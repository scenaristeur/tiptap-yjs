(self["webpackChunknoosphere3"]=self["webpackChunknoosphere3"]||[]).push([[998],{9662:function(t,e,n){var r=n(614),i=n(6330),s=TypeError;t.exports=function(t){if(r(t))return t;throw s(i(t)+" is not a function")}},6077:function(t,e,n){var r=n(614),i=String,s=TypeError;t.exports=function(t){if("object"==typeof t||r(t))return t;throw s("Can't set "+i(t)+" as a prototype")}},5787:function(t,e,n){var r=n(7976),i=TypeError;t.exports=function(t,e){if(r(e,t))return t;throw i("Incorrect invocation")}},9670:function(t,e,n){var r=n(111),i=String,s=TypeError;t.exports=function(t){if(r(t))return t;throw s(i(t)+" is not an object")}},3013:function(t){t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(t,e,n){"use strict";var r,i,s,o=n(3013),a=n(9781),c=n(7854),l=n(614),u=n(111),h=n(2597),d=n(648),f=n(6330),p=n(8880),g=n(8052),m=n(7045),y=n(7976),w=n(9518),b=n(7674),v=n(5112),E=n(9711),_=n(9909),S=_.enforce,A=_.get,C=c.Int8Array,I=C&&C.prototype,T=c.Uint8ClampedArray,k=T&&T.prototype,R=C&&w(C),N=I&&w(I),D=Object.prototype,O=c.TypeError,P=v("toStringTag"),x=E("TYPED_ARRAY_TAG"),M="TypedArrayConstructor",L=o&&!!b&&"Opera"!==d(c.opera),B=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},F={BigInt64Array:8,BigUint64Array:8},z=function(t){if(!u(t))return!1;var e=d(t);return"DataView"===e||h(U,e)||h(F,e)},V=function(t){var e=w(t);if(u(e)){var n=A(e);return n&&h(n,M)?n[M]:V(e)}},j=function(t){if(!u(t))return!1;var e=d(t);return h(U,e)||h(F,e)},H=function(t){if(j(t))return t;throw O("Target is not a typed array")},$=function(t){if(l(t)&&(!b||y(R,t)))return t;throw O(f(t)+" is not a typed array constructor")},K=function(t,e,n,r){if(a){if(n)for(var i in U){var s=c[i];if(s&&h(s.prototype,t))try{delete s.prototype[t]}catch(o){try{s.prototype[t]=e}catch(l){}}}N[t]&&!n||g(N,t,n?e:L&&I[t]||e,r)}},G=function(t,e,n){var r,i;if(a){if(b){if(n)for(r in U)if(i=c[r],i&&h(i,t))try{delete i[t]}catch(s){}if(R[t]&&!n)return;try{return g(R,t,n?e:L&&R[t]||e)}catch(s){}}for(r in U)i=c[r],!i||i[t]&&!n||g(i,t,e)}};for(r in U)i=c[r],s=i&&i.prototype,s?S(s)[M]=i:L=!1;for(r in F)i=c[r],s=i&&i.prototype,s&&(S(s)[M]=i);if((!L||!l(R)||R===Function.prototype)&&(R=function(){throw O("Incorrect invocation")},L))for(r in U)c[r]&&b(c[r],R);if((!L||!N||N===D)&&(N=R.prototype,L))for(r in U)c[r]&&b(c[r].prototype,N);if(L&&w(k)!==N&&b(k,N),a&&!h(N,P))for(r in B=!0,m(N,P,{configurable:!0,get:function(){return u(this)?this[x]:void 0}}),U)c[r]&&p(c[r],x,r);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:L,TYPED_ARRAY_TAG:B&&x,aTypedArray:H,aTypedArrayConstructor:$,exportTypedArrayMethod:K,exportTypedArrayStaticMethod:G,getTypedArrayConstructor:V,isView:z,isTypedArray:j,TypedArray:R,TypedArrayPrototype:N}},7745:function(t,e,n){var r=n(6244);t.exports=function(t,e){var n=0,i=r(e),s=new t(i);while(i>n)s[n]=e[n++];return s}},1318:function(t,e,n){var r=n(5656),i=n(1400),s=n(6244),o=function(t){return function(e,n,o){var a,c=r(e),l=s(c),u=i(o,l);if(t&&n!=n){while(l>u)if(a=c[u++],a!=a)return!0}else for(;l>u;u++)if((t||u in c)&&c[u]===n)return t||u||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},3658:function(t,e,n){"use strict";var r=n(9781),i=n(3157),s=TypeError,o=Object.getOwnPropertyDescriptor,a=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,e){if(i(t)&&!o(t,"length").writable)throw s("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},206:function(t,e,n){var r=n(1702);t.exports=r([].slice)},1843:function(t,e,n){var r=n(6244);t.exports=function(t,e){for(var n=r(t),i=new e(n),s=0;s<n;s++)i[s]=t[n-s-1];return i}},1572:function(t,e,n){var r=n(6244),i=n(9303),s=RangeError;t.exports=function(t,e,n,o){var a=r(t),c=i(n),l=c<0?a+c:c;if(l>=a||l<0)throw s("Incorrect index");for(var u=new e(a),h=0;h<a;h++)u[h]=h===l?o:t[h];return u}},4326:function(t,e,n){var r=n(1702),i=r({}.toString),s=r("".slice);t.exports=function(t){return s(i(t),8,-1)}},648:function(t,e,n){var r=n(1694),i=n(614),s=n(4326),o=n(5112),a=o("toStringTag"),c=Object,l="Arguments"==s(function(){return arguments}()),u=function(t,e){try{return t[e]}catch(n){}};t.exports=r?s:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=u(e=c(t),a))?n:l?s(e):"Object"==(r=s(e))&&i(e.callee)?"Arguments":r}},9920:function(t,e,n){var r=n(2597),i=n(3887),s=n(1236),o=n(3070);t.exports=function(t,e,n){for(var a=i(e),c=o.f,l=s.f,u=0;u<a.length;u++){var h=a[u];r(t,h)||n&&r(n,h)||c(t,h,l(e,h))}}},8544:function(t,e,n){var r=n(7293);t.exports=!r((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},8880:function(t,e,n){var r=n(9781),i=n(3070),s=n(9114);t.exports=r?function(t,e,n){return i.f(t,e,s(1,n))}:function(t,e,n){return t[e]=n,t}},9114:function(t){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},7045:function(t,e,n){var r=n(6339),i=n(3070);t.exports=function(t,e,n){return n.get&&r(n.get,e,{getter:!0}),n.set&&r(n.set,e,{setter:!0}),i.f(t,e,n)}},8052:function(t,e,n){var r=n(614),i=n(3070),s=n(6339),o=n(3072);t.exports=function(t,e,n,a){a||(a={});var c=a.enumerable,l=void 0!==a.name?a.name:e;if(r(n)&&s(n,l,a),a.global)c?t[e]=n:o(e,n);else{try{a.unsafe?t[e]&&(c=!0):delete t[e]}catch(u){}c?t[e]=n:i.f(t,e,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},3072:function(t,e,n){var r=n(7854),i=Object.defineProperty;t.exports=function(t,e){try{i(r,t,{value:e,configurable:!0,writable:!0})}catch(n){r[t]=e}return e}},5117:function(t,e,n){"use strict";var r=n(6330),i=TypeError;t.exports=function(t,e){if(!delete t[e])throw i("Cannot delete property "+r(e)+" of "+r(t))}},9781:function(t,e,n){var r=n(7293);t.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:function(t){var e="object"==typeof document&&document.all,n="undefined"==typeof e&&void 0!==e;t.exports={all:e,IS_HTMLDDA:n}},317:function(t,e,n){var r=n(7854),i=n(111),s=r.document,o=i(s)&&i(s.createElement);t.exports=function(t){return o?s.createElement(t):{}}},7207:function(t){var e=TypeError,n=9007199254740991;t.exports=function(t){if(t>n)throw e("Maximum allowed index exceeded");return t}},3678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},9363:function(t){t.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version},6833:function(t,e,n){var r=n(8113);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},5268:function(t,e,n){var r=n(4326);t.exports="undefined"!=typeof process&&"process"==r(process)},8113:function(t){t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7392:function(t,e,n){var r,i,s=n(7854),o=n(8113),a=s.process,c=s.Deno,l=a&&a.versions||c&&c.version,u=l&&l.v8;u&&(r=u.split("."),i=r[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&o&&(r=o.match(/Edge\/(\d+)/),(!r||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/),r&&(i=+r[1]))),t.exports=i},748:function(t){t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1060:function(t,e,n){var r=n(1702),i=Error,s=r("".replace),o=function(t){return String(i(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,c=a.test(o);t.exports=function(t,e){if(c&&"string"==typeof t&&!i.prepareStackTrace)while(e--)t=s(t,a,"");return t}},2109:function(t,e,n){var r=n(7854),i=n(1236).f,s=n(8880),o=n(8052),a=n(3072),c=n(9920),l=n(4705);t.exports=function(t,e){var n,u,h,d,f,p,g=t.target,m=t.global,y=t.stat;if(u=m?r:y?r[g]||a(g,{}):(r[g]||{}).prototype,u)for(h in e){if(f=e[h],t.dontCallGetSet?(p=i(u,h),d=p&&p.value):d=u[h],n=l(m?h:g+(y?".":"#")+h,t.forced),!n&&void 0!==d){if(typeof f==typeof d)continue;c(f,d)}(t.sham||d&&d.sham)&&s(f,"sham",!0),o(u,h,f,t)}}},7293:function(t){t.exports=function(t){try{return!!t()}catch(e){return!0}}},2104:function(t,e,n){var r=n(4374),i=Function.prototype,s=i.apply,o=i.call;t.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(s):function(){return o.apply(s,arguments)})},9974:function(t,e,n){var r=n(1470),i=n(9662),s=n(4374),o=r(r.bind);t.exports=function(t,e){return i(t),void 0===e?t:s?o(t,e):function(){return t.apply(e,arguments)}}},4374:function(t,e,n){var r=n(7293);t.exports=!r((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},6916:function(t,e,n){var r=n(4374),i=Function.prototype.call;t.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},6530:function(t,e,n){var r=n(9781),i=n(2597),s=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,a=i(s,"name"),c=a&&"something"===function(){}.name,l=a&&(!r||r&&o(s,"name").configurable);t.exports={EXISTS:a,PROPER:c,CONFIGURABLE:l}},5668:function(t,e,n){var r=n(1702),i=n(9662);t.exports=function(t,e,n){try{return r(i(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(s){}}},1470:function(t,e,n){var r=n(4326),i=n(1702);t.exports=function(t){if("Function"===r(t))return i(t)}},1702:function(t,e,n){var r=n(4374),i=Function.prototype,s=i.call,o=r&&i.bind.bind(s,s);t.exports=r?o:function(t){return function(){return s.apply(t,arguments)}}},5005:function(t,e,n){var r=n(7854),i=n(614),s=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?s(r[t]):r[t]&&r[t][e]}},8173:function(t,e,n){var r=n(9662),i=n(8554);t.exports=function(t,e){var n=t[e];return i(n)?void 0:r(n)}},7854:function(t,e,n){var r=function(t){return t&&t.Math==Math&&t};t.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},2597:function(t,e,n){var r=n(1702),i=n(7908),s=r({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return s(i(t),e)}},3501:function(t){t.exports={}},490:function(t,e,n){var r=n(5005);t.exports=r("document","documentElement")},4664:function(t,e,n){var r=n(9781),i=n(7293),s=n(317);t.exports=!r&&!i((function(){return 7!=Object.defineProperty(s("div"),"a",{get:function(){return 7}}).a}))},8361:function(t,e,n){var r=n(1702),i=n(7293),s=n(4326),o=Object,a=r("".split);t.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(t){return"String"==s(t)?a(t,""):o(t)}:o},9587:function(t,e,n){var r=n(614),i=n(111),s=n(7674);t.exports=function(t,e,n){var o,a;return s&&r(o=e.constructor)&&o!==n&&i(a=o.prototype)&&a!==n.prototype&&s(t,a),t}},2788:function(t,e,n){var r=n(1702),i=n(614),s=n(5465),o=r(Function.toString);i(s.inspectSource)||(s.inspectSource=function(t){return o(t)}),t.exports=s.inspectSource},9909:function(t,e,n){var r,i,s,o=n(4811),a=n(7854),c=n(111),l=n(8880),u=n(2597),h=n(5465),d=n(6200),f=n(3501),p="Object already initialized",g=a.TypeError,m=a.WeakMap,y=function(t){return s(t)?i(t):r(t,{})},w=function(t){return function(e){var n;if(!c(e)||(n=i(e)).type!==t)throw g("Incompatible receiver, "+t+" required");return n}};if(o||h.state){var b=h.state||(h.state=new m);b.get=b.get,b.has=b.has,b.set=b.set,r=function(t,e){if(b.has(t))throw g(p);return e.facade=t,b.set(t,e),e},i=function(t){return b.get(t)||{}},s=function(t){return b.has(t)}}else{var v=d("state");f[v]=!0,r=function(t,e){if(u(t,v))throw g(p);return e.facade=t,l(t,v,e),e},i=function(t){return u(t,v)?t[v]:{}},s=function(t){return u(t,v)}}t.exports={set:r,get:i,has:s,enforce:y,getterFor:w}},3157:function(t,e,n){var r=n(4326);t.exports=Array.isArray||function(t){return"Array"==r(t)}},4067:function(t,e,n){var r=n(648);t.exports=function(t){var e=r(t);return"BigInt64Array"==e||"BigUint64Array"==e}},614:function(t,e,n){var r=n(4154),i=r.all;t.exports=r.IS_HTMLDDA?function(t){return"function"==typeof t||t===i}:function(t){return"function"==typeof t}},4705:function(t,e,n){var r=n(7293),i=n(614),s=/#|\.prototype\./,o=function(t,e){var n=c[a(t)];return n==u||n!=l&&(i(e)?r(e):!!e)},a=o.normalize=function(t){return String(t).replace(s,".").toLowerCase()},c=o.data={},l=o.NATIVE="N",u=o.POLYFILL="P";t.exports=o},8554:function(t){t.exports=function(t){return null===t||void 0===t}},111:function(t,e,n){var r=n(614),i=n(4154),s=i.all;t.exports=i.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:r(t)||t===s}:function(t){return"object"==typeof t?null!==t:r(t)}},1913:function(t){t.exports=!1},2190:function(t,e,n){var r=n(5005),i=n(614),s=n(7976),o=n(3307),a=Object;t.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=r("Symbol");return i(e)&&s(e.prototype,a(t))}},6244:function(t,e,n){var r=n(7466);t.exports=function(t){return r(t.length)}},6339:function(t,e,n){var r=n(1702),i=n(7293),s=n(614),o=n(2597),a=n(9781),c=n(6530).CONFIGURABLE,l=n(2788),u=n(9909),h=u.enforce,d=u.get,f=String,p=Object.defineProperty,g=r("".slice),m=r("".replace),y=r([].join),w=a&&!i((function(){return 8!==p((function(){}),"length",{value:8}).length})),b=String(String).split("String"),v=t.exports=function(t,e,n){"Symbol("===g(f(e),0,7)&&(e="["+m(f(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!o(t,"name")||c&&t.name!==e)&&(a?p(t,"name",{value:e,configurable:!0}):t.name=e),w&&n&&o(n,"arity")&&t.length!==n.arity&&p(t,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?a&&p(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(i){}var r=h(t);return o(r,"source")||(r.source=y(b,"string"==typeof e?e:"")),t};Function.prototype.toString=v((function(){return s(this)&&d(this).source||l(this)}),"toString")},4758:function(t){var e=Math.ceil,n=Math.floor;t.exports=Math.trunc||function(t){var r=+t;return(r>0?n:e)(r)}},6277:function(t,e,n){var r=n(1340);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:r(t)}},3070:function(t,e,n){var r=n(9781),i=n(4664),s=n(3353),o=n(9670),a=n(4948),c=TypeError,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",f="writable";e.f=r?s?function(t,e,n){if(o(t),e=a(e),o(n),"function"===typeof t&&"prototype"===e&&"value"in n&&f in n&&!n[f]){var r=u(t,e);r&&r[f]&&(t[e]=n.value,n={configurable:d in n?n[d]:r[d],enumerable:h in n?n[h]:r[h],writable:!1})}return l(t,e,n)}:l:function(t,e,n){if(o(t),e=a(e),o(n),i)try{return l(t,e,n)}catch(r){}if("get"in n||"set"in n)throw c("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},1236:function(t,e,n){var r=n(9781),i=n(6916),s=n(5296),o=n(9114),a=n(5656),c=n(4948),l=n(2597),u=n(4664),h=Object.getOwnPropertyDescriptor;e.f=r?h:function(t,e){if(t=a(t),e=c(e),u)try{return h(t,e)}catch(n){}if(l(t,e))return o(!i(s.f,t,e),t[e])}},8006:function(t,e,n){var r=n(6324),i=n(748),s=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return r(t,s)}},5181:function(t,e){e.f=Object.getOwnPropertySymbols},9518:function(t,e,n){var r=n(2597),i=n(614),s=n(7908),o=n(6200),a=n(8544),c=o("IE_PROTO"),l=Object,u=l.prototype;t.exports=a?l.getPrototypeOf:function(t){var e=s(t);if(r(e,c))return e[c];var n=e.constructor;return i(n)&&e instanceof n?n.prototype:e instanceof l?u:null}},7976:function(t,e,n){var r=n(1702);t.exports=r({}.isPrototypeOf)},6324:function(t,e,n){var r=n(1702),i=n(2597),s=n(5656),o=n(1318).indexOf,a=n(3501),c=r([].push);t.exports=function(t,e){var n,r=s(t),l=0,u=[];for(n in r)!i(a,n)&&i(r,n)&&c(u,n);while(e.length>l)i(r,n=e[l++])&&(~o(u,n)||c(u,n));return u}},5296:function(t,e){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);e.f=i?function(t){var e=r(this,t);return!!e&&e.enumerable}:n},7674:function(t,e,n){var r=n(5668),i=n(9670),s=n(6077);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=r(Object.prototype,"__proto__","set"),t(n,[]),e=n instanceof Array}catch(o){}return function(n,r){return i(n),s(r),e?t(n,r):n.__proto__=r,n}}():void 0)},2140:function(t,e,n){var r=n(6916),i=n(614),s=n(111),o=TypeError;t.exports=function(t,e){var n,a;if("string"===e&&i(n=t.toString)&&!s(a=r(n,t)))return a;if(i(n=t.valueOf)&&!s(a=r(n,t)))return a;if("string"!==e&&i(n=t.toString)&&!s(a=r(n,t)))return a;throw o("Can't convert object to primitive value")}},3887:function(t,e,n){var r=n(5005),i=n(1702),s=n(8006),o=n(5181),a=n(9670),c=i([].concat);t.exports=r("Reflect","ownKeys")||function(t){var e=s.f(a(t)),n=o.f;return n?c(e,n(t)):e}},7066:function(t,e,n){"use strict";var r=n(9670);t.exports=function(){var t=r(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},4488:function(t,e,n){var r=n(8554),i=TypeError;t.exports=function(t){if(r(t))throw i("Can't call method on "+t);return t}},7152:function(t,e,n){"use strict";var r=n(7854),i=n(2104),s=n(614),o=n(9363),a=n(8113),c=n(206),l=n(8053),u=r.Function,h=/MSIE .\./.test(a)||o&&function(){var t=r.Bun.version.split(".");return t.length<3||0==t[0]&&(t[1]<3||3==t[1]&&0==t[2])}();t.exports=function(t,e){var n=e?2:1;return h?function(r,o){var a=l(arguments.length,1)>n,h=s(r)?r:u(r),d=a?c(arguments,n):[],f=a?function(){i(h,this,d)}:h;return e?t(f,o):t(f)}:t}},6200:function(t,e,n){var r=n(2309),i=n(9711),s=r("keys");t.exports=function(t){return s[t]||(s[t]=i(t))}},5465:function(t,e,n){var r=n(7854),i=n(3072),s="__core-js_shared__",o=r[s]||i(s,{});t.exports=o},2309:function(t,e,n){var r=n(1913),i=n(5465);(t.exports=function(t,e){return i[t]||(i[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.29.1",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.29.1/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:function(t,e,n){var r=n(7392),i=n(7293);t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},261:function(t,e,n){var r,i,s,o,a=n(7854),c=n(2104),l=n(9974),u=n(614),h=n(2597),d=n(7293),f=n(490),p=n(206),g=n(317),m=n(8053),y=n(6833),w=n(5268),b=a.setImmediate,v=a.clearImmediate,E=a.process,_=a.Dispatch,S=a.Function,A=a.MessageChannel,C=a.String,I=0,T={},k="onreadystatechange";d((function(){r=a.location}));var R=function(t){if(h(T,t)){var e=T[t];delete T[t],e()}},N=function(t){return function(){R(t)}},D=function(t){R(t.data)},O=function(t){a.postMessage(C(t),r.protocol+"//"+r.host)};b&&v||(b=function(t){m(arguments.length,1);var e=u(t)?t:S(t),n=p(arguments,1);return T[++I]=function(){c(e,void 0,n)},i(I),I},v=function(t){delete T[t]},w?i=function(t){E.nextTick(N(t))}:_&&_.now?i=function(t){_.now(N(t))}:A&&!y?(s=new A,o=s.port2,s.port1.onmessage=D,i=l(o.postMessage,o)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!d(O)?(i=O,a.addEventListener("message",D,!1)):i=k in g("script")?function(t){f.appendChild(g("script"))[k]=function(){f.removeChild(this),R(t)}}:function(t){setTimeout(N(t),0)}),t.exports={set:b,clear:v}},1400:function(t,e,n){var r=n(9303),i=Math.max,s=Math.min;t.exports=function(t,e){var n=r(t);return n<0?i(n+e,0):s(n,e)}},4599:function(t,e,n){var r=n(7593),i=TypeError;t.exports=function(t){var e=r(t,"number");if("number"==typeof e)throw i("Can't convert number to bigint");return BigInt(e)}},5656:function(t,e,n){var r=n(8361),i=n(4488);t.exports=function(t){return r(i(t))}},9303:function(t,e,n){var r=n(4758);t.exports=function(t){var e=+t;return e!==e||0===e?0:r(e)}},7466:function(t,e,n){var r=n(9303),i=Math.min;t.exports=function(t){return t>0?i(r(t),9007199254740991):0}},7908:function(t,e,n){var r=n(4488),i=Object;t.exports=function(t){return i(r(t))}},7593:function(t,e,n){var r=n(6916),i=n(111),s=n(2190),o=n(8173),a=n(2140),c=n(5112),l=TypeError,u=c("toPrimitive");t.exports=function(t,e){if(!i(t)||s(t))return t;var n,c=o(t,u);if(c){if(void 0===e&&(e="default"),n=r(c,t,e),!i(n)||s(n))return n;throw l("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},4948:function(t,e,n){var r=n(7593),i=n(2190);t.exports=function(t){var e=r(t,"string");return i(e)?e:e+""}},1694:function(t,e,n){var r=n(5112),i=r("toStringTag"),s={};s[i]="z",t.exports="[object z]"===String(s)},1340:function(t,e,n){var r=n(648),i=String;t.exports=function(t){if("Symbol"===r(t))throw TypeError("Cannot convert a Symbol value to a string");return i(t)}},6330:function(t){var e=String;t.exports=function(t){try{return e(t)}catch(n){return"Object"}}},9711:function(t,e,n){var r=n(1702),i=0,s=Math.random(),o=r(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++i+s,36)}},3307:function(t,e,n){var r=n(6293);t.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:function(t,e,n){var r=n(9781),i=n(7293);t.exports=r&&i((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8053:function(t){var e=TypeError;t.exports=function(t,n){if(t<n)throw e("Not enough arguments");return t}},4811:function(t,e,n){var r=n(7854),i=n(614),s=r.WeakMap;t.exports=i(s)&&/native code/.test(String(s))},5112:function(t,e,n){var r=n(7854),i=n(2309),s=n(2597),o=n(9711),a=n(6293),c=n(3307),l=r.Symbol,u=i("wks"),h=c?l["for"]||l:l&&l.withoutSetter||o;t.exports=function(t){return s(u,t)||(u[t]=a&&s(l,t)?l[t]:h("Symbol."+t)),u[t]}},7658:function(t,e,n){"use strict";var r=n(2109),i=n(7908),s=n(6244),o=n(3658),a=n(7207),c=n(7293),l=c((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},h=l||!u();r({target:"Array",proto:!0,arity:1,forced:h},{push:function(t){var e=i(this),n=s(e),r=arguments.length;a(n+r);for(var c=0;c<r;c++)e[n]=arguments[c],n++;return o(e,n),n}})},541:function(t,e,n){"use strict";var r=n(2109),i=n(7908),s=n(6244),o=n(3658),a=n(5117),c=n(7207),l=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(t){return t instanceof TypeError}},h=l||!u();r({target:"Array",proto:!0,arity:1,forced:h},{unshift:function(t){var e=i(this),n=s(e),r=arguments.length;if(r){c(n+r);var l=n;while(l--){var u=l+r;l in e?e[u]=e[l]:a(e,u)}for(var h=0;h<r;h++)e[h]=arguments[h]}return o(e,n+r)}})},2087:function(t,e,n){var r=n(7854),i=n(9781),s=n(7045),o=n(7066),a=n(7293),c=r.RegExp,l=c.prototype,u=i&&a((function(){var t=!0;try{c(".","d")}catch(u){t=!1}var e={},n="",r=t?"dgimsy":"gimsy",i=function(t,r){Object.defineProperty(e,t,{get:function(){return n+=r,!0}})},s={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in t&&(s.hasIndices="d"),s)i(o,s[o]);var a=Object.getOwnPropertyDescriptor(l,"flags").get.call(e);return a!==r||n!==r}));u&&s(l,"flags",{configurable:!0,get:o})},1439:function(t,e,n){"use strict";var r=n(1843),i=n(260),s=i.aTypedArray,o=i.exportTypedArrayMethod,a=i.getTypedArrayConstructor;o("toReversed",(function(){return r(s(this),a(this))}))},7585:function(t,e,n){"use strict";var r=n(260),i=n(1702),s=n(9662),o=n(7745),a=r.aTypedArray,c=r.getTypedArrayConstructor,l=r.exportTypedArrayMethod,u=i(r.TypedArrayPrototype.sort);l("toSorted",(function(t){void 0!==t&&s(t);var e=a(this),n=o(c(e),e);return u(n,t)}))},5315:function(t,e,n){"use strict";var r=n(1572),i=n(260),s=n(4067),o=n(9303),a=n(4599),c=i.aTypedArray,l=i.getTypedArrayConstructor,u=i.exportTypedArrayMethod,h=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();u("with",{with:function(t,e){var n=c(this),i=o(t),u=s(n)?a(e):+e;return r(n,l(n),i,u)}}["with"],!h)},3767:function(t,e,n){n(1439)},8585:function(t,e,n){n(7585)},8696:function(t,e,n){n(5315)},1091:function(t,e,n){var r=n(2109),i=n(7854),s=n(261).clear;r({global:!0,bind:!0,enumerable:!0,forced:i.clearImmediate!==s},{clearImmediate:s})},2801:function(t,e,n){"use strict";var r=n(2109),i=n(7854),s=n(5005),o=n(9114),a=n(3070).f,c=n(2597),l=n(5787),u=n(9587),h=n(6277),d=n(3678),f=n(1060),p=n(9781),g=n(1913),m="DOMException",y=s("Error"),w=s(m),b=function(){l(this,v);var t=arguments.length,e=h(t<1?void 0:arguments[0]),n=h(t<2?void 0:arguments[1],"Error"),r=new w(e,n),i=y(e);return i.name=m,a(r,"stack",o(1,f(i.stack,1))),u(r,this,b),r},v=b.prototype=w.prototype,E="stack"in y(m),_="stack"in new w(1,2),S=w&&p&&Object.getOwnPropertyDescriptor(i,m),A=!!S&&!(S.writable&&S.configurable),C=E&&!A&&!_;r({global:!0,constructor:!0,forced:g||C},{DOMException:C?b:w});var I=s(m),T=I.prototype;if(T.constructor!==I)for(var k in g||a(T,"constructor",o(1,I)),d)if(c(d,k)){var R=d[k],N=R.s;c(I,N)||a(I,N,o(6,R.c))}},4633:function(t,e,n){n(1091),n(2986)},2986:function(t,e,n){var r=n(2109),i=n(7854),s=n(261).set,o=n(7152),a=i.setImmediate?o(s,!1):s;r({global:!0,bind:!0,enumerable:!0,forced:i.setImmediate!==a},{setImmediate:a})},368:function(){},6742:function(){},1958:function(){},5110:function(){},7966:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=-8,i=-4,s=0,o=1,a=1,c=2,l=5,u=1024,h=2048,d=8192,f=0,p=4,g=8,m=12,y=12,w=16,b="undefined"!==typeof BigUint64Array,v=Symbol(),E=1024;function _(t,e){const n=new Uint32Array(t),r=new Uint16Array(t);var s=n[e+i>>>2]>>>1,o=e>>>1;if(s<=E)return String.fromCharCode.apply(String,r.subarray(o,o+s));const a=[];do{const t=r[o+E-1],e=t>=55296&&t<56320?E-1:E;a.push(String.fromCharCode.apply(String,r.subarray(o,o+=e))),s-=e}while(s>E);return a.join("")+String.fromCharCode.apply(String,r.subarray(o,o+s))}function S(t){const e={};function n(t,e){return t?_(t.buffer,e):"<yet unknown>"}const r=t.env=t.env||{};return r.abort=r.abort||function(t,i,s,o){const a=e.memory||r.memory;throw Error("abort: "+n(a,t)+" at "+n(a,i)+":"+s+":"+o)},r.trace=r.trace||function(t,i){const s=e.memory||r.memory;console.log("trace: "+n(s,t)+(i?" ":"")+Array.prototype.slice.call(arguments,2,2+i).join(", "))},t.Math=t.Math||Math,t.Date=t.Date||Date,e}function A(t,e){const n=e.exports,v=n.memory,E=n.table,S=n["__alloc"],A=n["__retain"],C=n["__rtti_base"]||-1;function I(t){const e=new Uint32Array(v.buffer),n=e[C>>>2];if((t>>>=0)>=n)throw Error("invalid id: "+t);return e[(C+4>>>2)+2*t]}function T(t){const e=new Uint32Array(v.buffer),n=e[C>>>2];if((t>>>=0)>=n)throw Error("invalid id: "+t);return e[(C+4>>>2)+2*t+1]}function k(t){return 31-Math.clz32(t>>>l&31)}function N(t){const e=t.length,n=S(e<<1,o),r=new Uint16Array(v.buffer);for(var i=0,s=n>>>1;i<e;++i)r[s+i]=t.charCodeAt(i);return n}function D(t){const e=v.buffer,n=new Uint32Array(e)[t+r>>>2];if(n!==o)throw Error("not a string: "+t);return _(e,t)}function O(t,e,n){const r=v.buffer;if(n)switch(t){case 2:return new Float32Array(r);case 3:return new Float64Array(r)}else switch(t){case 0:return new(e?Int8Array:Uint8Array)(r);case 1:return new(e?Int16Array:Uint16Array)(r);case 2:return new(e?Int32Array:Uint32Array)(r);case 3:return new(e?BigInt64Array:BigUint64Array)(r)}throw Error("unsupported align: "+t)}function P(t,e){const n=I(t);if(!(n&(a|c)))throw Error("not an array: "+t+" @ "+n);const r=k(n),i=e.length,o=S(i<<r,s),l=S(n&c?w:m,t),b=new Uint32Array(v.buffer);b[l+f>>>2]=A(o),b[l+p>>>2]=o,b[l+g>>>2]=i<<r,n&c&&(b[l+y>>>2]=i);const E=O(r,n&u,n&h);if(n&d)for(let s=0;s<i;++s)E[(o>>>r)+s]=A(e[s]);else E.set(e,o>>>r);return l}function x(t){const e=new Uint32Array(v.buffer),n=e[t+r>>>2],s=I(n);if(!(s&a))throw Error("not an array: "+n);const o=k(s);var l=e[t+p>>>2];const d=s&c?e[t+y>>>2]:e[l+i>>>2]>>>o;return O(o,s&u,s&h).subarray(l>>>=o,l+d)}function M(t){const e=x(t),n=e.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e[i];return r}function L(t){const e=v.buffer,n=new Uint32Array(e)[t+i>>>2];return e.slice(t,t+n)}function B(t,e,n){return new t(U(t,e,n))}function U(t,e,n){const r=v.buffer,s=new Uint32Array(r),o=s[n+p>>>2];return new t(r,o,s[o+i>>>2]>>>e)}function F(t,e){const n=new Uint32Array(v.buffer);var i=n[t+r>>>2];if(i<=n[C>>>2])do{if(i==e)return!0}while(i=T(i));return!1}return t.__allocString=N,t.__getString=D,t.__allocArray=P,t.__getArrayView=x,t.__getArray=M,t.__getArrayBuffer=L,t.__getInt8Array=B.bind(null,Int8Array,0),t.__getInt8ArrayView=U.bind(null,Int8Array,0),t.__getUint8Array=B.bind(null,Uint8Array,0),t.__getUint8ArrayView=U.bind(null,Uint8Array,0),t.__getUint8ClampedArray=B.bind(null,Uint8ClampedArray,0),t.__getUint8ClampedArrayView=U.bind(null,Uint8ClampedArray,0),t.__getInt16Array=B.bind(null,Int16Array,1),t.__getInt16ArrayView=U.bind(null,Int16Array,1),t.__getUint16Array=B.bind(null,Uint16Array,1),t.__getUint16ArrayView=U.bind(null,Uint16Array,1),t.__getInt32Array=B.bind(null,Int32Array,2),t.__getInt32ArrayView=U.bind(null,Int32Array,2),t.__getUint32Array=B.bind(null,Uint32Array,2),t.__getUint32ArrayView=U.bind(null,Uint32Array,2),b&&(t.__getInt64Array=B.bind(null,BigInt64Array,3),t.__getInt64ArrayView=U.bind(null,BigInt64Array,3),t.__getUint64Array=B.bind(null,BigUint64Array,3),t.__getUint64ArrayView=U.bind(null,BigUint64Array,3)),t.__getFloat32Array=B.bind(null,Float32Array,2),t.__getFloat32ArrayView=U.bind(null,Float32Array,2),t.__getFloat64Array=B.bind(null,Float64Array,3),t.__getFloat64ArrayView=U.bind(null,Float64Array,3),t.__instanceof=F,t.memory=t.memory||v,t.table=t.table||E,R(n,t)}function C(t){return"undefined"!==typeof Response&&t instanceof Response}async function I(t,e){return C(t=await t)?k(t,e):A(S(e||(e={})),await WebAssembly.instantiate(t instanceof WebAssembly.Module?t:await WebAssembly.compile(t),e))}function T(t,e){return A(S(e||(e={})),new WebAssembly.Instance(t instanceof WebAssembly.Module?t:new WebAssembly.Module(t),e))}async function k(t,e){return WebAssembly.instantiateStreaming?A(S(e||(e={})),(await WebAssembly.instantiateStreaming(t,e)).instance):I(C(t=await t)?t.arrayBuffer():t,e)}function R(t,e){var n=e?Object.create(e):{},r=t["__argumentsLength"]?function(e){t["__argumentsLength"].value=e}:t["__setArgumentsLength"]||t["__setargc"]||function(){};for(let i in t){if(!Object.prototype.hasOwnProperty.call(t,i))continue;const e=t[i];let s=i.split("."),o=n;while(s.length>1){let t=s.shift();Object.prototype.hasOwnProperty.call(o,t)||(o[t]={}),o=o[t]}let a=s[0],c=a.indexOf("#");if(c>=0){let n=a.substring(0,c),s=o[n];if("undefined"===typeof s||!s.prototype){let t=function(...e){return t.wrap(t.prototype.constructor(0,...e))};t.prototype={valueOf:function(){return this[v]}},t.wrap=function(e){return Object.create(t.prototype,{[v]:{value:e,writable:!1}})},s&&Object.getOwnPropertyNames(s).forEach((e=>Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e)))),o[n]=t}if(a=a.substring(c+1),o=o[n].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let e=t[i.replace("set:","get:")],n=t[i.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return e(this[v])},set:function(t){n(this[v],t)},enumerable:!0})}}else"constructor"===a?(o[a]=(...t)=>(r(t.length),e(...t))).original=e:(o[a]=function(...t){return r(t.length),e(this[v],...t)}).original=e}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:t[i.replace("set:","get:")],set:t[i.replace("get:","set:")],enumerable:!0}):"function"===typeof e&&e!==r?(o[a]=(...t)=>(r(t.length),e(...t))).original=e:o[a]=e}return n}e.instantiate=I,e.instantiateSync=T,e.instantiateStreaming=k,e.demangle=R},9145:function(t,e,n){"use strict";t.exports=n(1444)},1444:function(t,e,n){"use strict";var r=e;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(5770),r.BufferWriter=n(5910),r.Reader=n(8438),r.BufferReader=n(3479),r.util=n(3497),r.rpc=n(1735),r.roots=n(819),r.configure=i,i()},8438:function(t,e,n){"use strict";n(3767),n(8585),n(8696),t.exports=c;var r,i=n(3497),s=i.LongBits,o=i.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function c(t){this.buf=t,this.pos=0,this.len=t.length}var l="undefined"!==typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new c(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new c(t);throw Error("illegal buffer")},u=function(){return i.Buffer?function(t){return(c.create=function(t){return i.Buffer.isBuffer(t)?new r(t):l(t)})(t)}:l};function h(){var t=new s(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return t}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},c.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},c.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},c.prototype.skip=function(t){if("number"===typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while(4!==(t=7&this.uint32()))this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},c._configure=function(t){r=t,c.create=u(),r._configure();var e=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return h.call(this)[e](!1)},uint64:function(){return h.call(this)[e](!0)},sint64:function(){return h.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},3479:function(t,e,n){"use strict";t.exports=s;var r=n(8438);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(3497);function s(t){r.call(this,t)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},s._configure()},819:function(t){"use strict";t.exports={}},1735:function(t,e,n){"use strict";var r=e;r.Service=n(8782)},8782:function(t,e,n){"use strict";t.exports=i;var r=n(3497);function i(t,e,n){if("function"!==typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function t(e,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(t,a,e,n,i,s);if(a.rpcImpl)try{return a.rpcImpl(e,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(t,n){if(t)return a.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",n,e),o(null,n)}a.end(!0)}))}catch(c){return a.emit("error",c,e),void setTimeout((function(){o(c)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},5688:function(t,e,n){"use strict";t.exports=i;var r=n(3497);function i(t,e){this.lo=t>>>0,this.hi=e>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(t){if(0===t)return s;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(t){if("number"===typeof t)return i.fromNumber(t);if(r.isString(t)){if(!r.Long)return i.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new i(t.low>>>0,t.high>>>0):s},i.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;i.fromHash=function(t){return t===o?s:new i((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},i.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},i.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},3497:function(t,e,n){"use strict";n(3767),n(8585),n(8696);var r=e;function i(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function s(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}r.asPromise=n(3551),r.base64=n(8550),r.EventEmitter=n(8447),r.float=n(891),r.inquire=n(4842),r.utf8=n(479),r.pool=n(1387),r.LongBits=n(5688),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"===typeof t||t instanceof String},r.isObject=function(t){return t&&"object"===typeof t},r.isset=r.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(t){return"number"===typeof t?r.Buffer?r._Buffer_allocUnsafe(t):new r.Array(t):r.Buffer?r._Buffer_from(t):"undefined"===typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){var n=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},r.merge=i,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},r.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var t=r.Buffer;t?(r._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},r._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},5770:function(t,e,n){"use strict";t.exports=h;var r,i=n(3497),s=i.LongBits,o=i.base64,a=i.utf8;function c(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function l(){}function u(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function f(t,e,n){e[n]=255&t}function p(t,e,n){while(t>127)e[n++]=127&t|128,t>>>=7;e[n]=t}function g(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,n){while(t.hi)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;while(t.lo>127)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function y(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}h.create=d(),h.alloc=function(t){return new i.Array(t)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(t,e,n){return this.tail=this.tail.next=new c(t,e,n),this.len+=e,this},g.prototype=Object.create(c.prototype),g.prototype.fn=p,h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new g((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(m,10,s.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=s.from(t);return this._push(m,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=s.from(t).zzEncode();return this._push(m,e.length(),e)},h.prototype.bool=function(t){return this._push(f,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(y,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=s.from(t);return this._push(y,4,e.lo)._push(y,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(i.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(i.float.writeDoubleLE,8,t)};var w=i.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(f,1,0);if(i.isString(t)){var n=h.alloc(e=o.length(t));o.decode(t,n,0),t=n}return this.uint32(e)._push(w,e,t)},h.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},h.prototype.finish=function(){var t=this.head.next,e=this.constructor.alloc(this.len),n=0;while(t)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},h._configure=function(t){r=t,h.create=d(),r._configure()}},5910:function(t,e,n){"use strict";n(3767),n(8585),n(8696),t.exports=s;var r=n(5770);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(3497);function s(){r.call(this)}function o(t,e,n){t.length<40?i.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]}},s.prototype.bytes=function(t){i.isString(t)&&(t=i._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(s.writeBytesBuffer,e,t),this},s.prototype.string=function(t){var e=i.Buffer.byteLength(t);return this.uint32(e),e&&this._push(o,e,t),this},s._configure()},3551:function(t){"use strict";function e(t,e){var n=new Array(arguments.length-1),r=0,i=2,s=!0;while(i<arguments.length)n[r++]=arguments[i++];return new Promise((function(i,o){n[r]=function(t){if(s)if(s=!1,t)o(t);else{var e=new Array(arguments.length-1),n=0;while(n<e.length)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(a){s&&(s=!1,o(a))}}))}t.exports=e},8550:function(t,e,n){"use strict";n(7658);var r=e;r.length=function(t){var e=t.length;if(!e)return 0;var n=0;while(--e%4>1&&"="===t.charAt(e))++n;return Math.ceil(3*t.length)/4-n};for(var i=new Array(64),s=new Array(123),o=0;o<64;)s[i[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;r.encode=function(t,e,n){var r,s=null,o=[],a=0,c=0;while(e<n){var l=t[e++];switch(c){case 0:o[a++]=i[l>>2],r=(3&l)<<4,c=1;break;case 1:o[a++]=i[r|l>>4],r=(15&l)<<2,c=2;break;case 2:o[a++]=i[r|l>>6],o[a++]=i[63&l],c=0;break}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=i[r],o[a++]=61,1===c&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var a="invalid encoding";r.decode=function(t,e,n){for(var r,i=n,o=0,c=0;c<t.length;){var l=t.charCodeAt(c++);if(61===l&&o>1)break;if(void 0===(l=s[l]))throw Error(a);switch(o){case 0:r=l,o=1;break;case 1:e[n++]=r<<2|(48&l)>>4,r=l,o=2;break;case 2:e[n++]=(15&r)<<4|(60&l)>>2,r=l,o=3;break;case 3:e[n++]=(3&r)<<6|l,o=0;break}}if(1===o)throw Error(a);return n-i},r.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},8447:function(t,e,n){"use strict";function r(){this._listeners={}}n(7658),t.exports=r,r.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},r.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},r.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this}},891:function(t,e,n){"use strict";function r(t){return"undefined"!==typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=128===n[3];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(t,r,i){e[0]=t,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function o(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],e[0]}function a(t,r){return n[3]=t[r],n[2]=t[r+1],n[1]=t[r+2],n[0]=t[r+3],e[0]}t.writeFloatLE=r?i:s,t.writeFloatBE=r?s:i,t.readFloatLE=r?o:a,t.readFloatBE=r?a:o}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>34028234663852886e22)t((i<<31|2139095040)>>>0,n,r);else if(e<11754943508222875e-54)t((i<<31|Math.round(e/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(e)/Math.LN2),o=8388607&Math.round(e*Math.pow(2,-s)*8388608);t((i<<31|s+127<<23|o)>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,s=r>>>23&255,o=8388607&r;return 255===s?o?NaN:i*(1/0):0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}t.writeFloatLE=e.bind(null,i),t.writeFloatBE=e.bind(null,s),t.readFloatLE=n.bind(null,o),t.readFloatBE=n.bind(null,a)}(),"undefined"!==typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=128===n[7];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(t,r,i){e[0]=t,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function o(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5],n[6]=t[r+6],n[7]=t[r+7],e[0]}function a(t,r){return n[7]=t[r],n[6]=t[r+1],n[5]=t[r+2],n[4]=t[r+3],n[3]=t[r+4],n[2]=t[r+5],n[1]=t[r+6],n[0]=t[r+7],e[0]}t.writeDoubleLE=r?i:s,t.writeDoubleBE=r?s:i,t.readDoubleLE=r?o:a,t.readDoubleBE=r?a:o}():function(){function e(t,e,n,r,i,s){var o=r<0?1:0;if(o&&(r=-r),0===r)t(0,i,s+e),t(1/r>0?0:2147483648,i,s+n);else if(isNaN(r))t(0,i,s+e),t(2146959360,i,s+n);else if(r>17976931348623157e292)t(0,i,s+e),t((o<<31|2146435072)>>>0,i,s+n);else{var a;if(r<22250738585072014e-324)a=r/5e-324,t(a>>>0,i,s+e),t((o<<31|a/4294967296)>>>0,i,s+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),a=r*Math.pow(2,-c),t(4503599627370496*a>>>0,i,s+e),t((o<<31|c+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}}function n(t,e,n,r,i){var s=t(r,i+e),o=t(r,i+n),a=2*(o>>31)+1,c=o>>>20&2047,l=4294967296*(1048575&o)+s;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}t.writeDoubleLE=e.bind(null,i,0,4),t.writeDoubleBE=e.bind(null,s,4,0),t.readDoubleLE=n.bind(null,o,0,4),t.readDoubleBE=n.bind(null,a,4,0)}(),t}function i(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function s(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function o(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function a(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}n(3767),n(8585),n(8696),t.exports=r(r)},4842:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},1387:function(t){"use strict";function e(t,e,n){var r=n||8192,i=r>>>1,s=null,o=r;return function(n){if(n<1||n>i)return t(n);o+n>r&&(s=t(r),o=0);var a=e.call(s,o,o+=n);return 7&o&&(o=1+(7|o)),a}}t.exports=e},479:function(t,e,n){"use strict";n(7658);var r=e;r.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:55296===(64512&n)&&56320===(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},r.read=function(t,e,n){var r=n-e;if(r<1)return"";var i,s=null,o=[],a=0;while(e<n)i=t[e++],i<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(t,e,n){for(var r,i,s=n,o=0;o<t.length;++o)r=t.charCodeAt(o),r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296===(64512&r)&&56320===(64512&(i=t.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&i),++o,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-s}},3419:function(t,e,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(e,"__esModule",{value:!0});var r=n(6773);function i(t,e){return void 0===e&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}function s(t,e){return void 0===e&&(e=0),(t[e+0]<<8|t[e+1])>>>0}function o(t,e){return void 0===e&&(e=0),(t[e+1]<<8|t[e])<<16>>16}function a(t,e){return void 0===e&&(e=0),(t[e+1]<<8|t[e])>>>0}function c(t,e,n){return void 0===e&&(e=new Uint8Array(2)),void 0===n&&(n=0),e[n+0]=t>>>8,e[n+1]=t>>>0,e}function l(t,e,n){return void 0===e&&(e=new Uint8Array(2)),void 0===n&&(n=0),e[n+0]=t>>>0,e[n+1]=t>>>8,e}function u(t,e){return void 0===e&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}function h(t,e){return void 0===e&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}function d(t,e){return void 0===e&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}function f(t,e){return void 0===e&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}function p(t,e,n){return void 0===e&&(e=new Uint8Array(4)),void 0===n&&(n=0),e[n+0]=t>>>24,e[n+1]=t>>>16,e[n+2]=t>>>8,e[n+3]=t>>>0,e}function g(t,e,n){return void 0===e&&(e=new Uint8Array(4)),void 0===n&&(n=0),e[n+0]=t>>>0,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24,e}function m(t,e){void 0===e&&(e=0);var n=u(t,e),r=u(t,e+4);return 4294967296*n+r-4294967296*(r>>31)}function y(t,e){void 0===e&&(e=0);var n=h(t,e),r=h(t,e+4);return 4294967296*n+r}function w(t,e){void 0===e&&(e=0);var n=d(t,e),r=d(t,e+4);return 4294967296*r+n-4294967296*(n>>31)}function b(t,e){void 0===e&&(e=0);var n=f(t,e),r=f(t,e+4);return 4294967296*r+n}function v(t,e,n){return void 0===e&&(e=new Uint8Array(8)),void 0===n&&(n=0),p(t/4294967296>>>0,e,n),p(t>>>0,e,n+4),e}function E(t,e,n){return void 0===e&&(e=new Uint8Array(8)),void 0===n&&(n=0),g(t>>>0,e,n),g(t/4294967296>>>0,e,n+4),e}function _(t,e,n){if(void 0===n&&(n=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-n)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,i=1,s=t/8+n-1;s>=n;s--)r+=e[s]*i,i*=256;return r}function S(t,e,n){if(void 0===n&&(n=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-n)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,i=1,s=n;s<n+t/8;s++)r+=e[s]*i,i*=256;return r}function A(t,e,n,i){if(void 0===n&&(n=new Uint8Array(t/8)),void 0===i&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!r.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var s=1,o=t/8+i-1;o>=i;o--)n[o]=e/s&255,s*=256;return n}function C(t,e,n,i){if(void 0===n&&(n=new Uint8Array(t/8)),void 0===i&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!r.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var s=1,o=i;o<i+t/8;o++)n[o]=e/s&255,s*=256;return n}function I(t,e){void 0===e&&(e=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getFloat32(e)}function T(t,e){void 0===e&&(e=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getFloat32(e,!0)}function k(t,e){void 0===e&&(e=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getFloat64(e)}function R(t,e){void 0===e&&(e=0);var n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getFloat64(e,!0)}function N(t,e,n){void 0===e&&(e=new Uint8Array(4)),void 0===n&&(n=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(n,t),e}function D(t,e,n){void 0===e&&(e=new Uint8Array(4)),void 0===n&&(n=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat32(n,t,!0),e}function O(t,e,n){void 0===e&&(e=new Uint8Array(8)),void 0===n&&(n=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(n,t),e}function P(t,e,n){void 0===e&&(e=new Uint8Array(8)),void 0===n&&(n=0);var r=new DataView(e.buffer,e.byteOffset,e.byteLength);return r.setFloat64(n,t,!0),e}e.readInt16BE=i,e.readUint16BE=s,e.readInt16LE=o,e.readUint16LE=a,e.writeUint16BE=c,e.writeInt16BE=c,e.writeUint16LE=l,e.writeInt16LE=l,e.readInt32BE=u,e.readUint32BE=h,e.readInt32LE=d,e.readUint32LE=f,e.writeUint32BE=p,e.writeInt32BE=p,e.writeUint32LE=g,e.writeInt32LE=g,e.readInt64BE=m,e.readUint64BE=y,e.readInt64LE=w,e.readUint64LE=b,e.writeUint64BE=v,e.writeInt64BE=v,e.writeUint64LE=E,e.writeInt64LE=E,e.readUintBE=_,e.readUintLE=S,e.writeUintBE=A,e.writeUintLE=C,e.readFloat32BE=I,e.readFloat32LE=T,e.readFloat64BE=k,e.readFloat64LE=R,e.writeFloat32BE=N,e.writeFloat32LE=D,e.writeFloat64BE=O,e.writeFloat64LE=P},5593:function(t,e,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(e,"__esModule",{value:!0});var r=n(3419),i=n(6835),s=20;function o(t,e,n){for(var i=1634760805,o=857760878,a=2036477234,c=1797285236,l=n[3]<<24|n[2]<<16|n[1]<<8|n[0],u=n[7]<<24|n[6]<<16|n[5]<<8|n[4],h=n[11]<<24|n[10]<<16|n[9]<<8|n[8],d=n[15]<<24|n[14]<<16|n[13]<<8|n[12],f=n[19]<<24|n[18]<<16|n[17]<<8|n[16],p=n[23]<<24|n[22]<<16|n[21]<<8|n[20],g=n[27]<<24|n[26]<<16|n[25]<<8|n[24],m=n[31]<<24|n[30]<<16|n[29]<<8|n[28],y=e[3]<<24|e[2]<<16|e[1]<<8|e[0],w=e[7]<<24|e[6]<<16|e[5]<<8|e[4],b=e[11]<<24|e[10]<<16|e[9]<<8|e[8],v=e[15]<<24|e[14]<<16|e[13]<<8|e[12],E=i,_=o,S=a,A=c,C=l,I=u,T=h,k=d,R=f,N=p,D=g,O=m,P=y,x=w,M=b,L=v,B=0;B<s;B+=2)E=E+C|0,P^=E,P=P>>>16|P<<16,R=R+P|0,C^=R,C=C>>>20|C<<12,_=_+I|0,x^=_,x=x>>>16|x<<16,N=N+x|0,I^=N,I=I>>>20|I<<12,S=S+T|0,M^=S,M=M>>>16|M<<16,D=D+M|0,T^=D,T=T>>>20|T<<12,A=A+k|0,L^=A,L=L>>>16|L<<16,O=O+L|0,k^=O,k=k>>>20|k<<12,S=S+T|0,M^=S,M=M>>>24|M<<8,D=D+M|0,T^=D,T=T>>>25|T<<7,A=A+k|0,L^=A,L=L>>>24|L<<8,O=O+L|0,k^=O,k=k>>>25|k<<7,_=_+I|0,x^=_,x=x>>>24|x<<8,N=N+x|0,I^=N,I=I>>>25|I<<7,E=E+C|0,P^=E,P=P>>>24|P<<8,R=R+P|0,C^=R,C=C>>>25|C<<7,E=E+I|0,L^=E,L=L>>>16|L<<16,D=D+L|0,I^=D,I=I>>>20|I<<12,_=_+T|0,P^=_,P=P>>>16|P<<16,O=O+P|0,T^=O,T=T>>>20|T<<12,S=S+k|0,x^=S,x=x>>>16|x<<16,R=R+x|0,k^=R,k=k>>>20|k<<12,A=A+C|0,M^=A,M=M>>>16|M<<16,N=N+M|0,C^=N,C=C>>>20|C<<12,S=S+k|0,x^=S,x=x>>>24|x<<8,R=R+x|0,k^=R,k=k>>>25|k<<7,A=A+C|0,M^=A,M=M>>>24|M<<8,N=N+M|0,C^=N,C=C>>>25|C<<7,_=_+T|0,P^=_,P=P>>>24|P<<8,O=O+P|0,T^=O,T=T>>>25|T<<7,E=E+I|0,L^=E,L=L>>>24|L<<8,D=D+L|0,I^=D,I=I>>>25|I<<7;r.writeUint32LE(E+i|0,t,0),r.writeUint32LE(_+o|0,t,4),r.writeUint32LE(S+a|0,t,8),r.writeUint32LE(A+c|0,t,12),r.writeUint32LE(C+l|0,t,16),r.writeUint32LE(I+u|0,t,20),r.writeUint32LE(T+h|0,t,24),r.writeUint32LE(k+d|0,t,28),r.writeUint32LE(R+f|0,t,32),r.writeUint32LE(N+p|0,t,36),r.writeUint32LE(D+g|0,t,40),r.writeUint32LE(O+m|0,t,44),r.writeUint32LE(P+y|0,t,48),r.writeUint32LE(x+w|0,t,52),r.writeUint32LE(M+b|0,t,56),r.writeUint32LE(L+v|0,t,60)}function a(t,e,n,r,s){if(void 0===s&&(s=0),32!==t.length)throw new Error("ChaCha: key size must be 32 bytes");if(r.length<n.length)throw new Error("ChaCha: destination is shorter than source");var a,c;if(0===s){if(8!==e.length&&12!==e.length)throw new Error("ChaCha nonce must be 8 or 12 bytes");a=new Uint8Array(16),c=a.length-e.length,a.set(e,c)}else{if(16!==e.length)throw new Error("ChaCha nonce with counter must be 16 bytes");a=e,c=s}for(var u=new Uint8Array(64),h=0;h<n.length;h+=64){o(u,a,t);for(var d=h;d<h+64&&d<n.length;d++)r[d]=n[d]^u[d-h];l(a,0,c)}return i.wipe(u),0===s&&i.wipe(a),r}function c(t,e,n,r){return void 0===r&&(r=0),i.wipe(n),a(t,e,n,n,r)}function l(t,e,n){var r=1;while(n--)r=r+(255&t[e])|0,t[e]=255&r,r>>>=8,e++;if(r>0)throw new Error("ChaCha: counter overflow")}e.streamXOR=a,e.stream=c},5602:function(t,e,n){"use strict";n(3767),n(8585),n(8696);var r=n(5593),i=n(9952),s=n(6835),o=n(3419),a=n(3229);e.Cv=32,e.WH=12,e.pg=16;var c=new Uint8Array(16),l=function(){function t(t){if(this.nonceLength=e.WH,this.tagLength=e.pg,t.length!==e.Cv)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(t)}return t.prototype.seal=function(t,e,n,i){if(t.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var o=new Uint8Array(16);o.set(t,o.length-t.length);var a=new Uint8Array(32);r.stream(this._key,o,a,4);var c,l=e.length+this.tagLength;if(i){if(i.length!==l)throw new Error("ChaCha20Poly1305: incorrect destination length");c=i}else c=new Uint8Array(l);return r.streamXOR(this._key,o,e,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),a,c.subarray(0,c.length-this.tagLength),n),s.wipe(o),c},t.prototype.open=function(t,e,n,i){if(t.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(e.length<this.tagLength)return null;var o=new Uint8Array(16);o.set(t,o.length-t.length);var c=new Uint8Array(32);r.stream(this._key,o,c,4);var l=new Uint8Array(this.tagLength);if(this._authenticate(l,c,e.subarray(0,e.length-this.tagLength),n),!a.equal(l,e.subarray(e.length-this.tagLength,e.length)))return null;var u,h=e.length-this.tagLength;if(i){if(i.length!==h)throw new Error("ChaCha20Poly1305: incorrect destination length");u=i}else u=new Uint8Array(h);return r.streamXOR(this._key,o,e.subarray(0,e.length-this.tagLength),u,4),s.wipe(o),u},t.prototype.clean=function(){return s.wipe(this._key),this},t.prototype._authenticate=function(t,e,n,r){var a=new i.Poly1305(e);r&&(a.update(r),r.length%16>0&&a.update(c.subarray(r.length%16))),a.update(n),n.length%16>0&&a.update(c.subarray(n.length%16));var l=new Uint8Array(8);r&&o.writeUint64LE(r.length,l),a.update(l),o.writeUint64LE(n.length,l),a.update(l);for(var u=a.digest(),h=0;h<u.length;h++)t[h]=u[h];a.clean(),s.wipe(u),s.wipe(l)},t}();e.OK=l},3229:function(t,e){"use strict";function n(t,e,n){return~(t-1)&e|t-1&n}function r(t,e){return(0|t)-(0|e)-1>>>31&1}function i(t,e){if(t.length!==e.length)return 0;for(var n=0,r=0;r<t.length;r++)n|=t[r]^e[r];return 1&n-1>>>8}function s(t,e){return 0!==t.length&&0!==e.length&&0!==i(t,e)}Object.defineProperty(e,"__esModule",{value:!0}),e.select=n,e.lessOrEqual=r,e.compare=i,e.equal=s},1737:function(t,e){"use strict";function n(t){return"undefined"!==typeof t.saveState&&"undefined"!==typeof t.restoreState&&"undefined"!==typeof t.cleanSavedState}Object.defineProperty(e,"__esModule",{value:!0}),e.isSerializableHash=n},3017:function(t,e,n){"use strict";n(3767),n(8585),n(8696);var r=n(4135),i=n(6835),s=function(){function t(t,e,n,i){void 0===n&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=t,this._info=i;var s=r.hmac(this._hash,n,e);this._hmac=new r.HMAC(t,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var t=this._counter[0];if(0===t)throw new Error("hkdf: cannot expand more");this._hmac.reset(),t>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(t){for(var e=new Uint8Array(t),n=0;n<e.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),e[n]=this._buffer[this._bufpos++];return e},t.prototype.clean=function(){this._hmac.clean(),i.wipe(this._buffer),i.wipe(this._counter),this._bufpos=0},t}();e.t=s},4135:function(t,e,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(e,"__esModule",{value:!0});var r=n(1737),i=n(3229),s=n(6835),o=function(){function t(t,e){this._finished=!1,this._inner=new t,this._outer=new t,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);e.length>this.blockSize?this._inner.update(e).finish(n).clean():n.set(e);for(var i=0;i<n.length;i++)n[i]^=54;this._inner.update(n);for(i=0;i<n.length;i++)n[i]^=106;this._outer.update(n),r.isSerializableHash(this._inner)&&r.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),s.wipe(n)}return t.prototype.reset=function(){if(!r.isSerializableHash(this._inner)||!r.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){r.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),r.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(t){return this._inner.update(t),this},t.prototype.finish=function(t){return this._finished?(this._outer.finish(t),this):(this._inner.finish(t),this._outer.update(t.subarray(0,this.digestLength)).finish(t),this._finished=!0,this)},t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},t.prototype.saveState=function(){if(!r.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(t){if(!r.isSerializableHash(this._inner)||!r.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(t),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(t){if(!r.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(t)},t}();function a(t,e,n){var r=new o(t,e);r.update(n);var i=r.digest();return r.clean(),i}e.HMAC=o,e.hmac=a,e.equal=i.equal},6773:function(t,e){"use strict";function n(t,e){var n=t>>>16&65535,r=65535&t,i=e>>>16&65535,s=65535&e;return r*s+(n*s+r*i<<16>>>0)|0}function r(t,e){return t+e|0}function i(t,e){return t-e|0}function s(t,e){return t<<e|t>>>32-e}function o(t,e){return t<<32-e|t>>>e}function a(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t}Object.defineProperty(e,"__esModule",{value:!0}),e.mul=Math.imul||n,e.add=r,e.sub=i,e.rotl=s,e.rotr=o,e.isInteger=Number.isInteger||a,e.MAX_SAFE_INTEGER=9007199254740991,e.isSafeInteger=function(t){return e.isInteger(t)&&t>=-e.MAX_SAFE_INTEGER&&t<=e.MAX_SAFE_INTEGER}},9952:function(t,e,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(e,"__esModule",{value:!0});var r=n(3229),i=n(6835);e.DIGEST_LENGTH=16;var s=function(){function t(t){this.digestLength=e.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var n=t[0]|t[1]<<8;this._r[0]=8191&n;var r=t[2]|t[3]<<8;this._r[1]=8191&(n>>>13|r<<3);var i=t[4]|t[5]<<8;this._r[2]=7939&(r>>>10|i<<6);var s=t[6]|t[7]<<8;this._r[3]=8191&(i>>>7|s<<9);var o=t[8]|t[9]<<8;this._r[4]=255&(s>>>4|o<<12),this._r[5]=o>>>1&8190;var a=t[10]|t[11]<<8;this._r[6]=8191&(o>>>14|a<<2);var c=t[12]|t[13]<<8;this._r[7]=8065&(a>>>11|c<<5);var l=t[14]|t[15]<<8;this._r[8]=8191&(c>>>8|l<<8),this._r[9]=l>>>5&127,this._pad[0]=t[16]|t[17]<<8,this._pad[1]=t[18]|t[19]<<8,this._pad[2]=t[20]|t[21]<<8,this._pad[3]=t[22]|t[23]<<8,this._pad[4]=t[24]|t[25]<<8,this._pad[5]=t[26]|t[27]<<8,this._pad[6]=t[28]|t[29]<<8,this._pad[7]=t[30]|t[31]<<8}return t.prototype._blocks=function(t,e,n){var r=this._fin?0:2048,i=this._h[0],s=this._h[1],o=this._h[2],a=this._h[3],c=this._h[4],l=this._h[5],u=this._h[6],h=this._h[7],d=this._h[8],f=this._h[9],p=this._r[0],g=this._r[1],m=this._r[2],y=this._r[3],w=this._r[4],b=this._r[5],v=this._r[6],E=this._r[7],_=this._r[8],S=this._r[9];while(n>=16){var A=t[e+0]|t[e+1]<<8;i+=8191&A;var C=t[e+2]|t[e+3]<<8;s+=8191&(A>>>13|C<<3);var I=t[e+4]|t[e+5]<<8;o+=8191&(C>>>10|I<<6);var T=t[e+6]|t[e+7]<<8;a+=8191&(I>>>7|T<<9);var k=t[e+8]|t[e+9]<<8;c+=8191&(T>>>4|k<<12),l+=k>>>1&8191;var R=t[e+10]|t[e+11]<<8;u+=8191&(k>>>14|R<<2);var N=t[e+12]|t[e+13]<<8;h+=8191&(R>>>11|N<<5);var D=t[e+14]|t[e+15]<<8;d+=8191&(N>>>8|D<<8),f+=D>>>5|r;var O=0,P=O;P+=i*p,P+=s*(5*S),P+=o*(5*_),P+=a*(5*E),P+=c*(5*v),O=P>>>13,P&=8191,P+=l*(5*b),P+=u*(5*w),P+=h*(5*y),P+=d*(5*m),P+=f*(5*g),O+=P>>>13,P&=8191;var x=O;x+=i*g,x+=s*p,x+=o*(5*S),x+=a*(5*_),x+=c*(5*E),O=x>>>13,x&=8191,x+=l*(5*v),x+=u*(5*b),x+=h*(5*w),x+=d*(5*y),x+=f*(5*m),O+=x>>>13,x&=8191;var M=O;M+=i*m,M+=s*g,M+=o*p,M+=a*(5*S),M+=c*(5*_),O=M>>>13,M&=8191,M+=l*(5*E),M+=u*(5*v),M+=h*(5*b),M+=d*(5*w),M+=f*(5*y),O+=M>>>13,M&=8191;var L=O;L+=i*y,L+=s*m,L+=o*g,L+=a*p,L+=c*(5*S),O=L>>>13,L&=8191,L+=l*(5*_),L+=u*(5*E),L+=h*(5*v),L+=d*(5*b),L+=f*(5*w),O+=L>>>13,L&=8191;var B=O;B+=i*w,B+=s*y,B+=o*m,B+=a*g,B+=c*p,O=B>>>13,B&=8191,B+=l*(5*S),B+=u*(5*_),B+=h*(5*E),B+=d*(5*v),B+=f*(5*b),O+=B>>>13,B&=8191;var U=O;U+=i*b,U+=s*w,U+=o*y,U+=a*m,U+=c*g,O=U>>>13,U&=8191,U+=l*p,U+=u*(5*S),U+=h*(5*_),U+=d*(5*E),U+=f*(5*v),O+=U>>>13,U&=8191;var F=O;F+=i*v,F+=s*b,F+=o*w,F+=a*y,F+=c*m,O=F>>>13,F&=8191,F+=l*g,F+=u*p,F+=h*(5*S),F+=d*(5*_),F+=f*(5*E),O+=F>>>13,F&=8191;var z=O;z+=i*E,z+=s*v,z+=o*b,z+=a*w,z+=c*y,O=z>>>13,z&=8191,z+=l*m,z+=u*g,z+=h*p,z+=d*(5*S),z+=f*(5*_),O+=z>>>13,z&=8191;var V=O;V+=i*_,V+=s*E,V+=o*v,V+=a*b,V+=c*w,O=V>>>13,V&=8191,V+=l*y,V+=u*m,V+=h*g,V+=d*p,V+=f*(5*S),O+=V>>>13,V&=8191;var j=O;j+=i*S,j+=s*_,j+=o*E,j+=a*v,j+=c*b,O=j>>>13,j&=8191,j+=l*w,j+=u*y,j+=h*m,j+=d*g,j+=f*p,O+=j>>>13,j&=8191,O=(O<<2)+O|0,O=O+P|0,P=8191&O,O>>>=13,x+=O,i=P,s=x,o=M,a=L,c=B,l=U,u=F,h=z,d=V,f=j,e+=16,n-=16}this._h[0]=i,this._h[1]=s,this._h[2]=o,this._h[3]=a,this._h[4]=c,this._h[5]=l,this._h[6]=u,this._h[7]=h,this._h[8]=d,this._h[9]=f},t.prototype.finish=function(t,e){void 0===e&&(e=0);var n,r,i,s,o=new Uint16Array(10);if(this._leftover){for(s=this._leftover,this._buffer[s++]=1;s<16;s++)this._buffer[s]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(n=this._h[1]>>>13,this._h[1]&=8191,s=2;s<10;s++)this._h[s]+=n,n=this._h[s]>>>13,this._h[s]&=8191;for(this._h[0]+=5*n,n=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=n,n=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=n,o[0]=this._h[0]+5,n=o[0]>>>13,o[0]&=8191,s=1;s<10;s++)o[s]=this._h[s]+n,n=o[s]>>>13,o[s]&=8191;for(o[9]-=8192,r=(1^n)-1,s=0;s<10;s++)o[s]&=r;for(r=~r,s=0;s<10;s++)this._h[s]=this._h[s]&r|o[s];for(this._h[0]=65535&(this._h[0]|this._h[1]<<13),this._h[1]=65535&(this._h[1]>>>3|this._h[2]<<10),this._h[2]=65535&(this._h[2]>>>6|this._h[3]<<7),this._h[3]=65535&(this._h[3]>>>9|this._h[4]<<4),this._h[4]=65535&(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14),this._h[5]=65535&(this._h[6]>>>2|this._h[7]<<11),this._h[6]=65535&(this._h[7]>>>5|this._h[8]<<8),this._h[7]=65535&(this._h[8]>>>8|this._h[9]<<5),i=this._h[0]+this._pad[0],this._h[0]=65535&i,s=1;s<8;s++)i=(this._h[s]+this._pad[s]|0)+(i>>>16)|0,this._h[s]=65535&i;return t[e+0]=this._h[0]>>>0,t[e+1]=this._h[0]>>>8,t[e+2]=this._h[1]>>>0,t[e+3]=this._h[1]>>>8,t[e+4]=this._h[2]>>>0,t[e+5]=this._h[2]>>>8,t[e+6]=this._h[3]>>>0,t[e+7]=this._h[3]>>>8,t[e+8]=this._h[4]>>>0,t[e+9]=this._h[4]>>>8,t[e+10]=this._h[5]>>>0,t[e+11]=this._h[5]>>>8,t[e+12]=this._h[6]>>>0,t[e+13]=this._h[6]>>>8,t[e+14]=this._h[7]>>>0,t[e+15]=this._h[7]>>>8,this._finished=!0,this},t.prototype.update=function(t){var e,n=0,r=t.length;if(this._leftover){e=16-this._leftover,e>r&&(e=r);for(var i=0;i<e;i++)this._buffer[this._leftover+i]=t[n+i];if(r-=e,n+=e,this._leftover+=e,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(r>=16&&(e=r-r%16,this._blocks(t,n,e),n+=e,r-=e),r){for(i=0;i<r;i++)this._buffer[this._leftover+i]=t[n+i];this._leftover+=r}return this},t.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var t=new Uint8Array(16);return this.finish(t),t},t.prototype.clean=function(){return i.wipe(this._buffer),i.wipe(this._r),i.wipe(this._h),i.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},t}();function o(t,e){var n=new s(t);n.update(e);var r=n.digest();return n.clean(),r}function a(t,n){return t.length===e.DIGEST_LENGTH&&n.length===e.DIGEST_LENGTH&&r.equal(t,n)}e.Poly1305=s,e.oneTimeAuth=o,e.equal=a},3918:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.randomStringForEntropy=e.randomString=e.randomUint32=e.randomBytes=e.defaultRandomSource=void 0;const r=n(2193),i=n(3419),s=n(6835);function o(t,n=e.defaultRandomSource){return n.randomBytes(t)}function a(t=e.defaultRandomSource){const n=o(4,t),r=(0,i.readUint32LE)(n);return(0,s.wipe)(n),r}e.defaultRandomSource=new r.SystemRandomSource,e.randomBytes=o,e.randomUint32=a;const c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function l(t,n=c,r=e.defaultRandomSource){if(n.length<2)throw new Error("randomString charset is too short");if(n.length>256)throw new Error("randomString charset is too long");let i="";const a=n.length,l=256-256%a;while(t>0){const e=o(Math.ceil(256*t/l),r);for(let r=0;r<e.length&&t>0;r++){const s=e[r];s<l&&(i+=n.charAt(s%a),t--)}(0,s.wipe)(e)}return i}function u(t,n=c,r=e.defaultRandomSource){const i=Math.ceil(t/(Math.log(n.length)/Math.LN2));return l(i,n,r)}e.randomString=l,e.randomStringForEntropy=u},1474:function(t,e,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(e,"__esModule",{value:!0}),e.BrowserRandomSource=void 0;const r=65536;class i{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const t="undefined"!==typeof self?self.crypto||self.msCrypto:null;t&&void 0!==t.getRandomValues&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const e=new Uint8Array(t);for(let n=0;n<e.length;n+=r)this._crypto.getRandomValues(e.subarray(n,n+Math.min(e.length-n,r)));return e}}e.BrowserRandomSource=i},979:function(t,e,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(e,"__esModule",{value:!0}),e.NodeRandomSource=void 0;const r=n(6835);class i{constructor(){this.isAvailable=!1,this.isInstantiated=!1;{const t=n(1586);t&&t.randomBytes&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let e=this._crypto.randomBytes(t);if(e.length!==t)throw new Error("NodeRandomSource: got fewer bytes than requested");const n=new Uint8Array(t);for(let r=0;r<n.length;r++)n[r]=e[r];return(0,r.wipe)(e),n}}e.NodeRandomSource=i},2193:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SystemRandomSource=void 0;const r=n(1474),i=n(979);class s{constructor(){return this.isAvailable=!1,this.name="",this._source=new r.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new i.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}randomBytes(t){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(t)}}e.SystemRandomSource=s},9300:function(t,e,n){"use strict";n(3767),n(8585),n(8696);var r=n(3419),i=n(6835);e.k=32,e.cn=64;var s=function(){function t(){this.digestLength=e.k,this.blockSize=e.cn,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return t.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},t.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},t.prototype.clean=function(){i.wipe(this._buffer),i.wipe(this._temp),this.reset()},t.prototype.update=function(t,e){if(void 0===e&&(e=t.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this._bytesHashed+=e,this._bufferLength>0){while(this._bufferLength<this.blockSize&&e>0)this._buffer[this._bufferLength++]=t[n++],e--;this._bufferLength===this.blockSize&&(a(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}e>=this.blockSize&&(n=a(this._temp,this._state,t,n,e),e%=this.blockSize);while(e>0)this._buffer[this._bufferLength++]=t[n++],e--;return this},t.prototype.finish=function(t){if(!this._finished){var e=this._bytesHashed,n=this._bufferLength,i=e/536870912|0,s=e<<3,o=e%64<56?64:128;this._buffer[n]=128;for(var c=n+1;c<o-8;c++)this._buffer[c]=0;r.writeUint32BE(i,this._buffer,o-8),r.writeUint32BE(s,this._buffer,o-4),a(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(c=0;c<this.digestLength/4;c++)r.writeUint32BE(this._state[c],t,4*c);return this},t.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},t.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},t.prototype.restoreState=function(t){return this._state.set(t.state),this._bufferLength=t.bufferLength,t.buffer&&this._buffer.set(t.buffer),this._bytesHashed=t.bytesHashed,this._finished=!1,this},t.prototype.cleanSavedState=function(t){i.wipe(t.state),t.buffer&&i.wipe(t.buffer),t.bufferLength=0,t.bytesHashed=0},t}();e.mE=s;var o=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function a(t,e,n,i,s){while(s>=64){for(var a=e[0],c=e[1],l=e[2],u=e[3],h=e[4],d=e[5],f=e[6],p=e[7],g=0;g<16;g++){var m=i+4*g;t[g]=r.readUint32BE(n,m)}for(g=16;g<64;g++){var y=t[g-2],w=(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10;y=t[g-15];var b=(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3;t[g]=(w+t[g-7]|0)+(b+t[g-16]|0)}for(g=0;g<64;g++){w=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&d^~h&f)|0)+(p+(o[g]+t[g]|0)|0)|0,b=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&c^a&l^c&l)|0;p=f,f=d,d=h,h=u+w|0,u=l,l=c,c=a,a=w+b|0}e[0]+=a,e[1]+=c,e[2]+=l,e[3]+=u,e[4]+=h,e[5]+=d,e[6]+=f,e[7]+=p,i+=64,s-=64}return i}function c(t){var e=new s;e.update(t);var n=e.digest();return e.clean(),n}e.vp=c},6835:function(t,e){"use strict";function n(t){for(var e=0;e<t.length;e++)t[e]=0;return t}Object.defineProperty(e,"__esModule",{value:!0}),e.wipe=n},2578:function(t,e,n){"use strict";n(3767),n(8585),n(8696),e.gi=e.Au=e._w=e.KS=e.kz=void 0;const r=n(3918),i=n(6835);function s(t){const e=new Float64Array(16);if(t)for(let n=0;n<t.length;n++)e[n]=t[n];return e}e.kz=32,e.KS=32;const o=new Uint8Array(32);o[0]=9;const a=s([56129,1]);function c(t){let e=1;for(let n=0;n<16;n++){let r=t[n]+e+65535;e=Math.floor(r/65536),t[n]=r-65536*e}t[0]+=e-1+37*(e-1)}function l(t,e,n){const r=~(n-1);for(let i=0;i<16;i++){const n=r&(t[i]^e[i]);t[i]^=n,e[i]^=n}}function u(t,e){const n=s(),r=s();for(let i=0;i<16;i++)r[i]=e[i];c(r),c(r),c(r);for(let i=0;i<2;i++){n[0]=r[0]-65517;for(let e=1;e<15;e++)n[e]=r[e]-65535-(n[e-1]>>16&1),n[e-1]&=65535;n[15]=r[15]-32767-(n[14]>>16&1);const t=n[15]>>16&1;n[14]&=65535,l(r,n,1-t)}for(let i=0;i<16;i++)t[2*i]=255&r[i],t[2*i+1]=r[i]>>8}function h(t,e){for(let n=0;n<16;n++)t[n]=e[2*n]+(e[2*n+1]<<8);t[15]&=32767}function d(t,e,n){for(let r=0;r<16;r++)t[r]=e[r]+n[r]}function f(t,e,n){for(let r=0;r<16;r++)t[r]=e[r]-n[r]}function p(t,e,n){let r,i,s=0,o=0,a=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0,y=0,w=0,b=0,v=0,E=0,_=0,S=0,A=0,C=0,I=0,T=0,k=0,R=0,N=0,D=0,O=0,P=0,x=0,M=0,L=n[0],B=n[1],U=n[2],F=n[3],z=n[4],V=n[5],j=n[6],H=n[7],$=n[8],K=n[9],G=n[10],q=n[11],W=n[12],Y=n[13],X=n[14],Q=n[15];r=e[0],s+=r*L,o+=r*B,a+=r*U,c+=r*F,l+=r*z,u+=r*V,h+=r*j,d+=r*H,f+=r*$,p+=r*K,g+=r*G,m+=r*q,y+=r*W,w+=r*Y,b+=r*X,v+=r*Q,r=e[1],o+=r*L,a+=r*B,c+=r*U,l+=r*F,u+=r*z,h+=r*V,d+=r*j,f+=r*H,p+=r*$,g+=r*K,m+=r*G,y+=r*q,w+=r*W,b+=r*Y,v+=r*X,E+=r*Q,r=e[2],a+=r*L,c+=r*B,l+=r*U,u+=r*F,h+=r*z,d+=r*V,f+=r*j,p+=r*H,g+=r*$,m+=r*K,y+=r*G,w+=r*q,b+=r*W,v+=r*Y,E+=r*X,_+=r*Q,r=e[3],c+=r*L,l+=r*B,u+=r*U,h+=r*F,d+=r*z,f+=r*V,p+=r*j,g+=r*H,m+=r*$,y+=r*K,w+=r*G,b+=r*q,v+=r*W,E+=r*Y,_+=r*X,S+=r*Q,r=e[4],l+=r*L,u+=r*B,h+=r*U,d+=r*F,f+=r*z,p+=r*V,g+=r*j,m+=r*H,y+=r*$,w+=r*K,b+=r*G,v+=r*q,E+=r*W,_+=r*Y,S+=r*X,A+=r*Q,r=e[5],u+=r*L,h+=r*B,d+=r*U,f+=r*F,p+=r*z,g+=r*V,m+=r*j,y+=r*H,w+=r*$,b+=r*K,v+=r*G,E+=r*q,_+=r*W,S+=r*Y,A+=r*X,C+=r*Q,r=e[6],h+=r*L,d+=r*B,f+=r*U,p+=r*F,g+=r*z,m+=r*V,y+=r*j,w+=r*H,b+=r*$,v+=r*K,E+=r*G,_+=r*q,S+=r*W,A+=r*Y,C+=r*X,I+=r*Q,r=e[7],d+=r*L,f+=r*B,p+=r*U,g+=r*F,m+=r*z,y+=r*V,w+=r*j,b+=r*H,v+=r*$,E+=r*K,_+=r*G,S+=r*q,A+=r*W,C+=r*Y,I+=r*X,T+=r*Q,r=e[8],f+=r*L,p+=r*B,g+=r*U,m+=r*F,y+=r*z,w+=r*V,b+=r*j,v+=r*H,E+=r*$,_+=r*K,S+=r*G,A+=r*q,C+=r*W,I+=r*Y,T+=r*X,k+=r*Q,r=e[9],p+=r*L,g+=r*B,m+=r*U,y+=r*F,w+=r*z,b+=r*V,v+=r*j,E+=r*H,_+=r*$,S+=r*K,A+=r*G,C+=r*q,I+=r*W,T+=r*Y,k+=r*X,R+=r*Q,r=e[10],g+=r*L,m+=r*B,y+=r*U,w+=r*F,b+=r*z,v+=r*V,E+=r*j,_+=r*H,S+=r*$,A+=r*K,C+=r*G,I+=r*q,T+=r*W,k+=r*Y,R+=r*X,N+=r*Q,r=e[11],m+=r*L,y+=r*B,w+=r*U,b+=r*F,v+=r*z,E+=r*V,_+=r*j,S+=r*H,A+=r*$,C+=r*K,I+=r*G,T+=r*q,k+=r*W,R+=r*Y,N+=r*X,D+=r*Q,r=e[12],y+=r*L,w+=r*B,b+=r*U,v+=r*F,E+=r*z,_+=r*V,S+=r*j,A+=r*H,C+=r*$,I+=r*K,T+=r*G,k+=r*q,R+=r*W,N+=r*Y,D+=r*X,O+=r*Q,r=e[13],w+=r*L,b+=r*B,v+=r*U,E+=r*F,_+=r*z,S+=r*V,A+=r*j,C+=r*H,I+=r*$,T+=r*K,k+=r*G,R+=r*q,N+=r*W,D+=r*Y,O+=r*X,P+=r*Q,r=e[14],b+=r*L,v+=r*B,E+=r*U,_+=r*F,S+=r*z,A+=r*V,C+=r*j,I+=r*H,T+=r*$,k+=r*K,R+=r*G,N+=r*q,D+=r*W,O+=r*Y,P+=r*X,x+=r*Q,r=e[15],v+=r*L,E+=r*B,_+=r*U,S+=r*F,A+=r*z,C+=r*V,I+=r*j,T+=r*H,k+=r*$,R+=r*K,N+=r*G,D+=r*q,O+=r*W,P+=r*Y,x+=r*X,M+=r*Q,s+=38*E,o+=38*_,a+=38*S,c+=38*A,l+=38*C,u+=38*I,h+=38*T,d+=38*k,f+=38*R,p+=38*N,g+=38*D,m+=38*O,y+=38*P,w+=38*x,b+=38*M,i=1,r=s+i+65535,i=Math.floor(r/65536),s=r-65536*i,r=o+i+65535,i=Math.floor(r/65536),o=r-65536*i,r=a+i+65535,i=Math.floor(r/65536),a=r-65536*i,r=c+i+65535,i=Math.floor(r/65536),c=r-65536*i,r=l+i+65535,i=Math.floor(r/65536),l=r-65536*i,r=u+i+65535,i=Math.floor(r/65536),u=r-65536*i,r=h+i+65535,i=Math.floor(r/65536),h=r-65536*i,r=d+i+65535,i=Math.floor(r/65536),d=r-65536*i,r=f+i+65535,i=Math.floor(r/65536),f=r-65536*i,r=p+i+65535,i=Math.floor(r/65536),p=r-65536*i,r=g+i+65535,i=Math.floor(r/65536),g=r-65536*i,r=m+i+65535,i=Math.floor(r/65536),m=r-65536*i,r=y+i+65535,i=Math.floor(r/65536),y=r-65536*i,r=w+i+65535,i=Math.floor(r/65536),w=r-65536*i,r=b+i+65535,i=Math.floor(r/65536),b=r-65536*i,r=v+i+65535,i=Math.floor(r/65536),v=r-65536*i,s+=i-1+37*(i-1),i=1,r=s+i+65535,i=Math.floor(r/65536),s=r-65536*i,r=o+i+65535,i=Math.floor(r/65536),o=r-65536*i,r=a+i+65535,i=Math.floor(r/65536),a=r-65536*i,r=c+i+65535,i=Math.floor(r/65536),c=r-65536*i,r=l+i+65535,i=Math.floor(r/65536),l=r-65536*i,r=u+i+65535,i=Math.floor(r/65536),u=r-65536*i,r=h+i+65535,i=Math.floor(r/65536),h=r-65536*i,r=d+i+65535,i=Math.floor(r/65536),d=r-65536*i,r=f+i+65535,i=Math.floor(r/65536),f=r-65536*i,r=p+i+65535,i=Math.floor(r/65536),p=r-65536*i,r=g+i+65535,i=Math.floor(r/65536),g=r-65536*i,r=m+i+65535,i=Math.floor(r/65536),m=r-65536*i,r=y+i+65535,i=Math.floor(r/65536),y=r-65536*i,r=w+i+65535,i=Math.floor(r/65536),w=r-65536*i,r=b+i+65535,i=Math.floor(r/65536),b=r-65536*i,r=v+i+65535,i=Math.floor(r/65536),v=r-65536*i,s+=i-1+37*(i-1),t[0]=s,t[1]=o,t[2]=a,t[3]=c,t[4]=l,t[5]=u,t[6]=h,t[7]=d,t[8]=f,t[9]=p,t[10]=g,t[11]=m,t[12]=y,t[13]=w,t[14]=b,t[15]=v}function g(t,e){p(t,e,e)}function m(t,e){const n=s();for(let r=0;r<16;r++)n[r]=e[r];for(let r=253;r>=0;r--)g(n,n),2!==r&&4!==r&&p(n,n,e);for(let r=0;r<16;r++)t[r]=n[r]}function y(t,e){const n=new Uint8Array(32),r=new Float64Array(80),i=s(),o=s(),c=s(),y=s(),w=s(),b=s();for(let s=0;s<31;s++)n[s]=t[s];n[31]=127&t[31]|64,n[0]&=248,h(r,e);for(let s=0;s<16;s++)o[s]=r[s];i[0]=y[0]=1;for(let s=254;s>=0;--s){const t=n[s>>>3]>>>(7&s)&1;l(i,o,t),l(c,y,t),d(w,i,c),f(i,i,c),d(c,o,y),f(o,o,y),g(y,w),g(b,i),p(i,c,i),p(c,o,w),d(w,i,c),f(i,i,c),g(o,i),f(c,y,b),p(i,c,a),d(i,i,y),p(c,c,i),p(i,y,b),p(y,o,r),g(o,w),l(i,o,t),l(c,y,t)}for(let s=0;s<16;s++)r[s+16]=i[s],r[s+32]=c[s],r[s+48]=o[s],r[s+64]=y[s];const v=r.subarray(32),E=r.subarray(16);m(v,v),p(E,E,v);const _=new Uint8Array(32);return u(_,E),_}function w(t){return y(t,o)}function b(t){if(t.length!==e.KS)throw new Error(`x25519: seed must be ${e.KS} bytes`);const n=new Uint8Array(t),r=w(n);return{publicKey:r,secretKey:n}}function v(t){const e=(0,r.randomBytes)(32,t),n=b(e);return(0,i.wipe)(e),n}function E(t,n,r=!1){if(t.length!==e.kz)throw new Error("X25519: incorrect secret key length");if(n.length!==e.kz)throw new Error("X25519: incorrect public key length");const i=y(t,n);if(r){let t=0;for(let e=0;e<i.length;e++)t|=i[e];if(0===t)throw new Error("X25519: invalid shared key")}return i}e._w=b,e.Au=v,e.gi=E},8830:function(t,e){"use strict";const n=Math.exp;t.exports=function(t){if("number"!==typeof t)throw new Error("must provide a timespan to the moving average constructor");if(t<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let e,r,i=0,s=0,o=0,a={};function c(e,r){return 1-n(-(e-r)/t)}return a.push=function(t,n){if(r){const a=c(t,r),l=n-e,u=a*l;e=a*n+(1-a)*e,i=(1-a)*(i+l*u),s=Math.sqrt(i),o=e+a*l}else e=n;r=t},a.movingAverage=function(){return e},a.variance=function(){return i},a.deviation=function(){return s},a.forecast=function(){return o},a}},6551:function(t,e,n){"use strict";n(7658);const{fromCallback:r}=n(63),i=n(7368),{getCallback:s,getOptions:o}=n(9293),a=Symbol("promise"),c=Symbol("status"),l=Symbol("operations"),u=Symbol("finishClose"),h=Symbol("closeCallbacks");class d{constructor(t){if("object"!==typeof t||null===t){const e=null===t?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${e}`)}this[l]=[],this[h]=[],this[c]="open",this[u]=this[u].bind(this),this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get length(){return this[l].length}put(t,e,n){if("open"!==this[c])throw new i("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(t)||this.db._checkValue(e);if(r)throw r;const s=n&&null!=n.sublevel?n.sublevel:this.db,o=n,a=s.keyEncoding(n&&n.keyEncoding),u=s.valueEncoding(n&&n.valueEncoding),h=a.format;n={...n,keyEncoding:h,valueEncoding:u.format},s!==this.db&&(n.sublevel=null);const d=s.prefixKey(a.encode(t),h),f=u.encode(e);return this._put(d,f,n),this[l].push({...o,type:"put",key:t,value:e}),this}_put(t,e,n){}del(t,e){if("open"!==this[c])throw new i("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(t);if(n)throw n;const r=e&&null!=e.sublevel?e.sublevel:this.db,s=e,o=r.keyEncoding(e&&e.keyEncoding),a=o.format;return e={...e,keyEncoding:a},r!==this.db&&(e.sublevel=null),this._del(r.prefixKey(o.encode(t),a),e),this[l].push({...s,type:"del",key:t}),this}_del(t,e){}clear(){if("open"!==this[c])throw new i("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[l]=[],this}_clear(){}write(t,e){return e=s(t,e),e=r(e,a),t=o(t),"open"!==this[c]?this.nextTick(e,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(e):(this[c]="writing",this._write(t,(t=>{this[c]="closing",this[h].push((()=>e(t))),t||this.db.emit("batch",this[l]),this._close(this[u])}))),e[a]}_write(t,e){}close(t){return t=r(t,a),"closing"===this[c]?this[h].push(t):"closed"===this[c]?this.nextTick(t):(this[h].push(t),"writing"!==this[c]&&(this[c]="closing",this._close(this[u]))),t[a]}_close(t){this.nextTick(t)}[u](){this[c]="closed",this.db.detachResource(this);const t=this[h];this[h]=[];for(const e of t)e()}}e.AbstractChainedBatch=d},873:function(t,e,n){"use strict";n(7658);const{fromCallback:r}=n(63),i=n(7368),{getOptions:s,getCallback:o}=n(9293),a=Symbol("promise"),c=Symbol("callback"),l=Symbol("working"),u=Symbol("handleOne"),h=Symbol("handleMany"),d=Symbol("autoClose"),f=Symbol("finishWork"),p=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),y=Symbol("closed"),w=Symbol("closeCallbacks"),b=Symbol("keyEncoding"),v=Symbol("valueEncoding"),E=Symbol("abortOnClose"),_=Symbol("legacy"),S=Symbol("keys"),A=Symbol("values"),C=Symbol("limit"),I=Symbol("count"),T=Object.freeze({}),k=()=>{};let R=!1;class N{constructor(t,e,n){if("object"!==typeof t||null===t){const e=null===t?"null":typeof t;throw new TypeError(`The first argument must be an abstract-level database, received ${e}`)}if("object"!==typeof e||null===e)throw new TypeError("The second argument must be an options object");this[y]=!1,this[w]=[],this[l]=!1,this[g]=!1,this[d]=!1,this[c]=null,this[u]=this[u].bind(this),this[h]=this[h].bind(this),this[m]=this[m].bind(this),this[b]=e[b],this[v]=e[v],this[_]=n,this[C]=Number.isInteger(e.limit)&&e.limit>=0?e.limit:1/0,this[I]=0,this[E]=!!e.abortOnClose,this.db=t,this.db.attachResource(this),this.nextTick=t.nextTick}get count(){return this[I]}get limit(){return this[C]}next(t){let e;if(void 0===t)e=new Promise(((e,n)=>{t=(t,r,i)=>{t?n(t):this[_]?void 0===r&&void 0===i?e():e([r,i]):e(r)}}));else if("function"!==typeof t)throw new TypeError("Callback must be a function");return this[g]?this.nextTick(t,new i("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(t,new i("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[l]=!0,this[c]=t,this[I]>=this[C]?this.nextTick(this[u],null):this._next(this[u])),e}_next(t){this.nextTick(t)}nextv(t,e,n){return n=o(e,n),n=r(n,a),e=s(e,T),Number.isInteger(t)?(this[g]?this.nextTick(n,new i("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(n,new i("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(t<1&&(t=1),this[C]<1/0&&(t=Math.min(t,this[C]-this[I])),this[l]=!0,this[c]=n,t<=0?this.nextTick(this[h],null,[]):this._nextv(t,e,this[h])),n[a]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[a])}_nextv(t,e,n){const r=[],i=(e,s,o)=>e?n(e):(this[_]?void 0===s&&void 0===o:void 0===s)?n(null,r):(r.push(this[_]?[s,o]:s),void(r.length===t?n(null,r):this._next(i)));this._next(i)}all(t,e){return e=o(t,e),e=r(e,a),t=s(t,T),this[g]?this.nextTick(e,new i("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(e,new i("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[l]=!0,this[c]=e,this[d]=!0,this[I]>=this[C]?this.nextTick(this[h],null,[]):this._all(t,this[h])),e[a]}_all(t,e){let n=this[I];const r=[],i=()=>{const t=this[C]<1/0?Math.min(1e3,this[C]-n):1e3;t<=0?this.nextTick(e,null,r):this._nextv(t,T,s)},s=(t,s)=>{t?e(t):0===s.length?e(null,r):(r.push.apply(r,s),n+=s.length,i())};i()}[f](){const t=this[c];return this[E]&&null===t?k:(this[l]=!1,this[c]=null,this[g]&&this._close(this[m]),t)}[p](t,e,n){this[d]?this.close(t.bind(null,e,n)):t(e,n)}seek(t,e){if(e=s(e,T),this[g]);else{if(this[l])throw new i("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(e.keyEncoding||this[b]),r=n.format;e.keyEncoding!==r&&(e={...e,keyEncoding:r});const i=this.db.prefixKey(n.encode(t),r);this._seek(i,e)}}}_seek(t,e){throw new i("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(t){if(t=r(t,a),this[y])this.nextTick(t);else if(this[g])this[w].push(t);else if(this[g]=!0,this[w].push(t),this[l]){if(this[E]){const t=this[f]();t(new i("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[m]);return t[a]}_close(t){this.nextTick(t)}[m](){this[y]=!0,this.db.detachResource(this);const t=this[w];this[w]=[];for(const e of t)e()}async*[Symbol.asyncIterator](){try{let t;while(void 0!==(t=await this.next()))yield t}finally{this[y]||await this.close()}}}class D extends N{constructor(t,e){super(t,e,!0),this[S]=!1!==e.keys,this[A]=!1!==e.values}[u](t,e,n){const r=this[f]();if(t)return r(t);try{e=this[S]&&void 0!==e?this[b].decode(e):void 0,n=this[A]&&void 0!==n?this[v].decode(n):void 0}catch(t){return r(new x("entry",t))}void 0===e&&void 0===n||this[I]++,r(null,e,n)}[h](t,e){const n=this[f]();if(t)return this[p](n,t);try{for(const t of e){const e=t[0],n=t[1];t[0]=this[S]&&void 0!==e?this[b].decode(e):void 0,t[1]=this[A]&&void 0!==n?this[v].decode(n):void 0}}catch(t){return this[p](n,new x("entries",t))}this[I]+=e.length,this[p](n,null,e)}end(t){return R||"undefined"===typeof console||(R=!0,console.warn(new i("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(t)}}class O extends N{constructor(t,e){super(t,e,!1)}[u](t,e){const n=this[f]();if(t)return n(t);try{e=void 0!==e?this[b].decode(e):void 0}catch(t){return n(new x("key",t))}void 0!==e&&this[I]++,n(null,e)}[h](t,e){const n=this[f]();if(t)return this[p](n,t);try{for(let t=0;t<e.length;t++){const n=e[t];e[t]=void 0!==n?this[b].decode(n):void 0}}catch(t){return this[p](n,new x("keys",t))}this[I]+=e.length,this[p](n,null,e)}}class P extends N{constructor(t,e){super(t,e,!1)}[u](t,e){const n=this[f]();if(t)return n(t);try{e=void 0!==e?this[v].decode(e):void 0}catch(t){return n(new x("value",t))}void 0!==e&&this[I]++,n(null,e)}[h](t,e){const n=this[f]();if(t)return this[p](n,t);try{for(let t=0;t<e.length;t++){const n=e[t];e[t]=void 0!==n?this[v].decode(n):void 0}}catch(t){return this[p](n,new x("values",t))}this[I]+=e.length,this[p](n,null,e)}}class x extends i{constructor(t,e){super(`Iterator could not decode ${t}`,{code:"LEVEL_DECODE_ERROR",cause:e})}}for(const M of["_ended property","_nexting property","_end method"])Object.defineProperty(D.prototype,M.split(" ")[0],{get(){throw new i(`The ${M} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new i(`The ${M} has been removed`,{code:"LEVEL_LEGACY"})}});D.keyEncoding=b,D.valueEncoding=v,e.AbstractIterator=D,e.AbstractKeyIterator=O,e.AbstractValueIterator=P},639:function(t,e,n){"use strict";n(7658);const{supports:r}=n(9078),{Transcoder:i}=n(9871),{EventEmitter:s}=n(1528),{fromCallback:o}=n(63),a=n(7368),{AbstractIterator:c}=n(873),{DefaultKeyIterator:l,DefaultValueIterator:u}=n(6094),{DeferredIterator:h,DeferredKeyIterator:d,DeferredValueIterator:f}=n(2879),{DefaultChainedBatch:p}=n(8396),{getCallback:g,getOptions:m}=n(9293),y=n(8418),w=Symbol("promise"),b=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),_=Symbol("operations"),S=Symbol("undefer"),A=Symbol("deferOpen"),C=Symbol("options"),I=Symbol("status"),T=Symbol("defaultOptions"),k=Symbol("transcoder"),R=Symbol("keyEncoding"),N=Symbol("valueEncoding"),D=()=>{};class O extends s{constructor(t,e){if(super(),"object"!==typeof t||null===t)throw new TypeError("The first argument 'manifest' must be an object");e=m(e);const{keyEncoding:n,valueEncoding:s,passive:o,...a}=e;this[v]=new Set,this[_]=[],this[A]=!0,this[C]=a,this[I]="opening",this.supports=r(t,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==t.snapshots,permanence:!1!==t.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:t.encodings||{},events:Object.assign({},t.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[k]=new i(M(this)),this[R]=this[k].encoding(n||"utf8"),this[N]=this[k].encoding(s||"utf8");for(const r of this[k].encodings())this.supports.encodings[r.commonName]||(this.supports.encodings[r.commonName]=!0);this[T]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[R].commonName,valueEncoding:this[N].commonName}),key:Object.freeze({keyEncoding:this[R].commonName})},this.nextTick((()=>{this[A]&&this.open({passive:!1},D)}))}get status(){return this[I]}keyEncoding(t){return this[k].encoding(null!=t?t:this[R])}valueEncoding(t){return this[k].encoding(null!=t?t:this[N])}open(t,e){e=g(t,e),e=o(e,w),t={...this[C],...m(t)},t.createIfMissing=!1!==t.createIfMissing,t.errorIfExists=!!t.errorIfExists;const n=t=>{"closing"===this[I]||"opening"===this[I]?this.once(b,t?()=>n(t):n):"open"!==this[I]?e(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:t})):e()};return t.passive?"opening"===this[I]?this.once(b,n):this.nextTick(n):"closed"===this[I]||this[A]?(this[A]=!1,this[I]="opening",this.emit("opening"),this._open(t,(t=>{if(t)return this[I]="closed",this[E]((()=>{this.emit(b),n(t)})),void this[S]();this[I]="open",this[S](),this.emit(b),"open"===this[I]&&this.emit("open"),"open"===this[I]&&this.emit("ready"),n()}))):"open"===this[I]?this.nextTick(n):this.once(b,(()=>this.open(t,e))),e[w]}_open(t,e){this.nextTick(e)}close(t){t=o(t,w);const e=n=>{"opening"===this[I]||"closing"===this[I]?this.once(b,n?e(n):e):"closed"!==this[I]?t(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):t()};if("open"===this[I]){this[I]="closing",this.emit("closing");const t=t=>{this[I]="open",this[S](),this.emit(b),e(t)};this[E]((()=>{this._close((n=>{if(n)return t(n);this[I]="closed",this[S](),this.emit(b),"closed"===this[I]&&this.emit("closed"),e()}))}))}else"closed"===this[I]?this.nextTick(e):this.once(b,(()=>this.close(t)));return t[w]}[E](t){if(0===this[v].size)return this.nextTick(t);let e=this[v].size,n=!0;const r=()=>{0===--e&&(n?this.nextTick(t):t())};for(const i of this[v])i.close(r);n=!1,this[v].clear()}_close(t){this.nextTick(t)}get(t,e,n){if(n=g(e,n),n=o(n,w),e=m(e,this[T].entry),"opening"===this[I])return this.defer((()=>this.get(t,e,n))),n[w];if(x(this,n))return n[w];const r=this._checkKey(t);if(r)return this.nextTick(n,r),n[w];const i=this.keyEncoding(e.keyEncoding),s=this.valueEncoding(e.valueEncoding),c=i.format,l=s.format;return e.keyEncoding===c&&e.valueEncoding===l||(e=Object.assign({},e,{keyEncoding:c,valueEncoding:l})),this._get(this.prefixKey(i.encode(t),c),e,((t,e)=>{if(t)return("LEVEL_NOT_FOUND"===t.code||t.notFound||/NotFound/i.test(t))&&(t.code||(t.code="LEVEL_NOT_FOUND"),t.notFound||(t.notFound=!0),t.status||(t.status=404)),n(t);try{e=s.decode(e)}catch(t){return n(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:t}))}n(null,e)})),n[w]}_get(t,e,n){this.nextTick(n,new Error("NotFound"))}getMany(t,e,n){if(n=g(e,n),n=o(n,w),e=m(e,this[T].entry),"opening"===this[I])return this.defer((()=>this.getMany(t,e,n))),n[w];if(x(this,n))return n[w];if(!Array.isArray(t))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[w];if(0===t.length)return this.nextTick(n,null,[]),n[w];const r=this.keyEncoding(e.keyEncoding),i=this.valueEncoding(e.valueEncoding),s=r.format,c=i.format;e.keyEncoding===s&&e.valueEncoding===c||(e=Object.assign({},e,{keyEncoding:s,valueEncoding:c}));const l=new Array(t.length);for(let o=0;o<t.length;o++){const e=t[o],i=this._checkKey(e);if(i)return this.nextTick(n,i),n[w];l[o]=this.prefixKey(r.encode(e),s)}return this._getMany(l,e,((t,e)=>{if(t)return n(t);try{for(let t=0;t<e.length;t++)void 0!==e[t]&&(e[t]=i.decode(e[t]))}catch(t){return n(new a(`Could not decode one or more of ${e.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:t}))}n(null,e)})),n[w]}_getMany(t,e,n){this.nextTick(n,null,new Array(t.length).fill(void 0))}put(t,e,n,r){if(r=g(n,r),r=o(r,w),n=m(n,this[T].entry),"opening"===this[I])return this.defer((()=>this.put(t,e,n,r))),r[w];if(x(this,r))return r[w];const i=this._checkKey(t)||this._checkValue(e);if(i)return this.nextTick(r,i),r[w];const s=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=s.format,l=a.format;n.keyEncoding===c&&n.valueEncoding===l||(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const u=this.prefixKey(s.encode(t),c),h=a.encode(e);return this._put(u,h,n,(n=>{if(n)return r(n);this.emit("put",t,e),r()})),r[w]}_put(t,e,n,r){this.nextTick(r)}del(t,e,n){if(n=g(e,n),n=o(n,w),e=m(e,this[T].key),"opening"===this[I])return this.defer((()=>this.del(t,e,n))),n[w];if(x(this,n))return n[w];const r=this._checkKey(t);if(r)return this.nextTick(n,r),n[w];const i=this.keyEncoding(e.keyEncoding),s=i.format;return e.keyEncoding!==s&&(e=Object.assign({},e,{keyEncoding:s})),this._del(this.prefixKey(i.encode(t),s),e,(e=>{if(e)return n(e);this.emit("del",t),n()})),n[w]}_del(t,e,n){this.nextTick(n)}batch(t,e,n){if(!arguments.length){if("opening"===this[I])return new p(this);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(n="function"===typeof t?t:g(e,n),n=o(n,w),e=m(e,this[T].empty),"opening"===this[I])return this.defer((()=>this.batch(t,e,n))),n[w];if(x(this,n))return n[w];if(!Array.isArray(t))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[w];if(0===t.length)return this.nextTick(n),n[w];const r=new Array(t.length),{keyEncoding:i,valueEncoding:s,...c}=e;for(let o=0;o<t.length;o++){if("object"!==typeof t[o]||null===t[o])return this.nextTick(n,new TypeError("A batch operation must be an object")),n[w];const e=Object.assign({},t[o]);if("put"!==e.type&&"del"!==e.type)return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[w];const a=this._checkKey(e.key);if(a)return this.nextTick(n,a),n[w];const c=null!=e.sublevel?e.sublevel:this,l=c.keyEncoding(e.keyEncoding||i),u=l.format;if(e.key=c.prefixKey(l.encode(e.key),u),e.keyEncoding=u,"put"===e.type){const t=this._checkValue(e.value);if(t)return this.nextTick(n,t),n[w];const r=c.valueEncoding(e.valueEncoding||s);e.value=r.encode(e.value),e.valueEncoding=r.format}c!==this&&(e.sublevel=null),r[o]=e}return this._batch(r,c,(e=>{if(e)return n(e);this.emit("batch",t),n()})),n[w]}_batch(t,e,n){this.nextTick(n)}sublevel(t,e){return this._sublevel(t,P.defaults(e))}_sublevel(t,e){return new P(this,t,e)}prefixKey(t,e){return t}clear(t,e){if(e=g(t,e),e=o(e,w),t=m(t,this[T].empty),"opening"===this[I])return this.defer((()=>this.clear(t,e))),e[w];if(x(this,e))return e[w];const n=t,r=this.keyEncoding(t.keyEncoding);return t=y(t,r),t.keyEncoding=r.format,0===t.limit?this.nextTick(e):this._clear(t,(t=>{if(t)return e(t);this.emit("clear",n),e()})),e[w]}_clear(t,e){this.nextTick(e)}iterator(t){const e=this.keyEncoding(t&&t.keyEncoding),n=this.valueEncoding(t&&t.valueEncoding);if(t=y(t,e),t.keys=!1!==t.keys,t.values=!1!==t.values,t[c.keyEncoding]=e,t[c.valueEncoding]=n,t.keyEncoding=e.format,t.valueEncoding=n.format,"opening"===this[I])return new h(this,t);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(t)}_iterator(t){return new c(this,t)}keys(t){const e=this.keyEncoding(t&&t.keyEncoding),n=this.valueEncoding(t&&t.valueEncoding);if(t=y(t,e),t[c.keyEncoding]=e,t[c.valueEncoding]=n,t.keyEncoding=e.format,t.valueEncoding=n.format,"opening"===this[I])return new d(this,t);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(t)}_keys(t){return new l(this,t)}values(t){const e=this.keyEncoding(t&&t.keyEncoding),n=this.valueEncoding(t&&t.valueEncoding);if(t=y(t,e),t[c.keyEncoding]=e,t[c.valueEncoding]=n,t.keyEncoding=e.format,t.valueEncoding=n.format,"opening"===this[I])return new f(this,t);if("open"!==this[I])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(t)}_values(t){return new u(this,t)}defer(t){if("function"!==typeof t)throw new TypeError("The first argument must be a function");this[_].push(t)}[S](){if(0===this[_].length)return;const t=this[_];this[_]=[];for(const e of t)e()}attachResource(t){if("object"!==typeof t||null===t||"function"!==typeof t.close)throw new TypeError("The first argument must be a resource object");this[v].add(t)}detachResource(t){this[v].delete(t)}_chainedBatch(){return new p(this)}_checkKey(t){if(null===t||void 0===t)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(t){if(null===t||void 0===t)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}O.prototype.nextTick=n(6187);const{AbstractSublevel:P}=n(3110)({AbstractLevel:O});e.AbstractLevel=O,e.AbstractSublevel=P;const x=function(t,e){return"open"!==t[I]&&(t.nextTick(e,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},M=function(t){return Object.keys(t.supports.encodings).filter((e=>!!t.supports.encodings[e]))}},7013:function(t,e,n){"use strict";e.AbstractLevel=n(639).AbstractLevel,e.AbstractSublevel=n(639).AbstractSublevel,e.AbstractIterator=n(873).AbstractIterator,e.AbstractKeyIterator=n(873).AbstractKeyIterator,e.AbstractValueIterator=n(873).AbstractValueIterator,e.AbstractChainedBatch=n(6551).AbstractChainedBatch},4872:function(t,e,n){"use strict";const{AbstractIterator:r,AbstractKeyIterator:i,AbstractValueIterator:s}=n(873),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),l=Symbol("handleMany"),u=Symbol("callback");class h extends r{constructor(t,e,n,r){super(t,e),this[a]=n,this[o]=r,this[c]=this[c].bind(this),this[l]=this[l].bind(this),this[u]=null}[c](t,e,n){const r=this[u];if(t)return r(t);void 0!==e&&(e=this[o](e)),r(t,e,n)}[l](t,e){const n=this[u];if(t)return n(t);for(const r of e){const t=r[0];void 0!==t&&(r[0]=this[o](t))}n(t,e)}}class d extends i{constructor(t,e,n,r){super(t,e),this[a]=n,this[o]=r,this[c]=this[c].bind(this),this[l]=this[l].bind(this),this[u]=null}[c](t,e){const n=this[u];if(t)return n(t);void 0!==e&&(e=this[o](e)),n(t,e)}[l](t,e){const n=this[u];if(t)return n(t);for(let r=0;r<e.length;r++){const t=e[r];void 0!==t&&(e[r]=this[o](t))}n(t,e)}}class f extends s{constructor(t,e,n){super(t,e),this[a]=n}}for(const p of[h,d])p.prototype._next=function(t){this[u]=t,this[a].next(this[c])},p.prototype._nextv=function(t,e,n){this[u]=n,this[a].nextv(t,e,this[l])},p.prototype._all=function(t,e){this[u]=e,this[a].all(t,this[l])};for(const p of[f])p.prototype._next=function(t){this[a].next(t)},p.prototype._nextv=function(t,e,n){this[a].nextv(t,e,n)},p.prototype._all=function(t,e){this[a].all(t,e)};for(const p of[h,d,f])p.prototype._seek=function(t,e){this[a].seek(t,e)},p.prototype._close=function(t){this[a].close(t)};e.AbstractSublevelIterator=h,e.AbstractSublevelKeyIterator=d,e.AbstractSublevelValueIterator=f},3110:function(t,e,n){"use strict";n(3767),n(8585),n(8696);const r=n(7368),{Buffer:i}=n(911)||{},{AbstractSublevelIterator:s,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=n(4872),c=Symbol("prefix"),l=Symbol("upperBound"),u=Symbol("prefixRange"),h=Symbol("parent"),d=Symbol("unfix"),f=new TextEncoder,p={separator:"!"};t.exports=function({AbstractLevel:t}){class e extends t{static defaults(t){if("string"===typeof t)throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(t&&t.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==t?p:t.separator?t:{...t,separator:"!"}}constructor(t,n,i){const{separator:s,manifest:o,...a}=e.defaults(i);n=b(n,s);const u=s.charCodeAt(0)+1,p=t[h]||t;if(!f.encode(n).every((t=>t>u&&t<127)))throw new r(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(g(p,o),a);const m=(t.prefix||"")+s+n+s,v=m.slice(0,-1)+String.fromCharCode(u);this[h]=p,this[c]=new y(m),this[l]=new y(v),this[d]=new w,this.nextTick=p.nextTick}prefixKey(t,e){if("utf8"===e)return this[c].utf8+t;if(0===t.byteLength)return this[c][e];if("view"===e){const e=this[c].view,n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}{const e=this[c].buffer;return i.concat([e,t],e.byteLength+t.byteLength)}}[u](t,e){void 0!==t.gte?t.gte=this.prefixKey(t.gte,e):void 0!==t.gt?t.gt=this.prefixKey(t.gt,e):t.gte=this[c][e],void 0!==t.lte?t.lte=this.prefixKey(t.lte,e):void 0!==t.lt?t.lt=this.prefixKey(t.lt,e):t.lte=this[l][e]}get prefix(){return this[c].utf8}get db(){return this[h]}_open(t,e){this[h].open({passive:!0},e)}_put(t,e,n,r){this[h].put(t,e,n,r)}_get(t,e,n){this[h].get(t,e,n)}_getMany(t,e,n){this[h].getMany(t,e,n)}_del(t,e,n){this[h].del(t,e,n)}_batch(t,e,n){this[h].batch(t,e,n)}_clear(t,e){this[u](t,t.keyEncoding),this[h].clear(t,e)}_iterator(t){this[u](t,t.keyEncoding);const e=this[h].iterator(t),n=this[d].get(this[c].utf8.length,t.keyEncoding);return new s(this,t,e,n)}_keys(t){this[u](t,t.keyEncoding);const e=this[h].keys(t),n=this[d].get(this[c].utf8.length,t.keyEncoding);return new o(this,t,e,n)}_values(t){this[u](t,t.keyEncoding);const e=this[h].values(t);return new a(this,t,e)}}return{AbstractSublevel:e}};const g=function(t,e){return{...t.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...e,encodings:{utf8:m(t,"utf8"),buffer:m(t,"buffer"),view:m(t,"view")}}},m=function(t,e){return!!t.supports.encodings[e]&&t.keyEncoding(e).name===e};class y{constructor(t){this.utf8=t,this.view=f.encode(t),this.buffer=i?i.from(this.view.buffer,0,this.view.byteLength):{}}}class w{constructor(){this.cache=new Map}get(t,e){let n=this.cache.get(e);return void 0===n&&(n="view"===e?function(t,e){return e.subarray(t)}.bind(null,t):function(t,e){return e.slice(t)}.bind(null,t),this.cache.set(e,n)),n}}const b=function(t,e){let n=0,r=t.length;while(n<r&&t[n]===e)n++;while(r>n&&t[r-1]===e)r--;return t.slice(n,r)}},9293:function(t,e){"use strict";e.getCallback=function(t,e){return"function"===typeof t?t:e},e.getOptions=function(t,e){return"object"===typeof t&&null!==t?t:void 0!==e?e:{}}},8396:function(t,e,n){"use strict";n(7658);const{AbstractChainedBatch:r}=n(6551),i=n(7368),s=Symbol("encoded");class o extends r{constructor(t){super(t),this[s]=[]}_put(t,e,n){this[s].push({...n,type:"put",key:t,value:e})}_del(t,e){this[s].push({...e,type:"del",key:t})}_clear(){this[s]=[]}_write(t,e){"opening"===this.db.status?this.db.defer((()=>this._write(t,e))):"open"===this.db.status?0===this[s].length?this.nextTick(e):this.db._batch(this[s],t,e):this.nextTick(e,new i("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}e.DefaultChainedBatch=o},6094:function(t,e,n){"use strict";const{AbstractKeyIterator:r,AbstractValueIterator:i}=n(873),s=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class l extends r{constructor(t,e){super(t,e),this[s]=t.iterator({...e,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class u extends i{constructor(t,e){super(t,e),this[s]=t.iterator({...e,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const h of[l,u]){const t=h===l,e=t?t=>t[0]:t=>t[1];h.prototype._next=function(t){this[o]=t,this[s].next(this[a])},h.prototype[a]=function(e,n,r){const i=this[o];e?i(e):i(null,t?n:r)},h.prototype._nextv=function(t,e,n){this[o]=n,this[s].nextv(t,e,this[c])},h.prototype._all=function(t,e){this[o]=e,this[s].all(t,this[c])},h.prototype[c]=function(t,n){const r=this[o];t?r(t):r(null,n.map(e))},h.prototype._seek=function(t,e){this[s].seek(t,e)},h.prototype._close=function(t){this[s].close(t)}}e.DefaultKeyIterator=l,e.DefaultValueIterator=u},2879:function(t,e,n){"use strict";const{AbstractIterator:r,AbstractKeyIterator:i,AbstractValueIterator:s}=n(873),o=n(7368),a=Symbol("nut"),c=Symbol("undefer"),l=Symbol("factory");class u extends r{constructor(t,e){super(t,e),this[a]=null,this[l]=()=>t.iterator(e),this.db.defer((()=>this[c]()))}}class h extends i{constructor(t,e){super(t,e),this[a]=null,this[l]=()=>t.keys(e),this.db.defer((()=>this[c]()))}}class d extends s{constructor(t,e){super(t,e),this[a]=null,this[l]=()=>t.values(e),this.db.defer((()=>this[c]()))}}for(const f of[u,h,d])f.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[l]())},f.prototype._next=function(t){null!==this[a]?this[a].next(t):"opening"===this.db.status?this.db.defer((()=>this._next(t))):this.nextTick(t,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},f.prototype._nextv=function(t,e,n){null!==this[a]?this[a].nextv(t,e,n):"opening"===this.db.status?this.db.defer((()=>this._nextv(t,e,n))):this.nextTick(n,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},f.prototype._all=function(t,e){null!==this[a]?this[a].all(e):"opening"===this.db.status?this.db.defer((()=>this._all(t,e))):this.nextTick(e,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},f.prototype._seek=function(t,e){null!==this[a]?this[a]._seek(t,e):"opening"===this.db.status&&this.db.defer((()=>this._seek(t,e)))},f.prototype._close=function(t){null!==this[a]?this[a].close(t):"opening"===this.db.status?this.db.defer((()=>this._close(t))):this.nextTick(t)};e.DeferredIterator=u,e.DeferredKeyIterator=h,e.DeferredValueIterator=d},6187:function(t,e,n){"use strict";const r=n(6486);t.exports=function(t,...e){0===e.length?r(t):r((()=>t(...e)))}},8418:function(t,e,n){"use strict";const r=n(7368),i=Object.prototype.hasOwnProperty,s=new Set(["lt","lte","gt","gte"]);t.exports=function(t,e){const n={};for(const o in t)if(i.call(t,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new r(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});s.has(o)?n[o]=e.encode(t[o]):n[o]=t[o]}return n.reverse=!!n.reverse,n.limit=Number.isInteger(n.limit)&&n.limit>=0?n.limit:-1,n}},3162:function(t){function e(t){const e=new globalThis.AbortController;function n(){e.abort();for(const e of t)e&&e.removeEventListener&&e.removeEventListener("abort",n)}for(const r of t)if(r&&r.addEventListener){if(r.aborted){n();break}r.addEventListener("abort",n)}return e.signal}t.exports=e,t.exports.anySignal=e},8384:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658),e.byteLength=u,e.toByteArray=d,e.fromByteArray=g;for(var r=[],i=[],s="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");-1===n&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function u(t){var e=l(t),n=e[0],r=e[1];return 3*(n+r)/4-r}function h(t,e,n){return 3*(e+n)/4-n}function d(t){var e,n,r=l(t),o=r[0],a=r[1],c=new s(h(t,o,a)),u=0,d=a>0?o-4:o;for(n=0;n<d;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=255&e;return 2===a&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,c[u++]=255&e),1===a&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,c[u++]=e>>8&255,c[u++]=255&e),c}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function p(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(f(r));return i.join("")}function g(t){for(var e,n=t.length,i=n%3,s=[],o=16383,a=0,c=n-i;a<c;a+=o)s.push(p(t,a,a+o>c?c:a+o));return 1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},5101:function(t,e,n){"use strict";n(7658);const r=async t=>{const e=[];for await(const n of t)e.push(n);return e};t.exports=r},1555:function(t){"use strict";const e=async t=>{for await(const e of t);};t.exports=e},2386:function(t){"use strict";const e=async function*(t,e){for await(const n of t)await e(n)&&(yield n)};t.exports=e},4753:function(t){"use strict";const e=async function*(t,e){let n=0;if(!(e<1))for await(const r of t)if(yield r,n++,n===e)return};t.exports=e},2547:function(t,e,n){"use strict";const{AbstractLevel:r}=n(7013),i=n(7368),s=n(8250),{fromCallback:o}=n(63),{Iterator:a}=n(1092),c=n(852),l=n(4757),u=n(4934),h="level-js-",d=Symbol("idb"),f=Symbol("namePrefix"),p=Symbol("location"),g=Symbol("version"),m=Symbol("store"),y=Symbol("onComplete"),w=Symbol("promise");class b extends r{constructor(t,e,n){if("function"===typeof e||"function"===typeof n)throw new i("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:r,version:s,...o}=e||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!==typeof t)throw new Error("constructor requires a location string argument");this[p]=t,this[f]=null==r?h:r,this[g]=parseInt(s||1,10),this[d]=null}get location(){return this[p]}get namePrefix(){return this[f]}get version(){return this[g]}get db(){return this[d]}get type(){return"browser-level"}_open(t,e){const n=indexedDB.open(this[f]+this[p],this[g]);n.onerror=function(){e(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[d]=n.result,e()},n.onupgradeneeded=t=>{const e=t.target.result;e.objectStoreNames.contains(this[p])||e.createObjectStore(this[p])}}[m](t){const e=this[d].transaction([this[p]],t);return e.objectStore(this[p])}[y](t,e){const n=t.transaction;n.onabort=function(){e(n.error||new Error("aborted by user"))},n.oncomplete=function(){e(null,t.result)}}_get(t,e,n){const r=this[m]("readonly");let s;try{s=r.get(t)}catch(o){return this.nextTick(n,o)}this[y](s,(function(t,e){return t?n(t):void 0===e?n(new i("Entry not found",{code:"LEVEL_NOT_FOUND"})):void n(null,c(e))}))}_getMany(t,e,n){const r=this[m]("readonly"),i=t.map((t=>e=>{let n;try{n=r.get(t)}catch(i){return e(i)}n.onsuccess=()=>{const t=n.result;e(null,void 0===t?t:c(t))},n.onerror=t=>{t.stopPropagation(),e(n.error)}}));s(i,16,n)}_del(t,e,n){const r=this[m]("readwrite");let i;try{i=r.delete(t)}catch(s){return this.nextTick(n,s)}this[y](i,n)}_put(t,e,n,r){const i=this[m]("readwrite");let s;try{s=i.put(e,t)}catch(o){return this.nextTick(r,o)}this[y](s,r)}_iterator(t){return new a(this,this[p],t)}_batch(t,e,n){const r=this[m]("readwrite"),i=r.transaction;let s,o=0;function a(){const e=t[o++],n=e.key;let c;try{c="del"===e.type?r.delete(n):r.put(e.value,n)}catch(l){return s=l,void i.abort()}o<t.length?c.onsuccess=a:"function"===typeof i.commit&&i.commit()}i.onabort=function(){n(s||i.error||new Error("aborted by user"))},i.oncomplete=function(){n()},a()}_clear(t,e){let n,r;try{n=u(t)}catch(i){return this.nextTick(e)}if(t.limit>=0)return l(this,this[p],n,t,e);try{const t=this[m]("readwrite");r=n?t.delete(n):t.clear()}catch(s){return this.nextTick(e,s)}this[y](r,e)}_close(t){this[d].close(),this.nextTick(t)}}b.destroy=function(t,e,n){"function"===typeof e&&(n=e,e=h),n=o(n,w);const r=indexedDB.deleteDatabase(e+t);return r.onsuccess=function(){n()},r.onerror=function(t){n(t)},n[w]},e.BrowserLevel=b},1092:function(t,e,n){"use strict";n(7658);const{AbstractIterator:r}=n(7013),i=n(4934),s=n(852),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),l=Symbol("currentOptions"),u=Symbol("position"),h=Symbol("location"),d=Symbol("first"),f={};class p extends r{constructor(t,e,n){super(t,n),this[o]=[],this[a]=0===this.limit,this[c]=n,this[l]={...n},this[u]=void 0,this[h]=e,this[d]=!0}_nextv(t,e,n){if(this[d]=!1,this[a])return this.nextTick(n,null,[]);if(this[o].length>0)return t=Math.min(t,this[o].length),this.nextTick(n,null,this[o].splice(0,t));let r;void 0!==this[u]&&(this[c].reverse?(this[l].lt=this[u],this[l].lte=void 0):(this[l].gt=this[u],this[l].gte=void 0));try{r=i(this[l])}catch(y){return this[a]=!0,this.nextTick(n,null,[])}const f=this.db.db.transaction([this[h]],"readonly"),p=f.objectStore(this[h]),m=[];if(this[c].reverse){const e=!this[c].values&&p.openKeyCursor?"openKeyCursor":"openCursor";p[e](r,"prev").onsuccess=e=>{const n=e.target.result;if(n){const{key:e,value:r}=n;this[u]=e,m.push([this[c].keys&&void 0!==e?s(e):void 0,this[c].values&&void 0!==r?s(r):void 0]),m.length<t?n.continue():g(f)}else this[a]=!0}}else{let e,n;const i=()=>{if(void 0===e||void 0===n)return;const r=Math.max(e.length,n.length);0===r||t===1/0?this[a]=!0:this[u]=e[r-1],m.length=r;for(let t=0;t<r;t++){const r=e[t],i=n[t];m[t]=[this[c].keys&&void 0!==r?s(r):void 0,this[c].values&&void 0!==i?s(i):void 0]}g(f)};this[c].keys||t<1/0?p.getAllKeys(r,t<1/0?t:void 0).onsuccess=t=>{e=t.target.result,i()}:(e=[],this.nextTick(i)),this[c].values?p.getAll(r,t<1/0?t:void 0).onsuccess=t=>{n=t.target.result,i()}:(n=[],this.nextTick(i))}f.onabort=()=>{n(f.error||new Error("aborted by user")),n=null},f.oncomplete=()=>{n(null,m),n=null}}_next(t){if(this[o].length>0){const[e,n]=this[o].shift();this.nextTick(t,null,e,n)}else if(this[a])this.nextTick(t);else{let e=Math.min(100,this.limit-this.count);this[d]&&(this[d]=!1,e=1),this._nextv(e,f,((e,n)=>{if(e)return t(e);this[o]=n,this._next(t)}))}}_all(t,e){this[d]=!1;const n=this[o].splice(0,this[o].length),r=this.limit-this.count-n.length;if(r<=0)return this.nextTick(e,null,n);this._nextv(r,f,((t,r)=>{if(t)return e(t);n.length>0&&(r=n.concat(r)),e(null,r)}))}_seek(t,e){let n;this[d]=!0,this[o]=[],this[a]=!1,this[u]=void 0,this[l]={...this[c]};try{n=i(this[c])}catch(r){return void(this[a]=!0)}null===n||n.includes(t)?this[c].reverse?this[l].lte=t:this[l].gte=t:this[a]=!0}}function g(t){"function"===typeof t.commit&&t.commit()}e.Iterator=p},4757:function(t){"use strict";t.exports=function(t,e,n,r,i){if(0===r.limit)return t.nextTick(i);const s=t.db.transaction([e],"readwrite"),o=s.objectStore(e);let a=0;s.oncomplete=function(){i()},s.onabort=function(){i(s.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",l=r.reverse?"prev":"next";o[c](n,l).onsuccess=function(t){const e=t.target.result;e&&(o.delete(e.key).onsuccess=function(){(r.limit<=0||++a<r.limit)&&e.continue()})}}},852:function(t,e,n){"use strict";n(3767),n(8585),n(8696);const r=new TextEncoder;t.exports=function(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):r.encode(t)}},4934:function(t){"use strict";t.exports=function(t){const e=void 0!==t.gte?t.gte:void 0!==t.gt?t.gt:void 0,n=void 0!==t.lte?t.lte:void 0!==t.lt?t.lt:void 0,r=void 0===t.gte,i=void 0===t.lte;return void 0!==e&&void 0!==n?IDBKeyRange.bound(e,n,r,i):void 0!==e?IDBKeyRange.lowerBound(e,r):void 0!==n?IDBKeyRange.upperBound(n,i):null}},911:function(t,e,n){"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */n(3767),n(8585),n(8696),n(7658);const r=n(8384),i=n(4237),s="function"===typeof Symbol&&"function"===typeof Symbol["for"]?Symbol["for"]("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=v,e.INSPECT_MAX_BYTES=50;const o=2147483647;function a(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}function c(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,l.prototype),e}function l(t,e,n){if("number"===typeof t){if("string"===typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return f(t)}return u(t,e,n)}function u(t,e,n){if("string"===typeof t)return p(t,e);if(ArrayBuffer.isView(t))return m(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(ot(t,ArrayBuffer)||t&&ot(t.buffer,ArrayBuffer))return y(t,e,n);if("undefined"!==typeof SharedArrayBuffer&&(ot(t,SharedArrayBuffer)||t&&ot(t.buffer,SharedArrayBuffer)))return y(t,e,n);if("number"===typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return l.from(r,e,n);const i=w(t);if(i)return i;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!==typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function d(t,e,n){return h(t),t<=0?c(t):void 0!==e?"string"===typeof n?c(t).fill(e,n):c(t).fill(e):c(t)}function f(t){return h(t),c(t<0?0:0|b(t))}function p(t,e){if("string"===typeof e&&""!==e||(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|E(t,e);let r=c(n);const i=r.write(t,e);return i!==n&&(r=r.slice(0,i)),r}function g(t){const e=t.length<0?0:0|b(t.length),n=c(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function m(t){if(ot(t,Uint8Array)){const e=new Uint8Array(t);return y(e.buffer,e.byteOffset,e.byteLength)}return g(t)}function y(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,l.prototype),r}function w(t){if(l.isBuffer(t)){const e=0|b(t.length),n=c(e);return 0===n.length||t.copy(n,0,0,e),n}return void 0!==t.length?"number"!==typeof t.length||at(t.length)?c(0):g(t):"Buffer"===t.type&&Array.isArray(t.data)?g(t.data):void 0}function b(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function v(t){return+t!=t&&(t=0),l.alloc(+t)}function E(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||ot(t,ArrayBuffer))return t.byteLength;if("string"!==typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return et(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return it(t).length;default:if(i)return r?-1:et(t).length;e=(""+e).toLowerCase(),i=!0}}function _(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";t||(t="utf8");while(1)switch(t){case"hex":return B(this,e,n);case"utf8":case"utf-8":return O(this,e,n);case"ascii":return M(this,e,n);case"latin1":case"binary":return L(this,e,n);case"base64":return D(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function S(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function A(t,e,n,r,i){if(0===t.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,at(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:C(t,e,n,r,i);if("number"===typeof e)return e&=255,"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):C(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function C(t,e,n,r,i){let s,o=1,a=t.length,c=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,n/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let r=-1;for(s=n;s<a;s++)if(l(t,s)===l(e,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===c)return r*o}else-1!==r&&(s-=s-r),r=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){let n=!0;for(let r=0;r<c;r++)if(l(t,s+r)!==l(e,r)){n=!1;break}if(n)return s}return-1}function I(t,e,n,r){n=Number(n)||0;const i=t.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;const s=e.length;let o;for(r>s/2&&(r=s/2),o=0;o<r;++o){const r=parseInt(e.substr(2*o,2),16);if(at(r))return o;t[n+o]=r}return o}function T(t,e,n,r){return st(et(e,t.length-n),t,n,r)}function k(t,e,n,r){return st(nt(e),t,n,r)}function R(t,e,n,r){return st(it(e),t,n,r)}function N(t,e,n,r){return st(rt(e,t.length-n),t,n,r)}function D(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function O(t,e,n){n=Math.min(t.length,n);const r=[];let i=e;while(i<n){const e=t[i];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=n){let n,r,a,c;switch(o){case 1:e<128&&(s=e);break;case 2:n=t[i+1],128===(192&n)&&(c=(31&e)<<6|63&n,c>127&&(s=c));break;case 3:n=t[i+1],r=t[i+2],128===(192&n)&&128===(192&r)&&(c=(15&e)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:n=t[i+1],r=t[i+2],a=t[i+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=o}return x(r)}e.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=a(),l.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(t,e,n){return u(t,e,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(t,e,n){return d(t,e,n)},l.allocUnsafe=function(t){return f(t)},l.allocUnsafeSlow=function(t){return f(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,e){if(ot(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),ot(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,r=e.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=l.allocUnsafe(e);let i=0;for(n=0;n<t.length;++n){let e=t[n];if(ot(e,Uint8Array))i+e.length>r.length?(l.isBuffer(e)||(e=l.from(e)),e.copy(r,i)):Uint8Array.prototype.set.call(r,e,i);else{if(!l.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,i)}i+=e.length}return r},l.byteLength=E,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)S(this,e,e+1);return this},l.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)S(this,e,e+3),S(this,e+1,e+2);return this},l.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)S(this,e,e+7),S(this,e+1,e+6),S(this,e+2,e+5),S(this,e+3,e+4);return this},l.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?O(this,0,t):_.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},s&&(l.prototype[s]=l.prototype.inspect),l.prototype.compare=function(t,e,n,r,i){if(ot(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;let s=i-r,o=n-e;const a=Math.min(s,o),c=this.slice(r,i),u=t.slice(e,n);for(let l=0;l<a;++l)if(c[l]!==u[l]){s=c[l],o=u[l];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return A(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return A(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"===typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let s=!1;for(;;)switch(r){case"hex":return I(this,t,e,n);case"utf8":case"utf-8":return T(this,t,e,n);case"ascii":case"latin1":case"binary":return k(this,t,e,n);case"base64":return R(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const P=4096;function x(t){const e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);let n="",r=0;while(r<e)n+=String.fromCharCode.apply(String,t.slice(r,r+=P));return n}function M(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function L(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function B(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let i="";for(let s=e;s<n;++s)i+=ct[t[s]];return i}function U(t,e,n){const r=t.slice(e,n);let i="";for(let s=0;s<r.length-1;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function F(t,e,n){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function z(t,e,n,r,i,s){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function V(t,e,n,r,i){X(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,n}function j(t,e,n,r,i){X(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n+7]=s,s>>=8,t[n+6]=s,s>>=8,t[n+5]=s,s>>=8,t[n+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=o,o>>=8,t[n+2]=o,o>>=8,t[n+1]=o,o>>=8,t[n]=o,n+8}function H(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function $(t,e,n,r,s){return e=+e,n>>>=0,s||H(t,e,n,4,34028234663852886e22,-34028234663852886e22),i.write(t,e,n,r,23,4),n+4}function K(t,e,n,r,s){return e=+e,n>>>=0,s||H(t,e,n,8,17976931348623157e292,-17976931348623157e292),i.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){const n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=this[t],i=1,s=0;while(++s<e&&(i*=256))r+=this[t+s]*i;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=this[t+--e],i=1;while(e>0&&(i*=256))r+=this[t+--e]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(t,e){return t>>>=0,e||F(t,1,this.length),this[t]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||F(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||F(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||F(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||F(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readBigUInt64LE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=this[t],i=1,s=0;while(++s<e&&(i*=256))r+=this[t+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=e,i=1,s=this[t+--r];while(r>0&&(i*=256))s+=this[t+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*e)),s},l.prototype.readInt8=function(t,e){return t>>>=0,e||F(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||F(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(t,e){t>>>=0,e||F(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||F(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||F(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readBigInt64LE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),l.prototype.readBigInt64BE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),l.prototype.readFloatLE=function(t,e){return t>>>=0,e||F(t,4,this.length),i.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||F(t,4,this.length),i.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||F(t,8,this.length),i.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||F(t,8,this.length),i.read(this,t,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){const r=Math.pow(2,8*n)-1;z(this,t,e,n,r,0)}let i=1,s=0;this[e]=255&t;while(++s<n&&(i*=256))this[e+s]=t/i&255;return e+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){const r=Math.pow(2,8*n)-1;z(this,t,e,n,r,0)}let i=n-1,s=1;this[e+i]=255&t;while(--i>=0&&(s*=256))this[e+i]=t/s&255;return e+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigUInt64LE=lt((function(t,e=0){return V(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=lt((function(t,e=0){return j(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);z(this,t,e,n,r-1,-r)}let i=0,s=1,o=0;this[e]=255&t;while(++i<n&&(s*=256))t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/s>>0)-o&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);z(this,t,e,n,r-1,-r)}let i=n-1,s=1,o=0;this[e+i]=255&t;while(--i>=0&&(s*=256))t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/s>>0)-o&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigInt64LE=lt((function(t,e=0){return V(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=lt((function(t,e=0){return j(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(t,e,n){return $(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return $(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return K(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return K(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const i=r-n;return this===t&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),i},l.prototype.fill=function(t,e,n,r){if("string"===typeof t){if("string"===typeof e?(r=e,e=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"===typeof t?t&=255:"boolean"===typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"===typeof t)for(i=e;i<n;++i)this[i]=t;else{const s=l.isBuffer(t)?t:l.from(t,r),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<n-e;++i)this[i+e]=s[i%o]}return this};const G={};function q(t,e,n){G[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function W(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function Y(t,e,n){Q(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||J(e,t.length-(n+1))}function X(t,e,n,r,i,s){if(t>n||t<e){const r="bigint"===typeof e?"n":"";let i;throw i=s>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(s+1)}${r}`:`>= -(2${r} ** ${8*(s+1)-1}${r}) and < 2 ** ${8*(s+1)-1}${r}`:`>= ${e}${r} and <= ${n}${r}`,new G.ERR_OUT_OF_RANGE("value",i,t)}Y(r,i,s)}function Q(t,e){if("number"!==typeof t)throw new G.ERR_INVALID_ARG_TYPE(e,"number",t)}function J(t,e,n){if(Math.floor(t)!==t)throw Q(t,n),new G.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new G.ERR_BUFFER_OUT_OF_BOUNDS;throw new G.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}q("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),q("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),q("ERR_OUT_OF_RANGE",(function(t,e,n){let r=`The value of "${t}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=W(String(n)):"bigint"===typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=W(i)),i+="n"),r+=` It must be ${e}. Received ${i}`,r}),RangeError);const Z=/[^+/0-9A-Za-z-_]/g;function tt(t){if(t=t.split("=")[0],t=t.trim().replace(Z,""),t.length<2)return"";while(t.length%4!==0)t+="=";return t}function et(t,e){let n;e=e||1/0;const r=t.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function nt(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function rt(t,e){let n,r,i;const s=[];for(let o=0;o<t.length;++o){if((e-=2)<0)break;n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r)}return s}function it(t){return r.toByteArray(tt(t))}function st(t,e,n,r){let i;for(i=0;i<r;++i){if(i+n>=e.length||i>=t.length)break;e[i+n]=t[i]}return i}function ot(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function at(t){return t!==t}const ct=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)e[r+i]=t[n]+t[i]}return e}();function lt(t){return"undefined"===typeof BigInt?ut:t}function ut(){throw new Error("BigInt not supported")}},9149:function(t){"use strict";
/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */t.exports=s,t.exports.format=o,t.exports.parse=a;var e=/\B(?=(\d{3})+(?!\d))/g,n=/(?:\.0*|(\.[^0]+)0+)$/,r={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},i=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function s(t,e){return"string"===typeof t?a(t):"number"===typeof t?o(t,e):null}function o(t,i){if(!Number.isFinite(t))return null;var s=Math.abs(t),o=i&&i.thousandsSeparator||"",a=i&&i.unitSeparator||"",c=i&&void 0!==i.decimalPlaces?i.decimalPlaces:2,l=Boolean(i&&i.fixedDecimals),u=i&&i.unit||"";u&&r[u.toLowerCase()]||(u=s>=r.pb?"PB":s>=r.tb?"TB":s>=r.gb?"GB":s>=r.mb?"MB":s>=r.kb?"KB":"B");var h=t/r[u.toLowerCase()],d=h.toFixed(c);return l||(d=d.replace(n,"$1")),o&&(d=d.split(".").map((function(t,n){return 0===n?t.replace(e,o):t})).join(".")),d+a+u}function a(t){if("number"===typeof t&&!isNaN(t))return t;if("string"!==typeof t)return null;var e,n=i.exec(t),s="b";return n?(e=parseFloat(n[1]),s=n[4].toLowerCase()):(e=parseInt(t,10),s="b"),isNaN(e)?null:Math.floor(r[s]*e)}},63:function(t,e,n){"use strict";var r=n(7609);e.fromCallback=function(t,e){if(void 0===t){var n=new Promise((function(e,n){t=function(t,r){t?n(t):e(r)}}));t[void 0!==e?e:"promise"]=n}else if("function"!==typeof t)throw new TypeError("Callback must be a function");return t},e.fromPromise=function(t,e){if(void 0===e)return t;t.then((function(t){r((()=>e(null,t)))})).catch((function(t){r((()=>e(t)))}))}},7609:function(t){t.exports="function"===typeof queueMicrotask?queueMicrotask:t=>Promise.resolve().then(t)},2978:function(t,e,n){function r(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function i(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(r++,"%c"===t&&(i=r))})),e.splice(i,0,n)}function s(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(n){}}function o(){let t;try{t=e.storage.getItem("debug")}catch(n){}return!t&&"undefined"!==typeof process&&"env"in process&&(t={NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}.DEBUG),t}function a(){try{return localStorage}catch(t){}}e.formatArgs=i,e.save=s,e.load=o,e.useColors=r,e.storage=a(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=n(882)(e);const{formatters:c}=t.exports;c.j=function(t){try{return JSON.stringify(t)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},882:function(t,e,n){function r(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return r.colors[Math.abs(e)%r.colors.length]}function r(t){let e,n,s,o=null;function a(...t){if(!a.enabled)return;const n=a,i=Number(new Date),s=i-(e||i);n.diff=s,n.prev=e,n.curr=i,e=i,t[0]=r.coerce(t[0]),"string"!==typeof t[0]&&t.unshift("%O");let o=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((e,i)=>{if("%%"===e)return"%";o++;const s=r.formatters[i];if("function"===typeof s){const r=t[o];e=s.call(n,r),t.splice(o,1),o--}return e})),r.formatArgs.call(n,t);const c=n.log||r.log;c.apply(n,t)}return a.namespace=t,a.useColors=r.useColors(),a.color=r.selectColor(t),a.extend=i,a.destroy=r.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==r.namespaces&&(n=r.namespaces,s=r.enabled(t)),s),set:t=>{o=t}}),"function"===typeof r.init&&r.init(a),a}function i(t,e){const n=r(this.namespace+("undefined"===typeof e?":":e)+t);return n.log=this.log,n}function s(t){let e;r.save(t),r.namespaces=t,r.names=[],r.skips=[];const n=("string"===typeof t?t:"").split(/[\s,]+/),i=n.length;for(e=0;e<i;e++)n[e]&&(t=n[e].replace(/\*/g,".*?"),"-"===t[0]?r.skips.push(new RegExp("^"+t.slice(1)+"$")):r.names.push(new RegExp("^"+t+"$")))}function o(){const t=[...r.names.map(c),...r.skips.map(c).map((t=>"-"+t))].join(",");return r.enable(""),t}function a(t){if("*"===t[t.length-1])return!0;let e,n;for(e=0,n=r.skips.length;e<n;e++)if(r.skips[e].test(t))return!1;for(e=0,n=r.names.length;e<n;e++)if(r.names[e].test(t))return!0;return!1}function c(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}function l(t){return t instanceof Error?t.stack||t.message:t}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=s,r.enabled=a,r.humanize=n(7510),r.destroy=u,Object.keys(t).forEach((e=>{r[e]=t[e]})),r.names=[],r.skips=[],r.formatters={},r.selectColor=e,r.enable(r.load()),r}n(541),n(7658),t.exports=r},6190:function(t){"use strict";const e=(t,e)=>Math.floor(Math.random()*(e-t+1)+t),n=()=>{const t=new Error("Delay aborted");return t.name="AbortError",t},r=({clearTimeout:t,setTimeout:e,willResolve:r})=>(i,{value:s,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(n());let a,c,l;const u=t||clearTimeout,h=()=>{u(a),l(n())},d=()=>{o&&o.removeEventListener("abort",h)},f=new Promise(((t,n)=>{c=()=>{d(),r?t(s):n(s)},l=n,a=(e||setTimeout)(c,i)}));return o&&o.addEventListener("abort",h,{once:!0}),f.clear=()=>{u(a),a=null,c()},f},i=t=>{const n=r({...t,willResolve:!0});return n.reject=r({...t,willResolve:!1}),n.range=(t,r,i)=>n(e(t,r),i),n},s=i();s.createWithTimers=i,t.exports=s,t.exports["default"]=s},7051:function(t,e,n){"use strict";function r(t,e){e=e||{};this._head=0,this._tail=0,this._capacity=e.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(t)&&this._fromArray(t)}n(541),n(7658),r.prototype.peekAt=function(t){var e=t;if(e===(0|e)){var n=this.size();if(!(e>=n||e<-n))return e<0&&(e+=n),e=this._head+e&this._capacityMask,this._list[e]}},r.prototype.get=function(t){return this.peekAt(t)},r.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},r.prototype.peekFront=function(){return this.peek()},r.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(r.prototype,"length",{get:function(){return this.size()}}),r.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.unshift=function(t){if(void 0===t)return this.size();var e=this._list.length;return this._head=this._head-1+e&this._capacityMask,this._list[this._head]=t,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.shift=function(){var t=this._head;if(t!==this._tail){var e=this._list[t];return this._list[t]=void 0,this._head=t+1&this._capacityMask,t<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),e}},r.prototype.push=function(t){if(void 0===t)return this.size();var e=this._tail;return this._list[e]=t,this._tail=e+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.pop=function(){var t=this._tail;if(t!==this._head){var e=this._list.length;this._tail=t-1+e&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&t>1e4&&t<=e>>>2&&this._shrinkArray(),n}},r.prototype.removeOne=function(t){var e=t;if(e===(0|e)&&this._head!==this._tail){var n=this.size(),r=this._list.length;if(!(e>=n||e<-n)){e<0&&(e+=n),e=this._head+e&this._capacityMask;var i,s=this._list[e];if(t<n/2){for(i=t;i>0;i--)this._list[e]=this._list[e=e-1+r&this._capacityMask];this._list[e]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(i=n-1-t;i>0;i--)this._list[e]=this._list[e=e+1+r&this._capacityMask];this._list[e]=void 0,this._tail=this._tail-1+r&this._capacityMask}return s}}},r.prototype.remove=function(t,e){var n,r=t,i=e;if(r===(0|r)&&this._head!==this._tail){var s=this.size(),o=this._list.length;if(!(r>=s||r<-s||e<1)){if(r<0&&(r+=s),1===e||!e)return n=new Array(1),n[0]=this.removeOne(r),n;if(0===r&&r+e>=s)return n=this.toArray(),this.clear(),n;var a;for(r+e>s&&(e=s-r),n=new Array(e),a=0;a<e;a++)n[a]=this._list[this._head+r+a&this._capacityMask];if(r=this._head+r&this._capacityMask,t+e===s){for(this._tail=this._tail-e+o&this._capacityMask,a=e;a>0;a--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(0===t){for(this._head=this._head+e+o&this._capacityMask,a=e-1;a>0;a--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(r<s/2){for(this._head=this._head+t+e+o&this._capacityMask,a=t;a>0;a--)this.unshift(this._list[r=r-1+o&this._capacityMask]);r=this._head-1+o&this._capacityMask;while(i>0)this._list[r=r-1+o&this._capacityMask]=void 0,i--;t<0&&(this._tail=r)}else{for(this._tail=r,r=r+e+o&this._capacityMask,a=s-(e+t);a>0;a--)this.push(this._list[r++]);r=this._tail;while(i>0)this._list[r=r+1+o&this._capacityMask]=void 0,i--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),n}}},r.prototype.splice=function(t,e){var n=t;if(n===(0|n)){var r=this.size();if(n<0&&(n+=r),!(n>r)){if(arguments.length>2){var i,s,o,a=arguments.length,c=this._list.length,l=2;if(!r||n<r/2){for(s=new Array(n),i=0;i<n;i++)s[i]=this._list[this._head+i&this._capacityMask];0===e?(o=[],n>0&&(this._head=this._head+n+c&this._capacityMask)):(o=this.remove(n,e),this._head=this._head+n+c&this._capacityMask);while(a>l)this.unshift(arguments[--a]);for(i=n;i>0;i--)this.unshift(s[i-1])}else{s=new Array(r-(n+e));var u=s.length;for(i=0;i<u;i++)s[i]=this._list[this._head+n+e+i&this._capacityMask];0===e?(o=[],n!=r&&(this._tail=this._head+n+c&this._capacityMask)):(o=this.remove(n,e),this._tail=this._tail-u+c&this._capacityMask);while(l<a)this.push(arguments[l++]);for(i=0;i<u;i++)this.push(s[i])}return o}return this.remove(n,e)}}},r.prototype.clear=function(){this._head=0,this._tail=0},r.prototype.isEmpty=function(){return this._head===this._tail},r.prototype.toArray=function(){return this._copyArray(!1)},r.prototype._fromArray=function(t){for(var e=0;e<t.length;e++)this.push(t[e])},r.prototype._copyArray=function(t){var e,n=[],r=this._list,i=r.length;if(t||this._head>this._tail){for(e=this._head;e<i;e++)n.push(r[e]);for(e=0;e<this._tail;e++)n.push(r[e])}else for(e=this._head;e<this._tail;e++)n.push(r[e]);return n},r.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1},r.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},t.exports=r},6759:function(t){!function(e,n){t.exports=function(t,e,n,r,i){for(e=e.split?e.split("."):e,r=0;r<e.length;r++)t=t?t[e[r]]:i;return t===i?n:t}}()},1196:function(t){"use strict";function e(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function n(t,n,r){if(!t||"string"===typeof t)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"===typeof n&&(r=n,n=""),n&&(r.code=n);try{return e(t,r)}catch(i){r.message=t.message,r.stack=t.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(t));const s=e(new n,r);return s}}t.exports=n},409:function(t,e,n){"use strict";n(7658);const r=n(9433);function i(t,e,n){return new r.EventIterator((({push:n})=>(this.addEventListener(t,n,e),()=>this.removeEventListener(t,n,e))),n)}e.zN=r.EventIterator,r.EventIterator},9433:function(t,e,n){"use strict";n(7658),Object.defineProperty(e,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(t){if(this.isStopped)return;const e={value:t,done:!1};if(this.pullQueue.length){const t=this.pullQueue.shift();t&&t.resolve(e)}else this.pushQueue.push(Promise.resolve(e)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const t of this.pullQueue)t.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(t){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const e of this.pullQueue)e.reject(t);this.pullQueue.length=0}else{const e=Promise.reject(t);e.catch((()=>{})),this.pushQueue.push(e)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:t=>{const e=this.pushQueue.shift();return e?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),e):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((t,e)=>{this.pullQueue.push({resolve:t,reject:e})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class i{constructor(t,{highWaterMark:e=100,lowWaterMark:n=1}={}){const i=new r;i.highWaterMark=e,i.lowWaterMark=n,i.removeCallback=t({push:t=>i.push(t),stop:()=>i.stop(),fail:t=>i.fail(t),on:(t,e)=>{i.eventHandlers[t]=e}})||(()=>{}),this[Symbol.asyncIterator]=()=>i[Symbol.asyncIterator](),Object.freeze(this)}}e.EventIterator=i,e["default"]=i},9835:function(t,e,n){"use strict";n(7658);var r=Object.prototype.hasOwnProperty,i="~";function s(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function a(t,e,n,r,s){if("function"!==typeof n)throw new TypeError("The listener must be a function");var a=new o(n,r||t,s),c=i?i+e:e;return t._events[c]?t._events[c].fn?t._events[c]=[t._events[c],a]:t._events[c].push(a):(t._events[c]=a,t._eventsCount++),t}function c(t,e){0===--t._eventsCount?t._events=new s:delete t._events[e]}function l(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),l.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},l.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,o=new Array(s);r<s;r++)o[r]=n[r].fn;return o},l.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},l.prototype.emit=function(t,e,n,r,s,o){var a=i?i+t:t;if(!this._events[a])return!1;var c,l,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(t,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,e),!0;case 3:return u.fn.call(u.context,e,n),!0;case 4:return u.fn.call(u.context,e,n,r),!0;case 5:return u.fn.call(u.context,e,n,r,s),!0;case 6:return u.fn.call(u.context,e,n,r,s,o),!0}for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var d,f=u.length;for(l=0;l<f;l++)switch(u[l].once&&this.removeListener(t,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,e);break;case 3:u[l].fn.call(u[l].context,e,n);break;case 4:u[l].fn.call(u[l].context,e,n,r);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];u[l].fn.apply(u[l].context,c)}}return!0},l.prototype.on=function(t,e,n){return a(this,t,e,n,!1)},l.prototype.once=function(t,e,n){return a(this,t,e,n,!0)},l.prototype.removeListener=function(t,e,n,r){var s=i?i+t:t;if(!this._events[s])return this;if(!e)return c(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||r&&!o.once||n&&o.context!==n||c(this,s);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==e||r&&!o[a].once||n&&o[a].context!==n)&&l.push(o[a]);l.length?this._events[s]=1===l.length?l[0]:l:c(this,s)}return this},l.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&c(this,e)):(this._events=new s,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=i,l.EventEmitter=l,t.exports=l},1528:function(t,e,n){"use strict";n(7658),n(541);var r,i="object"===typeof Reflect?Reflect:null,s=i&&"function"===typeof i.apply?i.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};function o(t){console&&console.warn&&console.warn(t)}r=i&&"function"===typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var a=Number.isNaN||function(t){return t!==t};function c(){c.init.call(this)}t.exports=c,t.exports.once=v,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var l=10;function u(t){if("function"!==typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function h(t){return void 0===t._maxListeners?c.defaultMaxListeners:t._maxListeners}function d(t,e,n,r){var i,s,a;if(u(n),s=t._events,void 0===s?(s=t._events=Object.create(null),t._eventsCount=0):(void 0!==s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),a=s[e]),void 0===a)a=s[e]=n,++t._eventsCount;else if("function"===typeof a?a=s[e]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),i=h(t),i>0&&a.length>i&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,o(c)}return t}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function p(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function g(t,e,n){var r=t._events;if(void 0===r)return[];var i=r[e];return void 0===i?[]:"function"===typeof i?n?[i.listener||i]:[i]:n?b(i):y(i,i.length)}function m(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function w(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function b(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}function v(t,e){return new Promise((function(n,r){function i(n){t.removeListener(e,s),r(n)}function s(){"function"===typeof t.removeListener&&t.removeListener("error",i),n([].slice.call(arguments))}_(t,e,s,{once:!0}),"error"!==e&&E(t,i,{once:!0})}))}function E(t,e,n){"function"===typeof t.on&&_(t,"error",e,n)}function _(t,e,n,r){if("function"===typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!==typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function i(s){r.once&&t.removeEventListener(e,i),n(s)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(t){if("number"!==typeof t||t<0||a(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");l=t}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(t){if("number"!==typeof t||t<0||a(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var o;if(e.length>0&&(o=e[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=i[t];if(void 0===c)return!1;if("function"===typeof c)s(c,this,e);else{var l=c.length,u=y(c,l);for(n=0;n<l;++n)s(u[n],this,e)}return!0},c.prototype.addListener=function(t,e){return d(this,t,e,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(t,e){return d(this,t,e,!0)},c.prototype.once=function(t,e){return u(e),this.on(t,p(this,t,e)),this},c.prototype.prependOnceListener=function(t,e){return u(e),this.prependListener(t,p(this,t,e)),this},c.prototype.removeListener=function(t,e){var n,r,i,s,o;if(u(e),r=this._events,void 0===r)return this;if(n=r[t],void 0===n)return this;if(n===e||n.listener===e)0===--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!==typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===e||n[s].listener===e){o=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():w(n,i),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,o||e)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(t){var e,n,r;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)i=s[r],"removeListener"!==i&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(e=n[t],"function"===typeof e)this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},c.prototype.listeners=function(t){return g(this,t,!0)},c.prototype.rawListeners=function(t){return g(this,t,!1)},c.listenerCount=function(t,e){return"function"===typeof t.listenerCount?t.listenerCount(e):m.call(t,e)},c.prototype.listenerCount=m,c.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},4042:function(t){t.exports=class{constructor(t){if(!(t>0)||0!==(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},2517:function(t,e,n){n(7658);const r=n(4042);t.exports=class{constructor(t){this.hwm=t||16,this.head=new r(this.hwm),this.tail=this.head}push(t){if(!this.head.push(t)){const e=this.head;this.head=e.next=new r(2*this.head.buffer.length),this.head.push(t)}}shift(){const t=this.tail.shift();if(void 0===t&&this.tail.next){const t=this.tail.next;return this.tail.next=null,this.tail=t,this.tail.shift()}return t}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},336:function(t,e){"use strict";function n(t,e=n.BASE){const r=t.length;for(let n=0;n<r;n++)e^=t.charCodeAt(n),e+=(e<<1)+(e<<4)+(e<<7)+(e<<8)+(e<<24);return e>>>0}Object.defineProperty(e,"__esModule",{value:!0}),n.BASE=2166136261,e["default"]=n,t.exports=n},5470:function(t){t.exports=function(t){if(!t)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,n=Object.create(null),r=Object.create(null);function i(i,s){n[i]=s,e++,e>=t&&(e=0,r=n,n=Object.create(null))}return{has:function(t){return void 0!==n[t]||void 0!==r[t]},remove:function(t){void 0!==n[t]&&(n[t]=void 0),void 0!==r[t]&&(r[t]=void 0)},get:function(t){var e=n[t];return void 0!==e?e:void 0!==(e=r[t])?(i(t,e),e):void 0},set:function(t,e){void 0!==n[t]?n[t]=e:i(t,e)},clear:function(){n=Object.create(null),r=Object.create(null)}}}},4237:function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=l}return(f?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,a,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),e+=o+h>=1?d/c:d*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+f]=255&o,f+=p,o/=256,l-=8);t[n+f-p]|=128*g}},3246:function(t,e,n){n(7658),function(e){"use strict";const n="(0?\\d+|0x[a-f0-9]+)",r={fourOctet:new RegExp(`^${n}\\.${n}\\.${n}\\.${n}$`,"i"),threeOctet:new RegExp(`^${n}\\.${n}\\.${n}$`,"i"),twoOctet:new RegExp(`^${n}\\.${n}$`,"i"),longValue:new RegExp(`^${n}$`,"i")},i=new RegExp("^0[0-7]+$","i"),s=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${n}\\.${n}\\.${n}\\.${n}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${n}\\.${n}\\.${n}\\.${n}(${o})?$`,"i")};function l(t,e){if(t.indexOf("::")!==t.lastIndexOf("::"))return null;let n,r,i=0,s=-1,o=(t.match(c.zoneIndex)||[])[0];o&&(o=o.substring(1),t=t.replace(/%.+$/,""));while((s=t.indexOf(":",s+1))>=0)i++;if("::"===t.substr(0,2)&&i--,"::"===t.substr(-2,2)&&i--,i>e)return null;r=e-i,n=":";while(r--)n+="0:";return t=t.replace("::",n),":"===t[0]&&(t=t.slice(1)),":"===t[t.length-1]&&(t=t.slice(0,-1)),e=function(){const e=t.split(":"),n=[];for(let t=0;t<e.length;t++)n.push(parseInt(e[t],16));return n}(),{parts:e,zoneId:o}}function u(t,e,n,r){if(t.length!==e.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let i,s=0;while(r>0){if(i=n-r,i<0&&(i=0),t[s]>>i!==e[s]>>i)return!1;r-=n,s+=1}return!0}function h(t){if(s.test(t))return parseInt(t,16);if("0"===t[0]&&!isNaN(parseInt(t[1],10))){if(i.test(t))return parseInt(t,8);throw new Error(`ipaddr: cannot parse ${t} as octal`)}return parseInt(t,10)}function d(t,e){while(t.length<e)t=`0${t}`;return t}const f={};f.IPv4=function(){function t(t){if(4!==t.length)throw new Error("ipaddr: ipv4 octet count should be 4");let e,n;for(e=0;e<t.length;e++)if(n=t[e],!(0<=n&&n<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=t}return t.prototype.SpecialRanges={unspecified:[[new t([0,0,0,0]),8]],broadcast:[[new t([255,255,255,255]),32]],multicast:[[new t([224,0,0,0]),4]],linkLocal:[[new t([169,254,0,0]),16]],loopback:[[new t([127,0,0,0]),8]],carrierGradeNat:[[new t([100,64,0,0]),10]],private:[[new t([10,0,0,0]),8],[new t([172,16,0,0]),12],[new t([192,168,0,0]),16]],reserved:[[new t([192,0,0,0]),24],[new t([192,0,2,0]),24],[new t([192,88,99,0]),24],[new t([198,51,100,0]),24],[new t([203,0,113,0]),24],[new t([240,0,0,0]),4]]},t.prototype.kind=function(){return"ipv4"},t.prototype.match=function(t,e){let n;if(void 0===e&&(n=t,t=n[0],e=n[1]),"ipv4"!==t.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,t.octets,8,e)},t.prototype.prefixLengthFromSubnetMask=function(){let t=0,e=!1;const n={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let r,i,s;for(r=3;r>=0;r-=1){if(i=this.octets[r],!(i in n))return null;if(s=n[i],e&&0!==s)return null;8!==s&&(e=!0),t+=s}return 32-t},t.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},t.prototype.toByteArray=function(){return this.octets.slice(0)},t.prototype.toIPv4MappedAddress=function(){return f.IPv6.parse(`::ffff:${this.toString()}`)},t.prototype.toNormalizedString=function(){return this.toString()},t.prototype.toString=function(){return this.octets.join(".")},t}(),f.IPv4.broadcastAddressFromCIDR=function(t){try{const e=this.parseCIDR(t),n=e[0].toByteArray(),r=this.subnetMaskFromPrefixLength(e[1]).toByteArray(),i=[];let s=0;while(s<4)i.push(parseInt(n[s],10)|255^parseInt(r[s],10)),s++;return new this(i)}catch(e){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.isIPv4=function(t){return null!==this.parser(t)},f.IPv4.isValid=function(t){try{return new this(this.parser(t)),!0}catch(e){return!1}},f.IPv4.isValidFourPartDecimal=function(t){return!(!f.IPv4.isValid(t)||!t.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},f.IPv4.networkAddressFromCIDR=function(t){let e,n,r,i,s;try{e=this.parseCIDR(t),r=e[0].toByteArray(),s=this.subnetMaskFromPrefixLength(e[1]).toByteArray(),i=[],n=0;while(n<4)i.push(parseInt(r[n],10)&parseInt(s[n],10)),n++;return new this(i)}catch(o){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},f.IPv4.parse=function(t){const e=this.parser(t);if(null===e)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(e)},f.IPv4.parseCIDR=function(t){let e;if(e=t.match(/^(.+)\/(\d+)$/)){const t=parseInt(e[2]);if(t>=0&&t<=32){const n=[this.parse(e[1]),t];return Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},f.IPv4.parser=function(t){let e,n,i;if(e=t.match(r.fourOctet))return function(){const t=e.slice(1,6),r=[];for(let e=0;e<t.length;e++)n=t[e],r.push(h(n));return r}();if(e=t.match(r.longValue)){if(i=h(e[1]),i>4294967295||i<0)throw new Error("ipaddr: address outside defined range");return function(){const t=[];let e;for(e=0;e<=24;e+=8)t.push(i>>e&255);return t}().reverse()}return(e=t.match(r.twoOctet))?function(){const t=e.slice(1,4),n=[];if(i=h(t[1]),i>16777215||i<0)throw new Error("ipaddr: address outside defined range");return n.push(h(t[0])),n.push(i>>16&255),n.push(i>>8&255),n.push(255&i),n}():(e=t.match(r.threeOctet))?function(){const t=e.slice(1,5),n=[];if(i=h(t[2]),i>65535||i<0)throw new Error("ipaddr: address outside defined range");return n.push(h(t[0])),n.push(h(t[1])),n.push(i>>8&255),n.push(255&i),n}():null},f.IPv4.subnetMaskFromPrefixLength=function(t){if(t=parseInt(t),t<0||t>32)throw new Error("ipaddr: invalid IPv4 prefix length");const e=[0,0,0,0];let n=0;const r=Math.floor(t/8);while(n<r)e[n]=255,n++;return r<4&&(e[r]=Math.pow(2,t%8)-1<<8-t%8),new this(e)},f.IPv6=function(){function t(t,e){let n,r;if(16===t.length)for(this.parts=[],n=0;n<=14;n+=2)this.parts.push(t[n]<<8|t[n+1]);else{if(8!==t.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=t}for(n=0;n<this.parts.length;n++)if(r=this.parts[n],!(0<=r&&r<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");e&&(this.zoneId=e)}return t.prototype.SpecialRanges={unspecified:[new t([0,0,0,0,0,0,0,0]),128],linkLocal:[new t([65152,0,0,0,0,0,0,0]),10],multicast:[new t([65280,0,0,0,0,0,0,0]),8],loopback:[new t([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new t([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new t([0,0,0,0,0,65535,0,0]),96],rfc6145:[new t([0,0,0,0,65535,0,0,0]),96],rfc6052:[new t([100,65435,0,0,0,0,0,0]),96],"6to4":[new t([8194,0,0,0,0,0,0,0]),16],teredo:[new t([8193,0,0,0,0,0,0,0]),32],reserved:[[new t([8193,3512,0,0,0,0,0,0]),32]]},t.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},t.prototype.kind=function(){return"ipv6"},t.prototype.match=function(t,e){let n;if(void 0===e&&(n=t,t=n[0],e=n[1]),"ipv6"!==t.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,t.parts,16,e)},t.prototype.prefixLengthFromSubnetMask=function(){let t=0,e=!1;const n={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let r,i;for(let s=7;s>=0;s-=1){if(r=this.parts[s],!(r in n))return null;if(i=n[r],e&&0!==i)return null;16!==i&&(e=!0),t+=i}return 128-t},t.prototype.range=function(){return f.subnetMatch(this,this.SpecialRanges)},t.prototype.toByteArray=function(){let t;const e=[],n=this.parts;for(let r=0;r<n.length;r++)t=n[r],e.push(t>>8),e.push(255&t);return e},t.prototype.toFixedLengthString=function(){const t=function(){const t=[];for(let e=0;e<this.parts.length;e++)t.push(d(this.parts[e].toString(16),4));return t}.call(this).join(":");let e="";return this.zoneId&&(e=`%${this.zoneId}`),t+e},t.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const t=this.parts.slice(-2),e=t[0],n=t[1];return new f.IPv4([e>>8,255&e,n>>8,255&n])},t.prototype.toNormalizedString=function(){const t=function(){const t=[];for(let e=0;e<this.parts.length;e++)t.push(this.parts[e].toString(16));return t}.call(this).join(":");let e="";return this.zoneId&&(e=`%${this.zoneId}`),t+e},t.prototype.toRFC5952String=function(){const t=/((^|:)(0(:|$)){2,})/g,e=this.toNormalizedString();let n,r=0,i=-1;while(n=t.exec(e))n[0].length>i&&(r=n.index,i=n[0].length);return i<0?e:`${e.substring(0,r)}::${e.substring(r+i)}`},t.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},t}(),f.IPv6.broadcastAddressFromCIDR=function(t){try{const e=this.parseCIDR(t),n=e[0].toByteArray(),r=this.subnetMaskFromPrefixLength(e[1]).toByteArray(),i=[];let s=0;while(s<16)i.push(parseInt(n[s],10)|255^parseInt(r[s],10)),s++;return new this(i)}catch(e){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${e})`)}},f.IPv6.isIPv6=function(t){return null!==this.parser(t)},f.IPv6.isValid=function(t){if("string"===typeof t&&-1===t.indexOf(":"))return!1;try{const e=this.parser(t);return new this(e.parts,e.zoneId),!0}catch(e){return!1}},f.IPv6.networkAddressFromCIDR=function(t){let e,n,r,i,s;try{e=this.parseCIDR(t),r=e[0].toByteArray(),s=this.subnetMaskFromPrefixLength(e[1]).toByteArray(),i=[],n=0;while(n<16)i.push(parseInt(r[n],10)&parseInt(s[n],10)),n++;return new this(i)}catch(o){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${o})`)}},f.IPv6.parse=function(t){const e=this.parser(t);if(null===e.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(e.parts,e.zoneId)},f.IPv6.parseCIDR=function(t){let e,n,r;if((n=t.match(/^(.+)\/(\d+)$/))&&(e=parseInt(n[2]),e>=0&&e<=128))return r=[this.parse(n[1]),e],Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},f.IPv6.parser=function(t){let e,n,r,i,s,o;if(r=t.match(c.deprecatedTransitional))return this.parser(`::ffff:${r[1]}`);if(c.native.test(t))return l(t,8);if((r=t.match(c.transitional))&&(o=r[6]||"",e=l(r[1].slice(0,-1)+o,6),e.parts)){for(s=[parseInt(r[2]),parseInt(r[3]),parseInt(r[4]),parseInt(r[5])],n=0;n<s.length;n++)if(i=s[n],!(0<=i&&i<=255))return null;return e.parts.push(s[0]<<8|s[1]),e.parts.push(s[2]<<8|s[3]),{parts:e.parts,zoneId:e.zoneId}}return null},f.IPv6.subnetMaskFromPrefixLength=function(t){if(t=parseInt(t),t<0||t>128)throw new Error("ipaddr: invalid IPv6 prefix length");const e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let n=0;const r=Math.floor(t/8);while(n<r)e[n]=255,n++;return r<16&&(e[r]=Math.pow(2,t%8)-1<<8-t%8),new this(e)},f.fromByteArray=function(t){const e=t.length;if(4===e)return new f.IPv4(t);if(16===e)return new f.IPv6(t);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},f.isValid=function(t){return f.IPv6.isValid(t)||f.IPv4.isValid(t)},f.parse=function(t){if(f.IPv6.isValid(t))return f.IPv6.parse(t);if(f.IPv4.isValid(t))return f.IPv4.parse(t);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},f.parseCIDR=function(t){try{return f.IPv6.parseCIDR(t)}catch(e){try{return f.IPv4.parseCIDR(t)}catch(n){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},f.process=function(t){const e=this.parse(t);return"ipv6"===e.kind()&&e.isIPv4MappedAddress()?e.toIPv4Address():e},f.subnetMatch=function(t,e,n){let r,i,s,o;for(i in void 0!==n&&null!==n||(n="unicast"),e)if(Object.prototype.hasOwnProperty.call(e,i))for(s=e[i],!s[0]||s[0]instanceof Array||(s=[s]),r=0;r<s.length;r++)if(o=s[r],t.kind()===o[0].kind()&&t.match.apply(t,o))return i;return n},t.exports?t.exports=f:e.ipaddr=f}(this)},5363:function(t,e,n){"use strict";globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?t.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:t.exports={default:n(5319)["default"],Headers:n(5319).Headers,Request:n(5319).Request,Response:n(5319).Response}},5319:function(t,e){"use strict";var n=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r)return r;throw new Error("unable to locate global object")},r=n();t.exports=e=r.fetch,r.fetch&&(e["default"]=r.fetch.bind(r)),e.Headers=r.Headers,e.Request=r.Request,e.Response=r.Response},6338:function(t,e,n){"use strict";const r=n(8346),i="object"===typeof window&&"object"===typeof document&&9===document.nodeType,s=r(),o=i&&!s,a=s&&!i,c=s&&i,l="undefined"!==typeof process&&"undefined"!==typeof process.release&&"node"===process.release.name&&!s,u="function"===typeof importScripts&&"undefined"!==typeof self&&"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,h="undefined"!==typeof process&&!1,d="undefined"!==typeof navigator&&"ReactNative"===navigator.product;t.exports={isTest:h,isElectron:s,isElectronMain:a,isElectronRenderer:c,isNode:l,isBrowser:o,isWebWorker:u,isEnvWithDom:i,isReactNative:d}},2656:function(t,e,n){"use strict";t.exports=n(5363)},1819:function(t,e,n){"use strict";const r=n(3785),i=(t,e)=>({path:decodeURIComponent(new URL(t).pathname.split("/").pop()||""),content:s(t,e)});async function*s(t,e){const n=new r,i=await n.get(t,e);yield*i.iterator()}t.exports=i},3785:function(t,e,n){"use strict";const{fetch:r,Request:i,Headers:s}=n(403),{TimeoutError:o,HTTPError:a}=n(1253),c=n(9610).bind({ignoreUndefined:!0}),{URL:l,URLSearchParams:u}=n(5248),h=n(3162),d=(t,e,n)=>{if(void 0===e)return t;const r=Date.now(),i=()=>{const t=Date.now()-r;return t>=e};return new Promise(((r,s)=>{const a=setTimeout((()=>{i()&&(s(new o),n.abort())}),e),c=t=>{const e=e=>{clearTimeout(a),i()?s(new o):t(e)};return e};t.then(c(r),c(s))}))},f={throwHttpErrors:!0,credentials:"same-origin"};class p{constructor(t={}){this.opts=c(f,t)}async fetch(t,e={}){const n=c(this.opts,e),o=new s(n.headers);if("string"!==typeof t&&!(t instanceof l||t instanceof i))throw new TypeError("`resource` must be a string, URL, or Request");const f=new l(t.toString(),n.base),{searchParams:p,transformSearchParams:y,json:w}=n;p&&(f.search="function"===typeof y?y(new u(n.searchParams)):new u(n.searchParams)),w&&(n.body=JSON.stringify(n.json),o.set("content-type","application/json"));const b=new AbortController,v=h([b.signal,n.signal]),E=await d(r(f.toString(),{...n,signal:v,timeout:void 0,headers:o}),n.timeout,b);if(!E.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(E),new a(E);return E.iterator=async function*(){yield*m(E.body)},E.ndjson=async function*(){for await(const t of g(E.iterator()))e.transform?yield e.transform(t):yield t},E}post(t,e={}){return this.fetch(t,{...e,method:"POST"})}get(t,e={}){return this.fetch(t,{...e,method:"GET"})}put(t,e={}){return this.fetch(t,{...e,method:"PUT"})}delete(t,e={}){return this.fetch(t,{...e,method:"DELETE"})}options(t,e={}){return this.fetch(t,{...e,method:"OPTIONS"})}}const g=async function*(t){const e=new TextDecoder;let n="";for await(const r of t){n+=e.decode(r,{stream:!0});const t=n.split(/\r?\n/);for(let e=0;e<t.length-1;e++){const n=t[e].trim();n.length>0&&(yield JSON.parse(n))}n=t[t.length-1]}n+=e.decode(),n=n.trim(),0!==n.length&&(yield JSON.parse(n))},m=t=>{if(b(t)){const e=t[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){return{next:e.next.bind(e),return(n){return t.destroy(),"function"===typeof e.return?e.return():Promise.resolve({done:!0,value:n})}}}}}if(w(t)){const e=t.getReader();return async function*(){try{while(1){const{done:t,value:n}=await e.read();if(t)return;n&&(yield n)}}finally{e.releaseLock()}}()}if(y(t))return t;throw new TypeError("Body can't be converted to AsyncIterable")},y=t=>"object"===typeof t&&null!==t&&"function"===typeof t[Symbol.asyncIterator],w=t=>t&&"function"===typeof t.getReader,b=t=>Object.prototype.hasOwnProperty.call(t,"readable")&&Object.prototype.hasOwnProperty.call(t,"writable");p.HTTPError=a,p.TimeoutError=o,p.streamToAsyncIterator=m,p.post=(t,e)=>new p(e).post(t,e),p.get=(t,e)=>new p(e).get(t,e),p.put=(t,e)=>new p(e).put(t,e),p.delete=(t,e)=>new p(e).delete(t,e),p.options=(t,e)=>new p(e).options(t,e),t.exports=p},1253:function(t,e){"use strict";class n extends Error{constructor(t="Request timed out"){super(t),this.name="TimeoutError"}}e.TimeoutError=n;class r extends Error{constructor(t="The operation was aborted."){super(t),this.name="AbortError"}}e.AbortError=r;class i extends Error{constructor(t){super(t.statusText),this.name="HTTPError",this.response=t}}e.HTTPError=i},403:function(t,e,n){"use strict";const{TimeoutError:r,AbortError:i}=n(1253),{Response:s,Request:o,Headers:a,default:c}=n(2656),l=(t,e={})=>{const n=new XMLHttpRequest;n.open(e.method||"GET",t.toString(),!0);const{timeout:o,headers:c}=e;if(o&&o>0&&o<1/0&&(n.timeout=o),null!=e.overrideMimeType&&n.overrideMimeType(e.overrideMimeType),c)for(const[r,i]of new a(c))n.setRequestHeader(r,i);return e.signal&&(e.signal.onabort=()=>n.abort()),e.onUploadProgress&&(n.upload.onprogress=e.onUploadProgress),n.responseType="arraybuffer",new Promise(((t,o)=>{const a=e=>{switch(e.type){case"error":t(s.error());break;case"load":t(new f(n.responseURL,n.response,{status:n.status,statusText:n.statusText,headers:d(n.getAllResponseHeaders())}));break;case"timeout":o(new r);break;case"abort":o(new i);break;default:break}};n.onerror=a,n.onload=a,n.ontimeout=a,n.onabort=a,n.send(e.body)}))},u=c,h=(t,e={})=>null!=e.onUploadProgress?l(t,e):u(t,e),d=t=>{const e=new a;for(const n of t.trim().split(/[\r\n]+/)){const t=n.indexOf(": ");t>0&&e.set(n.slice(0,t),n.slice(t+1))}return e};class f extends s{constructor(t,e,n){super(e,n),Object.defineProperty(this,"url",{value:t})}}t.exports={fetch:h,Request:o,Headers:a}},6209:function(t){"use strict";var e=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;t.exports=function(t,n){if(null==n&&(n=!1),t.length<2)return!1;if(t.length>255)return!1;var r=t[t.length-1];if(n){if("."!==r)return!1}else if("."===r)return!1;return e.test(t)}},8346:function(t){function e(){return"undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type||(!("undefined"===typeof process||"object"!==typeof process.versions||!process.versions.electron)||"object"===typeof navigator&&"string"===typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}t.exports=e},7576:function(t){"use strict";t.exports=t=>{if("[object Object]"!==Object.prototype.toString.call(t))return!1;const e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}},7870:function(t){"use strict";t.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:256,RTLD_LOCAL:0,RTLD_DEEPBIND:8,E2BIG:7,EACCES:13,EADDRINUSE:98,EADDRNOTAVAIL:99,EAFNOSUPPORT:97,EAGAIN:11,EALREADY:114,EBADF:9,EBADMSG:74,EBUSY:16,ECANCELED:125,ECHILD:10,ECONNABORTED:103,ECONNREFUSED:111,ECONNRESET:104,EDEADLK:35,EDESTADDRREQ:89,EDOM:33,EDQUOT:122,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:113,EIDRM:43,EILSEQ:84,EINPROGRESS:115,EINTR:4,EINVAL:22,EIO:5,EISCONN:106,EISDIR:21,ELOOP:40,EMFILE:24,EMLINK:31,EMSGSIZE:90,EMULTIHOP:72,ENAMETOOLONG:36,ENETDOWN:100,ENETRESET:102,ENETUNREACH:101,ENFILE:23,ENOBUFS:105,ENODATA:61,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:37,ENOLINK:67,ENOMEM:12,ENOMSG:42,ENOPROTOOPT:92,ENOSPC:28,ENOSR:63,ENOSTR:60,ENOSYS:38,ENOTCONN:107,ENOTDIR:20,ENOTEMPTY:39,ENOTSOCK:88,ENOTSUP:95,ENOTTY:25,ENXIO:6,EOPNOTSUPP:95,EOVERFLOW:75,EPERM:1,EPIPE:32,EPROTO:71,EPROTONOSUPPORT:93,EPROTOTYPE:91,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:116,ETIME:62,ETIMEDOUT:110,ETXTBSY:26,EWOULDBLOCK:11,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:7,SIGFPE:8,SIGKILL:9,SIGUSR1:10,SIGSEGV:11,SIGUSR2:12,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:17,SIGSTKFLT:16,SIGCONT:18,SIGSTOP:19,SIGTSTP:20,SIGTTIN:21,SIGTTOU:22,SIGURG:23,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:29,SIGPOLL:29,SIGPWR:30,SIGSYS:31,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,UV_FS_O_FILEMAP:0,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:805306480,SSL_OP_ALL:2147485776,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,defaultCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA"}},5317:function(t,e,n){"use strict";n(3767),n(8585),n(8696);const r=65536;function i(t){const e=new Uint8Array(t);let n=0;if(t>0)if(t>r)while(n<t)n+r>t?(crypto.getRandomValues(e.subarray(n,n+(t-n))),n+=t-n):(crypto.getRandomValues(e.subarray(n,n+r)),n+=r);else crypto.getRandomValues(e);return e}t.exports=i},5248:function(t,e,n){"use strict";const{URLWithLegacySupport:r,format:i,URLSearchParams:s,defaultBase:o}=n(1124),a=n(5456);t.exports={URL:r,URLSearchParams:s,format:i,relative:a,defaultBase:o}},5456:function(t,e,n){"use strict";const{URLWithLegacySupport:r,format:i}=n(1124);t.exports=(t,e={},n={},s)=>{let o,a=e.protocol?e.protocol.replace(":",""):"http";a=(n[a]||s||a)+":";try{o=new r(t)}catch(l){o={}}const c=Object.assign({},e,{protocol:a||o.protocol,host:e.host||o.host});return new r(t,i(c)).toString()}},1124:function(t){"use strict";const e="undefined"!==typeof navigator&&"ReactNative"===navigator.product;function n(){return e?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}const r=self.URL,i=n();class s{constructor(t="",e=i){this.super=new r(t,e),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(t){this.super.hash=t}set host(t){this.super.host=t}set hostname(t){this.super.hostname=t}set href(t){this.super.href=t}set password(t){this.super.password=t}set pathname(t){this.super.pathname=t}set port(t){this.super.port=t}set protocol(t){this.super.protocol=t}set search(t){this.super.search=t}set username(t){this.super.username=t}static createObjectURL(t){return r.createObjectURL(t)}static revokeObjectURL(t){r.revokeObjectURL(t)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}}function o(t){if("string"===typeof t){const e=new r(t);return e.toString()}if(!(t instanceof r)){const e=t.username&&t.password?`${t.username}:${t.password}@`:"",n=t.auth?t.auth+"@":"",r=t.port?":"+t.port:"",i=t.protocol?t.protocol+"//":"",s=t.host||"",o=t.hostname||"",a=t.search||(t.query?"?"+t.query:""),c=t.hash||"",l=t.pathname||"",u=t.path||l+a;return`${i}${e||n}${s||o+r}${u}${c}`}}t.exports={URLWithLegacySupport:s,URLSearchParams:self.URLSearchParams,defaultBase:i,format:o}},1918:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=n(8109),{EventEmitter:i}=n(1528);function s(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;++n)if(t[n]!==e[n])return!1;return!0}function o(){return{contacts:[],dontSplit:!1,left:null,right:null}}function a(t,e){if(!(e instanceof Uint8Array))throw new TypeError(t+" is not a Uint8Array")}class c extends i{constructor(t={}){super(),this.localNodeId=t.localNodeId||r(20),this.numberOfNodesPerKBucket=t.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=t.numberOfNodesToPing||3,this.distance=t.distance||c.distance,this.arbiter=t.arbiter||c.arbiter,this.metadata=Object.assign({},t.metadata),a("option.localNodeId as parameter 1",this.localNodeId),this.root=o()}static arbiter(t,e){return t.vectorClock>e.vectorClock?t:e}static distance(t,e){let n=0,r=0;const i=Math.min(t.length,e.length),s=Math.max(t.length,e.length);for(;r<i;++r)n=256*n+(t[r]^e[r]);for(;r<s;++r)n=256*n+255;return n}add(t){a("contact.id",(t||{}).id);let e=0,n=this.root;while(null===n.contacts)n=this._determineNode(n,t.id,e++);const r=this._indexOf(n,t.id);return r>=0?(this._update(n,r,t),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(t),this.emit("added",t),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),t),this):(this._split(n,e),this.add(t))}closest(t,e=1/0){if(a("id",t),!Number.isInteger(e)&&e!==1/0||e<=0)throw new TypeError("n is not positive number");let n=[];for(let r=[this.root],i=0;r.length>0&&n.length<e;){const e=r.pop();if(null===e.contacts){const n=this._determineNode(e,t,i++);r.push(e.left===n?e.right:e.left),r.push(n)}else n=n.concat(e.contacts)}return n.map((e=>[this.distance(e.id,t),e])).sort(((t,e)=>t[0]-e[0])).slice(0,e).map((t=>t[1]))}count(){let t=0;for(const e=[this.root];e.length>0;){const n=e.pop();null===n.contacts?e.push(n.right,n.left):t+=n.contacts.length}return t}_determineNode(t,e,n){const r=n>>3,i=n%8;if(e.length<=r&&0!==i)return t.left;const s=e[r];return s&1<<7-i?t.right:t.left}get(t){a("id",t);let e=0,n=this.root;while(null===n.contacts)n=this._determineNode(n,t,e++);const r=this._indexOf(n,t);return r>=0?n.contacts[r]:null}_indexOf(t,e){for(let n=0;n<t.contacts.length;++n)if(s(t.contacts[n].id,e))return n;return-1}remove(t){a("the id as parameter 1",t);let e=0,n=this.root;while(null===n.contacts)n=this._determineNode(n,t,e++);const r=this._indexOf(n,t);if(r>=0){const t=n.contacts.splice(r,1)[0];this.emit("removed",t)}return this}_split(t,e){t.left=o(),t.right=o();for(const i of t.contacts)this._determineNode(t,i.id,e).contacts.push(i);t.contacts=null;const n=this._determineNode(t,this.localNodeId,e),r=t.left===n?t.right:t.left;r.dontSplit=!0}toArray(){let t=[];for(const e=[this.root];e.length>0;){const n=e.pop();null===n.contacts?e.push(n.right,n.left):t=t.concat(n.contacts)}return t}*toIterable(){for(const t=[this.root];t.length>0;){const e=t.pop();null===e.contacts?t.push(e.right,e.left):yield*e.contacts}}_update(t,e,n){if(!s(t.contacts[e].id,n.id))throw new Error("wrong index for _update");const r=t.contacts[e],i=this.arbiter(r,n);i===r&&r!==n||(t.contacts.splice(e,1),t.contacts.push(i),this.emit("updated",r,i))}}t.exports=c},9078:function(t,e){"use strict";e.supports=function(...t){const e=t.reduce(((t,e)=>Object.assign(t,e)),{});return Object.assign(e,{snapshots:e.snapshots||!1,permanence:e.permanence||!1,seek:e.seek||!1,clear:e.clear||!1,getMany:e.getMany||!1,keyIterator:e.keyIterator||!1,valueIterator:e.valueIterator||!1,iteratorNextv:e.iteratorNextv||!1,iteratorAll:e.iteratorAll||!1,status:e.status||!1,createIfMissing:e.createIfMissing||!1,errorIfExists:e.errorIfExists||!1,deferredOpen:e.deferredOpen||!1,promises:e.promises||!1,streams:e.streams||!1,encodings:Object.assign({},e.encodings),events:Object.assign({},e.events),additionalMethods:Object.assign({},e.additionalMethods)})}},9871:function(t,e,n){"use strict";const r=n(7368),i=n(7924),{Encoding:s}=n(1267),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=n(1001),l=Symbol("formats"),u=Symbol("encodings"),h=new Set(["buffer","view","utf8"]);class d{constructor(t){if(!Array.isArray(t))throw new TypeError("The first argument 'formats' must be an array");if(!t.every((t=>h.has(t))))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'");this[u]=new Map,this[l]=new Set(t);for(const n in i)try{this.encoding(n)}catch(e){if("LEVEL_ENCODING_NOT_SUPPORTED"!==e.code)throw e}}encodings(){return Array.from(new Set(this[u].values()))}encoding(t){let e=this[u].get(t);if(void 0===e){if("string"===typeof t&&""!==t){if(e=m[t],!e)throw new r(`Encoding '${t}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!==typeof t||null===t)throw new TypeError("First argument 'encoding' must be a string or object");e=f(t)}const{name:n,format:i}=e;if(!this[l].has(i))if(this[l].has("view"))e=e.createViewTranscoder();else if(this[l].has("buffer"))e=e.createBufferTranscoder();else{if(!this[l].has("utf8"))throw new r(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});e=e.createUTF8Transcoder()}for(const r of[t,n,e.name,e.commonName])this[u].set(r,e)}return e}}function f(t){if(t instanceof s)return t;const e="type"in t&&"string"===typeof t.type?t.type:void 0,n=t.name||e||"anonymous-"+y++;switch(p(t)){case"view":return new a({...t,name:n});case"utf8":return new c({...t,name:n});case"buffer":return new o({...t,name:n});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function p(t){return"format"in t&&void 0!==t.format?t.format:"buffer"in t&&"boolean"===typeof t.buffer?t.buffer?"buffer":"utf8":"code"in t&&Number.isInteger(t.code)?"view":"buffer"}e.Transcoder=d;const g={binary:i.buffer,"utf-8":i.utf8},m={...i,...g};let y=0},1267:function(t,e,n){"use strict";const r=n(7368),i=new Set(["buffer","view","utf8"]);class s{constructor(t){if(this.encode=t.encode||this.encode,this.decode=t.decode||this.decode,this.name=t.name||this.name,this.format=t.format||this.format,"function"!==typeof this.encode)throw new TypeError("The 'encode' property must be a function");if("function"!==typeof this.decode)throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!==typeof this.name||""===this.name)throw new TypeError("The 'name' property must be a string");if("string"!==typeof this.format||!i.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");t.createViewTranscoder&&(this.createViewTranscoder=t.createViewTranscoder),t.createBufferTranscoder&&(this.createBufferTranscoder=t.createBufferTranscoder),t.createUTF8Transcoder&&(this.createUTF8Transcoder=t.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}e.Encoding=s},7924:function(t,e,n){"use strict";const{Buffer:r}=n(911)||{Buffer:{isBuffer:()=>!1}},{textEncoder:i,textDecoder:s}=n(944)(),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=n(1001),l=t=>t;e.utf8=new c({encode:function(t){return r.isBuffer(t)?t.toString("utf8"):ArrayBuffer.isView(t)?s.decode(t):String(t)},decode:l,name:"utf8",createViewTranscoder(){return new a({encode:function(t){return ArrayBuffer.isView(t)?t:i.encode(t)},decode:function(t){return s.decode(t)},name:`${this.name}+view`})},createBufferTranscoder(){return new o({encode:function(t){return r.isBuffer(t)?t:ArrayBuffer.isView(t)?r.from(t.buffer,t.byteOffset,t.byteLength):r.from(String(t),"utf8")},decode:function(t){return t.toString("utf8")},name:`${this.name}+buffer`})}}),e.json=new c({encode:JSON.stringify,decode:JSON.parse,name:"json"}),e.buffer=new o({encode:function(t){return r.isBuffer(t)?t:ArrayBuffer.isView(t)?r.from(t.buffer,t.byteOffset,t.byteLength):r.from(String(t),"utf8")},decode:l,name:"buffer",createViewTranscoder(){return new a({encode:function(t){return ArrayBuffer.isView(t)?t:r.from(String(t),"utf8")},decode:function(t){return r.from(t.buffer,t.byteOffset,t.byteLength)},name:`${this.name}+view`})}}),e.view=new a({encode:function(t){return ArrayBuffer.isView(t)?t:i.encode(t)},decode:l,name:"view",createBufferTranscoder(){return new o({encode:function(t){return r.isBuffer(t)?t:ArrayBuffer.isView(t)?r.from(t.buffer,t.byteOffset,t.byteLength):r.from(String(t),"utf8")},decode:l,name:`${this.name}+buffer`})}}),e.hex=new o({encode:function(t){return r.isBuffer(t)?t:r.from(String(t),"hex")},decode:function(t){return t.toString("hex")},name:"hex"}),e.base64=new o({encode:function(t){return r.isBuffer(t)?t:r.from(String(t),"base64")},decode:function(t){return t.toString("base64")},name:"base64"})},1001:function(t,e,n){"use strict";const{Buffer:r}=n(911)||{},{Encoding:i}=n(1267),s=n(944);class o extends i{constructor(t){super({...t,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:t=>this.decode(r.from(t.buffer,t.byteOffset,t.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class a extends i{constructor(t){super({...t,format:"view"})}createBufferTranscoder(){return new o({encode:t=>{const e=this.encode(t);return r.from(e.buffer,e.byteOffset,e.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}class c extends i{constructor(t){super({...t,format:"utf8"})}createBufferTranscoder(){return new o({encode:t=>r.from(this.encode(t),"utf8"),decode:t=>this.decode(t.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:t,textDecoder:e}=s();return new a({encode:e=>t.encode(this.encode(e)),decode:t=>this.decode(e.decode(t)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}e.BufferFormat=o,e.ViewFormat=a,e.UTF8Format=c},944:function(t){"use strict";let e=null;t.exports=function(){return null===e&&(e={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),e}},7914:function(t,e,n){e.Level=n(2547).BrowserLevel},9610:function(t,e,n){"use strict";n(7658);const r=n(7576),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0}),a=this,c={concatArrays:!1,ignoreUndefined:!1},l=t=>{const e=[];for(const n in t)i.call(t,n)&&e.push(n);if(Object.getOwnPropertySymbols){const n=Object.getOwnPropertySymbols(t);for(const r of n)s.call(t,r)&&e.push(r)}return e};function u(t){return Array.isArray(t)?h(t):r(t)?d(t):t}function h(t){const e=t.slice(0,0);return l(t).forEach((n=>{o(e,n,u(t[n]))})),e}function d(t){const e=null===Object.getPrototypeOf(t)?Object.create(null):{};return l(t).forEach((n=>{o(e,n,u(t[n]))})),e}const f=(t,e,n,r)=>(n.forEach((n=>{"undefined"===typeof e[n]&&r.ignoreUndefined||(n in t&&t[n]!==Object.getPrototypeOf(t)?o(t,n,g(t[n],e[n],r)):o(t,n,u(e[n])))})),t),p=(t,e,n)=>{let r=t.slice(0,0),s=0;return[t,e].forEach((e=>{const a=[];for(let n=0;n<e.length;n++)i.call(e,n)&&(a.push(String(n)),o(r,s++,e===t?e[n]:u(e[n])));r=f(r,e,l(e).filter((t=>!a.includes(t))),n)})),r};function g(t,e,n){return n.concatArrays&&Array.isArray(t)&&Array.isArray(e)?p(t,e,n):r(e)&&r(t)?f(t,e,l(e),n):u(e)}t.exports=function(...t){const e=g(u(c),this!==a&&this||{},c);let n={_:{}};for(const i of t)if(void 0!==i){if(!r(i))throw new TypeError("`"+i+"` is not an Option Object");n=g(n,{_:i},e)}return n._}},7368:function(t){"use strict";t.exports=class extends Error{constructor(t,e){super(t||""),"object"===typeof e&&null!==e&&(e.code&&(this.code=String(e.code)),e.expected&&(this.expected=!0),e.transient&&(this.transient=!0),e.cause&&(this.cause=e.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},7510:function(t){var e=1e3,n=60*e,r=60*n,i=24*r,s=7*i,o=365.25*i;function a(t){if(t=String(t),!(t.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(a){var c=parseFloat(a[1]),l=(a[2]||"ms").toLowerCase();switch(l){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*s;case"days":case"day":case"d":return c*i;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}function c(t){var s=Math.abs(t);return s>=i?Math.round(t/i)+"d":s>=r?Math.round(t/r)+"h":s>=n?Math.round(t/n)+"m":s>=e?Math.round(t/e)+"s":t+"ms"}function l(t){var s=Math.abs(t);return s>=i?u(t,s,i,"day"):s>=r?u(t,s,r,"hour"):s>=n?u(t,s,n,"minute"):s>=e?u(t,s,e,"second"):t+" ms"}function u(t,e,n,r){var i=e>=1.5*n;return Math.round(t/n)+" "+r+(i?"s":"")}t.exports=function(t,e){e=e||{};var n=typeof t;if("string"===n&&t.length>0)return a(t);if("number"===n&&isFinite(t))return e.long?l(t):c(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}},512:function(t,e,n){t.exports=n(2820)},2820:function(t,e){(function(n,r){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(t){if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return!1;for(var e=0;e<t.length;e++)if(!Number.isInteger(t[e])||t[e]<0||t[e]>255)return!1;return!0}function o(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function a(t,e){return t<<e|t>>>32-e}function c(t){return t^=t>>>16,t=o(t,2246822507),t^=t>>>13,t=o(t,3266489909),t^=t>>>16,t}function l(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var n=[0,0,0,0];return n[3]+=t[3]+e[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=t[2]+e[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=t[1]+e[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=t[0]+e[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function u(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var n=[0,0,0,0];return n[3]+=t[3]*e[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=t[2]*e[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=t[3]*e[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=t[1]*e[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=t[2]*e[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=t[3]*e[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=t[0]*e[3]+t[1]*e[2]+t[2]*e[1]+t[3]*e[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function h(t,e){return e%=64,32===e?[t[1],t[0]]:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e|t[0]>>>32-e]:(e-=32,[t[1]<<e|t[0]>>>32-e,t[0]<<e|t[1]>>>32-e])}function d(t,e){return e%=64,0===e?t:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e]:[t[1]<<e-32,0]}function f(t,e){return[t[0]^e[0],t[1]^e[1]]}function p(t){return t=f(t,[0,t[0]>>>1]),t=u(t,[4283543511,3981806797]),t=f(t,[0,t[0]>>>1]),t=u(t,[3301882366,444984403]),t=f(t,[0,t[0]>>>1]),t}i.x86.hash32=function(t,e){if(i.inputValidation&&!s(t))return r;e=e||0;for(var n=t.length%4,l=t.length-n,u=e,h=0,d=3432918353,f=461845907,p=0;p<l;p+=4)h=t[p]|t[p+1]<<8|t[p+2]<<16|t[p+3]<<24,h=o(h,d),h=a(h,15),h=o(h,f),u^=h,u=a(u,13),u=o(u,5)+3864292196;switch(h=0,n){case 3:h^=t[p+2]<<16;case 2:h^=t[p+1]<<8;case 1:h^=t[p],h=o(h,d),h=a(h,15),h=o(h,f),u^=h}return u^=t.length,u=c(u),u>>>0},i.x86.hash128=function(t,e){if(i.inputValidation&&!s(t))return r;e=e||0;for(var n=t.length%16,l=t.length-n,u=e,h=e,d=e,f=e,p=0,g=0,m=0,y=0,w=597399067,b=2869860233,v=951274213,E=2716044179,_=0;_<l;_+=16)p=t[_]|t[_+1]<<8|t[_+2]<<16|t[_+3]<<24,g=t[_+4]|t[_+5]<<8|t[_+6]<<16|t[_+7]<<24,m=t[_+8]|t[_+9]<<8|t[_+10]<<16|t[_+11]<<24,y=t[_+12]|t[_+13]<<8|t[_+14]<<16|t[_+15]<<24,p=o(p,w),p=a(p,15),p=o(p,b),u^=p,u=a(u,19),u+=h,u=o(u,5)+1444728091,g=o(g,b),g=a(g,16),g=o(g,v),h^=g,h=a(h,17),h+=d,h=o(h,5)+197830471,m=o(m,v),m=a(m,17),m=o(m,E),d^=m,d=a(d,15),d+=f,d=o(d,5)+2530024501,y=o(y,E),y=a(y,18),y=o(y,w),f^=y,f=a(f,13),f+=u,f=o(f,5)+850148119;switch(p=0,g=0,m=0,y=0,n){case 15:y^=t[_+14]<<16;case 14:y^=t[_+13]<<8;case 13:y^=t[_+12],y=o(y,E),y=a(y,18),y=o(y,w),f^=y;case 12:m^=t[_+11]<<24;case 11:m^=t[_+10]<<16;case 10:m^=t[_+9]<<8;case 9:m^=t[_+8],m=o(m,v),m=a(m,17),m=o(m,E),d^=m;case 8:g^=t[_+7]<<24;case 7:g^=t[_+6]<<16;case 6:g^=t[_+5]<<8;case 5:g^=t[_+4],g=o(g,b),g=a(g,16),g=o(g,v),h^=g;case 4:p^=t[_+3]<<24;case 3:p^=t[_+2]<<16;case 2:p^=t[_+1]<<8;case 1:p^=t[_],p=o(p,w),p=a(p,15),p=o(p,b),u^=p}return u^=t.length,h^=t.length,d^=t.length,f^=t.length,u+=h,u+=d,u+=f,h+=u,d+=u,f+=u,u=c(u),h=c(h),d=c(d),f=c(f),u+=h,u+=d,u+=f,h+=u,d+=u,f+=u,("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)},i.x64.hash128=function(t,e){if(i.inputValidation&&!s(t))return r;e=e||0;for(var n=t.length%16,o=t.length-n,a=[0,e],c=[0,e],g=[0,0],m=[0,0],y=[2277735313,289559509],w=[1291169091,658871167],b=0;b<o;b+=16)g=[t[b+4]|t[b+5]<<8|t[b+6]<<16|t[b+7]<<24,t[b]|t[b+1]<<8|t[b+2]<<16|t[b+3]<<24],m=[t[b+12]|t[b+13]<<8|t[b+14]<<16|t[b+15]<<24,t[b+8]|t[b+9]<<8|t[b+10]<<16|t[b+11]<<24],g=u(g,y),g=h(g,31),g=u(g,w),a=f(a,g),a=h(a,27),a=l(a,c),a=l(u(a,[0,5]),[0,1390208809]),m=u(m,w),m=h(m,33),m=u(m,y),c=f(c,m),c=h(c,31),c=l(c,a),c=l(u(c,[0,5]),[0,944331445]);switch(g=[0,0],m=[0,0],n){case 15:m=f(m,d([0,t[b+14]],48));case 14:m=f(m,d([0,t[b+13]],40));case 13:m=f(m,d([0,t[b+12]],32));case 12:m=f(m,d([0,t[b+11]],24));case 11:m=f(m,d([0,t[b+10]],16));case 10:m=f(m,d([0,t[b+9]],8));case 9:m=f(m,[0,t[b+8]]),m=u(m,w),m=h(m,33),m=u(m,y),c=f(c,m);case 8:g=f(g,d([0,t[b+7]],56));case 7:g=f(g,d([0,t[b+6]],48));case 6:g=f(g,d([0,t[b+5]],40));case 5:g=f(g,d([0,t[b+4]],32));case 4:g=f(g,d([0,t[b+3]],24));case 3:g=f(g,d([0,t[b+2]],16));case 2:g=f(g,d([0,t[b+1]],8));case 1:g=f(g,[0,t[b]]),g=u(g,y),g=h(g,31),g=u(g,w),a=f(a,g)}return a=f(a,[0,t.length]),c=f(c,[0,t.length]),a=l(a,c),c=l(c,a),a=p(a),c=p(c),a=l(a,c),c=l(c,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(c[0]>>>0).toString(16)).slice(-8)+("00000000"+(c[1]>>>0).toString(16)).slice(-8)},t.exports&&(e=t.exports=i),e.murmurHash3=i})()},2163:function(t){"use strict";function e(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}t.exports=function(t){var n=void 0,r=void 0;function i(t){if(!(t instanceof Object))throw new Error('Target "'+t+'" is not an object');r=t}function s(t){Object.keys(t).forEach((function(e){var n=t[e];if("function"!==typeof n)throw new Error('Trap "'+e+": "+n+'" is not a function');if(!Reflect[e])throw new Error('Trap "'+e+": "+n+'" is not a valid trap')})),n=t}i((function(){})),t&&i(t),s(Reflect);var o=new Proxy({},{get:function(t,i){return function(){for(var t=arguments.length,s=Array(t),o=0;o<t;o++)s[o]=arguments[o];return n[i].apply(null,[r].concat(e(s.slice(1))))}}});return{setTarget:i,setHandler:s,getTarget:function(){return r},getHandler:function(){return n},proxy:new Proxy(r,o)}}},2346:function(t,e,n){n(7658),function(){var t,n,r,i,s,o,a,c;c=function(t){var e,n,r,i;return e=(t&255<<24)>>>24,n=(t&255<<16)>>>16,r=(65280&t)>>>8,i=255&t,[e,n,r,i].join(".")},a=function(t){var e,r,i,s,o,a;for(e=[],i=s=0;s<=3;i=++s){if(0===t.length)break;if(i>0){if("."!==t[0])throw new Error("Invalid IP");t=t.substring(1)}a=n(t),o=a[0],r=a[1],t=t.substring(r),e.push(o)}if(0!==t.length)throw new Error("Invalid IP");switch(e.length){case 1:if(e[0]>4294967295)throw new Error("Invalid IP");return e[0]>>>0;case 2:if(e[0]>255||e[1]>16777215)throw new Error("Invalid IP");return(e[0]<<24|e[1])>>>0;case 3:if(e[0]>255||e[1]>255||e[2]>65535)throw new Error("Invalid IP");return(e[0]<<24|e[1]<<16|e[2])>>>0;case 4:if(e[0]>255||e[1]>255||e[2]>255||e[3]>255)throw new Error("Invalid IP");return(e[0]<<24|e[1]<<16|e[2]<<8|e[3])>>>0;default:throw new Error("Invalid IP")}},r=function(t){return t.charCodeAt(0)},i=r("0"),o=r("a"),s=r("A"),n=function(t){var e,n,a,c,l;c=0,e=10,n="9",a=0,t.length>1&&"0"===t[a]&&("x"===t[a+1]||"X"===t[a+1]?(a+=2,e=16):"0"<=t[a+1]&&t[a+1]<="9"&&(a++,e=8,n="7")),l=a;while(a<t.length){if("0"<=t[a]&&t[a]<=n)c=c*e+(r(t[a])-i)>>>0;else{if(16!==e)break;if("a"<=t[a]&&t[a]<="f")c=c*e+(10+r(t[a])-o)>>>0;else{if(!("A"<=t[a]&&t[a]<="F"))break;c=c*e+(10+r(t[a])-s)>>>0}}if(c>4294967295)throw new Error("too large");a++}if(a===l)throw new Error("empty octet");return[c,a]},t=function(){function t(t,e){var n,r,i;if("string"!==typeof t)throw new Error("Missing `net' parameter");if(e||(i=t.split("/",2),t=i[0],e=i[1]),e||(e=32),"string"===typeof e&&e.indexOf(".")>-1){try{this.maskLong=a(e)}catch(s){throw s,new Error("Invalid mask: "+e)}for(n=r=32;r>=0;n=--r)if(this.maskLong===4294967295<<32-n>>>0){this.bitmask=n;break}}else{if(!e&&0!==e)throw new Error("Invalid mask: empty");this.bitmask=parseInt(e,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(t)&this.maskLong)>>>0}catch(s){throw s,new Error("Invalid net address: "+t)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+e);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return t.prototype.contains=function(e){return"string"===typeof e&&(e.indexOf("/")>0||4!==e.split(".").length)&&(e=new t(e)),e instanceof t?this.contains(e.base)&&this.contains(e.broadcast||e.last):(a(e)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},t.prototype.next=function(e){return null==e&&(e=1),new t(c(this.netLong+this.size*e),this.mask)},t.prototype.forEach=function(t){var e,n,r;r=a(this.first),n=a(this.last),e=0;while(r<=n)t(c(r),r,e),e++,r++},t.prototype.toString=function(){return this.base+"/"+this.bitmask},t}(),e.ip2long=a,e.long2ip=c,e.Netmask=t}.call(this)},6509:function(t,e,n){n(7658);var r=n(6143);function i(t,e){var n=function(){return new r.aes.Algorithm(t,e)};r.cipher.registerAlgorithm(t,n)}n(4403),n(2377),n(8666),t.exports=r.aes=r.aes||{},r.aes.startEncrypting=function(t,e,n,r){var i=g({key:t,output:n,decrypt:!1,mode:r});return i.start(e),i},r.aes.createEncryptionCipher=function(t,e){return g({key:t,output:null,decrypt:!1,mode:e})},r.aes.startDecrypting=function(t,e,n,r){var i=g({key:t,output:n,decrypt:!0,mode:r});return i.start(e),i},r.aes.createDecryptionCipher=function(t,e){return g({key:t,output:null,decrypt:!0,mode:e})},r.aes.Algorithm=function(t,e){u||d();var n=this;n.name=t,n.mode=new e({blockSize:16,cipher:{encrypt:function(t,e){return p(n._w,t,e,!1)},decrypt:function(t,e){return p(n._w,t,e,!0)}}}),n._init=!1},r.aes.Algorithm.prototype.initialize=function(t){if(!this._init){var e,n=t.key;if("string"!==typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(r.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){e=n,n=r.util.createBuffer();for(var i=0;i<e.length;++i)n.putByte(e[i])}}else n=r.util.createBuffer(n);if(!r.util.isArray(n)){e=n,n=[];var s=e.length();if(16===s||24===s||32===s){s>>>=2;for(i=0;i<s;++i)n.push(e.getInt32())}}if(!r.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var o=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=f(n,t.decrypt&&!a),this._init=!0}},r.aes._expandKey=function(t,e){return u||d(),f(t,e)},r.aes._updateBlock=p,i("AES-ECB",r.cipher.modes.ecb),i("AES-CBC",r.cipher.modes.cbc),i("AES-CFB",r.cipher.modes.cfb),i("AES-OFB",r.cipher.modes.ofb),i("AES-CTR",r.cipher.modes.ctr),i("AES-GCM",r.cipher.modes.gcm);var s,o,a,c,l,u=!1,h=4;function d(){u=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var t=new Array(256),e=0;e<128;++e)t[e]=e<<1,t[e+128]=e+128<<1^283;s=new Array(256),o=new Array(256),c=new Array(4),l=new Array(4);for(e=0;e<4;++e)c[e]=new Array(256),l[e]=new Array(256);var n,r,i,h,d,f,p,g=0,m=0;for(e=0;e<256;++e){h=m^m<<1^m<<2^m<<3^m<<4,h=h>>8^255&h^99,s[g]=h,o[h]=g,d=t[h],n=t[g],r=t[n],i=t[r],f=d<<24^h<<16^h<<8^h^d,p=(n^r^i)<<24^(g^i)<<16^(g^r^i)<<8^g^n^i;for(var y=0;y<4;++y)c[y][g]=f,l[y][h]=p,f=f<<24|f>>>8,p=p<<24|p>>>8;0===g?g=m=1:(g=n^t[t[t[n^i]]],m^=t[t[m]])}}function f(t,e){for(var n,r=t.slice(0),i=1,o=r.length,c=o+6+1,u=h*c,d=o;d<u;++d)n=r[d-1],d%o===0?(n=s[n>>>16&255]<<24^s[n>>>8&255]<<16^s[255&n]<<8^s[n>>>24]^a[i]<<24,i++):o>6&&d%o===4&&(n=s[n>>>24]<<24^s[n>>>16&255]<<16^s[n>>>8&255]<<8^s[255&n]),r[d]=r[d-o]^n;if(e){var f,p=l[0],g=l[1],m=l[2],y=l[3],w=r.slice(0);u=r.length;d=0;for(var b=u-h;d<u;d+=h,b-=h)if(0===d||d===u-h)w[d]=r[b],w[d+1]=r[b+3],w[d+2]=r[b+2],w[d+3]=r[b+1];else for(var v=0;v<h;++v)f=r[b+v],w[d+(3&-v)]=p[s[f>>>24]]^g[s[f>>>16&255]]^m[s[f>>>8&255]]^y[s[255&f]];r=w}return r}function p(t,e,n,r){var i,a,u,h,d,f,p,g,m,y,w,b,v=t.length/4-1;r?(i=l[0],a=l[1],u=l[2],h=l[3],d=o):(i=c[0],a=c[1],u=c[2],h=c[3],d=s),f=e[0]^t[0],p=e[r?3:1]^t[1],g=e[2]^t[2],m=e[r?1:3]^t[3];for(var E=3,_=1;_<v;++_)y=i[f>>>24]^a[p>>>16&255]^u[g>>>8&255]^h[255&m]^t[++E],w=i[p>>>24]^a[g>>>16&255]^u[m>>>8&255]^h[255&f]^t[++E],b=i[g>>>24]^a[m>>>16&255]^u[f>>>8&255]^h[255&p]^t[++E],m=i[m>>>24]^a[f>>>16&255]^u[p>>>8&255]^h[255&g]^t[++E],f=y,p=w,g=b;n[0]=d[f>>>24]<<24^d[p>>>16&255]<<16^d[g>>>8&255]<<8^d[255&m]^t[++E],n[r?3:1]=d[p>>>24]<<24^d[g>>>16&255]<<16^d[m>>>8&255]<<8^d[255&f]^t[++E],n[2]=d[g>>>24]<<24^d[m>>>16&255]<<16^d[f>>>8&255]<<8^d[255&p]^t[++E],n[r?1:3]=d[m>>>24]<<24^d[f>>>16&255]<<16^d[p>>>8&255]<<8^d[255&g]^t[++E]}function g(t){t=t||{};var e,n=(t.mode||"CBC").toUpperCase(),i="AES-"+n;e=t.decrypt?r.cipher.createDecipher(i,t.key):r.cipher.createCipher(i,t.key);var s=e.start;return e.start=function(t,n){var i=null;n instanceof r.util.ByteBuffer&&(i=n,n={}),n=n||{},n.output=i,n.iv=t,s.call(e,n)},e}},3655:function(t,e,n){n(7658);var r=n(6143);n(8666),n(5828);var i=t.exports=r.asn1=r.asn1||{};function s(t,e,n){if(n>e){var r=new Error("Too few bytes to parse DER.");throw r.available=t.length(),r.remaining=e,r.requested=n,r}}i.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},i.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},i.create=function(t,e,n,s,o){if(r.util.isArray(s)){for(var a=[],c=0;c<s.length;++c)void 0!==s[c]&&a.push(s[c]);s=a}var l={tagClass:t,type:e,constructed:n,composed:n||r.util.isArray(s),value:s};return o&&"bitStringContents"in o&&(l.bitStringContents=o.bitStringContents,l.original=i.copy(l)),l},i.copy=function(t,e){var n;if(r.util.isArray(t)){n=[];for(var s=0;s<t.length;++s)n.push(i.copy(t[s],e));return n}return"string"===typeof t?t:(n={tagClass:t.tagClass,type:t.type,constructed:t.constructed,composed:t.composed,value:i.copy(t.value,e)},e&&!e.excludeBitStringContents&&(n.bitStringContents=t.bitStringContents),n)},i.equals=function(t,e,n){if(r.util.isArray(t)){if(!r.util.isArray(e))return!1;if(t.length!==e.length)return!1;for(var s=0;s<t.length;++s)if(!i.equals(t[s],e[s]))return!1;return!0}if(typeof t!==typeof e)return!1;if("string"===typeof t)return t===e;var o=t.tagClass===e.tagClass&&t.type===e.type&&t.constructed===e.constructed&&t.composed===e.composed&&i.equals(t.value,e.value);return n&&n.includeBitStringContents&&(o=o&&t.bitStringContents===e.bitStringContents),o},i.getBerValueLength=function(t){var e=t.getByte();if(128!==e){var n,r=128&e;return n=r?t.getInt((127&e)<<3):e,n}};var o=function(t,e){var n=t.getByte();if(e--,128!==n){var r,i=128&n;if(i){var o=127&n;s(t,e,o),r=t.getInt(o<<3)}else r=n;if(r<0)throw new Error("Negative length: "+r);return r}};function a(t,e,n,r){var c;s(t,e,2);var l=t.getByte();e--;var u=192&l,h=31&l;c=t.length();var d,f,p=o(t,e);if(e-=c-t.length(),void 0!==p&&p>e){if(r.strict){var g=new Error("Too few bytes to read ASN.1 value.");throw g.available=t.length(),g.remaining=e,g.requested=p,g}p=e}var m=32===(32&l);if(m)if(d=[],void 0===p)for(;;){if(s(t,e,2),t.bytes(2)===String.fromCharCode(0,0)){t.getBytes(2),e-=2;break}c=t.length(),d.push(a(t,e,n+1,r)),e-=c-t.length()}else while(p>0)c=t.length(),d.push(a(t,p,n+1,r)),e-=c-t.length(),p-=c-t.length();if(void 0===d&&u===i.Class.UNIVERSAL&&h===i.Type.BITSTRING&&(f=t.bytes(p)),void 0===d&&r.decodeBitStrings&&u===i.Class.UNIVERSAL&&h===i.Type.BITSTRING&&p>1){var y=t.read,w=e,b=0;if(h===i.Type.BITSTRING&&(s(t,e,1),b=t.getByte(),e--),0===b)try{c=t.length();var v={strict:!0,decodeBitStrings:!0},E=a(t,e,n+1,v),_=c-t.length();e-=_,h==i.Type.BITSTRING&&_++;var S=E.tagClass;_!==p||S!==i.Class.UNIVERSAL&&S!==i.Class.CONTEXT_SPECIFIC||(d=[E])}catch(C){}void 0===d&&(t.read=y,e=w)}if(void 0===d){if(void 0===p){if(r.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");p=e}if(h===i.Type.BMPSTRING)for(d="";p>0;p-=2)s(t,e,2),d+=String.fromCharCode(t.getInt16()),e-=2;else d=t.getBytes(p),e-=p}var A=void 0===f?null:{bitStringContents:f};return i.create(u,h,m,d,A)}i.fromDer=function(t,e){void 0===e&&(e={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"===typeof e&&(e={strict:e,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in e||(e.strict=!0),"parseAllBytes"in e||(e.parseAllBytes=!0),"decodeBitStrings"in e||(e.decodeBitStrings=!0),"string"===typeof t&&(t=r.util.createBuffer(t));var n=t.length(),i=a(t,t.length(),0,e);if(e.parseAllBytes&&0!==t.length()){var s=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw s.byteCount=n,s.remaining=t.length(),s}return i},i.toDer=function(t){var e=r.util.createBuffer(),n=t.tagClass|t.type,s=r.util.createBuffer(),o=!1;if("bitStringContents"in t&&(o=!0,t.original&&(o=i.equals(t,t.original))),o)s.putBytes(t.bitStringContents);else if(t.composed){t.constructed?n|=32:s.putByte(0);for(var a=0;a<t.value.length;++a)void 0!==t.value[a]&&s.putBuffer(i.toDer(t.value[a]))}else if(t.type===i.Type.BMPSTRING)for(a=0;a<t.value.length;++a)s.putInt16(t.value.charCodeAt(a));else t.type===i.Type.INTEGER&&t.value.length>1&&(0===t.value.charCodeAt(0)&&0===(128&t.value.charCodeAt(1))||255===t.value.charCodeAt(0)&&128===(128&t.value.charCodeAt(1)))?s.putBytes(t.value.substr(1)):s.putBytes(t.value);if(e.putByte(n),s.length()<=127)e.putByte(127&s.length());else{var c=s.length(),l="";do{l+=String.fromCharCode(255&c),c>>>=8}while(c>0);e.putByte(128|l.length);for(a=l.length-1;a>=0;--a)e.putByte(l.charCodeAt(a))}return e.putBuffer(s),e},i.oidToDer=function(t){var e,n,i,s,o=t.split("."),a=r.util.createBuffer();a.putByte(40*parseInt(o[0],10)+parseInt(o[1],10));for(var c=2;c<o.length;++c){e=!0,n=[],i=parseInt(o[c],10);do{s=127&i,i>>>=7,e||(s|=128),n.push(s),e=!1}while(i>0);for(var l=n.length-1;l>=0;--l)a.putByte(n[l])}return a},i.derToOid=function(t){var e;"string"===typeof t&&(t=r.util.createBuffer(t));var n=t.getByte();e=Math.floor(n/40)+"."+n%40;var i=0;while(t.length()>0)n=t.getByte(),i<<=7,128&n?i+=127&n:(e+="."+(i+n),i=0);return e},i.utcTimeToDate=function(t){var e=new Date,n=parseInt(t.substr(0,2),10);n=n>=50?1900+n:2e3+n;var r=parseInt(t.substr(2,2),10)-1,i=parseInt(t.substr(4,2),10),s=parseInt(t.substr(6,2),10),o=parseInt(t.substr(8,2),10),a=0;if(t.length>11){var c=t.charAt(10),l=10;"+"!==c&&"-"!==c&&(a=parseInt(t.substr(10,2),10),l+=2)}if(e.setUTCFullYear(n,r,i),e.setUTCHours(s,o,a,0),l&&(c=t.charAt(l),"+"===c||"-"===c)){var u=parseInt(t.substr(l+1,2),10),h=parseInt(t.substr(l+4,2),10),d=60*u+h;d*=6e4,"+"===c?e.setTime(+e-d):e.setTime(+e+d)}return e},i.generalizedTimeToDate=function(t){var e=new Date,n=parseInt(t.substr(0,4),10),r=parseInt(t.substr(4,2),10)-1,i=parseInt(t.substr(6,2),10),s=parseInt(t.substr(8,2),10),o=parseInt(t.substr(10,2),10),a=parseInt(t.substr(12,2),10),c=0,l=0,u=!1;"Z"===t.charAt(t.length-1)&&(u=!0);var h=t.length-5,d=t.charAt(h);if("+"===d||"-"===d){var f=parseInt(t.substr(h+1,2),10),p=parseInt(t.substr(h+4,2),10);l=60*f+p,l*=6e4,"+"===d&&(l*=-1),u=!0}return"."===t.charAt(14)&&(c=1e3*parseFloat(t.substr(14),10)),u?(e.setUTCFullYear(n,r,i),e.setUTCHours(s,o,a,c),e.setTime(+e+l)):(e.setFullYear(n,r,i),e.setHours(s,o,a,c)),e},i.dateToUtcTime=function(t){if("string"===typeof t)return t;var e="",n=[];n.push((""+t.getUTCFullYear()).substr(2)),n.push(""+(t.getUTCMonth()+1)),n.push(""+t.getUTCDate()),n.push(""+t.getUTCHours()),n.push(""+t.getUTCMinutes()),n.push(""+t.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(e+="0"),e+=n[r];return e+="Z",e},i.dateToGeneralizedTime=function(t){if("string"===typeof t)return t;var e="",n=[];n.push(""+t.getUTCFullYear()),n.push(""+(t.getUTCMonth()+1)),n.push(""+t.getUTCDate()),n.push(""+t.getUTCHours()),n.push(""+t.getUTCMinutes()),n.push(""+t.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(e+="0"),e+=n[r];return e+="Z",e},i.integerToDer=function(t){var e=r.util.createBuffer();if(t>=-128&&t<128)return e.putSignedInt(t,8);if(t>=-32768&&t<32768)return e.putSignedInt(t,16);if(t>=-8388608&&t<8388608)return e.putSignedInt(t,24);if(t>=-2147483648&&t<2147483648)return e.putSignedInt(t,32);var n=new Error("Integer too large; max is 32-bits.");throw n.integer=t,n},i.derToInteger=function(t){"string"===typeof t&&(t=r.util.createBuffer(t));var e=8*t.length();if(e>32)throw new Error("Integer too large; max is 32-bits.");return t.getSignedInt(e)},i.validate=function(t,e,n,s){var o=!1;if(t.tagClass!==e.tagClass&&"undefined"!==typeof e.tagClass||t.type!==e.type&&"undefined"!==typeof e.type)s&&(t.tagClass!==e.tagClass&&s.push("["+e.name+'] Expected tag class "'+e.tagClass+'", got "'+t.tagClass+'"'),t.type!==e.type&&s.push("["+e.name+'] Expected type "'+e.type+'", got "'+t.type+'"'));else if(t.constructed===e.constructed||"undefined"===typeof e.constructed){if(o=!0,e.value&&r.util.isArray(e.value))for(var a=0,c=0;o&&c<e.value.length;++c)o=e.value[c].optional||!1,t.value[a]&&(o=i.validate(t.value[a],e.value[c],n,s),o?++a:e.value[c].optional&&(o=!0)),!o&&s&&s.push("["+e.name+'] Tag class "'+e.tagClass+'", type "'+e.type+'" expected value length "'+e.value.length+'", got "'+t.value.length+'"');if(o&&n)if(e.capture&&(n[e.capture]=t.value),e.captureAsn1&&(n[e.captureAsn1]=t),e.captureBitStringContents&&"bitStringContents"in t&&(n[e.captureBitStringContents]=t.bitStringContents),e.captureBitStringValue&&"bitStringContents"in t)if(t.bitStringContents.length<2)n[e.captureBitStringValue]="";else{var l=t.bitStringContents.charCodeAt(0);if(0!==l)throw new Error("captureBitStringValue only supported for zero unused bits");n[e.captureBitStringValue]=t.bitStringContents.slice(1)}}else s&&s.push("["+e.name+'] Expected constructed "'+e.constructed+'", got "'+t.constructed+'"');return o};var c=/[^\\u0000-\\u00ff]/;i.prettyPrint=function(t,e,n){var s="";e=e||0,n=n||2,e>0&&(s+="\n");for(var o="",a=0;a<e*n;++a)o+=" ";switch(s+=o+"Tag: ",t.tagClass){case i.Class.UNIVERSAL:s+="Universal:";break;case i.Class.APPLICATION:s+="Application:";break;case i.Class.CONTEXT_SPECIFIC:s+="Context-Specific:";break;case i.Class.PRIVATE:s+="Private:";break}if(t.tagClass===i.Class.UNIVERSAL)switch(s+=t.type,t.type){case i.Type.NONE:s+=" (None)";break;case i.Type.BOOLEAN:s+=" (Boolean)";break;case i.Type.INTEGER:s+=" (Integer)";break;case i.Type.BITSTRING:s+=" (Bit string)";break;case i.Type.OCTETSTRING:s+=" (Octet string)";break;case i.Type.NULL:s+=" (Null)";break;case i.Type.OID:s+=" (Object Identifier)";break;case i.Type.ODESC:s+=" (Object Descriptor)";break;case i.Type.EXTERNAL:s+=" (External or Instance of)";break;case i.Type.REAL:s+=" (Real)";break;case i.Type.ENUMERATED:s+=" (Enumerated)";break;case i.Type.EMBEDDED:s+=" (Embedded PDV)";break;case i.Type.UTF8:s+=" (UTF8)";break;case i.Type.ROID:s+=" (Relative Object Identifier)";break;case i.Type.SEQUENCE:s+=" (Sequence)";break;case i.Type.SET:s+=" (Set)";break;case i.Type.PRINTABLESTRING:s+=" (Printable String)";break;case i.Type.IA5String:s+=" (IA5String (ASCII))";break;case i.Type.UTCTIME:s+=" (UTC time)";break;case i.Type.GENERALIZEDTIME:s+=" (Generalized time)";break;case i.Type.BMPSTRING:s+=" (BMP String)";break}else s+=t.type;if(s+="\n",s+=o+"Constructed: "+t.constructed+"\n",t.composed){var l=0,u="";for(a=0;a<t.value.length;++a)void 0!==t.value[a]&&(l+=1,u+=i.prettyPrint(t.value[a],e+1,n),a+1<t.value.length&&(u+=","));s+=o+"Sub values: "+l+u}else{if(s+=o+"Value: ",t.type===i.Type.OID){var h=i.derToOid(t.value);s+=h,r.pki&&r.pki.oids&&h in r.pki.oids&&(s+=" ("+r.pki.oids[h]+") ")}if(t.type===i.Type.INTEGER)try{s+=i.derToInteger(t.value)}catch(f){s+="0x"+r.util.bytesToHex(t.value)}else if(t.type===i.Type.BITSTRING){if(t.value.length>1?s+="0x"+r.util.bytesToHex(t.value.slice(1)):s+="(none)",t.value.length>0){var d=t.value.charCodeAt(0);1==d?s+=" (1 unused bit shown)":d>1&&(s+=" ("+d+" unused bits shown)")}}else if(t.type===i.Type.OCTETSTRING)c.test(t.value)||(s+="("+t.value+") "),s+="0x"+r.util.bytesToHex(t.value);else if(t.type===i.Type.UTF8)try{s+=r.util.decodeUtf8(t.value)}catch(p){if("URI malformed"!==p.message)throw p;s+="0x"+r.util.bytesToHex(t.value)+" (malformed UTF8)"}else t.type===i.Type.PRINTABLESTRING||t.type===i.Type.IA5String?s+=t.value:c.test(t.value)?s+="0x"+r.util.bytesToHex(t.value):0===t.value.length?s+="[null]":s+=t.value}return s}},3441:function(t,e,n){n(3767),n(8585),n(8696),n(7658);var r={};t.exports=r;var i={};function s(t,e){var n=0,r=e.length,i=e.charAt(0),s=[0];for(n=0;n<t.length();++n){for(var o=0,a=t.at(n);o<s.length;++o)a+=s[o]<<8,s[o]=a%r,a=a/r|0;while(a>0)s.push(a%r),a=a/r|0}var c="";for(n=0;0===t.at(n)&&n<t.length()-1;++n)c+=i;for(n=s.length-1;n>=0;--n)c+=e[s[n]];return c}r.encode=function(t,e,n){if("string"!==typeof e)throw new TypeError('"alphabet" must be a string.');if(void 0!==n&&"number"!==typeof n)throw new TypeError('"maxline" must be a number.');var r="";if(t instanceof Uint8Array){var i=0,o=e.length,a=e.charAt(0),c=[0];for(i=0;i<t.length;++i){for(var l=0,u=t[i];l<c.length;++l)u+=c[l]<<8,c[l]=u%o,u=u/o|0;while(u>0)c.push(u%o),u=u/o|0}for(i=0;0===t[i]&&i<t.length-1;++i)r+=a;for(i=c.length-1;i>=0;--i)r+=e[c[i]]}else r=s(t,e);if(n){var h=new RegExp(".{1,"+n+"}","g");r=r.match(h).join("\r\n")}return r},r.decode=function(t,e){if("string"!==typeof t)throw new TypeError('"input" must be a string.');if("string"!==typeof e)throw new TypeError('"alphabet" must be a string.');var n=i[e];if(!n){n=i[e]=[];for(var r=0;r<e.length;++r)n[e.charCodeAt(r)]=r}t=t.replace(/\s/g,"");var s=e.length,o=e.charAt(0),a=[0];for(r=0;r<t.length;r++){var c=n[t.charCodeAt(r)];if(void 0===c)return;for(var l=0,u=c;l<a.length;++l)u+=a[l]*s,a[l]=255&u,u>>=8;while(u>0)a.push(255&u),u>>=8}for(var h=0;t[h]===o&&h<t.length-1;++h)a.push(0);return"undefined"!==typeof Buffer?Buffer.from(a.reverse()):new Uint8Array(a.reverse())}},4403:function(t,e,n){var r=n(6143);n(8666),t.exports=r.cipher=r.cipher||{},r.cipher.algorithms=r.cipher.algorithms||{},r.cipher.createCipher=function(t,e){var n=t;if("string"===typeof n&&(n=r.cipher.getAlgorithm(n),n&&(n=n())),!n)throw new Error("Unsupported algorithm: "+t);return new r.cipher.BlockCipher({algorithm:n,key:e,decrypt:!1})},r.cipher.createDecipher=function(t,e){var n=t;if("string"===typeof n&&(n=r.cipher.getAlgorithm(n),n&&(n=n())),!n)throw new Error("Unsupported algorithm: "+t);return new r.cipher.BlockCipher({algorithm:n,key:e,decrypt:!0})},r.cipher.registerAlgorithm=function(t,e){t=t.toUpperCase(),r.cipher.algorithms[t]=e},r.cipher.getAlgorithm=function(t){return t=t.toUpperCase(),t in r.cipher.algorithms?r.cipher.algorithms[t]:null};var i=r.cipher.BlockCipher=function(t){this.algorithm=t.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=t.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=t.decrypt,this.algorithm.initialize(t)};i.prototype.start=function(t){t=t||{};var e={};for(var n in t)e[n]=t[n];e.decrypt=this._decrypt,this._finish=!1,this._input=r.util.createBuffer(),this.output=t.output||r.util.createBuffer(),this.mode.start(e)},i.prototype.update=function(t){t&&this._input.putBuffer(t);while(!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish);this._input.compact()},i.prototype.finish=function(t){!t||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(e){return t(this.blockSize,e,!1)},this.mode.unpad=function(e){return t(this.blockSize,e,!0)});var e={};return e.decrypt=this._decrypt,e.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,e))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,e))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,e)))}},2377:function(t,e,n){n(7658);var r=n(6143);n(8666),r.cipher=r.cipher||{};var i=t.exports=r.cipher.modes=r.cipher.modes||{};function s(t,e){if("string"===typeof t&&(t=r.util.createBuffer(t)),r.util.isArray(t)&&t.length>4){var n=t;t=r.util.createBuffer();for(var i=0;i<n.length;++i)t.putByte(n[i])}if(t.length()<e)throw new Error("Invalid IV length; got "+t.length()+" bytes and expected "+e+" bytes.");if(!r.util.isArray(t)){var s=[],o=e/4;for(i=0;i<o;++i)s.push(t.getInt32());t=s}return t}function o(t){t[t.length-1]=t[t.length-1]+1&4294967295}function a(t){return[t/4294967296|0,4294967295&t]}i.ecb=function(t){t=t||{},this.name="ECB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.ecb.prototype.start=function(t){},i.ecb.prototype.encrypt=function(t,e,n){if(t.length()<this.blockSize&&!(n&&t.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)e.putInt32(this._outBlock[r])},i.ecb.prototype.decrypt=function(t,e,n){if(t.length()<this.blockSize&&!(n&&t.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)e.putInt32(this._outBlock[r])},i.ecb.prototype.pad=function(t,e){var n=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(n,n),!0},i.ecb.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var n=t.length(),r=t.at(n-1);return!(r>this.blockSize<<2)&&(t.truncate(r),!0)},i.cbc=function(t){t=t||{},this.name="CBC",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},i.cbc.prototype.start=function(t){if(null===t.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=s(t.iv,this.blockSize),this._prev=this._iv.slice(0)}},i.cbc.prototype.encrypt=function(t,e,n){if(t.length()<this.blockSize&&!(n&&t.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=this._prev[r]^t.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)e.putInt32(this._outBlock[r]);this._prev=this._outBlock},i.cbc.prototype.decrypt=function(t,e,n){if(t.length()<this.blockSize&&!(n&&t.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=t.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)e.putInt32(this._prev[r]^this._outBlock[r]);this._prev=this._inBlock.slice(0)},i.cbc.prototype.pad=function(t,e){var n=t.length()===this.blockSize?this.blockSize:this.blockSize-t.length();return t.fillWithByte(n,n),!0},i.cbc.prototype.unpad=function(t,e){if(e.overflow>0)return!1;var n=t.length(),r=t.at(n-1);return!(r>this.blockSize<<2)&&(t.truncate(r),!0)},i.cfb=function(t){t=t||{},this.name="CFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},i.cfb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=s(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.cfb.prototype.encrypt=function(t,e,n){var r=t.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=t.getInt32()^this._outBlock[i],e.putInt32(this._inBlock[i]);else{var s=(this.blockSize-r)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=t.getInt32()^this._outBlock[i],this._partialOutput.putInt32(this._partialBlock[i]);if(s>0)t.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!n)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},i.cfb.prototype.decrypt=function(t,e,n){var r=t.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)this._inBlock[i]=t.getInt32(),e.putInt32(this._inBlock[i]^this._outBlock[i]);else{var s=(this.blockSize-r)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialBlock[i]=t.getInt32(),this._partialOutput.putInt32(this._partialBlock[i]^this._outBlock[i]);if(s>0)t.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._partialBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!n)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},i.ofb=function(t){t=t||{},this.name="OFB",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},i.ofb.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=s(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ofb.prototype.encrypt=function(t,e,n){var r=t.length();if(0===t.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(t.getInt32()^this._outBlock[i]),this._inBlock[i]=this._outBlock[i];else{var s=(this.blockSize-r)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s>0)t.read-=this.blockSize;else for(i=0;i<this._ints;++i)this._inBlock[i]=this._outBlock[i];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!n)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},i.ofb.prototype.decrypt=i.ofb.prototype.encrypt,i.ctr=function(t){t=t||{},this.name="CTR",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},i.ctr.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");this._iv=s(t.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},i.ctr.prototype.encrypt=function(t,e,n){var r=t.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var i=0;i<this._ints;++i)e.putInt32(t.getInt32()^this._outBlock[i]);else{var s=(this.blockSize-r)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s>0&&(t.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!n)return e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}o(this._inBlock)},i.ctr.prototype.decrypt=i.ctr.prototype.encrypt,i.gcm=function(t){t=t||{},this.name="GCM",this.cipher=t.cipher,this.blockSize=t.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0,this._R=3774873600},i.gcm.prototype.start=function(t){if(!("iv"in t))throw new Error("Invalid IV parameter.");var e,n=r.util.createBuffer(t.iv);if(this._cipherLength=0,e="additionalData"in t?r.util.createBuffer(t.additionalData):r.util.createBuffer(),this._tagLength="tagLength"in t?t.tagLength:128,this._tag=null,t.decrypt&&(this._tag=r.util.createBuffer(t.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var i=n.length();if(12===i)this._j0=[n.getInt32(),n.getInt32(),n.getInt32(),1];else{this._j0=[0,0,0,0];while(n.length()>0)this._j0=this.ghash(this._hashSubkey,this._j0,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(a(8*i)))}this._inBlock=this._j0.slice(0),o(this._inBlock),this._partialBytes=0,e=r.util.createBuffer(e),this._aDataLength=a(8*e.length());var s=e.length()%this.blockSize;s&&e.fillWithByte(0,this.blockSize-s),this._s=[0,0,0,0];while(e.length()>0)this._s=this.ghash(this._hashSubkey,this._s,[e.getInt32(),e.getInt32(),e.getInt32(),e.getInt32()])},i.gcm.prototype.encrypt=function(t,e,n){var r=t.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize){for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^=t.getInt32());this._cipherLength+=this.blockSize}else{var s=(this.blockSize-r)%this.blockSize;s>0&&(s=this.blockSize-s),this._partialOutput.clear();for(i=0;i<this._ints;++i)this._partialOutput.putInt32(t.getInt32()^this._outBlock[i]);if(s<=0||n){if(n){var a=r%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(i=0;i<this._ints;++i)this._outBlock[i]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),s>0&&!n)return t.read-=this.blockSize,e.putBytes(this._partialOutput.getBytes(s-this._partialBytes)),this._partialBytes=s,!0;e.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),o(this._inBlock)},i.gcm.prototype.decrypt=function(t,e,n){var r=t.length();if(r<this.blockSize&&!(n&&r>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),o(this._inBlock),this._hashBlock[0]=t.getInt32(),this._hashBlock[1]=t.getInt32(),this._hashBlock[2]=t.getInt32(),this._hashBlock[3]=t.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var i=0;i<this._ints;++i)e.putInt32(this._outBlock[i]^this._hashBlock[i]);r<this.blockSize?this._cipherLength+=r%this.blockSize:this._cipherLength+=this.blockSize},i.gcm.prototype.afterFinish=function(t,e){var n=!0;e.decrypt&&e.overflow&&t.truncate(this.blockSize-e.overflow),this.tag=r.util.createBuffer();var i=this._aDataLength.concat(a(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,i);var s=[];this.cipher.encrypt(this._j0,s);for(var o=0;o<this._ints;++o)this.tag.putInt32(this._s[o]^s[o]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),e.decrypt&&this.tag.bytes()!==this._tag&&(n=!1),n},i.gcm.prototype.multiply=function(t,e){for(var n=[0,0,0,0],r=e.slice(0),i=0;i<128;++i){var s=t[i/32|0]&1<<31-i%32;s&&(n[0]^=r[0],n[1]^=r[1],n[2]^=r[2],n[3]^=r[3]),this.pow(r,r)}return n},i.gcm.prototype.pow=function(t,e){for(var n=1&t[3],r=3;r>0;--r)e[r]=t[r]>>>1|(1&t[r-1])<<31;e[0]=t[0]>>>1,n&&(e[0]^=this._R)},i.gcm.prototype.tableMultiply=function(t){for(var e=[0,0,0,0],n=0;n<32;++n){var r=n/8|0,i=t[r]>>>4*(7-n%8)&15,s=this._m[n][i];e[0]^=s[0],e[1]^=s[1],e[2]^=s[2],e[3]^=s[3]}return e},i.gcm.prototype.ghash=function(t,e,n){return e[0]^=n[0],e[1]^=n[1],e[2]^=n[2],e[3]^=n[3],this.tableMultiply(e)},i.gcm.prototype.generateHashTable=function(t,e){for(var n=8/e,r=4*n,i=16*n,s=new Array(i),o=0;o<i;++o){var a=[0,0,0,0],c=o/r|0,l=(r-1-o%r)*e;a[c]=1<<e-1<<l,s[o]=this.generateSubHashTable(this.multiply(a,t),e)}return s},i.gcm.prototype.generateSubHashTable=function(t,e){var n=1<<e,r=n>>>1,i=new Array(n);i[r]=t.slice(0);var s=r>>>1;while(s>0)this.pow(i[2*s],i[s]=[]),s>>=1;s=2;while(s<r){for(var o=1;o<s;++o){var a=i[s],c=i[o];i[s+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}s*=2}for(i[0]=[0,0,0,0],s=r+1;s<n;++s){var l=i[s^r];i[s]=[t[0]^l[0],t[1]^l[1],t[2]^l[2],t[3]^l[3]]}return i}},1202:function(t,e,n){var r=n(6143);function i(t,e){var n=function(){return new r.des.Algorithm(t,e)};r.cipher.registerAlgorithm(t,n)}n(4403),n(2377),n(8666),t.exports=r.des=r.des||{},r.des.startEncrypting=function(t,e,n,r){var i=g({key:t,output:n,decrypt:!1,mode:r||(null===e?"ECB":"CBC")});return i.start(e),i},r.des.createEncryptionCipher=function(t,e){return g({key:t,output:null,decrypt:!1,mode:e})},r.des.startDecrypting=function(t,e,n,r){var i=g({key:t,output:n,decrypt:!0,mode:r||(null===e?"ECB":"CBC")});return i.start(e),i},r.des.createDecryptionCipher=function(t,e){return g({key:t,output:null,decrypt:!0,mode:e})},r.des.Algorithm=function(t,e){var n=this;n.name=t,n.mode=new e({blockSize:8,cipher:{encrypt:function(t,e){return p(n._keys,t,e,!1)},decrypt:function(t,e){return p(n._keys,t,e,!0)}}}),n._init=!1},r.des.Algorithm.prototype.initialize=function(t){if(!this._init){var e=r.util.createBuffer(t.key);if(0===this.name.indexOf("3DES")&&24!==e.length())throw new Error("Invalid Triple-DES key size: "+8*e.length());this._keys=f(e),this._init=!0}},i("DES-ECB",r.cipher.modes.ecb),i("DES-CBC",r.cipher.modes.cbc),i("DES-CFB",r.cipher.modes.cfb),i("DES-OFB",r.cipher.modes.ofb),i("DES-CTR",r.cipher.modes.ctr),i("3DES-ECB",r.cipher.modes.ecb),i("3DES-CBC",r.cipher.modes.cbc),i("3DES-CFB",r.cipher.modes.cfb),i("3DES-OFB",r.cipher.modes.ofb),i("3DES-CTR",r.cipher.modes.ctr);var s=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],o=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],a=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],c=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],l=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function f(t){for(var e,n=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],i=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],s=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],o=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],f=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],p=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],g=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],m=t.length()>8?3:1,y=[],w=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,v=0;v<m;v++){var E=t.getInt32(),_=t.getInt32();e=252645135&(E>>>4^_),_^=e,E^=e<<4,e=65535&(_>>>-16^E),E^=e,_^=e<<-16,e=858993459&(E>>>2^_),_^=e,E^=e<<2,e=65535&(_>>>-16^E),E^=e,_^=e<<-16,e=1431655765&(E>>>1^_),_^=e,E^=e<<1,e=16711935&(_>>>8^E),E^=e,_^=e<<8,e=1431655765&(E>>>1^_),_^=e,E^=e<<1,e=E<<8|_>>>20&240,E=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=e;for(var S=0;S<w.length;++S){w[S]?(E=E<<2|E>>>26,_=_<<2|_>>>26):(E=E<<1|E>>>27,_=_<<1|_>>>27),E&=-15,_&=-15;var A=n[E>>>28]|r[E>>>24&15]|i[E>>>20&15]|s[E>>>16&15]|o[E>>>12&15]|a[E>>>8&15]|c[E>>>4&15],C=l[_>>>28]|u[_>>>24&15]|h[_>>>20&15]|d[_>>>16&15]|f[_>>>12&15]|p[_>>>8&15]|g[_>>>4&15];e=65535&(C>>>16^A),y[b++]=A^e,y[b++]=C^e<<16}}return y}function p(t,e,n,r){var i,f,p=32===t.length?3:9;i=3===p?r?[30,-2,-2]:[0,32,2]:r?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var g=e[0],m=e[1];f=252645135&(g>>>4^m),m^=f,g^=f<<4,f=65535&(g>>>16^m),m^=f,g^=f<<16,f=858993459&(m>>>2^g),g^=f,m^=f<<2,f=16711935&(m>>>8^g),g^=f,m^=f<<8,f=1431655765&(g>>>1^m),m^=f,g^=f<<1,g=g<<1|g>>>31,m=m<<1|m>>>31;for(var y=0;y<p;y+=3){for(var w=i[y+1],b=i[y+2],v=i[y];v!=w;v+=b){var E=m^t[v],_=(m>>>4|m<<28)^t[v+1];f=g,g=m,m=f^(o[E>>>24&63]|c[E>>>16&63]|u[E>>>8&63]|d[63&E]|s[_>>>24&63]|a[_>>>16&63]|l[_>>>8&63]|h[63&_])}f=g,g=m,m=f}g=g>>>1|g<<31,m=m>>>1|m<<31,f=1431655765&(g>>>1^m),m^=f,g^=f<<1,f=16711935&(m>>>8^g),g^=f,m^=f<<8,f=858993459&(m>>>2^g),g^=f,m^=f<<2,f=65535&(g>>>16^m),m^=f,g^=f<<16,f=252645135&(g>>>4^m),m^=f,g^=f<<4,n[0]=g,n[1]=m}function g(t){t=t||{};var e,n=(t.mode||"CBC").toUpperCase(),i="DES-"+n;e=t.decrypt?r.cipher.createDecipher(i,t.key):r.cipher.createCipher(i,t.key);var s=e.start;return e.start=function(t,n){var i=null;n instanceof r.util.ByteBuffer&&(i=n,n={}),n=n||{},n.output=i,n.iv=t,s.call(e,n)},e}},6143:function(t){t.exports={options:{usePureJavaScript:!1}}},1818:function(t,e,n){var r=n(6143);n(2713),n(8666);var i=t.exports=r.hmac=r.hmac||{};i.create=function(){var t=null,e=null,n=null,i=null,s={start:function(s,o){if(null!==s)if("string"===typeof s){if(s=s.toLowerCase(),!(s in r.md.algorithms))throw new Error('Unknown hash algorithm "'+s+'"');e=r.md.algorithms[s].create()}else e=s;if(null===o)o=t;else{if("string"===typeof o)o=r.util.createBuffer(o);else if(r.util.isArray(o)){var a=o;o=r.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var l=o.length();l>e.blockLength&&(e.start(),e.update(o.bytes()),o=e.digest()),n=r.util.createBuffer(),i=r.util.createBuffer(),l=o.length();for(c=0;c<l;++c){a=o.at(c);n.putByte(54^a),i.putByte(92^a)}if(l<e.blockLength)for(a=e.blockLength-l,c=0;c<a;++c)n.putByte(54),i.putByte(92);t=o,n=n.bytes(),i=i.bytes()}e.start(),e.update(n)},update:function(t){e.update(t)},getMac:function(){var t=e.digest().bytes();return e.start(),e.update(i),e.update(t),e.digest()}};return s.digest=s.getMac,s}},3322:function(t,e,n){var r,i=n(6143);t.exports=i.jsbn=i.jsbn||{};var s=0xdeadbeefcafe,o=15715070==(16777215&s);function a(t,e,n){this.data=[],null!=t&&("number"==typeof t?this.fromNumber(t,e,n):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}function c(){return new a(null)}function l(t,e,n,r,i,s){while(--s>=0){var o=e*this.data[t++]+n.data[r]+i;i=Math.floor(o/67108864),n.data[r++]=67108863&o}return i}function u(t,e,n,r,i,s){var o=32767&e,a=e>>15;while(--s>=0){var c=32767&this.data[t],l=this.data[t++]>>15,u=a*c+l*o;c=o*c+((32767&u)<<15)+n.data[r]+(1073741823&i),i=(c>>>30)+(u>>>15)+a*l+(i>>>30),n.data[r++]=1073741823&c}return i}function h(t,e,n,r,i,s){var o=16383&e,a=e>>14;while(--s>=0){var c=16383&this.data[t],l=this.data[t++]>>14,u=a*c+l*o;c=o*c+((16383&u)<<14)+n.data[r]+i,i=(c>>28)+(u>>14)+a*l,n.data[r++]=268435455&c}return i}i.jsbn.BigInteger=a,"undefined"===typeof navigator?(a.prototype.am=h,r=28):o&&"Microsoft Internet Explorer"==navigator.appName?(a.prototype.am=u,r=30):o&&"Netscape"!=navigator.appName?(a.prototype.am=l,r=26):(a.prototype.am=h,r=28),a.prototype.DB=r,a.prototype.DM=(1<<r)-1,a.prototype.DV=1<<r;var d=52;a.prototype.FV=Math.pow(2,d),a.prototype.F1=d-r,a.prototype.F2=2*r-d;var f,p,g="0123456789abcdefghijklmnopqrstuvwxyz",m=new Array;for(f="0".charCodeAt(0),p=0;p<=9;++p)m[f++]=p;for(f="a".charCodeAt(0),p=10;p<36;++p)m[f++]=p;for(f="A".charCodeAt(0),p=10;p<36;++p)m[f++]=p;function y(t){return g.charAt(t)}function w(t,e){var n=m[t.charCodeAt(e)];return null==n?-1:n}function b(t){for(var e=this.t-1;e>=0;--e)t.data[e]=this.data[e];t.t=this.t,t.s=this.s}function v(t){this.t=1,this.s=t<0?-1:0,t>0?this.data[0]=t:t<-1?this.data[0]=t+this.DV:this.t=0}function E(t){var e=c();return e.fromInt(t),e}function _(t,e){var n;if(16==e)n=4;else if(8==e)n=3;else if(256==e)n=8;else if(2==e)n=1;else if(32==e)n=5;else{if(4!=e)return void this.fromRadix(t,e);n=2}this.t=0,this.s=0;var r=t.length,i=!1,s=0;while(--r>=0){var o=8==n?255&t[r]:w(t,r);o<0?"-"==t.charAt(r)&&(i=!0):(i=!1,0==s?this.data[this.t++]=o:s+n>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-s)-1)<<s,this.data[this.t++]=o>>this.DB-s):this.data[this.t-1]|=o<<s,s+=n,s>=this.DB&&(s-=this.DB))}8==n&&0!=(128&t[0])&&(this.s=-1,s>0&&(this.data[this.t-1]|=(1<<this.DB-s)-1<<s)),this.clamp(),i&&a.ZERO.subTo(this,this)}function S(){var t=this.s&this.DM;while(this.t>0&&this.data[this.t-1]==t)--this.t}function A(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var n,r=(1<<e)-1,i=!1,s="",o=this.t,a=this.DB-o*this.DB%e;if(o-- >0){a<this.DB&&(n=this.data[o]>>a)>0&&(i=!0,s=y(n));while(o>=0)a<e?(n=(this.data[o]&(1<<a)-1)<<e-a,n|=this.data[--o]>>(a+=this.DB-e)):(n=this.data[o]>>(a-=e)&r,a<=0&&(a+=this.DB,--o)),n>0&&(i=!0),i&&(s+=y(n))}return i?s:"0"}function C(){var t=c();return a.ZERO.subTo(this,t),t}function I(){return this.s<0?this.negate():this}function T(t){var e=this.s-t.s;if(0!=e)return e;var n=this.t;if(e=n-t.t,0!=e)return this.s<0?-e:e;while(--n>=0)if(0!=(e=this.data[n]-t.data[n]))return e;return 0}function k(t){var e,n=1;return 0!=(e=t>>>16)&&(t=e,n+=16),0!=(e=t>>8)&&(t=e,n+=8),0!=(e=t>>4)&&(t=e,n+=4),0!=(e=t>>2)&&(t=e,n+=2),0!=(e=t>>1)&&(t=e,n+=1),n}function R(){return this.t<=0?0:this.DB*(this.t-1)+k(this.data[this.t-1]^this.s&this.DM)}function N(t,e){var n;for(n=this.t-1;n>=0;--n)e.data[n+t]=this.data[n];for(n=t-1;n>=0;--n)e.data[n]=0;e.t=this.t+t,e.s=this.s}function D(t,e){for(var n=t;n<this.t;++n)e.data[n-t]=this.data[n];e.t=Math.max(this.t-t,0),e.s=this.s}function O(t,e){var n,r=t%this.DB,i=this.DB-r,s=(1<<i)-1,o=Math.floor(t/this.DB),a=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)e.data[n+o+1]=this.data[n]>>i|a,a=(this.data[n]&s)<<r;for(n=o-1;n>=0;--n)e.data[n]=0;e.data[o]=a,e.t=this.t+o+1,e.s=this.s,e.clamp()}function P(t,e){e.s=this.s;var n=Math.floor(t/this.DB);if(n>=this.t)e.t=0;else{var r=t%this.DB,i=this.DB-r,s=(1<<r)-1;e.data[0]=this.data[n]>>r;for(var o=n+1;o<this.t;++o)e.data[o-n-1]|=(this.data[o]&s)<<i,e.data[o-n]=this.data[o]>>r;r>0&&(e.data[this.t-n-1]|=(this.s&s)<<i),e.t=this.t-n,e.clamp()}}function x(t,e){var n=0,r=0,i=Math.min(t.t,this.t);while(n<i)r+=this.data[n]-t.data[n],e.data[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){r-=t.s;while(n<this.t)r+=this.data[n],e.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<t.t)r-=t.data[n],e.data[n++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e.data[n++]=this.DV+r:r>0&&(e.data[n++]=r),e.t=n,e.clamp()}function M(t,e){var n=this.abs(),r=t.abs(),i=n.t;e.t=i+r.t;while(--i>=0)e.data[i]=0;for(i=0;i<r.t;++i)e.data[i+n.t]=n.am(0,r.data[i],e,i,0,n.t);e.s=0,e.clamp(),this.s!=t.s&&a.ZERO.subTo(e,e)}function L(t){var e=this.abs(),n=t.t=2*e.t;while(--n>=0)t.data[n]=0;for(n=0;n<e.t-1;++n){var r=e.am(n,e.data[n],t,2*n,0,1);(t.data[n+e.t]+=e.am(n+1,2*e.data[n],t,2*n+1,r,e.t-n-1))>=e.DV&&(t.data[n+e.t]-=e.DV,t.data[n+e.t+1]=1)}t.t>0&&(t.data[t.t-1]+=e.am(n,e.data[n],t,2*n,0,1)),t.s=0,t.clamp()}function B(t,e,n){var r=t.abs();if(!(r.t<=0)){var i=this.abs();if(i.t<r.t)return null!=e&&e.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=c());var s=c(),o=this.s,l=t.s,u=this.DB-k(r.data[r.t-1]);u>0?(r.lShiftTo(u,s),i.lShiftTo(u,n)):(r.copyTo(s),i.copyTo(n));var h=s.t,d=s.data[h-1];if(0!=d){var f=d*(1<<this.F1)+(h>1?s.data[h-2]>>this.F2:0),p=this.FV/f,g=(1<<this.F1)/f,m=1<<this.F2,y=n.t,w=y-h,b=null==e?c():e;s.dlShiftTo(w,b),n.compareTo(b)>=0&&(n.data[n.t++]=1,n.subTo(b,n)),a.ONE.dlShiftTo(h,b),b.subTo(s,s);while(s.t<h)s.data[s.t++]=0;while(--w>=0){var v=n.data[--y]==d?this.DM:Math.floor(n.data[y]*p+(n.data[y-1]+m)*g);if((n.data[y]+=s.am(0,v,n,w,0,h))<v){s.dlShiftTo(w,b),n.subTo(b,n);while(n.data[y]<--v)n.subTo(b,n)}}null!=e&&(n.drShiftTo(h,e),o!=l&&a.ZERO.subTo(e,e)),n.t=h,n.clamp(),u>0&&n.rShiftTo(u,n),o<0&&a.ZERO.subTo(n,n)}}}function U(t){var e=c();return this.abs().divRemTo(t,null,e),this.s<0&&e.compareTo(a.ZERO)>0&&t.subTo(e,e),e}function F(t){this.m=t}function z(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t}function V(t){return t}function j(t){t.divRemTo(this.m,null,t)}function H(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function $(t,e){t.squareTo(e),this.reduce(e)}function K(){if(this.t<1)return 0;var t=this.data[0];if(0==(1&t))return 0;var e=3&t;return e=e*(2-(15&t)*e)&15,e=e*(2-(255&t)*e)&255,e=e*(2-((65535&t)*e&65535))&65535,e=e*(2-t*e%this.DV)%this.DV,e>0?this.DV-e:-e}function G(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}function q(t){var e=c();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(a.ZERO)>0&&this.m.subTo(e,e),e}function W(t){var e=c();return t.copyTo(e),this.reduce(e),e}function Y(t){while(t.t<=this.mt2)t.data[t.t++]=0;for(var e=0;e<this.m.t;++e){var n=32767&t.data[e],r=n*this.mpl+((n*this.mph+(t.data[e]>>15)*this.mpl&this.um)<<15)&t.DM;n=e+this.m.t,t.data[n]+=this.m.am(0,r,t,e,0,this.m.t);while(t.data[n]>=t.DV)t.data[n]-=t.DV,t.data[++n]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)}function X(t,e){t.squareTo(e),this.reduce(e)}function Q(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function J(){return 0==(this.t>0?1&this.data[0]:this.s)}function Z(t,e){if(t>4294967295||t<1)return a.ONE;var n=c(),r=c(),i=e.convert(this),s=k(t)-1;i.copyTo(n);while(--s>=0)if(e.sqrTo(n,r),(t&1<<s)>0)e.mulTo(r,i,n);else{var o=n;n=r,r=o}return e.revert(n)}function tt(t,e){var n;return n=t<256||e.isEven()?new F(e):new G(e),this.exp(t,n)}function et(){var t=c();return this.copyTo(t),t}function nt(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function rt(){return 0==this.t?this.s:this.data[0]<<24>>24}function it(){return 0==this.t?this.s:this.data[0]<<16>>16}function st(t){return Math.floor(Math.LN2*this.DB/Math.log(t))}function ot(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function at(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),n=Math.pow(t,e),r=E(n),i=c(),s=c(),o="";this.divRemTo(r,i,s);while(i.signum()>0)o=(n+s.intValue()).toString(t).substr(1)+o,i.divRemTo(r,i,s);return s.intValue().toString(t)+o}function ct(t,e){this.fromInt(0),null==e&&(e=10);for(var n=this.chunkSize(e),r=Math.pow(e,n),i=!1,s=0,o=0,c=0;c<t.length;++c){var l=w(t,c);l<0?"-"==t.charAt(c)&&0==this.signum()&&(i=!0):(o=e*o+l,++s>=n&&(this.dMultiply(r),this.dAddOffset(o,0),s=0,o=0))}s>0&&(this.dMultiply(Math.pow(e,s)),this.dAddOffset(o,0)),i&&a.ZERO.subTo(this,this)}function lt(t,e,n){if("number"==typeof e)if(t<2)this.fromInt(1);else{this.fromNumber(t,n),this.testBit(t-1)||this.bitwiseTo(a.ONE.shiftLeft(t-1),yt,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(e))this.dAddOffset(2,0),this.bitLength()>t&&this.subTo(a.ONE.shiftLeft(t-1),this)}else{var r=new Array,i=7&t;r.length=1+(t>>3),e.nextBytes(r),i>0?r[0]&=(1<<i)-1:r[0]=0,this.fromString(r,256)}}function ut(){var t=this.t,e=new Array;e[0]=this.s;var n,r=this.DB-t*this.DB%8,i=0;if(t-- >0){r<this.DB&&(n=this.data[t]>>r)!=(this.s&this.DM)>>r&&(e[i++]=n|this.s<<this.DB-r);while(t>=0)r<8?(n=(this.data[t]&(1<<r)-1)<<8-r,n|=this.data[--t]>>(r+=this.DB-8)):(n=this.data[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),0!=(128&n)&&(n|=-256),0==i&&(128&this.s)!=(128&n)&&++i,(i>0||n!=this.s)&&(e[i++]=n)}return e}function ht(t){return 0==this.compareTo(t)}function dt(t){return this.compareTo(t)<0?this:t}function ft(t){return this.compareTo(t)>0?this:t}function pt(t,e,n){var r,i,s=Math.min(t.t,this.t);for(r=0;r<s;++r)n.data[r]=e(this.data[r],t.data[r]);if(t.t<this.t){for(i=t.s&this.DM,r=s;r<this.t;++r)n.data[r]=e(this.data[r],i);n.t=this.t}else{for(i=this.s&this.DM,r=s;r<t.t;++r)n.data[r]=e(i,t.data[r]);n.t=t.t}n.s=e(this.s,t.s),n.clamp()}function gt(t,e){return t&e}function mt(t){var e=c();return this.bitwiseTo(t,gt,e),e}function yt(t,e){return t|e}function wt(t){var e=c();return this.bitwiseTo(t,yt,e),e}function bt(t,e){return t^e}function vt(t){var e=c();return this.bitwiseTo(t,bt,e),e}function Et(t,e){return t&~e}function _t(t){var e=c();return this.bitwiseTo(t,Et,e),e}function St(){for(var t=c(),e=0;e<this.t;++e)t.data[e]=this.DM&~this.data[e];return t.t=this.t,t.s=~this.s,t}function At(t){var e=c();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e}function Ct(t){var e=c();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e}function It(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function Tt(){for(var t=0;t<this.t;++t)if(0!=this.data[t])return t*this.DB+It(this.data[t]);return this.s<0?this.t*this.DB:-1}function kt(t){var e=0;while(0!=t)t&=t-1,++e;return e}function Rt(){for(var t=0,e=this.s&this.DM,n=0;n<this.t;++n)t+=kt(this.data[n]^e);return t}function Nt(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this.data[e]&1<<t%this.DB)}function Dt(t,e){var n=a.ONE.shiftLeft(t);return this.bitwiseTo(n,e,n),n}function Ot(t){return this.changeBit(t,yt)}function Pt(t){return this.changeBit(t,Et)}function xt(t){return this.changeBit(t,bt)}function Mt(t,e){var n=0,r=0,i=Math.min(t.t,this.t);while(n<i)r+=this.data[n]+t.data[n],e.data[n++]=r&this.DM,r>>=this.DB;if(t.t<this.t){r+=t.s;while(n<this.t)r+=this.data[n],e.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<t.t)r+=t.data[n],e.data[n++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e.data[n++]=r:r<-1&&(e.data[n++]=this.DV+r),e.t=n,e.clamp()}function Lt(t){var e=c();return this.addTo(t,e),e}function Bt(t){var e=c();return this.subTo(t,e),e}function Ut(t){var e=c();return this.multiplyTo(t,e),e}function Ft(t){var e=c();return this.divRemTo(t,e,null),e}function zt(t){var e=c();return this.divRemTo(t,null,e),e}function Vt(t){var e=c(),n=c();return this.divRemTo(t,e,n),new Array(e,n)}function jt(t){this.data[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()}function Ht(t,e){if(0!=t){while(this.t<=e)this.data[this.t++]=0;this.data[e]+=t;while(this.data[e]>=this.DV)this.data[e]-=this.DV,++e>=this.t&&(this.data[this.t++]=0),++this.data[e]}}function $t(){}function Kt(t){return t}function Gt(t,e,n){t.multiplyTo(e,n)}function qt(t,e){t.squareTo(e)}function Wt(t){return this.exp(t,new $t)}function Yt(t,e,n){var r,i=Math.min(this.t+t.t,e);n.s=0,n.t=i;while(i>0)n.data[--i]=0;for(r=n.t-this.t;i<r;++i)n.data[i+this.t]=this.am(0,t.data[i],n,i,0,this.t);for(r=Math.min(t.t,e);i<r;++i)this.am(0,t.data[i],n,i,0,e-i);n.clamp()}function Xt(t,e,n){--e;var r=n.t=this.t+t.t-e;n.s=0;while(--r>=0)n.data[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)n.data[this.t+r-e]=this.am(e-r,t.data[r],n,0,0,this.t+r-e);n.clamp(),n.drShiftTo(1,n)}function Qt(t){this.r2=c(),this.q3=c(),a.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t),this.m=t}function Jt(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=c();return t.copyTo(e),this.reduce(e),e}function Zt(t){return t}function te(t){t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(t.compareTo(this.r2)<0)t.dAddOffset(1,this.m.t+1);t.subTo(this.r2,t);while(t.compareTo(this.m)>=0)t.subTo(this.m,t)}function ee(t,e){t.squareTo(e),this.reduce(e)}function ne(t,e,n){t.multiplyTo(e,n),this.reduce(n)}function re(t,e){var n,r,i=t.bitLength(),s=E(1);if(i<=0)return s;n=i<18?1:i<48?3:i<144?4:i<768?5:6,r=i<8?new F(e):e.isEven()?new Qt(e):new G(e);var o=new Array,a=3,l=n-1,u=(1<<n)-1;if(o[1]=r.convert(this),n>1){var h=c();r.sqrTo(o[1],h);while(a<=u)o[a]=c(),r.mulTo(h,o[a-2],o[a]),a+=2}var d,f,p=t.t-1,g=!0,m=c();i=k(t.data[p])-1;while(p>=0){i>=l?d=t.data[p]>>i-l&u:(d=(t.data[p]&(1<<i+1)-1)<<l-i,p>0&&(d|=t.data[p-1]>>this.DB+i-l)),a=n;while(0==(1&d))d>>=1,--a;if((i-=a)<0&&(i+=this.DB,--p),g)o[d].copyTo(s),g=!1;else{while(a>1)r.sqrTo(s,m),r.sqrTo(m,s),a-=2;a>0?r.sqrTo(s,m):(f=s,s=m,m=f),r.mulTo(m,o[d],s)}while(p>=0&&0==(t.data[p]&1<<i))r.sqrTo(s,m),f=s,s=m,m=f,--i<0&&(i=this.DB-1,--p)}return r.revert(s)}function ie(t){var e=this.s<0?this.negate():this.clone(),n=t.s<0?t.negate():t.clone();if(e.compareTo(n)<0){var r=e;e=n,n=r}var i=e.getLowestSetBit(),s=n.getLowestSetBit();if(s<0)return e;i<s&&(s=i),s>0&&(e.rShiftTo(s,e),n.rShiftTo(s,n));while(e.signum()>0)(i=e.getLowestSetBit())>0&&e.rShiftTo(i,e),(i=n.getLowestSetBit())>0&&n.rShiftTo(i,n),e.compareTo(n)>=0?(e.subTo(n,e),e.rShiftTo(1,e)):(n.subTo(e,n),n.rShiftTo(1,n));return s>0&&n.lShiftTo(s,n),n}function se(t){if(t<=0)return 0;var e=this.DV%t,n=this.s<0?t-1:0;if(this.t>0)if(0==e)n=this.data[0]%t;else for(var r=this.t-1;r>=0;--r)n=(e*n+this.data[r])%t;return n}function oe(t){var e=t.isEven();if(this.isEven()&&e||0==t.signum())return a.ZERO;var n=t.clone(),r=this.clone(),i=E(1),s=E(0),o=E(0),c=E(1);while(0!=n.signum()){while(n.isEven())n.rShiftTo(1,n),e?(i.isEven()&&s.isEven()||(i.addTo(this,i),s.subTo(t,s)),i.rShiftTo(1,i)):s.isEven()||s.subTo(t,s),s.rShiftTo(1,s);while(r.isEven())r.rShiftTo(1,r),e?(o.isEven()&&c.isEven()||(o.addTo(this,o),c.subTo(t,c)),o.rShiftTo(1,o)):c.isEven()||c.subTo(t,c),c.rShiftTo(1,c);n.compareTo(r)>=0?(n.subTo(r,n),e&&i.subTo(o,i),s.subTo(c,s)):(r.subTo(n,r),e&&o.subTo(i,o),c.subTo(s,c))}return 0!=r.compareTo(a.ONE)?a.ZERO:c.compareTo(t)>=0?c.subtract(t):c.signum()<0?(c.addTo(t,c),c.signum()<0?c.add(t):c):c}F.prototype.convert=z,F.prototype.revert=V,F.prototype.reduce=j,F.prototype.mulTo=H,F.prototype.sqrTo=$,G.prototype.convert=q,G.prototype.revert=W,G.prototype.reduce=Y,G.prototype.mulTo=Q,G.prototype.sqrTo=X,a.prototype.copyTo=b,a.prototype.fromInt=v,a.prototype.fromString=_,a.prototype.clamp=S,a.prototype.dlShiftTo=N,a.prototype.drShiftTo=D,a.prototype.lShiftTo=O,a.prototype.rShiftTo=P,a.prototype.subTo=x,a.prototype.multiplyTo=M,a.prototype.squareTo=L,a.prototype.divRemTo=B,a.prototype.invDigit=K,a.prototype.isEven=J,a.prototype.exp=Z,a.prototype.toString=A,a.prototype.negate=C,a.prototype.abs=I,a.prototype.compareTo=T,a.prototype.bitLength=R,a.prototype.mod=U,a.prototype.modPowInt=tt,a.ZERO=E(0),a.ONE=E(1),$t.prototype.convert=Kt,$t.prototype.revert=Kt,$t.prototype.mulTo=Gt,$t.prototype.sqrTo=qt,Qt.prototype.convert=Jt,Qt.prototype.revert=Zt,Qt.prototype.reduce=te,Qt.prototype.mulTo=ne,Qt.prototype.sqrTo=ee;var ae=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],ce=(1<<26)/ae[ae.length-1];function le(t){var e,n=this.abs();if(1==n.t&&n.data[0]<=ae[ae.length-1]){for(e=0;e<ae.length;++e)if(n.data[0]==ae[e])return!0;return!1}if(n.isEven())return!1;e=1;while(e<ae.length){var r=ae[e],i=e+1;while(i<ae.length&&r<ce)r*=ae[i++];r=n.modInt(r);while(e<i)if(r%ae[e++]==0)return!1}return n.millerRabin(t)}function ue(t){var e=this.subtract(a.ONE),n=e.getLowestSetBit();if(n<=0)return!1;for(var r,i=e.shiftRight(n),s=he(),o=0;o<t;++o){do{r=new a(this.bitLength(),s)}while(r.compareTo(a.ONE)<=0||r.compareTo(e)>=0);var c=r.modPow(i,this);if(0!=c.compareTo(a.ONE)&&0!=c.compareTo(e)){var l=1;while(l++<n&&0!=c.compareTo(e))if(c=c.modPowInt(2,this),0==c.compareTo(a.ONE))return!1;if(0!=c.compareTo(e))return!1}}return!0}function he(){return{nextBytes:function(t){for(var e=0;e<t.length;++e)t[e]=Math.floor(256*Math.random())}}}a.prototype.chunkSize=st,a.prototype.toRadix=at,a.prototype.fromRadix=ct,a.prototype.fromNumber=lt,a.prototype.bitwiseTo=pt,a.prototype.changeBit=Dt,a.prototype.addTo=Mt,a.prototype.dMultiply=jt,a.prototype.dAddOffset=Ht,a.prototype.multiplyLowerTo=Yt,a.prototype.multiplyUpperTo=Xt,a.prototype.modInt=se,a.prototype.millerRabin=ue,a.prototype.clone=et,a.prototype.intValue=nt,a.prototype.byteValue=rt,a.prototype.shortValue=it,a.prototype.signum=ot,a.prototype.toByteArray=ut,a.prototype.equals=ht,a.prototype.min=dt,a.prototype.max=ft,a.prototype.and=mt,a.prototype.or=wt,a.prototype.xor=vt,a.prototype.andNot=_t,a.prototype.not=St,a.prototype.shiftLeft=At,a.prototype.shiftRight=Ct,a.prototype.getLowestSetBit=Tt,a.prototype.bitCount=Rt,a.prototype.testBit=Nt,a.prototype.setBit=Ot,a.prototype.clearBit=Pt,a.prototype.flipBit=xt,a.prototype.add=Lt,a.prototype.subtract=Bt,a.prototype.multiply=Ut,a.prototype.divide=Ft,a.prototype.remainder=zt,a.prototype.divideAndRemainder=Vt,a.prototype.modPow=re,a.prototype.modInverse=oe,a.prototype.pow=Wt,a.prototype.gcd=ie,a.prototype.isProbablePrime=le},2713:function(t,e,n){var r=n(6143);t.exports=r.md=r.md||{},r.md.algorithms=r.md.algorithms||{}},3232:function(t,e,n){var r=n(6143);n(2128),t.exports=r.mgf=r.mgf||{},r.mgf.mgf1=r.mgf1},2128:function(t,e,n){var r=n(6143);n(8666),r.mgf=r.mgf||{};var i=t.exports=r.mgf.mgf1=r.mgf1=r.mgf1||{};i.create=function(t){var e={generate:function(e,n){for(var i=new r.util.ByteBuffer,s=Math.ceil(n/t.digestLength),o=0;o<s;o++){var a=new r.util.ByteBuffer;a.putInt32(o),t.start(),t.update(e+a.getBytes()),i.putBuffer(t.digest())}return i.truncate(i.length()-n),i.getBytes()}};return e}},5828:function(t,e,n){var r=n(6143);r.pki=r.pki||{};var i=t.exports=r.pki.oids=r.oids=r.oids||{};function s(t,e){i[t]=e,i[e]=t}function o(t,e){i[t]=e}s("1.2.840.113549.1.1.1","rsaEncryption"),s("1.2.840.113549.1.1.4","md5WithRSAEncryption"),s("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),s("1.2.840.113549.1.1.7","RSAES-OAEP"),s("1.2.840.113549.1.1.8","mgf1"),s("1.2.840.113549.1.1.9","pSpecified"),s("1.2.840.113549.1.1.10","RSASSA-PSS"),s("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),s("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),s("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),s("1.3.101.112","EdDSA25519"),s("1.2.840.10040.4.3","dsa-with-sha1"),s("1.3.14.3.2.7","desCBC"),s("1.3.14.3.2.26","sha1"),s("1.3.14.3.2.29","sha1WithRSASignature"),s("2.16.840.1.101.3.4.2.1","sha256"),s("2.16.840.1.101.3.4.2.2","sha384"),s("2.16.840.1.101.3.4.2.3","sha512"),s("2.16.840.1.101.3.4.2.4","sha224"),s("2.16.840.1.101.3.4.2.5","sha512-224"),s("2.16.840.1.101.3.4.2.6","sha512-256"),s("1.2.840.113549.2.2","md2"),s("1.2.840.113549.2.5","md5"),s("1.2.840.113549.1.7.1","data"),s("1.2.840.113549.1.7.2","signedData"),s("1.2.840.113549.1.7.3","envelopedData"),s("1.2.840.113549.1.7.4","signedAndEnvelopedData"),s("1.2.840.113549.1.7.5","digestedData"),s("1.2.840.113549.1.7.6","encryptedData"),s("1.2.840.113549.1.9.1","emailAddress"),s("1.2.840.113549.1.9.2","unstructuredName"),s("1.2.840.113549.1.9.3","contentType"),s("1.2.840.113549.1.9.4","messageDigest"),s("1.2.840.113549.1.9.5","signingTime"),s("1.2.840.113549.1.9.6","counterSignature"),s("1.2.840.113549.1.9.7","challengePassword"),s("1.2.840.113549.1.9.8","unstructuredAddress"),s("1.2.840.113549.1.9.14","extensionRequest"),s("1.2.840.113549.1.9.20","friendlyName"),s("1.2.840.113549.1.9.21","localKeyId"),s("1.2.840.113549.1.9.22.1","x509Certificate"),s("1.2.840.113549.1.12.10.1.1","keyBag"),s("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),s("1.2.840.113549.1.12.10.1.3","certBag"),s("1.2.840.113549.1.12.10.1.4","crlBag"),s("1.2.840.113549.1.12.10.1.5","secretBag"),s("1.2.840.113549.1.12.10.1.6","safeContentsBag"),s("1.2.840.113549.1.5.13","pkcs5PBES2"),s("1.2.840.113549.1.5.12","pkcs5PBKDF2"),s("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),s("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),s("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),s("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),s("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),s("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),s("1.2.840.113549.2.7","hmacWithSHA1"),s("1.2.840.113549.2.8","hmacWithSHA224"),s("1.2.840.113549.2.9","hmacWithSHA256"),s("1.2.840.113549.2.10","hmacWithSHA384"),s("1.2.840.113549.2.11","hmacWithSHA512"),s("1.2.840.113549.3.7","des-EDE3-CBC"),s("2.16.840.1.101.3.4.1.2","aes128-CBC"),s("2.16.840.1.101.3.4.1.22","aes192-CBC"),s("2.16.840.1.101.3.4.1.42","aes256-CBC"),s("2.5.4.3","commonName"),s("2.5.4.4","surname"),s("2.5.4.5","serialNumber"),s("2.5.4.6","countryName"),s("2.5.4.7","localityName"),s("2.5.4.8","stateOrProvinceName"),s("2.5.4.9","streetAddress"),s("2.5.4.10","organizationName"),s("2.5.4.11","organizationalUnitName"),s("2.5.4.12","title"),s("2.5.4.13","description"),s("2.5.4.15","businessCategory"),s("2.5.4.17","postalCode"),s("2.5.4.42","givenName"),s("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),s("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),s("2.16.840.1.113730.1.1","nsCertType"),s("2.16.840.1.113730.1.13","nsComment"),o("2.5.29.1","authorityKeyIdentifier"),o("2.5.29.2","keyAttributes"),o("2.5.29.3","certificatePolicies"),o("2.5.29.4","keyUsageRestriction"),o("2.5.29.5","policyMapping"),o("2.5.29.6","subtreesConstraint"),o("2.5.29.7","subjectAltName"),o("2.5.29.8","issuerAltName"),o("2.5.29.9","subjectDirectoryAttributes"),o("2.5.29.10","basicConstraints"),o("2.5.29.11","nameConstraints"),o("2.5.29.12","policyConstraints"),o("2.5.29.13","basicConstraints"),s("2.5.29.14","subjectKeyIdentifier"),s("2.5.29.15","keyUsage"),o("2.5.29.16","privateKeyUsagePeriod"),s("2.5.29.17","subjectAltName"),s("2.5.29.18","issuerAltName"),s("2.5.29.19","basicConstraints"),o("2.5.29.20","cRLNumber"),o("2.5.29.21","cRLReason"),o("2.5.29.22","expirationDate"),o("2.5.29.23","instructionCode"),o("2.5.29.24","invalidityDate"),o("2.5.29.25","cRLDistributionPoints"),o("2.5.29.26","issuingDistributionPoint"),o("2.5.29.27","deltaCRLIndicator"),o("2.5.29.28","issuingDistributionPoint"),o("2.5.29.29","certificateIssuer"),o("2.5.29.30","nameConstraints"),s("2.5.29.31","cRLDistributionPoints"),s("2.5.29.32","certificatePolicies"),o("2.5.29.33","policyMappings"),o("2.5.29.34","policyConstraints"),s("2.5.29.35","authorityKeyIdentifier"),o("2.5.29.36","policyConstraints"),s("2.5.29.37","extKeyUsage"),o("2.5.29.46","freshestCRL"),o("2.5.29.54","inhibitAnyPolicy"),s("1.3.6.1.4.1.11129.2.4.2","timestampList"),s("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),s("1.3.6.1.5.5.7.3.1","serverAuth"),s("1.3.6.1.5.5.7.3.2","clientAuth"),s("1.3.6.1.5.5.7.3.3","codeSigning"),s("1.3.6.1.5.5.7.3.4","emailProtection"),s("1.3.6.1.5.5.7.3.8","timeStamping")},8774:function(t,e,n){n(7658);var r=n(6143);if(n(6509),n(3655),n(1202),n(2713),n(5828),n(3350),n(8277),n(8584),n(3398),n(536),n(8666),"undefined"===typeof i)var i=r.jsbn.BigInteger;var s=r.asn1,o=r.pki=r.pki||{};t.exports=o.pbe=r.pbe=r.pbe||{};var a=o.oids,c={name:"EncryptedPrivateKeyInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},l={name:"PBES2Algorithms",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(t,e){return t.start().update(e).digest().getBytes()}function d(t){var e;if(t){if(e=o.oids[s.derToOid(t)],!e){var n=new Error("Unsupported PRF OID.");throw n.oid=t,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}}else e="hmacWithSHA1";return f(e)}function f(t){var e=r.md;switch(t){case"hmacWithSHA224":e=r.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":t=t.substr(8).toLowerCase();break;default:var n=new Error("Unsupported PRF algorithm.");throw n.algorithm=t,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}if(!e||!(t in e))throw new Error("Unknown hash algorithm: "+t);return e[t].create()}function p(t,e,n,i){var a=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,t),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,e.getBytes())]);return"hmacWithSHA1"!==i&&a.value.push(s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,r.util.hexToBytes(n.toString(16))),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.oids[i]).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])),a}o.encryptPrivateKeyInfo=function(t,e,n){n=n||{},n.saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||"aes128",n.prfAlgorithm=n.prfAlgorithm||"sha1";var i,c,l,u=r.random.getBytesSync(n.saltSize),h=n.count,d=s.integerToDer(h);if(0===n.algorithm.indexOf("aes")||"des"===n.algorithm){var g,m,y;switch(n.algorithm){case"aes128":i=16,g=16,m=a["aes128-CBC"],y=r.aes.createEncryptionCipher;break;case"aes192":i=24,g=16,m=a["aes192-CBC"],y=r.aes.createEncryptionCipher;break;case"aes256":i=32,g=16,m=a["aes256-CBC"],y=r.aes.createEncryptionCipher;break;case"des":i=8,g=8,m=a["desCBC"],y=r.des.createEncryptionCipher;break;default:var w=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw w.algorithm=n.algorithm,w}var b="hmacWith"+n.prfAlgorithm.toUpperCase(),v=f(b),E=r.pkcs5.pbkdf2(e,u,h,i,v),_=r.random.getBytesSync(g),S=y(E);S.start(_),S.update(s.toDer(t)),S.finish(),l=S.output.getBytes();var A=p(u,d,i,b);c=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(a["pkcs5PBES2"]).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(a["pkcs5PBKDF2"]).getBytes()),A]),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(m).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,_)])])])}else{if("3des"!==n.algorithm){w=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw w.algorithm=n.algorithm,w}i=24;var C=new r.util.ByteBuffer(u);E=o.pbe.generatePkcs12Key(e,C,1,h,i),_=o.pbe.generatePkcs12Key(e,C,2,h,i),S=r.des.createEncryptionCipher(E);S.start(_),S.update(s.toDer(t)),S.finish(),l=S.output.getBytes(),c=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,u),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,d.getBytes())])])}var I=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[c,s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,l)]);return I},o.decryptPrivateKeyInfo=function(t,e){var n=null,i={},a=[];if(!s.validate(t,c,i,a)){var l=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw l.errors=a,l}var u=s.derToOid(i.encryptionOid),h=o.pbe.getCipher(u,i.encryptionParams,e),d=r.util.createBuffer(i.encryptedData);return h.update(d),h.finish()&&(n=s.fromDer(h.output)),n},o.encryptedPrivateKeyToPem=function(t,e){var n={type:"ENCRYPTED PRIVATE KEY",body:s.toDer(t).getBytes()};return r.pem.encode(n,{maxline:e})},o.encryptedPrivateKeyFromPem=function(t){var e=r.pem.decode(t)[0];if("ENCRYPTED PRIVATE KEY"!==e.type){var n=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw n.headerType=e.type,n}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return s.fromDer(e.body)},o.encryptRsaPrivateKey=function(t,e,n){if(n=n||{},!n.legacy){var i=o.wrapRsaPrivateKey(o.privateKeyToAsn1(t));return i=o.encryptPrivateKeyInfo(i,e,n),o.encryptedPrivateKeyToPem(i)}var a,c,l,u;switch(n.algorithm){case"aes128":a="AES-128-CBC",l=16,c=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",l=24,c=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",l=32,c=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",l=24,c=r.random.getBytesSync(8),u=r.des.createEncryptionCipher;break;case"des":a="DES-CBC",l=8,c=r.random.getBytesSync(8),u=r.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+n.algorithm+'".');throw h.algorithm=n.algorithm,h}var d=r.pbe.opensslDeriveBytes(e,c.substr(0,8),l),f=u(d);f.start(c),f.update(s.toDer(o.privateKeyToAsn1(t))),f.finish();var p={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:r.util.bytesToHex(c).toUpperCase()},body:f.output.getBytes()};return r.pem.encode(p)},o.decryptRsaPrivateKey=function(t,e){var n=null,i=r.pem.decode(t)[0];if("ENCRYPTED PRIVATE KEY"!==i.type&&"PRIVATE KEY"!==i.type&&"RSA PRIVATE KEY"!==i.type){var a=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw a.headerType=a,a}if(i.procType&&"ENCRYPTED"===i.procType.type){var c,l;switch(i.dekInfo.algorithm){case"DES-CBC":c=8,l=r.des.createDecryptionCipher;break;case"DES-EDE3-CBC":c=24,l=r.des.createDecryptionCipher;break;case"AES-128-CBC":c=16,l=r.aes.createDecryptionCipher;break;case"AES-192-CBC":c=24,l=r.aes.createDecryptionCipher;break;case"AES-256-CBC":c=32,l=r.aes.createDecryptionCipher;break;case"RC2-40-CBC":c=5,l=function(t){return r.rc2.createDecryptionCipher(t,40)};break;case"RC2-64-CBC":c=8,l=function(t){return r.rc2.createDecryptionCipher(t,64)};break;case"RC2-128-CBC":c=16,l=function(t){return r.rc2.createDecryptionCipher(t,128)};break;default:a=new Error('Could not decrypt private key; unsupported encryption algorithm "'+i.dekInfo.algorithm+'".');throw a.algorithm=i.dekInfo.algorithm,a}var u=r.util.hexToBytes(i.dekInfo.parameters),h=r.pbe.opensslDeriveBytes(e,u.substr(0,8),c),d=l(h);if(d.start(u),d.update(r.util.createBuffer(i.body)),!d.finish())return n;n=d.output.getBytes()}else n=i.body;return n="ENCRYPTED PRIVATE KEY"===i.type?o.decryptPrivateKeyInfo(s.fromDer(n),e):s.fromDer(n),null!==n&&(n=o.privateKeyFromAsn1(n)),n},o.pbe.generatePkcs12Key=function(t,e,n,i,s,o){var a,c;if("undefined"===typeof o||null===o){if(!("sha1"in r.md))throw new Error('"sha1" hash algorithm unavailable.');o=r.md.sha1.create()}var l=o.digestLength,u=o.blockLength,h=new r.util.ByteBuffer,d=new r.util.ByteBuffer;if(null!==t&&void 0!==t){for(c=0;c<t.length;c++)d.putInt16(t.charCodeAt(c));d.putInt16(0)}var f=d.length(),p=e.length(),g=new r.util.ByteBuffer;g.fillWithByte(n,u);var m=u*Math.ceil(p/u),y=new r.util.ByteBuffer;for(c=0;c<m;c++)y.putByte(e.at(c%p));var w=u*Math.ceil(f/u),b=new r.util.ByteBuffer;for(c=0;c<w;c++)b.putByte(d.at(c%f));var v=y;v.putBuffer(b);for(var E=Math.ceil(s/l),_=1;_<=E;_++){var S=new r.util.ByteBuffer;S.putBytes(g.bytes()),S.putBytes(v.bytes());for(var A=0;A<i;A++)o.start(),o.update(S.getBytes()),S=o.digest();var C=new r.util.ByteBuffer;for(c=0;c<u;c++)C.putByte(S.at(c%l));var I=Math.ceil(p/u)+Math.ceil(f/u),T=new r.util.ByteBuffer;for(a=0;a<I;a++){var k=new r.util.ByteBuffer(v.getBytes(u)),R=511;for(c=C.length()-1;c>=0;c--)R>>=8,R+=C.at(c)+k.at(c),k.setAt(c,255&R);T.putBuffer(k)}v=T,h.putBuffer(S)}return h.truncate(h.length()-s),h},o.pbe.getCipher=function(t,e,n){switch(t){case o.oids["pkcs5PBES2"]:return o.pbe.getCipherForPBES2(t,e,n);case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case o.oids["pbewithSHAAnd40BitRC2-CBC"]:return o.pbe.getCipherForPKCS12PBE(t,e,n);default:var r=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw r.oid=t,r.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],r}},o.pbe.getCipherForPBES2=function(t,e,n){var i={},a=[];if(!s.validate(e,l,i,a)){var c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=a,c}if(t=s.derToOid(i.kdfOid),t!==o.oids["pkcs5PBKDF2"]){c=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw c.oid=t,c.supportedOids=["pkcs5PBKDF2"],c}if(t=s.derToOid(i.encOid),t!==o.oids["aes128-CBC"]&&t!==o.oids["aes192-CBC"]&&t!==o.oids["aes256-CBC"]&&t!==o.oids["des-EDE3-CBC"]&&t!==o.oids["desCBC"]){c=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw c.oid=t,c.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],c}var u,h,f=i.kdfSalt,p=r.util.createBuffer(i.kdfIterationCount);switch(p=p.getInt(p.length()<<3),o.oids[t]){case"aes128-CBC":u=16,h=r.aes.createDecryptionCipher;break;case"aes192-CBC":u=24,h=r.aes.createDecryptionCipher;break;case"aes256-CBC":u=32,h=r.aes.createDecryptionCipher;break;case"des-EDE3-CBC":u=24,h=r.des.createDecryptionCipher;break;case"desCBC":u=8,h=r.des.createDecryptionCipher;break}var g=d(i.prfOid),m=r.pkcs5.pbkdf2(n,f,p,u,g),y=i.encIv,w=h(m);return w.start(y),w},o.pbe.getCipherForPKCS12PBE=function(t,e,n){var i={},a=[];if(!s.validate(e,u,i,a)){var c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=a,c}var l,h,f,p=r.util.createBuffer(i.salt),g=r.util.createBuffer(i.iterations);switch(g=g.getInt(g.length()<<3),t){case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,h=8,f=r.des.startDecrypting;break;case o.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,h=8,f=function(t,e){var n=r.rc2.createDecryptionCipher(t,40);return n.start(e,null),n};break;default:c=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw c.oid=t,c}var m=d(i.prfOid),y=o.pbe.generatePkcs12Key(n,p,1,g,l,m);m.start();var w=o.pbe.generatePkcs12Key(n,p,2,g,h,m);return f(y,w)},o.pbe.opensslDeriveBytes=function(t,e,n,i){if("undefined"===typeof i||null===i){if(!("md5"in r.md))throw new Error('"md5" hash algorithm unavailable.');i=r.md.md5.create()}null===e&&(e="");for(var s=[h(i,t+e)],o=16,a=1;o<n;++a,o+=16)s.push(h(i,s[a-1]+t+e));return s.join("").substr(0,n)}},3350:function(t,e,n){var r=n(6143);n(1818),n(2713),n(8666);var i,s=r.pkcs5=r.pkcs5||{};r.util.isNodejs&&!r.options.usePureJavaScript&&(i=n(5745)),t.exports=r.pbkdf2=s.pbkdf2=function(t,e,n,s,o,a){if("function"===typeof o&&(a=o,o=null),r.util.isNodejs&&!r.options.usePureJavaScript&&i.pbkdf2&&(null===o||"object"!==typeof o)&&(i.pbkdf2Sync.length>4||!o||"sha1"===o))return"string"!==typeof o&&(o="sha1"),t=Buffer.from(t,"binary"),e=Buffer.from(e,"binary"),a?4===i.pbkdf2Sync.length?i.pbkdf2(t,e,n,s,(function(t,e){if(t)return a(t);a(null,e.toString("binary"))})):i.pbkdf2(t,e,n,s,o,(function(t,e){if(t)return a(t);a(null,e.toString("binary"))})):4===i.pbkdf2Sync.length?i.pbkdf2Sync(t,e,n,s).toString("binary"):i.pbkdf2Sync(t,e,n,s,o).toString("binary");if("undefined"!==typeof o&&null!==o||(o="sha1"),"string"===typeof o){if(!(o in r.md.algorithms))throw new Error("Unknown hash algorithm: "+o);o=r.md[o].create()}var c=o.digestLength;if(s>4294967295*c){var l=new Error("Derived key is too long.");if(a)return a(l);throw l}var u=Math.ceil(s/c),h=s-(u-1)*c,d=r.hmac.create();d.start(o,t);var f,p,g,m="";if(!a){for(var y=1;y<=u;++y){d.start(null,null),d.update(e),d.update(r.util.int32ToBytes(y)),f=g=d.digest().getBytes();for(var w=2;w<=n;++w)d.start(null,null),d.update(g),p=d.digest().getBytes(),f=r.util.xorBytes(f,p,c),g=p;m+=y<u?f:f.substr(0,h)}return m}y=1;function b(){if(y>u)return a(null,m);d.start(null,null),d.update(e),d.update(r.util.int32ToBytes(y)),f=g=d.digest().getBytes(),w=2,v()}function v(){if(w<=n)return d.start(null,null),d.update(g),p=d.digest().getBytes(),f=r.util.xorBytes(f,p,c),g=p,++w,r.util.setImmediate(v);m+=y<u?f:f.substr(0,h),++y,b()}b()}},8277:function(t,e,n){n(7658);var r=n(6143);n(8666);var i=t.exports=r.pem=r.pem||{};function s(t){for(var e=t.name+": ",n=[],r=function(t,e){return" "+e},i=0;i<t.values.length;++i)n.push(t.values[i].replace(/^(\S+\r\n)/,r));e+=n.join(",")+"\r\n";var s=0,o=-1;for(i=0;i<e.length;++i,++s)if(s>65&&-1!==o){var a=e[o];","===a?(++o,e=e.substr(0,o)+"\r\n "+e.substr(o)):e=e.substr(0,o)+"\r\n"+a+e.substr(o+1),s=i-o-1,o=-1,++i}else" "!==e[i]&&"\t"!==e[i]&&","!==e[i]||(o=i);return e}function o(t){return t.replace(/^\s+/,"")}i.encode=function(t,e){e=e||{};var n,i="-----BEGIN "+t.type+"-----\r\n";if(t.procType&&(n={name:"Proc-Type",values:[String(t.procType.version),t.procType.type]},i+=s(n)),t.contentDomain&&(n={name:"Content-Domain",values:[t.contentDomain]},i+=s(n)),t.dekInfo&&(n={name:"DEK-Info",values:[t.dekInfo.algorithm]},t.dekInfo.parameters&&n.values.push(t.dekInfo.parameters),i+=s(n)),t.headers)for(var o=0;o<t.headers.length;++o)i+=s(t.headers[o]);return t.procType&&(i+="\r\n"),i+=r.util.encode64(t.body,e.maxline||64)+"\r\n",i+="-----END "+t.type+"-----\r\n",i},i.decode=function(t){var e,n=[],i=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,s=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;while(1){if(e=i.exec(t),!e)break;var c=e[1];"NEW CERTIFICATE REQUEST"===c&&(c="CERTIFICATE REQUEST");var l={type:c,procType:null,contentDomain:null,dekInfo:null,headers:[],body:r.util.decode64(e[3])};if(n.push(l),e[2]){var u=e[2].split(a),h=0;while(e&&h<u.length){for(var d=u[h].replace(/\s+$/,""),f=h+1;f<u.length;++f){var p=u[f];if(!/\s/.test(p[0]))break;d+=p,h=f}if(e=d.match(s),e){for(var g={name:e[1],values:[]},m=e[2].split(","),y=0;y<m.length;++y)g.values.push(o(m[y]));if(l.procType)if(l.contentDomain||"Content-Domain"!==g.name)if(l.dekInfo||"DEK-Info"!==g.name)l.headers.push(g);else{if(0===g.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');l.dekInfo={algorithm:m[0],parameters:m[1]||null}}else l.contentDomain=m[0]||"";else{if("Proc-Type"!==g.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==g.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');l.procType={version:m[0],type:m[1]}}}++h}if("ENCRYPTED"===l.procType&&!l.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===n.length)throw new Error("Invalid PEM formatted message.");return n}},8219:function(t,e,n){var r=n(6143);n(8666),n(8584),n(8927);var i=t.exports=r.pkcs1=r.pkcs1||{};function s(t,e,n){n||(n=r.md.sha1.create());for(var i="",s=Math.ceil(e/n.digestLength),o=0;o<s;++o){var a=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);n.start(),n.update(t+a),i+=n.digest().getBytes()}return i.substring(0,e)}i.encode_rsa_oaep=function(t,e,n){var i,o,a,c;"string"===typeof n?(i=n,o=arguments[3]||void 0,a=arguments[4]||void 0):n&&(i=n.label||void 0,o=n.seed||void 0,a=n.md||void 0,n.mgf1&&n.mgf1.md&&(c=n.mgf1.md)),a?a.start():a=r.md.sha1.create(),c||(c=a);var l=Math.ceil(t.n.bitLength()/8),u=l-2*a.digestLength-2;if(e.length>u){var h=new Error("RSAES-OAEP input message length is too long.");throw h.length=e.length,h.maxLength=u,h}i||(i=""),a.update(i,"raw");for(var d=a.digest(),f="",p=u-e.length,g=0;g<p;g++)f+="\0";var m=d.getBytes()+f+""+e;if(o){if(o.length!==a.digestLength){h=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw h.seedLength=o.length,h.digestLength=a.digestLength,h}}else o=r.random.getBytes(a.digestLength);var y=s(o,l-a.digestLength-1,c),w=r.util.xorBytes(m,y,m.length),b=s(w,a.digestLength,c),v=r.util.xorBytes(o,b,o.length);return"\0"+v+w},i.decode_rsa_oaep=function(t,e,n){var i,o,a;"string"===typeof n?(i=n,o=arguments[3]||void 0):n&&(i=n.label||void 0,o=n.md||void 0,n.mgf1&&n.mgf1.md&&(a=n.mgf1.md));var c=Math.ceil(t.n.bitLength()/8);if(e.length!==c){var l=new Error("RSAES-OAEP encoded message length is invalid.");throw l.length=e.length,l.expectedLength=c,l}if(void 0===o?o=r.md.sha1.create():o.start(),a||(a=o),c<2*o.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");i||(i=""),o.update(i,"raw");for(var u=o.digest().getBytes(),h=e.charAt(0),d=e.substring(1,o.digestLength+1),f=e.substring(1+o.digestLength),p=s(f,o.digestLength,a),g=r.util.xorBytes(d,p,d.length),m=s(g,c-o.digestLength-1,a),y=r.util.xorBytes(f,m,f.length),w=y.substring(0,o.digestLength),b=(l="\0"!==h,0);b<o.digestLength;++b)l|=u.charAt(b)!==w.charAt(b);for(var v=1,E=o.digestLength,_=o.digestLength;_<y.length;_++){var S=y.charCodeAt(_),A=1&S^1,C=v?65534:0;l|=S&C,v&=A,E+=v}if(l||1!==y.charCodeAt(E))throw new Error("Invalid RSAES-OAEP padding.");return y.substring(E+1)}},4669:function(t,e,n){n(7658);var r=n(6143);n(6509),n(3655),n(1202),n(5828),n(8277),n(7929),n(8584),n(8666),n(4760);var i=r.asn1,s=t.exports=r.pkcs7=r.pkcs7||{};function o(t){var e={},n=[];if(!i.validate(t,s.asn1.recipientInfoValidator,e,n)){var o=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw o.errors=n,o}return{version:e.version.charCodeAt(0),issuer:r.pki.RDNAttributesAsArray(e.issuer),serialNumber:r.util.createBuffer(e.serial).toHex(),encryptedContent:{algorithm:i.derToOid(e.encAlgorithm),parameter:e.encParameter?e.encParameter.value:void 0,content:e.encKey}}}function a(t){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[r.pki.distinguishedNameToAsn1({attributes:t.issuer}),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,r.util.hexToBytes(t.serialNumber))]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.encryptedContent.algorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.encryptedContent.content)])}function c(t){for(var e=[],n=0;n<t.length;++n)e.push(o(t[n]));return e}function l(t){for(var e=[],n=0;n<t.length;++n)e.push(a(t[n]));return e}function u(t){var e=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[r.pki.distinguishedNameToAsn1({attributes:t.issuer}),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,r.util.hexToBytes(t.serialNumber))]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.digestAlgorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])]);if(t.authenticatedAttributesAsn1&&e.value.push(t.authenticatedAttributesAsn1),e.value.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.signatureAlgorithm).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])),e.value.push(i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.signature)),t.unauthenticatedAttributes.length>0){for(var n=i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[]),s=0;s<t.unauthenticatedAttributes.length;++s){var o=t.unauthenticatedAttributes[s];n.values.push(d(o))}e.value.push(n)}return e}function h(t){for(var e=[],n=0;n<t.length;++n)e.push(u(t[n]));return e}function d(t){var e;if(t.type===r.pki.oids.contentType)e=i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.value).getBytes());else if(t.type===r.pki.oids.messageDigest)e=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.value.bytes());else if(t.type===r.pki.oids.signingTime){var n=new Date("1950-01-01T00:00:00Z"),s=new Date("2050-01-01T00:00:00Z"),o=t.value;if("string"===typeof o){var a=Date.parse(o);o=isNaN(a)?13===o.length?i.utcTimeToDate(o):i.generalizedTimeToDate(o):new Date(a)}e=o>=n&&o<s?i.create(i.Class.UNIVERSAL,i.Type.UTCTIME,!1,i.dateToUtcTime(o)):i.create(i.Class.UNIVERSAL,i.Type.GENERALIZEDTIME,!1,i.dateToGeneralizedTime(o))}return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.type).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[e])])}function f(t){return[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(r.pki.oids.data).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.algorithm).getBytes()),t.parameter?i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.parameter.getBytes()):void 0]),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,t.content.getBytes())])]}function p(t,e,n){var s={},o=[];if(!i.validate(e,n,s,o)){var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw a.errors=a,a}var c=i.derToOid(s.contentType);if(c!==r.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(s.encryptedContent){var l="";if(r.util.isArray(s.encryptedContent))for(var u=0;u<s.encryptedContent.length;++u){if(s.encryptedContent[u].type!==i.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");l+=s.encryptedContent[u].value}else l=s.encryptedContent;t.encryptedContent={algorithm:i.derToOid(s.encAlgorithm),parameter:r.util.createBuffer(s.encParameter.value),content:r.util.createBuffer(l)}}if(s.content){l="";if(r.util.isArray(s.content))for(u=0;u<s.content.length;++u){if(s.content[u].type!==i.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");l+=s.content[u].value}else l=s.content;t.content=r.util.createBuffer(l)}return t.version=s.version.charCodeAt(0),t.rawCapture=s,s}function g(t){if(void 0===t.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===t.content){var e;switch(t.encryptedContent.algorithm){case r.pki.oids["aes128-CBC"]:case r.pki.oids["aes192-CBC"]:case r.pki.oids["aes256-CBC"]:e=r.aes.createDecryptionCipher(t.encryptedContent.key);break;case r.pki.oids["desCBC"]:case r.pki.oids["des-EDE3-CBC"]:e=r.des.createDecryptionCipher(t.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+t.encryptedContent.algorithm)}if(e.start(t.encryptedContent.parameter),e.update(t.encryptedContent.content),!e.finish())throw new Error("Symmetric decryption failed.");t.content=e.output}}s.messageFromPem=function(t){var e=r.pem.decode(t)[0];if("PKCS7"!==e.type){var n=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw n.headerType=e.type,n}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var o=i.fromDer(e.body);return s.messageFromAsn1(o)},s.messageToPem=function(t,e){var n={type:"PKCS7",body:i.toDer(t.toAsn1()).getBytes()};return r.pem.encode(n,{maxline:e})},s.messageFromAsn1=function(t){var e={},n=[];if(!i.validate(t,s.asn1.contentInfoValidator,e,n)){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw o.errors=n,o}var a,c=i.derToOid(e.contentType);switch(c){case r.pki.oids.envelopedData:a=s.createEnvelopedData();break;case r.pki.oids.encryptedData:a=s.createEncryptedData();break;case r.pki.oids.signedData:a=s.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+c+" is not (yet) supported.")}return a.fromAsn1(e.content.value[0]),a},s.createSignedData=function(){var t=null;return t={type:r.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(e){if(p(t,e,s.asn1.signedDataValidator),t.certificates=[],t.crls=[],t.digestAlgorithmIdentifiers=[],t.contentInfo=null,t.signerInfos=[],t.rawCapture.certificates)for(var n=t.rawCapture.certificates.value,i=0;i<n.length;++i)t.certificates.push(r.pki.certificateFromAsn1(n[i]))},toAsn1:function(){t.contentInfo||t.sign();for(var e=[],n=0;n<t.certificates.length;++n)e.push(r.pki.certificateToAsn1(t.certificates[n]));var s=[],o=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,t.digestAlgorithmIdentifiers),t.contentInfo])]);return e.length>0&&o.value[0].value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,e)),s.length>0&&o.value[0].value.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,s)),o.value[0].value.push(i.create(i.Class.UNIVERSAL,i.Type.SET,!0,t.signerInfos)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.type).getBytes()),o])},addSigner:function(e){var n=e.issuer,i=e.serialNumber;if(e.certificate){var s=e.certificate;"string"===typeof s&&(s=r.pki.certificateFromPem(s)),n=s.issuer.attributes,i=s.serialNumber}var o=e.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"===typeof o&&(o=r.pki.privateKeyFromPem(o));var a=e.digestAlgorithm||r.pki.oids.sha1;switch(a){case r.pki.oids.sha1:case r.pki.oids.sha256:case r.pki.oids.sha384:case r.pki.oids.sha512:case r.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+a)}var c=e.authenticatedAttributes||[];if(c.length>0){for(var l=!1,u=!1,h=0;h<c.length;++h){var d=c[h];if(l||d.type!==r.pki.oids.contentType){if(u||d.type!==r.pki.oids.messageDigest);else if(u=!0,l)break}else if(l=!0,u)break}if(!l||!u)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}t.signers.push({key:o,version:1,issuer:n,serialNumber:i,digestAlgorithm:a,signatureAlgorithm:r.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:c,unauthenticatedAttributes:[]})},sign:function(s){var o;(s=s||{},"object"!==typeof t.content||null===t.contentInfo)&&(t.contentInfo=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(r.pki.oids.data).getBytes())]),"content"in t&&(t.content instanceof r.util.ByteBuffer?o=t.content.bytes():"string"===typeof t.content&&(o=r.util.encodeUtf8(t.content)),s.detached?t.detachedContent=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,o):t.contentInfo.value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,o)]))));if(0!==t.signers.length){var a=e();n(a)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(e){"string"===typeof e&&(e=r.pki.certificateFromPem(e)),t.certificates.push(e)},addCertificateRevokationList:function(t){throw new Error("PKCS#7 CRL support not yet implemented.")}},t;function e(){for(var e={},n=0;n<t.signers.length;++n){var s=t.signers[n],o=s.digestAlgorithm;o in e||(e[o]=r.md[r.pki.oids[o]].create()),0===s.authenticatedAttributes.length?s.md=e[o]:s.md=r.md[r.pki.oids[o]].create()}for(var o in t.digestAlgorithmIdentifiers=[],e)t.digestAlgorithmIdentifiers.push(i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")]));return e}function n(e){var n;if(t.detachedContent?n=t.detachedContent:(n=t.contentInfo.value[1],n=n.value[0]),!n)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var s=i.derToOid(t.contentInfo.value[0].value),o=i.toDer(n);for(var a in o.getByte(),i.getBerValueLength(o),o=o.getBytes(),e)e[a].start().update(o);for(var c=new Date,l=0;l<t.signers.length;++l){var u=t.signers[l];if(0===u.authenticatedAttributes.length){if(s!==r.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{u.authenticatedAttributesAsn1=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var f=i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[]),p=0;p<u.authenticatedAttributes.length;++p){var g=u.authenticatedAttributes[p];g.type===r.pki.oids.messageDigest?g.value=e[u.digestAlgorithm].digest():g.type===r.pki.oids.signingTime&&(g.value||(g.value=c)),f.value.push(d(g)),u.authenticatedAttributesAsn1.value.push(d(g))}o=i.toDer(f).getBytes(),u.md.start().update(o)}u.signature=u.key.sign(u.md,"RSASSA-PKCS1-V1_5")}t.signerInfos=h(t.signers)}},s.createEncryptedData=function(){var t=null;return t={type:r.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:r.pki.oids["aes256-CBC"]},fromAsn1:function(e){p(t,e,s.asn1.encryptedDataValidator)},decrypt:function(e){void 0!==e&&(t.encryptedContent.key=e),g(t)}},t},s.createEnvelopedData=function(){var t=null;return t={type:r.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:r.pki.oids["aes256-CBC"]},fromAsn1:function(e){var n=p(t,e,s.asn1.envelopedDataValidator);t.recipients=c(n.recipientInfos.value)},toAsn1:function(){return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.type).getBytes()),i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,l(t.recipients)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,f(t.encryptedContent))])])])},findRecipient:function(e){for(var n=e.issuer.attributes,r=0;r<t.recipients.length;++r){var i=t.recipients[r],s=i.issuer;if(i.serialNumber===e.serialNumber&&s.length===n.length){for(var o=!0,a=0;a<n.length;++a)if(s[a].type!==n[a].type||s[a].value!==n[a].value){o=!1;break}if(o)return i}}return null},decrypt:function(e,n){if(void 0===t.encryptedContent.key&&void 0!==e&&void 0!==n)switch(e.encryptedContent.algorithm){case r.pki.oids.rsaEncryption:case r.pki.oids.desCBC:var i=n.decrypt(e.encryptedContent.content);t.encryptedContent.key=r.util.createBuffer(i);break;default:throw new Error("Unsupported asymmetric cipher, OID "+e.encryptedContent.algorithm)}g(t)},addRecipient:function(e){t.recipients.push({version:0,issuer:e.issuer.attributes,serialNumber:e.serialNumber,encryptedContent:{algorithm:r.pki.oids.rsaEncryption,key:e.publicKey}})},encrypt:function(e,n){if(void 0===t.encryptedContent.content){var i,s,o;switch(n=n||t.encryptedContent.algorithm,e=e||t.encryptedContent.key,n){case r.pki.oids["aes128-CBC"]:i=16,s=16,o=r.aes.createEncryptionCipher;break;case r.pki.oids["aes192-CBC"]:i=24,s=16,o=r.aes.createEncryptionCipher;break;case r.pki.oids["aes256-CBC"]:i=32,s=16,o=r.aes.createEncryptionCipher;break;case r.pki.oids["des-EDE3-CBC"]:i=24,s=8,o=r.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+n)}if(void 0===e)e=r.util.createBuffer(r.random.getBytes(i));else if(e.length()!=i)throw new Error("Symmetric key has wrong length; got "+e.length()+" bytes, expected "+i+".");t.encryptedContent.algorithm=n,t.encryptedContent.key=e,t.encryptedContent.parameter=r.util.createBuffer(r.random.getBytes(s));var a=o(e);if(a.start(t.encryptedContent.parameter.copy()),a.update(t.content),!a.finish())throw new Error("Symmetric encryption failed.");t.encryptedContent.content=a.output}for(var c=0;c<t.recipients.length;++c){var l=t.recipients[c];if(void 0===l.encryptedContent.content)switch(l.encryptedContent.algorithm){case r.pki.oids.rsaEncryption:l.encryptedContent.content=l.encryptedContent.key.encrypt(t.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm)}}}},t}},7929:function(t,e,n){var r=n(6143);n(3655),n(8666);var i=r.asn1,s=t.exports=r.pkcs7asn1=r.pkcs7asn1||{};r.pkcs7=r.pkcs7||{},r.pkcs7.asn1=s;var o={name:"ContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};s.contentInfoValidator=o;var a={name:"EncryptedContentInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};s.envelopedDataValidator={name:"EnvelopedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},s.encryptedDataValidator={name:"EncryptedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)};var c={name:"SignerInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};s.signedDataValidator={name:"SignedData",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},o,{name:"SignedData.Certificates",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,capture:"signerInfos",optional:!0,value:[c]}]},s.recipientInfoValidator={name:"RecipientInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:i.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},4537:function(t,e,n){var r=n(6143);n(8666),n(3322),n(8584),function(){if(r.prime)t.exports=r.prime;else{var e=t.exports=r.prime=r.prime||{},n=r.jsbn.BigInteger,i=[6,4,2,4,2,4,6,2],s=new n(null);s.fromInt(30);var o=function(t,e){return t|e};e.generateProbablePrime=function(t,e,n){"function"===typeof e&&(n=e,e={}),e=e||{};var i=e.algorithm||"PRIMEINC";"string"===typeof i&&(i={name:i}),i.options=i.options||{};var s=e.prng||r.random,o={nextBytes:function(t){for(var e=s.getBytesSync(t.length),n=0;n<t.length;++n)t[n]=e.charCodeAt(n)}};if("PRIMEINC"===i.name)return a(t,o,i.options,n);throw new Error("Invalid prime generation algorithm: "+i.name)}}function a(t,e,n,r){return"workers"in n?u(t,e,n,r):c(t,e,n,r)}function c(t,e,n,r){var i=h(t,e),s=0,o=d(i.bitLength());"millerRabinTests"in n&&(o=n.millerRabinTests);var a=10;"maxBlockTime"in n&&(a=n.maxBlockTime),l(i,t,e,s,o,a,r)}function l(t,e,n,s,o,a,c){var u=+new Date;do{if(t.bitLength()>e&&(t=h(e,n)),t.isProbablePrime(o))return c(null,t);t.dAddOffset(i[s++%8],0)}while(a<0||+new Date-u<a);r.util.setImmediate((function(){l(t,e,n,s,o,a,c)}))}function u(t,e,i,s){if("undefined"===typeof Worker)return c(t,e,i,s);var o=h(t,e),a=i.workers,l=i.workLoad||100,u=30*l/8,d=i.workerScript||"forge/prime.worker.js";if(-1===a)return r.util.estimateCores((function(t,e){t&&(e=2),a=e-1,f()}));function f(){a=Math.max(1,a);for(var r=[],i=0;i<a;++i)r[i]=new Worker(d);for(i=0;i<a;++i)r[i].addEventListener("message",f);var c=!1;function f(i){if(!c){0;var a=i.data;if(a.found){for(var d=0;d<r.length;++d)r[d].terminate();return c=!0,s(null,new n(a.prime,16))}o.bitLength()>t&&(o=h(t,e));var f=o.toString(16);i.target.postMessage({hex:f,workLoad:l}),o.dAddOffset(u,0)}}}f()}function h(t,e){var r=new n(t,e),i=t-1;return r.testBit(i)||r.bitwiseTo(n.ONE.shiftLeft(i),o,r),r.dAddOffset(31-r.mod(s).byteValue(),0),r}function d(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}}()},3772:function(t,e,n){n(3767),n(8585),n(8696);var r=n(6143);n(8666);var i=null;!r.util.isNodejs||r.options.usePureJavaScript||process.versions["node-webkit"]||(i=n(5745));var s=t.exports=r.prng=r.prng||{};s.create=function(t){for(var e={plugin:t,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},n=t.md,s=new Array(32),o=0;o<32;++o)s[o]=n.create();function a(t){if(e.pools[0].messageLength>=32)return l(),t();var n=32-e.pools[0].messageLength<<5;e.seedFile(n,(function(n,r){if(n)return t(n);e.collect(r),l(),t()}))}function c(){if(e.pools[0].messageLength>=32)return l();var t=32-e.pools[0].messageLength<<5;e.collect(e.seedFileSync(t)),l()}function l(){e.reseeds=4294967295===e.reseeds?0:e.reseeds+1;var t=e.plugin.md.create();t.update(e.keyBytes);for(var n=1,r=0;r<32;++r)e.reseeds%n===0&&(t.update(e.pools[r].digest().getBytes()),e.pools[r].start()),n<<=1;e.keyBytes=t.digest().getBytes(),t.start(),t.update(e.keyBytes);var i=t.digest().getBytes();e.key=e.plugin.formatKey(e.keyBytes),e.seed=e.plugin.formatSeed(i),e.generated=0}function u(t){var e=null,n=r.util.globalScope,i=n.crypto||n.msCrypto;i&&i.getRandomValues&&(e=function(t){return i.getRandomValues(t)});var s=r.util.createBuffer();if(e)while(s.length()<t){var o=Math.max(1,Math.min(t-s.length(),65536)/4),a=new Uint32Array(Math.floor(o));try{e(a);for(var c=0;c<a.length;++c)s.putInt32(a[c])}catch(f){if(!("undefined"!==typeof QuotaExceededError&&f instanceof QuotaExceededError))throw f}}if(s.length()<t){var l,u,h,d=Math.floor(65536*Math.random());while(s.length()<t){u=16807*(65535&d),l=16807*(d>>16),u+=(32767&l)<<16,u+=l>>15,u=(2147483647&u)+(u>>31),d=4294967295&u;for(c=0;c<3;++c)h=d>>>(c<<3),h^=Math.floor(256*Math.random()),s.putByte(255&h)}}return s.getBytes(t)}return e.pools=s,e.pool=0,e.generate=function(t,n){if(!n)return e.generateSync(t);var i=e.plugin.cipher,s=e.plugin.increment,o=e.plugin.formatKey,c=e.plugin.formatSeed,l=r.util.createBuffer();function u(h){if(h)return n(h);if(l.length()>=t)return n(null,l.getBytes(t));if(e.generated>1048575&&(e.key=null),null===e.key)return r.util.nextTick((function(){a(u)}));var d=i(e.key,e.seed);e.generated+=d.length,l.putBytes(d),e.key=o(i(e.key,s(e.seed))),e.seed=c(i(e.key,e.seed)),r.util.setImmediate(u)}e.key=null,u()},e.generateSync=function(t){var n=e.plugin.cipher,i=e.plugin.increment,s=e.plugin.formatKey,o=e.plugin.formatSeed;e.key=null;var a=r.util.createBuffer();while(a.length()<t){e.generated>1048575&&(e.key=null),null===e.key&&c();var l=n(e.key,e.seed);e.generated+=l.length,a.putBytes(l),e.key=s(n(e.key,i(e.seed))),e.seed=o(n(e.key,e.seed))}return a.getBytes(t)},i?(e.seedFile=function(t,e){i.randomBytes(t,(function(t,n){if(t)return e(t);e(null,n.toString())}))},e.seedFileSync=function(t){return i.randomBytes(t).toString()}):(e.seedFile=function(t,e){try{e(null,u(t))}catch(n){e(n)}},e.seedFileSync=u),e.collect=function(t){for(var n=t.length,r=0;r<n;++r)e.pools[e.pool].update(t.substr(r,1)),e.pool=31===e.pool?0:e.pool+1},e.collectInt=function(t,n){for(var r="",i=0;i<n;i+=8)r+=String.fromCharCode(t>>i&255);e.collect(r)},e.registerWorker=function(t){if(t===self)e.seedFile=function(t,e){function n(t){var r=t.data;r.forge&&r.forge.prng&&(self.removeEventListener("message",n),e(r.forge.prng.err,r.forge.prng.bytes))}self.addEventListener("message",n),self.postMessage({forge:{prng:{needed:t}}})};else{var n=function(n){var r=n.data;r.forge&&r.forge.prng&&e.seedFile(r.forge.prng.needed,(function(e,n){t.postMessage({forge:{prng:{err:e,bytes:n}}})}))};t.addEventListener("message",n)}},e}},121:function(t,e,n){var r=n(6143);n(8584),n(8666);var i=t.exports=r.pss=r.pss||{};i.create=function(t){3===arguments.length&&(t={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var e,n=t.md,i=t.mgf,s=n.digestLength,o=t.salt||null;if("string"===typeof o&&(o=r.util.createBuffer(o)),"saltLength"in t)e=t.saltLength;else{if(null===o)throw new Error("Salt length not specified or specific salt not given.");e=o.length()}if(null!==o&&o.length()!==e)throw new Error("Given salt length does not match length of given salt.");var a=t.prng||r.random,c={encode:function(t,c){var l,u,h=c-1,d=Math.ceil(h/8),f=t.digest().getBytes();if(d<s+e+2)throw new Error("Message is too long to encrypt.");u=null===o?a.getBytesSync(e):o.bytes();var p=new r.util.ByteBuffer;p.fillWithByte(0,8),p.putBytes(f),p.putBytes(u),n.start(),n.update(p.getBytes());var g=n.digest().getBytes(),m=new r.util.ByteBuffer;m.fillWithByte(0,d-e-s-2),m.putByte(1),m.putBytes(u);var y=m.getBytes(),w=d-s-1,b=i.generate(g,w),v="";for(l=0;l<w;l++)v+=String.fromCharCode(y.charCodeAt(l)^b.charCodeAt(l));var E=65280>>8*d-h&255;return v=String.fromCharCode(v.charCodeAt(0)&~E)+v.substr(1),v+g+String.fromCharCode(188)},verify:function(t,o,a){var c,l=a-1,u=Math.ceil(l/8);if(o=o.substr(-u),u<s+e+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==o.charCodeAt(u-1))throw new Error("Encoded message does not end in 0xBC.");var h=u-s-1,d=o.substr(0,h),f=o.substr(h,s),p=65280>>8*u-l&255;if(0!==(d.charCodeAt(0)&p))throw new Error("Bits beyond keysize not zero as expected.");var g=i.generate(f,h),m="";for(c=0;c<h;c++)m+=String.fromCharCode(d.charCodeAt(c)^g.charCodeAt(c));m=String.fromCharCode(m.charCodeAt(0)&~p)+m.substr(1);var y=u-s-e-2;for(c=0;c<y;c++)if(0!==m.charCodeAt(c))throw new Error("Leftmost octets not zero as expected");if(1!==m.charCodeAt(y))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var w=m.substr(-e),b=new r.util.ByteBuffer;b.fillWithByte(0,8),b.putBytes(t),b.putBytes(w),n.start(),n.update(b.getBytes());var v=n.digest().getBytes();return f===v}};return c}},8584:function(t,e,n){var r=n(6143);n(6509),n(9650),n(3772),n(8666),function(){r.random&&r.random.getBytes?t.exports=r.random:function(e){var n={},i=new Array(4),s=r.util.createBuffer();function o(){var t=r.prng.create(n);return t.getBytes=function(e,n){return t.generate(e,n)},t.getBytesSync=function(e){return t.generate(e)},t}n.formatKey=function(t){var e=r.util.createBuffer(t);return t=new Array(4),t[0]=e.getInt32(),t[1]=e.getInt32(),t[2]=e.getInt32(),t[3]=e.getInt32(),r.aes._expandKey(t,!1)},n.formatSeed=function(t){var e=r.util.createBuffer(t);return t=new Array(4),t[0]=e.getInt32(),t[1]=e.getInt32(),t[2]=e.getInt32(),t[3]=e.getInt32(),t},n.cipher=function(t,e){return r.aes._updateBlock(t,e,i,!1),s.putInt32(i[0]),s.putInt32(i[1]),s.putInt32(i[2]),s.putInt32(i[3]),s.getBytes()},n.increment=function(t){return++t[3],t},n.md=r.md.sha256;var a=o(),c=null,l=r.util.globalScope,u=l.crypto||l.msCrypto;if(u&&u.getRandomValues&&(c=function(t){return u.getRandomValues(t)}),r.options.usePureJavaScript||!r.util.isNodejs&&!c){if("undefined"===typeof window||window.document,a.collectInt(+new Date,32),"undefined"!==typeof navigator){var h="";for(var d in navigator)try{"string"==typeof navigator[d]&&(h+=navigator[d])}catch(f){}a.collect(h),h=null}e&&(e().mousemove((function(t){a.collectInt(t.clientX,16),a.collectInt(t.clientY,16)})),e().keypress((function(t){a.collectInt(t.charCode,8)})))}if(r.random)for(var d in a)r.random[d]=a[d];else r.random=a;r.random.createInstance=o,t.exports=r.random}("undefined"!==typeof jQuery?jQuery:null)}()},3398:function(t,e,n){n(7658);var r=n(6143);n(8666);var i=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],s=[1,2,3,5],o=function(t,e){return t<<e&65535|(65535&t)>>16-e},a=function(t,e){return(65535&t)>>e|t<<16-e&65535};t.exports=r.rc2=r.rc2||{},r.rc2.expandKey=function(t,e){"string"===typeof t&&(t=r.util.createBuffer(t)),e=e||128;var n,s=t,o=t.length(),a=e,c=Math.ceil(a/8),l=255>>(7&a);for(n=o;n<128;n++)s.putByte(i[s.at(n-1)+s.at(n-o)&255]);for(s.setAt(128-c,i[s.at(128-c)&l]),n=127-c;n>=0;n--)s.setAt(n,i[s.at(n+1)^s.at(n+c)]);return s};var c=function(t,e,n){var i,c,l,u,h=!1,d=null,f=null,p=null,g=[];for(t=r.rc2.expandKey(t,e),l=0;l<64;l++)g.push(t.getInt16Le());n?(i=function(t){for(l=0;l<4;l++)t[l]+=g[u]+(t[(l+3)%4]&t[(l+2)%4])+(~t[(l+3)%4]&t[(l+1)%4]),t[l]=o(t[l],s[l]),u++},c=function(t){for(l=0;l<4;l++)t[l]+=g[63&t[(l+3)%4]]}):(i=function(t){for(l=3;l>=0;l--)t[l]=a(t[l],s[l]),t[l]-=g[u]+(t[(l+3)%4]&t[(l+2)%4])+(~t[(l+3)%4]&t[(l+1)%4]),u--},c=function(t){for(l=3;l>=0;l--)t[l]-=g[63&t[(l+3)%4]]});var m=function(t){var e=[];for(l=0;l<4;l++){var r=d.getInt16Le();null!==p&&(n?r^=p.getInt16Le():p.putInt16Le(r)),e.push(65535&r)}u=n?0:63;for(var i=0;i<t.length;i++)for(var s=0;s<t[i][0];s++)t[i][1](e);for(l=0;l<4;l++)null!==p&&(n?p.putInt16Le(e[l]):e[l]^=p.getInt16Le()),f.putInt16Le(e[l])},y=null;return y={start:function(t,e){t&&"string"===typeof t&&(t=r.util.createBuffer(t)),h=!1,d=r.util.createBuffer(),f=e||new r.util.createBuffer,p=t,y.output=f},update:function(t){h||d.putBuffer(t);while(d.length()>=8)m([[5,i],[1,c],[6,i],[1,c],[5,i]])},finish:function(t){var e=!0;if(n)if(t)e=t(8,d,!n);else{var r=8===d.length()?8:8-d.length();d.fillWithByte(r,r)}if(e&&(h=!0,y.update()),!n&&(e=0===d.length(),e))if(t)e=t(8,f,!n);else{var i=f.length(),s=f.at(i-1);s>i?e=!1:f.truncate(s)}return e}},y};r.rc2.startEncrypting=function(t,e,n){var i=r.rc2.createEncryptionCipher(t,128);return i.start(e,n),i},r.rc2.createEncryptionCipher=function(t,e){return c(t,e,!0)},r.rc2.startDecrypting=function(t,e,n){var i=r.rc2.createDecryptionCipher(t,128);return i.start(e,n),i},r.rc2.createDecryptionCipher=function(t,e){return c(t,e,!1)}},536:function(t,e,n){n(7658),n(3767),n(8585),n(8696);var r=n(6143);if(n(3655),n(3322),n(5828),n(8219),n(4537),n(8584),n(8666),"undefined"===typeof i)var i=r.jsbn.BigInteger;var s=r.util.isNodejs?n(5745):null,o=r.asn1,a=r.util;r.pki=r.pki||{},t.exports=r.pki.rsa=r.rsa=r.rsa||{};var c=r.pki,l=[6,4,2,4,2,4,6,2],u={name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},d={name:"RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},f=r.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},p={name:"DigestInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:o.Class.UNIVERSAL,type:o.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},g=function(t){var e;if(!(t.algorithm in c.oids)){var n=new Error("Unknown message digest algorithm.");throw n.algorithm=t.algorithm,n}e=c.oids[t.algorithm];var r=o.oidToDer(e).getBytes(),i=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]),s=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]);s.value.push(o.create(o.Class.UNIVERSAL,o.Type.OID,!1,r)),s.value.push(o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,""));var a=o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,t.digest().getBytes());return i.value.push(s),i.value.push(a),o.toDer(i).getBytes()},m=function(t,e,n){if(n)return t.modPow(e.e,e.n);if(!e.p||!e.q)return t.modPow(e.d,e.n);var s;e.dP||(e.dP=e.d.mod(e.p.subtract(i.ONE))),e.dQ||(e.dQ=e.d.mod(e.q.subtract(i.ONE))),e.qInv||(e.qInv=e.q.modInverse(e.p));do{s=new i(r.util.bytesToHex(r.random.getBytes(e.n.bitLength()/8)),16)}while(s.compareTo(e.n)>=0||!s.gcd(e.n).equals(i.ONE));t=t.multiply(s.modPow(e.e,e.n)).mod(e.n);var o=t.mod(e.p).modPow(e.dP,e.p),a=t.mod(e.q).modPow(e.dQ,e.q);while(o.compareTo(a)<0)o=o.add(e.p);var c=o.subtract(a).multiply(e.qInv).mod(e.p).multiply(e.q).add(a);return c=c.multiply(s.modInverse(e.n)).mod(e.n),c};function y(t,e,n){var i=r.util.createBuffer(),s=Math.ceil(e.n.bitLength()/8);if(t.length>s-11){var o=new Error("Message is too long for PKCS#1 v1.5 padding.");throw o.length=t.length,o.max=s-11,o}i.putByte(0),i.putByte(n);var a,c=s-3-t.length;if(0===n||1===n){a=0===n?0:255;for(var l=0;l<c;++l)i.putByte(a)}else while(c>0){var u=0,h=r.random.getBytes(c);for(l=0;l<c;++l)a=h.charCodeAt(l),0===a?++u:i.putByte(a);c=u}return i.putByte(0),i.putBytes(t),i}function w(t,e,n,i){var s=Math.ceil(e.n.bitLength()/8),o=r.util.createBuffer(t),a=o.getByte(),c=o.getByte();if(0!==a||n&&0!==c&&1!==c||!n&&2!=c||n&&0===c&&"undefined"===typeof i)throw new Error("Encryption block is invalid.");var l=0;if(0===c){l=s-3-i;for(var u=0;u<l;++u)if(0!==o.getByte())throw new Error("Encryption block is invalid.")}else if(1===c){l=0;while(o.length()>1){if(255!==o.getByte()){--o.read;break}++l}}else if(2===c){l=0;while(o.length()>1){if(0===o.getByte()){--o.read;break}++l}}var h=o.getByte();if(0!==h||l!==s-3-o.length())throw new Error("Encryption block is invalid.");return o.getBytes()}function b(t,e,n){"function"===typeof e&&(n=e,e={}),e=e||{};var s={algorithm:{name:e.algorithm||"PRIMEINC",options:{workers:e.workers||2,workLoad:e.workLoad||100,workerScript:e.workerScript}}};function o(){a(t.pBits,(function(e,r){return e?n(e):(t.p=r,null!==t.q?l(e,t.q):void a(t.qBits,l))}))}function a(t,e){r.prime.generateProbablePrime(t,s,e)}function l(e,r){if(e)return n(e);if(t.q=r,t.p.compareTo(t.q)<0){var s=t.p;t.p=t.q,t.q=s}if(0!==t.p.subtract(i.ONE).gcd(t.e).compareTo(i.ONE))return t.p=null,void o();if(0!==t.q.subtract(i.ONE).gcd(t.e).compareTo(i.ONE))return t.q=null,void a(t.qBits,l);if(t.p1=t.p.subtract(i.ONE),t.q1=t.q.subtract(i.ONE),t.phi=t.p1.multiply(t.q1),0!==t.phi.gcd(t.e).compareTo(i.ONE))return t.p=t.q=null,void o();if(t.n=t.p.multiply(t.q),t.n.bitLength()!==t.bits)return t.q=null,void a(t.qBits,l);var u=t.e.modInverse(t.phi);t.keys={privateKey:c.rsa.setPrivateKey(t.n,t.e,u,t.p,t.q,u.mod(t.p1),u.mod(t.q1),t.q.modInverse(t.p)),publicKey:c.rsa.setPublicKey(t.n,t.e)},n(null,t.keys)}"prng"in e&&(s.prng=e.prng),o()}function v(t){var e=t.toString(16);e[0]>="8"&&(e="00"+e);var n=r.util.hexToBytes(e);return n.length>1&&(0===n.charCodeAt(0)&&0===(128&n.charCodeAt(1))||255===n.charCodeAt(0)&&128===(128&n.charCodeAt(1)))?n.substr(1):n}function E(t){return t<=100?27:t<=150?18:t<=200?15:t<=250?12:t<=300?9:t<=350?8:t<=400?7:t<=500?6:t<=600?5:t<=800?4:t<=1250?3:2}function _(t){return r.util.isNodejs&&"function"===typeof s[t]}function S(t){return"undefined"!==typeof a.globalScope&&"object"===typeof a.globalScope.crypto&&"object"===typeof a.globalScope.crypto.subtle&&"function"===typeof a.globalScope.crypto.subtle[t]}function A(t){return"undefined"!==typeof a.globalScope&&"object"===typeof a.globalScope.msCrypto&&"object"===typeof a.globalScope.msCrypto.subtle&&"function"===typeof a.globalScope.msCrypto.subtle[t]}function C(t){for(var e=r.util.hexToBytes(t.toString(16)),n=new Uint8Array(e.length),i=0;i<e.length;++i)n[i]=e.charCodeAt(i);return n}c.rsa.encrypt=function(t,e,n){var s,o=n,a=Math.ceil(e.n.bitLength()/8);!1!==n&&!0!==n?(o=2===n,s=y(t,e,n)):(s=r.util.createBuffer(),s.putBytes(t));var c=new i(s.toHex(),16),l=m(c,e,o),u=l.toString(16),h=r.util.createBuffer(),d=a-Math.ceil(u.length/2);while(d>0)h.putByte(0),--d;return h.putBytes(r.util.hexToBytes(u)),h.getBytes()},c.rsa.decrypt=function(t,e,n,s){var o=Math.ceil(e.n.bitLength()/8);if(t.length!==o){var a=new Error("Encrypted message length is invalid.");throw a.length=t.length,a.expected=o,a}var c=new i(r.util.createBuffer(t).toHex(),16);if(c.compareTo(e.n)>=0)throw new Error("Encrypted message is invalid.");var l=m(c,e,n),u=l.toString(16),h=r.util.createBuffer(),d=o-Math.ceil(u.length/2);while(d>0)h.putByte(0),--d;return h.putBytes(r.util.hexToBytes(u)),!1!==s?w(h.getBytes(),e,n):h.getBytes()},c.rsa.createKeyPairGenerationState=function(t,e,n){"string"===typeof t&&(t=parseInt(t,10)),t=t||2048,n=n||{};var s,o=n.prng||r.random,a={nextBytes:function(t){for(var e=o.getBytesSync(t.length),n=0;n<t.length;++n)t[n]=e.charCodeAt(n)}},c=n.algorithm||"PRIMEINC";if("PRIMEINC"!==c)throw new Error("Invalid key generation algorithm: "+c);return s={algorithm:c,state:0,bits:t,rng:a,eInt:e||65537,e:new i(null),p:null,q:null,qBits:t>>1,pBits:t-(t>>1),pqState:0,num:null,keys:null},s.e.fromInt(s.eInt),s},c.rsa.stepKeyPairGenerationState=function(t,e){"algorithm"in t||(t.algorithm="PRIMEINC");var n=new i(null);n.fromInt(30);var r,s=0,o=function(t,e){return t|e},a=+new Date,u=0;while(null===t.keys&&(e<=0||u<e)){if(0===t.state){var h=null===t.p?t.pBits:t.qBits,d=h-1;0===t.pqState?(t.num=new i(h,t.rng),t.num.testBit(d)||t.num.bitwiseTo(i.ONE.shiftLeft(d),o,t.num),t.num.dAddOffset(31-t.num.mod(n).byteValue(),0),s=0,++t.pqState):1===t.pqState?t.num.bitLength()>h?t.pqState=0:t.num.isProbablePrime(E(t.num.bitLength()))?++t.pqState:t.num.dAddOffset(l[s++%8],0):2===t.pqState?t.pqState=0===t.num.subtract(i.ONE).gcd(t.e).compareTo(i.ONE)?3:0:3===t.pqState&&(t.pqState=0,null===t.p?t.p=t.num:t.q=t.num,null!==t.p&&null!==t.q&&++t.state,t.num=null)}else if(1===t.state)t.p.compareTo(t.q)<0&&(t.num=t.p,t.p=t.q,t.q=t.num),++t.state;else if(2===t.state)t.p1=t.p.subtract(i.ONE),t.q1=t.q.subtract(i.ONE),t.phi=t.p1.multiply(t.q1),++t.state;else if(3===t.state)0===t.phi.gcd(t.e).compareTo(i.ONE)?++t.state:(t.p=null,t.q=null,t.state=0);else if(4===t.state)t.n=t.p.multiply(t.q),t.n.bitLength()===t.bits?++t.state:(t.q=null,t.state=0);else if(5===t.state){var f=t.e.modInverse(t.phi);t.keys={privateKey:c.rsa.setPrivateKey(t.n,t.e,f,t.p,t.q,f.mod(t.p1),f.mod(t.q1),t.q.modInverse(t.p)),publicKey:c.rsa.setPublicKey(t.n,t.e)}}r=+new Date,u+=r-a,a=r}return null!==t.keys},c.rsa.generateKeyPair=function(t,e,n,i){if(1===arguments.length?"object"===typeof t?(n=t,t=void 0):"function"===typeof t&&(i=t,t=void 0):2===arguments.length?"number"===typeof t?"function"===typeof e?(i=e,e=void 0):"number"!==typeof e&&(n=e,e=void 0):(n=t,i=e,t=void 0,e=void 0):3===arguments.length&&("number"===typeof e?"function"===typeof n&&(i=n,n=void 0):(i=n,n=e,e=void 0)),n=n||{},void 0===t&&(t=n.bits||2048),void 0===e&&(e=n.e||65537),!r.options.usePureJavaScript&&!n.prng&&t>=256&&t<=16384&&(65537===e||3===e))if(i){if(_("generateKeyPair"))return s.generateKeyPair("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(t,e,n){if(t)return i(t);i(null,{privateKey:c.privateKeyFromPem(n),publicKey:c.publicKeyFromPem(e)})}));if(S("generateKey")&&S("exportKey"))return a.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:C(e),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(t){return a.globalScope.crypto.subtle.exportKey("pkcs8",t.privateKey)})).then(void 0,(function(t){i(t)})).then((function(t){if(t){var e=c.privateKeyFromAsn1(o.fromDer(r.util.createBuffer(t)));i(null,{privateKey:e,publicKey:c.setRsaPublicKey(e.n,e.e)})}}));if(A("generateKey")&&A("exportKey")){var l=a.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:C(e),hash:{name:"SHA-256"}},!0,["sign","verify"]);return l.oncomplete=function(t){var e=t.target.result,n=a.globalScope.msCrypto.subtle.exportKey("pkcs8",e.privateKey);n.oncomplete=function(t){var e=t.target.result,n=c.privateKeyFromAsn1(o.fromDer(r.util.createBuffer(e)));i(null,{privateKey:n,publicKey:c.setRsaPublicKey(n.n,n.e)})},n.onerror=function(t){i(t)}},void(l.onerror=function(t){i(t)})}}else if(_("generateKeyPairSync")){var u=s.generateKeyPairSync("rsa",{modulusLength:t,publicExponent:e,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:c.privateKeyFromPem(u.privateKey),publicKey:c.publicKeyFromPem(u.publicKey)}}var h=c.rsa.createKeyPairGenerationState(t,e,n);if(!i)return c.rsa.stepKeyPairGenerationState(h,0),h.keys;b(h,n,i)},c.setRsaPublicKey=c.rsa.setPublicKey=function(t,e){var n={n:t,e:e,encrypt:function(t,e,i){if("string"===typeof e?e=e.toUpperCase():void 0===e&&(e="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===e)e={encode:function(t,e,n){return y(t,e,2).getBytes()}};else if("RSA-OAEP"===e||"RSAES-OAEP"===e)e={encode:function(t,e){return r.pkcs1.encode_rsa_oaep(e,t,i)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(e))e={encode:function(t){return t}};else if("string"===typeof e)throw new Error('Unsupported encryption scheme: "'+e+'".');var s=e.encode(t,n,!0);return c.rsa.encrypt(s,n,!0)},verify:function(t,e,i,s){"string"===typeof i?i=i.toUpperCase():void 0===i&&(i="RSASSA-PKCS1-V1_5"),void 0===s&&(s={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in s||(s._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===i?i={verify:function(t,e){e=w(e,n,!0);var i=o.fromDer(e,{parseAllBytes:s._parseAllDigestBytes}),a={},c=[];if(!o.validate(i,p,a,c)){var l=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw l.errors=c,l}var u=o.derToOid(a.algorithmIdentifier);if(u!==r.oids.md2&&u!==r.oids.md5&&u!==r.oids.sha1&&u!==r.oids.sha224&&u!==r.oids.sha256&&u!==r.oids.sha384&&u!==r.oids.sha512&&u!==r.oids["sha512-224"]&&u!==r.oids["sha512-256"]){l=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw l.oid=u,l}if((u===r.oids.md2||u===r.oids.md5)&&!("parameters"in a))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return t===a.digest}}:"NONE"!==i&&"NULL"!==i&&null!==i||(i={verify:function(t,e){return e=w(e,n,!0),t===e}});var a=c.rsa.decrypt(e,n,!0,!1);return i.verify(t,a,n.n.bitLength())}};return n},c.setRsaPrivateKey=c.rsa.setPrivateKey=function(t,e,n,i,s,o,a,l){var u={n:t,e:e,d:n,p:i,q:s,dP:o,dQ:a,qInv:l,decrypt:function(t,e,n){"string"===typeof e?e=e.toUpperCase():void 0===e&&(e="RSAES-PKCS1-V1_5");var i=c.rsa.decrypt(t,u,!1,!1);if("RSAES-PKCS1-V1_5"===e)e={decode:w};else if("RSA-OAEP"===e||"RSAES-OAEP"===e)e={decode:function(t,e){return r.pkcs1.decode_rsa_oaep(e,t,n)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(e))throw new Error('Unsupported encryption scheme: "'+e+'".');e={decode:function(t){return t}}}return e.decode(i,u,!1)},sign:function(t,e){var n=!1;"string"===typeof e&&(e=e.toUpperCase()),void 0===e||"RSASSA-PKCS1-V1_5"===e?(e={encode:g},n=1):"NONE"!==e&&"NULL"!==e&&null!==e||(e={encode:function(){return t}},n=1);var r=e.encode(t,u.n.bitLength());return c.rsa.encrypt(r,u,n)}};return u},c.wrapRsaPrivateKey=function(t){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,o.toDer(t).getBytes())])},c.privateKeyFromAsn1=function(t){var e,n,s,a,l,d,f,p,g={},m=[];if(o.validate(t,u,g,m)&&(t=o.fromDer(r.util.createBuffer(g.privateKey))),g={},m=[],!o.validate(t,h,g,m)){var y=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw y.errors=m,y}return e=r.util.createBuffer(g.privateKeyModulus).toHex(),n=r.util.createBuffer(g.privateKeyPublicExponent).toHex(),s=r.util.createBuffer(g.privateKeyPrivateExponent).toHex(),a=r.util.createBuffer(g.privateKeyPrime1).toHex(),l=r.util.createBuffer(g.privateKeyPrime2).toHex(),d=r.util.createBuffer(g.privateKeyExponent1).toHex(),f=r.util.createBuffer(g.privateKeyExponent2).toHex(),p=r.util.createBuffer(g.privateKeyCoefficient).toHex(),c.setRsaPrivateKey(new i(e,16),new i(n,16),new i(s,16),new i(a,16),new i(l,16),new i(d,16),new i(f,16),new i(p,16))},c.privateKeyToAsn1=c.privateKeyToRSAPrivateKey=function(t){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.e)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.d)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.p)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.q)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.dP)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.dQ)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.qInv))])},c.publicKeyFromAsn1=function(t){var e={},n=[];if(o.validate(t,f,e,n)){var s=o.derToOid(e.publicKeyOid);if(s!==c.oids.rsaEncryption){var a=new Error("Cannot read public key. Unknown OID.");throw a.oid=s,a}t=e.rsaPublicKey}if(n=[],!o.validate(t,d,e,n)){a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw a.errors=n,a}var l=r.util.createBuffer(e.publicKeyModulus).toHex(),u=r.util.createBuffer(e.publicKeyExponent).toHex();return c.setRsaPublicKey(new i(l,16),new i(u,16))},c.publicKeyToAsn1=c.publicKeyToSubjectPublicKeyInfo=function(t){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.BITSTRING,!1,[c.publicKeyToRSAPublicKey(t)])])},c.publicKeyToRSAPublicKey=function(t){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(t.e))])}},8927:function(t,e,n){n(7658);var r=n(6143);n(2713),n(8666);var i=t.exports=r.sha1=r.sha1||{};r.md.sha1=r.md.algorithms.sha1=i,i.create=function(){o||a();var t=null,e=r.util.createBuffer(),n=new Array(80),i={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var n=i.messageLengthSize/4,s=0;s<n;++s)i.fullMessageLength.push(0);return e=r.util.createBuffer(),t={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},i}};return i.start(),i.update=function(s,o){"utf8"===o&&(s=r.util.encodeUtf8(s));var a=s.length;i.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var l=i.fullMessageLength.length-1;l>=0;--l)i.fullMessageLength[l]+=a[1],a[1]=a[0]+(i.fullMessageLength[l]/4294967296>>>0),i.fullMessageLength[l]=i.fullMessageLength[l]>>>0,a[0]=a[1]/4294967296>>>0;return e.putBytes(s),c(t,n,e),(e.read>2048||0===e.length())&&e.compact(),i},i.digest=function(){var o=r.util.createBuffer();o.putBytes(e.bytes());var a,l,u=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize,h=u&i.blockLength-1;o.putBytes(s.substr(0,i.blockLength-h));for(var d=8*i.fullMessageLength[0],f=0;f<i.fullMessageLength.length-1;++f)a=8*i.fullMessageLength[f+1],l=a/4294967296>>>0,d+=l,o.putInt32(d>>>0),d=a>>>0;o.putInt32(d);var p={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4};c(p,n,o);var g=r.util.createBuffer();return g.putInt32(p.h0),g.putInt32(p.h1),g.putInt32(p.h2),g.putInt32(p.h3),g.putInt32(p.h4),g},i};var s=null,o=!1;function a(){s=String.fromCharCode(128),s+=r.util.fillString(String.fromCharCode(0),64),o=!0}function c(t,e,n){var r,i,s,o,a,c,l,u,h=n.length();while(h>=64){for(i=t.h0,s=t.h1,o=t.h2,a=t.h3,c=t.h4,u=0;u<16;++u)r=n.getInt32(),e[u]=r,l=a^s&(o^a),r=(i<<5|i>>>27)+l+c+1518500249+r,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=r;for(;u<20;++u)r=e[u-3]^e[u-8]^e[u-14]^e[u-16],r=r<<1|r>>>31,e[u]=r,l=a^s&(o^a),r=(i<<5|i>>>27)+l+c+1518500249+r,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=r;for(;u<32;++u)r=e[u-3]^e[u-8]^e[u-14]^e[u-16],r=r<<1|r>>>31,e[u]=r,l=s^o^a,r=(i<<5|i>>>27)+l+c+1859775393+r,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=r;for(;u<40;++u)r=e[u-6]^e[u-16]^e[u-28]^e[u-32],r=r<<2|r>>>30,e[u]=r,l=s^o^a,r=(i<<5|i>>>27)+l+c+1859775393+r,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=r;for(;u<60;++u)r=e[u-6]^e[u-16]^e[u-28]^e[u-32],r=r<<2|r>>>30,e[u]=r,l=s&o|a&(s^o),r=(i<<5|i>>>27)+l+c+2400959708+r,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=r;for(;u<80;++u)r=e[u-6]^e[u-16]^e[u-28]^e[u-32],r=r<<2|r>>>30,e[u]=r,l=s^o^a,r=(i<<5|i>>>27)+l+c+3395469782+r,c=a,a=o,o=(s<<30|s>>>2)>>>0,s=i,i=r;t.h0=t.h0+i|0,t.h1=t.h1+s|0,t.h2=t.h2+o|0,t.h3=t.h3+a|0,t.h4=t.h4+c|0,h-=64}}},9650:function(t,e,n){n(7658);var r=n(6143);n(2713),n(8666);var i=t.exports=r.sha256=r.sha256||{};r.md.sha256=r.md.algorithms.sha256=i,i.create=function(){o||c();var t=null,e=r.util.createBuffer(),n=new Array(64),i={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){i.messageLength=0,i.fullMessageLength=i.messageLength64=[];for(var n=i.messageLengthSize/4,s=0;s<n;++s)i.fullMessageLength.push(0);return e=r.util.createBuffer(),t={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},i}};return i.start(),i.update=function(s,o){"utf8"===o&&(s=r.util.encodeUtf8(s));var a=s.length;i.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=i.fullMessageLength.length-1;c>=0;--c)i.fullMessageLength[c]+=a[1],a[1]=a[0]+(i.fullMessageLength[c]/4294967296>>>0),i.fullMessageLength[c]=i.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return e.putBytes(s),l(t,n,e),(e.read>2048||0===e.length())&&e.compact(),i},i.digest=function(){var o=r.util.createBuffer();o.putBytes(e.bytes());var a,c,u=i.fullMessageLength[i.fullMessageLength.length-1]+i.messageLengthSize,h=u&i.blockLength-1;o.putBytes(s.substr(0,i.blockLength-h));for(var d=8*i.fullMessageLength[0],f=0;f<i.fullMessageLength.length-1;++f)a=8*i.fullMessageLength[f+1],c=a/4294967296>>>0,d+=c,o.putInt32(d>>>0),d=a>>>0;o.putInt32(d);var p={h0:t.h0,h1:t.h1,h2:t.h2,h3:t.h3,h4:t.h4,h5:t.h5,h6:t.h6,h7:t.h7};l(p,n,o);var g=r.util.createBuffer();return g.putInt32(p.h0),g.putInt32(p.h1),g.putInt32(p.h2),g.putInt32(p.h3),g.putInt32(p.h4),g.putInt32(p.h5),g.putInt32(p.h6),g.putInt32(p.h7),g},i};var s=null,o=!1,a=null;function c(){s=String.fromCharCode(128),s+=r.util.fillString(String.fromCharCode(0),64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=!0}function l(t,e,n){var r,i,s,o,c,l,u,h,d,f,p,g,m,y,w,b=n.length();while(b>=64){for(u=0;u<16;++u)e[u]=n.getInt32();for(;u<64;++u)r=e[u-2],r=(r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,i=e[u-15],i=(i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3,e[u]=r+e[u-7]+i+e[u-16]|0;for(h=t.h0,d=t.h1,f=t.h2,p=t.h3,g=t.h4,m=t.h5,y=t.h6,w=t.h7,u=0;u<64;++u)o=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),c=y^g&(m^y),s=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),l=h&d|f&(h^d),r=w+o+c+a[u]+e[u],i=s+l,w=y,y=m,m=g,g=p+r>>>0,p=f,f=d,d=h,h=r+i>>>0;t.h0=t.h0+h|0,t.h1=t.h1+d|0,t.h2=t.h2+f|0,t.h3=t.h3+p|0,t.h4=t.h4+g|0,t.h5=t.h5+m|0,t.h6=t.h6+y|0,t.h7=t.h7+w|0,b-=64}}},517:function(t,e,n){n(7658);var r=n(6143);n(2713),n(8666);var i=t.exports=r.sha512=r.sha512||{};r.md.sha512=r.md.algorithms.sha512=i;var s=r.sha384=r.sha512.sha384=r.sha512.sha384||{};s.create=function(){return i.create("SHA-384")},r.md.sha384=r.md.algorithms.sha384=s,r.sha512.sha256=r.sha512.sha256||{create:function(){return i.create("SHA-512/256")}},r.md["sha512/256"]=r.md.algorithms["sha512/256"]=r.sha512.sha256,r.sha512.sha224=r.sha512.sha224||{create:function(){return i.create("SHA-512/224")}},r.md["sha512/224"]=r.md.algorithms["sha512/224"]=r.sha512.sha224,i.create=function(t){if(a||u(),"undefined"===typeof t&&(t="SHA-512"),!(t in l))throw new Error("Invalid SHA-512 algorithm: "+t);for(var e=l[t],n=null,i=r.util.createBuffer(),s=new Array(80),c=0;c<80;++c)s[c]=new Array(2);var d=64;switch(t){case"SHA-384":d=48;break;case"SHA-512/256":d=32;break;case"SHA-512/224":d=28;break}var f={algorithm:t.replace("-","").toLowerCase(),blockLength:128,digestLength:d,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){f.messageLength=0,f.fullMessageLength=f.messageLength128=[];for(var t=f.messageLengthSize/4,s=0;s<t;++s)f.fullMessageLength.push(0);i=r.util.createBuffer(),n=new Array(e.length);for(s=0;s<e.length;++s)n[s]=e[s].slice(0);return f}};return f.start(),f.update=function(t,e){"utf8"===e&&(t=r.util.encodeUtf8(t));var o=t.length;f.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=f.fullMessageLength.length-1;a>=0;--a)f.fullMessageLength[a]+=o[1],o[1]=o[0]+(f.fullMessageLength[a]/4294967296>>>0),f.fullMessageLength[a]=f.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return i.putBytes(t),h(n,s,i),(i.read>2048||0===i.length())&&i.compact(),f},f.digest=function(){var e=r.util.createBuffer();e.putBytes(i.bytes());var a,c,l=f.fullMessageLength[f.fullMessageLength.length-1]+f.messageLengthSize,u=l&f.blockLength-1;e.putBytes(o.substr(0,f.blockLength-u));for(var d=8*f.fullMessageLength[0],p=0;p<f.fullMessageLength.length-1;++p)a=8*f.fullMessageLength[p+1],c=a/4294967296>>>0,d+=c,e.putInt32(d>>>0),d=a>>>0;e.putInt32(d);var g=new Array(n.length);for(p=0;p<n.length;++p)g[p]=n[p].slice(0);h(g,s,e);var m,y=r.util.createBuffer();m="SHA-512"===t?g.length:"SHA-384"===t?g.length-2:g.length-4;for(p=0;p<m;++p)y.putInt32(g[p][0]),p===m-1&&"SHA-512/224"===t||y.putInt32(g[p][1]);return y},f};var o=null,a=!1,c=null,l=null;function u(){o=String.fromCharCode(128),o+=r.util.fillString(String.fromCharCode(0),128),c=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],l={},l["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],l["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],l["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],l["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],a=!0}function h(t,e,n){var r,i,s,o,a,l,u,h,d,f,p,g,m,y,w,b,v,E,_,S,A,C,I,T,k,R,N,D,O,P,x,M,L,B,U,F=n.length();while(F>=128){for(O=0;O<16;++O)e[O][0]=n.getInt32()>>>0,e[O][1]=n.getInt32()>>>0;for(;O<80;++O)M=e[O-2],P=M[0],x=M[1],r=((P>>>19|x<<13)^(x>>>29|P<<3)^P>>>6)>>>0,i=((P<<13|x>>>19)^(x<<3|P>>>29)^(P<<26|x>>>6))>>>0,B=e[O-15],P=B[0],x=B[1],s=((P>>>1|x<<31)^(P>>>8|x<<24)^P>>>7)>>>0,o=((P<<31|x>>>1)^(P<<24|x>>>8)^(P<<25|x>>>7))>>>0,L=e[O-7],U=e[O-16],x=i+L[1]+o+U[1],e[O][0]=r+L[0]+s+U[0]+(x/4294967296>>>0)>>>0,e[O][1]=x>>>0;for(m=t[0][0],y=t[0][1],w=t[1][0],b=t[1][1],v=t[2][0],E=t[2][1],_=t[3][0],S=t[3][1],A=t[4][0],C=t[4][1],I=t[5][0],T=t[5][1],k=t[6][0],R=t[6][1],N=t[7][0],D=t[7][1],O=0;O<80;++O)u=((A>>>14|C<<18)^(A>>>18|C<<14)^(C>>>9|A<<23))>>>0,h=((A<<18|C>>>14)^(A<<14|C>>>18)^(C<<23|A>>>9))>>>0,d=(k^A&(I^k))>>>0,f=(R^C&(T^R))>>>0,a=((m>>>28|y<<4)^(y>>>2|m<<30)^(y>>>7|m<<25))>>>0,l=((m<<4|y>>>28)^(y<<30|m>>>2)^(y<<25|m>>>7))>>>0,p=(m&w|v&(m^w))>>>0,g=(y&b|E&(y^b))>>>0,x=D+h+f+c[O][1]+e[O][1],r=N+u+d+c[O][0]+e[O][0]+(x/4294967296>>>0)>>>0,i=x>>>0,x=l+g,s=a+p+(x/4294967296>>>0)>>>0,o=x>>>0,N=k,D=R,k=I,R=T,I=A,T=C,x=S+i,A=_+r+(x/4294967296>>>0)>>>0,C=x>>>0,_=v,S=E,v=w,E=b,w=m,b=y,x=i+o,m=r+s+(x/4294967296>>>0)>>>0,y=x>>>0;x=t[0][1]+y,t[0][0]=t[0][0]+m+(x/4294967296>>>0)>>>0,t[0][1]=x>>>0,x=t[1][1]+b,t[1][0]=t[1][0]+w+(x/4294967296>>>0)>>>0,t[1][1]=x>>>0,x=t[2][1]+E,t[2][0]=t[2][0]+v+(x/4294967296>>>0)>>>0,t[2][1]=x>>>0,x=t[3][1]+S,t[3][0]=t[3][0]+_+(x/4294967296>>>0)>>>0,t[3][1]=x>>>0,x=t[4][1]+C,t[4][0]=t[4][0]+A+(x/4294967296>>>0)>>>0,t[4][1]=x>>>0,x=t[5][1]+T,t[5][0]=t[5][0]+I+(x/4294967296>>>0)>>>0,t[5][1]=x>>>0,x=t[6][1]+R,t[6][0]=t[6][0]+k+(x/4294967296>>>0)>>>0,t[6][1]=x>>>0,x=t[7][1]+D,t[7][0]=t[7][0]+N+(x/4294967296>>>0)>>>0,t[7][1]=x>>>0,F-=128}}},8666:function(t,e,n){n(4633),n(7658),n(3767),n(8585),n(8696),n(541);var r=n(6143),i=n(3441),s=t.exports=r.util=r.util||{};function o(t){if(8!==t&&16!==t&&24!==t&&32!==t)throw new Error("Only 8, 16, 24, or 32 bits supported: "+t)}function a(t){if(this.data="",this.read=0,"string"===typeof t)this.data=t;else if(s.isArrayBuffer(t)||s.isArrayBufferView(t))if("undefined"!==typeof Buffer&&t instanceof Buffer)this.data=t.toString("binary");else{var e=new Uint8Array(t);try{this.data=String.fromCharCode.apply(null,e)}catch(r){for(var n=0;n<e.length;++n)this.putByte(e[n])}}else(t instanceof a||"object"===typeof t&&"string"===typeof t.data&&"number"===typeof t.read)&&(this.data=t.data,this.read=t.read);this._constructedStringLength=0}(function(){if("undefined"!==typeof process&&process.nextTick&&!process.browser)return s.nextTick=process.nextTick,void("function"===typeof setImmediate?s.setImmediate=setImmediate:s.setImmediate=s.nextTick);if("function"===typeof setImmediate)return s.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(s.nextTick=function(t){return setImmediate(t)});if(s.setImmediate=function(t){setTimeout(t,0)},"undefined"!==typeof window&&"function"===typeof window.postMessage){var t="forge.setImmediate",e=[];function n(n){if(n.source===window&&n.data===t){n.stopPropagation();var r=e.slice();e.length=0,r.forEach((function(t){t()}))}}s.setImmediate=function(n){e.push(n),1===e.length&&window.postMessage(t,"*")},window.addEventListener("message",n,!0)}if("undefined"!==typeof MutationObserver){var r=Date.now(),i=!0,o=document.createElement("div");e=[];new MutationObserver((function(){var t=e.slice();e.length=0,t.forEach((function(t){t()}))})).observe(o,{attributes:!0});var a=s.setImmediate;s.setImmediate=function(t){Date.now()-r>15?(r=Date.now(),a(t)):(e.push(t),1===e.length&&o.setAttribute("a",i=!i))}}s.nextTick=s.setImmediate})(),s.isNodejs="undefined"!==typeof process&&process.versions&&process.versions.node,s.globalScope=function(){return s.isNodejs?n.g:"undefined"===typeof self?window:self}(),s.isArray=Array.isArray||function(t){return"[object Array]"===Object.prototype.toString.call(t)},s.isArrayBuffer=function(t){return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer},s.isArrayBufferView=function(t){return t&&s.isArrayBuffer(t.buffer)&&void 0!==t.byteLength},s.ByteBuffer=a,s.ByteStringBuffer=a;var c=4096;function l(t,e){e=e||{},this.read=e.readOffset||0,this.growSize=e.growSize||1024;var n=s.isArrayBuffer(t),r=s.isArrayBufferView(t);if(n||r)return this.data=n?new DataView(t):new DataView(t.buffer,t.byteOffset,t.byteLength),void(this.write="writeOffset"in e?e.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==t&&void 0!==t&&this.putBytes(t),"writeOffset"in e&&(this.write=e.writeOffset)}s.ByteStringBuffer.prototype._optimizeConstructedString=function(t){this._constructedStringLength+=t,this._constructedStringLength>c&&(this.data.substr(0,1),this._constructedStringLength=0)},s.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},s.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},s.ByteStringBuffer.prototype.putByte=function(t){return this.putBytes(String.fromCharCode(t))},s.ByteStringBuffer.prototype.fillWithByte=function(t,e){t=String.fromCharCode(t);var n=this.data;while(e>0)1&e&&(n+=t),e>>>=1,e>0&&(t+=t);return this.data=n,this._optimizeConstructedString(e),this},s.ByteStringBuffer.prototype.putBytes=function(t){return this.data+=t,this._optimizeConstructedString(t.length),this},s.ByteStringBuffer.prototype.putString=function(t){return this.putBytes(s.encodeUtf8(t))},s.ByteStringBuffer.prototype.putInt16=function(t){return this.putBytes(String.fromCharCode(t>>8&255)+String.fromCharCode(255&t))},s.ByteStringBuffer.prototype.putInt24=function(t){return this.putBytes(String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t))},s.ByteStringBuffer.prototype.putInt32=function(t){return this.putBytes(String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t))},s.ByteStringBuffer.prototype.putInt16Le=function(t){return this.putBytes(String.fromCharCode(255&t)+String.fromCharCode(t>>8&255))},s.ByteStringBuffer.prototype.putInt24Le=function(t){return this.putBytes(String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255))},s.ByteStringBuffer.prototype.putInt32Le=function(t){return this.putBytes(String.fromCharCode(255&t)+String.fromCharCode(t>>8&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>24&255))},s.ByteStringBuffer.prototype.putInt=function(t,e){o(e);var n="";do{e-=8,n+=String.fromCharCode(t>>e&255)}while(e>0);return this.putBytes(n)},s.ByteStringBuffer.prototype.putSignedInt=function(t,e){return t<0&&(t+=2<<e-1),this.putInt(t,e)},s.ByteStringBuffer.prototype.putBuffer=function(t){return this.putBytes(t.getBytes())},s.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},s.ByteStringBuffer.prototype.getInt16=function(){var t=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,t},s.ByteStringBuffer.prototype.getInt24=function(){var t=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,t},s.ByteStringBuffer.prototype.getInt32=function(){var t=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,t},s.ByteStringBuffer.prototype.getInt16Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,t},s.ByteStringBuffer.prototype.getInt24Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,t},s.ByteStringBuffer.prototype.getInt32Le=function(){var t=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,t},s.ByteStringBuffer.prototype.getInt=function(t){o(t);var e=0;do{e=(e<<8)+this.data.charCodeAt(this.read++),t-=8}while(t>0);return e},s.ByteStringBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),n=2<<t-2;return e>=n&&(e-=n<<1),e},s.ByteStringBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):0===t?e="":(e=0===this.read?this.data:this.data.slice(this.read),this.clear()),e},s.ByteStringBuffer.prototype.bytes=function(t){return"undefined"===typeof t?this.data.slice(this.read):this.data.slice(this.read,this.read+t)},s.ByteStringBuffer.prototype.at=function(t){return this.data.charCodeAt(this.read+t)},s.ByteStringBuffer.prototype.setAt=function(t,e){return this.data=this.data.substr(0,this.read+t)+String.fromCharCode(e)+this.data.substr(this.read+t+1),this},s.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},s.ByteStringBuffer.prototype.copy=function(){var t=s.createBuffer(this.data);return t.read=this.read,t},s.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},s.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},s.ByteStringBuffer.prototype.truncate=function(t){var e=Math.max(0,this.length()-t);return this.data=this.data.substr(this.read,e),this.read=0,this},s.ByteStringBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.length;++e){var n=this.data.charCodeAt(e);n<16&&(t+="0"),t+=n.toString(16)}return t},s.ByteStringBuffer.prototype.toString=function(){return s.decodeUtf8(this.bytes())},s.DataBuffer=l,s.DataBuffer.prototype.length=function(){return this.write-this.read},s.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},s.DataBuffer.prototype.accommodate=function(t,e){if(this.length()>=t)return this;e=Math.max(e||this.growSize,t);var n=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),r=new Uint8Array(this.length()+e);return r.set(n),this.data=new DataView(r.buffer),this},s.DataBuffer.prototype.putByte=function(t){return this.accommodate(1),this.data.setUint8(this.write++,t),this},s.DataBuffer.prototype.fillWithByte=function(t,e){this.accommodate(e);for(var n=0;n<e;++n)this.data.setUint8(t);return this},s.DataBuffer.prototype.putBytes=function(t,e){if(s.isArrayBufferView(t)){var n=new Uint8Array(t.buffer,t.byteOffset,t.byteLength),r=n.byteLength-n.byteOffset;this.accommodate(r);var i=new Uint8Array(this.data.buffer,this.write);return i.set(n),this.write+=r,this}if(s.isArrayBuffer(t)){n=new Uint8Array(t);this.accommodate(n.byteLength);i=new Uint8Array(this.data.buffer);return i.set(n,this.write),this.write+=n.byteLength,this}if(t instanceof s.DataBuffer||"object"===typeof t&&"number"===typeof t.read&&"number"===typeof t.write&&s.isArrayBufferView(t.data)){n=new Uint8Array(t.data.byteLength,t.read,t.length());this.accommodate(n.byteLength);i=new Uint8Array(t.data.byteLength,this.write);return i.set(n),this.write+=n.byteLength,this}if(t instanceof s.ByteStringBuffer&&(t=t.data,e="binary"),e=e||"binary","string"===typeof t){var o;if("hex"===e)return this.accommodate(Math.ceil(t.length/2)),o=new Uint8Array(this.data.buffer,this.write),this.write+=s.binary.hex.decode(t,o,this.write),this;if("base64"===e)return this.accommodate(3*Math.ceil(t.length/4)),o=new Uint8Array(this.data.buffer,this.write),this.write+=s.binary.base64.decode(t,o,this.write),this;if("utf8"===e&&(t=s.encodeUtf8(t),e="binary"),"binary"===e||"raw"===e)return this.accommodate(t.length),o=new Uint8Array(this.data.buffer,this.write),this.write+=s.binary.raw.decode(o),this;if("utf16"===e)return this.accommodate(2*t.length),o=new Uint16Array(this.data.buffer,this.write),this.write+=s.text.utf16.encode(o),this;throw new Error("Invalid encoding: "+e)}throw Error("Invalid parameter: "+t)},s.DataBuffer.prototype.putBuffer=function(t){return this.putBytes(t),t.clear(),this},s.DataBuffer.prototype.putString=function(t){return this.putBytes(t,"utf16")},s.DataBuffer.prototype.putInt16=function(t){return this.accommodate(2),this.data.setInt16(this.write,t),this.write+=2,this},s.DataBuffer.prototype.putInt24=function(t){return this.accommodate(3),this.data.setInt16(this.write,t>>8&65535),this.data.setInt8(this.write,t>>16&255),this.write+=3,this},s.DataBuffer.prototype.putInt32=function(t){return this.accommodate(4),this.data.setInt32(this.write,t),this.write+=4,this},s.DataBuffer.prototype.putInt16Le=function(t){return this.accommodate(2),this.data.setInt16(this.write,t,!0),this.write+=2,this},s.DataBuffer.prototype.putInt24Le=function(t){return this.accommodate(3),this.data.setInt8(this.write,t>>16&255),this.data.setInt16(this.write,t>>8&65535,!0),this.write+=3,this},s.DataBuffer.prototype.putInt32Le=function(t){return this.accommodate(4),this.data.setInt32(this.write,t,!0),this.write+=4,this},s.DataBuffer.prototype.putInt=function(t,e){o(e),this.accommodate(e/8);do{e-=8,this.data.setInt8(this.write++,t>>e&255)}while(e>0);return this},s.DataBuffer.prototype.putSignedInt=function(t,e){return o(e),this.accommodate(e/8),t<0&&(t+=2<<e-1),this.putInt(t,e)},s.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},s.DataBuffer.prototype.getInt16=function(){var t=this.data.getInt16(this.read);return this.read+=2,t},s.DataBuffer.prototype.getInt24=function(){var t=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,t},s.DataBuffer.prototype.getInt32=function(){var t=this.data.getInt32(this.read);return this.read+=4,t},s.DataBuffer.prototype.getInt16Le=function(){var t=this.data.getInt16(this.read,!0);return this.read+=2,t},s.DataBuffer.prototype.getInt24Le=function(){var t=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,t},s.DataBuffer.prototype.getInt32Le=function(){var t=this.data.getInt32(this.read,!0);return this.read+=4,t},s.DataBuffer.prototype.getInt=function(t){o(t);var e=0;do{e=(e<<8)+this.data.getInt8(this.read++),t-=8}while(t>0);return e},s.DataBuffer.prototype.getSignedInt=function(t){var e=this.getInt(t),n=2<<t-2;return e>=n&&(e-=n<<1),e},s.DataBuffer.prototype.getBytes=function(t){var e;return t?(t=Math.min(this.length(),t),e=this.data.slice(this.read,this.read+t),this.read+=t):0===t?e="":(e=0===this.read?this.data:this.data.slice(this.read),this.clear()),e},s.DataBuffer.prototype.bytes=function(t){return"undefined"===typeof t?this.data.slice(this.read):this.data.slice(this.read,this.read+t)},s.DataBuffer.prototype.at=function(t){return this.data.getUint8(this.read+t)},s.DataBuffer.prototype.setAt=function(t,e){return this.data.setUint8(t,e),this},s.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},s.DataBuffer.prototype.copy=function(){return new s.DataBuffer(this)},s.DataBuffer.prototype.compact=function(){if(this.read>0){var t=new Uint8Array(this.data.buffer,this.read),e=new Uint8Array(t.byteLength);e.set(t),this.data=new DataView(e),this.write-=this.read,this.read=0}return this},s.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},s.DataBuffer.prototype.truncate=function(t){return this.write=Math.max(0,this.length()-t),this.read=Math.min(this.read,this.write),this},s.DataBuffer.prototype.toHex=function(){for(var t="",e=this.read;e<this.data.byteLength;++e){var n=this.data.getUint8(e);n<16&&(t+="0"),t+=n.toString(16)}return t},s.DataBuffer.prototype.toString=function(t){var e=new Uint8Array(this.data,this.read,this.length());if(t=t||"utf8","binary"===t||"raw"===t)return s.binary.raw.encode(e);if("hex"===t)return s.binary.hex.encode(e);if("base64"===t)return s.binary.base64.encode(e);if("utf8"===t)return s.text.utf8.decode(e);if("utf16"===t)return s.text.utf16.decode(e);throw new Error("Invalid encoding: "+t)},s.createBuffer=function(t,e){return e=e||"raw",void 0!==t&&"utf8"===e&&(t=s.encodeUtf8(t)),new s.ByteBuffer(t)},s.fillString=function(t,e){var n="";while(e>0)1&e&&(n+=t),e>>>=1,e>0&&(t+=t);return n},s.xorBytes=function(t,e,n){for(var r="",i="",s="",o=0,a=0;n>0;--n,++o)i=t.charCodeAt(o)^e.charCodeAt(o),a>=10&&(r+=s,s="",a=0),s+=String.fromCharCode(i),++a;return r+=s,r},s.hexToBytes=function(t){var e="",n=0;for(!0&t.length&&(n=1,e+=String.fromCharCode(parseInt(t[0],16)));n<t.length;n+=2)e+=String.fromCharCode(parseInt(t.substr(n,2),16));return e},s.bytesToHex=function(t){return s.createBuffer(t).toHex()},s.int32ToBytes=function(t){return String.fromCharCode(t>>24&255)+String.fromCharCode(t>>16&255)+String.fromCharCode(t>>8&255)+String.fromCharCode(255&t)};var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],d="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";s.encode64=function(t,e){var n,r,i,s="",o="",a=0;while(a<t.length)n=t.charCodeAt(a++),r=t.charCodeAt(a++),i=t.charCodeAt(a++),s+=u.charAt(n>>2),s+=u.charAt((3&n)<<4|r>>4),isNaN(r)?s+="==":(s+=u.charAt((15&r)<<2|i>>6),s+=isNaN(i)?"=":u.charAt(63&i)),e&&s.length>e&&(o+=s.substr(0,e)+"\r\n",s=s.substr(e));return o+=s,o},s.decode64=function(t){t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");var e,n,r,i,s="",o=0;while(o<t.length)e=h[t.charCodeAt(o++)-43],n=h[t.charCodeAt(o++)-43],r=h[t.charCodeAt(o++)-43],i=h[t.charCodeAt(o++)-43],s+=String.fromCharCode(e<<2|n>>4),64!==r&&(s+=String.fromCharCode((15&n)<<4|r>>2),64!==i&&(s+=String.fromCharCode((3&r)<<6|i)));return s},s.encodeUtf8=function(t){return unescape(encodeURIComponent(t))},s.decodeUtf8=function(t){return decodeURIComponent(escape(t))},s.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:i.encode,decode:i.decode}},s.binary.raw.encode=function(t){return String.fromCharCode.apply(null,t)},s.binary.raw.decode=function(t,e,n){var r=e;r||(r=new Uint8Array(t.length)),n=n||0;for(var i=n,s=0;s<t.length;++s)r[i++]=t.charCodeAt(s);return e?i-n:r},s.binary.hex.encode=s.bytesToHex,s.binary.hex.decode=function(t,e,n){var r=e;r||(r=new Uint8Array(Math.ceil(t.length/2))),n=n||0;var i=0,s=n;for(1&t.length&&(i=1,r[s++]=parseInt(t[0],16));i<t.length;i+=2)r[s++]=parseInt(t.substr(i,2),16);return e?s-n:r},s.binary.base64.encode=function(t,e){var n,r,i,s="",o="",a=0;while(a<t.byteLength)n=t[a++],r=t[a++],i=t[a++],s+=u.charAt(n>>2),s+=u.charAt((3&n)<<4|r>>4),isNaN(r)?s+="==":(s+=u.charAt((15&r)<<2|i>>6),s+=isNaN(i)?"=":u.charAt(63&i)),e&&s.length>e&&(o+=s.substr(0,e)+"\r\n",s=s.substr(e));return o+=s,o},s.binary.base64.decode=function(t,e,n){var r,i,s,o,a=e;a||(a=new Uint8Array(3*Math.ceil(t.length/4))),t=t.replace(/[^A-Za-z0-9\+\/\=]/g,""),n=n||0;var c=0,l=n;while(c<t.length)r=h[t.charCodeAt(c++)-43],i=h[t.charCodeAt(c++)-43],s=h[t.charCodeAt(c++)-43],o=h[t.charCodeAt(c++)-43],a[l++]=r<<2|i>>4,64!==s&&(a[l++]=(15&i)<<4|s>>2,64!==o&&(a[l++]=(3&s)<<6|o));return e?l-n:a.subarray(0,l)},s.binary.base58.encode=function(t,e){return s.binary.baseN.encode(t,d,e)},s.binary.base58.decode=function(t,e){return s.binary.baseN.decode(t,d,e)},s.text={utf8:{},utf16:{}},s.text.utf8.encode=function(t,e,n){t=s.encodeUtf8(t);var r=e;r||(r=new Uint8Array(t.length)),n=n||0;for(var i=n,o=0;o<t.length;++o)r[i++]=t.charCodeAt(o);return e?i-n:r},s.text.utf8.decode=function(t){return s.decodeUtf8(String.fromCharCode.apply(null,t))},s.text.utf16.encode=function(t,e,n){var r=e;r||(r=new Uint8Array(2*t.length));var i=new Uint16Array(r.buffer);n=n||0;for(var s=n,o=n,a=0;a<t.length;++a)i[o++]=t.charCodeAt(a),s+=2;return e?s-n:r},s.text.utf16.decode=function(t){return String.fromCharCode.apply(null,new Uint16Array(t.buffer))},s.deflate=function(t,e,n){if(e=s.decode64(t.deflate(s.encode64(e)).rval),n){var r=2,i=e.charCodeAt(1);32&i&&(r=6),e=e.substring(r,e.length-4)}return e},s.inflate=function(t,e,n){var r=t.inflate(s.encode64(e)).rval;return null===r?null:s.decode64(r)};var f=function(t,e,n){if(!t)throw new Error("WebStorage not available.");var r;if(null===n?r=t.removeItem(e):(n=s.encode64(JSON.stringify(n)),r=t.setItem(e,n)),"undefined"!==typeof r&&!0!==r.rval){var i=new Error(r.error.message);throw i.id=r.error.id,i.name=r.error.name,i}},p=function(t,e){if(!t)throw new Error("WebStorage not available.");var n=t.getItem(e);if(t.init)if(null===n.rval){if(n.error){var r=new Error(n.error.message);throw r.id=n.error.id,r.name=n.error.name,r}n=null}else n=n.rval;return null!==n&&(n=JSON.parse(s.decode64(n))),n},g=function(t,e,n,r){var i=p(t,e);null===i&&(i={}),i[n]=r,f(t,e,i)},m=function(t,e,n){var r=p(t,e);return null!==r&&(r=n in r?r[n]:null),r},y=function(t,e,n){var r=p(t,e);if(null!==r&&n in r){delete r[n];var i=!0;for(var s in r){i=!1;break}i&&(r=null),f(t,e,r)}},w=function(t,e){f(t,e,null)},b=function(t,e,n){var r,i=null;"undefined"===typeof n&&(n=["web","flash"]);var s=!1,o=null;for(var a in n){r=n[a];try{if("flash"===r||"both"===r){if(null===e[0])throw new Error("Flash local storage not available.");i=t.apply(this,e),s="flash"===r}"web"!==r&&"both"!==r||(e[0]=localStorage,i=t.apply(this,e),s=!0)}catch(c){o=c}if(s)break}if(!s)throw o;return i};s.setItem=function(t,e,n,r,i){b(g,arguments,i)},s.getItem=function(t,e,n,r){return b(m,arguments,r)},s.removeItem=function(t,e,n,r){b(y,arguments,r)},s.clearItems=function(t,e,n){b(w,arguments,n)},s.isEmpty=function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0},s.format=function(t){var e,n,r=/%./g,i=0,s=[],o=0;while(e=r.exec(t)){n=t.substring(o,r.lastIndex-2),n.length>0&&s.push(n),o=r.lastIndex;var a=e[0][1];switch(a){case"s":case"o":i<arguments.length?s.push(arguments[1+i++]):s.push("<?>");break;case"%":s.push("%");break;default:s.push("<%"+a+"?>")}}return s.push(t.substring(o)),s.join("")},s.formatNumber=function(t,e,n,r){var i=t,s=isNaN(e=Math.abs(e))?2:e,o=void 0===n?",":n,a=void 0===r?".":r,c=i<0?"-":"",l=parseInt(i=Math.abs(+i||0).toFixed(s),10)+"",u=l.length>3?l.length%3:0;return c+(u?l.substr(0,u)+a:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(s?o+Math.abs(i-l).toFixed(s).slice(2):"")},s.formatSize=function(t){return t=t>=1073741824?s.formatNumber(t/1073741824,2,".","")+" GiB":t>=1048576?s.formatNumber(t/1048576,2,".","")+" MiB":t>=1024?s.formatNumber(t/1024,0)+" KiB":s.formatNumber(t,0)+" bytes",t},s.bytesFromIP=function(t){return-1!==t.indexOf(".")?s.bytesFromIPv4(t):-1!==t.indexOf(":")?s.bytesFromIPv6(t):null},s.bytesFromIPv4=function(t){if(t=t.split("."),4!==t.length)return null;for(var e=s.createBuffer(),n=0;n<t.length;++n){var r=parseInt(t[n],10);if(isNaN(r))return null;e.putByte(r)}return e.getBytes()},s.bytesFromIPv6=function(t){var e=0;t=t.split(":").filter((function(t){return 0===t.length&&++e,!0}));for(var n=2*(8-t.length+e),r=s.createBuffer(),i=0;i<8;++i)if(t[i]&&0!==t[i].length){var o=s.hexToBytes(t[i]);o.length<2&&r.putByte(0),r.putBytes(o)}else r.fillWithByte(0,n),n=0;return r.getBytes()},s.bytesToIP=function(t){return 4===t.length?s.bytesToIPv4(t):16===t.length?s.bytesToIPv6(t):null},s.bytesToIPv4=function(t){if(4!==t.length)return null;for(var e=[],n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e.join(".")},s.bytesToIPv6=function(t){if(16!==t.length)return null;for(var e=[],n=[],r=0,i=0;i<t.length;i+=2){var o=s.bytesToHex(t[i]+t[i+1]);while("0"===o[0]&&"0"!==o)o=o.substr(1);if("0"===o){var a=n[n.length-1],c=e.length;a&&c===a.end+1?(a.end=c,a.end-a.start>n[r].end-n[r].start&&(r=n.length-1)):n.push({start:c,end:c})}e.push(o)}if(n.length>0){var l=n[r];l.end-l.start>0&&(e.splice(l.start,l.end-l.start+1,""),0===l.start&&e.unshift(""),7===l.end&&e.push(""))}return e.join(":")},s.estimateCores=function(t,e){if("function"===typeof t&&(e=t,t={}),t=t||{},"cores"in s&&!t.update)return e(null,s.cores);if("undefined"!==typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return s.cores=navigator.hardwareConcurrency,e(null,s.cores);if("undefined"===typeof Worker)return s.cores=1,e(null,s.cores);if("undefined"===typeof Blob)return s.cores=2,e(null,s.cores);var n=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(t){var e=Date.now(),n=e+4;while(Date.now()<n);self.postMessage({st:e,et:n})}))}.toString(),")()"],{type:"application/javascript"}));function r(t,a,c){if(0===a){var l=Math.floor(t.reduce((function(t,e){return t+e}),0)/t.length);return s.cores=Math.max(1,l),URL.revokeObjectURL(n),e(null,s.cores)}i(c,(function(e,n){t.push(o(c,n)),r(t,a-1,c)}))}function i(t,e){for(var r=[],i=[],s=0;s<t;++s){var o=new Worker(n);o.addEventListener("message",(function(n){if(i.push(n.data),i.length===t){for(var s=0;s<t;++s)r[s].terminate();e(null,i)}})),r.push(o)}for(s=0;s<t;++s)r[s].postMessage(s)}function o(t,e){for(var n=[],r=0;r<t;++r)for(var i=e[r],s=n[r]=[],o=0;o<t;++o)if(r!==o){var a=e[o];(i.st>a.st&&i.st<a.et||a.st>i.st&&a.st<i.et)&&s.push(o)}return n.reduce((function(t,e){return Math.max(t,e.length)}),0)}r([],5,16)}},4760:function(t,e,n){n(7658);var r=n(6143);n(6509),n(3655),n(1202),n(2713),n(3232),n(5828),n(8277),n(121),n(536),n(8666);var i=r.asn1,s=t.exports=r.pki=r.pki||{},o=s.oids,a={};a["CN"]=o["commonName"],a["commonName"]="CN",a["C"]=o["countryName"],a["countryName"]="C",a["L"]=o["localityName"],a["localityName"]="L",a["ST"]=o["stateOrProvinceName"],a["stateOrProvinceName"]="ST",a["O"]=o["organizationName"],a["organizationName"]="O",a["OU"]=o["organizationalUnitName"],a["organizationalUnitName"]="OU",a["E"]=o["emailAddress"],a["emailAddress"]="E";var c=r.pki.rsa.publicKeyValidator,l={name:"Certificate",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:i.Class.UNIVERSAL,type:i.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:i.Class.UNIVERSAL,type:i.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:i.Class.UNIVERSAL,type:i.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},c,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:i.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:i.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},u={name:"rsapss",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:i.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:i.Class.UNIVERSAL,type:i.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:i.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:i.Class.UNIVERSAL,type:i.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:i.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:i.Class.UNIVERSAL,type:i.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},h={name:"CertificationRequestInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},c,{name:"CertificationRequestInfo.attributes",tagClass:i.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:i.Class.UNIVERSAL,type:i.Type.SET,constructed:!0}]}]}]},d={name:"CertificationRequest",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[h,{name:"CertificationRequest.signatureAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:i.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:i.Class.UNIVERSAL,type:i.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function f(t,e){"string"===typeof e&&(e={shortName:e});for(var n,r=null,i=0;null===r&&i<t.attributes.length;++i)n=t.attributes[i],(e.type&&e.type===n.type||e.name&&e.name===n.name||e.shortName&&e.shortName===n.shortName)&&(r=n);return r}s.RDNAttributesAsArray=function(t,e){for(var n,r,s,c=[],l=0;l<t.value.length;++l){n=t.value[l];for(var u=0;u<n.value.length;++u)s={},r=n.value[u],s.type=i.derToOid(r.value[0].value),s.value=r.value[1].value,s.valueTagClass=r.value[1].type,s.type in o&&(s.name=o[s.type],s.name in a&&(s.shortName=a[s.name])),e&&(e.update(s.type),e.update(s.value)),c.push(s)}return c},s.CRIAttributesAsArray=function(t){for(var e=[],n=0;n<t.length;++n)for(var r=t[n],c=i.derToOid(r.value[0].value),l=r.value[1].value,u=0;u<l.length;++u){var h={};if(h.type=c,h.value=l[u].value,h.valueTagClass=l[u].type,h.type in o&&(h.name=o[h.type],h.name in a&&(h.shortName=a[h.name])),h.type===o.extensionRequest){h.extensions=[];for(var d=0;d<h.value.length;++d)h.extensions.push(s.certificateExtensionFromAsn1(h.value[d]))}e.push(h)}return e};var p=function(t,e,n){var r={};if(t!==o["RSASSA-PSS"])return r;n&&(r={hash:{algorithmOid:o["sha1"]},mgf:{algorithmOid:o["mgf1"],hash:{algorithmOid:o["sha1"]}},saltLength:20});var s={},a=[];if(!i.validate(e,u,s,a)){var c=new Error("Cannot read RSASSA-PSS parameter block.");throw c.errors=a,c}return void 0!==s.hashOid&&(r.hash=r.hash||{},r.hash.algorithmOid=i.derToOid(s.hashOid)),void 0!==s.maskGenOid&&(r.mgf=r.mgf||{},r.mgf.algorithmOid=i.derToOid(s.maskGenOid),r.mgf.hash=r.mgf.hash||{},r.mgf.hash.algorithmOid=i.derToOid(s.maskGenHashOid)),void 0!==s.saltLength&&(r.saltLength=s.saltLength.charCodeAt(0)),r},g=function(t){switch(o[t.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return r.md.sha1.create();case"md5WithRSAEncryption":return r.md.md5.create();case"sha256WithRSAEncryption":return r.md.sha256.create();case"sha384WithRSAEncryption":return r.md.sha384.create();case"sha512WithRSAEncryption":return r.md.sha512.create();case"RSASSA-PSS":return r.md.sha256.create();default:var e=new Error("Could not compute "+t.type+" digest. Unknown signature OID.");throw e.signatureOid=t.signatureOid,e}},m=function(t){var e,n=t.certificate;switch(n.signatureOid){case o.sha1WithRSAEncryption:case o.sha1WithRSASignature:break;case o["RSASSA-PSS"]:var i,s;if(i=o[n.signatureParameters.mgf.hash.algorithmOid],void 0===i||void 0===r.md[i]){var a=new Error("Unsupported MGF hash function.");throw a.oid=n.signatureParameters.mgf.hash.algorithmOid,a.name=i,a}if(s=o[n.signatureParameters.mgf.algorithmOid],void 0===s||void 0===r.mgf[s]){a=new Error("Unsupported MGF function.");throw a.oid=n.signatureParameters.mgf.algorithmOid,a.name=s,a}if(s=r.mgf[s].create(r.md[i].create()),i=o[n.signatureParameters.hash.algorithmOid],void 0===i||void 0===r.md[i]){a=new Error("Unsupported RSASSA-PSS hash function.");throw a.oid=n.signatureParameters.hash.algorithmOid,a.name=i,a}e=r.pss.create(r.md[i].create(),s,n.signatureParameters.saltLength);break}return n.publicKey.verify(t.md.digest().getBytes(),t.signature,e)};function y(t){for(var e,n,s=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),o=t.attributes,a=0;a<o.length;++a){e=o[a];var c=e.value,l=i.Type.PRINTABLESTRING;"valueTagClass"in e&&(l=e.valueTagClass,l===i.Type.UTF8&&(c=r.util.encodeUtf8(c))),n=i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.type).getBytes()),i.create(i.Class.UNIVERSAL,l,!1,c)])]),s.value.push(n)}return s}function w(t){for(var e,n=0;n<t.length;++n){if(e=t[n],"undefined"===typeof e.name&&(e.type&&e.type in s.oids?e.name=s.oids[e.type]:e.shortName&&e.shortName in a&&(e.name=s.oids[a[e.shortName]])),"undefined"===typeof e.type){if(!e.name||!(e.name in s.oids)){var r=new Error("Attribute type not specified.");throw r.attribute=e,r}e.type=s.oids[e.name]}if("undefined"===typeof e.shortName&&e.name&&e.name in a&&(e.shortName=a[e.name]),e.type===o.extensionRequest&&(e.valueConstructed=!0,e.valueTagClass=i.Type.SEQUENCE,!e.value&&e.extensions)){e.value=[];for(var c=0;c<e.extensions.length;++c)e.value.push(s.certificateExtensionToAsn1(b(e.extensions[c])))}if("undefined"===typeof e.value){r=new Error("Attribute value not specified.");throw r.attribute=e,r}}}function b(t,e){if(e=e||{},"undefined"===typeof t.name&&t.id&&t.id in s.oids&&(t.name=s.oids[t.id]),"undefined"===typeof t.id){if(!t.name||!(t.name in s.oids)){var n=new Error("Extension ID not specified.");throw n.extension=t,n}t.id=s.oids[t.name]}if("undefined"!==typeof t.value)return t;if("keyUsage"===t.name){var a=0,c=0,l=0;t.digitalSignature&&(c|=128,a=7),t.nonRepudiation&&(c|=64,a=6),t.keyEncipherment&&(c|=32,a=5),t.dataEncipherment&&(c|=16,a=4),t.keyAgreement&&(c|=8,a=3),t.keyCertSign&&(c|=4,a=2),t.cRLSign&&(c|=2,a=1),t.encipherOnly&&(c|=1,a=0),t.decipherOnly&&(l|=128,a=7);var u=String.fromCharCode(a);0!==l?u+=String.fromCharCode(c)+String.fromCharCode(l):0!==c&&(u+=String.fromCharCode(c)),t.value=i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,u)}else if("basicConstraints"===t.name)t.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),t.cA&&t.value.value.push(i.create(i.Class.UNIVERSAL,i.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in t&&t.value.value.push(i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.pathLenConstraint).getBytes()));else if("extKeyUsage"===t.name){t.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);var h=t.value.value;for(var d in t)!0===t[d]&&(d in o?h.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o[d]).getBytes())):-1!==d.indexOf(".")&&h.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(d).getBytes())))}else if("nsCertType"===t.name){a=0,c=0;t.client&&(c|=128,a=7),t.server&&(c|=64,a=6),t.email&&(c|=32,a=5),t.objsign&&(c|=16,a=4),t.reserved&&(c|=8,a=3),t.sslCA&&(c|=4,a=2),t.emailCA&&(c|=2,a=1),t.objCA&&(c|=1,a=0);u=String.fromCharCode(a);0!==c&&(u+=String.fromCharCode(c)),t.value=i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,u)}else if("subjectAltName"===t.name||"issuerAltName"===t.name){t.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);for(var f=0;f<t.altNames.length;++f){b=t.altNames[f];u=b.value;if(7===b.type&&b.ip){if(u=r.util.bytesFromIP(b.ip),null===u){n=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw n.extension=t,n}}else 8===b.type&&(u=b.oid?i.oidToDer(i.oidToDer(b.oid)):i.oidToDer(u));t.value.value.push(i.create(i.Class.CONTEXT_SPECIFIC,b.type,!1,u))}}else if("nsComment"===t.name&&e.cert){if(!/^[\x00-\x7F]*$/.test(t.comment)||t.comment.length<1||t.comment.length>128)throw new Error('Invalid "nsComment" content.');t.value=i.create(i.Class.UNIVERSAL,i.Type.IA5STRING,!1,t.comment)}else if("subjectKeyIdentifier"===t.name&&e.cert){var p=e.cert.generateSubjectKeyIdentifier();t.subjectKeyIdentifier=p.toHex(),t.value=i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,p.getBytes())}else if("authorityKeyIdentifier"===t.name&&e.cert){t.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);h=t.value.value;if(t.keyIdentifier){var g=!0===t.keyIdentifier?e.cert.generateSubjectKeyIdentifier().getBytes():t.keyIdentifier;h.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!1,g))}if(t.authorityCertIssuer){var m=[i.create(i.Class.CONTEXT_SPECIFIC,4,!0,[y(!0===t.authorityCertIssuer?e.cert.issuer:t.authorityCertIssuer)])];h.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,m))}if(t.serialNumber){var w=r.util.hexToBytes(!0===t.serialNumber?e.cert.serialNumber:t.serialNumber);h.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!1,w))}}else if("cRLDistributionPoints"===t.name){t.value=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);h=t.value.value;var b,v=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]),E=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);for(f=0;f<t.altNames.length;++f){b=t.altNames[f];u=b.value;if(7===b.type&&b.ip){if(u=r.util.bytesFromIP(b.ip),null===u){n=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw n.extension=t,n}}else 8===b.type&&(u=b.oid?i.oidToDer(i.oidToDer(b.oid)):i.oidToDer(u));E.value.push(i.create(i.Class.CONTEXT_SPECIFIC,b.type,!1,u))}v.value.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[E])),h.push(v)}if("undefined"===typeof t.value){n=new Error("Extension value not specified.");throw n.extension=t,n}return t}function v(t,e){switch(t){case o["RSASSA-PSS"]:var n=[];return void 0!==e.hash.algorithmOid&&n.push(i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.hash.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])])),void 0!==e.mgf.algorithmOid&&n.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.mgf.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(e.mgf.hash.algorithmOid).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])])])),void 0!==e.saltLength&&n.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(e.saltLength).getBytes())])),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,n);default:return i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")}}function E(t){var e=i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===t.attributes.length)return e;for(var n=t.attributes,s=0;s<n.length;++s){var o=n[s],a=o.value,c=i.Type.UTF8;"valueTagClass"in o&&(c=o.valueTagClass),c===i.Type.UTF8&&(a=r.util.encodeUtf8(a));var l=!1;"valueConstructed"in o&&(l=o.valueConstructed);var u=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o.type).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SET,!0,[i.create(i.Class.UNIVERSAL,c,l,a)])]);e.value.push(u)}return e}s.certificateFromPem=function(t,e,n){var o=r.pem.decode(t)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var c=i.fromDer(o.body,n);return s.certificateFromAsn1(c,e)},s.certificateToPem=function(t,e){var n={type:"CERTIFICATE",body:i.toDer(s.certificateToAsn1(t)).getBytes()};return r.pem.encode(n,{maxline:e})},s.publicKeyFromPem=function(t){var e=r.pem.decode(t)[0];if("PUBLIC KEY"!==e.type&&"RSA PUBLIC KEY"!==e.type){var n=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw n.headerType=e.type,n}if(e.procType&&"ENCRYPTED"===e.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var o=i.fromDer(e.body);return s.publicKeyFromAsn1(o)},s.publicKeyToPem=function(t,e){var n={type:"PUBLIC KEY",body:i.toDer(s.publicKeyToAsn1(t)).getBytes()};return r.pem.encode(n,{maxline:e})},s.publicKeyToRSAPublicKeyPem=function(t,e){var n={type:"RSA PUBLIC KEY",body:i.toDer(s.publicKeyToRSAPublicKey(t)).getBytes()};return r.pem.encode(n,{maxline:e})},s.getPublicKeyFingerprint=function(t,e){e=e||{};var n,o=e.md||r.md.sha1.create(),a=e.type||"RSAPublicKey";switch(a){case"RSAPublicKey":n=i.toDer(s.publicKeyToRSAPublicKey(t)).getBytes();break;case"SubjectPublicKeyInfo":n=i.toDer(s.publicKeyToAsn1(t)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+e.type+'".')}o.start(),o.update(n);var c=o.digest();if("hex"===e.encoding){var l=c.toHex();return e.delimiter?l.match(/.{2}/g).join(e.delimiter):l}if("binary"===e.encoding)return c.getBytes();if(e.encoding)throw new Error('Unknown encoding "'+e.encoding+'".');return c},s.certificationRequestFromPem=function(t,e,n){var o=r.pem.decode(t)[0];if("CERTIFICATE REQUEST"!==o.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var c=i.fromDer(o.body,n);return s.certificationRequestFromAsn1(c,e)},s.certificationRequestToPem=function(t,e){var n={type:"CERTIFICATE REQUEST",body:i.toDer(s.certificationRequestToAsn1(t)).getBytes()};return r.pem.encode(n,{maxline:e})},s.createCertificate=function(){var t={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return t.siginfo.algorithmOid=null,t.validity={},t.validity.notBefore=new Date,t.validity.notAfter=new Date,t.issuer={},t.issuer.getField=function(e){return f(t.issuer,e)},t.issuer.addField=function(e){w([e]),t.issuer.attributes.push(e)},t.issuer.attributes=[],t.issuer.hash=null,t.subject={},t.subject.getField=function(e){return f(t.subject,e)},t.subject.addField=function(e){w([e]),t.subject.attributes.push(e)},t.subject.attributes=[],t.subject.hash=null,t.extensions=[],t.publicKey=null,t.md=null,t.setSubject=function(e,n){w(e),t.subject.attributes=e,delete t.subject.uniqueId,n&&(t.subject.uniqueId=n),t.subject.hash=null},t.setIssuer=function(e,n){w(e),t.issuer.attributes=e,delete t.issuer.uniqueId,n&&(t.issuer.uniqueId=n),t.issuer.hash=null},t.setExtensions=function(e){for(var n=0;n<e.length;++n)b(e[n],{cert:t});t.extensions=e},t.getExtension=function(e){"string"===typeof e&&(e={name:e});for(var n,r=null,i=0;null===r&&i<t.extensions.length;++i)n=t.extensions[i],(e.id&&n.id===e.id||e.name&&n.name===e.name)&&(r=n);return r},t.sign=function(e,n){t.md=n||r.md.sha1.create();var a=o[t.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw c.algorithm=t.md.algorithm,c}t.signatureOid=t.siginfo.algorithmOid=a,t.tbsCertificate=s.getTBSCertificate(t);var l=i.toDer(t.tbsCertificate);t.md.update(l.getBytes()),t.signature=e.sign(t.md)},t.verify=function(e){var n=!1;if(!t.issued(e)){var r=e.issuer,o=t.subject,a=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw a.expectedIssuer=o.attributes,a.actualIssuer=r.attributes,a}var c=e.md;if(null===c){c=g({signatureOid:e.signatureOid,type:"certificate"});var l=e.tbsCertificate||s.getTBSCertificate(e),u=i.toDer(l);c.update(u.getBytes())}return null!==c&&(n=m({certificate:t,md:c,signature:e.signature})),n},t.isIssuer=function(e){var n=!1,r=t.issuer,i=e.subject;if(r.hash&&i.hash)n=r.hash===i.hash;else if(r.attributes.length===i.attributes.length){var s,o;n=!0;for(var a=0;n&&a<r.attributes.length;++a)s=r.attributes[a],o=i.attributes[a],s.type===o.type&&s.value===o.value||(n=!1)}return n},t.issued=function(e){return e.isIssuer(t)},t.generateSubjectKeyIdentifier=function(){return s.getPublicKeyFingerprint(t.publicKey,{type:"RSAPublicKey"})},t.verifySubjectKeyIdentifier=function(){for(var e=o["subjectKeyIdentifier"],n=0;n<t.extensions.length;++n){var i=t.extensions[n];if(i.id===e){var s=t.generateSubjectKeyIdentifier().getBytes();return r.util.hexToBytes(i.subjectKeyIdentifier)===s}}return!1},t},s.certificateFromAsn1=function(t,e){var n={},o=[];if(!i.validate(t,l,n,o)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=o,a}var c=i.derToOid(n.publicKeyOid);if(c!==s.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var u=s.createCertificate();u.version=n.certVersion?n.certVersion.charCodeAt(0):0;var h=r.util.createBuffer(n.certSerialNumber);u.serialNumber=h.toHex(),u.signatureOid=r.asn1.derToOid(n.certSignatureOid),u.signatureParameters=p(u.signatureOid,n.certSignatureParams,!0),u.siginfo.algorithmOid=r.asn1.derToOid(n.certinfoSignatureOid),u.siginfo.parameters=p(u.siginfo.algorithmOid,n.certinfoSignatureParams,!1),u.signature=n.certSignature;var d=[];if(void 0!==n.certValidity1UTCTime&&d.push(i.utcTimeToDate(n.certValidity1UTCTime)),void 0!==n.certValidity2GeneralizedTime&&d.push(i.generalizedTimeToDate(n.certValidity2GeneralizedTime)),void 0!==n.certValidity3UTCTime&&d.push(i.utcTimeToDate(n.certValidity3UTCTime)),void 0!==n.certValidity4GeneralizedTime&&d.push(i.generalizedTimeToDate(n.certValidity4GeneralizedTime)),d.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(d.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(u.validity.notBefore=d[0],u.validity.notAfter=d[1],u.tbsCertificate=n.tbsCertificate,e){u.md=g({signatureOid:u.signatureOid,type:"certificate"});var m=i.toDer(u.tbsCertificate);u.md.update(m.getBytes())}var y=r.md.sha1.create(),b=i.toDer(n.certIssuer);y.update(b.getBytes()),u.issuer.getField=function(t){return f(u.issuer,t)},u.issuer.addField=function(t){w([t]),u.issuer.attributes.push(t)},u.issuer.attributes=s.RDNAttributesAsArray(n.certIssuer),n.certIssuerUniqueId&&(u.issuer.uniqueId=n.certIssuerUniqueId),u.issuer.hash=y.digest().toHex();var v=r.md.sha1.create(),E=i.toDer(n.certSubject);return v.update(E.getBytes()),u.subject.getField=function(t){return f(u.subject,t)},u.subject.addField=function(t){w([t]),u.subject.attributes.push(t)},u.subject.attributes=s.RDNAttributesAsArray(n.certSubject),n.certSubjectUniqueId&&(u.subject.uniqueId=n.certSubjectUniqueId),u.subject.hash=v.digest().toHex(),n.certExtensions?u.extensions=s.certificateExtensionsFromAsn1(n.certExtensions):u.extensions=[],u.publicKey=s.publicKeyFromAsn1(n.subjectPublicKeyInfo),u},s.certificateExtensionsFromAsn1=function(t){for(var e=[],n=0;n<t.value.length;++n)for(var r=t.value[n],i=0;i<r.value.length;++i)e.push(s.certificateExtensionFromAsn1(r.value[i]));return e},s.certificateExtensionFromAsn1=function(t){var e={};if(e.id=i.derToOid(t.value[0].value),e.critical=!1,t.value[1].type===i.Type.BOOLEAN?(e.critical=0!==t.value[1].value.charCodeAt(0),e.value=t.value[2].value):e.value=t.value[1].value,e.id in o)if(e.name=o[e.id],"keyUsage"===e.name){var n=i.fromDer(e.value),s=0,a=0;n.value.length>1&&(s=n.value.charCodeAt(1),a=n.value.length>2?n.value.charCodeAt(2):0),e.digitalSignature=128===(128&s),e.nonRepudiation=64===(64&s),e.keyEncipherment=32===(32&s),e.dataEncipherment=16===(16&s),e.keyAgreement=8===(8&s),e.keyCertSign=4===(4&s),e.cRLSign=2===(2&s),e.encipherOnly=1===(1&s),e.decipherOnly=128===(128&a)}else if("basicConstraints"===e.name){n=i.fromDer(e.value);n.value.length>0&&n.value[0].type===i.Type.BOOLEAN?e.cA=0!==n.value[0].value.charCodeAt(0):e.cA=!1;var c=null;n.value.length>0&&n.value[0].type===i.Type.INTEGER?c=n.value[0].value:n.value.length>1&&(c=n.value[1].value),null!==c&&(e.pathLenConstraint=i.derToInteger(c))}else if("extKeyUsage"===e.name){n=i.fromDer(e.value);for(var l=0;l<n.value.length;++l){var u=i.derToOid(n.value[l].value);u in o?e[o[u]]=!0:e[u]=!0}}else if("nsCertType"===e.name){n=i.fromDer(e.value),s=0;n.value.length>1&&(s=n.value.charCodeAt(1)),e.client=128===(128&s),e.server=64===(64&s),e.email=32===(32&s),e.objsign=16===(16&s),e.reserved=8===(8&s),e.sslCA=4===(4&s),e.emailCA=2===(2&s),e.objCA=1===(1&s)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){var h;e.altNames=[];n=i.fromDer(e.value);for(var d=0;d<n.value.length;++d){h=n.value[d];var f={type:h.type,value:h.value};switch(e.altNames.push(f),h.type){case 1:case 2:case 6:break;case 7:f.ip=r.util.bytesToIP(h.value);break;case 8:f.oid=i.derToOid(h.value);break;default:}}}else if("subjectKeyIdentifier"===e.name){n=i.fromDer(e.value);e.subjectKeyIdentifier=r.util.bytesToHex(n.value)}return e},s.certificationRequestFromAsn1=function(t,e){var n={},o=[];if(!i.validate(t,d,n,o)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=o,a}var c=i.derToOid(n.publicKeyOid);if(c!==s.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var l=s.createCertificationRequest();if(l.version=n.csrVersion?n.csrVersion.charCodeAt(0):0,l.signatureOid=r.asn1.derToOid(n.csrSignatureOid),l.signatureParameters=p(l.signatureOid,n.csrSignatureParams,!0),l.siginfo.algorithmOid=r.asn1.derToOid(n.csrSignatureOid),l.siginfo.parameters=p(l.siginfo.algorithmOid,n.csrSignatureParams,!1),l.signature=n.csrSignature,l.certificationRequestInfo=n.certificationRequestInfo,e){l.md=g({signatureOid:l.signatureOid,type:"certification request"});var u=i.toDer(l.certificationRequestInfo);l.md.update(u.getBytes())}var h=r.md.sha1.create();return l.subject.getField=function(t){return f(l.subject,t)},l.subject.addField=function(t){w([t]),l.subject.attributes.push(t)},l.subject.attributes=s.RDNAttributesAsArray(n.certificationRequestInfoSubject,h),l.subject.hash=h.digest().toHex(),l.publicKey=s.publicKeyFromAsn1(n.subjectPublicKeyInfo),l.getAttribute=function(t){return f(l,t)},l.addAttribute=function(t){w([t]),l.attributes.push(t)},l.attributes=s.CRIAttributesAsArray(n.certificationRequestInfoAttributes||[]),l},s.createCertificationRequest=function(){var t={version:0,signatureOid:null,signature:null,siginfo:{}};return t.siginfo.algorithmOid=null,t.subject={},t.subject.getField=function(e){return f(t.subject,e)},t.subject.addField=function(e){w([e]),t.subject.attributes.push(e)},t.subject.attributes=[],t.subject.hash=null,t.publicKey=null,t.attributes=[],t.getAttribute=function(e){return f(t,e)},t.addAttribute=function(e){w([e]),t.attributes.push(e)},t.md=null,t.setSubject=function(e){w(e),t.subject.attributes=e,t.subject.hash=null},t.setAttributes=function(e){w(e),t.attributes=e},t.sign=function(e,n){t.md=n||r.md.sha1.create();var a=o[t.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw c.algorithm=t.md.algorithm,c}t.signatureOid=t.siginfo.algorithmOid=a,t.certificationRequestInfo=s.getCertificationRequestInfo(t);var l=i.toDer(t.certificationRequestInfo);t.md.update(l.getBytes()),t.signature=e.sign(t.md)},t.verify=function(){var e=!1,n=t.md;if(null===n){n=g({signatureOid:t.signatureOid,type:"certification request"});var r=t.certificationRequestInfo||s.getCertificationRequestInfo(t),o=i.toDer(r);n.update(o.getBytes())}return null!==n&&(e=m({certificate:t,md:n,signature:t.signature})),e},t};var _=new Date("1950-01-01T00:00:00Z"),S=new Date("2050-01-01T00:00:00Z");function A(t){return t>=_&&t<S?i.create(i.Class.UNIVERSAL,i.Type.UTCTIME,!1,i.dateToUtcTime(t)):i.create(i.Class.UNIVERSAL,i.Type.GENERALIZEDTIME,!1,i.dateToGeneralizedTime(t))}s.getTBSCertificate=function(t){var e=A(t.validity.notBefore),n=A(t.validity.notAfter),o=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.CONTEXT_SPECIFIC,0,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes())]),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,r.util.hexToBytes(t.serialNumber)),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.siginfo.algorithmOid).getBytes()),v(t.siginfo.algorithmOid,t.siginfo.parameters)]),y(t.issuer),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[e,n]),y(t.subject),s.publicKeyToAsn1(t.publicKey)]);return t.issuer.uniqueId&&o.value.push(i.create(i.Class.CONTEXT_SPECIFIC,1,!0,[i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+t.issuer.uniqueId)])),t.subject.uniqueId&&o.value.push(i.create(i.Class.CONTEXT_SPECIFIC,2,!0,[i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+t.subject.uniqueId)])),t.extensions.length>0&&o.value.push(s.certificateExtensionsToAsn1(t.extensions)),o},s.getCertificationRequestInfo=function(t){var e=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,i.integerToDer(t.version).getBytes()),y(t.subject),s.publicKeyToAsn1(t.publicKey),E(t)]);return e},s.distinguishedNameToAsn1=function(t){return y(t)},s.certificateToAsn1=function(t){var e=t.tbsCertificate||s.getTBSCertificate(t);return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[e,i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.signatureOid).getBytes()),v(t.signatureOid,t.signatureParameters)]),i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+t.signature)])},s.certificateExtensionsToAsn1=function(t){var e=i.create(i.Class.CONTEXT_SPECIFIC,3,!0,[]),n=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);e.value.push(n);for(var r=0;r<t.length;++r)n.value.push(s.certificateExtensionToAsn1(t[r]));return e},s.certificateExtensionToAsn1=function(t){var e=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[]);e.value.push(i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.id).getBytes())),t.critical&&e.value.push(i.create(i.Class.UNIVERSAL,i.Type.BOOLEAN,!1,String.fromCharCode(255)));var n=t.value;return"string"!==typeof t.value&&(n=i.toDer(n).getBytes()),e.value.push(i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,n)),e},s.certificationRequestToAsn1=function(t){var e=t.certificationRequestInfo||s.getCertificationRequestInfo(t);return i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[e,i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(t.signatureOid).getBytes()),v(t.signatureOid,t.signatureParameters)]),i.create(i.Class.UNIVERSAL,i.Type.BITSTRING,!1,String.fromCharCode(0)+t.signature)])},s.createCaStore=function(t){var e={certs:{}};function n(t){return o(t),e.certs[t.hash]||null}function o(t){if(!t.hash){var e=r.md.sha1.create();t.attributes=s.RDNAttributesAsArray(y(t),e),t.hash=e.digest().toHex()}}if(e.getIssuer=function(t){var e=n(t.issuer);return e},e.addCertificate=function(t){if("string"===typeof t&&(t=r.pki.certificateFromPem(t)),o(t.subject),!e.hasCertificate(t))if(t.subject.hash in e.certs){var n=e.certs[t.subject.hash];r.util.isArray(n)||(n=[n]),n.push(t),e.certs[t.subject.hash]=n}else e.certs[t.subject.hash]=t},e.hasCertificate=function(t){"string"===typeof t&&(t=r.pki.certificateFromPem(t));var e=n(t.subject);if(!e)return!1;r.util.isArray(e)||(e=[e]);for(var o=i.toDer(s.certificateToAsn1(t)).getBytes(),a=0;a<e.length;++a){var c=i.toDer(s.certificateToAsn1(e[a])).getBytes();if(o===c)return!0}return!1},e.listAllCertificates=function(){var t=[];for(var n in e.certs)if(e.certs.hasOwnProperty(n)){var i=e.certs[n];if(r.util.isArray(i))for(var s=0;s<i.length;++s)t.push(i[s]);else t.push(i)}return t},e.removeCertificate=function(t){var a;if("string"===typeof t&&(t=r.pki.certificateFromPem(t)),o(t.subject),!e.hasCertificate(t))return null;var c=n(t.subject);if(!r.util.isArray(c))return a=e.certs[t.subject.hash],delete e.certs[t.subject.hash],a;for(var l=i.toDer(s.certificateToAsn1(t)).getBytes(),u=0;u<c.length;++u){var h=i.toDer(s.certificateToAsn1(c[u])).getBytes();l===h&&(a=c[u],c.splice(u,1))}return 0===c.length&&delete e.certs[t.subject.hash],a},t)for(var a=0;a<t.length;++a){var c=t[a];e.addCertificate(c)}return e},s.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},s.verifyCertificateChain=function(t,e,n){"function"===typeof n&&(n={verify:n}),n=n||{},e=e.slice(0);var i=e.slice(0),o=n.validityCheckDate;"undefined"===typeof o&&(o=new Date);var a=!0,c=null,l=0;do{var u=e.shift(),h=null,d=!1;if(o&&(o<u.validity.notBefore||o>u.validity.notAfter)&&(c={message:"Certificate is not valid yet or has expired.",error:s.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:o}),null===c){if(h=e[0]||t.getIssuer(u),null===h&&u.isIssuer(u)&&(d=!0,h=u),h){var f=h;r.util.isArray(f)||(f=[f]);var p=!1;while(!p&&f.length>0){h=f.shift();try{p=h.verify(u)}catch(S){}}p||(c={message:"Certificate signature is invalid.",error:s.certificateError.bad_certificate})}null!==c||h&&!d||t.hasCertificate(u)||(c={message:"Certificate is not trusted.",error:s.certificateError.unknown_ca})}if(null===c&&h&&!u.isIssuer(h)&&(c={message:"Certificate issuer is invalid.",error:s.certificateError.bad_certificate}),null===c)for(var g={keyUsage:!0,basicConstraints:!0},m=0;null===c&&m<u.extensions.length;++m){var y=u.extensions[m];y.critical&&!(y.name in g)&&(c={message:"Certificate has an unsupported critical extension.",error:s.certificateError.unsupported_certificate})}if(null===c&&(!a||0===e.length&&(!h||d))){var w=u.getExtension("basicConstraints"),b=u.getExtension("keyUsage");if(null!==b&&(b.keyCertSign&&null!==w||(c={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:s.certificateError.bad_certificate})),null!==c||null===w||w.cA||(c={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:s.certificateError.bad_certificate}),null===c&&null!==b&&"pathLenConstraint"in w){var v=l-1;v>w.pathLenConstraint&&(c={message:"Certificate basicConstraints pathLenConstraint violated.",error:s.certificateError.bad_certificate})}}var E=null===c||c.error,_=n.verify?n.verify(E,l,i):E;if(!0!==_)throw!0===E&&(c={message:"The application rejected the certificate.",error:s.certificateError.bad_certificate}),(_||0===_)&&("object"!==typeof _||r.util.isArray(_)?"string"===typeof _&&(c.error=_):(_.message&&(c.message=_.message),_.error&&(c.error=_.error))),c;c=null,a=!1,++l}while(e.length>0);return!0}},2119:function(t,e,n){n(7658);const r=n(2517),i=n(2663);t.exports=class{constructor(){this._buffer=new r,this._waitingConsumers=new r}push(t){const{promise:e,resolve:n}=i();return this._buffer.push({chunk:t,resolve:n}),this._consume(),e}_consume(){while(!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty()){const t=this._waitingConsumers.shift(),e=this._buffer.shift();t.resolve(e.chunk),e.resolve()}}shift(){const{promise:t,resolve:e}=i();return this._waitingConsumers.push({resolve:e}),this._consume(),t}isEmpty(){return this._buffer.isEmpty()}}},2663:function(t){"use strict";const e=()=>{const t={};return t.promise=new Promise(((e,n)=>{t.resolve=e,t.reject=n})),t};t.exports=e},7341:function(t,e,n){"use strict";t.exports=n(7017)["default"]},7017:function(t,e,n){"use strict";var r=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const i=n(2346),s=r(n(862)),o=r(n(7636)),a=n(3246),c=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],l=c.map((t=>new i.Netmask(t)));function u(t){for(let e of l)if(e.contains(t))return!0;return!1}function h(t){return/^::$/.test(t)||/^::1$/.test(t)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(t)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(t)||/^ff([0-9a-fA-F]{2,2}):/i.test(t)}e["default"]=t=>{if((0,a.isValid)(t)){const e=(0,a.parse)(t);if("ipv4"===e.kind())return u(e.toNormalizedString());if("ipv6"===e.kind())return h(t)}else if((0,o.default)(t)&&s.default.v6().test(t))return h(t)}},862:function(t){"use strict";const e="[a-fA-F\\d:]",n=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${e})|(?<=${e})(?=\\s|$))`:"",r="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",i="[a-fA-F\\d]{1,4}",s=`\n(?:\n(?:${i}:){7}(?:${i}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${i}:){6}(?:${r}|:${i}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${i}:){5}(?::${r}|(?::${i}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${i}:){4}(?:(?::${i}){0,1}:${r}|(?::${i}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${i}:){3}(?:(?::${i}){0,2}:${r}|(?::${i}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${i}:){2}(?:(?::${i}){0,3}:${r}|(?::${i}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${i}:){1}(?:(?::${i}){0,4}:${r}|(?::${i}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${i}){0,5}:${r}|(?::${i}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=new RegExp(`(?:^${r}$)|(?:^${s}$)`),a=new RegExp(`^${r}$`),c=new RegExp(`^${s}$`),l=t=>t&&t.exact?o:new RegExp(`(?:${n(t)}${r}${n(t)})|(?:${n(t)}${s}${n(t)})`,"g");l.v4=t=>t&&t.exact?a:new RegExp(`${n(t)}${r}${n(t)}`,"g"),l.v6=t=>t&&t.exact?c:new RegExp(`${n(t)}${s}${n(t)}`,"g"),t.exports=l},7636:function(t,e,n){"use strict";const r=n(862),i=t=>r({exact:!0}).test(t);i.v4=t=>r.v4({exact:!0}).test(t),i.v6=t=>r.v6({exact:!0}).test(t),i.version=t=>i(t)?i.v4(t)?4:6:void 0,t.exports=i},8947:function(t,e,n){"use strict";t.exports=n(9880)},9880:function(t,e,n){"use strict";var r=e;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(1355),r.BufferWriter=n(3319),r.Reader=n(4609),r.BufferReader=n(3206),r.util=n(1539),r.rpc=n(1734),r.roots=n(3674),r.configure=i,i()},4609:function(t,e,n){"use strict";n(3767),n(8585),n(8696),t.exports=c;var r,i=n(1539),s=i.LongBits,o=i.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function c(t){this.buf=t,this.pos=0,this.len=t.length}var l="undefined"!==typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new c(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new c(t);throw Error("illegal buffer")},u=function(){return i.Buffer?function(t){return(c.create=function(t){return i.Buffer.isBuffer(t)?new r(t):l(t)})(t)}:l};function h(){var t=new s(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return t}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},c.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},c.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},c.prototype.skip=function(t){if("number"===typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while(4!==(t=7&this.uint32()))this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},c._configure=function(t){r=t,c.create=u(),r._configure();var e=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return h.call(this)[e](!1)},uint64:function(){return h.call(this)[e](!0)},sint64:function(){return h.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},3206:function(t,e,n){"use strict";t.exports=s;var r=n(4609);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(1539);function s(t){r.call(this,t)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},s._configure()},3674:function(t){"use strict";t.exports={}},1734:function(t,e,n){"use strict";var r=e;r.Service=n(4826)},4826:function(t,e,n){"use strict";t.exports=i;var r=n(1539);function i(t,e,n){if("function"!==typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function t(e,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(t,a,e,n,i,s);if(a.rpcImpl)try{return a.rpcImpl(e,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(t,n){if(t)return a.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",n,e),o(null,n)}a.end(!0)}))}catch(c){return a.emit("error",c,e),void setTimeout((function(){o(c)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},8893:function(t,e,n){"use strict";t.exports=i;var r=n(1539);function i(t,e){this.lo=t>>>0,this.hi=e>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(t){if(0===t)return s;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(t){if("number"===typeof t)return i.fromNumber(t);if(r.isString(t)){if(!r.Long)return i.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new i(t.low>>>0,t.high>>>0):s},i.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;i.fromHash=function(t){return t===o?s:new i((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},i.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},i.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},1539:function(t,e,n){"use strict";n(3767),n(8585),n(8696);var r=e;function i(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function s(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get(){return t},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}r.asPromise=n(3551),r.base64=n(8550),r.EventEmitter=n(8447),r.float=n(891),r.inquire=n(4842),r.utf8=n(479),r.pool=n(1387),r.LongBits=n(8893),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"===typeof t||t instanceof String},r.isObject=function(t){return t&&"object"===typeof t},r.isset=r.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(t){return"number"===typeof t?r.Buffer?r._Buffer_allocUnsafe(t):new r.Array(t):r.Buffer?r._Buffer_from(t):"undefined"===typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){var n=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},r.merge=i,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},r.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var t=r.Buffer;t?(r._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},r._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},1355:function(t,e,n){"use strict";t.exports=h;var r,i=n(1539),s=i.LongBits,o=i.base64,a=i.utf8;function c(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function l(){}function u(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function f(t,e,n){e[n]=255&t}function p(t,e,n){while(t>127)e[n++]=127&t|128,t>>>=7;e[n]=t}function g(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,n){while(t.hi)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;while(t.lo>127)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function y(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}h.create=d(),h.alloc=function(t){return new i.Array(t)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(t,e,n){return this.tail=this.tail.next=new c(t,e,n),this.len+=e,this},g.prototype=Object.create(c.prototype),g.prototype.fn=p,h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new g((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(m,10,s.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=s.from(t);return this._push(m,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=s.from(t).zzEncode();return this._push(m,e.length(),e)},h.prototype.bool=function(t){return this._push(f,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(y,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=s.from(t);return this._push(y,4,e.lo)._push(y,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(i.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(i.float.writeDoubleLE,8,t)};var w=i.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(f,1,0);if(i.isString(t)){var n=h.alloc(e=o.length(t));o.decode(t,n,0),t=n}return this.uint32(e)._push(w,e,t)},h.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},h.prototype.finish=function(){var t=this.head.next,e=this.constructor.alloc(this.len),n=0;while(t)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},h._configure=function(t){r=t,h.create=d(),r._configure()}},3319:function(t,e,n){"use strict";n(3767),n(8585),n(8696),t.exports=s;var r=n(1355);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(1539);function s(){r.call(this)}function o(t,e,n){t.length<40?i.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]}},s.prototype.bytes=function(t){i.isString(t)&&(t=i._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(s.writeBytesBuffer,e,t),this},s.prototype.string=function(t){var e=i.Buffer.byteLength(t);return this.uint32(e),e&&this._push(o,e,t),this},s._configure()},6486:function(t,e,n){
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
let r;t.exports="function"===typeof queueMicrotask?queueMicrotask.bind("undefined"!==typeof window?window:n.g):t=>(r||(r=Promise.resolve())).then(t).catch((t=>setTimeout((()=>{throw t}),0)))},5882:function(t,e,n){n(3767),n(8585),n(8696);const{instantiate:r}=n(7966);function i(t={}){if(!i.supported)return null;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return r(new Response(new Blob([e],{type:"application/wasm"})),t)}i.supported="undefined"!==typeof WebAssembly,t.exports=i},9566:function(t,e,n){const r=n(6477),i=n(5882),s=async(t,e,n,s,o)=>{const a=await i();return new r(a,t,e,n,s,o)};t.exports={Rabin:r,create:s}},6477:function(t,e,n){n(3767),n(8585),n(8696);class r{constructor(t,e=12,n=8192,r=32768,i=64,s){this.bits=e,this.min=n,this.max=r,this.asModule=t,this.rabin=new t.Rabin(e,n,r,i,s),this.polynomial=s}fingerprint(t){const{__retain:e,__release:n,__allocArray:r,__getInt32Array:i,Int32Array_ID:s,Uint8Array_ID:o}=this.asModule,a=new Int32Array(Math.ceil(t.length/this.min)),c=e(r(s,a)),l=e(r(o,t)),u=this.rabin.fingerprint(l,c),h=i(u);n(l),n(c);const d=h.indexOf(0);return d>=0?h.subarray(0,d):h}}t.exports=r},8109:function(t,e,n){"use strict";var r=65536,i=4294967295;function s(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var o=n(1989).Buffer,a=n.g.crypto||n.g.msCrypto;function c(t,e){if(t>i)throw new RangeError("requested too many random bytes");var n=o.allocUnsafe(t);if(t>0)if(t>r)for(var s=0;s<t;s+=r)a.getRandomValues(n.slice(s,s+r));else a.getRandomValues(n);return"function"===typeof e?process.nextTick((function(){e(null,n)})):n}a&&a.getRandomValues?t.exports=c:t.exports=s},8278:function(t,e,n){const r=n(6269),i=n(6886),s=n(2187),o=n(4240),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l}=n(5734),u=n(239),h=n(607),d=n(8913),f=n(3988),p=n(4420),g=n(548),m=n(3120);t.exports={RateLimiterRedis:r,RateLimiterMongo:i,RateLimiterMySQL:s,RateLimiterPostgres:o,RateLimiterMemory:u,RateLimiterMemcache:h,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l,RLWrapperBlackAndWhite:d,RateLimiterUnion:f,RateLimiterQueue:p,BurstyRateLimiter:g,RateLimiterRes:m}},548:function(t,e,n){const r=n(3120);t.exports=class{constructor(t,e){this._rateLimiter=t,this._burstLimiter=e}_combineRes(t,e){return new r(t.remainingPoints,Math.min(t.msBeforeNext,e.msBeforeNext),t.consumedPoints,t.isFirstInDuration)}consume(t,e=1,n={}){return this._rateLimiter.consume(t,e,n).catch((i=>i instanceof r?this._burstLimiter.consume(t,e,n).then((t=>Promise.resolve(this._combineRes(i,t)))).catch((t=>t instanceof r?Promise.reject(this._combineRes(i,t)):Promise.reject(t))):Promise.reject(i)))}get(t){return Promise.all([this._rateLimiter.get(t),this._burstLimiter.get(t)]).then((([t,e])=>this._combineRes(t,e)))}get points(){return this._rateLimiter.points}}},8913:function(t,e,n){const r=n(3120);t.exports=class{constructor(t={}){this.limiter=t.limiter,this.blackList=t.blackList,this.whiteList=t.whiteList,this.isBlackListed=t.isBlackListed,this.isWhiteListed=t.isWhiteListed,this.runActionAnyway=t.runActionAnyway}get limiter(){return this._limiter}set limiter(t){if("undefined"===typeof t)throw new Error("limiter is not set");this._limiter=t}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(t){this._runActionAnyway="undefined"!==typeof t&&t}get blackList(){return this._blackList}set blackList(t){this._blackList=Array.isArray(t)?t:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(t){if("undefined"===typeof t&&(t=()=>!1),"function"!==typeof t)throw new Error("isBlackListed must be function");this._isBlackListed=t}get whiteList(){return this._whiteList}set whiteList(t){this._whiteList=Array.isArray(t)?t:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(t){if("undefined"===typeof t&&(t=()=>!1),"function"!==typeof t)throw new Error("isWhiteListed must be function");this._isWhiteListed=t}isBlackListedSomewhere(t){return this.blackList.indexOf(t)>=0||this.isBlackListed(t)}isWhiteListedSomewhere(t){return this.whiteList.indexOf(t)>=0||this.isWhiteListed(t)}getBlackRes(){return new r(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new r(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(t,e=1){let n;return this.isWhiteListedSomewhere(t)?n=this.resolveWhite():this.isBlackListedSomewhere(t)&&(n=this.rejectBlack()),"undefined"===typeof n?this.limiter.consume(t,e):(this.runActionAnyway&&this.limiter.consume(t,e).catch((()=>{})),n)}block(t,e){let n;return this.isWhiteListedSomewhere(t)?n=this.resolveWhite():this.isBlackListedSomewhere(t)&&(n=this.resolveBlack()),"undefined"===typeof n?this.limiter.block(t,e):(this.runActionAnyway&&this.limiter.block(t,e).catch((()=>{})),n)}penalty(t,e){let n;return this.isWhiteListedSomewhere(t)?n=this.resolveWhite():this.isBlackListedSomewhere(t)&&(n=this.resolveBlack()),"undefined"===typeof n?this.limiter.penalty(t,e):(this.runActionAnyway&&this.limiter.penalty(t,e).catch((()=>{})),n)}reward(t,e){let n;return this.isWhiteListedSomewhere(t)?n=this.resolveWhite():this.isBlackListedSomewhere(t)&&(n=this.resolveBlack()),"undefined"===typeof n?this.limiter.reward(t,e):(this.runActionAnyway&&this.limiter.reward(t,e).catch((()=>{})),n)}get(t){let e;return this.isWhiteListedSomewhere(t)?e=this.resolveWhite():this.isBlackListedSomewhere(t)&&(e=this.resolveBlack()),"undefined"===typeof e||this.runActionAnyway?this.limiter.get(t):e}delete(t){return this.limiter.delete(t)}}},7083:function(t){t.exports=class{constructor(t={}){this.points=t.points,this.duration=t.duration,this.blockDuration=t.blockDuration,this.execEvenly=t.execEvenly,this.execEvenlyMinDelayMs=t.execEvenlyMinDelayMs,this.keyPrefix=t.keyPrefix}get points(){return this._points}set points(t){this._points=t>=0?t:4}get duration(){return this._duration}set duration(t){this._duration="undefined"===typeof t?1:t}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(t){this._blockDuration="undefined"===typeof t?0:t}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(t){this._execEvenly="undefined"!==typeof t&&Boolean(t)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(t){this._execEvenlyMinDelayMs="undefined"===typeof t?Math.ceil(this.msDuration/this.points):t}get keyPrefix(){return this._keyPrefix}set keyPrefix(t){if("undefined"===typeof t&&(t="rlflx"),"string"!==typeof t)throw new Error("keyPrefix must be string");this._keyPrefix=t}_getKeySecDuration(t={}){return t&&t.customDuration>=0?t.customDuration:this.duration}getKey(t){return this.keyPrefix.length>0?`${this.keyPrefix}:${t}`:t}parseKey(t){return t.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},5734:function(t,e,n){const r=n(2500),i=n(3090),s=n(7083),o=n(239),a=n(3120),c="rate_limiter_flexible";let l=null;const u=function(t,e,n,r){let i;i=null===r||!0===r||!1===r?r:{remainingPoints:r.remainingPoints,msBeforeNext:r.msBeforeNext,consumedPoints:r.consumedPoints,isFirstInDuration:r.isFirstInDuration},t.send({channel:c,keyPrefix:e.keyPrefix,promiseId:e.promiseId,type:n,data:i})},h=function(t){setTimeout((()=>{this._initiated?process.send(t):"undefined"!==typeof this._promises[t.promiseId]&&h.call(this,t)}),30)},d=function(t,e,n,r,i){const s={channel:c,keyPrefix:this.keyPrefix,func:t,promiseId:e,data:{key:n,arg:r,opts:i}};this._initiated?process.send(s):h.call(this,s)},f=function(t,e){if(!e||e.channel!==c||"undefined"===typeof this._rateLimiters[e.keyPrefix])return!1;let n;switch(e.func){case"consume":n=this._rateLimiters[e.keyPrefix].consume(e.data.key,e.data.arg,e.data.opts);break;case"penalty":n=this._rateLimiters[e.keyPrefix].penalty(e.data.key,e.data.arg,e.data.opts);break;case"reward":n=this._rateLimiters[e.keyPrefix].reward(e.data.key,e.data.arg,e.data.opts);break;case"block":n=this._rateLimiters[e.keyPrefix].block(e.data.key,e.data.arg,e.data.opts);break;case"get":n=this._rateLimiters[e.keyPrefix].get(e.data.key,e.data.opts);break;case"delete":n=this._rateLimiters[e.keyPrefix].delete(e.data.key,e.data.opts);break;default:return!1}n&&n.then((n=>{u(t,e,"resolve",n)})).catch((n=>{u(t,e,"reject",n)}))},p=function(t){if(!t||t.channel!==c||t.keyPrefix!==this.keyPrefix)return!1;if(this._promises[t.promiseId]){let e;switch(clearTimeout(this._promises[t.promiseId].timeoutId),e=null===t.data||!0===t.data||!1===t.data?t.data:new a(t.data.remainingPoints,t.data.msBeforeNext,t.data.consumedPoints,t.data.isFirstInDuration),t.type){case"resolve":this._promises[t.promiseId].resolve(e);break;case"reject":this._promises[t.promiseId].reject(e);break;default:throw new Error(`RateLimiterCluster: no such message type '${t.type}'`)}delete this._promises[t.promiseId]}},g=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},m=function(t,e){const n=process.hrtime();let r=n[0].toString()+n[1].toString();return"undefined"!==typeof this._promises[r]&&(r+=i.randomBytes(12).toString("base64")),this._promises[r]={resolve:t,reject:e,timeoutId:setTimeout((()=>{delete this._promises[r],e(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},r};class y{constructor(){if(l)return l;this._rateLimiters={},r.setMaxListeners(0),r.on("message",((t,e)=>{e&&e.channel===c&&"init"===e.type?("undefined"===typeof this._rateLimiters[e.opts.keyPrefix]&&(this._rateLimiters[e.opts.keyPrefix]=new o(e.opts)),t.send({channel:c,type:"init",keyPrefix:e.opts.keyPrefix})):f.call(this,t,e)})),l=this}}class w{constructor(t){if(l)return l;this._rateLimiters={},t.launchBus(((e,n)=>{n.on("process:msg",(e=>{const n=e.raw;if(n&&n.channel===c&&"init"===n.type)"undefined"===typeof this._rateLimiters[n.opts.keyPrefix]&&(this._rateLimiters[n.opts.keyPrefix]=new o(n.opts)),t.sendDataToProcessId(e.process.pm_id,{data:{},topic:c,channel:c,type:"init",keyPrefix:n.opts.keyPrefix},((t,e)=>{t&&console.log(t,e)}));else{const r={send:n=>{const r=n;r.topic=c,"undefined"===typeof r.data&&(r.data={}),t.sendDataToProcessId(e.process.pm_id,r,((t,e)=>{t&&console.log(t,e)}))}};f.call(this,r,n)}}))})),l=this}}class b extends s{get timeoutMs(){return this._timeoutMs}set timeoutMs(t){this._timeoutMs="undefined"===typeof t?5e3:Math.abs(parseInt(t))}constructor(t={}){super(t),process.setMaxListeners(0),this.timeoutMs=t.timeoutMs,this._initiated=!1,process.on("message",(t=>{t&&t.channel===c&&"init"===t.type&&t.keyPrefix===this.keyPrefix?this._initiated=!0:p.call(this,t)})),process.send({channel:c,type:"init",opts:g.call(this)}),this._promises={}}consume(t,e=1,n={}){return new Promise(((r,i)=>{const s=m.call(this,r,i);d.call(this,"consume",s,t,e,n)}))}penalty(t,e=1,n={}){return new Promise(((r,i)=>{const s=m.call(this,r,i);d.call(this,"penalty",s,t,e,n)}))}reward(t,e=1,n={}){return new Promise(((r,i)=>{const s=m.call(this,r,i);d.call(this,"reward",s,t,e,n)}))}block(t,e,n={}){return new Promise(((r,i)=>{const s=m.call(this,r,i);d.call(this,"block",s,t,e,n)}))}get(t,e={}){return new Promise(((n,r)=>{const i=m.call(this,n,r);d.call(this,"get",i,t,e)}))}delete(t,e={}){return new Promise(((n,r)=>{const i=m.call(this,n,r);d.call(this,"delete",i,t,e)}))}}t.exports={RateLimiterClusterMaster:y,RateLimiterClusterMasterPM2:w,RateLimiterCluster:b}},607:function(t,e,n){const r=n(7591),i=n(3120);class s extends r{constructor(t){super(t),this.client=t.storeClient}_getRateLimiterRes(t,e,n){const r=new i;return r.consumedPoints=parseInt(n.consumedPoints),r.isFirstInDuration=n.consumedPoints===e,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=n.msBeforeNext,r}_upsert(t,e,n,r=!1,i={}){return new Promise(((s,o)=>{const a=Date.now(),c=Math.floor(n/1e3);r?this.client.set(t,e,c,(n=>{n?o(n):this.client.set(`${t}_expire`,c>0?a+1e3*c:-1,c,(()=>{const t={consumedPoints:e,msBeforeNext:c>0?1e3*c:-1};s(t)}))})):this.client.incr(t,e,((l,u)=>{l||!1===u?this.client.add(t,e,c,((l,u)=>{if(l||!u)if("undefined"===typeof i.attemptNumber||i.attemptNumber<3){const a=Object.assign({},i);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(t,e,n,r,a).then((t=>s(t))).catch((t=>o(t)))}else o(new Error("Can not add key"));else this.client.add(`${t}_expire`,c>0?a+1e3*c:-1,c,(()=>{const t={consumedPoints:e,msBeforeNext:c>0?1e3*c:-1};s(t)}))})):this.client.get(`${t}_expire`,((t,e)=>{if(t)o(t);else{const t=!1===e?0:e,n={consumedPoints:u,msBeforeNext:t>=0?Math.max(t-a,0):-1};s(n)}}))}))}))}_get(t){return new Promise(((e,n)=>{const r=Date.now();this.client.get(t,((i,s)=>{s?this.client.get(`${t}_expire`,((t,i)=>{if(t)n(t);else{const t=!1===i?0:i,n={consumedPoints:s,msBeforeNext:t>=0?Math.max(t-r,0):-1};e(n)}})):e(null)}))}))}_delete(t){return new Promise(((e,n)=>{this.client.del(t,((r,i)=>{r?n(r):!1===i?e(i):this.client.del(`${t}_expire`,(t=>{t?n(t):e(i)}))}))}))}}t.exports=s},239:function(t,e,n){const r=n(7083),i=n(6749),s=n(3120);class o extends r{constructor(t={}){super(t),this._memoryStorage=new i}consume(t,e=1,n={}){return new Promise(((r,i)=>{const s=this.getKey(t),o=this._getKeySecDuration(n);let a=this._memoryStorage.incrby(s,e,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+e&&(a=this._memoryStorage.set(s,a.consumedPoints,this.blockDuration)),i(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let t=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(r,t,a)}else r(a)}))}penalty(t,e=1,n={}){const r=this.getKey(t);return new Promise((t=>{const i=this._getKeySecDuration(n),s=this._memoryStorage.incrby(r,e,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),t(s)}))}reward(t,e=1,n={}){const r=this.getKey(t);return new Promise((t=>{const i=this._getKeySecDuration(n),s=this._memoryStorage.incrby(r,-e,i);s.remainingPoints=Math.max(this.points-s.consumedPoints,0),t(s)}))}block(t,e){const n=1e3*e,r=this.points+1;return this._memoryStorage.set(this.getKey(t),r,e),Promise.resolve(new s(0,0===n?-1:n,r))}set(t,e,n){const r=1e3*(n>=0?n:this.duration);return this._memoryStorage.set(this.getKey(t),e,n),Promise.resolve(new s(0,0===r?-1:r,e))}get(t){const e=this._memoryStorage.get(this.getKey(t));return null!==e&&(e.remainingPoints=Math.max(this.points-e.consumedPoints,0)),Promise.resolve(e)}delete(t){return Promise.resolve(this._memoryStorage.delete(this.getKey(t)))}}t.exports=o},6886:function(t,e,n){const r=n(7591),i=n(3120);function s(t){try{const e=t.client?t.client:t,{version:n}=e.topology.s.options.metadata.driver,r=n.split(".").map((t=>parseInt(t)));return{major:r[0],feature:r[1],patch:r[2]}}catch(e){return{major:0,feature:0,patch:0}}}class o extends r{constructor(t){super(t),this.dbName=t.dbName,this.tableName=t.tableName,this.indexKeyPrefix=t.indexKeyPrefix,t.mongo?this.client=t.mongo:this.client=t.storeClient,"function"===typeof this.client.then?this.client.then((t=>{this.client=t,this._initCollection(),this._driverVersion=s(this.client)})):(this._initCollection(),this._driverVersion=s(this.client))}get dbName(){return this._dbName}set dbName(t){this._dbName="undefined"===typeof t?o.getDbName():t}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(t){this._tableName="undefined"===typeof t?this.keyPrefix:t}get client(){return this._client}set client(t){if("undefined"===typeof t)throw new Error("mongo is not set");this._client=t}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(t){this._indexKeyPrefix=t||{}}_initCollection(){const t="function"===typeof this.client.db?this.client.db(this.dbName):this.client,e=t.collection(this.tableName);e.createIndex({expire:-1},{expireAfterSeconds:0}),e.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=e}_getRateLimiterRes(t,e,n){const r=new i;let s;return s="undefined"===typeof n.value?n:n.value,r.isFirstInDuration=s.points===e,r.consumedPoints=s.points,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=null!==s.expire?Math.max(new Date(s.expire).getTime()-Date.now(),0):-1,r}_upsert(t,e,n,r=!1,i={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const s=i.attrs||{};let o,a;r?(o={key:t},o=Object.assign(o,s),a={$set:{key:t,points:e,expire:n>0?new Date(Date.now()+n):null}},a.$set=Object.assign(a.$set,s)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:t},o=Object.assign(o,s),a={$setOnInsert:{key:t,expire:n>0?new Date(Date.now()+n):null},$inc:{points:e}},a.$setOnInsert=Object.assign(a.$setOnInsert,s));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((i,l)=>{this._collection.findOneAndUpdate(o,a,c).then((t=>{i(t)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:t},s),a={$set:Object.assign({key:t,points:e,expire:n>0?new Date(Date.now()+n):null},s)};this._collection.findOneAndUpdate(o,a,c).then((t=>{i(t)})).catch((s=>{s&&11e3===s.code?this._upsert(t,e,n,r).then((t=>i(t))).catch((t=>l(t))):l(s)}))}else l(o)}))}))}_get(t,e={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const n=e.attrs||{},r=Object.assign({key:t,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(r)}_delete(t,e={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const n=e.attrs||{},r=Object.assign({key:t},n);return this._collection.deleteOne(r).then((t=>t.deletedCount>0))}}t.exports=o},2187:function(t,e,n){const r=n(7591),i=n(3120);class s extends r{constructor(t,e=null){super(t),this.client=t.storeClient,this.clientType=t.storeType,this.dbName=t.dbName,this.tableName=t.tableName,this.clearExpiredByTimeout=t.clearExpiredByTimeout,this.tableCreated=t.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"===typeof e&&e()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"===typeof e&&e()})).catch((t=>{if("function"!==typeof e)throw t;e(t)}))}clearExpired(t){return new Promise((e=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,t],(()=>{this._releaseConnection(n),e()}))})).catch((()=>{e()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((t,e)=>{this.client.getConnection(((n,r)=>{if(n)return e(n);t(r)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(t){switch(this.clientType){case"pool":return t.release();case"sequelize":return this.client.connectionManager.releaseConnection(t);case"knex":return this.client.client.releaseConnection(t);default:return!0}}_createDbAndTable(){return new Promise(((t,e)=>{this._getConnection().then((n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(r=>{if(r)return this._releaseConnection(n),e(r);n.query(this._getCreateTableStmt(),(r=>{if(r)return this._releaseConnection(n),e(r);this._releaseConnection(n),t()}))}))})).catch((t=>{e(t)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(t){if("undefined"===typeof t)if("Connection"===this.client.constructor.name)t="connection";else if("Pool"===this.client.constructor.name)t="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");t="sequelize"}this._clientType=t.toLowerCase()}get dbName(){return this._dbName}set dbName(t){this._dbName="undefined"===typeof t?"rtlmtrflx":t}get tableName(){return this._tableName}set tableName(t){this._tableName="undefined"===typeof t?this.keyPrefix:t}get tableCreated(){return this._tableCreated}set tableCreated(t){this._tableCreated="undefined"!==typeof t&&!!t}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(t){this._clearExpiredByTimeout="undefined"===typeof t||Boolean(t)}_getRateLimiterRes(t,e,n){const r=new i,[s]=n;return r.isFirstInDuration=e===s.points,r.consumedPoints=r.isFirstInDuration?e:s.points,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,r}_upsertTransaction(t,e,n,r,i){return new Promise(((s,o)=>{t.query("BEGIN",(a=>{if(a)return t.rollback(),o(a);const c=Date.now(),l=r>0?c+r:null;let u,h;i?(u="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",h=[this.dbName,this.tableName,e,n,l,n,l]):(u="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",h=[this.dbName,this.tableName,e,n,l,c,n,n,c,l]),t.query(u,h,(n=>{if(n)return t.rollback(),o(n);t.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,e],((e,n)=>{if(e)return t.rollback(),o(e);t.query("COMMIT",(e=>{if(e)return t.rollback(),o(e);s(n)}))}))}))}))}))}_upsert(t,e,n,r=!1){return this.tableCreated?new Promise(((i,s)=>{this._getConnection().then((o=>{this._upsertTransaction(o,t,e,n,r).then((t=>{i(t),this._releaseConnection(o)})).catch((t=>{s(t),this._releaseConnection(o)}))})).catch((t=>{s(t)}))})):Promise.reject(Error("Table is not created yet"))}_get(t){return this.tableCreated?new Promise(((e,n)=>{this._getConnection().then((r=>{r.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,t,Date.now()],((t,i)=>{t?n(t):0===i.length?e(null):e(i),this._releaseConnection(r)}))})).catch((t=>{n(t)}))})):Promise.reject(Error("Table is not created yet"))}_delete(t){return this.tableCreated?new Promise(((e,n)=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,t],((t,i)=>{t?n(t):e(i.affectedRows>0),this._releaseConnection(r)}))})).catch((t=>{n(t)}))})):Promise.reject(Error("Table is not created yet"))}}t.exports=s},4240:function(t,e,n){const r=n(7591),i=n(3120);class s extends r{constructor(t,e=null){super(t),this.client=t.storeClient,this.clientType=t.storeType,this.tableName=t.tableName,this.clearExpiredByTimeout=t.clearExpiredByTimeout,this.tableCreated=t.tableCreated,this.tableCreated?"function"===typeof e&&e():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"===typeof e&&e()})).catch((t=>{if("function"!==typeof e)throw t;e(t)}))}clearExpired(t){return new Promise((e=>{const n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[t]};this._query(n).then((()=>{e()})).catch((()=>{e()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(t){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(t);case"knex":return this.client.client.releaseConnection(t);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise(((t,e)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{t()})).catch((n=>{"23505"===n.code?t():e(n)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(t){const e=this.client.constructor.name;if("undefined"===typeof t)if("Client"===e)t="client";else if("Pool"===e||"BoundPool"===e)t="pool";else{if("Sequelize"!==e)throw new Error("storeType is not defined");t="sequelize"}this._clientType=t.toLowerCase()}get tableName(){return this._tableName}set tableName(t){this._tableName="undefined"===typeof t?this.keyPrefix:t}get tableCreated(){return this._tableCreated}set tableCreated(t){this._tableCreated="undefined"!==typeof t&&!!t}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(t){this._clearExpiredByTimeout="undefined"===typeof t||Boolean(t)}_getRateLimiterRes(t,e,n){const r=new i,s=n.rows[0];return r.isFirstInDuration=e===s.points,r.consumedPoints=r.isFirstInDuration?e:s.points,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=s.expire?Math.max(s.expire-Date.now(),0):-1,r}_query(t){const e=this.tableName.toLowerCase(),n={name:`${e}:${t.name}`,text:t.text,values:t.values};return new Promise(((t,e)=>{this._getConnection().then((r=>{r.query(n).then((e=>{t(e),this._releaseConnection(r)})).catch((t=>{e(t),this._releaseConnection(r)}))})).catch((t=>{e(t)}))}))}_upsert(t,e,n,r=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const i=n>0?Date.now()+n:null,s=r?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:r?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${r?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${s}\n            RETURNING points, expire;`,values:[t,e,i,Date.now()]})}_get(t){return this.tableCreated?new Promise(((e,n)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[t,Date.now()]}).then((t=>{0===t.rowCount&&(t=null),e(t)})).catch((t=>{n(t)}))})):Promise.reject(Error("Table is not created yet"))}_delete(t){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[t]}).then((t=>t.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}t.exports=s},4420:function(t,e,n){n(7658),n(541);const r=n(9304),i=4294967295,s="limiter";t.exports=class{constructor(t,e={maxQueueSize:i}){this._queueLimiters={KEY_DEFAULT:new o(t,e)},this._limiterFlexible=t,this._maxQueueSize=e.maxQueueSize}getTokensRemaining(t=s){return this._queueLimiters[t]?this._queueLimiters[t].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(t,e=s){return this._queueLimiters[e]||(this._queueLimiters[e]=new o(this._limiterFlexible,{key:e,maxQueueSize:this._maxQueueSize})),this._queueLimiters[e].removeTokens(t)}};class o{constructor(t,e={maxQueueSize:i,key:s}){this._key=e.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=t,this._maxQueueSize=e.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((t=>null!==t?t.remainingPoints:this._limiterFlexible.points))}removeTokens(t){const e=this;return new Promise(((n,i)=>{t>e._limiterFlexible.points?i(new r(`Requested tokens ${t} exceeds maximum ${e._limiterFlexible.points} tokens per interval`)):e._queue.length>0?e._queueRequest.call(e,n,i,t):e._limiterFlexible.consume(e._key,t).then((t=>{n(t.remainingPoints)})).catch((r=>{r instanceof Error?i(r):(e._queueRequest.call(e,n,i,t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),r.msBeforeNext)))}))}))}_queueRequest(t,e,n){const i=this;i._queue.length<i._maxQueueSize?i._queue.push({resolve:t,reject:e,tokens:n}):e(new r(`Number of requests reached it's maximum ${i._maxQueueSize}`))}_processFIFO(){const t=this;if(null!==t._waitTimeout&&(clearTimeout(t._waitTimeout),t._waitTimeout=null),0===t._queue.length)return;const e=t._queue.shift();t._limiterFlexible.consume(t._key,e.tokens).then((n=>{e.resolve(n.remainingPoints),t._processFIFO.call(t)})).catch((n=>{n instanceof Error?(e.reject(n),t._processFIFO.call(t)):(t._queue.unshift(e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),n.msBeforeNext)))}))}}},6269:function(t,e,n){const r=n(7591),i=n(3120),s="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";class o extends r{constructor(t){super(t),t.redis?this.client=t.redis:this.client=t.storeClient,this._rejectIfRedisNotReady=!!t.rejectIfRedisNotReady,"function"===typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:s})}_isRedisReady(){return!this._rejectIfRedisNotReady||(!this.client.status||"ready"===this.client.status)&&!("function"===typeof this.client.isReady&&!this.client.isReady())}_getRateLimiterRes(t,e,n){let[r,s]=n;Array.isArray(r)&&([,r]=r,[,s]=s);const o=new i;return o.consumedPoints=parseInt(r),o.isFirstInDuration=o.consumedPoints===e,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=s,o}_upsert(t,e,n,r=!1){return new Promise(((i,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));const a=Math.floor(n/1e3),c=this.client.multi();if(r)a>0?c.set(t,e,"EX",a):c.set(t,e),c.pttl(t).exec(((t,e)=>t?o(t):i(e)));else if(a>0){const n=function(t,e){return t?o(t):i(e)};"function"===typeof this.client.rlflxIncr?this.client.rlflxIncr(t,e,a,n):this.client.eval(s,1,t,e,a,n)}else c.incrby(t,e).pttl(t).exec(((t,e)=>t?o(t):i(e)))}))}_get(t){return new Promise(((e,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(t).pttl(t).exec(((t,r)=>{if(t)n(t);else{const[t]=r;if(null===t)return e(null);e(r)}}))}))}_delete(t){return new Promise(((e,n)=>{this.client.del(t,((t,r)=>{t?n(t):e(r>0)}))}))}}t.exports=o},3120:function(t){t.exports=class{constructor(t,e,n,r){this.remainingPoints="undefined"===typeof t?0:t,this.msBeforeNext="undefined"===typeof e?0:e,this.consumedPoints="undefined"===typeof n?0:n,this.isFirstInDuration="undefined"!==typeof r&&r}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(t){return this._msBeforeNext=t,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(t){return this._remainingPoints=t,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(t){return this._consumedPoints=t,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(t){this._isFirstInDuration=Boolean(t)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},7591:function(t,e,n){const r=n(7083),i=n(462),s=n(3120);t.exports=class extends r{constructor(t={}){super(t),this.inMemoryBlockOnConsumed=t.inMemoryBlockOnConsumed||t.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=t.inMemoryBlockDuration||t.inmemoryBlockDuration,this.insuranceLimiter=t.insuranceLimiter,this._inMemoryBlockedKeys=new i}get client(){return this._client}set client(t){if("undefined"===typeof t)throw new Error("storeClient is not set");this._client=t}_afterConsume(t,e,n,r,i,s={}){const o=this._getRateLimiterRes(n,r,i);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,o.msBeforeNext),o.consumedPoints>this.points?e(o):t(o);if(o.consumedPoints>this.points){let t=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+r&&(o.msBeforeNext=this.msBlockDuration,t=this._block(n,o.consumedPoints,this.msBlockDuration,s)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),t.then((()=>{e(o)})).catch((t=>{e(t)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let e=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(t,e,o)}else t(o)}_handleError(t,e,n,i,s,o=!1,a={}){this.insuranceLimiter instanceof r?this.insuranceLimiter[e](s,o,a).then((t=>{n(t)})).catch((t=>{i(t)})):i(t)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(t){return this.getInMemoryBlockMsBeforeExpire(t)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(t){this.inMemoryBlockOnConsumed=t}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(t){this.inMemoryBlockDuration=t}get msInmemoryBlockDuration(){return 1e3*this.inMemoryBlockDuration}getInMemoryBlockMsBeforeExpire(t){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(t):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(t){if(this._inMemoryBlockOnConsumed=t?parseInt(t):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(t){if(this._inMemoryBlockDuration=t?parseInt(t):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(t){if("undefined"!==typeof t&&!(t instanceof r))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=t,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(t,e,n={}){const r=1e3*e;return this._block(this.getKey(t),this.points+1,r,n)}set(t,e,n,r={}){const i=1e3*(n>=0?n:this.duration);return this._block(this.getKey(t),e,i,r)}consume(t,e=1,n={}){return new Promise(((r,i)=>{const o=this.getKey(t),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return i(new s(0,a));this._upsert(o,e,1e3*this._getKeySecDuration(n),!1,n).then((t=>{this._afterConsume(r,i,o,e,t)})).catch((s=>{this._handleError(s,"consume",r,i,t,e,n)}))}))}penalty(t,e=1,n={}){const r=this.getKey(t);return new Promise(((i,s)=>{this._upsert(r,e,1e3*this._getKeySecDuration(n),!1,n).then((t=>{i(this._getRateLimiterRes(r,e,t))})).catch((r=>{this._handleError(r,"penalty",i,s,t,e,n)}))}))}reward(t,e=1,n={}){const r=this.getKey(t);return new Promise(((i,s)=>{this._upsert(r,-e,1e3*this._getKeySecDuration(n),!1,n).then((t=>{i(this._getRateLimiterRes(r,-e,t))})).catch((r=>{this._handleError(r,"reward",i,s,t,e,n)}))}))}get(t,e={}){const n=this.getKey(t);return new Promise(((r,i)=>{this._get(n,e).then((t=>{r(null===t||"undefined"===typeof t?null:this._getRateLimiterRes(n,0,t))})).catch((n=>{this._handleError(n,"get",r,i,t,e)}))}))}delete(t,e={}){const n=this.getKey(t);return new Promise(((r,i)=>{this._delete(n,e).then((t=>{this._inMemoryBlockedKeys.delete(n),r(t)})).catch((n=>{this._handleError(n,"delete",r,i,t,e)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(t,e,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(t,e,n,r={}){return new Promise(((i,o)=>{this._upsert(t,e,n,!0,r).then((()=>{i(new s(0,n>0?n:-1,e))})).catch((e=>{this._handleError(e,"block",i,o,this.parseKey(t),n/1e3,r)}))}))}_get(t,e={}){throw new Error("You have to implement the method '_get'!")}_delete(t,e={}){throw new Error("You have to implement the method '_delete'!")}_upsert(t,e,n,r=!1,i={}){throw new Error("You have to implement the method '_upsert'!")}}},3988:function(t,e,n){n(7658);const r=n(7083);t.exports=class{constructor(...t){if(t.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");t.forEach((t=>{if(!(t instanceof r))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=t}consume(t,e=1){return new Promise(((n,r)=>{const i=[];this._limiters.forEach((n=>{i.push(n.consume(t,e).catch((t=>({rejected:!0,rej:t}))))})),Promise.all(i).then((t=>{const e={};let i=!1;t.forEach((t=>{!0===t.rejected&&(i=!0)}));for(let n=0;n<t.length;n++)i&&!0===t[n].rejected?e[this._limiters[n].keyPrefix]=t[n].rej:i||(e[this._limiters[n].keyPrefix]=t[n]);i?r(e):n(e)}))}))}}},950:function(t){t.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const t=Date.now();Object.keys(this._keys).forEach((e=>{this._keys[e]<=t&&delete this._keys[e]})),this._addedKeysAmount=Object.keys(this._keys).length}add(t,e){this.addMs(t,1e3*e)}addMs(t,e){this._keys[t]=Date.now()+e,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(t){const e=this._keys[t];if(e&&e>=Date.now()){this.collectExpired();const t=Date.now();return e>=t?e-t:0}return 0}delete(t){t?delete this._keys[t]:Object.keys(this._keys).forEach((t=>{delete this._keys[t]}))}}},462:function(t,e,n){const r=n(950);t.exports=r},6749:function(t,e,n){const r=n(772),i=n(3120);t.exports=class{constructor(){this._storage={}}incrby(t,e,n){if(this._storage[t]){const r=this._storage[t].expiresAt?this._storage[t].expiresAt.getTime()-(new Date).getTime():-1;return 0!==r?(this._storage[t].value=this._storage[t].value+e,new i(0,r,this._storage[t].value,!1)):this.set(t,e,n)}return this.set(t,e,n)}set(t,e,n){const s=1e3*n;return this._storage[t]&&this._storage[t].timeoutId&&clearTimeout(this._storage[t].timeoutId),this._storage[t]=new r(e,s>0?new Date(Date.now()+s):null),s>0&&(this._storage[t].timeoutId=setTimeout((()=>{delete this._storage[t]}),s),this._storage[t].timeoutId.unref&&this._storage[t].timeoutId.unref()),new i(0,0===s?-1:s,this._storage[t].value,!0)}get(t){if(this._storage[t]){const e=this._storage[t].expiresAt?this._storage[t].expiresAt.getTime()-(new Date).getTime():-1;return new i(0,e,this._storage[t].value,!1)}return null}delete(t){return!!this._storage[t]&&(this._storage[t].timeoutId&&clearTimeout(this._storage[t].timeoutId),delete this._storage[t],!0)}}},772:function(t){t.exports=class{constructor(t,e,n=null){this.value=t,this.expiresAt=e,this.timeoutId=n}get value(){return this._value}set value(t){this._value=parseInt(t)}get expiresAt(){return this._expiresAt}set expiresAt(t){t instanceof Date||!Number.isInteger(t)||(t=new Date(t)),this._expiresAt=t}get timeoutId(){return this._timeoutId}set timeoutId(t){this._timeoutId=t}}},9304:function(t){t.exports=class extends Error{constructor(t,e){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=t,e&&(this.extra=e)}}},3707:function(t,e,n){"use strict";n(7658),t.exports=a;var r=n(7510),i=a.prototype,s=new Date%1e9;function o(){return(1e9*Math.random()>>>0)+s++}function a(t){t=t||{},this.id=t.id||o(),this.max=t.max||1/0,this.items=t.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(t.lastModified||new Date);for(var e,n,r=this.items.length;r--;)e=this.items[r],n=new Date(e.expires)-new Date,this._lookup[e.key]=e,n>0?this.expire(e.key,n):n<=0&&this.delete(e.key)}i.has=function(t){return t in this._lookup},i.get=function(t){if(!this.has(t))return null;var e=this._lookup[t];return e.refresh&&this.expire(t,e.refresh),this.items.splice(this.items.indexOf(e),1),this.items.push(e),e.value},i.meta=function(t){if(!this.has(t))return null;var e=this._lookup[t];return"meta"in e?e.meta:null},i.set=function(t,e,n){var r=this._lookup[t],i=this._lookup[t]={key:t,value:e};return this.lastModified=new Date,r?(clearTimeout(r.timeout),this.items.splice(this.items.indexOf(r),1,i)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(i),this.size++),n&&("ttl"in n&&this.expire(t,n.ttl),"meta"in n&&(i.meta=n.meta),n.refresh&&(i.refresh=n.ttl)),this},i.delete=function(t){var e=this._lookup[t];return!!e&&(this.lastModified=new Date,this.items.splice(this.items.indexOf(e),1),clearTimeout(e.timeout),delete this._lookup[t],this.size--,this)},i.expire=function(t,e){var n=e||0,i=this._lookup[t];if(!i)return this;if("string"===typeof n&&(n=r(e)),"number"!==typeof n)throw new TypeError("Expiration time must be a string or number.");return clearTimeout(i.timeout),i.timeout=setTimeout(this.delete.bind(this,i.key),n),i.expires=Number(new Date)+n,this},i.clear=function(){for(var t=this.items.length;t--;)this.delete(this.items[t].key);return this},i.toJSON=function(){for(var t,e=new Array(this.items.length),n=e.length;n--;)t=this.items[n],e[n]={key:t.key,meta:t.meta,value:t.value,expires:t.expires,refresh:t.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:e}}},5748:function(t,e,n){"use strict";const r=n(612);class i{constructor(t,e,n){const i=this;this._started=r(),this._rescheduled=0,this._scheduled=e,this._args=n,this._triggered=!1,this._timerWrapper=()=>{i._rescheduled>0?(i._scheduled=i._rescheduled-(r()-i._started),i._schedule(i._scheduled)):(i._triggered=!0,t.apply(null,i._args))},this._timer=setTimeout(this._timerWrapper,e)}reschedule(t){t||(t=this._scheduled);const e=r();e+t-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(t)):this._triggered?this._schedule(t):(this._started=e,this._rescheduled=t)}_schedule(t){this._triggered=!1,this._started=r(),this._rescheduled=0,this._scheduled=t,this._timer=setTimeout(this._timerWrapper,t)}clear(){clearTimeout(this._timer)}}function s(){if("function"!==typeof arguments[0])throw new Error("callback needed");if("number"!==typeof arguments[1])throw new Error("timeout needed");let t;if(arguments.length>0){t=new Array(arguments.length-2);for(var e=0;e<t.length;e++)t[e]=arguments[e+2]}return new i(arguments[0],arguments[1],t)}t.exports=s},612:function(t){"use strict";t.exports=function(){return Date.now()}},8250:function(t,e,n){
/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.exports=i;const r=n(6486);function i(t,e,n){if("number"!==typeof e)throw new Error("second argument must be a Number");let i,s,o,a,c,l,u=!0;function h(t){function e(){n&&n(t,i),n=null}u?r(e):e()}function d(e,n,r){if(i[e]=r,n&&(c=!0),0===--o||n)h(n);else if(!c&&l<s){let e;a?(e=a[l],l+=1,t[e]((function(t,n){d(e,t,n)}))):(e=l,l+=1,t[e]((function(t,n){d(e,t,n)})))}}Array.isArray(t)?(i=[],o=s=t.length):(a=Object.keys(t),i={},o=s=a.length),l=e,o?a?a.some((function(n,r){return t[n]((function(t,e){d(n,t,e)})),r===e-1})):t.some((function(t,n){return t((function(t,e){d(n,t,e)})),n===e-1})):h(null),u=!1}},1989:function(t,e,n){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=n(911),i=r.Buffer;function s(t,e){for(var n in t)e[n]=t[n]}function o(t,e,n){return i(t,e,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=r:(s(r,e),e.Buffer=o),o.prototype=Object.create(i.prototype),s(i,o),o.from=function(t,e,n){if("number"===typeof t)throw new TypeError("Argument must not be a number");return i(t,e,n)},o.alloc=function(t,e,n){if("number"!==typeof t)throw new TypeError("Argument must be a number");var r=i(t);return void 0!==e?"string"===typeof n?r.fill(e,n):r.fill(e):r.fill(0),r},o.allocUnsafe=function(t){if("number"!==typeof t)throw new TypeError("Argument must be a number");return i(t)},o.allocUnsafeSlow=function(t){if("number"!==typeof t)throw new TypeError("Argument must be a number");return r.SlowBuffer(t)}},4203:function(t,e,n){"use strict";var r=n(4970),i=/[\/\?<>\\:\*\|"]/g,s=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(t,e){if("string"!==typeof t)throw new Error("Input must be string");var n=t.replace(i,e).replace(s,e).replace(o,e).replace(a,e).replace(c,e);return r(n,255)}t.exports=function(t,e){var n=e&&e.replacement||"",r=l(t,n);return""===n?r:l(r,"")}},7550:function(t){"use strict";const e=new Map,n=()=>`${Date.now()}:${Math.floor(1e6*Math.random())}`;async function r(t,n,r){while(e.get(r)){try{await t()}catch(i){setTimeout((()=>{throw i}),1);break}if(!e.get(r))break;await new Promise((t=>{const i=setTimeout(t,n);e.set(r,i)}))}}function i(t,i,s){s=s||i;const o=n(),a=setTimeout((()=>{r(t,i,o)}),s);return e.set(o,a),o}function s(t){const n=e.get(t);n&&(clearTimeout(n),e.delete(t))}t.exports={setDelayedInterval:i,clearDelayedInterval:s}},9963:function(t,e,n){"use strict";n(7658),n(541);const r=7;function i(t,e){return t+s(e)}function s(t){let e=t;return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),16843009*(e+(e>>4)&252645135)>>24}function o(t,e){return t[0]-e[0]}function a(t){return t[1]}t.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(t,e){let n=this._internalPositionFor(t,!1);if(void 0===e)-1!==n&&(this._unsetInternalPos(n),this._unsetBit(t),this._changedLength=!0,this._changedData=!0);else{let r=!1;-1===n?(n=this._data.length,this._setBit(t),this._changedData=!0):r=!0,this._setInternalPos(n,t,e,r),this._changedLength=!0}}unset(t){this.set(t,void 0)}get(t){this._sortData();const e=this._internalPositionFor(t,!0);if(-1!==e)return this._data[e][1]}push(t){return this.set(this.length,t),this.length}get length(){if(this._sortData(),this._changedLength){const t=this._data[this._data.length-1];this._length=t?t[0]+1:0,this._changedLength=!1}return this._length}forEach(t){let e=0;while(e<this.length)t(this.get(e),e,this),e++}map(t){let e=0,n=new Array(this.length);while(e<this.length)n[e]=t(this.get(e),e,this),e++;return n}reduce(t,e){let n=0,r=e;while(n<this.length){const e=this.get(n);r=t(r,e,n),n++}return r}find(t){let e,n,r=0;while(r<this.length&&!e)n=this.get(r),e=t(n),r++;return e?n:void 0}_internalPositionFor(t,e){const n=this._bytePosFor(t,e);if(n>=this._bitArrays.length)return-1;const o=this._bitArrays[n],a=t-n*r,c=(o&1<<a)>0;if(!c)return-1;const l=this._bitArrays.slice(0,n).reduce(i,0),u=~(4294967295<<a+1),h=s(o&u),d=l+h-1;return d}_bytePosFor(t,e){const n=Math.floor(t/r),i=n+1;while(!e&&this._bitArrays.length<i)this._bitArrays.push(0);return n}_setBit(t){const e=this._bytePosFor(t,!1);this._bitArrays[e]|=1<<t-e*r}_unsetBit(t){const e=this._bytePosFor(t,!1);this._bitArrays[e]&=~(1<<t-e*r)}_setInternalPos(t,e,n,r){const i=this._data,s=[e,n];if(r)this._sortData(),i[t]=s;else{if(i.length)if(i[i.length-1][0]>=e)i.push(s);else if(i[0][0]<=e)i.unshift(s);else{const t=Math.round(i.length/2);this._data=i.slice(0,t).concat(s).concat(i.slice(t))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(t){this._data.splice(t,1)}_sortData(){this._changedData&&this._data.sort(o),this._changedData=!1}bitField(){const t=[];let e,n=8,r=0,i=0;const s=this._bitArrays.slice();while(s.length||r){0===r&&(e=s.shift(),r=7);const o=Math.min(r,n),a=~(255<<o),c=e&a;i|=c<<8-n,e>>>=o,r-=o,n-=o,n&&(r||s.length)||(t.push(i),i=0,n=8)}for(var o=t.length-1;o>0;o--){const e=t[o];if(0!==e)break;t.pop()}return t}compactArray(){return this._sortData(),this._data.map(a)}}},1128:function(t){t.exports=t=>{if(t[Symbol.asyncIterator])return t;if(t.getReader)return async function*(){const e=t.getReader();try{while(1){const{done:t,value:n}=await e.read();if(t)return;yield n}}finally{e.releaseLock()}}();throw new Error("unknown stream")}},8957:function(t,e,n){"use strict";const{AbortController:r}=globalThis,i=n(5748);class s extends r{constructor(t){super(),this._ms=t,this._timer=i((()=>this.abort()),t),Object.setPrototypeOf(this,s.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=i((()=>this.abort()),this._ms)}}t.exports={TimeoutController:s}},4970:function(t,e,n){"use strict";var r=n(2636),i=n(6903);t.exports=r.bind(null,i)},2636:function(t){"use strict";function e(t){return t>=55296&&t<=56319}function n(t){return t>=56320&&t<=57343}t.exports=function(t,r,i){if("string"!==typeof r)throw new Error("Input must be string");for(var s,o,a=r.length,c=0,l=0;l<a;l+=1){if(s=r.charCodeAt(l),o=r[l],e(s)&&n(r.charCodeAt(l+1))&&(l+=1,o+=r[l]),c+=t(o),c===i)return r.slice(0,l+1);if(c>i)return r.slice(0,l-o.length+1)}return r}},6903:function(t){"use strict";function e(t){return t>=55296&&t<=56319}function n(t){return t>=56320&&t<=57343}t.exports=function(t){if("string"!==typeof t)throw new Error("Input must be string");for(var r=t.length,i=0,s=null,o=null,a=0;a<r;a++)s=t.charCodeAt(a),n(s)?null!=o&&e(o)?i+=1:i+=3:s<=127?i+=1:s>=128&&s<=2047?i+=2:s>=2048&&s<=65535&&(i+=3),o=s;return i}},5717:function(t){t.exports=r;var e=128,n=127;function r(t,i){var s,o=0,a=(i=i||0,0),c=i,l=t.length;do{if(c>=l)throw r.bytes=0,new RangeError("Could not decode varint");s=t[c++],o+=a<28?(s&n)<<a:(s&n)*Math.pow(2,a),a+=7}while(s>=e);return r.bytes=c-i,o}},2498:function(t){t.exports=s;var e=128,n=127,r=~n,i=Math.pow(2,31);function s(t,n,o){n=n||[],o=o||0;var a=o;while(t>=i)n[o++]=255&t|e,t/=128;while(t&r)n[o++]=255&t|e,t>>>=7;return n[o]=0|t,s.bytes=o-a+1,n}},8419:function(t,e,n){t.exports={encode:n(2498),decode:n(5717),encodingLength:n(3649)}},3649:function(t){var e=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);t.exports=function(t){return t<e?1:t<n?2:t<r?3:t<i?4:t<s?5:t<o?6:t<a?7:t<c?8:t<l?9:10}},1962:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=n(8419);t.exports=t=>{if(!(t instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const e=[];while(t.length>0){const n=r.decode(t);e.push(n),t=t.slice(r.decode.bytes)}return e}},9738:function(t){t.exports=r;var e=128,n=127;function r(t,i){var s,o=0,a=(i=i||0,0),c=i,l=t.length;do{if(c>=l||a>49)throw r.bytes=0,new RangeError("Could not decode varint");s=t[c++],o+=a<28?(s&n)<<a:(s&n)*Math.pow(2,a),a+=7}while(s>=e);return r.bytes=c-i,o}},1736:function(t){t.exports=s;var e=128,n=127,r=~n,i=Math.pow(2,31);function s(t,n,o){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw s.bytes=0,new RangeError("Could not encode varint");n=n||[],o=o||0;var a=o;while(t>=i)n[o++]=255&t|e,t/=128;while(t&r)n[o++]=255&t|e,t>>>=7;return n[o]=0|t,s.bytes=o-a+1,n}},1786:function(t,e,n){t.exports={encode:n(1736),decode:n(9738),encodingLength:n(948)}},948:function(t){var e=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);t.exports=function(t){return t<e?1:t<n?2:t<r?3:t<i?4:t<s?5:t<o?6:t<a?7:t<c?8:t<l?9:10}},5713:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=-8,i=-4,s=0,o=1,a=1,c=2,l=5,u=1024,h=2048,d=8192,f=0,p=4,g=8,m=12,y=12,w=16,b="undefined"!==typeof BigUint64Array,v=Symbol(),E=1024;function _(t,e){const n=new Uint32Array(t),r=new Uint16Array(t);var s=n[e+i>>>2]>>>1,o=e>>>1;if(s<=E)return String.fromCharCode.apply(String,r.subarray(o,o+s));const a=[];do{const t=r[o+E-1],e=t>=55296&&t<56320?E-1:E;a.push(String.fromCharCode.apply(String,r.subarray(o,o+=e))),s-=e}while(s>E);return a.join("")+String.fromCharCode.apply(String,r.subarray(o,o+s))}function S(t){const e={};function n(t,e){return t?_(t.buffer,e):"<yet unknown>"}const r=t.env=t.env||{};return r.abort=r.abort||function(t,i,s,o){const a=e.memory||r.memory;throw Error("abort: "+n(a,t)+" at "+n(a,i)+":"+s+":"+o)},r.trace=r.trace||function(t,i){const s=e.memory||r.memory;console.log("trace: "+n(s,t)+(i?" ":"")+Array.prototype.slice.call(arguments,2,2+i).join(", "))},t.Math=t.Math||Math,t.Date=t.Date||Date,e}function A(t,e){const n=e.exports,v=n.memory,E=n.table,S=n["__alloc"],A=n["__retain"],C=n["__rtti_base"]||-1;function I(t){const e=new Uint32Array(v.buffer),n=e[C>>>2];if((t>>>=0)>=n)throw Error("invalid id: "+t);return e[(C+4>>>2)+2*t]}function T(t){const e=new Uint32Array(v.buffer),n=e[C>>>2];if((t>>>=0)>=n)throw Error("invalid id: "+t);return e[(C+4>>>2)+2*t+1]}function k(t){return 31-Math.clz32(t>>>l&31)}function N(t){const e=t.length,n=S(e<<1,o),r=new Uint16Array(v.buffer);for(var i=0,s=n>>>1;i<e;++i)r[s+i]=t.charCodeAt(i);return n}function D(t){const e=v.buffer,n=new Uint32Array(e)[t+r>>>2];if(n!==o)throw Error("not a string: "+t);return _(e,t)}function O(t,e,n){const r=v.buffer;if(n)switch(t){case 2:return new Float32Array(r);case 3:return new Float64Array(r)}else switch(t){case 0:return new(e?Int8Array:Uint8Array)(r);case 1:return new(e?Int16Array:Uint16Array)(r);case 2:return new(e?Int32Array:Uint32Array)(r);case 3:return new(e?BigInt64Array:BigUint64Array)(r)}throw Error("unsupported align: "+t)}function P(t,e){const n=I(t);if(!(n&(a|c)))throw Error("not an array: "+t+" @ "+n);const r=k(n),i=e.length,o=S(i<<r,s),l=S(n&c?w:m,t),b=new Uint32Array(v.buffer);b[l+f>>>2]=A(o),b[l+p>>>2]=o,b[l+g>>>2]=i<<r,n&c&&(b[l+y>>>2]=i);const E=O(r,n&u,n&h);if(n&d)for(let s=0;s<i;++s)E[(o>>>r)+s]=A(e[s]);else E.set(e,o>>>r);return l}function x(t){const e=new Uint32Array(v.buffer),n=e[t+r>>>2],s=I(n);if(!(s&a))throw Error("not an array: "+n);const o=k(s);var l=e[t+p>>>2];const d=s&c?e[t+y>>>2]:e[l+i>>>2]>>>o;return O(o,s&u,s&h).subarray(l>>>=o,l+d)}function M(t){const e=x(t),n=e.length,r=new Array(n);for(let i=0;i<n;i++)r[i]=e[i];return r}function L(t){const e=v.buffer,n=new Uint32Array(e)[t+i>>>2];return e.slice(t,t+n)}function B(t,e,n){return new t(U(t,e,n))}function U(t,e,n){const r=v.buffer,s=new Uint32Array(r),o=s[n+p>>>2];return new t(r,o,s[o+i>>>2]>>>e)}function F(t,e){const n=new Uint32Array(v.buffer);var i=n[t+r>>>2];if(i<=n[C>>>2])do{if(i==e)return!0}while(i=T(i));return!1}return t.__allocString=N,t.__getString=D,t.__allocArray=P,t.__getArrayView=x,t.__getArray=M,t.__getArrayBuffer=L,t.__getInt8Array=B.bind(null,Int8Array,0),t.__getInt8ArrayView=U.bind(null,Int8Array,0),t.__getUint8Array=B.bind(null,Uint8Array,0),t.__getUint8ArrayView=U.bind(null,Uint8Array,0),t.__getUint8ClampedArray=B.bind(null,Uint8ClampedArray,0),t.__getUint8ClampedArrayView=U.bind(null,Uint8ClampedArray,0),t.__getInt16Array=B.bind(null,Int16Array,1),t.__getInt16ArrayView=U.bind(null,Int16Array,1),t.__getUint16Array=B.bind(null,Uint16Array,1),t.__getUint16ArrayView=U.bind(null,Uint16Array,1),t.__getInt32Array=B.bind(null,Int32Array,2),t.__getInt32ArrayView=U.bind(null,Int32Array,2),t.__getUint32Array=B.bind(null,Uint32Array,2),t.__getUint32ArrayView=U.bind(null,Uint32Array,2),b&&(t.__getInt64Array=B.bind(null,BigInt64Array,3),t.__getInt64ArrayView=U.bind(null,BigInt64Array,3),t.__getUint64Array=B.bind(null,BigUint64Array,3),t.__getUint64ArrayView=U.bind(null,BigUint64Array,3)),t.__getFloat32Array=B.bind(null,Float32Array,2),t.__getFloat32ArrayView=U.bind(null,Float32Array,2),t.__getFloat64Array=B.bind(null,Float64Array,3),t.__getFloat64ArrayView=U.bind(null,Float64Array,3),t.__instanceof=F,t.memory=t.memory||v,t.table=t.table||E,R(n,t)}function C(t){return"undefined"!==typeof Response&&t instanceof Response}async function I(t,e){return C(t=await t)?k(t,e):A(S(e||(e={})),await WebAssembly.instantiate(t instanceof WebAssembly.Module?t:await WebAssembly.compile(t),e))}function T(t,e){return A(S(e||(e={})),new WebAssembly.Instance(t instanceof WebAssembly.Module?t:new WebAssembly.Module(t),e))}async function k(t,e){return WebAssembly.instantiateStreaming?A(S(e||(e={})),(await WebAssembly.instantiateStreaming(t,e)).instance):I(C(t=await t)?t.arrayBuffer():t,e)}function R(t,e){var n=e?Object.create(e):{},r=t["__argumentsLength"]?function(e){t["__argumentsLength"].value=e}:t["__setArgumentsLength"]||t["__setargc"]||function(){};for(let i in t){if(!Object.prototype.hasOwnProperty.call(t,i))continue;const e=t[i];let s=i.split("."),o=n;while(s.length>1){let t=s.shift();Object.prototype.hasOwnProperty.call(o,t)||(o[t]={}),o=o[t]}let a=s[0],c=a.indexOf("#");if(c>=0){let n=a.substring(0,c),s=o[n];if("undefined"===typeof s||!s.prototype){let t=function(...e){return t.wrap(t.prototype.constructor(0,...e))};t.prototype={valueOf:function(){return this[v]}},t.wrap=function(e){return Object.create(t.prototype,{[v]:{value:e,writable:!1}})},s&&Object.getOwnPropertyNames(s).forEach((e=>Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e)))),o[n]=t}if(a=a.substring(c+1),o=o[n].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let e=t[i.replace("set:","get:")],n=t[i.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return e(this[v])},set:function(t){n(this[v],t)},enumerable:!0})}}else"constructor"===a?(o[a]=(...t)=>(r(t.length),e(...t))).original=e:(o[a]=function(...t){return r(t.length),e(this[v],...t)}).original=e}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:t[i.replace("set:","get:")],set:t[i.replace("get:","set:")],enumerable:!0}):"function"===typeof e&&e!==r?(o[a]=(...t)=>(r(t.length),e(...t))).original=e:o[a]=e}return n}e.instantiate=I,e.instantiateSync=T,e.instantiateStreaming=k,e.demangle=R},5186:function(t){"use strict";function e(t,e){var n=new Array(arguments.length-1),r=0,i=2,s=!0;while(i<arguments.length)n[r++]=arguments[i++];return new Promise((function(i,o){n[r]=function(t){if(s)if(s=!1,t)o(t);else{var e=new Array(arguments.length-1),n=0;while(n<e.length)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(a){s&&(s=!1,o(a))}}))}t.exports=e},8673:function(t,e,n){"use strict";n(7658);var r=e;r.length=function(t){var e=t.length;if(!e)return 0;var n=0;while(--e%4>1&&"="===t.charAt(e))++n;return Math.ceil(3*t.length)/4-n};for(var i=new Array(64),s=new Array(123),o=0;o<64;)s[i[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;r.encode=function(t,e,n){var r,s=null,o=[],a=0,c=0;while(e<n){var l=t[e++];switch(c){case 0:o[a++]=i[l>>2],r=(3&l)<<4,c=1;break;case 1:o[a++]=i[r|l>>4],r=(15&l)<<2,c=2;break;case 2:o[a++]=i[r|l>>6],o[a++]=i[63&l],c=0;break}a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=i[r],o[a++]=61,1===c&&(o[a++]=61)),s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var a="invalid encoding";r.decode=function(t,e,n){for(var r,i=n,o=0,c=0;c<t.length;){var l=t.charCodeAt(c++);if(61===l&&o>1)break;if(void 0===(l=s[l]))throw Error(a);switch(o){case 0:r=l,o=1;break;case 1:e[n++]=r<<2|(48&l)>>4,r=l,o=2;break;case 2:e[n++]=(15&r)<<4|(60&l)>>2,r=l,o=3;break;case 3:e[n++]=(3&r)<<6|l,o=0;break}}if(1===o)throw Error(a);return n-i},r.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},8825:function(t,e,n){"use strict";function r(){this._listeners={}}n(7658),t.exports=r,r.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},r.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],r=0;r<n.length;)n[r].fn===e?n.splice(r,1):++r;return this},r.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<e.length;)e[r].fn.apply(e[r++].ctx,n)}return this}},2913:function(t,e,n){"use strict";function r(t){return"undefined"!==typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),r=128===n[3];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3]}function s(t,r,i){e[0]=t,r[i]=n[3],r[i+1]=n[2],r[i+2]=n[1],r[i+3]=n[0]}function o(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],e[0]}function a(t,r){return n[3]=t[r],n[2]=t[r+1],n[1]=t[r+2],n[0]=t[r+3],e[0]}t.writeFloatLE=r?i:s,t.writeFloatBE=r?s:i,t.readFloatLE=r?o:a,t.readFloatBE=r?a:o}():function(){function e(t,e,n,r){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,r);else if(isNaN(e))t(2143289344,n,r);else if(e>34028234663852886e22)t((i<<31|2139095040)>>>0,n,r);else if(e<11754943508222875e-54)t((i<<31|Math.round(e/1401298464324817e-60))>>>0,n,r);else{var s=Math.floor(Math.log(e)/Math.LN2),o=8388607&Math.round(e*Math.pow(2,-s)*8388608);t((i<<31|s+127<<23|o)>>>0,n,r)}}function n(t,e,n){var r=t(e,n),i=2*(r>>31)+1,s=r>>>23&255,o=8388607&r;return 255===s?o?NaN:i*(1/0):0===s?1401298464324817e-60*i*o:i*Math.pow(2,s-150)*(o+8388608)}t.writeFloatLE=e.bind(null,i),t.writeFloatBE=e.bind(null,s),t.readFloatLE=n.bind(null,o),t.readFloatBE=n.bind(null,a)}(),"undefined"!==typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),r=128===n[7];function i(t,r,i){e[0]=t,r[i]=n[0],r[i+1]=n[1],r[i+2]=n[2],r[i+3]=n[3],r[i+4]=n[4],r[i+5]=n[5],r[i+6]=n[6],r[i+7]=n[7]}function s(t,r,i){e[0]=t,r[i]=n[7],r[i+1]=n[6],r[i+2]=n[5],r[i+3]=n[4],r[i+4]=n[3],r[i+5]=n[2],r[i+6]=n[1],r[i+7]=n[0]}function o(t,r){return n[0]=t[r],n[1]=t[r+1],n[2]=t[r+2],n[3]=t[r+3],n[4]=t[r+4],n[5]=t[r+5],n[6]=t[r+6],n[7]=t[r+7],e[0]}function a(t,r){return n[7]=t[r],n[6]=t[r+1],n[5]=t[r+2],n[4]=t[r+3],n[3]=t[r+4],n[2]=t[r+5],n[1]=t[r+6],n[0]=t[r+7],e[0]}t.writeDoubleLE=r?i:s,t.writeDoubleBE=r?s:i,t.readDoubleLE=r?o:a,t.readDoubleBE=r?a:o}():function(){function e(t,e,n,r,i,s){var o=r<0?1:0;if(o&&(r=-r),0===r)t(0,i,s+e),t(1/r>0?0:2147483648,i,s+n);else if(isNaN(r))t(0,i,s+e),t(2146959360,i,s+n);else if(r>17976931348623157e292)t(0,i,s+e),t((o<<31|2146435072)>>>0,i,s+n);else{var a;if(r<22250738585072014e-324)a=r/5e-324,t(a>>>0,i,s+e),t((o<<31|a/4294967296)>>>0,i,s+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),a=r*Math.pow(2,-c),t(4503599627370496*a>>>0,i,s+e),t((o<<31|c+1023<<20|1048576*a&1048575)>>>0,i,s+n)}}}function n(t,e,n,r,i){var s=t(r,i+e),o=t(r,i+n),a=2*(o>>31)+1,c=o>>>20&2047,l=4294967296*(1048575&o)+s;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}t.writeDoubleLE=e.bind(null,i,0,4),t.writeDoubleBE=e.bind(null,s,4,0),t.readDoubleLE=n.bind(null,o,0,4),t.readDoubleBE=n.bind(null,a,4,0)}(),t}function i(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function s(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function o(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function a(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}n(3767),n(8585),n(8696),t.exports=r(r)},6332:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},1168:function(t){"use strict";function e(t,e,n){var r=n||8192,i=r>>>1,s=null,o=r;return function(n){if(n<1||n>i)return t(n);o+n>r&&(s=t(r),o=0);var a=e.call(s,o,o+=n);return 7&o&&(o=1+(7|o)),a}}t.exports=e},9561:function(t,e,n){"use strict";n(7658);var r=e;r.length=function(t){for(var e=0,n=0,r=0;r<t.length;++r)n=t.charCodeAt(r),n<128?e+=1:n<2048?e+=2:55296===(64512&n)&&56320===(64512&t.charCodeAt(r+1))?(++r,e+=4):e+=3;return e},r.read=function(t,e,n){var r=n-e;if(r<1)return"";var i,s=null,o=[],a=0;while(e<n)i=t[e++],i<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(t,e,n){for(var r,i,s=n,o=0;o<t.length;++o)r=t.charCodeAt(o),r<128?e[n++]=r:r<2048?(e[n++]=r>>6|192,e[n++]=63&r|128):55296===(64512&r)&&56320===(64512&(i=t.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&i),++o,e[n++]=r>>18|240,e[n++]=r>>12&63|128,e[n++]=r>>6&63|128,e[n++]=63&r|128):(e[n++]=r>>12|224,e[n++]=r>>6&63|128,e[n++]=63&r|128);return n-s}},4870:function(t,e,n){"use strict";n.d(e,{B:function(){return o},Bj:function(){return s},Fl:function(){return Yt},IU:function(){return Dt},Jd:function(){return C},PG:function(){return Tt},SU:function(){return jt},Um:function(){return At},WL:function(){return $t},X$:function(){return R},X3:function(){return Nt},XI:function(){return Ft},Xl:function(){return Ot},ZM:function(){return Gt},dq:function(){return Bt},iH:function(){return Ut},j:function(){return T},lk:function(){return I},nZ:function(){return c},qj:function(){return St},qq:function(){return E},yT:function(){return Rt}});n(7658);var r=n(7139);let i;class s{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=i,!t&&i&&(this.index=(i.scopes||(i.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const e=i;try{return i=this,t()}finally{i=e}}else 0}on(){i=this}off(){i=this.parent}stop(t){if(this._active){let e,n;for(e=0,n=this.effects.length;e<n;e++)this.effects[e].stop();for(e=0,n=this.cleanups.length;e<n;e++)this.cleanups[e]();if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0,this._active=!1}}}function o(t){return new s(t)}function a(t,e=i){e&&e.active&&e.effects.push(t)}function c(){return i}const l=t=>{const e=new Set(t);return e.w=0,e.n=0,e},u=t=>(t.w&m)>0,h=t=>(t.n&m)>0,d=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=m},f=t=>{const{deps:e}=t;if(e.length){let n=0;for(let r=0;r<e.length;r++){const i=e[r];u(i)&&!h(i)?i.delete(t):e[n++]=i,i.w&=~m,i.n&=~m}e.length=n}},p=new WeakMap;let g=0,m=1;const y=30;let w;const b=Symbol(""),v=Symbol("");class E{constructor(t,e=null,n){this.fn=t,this.scheduler=e,this.active=!0,this.deps=[],this.parent=void 0,a(this,n)}run(){if(!this.active)return this.fn();let t=w,e=S;while(t){if(t===this)return;t=t.parent}try{return this.parent=w,w=this,S=!0,m=1<<++g,g<=y?d(this):_(this),this.fn()}finally{g<=y&&f(this),m=1<<--g,w=this.parent,S=e,this.parent=void 0,this.deferStop&&this.stop()}}stop(){w===this?this.deferStop=!0:this.active&&(_(this),this.onStop&&this.onStop(),this.active=!1)}}function _(t){const{deps:e}=t;if(e.length){for(let n=0;n<e.length;n++)e[n].delete(t);e.length=0}}let S=!0;const A=[];function C(){A.push(S),S=!1}function I(){const t=A.pop();S=void 0===t||t}function T(t,e,n){if(S&&w){let e=p.get(t);e||p.set(t,e=new Map);let r=e.get(n);r||e.set(n,r=l());const i=void 0;k(r,i)}}function k(t,e){let n=!1;g<=y?h(t)||(t.n|=m,n=!u(t)):n=!t.has(w),n&&(t.add(w),w.deps.push(t))}function R(t,e,n,i,s,o){const a=p.get(t);if(!a)return;let c=[];if("clear"===e)c=[...a.values()];else if("length"===n&&(0,r.kJ)(t)){const t=Number(i);a.forEach(((e,n)=>{("length"===n||n>=t)&&c.push(e)}))}else switch(void 0!==n&&c.push(a.get(n)),e){case"add":(0,r.kJ)(t)?(0,r.S0)(n)&&c.push(a.get("length")):(c.push(a.get(b)),(0,r._N)(t)&&c.push(a.get(v)));break;case"delete":(0,r.kJ)(t)||(c.push(a.get(b)),(0,r._N)(t)&&c.push(a.get(v)));break;case"set":(0,r._N)(t)&&c.push(a.get(b));break}if(1===c.length)c[0]&&N(c[0]);else{const t=[];for(const e of c)e&&t.push(...e);N(l(t))}}function N(t,e){const n=(0,r.kJ)(t)?t:[...t];for(const r of n)r.computed&&D(r,e);for(const r of n)r.computed||D(r,e)}function D(t,e){(t!==w||t.allowRecurse)&&(t.scheduler?t.scheduler():t.run())}const O=(0,r.fY)("__proto__,__v_isRef,__isVue"),P=new Set(Object.getOwnPropertyNames(Symbol).filter((t=>"arguments"!==t&&"caller"!==t)).map((t=>Symbol[t])).filter(r.yk)),x=z(),M=z(!1,!0),L=z(!0),B=U();function U(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const n=Dt(this);for(let e=0,i=this.length;e<i;e++)T(n,"get",e+"");const r=n[e](...t);return-1===r||!1===r?n[e](...t.map(Dt)):r}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){C();const n=Dt(this)[e].apply(this,t);return I(),n}})),t}function F(t){const e=Dt(this);return T(e,"has",t),e.hasOwnProperty(t)}function z(t=!1,e=!1){return function(n,i,s){if("__v_isReactive"===i)return!t;if("__v_isReadonly"===i)return t;if("__v_isShallow"===i)return e;if("__v_raw"===i&&s===(t?e?vt:bt:e?wt:yt).get(n))return n;const o=(0,r.kJ)(n);if(!t){if(o&&(0,r.RI)(B,i))return Reflect.get(B,i,s);if("hasOwnProperty"===i)return F}const a=Reflect.get(n,i,s);return((0,r.yk)(i)?P.has(i):O(i))?a:(t||T(n,"get",i),e?a:Bt(a)?o&&(0,r.S0)(i)?a:a.value:(0,r.Kn)(a)?t?Ct(a):St(a):a)}}const V=H(),j=H(!0);function H(t=!1){return function(e,n,i,s){let o=e[n];if(kt(o)&&Bt(o)&&!Bt(i))return!1;if(!t&&(Rt(i)||kt(i)||(o=Dt(o),i=Dt(i)),!(0,r.kJ)(e)&&Bt(o)&&!Bt(i)))return o.value=i,!0;const a=(0,r.kJ)(e)&&(0,r.S0)(n)?Number(n)<e.length:(0,r.RI)(e,n),c=Reflect.set(e,n,i,s);return e===Dt(s)&&(a?(0,r.aU)(i,o)&&R(e,"set",n,i,o):R(e,"add",n,i)),c}}function $(t,e){const n=(0,r.RI)(t,e),i=t[e],s=Reflect.deleteProperty(t,e);return s&&n&&R(t,"delete",e,void 0,i),s}function K(t,e){const n=Reflect.has(t,e);return(0,r.yk)(e)&&P.has(e)||T(t,"has",e),n}function G(t){return T(t,"iterate",(0,r.kJ)(t)?"length":b),Reflect.ownKeys(t)}const q={get:x,set:V,deleteProperty:$,has:K,ownKeys:G},W={get:L,set(t,e){return!0},deleteProperty(t,e){return!0}},Y=(0,r.l7)({},q,{get:M,set:j}),X=t=>t,Q=t=>Reflect.getPrototypeOf(t);function J(t,e,n=!1,r=!1){t=t["__v_raw"];const i=Dt(t),s=Dt(e);n||(e!==s&&T(i,"get",e),T(i,"get",s));const{has:o}=Q(i),a=r?X:n?xt:Pt;return o.call(i,e)?a(t.get(e)):o.call(i,s)?a(t.get(s)):void(t!==i&&t.get(e))}function Z(t,e=!1){const n=this["__v_raw"],r=Dt(n),i=Dt(t);return e||(t!==i&&T(r,"has",t),T(r,"has",i)),t===i?n.has(t):n.has(t)||n.has(i)}function tt(t,e=!1){return t=t["__v_raw"],!e&&T(Dt(t),"iterate",b),Reflect.get(t,"size",t)}function et(t){t=Dt(t);const e=Dt(this),n=Q(e),r=n.has.call(e,t);return r||(e.add(t),R(e,"add",t,t)),this}function nt(t,e){e=Dt(e);const n=Dt(this),{has:i,get:s}=Q(n);let o=i.call(n,t);o||(t=Dt(t),o=i.call(n,t));const a=s.call(n,t);return n.set(t,e),o?(0,r.aU)(e,a)&&R(n,"set",t,e,a):R(n,"add",t,e),this}function rt(t){const e=Dt(this),{has:n,get:r}=Q(e);let i=n.call(e,t);i||(t=Dt(t),i=n.call(e,t));const s=r?r.call(e,t):void 0,o=e.delete(t);return i&&R(e,"delete",t,void 0,s),o}function it(){const t=Dt(this),e=0!==t.size,n=void 0,r=t.clear();return e&&R(t,"clear",void 0,void 0,n),r}function st(t,e){return function(n,r){const i=this,s=i["__v_raw"],o=Dt(s),a=e?X:t?xt:Pt;return!t&&T(o,"iterate",b),s.forEach(((t,e)=>n.call(r,a(t),a(e),i)))}}function ot(t,e,n){return function(...i){const s=this["__v_raw"],o=Dt(s),a=(0,r._N)(o),c="entries"===t||t===Symbol.iterator&&a,l="keys"===t&&a,u=s[t](...i),h=n?X:e?xt:Pt;return!e&&T(o,"iterate",l?v:b),{next(){const{value:t,done:e}=u.next();return e?{value:t,done:e}:{value:c?[h(t[0]),h(t[1])]:h(t),done:e}},[Symbol.iterator](){return this}}}}function at(t){return function(...e){return"delete"!==t&&this}}function ct(){const t={get(t){return J(this,t)},get size(){return tt(this)},has:Z,add:et,set:nt,delete:rt,clear:it,forEach:st(!1,!1)},e={get(t){return J(this,t,!1,!0)},get size(){return tt(this)},has:Z,add:et,set:nt,delete:rt,clear:it,forEach:st(!1,!0)},n={get(t){return J(this,t,!0)},get size(){return tt(this,!0)},has(t){return Z.call(this,t,!0)},add:at("add"),set:at("set"),delete:at("delete"),clear:at("clear"),forEach:st(!0,!1)},r={get(t){return J(this,t,!0,!0)},get size(){return tt(this,!0)},has(t){return Z.call(this,t,!0)},add:at("add"),set:at("set"),delete:at("delete"),clear:at("clear"),forEach:st(!0,!0)},i=["keys","values","entries",Symbol.iterator];return i.forEach((i=>{t[i]=ot(i,!1,!1),n[i]=ot(i,!0,!1),e[i]=ot(i,!1,!0),r[i]=ot(i,!0,!0)})),[t,n,e,r]}const[lt,ut,ht,dt]=ct();function ft(t,e){const n=e?t?dt:ht:t?ut:lt;return(e,i,s)=>"__v_isReactive"===i?!t:"__v_isReadonly"===i?t:"__v_raw"===i?e:Reflect.get((0,r.RI)(n,i)&&i in e?n:e,i,s)}const pt={get:ft(!1,!1)},gt={get:ft(!1,!0)},mt={get:ft(!0,!1)};const yt=new WeakMap,wt=new WeakMap,bt=new WeakMap,vt=new WeakMap;function Et(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function _t(t){return t["__v_skip"]||!Object.isExtensible(t)?0:Et((0,r.W7)(t))}function St(t){return kt(t)?t:It(t,!1,q,pt,yt)}function At(t){return It(t,!1,Y,gt,wt)}function Ct(t){return It(t,!0,W,mt,bt)}function It(t,e,n,i,s){if(!(0,r.Kn)(t))return t;if(t["__v_raw"]&&(!e||!t["__v_isReactive"]))return t;const o=s.get(t);if(o)return o;const a=_t(t);if(0===a)return t;const c=new Proxy(t,2===a?i:n);return s.set(t,c),c}function Tt(t){return kt(t)?Tt(t["__v_raw"]):!(!t||!t["__v_isReactive"])}function kt(t){return!(!t||!t["__v_isReadonly"])}function Rt(t){return!(!t||!t["__v_isShallow"])}function Nt(t){return Tt(t)||kt(t)}function Dt(t){const e=t&&t["__v_raw"];return e?Dt(e):t}function Ot(t){return(0,r.Nj)(t,"__v_skip",!0),t}const Pt=t=>(0,r.Kn)(t)?St(t):t,xt=t=>(0,r.Kn)(t)?Ct(t):t;function Mt(t){S&&w&&(t=Dt(t),k(t.dep||(t.dep=l())))}function Lt(t,e){t=Dt(t);const n=t.dep;n&&N(n)}function Bt(t){return!(!t||!0!==t.__v_isRef)}function Ut(t){return zt(t,!1)}function Ft(t){return zt(t,!0)}function zt(t,e){return Bt(t)?t:new Vt(t,e)}class Vt{constructor(t,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?t:Dt(t),this._value=e?t:Pt(t)}get value(){return Mt(this),this._value}set value(t){const e=this.__v_isShallow||Rt(t)||kt(t);t=e?t:Dt(t),(0,r.aU)(t,this._rawValue)&&(this._rawValue=t,this._value=e?t:Pt(t),Lt(this,t))}}function jt(t){return Bt(t)?t.value:t}const Ht={get:(t,e,n)=>jt(Reflect.get(t,e,n)),set:(t,e,n,r)=>{const i=t[e];return Bt(i)&&!Bt(n)?(i.value=n,!0):Reflect.set(t,e,n,r)}};function $t(t){return Tt(t)?t:new Proxy(t,Ht)}class Kt{constructor(t){this.dep=void 0,this.__v_isRef=!0;const{get:e,set:n}=t((()=>Mt(this)),(()=>Lt(this)));this._get=e,this._set=n}get value(){return this._get()}set value(t){this._set(t)}}function Gt(t){return new Kt(t)}var qt;class Wt{constructor(t,e,n,r){this._setter=e,this.dep=void 0,this.__v_isRef=!0,this[qt]=!1,this._dirty=!0,this.effect=new E(t,(()=>{this._dirty||(this._dirty=!0,Lt(this))})),this.effect.computed=this,this.effect.active=this._cacheable=!r,this["__v_isReadonly"]=n}get value(){const t=Dt(this);return Mt(t),!t._dirty&&t._cacheable||(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}function Yt(t,e,n=!1){let i,s;const o=(0,r.mf)(t);o?(i=t,s=r.dG):(i=t.get,s=t.set);const a=new Wt(i,s,o||!s,n);return a}qt="__v_isReadonly"},3396:function(t,e,n){"use strict";n.d(e,{$d:function(){return o},Ah:function(){return It},FN:function(){return vn},Fl:function(){return Ln},HY:function(){return Fe},JJ:function(){return $},Jd:function(){return Ct},Ko:function(){return Ut},P$:function(){return nt},Q6:function(){return ct},U2:function(){return it},Uk:function(){return ln},Us:function(){return Ce},Wm:function(){return sn},Y3:function(){return w},Y8:function(){return Z},YP:function(){return W},_:function(){return rn},aZ:function(){return lt},bv:function(){return _t},dG:function(){return pn},dl:function(){return ft},f3:function(){return K},h:function(){return Bn},iD:function(){return Xe},ic:function(){return At},j4:function(){return Qe},kq:function(){return un},lR:function(){return Be},m0:function(){return G},nK:function(){return at},se:function(){return pt},up:function(){return xt},w5:function(){return M},wg:function(){return Ke},wy:function(){return Dt}});n(7658),n(541);var r=n(4870),i=n(7139);function s(t,e,n,r){let i;try{i=r?t(...r):t()}catch(s){a(s,e,n)}return i}function o(t,e,n,r){if((0,i.mf)(t)){const o=s(t,e,n,r);return o&&(0,i.tI)(o)&&o.catch((t=>{a(t,e,n)})),o}const c=[];for(let i=0;i<t.length;i++)c.push(o(t[i],e,n,r));return c}function a(t,e,n,r=!0){const i=e?e.vnode:null;if(e){let r=e.parent;const i=e.proxy,o=n;while(r){const e=r.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,i,o))return;r=r.parent}const a=e.appContext.config.errorHandler;if(a)return void s(a,null,10,[t,i,o])}c(t,n,i,r)}function c(t,e,n,r=!0){console.error(t)}let l=!1,u=!1;const h=[];let d=0;const f=[];let p=null,g=0;const m=Promise.resolve();let y=null;function w(t){const e=y||m;return t?e.then(this?t.bind(this):t):e}function b(t){let e=d+1,n=h.length;while(e<n){const r=e+n>>>1,i=I(h[r]);i<t?e=r+1:n=r}return e}function v(t){h.length&&h.includes(t,l&&t.allowRecurse?d+1:d)||(null==t.id?h.push(t):h.splice(b(t.id),0,t),E())}function E(){l||u||(u=!0,y=m.then(k))}function _(t){const e=h.indexOf(t);e>d&&h.splice(e,1)}function S(t){(0,i.kJ)(t)?f.push(...t):p&&p.includes(t,t.allowRecurse?g+1:g)||f.push(t),E()}function A(t,e=(l?d+1:0)){for(0;e<h.length;e++){const t=h[e];t&&t.pre&&(h.splice(e,1),e--,t())}}function C(t){if(f.length){const t=[...new Set(f)];if(f.length=0,p)return void p.push(...t);for(p=t,p.sort(((t,e)=>I(t)-I(e))),g=0;g<p.length;g++)p[g]();p=null,g=0}}const I=t=>null==t.id?1/0:t.id,T=(t,e)=>{const n=I(t)-I(e);if(0===n){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function k(t){u=!1,l=!0,h.sort(T);i.dG;try{for(d=0;d<h.length;d++){const t=h[d];t&&!1!==t.active&&s(t,null,14)}}finally{d=0,h.length=0,C(t),l=!1,y=null,(h.length||f.length)&&k(t)}}new Set;new Map;function R(t,e,...n){if(t.isUnmounted)return;const r=t.vnode.props||i.kT;let s=n;const a=e.startsWith("update:"),c=a&&e.slice(7);if(c&&c in r){const t=`${"modelValue"===c?"model":c}Modifiers`,{number:e,trim:o}=r[t]||i.kT;o&&(s=n.map((t=>(0,i.HD)(t)?t.trim():t))),e&&(s=n.map(i.h5))}let l;let u=r[l=(0,i.hR)(e)]||r[l=(0,i.hR)((0,i._A)(e))];!u&&a&&(u=r[l=(0,i.hR)((0,i.rs)(e))]),u&&o(u,t,6,s);const h=r[l+"Once"];if(h){if(t.emitted){if(t.emitted[l])return}else t.emitted={};t.emitted[l]=!0,o(h,t,6,s)}}function N(t,e,n=!1){const r=e.emitsCache,s=r.get(t);if(void 0!==s)return s;const o=t.emits;let a={},c=!1;if(!(0,i.mf)(t)){const r=t=>{const n=N(t,e,!0);n&&(c=!0,(0,i.l7)(a,n))};!n&&e.mixins.length&&e.mixins.forEach(r),t.extends&&r(t.extends),t.mixins&&t.mixins.forEach(r)}return o||c?((0,i.kJ)(o)?o.forEach((t=>a[t]=null)):(0,i.l7)(a,o),(0,i.Kn)(t)&&r.set(t,a),a):((0,i.Kn)(t)&&r.set(t,null),null)}function D(t,e){return!(!t||!(0,i.F7)(e))&&(e=e.slice(2).replace(/Once$/,""),(0,i.RI)(t,e[0].toLowerCase()+e.slice(1))||(0,i.RI)(t,(0,i.rs)(e))||(0,i.RI)(t,e))}let O=null,P=null;function x(t){const e=O;return O=t,P=t&&t.type.__scopeId||null,e}function M(t,e=O,n){if(!e)return t;if(t._n)return t;const r=(...n)=>{r._d&&We(-1);const i=x(e);let s;try{s=t(...n)}finally{x(i),r._d&&We(1)}return s};return r._n=!0,r._c=!0,r._d=!0,r}function L(t){const{type:e,vnode:n,proxy:r,withProxy:s,props:o,propsOptions:[c],slots:l,attrs:u,emit:h,render:d,renderCache:f,data:p,setupState:g,ctx:m,inheritAttrs:y}=t;let w,b;const v=x(t);try{if(4&n.shapeFlag){const t=s||r;w=hn(d.call(t,t,f,o,g,p,m)),b=u}else{const t=e;0,w=hn(t.length>1?t(o,{attrs:u,slots:l,emit:h}):t(o,null)),b=e.props?u:B(u)}}catch(_){He.length=0,a(_,t,1),w=sn(Ve)}let E=w;if(b&&!1!==y){const t=Object.keys(b),{shapeFlag:e}=E;t.length&&7&e&&(c&&t.some(i.tR)&&(b=U(b,c)),E=cn(E,b))}return n.dirs&&(E=cn(E),E.dirs=E.dirs?E.dirs.concat(n.dirs):n.dirs),n.transition&&(E.transition=n.transition),w=E,x(v),w}const B=t=>{let e;for(const n in t)("class"===n||"style"===n||(0,i.F7)(n))&&((e||(e={}))[n]=t[n]);return e},U=(t,e)=>{const n={};for(const r in t)(0,i.tR)(r)&&r.slice(9)in e||(n[r]=t[r]);return n};function F(t,e,n){const{props:r,children:i,component:s}=t,{props:o,children:a,patchFlag:c}=e,l=s.emitsOptions;if(e.dirs||e.transition)return!0;if(!(n&&c>=0))return!(!i&&!a||a&&a.$stable)||r!==o&&(r?!o||z(r,o,l):!!o);if(1024&c)return!0;if(16&c)return r?z(r,o,l):!!o;if(8&c){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const n=t[e];if(o[n]!==r[n]&&!D(l,n))return!0}}return!1}function z(t,e,n){const r=Object.keys(e);if(r.length!==Object.keys(t).length)return!0;for(let i=0;i<r.length;i++){const s=r[i];if(e[s]!==t[s]&&!D(n,s))return!0}return!1}function V({vnode:t,parent:e},n){while(e&&e.subTree===t)(t=e.vnode).el=n,e=e.parent}const j=t=>t.__isSuspense;function H(t,e){e&&e.pendingBranch?(0,i.kJ)(t)?e.effects.push(...t):e.effects.push(t):S(t)}function $(t,e){if(bn){let n=bn.provides;const r=bn.parent&&bn.parent.provides;r===n&&(n=bn.provides=Object.create(r)),n[t]=e}else 0}function K(t,e,n=!1){const r=bn||O;if(r){const s=null==r.parent?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(s&&t in s)return s[t];if(arguments.length>1)return n&&(0,i.mf)(e)?e.call(r.proxy):e}else 0}function G(t,e){return Y(t,null,e)}const q={};function W(t,e,n){return Y(t,e,n)}function Y(t,e,{immediate:n,deep:a,flush:c,onTrack:l,onTrigger:u}=i.kT){const h=(0,r.nZ)()===(null===bn||void 0===bn?void 0:bn.scope)?bn:null;let d,f,p=!1,g=!1;if((0,r.dq)(t)?(d=()=>t.value,p=(0,r.yT)(t)):(0,r.PG)(t)?(d=()=>t,a=!0):(0,i.kJ)(t)?(g=!0,p=t.some((t=>(0,r.PG)(t)||(0,r.yT)(t))),d=()=>t.map((t=>(0,r.dq)(t)?t.value:(0,r.PG)(t)?J(t):(0,i.mf)(t)?s(t,h,2):void 0))):d=(0,i.mf)(t)?e?()=>s(t,h,2):()=>{if(!h||!h.isUnmounted)return f&&f(),o(t,h,3,[y])}:i.dG,e&&a){const t=d;d=()=>J(t())}let m,y=t=>{f=_.onStop=()=>{s(t,h,4)}};if(In){if(y=i.dG,e?n&&o(e,h,3,[d(),g?[]:void 0,y]):d(),"sync"!==c)return i.dG;{const t=Fn();m=t.__watcherHandles||(t.__watcherHandles=[])}}let w=g?new Array(t.length).fill(q):q;const b=()=>{if(_.active)if(e){const t=_.run();(a||p||(g?t.some(((t,e)=>(0,i.aU)(t,w[e]))):(0,i.aU)(t,w)))&&(f&&f(),o(e,h,3,[t,w===q?void 0:g&&w[0]===q?[]:w,y]),w=t)}else _.run()};let E;b.allowRecurse=!!e,"sync"===c?E=b:"post"===c?E=()=>Ae(b,h&&h.suspense):(b.pre=!0,h&&(b.id=h.uid),E=()=>v(b));const _=new r.qq(d,E);e?n?b():w=_.run():"post"===c?Ae(_.run.bind(_),h&&h.suspense):_.run();const S=()=>{_.stop(),h&&h.scope&&(0,i.Od)(h.scope.effects,_)};return m&&m.push(S),S}function X(t,e,n){const r=this.proxy,s=(0,i.HD)(t)?t.includes(".")?Q(r,t):()=>r[t]:t.bind(r,r);let o;(0,i.mf)(e)?o=e:(o=e.handler,n=e);const a=bn;En(this);const c=Y(s,o.bind(r),n);return a?En(a):_n(),c}function Q(t,e){const n=e.split(".");return()=>{let e=t;for(let t=0;t<n.length&&e;t++)e=e[n[t]];return e}}function J(t,e){if(!(0,i.Kn)(t)||t["__v_skip"])return t;if(e=e||new Set,e.has(t))return t;if(e.add(t),(0,r.dq)(t))J(t.value,e);else if((0,i.kJ)(t))for(let n=0;n<t.length;n++)J(t[n],e);else if((0,i.DM)(t)||(0,i._N)(t))t.forEach((t=>{J(t,e)}));else if((0,i.PO)(t))for(const n in t)J(t[n],e);return t}function Z(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return _t((()=>{t.isMounted=!0})),Ct((()=>{t.isUnmounting=!0})),t}const tt=[Function,Array],et={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:tt,onEnter:tt,onAfterEnter:tt,onEnterCancelled:tt,onBeforeLeave:tt,onLeave:tt,onAfterLeave:tt,onLeaveCancelled:tt,onBeforeAppear:tt,onAppear:tt,onAfterAppear:tt,onAppearCancelled:tt},setup(t,{slots:e}){const n=vn(),i=Z();let s;return()=>{const o=e.default&&ct(e.default(),!0);if(!o||!o.length)return;let a=o[0];if(o.length>1){let t=!1;for(const e of o)if(e.type!==Ve){0,a=e,t=!0;break}}const c=(0,r.IU)(t),{mode:l}=c;if(i.isLeaving)return st(a);const u=ot(a);if(!u)return st(a);const h=it(u,c,i,n);at(u,h);const d=n.subTree,f=d&&ot(d);let p=!1;const{getTransitionKey:g}=u.type;if(g){const t=g();void 0===s?s=t:t!==s&&(s=t,p=!0)}if(f&&f.type!==Ve&&(!Ze(u,f)||p)){const t=it(f,c,i,n);if(at(f,t),"out-in"===l)return i.isLeaving=!0,t.afterLeave=()=>{i.isLeaving=!1,!1!==n.update.active&&n.update()},st(a);"in-out"===l&&u.type!==Ve&&(t.delayLeave=(t,e,n)=>{const r=rt(i,f);r[String(f.key)]=f,t._leaveCb=()=>{e(),t._leaveCb=void 0,delete h.delayedLeave},h.delayedLeave=n})}return a}}},nt=et;function rt(t,e){const{leavingVNodes:n}=t;let r=n.get(e.type);return r||(r=Object.create(null),n.set(e.type,r)),r}function it(t,e,n,r){const{appear:s,mode:a,persisted:c=!1,onBeforeEnter:l,onEnter:u,onAfterEnter:h,onEnterCancelled:d,onBeforeLeave:f,onLeave:p,onAfterLeave:g,onLeaveCancelled:m,onBeforeAppear:y,onAppear:w,onAfterAppear:b,onAppearCancelled:v}=e,E=String(t.key),_=rt(n,t),S=(t,e)=>{t&&o(t,r,9,e)},A=(t,e)=>{const n=e[1];S(t,e),(0,i.kJ)(t)?t.every((t=>t.length<=1))&&n():t.length<=1&&n()},C={mode:a,persisted:c,beforeEnter(e){let r=l;if(!n.isMounted){if(!s)return;r=y||l}e._leaveCb&&e._leaveCb(!0);const i=_[E];i&&Ze(t,i)&&i.el._leaveCb&&i.el._leaveCb(),S(r,[e])},enter(t){let e=u,r=h,i=d;if(!n.isMounted){if(!s)return;e=w||u,r=b||h,i=v||d}let o=!1;const a=t._enterCb=e=>{o||(o=!0,S(e?i:r,[t]),C.delayedLeave&&C.delayedLeave(),t._enterCb=void 0)};e?A(e,[t,a]):a()},leave(e,r){const i=String(t.key);if(e._enterCb&&e._enterCb(!0),n.isUnmounting)return r();S(f,[e]);let s=!1;const o=e._leaveCb=n=>{s||(s=!0,r(),S(n?m:g,[e]),e._leaveCb=void 0,_[i]===t&&delete _[i])};_[i]=t,p?A(p,[e,o]):o()},clone(t){return it(t,e,n,r)}};return C}function st(t){if(ht(t))return t=cn(t),t.children=null,t}function ot(t){return ht(t)?t.children?t.children[0]:void 0:t}function at(t,e){6&t.shapeFlag&&t.component?at(t.component.subTree,e):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function ct(t,e=!1,n){let r=[],i=0;for(let s=0;s<t.length;s++){let o=t[s];const a=null==n?o.key:String(n)+String(null!=o.key?o.key:s);o.type===Fe?(128&o.patchFlag&&i++,r=r.concat(ct(o.children,e,a))):(e||o.type!==Ve)&&r.push(null!=a?cn(o,{key:a}):o)}if(i>1)for(let s=0;s<r.length;s++)r[s].patchFlag=-2;return r}function lt(t){return(0,i.mf)(t)?{setup:t,name:t.name}:t}const ut=t=>!!t.type.__asyncLoader;const ht=t=>t.type.__isKeepAlive;RegExp,RegExp;function dt(t,e){return(0,i.kJ)(t)?t.some((t=>dt(t,e))):(0,i.HD)(t)?t.split(",").includes(e):!!(0,i.Kj)(t)&&t.test(e)}function ft(t,e){gt(t,"a",e)}function pt(t,e){gt(t,"da",e)}function gt(t,e,n=bn){const r=t.__wdc||(t.__wdc=()=>{let e=n;while(e){if(e.isDeactivated)return;e=e.parent}return t()});if(bt(e,r,n),n){let t=n.parent;while(t&&t.parent)ht(t.parent.vnode)&&mt(r,e,n,t),t=t.parent}}function mt(t,e,n,r){const s=bt(e,t,r,!0);It((()=>{(0,i.Od)(r[e],s)}),n)}function yt(t){t.shapeFlag&=-257,t.shapeFlag&=-513}function wt(t){return 128&t.shapeFlag?t.ssContent:t}function bt(t,e,n=bn,i=!1){if(n){const s=n[t]||(n[t]=[]),a=e.__weh||(e.__weh=(...i)=>{if(n.isUnmounted)return;(0,r.Jd)(),En(n);const s=o(e,n,t,i);return _n(),(0,r.lk)(),s});return i?s.unshift(a):s.push(a),a}}const vt=t=>(e,n=bn)=>(!In||"sp"===t)&&bt(t,((...t)=>e(...t)),n),Et=vt("bm"),_t=vt("m"),St=vt("bu"),At=vt("u"),Ct=vt("bum"),It=vt("um"),Tt=vt("sp"),kt=vt("rtg"),Rt=vt("rtc");function Nt(t,e=bn){bt("ec",t,e)}function Dt(t,e){const n=O;if(null===n)return t;const r=Pn(n)||n.proxy,s=t.dirs||(t.dirs=[]);for(let o=0;o<e.length;o++){let[t,n,a,c=i.kT]=e[o];t&&((0,i.mf)(t)&&(t={mounted:t,updated:t}),t.deep&&J(n),s.push({dir:t,instance:r,value:n,oldValue:void 0,arg:a,modifiers:c}))}return t}function Ot(t,e,n,i){const s=t.dirs,a=e&&e.dirs;for(let c=0;c<s.length;c++){const l=s[c];a&&(l.oldValue=a[c].value);let u=l.dir[i];u&&((0,r.Jd)(),o(u,n,8,[t.el,l,t,e]),(0,r.lk)())}}const Pt="components";function xt(t,e){return Lt(Pt,t,!0,e)||t}const Mt=Symbol();function Lt(t,e,n=!0,r=!1){const s=O||bn;if(s){const n=s.type;if(t===Pt){const t=xn(n,!1);if(t&&(t===e||t===(0,i._A)(e)||t===(0,i.kC)((0,i._A)(e))))return n}const o=Bt(s[t]||n[t],e)||Bt(s.appContext[t],e);return!o&&r?n:o}}function Bt(t,e){return t&&(t[e]||t[(0,i._A)(e)]||t[(0,i.kC)((0,i._A)(e))])}function Ut(t,e,n,r){let s;const o=n&&n[r];if((0,i.kJ)(t)||(0,i.HD)(t)){s=new Array(t.length);for(let n=0,r=t.length;n<r;n++)s[n]=e(t[n],n,void 0,o&&o[n])}else if("number"===typeof t){0,s=new Array(t);for(let n=0;n<t;n++)s[n]=e(n+1,n,void 0,o&&o[n])}else if((0,i.Kn)(t))if(t[Symbol.iterator])s=Array.from(t,((t,n)=>e(t,n,void 0,o&&o[n])));else{const n=Object.keys(t);s=new Array(n.length);for(let r=0,i=n.length;r<i;r++){const i=n[r];s[r]=e(t[i],i,r,o&&o[r])}}else s=[];return n&&(n[r]=s),s}const Ft=t=>t?Sn(t)?Pn(t)||t.proxy:Ft(t.parent):null,zt=(0,i.l7)(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Ft(t.parent),$root:t=>Ft(t.root),$emit:t=>t.emit,$options:t=>Wt(t),$forceUpdate:t=>t.f||(t.f=()=>v(t.update)),$nextTick:t=>t.n||(t.n=w.bind(t.proxy)),$watch:t=>X.bind(t)}),Vt=(t,e)=>t!==i.kT&&!t.__isScriptSetup&&(0,i.RI)(t,e),jt={get({_:t},e){const{ctx:n,setupState:s,data:o,props:a,accessCache:c,type:l,appContext:u}=t;let h;if("$"!==e[0]){const r=c[e];if(void 0!==r)switch(r){case 1:return s[e];case 2:return o[e];case 4:return n[e];case 3:return a[e]}else{if(Vt(s,e))return c[e]=1,s[e];if(o!==i.kT&&(0,i.RI)(o,e))return c[e]=2,o[e];if((h=t.propsOptions[0])&&(0,i.RI)(h,e))return c[e]=3,a[e];if(n!==i.kT&&(0,i.RI)(n,e))return c[e]=4,n[e];Ht&&(c[e]=0)}}const d=zt[e];let f,p;return d?("$attrs"===e&&(0,r.j)(t,"get",e),d(t)):(f=l.__cssModules)&&(f=f[e])?f:n!==i.kT&&(0,i.RI)(n,e)?(c[e]=4,n[e]):(p=u.config.globalProperties,(0,i.RI)(p,e)?p[e]:void 0)},set({_:t},e,n){const{data:r,setupState:s,ctx:o}=t;return Vt(s,e)?(s[e]=n,!0):r!==i.kT&&(0,i.RI)(r,e)?(r[e]=n,!0):!(0,i.RI)(t.props,e)&&(("$"!==e[0]||!(e.slice(1)in t))&&(o[e]=n,!0))},has({_:{data:t,setupState:e,accessCache:n,ctx:r,appContext:s,propsOptions:o}},a){let c;return!!n[a]||t!==i.kT&&(0,i.RI)(t,a)||Vt(e,a)||(c=o[0])&&(0,i.RI)(c,a)||(0,i.RI)(r,a)||(0,i.RI)(zt,a)||(0,i.RI)(s.config.globalProperties,a)},defineProperty(t,e,n){return null!=n.get?t._.accessCache[e]=0:(0,i.RI)(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};let Ht=!0;function $t(t){const e=Wt(t),n=t.proxy,s=t.ctx;Ht=!1,e.beforeCreate&&Gt(e.beforeCreate,t,"bc");const{data:o,computed:a,methods:c,watch:l,provide:u,inject:h,created:d,beforeMount:f,mounted:p,beforeUpdate:g,updated:m,activated:y,deactivated:w,beforeDestroy:b,beforeUnmount:v,destroyed:E,unmounted:_,render:S,renderTracked:A,renderTriggered:C,errorCaptured:I,serverPrefetch:T,expose:k,inheritAttrs:R,components:N,directives:D,filters:O}=e,P=null;if(h&&Kt(h,s,P,t.appContext.config.unwrapInjectedRef),c)for(const r in c){const t=c[r];(0,i.mf)(t)&&(s[r]=t.bind(n))}if(o){0;const e=o.call(n,n);0,(0,i.Kn)(e)&&(t.data=(0,r.qj)(e))}if(Ht=!0,a)for(const r in a){const t=a[r],e=(0,i.mf)(t)?t.bind(n,n):(0,i.mf)(t.get)?t.get.bind(n,n):i.dG;0;const o=!(0,i.mf)(t)&&(0,i.mf)(t.set)?t.set.bind(n):i.dG,c=Ln({get:e,set:o});Object.defineProperty(s,r,{enumerable:!0,configurable:!0,get:()=>c.value,set:t=>c.value=t})}if(l)for(const r in l)qt(l[r],s,n,r);if(u){const t=(0,i.mf)(u)?u.call(n):u;Reflect.ownKeys(t).forEach((e=>{$(e,t[e])}))}function x(t,e){(0,i.kJ)(e)?e.forEach((e=>t(e.bind(n)))):e&&t(e.bind(n))}if(d&&Gt(d,t,"c"),x(Et,f),x(_t,p),x(St,g),x(At,m),x(ft,y),x(pt,w),x(Nt,I),x(Rt,A),x(kt,C),x(Ct,v),x(It,_),x(Tt,T),(0,i.kJ)(k))if(k.length){const e=t.exposed||(t.exposed={});k.forEach((t=>{Object.defineProperty(e,t,{get:()=>n[t],set:e=>n[t]=e})}))}else t.exposed||(t.exposed={});S&&t.render===i.dG&&(t.render=S),null!=R&&(t.inheritAttrs=R),N&&(t.components=N),D&&(t.directives=D)}function Kt(t,e,n=i.dG,s=!1){(0,i.kJ)(t)&&(t=Zt(t));for(const o in t){const n=t[o];let a;a=(0,i.Kn)(n)?"default"in n?K(n.from||o,n.default,!0):K(n.from||o):K(n),(0,r.dq)(a)&&s?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>a.value,set:t=>a.value=t}):e[o]=a}}function Gt(t,e,n){o((0,i.kJ)(t)?t.map((t=>t.bind(e.proxy))):t.bind(e.proxy),e,n)}function qt(t,e,n,r){const s=r.includes(".")?Q(n,r):()=>n[r];if((0,i.HD)(t)){const n=e[t];(0,i.mf)(n)&&W(s,n)}else if((0,i.mf)(t))W(s,t.bind(n));else if((0,i.Kn)(t))if((0,i.kJ)(t))t.forEach((t=>qt(t,e,n,r)));else{const r=(0,i.mf)(t.handler)?t.handler.bind(n):e[t.handler];(0,i.mf)(r)&&W(s,r,t)}else 0}function Wt(t){const e=t.type,{mixins:n,extends:r}=e,{mixins:s,optionsCache:o,config:{optionMergeStrategies:a}}=t.appContext,c=o.get(e);let l;return c?l=c:s.length||n||r?(l={},s.length&&s.forEach((t=>Yt(l,t,a,!0))),Yt(l,e,a)):l=e,(0,i.Kn)(e)&&o.set(e,l),l}function Yt(t,e,n,r=!1){const{mixins:i,extends:s}=e;s&&Yt(t,s,n,!0),i&&i.forEach((e=>Yt(t,e,n,!0)));for(const o in e)if(r&&"expose"===o);else{const r=Xt[o]||n&&n[o];t[o]=r?r(t[o],e[o]):e[o]}return t}const Xt={data:Qt,props:ee,emits:ee,methods:ee,computed:ee,beforeCreate:te,created:te,beforeMount:te,mounted:te,beforeUpdate:te,updated:te,beforeDestroy:te,beforeUnmount:te,destroyed:te,unmounted:te,activated:te,deactivated:te,errorCaptured:te,serverPrefetch:te,components:ee,directives:ee,watch:ne,provide:Qt,inject:Jt};function Qt(t,e){return e?t?function(){return(0,i.l7)((0,i.mf)(t)?t.call(this,this):t,(0,i.mf)(e)?e.call(this,this):e)}:e:t}function Jt(t,e){return ee(Zt(t),Zt(e))}function Zt(t){if((0,i.kJ)(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function te(t,e){return t?[...new Set([].concat(t,e))]:e}function ee(t,e){return t?(0,i.l7)((0,i.l7)(Object.create(null),t),e):e}function ne(t,e){if(!t)return e;if(!e)return t;const n=(0,i.l7)(Object.create(null),t);for(const r in e)n[r]=te(t[r],e[r]);return n}function re(t,e,n,s=!1){const o={},a={};(0,i.Nj)(a,tn,1),t.propsDefaults=Object.create(null),se(t,e,o,a);for(const r in t.propsOptions[0])r in o||(o[r]=void 0);n?t.props=s?o:(0,r.Um)(o):t.type.props?t.props=o:t.props=a,t.attrs=a}function ie(t,e,n,s){const{props:o,attrs:a,vnode:{patchFlag:c}}=t,l=(0,r.IU)(o),[u]=t.propsOptions;let h=!1;if(!(s||c>0)||16&c){let r;se(t,e,o,a)&&(h=!0);for(const s in l)e&&((0,i.RI)(e,s)||(r=(0,i.rs)(s))!==s&&(0,i.RI)(e,r))||(u?!n||void 0===n[s]&&void 0===n[r]||(o[s]=oe(u,l,s,void 0,t,!0)):delete o[s]);if(a!==l)for(const t in a)e&&(0,i.RI)(e,t)||(delete a[t],h=!0)}else if(8&c){const n=t.vnode.dynamicProps;for(let r=0;r<n.length;r++){let s=n[r];if(D(t.emitsOptions,s))continue;const c=e[s];if(u)if((0,i.RI)(a,s))c!==a[s]&&(a[s]=c,h=!0);else{const e=(0,i._A)(s);o[e]=oe(u,l,e,c,t,!1)}else c!==a[s]&&(a[s]=c,h=!0)}}h&&(0,r.X$)(t,"set","$attrs")}function se(t,e,n,s){const[o,a]=t.propsOptions;let c,l=!1;if(e)for(let r in e){if((0,i.Gg)(r))continue;const u=e[r];let h;o&&(0,i.RI)(o,h=(0,i._A)(r))?a&&a.includes(h)?(c||(c={}))[h]=u:n[h]=u:D(t.emitsOptions,r)||r in s&&u===s[r]||(s[r]=u,l=!0)}if(a){const e=(0,r.IU)(n),s=c||i.kT;for(let r=0;r<a.length;r++){const c=a[r];n[c]=oe(o,e,c,s[c],t,!(0,i.RI)(s,c))}}return l}function oe(t,e,n,r,s,o){const a=t[n];if(null!=a){const t=(0,i.RI)(a,"default");if(t&&void 0===r){const t=a.default;if(a.type!==Function&&(0,i.mf)(t)){const{propsDefaults:i}=s;n in i?r=i[n]:(En(s),r=i[n]=t.call(null,e),_n())}else r=t}a[0]&&(o&&!t?r=!1:!a[1]||""!==r&&r!==(0,i.rs)(n)||(r=!0))}return r}function ae(t,e,n=!1){const r=e.propsCache,s=r.get(t);if(s)return s;const o=t.props,a={},c=[];let l=!1;if(!(0,i.mf)(t)){const r=t=>{l=!0;const[n,r]=ae(t,e,!0);(0,i.l7)(a,n),r&&c.push(...r)};!n&&e.mixins.length&&e.mixins.forEach(r),t.extends&&r(t.extends),t.mixins&&t.mixins.forEach(r)}if(!o&&!l)return(0,i.Kn)(t)&&r.set(t,i.Z6),i.Z6;if((0,i.kJ)(o))for(let h=0;h<o.length;h++){0;const t=(0,i._A)(o[h]);ce(t)&&(a[t]=i.kT)}else if(o){0;for(const t in o){const e=(0,i._A)(t);if(ce(e)){const n=o[t],r=a[e]=(0,i.kJ)(n)||(0,i.mf)(n)?{type:n}:Object.assign({},n);if(r){const t=he(Boolean,r.type),n=he(String,r.type);r[0]=t>-1,r[1]=n<0||t<n,(t>-1||(0,i.RI)(r,"default"))&&c.push(e)}}}}const u=[a,c];return(0,i.Kn)(t)&&r.set(t,u),u}function ce(t){return"$"!==t[0]}function le(t){const e=t&&t.toString().match(/^\s*(function|class) (\w+)/);return e?e[2]:null===t?"null":""}function ue(t,e){return le(t)===le(e)}function he(t,e){return(0,i.kJ)(e)?e.findIndex((e=>ue(e,t))):(0,i.mf)(e)&&ue(e,t)?0:-1}const de=t=>"_"===t[0]||"$stable"===t,fe=t=>(0,i.kJ)(t)?t.map(hn):[hn(t)],pe=(t,e,n)=>{if(e._n)return e;const r=M(((...t)=>fe(e(...t))),n);return r._c=!1,r},ge=(t,e,n)=>{const r=t._ctx;for(const s in t){if(de(s))continue;const n=t[s];if((0,i.mf)(n))e[s]=pe(s,n,r);else if(null!=n){0;const t=fe(n);e[s]=()=>t}}},me=(t,e)=>{const n=fe(e);t.slots.default=()=>n},ye=(t,e)=>{if(32&t.vnode.shapeFlag){const n=e._;n?(t.slots=(0,r.IU)(e),(0,i.Nj)(e,"_",n)):ge(e,t.slots={})}else t.slots={},e&&me(t,e);(0,i.Nj)(t.slots,tn,1)},we=(t,e,n)=>{const{vnode:r,slots:s}=t;let o=!0,a=i.kT;if(32&r.shapeFlag){const t=e._;t?n&&1===t?o=!1:((0,i.l7)(s,e),n||1!==t||delete s._):(o=!e.$stable,ge(e,s)),a=e}else e&&(me(t,e),a={default:1});if(o)for(const i in s)de(i)||i in a||delete s[i]};function be(){return{app:null,config:{isNativeTag:i.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ve=0;function Ee(t,e){return function(n,r=null){(0,i.mf)(n)||(n=Object.assign({},n)),null==r||(0,i.Kn)(r)||(r=null);const s=be(),o=new Set;let a=!1;const c=s.app={_uid:ve++,_component:n,_props:r,_container:null,_context:s,_instance:null,version:zn,get config(){return s.config},set config(t){0},use(t,...e){return o.has(t)||(t&&(0,i.mf)(t.install)?(o.add(t),t.install(c,...e)):(0,i.mf)(t)&&(o.add(t),t(c,...e))),c},mixin(t){return s.mixins.includes(t)||s.mixins.push(t),c},component(t,e){return e?(s.components[t]=e,c):s.components[t]},directive(t,e){return e?(s.directives[t]=e,c):s.directives[t]},mount(i,o,l){if(!a){0;const u=sn(n,r);return u.appContext=s,o&&e?e(u,i):t(u,i,l),a=!0,c._container=i,i.__vue_app__=c,Pn(u.component)||u.component.proxy}},unmount(){a&&(t(null,c._container),delete c._container.__vue_app__)},provide(t,e){return s.provides[t]=e,c}};return c}}function _e(t,e,n,o,a=!1){if((0,i.kJ)(t))return void t.forEach(((t,r)=>_e(t,e&&((0,i.kJ)(e)?e[r]:e),n,o,a)));if(ut(o)&&!a)return;const c=4&o.shapeFlag?Pn(o.component)||o.component.proxy:o.el,l=a?null:c,{i:u,r:h}=t;const d=e&&e.r,f=u.refs===i.kT?u.refs={}:u.refs,p=u.setupState;if(null!=d&&d!==h&&((0,i.HD)(d)?(f[d]=null,(0,i.RI)(p,d)&&(p[d]=null)):(0,r.dq)(d)&&(d.value=null)),(0,i.mf)(h))s(h,u,12,[l,f]);else{const e=(0,i.HD)(h),s=(0,r.dq)(h);if(e||s){const r=()=>{if(t.f){const n=e?(0,i.RI)(p,h)?p[h]:f[h]:h.value;a?(0,i.kJ)(n)&&(0,i.Od)(n,c):(0,i.kJ)(n)?n.includes(c)||n.push(c):e?(f[h]=[c],(0,i.RI)(p,h)&&(p[h]=f[h])):(h.value=[c],t.k&&(f[t.k]=h.value))}else e?(f[h]=l,(0,i.RI)(p,h)&&(p[h]=l)):s&&(h.value=l,t.k&&(f[t.k]=l))};l?(r.id=-1,Ae(r,n)):r()}else 0}}function Se(){}const Ae=H;function Ce(t){return Ie(t)}function Ie(t,e){Se();const n=(0,i.E9)();n.__VUE__=!0;const{insert:s,remove:o,patchProp:a,createElement:c,createText:l,createComment:u,setText:h,setElementText:d,parentNode:f,nextSibling:p,setScopeId:g=i.dG,insertStaticContent:m}=t,y=(t,e,n,r=null,i=null,s=null,o=!1,a=null,c=!!e.dynamicChildren)=>{if(t===e)return;t&&!Ze(t,e)&&(r=J(t),q(t,i,s,!0),t=null),-2===e.patchFlag&&(c=!1,e.dynamicChildren=null);const{type:l,ref:u,shapeFlag:h}=e;switch(l){case ze:w(t,e,n,r);break;case Ve:b(t,e,n,r);break;case je:null==t&&E(e,n,r,o);break;case Fe:x(t,e,n,r,i,s,o,a,c);break;default:1&h?T(t,e,n,r,i,s,o,a,c):6&h?M(t,e,n,r,i,s,o,a,c):(64&h||128&h)&&l.process(t,e,n,r,i,s,o,a,c,tt)}null!=u&&i&&_e(u,t&&t.ref,s,e||t,!e)},w=(t,e,n,r)=>{if(null==t)s(e.el=l(e.children),n,r);else{const n=e.el=t.el;e.children!==t.children&&h(n,e.children)}},b=(t,e,n,r)=>{null==t?s(e.el=u(e.children||""),n,r):e.el=t.el},E=(t,e,n,r)=>{[t.el,t.anchor]=m(t.children,e,n,r,t.el,t.anchor)},S=({el:t,anchor:e},n,r)=>{let i;while(t&&t!==e)i=p(t),s(t,n,r),t=i;s(e,n,r)},I=({el:t,anchor:e})=>{let n;while(t&&t!==e)n=p(t),o(t),t=n;o(e)},T=(t,e,n,r,i,s,o,a,c)=>{o=o||"svg"===e.type,null==t?k(e,n,r,i,s,o,a,c):D(t,e,i,s,o,a,c)},k=(t,e,n,r,o,l,u,h)=>{let f,p;const{type:g,props:m,shapeFlag:y,transition:w,dirs:b}=t;if(f=t.el=c(t.type,l,m&&m.is,m),8&y?d(f,t.children):16&y&&N(t.children,f,null,r,o,l&&"foreignObject"!==g,u,h),b&&Ot(t,null,r,"created"),R(f,t,t.scopeId,u,r),m){for(const e in m)"value"===e||(0,i.Gg)(e)||a(f,e,null,m[e],l,t.children,r,o,Q);"value"in m&&a(f,"value",null,m.value),(p=m.onVnodeBeforeMount)&&gn(p,r,t)}b&&Ot(t,null,r,"beforeMount");const v=(!o||o&&!o.pendingBranch)&&w&&!w.persisted;v&&w.beforeEnter(f),s(f,e,n),((p=m&&m.onVnodeMounted)||v||b)&&Ae((()=>{p&&gn(p,r,t),v&&w.enter(f),b&&Ot(t,null,r,"mounted")}),o)},R=(t,e,n,r,i)=>{if(n&&g(t,n),r)for(let s=0;s<r.length;s++)g(t,r[s]);if(i){let n=i.subTree;if(e===n){const e=i.vnode;R(t,e,e.scopeId,e.slotScopeIds,i.parent)}}},N=(t,e,n,r,i,s,o,a,c=0)=>{for(let l=c;l<t.length;l++){const c=t[l]=a?dn(t[l]):hn(t[l]);y(null,c,e,n,r,i,s,o,a)}},D=(t,e,n,r,s,o,c)=>{const l=e.el=t.el;let{patchFlag:u,dynamicChildren:h,dirs:f}=e;u|=16&t.patchFlag;const p=t.props||i.kT,g=e.props||i.kT;let m;n&&Te(n,!1),(m=g.onVnodeBeforeUpdate)&&gn(m,n,e,t),f&&Ot(e,t,n,"beforeUpdate"),n&&Te(n,!0);const y=s&&"foreignObject"!==e.type;if(h?O(t.dynamicChildren,h,l,n,r,y,o):c||H(t,e,l,null,n,r,y,o,!1),u>0){if(16&u)P(l,e,p,g,n,r,s);else if(2&u&&p.class!==g.class&&a(l,"class",null,g.class,s),4&u&&a(l,"style",p.style,g.style,s),8&u){const i=e.dynamicProps;for(let e=0;e<i.length;e++){const o=i[e],c=p[o],u=g[o];u===c&&"value"!==o||a(l,o,c,u,s,t.children,n,r,Q)}}1&u&&t.children!==e.children&&d(l,e.children)}else c||null!=h||P(l,e,p,g,n,r,s);((m=g.onVnodeUpdated)||f)&&Ae((()=>{m&&gn(m,n,e,t),f&&Ot(e,t,n,"updated")}),r)},O=(t,e,n,r,i,s,o)=>{for(let a=0;a<e.length;a++){const c=t[a],l=e[a],u=c.el&&(c.type===Fe||!Ze(c,l)||70&c.shapeFlag)?f(c.el):n;y(c,l,u,null,r,i,s,o,!0)}},P=(t,e,n,r,s,o,c)=>{if(n!==r){if(n!==i.kT)for(const l in n)(0,i.Gg)(l)||l in r||a(t,l,n[l],null,c,e.children,s,o,Q);for(const l in r){if((0,i.Gg)(l))continue;const u=r[l],h=n[l];u!==h&&"value"!==l&&a(t,l,h,u,c,e.children,s,o,Q)}"value"in r&&a(t,"value",n.value,r.value)}},x=(t,e,n,r,i,o,a,c,u)=>{const h=e.el=t?t.el:l(""),d=e.anchor=t?t.anchor:l("");let{patchFlag:f,dynamicChildren:p,slotScopeIds:g}=e;g&&(c=c?c.concat(g):g),null==t?(s(h,n,r),s(d,n,r),N(e.children,n,d,i,o,a,c,u)):f>0&&64&f&&p&&t.dynamicChildren?(O(t.dynamicChildren,p,n,i,o,a,c),(null!=e.key||i&&e===i.subTree)&&ke(t,e,!0)):H(t,e,n,d,i,o,a,c,u)},M=(t,e,n,r,i,s,o,a,c)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?i.ctx.activate(e,n,r,o,c):B(e,n,r,i,s,o,c):U(t,e,c)},B=(t,e,n,r,i,s,o)=>{const a=t.component=wn(t,r,i);if(ht(t)&&(a.ctx.renderer=tt),Tn(a),a.asyncDep){if(i&&i.registerDep(a,z),!t.el){const t=a.subTree=sn(Ve);b(null,t,e,n)}}else z(a,t,e,n,i,s,o)},U=(t,e,n)=>{const r=e.component=t.component;if(F(t,e,n)){if(r.asyncDep&&!r.asyncResolved)return void j(r,e,n);r.next=e,_(r.update),r.update()}else e.el=t.el,r.vnode=e},z=(t,e,n,s,o,a,c)=>{const l=()=>{if(t.isMounted){let e,{next:n,bu:r,u:s,parent:l,vnode:u}=t,h=n;0,Te(t,!1),n?(n.el=u.el,j(t,n,c)):n=u,r&&(0,i.ir)(r),(e=n.props&&n.props.onVnodeBeforeUpdate)&&gn(e,l,n,u),Te(t,!0);const d=L(t);0;const p=t.subTree;t.subTree=d,y(p,d,f(p.el),J(p),t,o,a),n.el=d.el,null===h&&V(t,d.el),s&&Ae(s,o),(e=n.props&&n.props.onVnodeUpdated)&&Ae((()=>gn(e,l,n,u)),o)}else{let r;const{el:c,props:l}=e,{bm:u,m:h,parent:d}=t,f=ut(e);if(Te(t,!1),u&&(0,i.ir)(u),!f&&(r=l&&l.onVnodeBeforeMount)&&gn(r,d,e),Te(t,!0),c&&nt){const n=()=>{t.subTree=L(t),nt(c,t.subTree,t,o,null)};f?e.type.__asyncLoader().then((()=>!t.isUnmounted&&n())):n()}else{0;const r=t.subTree=L(t);0,y(null,r,n,s,t,o,a),e.el=r.el}if(h&&Ae(h,o),!f&&(r=l&&l.onVnodeMounted)){const t=e;Ae((()=>gn(r,d,t)),o)}(256&e.shapeFlag||d&&ut(d.vnode)&&256&d.vnode.shapeFlag)&&t.a&&Ae(t.a,o),t.isMounted=!0,e=n=s=null}},u=t.effect=new r.qq(l,(()=>v(h)),t.scope),h=t.update=()=>u.run();h.id=t.uid,Te(t,!0),h()},j=(t,e,n)=>{e.component=t;const i=t.vnode.props;t.vnode=e,t.next=null,ie(t,e.props,i,n),we(t,e.children,n),(0,r.Jd)(),A(),(0,r.lk)()},H=(t,e,n,r,i,s,o,a,c=!1)=>{const l=t&&t.children,u=t?t.shapeFlag:0,h=e.children,{patchFlag:f,shapeFlag:p}=e;if(f>0){if(128&f)return void K(l,h,n,r,i,s,o,a,c);if(256&f)return void $(l,h,n,r,i,s,o,a,c)}8&p?(16&u&&Q(l,i,s),h!==l&&d(n,h)):16&u?16&p?K(l,h,n,r,i,s,o,a,c):Q(l,i,s,!0):(8&u&&d(n,""),16&p&&N(h,n,r,i,s,o,a,c))},$=(t,e,n,r,s,o,a,c,l)=>{t=t||i.Z6,e=e||i.Z6;const u=t.length,h=e.length,d=Math.min(u,h);let f;for(f=0;f<d;f++){const r=e[f]=l?dn(e[f]):hn(e[f]);y(t[f],r,n,null,s,o,a,c,l)}u>h?Q(t,s,o,!0,!1,d):N(e,n,r,s,o,a,c,l,d)},K=(t,e,n,r,s,o,a,c,l)=>{let u=0;const h=e.length;let d=t.length-1,f=h-1;while(u<=d&&u<=f){const r=t[u],i=e[u]=l?dn(e[u]):hn(e[u]);if(!Ze(r,i))break;y(r,i,n,null,s,o,a,c,l),u++}while(u<=d&&u<=f){const r=t[d],i=e[f]=l?dn(e[f]):hn(e[f]);if(!Ze(r,i))break;y(r,i,n,null,s,o,a,c,l),d--,f--}if(u>d){if(u<=f){const t=f+1,i=t<h?e[t].el:r;while(u<=f)y(null,e[u]=l?dn(e[u]):hn(e[u]),n,i,s,o,a,c,l),u++}}else if(u>f)while(u<=d)q(t[u],s,o,!0),u++;else{const p=u,g=u,m=new Map;for(u=g;u<=f;u++){const t=e[u]=l?dn(e[u]):hn(e[u]);null!=t.key&&m.set(t.key,u)}let w,b=0;const v=f-g+1;let E=!1,_=0;const S=new Array(v);for(u=0;u<v;u++)S[u]=0;for(u=p;u<=d;u++){const r=t[u];if(b>=v){q(r,s,o,!0);continue}let i;if(null!=r.key)i=m.get(r.key);else for(w=g;w<=f;w++)if(0===S[w-g]&&Ze(r,e[w])){i=w;break}void 0===i?q(r,s,o,!0):(S[i-g]=u+1,i>=_?_=i:E=!0,y(r,e[i],n,null,s,o,a,c,l),b++)}const A=E?Re(S):i.Z6;for(w=A.length-1,u=v-1;u>=0;u--){const t=g+u,i=e[t],d=t+1<h?e[t+1].el:r;0===S[u]?y(null,i,n,d,s,o,a,c,l):E&&(w<0||u!==A[w]?G(i,n,d,2):w--)}}},G=(t,e,n,r,i=null)=>{const{el:o,type:a,transition:c,children:l,shapeFlag:u}=t;if(6&u)return void G(t.component.subTree,e,n,r);if(128&u)return void t.suspense.move(e,n,r);if(64&u)return void a.move(t,e,n,tt);if(a===Fe){s(o,e,n);for(let t=0;t<l.length;t++)G(l[t],e,n,r);return void s(t.anchor,e,n)}if(a===je)return void S(t,e,n);const h=2!==r&&1&u&&c;if(h)if(0===r)c.beforeEnter(o),s(o,e,n),Ae((()=>c.enter(o)),i);else{const{leave:t,delayLeave:r,afterLeave:i}=c,a=()=>s(o,e,n),l=()=>{t(o,(()=>{a(),i&&i()}))};r?r(o,a,l):l()}else s(o,e,n)},q=(t,e,n,r=!1,i=!1)=>{const{type:s,props:o,ref:a,children:c,dynamicChildren:l,shapeFlag:u,patchFlag:h,dirs:d}=t;if(null!=a&&_e(a,null,n,t,!0),256&u)return void e.ctx.deactivate(t);const f=1&u&&d,p=!ut(t);let g;if(p&&(g=o&&o.onVnodeBeforeUnmount)&&gn(g,e,t),6&u)X(t.component,n,r);else{if(128&u)return void t.suspense.unmount(n,r);f&&Ot(t,null,e,"beforeUnmount"),64&u?t.type.remove(t,e,n,i,tt,r):l&&(s!==Fe||h>0&&64&h)?Q(l,e,n,!1,!0):(s===Fe&&384&h||!i&&16&u)&&Q(c,e,n),r&&W(t)}(p&&(g=o&&o.onVnodeUnmounted)||f)&&Ae((()=>{g&&gn(g,e,t),f&&Ot(t,null,e,"unmounted")}),n)},W=t=>{const{type:e,el:n,anchor:r,transition:i}=t;if(e===Fe)return void Y(n,r);if(e===je)return void I(t);const s=()=>{o(n),i&&!i.persisted&&i.afterLeave&&i.afterLeave()};if(1&t.shapeFlag&&i&&!i.persisted){const{leave:e,delayLeave:r}=i,o=()=>e(n,s);r?r(t.el,s,o):o()}else s()},Y=(t,e)=>{let n;while(t!==e)n=p(t),o(t),t=n;o(e)},X=(t,e,n)=>{const{bum:r,scope:s,update:o,subTree:a,um:c}=t;r&&(0,i.ir)(r),s.stop(),o&&(o.active=!1,q(a,t,e,n)),c&&Ae(c,e),Ae((()=>{t.isUnmounted=!0}),e),e&&e.pendingBranch&&!e.isUnmounted&&t.asyncDep&&!t.asyncResolved&&t.suspenseId===e.pendingId&&(e.deps--,0===e.deps&&e.resolve())},Q=(t,e,n,r=!1,i=!1,s=0)=>{for(let o=s;o<t.length;o++)q(t[o],e,n,r,i)},J=t=>6&t.shapeFlag?J(t.component.subTree):128&t.shapeFlag?t.suspense.next():p(t.anchor||t.el),Z=(t,e,n)=>{null==t?e._vnode&&q(e._vnode,null,null,!0):y(e._vnode||null,t,e,null,null,null,n),A(),C(),e._vnode=t},tt={p:y,um:q,m:G,r:W,mt:B,mc:N,pc:H,pbc:O,n:J,o:t};let et,nt;return e&&([et,nt]=e(tt)),{render:Z,hydrate:et,createApp:Ee(Z,et)}}function Te({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function ke(t,e,n=!1){const r=t.children,s=e.children;if((0,i.kJ)(r)&&(0,i.kJ)(s))for(let i=0;i<r.length;i++){const t=r[i];let e=s[i];1&e.shapeFlag&&!e.dynamicChildren&&((e.patchFlag<=0||32===e.patchFlag)&&(e=s[i]=dn(s[i]),e.el=t.el),n||ke(t,e)),e.type===ze&&(e.el=t.el)}}function Re(t){const e=t.slice(),n=[0];let r,i,s,o,a;const c=t.length;for(r=0;r<c;r++){const c=t[r];if(0!==c){if(i=n[n.length-1],t[i]<c){e[r]=i,n.push(r);continue}s=0,o=n.length-1;while(s<o)a=s+o>>1,t[n[a]]<c?s=a+1:o=a;c<t[n[s]]&&(s>0&&(e[r]=n[s-1]),n[s]=r)}}s=n.length,o=n[s-1];while(s-- >0)n[s]=o,o=e[o];return n}const Ne=t=>t.__isTeleport,De=t=>t&&(t.disabled||""===t.disabled),Oe=t=>"undefined"!==typeof SVGElement&&t instanceof SVGElement,Pe=(t,e)=>{const n=t&&t.to;if((0,i.HD)(n)){if(e){const t=e(n);return t}return null}return n},xe={__isTeleport:!0,process(t,e,n,r,i,s,o,a,c,l){const{mc:u,pc:h,pbc:d,o:{insert:f,querySelector:p,createText:g,createComment:m}}=l,y=De(e.props);let{shapeFlag:w,children:b,dynamicChildren:v}=e;if(null==t){const t=e.el=g(""),l=e.anchor=g("");f(t,n,r),f(l,n,r);const h=e.target=Pe(e.props,p),d=e.targetAnchor=g("");h&&(f(d,h),o=o||Oe(h));const m=(t,e)=>{16&w&&u(b,t,e,i,s,o,a,c)};y?m(n,l):h&&m(h,d)}else{e.el=t.el;const r=e.anchor=t.anchor,u=e.target=t.target,f=e.targetAnchor=t.targetAnchor,g=De(t.props),m=g?n:u,w=g?r:f;if(o=o||Oe(u),v?(d(t.dynamicChildren,v,m,i,s,o,a),ke(t,e,!0)):c||h(t,e,m,w,i,s,o,a,!1),y)g||Me(e,n,r,l,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const t=e.target=Pe(e.props,p);t&&Me(e,t,null,l,0)}else g&&Me(e,u,f,l,1)}Ue(e)},remove(t,e,n,r,{um:i,o:{remove:s}},o){const{shapeFlag:a,children:c,anchor:l,targetAnchor:u,target:h,props:d}=t;if(h&&s(u),(o||!De(d))&&(s(l),16&a))for(let f=0;f<c.length;f++){const t=c[f];i(t,e,n,!0,!!t.dynamicChildren)}},move:Me,hydrate:Le};function Me(t,e,n,{o:{insert:r},m:i},s=2){0===s&&r(t.targetAnchor,e,n);const{el:o,anchor:a,shapeFlag:c,children:l,props:u}=t,h=2===s;if(h&&r(o,e,n),(!h||De(u))&&16&c)for(let d=0;d<l.length;d++)i(l[d],e,n,2);h&&r(a,e,n)}function Le(t,e,n,r,i,s,{o:{nextSibling:o,parentNode:a,querySelector:c}},l){const u=e.target=Pe(e.props,c);if(u){const c=u._lpa||u.firstChild;if(16&e.shapeFlag)if(De(e.props))e.anchor=l(o(t),e,a(t),n,r,i,s),e.targetAnchor=c;else{e.anchor=o(t);let a=c;while(a)if(a=o(a),a&&8===a.nodeType&&"teleport anchor"===a.data){e.targetAnchor=a,u._lpa=e.targetAnchor&&o(e.targetAnchor);break}l(c,e,u,n,r,i,s)}Ue(e)}return e.anchor&&o(e.anchor)}const Be=xe;function Ue(t){const e=t.ctx;if(e&&e.ut){let n=t.children[0].el;while(n!==t.targetAnchor)1===n.nodeType&&n.setAttribute("data-v-owner",e.uid),n=n.nextSibling;e.ut()}}const Fe=Symbol(void 0),ze=Symbol(void 0),Ve=Symbol(void 0),je=Symbol(void 0),He=[];let $e=null;function Ke(t=!1){He.push($e=t?null:[])}function Ge(){He.pop(),$e=He[He.length-1]||null}let qe=1;function We(t){qe+=t}function Ye(t){return t.dynamicChildren=qe>0?$e||i.Z6:null,Ge(),qe>0&&$e&&$e.push(t),t}function Xe(t,e,n,r,i,s){return Ye(rn(t,e,n,r,i,s,!0))}function Qe(t,e,n,r,i){return Ye(sn(t,e,n,r,i,!0))}function Je(t){return!!t&&!0===t.__v_isVNode}function Ze(t,e){return t.type===e.type&&t.key===e.key}const tn="__vInternal",en=({key:t})=>null!=t?t:null,nn=({ref:t,ref_key:e,ref_for:n})=>null!=t?(0,i.HD)(t)||(0,r.dq)(t)||(0,i.mf)(t)?{i:O,r:t,k:e,f:!!n}:t:null;function rn(t,e=null,n=null,r=0,s=null,o=(t===Fe?0:1),a=!1,c=!1){const l={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&en(e),ref:e&&nn(e),scopeId:P,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:r,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:O};return c?(fn(l,n),128&o&&t.normalize(l)):n&&(l.shapeFlag|=(0,i.HD)(n)?8:16),qe>0&&!a&&$e&&(l.patchFlag>0||6&o)&&32!==l.patchFlag&&$e.push(l),l}const sn=on;function on(t,e=null,n=null,s=0,o=null,a=!1){if(t&&t!==Mt||(t=Ve),Je(t)){const r=cn(t,e,!0);return n&&fn(r,n),qe>0&&!a&&$e&&(6&r.shapeFlag?$e[$e.indexOf(t)]=r:$e.push(r)),r.patchFlag|=-2,r}if(Mn(t)&&(t=t.__vccOpts),e){e=an(e);let{class:t,style:n}=e;t&&!(0,i.HD)(t)&&(e.class=(0,i.C_)(t)),(0,i.Kn)(n)&&((0,r.X3)(n)&&!(0,i.kJ)(n)&&(n=(0,i.l7)({},n)),e.style=(0,i.j5)(n))}const c=(0,i.HD)(t)?1:j(t)?128:Ne(t)?64:(0,i.Kn)(t)?4:(0,i.mf)(t)?2:0;return rn(t,e,n,s,o,c,a,!0)}function an(t){return t?(0,r.X3)(t)||tn in t?(0,i.l7)({},t):t:null}function cn(t,e,n=!1){const{props:r,ref:s,patchFlag:o,children:a}=t,c=e?pn(r||{},e):r,l={__v_isVNode:!0,__v_skip:!0,type:t.type,props:c,key:c&&en(c),ref:e&&e.ref?n&&s?(0,i.kJ)(s)?s.concat(nn(e)):[s,nn(e)]:nn(e):s,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==Fe?-1===o?16:16|o:o,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&cn(t.ssContent),ssFallback:t.ssFallback&&cn(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return l}function ln(t=" ",e=0){return sn(ze,null,t,e)}function un(t="",e=!1){return e?(Ke(),Qe(Ve,null,t)):sn(Ve,null,t)}function hn(t){return null==t||"boolean"===typeof t?sn(Ve):(0,i.kJ)(t)?sn(Fe,null,t.slice()):"object"===typeof t?dn(t):sn(ze,null,String(t))}function dn(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:cn(t)}function fn(t,e){let n=0;const{shapeFlag:r}=t;if(null==e)e=null;else if((0,i.kJ)(e))n=16;else if("object"===typeof e){if(65&r){const n=e.default;return void(n&&(n._c&&(n._d=!1),fn(t,n()),n._c&&(n._d=!0)))}{n=32;const r=e._;r||tn in e?3===r&&O&&(1===O.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=O}}else(0,i.mf)(e)?(e={default:e,_ctx:O},n=32):(e=String(e),64&r?(n=16,e=[ln(e)]):n=8);t.children=e,t.shapeFlag|=n}function pn(...t){const e={};for(let n=0;n<t.length;n++){const r=t[n];for(const t in r)if("class"===t)e.class!==r.class&&(e.class=(0,i.C_)([e.class,r.class]));else if("style"===t)e.style=(0,i.j5)([e.style,r.style]);else if((0,i.F7)(t)){const n=e[t],s=r[t];!s||n===s||(0,i.kJ)(n)&&n.includes(s)||(e[t]=n?[].concat(n,s):s)}else""!==t&&(e[t]=r[t])}return e}function gn(t,e,n,r=null){o(t,e,7,[n,r])}const mn=be();let yn=0;function wn(t,e,n){const s=t.type,o=(e?e.appContext:t.appContext)||mn,a={uid:yn++,vnode:t,type:s,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,scope:new r.Bj(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ae(s,o),emitsOptions:N(s,o),emit:null,emitted:null,propsDefaults:i.kT,inheritAttrs:s.inheritAttrs,ctx:i.kT,data:i.kT,props:i.kT,attrs:i.kT,slots:i.kT,refs:i.kT,setupState:i.kT,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=R.bind(null,a),t.ce&&t.ce(a),a}let bn=null;const vn=()=>bn||O,En=t=>{bn=t,t.scope.on()},_n=()=>{bn&&bn.scope.off(),bn=null};function Sn(t){return 4&t.vnode.shapeFlag}let An,Cn,In=!1;function Tn(t,e=!1){In=e;const{props:n,children:r}=t.vnode,i=Sn(t);re(t,n,i,e),ye(t,r);const s=i?kn(t,e):void 0;return In=!1,s}function kn(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=(0,r.Xl)(new Proxy(t.ctx,jt));const{setup:o}=n;if(o){const n=t.setupContext=o.length>1?On(t):null;En(t),(0,r.Jd)();const c=s(o,t,0,[t.props,n]);if((0,r.lk)(),_n(),(0,i.tI)(c)){if(c.then(_n,_n),e)return c.then((n=>{Rn(t,n,e)})).catch((e=>{a(e,t,0)}));t.asyncDep=c}else Rn(t,c,e)}else Nn(t,e)}function Rn(t,e,n){(0,i.mf)(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:(0,i.Kn)(e)&&(t.setupState=(0,r.WL)(e)),Nn(t,n)}function Nn(t,e,n){const s=t.type;if(!t.render){if(!e&&An&&!s.render){const e=s.template||Wt(t).template;if(e){0;const{isCustomElement:n,compilerOptions:r}=t.appContext.config,{delimiters:o,compilerOptions:a}=s,c=(0,i.l7)((0,i.l7)({isCustomElement:n,delimiters:o},r),a);s.render=An(e,c)}}t.render=s.render||i.dG,Cn&&Cn(t)}En(t),(0,r.Jd)(),$t(t),(0,r.lk)(),_n()}function Dn(t){return new Proxy(t.attrs,{get(e,n){return(0,r.j)(t,"get","$attrs"),e[n]}})}function On(t){const e=e=>{t.exposed=e||{}};let n;return{get attrs(){return n||(n=Dn(t))},slots:t.slots,emit:t.emit,expose:e}}function Pn(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy((0,r.WL)((0,r.Xl)(t.exposed)),{get(e,n){return n in e?e[n]:n in zt?zt[n](t):void 0},has(t,e){return e in t||e in zt}}))}function xn(t,e=!0){return(0,i.mf)(t)?t.displayName||t.name:t.name||e&&t.__name}function Mn(t){return(0,i.mf)(t)&&"__vccOpts"in t}const Ln=(t,e)=>(0,r.Fl)(t,e,In);function Bn(t,e,n){const r=arguments.length;return 2===r?(0,i.Kn)(e)&&!(0,i.kJ)(e)?Je(e)?sn(t,null,[e]):sn(t,e):sn(t,null,e):(r>3?n=Array.prototype.slice.call(arguments,2):3===r&&Je(n)&&(n=[n]),sn(t,e,n))}const Un=Symbol(""),Fn=()=>{{const t=K(Un);return t}};const zn="3.2.47"},9242:function(t,e,n){"use strict";n.d(e,{F8:function(){return st},ri:function(){return ut},uT:function(){return M}});n(7658);var r=n(7139),i=n(3396),s=n(4870);const o="http://www.w3.org/2000/svg",a="undefined"!==typeof document?document:null,c=a&&a.createElement("template"),l={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,r)=>{const i=e?a.createElementNS(o,t):a.createElement(t,n?{is:n}:void 0);return"select"===t&&r&&null!=r.multiple&&i.setAttribute("multiple",r.multiple),i},createText:t=>a.createTextNode(t),createComment:t=>a.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>a.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,r,i,s){const o=n?n.previousSibling:e.lastChild;if(i&&(i===s||i.nextSibling)){while(1)if(e.insertBefore(i.cloneNode(!0),n),i===s||!(i=i.nextSibling))break}else{c.innerHTML=r?`<svg>${t}</svg>`:t;const i=c.content;if(r){const t=i.firstChild;while(t.firstChild)i.appendChild(t.firstChild);i.removeChild(t)}e.insertBefore(i,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}};function u(t,e,n){const r=t._vtc;r&&(e=(e?[e,...r]:[...r]).join(" ")),null==e?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}function h(t,e,n){const i=t.style,s=(0,r.HD)(n);if(n&&!s){if(e&&!(0,r.HD)(e))for(const t in e)null==n[t]&&f(i,t,"");for(const t in n)f(i,t,n[t])}else{const r=i.display;s?e!==n&&(i.cssText=n):e&&t.removeAttribute("style"),"_vod"in t&&(i.display=r)}}const d=/\s*!important$/;function f(t,e,n){if((0,r.kJ)(n))n.forEach((n=>f(t,e,n)));else if(null==n&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const i=m(t,e);d.test(n)?t.setProperty((0,r.rs)(i),n.replace(d,""),"important"):t[i]=n}}const p=["Webkit","Moz","ms"],g={};function m(t,e){const n=g[e];if(n)return n;let i=(0,r._A)(e);if("filter"!==i&&i in t)return g[e]=i;i=(0,r.kC)(i);for(let r=0;r<p.length;r++){const n=p[r]+i;if(n in t)return g[e]=n}return e}const y="http://www.w3.org/1999/xlink";function w(t,e,n,i,s){if(i&&e.startsWith("xlink:"))null==n?t.removeAttributeNS(y,e.slice(6,e.length)):t.setAttributeNS(y,e,n);else{const i=(0,r.Pq)(e);null==n||i&&!(0,r.yA)(n)?t.removeAttribute(e):t.setAttribute(e,i?"":n)}}function b(t,e,n,i,s,o,a){if("innerHTML"===e||"textContent"===e)return i&&a(i,s,o),void(t[e]=null==n?"":n);if("value"===e&&"PROGRESS"!==t.tagName&&!t.tagName.includes("-")){t._value=n;const r=null==n?"":n;return t.value===r&&"OPTION"!==t.tagName||(t.value=r),void(null==n&&t.removeAttribute(e))}let c=!1;if(""===n||null==n){const i=typeof t[e];"boolean"===i?n=(0,r.yA)(n):null==n&&"string"===i?(n="",c=!0):"number"===i&&(n=0,c=!0)}try{t[e]=n}catch(l){0}c&&t.removeAttribute(e)}function v(t,e,n,r){t.addEventListener(e,n,r)}function E(t,e,n,r){t.removeEventListener(e,n,r)}function _(t,e,n,r,i=null){const s=t._vei||(t._vei={}),o=s[e];if(r&&o)o.value=r;else{const[n,a]=A(e);if(r){const o=s[e]=k(r,i);v(t,n,o,a)}else o&&(E(t,n,o,a),s[e]=void 0)}}const S=/(?:Once|Passive|Capture)$/;function A(t){let e;if(S.test(t)){let n;e={};while(n=t.match(S))t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}const n=":"===t[2]?t.slice(3):(0,r.rs)(t.slice(2));return[n,e]}let C=0;const I=Promise.resolve(),T=()=>C||(I.then((()=>C=0)),C=Date.now());function k(t,e){const n=t=>{if(t._vts){if(t._vts<=n.attached)return}else t._vts=Date.now();(0,i.$d)(R(t,n.value),e,5,[t])};return n.value=t,n.attached=T(),n}function R(t,e){if((0,r.kJ)(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map((t=>e=>!e._stopped&&t&&t(e)))}return e}const N=/^on[a-z]/,D=(t,e,n,i,s=!1,o,a,c,l)=>{"class"===e?u(t,i,s):"style"===e?h(t,n,i):(0,r.F7)(e)?(0,r.tR)(e)||_(t,e,n,i,a):("."===e[0]?(e=e.slice(1),1):"^"===e[0]?(e=e.slice(1),0):O(t,e,i,s))?b(t,e,i,o,a,c,l):("true-value"===e?t._trueValue=i:"false-value"===e&&(t._falseValue=i),w(t,e,i,s))};function O(t,e,n,i){return i?"innerHTML"===e||"textContent"===e||!!(e in t&&N.test(e)&&(0,r.mf)(n)):"spellcheck"!==e&&"draggable"!==e&&"translate"!==e&&("form"!==e&&(("list"!==e||"INPUT"!==t.tagName)&&(("type"!==e||"TEXTAREA"!==t.tagName)&&((!N.test(e)||!(0,r.HD)(n))&&e in t))))}"undefined"!==typeof HTMLElement&&HTMLElement;const P="transition",x="animation",M=(t,{slots:e})=>(0,i.h)(i.P$,z(t),e);M.displayName="Transition";const L={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},B=M.props=(0,r.l7)({},i.P$.props,L),U=(t,e=[])=>{(0,r.kJ)(t)?t.forEach((t=>t(...e))):t&&t(...e)},F=t=>!!t&&((0,r.kJ)(t)?t.some((t=>t.length>1)):t.length>1);function z(t){const e={};for(const r in t)r in L||(e[r]=t[r]);if(!1===t.css)return e;const{name:n="v",type:i,duration:s,enterFromClass:o=`${n}-enter-from`,enterActiveClass:a=`${n}-enter-active`,enterToClass:c=`${n}-enter-to`,appearFromClass:l=o,appearActiveClass:u=a,appearToClass:h=c,leaveFromClass:d=`${n}-leave-from`,leaveActiveClass:f=`${n}-leave-active`,leaveToClass:p=`${n}-leave-to`}=t,g=V(s),m=g&&g[0],y=g&&g[1],{onBeforeEnter:w,onEnter:b,onEnterCancelled:v,onLeave:E,onLeaveCancelled:_,onBeforeAppear:S=w,onAppear:A=b,onAppearCancelled:C=v}=e,I=(t,e,n)=>{$(t,e?h:c),$(t,e?u:a),n&&n()},T=(t,e)=>{t._isLeaving=!1,$(t,d),$(t,p),$(t,f),e&&e()},k=t=>(e,n)=>{const r=t?A:b,s=()=>I(e,t,n);U(r,[e,s]),K((()=>{$(e,t?l:o),H(e,t?h:c),F(r)||q(e,i,m,s)}))};return(0,r.l7)(e,{onBeforeEnter(t){U(w,[t]),H(t,o),H(t,a)},onBeforeAppear(t){U(S,[t]),H(t,l),H(t,u)},onEnter:k(!1),onAppear:k(!0),onLeave(t,e){t._isLeaving=!0;const n=()=>T(t,e);H(t,d),Q(),H(t,f),K((()=>{t._isLeaving&&($(t,d),H(t,p),F(E)||q(t,i,y,n))})),U(E,[t,n])},onEnterCancelled(t){I(t,!1),U(v,[t])},onAppearCancelled(t){I(t,!0),U(C,[t])},onLeaveCancelled(t){T(t),U(_,[t])}})}function V(t){if(null==t)return null;if((0,r.Kn)(t))return[j(t.enter),j(t.leave)];{const e=j(t);return[e,e]}}function j(t){const e=(0,r.He)(t);return e}function H(t,e){e.split(/\s+/).forEach((e=>e&&t.classList.add(e))),(t._vtc||(t._vtc=new Set)).add(e)}function $(t,e){e.split(/\s+/).forEach((e=>e&&t.classList.remove(e)));const{_vtc:n}=t;n&&(n.delete(e),n.size||(t._vtc=void 0))}function K(t){requestAnimationFrame((()=>{requestAnimationFrame(t)}))}let G=0;function q(t,e,n,r){const i=t._endId=++G,s=()=>{i===t._endId&&r()};if(n)return setTimeout(s,n);const{type:o,timeout:a,propCount:c}=W(t,e);if(!o)return r();const l=o+"end";let u=0;const h=()=>{t.removeEventListener(l,d),s()},d=e=>{e.target===t&&++u>=c&&h()};setTimeout((()=>{u<c&&h()}),a+1),t.addEventListener(l,d)}function W(t,e){const n=window.getComputedStyle(t),r=t=>(n[t]||"").split(", "),i=r(`${P}Delay`),s=r(`${P}Duration`),o=Y(i,s),a=r(`${x}Delay`),c=r(`${x}Duration`),l=Y(a,c);let u=null,h=0,d=0;e===P?o>0&&(u=P,h=o,d=s.length):e===x?l>0&&(u=x,h=l,d=c.length):(h=Math.max(o,l),u=h>0?o>l?P:x:null,d=u?u===P?s.length:c.length:0);const f=u===P&&/\b(transform|all)(,|$)/.test(r(`${P}Property`).toString());return{type:u,timeout:h,propCount:d,hasTransform:f}}function Y(t,e){while(t.length<e.length)t=t.concat(t);return Math.max(...e.map(((e,n)=>X(e)+X(t[n]))))}function X(t){return 1e3*Number(t.slice(0,-1).replace(",","."))}function Q(){return document.body.offsetHeight}const J=new WeakMap,Z=new WeakMap,tt={name:"TransitionGroup",props:(0,r.l7)({},B,{tag:String,moveClass:String}),setup(t,{slots:e}){const n=(0,i.FN)(),r=(0,i.Y8)();let o,a;return(0,i.ic)((()=>{if(!o.length)return;const e=t.moveClass||`${t.name||"v"}-move`;if(!it(o[0].el,n.vnode.el,e))return;o.forEach(et),o.forEach(nt);const r=o.filter(rt);Q(),r.forEach((t=>{const n=t.el,r=n.style;H(n,e),r.transform=r.webkitTransform=r.transitionDuration="";const i=n._moveCb=t=>{t&&t.target!==n||t&&!/transform$/.test(t.propertyName)||(n.removeEventListener("transitionend",i),n._moveCb=null,$(n,e))};n.addEventListener("transitionend",i)}))})),()=>{const c=(0,s.IU)(t),l=z(c);let u=c.tag||i.HY;o=a,a=e.default?(0,i.Q6)(e.default()):[];for(let t=0;t<a.length;t++){const e=a[t];null!=e.key&&(0,i.nK)(e,(0,i.U2)(e,l,r,n))}if(o)for(let t=0;t<o.length;t++){const e=o[t];(0,i.nK)(e,(0,i.U2)(e,l,r,n)),J.set(e,e.el.getBoundingClientRect())}return(0,i.Wm)(u,null,a)}}};tt.props;function et(t){const e=t.el;e._moveCb&&e._moveCb(),e._enterCb&&e._enterCb()}function nt(t){Z.set(t,t.el.getBoundingClientRect())}function rt(t){const e=J.get(t),n=Z.get(t),r=e.left-n.left,i=e.top-n.top;if(r||i){const e=t.el.style;return e.transform=e.webkitTransform=`translate(${r}px,${i}px)`,e.transitionDuration="0s",t}}function it(t,e,n){const r=t.cloneNode();t._vtc&&t._vtc.forEach((t=>{t.split(/\s+/).forEach((t=>t&&r.classList.remove(t)))})),n.split(/\s+/).forEach((t=>t&&r.classList.add(t))),r.style.display="none";const i=1===e.nodeType?e:e.parentNode;i.appendChild(r);const{hasTransform:s}=W(r);return i.removeChild(r),s}const st={beforeMount(t,{value:e},{transition:n}){t._vod="none"===t.style.display?"":t.style.display,n&&e?n.beforeEnter(t):ot(t,e)},mounted(t,{value:e},{transition:n}){n&&e&&n.enter(t)},updated(t,{value:e,oldValue:n},{transition:r}){!e!==!n&&(r?e?(r.beforeEnter(t),ot(t,!0),r.enter(t)):r.leave(t,(()=>{ot(t,!1)})):ot(t,e))},beforeUnmount(t,{value:e}){ot(t,e)}};function ot(t,e){t.style.display=e?t._vod:"none"}const at=(0,r.l7)({patchProp:D},l);let ct;function lt(){return ct||(ct=(0,i.Us)(at))}const ut=(...t)=>{const e=lt().createApp(...t);const{mount:n}=e;return e.mount=t=>{const i=ht(t);if(!i)return;const s=e._component;(0,r.mf)(s)||s.render||s.template||(s.template=i.innerHTML),i.innerHTML="";const o=n(i,!1,i instanceof SVGElement);return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},e};function ht(t){if((0,r.HD)(t)){const e=document.querySelector(t);return e}return t}},7139:function(t,e,n){"use strict";n.d(e,{C_:function(){return h},DM:function(){return P},E9:function(){return ot},F7:function(){return C},Gg:function(){return G},HD:function(){return B},He:function(){return it},Kj:function(){return M},Kn:function(){return F},NO:function(){return S},Nj:function(){return nt},Od:function(){return k},PO:function(){return $},Pq:function(){return f},RI:function(){return N},S0:function(){return K},W7:function(){return H},WV:function(){return m},Z6:function(){return E},_A:function(){return Y},_N:function(){return O},aU:function(){return tt},dG:function(){return _},e1:function(){return s},fY:function(){return r},h5:function(){return rt},hR:function(){return Z},hq:function(){return y},ir:function(){return et},j5:function(){return o},kC:function(){return J},kJ:function(){return D},kT:function(){return v},l7:function(){return T},mf:function(){return L},rs:function(){return Q},tI:function(){return z},tR:function(){return I},yA:function(){return p},yk:function(){return U},zw:function(){return w}});n(7658);function r(t,e){const n=Object.create(null),r=t.split(",");for(let i=0;i<r.length;i++)n[r[i]]=!0;return e?t=>!!n[t.toLowerCase()]:t=>!!n[t]}const i="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt",s=r(i);function o(t){if(D(t)){const e={};for(let n=0;n<t.length;n++){const r=t[n],i=B(r)?u(r):o(r);if(i)for(const t in i)e[t]=i[t]}return e}return B(t)||F(t)?t:void 0}const a=/;(?![^(]*\))/g,c=/:([^]+)/,l=/\/\*.*?\*\//gs;function u(t){const e={};return t.replace(l,"").split(a).forEach((t=>{if(t){const n=t.split(c);n.length>1&&(e[n[0].trim()]=n[1].trim())}})),e}function h(t){let e="";if(B(t))e=t;else if(D(t))for(let n=0;n<t.length;n++){const r=h(t[n]);r&&(e+=r+" ")}else if(F(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const d="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",f=r(d);function p(t){return!!t||""===t}function g(t,e){if(t.length!==e.length)return!1;let n=!0;for(let r=0;n&&r<t.length;r++)n=m(t[r],e[r]);return n}function m(t,e){if(t===e)return!0;let n=x(t),r=x(e);if(n||r)return!(!n||!r)&&t.getTime()===e.getTime();if(n=U(t),r=U(e),n||r)return t===e;if(n=D(t),r=D(e),n||r)return!(!n||!r)&&g(t,e);if(n=F(t),r=F(e),n||r){if(!n||!r)return!1;const i=Object.keys(t).length,s=Object.keys(e).length;if(i!==s)return!1;for(const n in t){const r=t.hasOwnProperty(n),i=e.hasOwnProperty(n);if(r&&!i||!r&&i||!m(t[n],e[n]))return!1}}return String(t)===String(e)}function y(t,e){return t.findIndex((t=>m(t,e)))}const w=t=>B(t)?t:null==t?"":D(t)||F(t)&&(t.toString===V||!L(t.toString))?JSON.stringify(t,b,2):String(t),b=(t,e)=>e&&e.__v_isRef?b(t,e.value):O(e)?{[`Map(${e.size})`]:[...e.entries()].reduce(((t,[e,n])=>(t[`${e} =>`]=n,t)),{})}:P(e)?{[`Set(${e.size})`]:[...e.values()]}:!F(e)||D(e)||$(e)?e:String(e),v={},E=[],_=()=>{},S=()=>!1,A=/^on[^a-z]/,C=t=>A.test(t),I=t=>t.startsWith("onUpdate:"),T=Object.assign,k=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},R=Object.prototype.hasOwnProperty,N=(t,e)=>R.call(t,e),D=Array.isArray,O=t=>"[object Map]"===j(t),P=t=>"[object Set]"===j(t),x=t=>"[object Date]"===j(t),M=t=>"[object RegExp]"===j(t),L=t=>"function"===typeof t,B=t=>"string"===typeof t,U=t=>"symbol"===typeof t,F=t=>null!==t&&"object"===typeof t,z=t=>F(t)&&L(t.then)&&L(t.catch),V=Object.prototype.toString,j=t=>V.call(t),H=t=>j(t).slice(8,-1),$=t=>"[object Object]"===j(t),K=t=>B(t)&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,G=r(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),q=t=>{const e=Object.create(null);return n=>{const r=e[n];return r||(e[n]=t(n))}},W=/-(\w)/g,Y=q((t=>t.replace(W,((t,e)=>e?e.toUpperCase():"")))),X=/\B([A-Z])/g,Q=q((t=>t.replace(X,"-$1").toLowerCase())),J=q((t=>t.charAt(0).toUpperCase()+t.slice(1))),Z=q((t=>t?`on${J(t)}`:"")),tt=(t,e)=>!Object.is(t,e),et=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},nt=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},rt=t=>{const e=parseFloat(t);return isNaN(e)?t:e},it=t=>{const e=B(t)?Number(t):NaN;return isNaN(e)?t:e};let st;const ot=()=>st||(st="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{})},1271:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658),e.byteLength=u,e.toByteArray=d,e.fromByteArray=g;for(var r=[],i=[],s="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],i[o.charCodeAt(a)]=a;function l(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=t.indexOf("=");-1===n&&(n=e);var r=n===e?0:4-n%4;return[n,r]}function u(t){var e=l(t),n=e[0],r=e[1];return 3*(n+r)/4-r}function h(t,e,n){return 3*(e+n)/4-n}function d(t){var e,n,r=l(t),o=r[0],a=r[1],c=new s(h(t,o,a)),u=0,d=a>0?o-4:o;for(n=0;n<d;n+=4)e=i[t.charCodeAt(n)]<<18|i[t.charCodeAt(n+1)]<<12|i[t.charCodeAt(n+2)]<<6|i[t.charCodeAt(n+3)],c[u++]=e>>16&255,c[u++]=e>>8&255,c[u++]=255&e;return 2===a&&(e=i[t.charCodeAt(n)]<<2|i[t.charCodeAt(n+1)]>>4,c[u++]=255&e),1===a&&(e=i[t.charCodeAt(n)]<<10|i[t.charCodeAt(n+1)]<<4|i[t.charCodeAt(n+2)]>>2,c[u++]=e>>8&255,c[u++]=255&e),c}function f(t){return r[t>>18&63]+r[t>>12&63]+r[t>>6&63]+r[63&t]}function p(t,e,n){for(var r,i=[],s=e;s<n;s+=3)r=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),i.push(f(r));return i.join("")}function g(t){for(var e,n=t.length,i=n%3,s=[],o=16383,a=0,c=n-i;a<c;a+=o)s.push(p(t,a,a+o>c?c:a+o));return 1===i?(e=t[n-1],s.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],s.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},7336:function(t,e,n){"use strict";const r=n(411);function i(t){return"function"===typeof t.stream?r(t.stream()):r(new Response(t).body)}t.exports=i},411:function(t){"use strict";async function*e(t,e={}){const n=t.getReader();try{while(1){const t=await n.read();if(t.done)return;yield t.value}}finally{!0!==e.preventCancel&&n.cancel(),n.releaseLock()}}t.exports=e},8716:function(t,e,n){"use strict";n(7658);var r={single_source_shortest_paths:function(t,e,n){var i={},s={};s[e]=0;var o,a,c,l,u,h,d,f,p,g=r.PriorityQueue.make();g.push(e,0);while(!g.empty())for(c in o=g.pop(),a=o.value,l=o.cost,u=t[a]||{},u)u.hasOwnProperty(c)&&(h=u[c],d=l+h,f=s[c],p="undefined"===typeof s[c],(p||f>d)&&(s[c]=d,g.push(c,d),i[c]=a));if("undefined"!==typeof n&&"undefined"===typeof s[n]){var m=["Could not find a path from ",e," to ",n,"."].join("");throw new Error(m)}return i},extract_shortest_path_from_predecessor_list:function(t,e){var n=[],r=e;while(r)n.push(r),t[r],r=t[r];return n.reverse(),n},find_path:function(t,e,n){var i=r.single_source_shortest_paths(t,e,n);return r.extract_shortest_path_from_predecessor_list(i,n)},PriorityQueue:{make:function(t){var e,n=r.PriorityQueue,i={};for(e in t=t||{},n)n.hasOwnProperty(e)&&(i[e]=n[e]);return i.queue=[],i.sorter=t.sorter||n.default_sorter,i},default_sorter:function(t,e){return t.cost-e.cost},push:function(t,e){var n={value:t,cost:e};this.queue.push(n),this.queue.sort(this.sorter)},pop:function(){return this.queue.shift()},empty:function(){return 0===this.queue.length}}};t.exports=r},4700:function(t,e,n){"use strict";n(7658),n(3767),n(8585),n(8696),t.exports=function(t){for(var e=[],n=t.length,r=0;r<n;r++){var i=t.charCodeAt(r);if(i>=55296&&i<=56319&&n>r+1){var s=t.charCodeAt(r+1);s>=56320&&s<=57343&&(i=1024*(i-55296)+s-56320+65536,r+=1)}i<128?e.push(i):i<2048?(e.push(i>>6|192),e.push(63&i|128)):i<55296||i>=57344&&i<65536?(e.push(i>>12|224),e.push(i>>6&63|128),e.push(63&i|128)):i>=65536&&i<=1114111?(e.push(i>>18|240),e.push(i>>12&63|128),e.push(i>>6&63|128),e.push(63&i|128)):e.push(239,191,189)}return new Uint8Array(e).buffer}},9998:function(t){"use strict";function e(t,e){for(const n in e)Object.defineProperty(t,n,{value:e[n],enumerable:!0,configurable:!0});return t}function n(t,n,r){if(!t||"string"===typeof t)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"===typeof n&&(r=n,n=""),n&&(r.code=n);try{return e(t,r)}catch(i){r.message=t.message,r.stack=t.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(t));const s=e(new n,r);return s}}t.exports=n},9150:function(t,e,n){"use strict";n(7658);const r=n(1946),{fromString:i}=n(6555);class s{constructor(t,e,n=0){this._options=t,this._popCount=0,this._parent=e,this._posAtParent=n,this._children=new r,this.key=null}async put(t,e){const n=await this._findNewBucketAndPos(t);await n.bucket._putAt(n,t,e)}async get(t){const e=await this._findChild(t);if(e)return e.value}async del(t){const e=await this._findPlace(t),n=e.bucket._at(e.pos);n&&n.key===t&&e.bucket._delAt(e.pos)}leafCount(){const t=this._children.compactArray();return t.reduce(((t,e)=>e instanceof s?t+e.leafCount():t+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const t=this._children.compactArray();for(const e of t)e instanceof s?yield*e.eachLeafSeries():yield e;return[]}serialize(t,e){const n=[];return e(this._children.reduce(((n,r,i)=>(r&&(r instanceof s?n.push(r.serialize(t,e)):n.push(t(r,i))),n)),n))}asyncTransform(t,e){return l(this,t,e)}toJSON(){return this.serialize(a,c)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){const e=await this._findPlace(t),n=e.bucket._at(e.pos);if(!(n instanceof s))return n&&n.key===t?n:void 0}async _findPlace(t){const e=this._options.hash("string"===typeof t?i(t):t),n=await e.take(this._options.bits),r=this._children.get(n);return r instanceof s?r._findPlace(e):{bucket:this,pos:n,hash:e,existingChild:r}}async _findNewBucketAndPos(t){const e=await this._findPlace(t);if(e.existingChild&&e.existingChild.key!==t){const t=new s(this._options,e.bucket,e.pos);e.bucket._putObjectAt(e.pos,t);const n=await t._findPlace(e.existingChild.hash);return n.bucket._putAt(n,e.existingChild.key,e.existingChild.value),t._findNewBucketAndPos(e.hash)}return e}_putAt(t,e,n){this._putObjectAt(t.pos,{key:e,value:n,hash:t.hash})}_putObjectAt(t,e){this._children.get(t)||this._popCount++,this._children.set(t,e)}_delAt(t){if(-1===t)throw new Error("Invalid position");this._children.get(t)&&this._popCount--,this._children.unset(t),this._level()}_level(){if(this._parent&&this._popCount<=1)if(1===this._popCount){const t=this._children.find(o);if(t&&!(t instanceof s)){const e=t.hash;e.untake(this._options.bits);const n={pos:this._posAtParent,hash:e,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(t){return this._children.get(t)}}function o(t){return Boolean(t)}function a(t,e){return t.key}function c(t){return t}async function l(t,e,n){const r=[];for(const i of t._children.compactArray())if(i instanceof s)await l(i,e,n);else{const n=await e(i);r.push({bitField:t._children.bitField(),children:n})}return n(r)}t.exports=s},8950:function(t){"use strict";const e=[255,254,252,248,240,224,192,128],n=[1,3,7,15,31,63,127,255];function r(t,e,n){const r=i(e,n);return(t&r)>>>e}function i(t,r){return e[t]&n[Math.min(r+t-1,7)]}t.exports=class{constructor(t){this._value=t,this._currentBytePos=t.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(t){let e=t,n=0;while(e&&this._haveBits()){const t=this._value[this._currentBytePos],i=this._currentBitPos+1,s=Math.min(i,e),o=r(t,i-s,s);n=(n<<s)+o,e-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(t){this._currentBitPos+=t;while(this._currentBitPos>7)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}},3165:function(t,e,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=n(8950),{concat:i}=n(5489);function s(t){function e(e){return e instanceof o?e:new o(e,t)}return e}class o{constructor(t,e){if(!(t instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=t,this._hashFn=e,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(t){let e=t;while(this._availableBits<e)await this._produceMoreBits();let n=0;while(e>0){const t=this._buffers[this._currentBufferIndex],r=Math.min(t.availableBits(),e),i=t.take(r);n=(n<<r)+i,e-=r,this._availableBits-=r,0===t.availableBits()&&this._currentBufferIndex++}return n}untake(t){let e=t;while(e>0){const t=this._buffers[this._currentBufferIndex],n=Math.min(t.totalBits()-t.availableBits(),e);t.untake(n),e-=n,this._availableBits+=n,this._currentBufferIndex>0&&t.totalBits()===t.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const t=this._depth?i([this._value,Uint8Array.from([this._depth])]):this._value,e=await this._hashFn(t),n=new r(e);this._buffers.push(n),this._availableBits+=n.availableBits()}}t.exports=s,t.exports.InfiniteHash=o},9800:function(t,e,n){"use strict";const r=n(9150),i=n(3165);function s(t){if(!t||!t.hashFn)throw new Error("please define an options.hashFn");const e={bits:t.bits||8,hash:i(t.hashFn)};return new r(e)}t.exports={createHAMT:s,Bucket:r}},4405:function(t,e,n){"use strict";n.d(e,{t2:function(){return J}});var r;n(7658);(function(t){t[t["QR_CODE"]=0]="QR_CODE",t[t["AZTEC"]=1]="AZTEC",t[t["CODABAR"]=2]="CODABAR",t[t["CODE_39"]=3]="CODE_39",t[t["CODE_93"]=4]="CODE_93",t[t["CODE_128"]=5]="CODE_128",t[t["DATA_MATRIX"]=6]="DATA_MATRIX",t[t["MAXICODE"]=7]="MAXICODE",t[t["ITF"]=8]="ITF",t[t["EAN_13"]=9]="EAN_13",t[t["EAN_8"]=10]="EAN_8",t[t["PDF_417"]=11]="PDF_417",t[t["RSS_14"]=12]="RSS_14",t[t["RSS_EXPANDED"]=13]="RSS_EXPANDED",t[t["UPC_A"]=14]="UPC_A",t[t["UPC_E"]=15]="UPC_E",t[t["UPC_EAN_EXTENSION"]=16]="UPC_EAN_EXTENSION"})(r||(r={}));var i,s,o=new Map([[r.QR_CODE,"QR_CODE"],[r.AZTEC,"AZTEC"],[r.CODABAR,"CODABAR"],[r.CODE_39,"CODE_39"],[r.CODE_93,"CODE_93"],[r.CODE_128,"CODE_128"],[r.DATA_MATRIX,"DATA_MATRIX"],[r.MAXICODE,"MAXICODE"],[r.ITF,"ITF"],[r.EAN_13,"EAN_13"],[r.EAN_8,"EAN_8"],[r.PDF_417,"PDF_417"],[r.RSS_14,"RSS_14"],[r.RSS_EXPANDED,"RSS_EXPANDED"],[r.UPC_A,"UPC_A"],[r.UPC_E,"UPC_E"],[r.UPC_EAN_EXTENSION,"UPC_EAN_EXTENSION"]]);function a(t){return Object.values(r).includes(t)}(function(t){t[t["UNKNOWN"]=0]="UNKNOWN",t[t["URL"]=1]="URL"})(i||(i={})),function(t){t[t["SCAN_TYPE_CAMERA"]=0]="SCAN_TYPE_CAMERA",t[t["SCAN_TYPE_FILE"]=1]="SCAN_TYPE_FILE"}(s||(s={}));var c,l=function(){function t(){}return t.GITHUB_PROJECT_URL="https://github.com/mebjas/html5-qrcode",t.SCAN_DEFAULT_FPS=2,t.DEFAULT_DISABLE_FLIP=!1,t.DEFAULT_REMEMBER_LAST_CAMERA_USED=!0,t.DEFAULT_SUPPORTED_SCAN_TYPE=[s.SCAN_TYPE_CAMERA,s.SCAN_TYPE_FILE],t}(),u=function(){function t(t,e){this.format=t,this.formatName=e}return t.prototype.toString=function(){return this.formatName},t.create=function(e){if(!o.has(e))throw e+" not in html5QrcodeSupportedFormatsTextMap";return new t(e,o.get(e))},t}(),h=function(){function t(){}return t.createFromText=function(t){var e={text:t};return{decodedText:t,result:e}},t.createFromQrcodeResult=function(t){return{decodedText:t.text,result:t}},t}();(function(t){t[t["UNKWOWN_ERROR"]=0]="UNKWOWN_ERROR",t[t["IMPLEMENTATION_ERROR"]=1]="IMPLEMENTATION_ERROR",t[t["NO_CODE_FOUND_ERROR"]=2]="NO_CODE_FOUND_ERROR"})(c||(c={}));var d=function(){function t(){}return t.createFrom=function(t){return{errorMessage:t,type:c.UNKWOWN_ERROR}},t}(),f=function(){function t(t){this.verbose=t}return t.prototype.log=function(t){this.verbose&&console.log(t)},t.prototype.warn=function(t){this.verbose&&console.warn(t)},t.prototype.logError=function(t,e){(this.verbose||!0===e)&&console.error(t)},t.prototype.logErrors=function(t){if(0===t.length)throw"Logger#logError called without arguments";this.verbose&&console.error(t)},t}();function p(t){return"undefined"===typeof t||null===t}function g(t,e,n){return t>n?n:t<e?e:t}var m,y=function(){function t(){}return t.codeParseError=function(t){return"QR code parse error, error = "+t},t.errorGettingUserMedia=function(t){return"Error getting userMedia, error = "+t},t.onlyDeviceSupportedError=function(){return"The device doesn't support navigator.mediaDevices , only supported cameraIdOrConfig in this case is deviceId parameter (string)."},t.cameraStreamingNotSupported=function(){return"Camera streaming not supported by the browser."},t.unableToQuerySupportedDevices=function(){return"Unable to query supported devices, unknown error."},t.insecureContextCameraQueryError=function(){return"Camera access is only supported in secure context like https or localhost."},t}(),w=function(){function t(){}return t.scanningStatus=function(){return"Scanning"},t.idleStatus=function(){return"Idle"},t.errorStatus=function(){return"Error"},t.permissionStatus=function(){return"Permission"},t.noCameraFoundErrorStatus=function(){return"No Cameras"},t.lastMatch=function(t){return"Last Match: "+t},t.codeScannerTitle=function(){return"Code Scanner"},t.cameraPermissionTitle=function(){return"Request Camera Permissions"},t.cameraPermissionRequesting=function(){return"Requesting camera permissions..."},t.noCameraFound=function(){return"No camera found"},t.scanButtonStopScanningText=function(){return"Stop Scanning"},t.scanButtonStartScanningText=function(){return"Start Scanning"},t.torchOnButton=function(){return"Switch On Torch"},t.torchOffButton=function(){return"Switch Off Torch"},t.torchOnFailedMessage=function(){return"Failed to turn on torch"},t.torchOffFailedMessage=function(){return"Failed to turn off torch"},t.scanButtonScanningStarting=function(){return"Launching Camera..."},t.textIfCameraScanSelected=function(){return"Scan an Image File"},t.textIfFileScanSelected=function(){return"Scan using camera directly"},t.selectCamera=function(){return"Select Camera"},t.fileSelectionChooseImage=function(){return"Choose Image"},t.fileSelectionChooseAnother=function(){return"Choose Another"},t.fileSelectionNoImageSelected=function(){return"No image choosen"},t.anonymousCameraPrefix=function(){return"Anonymous Camera"},t.dragAndDropMessage=function(){return"Or drop an image to scan"},t.dragAndDropMessageOnlyImages=function(){return"Or drop an image to scan (other files not supported)"},t.zoom=function(){return"zoom"},t.loadingImage=function(){return"Loading image..."},t.cameraScanAltText=function(){return"Camera based scan"},t.fileScanAltText=function(){return"Fule based scan"},t}(),b=function(){function t(){}return t.poweredBy=function(){return"Powered by "},t.reportIssues=function(){return"Report issues"},t}(),v=function(){function t(){}return t.isMediaStreamConstraintsValid=function(t,e){if("object"!==typeof t){var n=typeof t;return e.logError("videoConstraints should be of type object, the object passed is of type "+n+".",!0),!1}for(var r=["autoGainControl","channelCount","echoCancellation","latency","noiseSuppression","sampleRate","sampleSize","volume"],i=new Set(r),s=Object.keys(t),o=0,a=s;o<a.length;o++){var c=a[o];if(i.has(c))return e.logError(c+" is not supported videoConstaints.",!0),!1}return!0},t}(),E=n(5176),_=function(){function t(t,e,n){if(this.formatMap=new Map([[r.QR_CODE,E.BarcodeFormat.QR_CODE],[r.AZTEC,E.BarcodeFormat.AZTEC],[r.CODABAR,E.BarcodeFormat.CODABAR],[r.CODE_39,E.BarcodeFormat.CODE_39],[r.CODE_93,E.BarcodeFormat.CODE_93],[r.CODE_128,E.BarcodeFormat.CODE_128],[r.DATA_MATRIX,E.BarcodeFormat.DATA_MATRIX],[r.MAXICODE,E.BarcodeFormat.MAXICODE],[r.ITF,E.BarcodeFormat.ITF],[r.EAN_13,E.BarcodeFormat.EAN_13],[r.EAN_8,E.BarcodeFormat.EAN_8],[r.PDF_417,E.BarcodeFormat.PDF_417],[r.RSS_14,E.BarcodeFormat.RSS_14],[r.RSS_EXPANDED,E.BarcodeFormat.RSS_EXPANDED],[r.UPC_A,E.BarcodeFormat.UPC_A],[r.UPC_E,E.BarcodeFormat.UPC_E],[r.UPC_EAN_EXTENSION,E.BarcodeFormat.UPC_EAN_EXTENSION]]),this.reverseFormatMap=this.createReverseFormatMap(),!E)throw"Use html5qrcode.min.js without edit, ZXing not found.";this.verbose=e,this.logger=n;var i=this.createZXingFormats(t),s=new Map;s.set(E.DecodeHintType.POSSIBLE_FORMATS,i),s.set(E.DecodeHintType.TRY_HARDER,!1),this.hints=s}return t.prototype.decodeAsync=function(t){var e=this;return new Promise((function(n,r){try{n(e.decode(t))}catch(i){r(i)}}))},t.prototype.decode=function(t){var e=new E.MultiFormatReader(this.verbose,this.hints),n=new E.HTMLCanvasElementLuminanceSource(t),r=new E.BinaryBitmap(new E.HybridBinarizer(n)),i=e.decode(r);return{text:i.text,format:u.create(this.toHtml5QrcodeSupportedFormats(i.format)),debugData:this.createDebugData()}},t.prototype.createReverseFormatMap=function(){var t=new Map;return this.formatMap.forEach((function(e,n,r){t.set(e,n)})),t},t.prototype.toHtml5QrcodeSupportedFormats=function(t){if(!this.reverseFormatMap.has(t))throw"reverseFormatMap doesn't have "+t;return this.reverseFormatMap.get(t)},t.prototype.createZXingFormats=function(t){for(var e=[],n=0,r=t;n<r.length;n++){var i=r[n];this.formatMap.has(i)?e.push(this.formatMap.get(i)):this.logger.logError(i+" is not supported byZXingHtml5QrcodeShim")}return e},t.prototype.createDebugData=function(){return{decoderName:"zxing-js"}},t}(),S=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},A=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},C=function(){function t(e,n,i){if(this.formatMap=new Map([[r.QR_CODE,"qr_code"],[r.AZTEC,"aztec"],[r.CODABAR,"codabar"],[r.CODE_39,"code_39"],[r.CODE_93,"code_93"],[r.CODE_128,"code_128"],[r.DATA_MATRIX,"data_matrix"],[r.ITF,"itf"],[r.EAN_13,"ean_13"],[r.EAN_8,"ean_8"],[r.PDF_417,"pdf417"],[r.UPC_A,"upc_a"],[r.UPC_E,"upc_e"]]),this.reverseFormatMap=this.createReverseFormatMap(),!t.isSupported())throw"Use html5qrcode.min.js without edit, Use BarcodeDetectorDelegate only if it isSupported();";this.verbose=n,this.logger=i;var s=this.createBarcodeDetectorFormats(e);if(this.detector=new BarcodeDetector(s),!this.detector)throw"BarcodeDetector detector not supported"}return t.isSupported=function(){if(!("BarcodeDetector"in window))return!1;var t=new BarcodeDetector({formats:["qr_code"]});return"undefined"!==typeof t},t.prototype.decodeAsync=function(t){return S(this,void 0,void 0,(function(){var e,n;return A(this,(function(r){switch(r.label){case 0:return[4,this.detector.detect(t)];case 1:if(e=r.sent(),!e||0===e.length)throw"No barcode or QR code detected.";return n=this.selectLargestBarcode(e),[2,{text:n.rawValue,format:u.create(this.toHtml5QrcodeSupportedFormats(n.format)),debugData:this.createDebugData()}]}}))}))},t.prototype.selectLargestBarcode=function(t){for(var e=null,n=0,r=0,i=t;r<i.length;r++){var s=i[r],o=s.boundingBox.width*s.boundingBox.height;o>n&&(n=o,e=s)}if(!e)throw"No largest barcode found";return e},t.prototype.createBarcodeDetectorFormats=function(t){for(var e=[],n=0,r=t;n<r.length;n++){var i=r[n];this.formatMap.has(i)?e.push(this.formatMap.get(i)):this.logger.warn(i+" is not supported byBarcodeDetectorDelegate")}return{formats:e}},t.prototype.toHtml5QrcodeSupportedFormats=function(t){if(!this.reverseFormatMap.has(t))throw"reverseFormatMap doesn't have "+t;return this.reverseFormatMap.get(t)},t.prototype.createReverseFormatMap=function(){var t=new Map;return this.formatMap.forEach((function(e,n,r){t.set(e,n)})),t},t.prototype.createDebugData=function(){return{decoderName:"BarcodeDetector"}},t}(),I=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},T=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},k=function(){function t(t,e,n,r){this.EXECUTIONS_TO_REPORT_PERFORMANCE=100,this.executions=0,this.executionResults=[],this.wasPrimaryDecoderUsedInLastDecode=!1,this.verbose=n,e&&C.isSupported()?(this.primaryDecoder=new C(t,n,r),this.secondaryDecoder=new _(t,n,r)):this.primaryDecoder=new _(t,n,r)}return t.prototype.decodeAsync=function(t){return I(this,void 0,void 0,(function(){var e;return T(this,(function(n){switch(n.label){case 0:e=performance.now(),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,this.getDecoder().decodeAsync(t)];case 2:return[2,n.sent()];case 3:return this.possiblyLogPerformance(e),[7];case 4:return[2]}}))}))},t.prototype.decodeRobustlyAsync=function(t){return I(this,void 0,void 0,(function(){var e,n;return T(this,(function(r){switch(r.label){case 0:e=performance.now(),r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,this.primaryDecoder.decodeAsync(t)];case 2:return[2,r.sent()];case 3:if(n=r.sent(),this.secondaryDecoder)return[2,this.secondaryDecoder.decodeAsync(t)];throw n;case 4:return this.possiblyLogPerformance(e),[7];case 5:return[2]}}))}))},t.prototype.getDecoder=function(){return this.secondaryDecoder?!1===this.wasPrimaryDecoderUsedInLastDecode?(this.wasPrimaryDecoderUsedInLastDecode=!0,this.primaryDecoder):(this.wasPrimaryDecoderUsedInLastDecode=!1,this.secondaryDecoder):this.primaryDecoder},t.prototype.possiblyLogPerformance=function(t){if(this.verbose){var e=performance.now()-t;this.executionResults.push(e),this.executions++,this.possiblyFlushPerformanceReport()}},t.prototype.possiblyFlushPerformanceReport=function(){if(!(this.executions<this.EXECUTIONS_TO_REPORT_PERFORMANCE)){for(var t=0,e=0,n=this.executionResults;e<n.length;e++){var r=n[e];t+=r}var i=t/this.executionResults.length;console.log(i+" ms for "+this.executionResults.length+" last runs."),this.executions=0,this.executionResults=[]}},t}(),R=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),N=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},D=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},O=function(){function t(t,e){this.name=t,this.track=e}return t.prototype.isSupported=function(){return!!this.track.getCapabilities&&this.name in this.track.getCapabilities()},t.prototype.apply=function(t){var e={};e[this.name]=t;var n={advanced:[e]};return this.track.applyConstraints(n)},t.prototype.value=function(){var t=this.track.getSettings();if(this.name in t){var e=t[this.name];return e}return null},t}(),P=function(t){function e(e,n){return t.call(this,e,n)||this}return R(e,t),e.prototype.min=function(){return this.getCapabilities().min},e.prototype.max=function(){return this.getCapabilities().max},e.prototype.step=function(){return this.getCapabilities().step},e.prototype.apply=function(t){var e={};e[this.name]=t;var n={advanced:[e]};return this.track.applyConstraints(n)},e.prototype.getCapabilities=function(){this.failIfNotSupported();var t=this.track.getCapabilities(),e=t[this.name];return{min:e.min,max:e.max,step:e.step}},e.prototype.failIfNotSupported=function(){if(!this.isSupported())throw new Error(this.name+" capability not supported")},e}(O),x=function(t){function e(e){return t.call(this,"zoom",e)||this}return R(e,t),e}(P),M=function(t){function e(e){return t.call(this,"torch",e)||this}return R(e,t),e}(O),L=function(){function t(t){this.track=t}return t.prototype.zoomFeature=function(){return new x(this.track)},t.prototype.torchFeature=function(){return new M(this.track)},t}(),B=function(){function t(t,e,n){this.isClosed=!1,this.parentElement=t,this.mediaStream=e,this.callbacks=n,this.surface=this.createVideoElement(this.parentElement.clientWidth),t.append(this.surface)}return t.prototype.createVideoElement=function(t){var e=document.createElement("video");return e.style.width=t+"px",e.style.display="block",e.muted=!0,e.setAttribute("muted","true"),e.playsInline=!0,e},t.prototype.setupSurface=function(){var t=this;this.surface.onabort=function(){throw"RenderedCameraImpl video surface onabort() called"},this.surface.onerror=function(){throw"RenderedCameraImpl video surface onerror() called"};var e=function(){var n=t.surface.clientWidth,r=t.surface.clientHeight;t.callbacks.onRenderSurfaceReady(n,r),t.surface.removeEventListener("playing",e)};this.surface.addEventListener("playing",e),this.surface.srcObject=this.mediaStream,this.surface.play()},t.create=function(e,n,r,i){return N(this,void 0,void 0,(function(){var s,o;return D(this,(function(a){switch(a.label){case 0:return s=new t(e,n,i),r.aspectRatio?(o={aspectRatio:r.aspectRatio},[4,s.getFirstTrackOrFail().applyConstraints(o)]):[3,2];case 1:a.sent(),a.label=2;case 2:return s.setupSurface(),[2,s]}}))}))},t.prototype.failIfClosed=function(){if(this.isClosed)throw"The RenderedCamera has already been closed."},t.prototype.getFirstTrackOrFail=function(){if(this.failIfClosed(),0===this.mediaStream.getVideoTracks().length)throw"No video tracks found";return this.mediaStream.getVideoTracks()[0]},t.prototype.pause=function(){this.failIfClosed(),this.surface.pause()},t.prototype.resume=function(t){this.failIfClosed();var e=this,n=function(){setTimeout(t,200),e.surface.removeEventListener("playing",n)};this.surface.addEventListener("playing",n),this.surface.play()},t.prototype.isPaused=function(){return this.failIfClosed(),this.surface.paused},t.prototype.getSurface=function(){return this.failIfClosed(),this.surface},t.prototype.getRunningTrackCapabilities=function(){return this.getFirstTrackOrFail().getCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getFirstTrackOrFail().getSettings()},t.prototype.applyVideoConstraints=function(t){return N(this,void 0,void 0,(function(){return D(this,(function(e){if("aspectRatio"in t)throw"Changing 'aspectRatio' in run-time is not yet supported.";return[2,this.getFirstTrackOrFail().applyConstraints(t)]}))}))},t.prototype.close=function(){if(this.isClosed)return Promise.resolve();var t=this;return new Promise((function(e,n){var r=t.mediaStream.getVideoTracks(),i=r.length,s=0;t.mediaStream.getVideoTracks().forEach((function(n){t.mediaStream.removeTrack(n),n.stop(),++s,s>=i&&(t.isClosed=!0,t.parentElement.removeChild(t.surface),e())}))}))},t.prototype.getCapabilities=function(){return new L(this.getFirstTrackOrFail())},t}(),U=function(){function t(t){this.mediaStream=t}return t.prototype.render=function(t,e,n){return N(this,void 0,void 0,(function(){return D(this,(function(r){return[2,B.create(t,this.mediaStream,e,n)]}))}))},t.create=function(e){return N(this,void 0,void 0,(function(){var n,r;return D(this,(function(i){switch(i.label){case 0:if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return n={audio:!1,video:e},[4,navigator.mediaDevices.getUserMedia(n)];case 1:return r=i.sent(),[2,new t(r)]}}))}))},t}(),F=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},z=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},V=function(){function t(){}return t.failIfNotSupported=function(){return F(this,void 0,void 0,(function(){return z(this,(function(e){if(!navigator.mediaDevices)throw"navigator.mediaDevices not supported";return[2,new t]}))}))},t.prototype.create=function(t){return F(this,void 0,void 0,(function(){return z(this,(function(e){return[2,U.create(t)]}))}))},t}(),j=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},H=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},$=function(){function t(){}return t.retrieve=function(){if(navigator.mediaDevices)return t.getCamerasFromMediaDevices();var e=MediaStreamTrack;return MediaStreamTrack&&e.getSources?t.getCamerasFromMediaStreamTrack():t.rejectWithError()},t.rejectWithError=function(){var e=y.unableToQuerySupportedDevices();return t.isHttpsOrLocalhost()||(e=y.insecureContextCameraQueryError()),Promise.reject(e)},t.isHttpsOrLocalhost=function(){if("https:"===location.protocol)return!0;var t=location.host.split(":")[0];return"127.0.0.1"===t||"localhost"===t},t.getCamerasFromMediaDevices=function(){return j(this,void 0,void 0,(function(){var t,e,n,r,i,s,o;return H(this,(function(a){switch(a.label){case 0:return t=function(t){for(var e=t.getVideoTracks(),n=0,r=e;n<r.length;n++){var i=r[n];i.enabled=!1,i.stop(),t.removeTrack(i)}},[4,navigator.mediaDevices.getUserMedia({audio:!1,video:!0})];case 1:return e=a.sent(),[4,navigator.mediaDevices.enumerateDevices()];case 2:for(n=a.sent(),r=[],i=0,s=n;i<s.length;i++)o=s[i],"videoinput"===o.kind&&r.push({id:o.deviceId,label:o.label});return t(e),[2,r]}}))}))},t.getCamerasFromMediaStreamTrack=function(){return new Promise((function(t,e){var n=function(e){for(var n=[],r=0,i=e;r<i.length;r++){var s=i[r];"video"===s.kind&&n.push({id:s.id,label:s.label})}t(n)},r=MediaStreamTrack;r.getSources(n)}))},t}();(function(t){t[t["UNKNOWN"]=0]="UNKNOWN",t[t["NOT_STARTED"]=1]="NOT_STARTED",t[t["SCANNING"]=2]="SCANNING",t[t["PAUSED"]=3]="PAUSED"})(m||(m={}));var K,G=function(){function t(){this.state=m.NOT_STARTED,this.onGoingTransactionNewState=m.UNKNOWN}return t.prototype.directTransition=function(t){this.failIfTransitionOngoing(),this.validateTransition(t),this.state=t},t.prototype.startTransition=function(t){return this.failIfTransitionOngoing(),this.validateTransition(t),this.onGoingTransactionNewState=t,this},t.prototype.execute=function(){if(this.onGoingTransactionNewState===m.UNKNOWN)throw"Transaction is already cancelled, cannot execute().";var t=this.onGoingTransactionNewState;this.onGoingTransactionNewState=m.UNKNOWN,this.directTransition(t)},t.prototype.cancel=function(){if(this.onGoingTransactionNewState===m.UNKNOWN)throw"Transaction is already cancelled, cannot cancel().";this.onGoingTransactionNewState=m.UNKNOWN},t.prototype.getState=function(){return this.state},t.prototype.failIfTransitionOngoing=function(){if(this.onGoingTransactionNewState!==m.UNKNOWN)throw"Cannot transition to a new state, already under transition"},t.prototype.validateTransition=function(t){switch(this.state){case m.UNKNOWN:throw"Transition from unknown is not allowed";case m.NOT_STARTED:this.failIfNewStateIs(t,[m.PAUSED]);break;case m.SCANNING:break;case m.PAUSED:break}},t.prototype.failIfNewStateIs=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(t===i)throw"Cannot transition from "+this.state+" to "+t}},t}(),q=function(){function t(t){this.stateManager=t}return t.prototype.startTransition=function(t){return this.stateManager.startTransition(t)},t.prototype.directTransition=function(t){this.stateManager.directTransition(t)},t.prototype.getState=function(){return this.stateManager.getState()},t.prototype.canScanFile=function(){return this.stateManager.getState()===m.NOT_STARTED},t.prototype.isScanning=function(){return this.stateManager.getState()!==m.NOT_STARTED},t.prototype.isStrictlyScanning=function(){return this.stateManager.getState()===m.SCANNING},t.prototype.isPaused=function(){return this.stateManager.getState()===m.PAUSED},t}(),W=function(){function t(){}return t.create=function(){return new q(new G)},t}(),Y=function(){var t=function(e,n){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])},t(e,n)};return function(e,n){if("function"!==typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Y(e,t),e.DEFAULT_WIDTH=300,e.DEFAULT_WIDTH_OFFSET=2,e.FILE_SCAN_MIN_HEIGHT=300,e.FILE_SCAN_HIDDEN_CANVAS_PADDING=100,e.MIN_QR_BOX_SIZE=50,e.SHADED_LEFT=1,e.SHADED_RIGHT=2,e.SHADED_TOP=3,e.SHADED_BOTTOM=4,e.SHADED_REGION_ELEMENT_ID="qr-shaded-region",e.VERBOSE=!1,e.BORDER_SHADER_DEFAULT_COLOR="#ffffff",e.BORDER_SHADER_MATCH_COLOR="rgb(90, 193, 56)",e}(l),Q=function(){function t(t,e){this.logger=e,this.fps=X.SCAN_DEFAULT_FPS,t?(t.fps&&(this.fps=t.fps),this.disableFlip=!0===t.disableFlip,this.qrbox=t.qrbox,this.aspectRatio=t.aspectRatio,this.videoConstraints=t.videoConstraints):this.disableFlip=X.DEFAULT_DISABLE_FLIP}return t.prototype.isMediaStreamConstraintsValid=function(){return this.videoConstraints?v.isMediaStreamConstraintsValid(this.videoConstraints,this.logger):(this.logger.logError("Empty videoConstraints",!0),!1)},t.prototype.isShadedBoxEnabled=function(){return!p(this.qrbox)},t.create=function(e,n){return new t(e,n)},t}(),J=function(){function t(t,e){if(this.element=null,this.canvasElement=null,this.scannerPausedUiElement=null,this.hasBorderShaders=null,this.borderShaders=null,this.qrMatch=null,this.renderedCamera=null,this.qrRegion=null,this.context=null,this.lastScanImageFile=null,this.isScanning=!1,!document.getElementById(t))throw"HTML Element with id="+t+" not found";var n;this.elementId=t,this.verbose=!1,"boolean"==typeof e?this.verbose=!0===e:e&&(n=e,this.verbose=!0===n.verbose,n.experimentalFeatures),this.logger=new f(this.verbose),this.qrcode=new k(this.getSupportedFormats(e),this.getUseBarCodeDetectorIfSupported(n),this.verbose,this.logger),this.foreverScanTimeout,this.shouldScan=!0,this.stateManagerProxy=W.create()}return t.prototype.start=function(t,e,n,r){var i,s=this;if(!t)throw"cameraIdOrConfig is required";if(!n||"function"!=typeof n)throw"qrCodeSuccessCallback is required and should be a function.";i=r||(this.verbose?this.logger.log:function(){});var o=Q.create(e,this.logger);this.clearElement();var a=!1;o.videoConstraints&&(o.isMediaStreamConstraintsValid()?a=!0:this.logger.logError("'videoConstraints' is not valid 'MediaStreamConstraints, it will be ignored.'",!0));var c=a,l=document.getElementById(this.elementId);l.clientWidth?l.clientWidth:X.DEFAULT_WIDTH;l.style.position="relative",this.shouldScan=!0,this.element=l;var u=this,h=this.stateManagerProxy.startTransition(m.SCANNING);return new Promise((function(e,r){var a=c?o.videoConstraints:u.createVideoConstraints(t);if(!a)return h.cancel(),void r("videoConstraints should be defined");var l={};c&&!o.aspectRatio||(l.aspectRatio=o.aspectRatio);var d={onRenderSurfaceReady:function(t,e){u.setupUi(t,e,o),u.isScanning=!0,u.foreverScan(o,n,i)}};V.failIfNotSupported().then((function(t){t.create(a).then((function(t){return t.render(s.element,l,d).then((function(t){u.renderedCamera=t,h.execute(),e(null)})).catch((function(t){h.cancel(),r(t)}))})).catch((function(t){h.cancel(),r(y.errorGettingUserMedia(t))}))})).catch((function(t){h.cancel(),r(y.cameraStreamingNotSupported())}))}))},t.prototype.pause=function(t){if(!this.stateManagerProxy.isStrictlyScanning())throw"Cannot pause, scanner is not scanning.";this.stateManagerProxy.directTransition(m.PAUSED),this.showPausedState(),(p(t)||!0!==t)&&(t=!1),t&&this.renderedCamera&&this.renderedCamera.pause()},t.prototype.resume=function(){if(!this.stateManagerProxy.isPaused())throw"Cannot result, scanner is not paused.";if(!this.renderedCamera)throw"renderedCamera doesn't exist while trying resume()";var t=this,e=function(){t.stateManagerProxy.directTransition(m.SCANNING),t.hidePausedState()};this.renderedCamera.isPaused()?this.renderedCamera.resume((function(){e()})):e()},t.prototype.getState=function(){return this.stateManagerProxy.getState()},t.prototype.stop=function(){var t=this;if(!this.stateManagerProxy.isScanning())throw"Cannot stop, scanner is not running or paused.";var e=this.stateManagerProxy.startTransition(m.NOT_STARTED);this.shouldScan=!1,this.foreverScanTimeout&&clearTimeout(this.foreverScanTimeout);var n=function(){if(t.element){var e=document.getElementById(X.SHADED_REGION_ELEMENT_ID);e&&t.element.removeChild(e)}},r=this;return this.renderedCamera.close().then((function(){return r.renderedCamera=null,r.element&&(r.element.removeChild(r.canvasElement),r.canvasElement=null),n(),r.qrRegion&&(r.qrRegion=null),r.context&&(r.context=null),e.execute(),r.hidePausedState(),r.isScanning=!1,Promise.resolve()}))},t.prototype.scanFile=function(t,e){return this.scanFileV2(t,e).then((function(t){return t.decodedText}))},t.prototype.scanFileV2=function(t,e){var n=this;if(!t||!(t instanceof File))throw"imageFile argument is mandatory and should be instance of File. Use 'event.target.files[0]'.";if(p(e)&&(e=!0),!this.stateManagerProxy.canScanFile())throw"Cannot start file scan - ongoing camera scan";return new Promise((function(r,i){n.possiblyCloseLastScanImageFile(),n.clearElement(),n.lastScanImageFile=URL.createObjectURL(t);var s=new Image;s.onload=function(){var t=s.width,o=s.height,a=document.getElementById(n.elementId),c=a.clientWidth?a.clientWidth:X.DEFAULT_WIDTH,l=Math.max(a.clientHeight?a.clientHeight:o,X.FILE_SCAN_MIN_HEIGHT),u=n.computeCanvasDrawConfig(t,o,c,l);if(e){var d=n.createCanvasElement(c,l,"qr-canvas-visible");d.style.display="inline-block",a.appendChild(d);var f=d.getContext("2d");if(!f)throw"Unable to get 2d context from canvas";f.canvas.width=c,f.canvas.height=l,f.drawImage(s,0,0,t,o,u.x,u.y,u.width,u.height)}var p=X.FILE_SCAN_HIDDEN_CANVAS_PADDING,g=Math.max(s.width,u.width),m=Math.max(s.height,u.height),y=g+2*p,w=m+2*p,b=n.createCanvasElement(y,w);a.appendChild(b);var v=b.getContext("2d");if(!v)throw"Unable to get 2d context from canvas";v.canvas.width=y,v.canvas.height=w,v.drawImage(s,0,0,t,o,p,p,g,m);try{n.qrcode.decodeRobustlyAsync(b).then((function(t){r(h.createFromQrcodeResult(t))})).catch(i)}catch(E){i("QR code parse error, error = "+E)}},s.onerror=i,s.onabort=i,s.onstalled=i,s.onsuspend=i,s.src=URL.createObjectURL(t)}))},t.prototype.clear=function(){this.clearElement()},t.getCameras=function(){return $.retrieve()},t.prototype.getRunningTrackCapabilities=function(){return this.getRenderedCameraOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getRenderedCameraOrFail().getRunningTrackSettings()},t.prototype.getRunningTrackCameraCapabilities=function(){return this.getRenderedCameraOrFail().getCapabilities()},t.prototype.applyVideoConstraints=function(t){if(!t)throw"videoConstaints is required argument.";if(!v.isMediaStreamConstraintsValid(t,this.logger))throw"invalid videoConstaints passed, check logs for more details";return this.getRenderedCameraOrFail().applyVideoConstraints(t)},t.prototype.getRenderedCameraOrFail=function(){if(null==this.renderedCamera)throw"Scanning is not in running state, call this API only when QR code scanning using camera is in running state.";return this.renderedCamera},t.prototype.getSupportedFormats=function(t){var e=[r.QR_CODE,r.AZTEC,r.CODABAR,r.CODE_39,r.CODE_93,r.CODE_128,r.DATA_MATRIX,r.MAXICODE,r.ITF,r.EAN_13,r.EAN_8,r.PDF_417,r.RSS_14,r.RSS_EXPANDED,r.UPC_A,r.UPC_E,r.UPC_EAN_EXTENSION];if(!t||"boolean"==typeof t)return e;if(!t.formatsToSupport)return e;if(!Array.isArray(t.formatsToSupport))throw"configOrVerbosityFlag.formatsToSupport should be undefined or an array.";if(0===t.formatsToSupport.length)throw"Atleast 1 formatsToSupport is needed.";for(var n=[],i=0,s=t.formatsToSupport;i<s.length;i++){var o=s[i];a(o)?n.push(o):this.logger.warn("Invalid format: "+o+" passed in config, ignoring.")}if(0===n.length)throw"None of formatsToSupport match supported values.";return n},t.prototype.getUseBarCodeDetectorIfSupported=function(t){if(p(t))return!0;if(!p(t.useBarCodeDetectorIfSupported))return!1!==t.useBarCodeDetectorIfSupported;if(p(t.experimentalFeatures))return!0;var e=t.experimentalFeatures;return!!p(e.useBarCodeDetectorIfSupported)||!1!==e.useBarCodeDetectorIfSupported},t.prototype.validateQrboxSize=function(t,e,n){var r=this,i=n.qrbox;this.validateQrboxConfig(i);var s=this.toQrdimensions(t,e,i),o=function(t){if(t<X.MIN_QR_BOX_SIZE)throw"minimum size of 'config.qrbox' dimension value is "+X.MIN_QR_BOX_SIZE+"px."},a=function(e){return e>t&&(r.logger.warn("`qrbox.width` or `qrbox` is larger than the width of the root element. The width will be truncated to the width of root element."),e=t),e};o(s.width),o(s.height),s.width=a(s.width)},t.prototype.validateQrboxConfig=function(t){if("number"!==typeof t&&"function"!==typeof t&&(void 0===t.width||void 0===t.height))throw"Invalid instance of QrDimensions passed for 'config.qrbox'. Both 'width' and 'height' should be set."},t.prototype.toQrdimensions=function(t,e,n){if("number"===typeof n)return{width:n,height:n};if("function"===typeof n)try{return n(t,e)}catch(r){throw new Error("qrbox config was passed as a function but it failed with unknown error"+r)}return n},t.prototype.setupUi=function(t,e,n){n.isShadedBoxEnabled()&&this.validateQrboxSize(t,e,n);var r=p(n.qrbox)?{width:t,height:e}:n.qrbox;this.validateQrboxConfig(r);var i=this.toQrdimensions(t,e,r);i.height>e&&this.logger.warn("[Html5Qrcode] config.qrbox has height that isgreater than the height of the video stream. Shading will be ignored");var s=n.isShadedBoxEnabled()&&i.height<=e,o={x:0,y:0,width:t,height:e},a=s?this.getShadedRegionBounds(t,e,i):o,c=this.createCanvasElement(a.width,a.height),l={willReadFrequently:!0},u=c.getContext("2d",l);u.canvas.width=a.width,u.canvas.height=a.height,this.element.append(c),s&&this.possiblyInsertShadingElement(this.element,t,e,i),this.createScannerPausedUiElement(this.element),this.qrRegion=a,this.context=u,this.canvasElement=c},t.prototype.createScannerPausedUiElement=function(t){var e=document.createElement("div");e.innerText="Scanner paused",e.style.display="none",e.style.position="absolute",e.style.top="0px",e.style.zIndex="1",e.style.background="yellow",e.style.textAlign="center",e.style.width="100%",t.appendChild(e),this.scannerPausedUiElement=e},t.prototype.scanContext=function(t,e){var n=this;return this.stateManagerProxy.isPaused()?Promise.resolve(!1):this.qrcode.decodeAsync(this.canvasElement).then((function(e){return t(e.text,h.createFromQrcodeResult(e)),n.possiblyUpdateShaders(!0),!0})).catch((function(t){n.possiblyUpdateShaders(!1);var r=y.codeParseError(t);return e(r,d.createFrom(r)),!1}))},t.prototype.foreverScan=function(t,e,n){var r=this;if(this.shouldScan&&this.renderedCamera){var i=this.renderedCamera.getSurface(),s=i.videoWidth/i.clientWidth,o=i.videoHeight/i.clientHeight;if(!this.qrRegion)throw"qrRegion undefined when localMediaStream is ready.";var a=this.qrRegion.width*s,c=this.qrRegion.height*o,l=this.qrRegion.x*s,u=this.qrRegion.y*o;this.context.drawImage(i,l,u,a,c,0,0,this.qrRegion.width,this.qrRegion.height);var h=function(){r.foreverScanTimeout=setTimeout((function(){r.foreverScan(t,e,n)}),r.getTimeoutFps(t.fps))};this.scanContext(e,n).then((function(i){i||!0===t.disableFlip?h():(r.context.translate(r.context.canvas.width,0),r.context.scale(-1,1),r.scanContext(e,n).finally((function(){h()})))})).catch((function(t){r.logger.logError("Error happend while scanning context",t),h()}))}},t.prototype.createVideoConstraints=function(t){if("string"==typeof t)return{deviceId:{exact:t}};if("object"==typeof t){var e="facingMode",n="deviceId",r={user:!0,environment:!0},i="exact",s=function(t){if(t in r)return!0;throw"config has invalid 'facingMode' value = '"+t+"'"},o=Object.keys(t);if(1!==o.length)throw"'cameraIdOrConfig' object should have exactly 1 key, if passed as an object, found "+o.length+" keys";var a=Object.keys(t)[0];if(a!==e&&a!==n)throw"Only '"+e+"' and '"+n+"'  are supported for 'cameraIdOrConfig'";if(a!==e){var c=t.deviceId;if("string"==typeof c)return{deviceId:c};if("object"==typeof c){if(i in c)return{deviceId:{exact:c[""+i]}};throw"'deviceId' should be string or object with "+i+" as key."}var l=typeof c;throw"Invalid type of 'deviceId' = "+l}var u=t.facingMode;if("string"==typeof u){if(s(u))return{facingMode:u}}else{if("object"!=typeof u){var h=typeof u;throw"Invalid type of 'facingMode' = "+h}if(!(i in u))throw"'facingMode' should be string or object with "+i+" as key.";if(s(u[""+i]))return{facingMode:{exact:u[""+i]}}}}var d=typeof t;throw"Invalid type of 'cameraIdOrConfig' = "+d},t.prototype.computeCanvasDrawConfig=function(t,e,n,r){if(t<=n&&e<=r){var i=(n-t)/2,s=(r-e)/2;return{x:i,y:s,width:t,height:e}}var o=t,a=e;return t>n&&(e*=n/t,t=n),e>r&&(t*=r/e,e=r),this.logger.log("Image downsampled from "+o+"X"+a+" to "+t+"X"+e+"."),this.computeCanvasDrawConfig(t,e,n,r)},t.prototype.clearElement=function(){if(this.stateManagerProxy.isScanning())throw"Cannot clear while scan is ongoing, close it first.";var t=document.getElementById(this.elementId);t&&(t.innerHTML="")},t.prototype.possiblyUpdateShaders=function(t){this.qrMatch!==t&&(this.hasBorderShaders&&this.borderShaders&&this.borderShaders.length&&this.borderShaders.forEach((function(e){e.style.backgroundColor=t?X.BORDER_SHADER_MATCH_COLOR:X.BORDER_SHADER_DEFAULT_COLOR})),this.qrMatch=t)},t.prototype.possiblyCloseLastScanImageFile=function(){this.lastScanImageFile&&(URL.revokeObjectURL(this.lastScanImageFile),this.lastScanImageFile=null)},t.prototype.createCanvasElement=function(t,e,n){var r=t,i=e,s=document.createElement("canvas");return s.style.width=r+"px",s.style.height=i+"px",s.style.display="none",s.id=p(n)?"qr-canvas":n,s},t.prototype.getShadedRegionBounds=function(t,e,n){if(n.width>t||n.height>e)throw"'config.qrbox' dimensions should not be greater than the dimensions of the root HTML element.";return{x:(t-n.width)/2,y:(e-n.height)/2,width:n.width,height:n.height}},t.prototype.possiblyInsertShadingElement=function(t,e,n,r){if(!(e-r.width<1||n-r.height<1)){var i=document.createElement("div");i.style.position="absolute";var s=(e-r.width)/2,o=(n-r.height)/2;if(i.style.borderLeft=s+"px solid rgba(0, 0, 0, 0.48)",i.style.borderRight=s+"px solid rgba(0, 0, 0, 0.48)",i.style.borderTop=o+"px solid rgba(0, 0, 0, 0.48)",i.style.borderBottom=o+"px solid rgba(0, 0, 0, 0.48)",i.style.boxSizing="border-box",i.style.top="0px",i.style.bottom="0px",i.style.left="0px",i.style.right="0px",i.id=""+X.SHADED_REGION_ELEMENT_ID,e-r.width<11||n-r.height<11)this.hasBorderShaders=!1;else{var a=5,c=40;this.insertShaderBorders(i,c,a,-a,null,0,!0),this.insertShaderBorders(i,c,a,-a,null,0,!1),this.insertShaderBorders(i,c,a,null,-a,0,!0),this.insertShaderBorders(i,c,a,null,-a,0,!1),this.insertShaderBorders(i,a,c+a,-a,null,-a,!0),this.insertShaderBorders(i,a,c+a,null,-a,-a,!0),this.insertShaderBorders(i,a,c+a,-a,null,-a,!1),this.insertShaderBorders(i,a,c+a,null,-a,-a,!1),this.hasBorderShaders=!0}t.append(i)}},t.prototype.insertShaderBorders=function(t,e,n,r,i,s,o){var a=document.createElement("div");a.style.position="absolute",a.style.backgroundColor=X.BORDER_SHADER_DEFAULT_COLOR,a.style.width=e+"px",a.style.height=n+"px",null!==r&&(a.style.top=r+"px"),null!==i&&(a.style.bottom=i+"px"),o?a.style.left=s+"px":a.style.right=s+"px",this.borderShaders||(this.borderShaders=[]),this.borderShaders.push(a),t.appendChild(a)},t.prototype.showPausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="block"},t.prototype.hidePausedState=function(){if(!this.scannerPausedUiElement)throw"[internal error] scanner paused UI element not found";this.scannerPausedUiElement.style.display="none"},t.prototype.getTimeoutFps=function(t){return 1e3/t},t}(),Z="data:image/svg+xml;base64,",tt=Z+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAzNzEuNjQzIDM3MS42NDMiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDM3MS42NDMgMzcxLjY0MyIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSI+PHBhdGggZD0iTTEwNS4wODQgMzguMjcxaDE2My43Njh2MjBIMTA1LjA4NHoiLz48cGF0aCBkPSJNMzExLjU5NiAxOTAuMTg5Yy03LjQ0MS05LjM0Ny0xOC40MDMtMTYuMjA2LTMyLjc0My0yMC41MjJWMzBjMC0xNi41NDItMTMuNDU4LTMwLTMwLTMwSDEyNS4wODRjLTE2LjU0MiAwLTMwIDEzLjQ1OC0zMCAzMHYxMjAuMTQzaC04LjI5NmMtMTYuNTQyIDAtMzAgMTMuNDU4LTMwIDMwdjEuMzMzYTI5LjgwNCAyOS44MDQgMCAwIDAgNC42MDMgMTUuOTM5Yy03LjM0IDUuNDc0LTEyLjEwMyAxNC4yMjEtMTIuMTAzIDI0LjA2MXYxLjMzM2MwIDkuODQgNC43NjMgMTguNTg3IDEyLjEwMyAyNC4wNjJhMjkuODEgMjkuODEgMCAwIDAtNC42MDMgMTUuOTM4djEuMzMzYzAgMTYuNTQyIDEzLjQ1OCAzMCAzMCAzMGg4LjMyNGMuNDI3IDExLjYzMSA3LjUwMyAyMS41ODcgMTcuNTM0IDI2LjE3Ny45MzEgMTAuNTAzIDQuMDg0IDMwLjE4NyAxNC43NjggNDUuNTM3YTkuOTg4IDkuOTg4IDAgMCAwIDguMjE2IDQuMjg4IDkuOTU4IDkuOTU4IDAgMCAwIDUuNzA0LTEuNzkzYzQuNTMzLTMuMTU1IDUuNjUtOS4zODggMi40OTUtMTMuOTIxLTYuNzk4LTkuNzY3LTkuNjAyLTIyLjYwOC0xMC43Ni0zMS40aDgyLjY4NWMuMjcyLjQxNC41NDUuODE4LjgxNSAxLjIxIDMuMTQyIDQuNTQxIDkuMzcyIDUuNjc5IDEzLjkxMyAyLjUzNCA0LjU0Mi0zLjE0MiA1LjY3Ny05LjM3MSAyLjUzNS0xMy45MTMtMTEuOTE5LTE3LjIyOS04Ljc4Ny0zNS44ODQgOS41ODEtNTcuMDEyIDMuMDY3LTIuNjUyIDEyLjMwNy0xMS43MzIgMTEuMjE3LTI0LjAzMy0uODI4LTkuMzQzLTcuMTA5LTE3LjE5NC0xOC42NjktMjMuMzM3YTkuODU3IDkuODU3IDAgMCAwLTEuMDYxLS40ODZjLS40NjYtLjE4Mi0xMS40MDMtNC41NzktOS43NDEtMTUuNzA2IDEuMDA3LTYuNzM3IDE0Ljc2OC04LjI3MyAyMy43NjYtNy42NjYgMjMuMTU2IDEuNTY5IDM5LjY5OCA3LjgwMyA0Ny44MzYgMTguMDI2IDUuNzUyIDcuMjI1IDcuNjA3IDE2LjYyMyA1LjY3MyAyOC43MzMtLjQxMyAyLjU4NS0uODI0IDUuMjQxLTEuMjQ1IDcuOTU5LTUuNzU2IDM3LjE5NC0xMi45MTkgODMuNDgzLTQ5Ljg3IDExNC42NjEtNC4yMjEgMy41NjEtNC43NTYgOS44Ny0xLjE5NCAxNC4wOTJhOS45OCA5Ljk4IDAgMCAwIDcuNjQ4IDMuNTUxIDkuOTU1IDkuOTU1IDAgMCAwIDYuNDQ0LTIuMzU4YzQyLjY3Mi0zNi4wMDUgNTAuODAyLTg4LjUzMyA1Ni43MzctMTI2Ljg4OC40MTUtMi42ODQuODIxLTUuMzA5IDEuMjI5LTcuODYzIDIuODM0LTE3LjcyMS0uNDU1LTMyLjY0MS05Ljc3Mi00NC4zNDV6bS0yMzIuMzA4IDQyLjYyYy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM2MwLTUuNTE0IDQuNDg2LTEwIDEwLTEwaDE1djIxLjMzM2gtMTV6bS0yLjUtNTIuNjY2YzAtNS41MTQgNC40ODYtMTAgMTAtMTBoNy41djIxLjMzM2gtNy41Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi0xLjMzM3ptMTcuNSA5My45OTloLTcuNWMtNS41MTQgMC0xMC00LjQ4Ni0xMC0xMHYtMS4zMzNjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGg3LjV2MjEuMzMzem0zMC43OTYgMjguODg3Yy01LjUxNCAwLTEwLTQuNDg2LTEwLTEwdi04LjI3MWg5MS40NTdjLS44NTEgNi42NjgtLjQzNyAxMi43ODcuNzMxIDE4LjI3MWgtODIuMTg4em03OS40ODItMTEzLjY5OGMtMy4xMjQgMjAuOTA2IDEyLjQyNyAzMy4xODQgMjEuNjI1IDM3LjA0IDUuNDQxIDIuOTY4IDcuNTUxIDUuNjQ3IDcuNzAxIDcuMTg4LjIxIDIuMTUtMi41NTMgNS42ODQtNC40NzcgNy4yNTEtLjQ4Mi4zNzgtLjkyOS44LTEuMzM1IDEuMjYxLTYuOTg3IDcuOTM2LTExLjk4MiAxNS41Mi0xNS40MzIgMjIuNjg4aC05Ny41NjRWMzBjMC01LjUxNCA0LjQ4Ni0xMCAxMC0xMGgxMjMuNzY5YzUuNTE0IDAgMTAgNC40ODYgMTAgMTB2MTM1LjU3OWMtMy4wMzItLjM4MS02LjE1LS42OTQtOS4zODktLjkxNC0yNS4xNTktMS42OTQtNDIuMzcgNy43NDgtNDQuODk4IDI0LjY2NnoiLz48cGF0aCBkPSJNMTc5LjEyOSA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXpNMTcyLjYyOSAxNDIuODZoLTEyLjU2VjEzMC44YTUgNSAwIDEgMC0xMCAwdjE3LjA2MWE1IDUgMCAwIDAgNSA1aDE3LjU2YTUgNSAwIDEgMCAwLTEwLjAwMXpNMjE2LjU2OCA4My4xNjdoLTI0LjA2YTUgNSAwIDAgMC01IDV2MjQuMDYxYTUgNSAwIDAgMCA1IDVoMjQuMDZhNSA1IDAgMCAwIDUtNVY4OC4xNjdhNSA1IDAgMCAwLTUtNXptLTUgMjQuMDYxaC0xNC4wNlY5My4xNjdoMTQuMDZ2MTQuMDYxek0yMTEuNjY5IDEyNS45MzZIMTk3LjQxYTUgNSAwIDAgMC01IDV2MTQuMjU3YTUgNSAwIDAgMCA1IDVoMTQuMjU5YTUgNSAwIDAgMCA1LTV2LTE0LjI1N2E1IDUgMCAwIDAtNS01eiIvPjwvc3ZnPg==",et=Z+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA1OS4wMTggNTkuMDE4IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA1OS4wMTggNTkuMDE4IiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJtNTguNzQxIDU0LjgwOS01Ljk2OS02LjI0NGExMC43NCAxMC43NCAwIDAgMCAyLjgyLTcuMjVjMC01Ljk1My00Ljg0My0xMC43OTYtMTAuNzk2LTEwLjc5NlMzNCAzNS4zNjEgMzQgNDEuMzE0IDM4Ljg0MyA1Mi4xMSA0NC43OTYgNTIuMTFjMi40NDEgMCA0LjY4OC0uODI0IDYuNDk5LTIuMTk2bDYuMDAxIDYuMjc3YS45OTguOTk4IDAgMCAwIDEuNDE0LjAzMiAxIDEgMCAwIDAgLjAzMS0xLjQxNHpNMzYgNDEuMzE0YzAtNC44NSAzLjk0Ni04Ljc5NiA4Ljc5Ni04Ljc5NnM4Ljc5NiAzLjk0NiA4Ljc5NiA4Ljc5Ni0zLjk0NiA4Ljc5Ni04Ljc5NiA4Ljc5NlMzNiA0Ni4xNjQgMzYgNDEuMzE0ek0xMC40MzEgMTYuMDg4YzAgMy4wNyAyLjQ5OCA1LjU2OCA1LjU2OSA1LjU2OHM1LjU2OS0yLjQ5OCA1LjU2OS01LjU2OGMwLTMuMDcxLTIuNDk4LTUuNTY5LTUuNTY5LTUuNTY5cy01LjU2OSAyLjQ5OC01LjU2OSA1LjU2OXptOS4xMzggMGMwIDEuOTY4LTEuNjAyIDMuNTY4LTMuNTY5IDMuNTY4cy0zLjU2OS0xLjYwMS0zLjU2OS0zLjU2OCAxLjYwMi0zLjU2OSAzLjU2OS0zLjU2OSAzLjU2OSAxLjYwMSAzLjU2OSAzLjU2OXoiLz48cGF0aCBkPSJtMzAuODgyIDI4Ljk4NyA5LjE4LTEwLjA1NCAxMS4yNjIgMTAuMzIzYTEgMSAwIDAgMCAxLjM1MS0xLjQ3NWwtMTItMTFhMSAxIDAgMCAwLTEuNDE0LjA2M2wtOS43OTQgMTAuNzI3LTQuNzQzLTQuNzQzYTEuMDAzIDEuMDAzIDAgMCAwLTEuMzY4LS4wNDRMNi4zMzkgMzcuNzY4YTEgMSAwIDEgMCAxLjMyMiAxLjUwMWwxNi4zMTMtMTQuMzYyIDcuMzE5IDcuMzE4YS45OTkuOTk5IDAgMSAwIDEuNDE0LTEuNDE0bC0xLjgyNS0xLjgyNHoiLz48cGF0aCBkPSJNMzAgNDYuNTE4SDJ2LTQyaDU0djI4YTEgMSAwIDEgMCAyIDB2LTI5YTEgMSAwIDAgMC0xLTFIMWExIDEgMCAwIDAtMSAxdjQ0YTEgMSAwIDAgMCAxIDFoMjlhMSAxIDAgMSAwIDAtMnoiLz48L3N2Zz4=",nt=Z+"PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA0NjAgNDYwIiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCA0NjAgNDYwIiB4bWw6c3BhY2U9InByZXNlcnZlIj48cGF0aCBkPSJNMjMwIDBDMTAyLjk3NSAwIDAgMTAyLjk3NSAwIDIzMHMxMDIuOTc1IDIzMCAyMzAgMjMwIDIzMC0xMDIuOTc0IDIzMC0yMzBTMzU3LjAyNSAwIDIzMCAwem0zOC4zMzMgMzc3LjM2YzAgOC42NzYtNy4wMzQgMTUuNzEtMTUuNzEgMTUuNzFoLTQzLjEwMWMtOC42NzYgMC0xNS43MS03LjAzNC0xNS43MS0xNS43MVYyMDIuNDc3YzAtOC42NzYgNy4wMzMtMTUuNzEgMTUuNzEtMTUuNzFoNDMuMTAxYzguNjc2IDAgMTUuNzEgNy4wMzMgMTUuNzEgMTUuNzFWMzc3LjM2ek0yMzAgMTU3Yy0yMS41MzkgMC0zOS0xNy40NjEtMzktMzlzMTcuNDYxLTM5IDM5LTM5IDM5IDE3LjQ2MSAzOSAzOS0xNy40NjEgMzktMzkgMzl6Ii8+PC9zdmc+",rt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAAQgAAAEIBarqQRAAAABl0RVh0U29mdHdhcmUAd3d3Lmlua3NjYXBlLm9yZ5vuPBoAAAE1SURBVDiNfdI7S0NBEAXgLya1otFgpbYSbISAgpXYi6CmiH9KCAiChaVga6OiWPgfRDQ+0itaGVNosXtluWwcuMzePfM4M3sq8lbHBubwg1dc4m1E/J/N4ghDPOIsfk/4xiEao5KX0McFljN4C9d4QTPXuY99jP3DsIoDPGM6BY5i5yI5R7O4q+ImFkJY2DCh3cAH2klyB+9J1xUMMAG7eCh1a+Mr+k48b5diXrFVwwLuS+BJ9MfR7+G0FHOHhTHhnXNWS87VDF4pcnfQK4Ep7XScNLmPTZgURNKKYENYWDpzW1BhscS1WHS8CDgURFJQrWcoF3c13KKbgg1BYQfy8xZWEzTTw1QZbAoKu8FqJnktdu5hcVSHmchiILzzuaDQvjBzV2m8yohCE1jHfPx/xhU+y4G/D75ELlRJsSYAAAAASUVORK5CYII=",it=function(){function t(){}return t.createDefault=function(){return{hasPermission:!1,lastUsedCameraId:null}},t}(),st=function(){function t(){this.data=it.createDefault();var e=localStorage.getItem(t.LOCAL_STORAGE_KEY);e?this.data=JSON.parse(e):this.reset()}return t.prototype.hasCameraPermissions=function(){return this.data.hasPermission},t.prototype.getLastUsedCameraId=function(){return this.data.lastUsedCameraId},t.prototype.setHasPermission=function(t){this.data.hasPermission=t,this.flush()},t.prototype.setLastUsedCameraId=function(t){this.data.lastUsedCameraId=t,this.flush()},t.prototype.resetLastUsedCameraId=function(){this.data.lastUsedCameraId=null,this.flush()},t.prototype.reset=function(){this.data=it.createDefault(),this.flush()},t.prototype.flush=function(){localStorage.setItem(t.LOCAL_STORAGE_KEY,JSON.stringify(this.data))},t.LOCAL_STORAGE_KEY="HTML5_QRCODE_DATA",t}(),ot=function(){function t(){this.infoDiv=document.createElement("div")}return t.prototype.renderInto=function(t){this.infoDiv.style.position="absolute",this.infoDiv.style.top="10px",this.infoDiv.style.right="10px",this.infoDiv.style.zIndex="2",this.infoDiv.style.display="none",this.infoDiv.style.padding="5pt",this.infoDiv.style.border="1px solid #171717",this.infoDiv.style.fontSize="10pt",this.infoDiv.style.background="rgb(0 0 0 / 69%)",this.infoDiv.style.borderRadius="5px",this.infoDiv.style.textAlign="center",this.infoDiv.style.fontWeight="400",this.infoDiv.style.color="white",this.infoDiv.innerText=b.poweredBy();var e=document.createElement("a");e.innerText="ScanApp",e.href="https://scanapp.org",e.target="new",e.style.color="white",this.infoDiv.appendChild(e);var n=document.createElement("br"),r=document.createElement("br");this.infoDiv.appendChild(n),this.infoDiv.appendChild(r);var i=document.createElement("a");i.innerText=b.reportIssues(),i.href="https://github.com/mebjas/html5-qrcode/issues",i.target="new",i.style.color="white",this.infoDiv.appendChild(i),t.appendChild(this.infoDiv)},t.prototype.show=function(){this.infoDiv.style.display="block"},t.prototype.hide=function(){this.infoDiv.style.display="none"},t}(),at=function(){function t(t,e){this.isShowingInfoIcon=!0,this.onTapIn=t,this.onTapOut=e,this.infoIcon=document.createElement("img")}return t.prototype.renderInto=function(t){var e=this;this.infoIcon.alt="Info icon",this.infoIcon.src=nt,this.infoIcon.style.position="absolute",this.infoIcon.style.top="4px",this.infoIcon.style.right="4px",this.infoIcon.style.opacity="0.6",this.infoIcon.style.cursor="pointer",this.infoIcon.style.zIndex="2",this.infoIcon.style.width="16px",this.infoIcon.style.height="16px",this.infoIcon.onmouseover=function(t){return e.onHoverIn()},this.infoIcon.onmouseout=function(t){return e.onHoverOut()},this.infoIcon.onclick=function(t){return e.onClick()},t.appendChild(this.infoIcon)},t.prototype.onHoverIn=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="1")},t.prototype.onHoverOut=function(){this.isShowingInfoIcon&&(this.infoIcon.style.opacity="0.6")},t.prototype.onClick=function(){this.isShowingInfoIcon?(this.isShowingInfoIcon=!1,this.onTapIn(),this.infoIcon.src=rt,this.infoIcon.style.opacity="1"):(this.isShowingInfoIcon=!0,this.onTapOut(),this.infoIcon.src=nt,this.infoIcon.style.opacity="0.6")},t}(),ct=function(){function t(){var t=this;this.infoDiv=new ot,this.infoIcon=new at((function(){t.infoDiv.show()}),(function(){t.infoDiv.hide()}))}return t.prototype.renderInto=function(t){this.infoDiv.renderInto(t),this.infoIcon.renderInto(t)},t}(),lt=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},ut=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},ht=function(){function t(){}return t.hasPermissions=function(){return lt(this,void 0,void 0,(function(){var t,e,n,r;return ut(this,(function(i){switch(i.label){case 0:return[4,navigator.mediaDevices.enumerateDevices()];case 1:for(t=i.sent(),e=0,n=t;e<n.length;e++)if(r=n[e],"videoinput"===r.kind&&r.label)return[2,!0];return[2,!1]}}))}))},t}(),dt=function(){function t(t){this.supportedScanTypes=this.validateAndReturnScanTypes(t)}return t.prototype.getDefaultScanType=function(){return this.supportedScanTypes[0]},t.prototype.hasMoreThanOneScanType=function(){return this.supportedScanTypes.length>1},t.prototype.isCameraScanRequired=function(){for(var e=0,n=this.supportedScanTypes;e<n.length;e++){var r=n[e];if(t.isCameraScanType(r))return!0}return!1},t.isCameraScanType=function(t){return t===s.SCAN_TYPE_CAMERA},t.isFileScanType=function(t){return t===s.SCAN_TYPE_FILE},t.prototype.validateAndReturnScanTypes=function(t){if(!t||0===t.length)return l.DEFAULT_SUPPORTED_SCAN_TYPE;var e=l.DEFAULT_SUPPORTED_SCAN_TYPE.length;if(t.length>e)throw"Max "+e+" values expected for supportedScanTypes";for(var n=0,r=t;n<r.length;n++){var i=r[n];if(!l.DEFAULT_SUPPORTED_SCAN_TYPE.includes(i))throw"Unsupported scan type "+i}return t},t}(),ft=function(){function t(){}return t.ALL_ELEMENT_CLASS="html5-qrcode-element",t.CAMERA_PERMISSION_BUTTON_ID="html5-qrcode-button-camera-permission",t.CAMERA_START_BUTTON_ID="html5-qrcode-button-camera-start",t.CAMERA_STOP_BUTTON_ID="html5-qrcode-button-camera-stop",t.TORCH_BUTTON_ID="html5-qrcode-button-torch",t.CAMERA_SELECTION_SELECT_ID="html5-qrcode-select-camera",t.FILE_SELECTION_BUTTON_ID="html5-qrcode-button-file-selection",t.ZOOM_SLIDER_ID="html5-qrcode-input-range-zoom",t.SCAN_TYPE_CHANGE_ANCHOR_ID="html5-qrcode-anchor-scan-type-change",t.TORCH_BUTTON_CLASS_TORCH_ON="html5-qrcode-button-torch-on",t.TORCH_BUTTON_CLASS_TORCH_OFF="html5-qrcode-button-torch-off",t}(),pt=function(){function t(){}return t.createElement=function(t,e){var n=document.createElement(t);return n.id=e,n.classList.add(ft.ALL_ELEMENT_CLASS),"button"===t&&n.setAttribute("type","button"),n},t}(),gt=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))},mt=function(t,e){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function a(t){return function(e){return c([t,e])}}function c(s){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,r&&(i=2&s[0]?r["return"]:s[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===s[0]||2===s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=e.call(t,o)}catch(a){s=[6,a],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}},yt=function(){function t(t,e,n){this.isTorchOn=!1,this.torchCapability=t,this.buttonController=e,this.onTorchActionFailureCallback=n}return t.prototype.isTorchEnabled=function(){return this.isTorchOn},t.prototype.flipState=function(){return gt(this,void 0,void 0,(function(){var t,e;return mt(this,(function(n){switch(n.label){case 0:this.buttonController.disable(),t=!this.isTorchOn,n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.torchCapability.apply(t)];case 2:return n.sent(),this.updateUiBasedOnLatestSettings(this.torchCapability.value(),t),[3,4];case 3:return e=n.sent(),this.propagateFailure(t,e),this.buttonController.enable(),[3,4];case 4:return[2]}}))}))},t.prototype.updateUiBasedOnLatestSettings=function(t,e){t===e?(this.buttonController.setText(e?w.torchOffButton():w.torchOnButton()),this.isTorchOn=e):this.propagateFailure(e),this.buttonController.enable()},t.prototype.propagateFailure=function(t,e){var n=t?w.torchOnFailedMessage():w.torchOffFailedMessage();e&&(n+="; Error = "+e),this.onTorchActionFailureCallback(n)},t.prototype.reset=function(){this.isTorchOn=!1},t}(),wt=function(){function t(t,e){this.onTorchActionFailureCallback=e,this.torchButton=pt.createElement("button",ft.TORCH_BUTTON_ID),this.torchController=new yt(t,this,e)}return t.prototype.render=function(t,e){var n=this;this.torchButton.innerText=w.torchOnButton(),this.torchButton.style.display=e.display,this.torchButton.style.marginLeft=e.marginLeft;var r=this;this.torchButton.addEventListener("click",(function(t){return gt(n,void 0,void 0,(function(){return mt(this,(function(t){switch(t.label){case 0:return[4,r.torchController.flipState()];case 1:return t.sent(),r.torchController.isTorchEnabled()?(r.torchButton.classList.remove(ft.TORCH_BUTTON_CLASS_TORCH_OFF),r.torchButton.classList.add(ft.TORCH_BUTTON_CLASS_TORCH_ON)):(r.torchButton.classList.remove(ft.TORCH_BUTTON_CLASS_TORCH_ON),r.torchButton.classList.add(ft.TORCH_BUTTON_CLASS_TORCH_OFF)),[2]}}))}))})),t.appendChild(this.torchButton)},t.prototype.updateTorchCapability=function(t){this.torchController=new yt(t,this,this.onTorchActionFailureCallback)},t.prototype.getTorchButton=function(){return this.torchButton},t.prototype.hide=function(){this.torchButton.style.display="none"},t.prototype.show=function(){this.torchButton.style.display="inline-block"},t.prototype.disable=function(){this.torchButton.disabled=!0},t.prototype.enable=function(){this.torchButton.disabled=!1},t.prototype.setText=function(t){this.torchButton.innerText=t},t.prototype.reset=function(){this.torchButton.innerText=w.torchOnButton(),this.torchController.reset()},t.create=function(e,n,r,i){var s=new t(n,i);return s.render(e,r),s},t}(),bt=function(){function t(t,e,n){this.fileBasedScanRegion=this.createFileBasedScanRegion(),this.fileBasedScanRegion.style.display=e?"block":"none",t.appendChild(this.fileBasedScanRegion);var r=document.createElement("label");r.setAttribute("for",this.getFileScanInputId()),r.style.display="inline-block",this.fileBasedScanRegion.appendChild(r),this.fileSelectionButton=pt.createElement("button",ft.FILE_SELECTION_BUTTON_ID),this.setInitialValueToButton(),this.fileSelectionButton.addEventListener("click",(function(t){r.click()})),r.append(this.fileSelectionButton),this.fileScanInput=pt.createElement("input",this.getFileScanInputId()),this.fileScanInput.type="file",this.fileScanInput.accept="image/*",this.fileScanInput.style.display="none",r.appendChild(this.fileScanInput);var i=this;this.fileScanInput.addEventListener("change",(function(t){if(null!=t&&null!=t.target){var e=t.target;if(!e.files||0!==e.files.length){var r=e.files,s=r[0],o=s.name;i.setImageNameToButton(o),n(s)}}}));var s=this.createDragAndDropMessage();this.fileBasedScanRegion.appendChild(s),this.fileBasedScanRegion.addEventListener("dragenter",(function(t){i.fileBasedScanRegion.style.border=i.fileBasedScanRegionActiveBorder(),t.stopPropagation(),t.preventDefault()})),this.fileBasedScanRegion.addEventListener("dragleave",(function(t){i.fileBasedScanRegion.style.border=i.fileBasedScanRegionDefaultBorder(),t.stopPropagation(),t.preventDefault()})),this.fileBasedScanRegion.addEventListener("dragover",(function(t){i.fileBasedScanRegion.style.border=i.fileBasedScanRegionActiveBorder(),t.stopPropagation(),t.preventDefault()})),this.fileBasedScanRegion.addEventListener("drop",(function(t){t.stopPropagation(),t.preventDefault(),i.fileBasedScanRegion.style.border=i.fileBasedScanRegionDefaultBorder();var e=t.dataTransfer;if(e){var r=e.files;if(!r||0===r.length)return;for(var o=!1,a=0;a<r.length;++a){var c=r.item(a);if(c){var l=/image.*/;if(c.type.match(l)){o=!0;var u=c.name;i.setImageNameToButton(u),n(c),s.innerText=w.dragAndDropMessage();break}}}o||(s.innerText=w.dragAndDropMessageOnlyImages())}}))}return t.prototype.hide=function(){this.fileBasedScanRegion.style.display="none",this.fileScanInput.disabled=!0},t.prototype.show=function(){this.fileBasedScanRegion.style.display="block",this.fileScanInput.disabled=!1},t.prototype.isShowing=function(){return"block"===this.fileBasedScanRegion.style.display},t.prototype.resetValue=function(){this.fileScanInput.value="",this.setInitialValueToButton()},t.prototype.createFileBasedScanRegion=function(){var t=document.createElement("div");return t.style.textAlign="center",t.style.margin="auto",t.style.width="80%",t.style.maxWidth="600px",t.style.border=this.fileBasedScanRegionDefaultBorder(),t.style.padding="10px",t.style.marginBottom="10px",t},t.prototype.fileBasedScanRegionDefaultBorder=function(){return"6px dashed #ebebeb"},t.prototype.fileBasedScanRegionActiveBorder=function(){return"6px dashed rgb(153 151 151)"},t.prototype.createDragAndDropMessage=function(){var t=document.createElement("div");return t.innerText=w.dragAndDropMessage(),t.style.fontWeight="400",t},t.prototype.setImageNameToButton=function(t){var e=20;if(t.length>e){var n=t.substring(0,8),r=t.length,i=t.substring(r-8,r);t=n+"...."+i}var s=w.fileSelectionChooseAnother()+" - "+t;this.fileSelectionButton.innerText=s},t.prototype.setInitialValueToButton=function(){var t=w.fileSelectionChooseImage()+" - "+w.fileSelectionNoImageSelected();this.fileSelectionButton.innerText=t},t.prototype.getFileScanInputId=function(){return"html5-qrcode-private-filescan-input"},t.create=function(e,n,r){var i=new t(e,n,r);return i},t}(),vt=function(){function t(t){this.selectElement=pt.createElement("select",ft.CAMERA_SELECTION_SELECT_ID),this.cameras=t,this.options=[]}return t.prototype.render=function(t){var e=document.createElement("span");e.style.marginRight="10px";var n=this.cameras.length;if(0===n)throw new Error("No cameras found");if(1===n)e.style.display="none";else{var r=w.selectCamera();e.innerText=r+" ("+this.cameras.length+")  "}for(var i=1,s=0,o=this.cameras;s<o.length;s++){var a=o[s],c=a.id,l=null==a.label?c:a.label;l&&""!==l||(l=[w.anonymousCameraPrefix(),i++].join(" "));var u=document.createElement("option");u.value=c,u.innerText=l,this.options.push(u),this.selectElement.appendChild(u)}e.appendChild(this.selectElement),t.appendChild(e)},t.prototype.disable=function(){this.selectElement.disabled=!0},t.prototype.isDisabled=function(){return!0===this.selectElement.disabled},t.prototype.enable=function(){this.selectElement.disabled=!1},t.prototype.getValue=function(){return this.selectElement.value},t.prototype.hasValue=function(t){for(var e=0,n=this.options;e<n.length;e++){var r=n[e];if(r.value===t)return!0}return!1},t.prototype.setValue=function(t){if(!this.hasValue(t))throw new Error(t+" is not present in the camera list.");this.selectElement.value=t},t.prototype.hasSingleItem=function(){return 1===this.cameras.length},t.prototype.numCameras=function(){return this.cameras.length},t.create=function(e,n){var r=new t(n);return r.render(e),r},t}(),Et=function(){function t(){this.onChangeCallback=null,this.zoomElementContainer=document.createElement("div"),this.rangeInput=pt.createElement("input",ft.ZOOM_SLIDER_ID),this.rangeInput.type="range",this.rangeText=document.createElement("span"),this.rangeInput.min="1",this.rangeInput.max="5",this.rangeInput.value="1",this.rangeInput.step="0.1"}return t.prototype.render=function(t,e){this.zoomElementContainer.style.display=e?"block":"none",this.zoomElementContainer.style.padding="5px 10px",this.zoomElementContainer.style.textAlign="center",t.appendChild(this.zoomElementContainer),this.rangeInput.style.display="inline-block",this.rangeInput.style.width="50%",this.rangeInput.style.height="5px",this.rangeInput.style.background="#d3d3d3",this.rangeInput.style.outline="none",this.rangeInput.style.opacity="0.7";var n=w.zoom();this.rangeText.innerText=this.rangeInput.value+"x "+n,this.rangeText.style.marginRight="10px";var r=this;this.rangeInput.addEventListener("input",(function(){return r.onValueChange()})),this.rangeInput.addEventListener("change",(function(){return r.onValueChange()})),this.zoomElementContainer.appendChild(this.rangeInput),this.zoomElementContainer.appendChild(this.rangeText)},t.prototype.onValueChange=function(){var t=w.zoom();this.rangeText.innerText=this.rangeInput.value+"x "+t,this.onChangeCallback&&this.onChangeCallback(parseFloat(this.rangeInput.value))},t.prototype.setValues=function(t,e,n,r){this.rangeInput.min=t.toString(),this.rangeInput.max=e.toString(),this.rangeInput.step=r.toString(),this.rangeInput.value=n.toString(),this.onValueChange()},t.prototype.show=function(){this.zoomElementContainer.style.display="block"},t.prototype.hide=function(){this.zoomElementContainer.style.display="none"},t.prototype.setOnCameraZoomValueChangeCallback=function(t){this.onChangeCallback=t},t.prototype.removeOnCameraZoomValueChangeCallback=function(){this.onChangeCallback=null},t.create=function(e,n){var r=new t;return r.render(e,n),r},t}();function _t(t){return{fps:t.fps,qrbox:t.qrbox,aspectRatio:t.aspectRatio,disableFlip:t.disableFlip,videoConstraints:t.videoConstraints}}function St(t,e){return{formatsToSupport:t.formatsToSupport,useBarCodeDetectorIfSupported:t.useBarCodeDetectorIfSupported,experimentalFeatures:t.experimentalFeatures,verbose:e}}(function(t){t[t["STATUS_DEFAULT"]=0]="STATUS_DEFAULT",t[t["STATUS_SUCCESS"]=1]="STATUS_SUCCESS",t[t["STATUS_WARNING"]=2]="STATUS_WARNING",t[t["STATUS_REQUESTING_PERMISSION"]=3]="STATUS_REQUESTING_PERMISSION"})(K||(K={}));(function(){function t(t,e,n){if(this.lastMatchFound=null,this.cameraScanImage=null,this.fileScanImage=null,this.fileSelectionUi=null,this.elementId=t,this.config=this.createConfig(e),this.verbose=!0===n,!document.getElementById(t))throw"HTML Element with id="+t+" not found";this.scanTypeSelector=new dt(this.config.supportedScanTypes),this.currentScanType=this.scanTypeSelector.getDefaultScanType(),this.sectionSwapAllowed=!0,this.logger=new f(this.verbose),this.persistedDataManager=new st,!0!==e.rememberLastUsedCamera&&this.persistedDataManager.reset()}t.prototype.render=function(t,e){var n=this;this.lastMatchFound=null,this.qrCodeSuccessCallback=function(e,r){if(t)t(e,r);else{if(n.lastMatchFound===e)return;n.lastMatchFound=e,n.setHeaderMessage(w.lastMatch(e),K.STATUS_SUCCESS)}},this.qrCodeErrorCallback=function(t,n){e&&e(t,n)};var r=document.getElementById(this.elementId);if(!r)throw"HTML Element with id="+this.elementId+" not found";r.innerHTML="",this.createBasicLayout(r),this.html5Qrcode=new J(this.getScanRegionId(),St(this.config,this.verbose))},t.prototype.pause=function(t){(p(t)||!0!==t)&&(t=!1),this.getHtml5QrcodeOrFail().pause(t)},t.prototype.resume=function(){this.getHtml5QrcodeOrFail().resume()},t.prototype.getState=function(){return this.getHtml5QrcodeOrFail().getState()},t.prototype.clear=function(){var t=this,e=function(){var e=document.getElementById(t.elementId);e&&(e.innerHTML="",t.resetBasicLayout(e))};return this.html5Qrcode?new Promise((function(n,r){t.html5Qrcode?t.html5Qrcode.isScanning?t.html5Qrcode.stop().then((function(r){t.html5Qrcode?(t.html5Qrcode.clear(),e(),n()):n()})).catch((function(e){t.verbose&&t.logger.logError("Unable to stop qrcode scanner",e),r(e)})):(t.html5Qrcode.clear(),e(),n()):n()})):Promise.resolve()},t.prototype.getRunningTrackCapabilities=function(){return this.getHtml5QrcodeOrFail().getRunningTrackCapabilities()},t.prototype.getRunningTrackSettings=function(){return this.getHtml5QrcodeOrFail().getRunningTrackSettings()},t.prototype.applyVideoConstraints=function(t){return this.getHtml5QrcodeOrFail().applyVideoConstraints(t)},t.prototype.getHtml5QrcodeOrFail=function(){if(!this.html5Qrcode)throw"Code scanner not initialized.";return this.html5Qrcode},t.prototype.createConfig=function(t){return t?(t.fps||(t.fps=l.SCAN_DEFAULT_FPS),t.rememberLastUsedCamera!==!l.DEFAULT_REMEMBER_LAST_CAMERA_USED&&(t.rememberLastUsedCamera=l.DEFAULT_REMEMBER_LAST_CAMERA_USED),t.supportedScanTypes||(t.supportedScanTypes=l.DEFAULT_SUPPORTED_SCAN_TYPE),t):{fps:l.SCAN_DEFAULT_FPS,rememberLastUsedCamera:l.DEFAULT_REMEMBER_LAST_CAMERA_USED,supportedScanTypes:l.DEFAULT_SUPPORTED_SCAN_TYPE}},t.prototype.createBasicLayout=function(t){t.style.position="relative",t.style.padding="0px",t.style.border="1px solid silver",this.createHeader(t);var e=document.createElement("div"),n=this.getScanRegionId();e.id=n,e.style.width="100%",e.style.minHeight="100px",e.style.textAlign="center",t.appendChild(e),dt.isCameraScanType(this.currentScanType)?this.insertCameraScanImageToScanRegion():this.insertFileScanImageToScanRegion();var r=document.createElement("div"),i=this.getDashboardId();r.id=i,r.style.width="100%",t.appendChild(r),this.setupInitialDashboard(r)},t.prototype.resetBasicLayout=function(t){t.style.border="none"},t.prototype.setupInitialDashboard=function(t){this.createSection(t),this.createSectionControlPanel(),this.scanTypeSelector.hasMoreThanOneScanType()&&this.createSectionSwap()},t.prototype.createHeader=function(t){var e=document.createElement("div");e.style.textAlign="left",e.style.margin="0px",t.appendChild(e);var n=new ct;n.renderInto(e);var r=document.createElement("div");r.id=this.getHeaderMessageContainerId(),r.style.display="none",r.style.textAlign="center",r.style.fontSize="14px",r.style.padding="2px 10px",r.style.margin="4px",r.style.borderTop="1px solid #f6f6f6",e.appendChild(r)},t.prototype.createSection=function(t){var e=document.createElement("div");e.id=this.getDashboardSectionId(),e.style.width="100%",e.style.padding="10px 0px 10px 0px",e.style.textAlign="left",t.appendChild(e)},t.prototype.createCameraListUi=function(t,e,n){var r=this;r.showHideScanTypeSwapLink(!1),r.setHeaderMessage(w.cameraPermissionRequesting());var i=function(){n||r.createPermissionButton(t,e)};J.getCameras().then((function(n){r.persistedDataManager.setHasPermission(!0),r.showHideScanTypeSwapLink(!0),r.resetHeaderMessage(),n&&n.length>0?(t.removeChild(e),r.renderCameraSelection(n)):(r.setHeaderMessage(w.noCameraFound(),K.STATUS_WARNING),i())})).catch((function(t){r.persistedDataManager.setHasPermission(!1),n?n.disabled=!1:i(),r.setHeaderMessage(t,K.STATUS_WARNING),r.showHideScanTypeSwapLink(!0)}))},t.prototype.createPermissionButton=function(t,e){var n=this,r=pt.createElement("button",this.getCameraPermissionButtonId());r.innerText=w.cameraPermissionTitle(),r.addEventListener("click",(function(){r.disabled=!0,n.createCameraListUi(t,e,r)})),e.appendChild(r)},t.prototype.createPermissionsUi=function(t,e){var n=this;dt.isCameraScanType(this.currentScanType)&&this.persistedDataManager.hasCameraPermissions()?ht.hasPermissions().then((function(r){r?n.createCameraListUi(t,e):(n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(t,e))})).catch((function(r){n.persistedDataManager.setHasPermission(!1),n.createPermissionButton(t,e)})):this.createPermissionButton(t,e)},t.prototype.createSectionControlPanel=function(){var t=document.getElementById(this.getDashboardSectionId()),e=document.createElement("div");t.appendChild(e);var n=document.createElement("div");n.id=this.getDashboardSectionCameraScanRegionId(),n.style.display=dt.isCameraScanType(this.currentScanType)?"block":"none",e.appendChild(n);var r=document.createElement("div");r.style.textAlign="center",n.appendChild(r),this.scanTypeSelector.isCameraScanRequired()&&this.createPermissionsUi(n,r),this.renderFileScanUi(e)},t.prototype.renderFileScanUi=function(t){var e=dt.isFileScanType(this.currentScanType),n=this,r=function(t){if(!n.html5Qrcode)throw"html5Qrcode not defined";dt.isFileScanType(n.currentScanType)&&(n.setHeaderMessage(w.loadingImage()),n.html5Qrcode.scanFileV2(t,!0).then((function(t){n.resetHeaderMessage(),n.qrCodeSuccessCallback(t.decodedText,t)})).catch((function(t){n.setHeaderMessage(t,K.STATUS_WARNING),n.qrCodeErrorCallback(t,d.createFrom(t))})))};this.fileSelectionUi=bt.create(t,e,r)},t.prototype.renderCameraSelection=function(t){var e=this,n=this,r=document.getElementById(this.getDashboardSectionCameraScanRegionId());r.style.textAlign="center";var i=Et.create(r,!1),s=function(t){var n=t.zoomFeature();if(n.isSupported()){i.setOnCameraZoomValueChangeCallback((function(t){n.apply(t)}));var r=1;e.config.defaultZoomValueIfSupported&&(r=e.config.defaultZoomValueIfSupported),r=g(r,n.min(),n.max()),i.setValues(n.min(),n.max(),r,n.step()),i.show()}},o=vt.create(r,t),a=document.createElement("span"),c=pt.createElement("button",ft.CAMERA_START_BUTTON_ID);c.innerText=w.scanButtonStartScanningText(),a.appendChild(c);var l,u=pt.createElement("button",ft.CAMERA_STOP_BUTTON_ID);u.innerText=w.scanButtonStopScanningText(),u.style.display="none",u.disabled=!0,a.appendChild(u);var h=function(t){t.torchFeature().isSupported()?(l?l.updateTorchCapability(t.torchFeature()):l=wt.create(a,t.torchFeature(),{display:"none",marginLeft:"5px"},(function(t){n.setHeaderMessage(t,K.STATUS_WARNING)})),l.show()):l&&l.hide()};r.appendChild(a);var d=function(t){t||(c.style.display="none"),c.innerText=w.scanButtonStartScanningText(),c.style.opacity="1",c.disabled=!1,t&&(c.style.display="inline-block")};if(c.addEventListener("click",(function(t){c.innerText=w.scanButtonScanningStarting(),o.disable(),c.disabled=!0,c.style.opacity="0.5",e.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!1),n.resetHeaderMessage();var r=o.getValue();n.persistedDataManager.setLastUsedCameraId(r),n.html5Qrcode.start(r,_t(n.config),n.qrCodeSuccessCallback,n.qrCodeErrorCallback).then((function(t){u.disabled=!1,u.style.display="inline-block",d(!1);var r=n.html5Qrcode.getRunningTrackCameraCapabilities();!0===e.config.showTorchButtonIfSupported&&h(r),!0===e.config.showZoomSliderIfSupported&&s(r)})).catch((function(t){n.showHideScanTypeSwapLink(!0),o.enable(),d(!0),n.setHeaderMessage(t,K.STATUS_WARNING)}))})),o.hasSingleItem()&&c.click(),u.addEventListener("click",(function(t){if(!n.html5Qrcode)throw"html5Qrcode not defined";u.disabled=!0,n.html5Qrcode.stop().then((function(t){e.scanTypeSelector.hasMoreThanOneScanType()&&n.showHideScanTypeSwapLink(!0),o.enable(),c.disabled=!1,u.style.display="none",c.style.display="inline-block",l&&(l.reset(),l.hide()),i.removeOnCameraZoomValueChangeCallback(),i.hide(),n.insertCameraScanImageToScanRegion()})).catch((function(t){u.disabled=!1,n.setHeaderMessage(t,K.STATUS_WARNING)}))})),n.persistedDataManager.getLastUsedCameraId()){var f=n.persistedDataManager.getLastUsedCameraId();o.hasValue(f)?(o.setValue(f),c.click()):n.persistedDataManager.resetLastUsedCameraId()}},t.prototype.createSectionSwap=function(){var t=this,e=w.textIfCameraScanSelected(),n=w.textIfFileScanSelected(),r=document.getElementById(this.getDashboardSectionId()),i=document.createElement("div");i.style.textAlign="center";var o=pt.createElement("span",this.getDashboardSectionSwapLinkId());o.style.textDecoration="underline",o.style.cursor="pointer",o.innerText=dt.isCameraScanType(this.currentScanType)?e:n,o.addEventListener("click",(function(){t.sectionSwapAllowed?(t.resetHeaderMessage(),t.fileSelectionUi.resetValue(),t.sectionSwapAllowed=!1,dt.isCameraScanType(t.currentScanType)?(t.clearScanRegion(),t.getCameraScanRegion().style.display="none",t.fileSelectionUi.show(),o.innerText=n,t.currentScanType=s.SCAN_TYPE_FILE,t.insertFileScanImageToScanRegion()):(t.clearScanRegion(),t.getCameraScanRegion().style.display="block",t.fileSelectionUi.hide(),o.innerText=e,t.currentScanType=s.SCAN_TYPE_CAMERA,t.insertCameraScanImageToScanRegion(),t.startCameraScanIfPermissionExistsOnSwap()),t.sectionSwapAllowed=!0):t.verbose&&t.logger.logError("Section swap called when not allowed")})),i.appendChild(o),r.appendChild(i)},t.prototype.startCameraScanIfPermissionExistsOnSwap=function(){var t=this,e=this;this.persistedDataManager.hasCameraPermissions()&&ht.hasPermissions().then((function(n){if(n){var r=document.getElementById(e.getCameraPermissionButtonId());if(!r)throw t.logger.logError("Permission button not found, fail;"),"Permission button not found";r.click()}else e.persistedDataManager.setHasPermission(!1)})).catch((function(t){e.persistedDataManager.setHasPermission(!1)}))},t.prototype.resetHeaderMessage=function(){var t=document.getElementById(this.getHeaderMessageContainerId());t.style.display="none"},t.prototype.setHeaderMessage=function(t,e){e||(e=K.STATUS_DEFAULT);var n=this.getHeaderMessageDiv();switch(n.innerText=t,n.style.display="block",e){case K.STATUS_SUCCESS:n.style.background="rgba(106, 175, 80, 0.26)",n.style.color="#477735";break;case K.STATUS_WARNING:n.style.background="rgba(203, 36, 49, 0.14)",n.style.color="#cb2431";break;case K.STATUS_DEFAULT:default:n.style.background="rgba(0, 0, 0, 0)",n.style.color="rgb(17, 17, 17)";break}},t.prototype.showHideScanTypeSwapLink=function(t){this.scanTypeSelector.hasMoreThanOneScanType()&&(!0!==t&&(t=!1),this.sectionSwapAllowed=t,this.getDashboardSectionSwapLink().style.display=t?"inline-block":"none")},t.prototype.insertCameraScanImageToScanRegion=function(){var t=this,e=document.getElementById(this.getScanRegionId());if(this.cameraScanImage)return e.innerHTML="<br>",void e.appendChild(this.cameraScanImage);this.cameraScanImage=new Image,this.cameraScanImage.onload=function(n){e.innerHTML="<br>",e.appendChild(t.cameraScanImage)},this.cameraScanImage.width=64,this.cameraScanImage.style.opacity="0.8",this.cameraScanImage.src=tt,this.cameraScanImage.alt=w.cameraScanAltText()},t.prototype.insertFileScanImageToScanRegion=function(){var t=this,e=document.getElementById(this.getScanRegionId());if(this.fileScanImage)return e.innerHTML="<br>",void e.appendChild(this.fileScanImage);this.fileScanImage=new Image,this.fileScanImage.onload=function(n){e.innerHTML="<br>",e.appendChild(t.fileScanImage)},this.fileScanImage.width=64,this.fileScanImage.style.opacity="0.8",this.fileScanImage.src=et,this.fileScanImage.alt=w.fileScanAltText()},t.prototype.clearScanRegion=function(){var t=document.getElementById(this.getScanRegionId());t.innerHTML=""},t.prototype.getDashboardSectionId=function(){return this.elementId+"__dashboard_section"},t.prototype.getDashboardSectionCameraScanRegionId=function(){return this.elementId+"__dashboard_section_csr"},t.prototype.getDashboardSectionSwapLinkId=function(){return ft.SCAN_TYPE_CHANGE_ANCHOR_ID},t.prototype.getScanRegionId=function(){return this.elementId+"__scan_region"},t.prototype.getDashboardId=function(){return this.elementId+"__dashboard"},t.prototype.getHeaderMessageContainerId=function(){return this.elementId+"__header_message"},t.prototype.getCameraPermissionButtonId=function(){return ft.CAMERA_PERMISSION_BUTTON_ID},t.prototype.getCameraScanRegion=function(){return document.getElementById(this.getDashboardSectionCameraScanRegionId())},t.prototype.getDashboardSectionSwapLink=function(){return document.getElementById(this.getDashboardSectionSwapLinkId())},t.prototype.getHeaderMessageDiv=function(){return document.getElementById(this.getHeaderMessageContainerId())}})()},5176:function(t,e,n){n(3767),n(8585),n(8696),n(2801),n(7658),n(541),function(t,n){n(e)}(0,(function(t){"use strict";function e(t){return null===t||void 0===t}var r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};function i(t,e){function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function s(t,e){var n=Object.setPrototypeOf;n?n(t,e):t.__proto__=e}function o(t,e){void 0===e&&(e=t.constructor);var n=Error.captureStackTrace;n&&n(t,e)}var a,c=function(t){function e(e){var n=this.constructor,r=t.call(this,e)||this;return Object.defineProperty(r,"name",{value:n.name,enumerable:!1}),s(r,n.prototype),o(r),r}return i(e,t),e}(Error);class l extends c{constructor(t=undefined){super(t),this.message=t}getKind(){const t=this.constructor;return t.kind}}l.kind="Exception";class u extends l{}u.kind="ArgumentException";class h extends l{}h.kind="IllegalArgumentException";class d{constructor(t){if(this.binarizer=t,null===t)throw new h("Binarizer must be non-null.")}getWidth(){return this.binarizer.getWidth()}getHeight(){return this.binarizer.getHeight()}getBlackRow(t,e){return this.binarizer.getBlackRow(t,e)}getBlackMatrix(){return null!==this.matrix&&void 0!==this.matrix||(this.matrix=this.binarizer.getBlackMatrix()),this.matrix}isCropSupported(){return this.binarizer.getLuminanceSource().isCropSupported()}crop(t,e,n,r){const i=this.binarizer.getLuminanceSource().crop(t,e,n,r);return new d(this.binarizer.createBinarizer(i))}isRotateSupported(){return this.binarizer.getLuminanceSource().isRotateSupported()}rotateCounterClockwise(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new d(this.binarizer.createBinarizer(t))}rotateCounterClockwise45(){const t=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new d(this.binarizer.createBinarizer(t))}toString(){try{return this.getBlackMatrix().toString()}catch(t){return""}}}class f extends l{static getChecksumInstance(){return new f}}f.kind="ChecksumException";class p{constructor(t){this.source=t}getLuminanceSource(){return this.source}getWidth(){return this.source.getWidth()}getHeight(){return this.source.getHeight()}}class g{static arraycopy(t,e,n,r,i){while(i--)n[r++]=t[e++]}static currentTimeMillis(){return Date.now()}}class m extends l{}m.kind="IndexOutOfBoundsException";class y extends m{constructor(t=undefined,e=undefined){super(e),this.index=t,this.message=e}}y.kind="ArrayIndexOutOfBoundsException";class w{static fill(t,e){for(let n=0,r=t.length;n<r;n++)t[n]=e}static fillWithin(t,e,n,r){w.rangeCheck(t.length,e,n);for(let i=e;i<n;i++)t[i]=r}static rangeCheck(t,e,n){if(e>n)throw new h("fromIndex("+e+") > toIndex("+n+")");if(e<0)throw new y(e);if(n>t)throw new y(n)}static asList(...t){return t}static create(t,e,n){let r=Array.from({length:t});return r.map((t=>Array.from({length:e}).fill(n)))}static createInt32Array(t,e,n){let r=Array.from({length:t});return r.map((t=>Int32Array.from({length:e}).fill(n)))}static equals(t,e){if(!t)return!1;if(!e)return!1;if(!t.length)return!1;if(!e.length)return!1;if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}static hashCode(t){if(null===t)return 0;let e=1;for(const n of t)e=31*e+n;return e}static fillUint8Array(t,e){for(let n=0;n!==t.length;n++)t[n]=e}static copyOf(t,e){return t.slice(0,e)}static copyOfUint8Array(t,e){if(t.length<=e){const n=new Uint8Array(e);return n.set(t),n}return t.slice(0,e)}static copyOfRange(t,e,n){const r=n-e,i=new Int32Array(r);return g.arraycopy(t,e,i,0,r),i}static binarySearch(t,e,n){void 0===n&&(n=w.numberComparator);let r=0,i=t.length-1;while(r<=i){const s=i+r>>1,o=n(e,t[s]);if(o>0)r=s+1;else{if(!(o<0))return s;i=s-1}}return-r-1}static numberComparator(t,e){return t-e}}class b{static numberOfTrailingZeros(t){let e;if(0===t)return 32;let n=31;return e=t<<16,0!==e&&(n-=16,t=e),e=t<<8,0!==e&&(n-=8,t=e),e=t<<4,0!==e&&(n-=4,t=e),e=t<<2,0!==e&&(n-=2,t=e),n-(t<<1>>>31)}static numberOfLeadingZeros(t){if(0===t)return 32;let e=1;return t>>>16===0&&(e+=16,t<<=16),t>>>24===0&&(e+=8,t<<=8),t>>>28===0&&(e+=4,t<<=4),t>>>30===0&&(e+=2,t<<=2),e-=t>>>31,e}static toHexString(t){return t.toString(16)}static toBinaryString(t){return String(parseInt(String(t),2))}static bitCount(t){return t-=t>>>1&1431655765,t=(858993459&t)+(t>>>2&858993459),t=t+(t>>>4)&252645135,t+=t>>>8,t+=t>>>16,63&t}static truncDivision(t,e){return Math.trunc(t/e)}static parseInt(t,e=undefined){return parseInt(t,e)}}b.MIN_VALUE_32_BITS=-2147483648,b.MAX_VALUE=Number.MAX_SAFE_INTEGER;class v{constructor(t,e){void 0===t?(this.size=0,this.bits=new Int32Array(1)):(this.size=t,this.bits=void 0===e||null===e?v.makeArray(t):e)}getSize(){return this.size}getSizeInBytes(){return Math.floor((this.size+7)/8)}ensureCapacity(t){if(t>32*this.bits.length){const e=v.makeArray(t);g.arraycopy(this.bits,0,e,0,this.bits.length),this.bits=e}}get(t){return 0!==(this.bits[Math.floor(t/32)]&1<<(31&t))}set(t){this.bits[Math.floor(t/32)]|=1<<(31&t)}flip(t){this.bits[Math.floor(t/32)]^=1<<(31&t)}getNextSet(t){const e=this.size;if(t>=e)return e;const n=this.bits;let r=Math.floor(t/32),i=n[r];i&=~((1<<(31&t))-1);const s=n.length;while(0===i){if(++r===s)return e;i=n[r]}const o=32*r+b.numberOfTrailingZeros(i);return o>e?e:o}getNextUnset(t){const e=this.size;if(t>=e)return e;const n=this.bits;let r=Math.floor(t/32),i=~n[r];i&=~((1<<(31&t))-1);const s=n.length;while(0===i){if(++r===s)return e;i=~n[r]}const o=32*r+b.numberOfTrailingZeros(i);return o>e?e:o}setBulk(t,e){this.bits[Math.floor(t/32)]=e}setRange(t,e){if(e<t||t<0||e>this.size)throw new h;if(e===t)return;e--;const n=Math.floor(t/32),r=Math.floor(e/32),i=this.bits;for(let s=n;s<=r;s++){const o=s>n?0:31&t,a=s<r?31:31&e,c=(2<<a)-(1<<o);i[s]|=c}}clear(){const t=this.bits.length,e=this.bits;for(let n=0;n<t;n++)e[n]=0}isRange(t,e,n){if(e<t||t<0||e>this.size)throw new h;if(e===t)return!0;e--;const r=Math.floor(t/32),i=Math.floor(e/32),s=this.bits;for(let o=r;o<=i;o++){const a=o>r?0:31&t,c=o<i?31:31&e,l=(2<<c)-(1<<a)&4294967295;if((s[o]&l)!==(n?l:0))return!1}return!0}appendBit(t){this.ensureCapacity(this.size+1),t&&(this.bits[Math.floor(this.size/32)]|=1<<(31&this.size)),this.size++}appendBits(t,e){if(e<0||e>32)throw new h("Num bits must be between 0 and 32");this.ensureCapacity(this.size+e);for(let n=e;n>0;n--)this.appendBit(1===(t>>n-1&1))}appendBitArray(t){const e=t.size;this.ensureCapacity(this.size+e);for(let n=0;n<e;n++)this.appendBit(t.get(n))}xor(t){if(this.size!==t.size)throw new h("Sizes don't match");const e=this.bits;for(let n=0,r=e.length;n<r;n++)e[n]^=t.bits[n]}toBytes(t,e,n,r){for(let i=0;i<r;i++){let r=0;for(let e=0;e<8;e++)this.get(t)&&(r|=1<<7-e),t++;e[n+i]=r}}getBitArray(){return this.bits}reverse(){const t=new Int32Array(this.bits.length),e=Math.floor((this.size-1)/32),n=e+1,r=this.bits;for(let i=0;i<n;i++){let n=r[i];n=n>>1&1431655765|(1431655765&n)<<1,n=n>>2&858993459|(858993459&n)<<2,n=n>>4&252645135|(252645135&n)<<4,n=n>>8&16711935|(16711935&n)<<8,n=n>>16&65535|(65535&n)<<16,t[e-i]=n}if(this.size!==32*n){const e=32*n-this.size;let r=t[0]>>>e;for(let i=1;i<n;i++){const n=t[i];r|=n<<32-e,t[i-1]=r,r=n>>>e}t[n-1]=r}this.bits=t}static makeArray(t){return new Int32Array(Math.floor((t+31)/32))}equals(t){if(!(t instanceof v))return!1;const e=t;return this.size===e.size&&w.equals(this.bits,e.bits)}hashCode(){return 31*this.size+w.hashCode(this.bits)}toString(){let t="";for(let e=0,n=this.size;e<n;e++)0===(7&e)&&(t+=" "),t+=this.get(e)?"X":".";return t}clone(){return new v(this.size,this.bits.slice())}}(function(t){t[t["OTHER"]=0]="OTHER",t[t["PURE_BARCODE"]=1]="PURE_BARCODE",t[t["POSSIBLE_FORMATS"]=2]="POSSIBLE_FORMATS",t[t["TRY_HARDER"]=3]="TRY_HARDER",t[t["CHARACTER_SET"]=4]="CHARACTER_SET",t[t["ALLOWED_LENGTHS"]=5]="ALLOWED_LENGTHS",t[t["ASSUME_CODE_39_CHECK_DIGIT"]=6]="ASSUME_CODE_39_CHECK_DIGIT",t[t["ASSUME_GS1"]=7]="ASSUME_GS1",t[t["RETURN_CODABAR_START_END"]=8]="RETURN_CODABAR_START_END",t[t["NEED_RESULT_POINT_CALLBACK"]=9]="NEED_RESULT_POINT_CALLBACK",t[t["ALLOWED_EAN_EXTENSIONS"]=10]="ALLOWED_EAN_EXTENSIONS"})(a||(a={}));var E,_=a;class S extends l{static getFormatInstance(){return new S}}S.kind="FormatException",function(t){t[t["Cp437"]=0]="Cp437",t[t["ISO8859_1"]=1]="ISO8859_1",t[t["ISO8859_2"]=2]="ISO8859_2",t[t["ISO8859_3"]=3]="ISO8859_3",t[t["ISO8859_4"]=4]="ISO8859_4",t[t["ISO8859_5"]=5]="ISO8859_5",t[t["ISO8859_6"]=6]="ISO8859_6",t[t["ISO8859_7"]=7]="ISO8859_7",t[t["ISO8859_8"]=8]="ISO8859_8",t[t["ISO8859_9"]=9]="ISO8859_9",t[t["ISO8859_10"]=10]="ISO8859_10",t[t["ISO8859_11"]=11]="ISO8859_11",t[t["ISO8859_13"]=12]="ISO8859_13",t[t["ISO8859_14"]=13]="ISO8859_14",t[t["ISO8859_15"]=14]="ISO8859_15",t[t["ISO8859_16"]=15]="ISO8859_16",t[t["SJIS"]=16]="SJIS",t[t["Cp1250"]=17]="Cp1250",t[t["Cp1251"]=18]="Cp1251",t[t["Cp1252"]=19]="Cp1252",t[t["Cp1256"]=20]="Cp1256",t[t["UnicodeBigUnmarked"]=21]="UnicodeBigUnmarked",t[t["UTF8"]=22]="UTF8",t[t["ASCII"]=23]="ASCII",t[t["Big5"]=24]="Big5",t[t["GB18030"]=25]="GB18030",t[t["EUC_KR"]=26]="EUC_KR"}(E||(E={}));class A{constructor(t,e,n,...r){this.valueIdentifier=t,this.name=n,this.values="number"===typeof e?Int32Array.from([e]):e,this.otherEncodingNames=r,A.VALUE_IDENTIFIER_TO_ECI.set(t,this),A.NAME_TO_ECI.set(n,this);const i=this.values;for(let s=0,o=i.length;s!==o;s++){const t=i[s];A.VALUES_TO_ECI.set(t,this)}for(const s of r)A.NAME_TO_ECI.set(s,this)}getValueIdentifier(){return this.valueIdentifier}getName(){return this.name}getValue(){return this.values[0]}static getCharacterSetECIByValue(t){if(t<0||t>=900)throw new S("incorect value");const e=A.VALUES_TO_ECI.get(t);if(void 0===e)throw new S("incorect value");return e}static getCharacterSetECIByName(t){const e=A.NAME_TO_ECI.get(t);if(void 0===e)throw new S("incorect value");return e}equals(t){if(!(t instanceof A))return!1;const e=t;return this.getName()===e.getName()}}A.VALUE_IDENTIFIER_TO_ECI=new Map,A.VALUES_TO_ECI=new Map,A.NAME_TO_ECI=new Map,A.Cp437=new A(E.Cp437,Int32Array.from([0,2]),"Cp437"),A.ISO8859_1=new A(E.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),A.ISO8859_2=new A(E.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),A.ISO8859_3=new A(E.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),A.ISO8859_4=new A(E.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),A.ISO8859_5=new A(E.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),A.ISO8859_6=new A(E.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),A.ISO8859_7=new A(E.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),A.ISO8859_8=new A(E.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),A.ISO8859_9=new A(E.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),A.ISO8859_10=new A(E.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),A.ISO8859_11=new A(E.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),A.ISO8859_13=new A(E.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),A.ISO8859_14=new A(E.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),A.ISO8859_15=new A(E.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),A.ISO8859_16=new A(E.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),A.SJIS=new A(E.SJIS,20,"SJIS","Shift_JIS"),A.Cp1250=new A(E.Cp1250,21,"Cp1250","windows-1250"),A.Cp1251=new A(E.Cp1251,22,"Cp1251","windows-1251"),A.Cp1252=new A(E.Cp1252,23,"Cp1252","windows-1252"),A.Cp1256=new A(E.Cp1256,24,"Cp1256","windows-1256"),A.UnicodeBigUnmarked=new A(E.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),A.UTF8=new A(E.UTF8,26,"UTF8","UTF-8"),A.ASCII=new A(E.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),A.Big5=new A(E.Big5,28,"Big5"),A.GB18030=new A(E.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),A.EUC_KR=new A(E.EUC_KR,30,"EUC_KR","EUC-KR");class C extends l{}C.kind="UnsupportedOperationException";class I{static decode(t,e){const n=this.encodingName(e);return this.customDecoder?this.customDecoder(t,n):"undefined"===typeof TextDecoder||this.shouldDecodeOnFallback(n)?this.decodeFallback(t,n):new TextDecoder(n).decode(t)}static shouldDecodeOnFallback(t){return!I.isBrowser()&&"ISO-8859-1"===t}static encode(t,e){const n=this.encodingName(e);return this.customEncoder?this.customEncoder(t,n):"undefined"===typeof TextEncoder?this.encodeFallback(t):(new TextEncoder).encode(t)}static isBrowser(){return"undefined"!==typeof window&&"[object Window]"==={}.toString.call(window)}static encodingName(t){return"string"===typeof t?t:t.getName()}static encodingCharacterSet(t){return t instanceof A?t:A.getCharacterSetECIByName(t)}static decodeFallback(t,e){const n=this.encodingCharacterSet(e);if(I.isDecodeFallbackSupported(n)){let e="";for(let n=0,r=t.length;n<r;n++){let r=t[n].toString(16);r.length<2&&(r="0"+r),e+="%"+r}return decodeURIComponent(e)}if(n.equals(A.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(t.buffer));throw new C(`Encoding ${this.encodingName(e)} not supported by fallback.`)}static isDecodeFallbackSupported(t){return t.equals(A.UTF8)||t.equals(A.ISO8859_1)||t.equals(A.ASCII)}static encodeFallback(t){const e=btoa(unescape(encodeURIComponent(t))),n=e.split(""),r=[];for(let i=0;i<n.length;i++)r.push(n[i].charCodeAt(0));return new Uint8Array(r)}}class T{static castAsNonUtf8Char(t,e=null){const n=e?e.getName():this.ISO88591;return I.decode(new Uint8Array([t]),n)}static guessEncoding(t,e){if(null!==e&&void 0!==e&&void 0!==e.get(_.CHARACTER_SET))return e.get(_.CHARACTER_SET).toString();const n=t.length;let r=!0,i=!0,s=!0,o=0,a=0,c=0,l=0,u=0,h=0,d=0,f=0,p=0,g=0,m=0;const y=t.length>3&&239===t[0]&&187===t[1]&&191===t[2];for(let w=0;w<n&&(r||i||s);w++){const e=255&t[w];s&&(o>0?0===(128&e)?s=!1:o--:0!==(128&e)&&(0===(64&e)?s=!1:(o++,0===(32&e)?a++:(o++,0===(16&e)?c++:(o++,0===(8&e)?l++:s=!1))))),r&&(e>127&&e<160?r=!1:e>159&&(e<192||215===e||247===e)&&m++),i&&(u>0?e<64||127===e||e>252?i=!1:u--:128===e||160===e||e>239?i=!1:e>160&&e<224?(h++,f=0,d++,d>p&&(p=d)):e>127?(u++,d=0,f++,f>g&&(g=f)):(d=0,f=0))}return s&&o>0&&(s=!1),i&&u>0&&(i=!1),s&&(y||a+c+l>0)?T.UTF8:i&&(T.ASSUME_SHIFT_JIS||p>=3||g>=3)?T.SHIFT_JIS:r&&i?2===p&&2===h||10*m>=n?T.SHIFT_JIS:T.ISO88591:r?T.ISO88591:i?T.SHIFT_JIS:s?T.UTF8:T.PLATFORM_DEFAULT_ENCODING}static format(t,...e){let n=-1;function r(t,r,i,s,o,a){if("%%"===t)return"%";if(void 0===e[++n])return;t=s?parseInt(s.substr(1)):void 0;let c,l=o?parseInt(o.substr(1)):void 0;switch(a){case"s":c=e[n];break;case"c":c=e[n][0];break;case"f":c=parseFloat(e[n]).toFixed(t);break;case"p":c=parseFloat(e[n]).toPrecision(t);break;case"e":c=parseFloat(e[n]).toExponential(t);break;case"x":c=parseInt(e[n]).toString(l||16);break;case"d":c=parseFloat(parseInt(e[n],l||10).toPrecision(t)).toFixed(0);break}c="object"===typeof c?JSON.stringify(c):(+c).toString(l);let u=parseInt(i),h=i&&i[0]+""==="0"?"0":" ";while(c.length<u)c=void 0!==r?c+h:h+c;return c}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(i,r)}static getBytes(t,e){return I.encode(t,e)}static getCharCode(t,e=0){return t.charCodeAt(e)}static getCharAt(t){return String.fromCharCode(t)}}T.SHIFT_JIS=A.SJIS.getName(),T.GB2312="GB2312",T.ISO88591=A.ISO8859_1.getName(),T.EUC_JP="EUC_JP",T.UTF8=A.UTF8.getName(),T.PLATFORM_DEFAULT_ENCODING=T.UTF8,T.ASSUME_SHIFT_JIS=!1;class k{constructor(t=""){this.value=t}enableDecoding(t){return this.encoding=t,this}append(t){return"string"===typeof t?this.value+=t.toString():this.encoding?this.value+=T.castAsNonUtf8Char(t,this.encoding):this.value+=String.fromCharCode(t),this}appendChars(t,e,n){for(let r=e;e<e+n;r++)this.append(t[r]);return this}length(){return this.value.length}charAt(t){return this.value.charAt(t)}deleteCharAt(t){this.value=this.value.substr(0,t)+this.value.substring(t+1)}setCharAt(t,e){this.value=this.value.substr(0,t)+e+this.value.substr(t+1)}substring(t,e){return this.value.substring(t,e)}setLengthToZero(){this.value=""}toString(){return this.value}insert(t,e){this.value=this.value.substr(0,t)+e+this.value.substr(t+e.length)}}class R{constructor(t,e,n,r){if(this.width=t,this.height=e,this.rowSize=n,this.bits=r,void 0!==e&&null!==e||(e=t),this.height=e,t<1||e<1)throw new h("Both dimensions must be greater than 0");void 0!==n&&null!==n||(n=Math.floor((t+31)/32)),this.rowSize=n,void 0!==r&&null!==r||(this.bits=new Int32Array(this.rowSize*this.height))}static parseFromBooleanArray(t){const e=t.length,n=t[0].length,r=new R(n,e);for(let i=0;i<e;i++){const e=t[i];for(let t=0;t<n;t++)e[t]&&r.set(t,i)}return r}static parseFromString(t,e,n){if(null===t)throw new h("stringRepresentation cannot be null");const r=new Array(t.length);let i=0,s=0,o=-1,a=0,c=0;while(c<t.length)if("\n"===t.charAt(c)||"\r"===t.charAt(c)){if(i>s){if(-1===o)o=i-s;else if(i-s!==o)throw new h("row lengths do not match");s=i,a++}c++}else if(t.substring(c,c+e.length)===e)c+=e.length,r[i]=!0,i++;else{if(t.substring(c,c+n.length)!==n)throw new h("illegal character encountered: "+t.substring(c));c+=n.length,r[i]=!1,i++}if(i>s){if(-1===o)o=i-s;else if(i-s!==o)throw new h("row lengths do not match");a++}const l=new R(o,a);for(let u=0;u<i;u++)r[u]&&l.set(Math.floor(u%o),Math.floor(u/o));return l}get(t,e){const n=e*this.rowSize+Math.floor(t/32);return 0!==(this.bits[n]>>>(31&t)&1)}set(t,e){const n=e*this.rowSize+Math.floor(t/32);this.bits[n]|=1<<(31&t)&4294967295}unset(t,e){const n=e*this.rowSize+Math.floor(t/32);this.bits[n]&=~(1<<(31&t)&4294967295)}flip(t,e){const n=e*this.rowSize+Math.floor(t/32);this.bits[n]^=1<<(31&t)&4294967295}xor(t){if(this.width!==t.getWidth()||this.height!==t.getHeight()||this.rowSize!==t.getRowSize())throw new h("input matrix dimensions do not match");const e=new v(Math.floor(this.width/32)+1),n=this.rowSize,r=this.bits;for(let i=0,s=this.height;i<s;i++){const s=i*n,o=t.getRow(i,e).getBitArray();for(let t=0;t<n;t++)r[s+t]^=o[t]}}clear(){const t=this.bits,e=t.length;for(let n=0;n<e;n++)t[n]=0}setRegion(t,e,n,r){if(e<0||t<0)throw new h("Left and top must be nonnegative");if(r<1||n<1)throw new h("Height and width must be at least 1");const i=t+n,s=e+r;if(s>this.height||i>this.width)throw new h("The region must fit inside the matrix");const o=this.rowSize,a=this.bits;for(let c=e;c<s;c++){const e=c*o;for(let n=t;n<i;n++)a[e+Math.floor(n/32)]|=1<<(31&n)&4294967295}}getRow(t,e){null===e||void 0===e||e.getSize()<this.width?e=new v(this.width):e.clear();const n=this.rowSize,r=this.bits,i=t*n;for(let s=0;s<n;s++)e.setBulk(32*s,r[i+s]);return e}setRow(t,e){g.arraycopy(e.getBitArray(),0,this.bits,t*this.rowSize,this.rowSize)}rotate180(){const t=this.getWidth(),e=this.getHeight();let n=new v(t),r=new v(t);for(let i=0,s=Math.floor((e+1)/2);i<s;i++)n=this.getRow(i,n),r=this.getRow(e-1-i,r),n.reverse(),r.reverse(),this.setRow(i,r),this.setRow(e-1-i,n)}getEnclosingRectangle(){const t=this.width,e=this.height,n=this.rowSize,r=this.bits;let i=t,s=e,o=-1,a=-1;for(let c=0;c<e;c++)for(let t=0;t<n;t++){const e=r[c*n+t];if(0!==e){if(c<s&&(s=c),c>a&&(a=c),32*t<i){let n=0;while(0===(e<<31-n&4294967295))n++;32*t+n<i&&(i=32*t+n)}if(32*t+31>o){let n=31;while(e>>>n===0)n--;32*t+n>o&&(o=32*t+n)}}}return o<i||a<s?null:Int32Array.from([i,s,o-i+1,a-s+1])}getTopLeftOnBit(){const t=this.rowSize,e=this.bits;let n=0;while(n<e.length&&0===e[n])n++;if(n===e.length)return null;const r=n/t;let i=n%t*32;const s=e[n];let o=0;while(0===(s<<31-o&4294967295))o++;return i+=o,Int32Array.from([i,r])}getBottomRightOnBit(){const t=this.rowSize,e=this.bits;let n=e.length-1;while(n>=0&&0===e[n])n--;if(n<0)return null;const r=Math.floor(n/t);let i=32*Math.floor(n%t);const s=e[n];let o=31;while(s>>>o===0)o--;return i+=o,Int32Array.from([i,r])}getWidth(){return this.width}getHeight(){return this.height}getRowSize(){return this.rowSize}equals(t){if(!(t instanceof R))return!1;const e=t;return this.width===e.width&&this.height===e.height&&this.rowSize===e.rowSize&&w.equals(this.bits,e.bits)}hashCode(){let t=this.width;return t=31*t+this.width,t=31*t+this.height,t=31*t+this.rowSize,t=31*t+w.hashCode(this.bits),t}toString(t="X ",e="  ",n="\n"){return this.buildToString(t,e,n)}buildToString(t,e,n){let r=new k;for(let i=0,s=this.height;i<s;i++){for(let n=0,s=this.width;n<s;n++)r.append(this.get(n,i)?t:e);r.append(n)}return r.toString()}clone(){return new R(this.width,this.height,this.rowSize,this.bits.slice())}}class N extends l{static getNotFoundInstance(){return new N}}N.kind="NotFoundException";class D extends p{constructor(t){super(t),this.luminances=D.EMPTY,this.buckets=new Int32Array(D.LUMINANCE_BUCKETS)}getBlackRow(t,e){const n=this.getLuminanceSource(),r=n.getWidth();void 0===e||null===e||e.getSize()<r?e=new v(r):e.clear(),this.initArrays(r);const i=n.getRow(t,this.luminances),s=this.buckets;for(let a=0;a<r;a++)s[(255&i[a])>>D.LUMINANCE_SHIFT]++;const o=D.estimateBlackPoint(s);if(r<3)for(let a=0;a<r;a++)(255&i[a])<o&&e.set(a);else{let t=255&i[0],n=255&i[1];for(let s=1;s<r-1;s++){const r=255&i[s+1];(4*n-t-r)/2<o&&e.set(s),t=n,n=r}}return e}getBlackMatrix(){const t=this.getLuminanceSource(),e=t.getWidth(),n=t.getHeight(),r=new R(e,n);this.initArrays(e);const i=this.buckets;for(let a=1;a<5;a++){const r=Math.floor(n*a/5),s=t.getRow(r,this.luminances),o=Math.floor(4*e/5);for(let t=Math.floor(e/5);t<o;t++){const e=255&s[t];i[e>>D.LUMINANCE_SHIFT]++}}const s=D.estimateBlackPoint(i),o=t.getMatrix();for(let a=0;a<n;a++){const t=a*e;for(let n=0;n<e;n++){const e=255&o[t+n];e<s&&r.set(n,a)}}return r}createBinarizer(t){return new D(t)}initArrays(t){this.luminances.length<t&&(this.luminances=new Uint8ClampedArray(t));const e=this.buckets;for(let n=0;n<D.LUMINANCE_BUCKETS;n++)e[n]=0}static estimateBlackPoint(t){const e=t.length;let n=0,r=0,i=0;for(let l=0;l<e;l++)t[l]>i&&(r=l,i=t[l]),t[l]>n&&(n=t[l]);let s=0,o=0;for(let l=0;l<e;l++){const e=l-r,n=t[l]*e*e;n>o&&(s=l,o=n)}if(r>s){const t=r;r=s,s=t}if(s-r<=e/16)throw new N;let a=s-1,c=-1;for(let l=s-1;l>r;l--){const e=l-r,i=e*e*(s-l)*(n-t[l]);i>c&&(a=l,c=i)}return a<<D.LUMINANCE_SHIFT}}D.LUMINANCE_BITS=5,D.LUMINANCE_SHIFT=8-D.LUMINANCE_BITS,D.LUMINANCE_BUCKETS=1<<D.LUMINANCE_BITS,D.EMPTY=Uint8ClampedArray.from([0]);class O extends D{constructor(t){super(t),this.matrix=null}getBlackMatrix(){if(null!==this.matrix)return this.matrix;const t=this.getLuminanceSource(),e=t.getWidth(),n=t.getHeight();if(e>=O.MINIMUM_DIMENSION&&n>=O.MINIMUM_DIMENSION){const r=t.getMatrix();let i=e>>O.BLOCK_SIZE_POWER;0!==(e&O.BLOCK_SIZE_MASK)&&i++;let s=n>>O.BLOCK_SIZE_POWER;0!==(n&O.BLOCK_SIZE_MASK)&&s++;const o=O.calculateBlackPoints(r,i,s,e,n),a=new R(e,n);O.calculateThresholdForBlock(r,i,s,e,n,o,a),this.matrix=a}else this.matrix=super.getBlackMatrix();return this.matrix}createBinarizer(t){return new O(t)}static calculateThresholdForBlock(t,e,n,r,i,s,o){const a=i-O.BLOCK_SIZE,c=r-O.BLOCK_SIZE;for(let l=0;l<n;l++){let i=l<<O.BLOCK_SIZE_POWER;i>a&&(i=a);const u=O.cap(l,2,n-3);for(let n=0;n<e;n++){let a=n<<O.BLOCK_SIZE_POWER;a>c&&(a=c);const l=O.cap(n,2,e-3);let h=0;for(let t=-2;t<=2;t++){const e=s[u+t];h+=e[l-2]+e[l-1]+e[l]+e[l+1]+e[l+2]}const d=h/25;O.thresholdBlock(t,a,i,d,r,o)}}}static cap(t,e,n){return t<e?e:t>n?n:t}static thresholdBlock(t,e,n,r,i,s){for(let o=0,a=n*i+e;o<O.BLOCK_SIZE;o++,a+=i)for(let i=0;i<O.BLOCK_SIZE;i++)(255&t[a+i])<=r&&s.set(e+i,n+o)}static calculateBlackPoints(t,e,n,r,i){const s=i-O.BLOCK_SIZE,o=r-O.BLOCK_SIZE,a=new Array(n);for(let c=0;c<n;c++){a[c]=new Int32Array(e);let n=c<<O.BLOCK_SIZE_POWER;n>s&&(n=s);for(let i=0;i<e;i++){let e=i<<O.BLOCK_SIZE_POWER;e>o&&(e=o);let s=0,l=255,u=0;for(let i=0,o=n*r+e;i<O.BLOCK_SIZE;i++,o+=r){for(let e=0;e<O.BLOCK_SIZE;e++){const n=255&t[o+e];s+=n,n<l&&(l=n),n>u&&(u=n)}if(u-l>O.MIN_DYNAMIC_RANGE)for(i++,o+=r;i<O.BLOCK_SIZE;i++,o+=r)for(let e=0;e<O.BLOCK_SIZE;e++)s+=255&t[o+e]}let h=s>>2*O.BLOCK_SIZE_POWER;if(u-l<=O.MIN_DYNAMIC_RANGE&&(h=l/2,c>0&&i>0)){const t=(a[c-1][i]+2*a[c][i-1]+a[c-1][i-1])/4;l<t&&(h=t)}a[c][i]=h}}return a}}O.BLOCK_SIZE_POWER=3,O.BLOCK_SIZE=1<<O.BLOCK_SIZE_POWER,O.BLOCK_SIZE_MASK=O.BLOCK_SIZE-1,O.MINIMUM_DIMENSION=5*O.BLOCK_SIZE,O.MIN_DYNAMIC_RANGE=24;class P{constructor(t,e){this.width=t,this.height=e}getWidth(){return this.width}getHeight(){return this.height}isCropSupported(){return!1}crop(t,e,n,r){throw new C("This luminance source does not support cropping.")}isRotateSupported(){return!1}rotateCounterClockwise(){throw new C("This luminance source does not support rotation by 90 degrees.")}rotateCounterClockwise45(){throw new C("This luminance source does not support rotation by 45 degrees.")}toString(){const t=new Uint8ClampedArray(this.width);let e=new k;for(let n=0;n<this.height;n++){const r=this.getRow(n,t);for(let t=0;t<this.width;t++){const n=255&r[t];let i;i=n<64?"#":n<128?"+":n<192?".":" ",e.append(i)}e.append("\n")}return e.toString()}}class x extends P{constructor(t){super(t.getWidth(),t.getHeight()),this.delegate=t}getRow(t,e){const n=this.delegate.getRow(t,e),r=this.getWidth();for(let i=0;i<r;i++)n[i]=255-(255&n[i]);return n}getMatrix(){const t=this.delegate.getMatrix(),e=this.getWidth()*this.getHeight(),n=new Uint8ClampedArray(e);for(let r=0;r<e;r++)n[r]=255-(255&t[r]);return n}isCropSupported(){return this.delegate.isCropSupported()}crop(t,e,n,r){return new x(this.delegate.crop(t,e,n,r))}isRotateSupported(){return this.delegate.isRotateSupported()}invert(){return this.delegate}rotateCounterClockwise(){return new x(this.delegate.rotateCounterClockwise())}rotateCounterClockwise45(){return new x(this.delegate.rotateCounterClockwise45())}}class M extends P{constructor(t){super(t.width,t.height),this.canvas=t,this.tempCanvasElement=null,this.buffer=M.makeBufferFromCanvasImageData(t)}static makeBufferFromCanvasImageData(t){const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return M.toGrayscaleBuffer(e.data,t.width,t.height)}static toGrayscaleBuffer(t,e,n){const r=new Uint8ClampedArray(e*n);for(let i=0,s=0,o=t.length;i<o;i+=4,s++){let e;const n=t[i+3];if(0===n)e=255;else{const n=t[i],r=t[i+1],s=t[i+2];e=306*n+601*r+117*s+512>>10}r[s]=e}return r}getRow(t,e){if(t<0||t>=this.getHeight())throw new h("Requested row is outside the image: "+t);const n=this.getWidth(),r=t*n;return null===e?e=this.buffer.slice(r,r+n):(e.length<n&&(e=new Uint8ClampedArray(n)),e.set(this.buffer.slice(r,r+n))),e}getMatrix(){return this.buffer}isCropSupported(){return!0}crop(t,e,n,r){return super.crop(t,e,n,r),this}isRotateSupported(){return!0}rotateCounterClockwise(){return this.rotate(-90),this}rotateCounterClockwise45(){return this.rotate(-45),this}getTempCanvasElement(){if(null===this.tempCanvasElement){const t=this.canvas.ownerDocument.createElement("canvas");t.width=this.canvas.width,t.height=this.canvas.height,this.tempCanvasElement=t}return this.tempCanvasElement}rotate(t){const e=this.getTempCanvasElement(),n=e.getContext("2d"),r=t*M.DEGREE_TO_RADIANS,i=this.canvas.width,s=this.canvas.height,o=Math.ceil(Math.abs(Math.cos(r))*i+Math.abs(Math.sin(r))*s),a=Math.ceil(Math.abs(Math.sin(r))*i+Math.abs(Math.cos(r))*s);return e.width=o,e.height=a,n.translate(o/2,a/2),n.rotate(r),n.drawImage(this.canvas,i/-2,s/-2),this.buffer=M.makeBufferFromCanvasImageData(e),this}invert(){return new x(this)}}M.DEGREE_TO_RADIANS=Math.PI/180;class L{constructor(t,e,n){this.deviceId=t,this.label=e,this.kind="videoinput",this.groupId=n||void 0}toJSON(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}}}var B,U=(globalThis||n.g||self||window?(globalThis||n.g||self||window||void 0).__awaiter:void 0)||function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,s){function o(t){try{c(r.next(t))}catch(e){s(e)}}function a(t){try{c(r["throw"](t))}catch(e){s(e)}}function c(t){t.done?n(t.value):i(t.value).then(o,a)}c((r=r.apply(t,e||[])).next())}))};class F{constructor(t,e=500,n){this.reader=t,this.timeBetweenScansMillis=e,this._hints=n,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}get hasNavigator(){return"undefined"!==typeof navigator}get isMediaDevicesSuported(){return this.hasNavigator&&!!navigator.mediaDevices}get canEnumerateDevices(){return!(!this.isMediaDevicesSuported||!navigator.mediaDevices.enumerateDevices)}get timeBetweenDecodingAttempts(){return this._timeBetweenDecodingAttempts}set timeBetweenDecodingAttempts(t){this._timeBetweenDecodingAttempts=t<0?0:t}set hints(t){this._hints=t||null}get hints(){return this._hints}listVideoInputDevices(){return U(this,void 0,void 0,(function*(){if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");const t=yield navigator.mediaDevices.enumerateDevices(),e=[];for(const n of t){const t="video"===n.kind?"videoinput":n.kind;if("videoinput"!==t)continue;const r=n.deviceId||n.id,i=n.label||`Video device ${e.length+1}`,s=n.groupId,o={deviceId:r,label:i,kind:t,groupId:s};e.push(o)}return e}))}getVideoInputDevices(){return U(this,void 0,void 0,(function*(){const t=yield this.listVideoInputDevices();return t.map((t=>new L(t.deviceId,t.label)))}))}findDeviceById(t){return U(this,void 0,void 0,(function*(){const e=yield this.listVideoInputDevices();return e?e.find((e=>e.deviceId===t)):null}))}decodeFromInputVideoDevice(t,e){return U(this,void 0,void 0,(function*(){return yield this.decodeOnceFromVideoDevice(t,e)}))}decodeOnceFromVideoDevice(t,e){return U(this,void 0,void 0,(function*(){let n;this.reset(),n=t?{deviceId:{exact:t}}:{facingMode:"environment"};const r={video:n};return yield this.decodeOnceFromConstraints(r,e)}))}decodeOnceFromConstraints(t,e){return U(this,void 0,void 0,(function*(){const n=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeOnceFromStream(n,e)}))}decodeOnceFromStream(t,e){return U(this,void 0,void 0,(function*(){this.reset();const n=yield this.attachStreamToVideo(t,e),r=yield this.decodeOnce(n);return r}))}decodeFromInputVideoDeviceContinuously(t,e,n){return U(this,void 0,void 0,(function*(){return yield this.decodeFromVideoDevice(t,e,n)}))}decodeFromVideoDevice(t,e,n){return U(this,void 0,void 0,(function*(){let r;r=t?{deviceId:{exact:t}}:{facingMode:"environment"};const i={video:r};return yield this.decodeFromConstraints(i,e,n)}))}decodeFromConstraints(t,e,n){return U(this,void 0,void 0,(function*(){const r=yield navigator.mediaDevices.getUserMedia(t);return yield this.decodeFromStream(r,e,n)}))}decodeFromStream(t,e,n){return U(this,void 0,void 0,(function*(){this.reset();const r=yield this.attachStreamToVideo(t,e);return yield this.decodeContinuously(r,n)}))}stopAsyncDecode(){this._stopAsyncDecode=!0}stopContinuousDecode(){this._stopContinuousDecode=!0}attachStreamToVideo(t,e){return U(this,void 0,void 0,(function*(){const n=this.prepareVideoElement(e);return this.addVideoSource(n,t),this.videoElement=n,this.stream=t,yield this.playVideoOnLoadAsync(n),n}))}playVideoOnLoadAsync(t){return new Promise(((e,n)=>this.playVideoOnLoad(t,(()=>e()))))}playVideoOnLoad(t,e){this.videoEndedListener=()=>this.stopStreams(),this.videoCanPlayListener=()=>this.tryPlayVideo(t),t.addEventListener("ended",this.videoEndedListener),t.addEventListener("canplay",this.videoCanPlayListener),t.addEventListener("playing",e),this.tryPlayVideo(t)}isVideoPlaying(t){return t.currentTime>0&&!t.paused&&!t.ended&&t.readyState>2}tryPlayVideo(t){return U(this,void 0,void 0,(function*(){if(this.isVideoPlaying(t))console.warn("Trying to play video that is already playing.");else try{yield t.play()}catch(e){console.warn("It was not possible to play the video.")}}))}getMediaElement(t,e){const n=document.getElementById(t);if(!n)throw new u(`element with id '${t}' not found`);if(n.nodeName.toLowerCase()!==e.toLowerCase())throw new u(`element with id '${t}' must be an ${e} element`);return n}decodeFromImage(t,e){if(!t&&!e)throw new u("either imageElement with a src set or an url must be provided");return e&&!t?this.decodeFromImageUrl(e):this.decodeFromImageElement(t)}decodeFromVideo(t,e){if(!t&&!e)throw new u("Either an element with a src set or an URL must be provided");return e&&!t?this.decodeFromVideoUrl(e):this.decodeFromVideoElement(t)}decodeFromVideoContinuously(t,e,n){if(void 0===t&&void 0===e)throw new u("Either an element with a src set or an URL must be provided");return e&&!t?this.decodeFromVideoUrlContinuously(e,n):this.decodeFromVideoElementContinuously(t,n)}decodeFromImageElement(t){if(!t)throw new u("An image element must be provided.");this.reset();const e=this.prepareImageElement(t);let n;return this.imageElement=e,n=this.isImageLoaded(e)?this.decodeOnce(e,!1,!0):this._decodeOnLoadImage(e),n}decodeFromVideoElement(t){const e=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideo(e)}decodeFromVideoElementContinuously(t,e){const n=this._decodeFromVideoElementSetup(t);return this._decodeOnLoadVideoContinuously(n,e)}_decodeFromVideoElementSetup(t){if(!t)throw new u("A video element must be provided.");this.reset();const e=this.prepareVideoElement(t);return this.videoElement=e,e}decodeFromImageUrl(t){if(!t)throw new u("An URL must be provided.");this.reset();const e=this.prepareImageElement();this.imageElement=e;const n=this._decodeOnLoadImage(e);return e.src=t,n}decodeFromVideoUrl(t){if(!t)throw new u("An URL must be provided.");this.reset();const e=this.prepareVideoElement(),n=this.decodeFromVideoElement(e);return e.src=t,n}decodeFromVideoUrlContinuously(t,e){if(!t)throw new u("An URL must be provided.");this.reset();const n=this.prepareVideoElement(),r=this.decodeFromVideoElementContinuously(n,e);return n.src=t,r}_decodeOnLoadImage(t){return new Promise(((e,n)=>{this.imageLoadedListener=()=>this.decodeOnce(t,!1,!0).then(e,n),t.addEventListener("load",this.imageLoadedListener)}))}_decodeOnLoadVideo(t){return U(this,void 0,void 0,(function*(){return yield this.playVideoOnLoadAsync(t),yield this.decodeOnce(t)}))}_decodeOnLoadVideoContinuously(t,e){return U(this,void 0,void 0,(function*(){yield this.playVideoOnLoadAsync(t),this.decodeContinuously(t,e)}))}isImageLoaded(t){return!!t.complete&&0!==t.naturalWidth}prepareImageElement(t){let e;return"undefined"===typeof t&&(e=document.createElement("img"),e.width=200,e.height=200),"string"===typeof t&&(e=this.getMediaElement(t,"img")),t instanceof HTMLImageElement&&(e=t),e}prepareVideoElement(t){let e;return t||"undefined"===typeof document||(e=document.createElement("video"),e.width=200,e.height=200),"string"===typeof t&&(e=this.getMediaElement(t,"video")),t instanceof HTMLVideoElement&&(e=t),e.setAttribute("autoplay","true"),e.setAttribute("muted","true"),e.setAttribute("playsinline","true"),e}decodeOnce(t,e=!0,n=!0){this._stopAsyncDecode=!1;const r=(i,s)=>{if(this._stopAsyncDecode)return s(new N("Video stream has ended before any code could be detected.")),void(this._stopAsyncDecode=void 0);try{const e=this.decode(t);i(e)}catch(o){const t=e&&o instanceof N,a=o instanceof f||o instanceof S,c=a&&n;if(t||c)return setTimeout(r,this._timeBetweenDecodingAttempts,i,s);s(o)}};return new Promise(((t,e)=>r(t,e)))}decodeContinuously(t,e){this._stopContinuousDecode=!1;const n=()=>{if(this._stopContinuousDecode)this._stopContinuousDecode=void 0;else try{const r=this.decode(t);e(r,null),setTimeout(n,this.timeBetweenScansMillis)}catch(r){e(null,r);const t=r instanceof f||r instanceof S,i=r instanceof N;(t||i)&&setTimeout(n,this._timeBetweenDecodingAttempts)}};n()}decode(t){const e=this.createBinaryBitmap(t);return this.decodeBitmap(e)}_isHTMLVideoElement(t){const e=t;return 0!==e.videoWidth}drawFrameOnCanvas(t,e,n){e||(e={sx:0,sy:0,sWidth:t.videoWidth,sHeight:t.videoHeight,dx:0,dy:0,dWidth:t.videoWidth,dHeight:t.videoHeight}),n||(n=this.captureCanvasContext),n.drawImage(t,e.sx,e.sy,e.sWidth,e.sHeight,e.dx,e.dy,e.dWidth,e.dHeight)}drawImageOnCanvas(t,e,n=this.captureCanvasContext){e||(e={sx:0,sy:0,sWidth:t.naturalWidth,sHeight:t.naturalHeight,dx:0,dy:0,dWidth:t.naturalWidth,dHeight:t.naturalHeight}),n||(n=this.captureCanvasContext),n.drawImage(t,e.sx,e.sy,e.sWidth,e.sHeight,e.dx,e.dy,e.dWidth,e.dHeight)}createBinaryBitmap(t){this.getCaptureCanvasContext(t);this._isHTMLVideoElement(t)?this.drawFrameOnCanvas(t):this.drawImageOnCanvas(t);const e=this.getCaptureCanvas(t),n=new M(e),r=new O(n);return new d(r)}getCaptureCanvasContext(t){if(!this.captureCanvasContext){const e=this.getCaptureCanvas(t),n=e.getContext("2d");this.captureCanvasContext=n}return this.captureCanvasContext}getCaptureCanvas(t){if(!this.captureCanvas){const e=this.createCaptureCanvas(t);this.captureCanvas=e}return this.captureCanvas}decodeBitmap(t){return this.reader.decode(t,this._hints)}createCaptureCanvas(t){if("undefined"===typeof document)return this._destroyCaptureCanvas(),null;const e=document.createElement("canvas");let n,r;return"undefined"!==typeof t&&(t instanceof HTMLVideoElement?(n=t.videoWidth,r=t.videoHeight):t instanceof HTMLImageElement&&(n=t.naturalWidth||t.width,r=t.naturalHeight||t.height)),e.style.width=n+"px",e.style.height=r+"px",e.width=n,e.height=r,e}stopStreams(){this.stream&&(this.stream.getVideoTracks().forEach((t=>t.stop())),this.stream=void 0),!1===this._stopAsyncDecode&&this.stopAsyncDecode(),!1===this._stopContinuousDecode&&this.stopContinuousDecode()}reset(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()}_destroyVideoElement(){this.videoElement&&("undefined"!==typeof this.videoEndedListener&&this.videoElement.removeEventListener("ended",this.videoEndedListener),"undefined"!==typeof this.videoPlayingEventListener&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),"undefined"!==typeof this.videoCanPlayListener&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)}_destroyImageElement(){this.imageElement&&(void 0!==this.imageLoadedListener&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)}_destroyCaptureCanvas(){this.captureCanvasContext=void 0,this.captureCanvas=void 0}addVideoSource(t,e){try{t.srcObject=e}catch(n){t.src=URL.createObjectURL(e)}}cleanVideoSource(t){try{t.srcObject=null}catch(e){t.src=""}this.videoElement.removeAttribute("src")}}class z{constructor(t,e,n=(null==e?0:8*e.length),r,i,s=g.currentTimeMillis()){this.text=t,this.rawBytes=e,this.numBits=n,this.resultPoints=r,this.format=i,this.timestamp=s,this.text=t,this.rawBytes=e,this.numBits=void 0===n||null===n?null===e||void 0===e?0:8*e.length:n,this.resultPoints=r,this.format=i,this.resultMetadata=null,this.timestamp=void 0===s||null===s?g.currentTimeMillis():s}getText(){return this.text}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}getResultPoints(){return this.resultPoints}getBarcodeFormat(){return this.format}getResultMetadata(){return this.resultMetadata}putMetadata(t,e){null===this.resultMetadata&&(this.resultMetadata=new Map),this.resultMetadata.set(t,e)}putAllMetadata(t){null!==t&&(null===this.resultMetadata?this.resultMetadata=t:this.resultMetadata=new Map(t))}addResultPoints(t){const e=this.resultPoints;if(null===e)this.resultPoints=t;else if(null!==t&&t.length>0){const n=new Array(e.length+t.length);g.arraycopy(e,0,n,0,e.length),g.arraycopy(t,0,n,e.length,t.length),this.resultPoints=n}}getTimestamp(){return this.timestamp}toString(){return this.text}}(function(t){t[t["AZTEC"]=0]="AZTEC",t[t["CODABAR"]=1]="CODABAR",t[t["CODE_39"]=2]="CODE_39",t[t["CODE_93"]=3]="CODE_93",t[t["CODE_128"]=4]="CODE_128",t[t["DATA_MATRIX"]=5]="DATA_MATRIX",t[t["EAN_8"]=6]="EAN_8",t[t["EAN_13"]=7]="EAN_13",t[t["ITF"]=8]="ITF",t[t["MAXICODE"]=9]="MAXICODE",t[t["PDF_417"]=10]="PDF_417",t[t["QR_CODE"]=11]="QR_CODE",t[t["RSS_14"]=12]="RSS_14",t[t["RSS_EXPANDED"]=13]="RSS_EXPANDED",t[t["UPC_A"]=14]="UPC_A",t[t["UPC_E"]=15]="UPC_E",t[t["UPC_EAN_EXTENSION"]=16]="UPC_EAN_EXTENSION"})(B||(B={}));var V,j=B;(function(t){t[t["OTHER"]=0]="OTHER",t[t["ORIENTATION"]=1]="ORIENTATION",t[t["BYTE_SEGMENTS"]=2]="BYTE_SEGMENTS",t[t["ERROR_CORRECTION_LEVEL"]=3]="ERROR_CORRECTION_LEVEL",t[t["ISSUE_NUMBER"]=4]="ISSUE_NUMBER",t[t["SUGGESTED_PRICE"]=5]="SUGGESTED_PRICE",t[t["POSSIBLE_COUNTRY"]=6]="POSSIBLE_COUNTRY",t[t["UPC_EAN_EXTENSION"]=7]="UPC_EAN_EXTENSION",t[t["PDF417_EXTRA_METADATA"]=8]="PDF417_EXTRA_METADATA",t[t["STRUCTURED_APPEND_SEQUENCE"]=9]="STRUCTURED_APPEND_SEQUENCE",t[t["STRUCTURED_APPEND_PARITY"]=10]="STRUCTURED_APPEND_PARITY"})(V||(V={}));var H,$,K,G,q,W,Y=V;class X{constructor(t,e,n,r,i=-1,s=-1){this.rawBytes=t,this.text=e,this.byteSegments=n,this.ecLevel=r,this.structuredAppendSequenceNumber=i,this.structuredAppendParity=s,this.numBits=void 0===t||null===t?0:8*t.length}getRawBytes(){return this.rawBytes}getNumBits(){return this.numBits}setNumBits(t){this.numBits=t}getText(){return this.text}getByteSegments(){return this.byteSegments}getECLevel(){return this.ecLevel}getErrorsCorrected(){return this.errorsCorrected}setErrorsCorrected(t){this.errorsCorrected=t}getErasures(){return this.erasures}setErasures(t){this.erasures=t}getOther(){return this.other}setOther(t){this.other=t}hasStructuredAppend(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0}getStructuredAppendParity(){return this.structuredAppendParity}getStructuredAppendSequenceNumber(){return this.structuredAppendSequenceNumber}}class Q{exp(t){return this.expTable[t]}log(t){if(0===t)throw new h;return this.logTable[t]}static addOrSubtract(t,e){return t^e}}class J{constructor(t,e){if(0===e.length)throw new h;this.field=t;const n=e.length;if(n>1&&0===e[0]){let t=1;while(t<n&&0===e[t])t++;t===n?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(n-t),g.arraycopy(e,t,this.coefficients,0,this.coefficients.length))}else this.coefficients=e}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(0===t)return this.getCoefficient(0);const e=this.coefficients;let n;if(1===t){n=0;for(let t=0,r=e.length;t!==r;t++){const r=e[t];n=Q.addOrSubtract(n,r)}return n}n=e[0];const r=e.length,i=this.field;for(let s=1;s<r;s++)n=Q.addOrSubtract(i.multiply(t,n),e[s]);return n}addOrSubtract(t){if(!this.field.equals(t.field))throw new h("GenericGFPolys do not have same GenericGF field");if(this.isZero())return t;if(t.isZero())return this;let e=this.coefficients,n=t.coefficients;if(e.length>n.length){const t=e;e=n,n=t}let r=new Int32Array(n.length);const i=n.length-e.length;g.arraycopy(n,0,r,0,i);for(let s=i;s<n.length;s++)r[s]=Q.addOrSubtract(e[s-i],n[s]);return new J(this.field,r)}multiply(t){if(!this.field.equals(t.field))throw new h("GenericGFPolys do not have same GenericGF field");if(this.isZero()||t.isZero())return this.field.getZero();const e=this.coefficients,n=e.length,r=t.coefficients,i=r.length,s=new Int32Array(n+i-1),o=this.field;for(let a=0;a<n;a++){const t=e[a];for(let e=0;e<i;e++)s[a+e]=Q.addOrSubtract(s[a+e],o.multiply(t,r[e]))}return new J(o,s)}multiplyScalar(t){if(0===t)return this.field.getZero();if(1===t)return this;const e=this.coefficients.length,n=this.field,r=new Int32Array(e),i=this.coefficients;for(let s=0;s<e;s++)r[s]=n.multiply(i[s],t);return new J(n,r)}multiplyByMonomial(t,e){if(t<0)throw new h;if(0===e)return this.field.getZero();const n=this.coefficients,r=n.length,i=new Int32Array(r+t),s=this.field;for(let o=0;o<r;o++)i[o]=s.multiply(n[o],e);return new J(s,i)}divide(t){if(!this.field.equals(t.field))throw new h("GenericGFPolys do not have same GenericGF field");if(t.isZero())throw new h("Divide by 0");const e=this.field;let n=e.getZero(),r=this;const i=t.getCoefficient(t.getDegree()),s=e.inverse(i);while(r.getDegree()>=t.getDegree()&&!r.isZero()){const i=r.getDegree()-t.getDegree(),o=e.multiply(r.getCoefficient(r.getDegree()),s),a=t.multiplyByMonomial(i,o),c=e.buildMonomial(i,o);n=n.addOrSubtract(c),r=r.addOrSubtract(a)}return[n,r]}toString(){let t="";for(let e=this.getDegree();e>=0;e--){let n=this.getCoefficient(e);if(0!==n){if(n<0?(t+=" - ",n=-n):t.length>0&&(t+=" + "),0===e||1!==n){const e=this.field.log(n);0===e?t+="1":1===e?t+="a":(t+="a^",t+=e)}0!==e&&(1===e?t+="x":(t+="x^",t+=e))}}return t}}class Z extends l{}Z.kind="ArithmeticException";class tt extends Q{constructor(t,e,n){super(),this.primitive=t,this.size=e,this.generatorBase=n;const r=new Int32Array(e);let i=1;for(let o=0;o<e;o++)r[o]=i,i*=2,i>=e&&(i^=t,i&=e-1);this.expTable=r;const s=new Int32Array(e);for(let o=0;o<e-1;o++)s[r[o]]=o;this.logTable=s,this.zero=new J(this,Int32Array.from([0])),this.one=new J(this,Int32Array.from([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,e){if(t<0)throw new h;if(0===e)return this.zero;const n=new Int32Array(t+1);return n[0]=e,new J(this,n)}inverse(t){if(0===t)throw new Z;return this.expTable[this.size-this.logTable[t]-1]}multiply(t,e){return 0===t||0===e?0:this.expTable[(this.logTable[t]+this.logTable[e])%(this.size-1)]}getSize(){return this.size}getGeneratorBase(){return this.generatorBase}toString(){return"GF(0x"+b.toHexString(this.primitive)+","+this.size+")"}equals(t){return t===this}}tt.AZTEC_DATA_12=new tt(4201,4096,1),tt.AZTEC_DATA_10=new tt(1033,1024,1),tt.AZTEC_DATA_6=new tt(67,64,1),tt.AZTEC_PARAM=new tt(19,16,1),tt.QR_CODE_FIELD_256=new tt(285,256,0),tt.DATA_MATRIX_FIELD_256=new tt(301,256,1),tt.AZTEC_DATA_8=tt.DATA_MATRIX_FIELD_256,tt.MAXICODE_FIELD_64=tt.AZTEC_DATA_6;class et extends l{}et.kind="ReedSolomonException";class nt extends l{}nt.kind="IllegalStateException";class rt{constructor(t){this.field=t}decode(t,e){const n=this.field,r=new J(n,t),i=new Int32Array(e);let s=!0;for(let d=0;d<e;d++){const t=r.evaluateAt(n.exp(d+n.getGeneratorBase()));i[i.length-1-d]=t,0!==t&&(s=!1)}if(s)return;const o=new J(n,i),a=this.runEuclideanAlgorithm(n.buildMonomial(e,1),o,e),c=a[0],l=a[1],u=this.findErrorLocations(c),h=this.findErrorMagnitudes(l,u);for(let d=0;d<u.length;d++){const e=t.length-1-n.log(u[d]);if(e<0)throw new et("Bad error location");t[e]=tt.addOrSubtract(t[e],h[d])}}runEuclideanAlgorithm(t,e,n){if(t.getDegree()<e.getDegree()){const n=t;t=e,e=n}const r=this.field;let i=t,s=e,o=r.getZero(),a=r.getOne();while(s.getDegree()>=(n/2|0)){let t=i,e=o;if(i=s,o=a,i.isZero())throw new et("r_{i-1} was zero");s=t;let n=r.getZero();const c=i.getCoefficient(i.getDegree()),l=r.inverse(c);while(s.getDegree()>=i.getDegree()&&!s.isZero()){const t=s.getDegree()-i.getDegree(),e=r.multiply(s.getCoefficient(s.getDegree()),l);n=n.addOrSubtract(r.buildMonomial(t,e)),s=s.addOrSubtract(i.multiplyByMonomial(t,e))}if(a=n.multiply(o).addOrSubtract(e),s.getDegree()>=i.getDegree())throw new nt("Division algorithm failed to reduce polynomial?")}const c=a.getCoefficient(0);if(0===c)throw new et("sigmaTilde(0) was zero");const l=r.inverse(c),u=a.multiplyScalar(l),h=s.multiplyScalar(l);return[u,h]}findErrorLocations(t){const e=t.getDegree();if(1===e)return Int32Array.from([t.getCoefficient(1)]);const n=new Int32Array(e);let r=0;const i=this.field;for(let s=1;s<i.getSize()&&r<e;s++)0===t.evaluateAt(s)&&(n[r]=i.inverse(s),r++);if(r!==e)throw new et("Error locator degree does not match number of roots");return n}findErrorMagnitudes(t,e){const n=e.length,r=new Int32Array(n),i=this.field;for(let s=0;s<n;s++){const o=i.inverse(e[s]);let a=1;for(let t=0;t<n;t++)if(s!==t){const n=i.multiply(e[t],o),r=0===(1&n)?1|n:-2&n;a=i.multiply(a,r)}r[s]=i.multiply(t.evaluateAt(o),i.inverse(a)),0!==i.getGeneratorBase()&&(r[s]=i.multiply(r[s],o))}return r}}(function(t){t[t["UPPER"]=0]="UPPER",t[t["LOWER"]=1]="LOWER",t[t["MIXED"]=2]="MIXED",t[t["DIGIT"]=3]="DIGIT",t[t["PUNCT"]=4]="PUNCT",t[t["BINARY"]=5]="BINARY"})(H||(H={}));class it{decode(t){this.ddata=t;let e=t.getBits(),n=this.extractBits(e),r=this.correctBits(n),i=it.convertBoolArrayToByteArray(r),s=it.getEncodedData(r),o=new X(i,s,null,null);return o.setNumBits(r.length),o}static highLevelDecode(t){return this.getEncodedData(t)}static getEncodedData(t){let e=t.length,n=H.UPPER,r=H.UPPER,i="",s=0;while(s<e)if(r===H.BINARY){if(e-s<5)break;let o=it.readCode(t,s,5);if(s+=5,0===o){if(e-s<11)break;o=it.readCode(t,s,11)+31,s+=11}for(let n=0;n<o;n++){if(e-s<8){s=e;break}const n=it.readCode(t,s,8);i+=T.castAsNonUtf8Char(n),s+=8}r=n}else{let o=r===H.DIGIT?4:5;if(e-s<o)break;let a=it.readCode(t,s,o);s+=o;let c=it.getCharacter(r,a);c.startsWith("CTRL_")?(n=r,r=it.getTable(c.charAt(5)),"L"===c.charAt(6)&&(n=r)):(i+=c,r=n)}return i}static getTable(t){switch(t){case"L":return H.LOWER;case"P":return H.PUNCT;case"M":return H.MIXED;case"D":return H.DIGIT;case"B":return H.BINARY;case"U":default:return H.UPPER}}static getCharacter(t,e){switch(t){case H.UPPER:return it.UPPER_TABLE[e];case H.LOWER:return it.LOWER_TABLE[e];case H.MIXED:return it.MIXED_TABLE[e];case H.PUNCT:return it.PUNCT_TABLE[e];case H.DIGIT:return it.DIGIT_TABLE[e];default:throw new nt("Bad table")}}correctBits(t){let e,n;this.ddata.getNbLayers()<=2?(n=6,e=tt.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(n=8,e=tt.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(n=10,e=tt.AZTEC_DATA_10):(n=12,e=tt.AZTEC_DATA_12);let r=this.ddata.getNbDatablocks(),i=t.length/n;if(i<r)throw new S;let s=t.length%n,o=new Int32Array(i);for(let d=0;d<i;d++,s+=n)o[d]=it.readCode(t,s,n);try{let t=new rt(e);t.decode(o,i-r)}catch(h){throw new S(h)}let a=(1<<n)-1,c=0;for(let d=0;d<r;d++){let t=o[d];if(0===t||t===a)throw new S;1!==t&&t!==a-1||c++}let l=new Array(r*n-c),u=0;for(let d=0;d<r;d++){let t=o[d];if(1===t||t===a-1)l.fill(t>1,u,u+n-1),u+=n-1;else for(let e=n-1;e>=0;--e)l[u++]=0!==(t&1<<e)}return l}extractBits(t){let e=this.ddata.isCompact(),n=this.ddata.getNbLayers(),r=(e?11:14)+4*n,i=new Int32Array(r),s=new Array(this.totalBitsInLayer(n,e));if(e)for(let o=0;o<i.length;o++)i[o]=o;else{let t=r+1+2*b.truncDivision(b.truncDivision(r,2)-1,15),e=r/2,n=b.truncDivision(t,2);for(let r=0;r<e;r++){let t=r+b.truncDivision(r,15);i[e-r-1]=n-t-1,i[e+r]=n+t+1}}for(let o=0,a=0;o<n;o++){let c=4*(n-o)+(e?9:12),l=2*o,u=r-1-l;for(let e=0;e<c;e++){let n=2*e;for(let r=0;r<2;r++)s[a+n+r]=t.get(i[l+r],i[l+e]),s[a+2*c+n+r]=t.get(i[l+e],i[u-r]),s[a+4*c+n+r]=t.get(i[u-r],i[u-e]),s[a+6*c+n+r]=t.get(i[u-e],i[l+r])}a+=8*c}return s}static readCode(t,e,n){let r=0;for(let i=e;i<e+n;i++)r<<=1,t[i]&&(r|=1);return r}static readByte(t,e){let n=t.length-e;return n>=8?it.readCode(t,e,8):it.readCode(t,e,n)<<8-n}static convertBoolArrayToByteArray(t){let e=new Uint8Array((t.length+7)/8);for(let n=0;n<e.length;n++)e[n]=it.readByte(t,8*n);return e}totalBitsInLayer(t,e){return((e?88:112)+16*t)*t}}it.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],it.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],it.MIXED_TABLE=["CTRL_PS"," ","\\1","\\2","\\3","\\4","\\5","\\6","\\7","\b","\t","\n","\\13","\f","\r","\\33","\\34","\\35","\\36","\\37","@","\\","^","_","`","|","~","\\177","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],it.PUNCT_TABLE=["","\r","\r\n",". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],it.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"];class st{constructor(){}static round(t){return NaN===t?0:t<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:t>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:t+(t<0?-.5:.5)|0}static distance(t,e,n,r){const i=t-n,s=e-r;return Math.sqrt(i*i+s*s)}static sum(t){let e=0;for(let n=0,r=t.length;n!==r;n++){const r=t[n];e+=r}return e}}class ot{static floatToIntBits(t){return t}}ot.MAX_VALUE=Number.MAX_SAFE_INTEGER;class at{constructor(t,e){this.x=t,this.y=e}getX(){return this.x}getY(){return this.y}equals(t){if(t instanceof at){const e=t;return this.x===e.x&&this.y===e.y}return!1}hashCode(){return 31*ot.floatToIntBits(this.x)+ot.floatToIntBits(this.y)}toString(){return"("+this.x+","+this.y+")"}static orderBestPatterns(t){const e=this.distance(t[0],t[1]),n=this.distance(t[1],t[2]),r=this.distance(t[0],t[2]);let i,s,o;if(n>=e&&n>=r?(s=t[0],i=t[1],o=t[2]):r>=n&&r>=e?(s=t[1],i=t[0],o=t[2]):(s=t[2],i=t[0],o=t[1]),this.crossProductZ(i,s,o)<0){const t=i;i=o,o=t}t[0]=i,t[1]=s,t[2]=o}static distance(t,e){return st.distance(t.x,t.y,e.x,e.y)}static crossProductZ(t,e,n){const r=e.x,i=e.y;return(n.x-r)*(t.y-i)-(n.y-i)*(t.x-r)}}class ct{constructor(t,e){this.bits=t,this.points=e}getBits(){return this.bits}getPoints(){return this.points}}class lt extends ct{constructor(t,e,n,r,i){super(t,e),this.compact=n,this.nbDatablocks=r,this.nbLayers=i}getNbLayers(){return this.nbLayers}getNbDatablocks(){return this.nbDatablocks}isCompact(){return this.compact}}class ut{constructor(t,e,n,r){this.image=t,this.height=t.getHeight(),this.width=t.getWidth(),void 0!==e&&null!==e||(e=ut.INIT_SIZE),void 0!==n&&null!==n||(n=t.getWidth()/2|0),void 0!==r&&null!==r||(r=t.getHeight()/2|0);const i=e/2|0;if(this.leftInit=n-i,this.rightInit=n+i,this.upInit=r-i,this.downInit=r+i,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new N}detect(){let t=this.leftInit,e=this.rightInit,n=this.upInit,r=this.downInit,i=!1,s=!0,o=!1,a=!1,c=!1,l=!1,u=!1;const h=this.width,d=this.height;while(s){s=!1;let f=!0;while((f||!a)&&e<h)f=this.containsBlackPoint(n,r,e,!1),f?(e++,s=!0,a=!0):a||e++;if(e>=h){i=!0;break}let p=!0;while((p||!c)&&r<d)p=this.containsBlackPoint(t,e,r,!0),p?(r++,s=!0,c=!0):c||r++;if(r>=d){i=!0;break}let g=!0;while((g||!l)&&t>=0)g=this.containsBlackPoint(n,r,t,!1),g?(t--,s=!0,l=!0):l||t--;if(t<0){i=!0;break}let m=!0;while((m||!u)&&n>=0)m=this.containsBlackPoint(t,e,n,!0),m?(n--,s=!0,u=!0):u||n--;if(n<0){i=!0;break}s&&(o=!0)}if(!i&&o){const i=e-t;let s=null;for(let e=1;null===s&&e<i;e++)s=this.getBlackPointOnSegment(t,r-e,t+e,r);if(null==s)throw new N;let o=null;for(let e=1;null===o&&e<i;e++)o=this.getBlackPointOnSegment(t,n+e,t+e,n);if(null==o)throw new N;let a=null;for(let t=1;null===a&&t<i;t++)a=this.getBlackPointOnSegment(e,n+t,e-t,n);if(null==a)throw new N;let c=null;for(let t=1;null===c&&t<i;t++)c=this.getBlackPointOnSegment(e,r-t,e-t,r);if(null==c)throw new N;return this.centerEdges(c,s,a,o)}throw new N}getBlackPointOnSegment(t,e,n,r){const i=st.round(st.distance(t,e,n,r)),s=(n-t)/i,o=(r-e)/i,a=this.image;for(let c=0;c<i;c++){const n=st.round(t+c*s),r=st.round(e+c*o);if(a.get(n,r))return new at(n,r)}return null}centerEdges(t,e,n,r){const i=t.getX(),s=t.getY(),o=e.getX(),a=e.getY(),c=n.getX(),l=n.getY(),u=r.getX(),h=r.getY(),d=ut.CORR;return i<this.width/2?[new at(u-d,h+d),new at(o+d,a+d),new at(c-d,l-d),new at(i+d,s-d)]:[new at(u+d,h+d),new at(o+d,a-d),new at(c-d,l+d),new at(i-d,s-d)]}containsBlackPoint(t,e,n,r){const i=this.image;if(r){for(let s=t;s<=e;s++)if(i.get(s,n))return!0}else for(let s=t;s<=e;s++)if(i.get(n,s))return!0;return!1}}ut.INIT_SIZE=10,ut.CORR=1;class ht{static checkAndNudgePoints(t,e){const n=t.getWidth(),r=t.getHeight();let i=!0;for(let s=0;s<e.length&&i;s+=2){const t=Math.floor(e[s]),o=Math.floor(e[s+1]);if(t<-1||t>n||o<-1||o>r)throw new N;i=!1,-1===t?(e[s]=0,i=!0):t===n&&(e[s]=n-1,i=!0),-1===o?(e[s+1]=0,i=!0):o===r&&(e[s+1]=r-1,i=!0)}i=!0;for(let s=e.length-2;s>=0&&i;s-=2){const t=Math.floor(e[s]),o=Math.floor(e[s+1]);if(t<-1||t>n||o<-1||o>r)throw new N;i=!1,-1===t?(e[s]=0,i=!0):t===n&&(e[s]=n-1,i=!0),-1===o?(e[s+1]=0,i=!0):o===r&&(e[s+1]=r-1,i=!0)}}}class dt{constructor(t,e,n,r,i,s,o,a,c){this.a11=t,this.a21=e,this.a31=n,this.a12=r,this.a22=i,this.a32=s,this.a13=o,this.a23=a,this.a33=c}static quadrilateralToQuadrilateral(t,e,n,r,i,s,o,a,c,l,u,h,d,f,p,g){const m=dt.quadrilateralToSquare(t,e,n,r,i,s,o,a),y=dt.squareToQuadrilateral(c,l,u,h,d,f,p,g);return y.times(m)}transformPoints(t){const e=t.length,n=this.a11,r=this.a12,i=this.a13,s=this.a21,o=this.a22,a=this.a23,c=this.a31,l=this.a32,u=this.a33;for(let h=0;h<e;h+=2){const e=t[h],d=t[h+1],f=i*e+a*d+u;t[h]=(n*e+s*d+c)/f,t[h+1]=(r*e+o*d+l)/f}}transformPointsWithValues(t,e){const n=this.a11,r=this.a12,i=this.a13,s=this.a21,o=this.a22,a=this.a23,c=this.a31,l=this.a32,u=this.a33,h=t.length;for(let d=0;d<h;d++){const h=t[d],f=e[d],p=i*h+a*f+u;t[d]=(n*h+s*f+c)/p,e[d]=(r*h+o*f+l)/p}}static squareToQuadrilateral(t,e,n,r,i,s,o,a){const c=t-n+i-o,l=e-r+s-a;if(0===c&&0===l)return new dt(n-t,i-n,t,r-e,s-r,e,0,0,1);{const u=n-i,h=o-i,d=r-s,f=a-s,p=u*f-h*d,g=(c*f-h*l)/p,m=(u*l-c*d)/p;return new dt(n-t+g*n,o-t+m*o,t,r-e+g*r,a-e+m*a,e,g,m,1)}}static quadrilateralToSquare(t,e,n,r,i,s,o,a){return dt.squareToQuadrilateral(t,e,n,r,i,s,o,a).buildAdjoint()}buildAdjoint(){return new dt(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)}times(t){return new dt(this.a11*t.a11+this.a21*t.a12+this.a31*t.a13,this.a11*t.a21+this.a21*t.a22+this.a31*t.a23,this.a11*t.a31+this.a21*t.a32+this.a31*t.a33,this.a12*t.a11+this.a22*t.a12+this.a32*t.a13,this.a12*t.a21+this.a22*t.a22+this.a32*t.a23,this.a12*t.a31+this.a22*t.a32+this.a32*t.a33,this.a13*t.a11+this.a23*t.a12+this.a33*t.a13,this.a13*t.a21+this.a23*t.a22+this.a33*t.a23,this.a13*t.a31+this.a23*t.a32+this.a33*t.a33)}}class ft extends ht{sampleGrid(t,e,n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,w){const b=dt.quadrilateralToQuadrilateral(r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,w);return this.sampleGridWithTransform(t,e,n,b)}sampleGridWithTransform(t,e,n,r){if(e<=0||n<=0)throw new N;const i=new R(e,n),s=new Float32Array(2*e);for(let a=0;a<n;a++){const e=s.length,n=a+.5;for(let t=0;t<e;t+=2)s[t]=t/2+.5,s[t+1]=n;r.transformPoints(s),ht.checkAndNudgePoints(t,s);try{for(let n=0;n<e;n+=2)t.get(Math.floor(s[n]),Math.floor(s[n+1]))&&i.set(n/2,a)}catch(o){throw new N}}return i}}class pt{static setGridSampler(t){pt.gridSampler=t}static getInstance(){return pt.gridSampler}}pt.gridSampler=new ft;class gt{constructor(t,e){this.x=t,this.y=e}toResultPoint(){return new at(this.getX(),this.getY())}getX(){return this.x}getY(){return this.y}}class mt{constructor(t){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=t}detect(){return this.detectMirror(!1)}detectMirror(t){let e=this.getMatrixCenter(),n=this.getBullsEyeCorners(e);if(t){let t=n[0];n[0]=n[2],n[2]=t}this.extractParameters(n);let r=this.sampleGrid(this.image,n[this.shift%4],n[(this.shift+1)%4],n[(this.shift+2)%4],n[(this.shift+3)%4]),i=this.getMatrixCornerPoints(n);return new lt(r,i,this.compact,this.nbDataBlocks,this.nbLayers)}extractParameters(t){if(!this.isValidPoint(t[0])||!this.isValidPoint(t[1])||!this.isValidPoint(t[2])||!this.isValidPoint(t[3]))throw new N;let e=2*this.nbCenterLayers,n=new Int32Array([this.sampleLine(t[0],t[1],e),this.sampleLine(t[1],t[2],e),this.sampleLine(t[2],t[3],e),this.sampleLine(t[3],t[0],e)]);this.shift=this.getRotation(n,e);let r=0;for(let s=0;s<4;s++){let t=n[(this.shift+s)%4];this.compact?(r<<=7,r+=t>>1&127):(r<<=10,r+=(t>>2&992)+(t>>1&31))}let i=this.getCorrectedParameterData(r,this.compact);this.compact?(this.nbLayers=1+(i>>6),this.nbDataBlocks=1+(63&i)):(this.nbLayers=1+(i>>11),this.nbDataBlocks=1+(2047&i))}getRotation(t,e){let n=0;t.forEach(((t,r,i)=>{let s=(t>>e-2<<1)+(1&t);n=(n<<3)+s})),n=((1&n)<<11)+(n>>1);for(let r=0;r<4;r++)if(b.bitCount(n^this.EXPECTED_CORNER_BITS[r])<=2)return r;throw new N}getCorrectedParameterData(t,e){let n,r;e?(n=7,r=2):(n=10,r=4);let i=n-r,s=new Int32Array(n);for(let c=n-1;c>=0;--c)s[c]=15&t,t>>=4;try{let t=new rt(tt.AZTEC_PARAM);t.decode(s,i)}catch(a){throw new N}let o=0;for(let c=0;c<r;c++)o=(o<<4)+s[c];return o}getBullsEyeCorners(t){let e=t,n=t,r=t,i=t,s=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){let t=this.getFirstDifferent(e,s,1,-1),o=this.getFirstDifferent(n,s,1,1),a=this.getFirstDifferent(r,s,-1,1),c=this.getFirstDifferent(i,s,-1,-1);if(this.nbCenterLayers>2){let n=this.distancePoint(c,t)*this.nbCenterLayers/(this.distancePoint(i,e)*(this.nbCenterLayers+2));if(n<.75||n>1.25||!this.isWhiteOrBlackRectangle(t,o,a,c))break}e=t,n=o,r=a,i=c,s=!s}if(5!==this.nbCenterLayers&&7!==this.nbCenterLayers)throw new N;this.compact=5===this.nbCenterLayers;let o=new at(e.getX()+.5,e.getY()-.5),a=new at(n.getX()+.5,n.getY()+.5),c=new at(r.getX()-.5,r.getY()+.5),l=new at(i.getX()-.5,i.getY()-.5);return this.expandSquare([o,a,c,l],2*this.nbCenterLayers-3,2*this.nbCenterLayers)}getMatrixCenter(){let t,e,n,r;try{let i=new ut(this.image).detect();t=i[0],e=i[1],n=i[2],r=i[3]}catch(o){let i=this.image.getWidth()/2,s=this.image.getHeight()/2;t=this.getFirstDifferent(new gt(i+7,s-7),!1,1,-1).toResultPoint(),e=this.getFirstDifferent(new gt(i+7,s+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new gt(i-7,s+7),!1,-1,1).toResultPoint(),r=this.getFirstDifferent(new gt(i-7,s-7),!1,-1,-1).toResultPoint()}let i=st.round((t.getX()+r.getX()+e.getX()+n.getX())/4),s=st.round((t.getY()+r.getY()+e.getY()+n.getY())/4);try{let o=new ut(this.image,15,i,s).detect();t=o[0],e=o[1],n=o[2],r=o[3]}catch(o){t=this.getFirstDifferent(new gt(i+7,s-7),!1,1,-1).toResultPoint(),e=this.getFirstDifferent(new gt(i+7,s+7),!1,1,1).toResultPoint(),n=this.getFirstDifferent(new gt(i-7,s+7),!1,-1,1).toResultPoint(),r=this.getFirstDifferent(new gt(i-7,s-7),!1,-1,-1).toResultPoint()}return i=st.round((t.getX()+r.getX()+e.getX()+n.getX())/4),s=st.round((t.getY()+r.getY()+e.getY()+n.getY())/4),new gt(i,s)}getMatrixCornerPoints(t){return this.expandSquare(t,2*this.nbCenterLayers,this.getDimension())}sampleGrid(t,e,n,r,i){let s=pt.getInstance(),o=this.getDimension(),a=o/2-this.nbCenterLayers,c=o/2+this.nbCenterLayers;return s.sampleGrid(t,o,o,a,a,c,a,c,c,a,c,e.getX(),e.getY(),n.getX(),n.getY(),r.getX(),r.getY(),i.getX(),i.getY())}sampleLine(t,e,n){let r=0,i=this.distanceResultPoint(t,e),s=i/n,o=t.getX(),a=t.getY(),c=s*(e.getX()-t.getX())/i,l=s*(e.getY()-t.getY())/i;for(let u=0;u<n;u++)this.image.get(st.round(o+u*c),st.round(a+u*l))&&(r|=1<<n-u-1);return r}isWhiteOrBlackRectangle(t,e,n,r){let i=3;t=new gt(t.getX()-i,t.getY()+i),e=new gt(e.getX()-i,e.getY()-i),n=new gt(n.getX()+i,n.getY()-i),r=new gt(r.getX()+i,r.getY()+i);let s=this.getColor(r,t);if(0===s)return!1;let o=this.getColor(t,e);return o===s&&(o=this.getColor(e,n),o===s&&(o=this.getColor(n,r),o===s))}getColor(t,e){let n=this.distancePoint(t,e),r=(e.getX()-t.getX())/n,i=(e.getY()-t.getY())/n,s=0,o=t.getX(),a=t.getY(),c=this.image.get(t.getX(),t.getY()),l=Math.ceil(n);for(let h=0;h<l;h++)o+=r,a+=i,this.image.get(st.round(o),st.round(a))!==c&&s++;let u=s/n;return u>.1&&u<.9?0:u<=.1===c?1:-1}getFirstDifferent(t,e,n,r){let i=t.getX()+n,s=t.getY()+r;while(this.isValid(i,s)&&this.image.get(i,s)===e)i+=n,s+=r;i-=n,s-=r;while(this.isValid(i,s)&&this.image.get(i,s)===e)i+=n;i-=n;while(this.isValid(i,s)&&this.image.get(i,s)===e)s+=r;return s-=r,new gt(i,s)}expandSquare(t,e,n){let r=n/(2*e),i=t[0].getX()-t[2].getX(),s=t[0].getY()-t[2].getY(),o=(t[0].getX()+t[2].getX())/2,a=(t[0].getY()+t[2].getY())/2,c=new at(o+r*i,a+r*s),l=new at(o-r*i,a-r*s);i=t[1].getX()-t[3].getX(),s=t[1].getY()-t[3].getY(),o=(t[1].getX()+t[3].getX())/2,a=(t[1].getY()+t[3].getY())/2;let u=new at(o+r*i,a+r*s),h=new at(o-r*i,a-r*s),d=[c,u,l,h];return d}isValid(t,e){return t>=0&&t<this.image.getWidth()&&e>0&&e<this.image.getHeight()}isValidPoint(t){let e=st.round(t.getX()),n=st.round(t.getY());return this.isValid(e,n)}distancePoint(t,e){return st.distance(t.getX(),t.getY(),e.getX(),e.getY())}distanceResultPoint(t,e){return st.distance(t.getX(),t.getY(),e.getX(),e.getY())}getDimension(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(b.truncDivision(this.nbLayers-4,8)+1)+15}}class yt{decode(t,e=null){let n=null,r=new mt(t.getBlackMatrix()),i=null,s=null;try{let t=r.detectMirror(!1);i=t.getPoints(),this.reportFoundResultPoints(e,i),s=(new it).decode(t)}catch(l){n=l}if(null==s)try{let t=r.detectMirror(!0);i=t.getPoints(),this.reportFoundResultPoints(e,i),s=(new it).decode(t)}catch(l){if(null!=n)throw n;throw l}let o=new z(s.getText(),s.getRawBytes(),s.getNumBits(),i,j.AZTEC,g.currentTimeMillis()),a=s.getByteSegments();null!=a&&o.putMetadata(Y.BYTE_SEGMENTS,a);let c=s.getECLevel();return null!=c&&o.putMetadata(Y.ERROR_CORRECTION_LEVEL,c),o}reportFoundResultPoints(t,e){if(null!=t){let n=t.get(_.NEED_RESULT_POINT_CALLBACK);null!=n&&e.forEach(((t,e,r)=>{n.foundPossibleResultPoint(t)}))}}reset(){}}class wt extends F{constructor(t=500){super(new yt,t)}}class bt{decode(t,e){try{return this.doDecode(t,e)}catch(n){const r=e&&!0===e.get(_.TRY_HARDER);if(r&&t.isRotateSupported()){const n=t.rotateCounterClockwise(),r=this.doDecode(n,e),i=r.getResultMetadata();let s=270;null!==i&&!0===i.get(Y.ORIENTATION)&&(s+=i.get(Y.ORIENTATION)%360),r.putMetadata(Y.ORIENTATION,s);const o=r.getResultPoints();if(null!==o){const t=n.getHeight();for(let e=0;e<o.length;e++)o[e]=new at(t-o[e].getY()-1,o[e].getX())}return r}throw new N}}reset(){}doDecode(t,e){const n=t.getWidth(),r=t.getHeight();let i=new v(n);const s=e&&!0===e.get(_.TRY_HARDER),o=Math.max(1,r>>(s?8:5));let a;a=s?r:15;const c=Math.trunc(r/2);for(let h=0;h<a;h++){const s=Math.trunc((h+1)/2),a=0===(1&h),d=c+o*(a?s:-s);if(d<0||d>=r)break;try{i=t.getBlackRow(d,i)}catch(l){continue}for(let t=0;t<2;t++){if(1===t&&(i.reverse(),e&&!0===e.get(_.NEED_RESULT_POINT_CALLBACK))){const t=new Map;e.forEach(((e,n)=>t.set(n,e))),t.delete(_.NEED_RESULT_POINT_CALLBACK),e=t}try{const r=this.decodeRow(d,i,e);if(1===t){r.putMetadata(Y.ORIENTATION,180);const t=r.getResultPoints();null!==t&&(t[0]=new at(n-t[0].getX()-1,t[0].getY()),t[1]=new at(n-t[1].getX()-1,t[1].getY()))}return r}catch(u){}}}throw new N}static recordPattern(t,e,n){const r=n.length;for(let c=0;c<r;c++)n[c]=0;const i=t.getSize();if(e>=i)throw new N;let s=!t.get(e),o=0,a=e;while(a<i){if(t.get(a)!==s)n[o]++;else{if(++o===r)break;n[o]=1,s=!s}a++}if(o!==r&&(o!==r-1||a!==i))throw new N}static recordPatternInReverse(t,e,n){let r=n.length,i=t.get(e);while(e>0&&r>=0)t.get(--e)!==i&&(r--,i=!i);if(r>=0)throw new N;bt.recordPattern(t,e+1,n)}static patternMatchVariance(t,e,n){const r=t.length;let i=0,s=0;for(let c=0;c<r;c++)i+=t[c],s+=e[c];if(i<s)return Number.POSITIVE_INFINITY;const o=i/s;n*=o;let a=0;for(let c=0;c<r;c++){const r=t[c],i=e[c]*o,s=r>i?r-i:i-r;if(s>n)return Number.POSITIVE_INFINITY;a+=s}return a/i}}class vt extends bt{static findStartPattern(t){const e=t.getSize(),n=t.getNextSet(0);let r=0,i=Int32Array.from([0,0,0,0,0,0]),s=n,o=!1;const a=6;for(let c=n;c<e;c++)if(t.get(c)!==o)i[r]++;else{if(r===a-1){let e=vt.MAX_AVG_VARIANCE,n=-1;for(let t=vt.CODE_START_A;t<=vt.CODE_START_C;t++){const r=bt.patternMatchVariance(i,vt.CODE_PATTERNS[t],vt.MAX_INDIVIDUAL_VARIANCE);r<e&&(e=r,n=t)}if(n>=0&&t.isRange(Math.max(0,s-(c-s)/2),s,!1))return Int32Array.from([s,c,n]);s+=i[0]+i[1],i=i.slice(2,i.length-1),i[r-1]=0,i[r]=0,r--}else r++;i[r]=1,o=!o}throw new N}static decodeCode(t,e,n){bt.recordPattern(t,n,e);let r=vt.MAX_AVG_VARIANCE,i=-1;for(let s=0;s<vt.CODE_PATTERNS.length;s++){const t=vt.CODE_PATTERNS[s],n=this.patternMatchVariance(e,t,vt.MAX_INDIVIDUAL_VARIANCE);n<r&&(r=n,i=s)}if(i>=0)return i;throw new N}decodeRow(t,e,n){const r=n&&!0===n.get(_.ASSUME_GS1),i=vt.findStartPattern(e),s=i[2];let o=0;const a=new Uint8Array(20);let c;switch(a[o++]=s,s){case vt.CODE_START_A:c=vt.CODE_CODE_A;break;case vt.CODE_START_B:c=vt.CODE_CODE_B;break;case vt.CODE_START_C:c=vt.CODE_CODE_C;break;default:throw new S}let l=!1,u=!1,h="",d=i[0],p=i[1];const g=Int32Array.from([0,0,0,0,0,0]);let m=0,y=0,w=s,b=0,v=!0,E=!1,A=!1;while(!l){const t=u;switch(u=!1,m=y,y=vt.decodeCode(e,g,p),a[o++]=y,y!==vt.CODE_STOP&&(v=!0),y!==vt.CODE_STOP&&(b++,w+=b*y),d=p,p+=g.reduce(((t,e)=>t+e),0),y){case vt.CODE_START_A:case vt.CODE_START_B:case vt.CODE_START_C:throw new S}switch(c){case vt.CODE_CODE_A:if(y<64)h+=A===E?String.fromCharCode(" ".charCodeAt(0)+y):String.fromCharCode(" ".charCodeAt(0)+y+128),A=!1;else if(y<96)h+=A===E?String.fromCharCode(y-64):String.fromCharCode(y+64),A=!1;else switch(y!==vt.CODE_STOP&&(v=!1),y){case vt.CODE_FNC_1:r&&(0===h.length?h+="]C1":h+=String.fromCharCode(29));break;case vt.CODE_FNC_2:case vt.CODE_FNC_3:break;case vt.CODE_FNC_4_A:!E&&A?(E=!0,A=!1):E&&A?(E=!1,A=!1):A=!0;break;case vt.CODE_SHIFT:u=!0,c=vt.CODE_CODE_B;break;case vt.CODE_CODE_B:c=vt.CODE_CODE_B;break;case vt.CODE_CODE_C:c=vt.CODE_CODE_C;break;case vt.CODE_STOP:l=!0;break}break;case vt.CODE_CODE_B:if(y<96)h+=A===E?String.fromCharCode(" ".charCodeAt(0)+y):String.fromCharCode(" ".charCodeAt(0)+y+128),A=!1;else switch(y!==vt.CODE_STOP&&(v=!1),y){case vt.CODE_FNC_1:r&&(0===h.length?h+="]C1":h+=String.fromCharCode(29));break;case vt.CODE_FNC_2:case vt.CODE_FNC_3:break;case vt.CODE_FNC_4_B:!E&&A?(E=!0,A=!1):E&&A?(E=!1,A=!1):A=!0;break;case vt.CODE_SHIFT:u=!0,c=vt.CODE_CODE_A;break;case vt.CODE_CODE_A:c=vt.CODE_CODE_A;break;case vt.CODE_CODE_C:c=vt.CODE_CODE_C;break;case vt.CODE_STOP:l=!0;break}break;case vt.CODE_CODE_C:if(y<100)y<10&&(h+="0"),h+=y;else switch(y!==vt.CODE_STOP&&(v=!1),y){case vt.CODE_FNC_1:r&&(0===h.length?h+="]C1":h+=String.fromCharCode(29));break;case vt.CODE_CODE_A:c=vt.CODE_CODE_A;break;case vt.CODE_CODE_B:c=vt.CODE_CODE_B;break;case vt.CODE_STOP:l=!0;break}break}t&&(c=c===vt.CODE_CODE_A?vt.CODE_CODE_B:vt.CODE_CODE_A)}const C=p-d;if(p=e.getNextUnset(p),!e.isRange(p,Math.min(e.getSize(),p+(p-d)/2),!1))throw new N;if(w-=b*m,w%103!==m)throw new f;const I=h.length;if(0===I)throw new N;I>0&&v&&(h=c===vt.CODE_CODE_C?h.substring(0,I-2):h.substring(0,I-1));const T=(i[1]+i[0])/2,k=d+C/2,R=a.length,D=new Uint8Array(R);for(let f=0;f<R;f++)D[f]=a[f];const O=[new at(T,t),new at(k,t)];return new z(h,D,0,O,j.CODE_128,(new Date).getTime())}}vt.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],vt.MAX_AVG_VARIANCE=.25,vt.MAX_INDIVIDUAL_VARIANCE=.7,vt.CODE_SHIFT=98,vt.CODE_CODE_C=99,vt.CODE_CODE_B=100,vt.CODE_CODE_A=101,vt.CODE_FNC_1=102,vt.CODE_FNC_2=97,vt.CODE_FNC_3=96,vt.CODE_FNC_4_A=101,vt.CODE_FNC_4_B=100,vt.CODE_START_A=103,vt.CODE_START_B=104,vt.CODE_START_C=105,vt.CODE_STOP=106;class Et extends bt{constructor(t=!1,e=!1){super(),this.usingCheckDigit=t,this.extendedMode=e,this.decodeRowResult="",this.counters=new Int32Array(9)}decodeRow(t,e,n){let r=this.counters;r.fill(0),this.decodeRowResult="";let i,s,o=Et.findAsteriskPattern(e,r),a=e.getNextSet(o[1]),c=e.getSize();do{Et.recordPattern(e,a,r);let t=Et.toNarrowWidePattern(r);if(t<0)throw new N;i=Et.patternToChar(t),this.decodeRowResult+=i,s=a;for(let e of r)a+=e;a=e.getNextSet(a)}while("*"!==i);this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);let l=0;for(let f of r)l+=f;let u,h=a-s-l;if(a!==c&&2*h<l)throw new N;if(this.usingCheckDigit){let t=this.decodeRowResult.length-1,e=0;for(let n=0;n<t;n++)e+=Et.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(n));if(this.decodeRowResult.charAt(t)!==Et.ALPHABET_STRING.charAt(e%43))throw new f;this.decodeRowResult=this.decodeRowResult.substring(0,t)}if(0===this.decodeRowResult.length)throw new N;u=this.extendedMode?Et.decodeExtended(this.decodeRowResult):this.decodeRowResult;let d=(o[1]+o[0])/2,p=s+l/2;return new z(u,null,0,[new at(d,t),new at(p,t)],j.CODE_39,(new Date).getTime())}static findAsteriskPattern(t,e){let n=t.getSize(),r=t.getNextSet(0),i=0,s=r,o=!1,a=e.length;for(let c=r;c<n;c++)if(t.get(c)!==o)e[i]++;else{if(i===a-1){if(this.toNarrowWidePattern(e)===Et.ASTERISK_ENCODING&&t.isRange(Math.max(0,s-Math.floor((c-s)/2)),s,!1))return[s,c];s+=e[0]+e[1],e.copyWithin(0,2,2+i-1),e[i-1]=0,e[i]=0,i--}else i++;e[i]=1,o=!o}throw new N}static toNarrowWidePattern(t){let e,n=t.length,r=0;do{let i=2147483647;for(let e of t)e<i&&e>r&&(i=e);r=i,e=0;let s=0,o=0;for(let a=0;a<n;a++){let i=t[a];i>r&&(o|=1<<n-1-a,e++,s+=i)}if(3===e){for(let i=0;i<n&&e>0;i++){let n=t[i];if(n>r&&(e--,2*n>=s))return-1}return o}}while(e>3);return-1}static patternToChar(t){for(let e=0;e<Et.CHARACTER_ENCODINGS.length;e++)if(Et.CHARACTER_ENCODINGS[e]===t)return Et.ALPHABET_STRING.charAt(e);if(t===Et.ASTERISK_ENCODING)return"*";throw new N}static decodeExtended(t){let e=t.length,n="";for(let r=0;r<e;r++){let e=t.charAt(r);if("+"===e||"$"===e||"%"===e||"/"===e){let i=t.charAt(r+1),s="\0";switch(e){case"+":if(!(i>="A"&&i<="Z"))throw new S;s=String.fromCharCode(i.charCodeAt(0)+32);break;case"$":if(!(i>="A"&&i<="Z"))throw new S;s=String.fromCharCode(i.charCodeAt(0)-64);break;case"%":if(i>="A"&&i<="E")s=String.fromCharCode(i.charCodeAt(0)-38);else if(i>="F"&&i<="J")s=String.fromCharCode(i.charCodeAt(0)-11);else if(i>="K"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)+16);else if(i>="P"&&i<="T")s=String.fromCharCode(i.charCodeAt(0)+43);else if("U"===i)s="\0";else if("V"===i)s="@";else if("W"===i)s="`";else{if("X"!==i&&"Y"!==i&&"Z"!==i)throw new S;s=""}break;case"/":if(i>="A"&&i<="O")s=String.fromCharCode(i.charCodeAt(0)-32);else{if("Z"!==i)throw new S;s=":"}break}n+=s,r++}else n+=e}return n}}Et.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",Et.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],Et.ASTERISK_ENCODING=148;class _t extends bt{constructor(){super(...arguments),this.narrowLineWidth=-1}decodeRow(t,e,n){let r=this.decodeStart(e),i=this.decodeEnd(e),s=new k;_t.decodeMiddle(e,r[1],i[0],s);let o=s.toString(),a=null;null!=n&&(a=n.get(_.ALLOWED_LENGTHS)),null==a&&(a=_t.DEFAULT_ALLOWED_LENGTHS);let c=o.length,l=!1,u=0;for(let f of a){if(c===f){l=!0;break}f>u&&(u=f)}if(!l&&c>u&&(l=!0),!l)throw new S;const h=[new at(r[1],t),new at(i[0],t)];let d=new z(o,null,0,h,j.ITF,(new Date).getTime());return d}static decodeMiddle(t,e,n,r){let i=new Int32Array(10),s=new Int32Array(5),o=new Int32Array(5);i.fill(0),s.fill(0),o.fill(0);while(e<n){bt.recordPattern(t,e,i);for(let t=0;t<5;t++){let e=2*t;s[t]=i[e],o[t]=i[e+1]}let n=_t.decodeDigit(s);r.append(n.toString()),n=this.decodeDigit(o),r.append(n.toString()),i.forEach((function(t){e+=t}))}}decodeStart(t){let e=_t.skipWhiteSpace(t),n=_t.findGuardPattern(t,e,_t.START_PATTERN);return this.narrowLineWidth=(n[1]-n[0])/4,this.validateQuietZone(t,n[0]),n}validateQuietZone(t,e){let n=10*this.narrowLineWidth;n=n<e?n:e;for(let r=e-1;n>0&&r>=0;r--){if(t.get(r))break;n--}if(0!==n)throw new N}static skipWhiteSpace(t){const e=t.getSize(),n=t.getNextSet(0);if(n===e)throw new N;return n}decodeEnd(t){t.reverse();try{let n,r=_t.skipWhiteSpace(t);try{n=_t.findGuardPattern(t,r,_t.END_PATTERN_REVERSED[0])}catch(e){e instanceof N&&(n=_t.findGuardPattern(t,r,_t.END_PATTERN_REVERSED[1]))}this.validateQuietZone(t,n[0]);let i=n[0];return n[0]=t.getSize()-n[1],n[1]=t.getSize()-i,n}finally{t.reverse()}}static findGuardPattern(t,e,n){let r=n.length,i=new Int32Array(r),s=t.getSize(),o=!1,a=0,c=e;i.fill(0);for(let l=e;l<s;l++)if(t.get(l)!==o)i[a]++;else{if(a===r-1){if(bt.patternMatchVariance(i,n,_t.MAX_INDIVIDUAL_VARIANCE)<_t.MAX_AVG_VARIANCE)return[c,l];c+=i[0]+i[1],g.arraycopy(i,2,i,0,a-1),i[a-1]=0,i[a]=0,a--}else a++;i[a]=1,o=!o}throw new N}static decodeDigit(t){let e=_t.MAX_AVG_VARIANCE,n=-1,r=_t.PATTERNS.length;for(let i=0;i<r;i++){let r=_t.PATTERNS[i],s=bt.patternMatchVariance(t,r,_t.MAX_INDIVIDUAL_VARIANCE);s<e?(e=s,n=i):s===e&&(n=-1)}if(n>=0)return n%10;throw new N}}_t.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],_t.MAX_AVG_VARIANCE=.38,_t.MAX_INDIVIDUAL_VARIANCE=.5,_t.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],_t.START_PATTERN=Int32Array.from([1,1,1,1]),_t.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])];class St extends bt{constructor(){super(...arguments),this.decodeRowStringBuffer=""}static findStartGuardPattern(t){let e,n=!1,r=0,i=Int32Array.from([0,0,0]);while(!n){i=Int32Array.from([0,0,0]),e=St.findGuardPattern(t,r,!1,this.START_END_PATTERN,i);let s=e[0];r=e[1];let o=s-(r-s);o>=0&&(n=t.isRange(o,s,!1))}return e}static checkChecksum(t){return St.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let e=t.length;if(0===e)return!1;let n=parseInt(t.charAt(e-1),10);return St.getStandardUPCEANChecksum(t.substring(0,e-1))===n}static getStandardUPCEANChecksum(t){let e=t.length,n=0;for(let r=e-1;r>=0;r-=2){let e=t.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(e<0||e>9)throw new S;n+=e}n*=3;for(let r=e-2;r>=0;r-=2){let e=t.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(e<0||e>9)throw new S;n+=e}return(1e3-n)%10}static decodeEnd(t,e){return St.findGuardPattern(t,e,!1,St.START_END_PATTERN,new Int32Array(St.START_END_PATTERN.length).fill(0))}static findGuardPatternWithoutCounters(t,e,n,r){return this.findGuardPattern(t,e,n,r,new Int32Array(r.length))}static findGuardPattern(t,e,n,r,i){let s=t.getSize();e=n?t.getNextUnset(e):t.getNextSet(e);let o=0,a=e,c=r.length,l=n;for(let u=e;u<s;u++)if(t.get(u)!==l)i[o]++;else{if(o===c-1){if(bt.patternMatchVariance(i,r,St.MAX_INDIVIDUAL_VARIANCE)<St.MAX_AVG_VARIANCE)return Int32Array.from([a,u]);a+=i[0]+i[1];let t=i.slice(2,i.length-1);for(let e=0;e<o-1;e++)i[e]=t[e];i[o-1]=0,i[o]=0,o--}else o++;i[o]=1,l=!l}throw new N}static decodeDigit(t,e,n,r){this.recordPattern(t,n,e);let i=this.MAX_AVG_VARIANCE,s=-1,o=r.length;for(let a=0;a<o;a++){let t=r[a],n=bt.patternMatchVariance(e,t,St.MAX_INDIVIDUAL_VARIANCE);n<i&&(i=n,s=a)}if(s>=0)return s;throw new N}}St.MAX_AVG_VARIANCE=.48,St.MAX_INDIVIDUAL_VARIANCE=.7,St.START_END_PATTERN=Int32Array.from([1,1,1]),St.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),St.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),St.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])];class At{constructor(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,e,n){let r=this.decodeRowStringBuffer,i=this.decodeMiddle(e,n,r),s=r.toString(),o=At.parseExtensionString(s),a=[new at((n[0]+n[1])/2,t),new at(i,t)],c=new z(s,null,0,a,j.UPC_EAN_EXTENSION,(new Date).getTime());return null!=o&&c.putAllMetadata(o),c}decodeMiddle(t,e,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=t.getSize(),s=e[1],o=0;for(let c=0;c<5&&s<i;c++){let e=St.decodeDigit(t,r,s,St.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e%10);for(let t of r)s+=t;e>=10&&(o|=1<<4-c),4!==c&&(s=t.getNextSet(s),s=t.getNextUnset(s))}if(5!==n.length)throw new N;let a=this.determineCheckDigit(o);if(At.extensionChecksum(n.toString())!==a)throw new N;return s}static extensionChecksum(t){let e=t.length,n=0;for(let r=e-2;r>=0;r-=2)n+=t.charAt(r).charCodeAt(0)-"0".charCodeAt(0);n*=3;for(let r=e-1;r>=0;r-=2)n+=t.charAt(r).charCodeAt(0)-"0".charCodeAt(0);return n*=3,n%10}determineCheckDigit(t){for(let e=0;e<10;e++)if(t===this.CHECK_DIGIT_ENCODINGS[e])return e;throw new N}static parseExtensionString(t){if(5!==t.length)return null;let e=At.parseExtension5String(t);return null==e?null:new Map([[Y.SUGGESTED_PRICE,e]])}static parseExtension5String(t){let e;switch(t.charAt(0)){case"0":e="£";break;case"5":e="$";break;case"9":switch(t){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}e="";break;default:e="";break}let n=parseInt(t.substring(1)),r=(n/100).toString(),i=n%100,s=i<10?"0"+i:i.toString();return e+r+"."+s}}class Ct{constructor(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}decodeRow(t,e,n){let r=this.decodeRowStringBuffer,i=this.decodeMiddle(e,n,r),s=r.toString(),o=Ct.parseExtensionString(s),a=[new at((n[0]+n[1])/2,t),new at(i,t)],c=new z(s,null,0,a,j.UPC_EAN_EXTENSION,(new Date).getTime());return null!=o&&c.putAllMetadata(o),c}decodeMiddle(t,e,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=t.getSize(),s=e[1],o=0;for(let a=0;a<2&&s<i;a++){let e=St.decodeDigit(t,r,s,St.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e%10);for(let t of r)s+=t;e>=10&&(o|=1<<1-a),1!==a&&(s=t.getNextSet(s),s=t.getNextUnset(s))}if(2!==n.length)throw new N;if(parseInt(n.toString())%4!==o)throw new N;return s}static parseExtensionString(t){return 2!==t.length?null:new Map([[Y.ISSUE_NUMBER,parseInt(t)]])}}class It{static decodeRow(t,e,n){let r=St.findGuardPattern(e,n,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{let n=new At;return n.decodeRow(t,e,r)}catch(i){let n=new Ct;return n.decodeRow(t,e,r)}}}It.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]);class Tt extends St{constructor(){super(),this.decodeRowStringBuffer="",Tt.L_AND_G_PATTERNS=Tt.L_PATTERNS.map((t=>Int32Array.from(t)));for(let t=10;t<20;t++){let e=Tt.L_PATTERNS[t-10],n=new Int32Array(e.length);for(let t=0;t<e.length;t++)n[t]=e[e.length-t-1];Tt.L_AND_G_PATTERNS[t]=n}}decodeRow(t,e,n){let r=Tt.findStartGuardPattern(e),i=null==n?null:n.get(_.NEED_RESULT_POINT_CALLBACK);if(null!=i){const e=new at((r[0]+r[1])/2,t);i.foundPossibleResultPoint(e)}let s=this.decodeMiddle(e,r,this.decodeRowStringBuffer),o=s.rowOffset,a=s.resultString;if(null!=i){const e=new at(o,t);i.foundPossibleResultPoint(e)}let c=this.decodeEnd(e,o);if(null!=i){const e=new at((c[0]+c[1])/2,t);i.foundPossibleResultPoint(e)}let l=c[1],u=l+(l-c[0]);if(u>=e.getSize()||!e.isRange(l,u,!1))throw new N;let h=a.toString();if(h.length<8)throw new S;if(!Tt.checkChecksum(h))throw new f;let d=(r[1]+r[0])/2,p=(c[1]+c[0])/2,g=this.getBarcodeFormat(),m=[new at(d,t),new at(p,t)],y=new z(h,null,0,m,g,(new Date).getTime()),w=0;try{let n=It.decodeRow(t,e,c[1]);y.putMetadata(Y.UPC_EAN_EXTENSION,n.getText()),y.putAllMetadata(n.getResultMetadata()),y.addResultPoints(n.getResultPoints()),w=n.getText().length}catch(v){}let b=null==n?null:n.get(_.ALLOWED_EAN_EXTENSIONS);if(null!=b){let t=!1;for(let e in b)if(w.toString()===e){t=!0;break}if(!t)throw new N}return y}decodeEnd(t,e){return Tt.findGuardPattern(t,e,!1,Tt.START_END_PATTERN,new Int32Array(Tt.START_END_PATTERN.length).fill(0))}static checkChecksum(t){return Tt.checkStandardUPCEANChecksum(t)}static checkStandardUPCEANChecksum(t){let e=t.length;if(0===e)return!1;let n=parseInt(t.charAt(e-1),10);return Tt.getStandardUPCEANChecksum(t.substring(0,e-1))===n}static getStandardUPCEANChecksum(t){let e=t.length,n=0;for(let r=e-1;r>=0;r-=2){let e=t.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(e<0||e>9)throw new S;n+=e}n*=3;for(let r=e-2;r>=0;r-=2){let e=t.charAt(r).charCodeAt(0)-"0".charCodeAt(0);if(e<0||e>9)throw new S;n+=e}return(1e3-n)%10}}class kt extends Tt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,e,n){let r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=t.getSize(),s=e[1],o=0;for(let c=0;c<6&&s<i;c++){let e=Tt.decodeDigit(t,r,s,Tt.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e%10);for(let t of r)s+=t;e>=10&&(o|=1<<5-c)}n=kt.determineFirstDigit(n,o);let a=Tt.findGuardPattern(t,s,!0,Tt.MIDDLE_PATTERN,new Int32Array(Tt.MIDDLE_PATTERN.length).fill(0));s=a[1];for(let c=0;c<6&&s<i;c++){let e=Tt.decodeDigit(t,r,s,Tt.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e);for(let t of r)s+=t}return{rowOffset:s,resultString:n}}getBarcodeFormat(){return j.EAN_13}static determineFirstDigit(t,e){for(let n=0;n<10;n++)if(e===this.FIRST_DIGIT_ENCODINGS[n])return t=String.fromCharCode("0".charCodeAt(0)+n)+t,t;throw new N}}kt.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26];class Rt extends Tt{constructor(){super(),this.decodeMiddleCounters=Int32Array.from([0,0,0,0])}decodeMiddle(t,e,n){const r=this.decodeMiddleCounters;r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i=t.getSize(),s=e[1];for(let a=0;a<4&&s<i;a++){let e=Tt.decodeDigit(t,r,s,Tt.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e);for(let t of r)s+=t}let o=Tt.findGuardPattern(t,s,!0,Tt.MIDDLE_PATTERN,new Int32Array(Tt.MIDDLE_PATTERN.length).fill(0));s=o[1];for(let a=0;a<4&&s<i;a++){let e=Tt.decodeDigit(t,r,s,Tt.L_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e);for(let t of r)s+=t}return{rowOffset:s,resultString:n}}getBarcodeFormat(){return j.EAN_8}}class Nt extends Tt{constructor(){super(...arguments),this.ean13Reader=new kt}getBarcodeFormat(){return j.UPC_A}decode(t,e){return this.maybeReturnResult(this.ean13Reader.decode(t))}decodeRow(t,e,n){return this.maybeReturnResult(this.ean13Reader.decodeRow(t,e,n))}decodeMiddle(t,e,n){return this.ean13Reader.decodeMiddle(t,e,n)}maybeReturnResult(t){let e=t.getText();if("0"===e.charAt(0)){let n=new z(e.substring(1),null,null,t.getResultPoints(),j.UPC_A);return null!=t.getResultMetadata()&&n.putAllMetadata(t.getResultMetadata()),n}throw new N}reset(){this.ean13Reader.reset()}}class Dt extends Tt{constructor(){super(),this.decodeMiddleCounters=new Int32Array(4)}decodeMiddle(t,e,n){const r=this.decodeMiddleCounters.map((t=>t));r[0]=0,r[1]=0,r[2]=0,r[3]=0;const i=t.getSize();let s=e[1],o=0;for(let c=0;c<6&&s<i;c++){const e=Dt.decodeDigit(t,r,s,Dt.L_AND_G_PATTERNS);n+=String.fromCharCode("0".charCodeAt(0)+e%10);for(let t of r)s+=t;e>=10&&(o|=1<<5-c)}let a=Dt.determineNumSysAndCheckDigit(n,o);return{rowOffset:s,resultString:a}}decodeEnd(t,e){return Dt.findGuardPatternWithoutCounters(t,e,!0,Dt.MIDDLE_END_PATTERN)}checkChecksum(t){return Tt.checkChecksum(Dt.convertUPCEtoUPCA(t))}static determineNumSysAndCheckDigit(t,e){for(let n=0;n<=1;n++)for(let r=0;r<10;r++)if(e===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[n][r]){let e=String.fromCharCode("0".charCodeAt(0)+n),i=String.fromCharCode("0".charCodeAt(0)+r);return e+t+i}throw N.getNotFoundInstance()}getBarcodeFormat(){return j.UPC_E}static convertUPCEtoUPCA(t){const e=t.slice(1,7).split("").map((t=>t.charCodeAt(0))),n=new k;n.append(t.charAt(0));let r=e[5];switch(r){case 0:case 1:case 2:n.appendChars(e,0,2),n.append(r),n.append("0000"),n.appendChars(e,2,3);break;case 3:n.appendChars(e,0,3),n.append("00000"),n.appendChars(e,3,2);break;case 4:n.appendChars(e,0,4),n.append("00000"),n.append(e[4]);break;default:n.appendChars(e,0,5),n.append("0000"),n.append(r);break}return t.length>=8&&n.append(t.charAt(7)),n.toString()}}Dt.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),Dt.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,26])];class Ot extends bt{constructor(t){super();let n=null==t?null:t.get(_.POSSIBLE_FORMATS),r=[];e(n)?(r.push(new kt),r.push(new Nt),r.push(new Rt),r.push(new Dt)):(n.indexOf(j.EAN_13)>-1&&r.push(new kt),n.indexOf(j.UPC_A)>-1&&r.push(new Nt),n.indexOf(j.EAN_8)>-1&&r.push(new Rt),n.indexOf(j.UPC_E)>-1&&r.push(new Dt)),this.readers=r}decodeRow(t,e,n){for(let i of this.readers)try{const r=i.decodeRow(t,e,n),s=r.getBarcodeFormat()===j.EAN_13&&"0"===r.getText().charAt(0),o=null==n?null:n.get(_.POSSIBLE_FORMATS),a=null==o||o.includes(j.UPC_A);if(s&&a){const t=r.getRawBytes(),e=new z(r.getText().substring(1),t,t?t.length:null,r.getResultPoints(),j.UPC_A);return e.putAllMetadata(r.getResultMetadata()),e}return r}catch(r){}throw new N}reset(){for(let t of this.readers)t.reset()}}class Pt extends bt{constructor(){super(),this.decodeFinderCounters=new Int32Array(4),this.dataCharacterCounters=new Int32Array(8),this.oddRoundingErrors=new Array(4),this.evenRoundingErrors=new Array(4),this.oddCounts=new Array(this.dataCharacterCounters.length/2),this.evenCounts=new Array(this.dataCharacterCounters.length/2)}getDecodeFinderCounters(){return this.decodeFinderCounters}getDataCharacterCounters(){return this.dataCharacterCounters}getOddRoundingErrors(){return this.oddRoundingErrors}getEvenRoundingErrors(){return this.evenRoundingErrors}getOddCounts(){return this.oddCounts}getEvenCounts(){return this.evenCounts}parseFinderValue(t,e){for(let n=0;n<e.length;n++)if(bt.patternMatchVariance(t,e[n],Pt.MAX_INDIVIDUAL_VARIANCE)<Pt.MAX_AVG_VARIANCE)return n;throw new N}static count(t){return st.sum(new Int32Array(t))}static increment(t,e){let n=0,r=e[0];for(let i=1;i<t.length;i++)e[i]>r&&(r=e[i],n=i);t[n]++}static decrement(t,e){let n=0,r=e[0];for(let i=1;i<t.length;i++)e[i]<r&&(r=e[i],n=i);t[n]--}static isFinderPattern(t){let e=t[0]+t[1],n=e+t[2]+t[3],r=e/n;if(r>=Pt.MIN_FINDER_PATTERN_RATIO&&r<=Pt.MAX_FINDER_PATTERN_RATIO){let e=Number.MAX_SAFE_INTEGER,n=Number.MIN_SAFE_INTEGER;for(let r of t)r>n&&(n=r),r<e&&(e=r);return n<10*e}return!1}}Pt.MAX_AVG_VARIANCE=.2,Pt.MAX_INDIVIDUAL_VARIANCE=.45,Pt.MIN_FINDER_PATTERN_RATIO=9.5/12,Pt.MAX_FINDER_PATTERN_RATIO=12.5/14;class xt{constructor(t,e){this.value=t,this.checksumPortion=e}getValue(){return this.value}getChecksumPortion(){return this.checksumPortion}toString(){return this.value+"("+this.checksumPortion+")"}equals(t){if(!(t instanceof xt))return!1;const e=t;return this.value===e.value&&this.checksumPortion===e.checksumPortion}hashCode(){return this.value^this.checksumPortion}}class Mt{constructor(t,e,n,r,i){this.value=t,this.startEnd=e,this.value=t,this.startEnd=e,this.resultPoints=new Array,this.resultPoints.push(new at(n,i)),this.resultPoints.push(new at(r,i))}getValue(){return this.value}getStartEnd(){return this.startEnd}getResultPoints(){return this.resultPoints}equals(t){if(!(t instanceof Mt))return!1;const e=t;return this.value===e.value}hashCode(){return this.value}}class Lt{constructor(){}static getRSSvalue(t,e,n){let r=0;for(let a of t)r+=a;let i=0,s=0,o=t.length;for(let a=0;a<o-1;a++){let c;for(c=1,s|=1<<a;c<t[a];c++,s&=~(1<<a)){let t=Lt.combins(r-c-1,o-a-2);if(n&&0===s&&r-c-(o-a-1)>=o-a-1&&(t-=Lt.combins(r-c-(o-a),o-a-2)),o-a-1>1){let n=0;for(let t=r-c-(o-a-2);t>e;t--)n+=Lt.combins(r-c-t-1,o-a-3);t-=n*(o-1-a)}else r-c>e&&t--;i+=t}r-=c}return i}static combins(t,e){let n,r;t-e>e?(r=e,n=t-e):(r=t-e,n=e);let i=1,s=1;for(let o=t;o>n;o--)i*=o,s<=r&&(i/=s,s++);while(s<=r)i/=s,s++;return i}}class Bt{static buildBitArray(t){let e=2*t.length-1;null==t[t.length-1].getRightChar()&&(e-=1);let n=12*e,r=new v(n),i=0,s=t[0],o=s.getRightChar().getValue();for(let a=11;a>=0;--a)0!=(o&1<<a)&&r.set(i),i++;for(let a=1;a<t.length;++a){let e=t[a],n=e.getLeftChar().getValue();for(let t=11;t>=0;--t)0!=(n&1<<t)&&r.set(i),i++;if(null!=e.getRightChar()){let t=e.getRightChar().getValue();for(let e=11;e>=0;--e)0!=(t&1<<e)&&r.set(i),i++}}return r}}class Ut{constructor(t,e){e?this.decodedInformation=null:(this.finished=t,this.decodedInformation=e)}getDecodedInformation(){return this.decodedInformation}isFinished(){return this.finished}}class Ft{constructor(t){this.newPosition=t}getNewPosition(){return this.newPosition}}class zt extends Ft{constructor(t,e){super(t),this.value=e}getValue(){return this.value}isFNC1(){return this.value===zt.FNC1}}zt.FNC1="$";class Vt extends Ft{constructor(t,e,n){super(t),n?(this.remaining=!0,this.remainingValue=this.remainingValue):(this.remaining=!1,this.remainingValue=0),this.newString=e}getNewString(){return this.newString}isRemaining(){return this.remaining}getRemainingValue(){return this.remainingValue}}class jt extends Ft{constructor(t,e,n){if(super(t),e<0||e>10||n<0||n>10)throw new S;this.firstDigit=e,this.secondDigit=n}getFirstDigit(){return this.firstDigit}getSecondDigit(){return this.secondDigit}getValue(){return 10*this.firstDigit+this.secondDigit}isFirstDigitFNC1(){return this.firstDigit===jt.FNC1}isSecondDigitFNC1(){return this.secondDigit===jt.FNC1}isAnyFNC1(){return this.firstDigit===jt.FNC1||this.secondDigit===jt.FNC1}}jt.FNC1=10;class Ht{constructor(){}static parseFieldsInGeneralPurpose(t){if(!t)return null;if(t.length<2)throw new N;let e=t.substring(0,2);for(let i of Ht.TWO_DIGIT_DATA_LENGTH)if(i[0]===e)return i[1]===Ht.VARIABLE_LENGTH?Ht.processVariableAI(2,i[2],t):Ht.processFixedAI(2,i[1],t);if(t.length<3)throw new N;let n=t.substring(0,3);for(let i of Ht.THREE_DIGIT_DATA_LENGTH)if(i[0]===n)return i[1]===Ht.VARIABLE_LENGTH?Ht.processVariableAI(3,i[2],t):Ht.processFixedAI(3,i[1],t);for(let i of Ht.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH)if(i[0]===n)return i[1]===Ht.VARIABLE_LENGTH?Ht.processVariableAI(4,i[2],t):Ht.processFixedAI(4,i[1],t);if(t.length<4)throw new N;let r=t.substring(0,4);for(let i of Ht.FOUR_DIGIT_DATA_LENGTH)if(i[0]===r)return i[1]===Ht.VARIABLE_LENGTH?Ht.processVariableAI(4,i[2],t):Ht.processFixedAI(4,i[1],t);throw new N}static processFixedAI(t,e,n){if(n.length<t)throw new N;let r=n.substring(0,t);if(n.length<t+e)throw new N;let i=n.substring(t,t+e),s=n.substring(t+e),o="("+r+")"+i,a=Ht.parseFieldsInGeneralPurpose(s);return null==a?o:o+a}static processVariableAI(t,e,n){let r,i=n.substring(0,t);r=n.length<t+e?n.length:t+e;let s=n.substring(t,r),o=n.substring(r),a="("+i+")"+s,c=Ht.parseFieldsInGeneralPurpose(o);return null==c?a:a+c}}Ht.VARIABLE_LENGTH=[],Ht.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",Ht.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",Ht.VARIABLE_LENGTH,20],["22",Ht.VARIABLE_LENGTH,29],["30",Ht.VARIABLE_LENGTH,8],["37",Ht.VARIABLE_LENGTH,8],["90",Ht.VARIABLE_LENGTH,30],["91",Ht.VARIABLE_LENGTH,30],["92",Ht.VARIABLE_LENGTH,30],["93",Ht.VARIABLE_LENGTH,30],["94",Ht.VARIABLE_LENGTH,30],["95",Ht.VARIABLE_LENGTH,30],["96",Ht.VARIABLE_LENGTH,30],["97",Ht.VARIABLE_LENGTH,3],["98",Ht.VARIABLE_LENGTH,30],["99",Ht.VARIABLE_LENGTH,30]],Ht.THREE_DIGIT_DATA_LENGTH=[["240",Ht.VARIABLE_LENGTH,30],["241",Ht.VARIABLE_LENGTH,30],["242",Ht.VARIABLE_LENGTH,6],["250",Ht.VARIABLE_LENGTH,30],["251",Ht.VARIABLE_LENGTH,30],["253",Ht.VARIABLE_LENGTH,17],["254",Ht.VARIABLE_LENGTH,20],["400",Ht.VARIABLE_LENGTH,30],["401",Ht.VARIABLE_LENGTH,30],["402",17],["403",Ht.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",Ht.VARIABLE_LENGTH,20],["421",Ht.VARIABLE_LENGTH,15],["422",3],["423",Ht.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],Ht.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",Ht.VARIABLE_LENGTH,15],["391",Ht.VARIABLE_LENGTH,18],["392",Ht.VARIABLE_LENGTH,15],["393",Ht.VARIABLE_LENGTH,18],["703",Ht.VARIABLE_LENGTH,30]],Ht.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",Ht.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",Ht.VARIABLE_LENGTH,20],["8003",Ht.VARIABLE_LENGTH,30],["8004",Ht.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",Ht.VARIABLE_LENGTH,30],["8008",Ht.VARIABLE_LENGTH,12],["8018",18],["8020",Ht.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",Ht.VARIABLE_LENGTH,70],["8200",Ht.VARIABLE_LENGTH,70]];class $t{constructor(t){this.buffer=new k,this.information=t}decodeAllCodes(t,e){let n=e,r=null;do{let e=this.decodeGeneralPurposeField(n,r),i=Ht.parseFieldsInGeneralPurpose(e.getNewString());if(null!=i&&t.append(i),r=e.isRemaining()?""+e.getRemainingValue():null,n===e.getNewPosition())break;n=e.getNewPosition()}while(1);return t.toString()}isStillNumeric(t){if(t+7>this.information.getSize())return t+4<=this.information.getSize();for(let e=t;e<t+3;++e)if(this.information.get(e))return!0;return this.information.get(t+3)}decodeNumeric(t){if(t+7>this.information.getSize()){let e=this.extractNumericValueFromBitArray(t,4);return new jt(this.information.getSize(),0===e?jt.FNC1:e-1,jt.FNC1)}let e=this.extractNumericValueFromBitArray(t,7),n=(e-8)/11,r=(e-8)%11;return new jt(t+7,n,r)}extractNumericValueFromBitArray(t,e){return $t.extractNumericValueFromBitArray(this.information,t,e)}static extractNumericValueFromBitArray(t,e,n){let r=0;for(let i=0;i<n;++i)t.get(e+i)&&(r|=1<<n-i-1);return r}decodeGeneralPurposeField(t,e){this.buffer.setLengthToZero(),null!=e&&this.buffer.append(e),this.current.setPosition(t);let n=this.parseBlocks();return null!=n&&n.isRemaining()?new Vt(this.current.getPosition(),this.buffer.toString(),n.getRemainingValue()):new Vt(this.current.getPosition(),this.buffer.toString())}parseBlocks(){let t,e;do{let n=this.current.getPosition();this.current.isAlpha()?(e=this.parseAlphaBlock(),t=e.isFinished()):this.current.isIsoIec646()?(e=this.parseIsoIec646Block(),t=e.isFinished()):(e=this.parseNumericBlock(),t=e.isFinished());let r=n!==this.current.getPosition();if(!r&&!t)break}while(!t);return e.getDecodedInformation()}parseNumericBlock(){while(this.isStillNumeric(this.current.getPosition())){let t=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFirstDigitFNC1()){let e;return e=t.isSecondDigitFNC1()?new Vt(this.current.getPosition(),this.buffer.toString()):new Vt(this.current.getPosition(),this.buffer.toString(),t.getSecondDigit()),new Ut(!0,e)}if(this.buffer.append(t.getFirstDigit()),t.isSecondDigitFNC1()){let t=new Vt(this.current.getPosition(),this.buffer.toString());return new Ut(!0,t)}this.buffer.append(t.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new Ut(!1)}parseIsoIec646Block(){while(this.isStillIsoIec646(this.current.getPosition())){let t=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let t=new Vt(this.current.getPosition(),this.buffer.toString());return new Ut(!0,t)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new Ut(!1)}parseAlphaBlock(){while(this.isStillAlpha(this.current.getPosition())){let t=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(t.getNewPosition()),t.isFNC1()){let t=new Vt(this.current.getPosition(),this.buffer.toString());return new Ut(!0,t)}this.buffer.append(t.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new Ut(!1)}isStillIsoIec646(t){if(t+5>this.information.getSize())return!1;let e=this.extractNumericValueFromBitArray(t,5);if(e>=5&&e<16)return!0;if(t+7>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(t,7);if(n>=64&&n<116)return!0;if(t+8>this.information.getSize())return!1;let r=this.extractNumericValueFromBitArray(t,8);return r>=232&&r<253}decodeIsoIec646(t){let e=this.extractNumericValueFromBitArray(t,5);if(15===e)return new zt(t+5,zt.FNC1);if(e>=5&&e<15)return new zt(t+5,"0"+(e-5));let n=this.extractNumericValueFromBitArray(t,7);if(n>=64&&n<90)return new zt(t+7,""+(n+1));if(n>=90&&n<116)return new zt(t+7,""+(n+7));let r,i=this.extractNumericValueFromBitArray(t,8);switch(i){case 232:r="!";break;case 233:r='"';break;case 234:r="%";break;case 235:r="&";break;case 236:r="'";break;case 237:r="(";break;case 238:r=")";break;case 239:r="*";break;case 240:r="+";break;case 241:r=",";break;case 242:r="-";break;case 243:r=".";break;case 244:r="/";break;case 245:r=":";break;case 246:r=";";break;case 247:r="<";break;case 248:r="=";break;case 249:r=">";break;case 250:r="?";break;case 251:r="_";break;case 252:r=" ";break;default:throw new S}return new zt(t+8,r)}isStillAlpha(t){if(t+5>this.information.getSize())return!1;let e=this.extractNumericValueFromBitArray(t,5);if(e>=5&&e<16)return!0;if(t+6>this.information.getSize())return!1;let n=this.extractNumericValueFromBitArray(t,6);return n>=16&&n<63}decodeAlphanumeric(t){let e=this.extractNumericValueFromBitArray(t,5);if(15===e)return new zt(t+5,zt.FNC1);if(e>=5&&e<15)return new zt(t+5,"0"+(e-5));let n,r=this.extractNumericValueFromBitArray(t,6);if(r>=32&&r<58)return new zt(t+6,""+(r+33));switch(r){case 58:n="*";break;case 59:n=",";break;case 60:n="-";break;case 61:n=".";break;case 62:n="/";break;default:throw new nt("Decoding invalid alphanumeric value: "+r)}return new zt(t+6,n)}isAlphaTo646ToAlphaLatch(t){if(t+1>this.information.getSize())return!1;for(let e=0;e<5&&e+t<this.information.getSize();++e)if(2===e){if(!this.information.get(t+2))return!1}else if(this.information.get(t+e))return!1;return!0}isAlphaOr646ToNumericLatch(t){if(t+3>this.information.getSize())return!1;for(let e=t;e<t+3;++e)if(this.information.get(e))return!1;return!0}isNumericToAlphaNumericLatch(t){if(t+1>this.information.getSize())return!1;for(let e=0;e<4&&e+t<this.information.getSize();++e)if(this.information.get(t+e))return!1;return!0}}class Kt{constructor(t){this.information=t,this.generalDecoder=new $t(t)}getInformation(){return this.information}getGeneralDecoder(){return this.generalDecoder}}class Gt extends Kt{constructor(t){super(t)}encodeCompressedGtin(t,e){t.append("(01)");let n=t.length();t.append("9"),this.encodeCompressedGtinWithoutAI(t,e,n)}encodeCompressedGtinWithoutAI(t,e,n){for(let r=0;r<4;++r){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(e+10*r,10);n/100===0&&t.append("0"),n/10===0&&t.append("0"),t.append(n)}Gt.appendCheckDigit(t,n)}static appendCheckDigit(t,e){let n=0;for(let r=0;r<13;r++){let i=t.charAt(r+e).charCodeAt(0)-"0".charCodeAt(0);n+=0===(1&r)?3*i:i}n=10-n%10,10===n&&(n=0),t.append(n)}}Gt.GTIN_SIZE=40;class qt extends Gt{constructor(t){super(t)}parseInformation(){let t=new k;t.append("(01)");let e=t.length(),n=this.getGeneralDecoder().extractNumericValueFromBitArray(qt.HEADER_SIZE,4);return t.append(n),this.encodeCompressedGtinWithoutAI(t,qt.HEADER_SIZE+4,e),this.getGeneralDecoder().decodeAllCodes(t,qt.HEADER_SIZE+44)}}qt.HEADER_SIZE=4;class Wt extends Kt{constructor(t){super(t)}parseInformation(){let t=new k;return this.getGeneralDecoder().decodeAllCodes(t,Wt.HEADER_SIZE)}}Wt.HEADER_SIZE=5;class Yt extends Gt{constructor(t){super(t)}encodeCompressedWeight(t,e,n){let r=this.getGeneralDecoder().extractNumericValueFromBitArray(e,n);this.addWeightCode(t,r);let i=this.checkWeight(r),s=1e5;for(let o=0;o<5;++o)i/s===0&&t.append("0"),s/=10;t.append(i)}}class Xt extends Yt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()!=Xt.HEADER_SIZE+Yt.GTIN_SIZE+Xt.WEIGHT_SIZE)throw new N;let t=new k;return this.encodeCompressedGtin(t,Xt.HEADER_SIZE),this.encodeCompressedWeight(t,Xt.HEADER_SIZE+Yt.GTIN_SIZE,Xt.WEIGHT_SIZE),t.toString()}}Xt.HEADER_SIZE=5,Xt.WEIGHT_SIZE=15;class Qt extends Xt{constructor(t){super(t)}addWeightCode(t,e){t.append("(3103)")}checkWeight(t){return t}}class Jt extends Xt{constructor(t){super(t)}addWeightCode(t,e){e<1e4?t.append("(3202)"):t.append("(3203)")}checkWeight(t){return t<1e4?t:t-1e4}}class Zt extends Gt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<Zt.HEADER_SIZE+Gt.GTIN_SIZE)throw new N;let t=new k;this.encodeCompressedGtin(t,Zt.HEADER_SIZE);let e=this.getGeneralDecoder().extractNumericValueFromBitArray(Zt.HEADER_SIZE+Gt.GTIN_SIZE,Zt.LAST_DIGIT_SIZE);t.append("(392"),t.append(e),t.append(")");let n=this.getGeneralDecoder().decodeGeneralPurposeField(Zt.HEADER_SIZE+Gt.GTIN_SIZE+Zt.LAST_DIGIT_SIZE,null);return t.append(n.getNewString()),t.toString()}}Zt.HEADER_SIZE=8,Zt.LAST_DIGIT_SIZE=2;class te extends Gt{constructor(t){super(t)}parseInformation(){if(this.getInformation().getSize()<te.HEADER_SIZE+Gt.GTIN_SIZE)throw new N;let t=new k;this.encodeCompressedGtin(t,te.HEADER_SIZE);let e=this.getGeneralDecoder().extractNumericValueFromBitArray(te.HEADER_SIZE+Gt.GTIN_SIZE,te.LAST_DIGIT_SIZE);t.append("(393"),t.append(e),t.append(")");let n=this.getGeneralDecoder().extractNumericValueFromBitArray(te.HEADER_SIZE+Gt.GTIN_SIZE+te.LAST_DIGIT_SIZE,te.FIRST_THREE_DIGITS_SIZE);n/100==0&&t.append("0"),n/10==0&&t.append("0"),t.append(n);let r=this.getGeneralDecoder().decodeGeneralPurposeField(te.HEADER_SIZE+Gt.GTIN_SIZE+te.LAST_DIGIT_SIZE+te.FIRST_THREE_DIGITS_SIZE,null);return t.append(r.getNewString()),t.toString()}}te.HEADER_SIZE=8,te.LAST_DIGIT_SIZE=2,te.FIRST_THREE_DIGITS_SIZE=10;class ee extends Yt{constructor(t,e,n){super(t),this.dateCode=n,this.firstAIdigits=e}parseInformation(){if(this.getInformation().getSize()!=ee.HEADER_SIZE+ee.GTIN_SIZE+ee.WEIGHT_SIZE+ee.DATE_SIZE)throw new N;let t=new k;return this.encodeCompressedGtin(t,ee.HEADER_SIZE),this.encodeCompressedWeight(t,ee.HEADER_SIZE+ee.GTIN_SIZE,ee.WEIGHT_SIZE),this.encodeCompressedDate(t,ee.HEADER_SIZE+ee.GTIN_SIZE+ee.WEIGHT_SIZE),t.toString()}encodeCompressedDate(t,e){let n=this.getGeneralDecoder().extractNumericValueFromBitArray(e,ee.DATE_SIZE);if(38400==n)return;t.append("("),t.append(this.dateCode),t.append(")");let r=n%32;n/=32;let i=n%12+1;n/=12;let s=n;s/10==0&&t.append("0"),t.append(s),i/10==0&&t.append("0"),t.append(i),r/10==0&&t.append("0"),t.append(r)}addWeightCode(t,e){t.append("("),t.append(this.firstAIdigits),t.append(e/1e5),t.append(")")}checkWeight(t){return t%1e5}}function ne(t){try{if(t.get(1))return new qt(t);if(!t.get(2))return new Wt(t);let e=$t.extractNumericValueFromBitArray(t,1,4);switch(e){case 4:return new Qt(t);case 5:return new Jt(t)}let n=$t.extractNumericValueFromBitArray(t,1,5);switch(n){case 12:return new Zt(t);case 13:return new te(t)}let r=$t.extractNumericValueFromBitArray(t,1,7);switch(r){case 56:return new ee(t,"310","11");case 57:return new ee(t,"320","11");case 58:return new ee(t,"310","13");case 59:return new ee(t,"320","13");case 60:return new ee(t,"310","15");case 61:return new ee(t,"320","15");case 62:return new ee(t,"310","17");case 63:return new ee(t,"320","17")}}catch(e){throw console.log(e),new nt("unknown decoder: "+t)}}ee.HEADER_SIZE=8,ee.WEIGHT_SIZE=20,ee.DATE_SIZE=16;class re{constructor(t,e,n,r){this.leftchar=t,this.rightchar=e,this.finderpattern=n,this.maybeLast=r}mayBeLast(){return this.maybeLast}getLeftChar(){return this.leftchar}getRightChar(){return this.rightchar}getFinderPattern(){return this.finderpattern}mustBeLast(){return null==this.rightchar}toString(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(null==this.finderpattern?"null":this.finderpattern.getValue())+" ]"}static equals(t,e){return t instanceof re&&(re.equalsOrNull(t.leftchar,e.leftchar)&&re.equalsOrNull(t.rightchar,e.rightchar)&&re.equalsOrNull(t.finderpattern,e.finderpattern))}static equalsOrNull(t,e){return null===t?null===e:re.equals(t,e)}hashCode(){let t=this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue();return t}}class ie{constructor(t,e,n){this.pairs=t,this.rowNumber=e,this.wasReversed=n}getPairs(){return this.pairs}getRowNumber(){return this.rowNumber}isReversed(){return this.wasReversed}isEquivalent(t){return this.checkEqualitity(this,t)}toString(){return"{ "+this.pairs+" }"}equals(t,e){return t instanceof ie&&(this.checkEqualitity(t,e)&&t.wasReversed===e.wasReversed)}checkEqualitity(t,e){if(!t||!e)return;let n;return t.forEach(((t,r)=>{e.forEach((e=>{t.getLeftChar().getValue()===e.getLeftChar().getValue()&&t.getRightChar().getValue()===e.getRightChar().getValue()&&t.getFinderPatter().getValue()===e.getFinderPatter().getValue()&&(n=!0)}))})),n}}class se extends Pt{constructor(t){super(...arguments),this.pairs=new Array(se.MAX_PAIRS),this.rows=new Array,this.startEnd=[2],this.verbose=!0===t}decodeRow(t,e,n){this.pairs.length=0,this.startFromEven=!1;try{return se.constructResult(this.decodeRow2pairs(t,e))}catch(r){this.verbose&&console.log(r)}return this.pairs.length=0,this.startFromEven=!0,se.constructResult(this.decodeRow2pairs(t,e))}reset(){this.pairs.length=0,this.rows.length=0}decodeRow2pairs(t,e){let n,r=!1;while(!r)try{this.pairs.push(this.retrieveNextPair(e,this.pairs,t))}catch(i){if(i instanceof N){if(!this.pairs.length)throw new N;r=!0}}if(this.checkChecksum())return this.pairs;if(n=!!this.rows.length,this.storeRow(t,!1),n){let t=this.checkRowsBoolean(!1);if(null!=t)return t;if(t=this.checkRowsBoolean(!0),null!=t)return t}throw new N}checkRowsBoolean(t){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,t&&(this.rows=this.rows.reverse());let e=null;try{e=this.checkRows(new Array,0)}catch(n){this.verbose&&console.log(n)}return t&&(this.rows=this.rows.reverse()),e}checkRows(t,e){for(let r=e;r<this.rows.length;r++){let e=this.rows[r];this.pairs.length=0;for(let n of t)this.pairs.push(n.getPairs());if(this.pairs.push(e.getPairs()),!se.isValidSequence(this.pairs))continue;if(this.checkChecksum())return this.pairs;let i=new Array(t);i.push(e);try{return this.checkRows(i,r+1)}catch(n){this.verbose&&console.log(n)}}throw new N}static isValidSequence(t){for(let e of se.FINDER_PATTERN_SEQUENCES){if(t.length>e.length)continue;let n=!0;for(let r=0;r<t.length;r++)if(t[r].getFinderPattern().getValue()!=e[r]){n=!1;break}if(n)return!0}return!1}storeRow(t,e){let n=0,r=!1,i=!1;while(n<this.rows.length){let e=this.rows[n];if(e.getRowNumber()>t){i=e.isEquivalent(this.pairs);break}r=e.isEquivalent(this.pairs),n++}i||r||se.isPartialRow(this.pairs,this.rows)||(this.rows.push(n,new ie(this.pairs,t,e)),this.removePartialRows(this.pairs,this.rows))}removePartialRows(t,e){for(let n of e)if(n.getPairs().length!==t.length)for(let e of n.getPairs())for(let n of t)if(re.equals(e,n))break}static isPartialRow(t,e){for(let n of e){let e=!0;for(let r of t){let t=!1;for(let e of n.getPairs())if(r.equals(e)){t=!0;break}if(!t){e=!1;break}}if(e)return!0}return!1}getRows(){return this.rows}static constructResult(t){let e=Bt.buildBitArray(t),n=ne(e),r=n.parseInformation(),i=t[0].getFinderPattern().getResultPoints(),s=t[t.length-1].getFinderPattern().getResultPoints(),o=[i[0],i[1],s[0],s[1]];return new z(r,null,null,o,j.RSS_EXPANDED,null)}checkChecksum(){let t=this.pairs.get(0),e=t.getLeftChar(),n=t.getRightChar();if(null==n)return!1;let r=n.getChecksumPortion(),i=2;for(let o=1;o<this.pairs.size();++o){let t=this.pairs.get(o);r+=t.getLeftChar().getChecksumPortion(),i++;let e=t.getRightChar();null!=e&&(r+=e.getChecksumPortion(),i++)}r%=211;let s=211*(i-4)+r;return s==e.getValue()}static getNextSecondBar(t,e){let n;return t.get(e)?(n=t.getNextUnset(e),n=t.getNextSet(n)):(n=t.getNextSet(e),n=t.getNextUnset(n)),n}retrieveNextPair(t,e,n){let r,i=e.length%2==0;this.startFromEven&&(i=!i);let s=!0,o=-1;do{this.findNextPair(t,e,o),r=this.parseFoundFinderPattern(t,n,i),null==r?o=se.getNextSecondBar(t,this.startEnd[0]):s=!1}while(s);let a,c=this.decodeDataCharacter(t,r,i,!0);if(!this.isEmptyPair(e)&&e[e.length-1].mustBeLast())throw new N;try{a=this.decodeDataCharacter(t,r,i,!1)}catch(l){a=null,this.verbose&&console.log(l)}return new re(c,a,r,!0)}isEmptyPair(t){return 0===t.length}findNextPair(t,e,n){let r=this.getDecodeFinderCounters();r[0]=0,r[1]=0,r[2]=0,r[3]=0;let i,s=t.getSize();if(n>=0)i=n;else if(this.isEmptyPair(e))i=0;else{let t=e[e.length-1];i=t.getFinderPattern().getStartEnd()[1]}let o=e.length%2!=0;this.startFromEven&&(o=!o);let a=!1;while(i<s){if(a=!t.get(i),!a)break;i++}let c=0,l=i;for(let u=i;u<s;u++)if(t.get(u)!=a)r[c]++;else{if(3==c){if(o&&se.reverseCounters(r),se.isFinderPattern(r))return this.startEnd[0]=l,void(this.startEnd[1]=u);o&&se.reverseCounters(r),l+=r[0]+r[1],r[0]=r[2],r[1]=r[3],r[2]=0,r[3]=0,c--}else c++;r[c]=1,a=!a}throw new N}static reverseCounters(t){let e=t.length;for(let n=0;n<e/2;++n){let r=t[n];t[n]=t[e-n-1],t[e-n-1]=r}}parseFoundFinderPattern(t,e,n){let r,i,s;if(n){let e=this.startEnd[0]-1;while(e>=0&&!t.get(e))e--;e++,r=this.startEnd[0]-e,i=e,s=this.startEnd[1]}else i=this.startEnd[0],s=t.getNextUnset(this.startEnd[1]+1),r=s-this.startEnd[1];let o,a=this.getDecodeFinderCounters();g.arraycopy(a,0,a,1,a.length-1),a[0]=r;try{o=this.parseFinderValue(a,se.FINDER_PATTERNS)}catch(c){return null}return new Mt(o,[i,s],i,s,e)}decodeDataCharacter(t,e,n,r){let i=this.getDataCharacterCounters();for(let C=0;C<i.length;C++)i[C]=0;if(r)se.recordPatternInReverse(t,e.getStartEnd()[0],i);else{se.recordPattern(t,e.getStartEnd()[1],i);for(let t=0,e=i.length-1;t<e;t++,e--){let n=i[t];i[t]=i[e],i[e]=n}}let s=17,o=st.sum(new Int32Array(i))/s,a=(e.getStartEnd()[1]-e.getStartEnd()[0])/15;if(Math.abs(o-a)/a>.3)throw new N;let c=this.getOddCounts(),l=this.getEvenCounts(),u=this.getOddRoundingErrors(),h=this.getEvenRoundingErrors();for(let C=0;C<i.length;C++){let t=1*i[C]/o,e=t+.5;if(e<1){if(t<.3)throw new N;e=1}else if(e>8){if(t>8.7)throw new N;e=8}let n=C/2;0==(1&C)?(c[n]=e,u[n]=t-e):(l[n]=e,h[n]=t-e)}this.adjustOddEvenCounts(s);let d=4*e.getValue()+(n?0:2)+(r?0:1)-1,f=0,p=0;for(let C=c.length-1;C>=0;C--){if(se.isNotA1left(e,n,r)){let t=se.WEIGHTS[d][2*C];p+=c[C]*t}f+=c[C]}let g=0;for(let C=l.length-1;C>=0;C--)if(se.isNotA1left(e,n,r)){let t=se.WEIGHTS[d][2*C+1];g+=l[C]*t}let m=p+g;if(0!=(1&f)||f>13||f<4)throw new N;let y=(13-f)/2,w=se.SYMBOL_WIDEST[y],b=9-w,v=Lt.getRSSvalue(c,w,!0),E=Lt.getRSSvalue(l,b,!1),_=se.EVEN_TOTAL_SUBSET[y],S=se.GSUM[y],A=v*_+E+S;return new xt(A,m)}static isNotA1left(t,e,n){return!(0==t.getValue()&&e&&n)}adjustOddEvenCounts(t){let e=st.sum(new Int32Array(this.getOddCounts())),n=st.sum(new Int32Array(this.getEvenCounts())),r=!1,i=!1;e>13?i=!0:e<4&&(r=!0);let s=!1,o=!1;n>13?o=!0:n<4&&(s=!0);let a=e+n-t,c=1==(1&e),l=0==(1&n);if(1==a)if(c){if(l)throw new N;i=!0}else{if(!l)throw new N;o=!0}else if(-1==a)if(c){if(l)throw new N;r=!0}else{if(!l)throw new N;s=!0}else{if(0!=a)throw new N;if(c){if(!l)throw new N;e<n?(r=!0,o=!0):(i=!0,s=!0)}else if(l)throw new N}if(r){if(i)throw new N;se.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(i&&se.decrement(this.getOddCounts(),this.getOddRoundingErrors()),s){if(o)throw new N;se.increment(this.getEvenCounts(),this.getOddRoundingErrors())}o&&se.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}se.SYMBOL_WIDEST=[7,5,4,3,1],se.EVEN_TOTAL_SUBSET=[4,20,52,104,204],se.GSUM=[0,348,1388,2948,3988],se.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],se.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],se.FINDER_PAT_A=0,se.FINDER_PAT_B=1,se.FINDER_PAT_C=2,se.FINDER_PAT_D=3,se.FINDER_PAT_E=4,se.FINDER_PAT_F=5,se.FINDER_PATTERN_SEQUENCES=[[se.FINDER_PAT_A,se.FINDER_PAT_A],[se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B],[se.FINDER_PAT_A,se.FINDER_PAT_C,se.FINDER_PAT_B,se.FINDER_PAT_D],[se.FINDER_PAT_A,se.FINDER_PAT_E,se.FINDER_PAT_B,se.FINDER_PAT_D,se.FINDER_PAT_C],[se.FINDER_PAT_A,se.FINDER_PAT_E,se.FINDER_PAT_B,se.FINDER_PAT_D,se.FINDER_PAT_D,se.FINDER_PAT_F],[se.FINDER_PAT_A,se.FINDER_PAT_E,se.FINDER_PAT_B,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_F,se.FINDER_PAT_F],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_D],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_E],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_F,se.FINDER_PAT_F],[se.FINDER_PAT_A,se.FINDER_PAT_A,se.FINDER_PAT_B,se.FINDER_PAT_B,se.FINDER_PAT_C,se.FINDER_PAT_D,se.FINDER_PAT_D,se.FINDER_PAT_E,se.FINDER_PAT_E,se.FINDER_PAT_F,se.FINDER_PAT_F]],se.MAX_PAIRS=11;class oe extends xt{constructor(t,e,n){super(t,e),this.count=0,this.finderPattern=n}getFinderPattern(){return this.finderPattern}getCount(){return this.count}incrementCount(){this.count++}}class ae extends Pt{constructor(){super(...arguments),this.possibleLeftPairs=[],this.possibleRightPairs=[]}decodeRow(t,e,n){const r=this.decodePair(e,!1,t,n);ae.addOrTally(this.possibleLeftPairs,r),e.reverse();let i=this.decodePair(e,!0,t,n);ae.addOrTally(this.possibleRightPairs,i),e.reverse();for(let s of this.possibleLeftPairs)if(s.getCount()>1)for(let t of this.possibleRightPairs)if(t.getCount()>1&&ae.checkChecksum(s,t))return ae.constructResult(s,t);throw new N}static addOrTally(t,e){if(null==e)return;let n=!1;for(let r of t)if(r.getValue()===e.getValue()){r.incrementCount(),n=!0;break}n||t.push(e)}reset(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0}static constructResult(t,e){let n=4537077*t.getValue()+e.getValue(),r=new String(n).toString(),i=new k;for(let c=13-r.length;c>0;c--)i.append("0");i.append(r);let s=0;for(let c=0;c<13;c++){let t=i.charAt(c).charCodeAt(0)-"0".charCodeAt(0);s+=0===(1&c)?3*t:t}s=10-s%10,10===s&&(s=0),i.append(s.toString());let o=t.getFinderPattern().getResultPoints(),a=e.getFinderPattern().getResultPoints();return new z(i.toString(),null,0,[o[0],o[1],a[0],a[1]],j.RSS_14,(new Date).getTime())}static checkChecksum(t,e){let n=(t.getChecksumPortion()+16*e.getChecksumPortion())%79,r=9*t.getFinderPattern().getValue()+e.getFinderPattern().getValue();return r>72&&r--,r>8&&r--,n===r}decodePair(t,e,n,r){try{let i=this.findFinderPattern(t,e),s=this.parseFoundFinderPattern(t,n,e,i),o=null==r?null:r.get(_.NEED_RESULT_POINT_CALLBACK);if(null!=o){let r=(i[0]+i[1])/2;e&&(r=t.getSize()-1-r),o.foundPossibleResultPoint(new at(r,n))}let a=this.decodeDataCharacter(t,s,!0),c=this.decodeDataCharacter(t,s,!1);return new oe(1597*a.getValue()+c.getValue(),a.getChecksumPortion()+4*c.getChecksumPortion(),s)}catch(i){return null}}decodeDataCharacter(t,e,n){let r=this.getDataCharacterCounters();for(let g=0;g<r.length;g++)r[g]=0;if(n)bt.recordPatternInReverse(t,e.getStartEnd()[0],r);else{bt.recordPattern(t,e.getStartEnd()[1]+1,r);for(let t=0,e=r.length-1;t<e;t++,e--){let n=r[t];r[t]=r[e],r[e]=n}}let i=n?16:15,s=st.sum(new Int32Array(r))/i,o=this.getOddCounts(),a=this.getEvenCounts(),c=this.getOddRoundingErrors(),l=this.getEvenRoundingErrors();for(let g=0;g<r.length;g++){let t=r[g]/s,e=Math.floor(t+.5);e<1?e=1:e>8&&(e=8);let n=Math.floor(g/2);0===(1&g)?(o[n]=e,c[n]=t-e):(a[n]=e,l[n]=t-e)}this.adjustOddEvenCounts(n,i);let u=0,h=0;for(let g=o.length-1;g>=0;g--)h*=9,h+=o[g],u+=o[g];let d=0,f=0;for(let g=a.length-1;g>=0;g--)d*=9,d+=a[g],f+=a[g];let p=h+3*d;if(n){if(0!==(1&u)||u>12||u<4)throw new N;let t=(12-u)/2,e=ae.OUTSIDE_ODD_WIDEST[t],n=9-e,r=Lt.getRSSvalue(o,e,!1),i=Lt.getRSSvalue(a,n,!0),s=ae.OUTSIDE_EVEN_TOTAL_SUBSET[t],c=ae.OUTSIDE_GSUM[t];return new xt(r*s+i+c,p)}{if(0!==(1&f)||f>10||f<4)throw new N;let t=(10-f)/2,e=ae.INSIDE_ODD_WIDEST[t],n=9-e,r=Lt.getRSSvalue(o,e,!0),i=Lt.getRSSvalue(a,n,!1),s=ae.INSIDE_ODD_TOTAL_SUBSET[t],c=ae.INSIDE_GSUM[t];return new xt(i*s+r+c,p)}}findFinderPattern(t,e){let n=this.getDecodeFinderCounters();n[0]=0,n[1]=0,n[2]=0,n[3]=0;let r=t.getSize(),i=!1,s=0;while(s<r){if(i=!t.get(s),e===i)break;s++}let o=0,a=s;for(let c=s;c<r;c++)if(t.get(c)!==i)n[o]++;else{if(3===o){if(Pt.isFinderPattern(n))return[a,c];a+=n[0]+n[1],n[0]=n[2],n[1]=n[3],n[2]=0,n[3]=0,o--}else o++;n[o]=1,i=!i}throw new N}parseFoundFinderPattern(t,e,n,r){let i=t.get(r[0]),s=r[0]-1;while(s>=0&&i!==t.get(s))s--;s++;const o=r[0]-s,a=this.getDecodeFinderCounters(),c=new Int32Array(a.length);g.arraycopy(a,0,c,1,a.length-1),c[0]=o;const l=this.parseFinderValue(c,ae.FINDER_PATTERNS);let u=s,h=r[1];return n&&(u=t.getSize()-1-u,h=t.getSize()-1-h),new Mt(l,[s,r[1]],u,h,e)}adjustOddEvenCounts(t,e){let n=st.sum(new Int32Array(this.getOddCounts())),r=st.sum(new Int32Array(this.getEvenCounts())),i=!1,s=!1,o=!1,a=!1;t?(n>12?s=!0:n<4&&(i=!0),r>12?a=!0:r<4&&(o=!0)):(n>11?s=!0:n<5&&(i=!0),r>10?a=!0:r<4&&(o=!0));let c=n+r-e,l=(1&n)===(t?1:0),u=1===(1&r);if(1===c)if(l){if(u)throw new N;s=!0}else{if(!u)throw new N;a=!0}else if(-1===c)if(l){if(u)throw new N;i=!0}else{if(!u)throw new N;o=!0}else{if(0!==c)throw new N;if(l){if(!u)throw new N;n<r?(i=!0,a=!0):(s=!0,o=!0)}else if(u)throw new N}if(i){if(s)throw new N;Pt.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(s&&Pt.decrement(this.getOddCounts(),this.getOddRoundingErrors()),o){if(a)throw new N;Pt.increment(this.getEvenCounts(),this.getOddRoundingErrors())}a&&Pt.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())}}ae.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],ae.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],ae.OUTSIDE_GSUM=[0,161,961,2015,2715],ae.INSIDE_GSUM=[0,336,1036,1516],ae.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],ae.INSIDE_ODD_WIDEST=[2,4,6,8],ae.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])];class ce extends bt{constructor(t,e){super(),this.readers=[],this.verbose=!0===e;const n=t?t.get(_.POSSIBLE_FORMATS):null,r=t&&void 0!==t.get(_.ASSUME_CODE_39_CHECK_DIGIT);n?((n.includes(j.EAN_13)||n.includes(j.UPC_A)||n.includes(j.EAN_8)||n.includes(j.UPC_E))&&this.readers.push(new Ot(t)),n.includes(j.CODE_39)&&this.readers.push(new Et(r)),n.includes(j.CODE_128)&&this.readers.push(new vt),n.includes(j.ITF)&&this.readers.push(new _t),n.includes(j.RSS_14)&&this.readers.push(new ae),n.includes(j.RSS_EXPANDED)&&this.readers.push(new se(this.verbose))):(this.readers.push(new Ot(t)),this.readers.push(new Et),this.readers.push(new Ot(t)),this.readers.push(new vt),this.readers.push(new _t),this.readers.push(new ae),this.readers.push(new se(this.verbose)))}decodeRow(t,e,n){for(let i=0;i<this.readers.length;i++)try{return this.readers[i].decodeRow(t,e,n)}catch(r){}throw new N}reset(){this.readers.forEach((t=>t.reset()))}}class le extends F{constructor(t=500,e){super(new ce(e),t,e)}}class ue{constructor(t,e,n){this.ecCodewords=t,this.ecBlocks=[e],n&&this.ecBlocks.push(n)}getECCodewords(){return this.ecCodewords}getECBlocks(){return this.ecBlocks}}class he{constructor(t,e){this.count=t,this.dataCodewords=e}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class de{constructor(t,e,n,r,i,s){this.versionNumber=t,this.symbolSizeRows=e,this.symbolSizeColumns=n,this.dataRegionSizeRows=r,this.dataRegionSizeColumns=i,this.ecBlocks=s;let o=0;const a=s.getECCodewords(),c=s.getECBlocks();for(let l of c)o+=l.getCount()*(l.getDataCodewords()+a);this.totalCodewords=o}getVersionNumber(){return this.versionNumber}getSymbolSizeRows(){return this.symbolSizeRows}getSymbolSizeColumns(){return this.symbolSizeColumns}getDataRegionSizeRows(){return this.dataRegionSizeRows}getDataRegionSizeColumns(){return this.dataRegionSizeColumns}getTotalCodewords(){return this.totalCodewords}getECBlocks(){return this.ecBlocks}static getVersionForDimensions(t,e){if(0!==(1&t)||0!==(1&e))throw new S;for(let n of de.VERSIONS)if(n.symbolSizeRows===t&&n.symbolSizeColumns===e)return n;throw new S}toString(){return""+this.versionNumber}static buildVersions(){return[new de(1,10,10,8,8,new ue(5,new he(1,3))),new de(2,12,12,10,10,new ue(7,new he(1,5))),new de(3,14,14,12,12,new ue(10,new he(1,8))),new de(4,16,16,14,14,new ue(12,new he(1,12))),new de(5,18,18,16,16,new ue(14,new he(1,18))),new de(6,20,20,18,18,new ue(18,new he(1,22))),new de(7,22,22,20,20,new ue(20,new he(1,30))),new de(8,24,24,22,22,new ue(24,new he(1,36))),new de(9,26,26,24,24,new ue(28,new he(1,44))),new de(10,32,32,14,14,new ue(36,new he(1,62))),new de(11,36,36,16,16,new ue(42,new he(1,86))),new de(12,40,40,18,18,new ue(48,new he(1,114))),new de(13,44,44,20,20,new ue(56,new he(1,144))),new de(14,48,48,22,22,new ue(68,new he(1,174))),new de(15,52,52,24,24,new ue(42,new he(2,102))),new de(16,64,64,14,14,new ue(56,new he(2,140))),new de(17,72,72,16,16,new ue(36,new he(4,92))),new de(18,80,80,18,18,new ue(48,new he(4,114))),new de(19,88,88,20,20,new ue(56,new he(4,144))),new de(20,96,96,22,22,new ue(68,new he(4,174))),new de(21,104,104,24,24,new ue(56,new he(6,136))),new de(22,120,120,18,18,new ue(68,new he(6,175))),new de(23,132,132,20,20,new ue(62,new he(8,163))),new de(24,144,144,22,22,new ue(62,new he(8,156),new he(2,155))),new de(25,8,18,6,16,new ue(7,new he(1,5))),new de(26,8,32,6,14,new ue(11,new he(1,10))),new de(27,12,26,10,24,new ue(14,new he(1,16))),new de(28,12,36,10,16,new ue(18,new he(1,22))),new de(29,16,36,14,16,new ue(24,new he(1,32))),new de(30,16,48,14,22,new ue(28,new he(1,49)))]}}de.VERSIONS=de.buildVersions();class fe{constructor(t){const e=t.getHeight();if(e<8||e>144||0!==(1&e))throw new S;this.version=fe.readVersion(t),this.mappingBitMatrix=this.extractDataRegion(t),this.readMappingMatrix=new R(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}getVersion(){return this.version}static readVersion(t){const e=t.getHeight(),n=t.getWidth();return de.getVersionForDimensions(e,n)}readCodewords(){const t=new Int8Array(this.version.getTotalCodewords());let e=0,n=4,r=0;const i=this.mappingBitMatrix.getHeight(),s=this.mappingBitMatrix.getWidth();let o=!1,a=!1,c=!1,l=!1;do{if(n!==i||0!==r||o)if(n!==i-2||0!==r||0===(3&s)||a)if(n!==i+4||2!==r||0!==(7&s)||c)if(n!==i-2||0!==r||4!==(7&s)||l){do{n<i&&r>=0&&!this.readMappingMatrix.get(r,n)&&(t[e++]=255&this.readUtah(n,r,i,s)),n-=2,r+=2}while(n>=0&&r<s);n+=1,r+=3;do{n>=0&&r<s&&!this.readMappingMatrix.get(r,n)&&(t[e++]=255&this.readUtah(n,r,i,s)),n+=2,r-=2}while(n<i&&r>=0);n+=3,r+=1}else t[e++]=255&this.readCorner4(i,s),n-=2,r+=2,l=!0;else t[e++]=255&this.readCorner3(i,s),n-=2,r+=2,c=!0;else t[e++]=255&this.readCorner2(i,s),n-=2,r+=2,a=!0;else t[e++]=255&this.readCorner1(i,s),n-=2,r+=2,o=!0}while(n<i||r<s);if(e!==this.version.getTotalCodewords())throw new S;return t}readModule(t,e,n,r){return t<0&&(t+=n,e+=4-(n+4&7)),e<0&&(e+=r,t+=4-(r+4&7)),this.readMappingMatrix.set(e,t),this.mappingBitMatrix.get(e,t)}readUtah(t,e,n,r){let i=0;return this.readModule(t-2,e-2,n,r)&&(i|=1),i<<=1,this.readModule(t-2,e-1,n,r)&&(i|=1),i<<=1,this.readModule(t-1,e-2,n,r)&&(i|=1),i<<=1,this.readModule(t-1,e-1,n,r)&&(i|=1),i<<=1,this.readModule(t-1,e,n,r)&&(i|=1),i<<=1,this.readModule(t,e-2,n,r)&&(i|=1),i<<=1,this.readModule(t,e-1,n,r)&&(i|=1),i<<=1,this.readModule(t,e,n,r)&&(i|=1),i}readCorner1(t,e){let n=0;return this.readModule(t-1,0,t,e)&&(n|=1),n<<=1,this.readModule(t-1,1,t,e)&&(n|=1),n<<=1,this.readModule(t-1,2,t,e)&&(n|=1),n<<=1,this.readModule(0,e-2,t,e)&&(n|=1),n<<=1,this.readModule(0,e-1,t,e)&&(n|=1),n<<=1,this.readModule(1,e-1,t,e)&&(n|=1),n<<=1,this.readModule(2,e-1,t,e)&&(n|=1),n<<=1,this.readModule(3,e-1,t,e)&&(n|=1),n}readCorner2(t,e){let n=0;return this.readModule(t-3,0,t,e)&&(n|=1),n<<=1,this.readModule(t-2,0,t,e)&&(n|=1),n<<=1,this.readModule(t-1,0,t,e)&&(n|=1),n<<=1,this.readModule(0,e-4,t,e)&&(n|=1),n<<=1,this.readModule(0,e-3,t,e)&&(n|=1),n<<=1,this.readModule(0,e-2,t,e)&&(n|=1),n<<=1,this.readModule(0,e-1,t,e)&&(n|=1),n<<=1,this.readModule(1,e-1,t,e)&&(n|=1),n}readCorner3(t,e){let n=0;return this.readModule(t-1,0,t,e)&&(n|=1),n<<=1,this.readModule(t-1,e-1,t,e)&&(n|=1),n<<=1,this.readModule(0,e-3,t,e)&&(n|=1),n<<=1,this.readModule(0,e-2,t,e)&&(n|=1),n<<=1,this.readModule(0,e-1,t,e)&&(n|=1),n<<=1,this.readModule(1,e-3,t,e)&&(n|=1),n<<=1,this.readModule(1,e-2,t,e)&&(n|=1),n<<=1,this.readModule(1,e-1,t,e)&&(n|=1),n}readCorner4(t,e){let n=0;return this.readModule(t-3,0,t,e)&&(n|=1),n<<=1,this.readModule(t-2,0,t,e)&&(n|=1),n<<=1,this.readModule(t-1,0,t,e)&&(n|=1),n<<=1,this.readModule(0,e-2,t,e)&&(n|=1),n<<=1,this.readModule(0,e-1,t,e)&&(n|=1),n<<=1,this.readModule(1,e-1,t,e)&&(n|=1),n<<=1,this.readModule(2,e-1,t,e)&&(n|=1),n<<=1,this.readModule(3,e-1,t,e)&&(n|=1),n}extractDataRegion(t){const e=this.version.getSymbolSizeRows(),n=this.version.getSymbolSizeColumns();if(t.getHeight()!==e)throw new h("Dimension of bitMatrix must match the version size");const r=this.version.getDataRegionSizeRows(),i=this.version.getDataRegionSizeColumns(),s=e/r|0,o=n/i|0,a=s*r,c=o*i,l=new R(c,a);for(let u=0;u<s;++u){const e=u*r;for(let n=0;n<o;++n){const s=n*i;for(let o=0;o<r;++o){const a=u*(r+2)+1+o,c=e+o;for(let e=0;e<i;++e){const r=n*(i+2)+1+e;if(t.get(r,a)){const t=s+e;l.set(t,c)}}}}}return l}}class pe{constructor(t,e){this.numDataCodewords=t,this.codewords=e}static getDataBlocks(t,e){const n=e.getECBlocks();let r=0;const i=n.getECBlocks();for(let h of i)r+=h.getCount();const s=new Array(r);let o=0;for(let h of i)for(let t=0;t<h.getCount();t++){const t=h.getDataCodewords(),e=n.getECCodewords()+t;s[o++]=new pe(t,new Uint8Array(e))}const a=s[0].codewords.length,c=a-n.getECCodewords(),l=c-1;let u=0;for(let h=0;h<l;h++)for(let e=0;e<o;e++)s[e].codewords[h]=t[u++];const d=24===e.getVersionNumber(),f=d?8:o;for(let h=0;h<f;h++)s[h].codewords[c-1]=t[u++];const p=s[0].codewords.length;for(let h=c;h<p;h++)for(let e=0;e<o;e++){const n=d?(e+8)%o:e,r=d&&n>7?h-1:h;s[n].codewords[r]=t[u++]}if(u!==t.length)throw new h;return s}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}class ge{constructor(t){this.bytes=t,this.byteOffset=0,this.bitOffset=0}getBitOffset(){return this.bitOffset}getByteOffset(){return this.byteOffset}readBits(t){if(t<1||t>32||t>this.available())throw new h(""+t);let e=0,n=this.bitOffset,r=this.byteOffset;const i=this.bytes;if(n>0){const s=8-n,o=t<s?t:s,a=s-o,c=255>>8-o<<a;e=(i[r]&c)>>a,t-=o,n+=o,8===n&&(n=0,r++)}if(t>0){while(t>=8)e=e<<8|255&i[r],r++,t-=8;if(t>0){const s=8-t,o=255>>s<<s;e=e<<t|(i[r]&o)>>s,n+=t}}return this.bitOffset=n,this.byteOffset=r,e}available(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset}}(function(t){t[t["PAD_ENCODE"]=0]="PAD_ENCODE",t[t["ASCII_ENCODE"]=1]="ASCII_ENCODE",t[t["C40_ENCODE"]=2]="C40_ENCODE",t[t["TEXT_ENCODE"]=3]="TEXT_ENCODE",t[t["ANSIX12_ENCODE"]=4]="ANSIX12_ENCODE",t[t["EDIFACT_ENCODE"]=5]="EDIFACT_ENCODE",t[t["BASE256_ENCODE"]=6]="BASE256_ENCODE"})($||($={}));class me{static decode(t){const e=new ge(t),n=new k,r=new k,i=new Array;let s=$.ASCII_ENCODE;do{if(s===$.ASCII_ENCODE)s=this.decodeAsciiSegment(e,n,r);else{switch(s){case $.C40_ENCODE:this.decodeC40Segment(e,n);break;case $.TEXT_ENCODE:this.decodeTextSegment(e,n);break;case $.ANSIX12_ENCODE:this.decodeAnsiX12Segment(e,n);break;case $.EDIFACT_ENCODE:this.decodeEdifactSegment(e,n);break;case $.BASE256_ENCODE:this.decodeBase256Segment(e,n,i);break;default:throw new S}s=$.ASCII_ENCODE}}while(s!==$.PAD_ENCODE&&e.available()>0);return r.length()>0&&n.append(r.toString()),new X(t,n.toString(),0===i.length?null:i,null)}static decodeAsciiSegment(t,e,n){let r=!1;do{let i=t.readBits(8);if(0===i)throw new S;if(i<=128)return r&&(i+=128),e.append(String.fromCharCode(i-1)),$.ASCII_ENCODE;if(129===i)return $.PAD_ENCODE;if(i<=229){const t=i-130;t<10&&e.append("0"),e.append(""+t)}else switch(i){case 230:return $.C40_ENCODE;case 231:return $.BASE256_ENCODE;case 232:e.append(String.fromCharCode(29));break;case 233:case 234:break;case 235:r=!0;break;case 236:e.append("[)>05"),n.insert(0,"");break;case 237:e.append("[)>06"),n.insert(0,"");break;case 238:return $.ANSIX12_ENCODE;case 239:return $.TEXT_ENCODE;case 240:return $.EDIFACT_ENCODE;case 241:break;default:if(254!==i||0!==t.available())throw new S;break}}while(t.available()>0);return $.ASCII_ENCODE}static decodeC40Segment(t,e){let n=!1;const r=[];let i=0;do{if(8===t.available())return;const s=t.readBits(8);if(254===s)return;this.parseTwoBytes(s,t.readBits(8),r);for(let t=0;t<3;t++){const s=r[t];switch(i){case 0:if(s<3)i=s+1;else{if(!(s<this.C40_BASIC_SET_CHARS.length))throw new S;{const t=this.C40_BASIC_SET_CHARS[s];n?(e.append(String.fromCharCode(t.charCodeAt(0)+128)),n=!1):e.append(t)}}break;case 1:n?(e.append(String.fromCharCode(s+128)),n=!1):e.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.C40_SHIFT2_SET_CHARS.length){const t=this.C40_SHIFT2_SET_CHARS[s];n?(e.append(String.fromCharCode(t.charCodeAt(0)+128)),n=!1):e.append(t)}else switch(s){case 27:e.append(String.fromCharCode(29));break;case 30:n=!0;break;default:throw new S}i=0;break;case 3:n?(e.append(String.fromCharCode(s+224)),n=!1):e.append(String.fromCharCode(s+96)),i=0;break;default:throw new S}}}while(t.available()>0)}static decodeTextSegment(t,e){let n=!1,r=[],i=0;do{if(8===t.available())return;const s=t.readBits(8);if(254===s)return;this.parseTwoBytes(s,t.readBits(8),r);for(let t=0;t<3;t++){const s=r[t];switch(i){case 0:if(s<3)i=s+1;else{if(!(s<this.TEXT_BASIC_SET_CHARS.length))throw new S;{const t=this.TEXT_BASIC_SET_CHARS[s];n?(e.append(String.fromCharCode(t.charCodeAt(0)+128)),n=!1):e.append(t)}}break;case 1:n?(e.append(String.fromCharCode(s+128)),n=!1):e.append(String.fromCharCode(s)),i=0;break;case 2:if(s<this.TEXT_SHIFT2_SET_CHARS.length){const t=this.TEXT_SHIFT2_SET_CHARS[s];n?(e.append(String.fromCharCode(t.charCodeAt(0)+128)),n=!1):e.append(t)}else switch(s){case 27:e.append(String.fromCharCode(29));break;case 30:n=!0;break;default:throw new S}i=0;break;case 3:if(!(s<this.TEXT_SHIFT3_SET_CHARS.length))throw new S;{const t=this.TEXT_SHIFT3_SET_CHARS[s];n?(e.append(String.fromCharCode(t.charCodeAt(0)+128)),n=!1):e.append(t),i=0}break;default:throw new S}}}while(t.available()>0)}static decodeAnsiX12Segment(t,e){const n=[];do{if(8===t.available())return;const r=t.readBits(8);if(254===r)return;this.parseTwoBytes(r,t.readBits(8),n);for(let t=0;t<3;t++){const r=n[t];switch(r){case 0:e.append("\r");break;case 1:e.append("*");break;case 2:e.append(">");break;case 3:e.append(" ");break;default:if(r<14)e.append(String.fromCharCode(r+44));else{if(!(r<40))throw new S;e.append(String.fromCharCode(r+51))}break}}}while(t.available()>0)}static parseTwoBytes(t,e,n){let r=(t<<8)+e-1,i=Math.floor(r/1600);n[0]=i,r-=1600*i,i=Math.floor(r/40),n[1]=i,n[2]=r-40*i}static decodeEdifactSegment(t,e){do{if(t.available()<=16)return;for(let n=0;n<4;n++){let n=t.readBits(6);if(31===n){const e=8-t.getBitOffset();return void(8!==e&&t.readBits(e))}0===(32&n)&&(n|=64),e.append(String.fromCharCode(n))}}while(t.available()>0)}static decodeBase256Segment(t,e,n){let r=1+t.getByteOffset();const i=this.unrandomize255State(t.readBits(8),r++);let s;if(s=0===i?t.available()/8|0:i<250?i:250*(i-249)+this.unrandomize255State(t.readBits(8),r++),s<0)throw new S;const o=new Uint8Array(s);for(let c=0;c<s;c++){if(t.available()<8)throw new S;o[c]=this.unrandomize255State(t.readBits(8),r++)}n.push(o);try{e.append(I.decode(o,T.ISO88591))}catch(a){throw new nt("Platform does not support required encoding: "+a.message)}}static unrandomize255State(t,e){const n=149*e%255+1,r=t-n;return r>=0?r:r+256}}me.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],me.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],me.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],me.TEXT_SHIFT2_SET_CHARS=me.C40_SHIFT2_SET_CHARS,me.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",String.fromCharCode(127)];class ye{constructor(){this.rsDecoder=new rt(tt.DATA_MATRIX_FIELD_256)}decode(t){const e=new fe(t),n=e.getVersion(),r=e.readCodewords(),i=pe.getDataBlocks(r,n);let s=0;for(let c of i)s+=c.getNumDataCodewords();const o=new Uint8Array(s),a=i.length;for(let c=0;c<a;c++){const t=i[c],e=t.getCodewords(),n=t.getNumDataCodewords();this.correctErrors(e,n);for(let r=0;r<n;r++)o[r*a+c]=e[r]}return me.decode(o)}correctErrors(t,e){const n=new Int32Array(t);try{this.rsDecoder.decode(n,t.length-e)}catch(r){throw new f}for(let i=0;i<e;i++)t[i]=n[i]}}class we{constructor(t){this.image=t,this.rectangleDetector=new ut(this.image)}detect(){const t=this.rectangleDetector.detect();let e=this.detectSolid1(t);if(e=this.detectSolid2(e),e[3]=this.correctTopRight(e),!e[3])throw new N;e=this.shiftToModuleCenter(e);const n=e[0],r=e[1],i=e[2],s=e[3];let o=this.transitionsBetween(n,s)+1,a=this.transitionsBetween(i,s)+1;1===(1&o)&&(o+=1),1===(1&a)&&(a+=1),4*o<7*a&&4*a<7*o&&(o=a=Math.max(o,a));let c=we.sampleGrid(this.image,n,r,i,s,o,a);return new ct(c,[n,r,i,s])}static shiftPoint(t,e,n){let r=(e.getX()-t.getX())/(n+1),i=(e.getY()-t.getY())/(n+1);return new at(t.getX()+r,t.getY()+i)}static moveAway(t,e,n){let r=t.getX(),i=t.getY();return r<e?r-=1:r+=1,i<n?i-=1:i+=1,new at(r,i)}detectSolid1(t){let e=t[0],n=t[1],r=t[3],i=t[2],s=this.transitionsBetween(e,n),o=this.transitionsBetween(n,r),a=this.transitionsBetween(r,i),c=this.transitionsBetween(i,e),l=s,u=[i,e,n,r];return l>o&&(l=o,u[0]=e,u[1]=n,u[2]=r,u[3]=i),l>a&&(l=a,u[0]=n,u[1]=r,u[2]=i,u[3]=e),l>c&&(u[0]=r,u[1]=i,u[2]=e,u[3]=n),u}detectSolid2(t){let e=t[0],n=t[1],r=t[2],i=t[3],s=this.transitionsBetween(e,i),o=we.shiftPoint(n,r,4*(s+1)),a=we.shiftPoint(r,n,4*(s+1)),c=this.transitionsBetween(o,e),l=this.transitionsBetween(a,i);return c<l?(t[0]=e,t[1]=n,t[2]=r,t[3]=i):(t[0]=n,t[1]=r,t[2]=i,t[3]=e),t}correctTopRight(t){let e=t[0],n=t[1],r=t[2],i=t[3],s=this.transitionsBetween(e,i),o=this.transitionsBetween(n,i),a=we.shiftPoint(e,n,4*(o+1)),c=we.shiftPoint(r,n,4*(s+1));s=this.transitionsBetween(a,i),o=this.transitionsBetween(c,i);let l=new at(i.getX()+(r.getX()-n.getX())/(s+1),i.getY()+(r.getY()-n.getY())/(s+1)),u=new at(i.getX()+(e.getX()-n.getX())/(o+1),i.getY()+(e.getY()-n.getY())/(o+1));if(!this.isValid(l))return this.isValid(u)?u:null;if(!this.isValid(u))return l;let h=this.transitionsBetween(a,l)+this.transitionsBetween(c,l),d=this.transitionsBetween(a,u)+this.transitionsBetween(c,u);return h>d?l:u}shiftToModuleCenter(t){let e=t[0],n=t[1],r=t[2],i=t[3],s=this.transitionsBetween(e,i)+1,o=this.transitionsBetween(r,i)+1,a=we.shiftPoint(e,n,4*o),c=we.shiftPoint(r,n,4*s);s=this.transitionsBetween(a,i)+1,o=this.transitionsBetween(c,i)+1,1===(1&s)&&(s+=1),1===(1&o)&&(o+=1);let l,u,h=(e.getX()+n.getX()+r.getX()+i.getX())/4,d=(e.getY()+n.getY()+r.getY()+i.getY())/4;return e=we.moveAway(e,h,d),n=we.moveAway(n,h,d),r=we.moveAway(r,h,d),i=we.moveAway(i,h,d),a=we.shiftPoint(e,n,4*o),a=we.shiftPoint(a,i,4*s),l=we.shiftPoint(n,e,4*o),l=we.shiftPoint(l,r,4*s),c=we.shiftPoint(r,i,4*o),c=we.shiftPoint(c,n,4*s),u=we.shiftPoint(i,r,4*o),u=we.shiftPoint(u,e,4*s),[a,l,c,u]}isValid(t){return t.getX()>=0&&t.getX()<this.image.getWidth()&&t.getY()>0&&t.getY()<this.image.getHeight()}static sampleGrid(t,e,n,r,i,s,o){const a=pt.getInstance();return a.sampleGrid(t,s,o,.5,.5,s-.5,.5,s-.5,o-.5,.5,o-.5,e.getX(),e.getY(),i.getX(),i.getY(),r.getX(),r.getY(),n.getX(),n.getY())}transitionsBetween(t,e){let n=Math.trunc(t.getX()),r=Math.trunc(t.getY()),i=Math.trunc(e.getX()),s=Math.trunc(e.getY()),o=Math.abs(s-r)>Math.abs(i-n);if(o){let t=n;n=r,r=t,t=i,i=s,s=t}let a=Math.abs(i-n),c=Math.abs(s-r),l=-a/2,u=r<s?1:-1,h=n<i?1:-1,d=0,f=this.image.get(o?r:n,o?n:r);for(let p=n,g=r;p!==i;p+=h){let t=this.image.get(o?g:p,o?p:g);if(t!==f&&(d++,f=t),l+=c,l>0){if(g===s)break;g+=u,l-=a}}return d}}class be{constructor(){this.decoder=new ye}decode(t,e=null){let n,r;if(null!=e&&e.has(_.PURE_BARCODE)){const e=be.extractPureBits(t.getBlackMatrix());n=this.decoder.decode(e),r=be.NO_POINTS}else{const e=new we(t.getBlackMatrix()).detect();n=this.decoder.decode(e.getBits()),r=e.getPoints()}const i=n.getRawBytes(),s=new z(n.getText(),i,8*i.length,r,j.DATA_MATRIX,g.currentTimeMillis()),o=n.getByteSegments();null!=o&&s.putMetadata(Y.BYTE_SEGMENTS,o);const a=n.getECLevel();return null!=a&&s.putMetadata(Y.ERROR_CORRECTION_LEVEL,a),s}reset(){}static extractPureBits(t){const e=t.getTopLeftOnBit(),n=t.getBottomRightOnBit();if(null==e||null==n)throw new N;const r=this.moduleSize(e,t);let i=e[1];const s=n[1];let o=e[0];const a=n[0],c=(a-o+1)/r,l=(s-i+1)/r;if(c<=0||l<=0)throw new N;const u=r/2;i+=u,o+=u;const h=new R(c,l);for(let d=0;d<l;d++){const e=i+d*r;for(let n=0;n<c;n++)t.get(o+n*r,e)&&h.set(n,d)}return h}static moduleSize(t,e){const n=e.getWidth();let r=t[0];const i=t[1];while(r<n&&e.get(r,i))r++;if(r===n)throw new N;const s=r-t[0];if(0===s)throw new N;return s}}be.NO_POINTS=[];class ve extends F{constructor(t=500){super(new be,t)}}(function(t){t[t["L"]=0]="L",t[t["M"]=1]="M",t[t["Q"]=2]="Q",t[t["H"]=3]="H"})(K||(K={}));class Ee{constructor(t,e,n){this.value=t,this.stringValue=e,this.bits=n,Ee.FOR_BITS.set(n,this),Ee.FOR_VALUE.set(t,this)}getValue(){return this.value}getBits(){return this.bits}static fromString(t){switch(t){case"L":return Ee.L;case"M":return Ee.M;case"Q":return Ee.Q;case"H":return Ee.H;default:throw new u(t+"not available")}}toString(){return this.stringValue}equals(t){if(!(t instanceof Ee))return!1;const e=t;return this.value===e.value}static forBits(t){if(t<0||t>=Ee.FOR_BITS.size)throw new h;return Ee.FOR_BITS.get(t)}}Ee.FOR_BITS=new Map,Ee.FOR_VALUE=new Map,Ee.L=new Ee(K.L,"L",1),Ee.M=new Ee(K.M,"M",0),Ee.Q=new Ee(K.Q,"Q",3),Ee.H=new Ee(K.H,"H",2);class _e{constructor(t){this.errorCorrectionLevel=Ee.forBits(t>>3&3),this.dataMask=7&t}static numBitsDiffering(t,e){return b.bitCount(t^e)}static decodeFormatInformation(t,e){const n=_e.doDecodeFormatInformation(t,e);return null!==n?n:_e.doDecodeFormatInformation(t^_e.FORMAT_INFO_MASK_QR,e^_e.FORMAT_INFO_MASK_QR)}static doDecodeFormatInformation(t,e){let n=Number.MAX_SAFE_INTEGER,r=0;for(const i of _e.FORMAT_INFO_DECODE_LOOKUP){const s=i[0];if(s===t||s===e)return new _e(i[1]);let o=_e.numBitsDiffering(t,s);o<n&&(r=i[1],n=o),t!==e&&(o=_e.numBitsDiffering(e,s),o<n&&(r=i[1],n=o))}return n<=3?new _e(r):null}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getDataMask(){return this.dataMask}hashCode(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask}equals(t){if(!(t instanceof _e))return!1;const e=t;return this.errorCorrectionLevel===e.errorCorrectionLevel&&this.dataMask===e.dataMask}}_e.FORMAT_INFO_MASK_QR=21522,_e.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])];class Se{constructor(t,...e){this.ecCodewordsPerBlock=t,this.ecBlocks=e}getECCodewordsPerBlock(){return this.ecCodewordsPerBlock}getNumBlocks(){let t=0;const e=this.ecBlocks;for(const n of e)t+=n.getCount();return t}getTotalECCodewords(){return this.ecCodewordsPerBlock*this.getNumBlocks()}getECBlocks(){return this.ecBlocks}}class Ae{constructor(t,e){this.count=t,this.dataCodewords=e}getCount(){return this.count}getDataCodewords(){return this.dataCodewords}}class Ce{constructor(t,e,...n){this.versionNumber=t,this.alignmentPatternCenters=e,this.ecBlocks=n;let r=0;const i=n[0].getECCodewordsPerBlock(),s=n[0].getECBlocks();for(const o of s)r+=o.getCount()*(o.getDataCodewords()+i);this.totalCodewords=r}getVersionNumber(){return this.versionNumber}getAlignmentPatternCenters(){return this.alignmentPatternCenters}getTotalCodewords(){return this.totalCodewords}getDimensionForVersion(){return 17+4*this.versionNumber}getECBlocksForLevel(t){return this.ecBlocks[t.getValue()]}static getProvisionalVersionForDimension(t){if(t%4!==1)throw new S;try{return this.getVersionForNumber((t-17)/4)}catch(e){throw new S}}static getVersionForNumber(t){if(t<1||t>40)throw new h;return Ce.VERSIONS[t-1]}static decodeVersionInformation(t){let e=Number.MAX_SAFE_INTEGER,n=0;for(let r=0;r<Ce.VERSION_DECODE_INFO.length;r++){const i=Ce.VERSION_DECODE_INFO[r];if(i===t)return Ce.getVersionForNumber(r+7);const s=_e.numBitsDiffering(t,i);s<e&&(n=r+7,e=s)}return e<=3?Ce.getVersionForNumber(n):null}buildFunctionPattern(){const t=this.getDimensionForVersion(),e=new R(t);e.setRegion(0,0,9,9),e.setRegion(t-8,0,8,9),e.setRegion(0,t-8,9,8);const n=this.alignmentPatternCenters.length;for(let r=0;r<n;r++){const t=this.alignmentPatternCenters[r]-2;for(let i=0;i<n;i++)0===r&&(0===i||i===n-1)||r===n-1&&0===i||e.setRegion(this.alignmentPatternCenters[i]-2,t,5,5)}return e.setRegion(6,9,1,t-17),e.setRegion(9,6,t-17,1),this.versionNumber>6&&(e.setRegion(t-11,0,3,6),e.setRegion(0,t-11,6,3)),e}toString(){return""+this.versionNumber}}Ce.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),Ce.VERSIONS=[new Ce(1,new Int32Array(0),new Se(7,new Ae(1,19)),new Se(10,new Ae(1,16)),new Se(13,new Ae(1,13)),new Se(17,new Ae(1,9))),new Ce(2,Int32Array.from([6,18]),new Se(10,new Ae(1,34)),new Se(16,new Ae(1,28)),new Se(22,new Ae(1,22)),new Se(28,new Ae(1,16))),new Ce(3,Int32Array.from([6,22]),new Se(15,new Ae(1,55)),new Se(26,new Ae(1,44)),new Se(18,new Ae(2,17)),new Se(22,new Ae(2,13))),new Ce(4,Int32Array.from([6,26]),new Se(20,new Ae(1,80)),new Se(18,new Ae(2,32)),new Se(26,new Ae(2,24)),new Se(16,new Ae(4,9))),new Ce(5,Int32Array.from([6,30]),new Se(26,new Ae(1,108)),new Se(24,new Ae(2,43)),new Se(18,new Ae(2,15),new Ae(2,16)),new Se(22,new Ae(2,11),new Ae(2,12))),new Ce(6,Int32Array.from([6,34]),new Se(18,new Ae(2,68)),new Se(16,new Ae(4,27)),new Se(24,new Ae(4,19)),new Se(28,new Ae(4,15))),new Ce(7,Int32Array.from([6,22,38]),new Se(20,new Ae(2,78)),new Se(18,new Ae(4,31)),new Se(18,new Ae(2,14),new Ae(4,15)),new Se(26,new Ae(4,13),new Ae(1,14))),new Ce(8,Int32Array.from([6,24,42]),new Se(24,new Ae(2,97)),new Se(22,new Ae(2,38),new Ae(2,39)),new Se(22,new Ae(4,18),new Ae(2,19)),new Se(26,new Ae(4,14),new Ae(2,15))),new Ce(9,Int32Array.from([6,26,46]),new Se(30,new Ae(2,116)),new Se(22,new Ae(3,36),new Ae(2,37)),new Se(20,new Ae(4,16),new Ae(4,17)),new Se(24,new Ae(4,12),new Ae(4,13))),new Ce(10,Int32Array.from([6,28,50]),new Se(18,new Ae(2,68),new Ae(2,69)),new Se(26,new Ae(4,43),new Ae(1,44)),new Se(24,new Ae(6,19),new Ae(2,20)),new Se(28,new Ae(6,15),new Ae(2,16))),new Ce(11,Int32Array.from([6,30,54]),new Se(20,new Ae(4,81)),new Se(30,new Ae(1,50),new Ae(4,51)),new Se(28,new Ae(4,22),new Ae(4,23)),new Se(24,new Ae(3,12),new Ae(8,13))),new Ce(12,Int32Array.from([6,32,58]),new Se(24,new Ae(2,92),new Ae(2,93)),new Se(22,new Ae(6,36),new Ae(2,37)),new Se(26,new Ae(4,20),new Ae(6,21)),new Se(28,new Ae(7,14),new Ae(4,15))),new Ce(13,Int32Array.from([6,34,62]),new Se(26,new Ae(4,107)),new Se(22,new Ae(8,37),new Ae(1,38)),new Se(24,new Ae(8,20),new Ae(4,21)),new Se(22,new Ae(12,11),new Ae(4,12))),new Ce(14,Int32Array.from([6,26,46,66]),new Se(30,new Ae(3,115),new Ae(1,116)),new Se(24,new Ae(4,40),new Ae(5,41)),new Se(20,new Ae(11,16),new Ae(5,17)),new Se(24,new Ae(11,12),new Ae(5,13))),new Ce(15,Int32Array.from([6,26,48,70]),new Se(22,new Ae(5,87),new Ae(1,88)),new Se(24,new Ae(5,41),new Ae(5,42)),new Se(30,new Ae(5,24),new Ae(7,25)),new Se(24,new Ae(11,12),new Ae(7,13))),new Ce(16,Int32Array.from([6,26,50,74]),new Se(24,new Ae(5,98),new Ae(1,99)),new Se(28,new Ae(7,45),new Ae(3,46)),new Se(24,new Ae(15,19),new Ae(2,20)),new Se(30,new Ae(3,15),new Ae(13,16))),new Ce(17,Int32Array.from([6,30,54,78]),new Se(28,new Ae(1,107),new Ae(5,108)),new Se(28,new Ae(10,46),new Ae(1,47)),new Se(28,new Ae(1,22),new Ae(15,23)),new Se(28,new Ae(2,14),new Ae(17,15))),new Ce(18,Int32Array.from([6,30,56,82]),new Se(30,new Ae(5,120),new Ae(1,121)),new Se(26,new Ae(9,43),new Ae(4,44)),new Se(28,new Ae(17,22),new Ae(1,23)),new Se(28,new Ae(2,14),new Ae(19,15))),new Ce(19,Int32Array.from([6,30,58,86]),new Se(28,new Ae(3,113),new Ae(4,114)),new Se(26,new Ae(3,44),new Ae(11,45)),new Se(26,new Ae(17,21),new Ae(4,22)),new Se(26,new Ae(9,13),new Ae(16,14))),new Ce(20,Int32Array.from([6,34,62,90]),new Se(28,new Ae(3,107),new Ae(5,108)),new Se(26,new Ae(3,41),new Ae(13,42)),new Se(30,new Ae(15,24),new Ae(5,25)),new Se(28,new Ae(15,15),new Ae(10,16))),new Ce(21,Int32Array.from([6,28,50,72,94]),new Se(28,new Ae(4,116),new Ae(4,117)),new Se(26,new Ae(17,42)),new Se(28,new Ae(17,22),new Ae(6,23)),new Se(30,new Ae(19,16),new Ae(6,17))),new Ce(22,Int32Array.from([6,26,50,74,98]),new Se(28,new Ae(2,111),new Ae(7,112)),new Se(28,new Ae(17,46)),new Se(30,new Ae(7,24),new Ae(16,25)),new Se(24,new Ae(34,13))),new Ce(23,Int32Array.from([6,30,54,78,102]),new Se(30,new Ae(4,121),new Ae(5,122)),new Se(28,new Ae(4,47),new Ae(14,48)),new Se(30,new Ae(11,24),new Ae(14,25)),new Se(30,new Ae(16,15),new Ae(14,16))),new Ce(24,Int32Array.from([6,28,54,80,106]),new Se(30,new Ae(6,117),new Ae(4,118)),new Se(28,new Ae(6,45),new Ae(14,46)),new Se(30,new Ae(11,24),new Ae(16,25)),new Se(30,new Ae(30,16),new Ae(2,17))),new Ce(25,Int32Array.from([6,32,58,84,110]),new Se(26,new Ae(8,106),new Ae(4,107)),new Se(28,new Ae(8,47),new Ae(13,48)),new Se(30,new Ae(7,24),new Ae(22,25)),new Se(30,new Ae(22,15),new Ae(13,16))),new Ce(26,Int32Array.from([6,30,58,86,114]),new Se(28,new Ae(10,114),new Ae(2,115)),new Se(28,new Ae(19,46),new Ae(4,47)),new Se(28,new Ae(28,22),new Ae(6,23)),new Se(30,new Ae(33,16),new Ae(4,17))),new Ce(27,Int32Array.from([6,34,62,90,118]),new Se(30,new Ae(8,122),new Ae(4,123)),new Se(28,new Ae(22,45),new Ae(3,46)),new Se(30,new Ae(8,23),new Ae(26,24)),new Se(30,new Ae(12,15),new Ae(28,16))),new Ce(28,Int32Array.from([6,26,50,74,98,122]),new Se(30,new Ae(3,117),new Ae(10,118)),new Se(28,new Ae(3,45),new Ae(23,46)),new Se(30,new Ae(4,24),new Ae(31,25)),new Se(30,new Ae(11,15),new Ae(31,16))),new Ce(29,Int32Array.from([6,30,54,78,102,126]),new Se(30,new Ae(7,116),new Ae(7,117)),new Se(28,new Ae(21,45),new Ae(7,46)),new Se(30,new Ae(1,23),new Ae(37,24)),new Se(30,new Ae(19,15),new Ae(26,16))),new Ce(30,Int32Array.from([6,26,52,78,104,130]),new Se(30,new Ae(5,115),new Ae(10,116)),new Se(28,new Ae(19,47),new Ae(10,48)),new Se(30,new Ae(15,24),new Ae(25,25)),new Se(30,new Ae(23,15),new Ae(25,16))),new Ce(31,Int32Array.from([6,30,56,82,108,134]),new Se(30,new Ae(13,115),new Ae(3,116)),new Se(28,new Ae(2,46),new Ae(29,47)),new Se(30,new Ae(42,24),new Ae(1,25)),new Se(30,new Ae(23,15),new Ae(28,16))),new Ce(32,Int32Array.from([6,34,60,86,112,138]),new Se(30,new Ae(17,115)),new Se(28,new Ae(10,46),new Ae(23,47)),new Se(30,new Ae(10,24),new Ae(35,25)),new Se(30,new Ae(19,15),new Ae(35,16))),new Ce(33,Int32Array.from([6,30,58,86,114,142]),new Se(30,new Ae(17,115),new Ae(1,116)),new Se(28,new Ae(14,46),new Ae(21,47)),new Se(30,new Ae(29,24),new Ae(19,25)),new Se(30,new Ae(11,15),new Ae(46,16))),new Ce(34,Int32Array.from([6,34,62,90,118,146]),new Se(30,new Ae(13,115),new Ae(6,116)),new Se(28,new Ae(14,46),new Ae(23,47)),new Se(30,new Ae(44,24),new Ae(7,25)),new Se(30,new Ae(59,16),new Ae(1,17))),new Ce(35,Int32Array.from([6,30,54,78,102,126,150]),new Se(30,new Ae(12,121),new Ae(7,122)),new Se(28,new Ae(12,47),new Ae(26,48)),new Se(30,new Ae(39,24),new Ae(14,25)),new Se(30,new Ae(22,15),new Ae(41,16))),new Ce(36,Int32Array.from([6,24,50,76,102,128,154]),new Se(30,new Ae(6,121),new Ae(14,122)),new Se(28,new Ae(6,47),new Ae(34,48)),new Se(30,new Ae(46,24),new Ae(10,25)),new Se(30,new Ae(2,15),new Ae(64,16))),new Ce(37,Int32Array.from([6,28,54,80,106,132,158]),new Se(30,new Ae(17,122),new Ae(4,123)),new Se(28,new Ae(29,46),new Ae(14,47)),new Se(30,new Ae(49,24),new Ae(10,25)),new Se(30,new Ae(24,15),new Ae(46,16))),new Ce(38,Int32Array.from([6,32,58,84,110,136,162]),new Se(30,new Ae(4,122),new Ae(18,123)),new Se(28,new Ae(13,46),new Ae(32,47)),new Se(30,new Ae(48,24),new Ae(14,25)),new Se(30,new Ae(42,15),new Ae(32,16))),new Ce(39,Int32Array.from([6,26,54,82,110,138,166]),new Se(30,new Ae(20,117),new Ae(4,118)),new Se(28,new Ae(40,47),new Ae(7,48)),new Se(30,new Ae(43,24),new Ae(22,25)),new Se(30,new Ae(10,15),new Ae(67,16))),new Ce(40,Int32Array.from([6,30,58,86,114,142,170]),new Se(30,new Ae(19,118),new Ae(6,119)),new Se(28,new Ae(18,47),new Ae(31,48)),new Se(30,new Ae(34,24),new Ae(34,25)),new Se(30,new Ae(20,15),new Ae(61,16)))],function(t){t[t["DATA_MASK_000"]=0]="DATA_MASK_000",t[t["DATA_MASK_001"]=1]="DATA_MASK_001",t[t["DATA_MASK_010"]=2]="DATA_MASK_010",t[t["DATA_MASK_011"]=3]="DATA_MASK_011",t[t["DATA_MASK_100"]=4]="DATA_MASK_100",t[t["DATA_MASK_101"]=5]="DATA_MASK_101",t[t["DATA_MASK_110"]=6]="DATA_MASK_110",t[t["DATA_MASK_111"]=7]="DATA_MASK_111"}(G||(G={}));class Ie{constructor(t,e){this.value=t,this.isMasked=e}unmaskBitMatrix(t,e){for(let n=0;n<e;n++)for(let r=0;r<e;r++)this.isMasked(n,r)&&t.flip(r,n)}}Ie.values=new Map([[G.DATA_MASK_000,new Ie(G.DATA_MASK_000,((t,e)=>0===(t+e&1)))],[G.DATA_MASK_001,new Ie(G.DATA_MASK_001,((t,e)=>0===(1&t)))],[G.DATA_MASK_010,new Ie(G.DATA_MASK_010,((t,e)=>e%3===0))],[G.DATA_MASK_011,new Ie(G.DATA_MASK_011,((t,e)=>(t+e)%3===0))],[G.DATA_MASK_100,new Ie(G.DATA_MASK_100,((t,e)=>0===(Math.floor(t/2)+Math.floor(e/3)&1)))],[G.DATA_MASK_101,new Ie(G.DATA_MASK_101,((t,e)=>t*e%6===0))],[G.DATA_MASK_110,new Ie(G.DATA_MASK_110,((t,e)=>t*e%6<3))],[G.DATA_MASK_111,new Ie(G.DATA_MASK_111,((t,e)=>0===(t+e+t*e%3&1)))]]);class Te{constructor(t){const e=t.getHeight();if(e<21||1!==(3&e))throw new S;this.bitMatrix=t}readFormatInformation(){if(null!==this.parsedFormatInfo&&void 0!==this.parsedFormatInfo)return this.parsedFormatInfo;let t=0;for(let i=0;i<6;i++)t=this.copyBit(i,8,t);t=this.copyBit(7,8,t),t=this.copyBit(8,8,t),t=this.copyBit(8,7,t);for(let i=5;i>=0;i--)t=this.copyBit(8,i,t);const e=this.bitMatrix.getHeight();let n=0;const r=e-7;for(let i=e-1;i>=r;i--)n=this.copyBit(8,i,n);for(let i=e-8;i<e;i++)n=this.copyBit(i,8,n);if(this.parsedFormatInfo=_e.decodeFormatInformation(t,n),null!==this.parsedFormatInfo)return this.parsedFormatInfo;throw new S}readVersion(){if(null!==this.parsedVersion&&void 0!==this.parsedVersion)return this.parsedVersion;const t=this.bitMatrix.getHeight(),e=Math.floor((t-17)/4);if(e<=6)return Ce.getVersionForNumber(e);let n=0;const r=t-11;for(let s=5;s>=0;s--)for(let e=t-9;e>=r;e--)n=this.copyBit(e,s,n);let i=Ce.decodeVersionInformation(n);if(null!==i&&i.getDimensionForVersion()===t)return this.parsedVersion=i,i;n=0;for(let s=5;s>=0;s--)for(let e=t-9;e>=r;e--)n=this.copyBit(s,e,n);if(i=Ce.decodeVersionInformation(n),null!==i&&i.getDimensionForVersion()===t)return this.parsedVersion=i,i;throw new S}copyBit(t,e,n){const r=this.isMirror?this.bitMatrix.get(e,t):this.bitMatrix.get(t,e);return r?n<<1|1:n<<1}readCodewords(){const t=this.readFormatInformation(),e=this.readVersion(),n=Ie.values.get(t.getDataMask()),r=this.bitMatrix.getHeight();n.unmaskBitMatrix(this.bitMatrix,r);const i=e.buildFunctionPattern();let s=!0;const o=new Uint8Array(e.getTotalCodewords());let a=0,c=0,l=0;for(let u=r-1;u>0;u-=2){6===u&&u--;for(let t=0;t<r;t++){const e=s?r-1-t:t;for(let t=0;t<2;t++)i.get(u-t,e)||(l++,c<<=1,this.bitMatrix.get(u-t,e)&&(c|=1),8===l&&(o[a++]=c,l=0,c=0))}s=!s}if(a!==e.getTotalCodewords())throw new S;return o}remask(){if(null===this.parsedFormatInfo)return;const t=Ie.values[this.parsedFormatInfo.getDataMask()],e=this.bitMatrix.getHeight();t.unmaskBitMatrix(this.bitMatrix,e)}setMirror(t){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=t}mirror(){const t=this.bitMatrix;for(let e=0,n=t.getWidth();e<n;e++)for(let r=e+1,i=t.getHeight();r<i;r++)t.get(e,r)!==t.get(r,e)&&(t.flip(r,e),t.flip(e,r))}}class ke{constructor(t,e){this.numDataCodewords=t,this.codewords=e}static getDataBlocks(t,e,n){if(t.length!==e.getTotalCodewords())throw new h;const r=e.getECBlocksForLevel(n);let i=0;const s=r.getECBlocks();for(const h of s)i+=h.getCount();const o=new Array(i);let a=0;for(const h of s)for(let t=0;t<h.getCount();t++){const t=h.getDataCodewords(),e=r.getECCodewordsPerBlock()+t;o[a++]=new ke(t,new Uint8Array(e))}const c=o[0].codewords.length;let l=o.length-1;while(l>=0){const t=o[l].codewords.length;if(t===c)break;l--}l++;const u=c-r.getECCodewordsPerBlock();let d=0;for(let h=0;h<u;h++)for(let e=0;e<a;e++)o[e].codewords[h]=t[d++];for(let h=l;h<a;h++)o[h].codewords[u]=t[d++];const f=o[0].codewords.length;for(let h=u;h<f;h++)for(let e=0;e<a;e++){const n=e<l?h:h+1;o[e].codewords[n]=t[d++]}return o}getNumDataCodewords(){return this.numDataCodewords}getCodewords(){return this.codewords}}(function(t){t[t["TERMINATOR"]=0]="TERMINATOR",t[t["NUMERIC"]=1]="NUMERIC",t[t["ALPHANUMERIC"]=2]="ALPHANUMERIC",t[t["STRUCTURED_APPEND"]=3]="STRUCTURED_APPEND",t[t["BYTE"]=4]="BYTE",t[t["ECI"]=5]="ECI",t[t["KANJI"]=6]="KANJI",t[t["FNC1_FIRST_POSITION"]=7]="FNC1_FIRST_POSITION",t[t["FNC1_SECOND_POSITION"]=8]="FNC1_SECOND_POSITION",t[t["HANZI"]=9]="HANZI"})(q||(q={}));class Re{constructor(t,e,n,r){this.value=t,this.stringValue=e,this.characterCountBitsForVersions=n,this.bits=r,Re.FOR_BITS.set(r,this),Re.FOR_VALUE.set(t,this)}static forBits(t){const e=Re.FOR_BITS.get(t);if(void 0===e)throw new h;return e}getCharacterCountBits(t){const e=t.getVersionNumber();let n;return n=e<=9?0:e<=26?1:2,this.characterCountBitsForVersions[n]}getValue(){return this.value}getBits(){return this.bits}equals(t){if(!(t instanceof Re))return!1;const e=t;return this.value===e.value}toString(){return this.stringValue}}Re.FOR_BITS=new Map,Re.FOR_VALUE=new Map,Re.TERMINATOR=new Re(q.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),Re.NUMERIC=new Re(q.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),Re.ALPHANUMERIC=new Re(q.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),Re.STRUCTURED_APPEND=new Re(q.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),Re.BYTE=new Re(q.BYTE,"BYTE",Int32Array.from([8,16,16]),4),Re.ECI=new Re(q.ECI,"ECI",Int32Array.from([0,0,0]),7),Re.KANJI=new Re(q.KANJI,"KANJI",Int32Array.from([8,10,12]),8),Re.FNC1_FIRST_POSITION=new Re(q.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),Re.FNC1_SECOND_POSITION=new Re(q.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),Re.HANZI=new Re(q.HANZI,"HANZI",Int32Array.from([8,10,12]),13);class Ne{static decode(t,e,n,r){const i=new ge(t);let s=new k;const o=new Array;let a=-1,c=-1;try{let t,n=null,l=!1;do{if(i.available()<4)t=Re.TERMINATOR;else{const e=i.readBits(4);t=Re.forBits(e)}switch(t){case Re.TERMINATOR:break;case Re.FNC1_FIRST_POSITION:case Re.FNC1_SECOND_POSITION:l=!0;break;case Re.STRUCTURED_APPEND:if(i.available()<16)throw new S;a=i.readBits(8),c=i.readBits(8);break;case Re.ECI:const u=Ne.parseECIValue(i);if(n=A.getCharacterSetECIByValue(u),null===n)throw new S;break;case Re.HANZI:const h=i.readBits(4),d=i.readBits(t.getCharacterCountBits(e));h===Ne.GB2312_SUBSET&&Ne.decodeHanziSegment(i,s,d);break;default:const f=i.readBits(t.getCharacterCountBits(e));switch(t){case Re.NUMERIC:Ne.decodeNumericSegment(i,s,f);break;case Re.ALPHANUMERIC:Ne.decodeAlphanumericSegment(i,s,f,l);break;case Re.BYTE:Ne.decodeByteSegment(i,s,f,n,o,r);break;case Re.KANJI:Ne.decodeKanjiSegment(i,s,f);break;default:throw new S}break}}while(t!==Re.TERMINATOR)}catch(l){throw new S}return new X(t,s.toString(),0===o.length?null:o,null===n?null:n.toString(),a,c)}static decodeHanziSegment(t,e,n){if(13*n>t.available())throw new S;const r=new Uint8Array(2*n);let i=0;while(n>0){const e=t.readBits(13);let s=e/96<<8&4294967295|e%96;s+=s<959?41377:42657,r[i]=s>>8&255,r[i+1]=255&s,i+=2,n--}try{e.append(I.decode(r,T.GB2312))}catch(s){throw new S(s)}}static decodeKanjiSegment(t,e,n){if(13*n>t.available())throw new S;const r=new Uint8Array(2*n);let i=0;while(n>0){const e=t.readBits(13);let s=e/192<<8&4294967295|e%192;s+=s<7936?33088:49472,r[i]=s>>8,r[i+1]=s,i+=2,n--}try{e.append(I.decode(r,T.SHIFT_JIS))}catch(s){throw new S(s)}}static decodeByteSegment(t,e,n,r,i,s){if(8*n>t.available())throw new S;const o=new Uint8Array(n);for(let l=0;l<n;l++)o[l]=t.readBits(8);let a;a=null===r?T.guessEncoding(o,s):r.getName();try{e.append(I.decode(o,a))}catch(c){throw new S(c)}i.push(o)}static toAlphaNumericChar(t){if(t>=Ne.ALPHANUMERIC_CHARS.length)throw new S;return Ne.ALPHANUMERIC_CHARS[t]}static decodeAlphanumericSegment(t,e,n,r){const i=e.length();while(n>1){if(t.available()<11)throw new S;const r=t.readBits(11);e.append(Ne.toAlphaNumericChar(Math.floor(r/45))),e.append(Ne.toAlphaNumericChar(r%45)),n-=2}if(1===n){if(t.available()<6)throw new S;e.append(Ne.toAlphaNumericChar(t.readBits(6)))}if(r)for(let s=i;s<e.length();s++)"%"===e.charAt(s)&&(s<e.length()-1&&"%"===e.charAt(s+1)?e.deleteCharAt(s+1):e.setCharAt(s,String.fromCharCode(29)))}static decodeNumericSegment(t,e,n){while(n>=3){if(t.available()<10)throw new S;const r=t.readBits(10);if(r>=1e3)throw new S;e.append(Ne.toAlphaNumericChar(Math.floor(r/100))),e.append(Ne.toAlphaNumericChar(Math.floor(r/10)%10)),e.append(Ne.toAlphaNumericChar(r%10)),n-=3}if(2===n){if(t.available()<7)throw new S;const n=t.readBits(7);if(n>=100)throw new S;e.append(Ne.toAlphaNumericChar(Math.floor(n/10))),e.append(Ne.toAlphaNumericChar(n%10))}else if(1===n){if(t.available()<4)throw new S;const n=t.readBits(4);if(n>=10)throw new S;e.append(Ne.toAlphaNumericChar(n))}}static parseECIValue(t){const e=t.readBits(8);if(0===(128&e))return 127&e;if(128===(192&e)){const n=t.readBits(8);return(63&e)<<8&4294967295|n}if(192===(224&e)){const n=t.readBits(16);return(31&e)<<16&4294967295|n}throw new S}}Ne.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",Ne.GB2312_SUBSET=1;class De{constructor(t){this.mirrored=t}isMirrored(){return this.mirrored}applyMirroredCorrection(t){if(!this.mirrored||null===t||t.length<3)return;const e=t[0];t[0]=t[2],t[2]=e}}class Oe{constructor(){this.rsDecoder=new rt(tt.QR_CODE_FIELD_256)}decodeBooleanArray(t,e){return this.decodeBitMatrix(R.parseFromBooleanArray(t),e)}decodeBitMatrix(t,e){const n=new Te(t);let r=null;try{return this.decodeBitMatrixParser(n,e)}catch(i){r=i}try{n.remask(),n.setMirror(!0),n.readVersion(),n.readFormatInformation(),n.mirror();const t=this.decodeBitMatrixParser(n,e);return t.setOther(new De(!0)),t}catch(i){if(null!==r)throw r;throw i}}decodeBitMatrixParser(t,e){const n=t.readVersion(),r=t.readFormatInformation().getErrorCorrectionLevel(),i=t.readCodewords(),s=ke.getDataBlocks(i,n,r);let o=0;for(const l of s)o+=l.getNumDataCodewords();const a=new Uint8Array(o);let c=0;for(const l of s){const t=l.getCodewords(),e=l.getNumDataCodewords();this.correctErrors(t,e);for(let n=0;n<e;n++)a[c++]=t[n]}return Ne.decode(a,n,r,e)}correctErrors(t,e){const n=new Int32Array(t);try{this.rsDecoder.decode(n,t.length-e)}catch(r){throw new f}for(let i=0;i<e;i++)t[i]=n[i]}}class Pe extends at{constructor(t,e,n){super(t,e),this.estimatedModuleSize=n}aboutEquals(t,e,n){if(Math.abs(e-this.getY())<=t&&Math.abs(n-this.getX())<=t){const e=Math.abs(t-this.estimatedModuleSize);return e<=1||e<=this.estimatedModuleSize}return!1}combineEstimate(t,e,n){const r=(this.getX()+e)/2,i=(this.getY()+t)/2,s=(this.estimatedModuleSize+n)/2;return new Pe(r,i,s)}}class xe{constructor(t,e,n,r,i,s,o){this.image=t,this.startX=e,this.startY=n,this.width=r,this.height=i,this.moduleSize=s,this.resultPointCallback=o,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}find(){const t=this.startX,e=this.height,n=this.width,r=t+n,i=this.startY+e/2,s=new Int32Array(3),o=this.image;for(let a=0;a<e;a++){const e=i+(0===(1&a)?Math.floor((a+1)/2):-Math.floor((a+1)/2));s[0]=0,s[1]=0,s[2]=0;let n=t;while(n<r&&!o.get(n,e))n++;let c=0;while(n<r){if(o.get(n,e))if(1===c)s[1]++;else if(2===c){if(this.foundPatternCross(s)){const t=this.handlePossibleCenter(s,e,n);if(null!==t)return t}s[0]=s[2],s[1]=1,s[2]=0,c=1}else s[++c]++;else 1===c&&c++,s[c]++;n++}if(this.foundPatternCross(s)){const t=this.handlePossibleCenter(s,e,r);if(null!==t)return t}}if(0!==this.possibleCenters.length)return this.possibleCenters[0];throw new N}static centerFromEnd(t,e){return e-t[2]-t[1]/2}foundPatternCross(t){const e=this.moduleSize,n=e/2;for(let r=0;r<3;r++)if(Math.abs(e-t[r])>=n)return!1;return!0}crossCheckVertical(t,e,n,r){const i=this.image,s=i.getHeight(),o=this.crossCheckStateCount;o[0]=0,o[1]=0,o[2]=0;let a=t;while(a>=0&&i.get(e,a)&&o[1]<=n)o[1]++,a--;if(a<0||o[1]>n)return NaN;while(a>=0&&!i.get(e,a)&&o[0]<=n)o[0]++,a--;if(o[0]>n)return NaN;a=t+1;while(a<s&&i.get(e,a)&&o[1]<=n)o[1]++,a++;if(a===s||o[1]>n)return NaN;while(a<s&&!i.get(e,a)&&o[2]<=n)o[2]++,a++;if(o[2]>n)return NaN;const c=o[0]+o[1]+o[2];return 5*Math.abs(c-r)>=2*r?NaN:this.foundPatternCross(o)?xe.centerFromEnd(o,a):NaN}handlePossibleCenter(t,e,n){const r=t[0]+t[1]+t[2],i=xe.centerFromEnd(t,n),s=this.crossCheckVertical(e,i,2*t[1],r);if(!isNaN(s)){const e=(t[0]+t[1]+t[2])/3;for(const t of this.possibleCenters)if(t.aboutEquals(e,s,i))return t.combineEstimate(s,i,e);const n=new Pe(i,s,e);this.possibleCenters.push(n),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(n)}return null}}class Me extends at{constructor(t,e,n,r){super(t,e),this.estimatedModuleSize=n,this.count=r,void 0===r&&(this.count=1)}getEstimatedModuleSize(){return this.estimatedModuleSize}getCount(){return this.count}aboutEquals(t,e,n){if(Math.abs(e-this.getY())<=t&&Math.abs(n-this.getX())<=t){const e=Math.abs(t-this.estimatedModuleSize);return e<=1||e<=this.estimatedModuleSize}return!1}combineEstimate(t,e,n){const r=this.count+1,i=(this.count*this.getX()+e)/r,s=(this.count*this.getY()+t)/r,o=(this.count*this.estimatedModuleSize+n)/r;return new Me(i,s,o,r)}}class Le{constructor(t){this.bottomLeft=t[0],this.topLeft=t[1],this.topRight=t[2]}getBottomLeft(){return this.bottomLeft}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}}class Be{constructor(t,e){this.image=t,this.resultPointCallback=e,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=e}getImage(){return this.image}getPossibleCenters(){return this.possibleCenters}find(t){const e=null!==t&&void 0!==t&&void 0!==t.get(_.TRY_HARDER),n=null!==t&&void 0!==t&&void 0!==t.get(_.PURE_BARCODE),r=this.image,i=r.getHeight(),s=r.getWidth();let o=Math.floor(3*i/(4*Be.MAX_MODULES));(o<Be.MIN_SKIP||e)&&(o=Be.MIN_SKIP);let a=!1;const c=new Int32Array(5);for(let u=o-1;u<i&&!a;u+=o){c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0;let t=0;for(let e=0;e<s;e++)if(r.get(e,u))1===(1&t)&&t++,c[t]++;else if(0===(1&t))if(4===t)if(Be.foundPatternCross(c)){const r=this.handlePossibleCenter(c,u,e,n);if(!0!==r){c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,t=3;continue}if(o=2,!0===this.hasSkipped)a=this.haveMultiplyConfirmedCenters();else{const t=this.findRowSkip();t>c[2]&&(u+=t-c[2]-o,e=s-1)}t=0,c[0]=0,c[1]=0,c[2]=0,c[3]=0,c[4]=0}else c[0]=c[2],c[1]=c[3],c[2]=c[4],c[3]=1,c[4]=0,t=3;else c[++t]++;else c[t]++;if(Be.foundPatternCross(c)){const t=this.handlePossibleCenter(c,u,s,n);!0===t&&(o=c[0],this.hasSkipped&&(a=this.haveMultiplyConfirmedCenters()))}}const l=this.selectBestPatterns();return at.orderBestPatterns(l),new Le(l)}static centerFromEnd(t,e){return e-t[4]-t[3]-t[2]/2}static foundPatternCross(t){let e=0;for(let i=0;i<5;i++){const n=t[i];if(0===n)return!1;e+=n}if(e<7)return!1;const n=e/7,r=n/2;return Math.abs(n-t[0])<r&&Math.abs(n-t[1])<r&&Math.abs(3*n-t[2])<3*r&&Math.abs(n-t[3])<r&&Math.abs(n-t[4])<r}getCrossCheckStateCount(){const t=this.crossCheckStateCount;return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t}crossCheckDiagonal(t,e,n,r){const i=this.getCrossCheckStateCount();let s=0;const o=this.image;while(t>=s&&e>=s&&o.get(e-s,t-s))i[2]++,s++;if(t<s||e<s)return!1;while(t>=s&&e>=s&&!o.get(e-s,t-s)&&i[1]<=n)i[1]++,s++;if(t<s||e<s||i[1]>n)return!1;while(t>=s&&e>=s&&o.get(e-s,t-s)&&i[0]<=n)i[0]++,s++;if(i[0]>n)return!1;const a=o.getHeight(),c=o.getWidth();s=1;while(t+s<a&&e+s<c&&o.get(e+s,t+s))i[2]++,s++;if(t+s>=a||e+s>=c)return!1;while(t+s<a&&e+s<c&&!o.get(e+s,t+s)&&i[3]<n)i[3]++,s++;if(t+s>=a||e+s>=c||i[3]>=n)return!1;while(t+s<a&&e+s<c&&o.get(e+s,t+s)&&i[4]<n)i[4]++,s++;if(i[4]>=n)return!1;const l=i[0]+i[1]+i[2]+i[3]+i[4];return Math.abs(l-r)<2*r&&Be.foundPatternCross(i)}crossCheckVertical(t,e,n,r){const i=this.image,s=i.getHeight(),o=this.getCrossCheckStateCount();let a=t;while(a>=0&&i.get(e,a))o[2]++,a--;if(a<0)return NaN;while(a>=0&&!i.get(e,a)&&o[1]<=n)o[1]++,a--;if(a<0||o[1]>n)return NaN;while(a>=0&&i.get(e,a)&&o[0]<=n)o[0]++,a--;if(o[0]>n)return NaN;a=t+1;while(a<s&&i.get(e,a))o[2]++,a++;if(a===s)return NaN;while(a<s&&!i.get(e,a)&&o[3]<n)o[3]++,a++;if(a===s||o[3]>=n)return NaN;while(a<s&&i.get(e,a)&&o[4]<n)o[4]++,a++;if(o[4]>=n)return NaN;const c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-r)>=2*r?NaN:Be.foundPatternCross(o)?Be.centerFromEnd(o,a):NaN}crossCheckHorizontal(t,e,n,r){const i=this.image,s=i.getWidth(),o=this.getCrossCheckStateCount();let a=t;while(a>=0&&i.get(a,e))o[2]++,a--;if(a<0)return NaN;while(a>=0&&!i.get(a,e)&&o[1]<=n)o[1]++,a--;if(a<0||o[1]>n)return NaN;while(a>=0&&i.get(a,e)&&o[0]<=n)o[0]++,a--;if(o[0]>n)return NaN;a=t+1;while(a<s&&i.get(a,e))o[2]++,a++;if(a===s)return NaN;while(a<s&&!i.get(a,e)&&o[3]<n)o[3]++,a++;if(a===s||o[3]>=n)return NaN;while(a<s&&i.get(a,e)&&o[4]<n)o[4]++,a++;if(o[4]>=n)return NaN;const c=o[0]+o[1]+o[2]+o[3]+o[4];return 5*Math.abs(c-r)>=r?NaN:Be.foundPatternCross(o)?Be.centerFromEnd(o,a):NaN}handlePossibleCenter(t,e,n,r){const i=t[0]+t[1]+t[2]+t[3]+t[4];let s=Be.centerFromEnd(t,n),o=this.crossCheckVertical(e,Math.floor(s),t[2],i);if(!isNaN(o)&&(s=this.crossCheckHorizontal(Math.floor(s),Math.floor(o),t[2],i),!isNaN(s)&&(!r||this.crossCheckDiagonal(Math.floor(o),Math.floor(s),t[2],i)))){const t=i/7;let e=!1;const n=this.possibleCenters;for(let r=0,i=n.length;r<i;r++){const i=n[r];if(i.aboutEquals(t,o,s)){n[r]=i.combineEstimate(o,s,t),e=!0;break}}if(!e){const e=new Me(s,o,t);n.push(e),null!==this.resultPointCallback&&void 0!==this.resultPointCallback&&this.resultPointCallback.foundPossibleResultPoint(e)}return!0}return!1}findRowSkip(){const t=this.possibleCenters.length;if(t<=1)return 0;let e=null;for(const n of this.possibleCenters)if(n.getCount()>=Be.CENTER_QUORUM){if(null!=e)return this.hasSkipped=!0,Math.floor((Math.abs(e.getX()-n.getX())-Math.abs(e.getY()-n.getY()))/2);e=n}return 0}haveMultiplyConfirmedCenters(){let t=0,e=0;const n=this.possibleCenters.length;for(const s of this.possibleCenters)s.getCount()>=Be.CENTER_QUORUM&&(t++,e+=s.getEstimatedModuleSize());if(t<3)return!1;const r=e/n;let i=0;for(const s of this.possibleCenters)i+=Math.abs(s.getEstimatedModuleSize()-r);return i<=.05*e}selectBestPatterns(){const t=this.possibleCenters.length;if(t<3)throw new N;const e=this.possibleCenters;let n;if(t>3){let r=0,i=0;for(const t of this.possibleCenters){const e=t.getEstimatedModuleSize();r+=e,i+=e*e}n=r/t;let s=Math.sqrt(i/t-n*n);e.sort(((t,e)=>{const r=Math.abs(e.getEstimatedModuleSize()-n),i=Math.abs(t.getEstimatedModuleSize()-n);return r<i?-1:r>i?1:0}));const o=Math.max(.2*n,s);for(let t=0;t<e.length&&e.length>3;t++){const r=e[t];Math.abs(r.getEstimatedModuleSize()-n)>o&&(e.splice(t,1),t--)}}if(e.length>3){let t=0;for(const n of e)t+=n.getEstimatedModuleSize();n=t/e.length,e.sort(((t,e)=>{if(e.getCount()===t.getCount()){const r=Math.abs(e.getEstimatedModuleSize()-n),i=Math.abs(t.getEstimatedModuleSize()-n);return r<i?1:r>i?-1:0}return e.getCount()-t.getCount()})),e.splice(3)}return[e[0],e[1],e[2]]}}Be.CENTER_QUORUM=2,Be.MIN_SKIP=3,Be.MAX_MODULES=57;class Ue{constructor(t){this.image=t}getImage(){return this.image}getResultPointCallback(){return this.resultPointCallback}detect(t){this.resultPointCallback=null===t||void 0===t?null:t.get(_.NEED_RESULT_POINT_CALLBACK);const e=new Be(this.image,this.resultPointCallback),n=e.find(t);return this.processFinderPatternInfo(n)}processFinderPatternInfo(t){const e=t.getTopLeft(),n=t.getTopRight(),r=t.getBottomLeft(),i=this.calculateModuleSize(e,n,r);if(i<1)throw new N("No pattern found in proccess finder.");const s=Ue.computeDimension(e,n,r,i),o=Ce.getProvisionalVersionForDimension(s),a=o.getDimensionForVersion()-7;let c=null;if(o.getAlignmentPatternCenters().length>0){const t=n.getX()-e.getX()+r.getX(),s=n.getY()-e.getY()+r.getY(),o=1-3/a,l=Math.floor(e.getX()+o*(t-e.getX())),u=Math.floor(e.getY()+o*(s-e.getY()));for(let e=4;e<=16;e<<=1)try{c=this.findAlignmentInRegion(i,l,u,e);break}catch(d){if(!(d instanceof N))throw d}}const l=Ue.createTransform(e,n,r,c,s),u=Ue.sampleGrid(this.image,l,s);let h;return h=null===c?[r,e,n]:[r,e,n,c],new ct(u,h)}static createTransform(t,e,n,r,i){const s=i-3.5;let o,a,c,l;return null!==r?(o=r.getX(),a=r.getY(),c=s-3,l=c):(o=e.getX()-t.getX()+n.getX(),a=e.getY()-t.getY()+n.getY(),c=s,l=s),dt.quadrilateralToQuadrilateral(3.5,3.5,s,3.5,c,l,3.5,s,t.getX(),t.getY(),e.getX(),e.getY(),o,a,n.getX(),n.getY())}static sampleGrid(t,e,n){const r=pt.getInstance();return r.sampleGridWithTransform(t,n,n,e)}static computeDimension(t,e,n,r){const i=st.round(at.distance(t,e)/r),s=st.round(at.distance(t,n)/r);let o=Math.floor((i+s)/2)+7;switch(3&o){case 0:o++;break;case 2:o--;break;case 3:throw new N("Dimensions could be not found.")}return o}calculateModuleSize(t,e,n){return(this.calculateModuleSizeOneWay(t,e)+this.calculateModuleSizeOneWay(t,n))/2}calculateModuleSizeOneWay(t,e){const n=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(t.getX()),Math.floor(t.getY()),Math.floor(e.getX()),Math.floor(e.getY())),r=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(t.getX()),Math.floor(t.getY()));return isNaN(n)?r/7:isNaN(r)?n/7:(n+r)/14}sizeOfBlackWhiteBlackRunBothWays(t,e,n,r){let i=this.sizeOfBlackWhiteBlackRun(t,e,n,r),s=1,o=t-(n-t);o<0?(s=t/(t-o),o=0):o>=this.image.getWidth()&&(s=(this.image.getWidth()-1-t)/(o-t),o=this.image.getWidth()-1);let a=Math.floor(e-(r-e)*s);return s=1,a<0?(s=e/(e-a),a=0):a>=this.image.getHeight()&&(s=(this.image.getHeight()-1-e)/(a-e),a=this.image.getHeight()-1),o=Math.floor(t+(o-t)*s),i+=this.sizeOfBlackWhiteBlackRun(t,e,o,a),i-1}sizeOfBlackWhiteBlackRun(t,e,n,r){const i=Math.abs(r-e)>Math.abs(n-t);if(i){let i=t;t=e,e=i,i=n,n=r,r=i}const s=Math.abs(n-t),o=Math.abs(r-e);let a=-s/2;const c=t<n?1:-1,l=e<r?1:-1;let u=0;const h=n+c;for(let d=t,f=e;d!==h;d+=c){const n=i?f:d,c=i?d:f;if(1===u===this.image.get(n,c)){if(2===u)return st.distance(d,f,t,e);u++}if(a+=o,a>0){if(f===r)break;f+=l,a-=s}}return 2===u?st.distance(n+c,r,t,e):NaN}findAlignmentInRegion(t,e,n,r){const i=Math.floor(r*t),s=Math.max(0,e-i),o=Math.min(this.image.getWidth()-1,e+i);if(o-s<3*t)throw new N("Alignment top exceeds estimated module size.");const a=Math.max(0,n-i),c=Math.min(this.image.getHeight()-1,n+i);if(c-a<3*t)throw new N("Alignment bottom exceeds estimated module size.");const l=new xe(this.image,s,a,o-s,c-a,t,this.resultPointCallback);return l.find()}}class Fe{constructor(){this.decoder=new Oe}getDecoder(){return this.decoder}decode(t,e){let n,r;if(void 0!==e&&null!==e&&void 0!==e.get(_.PURE_BARCODE)){const i=Fe.extractPureBits(t.getBlackMatrix());n=this.decoder.decodeBitMatrix(i,e),r=Fe.NO_POINTS}else{const i=new Ue(t.getBlackMatrix()).detect(e);n=this.decoder.decodeBitMatrix(i.getBits(),e),r=i.getPoints()}n.getOther()instanceof De&&n.getOther().applyMirroredCorrection(r);const i=new z(n.getText(),n.getRawBytes(),void 0,r,j.QR_CODE,void 0),s=n.getByteSegments();null!==s&&i.putMetadata(Y.BYTE_SEGMENTS,s);const o=n.getECLevel();return null!==o&&i.putMetadata(Y.ERROR_CORRECTION_LEVEL,o),n.hasStructuredAppend()&&(i.putMetadata(Y.STRUCTURED_APPEND_SEQUENCE,n.getStructuredAppendSequenceNumber()),i.putMetadata(Y.STRUCTURED_APPEND_PARITY,n.getStructuredAppendParity())),i}reset(){}static extractPureBits(t){const e=t.getTopLeftOnBit(),n=t.getBottomRightOnBit();if(null===e||null===n)throw new N;const r=this.moduleSize(e,t);let i=e[1],s=n[1],o=e[0],a=n[0];if(o>=a||i>=s)throw new N;if(s-i!==a-o&&(a=o+(s-i),a>=t.getWidth()))throw new N;const c=Math.round((a-o+1)/r),l=Math.round((s-i+1)/r);if(c<=0||l<=0)throw new N;if(l!==c)throw new N;const u=Math.floor(r/2);i+=u,o+=u;const h=o+Math.floor((c-1)*r)-a;if(h>0){if(h>u)throw new N;o-=h}const d=i+Math.floor((l-1)*r)-s;if(d>0){if(d>u)throw new N;i-=d}const f=new R(c,l);for(let p=0;p<l;p++){const e=i+Math.floor(p*r);for(let n=0;n<c;n++)t.get(o+Math.floor(n*r),e)&&f.set(n,p)}return f}static moduleSize(t,e){const n=e.getHeight(),r=e.getWidth();let i=t[0],s=t[1],o=!0,a=0;while(i<r&&s<n){if(o!==e.get(i,s)){if(5===++a)break;o=!o}i++,s++}if(i===r||s===n)throw new N;return(i-t[0])/7}}Fe.NO_POINTS=new Array;class ze{PDF417Common(){}static getBitCountSum(t){return st.sum(t)}static toIntArray(t){if(null==t||!t.length)return ze.EMPTY_INT_ARRAY;const e=new Int32Array(t.length);let n=0;for(const r of t)e[n++]=r;return e}static getCodeword(t){const e=w.binarySearch(ze.SYMBOL_TABLE,262143&t);return e<0?-1:(ze.CODEWORD_TABLE[e]-1)%ze.NUMBER_OF_CODEWORDS}}ze.NUMBER_OF_CODEWORDS=929,ze.MAX_CODEWORDS_IN_BARCODE=ze.NUMBER_OF_CODEWORDS-1,ze.MIN_ROWS_IN_BARCODE=3,ze.MAX_ROWS_IN_BARCODE=90,ze.MODULES_IN_CODEWORD=17,ze.MODULES_IN_STOP_PATTERN=18,ze.BARS_IN_MODULE=8,ze.EMPTY_INT_ARRAY=new Int32Array([]),ze.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),ze.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]);class Ve{constructor(t,e){this.bits=t,this.points=e}getBits(){return this.bits}getPoints(){return this.points}}class je{static detectMultiple(t,e,n){let r=t.getBlackMatrix(),i=je.detect(n,r);return i.length||(r=r.clone(),r.rotate180(),i=je.detect(n,r)),new Ve(r,i)}static detect(t,e){const n=new Array;let r=0,i=0,s=!1;while(r<e.getHeight()){const o=je.findVertices(e,r,i);if(null!=o[0]||null!=o[3]){if(s=!0,n.push(o),!t)break;null!=o[2]?(i=Math.trunc(o[2].getX()),r=Math.trunc(o[2].getY())):(i=Math.trunc(o[4].getX()),r=Math.trunc(o[4].getY()))}else{if(!s)break;s=!1,i=0;for(const t of n)null!=t[1]&&(r=Math.trunc(Math.max(r,t[1].getY()))),null!=t[3]&&(r=Math.max(r,Math.trunc(t[3].getY())));r+=je.ROW_STEP}}return n}static findVertices(t,e,n){const r=t.getHeight(),i=t.getWidth(),s=new Array(8);return je.copyToResult(s,je.findRowsWithPattern(t,r,i,e,n,je.START_PATTERN),je.INDEXES_START_PATTERN),null!=s[4]&&(n=Math.trunc(s[4].getX()),e=Math.trunc(s[4].getY())),je.copyToResult(s,je.findRowsWithPattern(t,r,i,e,n,je.STOP_PATTERN),je.INDEXES_STOP_PATTERN),s}static copyToResult(t,e,n){for(let r=0;r<n.length;r++)t[n[r]]=e[r]}static findRowsWithPattern(t,e,n,r,i,s){const o=new Array(4);let a=!1;const c=new Int32Array(s.length);for(;r<e;r+=je.ROW_STEP){let e=je.findGuardPattern(t,i,r,n,!1,s,c);if(null!=e){while(r>0){const o=je.findGuardPattern(t,i,--r,n,!1,s,c);if(null==o){r++;break}e=o}o[0]=new at(e[0],r),o[1]=new at(e[1],r),a=!0;break}}let l=r+1;if(a){let r=0,i=Int32Array.from([Math.trunc(o[0].getX()),Math.trunc(o[1].getX())]);for(;l<e;l++){const e=je.findGuardPattern(t,i[0],l,n,!1,s,c);if(null!=e&&Math.abs(i[0]-e[0])<je.MAX_PATTERN_DRIFT&&Math.abs(i[1]-e[1])<je.MAX_PATTERN_DRIFT)i=e,r=0;else{if(r>je.SKIPPED_ROW_COUNT_MAX)break;r++}}l-=r+1,o[2]=new at(i[0],l),o[3]=new at(i[1],l)}return l-r<je.BARCODE_MIN_HEIGHT&&w.fill(o,null),o}static findGuardPattern(t,e,n,r,i,s,o){w.fillWithin(o,0,o.length,0);let a=e,c=0;while(t.get(a,n)&&a>0&&c++<je.MAX_PIXEL_DRIFT)a--;let l=a,u=0,h=s.length;for(let d=i;l<r;l++){let e=t.get(l,n);if(e!==d)o[u]++;else{if(u===h-1){if(je.patternMatchVariance(o,s,je.MAX_INDIVIDUAL_VARIANCE)<je.MAX_AVG_VARIANCE)return new Int32Array([a,l]);a+=o[0]+o[1],g.arraycopy(o,2,o,0,u-1),o[u-1]=0,o[u]=0,u--}else u++;o[u]=1,d=!d}}return u===h-1&&je.patternMatchVariance(o,s,je.MAX_INDIVIDUAL_VARIANCE)<je.MAX_AVG_VARIANCE?new Int32Array([a,l-1]):null}static patternMatchVariance(t,e,n){let r=t.length,i=0,s=0;for(let c=0;c<r;c++)i+=t[c],s+=e[c];if(i<s)return 1/0;let o=i/s;n*=o;let a=0;for(let c=0;c<r;c++){let r=t[c],i=e[c]*o,s=r>i?r-i:i-r;if(s>n)return 1/0;a+=s}return a/i}}je.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),je.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),je.MAX_AVG_VARIANCE=.42,je.MAX_INDIVIDUAL_VARIANCE=.8,je.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),je.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),je.MAX_PIXEL_DRIFT=3,je.MAX_PATTERN_DRIFT=5,je.SKIPPED_ROW_COUNT_MAX=25,je.ROW_STEP=5,je.BARCODE_MIN_HEIGHT=10;class He{constructor(t,e){if(0===e.length)throw new h;this.field=t;let n=e.length;if(n>1&&0===e[0]){let t=1;while(t<n&&0===e[t])t++;t===n?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(n-t),g.arraycopy(e,t,this.coefficients,0,this.coefficients.length))}else this.coefficients=e}getCoefficients(){return this.coefficients}getDegree(){return this.coefficients.length-1}isZero(){return 0===this.coefficients[0]}getCoefficient(t){return this.coefficients[this.coefficients.length-1-t]}evaluateAt(t){if(0===t)return this.getCoefficient(0);if(1===t){let t=0;for(let e of this.coefficients)t=this.field.add(t,e);return t}let e=this.coefficients[0],n=this.coefficients.length;for(let r=1;r<n;r++)e=this.field.add(this.field.multiply(t,e),this.coefficients[r]);return e}add(t){if(!this.field.equals(t.field))throw new h("ModulusPolys do not have same ModulusGF field");if(this.isZero())return t;if(t.isZero())return this;let e=this.coefficients,n=t.coefficients;if(e.length>n.length){let t=e;e=n,n=t}let r=new Int32Array(n.length),i=n.length-e.length;g.arraycopy(n,0,r,0,i);for(let s=i;s<n.length;s++)r[s]=this.field.add(e[s-i],n[s]);return new He(this.field,r)}subtract(t){if(!this.field.equals(t.field))throw new h("ModulusPolys do not have same ModulusGF field");return t.isZero()?this:this.add(t.negative())}multiply(t){return t instanceof He?this.multiplyOther(t):this.multiplyScalar(t)}multiplyOther(t){if(!this.field.equals(t.field))throw new h("ModulusPolys do not have same ModulusGF field");if(this.isZero()||t.isZero())return new He(this.field,new Int32Array([0]));let e=this.coefficients,n=e.length,r=t.coefficients,i=r.length,s=new Int32Array(n+i-1);for(let o=0;o<n;o++){let t=e[o];for(let e=0;e<i;e++)s[o+e]=this.field.add(s[o+e],this.field.multiply(t,r[e]))}return new He(this.field,s)}negative(){let t=this.coefficients.length,e=new Int32Array(t);for(let n=0;n<t;n++)e[n]=this.field.subtract(0,this.coefficients[n]);return new He(this.field,e)}multiplyScalar(t){if(0===t)return new He(this.field,new Int32Array([0]));if(1===t)return this;let e=this.coefficients.length,n=new Int32Array(e);for(let r=0;r<e;r++)n[r]=this.field.multiply(this.coefficients[r],t);return new He(this.field,n)}multiplyByMonomial(t,e){if(t<0)throw new h;if(0===e)return new He(this.field,new Int32Array([0]));let n=this.coefficients.length,r=new Int32Array(n+t);for(let i=0;i<n;i++)r[i]=this.field.multiply(this.coefficients[i],e);return new He(this.field,r)}toString(){let t=new k;for(let e=this.getDegree();e>=0;e--){let n=this.getCoefficient(e);0!==n&&(n<0?(t.append(" - "),n=-n):t.length()>0&&t.append(" + "),0!==e&&1===n||t.append(n),0!==e&&(1===e?t.append("x"):(t.append("x^"),t.append(e))))}return t.toString()}}class $e{add(t,e){return(t+e)%this.modulus}subtract(t,e){return(this.modulus+t-e)%this.modulus}exp(t){return this.expTable[t]}log(t){if(0===t)throw new h;return this.logTable[t]}inverse(t){if(0===t)throw new Z;return this.expTable[this.modulus-this.logTable[t]-1]}multiply(t,e){return 0===t||0===e?0:this.expTable[(this.logTable[t]+this.logTable[e])%(this.modulus-1)]}getSize(){return this.modulus}equals(t){return t===this}}class Ke extends $e{constructor(t,e){super(),this.modulus=t,this.expTable=new Int32Array(t),this.logTable=new Int32Array(t);let n=1;for(let r=0;r<t;r++)this.expTable[r]=n,n=n*e%t;for(let r=0;r<t-1;r++)this.logTable[this.expTable[r]]=r;this.zero=new He(this,new Int32Array([0])),this.one=new He(this,new Int32Array([1]))}getZero(){return this.zero}getOne(){return this.one}buildMonomial(t,e){if(t<0)throw new h;if(0===e)return this.zero;let n=new Int32Array(t+1);return n[0]=e,new He(this,n)}}Ke.PDF417_GF=new Ke(ze.NUMBER_OF_CODEWORDS,3);class Ge{constructor(){this.field=Ke.PDF417_GF}decode(t,e,n){let r=new He(this.field,t),i=new Int32Array(e),s=!1;for(let f=e;f>0;f--){let t=r.evaluateAt(this.field.exp(f));i[e-f]=t,0!==t&&(s=!0)}if(!s)return 0;let o=this.field.getOne();if(null!=n)for(const f of n){let e=this.field.exp(t.length-1-f),n=new He(this.field,new Int32Array([this.field.subtract(0,e),1]));o=o.multiply(n)}let a=new He(this.field,i),c=this.runEuclideanAlgorithm(this.field.buildMonomial(e,1),a,e),l=c[0],u=c[1],h=this.findErrorLocations(l),d=this.findErrorMagnitudes(u,l,h);for(let p=0;p<h.length;p++){let e=t.length-1-this.field.log(h[p]);if(e<0)throw f.getChecksumInstance();t[e]=this.field.subtract(t[e],d[p])}return h.length}runEuclideanAlgorithm(t,e,n){if(t.getDegree()<e.getDegree()){let n=t;t=e,e=n}let r=t,i=e,s=this.field.getZero(),o=this.field.getOne();while(i.getDegree()>=Math.round(n/2)){let t=r,e=s;if(r=i,s=o,r.isZero())throw f.getChecksumInstance();i=t;let n=this.field.getZero(),a=r.getCoefficient(r.getDegree()),c=this.field.inverse(a);while(i.getDegree()>=r.getDegree()&&!i.isZero()){let t=i.getDegree()-r.getDegree(),e=this.field.multiply(i.getCoefficient(i.getDegree()),c);n=n.add(this.field.buildMonomial(t,e)),i=i.subtract(r.multiplyByMonomial(t,e))}o=n.multiply(s).subtract(e).negative()}let a=o.getCoefficient(0);if(0===a)throw f.getChecksumInstance();let c=this.field.inverse(a),l=o.multiply(c),u=i.multiply(c);return[l,u]}findErrorLocations(t){let e=t.getDegree(),n=new Int32Array(e),r=0;for(let i=1;i<this.field.getSize()&&r<e;i++)0===t.evaluateAt(i)&&(n[r]=this.field.inverse(i),r++);if(r!==e)throw f.getChecksumInstance();return n}findErrorMagnitudes(t,e,n){let r=e.getDegree(),i=new Int32Array(r);for(let c=1;c<=r;c++)i[r-c]=this.field.multiply(c,e.getCoefficient(c));let s=new He(this.field,i),o=n.length,a=new Int32Array(o);for(let c=0;c<o;c++){let e=this.field.inverse(n[c]),r=this.field.subtract(0,t.evaluateAt(e)),i=this.field.inverse(s.evaluateAt(e));a[c]=this.field.multiply(r,i)}return a}}class qe{constructor(t,e,n,r,i){t instanceof qe?this.constructor_2(t):this.constructor_1(t,e,n,r,i)}constructor_1(t,e,n,r,i){const s=null==e||null==n,o=null==r||null==i;if(s&&o)throw new N;s?(e=new at(0,r.getY()),n=new at(0,i.getY())):o&&(r=new at(t.getWidth()-1,e.getY()),i=new at(t.getWidth()-1,n.getY())),this.image=t,this.topLeft=e,this.bottomLeft=n,this.topRight=r,this.bottomRight=i,this.minX=Math.trunc(Math.min(e.getX(),n.getX())),this.maxX=Math.trunc(Math.max(r.getX(),i.getX())),this.minY=Math.trunc(Math.min(e.getY(),r.getY())),this.maxY=Math.trunc(Math.max(n.getY(),i.getY()))}constructor_2(t){this.image=t.image,this.topLeft=t.getTopLeft(),this.bottomLeft=t.getBottomLeft(),this.topRight=t.getTopRight(),this.bottomRight=t.getBottomRight(),this.minX=t.getMinX(),this.maxX=t.getMaxX(),this.minY=t.getMinY(),this.maxY=t.getMaxY()}static merge(t,e){return null==t?e:null==e?t:new qe(t.image,t.topLeft,t.bottomLeft,e.topRight,e.bottomRight)}addMissingRows(t,e,n){let r=this.topLeft,i=this.bottomLeft,s=this.topRight,o=this.bottomRight;if(t>0){let e=n?this.topLeft:this.topRight,i=Math.trunc(e.getY()-t);i<0&&(i=0);let o=new at(e.getX(),i);n?r=o:s=o}if(e>0){let t=n?this.bottomLeft:this.bottomRight,r=Math.trunc(t.getY()+e);r>=this.image.getHeight()&&(r=this.image.getHeight()-1);let s=new at(t.getX(),r);n?i=s:o=s}return new qe(this.image,r,i,s,o)}getMinX(){return this.minX}getMaxX(){return this.maxX}getMinY(){return this.minY}getMaxY(){return this.maxY}getTopLeft(){return this.topLeft}getTopRight(){return this.topRight}getBottomLeft(){return this.bottomLeft}getBottomRight(){return this.bottomRight}}class We{constructor(t,e,n,r){this.columnCount=t,this.errorCorrectionLevel=r,this.rowCountUpperPart=e,this.rowCountLowerPart=n,this.rowCount=e+n}getColumnCount(){return this.columnCount}getErrorCorrectionLevel(){return this.errorCorrectionLevel}getRowCount(){return this.rowCount}getRowCountUpperPart(){return this.rowCountUpperPart}getRowCountLowerPart(){return this.rowCountLowerPart}}class Ye{constructor(){this.buffer=""}static form(t,e){let n=-1;function r(t,r,i,s,o,a){if("%%"===t)return"%";if(void 0===e[++n])return;t=s?parseInt(s.substr(1)):void 0;let c,l=o?parseInt(o.substr(1)):void 0;switch(a){case"s":c=e[n];break;case"c":c=e[n][0];break;case"f":c=parseFloat(e[n]).toFixed(t);break;case"p":c=parseFloat(e[n]).toPrecision(t);break;case"e":c=parseFloat(e[n]).toExponential(t);break;case"x":c=parseInt(e[n]).toString(l||16);break;case"d":c=parseFloat(parseInt(e[n],l||10).toPrecision(t)).toFixed(0);break}c="object"===typeof c?JSON.stringify(c):(+c).toString(l);let u=parseInt(i),h=i&&i[0]+""==="0"?"0":" ";while(c.length<u)c=void 0!==r?c+h:h+c;return c}let i=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return t.replace(i,r)}format(t,...e){this.buffer+=Ye.form(t,e)}toString(){return this.buffer}}class Xe{constructor(t){this.boundingBox=new qe(t),this.codewords=new Array(t.getMaxY()-t.getMinY()+1)}getCodewordNearby(t){let e=this.getCodeword(t);if(null!=e)return e;for(let n=1;n<Xe.MAX_NEARBY_DISTANCE;n++){let r=this.imageRowToCodewordIndex(t)-n;if(r>=0&&(e=this.codewords[r],null!=e))return e;if(r=this.imageRowToCodewordIndex(t)+n,r<this.codewords.length&&(e=this.codewords[r],null!=e))return e}return null}imageRowToCodewordIndex(t){return t-this.boundingBox.getMinY()}setCodeword(t,e){this.codewords[this.imageRowToCodewordIndex(t)]=e}getCodeword(t){return this.codewords[this.imageRowToCodewordIndex(t)]}getBoundingBox(){return this.boundingBox}getCodewords(){return this.codewords}toString(){const t=new Ye;let e=0;for(const n of this.codewords)null!=n?t.format("%3d: %3d|%3d%n",e++,n.getRowNumber(),n.getValue()):t.format("%3d:    |   %n",e++);return t.toString()}}Xe.MAX_NEARBY_DISTANCE=5;class Qe{constructor(){this.values=new Map}setValue(t){t=Math.trunc(t);let e=this.values.get(t);null==e&&(e=0),e++,this.values.set(t,e)}getValue(){let t=-1,e=new Array;for(const[n,r]of this.values.entries()){const i={getKey:()=>n,getValue:()=>r};i.getValue()>t?(t=i.getValue(),e=[],e.push(i.getKey())):i.getValue()===t&&e.push(i.getKey())}return ze.toIntArray(e)}getConfidence(t){return this.values.get(t)}}class Je extends Xe{constructor(t,e){super(t),this._isLeft=e}setRowNumbers(){for(let t of this.getCodewords())null!=t&&t.setRowNumberAsRowIndicatorColumn()}adjustCompleteIndicatorColumnRowNumbers(t){let e=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(e,t);let n=this.getBoundingBox(),r=this._isLeft?n.getTopLeft():n.getTopRight(),i=this._isLeft?n.getBottomLeft():n.getBottomRight(),s=this.imageRowToCodewordIndex(Math.trunc(r.getY())),o=this.imageRowToCodewordIndex(Math.trunc(i.getY())),a=-1,c=1,l=0;for(let u=s;u<o;u++){if(null==e[u])continue;let n=e[u],r=n.getRowNumber()-a;if(0===r)l++;else if(1===r)c=Math.max(c,l),l=1,a=n.getRowNumber();else if(r<0||n.getRowNumber()>=t.getRowCount()||r>u)e[u]=null;else{let t;t=c>2?(c-2)*r:r;let i=t>=u;for(let n=1;n<=t&&!i;n++)i=null!=e[u-n];i?e[u]=null:(a=n.getRowNumber(),l=1)}}}getRowHeights(){let t=this.getBarcodeMetadata();if(null==t)return null;this.adjustIncompleteIndicatorColumnRowNumbers(t);let e=new Int32Array(t.getRowCount());for(let n of this.getCodewords())if(null!=n){let t=n.getRowNumber();if(t>=e.length)continue;e[t]++}return e}adjustIncompleteIndicatorColumnRowNumbers(t){let e=this.getBoundingBox(),n=this._isLeft?e.getTopLeft():e.getTopRight(),r=this._isLeft?e.getBottomLeft():e.getBottomRight(),i=this.imageRowToCodewordIndex(Math.trunc(n.getY())),s=this.imageRowToCodewordIndex(Math.trunc(r.getY())),o=this.getCodewords(),a=-1;for(let c=i;c<s;c++){if(null==o[c])continue;let e=o[c];e.setRowNumberAsRowIndicatorColumn();let n=e.getRowNumber()-a;0===n||(1===n?a=e.getRowNumber():e.getRowNumber()>=t.getRowCount()?o[c]=null:a=e.getRowNumber())}}getBarcodeMetadata(){let t=this.getCodewords(),e=new Qe,n=new Qe,r=new Qe,i=new Qe;for(let o of t){if(null==o)continue;o.setRowNumberAsRowIndicatorColumn();let t=o.getValue()%30,s=o.getRowNumber();switch(this._isLeft||(s+=2),s%3){case 0:n.setValue(3*t+1);break;case 1:i.setValue(t/3),r.setValue(t%3);break;case 2:e.setValue(t+1);break}}if(0===e.getValue().length||0===n.getValue().length||0===r.getValue().length||0===i.getValue().length||e.getValue()[0]<1||n.getValue()[0]+r.getValue()[0]<ze.MIN_ROWS_IN_BARCODE||n.getValue()[0]+r.getValue()[0]>ze.MAX_ROWS_IN_BARCODE)return null;let s=new We(e.getValue()[0],n.getValue()[0],r.getValue()[0],i.getValue()[0]);return this.removeIncorrectCodewords(t,s),s}removeIncorrectCodewords(t,e){for(let n=0;n<t.length;n++){let r=t[n];if(null==t[n])continue;let i=r.getValue()%30,s=r.getRowNumber();if(s>e.getRowCount())t[n]=null;else switch(this._isLeft||(s+=2),s%3){case 0:3*i+1!==e.getRowCountUpperPart()&&(t[n]=null);break;case 1:Math.trunc(i/3)===e.getErrorCorrectionLevel()&&i%3===e.getRowCountLowerPart()||(t[n]=null);break;case 2:i+1!==e.getColumnCount()&&(t[n]=null);break}}}isLeft(){return this._isLeft}toString(){return"IsLeft: "+this._isLeft+"\n"+super.toString()}}class Ze{constructor(t,e){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=t,this.barcodeColumnCount=t.getColumnCount(),this.boundingBox=e,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}getDetectionResultColumns(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);let t,e=ze.MAX_CODEWORDS_IN_BARCODE;do{t=e,e=this.adjustRowNumbersAndGetCount()}while(e>0&&e<t);return this.detectionResultColumns}adjustIndicatorColumnRowNumbers(t){null!=t&&t.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)}adjustRowNumbersAndGetCount(){let t=this.adjustRowNumbersByRow();if(0===t)return 0;for(let e=1;e<this.barcodeColumnCount+1;e++){let t=this.detectionResultColumns[e].getCodewords();for(let n=0;n<t.length;n++)null!=t[n]&&(t[n].hasValidRowNumber()||this.adjustRowNumbers(e,n,t))}return t}adjustRowNumbersByRow(){this.adjustRowNumbersFromBothRI();let t=this.adjustRowNumbersFromLRI();return t+this.adjustRowNumbersFromRRI()}adjustRowNumbersFromBothRI(){if(null==this.detectionResultColumns[0]||null==this.detectionResultColumns[this.barcodeColumnCount+1])return;let t=this.detectionResultColumns[0].getCodewords(),e=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<t.length;n++)if(null!=t[n]&&null!=e[n]&&t[n].getRowNumber()===e[n].getRowNumber())for(let e=1;e<=this.barcodeColumnCount;e++){let r=this.detectionResultColumns[e].getCodewords()[n];null!=r&&(r.setRowNumber(t[n].getRowNumber()),r.hasValidRowNumber()||(this.detectionResultColumns[e].getCodewords()[n]=null))}}adjustRowNumbersFromRRI(){if(null==this.detectionResultColumns[this.barcodeColumnCount+1])return 0;let t=0,e=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords();for(let n=0;n<e.length;n++){if(null==e[n])continue;let r=e[n].getRowNumber(),i=0;for(let e=this.barcodeColumnCount+1;e>0&&i<this.ADJUST_ROW_NUMBER_SKIP;e--){let s=this.detectionResultColumns[e].getCodewords()[n];null!=s&&(i=Ze.adjustRowNumberIfValid(r,i,s),s.hasValidRowNumber()||t++)}}return t}adjustRowNumbersFromLRI(){if(null==this.detectionResultColumns[0])return 0;let t=0,e=this.detectionResultColumns[0].getCodewords();for(let n=0;n<e.length;n++){if(null==e[n])continue;let r=e[n].getRowNumber(),i=0;for(let e=1;e<this.barcodeColumnCount+1&&i<this.ADJUST_ROW_NUMBER_SKIP;e++){let s=this.detectionResultColumns[e].getCodewords()[n];null!=s&&(i=Ze.adjustRowNumberIfValid(r,i,s),s.hasValidRowNumber()||t++)}}return t}static adjustRowNumberIfValid(t,e,n){return null==n||n.hasValidRowNumber()||(n.isValidRowNumber(t)?(n.setRowNumber(t),e=0):++e),e}adjustRowNumbers(t,e,n){if(!this.detectionResultColumns[t-1])return;let r=n[e],i=this.detectionResultColumns[t-1].getCodewords(),s=i;null!=this.detectionResultColumns[t+1]&&(s=this.detectionResultColumns[t+1].getCodewords());let o=new Array(14);o[2]=i[e],o[3]=s[e],e>0&&(o[0]=n[e-1],o[4]=i[e-1],o[5]=s[e-1]),e>1&&(o[8]=n[e-2],o[10]=i[e-2],o[11]=s[e-2]),e<n.length-1&&(o[1]=n[e+1],o[6]=i[e+1],o[7]=s[e+1]),e<n.length-2&&(o[9]=n[e+2],o[12]=i[e+2],o[13]=s[e+2]);for(let a of o)if(Ze.adjustRowNumber(r,a))return}static adjustRowNumber(t,e){return null!=e&&(!(!e.hasValidRowNumber()||e.getBucket()!==t.getBucket())&&(t.setRowNumber(e.getRowNumber()),!0))}getBarcodeColumnCount(){return this.barcodeColumnCount}getBarcodeRowCount(){return this.barcodeMetadata.getRowCount()}getBarcodeECLevel(){return this.barcodeMetadata.getErrorCorrectionLevel()}setBoundingBox(t){this.boundingBox=t}getBoundingBox(){return this.boundingBox}setDetectionResultColumn(t,e){this.detectionResultColumns[t]=e}getDetectionResultColumn(t){return this.detectionResultColumns[t]}toString(){let t=this.detectionResultColumns[0];null==t&&(t=this.detectionResultColumns[this.barcodeColumnCount+1]);let e=new Ye;for(let n=0;n<t.getCodewords().length;n++){e.format("CW %3d:",n);for(let t=0;t<this.barcodeColumnCount+2;t++){if(null==this.detectionResultColumns[t]){e.format("    |   ");continue}let r=this.detectionResultColumns[t].getCodewords()[n];null!=r?e.format(" %3d|%3d",r.getRowNumber(),r.getValue()):e.format("    |   ")}e.format("%n")}return e.toString()}}class tn{constructor(t,e,n,r){this.rowNumber=tn.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(t),this.endX=Math.trunc(e),this.bucket=Math.trunc(n),this.value=Math.trunc(r)}hasValidRowNumber(){return this.isValidRowNumber(this.rowNumber)}isValidRowNumber(t){return t!==tn.BARCODE_ROW_UNKNOWN&&this.bucket===t%3*3}setRowNumberAsRowIndicatorColumn(){this.rowNumber=Math.trunc(3*Math.trunc(this.value/30)+Math.trunc(this.bucket/3))}getWidth(){return this.endX-this.startX}getStartX(){return this.startX}getEndX(){return this.endX}getBucket(){return this.bucket}getValue(){return this.value}getRowNumber(){return this.rowNumber}setRowNumber(t){this.rowNumber=t}toString(){return this.rowNumber+"|"+this.value}}tn.BARCODE_ROW_UNKNOWN=-1;class en{static initialize(){for(let t=0;t<ze.SYMBOL_TABLE.length;t++){let e=ze.SYMBOL_TABLE[t],n=1&e;for(let r=0;r<ze.BARS_IN_MODULE;r++){let i=0;while((1&e)===n)i+=1,e>>=1;n=1&e,en.RATIOS_TABLE[t]||(en.RATIOS_TABLE[t]=new Array(ze.BARS_IN_MODULE)),en.RATIOS_TABLE[t][ze.BARS_IN_MODULE-r-1]=Math.fround(i/ze.MODULES_IN_CODEWORD)}}this.bSymbolTableReady=!0}static getDecodedValue(t){let e=en.getDecodedCodewordValue(en.sampleBitCounts(t));return-1!==e?e:en.getClosestDecodedValue(t)}static sampleBitCounts(t){let e=st.sum(t),n=new Int32Array(ze.BARS_IN_MODULE),r=0,i=0;for(let s=0;s<ze.MODULES_IN_CODEWORD;s++){let o=e/(2*ze.MODULES_IN_CODEWORD)+s*e/ze.MODULES_IN_CODEWORD;i+t[r]<=o&&(i+=t[r],r++),n[r]++}return n}static getDecodedCodewordValue(t){let e=en.getBitValue(t);return-1===ze.getCodeword(e)?-1:e}static getBitValue(t){let e=0;for(let n=0;n<t.length;n++)for(let r=0;r<t[n];r++)e=e<<1|(n%2===0?1:0);return Math.trunc(e)}static getClosestDecodedValue(t){let e=st.sum(t),n=new Array(ze.BARS_IN_MODULE);if(e>1)for(let s=0;s<n.length;s++)n[s]=Math.fround(t[s]/e);let r=ot.MAX_VALUE,i=-1;this.bSymbolTableReady||en.initialize();for(let s=0;s<en.RATIOS_TABLE.length;s++){let t=0,e=en.RATIOS_TABLE[s];for(let i=0;i<ze.BARS_IN_MODULE;i++){let s=Math.fround(e[i]-n[i]);if(t+=Math.fround(s*s),t>=r)break}t<r&&(r=t,i=ze.SYMBOL_TABLE[s])}return i}}en.bSymbolTableReady=!1,en.RATIOS_TABLE=new Array(ze.SYMBOL_TABLE.length).map((t=>new Array(ze.BARS_IN_MODULE)));class nn{constructor(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}getSegmentIndex(){return this.segmentIndex}setSegmentIndex(t){this.segmentIndex=t}getFileId(){return this.fileId}setFileId(t){this.fileId=t}getOptionalData(){return this.optionalData}setOptionalData(t){this.optionalData=t}isLastSegment(){return this.lastSegment}setLastSegment(t){this.lastSegment=t}getSegmentCount(){return this.segmentCount}setSegmentCount(t){this.segmentCount=t}getSender(){return this.sender||null}setSender(t){this.sender=t}getAddressee(){return this.addressee||null}setAddressee(t){this.addressee=t}getFileName(){return this.fileName}setFileName(t){this.fileName=t}getFileSize(){return this.fileSize}setFileSize(t){this.fileSize=t}getChecksum(){return this.checksum}setChecksum(t){this.checksum=t}getTimestamp(){return this.timestamp}setTimestamp(t){this.timestamp=t}}class rn{static parseLong(t,e=undefined){return parseInt(t,e)}}class sn extends l{}sn.kind="NullPointerException";class on{writeBytes(t){this.writeBytesOffset(t,0,t.length)}writeBytesOffset(t,e,n){if(null==t)throw new sn;if(e<0||e>t.length||n<0||e+n>t.length||e+n<0)throw new m;if(0!==n)for(let r=0;r<n;r++)this.write(t[e+r])}flush(){}close(){}}class an extends l{}class cn extends on{constructor(t=32){if(super(),this.count=0,t<0)throw new h("Negative initial size: "+t);this.buf=new Uint8Array(t)}ensureCapacity(t){t-this.buf.length>0&&this.grow(t)}grow(t){let e=this.buf.length,n=e<<1;if(n-t<0&&(n=t),n<0){if(t<0)throw new an;n=b.MAX_VALUE}this.buf=w.copyOfUint8Array(this.buf,n)}write(t){this.ensureCapacity(this.count+1),this.buf[this.count]=t,this.count+=1}writeBytesOffset(t,e,n){if(e<0||e>t.length||n<0||e+n-t.length>0)throw new m;this.ensureCapacity(this.count+n),g.arraycopy(t,e,this.buf,this.count,n),this.count+=n}writeTo(t){t.writeBytesOffset(this.buf,0,this.count)}reset(){this.count=0}toByteArray(){return w.copyOfUint8Array(this.buf,this.count)}size(){return this.count}toString(t){return t?"string"===typeof t?this.toString_string(t):this.toString_number(t):this.toString_void()}toString_void(){return new String(this.buf).toString()}toString_string(t){return new String(this.buf).toString()}toString_number(t){return new String(this.buf).toString()}close(){}}function ln(){if("undefined"!==typeof window)return window["BigInt"]||null;if("undefined"!==typeof n.g)return n.g["BigInt"]||null;if("undefined"!==typeof self)return self["BigInt"]||null;throw new Error("Can't search globals for BigInt!")}let un;function hn(t){if("undefined"===typeof un&&(un=ln()),null===un)throw new Error("BigInt is not supported!");return un(t)}function dn(){let t=[];t[0]=hn(1);let e=hn(900);t[1]=e;for(let n=2;n<16;n++)t[n]=t[n-1]*e;return t}(function(t){t[t["ALPHA"]=0]="ALPHA",t[t["LOWER"]=1]="LOWER",t[t["MIXED"]=2]="MIXED",t[t["PUNCT"]=3]="PUNCT",t[t["ALPHA_SHIFT"]=4]="ALPHA_SHIFT",t[t["PUNCT_SHIFT"]=5]="PUNCT_SHIFT"})(W||(W={}));class fn{static decode(t,e){let n=new k(""),r=A.ISO8859_1;n.enableDecoding(r);let i=1,s=t[i++],o=new nn;while(i<t[0]){switch(s){case fn.TEXT_COMPACTION_MODE_LATCH:i=fn.textCompaction(t,i,n);break;case fn.BYTE_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:i=fn.byteCompaction(s,t,r,i,n);break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:n.append(t[i++]);break;case fn.NUMERIC_COMPACTION_MODE_LATCH:i=fn.numericCompaction(t,i,n);break;case fn.ECI_CHARSET:A.getCharacterSetECIByValue(t[i++]);break;case fn.ECI_GENERAL_PURPOSE:i+=2;break;case fn.ECI_USER_DEFINED:i++;break;case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:i=fn.decodeMacroBlock(t,i,o);break;case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:throw new S;default:i--,i=fn.textCompaction(t,i,n);break}if(!(i<t.length))throw S.getFormatInstance();s=t[i++]}if(0===n.length())throw S.getFormatInstance();let a=new X(null,n.toString(),null,e);return a.setOther(o),a}static decodeMacroBlock(t,e,n){if(e+fn.NUMBER_OF_SEQUENCE_CODEWORDS>t[0])throw S.getFormatInstance();let r=new Int32Array(fn.NUMBER_OF_SEQUENCE_CODEWORDS);for(let o=0;o<fn.NUMBER_OF_SEQUENCE_CODEWORDS;o++,e++)r[o]=t[e];n.setSegmentIndex(b.parseInt(fn.decodeBase900toBase10(r,fn.NUMBER_OF_SEQUENCE_CODEWORDS)));let i=new k;e=fn.textCompaction(t,e,i),n.setFileId(i.toString());let s=-1;t[e]===fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(s=e+1);while(e<t[0])switch(t[e]){case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(e++,t[e]){case fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:let r=new k;e=fn.textCompaction(t,e+1,r),n.setFileName(r.toString());break;case fn.MACRO_PDF417_OPTIONAL_FIELD_SENDER:let i=new k;e=fn.textCompaction(t,e+1,i),n.setSender(i.toString());break;case fn.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:let s=new k;e=fn.textCompaction(t,e+1,s),n.setAddressee(s.toString());break;case fn.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:let o=new k;e=fn.numericCompaction(t,e+1,o),n.setSegmentCount(b.parseInt(o.toString()));break;case fn.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:let a=new k;e=fn.numericCompaction(t,e+1,a),n.setTimestamp(rn.parseLong(a.toString()));break;case fn.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:let c=new k;e=fn.numericCompaction(t,e+1,c),n.setChecksum(b.parseInt(c.toString()));break;case fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:let l=new k;e=fn.numericCompaction(t,e+1,l),n.setFileSize(rn.parseLong(l.toString()));break;default:throw S.getFormatInstance()}break;case fn.MACRO_PDF417_TERMINATOR:e++,n.setLastSegment(!0);break;default:throw S.getFormatInstance()}if(-1!==s){let r=e-s;n.isLastSegment()&&r--,n.setOptionalData(w.copyOfRange(t,s,s+r))}return e}static textCompaction(t,e,n){let r=new Int32Array(2*(t[0]-e)),i=new Int32Array(2*(t[0]-e)),s=0,o=!1;while(e<t[0]&&!o){let n=t[e++];if(n<fn.TEXT_COMPACTION_MODE_LATCH)r[s]=n/30,r[s+1]=n%30,s+=2;else switch(n){case fn.TEXT_COMPACTION_MODE_LATCH:r[s++]=fn.TEXT_COMPACTION_MODE_LATCH;break;case fn.BYTE_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.NUMERIC_COMPACTION_MODE_LATCH:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:e--,o=!0;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r[s]=fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,n=t[e++],i[s]=n,s++;break}}return fn.decodeTextCompaction(r,i,s,n),e}static decodeTextCompaction(t,e,n,r){let i=W.ALPHA,s=W.ALPHA,o=0;while(o<n){let n=t[o],a="";switch(i){case W.ALPHA:if(n<26)a=String.fromCharCode(65+n);else switch(n){case 26:a=" ";break;case fn.LL:i=W.LOWER;break;case fn.ML:i=W.MIXED;break;case fn.PS:s=i,i=W.PUNCT_SHIFT;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:i=W.ALPHA;break}break;case W.LOWER:if(n<26)a=String.fromCharCode(97+n);else switch(n){case 26:a=" ";break;case fn.AS:s=i,i=W.ALPHA_SHIFT;break;case fn.ML:i=W.MIXED;break;case fn.PS:s=i,i=W.PUNCT_SHIFT;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:i=W.ALPHA;break}break;case W.MIXED:if(n<fn.PL)a=fn.MIXED_CHARS[n];else switch(n){case fn.PL:i=W.PUNCT;break;case 26:a=" ";break;case fn.LL:i=W.LOWER;break;case fn.AL:i=W.ALPHA;break;case fn.PS:s=i,i=W.PUNCT_SHIFT;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:i=W.ALPHA;break}break;case W.PUNCT:if(n<fn.PAL)a=fn.PUNCT_CHARS[n];else switch(n){case fn.PAL:i=W.ALPHA;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:i=W.ALPHA;break}break;case W.ALPHA_SHIFT:if(i=s,n<26)a=String.fromCharCode(65+n);else switch(n){case 26:a=" ";break;case fn.TEXT_COMPACTION_MODE_LATCH:i=W.ALPHA;break}break;case W.PUNCT_SHIFT:if(i=s,n<fn.PAL)a=fn.PUNCT_CHARS[n];else switch(n){case fn.PAL:i=W.ALPHA;break;case fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:r.append(e[o]);break;case fn.TEXT_COMPACTION_MODE_LATCH:i=W.ALPHA;break}break}""!==a&&r.append(a),o++}}static byteCompaction(t,e,n,r,i){let s=new cn,o=0,a=0,c=!1;switch(t){case fn.BYTE_COMPACTION_MODE_LATCH:let t=new Int32Array(6),n=e[r++];while(r<e[0]&&!c)switch(t[o++]=n,a=900*a+n,n=e[r++],n){case fn.TEXT_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH:case fn.NUMERIC_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:r--,c=!0;break;default:if(o%5===0&&o>0){for(let t=0;t<6;++t)s.write(Number(hn(a)>>hn(8*(5-t))));a=0,o=0}break}r===e[0]&&n<fn.TEXT_COMPACTION_MODE_LATCH&&(t[o++]=n);for(let e=0;e<o;e++)s.write(t[e]);break;case fn.BYTE_COMPACTION_MODE_LATCH_6:while(r<e[0]&&!c){let t=e[r++];if(t<fn.TEXT_COMPACTION_MODE_LATCH)o++,a=900*a+t;else switch(t){case fn.TEXT_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH:case fn.NUMERIC_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:r--,c=!0;break}if(o%5===0&&o>0){for(let t=0;t<6;++t)s.write(Number(hn(a)>>hn(8*(5-t))));a=0,o=0}}break}return i.append(I.decode(s.toByteArray(),n)),r}static numericCompaction(t,e,n){let r=0,i=!1,s=new Int32Array(fn.MAX_NUMERIC_CODEWORDS);while(e<t[0]&&!i){let o=t[e++];if(e===t[0]&&(i=!0),o<fn.TEXT_COMPACTION_MODE_LATCH)s[r]=o,r++;else switch(o){case fn.TEXT_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH:case fn.BYTE_COMPACTION_MODE_LATCH_6:case fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case fn.MACRO_PDF417_TERMINATOR:e--,i=!0;break}(r%fn.MAX_NUMERIC_CODEWORDS===0||o===fn.NUMERIC_COMPACTION_MODE_LATCH||i)&&r>0&&(n.append(fn.decodeBase900toBase10(s,r)),r=0)}return e}static decodeBase900toBase10(t,e){let n=hn(0);for(let i=0;i<e;i++)n+=fn.EXP900[e-i-1]*hn(t[i]);let r=n.toString();if("1"!==r.charAt(0))throw new S;return r.substring(1)}}fn.TEXT_COMPACTION_MODE_LATCH=900,fn.BYTE_COMPACTION_MODE_LATCH=901,fn.NUMERIC_COMPACTION_MODE_LATCH=902,fn.BYTE_COMPACTION_MODE_LATCH_6=924,fn.ECI_USER_DEFINED=925,fn.ECI_GENERAL_PURPOSE=926,fn.ECI_CHARSET=927,fn.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,fn.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,fn.MACRO_PDF417_TERMINATOR=922,fn.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,fn.MAX_NUMERIC_CODEWORDS=15,fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,fn.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,fn.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,fn.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,fn.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,fn.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,fn.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,fn.PL=25,fn.LL=27,fn.AS=27,fn.ML=28,fn.AL=28,fn.PS=29,fn.PAL=29,fn.PUNCT_CHARS=";<>@[\\]_`~!\r\t,:\n-.$/\"|*()?{}'",fn.MIXED_CHARS="0123456789&\r\t,:#-.$/+%*=^",fn.EXP900=ln()?dn():[],fn.NUMBER_OF_SEQUENCE_CODEWORDS=2;class pn{constructor(){}static decode(t,e,n,r,i,s,o){let a,c=new qe(t,e,n,r,i),l=null,u=null;for(let f=!0;;f=!1){if(null!=e&&(l=pn.getRowIndicatorColumn(t,c,e,!0,s,o)),null!=r&&(u=pn.getRowIndicatorColumn(t,c,r,!1,s,o)),a=pn.merge(l,u),null==a)throw N.getNotFoundInstance();let n=a.getBoundingBox();if(!f||null==n||!(n.getMinY()<c.getMinY()||n.getMaxY()>c.getMaxY()))break;c=n}a.setBoundingBox(c);let h=a.getBarcodeColumnCount()+1;a.setDetectionResultColumn(0,l),a.setDetectionResultColumn(h,u);let d=null!=l;for(let f=1;f<=h;f++){let e,n=d?f:h-f;if(void 0!==a.getDetectionResultColumn(n))continue;e=0===n||n===h?new Je(c,0===n):new Xe(c),a.setDetectionResultColumn(n,e);let r=-1,i=r;for(let l=c.getMinY();l<=c.getMaxY();l++){if(r=pn.getStartColumn(a,n,l,d),r<0||r>c.getMaxX()){if(-1===i)continue;r=i}let u=pn.detectCodeword(t,c.getMinX(),c.getMaxX(),d,r,l,s,o);null!=u&&(e.setCodeword(l,u),i=r,s=Math.min(s,u.getWidth()),o=Math.max(o,u.getWidth()))}}return pn.createDecoderResult(a)}static merge(t,e){if(null==t&&null==e)return null;let n=pn.getBarcodeMetadata(t,e);if(null==n)return null;let r=qe.merge(pn.adjustBoundingBox(t),pn.adjustBoundingBox(e));return new Ze(n,r)}static adjustBoundingBox(t){if(null==t)return null;let e=t.getRowHeights();if(null==e)return null;let n=pn.getMax(e),r=0;for(let o of e)if(r+=n-o,o>0)break;let i=t.getCodewords();for(let o=0;r>0&&null==i[o];o++)r--;let s=0;for(let o=e.length-1;o>=0;o--)if(s+=n-e[o],e[o]>0)break;for(let o=i.length-1;s>0&&null==i[o];o--)s--;return t.getBoundingBox().addMissingRows(r,s,t.isLeft())}static getMax(t){let e=-1;for(let n of t)e=Math.max(e,n);return e}static getBarcodeMetadata(t,e){let n,r;return null==t||null==(n=t.getBarcodeMetadata())?null==e?null:e.getBarcodeMetadata():null==e||null==(r=e.getBarcodeMetadata())?n:n.getColumnCount()!==r.getColumnCount()&&n.getErrorCorrectionLevel()!==r.getErrorCorrectionLevel()&&n.getRowCount()!==r.getRowCount()?null:n}static getRowIndicatorColumn(t,e,n,r,i,s){let o=new Je(e,r);for(let a=0;a<2;a++){let c=0===a?1:-1,l=Math.trunc(Math.trunc(n.getX()));for(let a=Math.trunc(Math.trunc(n.getY()));a<=e.getMaxY()&&a>=e.getMinY();a+=c){let e=pn.detectCodeword(t,0,t.getWidth(),r,l,a,i,s);null!=e&&(o.setCodeword(a,e),l=r?e.getStartX():e.getEndX())}}return o}static adjustCodewordCount(t,e){let n=e[0][1],r=n.getValue(),i=t.getBarcodeColumnCount()*t.getBarcodeRowCount()-pn.getNumberOfECCodeWords(t.getBarcodeECLevel());if(0===r.length){if(i<1||i>ze.MAX_CODEWORDS_IN_BARCODE)throw N.getNotFoundInstance();n.setValue(i)}else r[0]!==i&&n.setValue(i)}static createDecoderResult(t){let e=pn.createBarcodeMatrix(t);pn.adjustCodewordCount(t,e);let n=new Array,r=new Int32Array(t.getBarcodeRowCount()*t.getBarcodeColumnCount()),i=[],s=new Array;for(let a=0;a<t.getBarcodeRowCount();a++)for(let o=0;o<t.getBarcodeColumnCount();o++){let c=e[a][o+1].getValue(),l=a*t.getBarcodeColumnCount()+o;0===c.length?n.push(l):1===c.length?r[l]=c[0]:(s.push(l),i.push(c))}let o=new Array(i.length);for(let a=0;a<o.length;a++)o[a]=i[a];return pn.createDecoderResultFromAmbiguousValues(t.getBarcodeECLevel(),r,ze.toIntArray(n),ze.toIntArray(s),o)}static createDecoderResultFromAmbiguousValues(t,e,n,r,i){let s=new Int32Array(r.length),o=100;while(o-- >0){for(let t=0;t<s.length;t++)e[r[t]]=i[t][s[t]];try{return pn.decodeCodewords(e,t,n)}catch(a){let t=a instanceof f;if(!t)throw a}if(0===s.length)throw f.getChecksumInstance();for(let t=0;t<s.length;t++){if(s[t]<i[t].length-1){s[t]++;break}if(s[t]=0,t===s.length-1)throw f.getChecksumInstance()}}throw f.getChecksumInstance()}static createBarcodeMatrix(t){let e=Array.from({length:t.getBarcodeRowCount()},(()=>new Array(t.getBarcodeColumnCount()+2)));for(let r=0;r<e.length;r++)for(let t=0;t<e[r].length;t++)e[r][t]=new Qe;let n=0;for(let r of t.getDetectionResultColumns()){if(null!=r)for(let t of r.getCodewords())if(null!=t){let r=t.getRowNumber();if(r>=0){if(r>=e.length)continue;e[r][n].setValue(t.getValue())}}n++}return e}static isValidBarcodeColumn(t,e){return e>=0&&e<=t.getBarcodeColumnCount()+1}static getStartColumn(t,e,n,r){let i=r?1:-1,s=null;if(pn.isValidBarcodeColumn(t,e-i)&&(s=t.getDetectionResultColumn(e-i).getCodeword(n)),null!=s)return r?s.getEndX():s.getStartX();if(s=t.getDetectionResultColumn(e).getCodewordNearby(n),null!=s)return r?s.getStartX():s.getEndX();if(pn.isValidBarcodeColumn(t,e-i)&&(s=t.getDetectionResultColumn(e-i).getCodewordNearby(n)),null!=s)return r?s.getEndX():s.getStartX();let o=0;while(pn.isValidBarcodeColumn(t,e-i)){e-=i;for(let n of t.getDetectionResultColumn(e).getCodewords())if(null!=n)return(r?n.getEndX():n.getStartX())+i*o*(n.getEndX()-n.getStartX());o++}return r?t.getBoundingBox().getMinX():t.getBoundingBox().getMaxX()}static detectCodeword(t,e,n,r,i,s,o,a){i=pn.adjustCodewordStartColumn(t,e,n,r,i,s);let c,l=pn.getModuleBitCount(t,e,n,r,i,s);if(null==l)return null;let u=st.sum(l);if(r)c=i+u;else{for(let t=0;t<l.length/2;t++){let e=l[t];l[t]=l[l.length-1-t],l[l.length-1-t]=e}c=i,i=c-u}if(!pn.checkCodewordSkew(u,o,a))return null;let h=en.getDecodedValue(l),d=ze.getCodeword(h);return-1===d?null:new tn(i,c,pn.getCodewordBucketNumber(h),d)}static getModuleBitCount(t,e,n,r,i,s){let o=i,a=new Int32Array(8),c=0,l=r?1:-1,u=r;while((r?o<n:o>=e)&&c<a.length)t.get(o,s)===u?(a[c]++,o+=l):(c++,u=!u);return c===a.length||o===(r?n:e)&&c===a.length-1?a:null}static getNumberOfECCodeWords(t){return 2<<t}static adjustCodewordStartColumn(t,e,n,r,i,s){let o=i,a=r?-1:1;for(let c=0;c<2;c++){while((r?o>=e:o<n)&&r===t.get(o,s)){if(Math.abs(i-o)>pn.CODEWORD_SKEW_SIZE)return i;o+=a}a=-a,r=!r}return o}static checkCodewordSkew(t,e,n){return e-pn.CODEWORD_SKEW_SIZE<=t&&t<=n+pn.CODEWORD_SKEW_SIZE}static decodeCodewords(t,e,n){if(0===t.length)throw S.getFormatInstance();let r=1<<e+1,i=pn.correctErrors(t,n,r);pn.verifyCodewordCount(t,r);let s=fn.decode(t,""+e);return s.setErrorsCorrected(i),s.setErasures(n.length),s}static correctErrors(t,e,n){if(null!=e&&e.length>n/2+pn.MAX_ERRORS||n<0||n>pn.MAX_EC_CODEWORDS)throw f.getChecksumInstance();return pn.errorCorrection.decode(t,n,e)}static verifyCodewordCount(t,e){if(t.length<4)throw S.getFormatInstance();let n=t[0];if(n>t.length)throw S.getFormatInstance();if(0===n){if(!(e<t.length))throw S.getFormatInstance();t[0]=t.length-e}}static getBitCountForCodeword(t){let e=new Int32Array(8),n=0,r=e.length-1;while(1){if((1&t)!==n&&(n=1&t,r--,r<0))break;e[r]++,t>>=1}return e}static getCodewordBucketNumber(t){return t instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(t):this.getCodewordBucketNumber_number(t)}static getCodewordBucketNumber_number(t){return pn.getCodewordBucketNumber(pn.getBitCountForCodeword(t))}static getCodewordBucketNumber_Int32Array(t){return(t[0]-t[2]+t[4]-t[6]+9)%9}static toString(t){let e=new Ye;for(let n=0;n<t.length;n++){e.format("Row %2d: ",n);for(let r=0;r<t[n].length;r++){let i=t[n][r];0===i.getValue().length?e.format("        ",null):e.format("%4d(%2d)",i.getValue()[0],i.getConfidence(i.getValue()[0]))}e.format("%n")}return e.toString()}}pn.CODEWORD_SKEW_SIZE=2,pn.MAX_ERRORS=3,pn.MAX_EC_CODEWORDS=512,pn.errorCorrection=new Ge;class gn{decode(t,e=null){let n=gn.decode(t,e,!1);if(null==n||0===n.length||null==n[0])throw N.getNotFoundInstance();return n[0]}decodeMultiple(t,e=null){try{return gn.decode(t,e,!0)}catch(n){if(n instanceof S||n instanceof f)throw N.getNotFoundInstance();throw n}}static decode(t,e,n){const r=new Array,i=je.detectMultiple(t,e,n);for(const s of i.getPoints()){const t=pn.decode(i.getBits(),s[4],s[5],s[6],s[7],gn.getMinCodewordWidth(s),gn.getMaxCodewordWidth(s)),e=new z(t.getText(),t.getRawBytes(),void 0,s,j.PDF_417);e.putMetadata(Y.ERROR_CORRECTION_LEVEL,t.getECLevel());const n=t.getOther();null!=n&&e.putMetadata(Y.PDF417_EXTRA_METADATA,n),r.push(e)}return r.map((t=>t))}static getMaxWidth(t,e){return null==t||null==e?0:Math.trunc(Math.abs(t.getX()-e.getX()))}static getMinWidth(t,e){return null==t||null==e?b.MAX_VALUE:Math.trunc(Math.abs(t.getX()-e.getX()))}static getMaxCodewordWidth(t){return Math.floor(Math.max(Math.max(gn.getMaxWidth(t[0],t[4]),gn.getMaxWidth(t[6],t[2])*ze.MODULES_IN_CODEWORD/ze.MODULES_IN_STOP_PATTERN),Math.max(gn.getMaxWidth(t[1],t[5]),gn.getMaxWidth(t[7],t[3])*ze.MODULES_IN_CODEWORD/ze.MODULES_IN_STOP_PATTERN)))}static getMinCodewordWidth(t){return Math.floor(Math.min(Math.min(gn.getMinWidth(t[0],t[4]),gn.getMinWidth(t[6],t[2])*ze.MODULES_IN_CODEWORD/ze.MODULES_IN_STOP_PATTERN),Math.min(gn.getMinWidth(t[1],t[5]),gn.getMinWidth(t[7],t[3])*ze.MODULES_IN_CODEWORD/ze.MODULES_IN_STOP_PATTERN)))}reset(){}}class mn extends l{}mn.kind="ReaderException";class yn{constructor(t,e){this.verbose=!0===t,e&&this.setHints(e)}decode(t,e){return e&&this.setHints(e),this.decodeInternal(t)}decodeWithState(t){return null!==this.readers&&void 0!==this.readers||this.setHints(null),this.decodeInternal(t)}setHints(t){this.hints=t;const n=!e(t)&&!0===t.get(_.TRY_HARDER),r=e(t)?null:t.get(_.POSSIBLE_FORMATS),i=new Array;if(!e(r)){const e=r.some((t=>t===j.UPC_A||t===j.UPC_E||t===j.EAN_13||t===j.EAN_8||t===j.CODABAR||t===j.CODE_39||t===j.CODE_93||t===j.CODE_128||t===j.ITF||t===j.RSS_14||t===j.RSS_EXPANDED));e&&!n&&i.push(new ce(t,this.verbose)),r.includes(j.QR_CODE)&&i.push(new Fe),r.includes(j.DATA_MATRIX)&&i.push(new be),r.includes(j.AZTEC)&&i.push(new yt),r.includes(j.PDF_417)&&i.push(new gn),e&&n&&i.push(new ce(t,this.verbose))}0===i.length&&(n||i.push(new ce(t,this.verbose)),i.push(new Fe),i.push(new be),i.push(new yt),i.push(new gn),n&&i.push(new ce(t,this.verbose))),this.readers=i}reset(){if(null!==this.readers)for(const t of this.readers)t.reset()}decodeInternal(t){if(null===this.readers)throw new mn("No readers where selected, nothing can be read.");for(const n of this.readers)try{return n.decode(t,this.hints)}catch(e){if(e instanceof mn)continue}throw new N("No MultiFormat Readers were able to detect the code.")}}class wn extends F{constructor(t=null,e=500){const n=new yn;n.setHints(t),super(n,e)}decodeBitmap(t){return this.reader.decodeWithState(t)}}class bn extends F{constructor(t=500){super(new gn,t)}}class vn extends F{constructor(t=500){super(new Fe,t)}}var En;(function(t){t[t["ERROR_CORRECTION"]=0]="ERROR_CORRECTION",t[t["CHARACTER_SET"]=1]="CHARACTER_SET",t[t["DATA_MATRIX_SHAPE"]=2]="DATA_MATRIX_SHAPE",t[t["MIN_SIZE"]=3]="MIN_SIZE",t[t["MAX_SIZE"]=4]="MAX_SIZE",t[t["MARGIN"]=5]="MARGIN",t[t["PDF417_COMPACT"]=6]="PDF417_COMPACT",t[t["PDF417_COMPACTION"]=7]="PDF417_COMPACTION",t[t["PDF417_DIMENSIONS"]=8]="PDF417_DIMENSIONS",t[t["AZTEC_LAYERS"]=9]="AZTEC_LAYERS",t[t["QR_VERSION"]=10]="QR_VERSION"})(En||(En={}));var _n=En;class Sn{constructor(t){this.field=t,this.cachedGenerators=[],this.cachedGenerators.push(new J(t,Int32Array.from([1])))}buildGenerator(t){const e=this.cachedGenerators;if(t>=e.length){let n=e[e.length-1];const r=this.field;for(let i=e.length;i<=t;i++){const t=n.multiply(new J(r,Int32Array.from([1,r.exp(i-1+r.getGeneratorBase())])));e.push(t),n=t}}return e[t]}encode(t,e){if(0===e)throw new h("No error correction bytes");const n=t.length-e;if(n<=0)throw new h("No data bytes provided");const r=this.buildGenerator(e),i=new Int32Array(n);g.arraycopy(t,0,i,0,n);let s=new J(this.field,i);s=s.multiplyByMonomial(e,1);const o=s.divide(r)[1],a=o.getCoefficients(),c=e-a.length;for(let l=0;l<c;l++)t[n+l]=0;g.arraycopy(a,0,t,n+c,a.length)}}class An{constructor(){}static applyMaskPenaltyRule1(t){return An.applyMaskPenaltyRule1Internal(t,!0)+An.applyMaskPenaltyRule1Internal(t,!1)}static applyMaskPenaltyRule2(t){let e=0;const n=t.getArray(),r=t.getWidth(),i=t.getHeight();for(let s=0;s<i-1;s++){const t=n[s];for(let i=0;i<r-1;i++){const r=t[i];r===t[i+1]&&r===n[s+1][i]&&r===n[s+1][i+1]&&e++}}return An.N2*e}static applyMaskPenaltyRule3(t){let e=0;const n=t.getArray(),r=t.getWidth(),i=t.getHeight();for(let s=0;s<i;s++)for(let t=0;t<r;t++){const o=n[s];t+6<r&&1===o[t]&&0===o[t+1]&&1===o[t+2]&&1===o[t+3]&&1===o[t+4]&&0===o[t+5]&&1===o[t+6]&&(An.isWhiteHorizontal(o,t-4,t)||An.isWhiteHorizontal(o,t+7,t+11))&&e++,s+6<i&&1===n[s][t]&&0===n[s+1][t]&&1===n[s+2][t]&&1===n[s+3][t]&&1===n[s+4][t]&&0===n[s+5][t]&&1===n[s+6][t]&&(An.isWhiteVertical(n,t,s-4,s)||An.isWhiteVertical(n,t,s+7,s+11))&&e++}return e*An.N3}static isWhiteHorizontal(t,e,n){e=Math.max(e,0),n=Math.min(n,t.length);for(let r=e;r<n;r++)if(1===t[r])return!1;return!0}static isWhiteVertical(t,e,n,r){n=Math.max(n,0),r=Math.min(r,t.length);for(let i=n;i<r;i++)if(1===t[i][e])return!1;return!0}static applyMaskPenaltyRule4(t){let e=0;const n=t.getArray(),r=t.getWidth(),i=t.getHeight();for(let a=0;a<i;a++){const t=n[a];for(let n=0;n<r;n++)1===t[n]&&e++}const s=t.getHeight()*t.getWidth(),o=Math.floor(10*Math.abs(2*e-s)/s);return o*An.N4}static getDataMaskBit(t,e,n){let r,i;switch(t){case 0:r=n+e&1;break;case 1:r=1&n;break;case 2:r=e%3;break;case 3:r=(n+e)%3;break;case 4:r=Math.floor(n/2)+Math.floor(e/3)&1;break;case 5:i=n*e,r=(1&i)+i%3;break;case 6:i=n*e,r=(1&i)+i%3&1;break;case 7:i=n*e,r=i%3+(n+e&1)&1;break;default:throw new h("Invalid mask pattern: "+t)}return 0===r}static applyMaskPenaltyRule1Internal(t,e){let n=0;const r=e?t.getHeight():t.getWidth(),i=e?t.getWidth():t.getHeight(),s=t.getArray();for(let o=0;o<r;o++){let t=0,r=-1;for(let a=0;a<i;a++){const i=e?s[o][a]:s[a][o];i===r?t++:(t>=5&&(n+=An.N1+(t-5)),t=1,r=i)}t>=5&&(n+=An.N1+(t-5))}return n}}An.N1=3,An.N2=3,An.N3=40,An.N4=10;class Cn{constructor(t,e){this.width=t,this.height=e;const n=new Array(e);for(let r=0;r!==e;r++)n[r]=new Uint8Array(t);this.bytes=n}getHeight(){return this.height}getWidth(){return this.width}get(t,e){return this.bytes[e][t]}getArray(){return this.bytes}setNumber(t,e,n){this.bytes[e][t]=n}setBoolean(t,e,n){this.bytes[e][t]=n?1:0}clear(t){for(const e of this.bytes)w.fill(e,t)}equals(t){if(!(t instanceof Cn))return!1;const e=t;if(this.width!==e.width)return!1;if(this.height!==e.height)return!1;for(let n=0,r=this.height;n<r;++n){const t=this.bytes[n],r=e.bytes[n];for(let e=0,n=this.width;e<n;++e)if(t[e]!==r[e])return!1}return!0}toString(){const t=new k;for(let e=0,n=this.height;e<n;++e){const n=this.bytes[e];for(let e=0,r=this.width;e<r;++e)switch(n[e]){case 0:t.append(" 0");break;case 1:t.append(" 1");break;default:t.append("  ");break}t.append("\n")}return t.toString()}}class In{constructor(){this.maskPattern=-1}getMode(){return this.mode}getECLevel(){return this.ecLevel}getVersion(){return this.version}getMaskPattern(){return this.maskPattern}getMatrix(){return this.matrix}toString(){const t=new k;return t.append("<<\n"),t.append(" mode: "),t.append(this.mode?this.mode.toString():"null"),t.append("\n ecLevel: "),t.append(this.ecLevel?this.ecLevel.toString():"null"),t.append("\n version: "),t.append(this.version?this.version.toString():"null"),t.append("\n maskPattern: "),t.append(this.maskPattern.toString()),this.matrix?(t.append("\n matrix:\n"),t.append(this.matrix.toString())):t.append("\n matrix: null\n"),t.append(">>\n"),t.toString()}setMode(t){this.mode=t}setECLevel(t){this.ecLevel=t}setVersion(t){this.version=t}setMaskPattern(t){this.maskPattern=t}setMatrix(t){this.matrix=t}static isValidMaskPattern(t){return t>=0&&t<In.NUM_MASK_PATTERNS}}In.NUM_MASK_PATTERNS=8;class Tn extends l{}Tn.kind="WriterException";class kn{constructor(){}static clearMatrix(t){t.clear(255)}static buildMatrix(t,e,n,r,i){kn.clearMatrix(i),kn.embedBasicPatterns(n,i),kn.embedTypeInfo(e,r,i),kn.maybeEmbedVersionInfo(n,i),kn.embedDataBits(t,r,i)}static embedBasicPatterns(t,e){kn.embedPositionDetectionPatternsAndSeparators(e),kn.embedDarkDotAtLeftBottomCorner(e),kn.maybeEmbedPositionAdjustmentPatterns(t,e),kn.embedTimingPatterns(e)}static embedTypeInfo(t,e,n){const r=new v;kn.makeTypeInfoBits(t,e,r);for(let i=0,s=r.getSize();i<s;++i){const t=r.get(r.getSize()-1-i),e=kn.TYPE_INFO_COORDINATES[i],s=e[0],o=e[1];if(n.setBoolean(s,o,t),i<8){const e=n.getWidth()-i-1,r=8;n.setBoolean(e,r,t)}else{const e=8,r=n.getHeight()-7+(i-8);n.setBoolean(e,r,t)}}}static maybeEmbedVersionInfo(t,e){if(t.getVersionNumber()<7)return;const n=new v;kn.makeVersionInfoBits(t,n);let r=17;for(let i=0;i<6;++i)for(let t=0;t<3;++t){const s=n.get(r);r--,e.setBoolean(i,e.getHeight()-11+t,s),e.setBoolean(e.getHeight()-11+t,i,s)}}static embedDataBits(t,e,n){let r=0,i=-1,s=n.getWidth()-1,o=n.getHeight()-1;while(s>0){6===s&&(s-=1);while(o>=0&&o<n.getHeight()){for(let i=0;i<2;++i){const a=s-i;if(!kn.isEmpty(n.get(a,o)))continue;let c;r<t.getSize()?(c=t.get(r),++r):c=!1,255!==e&&An.getDataMaskBit(e,a,o)&&(c=!c),n.setBoolean(a,o,c)}o+=i}i=-i,o+=i,s-=2}if(r!==t.getSize())throw new Tn("Not all bits consumed: "+r+"/"+t.getSize())}static findMSBSet(t){return 32-b.numberOfLeadingZeros(t)}static calculateBCHCode(t,e){if(0===e)throw new h("0 polynomial");const n=kn.findMSBSet(e);t<<=n-1;while(kn.findMSBSet(t)>=n)t^=e<<kn.findMSBSet(t)-n;return t}static makeTypeInfoBits(t,e,n){if(!In.isValidMaskPattern(e))throw new Tn("Invalid mask pattern");const r=t.getBits()<<3|e;n.appendBits(r,5);const i=kn.calculateBCHCode(r,kn.TYPE_INFO_POLY);n.appendBits(i,10);const s=new v;if(s.appendBits(kn.TYPE_INFO_MASK_PATTERN,15),n.xor(s),15!==n.getSize())throw new Tn("should not happen but we got: "+n.getSize())}static makeVersionInfoBits(t,e){e.appendBits(t.getVersionNumber(),6);const n=kn.calculateBCHCode(t.getVersionNumber(),kn.VERSION_INFO_POLY);if(e.appendBits(n,12),18!==e.getSize())throw new Tn("should not happen but we got: "+e.getSize())}static isEmpty(t){return 255===t}static embedTimingPatterns(t){for(let e=8;e<t.getWidth()-8;++e){const n=(e+1)%2;kn.isEmpty(t.get(e,6))&&t.setNumber(e,6,n),kn.isEmpty(t.get(6,e))&&t.setNumber(6,e,n)}}static embedDarkDotAtLeftBottomCorner(t){if(0===t.get(8,t.getHeight()-8))throw new Tn;t.setNumber(8,t.getHeight()-8,1)}static embedHorizontalSeparationPattern(t,e,n){for(let r=0;r<8;++r){if(!kn.isEmpty(n.get(t+r,e)))throw new Tn;n.setNumber(t+r,e,0)}}static embedVerticalSeparationPattern(t,e,n){for(let r=0;r<7;++r){if(!kn.isEmpty(n.get(t,e+r)))throw new Tn;n.setNumber(t,e+r,0)}}static embedPositionAdjustmentPattern(t,e,n){for(let r=0;r<5;++r){const i=kn.POSITION_ADJUSTMENT_PATTERN[r];for(let s=0;s<5;++s)n.setNumber(t+s,e+r,i[s])}}static embedPositionDetectionPattern(t,e,n){for(let r=0;r<7;++r){const i=kn.POSITION_DETECTION_PATTERN[r];for(let s=0;s<7;++s)n.setNumber(t+s,e+r,i[s])}}static embedPositionDetectionPatternsAndSeparators(t){const e=kn.POSITION_DETECTION_PATTERN[0].length;kn.embedPositionDetectionPattern(0,0,t),kn.embedPositionDetectionPattern(t.getWidth()-e,0,t),kn.embedPositionDetectionPattern(0,t.getWidth()-e,t);const n=8;kn.embedHorizontalSeparationPattern(0,n-1,t),kn.embedHorizontalSeparationPattern(t.getWidth()-n,n-1,t),kn.embedHorizontalSeparationPattern(0,t.getWidth()-n,t);const r=7;kn.embedVerticalSeparationPattern(r,0,t),kn.embedVerticalSeparationPattern(t.getHeight()-r-1,0,t),kn.embedVerticalSeparationPattern(r,t.getHeight()-r,t)}static maybeEmbedPositionAdjustmentPatterns(t,e){if(t.getVersionNumber()<2)return;const n=t.getVersionNumber()-1,r=kn.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[n];for(let i=0,s=r.length;i!==s;i++){const t=r[i];if(t>=0)for(let n=0;n!==s;n++){const i=r[n];i>=0&&kn.isEmpty(e.get(i,t))&&kn.embedPositionAdjustmentPattern(i-2,t-2,e)}}}}kn.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),kn.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),kn.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),kn.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),kn.VERSION_INFO_POLY=7973,kn.TYPE_INFO_POLY=1335,kn.TYPE_INFO_MASK_PATTERN=21522;class Rn{constructor(t,e){this.dataBytes=t,this.errorCorrectionBytes=e}getDataBytes(){return this.dataBytes}getErrorCorrectionBytes(){return this.errorCorrectionBytes}}class Nn{constructor(){}static calculateMaskPenalty(t){return An.applyMaskPenaltyRule1(t)+An.applyMaskPenaltyRule2(t)+An.applyMaskPenaltyRule3(t)+An.applyMaskPenaltyRule4(t)}static encode(t,e,n=null){let r=Nn.DEFAULT_BYTE_MODE_ENCODING;const i=null!==n&&void 0!==n.get(_n.CHARACTER_SET);i&&(r=n.get(_n.CHARACTER_SET).toString());const s=this.chooseMode(t,r),o=new v;if(s===Re.BYTE&&(i||Nn.DEFAULT_BYTE_MODE_ENCODING!==r)){const t=A.getCharacterSetECIByName(r);void 0!==t&&this.appendECI(t,o)}this.appendModeInfo(s,o);const a=new v;let c;if(this.appendBytes(t,s,a,r),null!==n&&void 0!==n.get(_n.QR_VERSION)){const t=Number.parseInt(n.get(_n.QR_VERSION).toString(),10);c=Ce.getVersionForNumber(t);const r=this.calculateBitsNeeded(s,o,a,c);if(!this.willFit(r,c,e))throw new Tn("Data too big for requested version")}else c=this.recommendVersion(e,s,o,a);const l=new v;l.appendBitArray(o);const u=s===Re.BYTE?a.getSizeInBytes():t.length;this.appendLengthInfo(u,c,s,l),l.appendBitArray(a);const h=c.getECBlocksForLevel(e),d=c.getTotalCodewords()-h.getTotalECCodewords();this.terminateBits(d,l);const f=this.interleaveWithECBytes(l,c.getTotalCodewords(),d,h.getNumBlocks()),p=new In;p.setECLevel(e),p.setMode(s),p.setVersion(c);const g=c.getDimensionForVersion(),m=new Cn(g,g),y=this.chooseMaskPattern(f,e,c,m);return p.setMaskPattern(y),kn.buildMatrix(f,e,c,y,m),p.setMatrix(m),p}static recommendVersion(t,e,n,r){const i=this.calculateBitsNeeded(e,n,r,Ce.getVersionForNumber(1)),s=this.chooseVersion(i,t),o=this.calculateBitsNeeded(e,n,r,s);return this.chooseVersion(o,t)}static calculateBitsNeeded(t,e,n,r){return e.getSize()+t.getCharacterCountBits(r)+n.getSize()}static getAlphanumericCode(t){return t<Nn.ALPHANUMERIC_TABLE.length?Nn.ALPHANUMERIC_TABLE[t]:-1}static chooseMode(t,e=null){if(A.SJIS.getName()===e&&this.isOnlyDoubleByteKanji(t))return Re.KANJI;let n=!1,r=!1;for(let i=0,s=t.length;i<s;++i){const e=t.charAt(i);if(Nn.isDigit(e))n=!0;else{if(-1===this.getAlphanumericCode(e.charCodeAt(0)))return Re.BYTE;r=!0}}return r?Re.ALPHANUMERIC:n?Re.NUMERIC:Re.BYTE}static isOnlyDoubleByteKanji(t){let e;try{e=I.encode(t,A.SJIS)}catch(r){return!1}const n=e.length;if(n%2!==0)return!1;for(let i=0;i<n;i+=2){const t=255&e[i];if((t<129||t>159)&&(t<224||t>235))return!1}return!0}static chooseMaskPattern(t,e,n,r){let i=Number.MAX_SAFE_INTEGER,s=-1;for(let o=0;o<In.NUM_MASK_PATTERNS;o++){kn.buildMatrix(t,e,n,o,r);let a=this.calculateMaskPenalty(r);a<i&&(i=a,s=o)}return s}static chooseVersion(t,e){for(let n=1;n<=40;n++){const r=Ce.getVersionForNumber(n);if(Nn.willFit(t,r,e))return r}throw new Tn("Data too big")}static willFit(t,e,n){const r=e.getTotalCodewords(),i=e.getECBlocksForLevel(n),s=i.getTotalECCodewords(),o=r-s,a=(t+7)/8;return o>=a}static terminateBits(t,e){const n=8*t;if(e.getSize()>n)throw new Tn("data bits cannot fit in the QR Code"+e.getSize()+" > "+n);for(let s=0;s<4&&e.getSize()<n;++s)e.appendBit(!1);const r=7&e.getSize();if(r>0)for(let s=r;s<8;s++)e.appendBit(!1);const i=t-e.getSizeInBytes();for(let s=0;s<i;++s)e.appendBits(0===(1&s)?236:17,8);if(e.getSize()!==n)throw new Tn("Bits size does not equal capacity")}static getNumDataBytesAndNumECBytesForBlockID(t,e,n,r,i,s){if(r>=n)throw new Tn("Block ID too large");const o=t%n,a=n-o,c=Math.floor(t/n),l=c+1,u=Math.floor(e/n),h=u+1,d=c-u,f=l-h;if(d!==f)throw new Tn("EC bytes mismatch");if(n!==a+o)throw new Tn("RS blocks mismatch");if(t!==(u+d)*a+(h+f)*o)throw new Tn("Total bytes mismatch");r<a?(i[0]=u,s[0]=d):(i[0]=h,s[0]=f)}static interleaveWithECBytes(t,e,n,r){if(t.getSizeInBytes()!==n)throw new Tn("Number of bits and data bytes does not match");let i=0,s=0,o=0;const a=new Array;for(let l=0;l<r;++l){const c=new Int32Array(1),u=new Int32Array(1);Nn.getNumDataBytesAndNumECBytesForBlockID(e,n,r,l,c,u);const h=c[0],d=new Uint8Array(h);t.toBytes(8*i,d,0,h);const f=Nn.generateECBytes(d,u[0]);a.push(new Rn(d,f)),s=Math.max(s,h),o=Math.max(o,f.length),i+=c[0]}if(n!==i)throw new Tn("Data bytes does not match offset");const c=new v;for(let l=0;l<s;++l)for(const t of a){const e=t.getDataBytes();l<e.length&&c.appendBits(e[l],8)}for(let l=0;l<o;++l)for(const t of a){const e=t.getErrorCorrectionBytes();l<e.length&&c.appendBits(e[l],8)}if(e!==c.getSizeInBytes())throw new Tn("Interleaving error: "+e+" and "+c.getSizeInBytes()+" differ.");return c}static generateECBytes(t,e){const n=t.length,r=new Int32Array(n+e);for(let s=0;s<n;s++)r[s]=255&t[s];new Sn(tt.QR_CODE_FIELD_256).encode(r,e);const i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=r[n+s];return i}static appendModeInfo(t,e){e.appendBits(t.getBits(),4)}static appendLengthInfo(t,e,n,r){const i=n.getCharacterCountBits(e);if(t>=1<<i)throw new Tn(t+" is bigger than "+((1<<i)-1));r.appendBits(t,i)}static appendBytes(t,e,n,r){switch(e){case Re.NUMERIC:Nn.appendNumericBytes(t,n);break;case Re.ALPHANUMERIC:Nn.appendAlphanumericBytes(t,n);break;case Re.BYTE:Nn.append8BitBytes(t,n,r);break;case Re.KANJI:Nn.appendKanjiBytes(t,n);break;default:throw new Tn("Invalid mode: "+e)}}static getDigit(t){return t.charCodeAt(0)-48}static isDigit(t){const e=Nn.getDigit(t);return e>=0&&e<=9}static appendNumericBytes(t,e){const n=t.length;let r=0;while(r<n){const i=Nn.getDigit(t.charAt(r));if(r+2<n){const n=Nn.getDigit(t.charAt(r+1)),s=Nn.getDigit(t.charAt(r+2));e.appendBits(100*i+10*n+s,10),r+=3}else if(r+1<n){const n=Nn.getDigit(t.charAt(r+1));e.appendBits(10*i+n,7),r+=2}else e.appendBits(i,4),r++}}static appendAlphanumericBytes(t,e){const n=t.length;let r=0;while(r<n){const i=Nn.getAlphanumericCode(t.charCodeAt(r));if(-1===i)throw new Tn;if(r+1<n){const n=Nn.getAlphanumericCode(t.charCodeAt(r+1));if(-1===n)throw new Tn;e.appendBits(45*i+n,11),r+=2}else e.appendBits(i,6),r++}}static append8BitBytes(t,e,n){let r;try{r=I.encode(t,n)}catch(i){throw new Tn(i)}for(let s=0,o=r.length;s!==o;s++){const t=r[s];e.appendBits(t,8)}}static appendKanjiBytes(t,e){let n;try{n=I.encode(t,A.SJIS)}catch(i){throw new Tn(i)}const r=n.length;for(let s=0;s<r;s+=2){const t=255&n[s],r=255&n[s+1],i=t<<8&4294967295|r;let o=-1;if(i>=33088&&i<=40956?o=i-33088:i>=57408&&i<=60351&&(o=i-49472),-1===o)throw new Tn("Invalid byte sequence");const a=192*(o>>8)+(255&o);e.appendBits(a,13)}}static appendECI(t,e){e.appendBits(Re.ECI.getBits(),4),e.appendBits(t.getValue(),8)}}Nn.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),Nn.DEFAULT_BYTE_MODE_ENCODING=A.UTF8.getName();class Dn{write(t,e,n,r=null){if(0===t.length)throw new h("Found empty contents");if(e<0||n<0)throw new h("Requested dimensions are too small: "+e+"x"+n);let i=Ee.L,s=Dn.QUIET_ZONE_SIZE;null!==r&&(void 0!==r.get(_n.ERROR_CORRECTION)&&(i=Ee.fromString(r.get(_n.ERROR_CORRECTION).toString())),void 0!==r.get(_n.MARGIN)&&(s=Number.parseInt(r.get(_n.MARGIN).toString(),10)));const o=Nn.encode(t,i,r);return this.renderResult(o,e,n,s)}writeToDom(t,e,n,r,i=null){"string"===typeof t&&(t=document.querySelector(t));const s=this.write(e,n,r,i);t&&t.appendChild(s)}renderResult(t,e,n,r){const i=t.getMatrix();if(null===i)throw new nt;const s=i.getWidth(),o=i.getHeight(),a=s+2*r,c=o+2*r,l=Math.max(e,a),u=Math.max(n,c),h=Math.min(Math.floor(l/a),Math.floor(u/c)),d=Math.floor((l-s*h)/2),f=Math.floor((u-o*h)/2),p=this.createSVGElement(l,u);for(let g=0,m=f;g<o;g++,m+=h)for(let t=0,e=d;t<s;t++,e+=h)if(1===i.get(t,g)){const t=this.createSvgRectElement(e,m,h,h);p.appendChild(t)}return p}createSVGElement(t,e){const n=document.createElementNS(Dn.SVG_NS,"svg");return n.setAttributeNS(null,"height",t.toString()),n.setAttributeNS(null,"width",e.toString()),n}createSvgRectElement(t,e,n,r){const i=document.createElementNS(Dn.SVG_NS,"rect");return i.setAttributeNS(null,"x",t.toString()),i.setAttributeNS(null,"y",e.toString()),i.setAttributeNS(null,"height",n.toString()),i.setAttributeNS(null,"width",r.toString()),i.setAttributeNS(null,"fill","#000000"),i}}Dn.QUIET_ZONE_SIZE=4,Dn.SVG_NS="http://www.w3.org/2000/svg";class On{encode(t,e,n,r,i){if(0===t.length)throw new h("Found empty contents");if(e!==j.QR_CODE)throw new h("Can only encode QR_CODE, but got "+e);if(n<0||r<0)throw new h(`Requested dimensions are too small: ${n}x${r}`);let s=Ee.L,o=On.QUIET_ZONE_SIZE;null!==i&&(void 0!==i.get(_n.ERROR_CORRECTION)&&(s=Ee.fromString(i.get(_n.ERROR_CORRECTION).toString())),void 0!==i.get(_n.MARGIN)&&(o=Number.parseInt(i.get(_n.MARGIN).toString(),10)));const a=Nn.encode(t,s,i);return On.renderResult(a,n,r,o)}static renderResult(t,e,n,r){const i=t.getMatrix();if(null===i)throw new nt;const s=i.getWidth(),o=i.getHeight(),a=s+2*r,c=o+2*r,l=Math.max(e,a),u=Math.max(n,c),h=Math.min(Math.floor(l/a),Math.floor(u/c)),d=Math.floor((l-s*h)/2),f=Math.floor((u-o*h)/2),p=new R(l,u);for(let g=0,m=f;g<o;g++,m+=h)for(let t=0,e=d;t<s;t++,e+=h)1===i.get(t,g)&&p.setRegion(e,m,h,h);return p}}On.QUIET_ZONE_SIZE=4;class Pn{encode(t,e,n,r,i){let s;switch(e){case j.QR_CODE:s=new On;break;default:throw new h("No encoder available for format "+e)}return s.encode(t,e,n,r,i)}}class xn extends P{constructor(t,e,n,r,i,s,o,a){if(super(s,o),this.yuvData=t,this.dataWidth=e,this.dataHeight=n,this.left=r,this.top=i,r+s>e||i+o>n)throw new h("Crop rectangle does not fit within image data.");a&&this.reverseHorizontal(s,o)}getRow(t,e){if(t<0||t>=this.getHeight())throw new h("Requested row is outside the image: "+t);const n=this.getWidth();(null===e||void 0===e||e.length<n)&&(e=new Uint8ClampedArray(n));const r=(t+this.top)*this.dataWidth+this.left;return g.arraycopy(this.yuvData,r,e,0,n),e}getMatrix(){const t=this.getWidth(),e=this.getHeight();if(t===this.dataWidth&&e===this.dataHeight)return this.yuvData;const n=t*e,r=new Uint8ClampedArray(n);let i=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return g.arraycopy(this.yuvData,i,r,0,n),r;for(let s=0;s<e;s++){const e=s*t;g.arraycopy(this.yuvData,i,r,e,t),i+=this.dataWidth}return r}isCropSupported(){return!0}crop(t,e,n,r){return new xn(this.yuvData,this.dataWidth,this.dataHeight,this.left+t,this.top+e,n,r,!1)}renderThumbnail(){const t=this.getWidth()/xn.THUMBNAIL_SCALE_FACTOR,e=this.getHeight()/xn.THUMBNAIL_SCALE_FACTOR,n=new Int32Array(t*e),r=this.yuvData;let i=this.top*this.dataWidth+this.left;for(let s=0;s<e;s++){const e=s*t;for(let s=0;s<t;s++){const t=255&r[i+s*xn.THUMBNAIL_SCALE_FACTOR];n[e+s]=4278190080|65793*t}i+=this.dataWidth*xn.THUMBNAIL_SCALE_FACTOR}return n}getThumbnailWidth(){return this.getWidth()/xn.THUMBNAIL_SCALE_FACTOR}getThumbnailHeight(){return this.getHeight()/xn.THUMBNAIL_SCALE_FACTOR}reverseHorizontal(t,e){const n=this.yuvData;for(let r=0,i=this.top*this.dataWidth+this.left;r<e;r++,i+=this.dataWidth){const e=i+t/2;for(let r=i,s=i+t-1;r<e;r++,s--){const t=n[r];n[r]=n[s],n[s]=t}}}invert(){return new x(this)}}xn.THUMBNAIL_SCALE_FACTOR=2;class Mn extends P{constructor(t,e,n,r,i,s,o){if(super(e,n),this.dataWidth=r,this.dataHeight=i,this.left=s,this.top=o,4===t.BYTES_PER_ELEMENT){const r=e*n,i=new Uint8ClampedArray(r);for(let e=0;e<r;e++){const n=t[e],r=n>>16&255,s=n>>7&510,o=255&n;i[e]=(r+s+o)/4&255}this.luminances=i}else this.luminances=t;if(void 0===r&&(this.dataWidth=e),void 0===i&&(this.dataHeight=n),void 0===s&&(this.left=0),void 0===o&&(this.top=0),this.left+e>this.dataWidth||this.top+n>this.dataHeight)throw new h("Crop rectangle does not fit within image data.")}getRow(t,e){if(t<0||t>=this.getHeight())throw new h("Requested row is outside the image: "+t);const n=this.getWidth();(null===e||void 0===e||e.length<n)&&(e=new Uint8ClampedArray(n));const r=(t+this.top)*this.dataWidth+this.left;return g.arraycopy(this.luminances,r,e,0,n),e}getMatrix(){const t=this.getWidth(),e=this.getHeight();if(t===this.dataWidth&&e===this.dataHeight)return this.luminances;const n=t*e,r=new Uint8ClampedArray(n);let i=this.top*this.dataWidth+this.left;if(t===this.dataWidth)return g.arraycopy(this.luminances,i,r,0,n),r;for(let s=0;s<e;s++){const e=s*t;g.arraycopy(this.luminances,i,r,e,t),i+=this.dataWidth}return r}isCropSupported(){return!0}crop(t,e,n,r){return new Mn(this.luminances,n,r,this.dataWidth,this.dataHeight,this.left+t,this.top+e)}invert(){return new x(this)}}class Ln extends A{static forName(t){return this.getCharacterSetECIByName(t)}}class Bn{}Bn.ISO_8859_1=A.ISO8859_1;class Un{isCompact(){return this.compact}setCompact(t){this.compact=t}getSize(){return this.size}setSize(t){this.size=t}getLayers(){return this.layers}setLayers(t){this.layers=t}getCodeWords(){return this.codeWords}setCodeWords(t){this.codeWords=t}getMatrix(){return this.matrix}setMatrix(t){this.matrix=t}}class Fn{static singletonList(t){return[t]}static min(t,e){return t.sort(e)[0]}}class zn{constructor(t){this.previous=t}getPrevious(){return this.previous}}class Vn extends zn{constructor(t,e,n){super(t),this.value=e,this.bitCount=n}appendTo(t,e){t.appendBits(this.value,this.bitCount)}add(t,e){return new Vn(this,t,e)}addBinaryShift(t,e){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new Vn(this,t,e)}toString(){let t=this.value&(1<<this.bitCount)-1;return t|=1<<this.bitCount,"<"+b.toBinaryString(t|1<<this.bitCount).substring(1)+">"}}class jn extends Vn{constructor(t,e,n){super(t,0,0),this.binaryShiftStart=e,this.binaryShiftByteCount=n}appendTo(t,e){for(let n=0;n<this.binaryShiftByteCount;n++)(0===n||31===n&&this.binaryShiftByteCount<=62)&&(t.appendBits(31,5),this.binaryShiftByteCount>62?t.appendBits(this.binaryShiftByteCount-31,16):0===n?t.appendBits(Math.min(this.binaryShiftByteCount,31),5):t.appendBits(this.binaryShiftByteCount-31,5)),t.appendBits(e[this.binaryShiftStart+n],8)}addBinaryShift(t,e){return new jn(this,t,e)}toString(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"}}function Hn(t,e,n){return new jn(t,e,n)}function $n(t,e,n){return new Vn(t,e,n)}const Kn=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],Gn=0,qn=1,Wn=2,Yn=3,Xn=4,Qn=new Vn(null,0,0),Jn=[Int32Array.from([0,327708,327710,327709,656318]),Int32Array.from([590318,0,327710,327709,656318]),Int32Array.from([262158,590300,0,590301,932798]),Int32Array.from([327709,327708,656318,0,327710]),Int32Array.from([327711,656380,656382,656381,0])];function Zn(t){for(let e of t)w.fill(e,-1);return t[Gn][Xn]=0,t[qn][Xn]=0,t[qn][Gn]=28,t[Yn][Xn]=0,t[Wn][Xn]=0,t[Wn][Gn]=15,t}const tr=Zn(w.createInt32Array(6,6));class er{constructor(t,e,n,r){this.token=t,this.mode=e,this.binaryShiftByteCount=n,this.bitCount=r}getMode(){return this.mode}getToken(){return this.token}getBinaryShiftByteCount(){return this.binaryShiftByteCount}getBitCount(){return this.bitCount}latchAndAppend(t,e){let n=this.bitCount,r=this.token;if(t!==this.mode){let e=Jn[this.mode][t];r=$n(r,65535&e,e>>16),n+=e>>16}let i=t===Wn?4:5;return r=$n(r,e,i),new er(r,t,0,n+i)}shiftAndAppend(t,e){let n=this.token,r=this.mode===Wn?4:5;return n=$n(n,tr[this.mode][t],r),n=$n(n,e,5),new er(n,this.mode,0,this.bitCount+r+5)}addBinaryShiftChar(t){let e=this.token,n=this.mode,r=this.bitCount;if(this.mode===Xn||this.mode===Wn){let t=Jn[n][Gn];e=$n(e,65535&t,t>>16),r+=t>>16,n=Gn}let i=0===this.binaryShiftByteCount||31===this.binaryShiftByteCount?18:62===this.binaryShiftByteCount?9:8,s=new er(e,n,this.binaryShiftByteCount+1,r+i);return 2078===s.binaryShiftByteCount&&(s=s.endBinaryShift(t+1)),s}endBinaryShift(t){if(0===this.binaryShiftByteCount)return this;let e=this.token;return e=Hn(e,t-this.binaryShiftByteCount,this.binaryShiftByteCount),new er(e,this.mode,0,this.bitCount)}isBetterThanOrEqualTo(t){let e=this.bitCount+(Jn[this.mode][t.mode]>>16);return this.binaryShiftByteCount<t.binaryShiftByteCount?e+=er.calculateBinaryShiftCost(t)-er.calculateBinaryShiftCost(this):this.binaryShiftByteCount>t.binaryShiftByteCount&&t.binaryShiftByteCount>0&&(e+=10),e<=t.bitCount}toBitArray(t){let e=[];for(let r=this.endBinaryShift(t.length).token;null!==r;r=r.getPrevious())e.unshift(r);let n=new v;for(const r of e)r.appendTo(n,t);return n}toString(){return T.format("%s bits=%d bytes=%d",Kn[this.mode],this.bitCount,this.binaryShiftByteCount)}static calculateBinaryShiftCost(t){return t.binaryShiftByteCount>62?21:t.binaryShiftByteCount>31?20:t.binaryShiftByteCount>0?10:0}}function nr(t){const e=T.getCharCode(" "),n=T.getCharCode("."),r=T.getCharCode(",");t[Gn][e]=1;const i=T.getCharCode("Z"),s=T.getCharCode("A");for(let d=s;d<=i;d++)t[Gn][d]=d-s+2;t[qn][e]=1;const o=T.getCharCode("z"),a=T.getCharCode("a");for(let d=a;d<=o;d++)t[qn][d]=d-a+2;t[Wn][e]=1;const c=T.getCharCode("9"),l=T.getCharCode("0");for(let d=l;d<=c;d++)t[Wn][d]=d-l+2;t[Wn][r]=12,t[Wn][n]=13;const u=["\0"," ","","","","","","","","\b","\t","\n","\v","\f","\r","","","","","","@","\\","^","_","`","|","~",""];for(let d=0;d<u.length;d++)t[Yn][T.getCharCode(u[d])]=d;const h=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"];for(let d=0;d<h.length;d++)T.getCharCode(h[d])>0&&(t[Xn][T.getCharCode(h[d])]=d);return t}er.INITIAL_STATE=new er(Qn,Gn,0,0);const rr=nr(w.createInt32Array(5,256));class ir{constructor(t){this.text=t}encode(){const t=T.getCharCode(" "),e=T.getCharCode("\n");let n=Fn.singletonList(er.INITIAL_STATE);for(let i=0;i<this.text.length;i++){let r,s=i+1<this.text.length?this.text[i+1]:0;switch(this.text[i]){case T.getCharCode("\r"):r=s===e?2:0;break;case T.getCharCode("."):r=s===t?3:0;break;case T.getCharCode(","):r=s===t?4:0;break;case T.getCharCode(":"):r=s===t?5:0;break;default:r=0}r>0?(n=ir.updateStateListForPair(n,i,r),i++):n=this.updateStateListForChar(n,i)}const r=Fn.min(n,((t,e)=>t.getBitCount()-e.getBitCount()));return r.toBitArray(this.text)}updateStateListForChar(t,e){const n=[];for(let r of t)this.updateStateForChar(r,e,n);return ir.simplifyStates(n)}updateStateForChar(t,e,n){let r=255&this.text[e],i=rr[t.getMode()][r]>0,s=null;for(let o=0;o<=Xn;o++){let a=rr[o][r];if(a>0){if(null==s&&(s=t.endBinaryShift(e)),!i||o===t.getMode()||o===Wn){const t=s.latchAndAppend(o,a);n.push(t)}if(!i&&tr[t.getMode()][o]>=0){const t=s.shiftAndAppend(o,a);n.push(t)}}}if(t.getBinaryShiftByteCount()>0||0===rr[t.getMode()][r]){let r=t.addBinaryShiftChar(e);n.push(r)}}static updateStateListForPair(t,e,n){const r=[];for(let i of t)this.updateStateForPair(i,e,n,r);return this.simplifyStates(r)}static updateStateForPair(t,e,n,r){let i=t.endBinaryShift(e);if(r.push(i.latchAndAppend(Xn,n)),t.getMode()!==Xn&&r.push(i.shiftAndAppend(Xn,n)),3===n||4===n){let t=i.latchAndAppend(Wn,16-n).latchAndAppend(Wn,1);r.push(t)}if(t.getBinaryShiftByteCount()>0){let n=t.addBinaryShiftChar(e).addBinaryShiftChar(e+1);r.push(n)}}static simplifyStates(t){let e=[];for(const n of t){let t=!0;for(const r of e){if(r.isBetterThanOrEqualTo(n)){t=!1;break}n.isBetterThanOrEqualTo(r)&&(e=e.filter((t=>t!==r)))}t&&e.push(n)}return e}}class sr{constructor(){}static encodeBytes(t){return sr.encode(t,sr.DEFAULT_EC_PERCENT,sr.DEFAULT_AZTEC_LAYERS)}static encode(t,e,n){let r,i,s,o,a,c=new ir(t).encode(),l=b.truncDivision(c.getSize()*e,100)+11,u=c.getSize()+l;if(n!==sr.DEFAULT_AZTEC_LAYERS){if(r=n<0,i=Math.abs(n),i>(r?sr.MAX_NB_BITS_COMPACT:sr.MAX_NB_BITS))throw new h(T.format("Illegal value %s for layers",n));s=sr.totalBitsInLayer(i,r),o=sr.WORD_SIZE[i];let t=s-s%o;if(a=sr.stuffBits(c,o),a.getSize()+l>t)throw new h("Data to large for user specified layer");if(r&&a.getSize()>64*o)throw new h("Data to large for user specified layer")}else{o=0,a=null;for(let t=0;;t++){if(t>sr.MAX_NB_BITS)throw new h("Data too large for an Aztec code");if(r=t<=3,i=r?t+1:t,s=sr.totalBitsInLayer(i,r),u>s)continue;null!=a&&o===sr.WORD_SIZE[i]||(o=sr.WORD_SIZE[i],a=sr.stuffBits(c,o));let e=s-s%o;if(!(r&&a.getSize()>64*o)&&a.getSize()+l<=e)break}}let d,f=sr.generateCheckWords(a,s,o),p=a.getSize()/o,g=sr.generateModeMessage(r,i,p),m=(r?11:14)+4*i,y=new Int32Array(m);if(r){d=m;for(let t=0;t<y.length;t++)y[t]=t}else{d=m+1+2*b.truncDivision(b.truncDivision(m,2)-1,15);let t=b.truncDivision(m,2),e=b.truncDivision(d,2);for(let n=0;n<t;n++){let r=n+b.truncDivision(n,15);y[t-n-1]=e-r-1,y[t+n]=e+r+1}}let w=new R(d);for(let h=0,b=0;h<i;h++){let t=4*(i-h)+(r?9:12);for(let e=0;e<t;e++){let n=2*e;for(let r=0;r<2;r++)f.get(b+n+r)&&w.set(y[2*h+r],y[2*h+e]),f.get(b+2*t+n+r)&&w.set(y[2*h+e],y[m-1-2*h-r]),f.get(b+4*t+n+r)&&w.set(y[m-1-2*h-r],y[m-1-2*h-e]),f.get(b+6*t+n+r)&&w.set(y[m-1-2*h-e],y[2*h+r])}b+=8*t}if(sr.drawModeMessage(w,r,d,g),r)sr.drawBullsEye(w,b.truncDivision(d,2),5);else{sr.drawBullsEye(w,b.truncDivision(d,2),7);for(let t=0,e=0;t<b.truncDivision(m,2)-1;t+=15,e+=16)for(let n=1&b.truncDivision(d,2);n<d;n+=2)w.set(b.truncDivision(d,2)-e,n),w.set(b.truncDivision(d,2)+e,n),w.set(n,b.truncDivision(d,2)-e),w.set(n,b.truncDivision(d,2)+e)}let v=new Un;return v.setCompact(r),v.setSize(d),v.setLayers(i),v.setCodeWords(p),v.setMatrix(w),v}static drawBullsEye(t,e,n){for(let r=0;r<n;r+=2)for(let n=e-r;n<=e+r;n++)t.set(n,e-r),t.set(n,e+r),t.set(e-r,n),t.set(e+r,n);t.set(e-n,e-n),t.set(e-n+1,e-n),t.set(e-n,e-n+1),t.set(e+n,e-n),t.set(e+n,e-n+1),t.set(e+n,e+n-1)}static generateModeMessage(t,e,n){let r=new v;return t?(r.appendBits(e-1,2),r.appendBits(n-1,6),r=sr.generateCheckWords(r,28,4)):(r.appendBits(e-1,5),r.appendBits(n-1,11),r=sr.generateCheckWords(r,40,4)),r}static drawModeMessage(t,e,n,r){let i=b.truncDivision(n,2);if(e)for(let s=0;s<7;s++){let e=i-3+s;r.get(s)&&t.set(e,i-5),r.get(s+7)&&t.set(i+5,e),r.get(20-s)&&t.set(e,i+5),r.get(27-s)&&t.set(i-5,e)}else for(let s=0;s<10;s++){let e=i-5+s+b.truncDivision(s,5);r.get(s)&&t.set(e,i-7),r.get(s+10)&&t.set(i+7,e),r.get(29-s)&&t.set(e,i+7),r.get(39-s)&&t.set(i-7,e)}}static generateCheckWords(t,e,n){let r=t.getSize()/n,i=new Sn(sr.getGF(n)),s=b.truncDivision(e,n),o=sr.bitsToWords(t,n,s);i.encode(o,s-r);let a=e%n,c=new v;c.appendBits(0,a);for(const l of Array.from(o))c.appendBits(l,n);return c}static bitsToWords(t,e,n){let r,i,s=new Int32Array(n);for(r=0,i=t.getSize()/e;r<i;r++){let n=0;for(let i=0;i<e;i++)n|=t.get(r*e+i)?1<<e-i-1:0;s[r]=n}return s}static getGF(t){switch(t){case 4:return tt.AZTEC_PARAM;case 6:return tt.AZTEC_DATA_6;case 8:return tt.AZTEC_DATA_8;case 10:return tt.AZTEC_DATA_10;case 12:return tt.AZTEC_DATA_12;default:throw new h("Unsupported word size "+t)}}static stuffBits(t,e){let n=new v,r=t.getSize(),i=(1<<e)-2;for(let s=0;s<r;s+=e){let o=0;for(let n=0;n<e;n++)(s+n>=r||t.get(s+n))&&(o|=1<<e-1-n);(o&i)===i?(n.appendBits(o&i,e),s--):0===(o&i)?(n.appendBits(1|o,e),s--):n.appendBits(o,e)}return n}static totalBitsInLayer(t,e){return((e?88:112)+16*t)*t}}sr.DEFAULT_EC_PERCENT=33,sr.DEFAULT_AZTEC_LAYERS=0,sr.MAX_NB_BITS=32,sr.MAX_NB_BITS_COMPACT=4,sr.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]);class or{encode(t,e,n,r){return this.encodeWithHints(t,e,n,r,null)}encodeWithHints(t,e,n,r,i){let s=Bn.ISO_8859_1,o=sr.DEFAULT_EC_PERCENT,a=sr.DEFAULT_AZTEC_LAYERS;return null!=i&&(i.has(_n.CHARACTER_SET)&&(s=Ln.forName(i.get(_n.CHARACTER_SET).toString())),i.has(_n.ERROR_CORRECTION)&&(o=b.parseInt(i.get(_n.ERROR_CORRECTION).toString())),i.has(_n.AZTEC_LAYERS)&&(a=b.parseInt(i.get(_n.AZTEC_LAYERS).toString()))),or.encodeLayers(t,e,n,r,s,o,a)}static encodeLayers(t,e,n,r,i,s,o){if(e!==j.AZTEC)throw new h("Can only encode AZTEC, but got "+e);let a=sr.encode(T.getBytes(t,i),s,o);return or.renderResult(a,n,r)}static renderResult(t,e,n){let r=t.getMatrix();if(null==r)throw new nt;let i=r.getWidth(),s=r.getHeight(),o=Math.max(e,i),a=Math.max(n,s),c=Math.min(o/i,a/s),l=(o-i*c)/2,u=(a-s*c)/2,h=new R(o,a);for(let d=0,f=u;d<s;d++,f+=c)for(let t=0,e=l;t<i;t++,e+=c)r.get(t,d)&&h.setRegion(e,f,c,c);return h}}t.AbstractExpandedDecoder=Kt,t.ArgumentException=u,t.ArithmeticException=Z,t.AztecCode=Un,t.AztecCodeReader=yt,t.AztecCodeWriter=or,t.AztecDecoder=it,t.AztecDetector=mt,t.AztecDetectorResult=lt,t.AztecEncoder=sr,t.AztecHighLevelEncoder=ir,t.AztecPoint=gt,t.BarcodeFormat=j,t.Binarizer=p,t.BinaryBitmap=d,t.BitArray=v,t.BitMatrix=R,t.BitSource=ge,t.BrowserAztecCodeReader=wt,t.BrowserBarcodeReader=le,t.BrowserCodeReader=F,t.BrowserDatamatrixCodeReader=ve,t.BrowserMultiFormatReader=wn,t.BrowserPDF417Reader=bn,t.BrowserQRCodeReader=vn,t.BrowserQRCodeSvgWriter=Dn,t.CharacterSetECI=A,t.ChecksumException=f,t.Code128Reader=vt,t.Code39Reader=Et,t.DataMatrixDecodedBitStreamParser=me,t.DataMatrixReader=be,t.DecodeHintType=_,t.DecoderResult=X,t.DefaultGridSampler=ft,t.DetectorResult=ct,t.EAN13Reader=kt,t.EncodeHintType=_n,t.Exception=l,t.FormatException=S,t.GenericGF=tt,t.GenericGFPoly=J,t.GlobalHistogramBinarizer=D,t.GridSampler=ht,t.GridSamplerInstance=pt,t.HTMLCanvasElementLuminanceSource=M,t.HybridBinarizer=O,t.ITFReader=_t,t.IllegalArgumentException=h,t.IllegalStateException=nt,t.InvertedLuminanceSource=x,t.LuminanceSource=P,t.MathUtils=st,t.MultiFormatOneDReader=ce,t.MultiFormatReader=yn,t.MultiFormatWriter=Pn,t.NotFoundException=N,t.OneDReader=bt,t.PDF417DecodedBitStreamParser=fn,t.PDF417DecoderErrorCorrection=Ge,t.PDF417Reader=gn,t.PDF417ResultMetadata=nn,t.PerspectiveTransform=dt,t.PlanarYUVLuminanceSource=xn,t.QRCodeByteMatrix=Cn,t.QRCodeDataMask=Ie,t.QRCodeDecodedBitStreamParser=Ne,t.QRCodeDecoderErrorCorrectionLevel=Ee,t.QRCodeDecoderFormatInformation=_e,t.QRCodeEncoder=Nn,t.QRCodeEncoderQRCode=In,t.QRCodeMaskUtil=An,t.QRCodeMatrixUtil=kn,t.QRCodeMode=Re,t.QRCodeReader=Fe,t.QRCodeVersion=Ce,t.QRCodeWriter=On,t.RGBLuminanceSource=Mn,t.RSS14Reader=ae,t.RSSExpandedReader=se,t.ReaderException=mn,t.ReedSolomonDecoder=rt,t.ReedSolomonEncoder=Sn,t.ReedSolomonException=et,t.Result=z,t.ResultMetadataType=Y,t.ResultPoint=at,t.StringUtils=T,t.UnsupportedOperationException=C,t.VideoInputDevice=L,t.WhiteRectangleDetector=ut,t.WriterException=Tn,t.ZXingArrays=w,t.ZXingCharset=Ln,t.ZXingInteger=b,t.ZXingStandardCharsets=Bn,t.ZXingStringBuilder=k,t.ZXingStringEncoding=I,t.ZXingSystem=g,t.createAbstractExpandedDecoder=ne,Object.defineProperty(t,"__esModule",{value:!0})}))},7055:function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,n,r,i){var s,o,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,f=t[e+h];for(h+=d,s=f&(1<<-u)-1,f>>=-u,u+=a;u>0;s=256*s+t[e+h],h+=d,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=r;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===s)s=1-l;else{if(s===c)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),s-=l}return(f?-1:1)*o*Math.pow(2,s-r)},e.write=function(t,e,n,r,i,s){var o,a,c,l=8*s-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),e+=o+h>=1?d/c:d*Math.pow(2,1-h),e*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(e*c-1)*Math.pow(2,i),o+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;t[n+f]=255&a,f+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[n+f]=255&o,f+=p,o/=256,l-=8);t[n+f-p]|=128*g}},9051:function(t,e,n){"use strict";n(7658);const{Buffer:r}=n(1547),i=Symbol.for("BufferList");function s(t){if(!(this instanceof s))return new s(t);s._init.call(this,t)}s._init=function(t){Object.defineProperty(this,i,{value:!0}),this._bufs=[],this.length=0,t&&this.append(t)},s.prototype._new=function(t){return new s(t)},s.prototype._offset=function(t){if(0===t)return[0,0];let e=0;for(let n=0;n<this._bufs.length;n++){const r=e+this._bufs[n].length;if(t<r||n===this._bufs.length-1)return[n,t-e];e=r}},s.prototype._reverseOffset=function(t){const e=t[0];let n=t[1];for(let r=0;r<e;r++)n+=this._bufs[r].length;return n},s.prototype.get=function(t){if(t>this.length||t<0)return;const e=this._offset(t);return this._bufs[e[0]][e[1]]},s.prototype.slice=function(t,e){return"number"===typeof t&&t<0&&(t+=this.length),"number"===typeof e&&e<0&&(e+=this.length),this.copy(null,0,t,e)},s.prototype.copy=function(t,e,n,i){if(("number"!==typeof n||n<0)&&(n=0),("number"!==typeof i||i>this.length)&&(i=this.length),n>=this.length)return t||r.alloc(0);if(i<=0)return t||r.alloc(0);const s=!!t,o=this._offset(n),a=i-n;let c=a,l=s&&e||0,u=o[1];if(0===n&&i===this.length){if(!s)return 1===this._bufs.length?this._bufs[0]:r.concat(this._bufs,this.length);for(let e=0;e<this._bufs.length;e++)this._bufs[e].copy(t,l),l+=this._bufs[e].length;return t}if(c<=this._bufs[o[0]].length-u)return s?this._bufs[o[0]].copy(t,e,u,u+c):this._bufs[o[0]].slice(u,u+c);s||(t=r.allocUnsafe(a));for(let r=o[0];r<this._bufs.length;r++){const e=this._bufs[r].length-u;if(!(c>e)){this._bufs[r].copy(t,l,u,u+c),l+=e;break}this._bufs[r].copy(t,l,u),l+=e,c-=e,u&&(u=0)}return t.length>l?t.slice(0,l):t},s.prototype.shallowSlice=function(t,e){if(t=t||0,e="number"!==typeof e?this.length:e,t<0&&(t+=this.length),e<0&&(e+=this.length),t===e)return this._new();const n=this._offset(t),r=this._offset(e),i=this._bufs.slice(n[0],r[0]+1);return 0===r[1]?i.pop():i[i.length-1]=i[i.length-1].slice(0,r[1]),0!==n[1]&&(i[0]=i[0].slice(n[1])),this._new(i)},s.prototype.toString=function(t,e,n){return this.slice(e,n).toString(t)},s.prototype.consume=function(t){if(t=Math.trunc(t),Number.isNaN(t)||t<=0)return this;while(this._bufs.length){if(!(t>=this._bufs[0].length)){this._bufs[0]=this._bufs[0].slice(t),this.length-=t;break}t-=this._bufs[0].length,this.length-=this._bufs[0].length,this._bufs.shift()}return this},s.prototype.duplicate=function(){const t=this._new();for(let e=0;e<this._bufs.length;e++)t.append(this._bufs[e]);return t},s.prototype.append=function(t){if(null==t)return this;if(t.buffer)this._appendBuffer(r.from(t.buffer,t.byteOffset,t.byteLength));else if(Array.isArray(t))for(let e=0;e<t.length;e++)this.append(t[e]);else if(this._isBufferList(t))for(let e=0;e<t._bufs.length;e++)this.append(t._bufs[e]);else"number"===typeof t&&(t=t.toString()),this._appendBuffer(r.from(t));return this},s.prototype._appendBuffer=function(t){this._bufs.push(t),this.length+=t.length},s.prototype.indexOf=function(t,e,n){if(void 0===n&&"string"===typeof e&&(n=e,e=void 0),"function"===typeof t||Array.isArray(t))throw new TypeError('The "value" argument must be one of type string, Buffer, BufferList, or Uint8Array.');if("number"===typeof t?t=r.from([t]):"string"===typeof t?t=r.from(t,n):this._isBufferList(t)?t=t.slice():Array.isArray(t.buffer)?t=r.from(t.buffer,t.byteOffset,t.byteLength):r.isBuffer(t)||(t=r.from(t)),e=Number(e||0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),0===t.length)return e>this.length?this.length:e;const i=this._offset(e);let s=i[0],o=i[1];for(;s<this._bufs.length;s++){const e=this._bufs[s];while(o<e.length){const n=e.length-o;if(n>=t.length){const n=e.indexOf(t,o);if(-1!==n)return this._reverseOffset([s,n]);o=e.length-t.length+1}else{const e=this._reverseOffset([s,o]);if(this._match(e,t))return e;o++}}o=0}return-1},s.prototype._match=function(t,e){if(this.length-t<e.length)return!1;for(let n=0;n<e.length;n++)if(this.get(t+n)!==e[n])return!1;return!0},function(){const t={readDoubleBE:8,readDoubleLE:8,readFloatBE:4,readFloatLE:4,readInt32BE:4,readInt32LE:4,readUInt32BE:4,readUInt32LE:4,readInt16BE:2,readInt16LE:2,readUInt16BE:2,readUInt16LE:2,readInt8:1,readUInt8:1,readIntBE:null,readIntLE:null,readUIntBE:null,readUIntLE:null};for(const e in t)(function(e){null===t[e]?s.prototype[e]=function(t,n){return this.slice(t,t+n)[e](0,n)}:s.prototype[e]=function(n=0){return this.slice(n,n+t[e])[e](0)}})(e)}(),s.prototype._isBufferList=function(t){return t instanceof s||s.isBufferList(t)},s.isBufferList=function(t){return null!=t&&t[i]},t.exports=s},1547:function(t,e,n){"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */n(3767),n(8585),n(8696),n(7658);const r=n(1271),i=n(7055),s="function"===typeof Symbol&&"function"===typeof Symbol["for"]?Symbol["for"]("nodejs.util.inspect.custom"):null;e.Buffer=l,e.SlowBuffer=v,e.INSPECT_MAX_BYTES=50;const o=2147483647;function a(){try{const t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}function c(t){if(t>o)throw new RangeError('The value "'+t+'" is invalid for option "size"');const e=new Uint8Array(t);return Object.setPrototypeOf(e,l.prototype),e}function l(t,e,n){if("number"===typeof t){if("string"===typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return f(t)}return u(t,e,n)}function u(t,e,n){if("string"===typeof t)return p(t,e);if(ArrayBuffer.isView(t))return m(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(ot(t,ArrayBuffer)||t&&ot(t.buffer,ArrayBuffer))return y(t,e,n);if("undefined"!==typeof SharedArrayBuffer&&(ot(t,SharedArrayBuffer)||t&&ot(t.buffer,SharedArrayBuffer)))return y(t,e,n);if("number"===typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=t.valueOf&&t.valueOf();if(null!=r&&r!==t)return l.from(r,e,n);const i=w(t);if(i)return i;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof t[Symbol.toPrimitive])return l.from(t[Symbol.toPrimitive]("string"),e,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function h(t){if("number"!==typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function d(t,e,n){return h(t),t<=0?c(t):void 0!==e?"string"===typeof n?c(t).fill(e,n):c(t).fill(e):c(t)}function f(t){return h(t),c(t<0?0:0|b(t))}function p(t,e){if("string"===typeof e&&""!==e||(e="utf8"),!l.isEncoding(e))throw new TypeError("Unknown encoding: "+e);const n=0|E(t,e);let r=c(n);const i=r.write(t,e);return i!==n&&(r=r.slice(0,i)),r}function g(t){const e=t.length<0?0:0|b(t.length),n=c(e);for(let r=0;r<e;r+=1)n[r]=255&t[r];return n}function m(t){if(ot(t,Uint8Array)){const e=new Uint8Array(t);return y(e.buffer,e.byteOffset,e.byteLength)}return g(t)}function y(t,e,n){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===e&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,e):new Uint8Array(t,e,n),Object.setPrototypeOf(r,l.prototype),r}function w(t){if(l.isBuffer(t)){const e=0|b(t.length),n=c(e);return 0===n.length||t.copy(n,0,0,e),n}return void 0!==t.length?"number"!==typeof t.length||at(t.length)?c(0):g(t):"Buffer"===t.type&&Array.isArray(t.data)?g(t.data):void 0}function b(t){if(t>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|t}function v(t){return+t!=t&&(t=0),l.alloc(+t)}function E(t,e){if(l.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||ot(t,ArrayBuffer))return t.byteLength;if("string"!==typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);const n=t.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let i=!1;for(;;)switch(e){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return et(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return it(t).length;default:if(i)return r?-1:et(t).length;e=(""+e).toLowerCase(),i=!0}}function _(t,e,n){let r=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,e>>>=0,n<=e)return"";t||(t="utf8");while(1)switch(t){case"hex":return B(this,e,n);case"utf8":case"utf-8":return O(this,e,n);case"ascii":return M(this,e,n);case"latin1":case"binary":return L(this,e,n);case"base64":return D(this,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,e,n);default:if(r)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),r=!0}}function S(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function A(t,e,n,r,i){if(0===t.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,at(n)&&(n=i?0:t.length-1),n<0&&(n=t.length+n),n>=t.length){if(i)return-1;n=t.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof e&&(e=l.from(e,r)),l.isBuffer(e))return 0===e.length?-1:C(t,e,n,r,i);if("number"===typeof e)return e&=255,"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,n):Uint8Array.prototype.lastIndexOf.call(t,e,n):C(t,[e],n,r,i);throw new TypeError("val must be string, number or Buffer")}function C(t,e,n,r,i){let s,o=1,a=t.length,c=e.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(t.length<2||e.length<2)return-1;o=2,a/=2,c/=2,n/=2}function l(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){let r=-1;for(s=n;s<a;s++)if(l(t,s)===l(e,-1===r?0:s-r)){if(-1===r&&(r=s),s-r+1===c)return r*o}else-1!==r&&(s-=s-r),r=-1}else for(n+c>a&&(n=a-c),s=n;s>=0;s--){let n=!0;for(let r=0;r<c;r++)if(l(t,s+r)!==l(e,r)){n=!1;break}if(n)return s}return-1}function I(t,e,n,r){n=Number(n)||0;const i=t.length-n;r?(r=Number(r),r>i&&(r=i)):r=i;const s=e.length;let o;for(r>s/2&&(r=s/2),o=0;o<r;++o){const r=parseInt(e.substr(2*o,2),16);if(at(r))return o;t[n+o]=r}return o}function T(t,e,n,r){return st(et(e,t.length-n),t,n,r)}function k(t,e,n,r){return st(nt(e),t,n,r)}function R(t,e,n,r){return st(it(e),t,n,r)}function N(t,e,n,r){return st(rt(e,t.length-n),t,n,r)}function D(t,e,n){return 0===e&&n===t.length?r.fromByteArray(t):r.fromByteArray(t.slice(e,n))}function O(t,e,n){n=Math.min(t.length,n);const r=[];let i=e;while(i<n){const e=t[i];let s=null,o=e>239?4:e>223?3:e>191?2:1;if(i+o<=n){let n,r,a,c;switch(o){case 1:e<128&&(s=e);break;case 2:n=t[i+1],128===(192&n)&&(c=(31&e)<<6|63&n,c>127&&(s=c));break;case 3:n=t[i+1],r=t[i+2],128===(192&n)&&128===(192&r)&&(c=(15&e)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:n=t[i+1],r=t[i+2],a=t[i+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),i+=o}return x(r)}e.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=a(),l.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(t,e,n){return u(t,e,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(t,e,n){return d(t,e,n)},l.allocUnsafe=function(t){return f(t)},l.allocUnsafeSlow=function(t){return f(t)},l.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==l.prototype},l.compare=function(t,e){if(ot(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),ot(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(t)||!l.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;let n=t.length,r=e.length;for(let i=0,s=Math.min(n,r);i<s;++i)if(t[i]!==e[i]){n=t[i],r=e[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return l.alloc(0);let n;if(void 0===e)for(e=0,n=0;n<t.length;++n)e+=t[n].length;const r=l.allocUnsafe(e);let i=0;for(n=0;n<t.length;++n){let e=t[n];if(ot(e,Uint8Array))i+e.length>r.length?(l.isBuffer(e)||(e=l.from(e)),e.copy(r,i)):Uint8Array.prototype.set.call(r,e,i);else{if(!l.isBuffer(e))throw new TypeError('"list" argument must be an Array of Buffers');e.copy(r,i)}i+=e.length}return r},l.byteLength=E,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let e=0;e<t;e+=2)S(this,e,e+1);return this},l.prototype.swap32=function(){const t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let e=0;e<t;e+=4)S(this,e,e+3),S(this,e+1,e+2);return this},l.prototype.swap64=function(){const t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let e=0;e<t;e+=8)S(this,e,e+7),S(this,e+1,e+6),S(this,e+2,e+5),S(this,e+3,e+4);return this},l.prototype.toString=function(){const t=this.length;return 0===t?"":0===arguments.length?O(this,0,t):_.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(t){if(!l.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===l.compare(this,t)},l.prototype.inspect=function(){let t="";const n=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(t+=" ... "),"<Buffer "+t+">"},s&&(l.prototype[s]=l.prototype.inspect),l.prototype.compare=function(t,e,n,r,i){if(ot(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===n&&(n=t?t.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),e<0||n>t.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&e>=n)return 0;if(r>=i)return-1;if(e>=n)return 1;if(e>>>=0,n>>>=0,r>>>=0,i>>>=0,this===t)return 0;let s=i-r,o=n-e;const a=Math.min(s,o),c=this.slice(r,i),u=t.slice(e,n);for(let l=0;l<a;++l)if(c[l]!==u[l]){s=c[l],o=u[l];break}return s<o?-1:o<s?1:0},l.prototype.includes=function(t,e,n){return-1!==this.indexOf(t,e,n)},l.prototype.indexOf=function(t,e,n){return A(this,t,e,n,!0)},l.prototype.lastIndexOf=function(t,e,n){return A(this,t,e,n,!1)},l.prototype.write=function(t,e,n,r){if(void 0===e)r="utf8",n=this.length,e=0;else if(void 0===n&&"string"===typeof e)r=e,n=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const i=this.length-e;if((void 0===n||n>i)&&(n=i),t.length>0&&(n<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let s=!1;for(;;)switch(r){case"hex":return I(this,t,e,n);case"utf8":case"utf-8":return T(this,t,e,n);case"ascii":case"latin1":case"binary":return k(this,t,e,n);case"base64":return R(this,t,e,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,e,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const P=4096;function x(t){const e=t.length;if(e<=P)return String.fromCharCode.apply(String,t);let n="",r=0;while(r<e)n+=String.fromCharCode.apply(String,t.slice(r,r+=P));return n}function M(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(127&t[i]);return r}function L(t,e,n){let r="";n=Math.min(t.length,n);for(let i=e;i<n;++i)r+=String.fromCharCode(t[i]);return r}function B(t,e,n){const r=t.length;(!e||e<0)&&(e=0),(!n||n<0||n>r)&&(n=r);let i="";for(let s=e;s<n;++s)i+=ct[t[s]];return i}function U(t,e,n){const r=t.slice(e,n);let i="";for(let s=0;s<r.length-1;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function F(t,e,n){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>n)throw new RangeError("Trying to access beyond buffer length")}function z(t,e,n,r,i,s){if(!l.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<s)throw new RangeError('"value" argument is out of bounds');if(n+r>t.length)throw new RangeError("Index out of range")}function V(t,e,n,r,i){X(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s,s>>=8,t[n++]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,o>>=8,t[n++]=o,n}function j(t,e,n,r,i){X(e,r,i,t,n,7);let s=Number(e&BigInt(4294967295));t[n+7]=s,s>>=8,t[n+6]=s,s>>=8,t[n+5]=s,s>>=8,t[n+4]=s;let o=Number(e>>BigInt(32)&BigInt(4294967295));return t[n+3]=o,o>>=8,t[n+2]=o,o>>=8,t[n+1]=o,o>>=8,t[n]=o,n+8}function H(t,e,n,r,i,s){if(n+r>t.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function $(t,e,n,r,s){return e=+e,n>>>=0,s||H(t,e,n,4,34028234663852886e22,-34028234663852886e22),i.write(t,e,n,r,23,4),n+4}function K(t,e,n,r,s){return e=+e,n>>>=0,s||H(t,e,n,8,17976931348623157e292,-17976931348623157e292),i.write(t,e,n,r,52,8),n+8}l.prototype.slice=function(t,e){const n=this.length;t=~~t,e=void 0===e?n:~~e,t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),e<t&&(e=t);const r=this.subarray(t,e);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=this[t],i=1,s=0;while(++s<e&&(i*=256))r+=this[t+s]*i;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=this[t+--e],i=1;while(e>0&&(i*=256))r+=this[t+--e]*i;return r},l.prototype.readUint8=l.prototype.readUInt8=function(t,e){return t>>>=0,e||F(t,1,this.length),this[t]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(t,e){return t>>>=0,e||F(t,2,this.length),this[t]|this[t+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(t,e){return t>>>=0,e||F(t,2,this.length),this[t]<<8|this[t+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(t,e){return t>>>=0,e||F(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(t,e){return t>>>=0,e||F(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},l.prototype.readBigUInt64LE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=e+256*this[++t]+65536*this[++t]+this[++t]*2**24,i=this[++t]+256*this[++t]+65536*this[++t]+n*2**24;return BigInt(r)+(BigInt(i)<<BigInt(32))})),l.prototype.readBigUInt64BE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=e*2**24+65536*this[++t]+256*this[++t]+this[++t],i=this[++t]*2**24+65536*this[++t]+256*this[++t]+n;return(BigInt(r)<<BigInt(32))+BigInt(i)})),l.prototype.readIntLE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=this[t],i=1,s=0;while(++s<e&&(i*=256))r+=this[t+s]*i;return i*=128,r>=i&&(r-=Math.pow(2,8*e)),r},l.prototype.readIntBE=function(t,e,n){t>>>=0,e>>>=0,n||F(t,e,this.length);let r=e,i=1,s=this[t+--r];while(r>0&&(i*=256))s+=this[t+--r]*i;return i*=128,s>=i&&(s-=Math.pow(2,8*e)),s},l.prototype.readInt8=function(t,e){return t>>>=0,e||F(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},l.prototype.readInt16LE=function(t,e){t>>>=0,e||F(t,2,this.length);const n=this[t]|this[t+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(t,e){t>>>=0,e||F(t,2,this.length);const n=this[t+1]|this[t]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(t,e){return t>>>=0,e||F(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},l.prototype.readInt32BE=function(t,e){return t>>>=0,e||F(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},l.prototype.readBigInt64LE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=this[t+4]+256*this[t+5]+65536*this[t+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(e+256*this[++t]+65536*this[++t]+this[++t]*2**24)})),l.prototype.readBigInt64BE=lt((function(t){t>>>=0,Q(t,"offset");const e=this[t],n=this[t+7];void 0!==e&&void 0!==n||J(t,this.length-8);const r=(e<<24)+65536*this[++t]+256*this[++t]+this[++t];return(BigInt(r)<<BigInt(32))+BigInt(this[++t]*2**24+65536*this[++t]+256*this[++t]+n)})),l.prototype.readFloatLE=function(t,e){return t>>>=0,e||F(t,4,this.length),i.read(this,t,!0,23,4)},l.prototype.readFloatBE=function(t,e){return t>>>=0,e||F(t,4,this.length),i.read(this,t,!1,23,4)},l.prototype.readDoubleLE=function(t,e){return t>>>=0,e||F(t,8,this.length),i.read(this,t,!0,52,8)},l.prototype.readDoubleBE=function(t,e){return t>>>=0,e||F(t,8,this.length),i.read(this,t,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){const r=Math.pow(2,8*n)-1;z(this,t,e,n,r,0)}let i=1,s=0;this[e]=255&t;while(++s<n&&(i*=256))this[e+s]=t/i&255;return e+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(t,e,n,r){if(t=+t,e>>>=0,n>>>=0,!r){const r=Math.pow(2,8*n)-1;z(this,t,e,n,r,0)}let i=n-1,s=1;this[e+i]=255&t;while(--i>=0&&(s*=256))this[e+i]=t/s&255;return e+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,1,255,0),this[e]=255&t,e+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigUInt64LE=lt((function(t,e=0){return V(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=lt((function(t,e=0){return j(this,t,e,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);z(this,t,e,n,r-1,-r)}let i=0,s=1,o=0;this[e]=255&t;while(++i<n&&(s*=256))t<0&&0===o&&0!==this[e+i-1]&&(o=1),this[e+i]=(t/s>>0)-o&255;return e+n},l.prototype.writeIntBE=function(t,e,n,r){if(t=+t,e>>>=0,!r){const r=Math.pow(2,8*n-1);z(this,t,e,n,r-1,-r)}let i=n-1,s=1,o=0;this[e+i]=255&t;while(--i>=0&&(s*=256))t<0&&0===o&&0!==this[e+i+1]&&(o=1),this[e+i]=(t/s>>0)-o&255;return e+n},l.prototype.writeInt8=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},l.prototype.writeInt16LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},l.prototype.writeInt16BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},l.prototype.writeInt32LE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},l.prototype.writeInt32BE=function(t,e,n){return t=+t,e>>>=0,n||z(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},l.prototype.writeBigInt64LE=lt((function(t,e=0){return V(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=lt((function(t,e=0){return j(this,t,e,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(t,e,n){return $(this,t,e,!0,n)},l.prototype.writeFloatBE=function(t,e,n){return $(this,t,e,!1,n)},l.prototype.writeDoubleLE=function(t,e,n){return K(this,t,e,!0,n)},l.prototype.writeDoubleBE=function(t,e,n){return K(this,t,e,!1,n)},l.prototype.copy=function(t,e,n,r){if(!l.isBuffer(t))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),e>=t.length&&(e=t.length),e||(e=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),t.length-e<r-n&&(r=t.length-e+n);const i=r-n;return this===t&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,n,r):Uint8Array.prototype.set.call(t,this.subarray(n,r),e),i},l.prototype.fill=function(t,e,n,r){if("string"===typeof t){if("string"===typeof e?(r=e,e=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===t.length){const e=t.charCodeAt(0);("utf8"===r&&e<128||"latin1"===r)&&(t=e)}}else"number"===typeof t?t&=255:"boolean"===typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<n)throw new RangeError("Out of range index");if(n<=e)return this;let i;if(e>>>=0,n=void 0===n?this.length:n>>>0,t||(t=0),"number"===typeof t)for(i=e;i<n;++i)this[i]=t;else{const s=l.isBuffer(t)?t:l.from(t,r),o=s.length;if(0===o)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(i=0;i<n-e;++i)this[i+e]=s[i%o]}return this};const G={};function q(t,e,n){G[t]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:e.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${t}]`,this.stack,delete this.name}get code(){return t}set code(t){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:t,writable:!0})}toString(){return`${this.name} [${t}]: ${this.message}`}}}function W(t){let e="",n=t.length;const r="-"===t[0]?1:0;for(;n>=r+4;n-=3)e=`_${t.slice(n-3,n)}${e}`;return`${t.slice(0,n)}${e}`}function Y(t,e,n){Q(e,"offset"),void 0!==t[e]&&void 0!==t[e+n]||J(e,t.length-(n+1))}function X(t,e,n,r,i,s){if(t>n||t<e){const r="bigint"===typeof e?"n":"";let i;throw i=s>3?0===e||e===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(s+1)}${r}`:`>= -(2${r} ** ${8*(s+1)-1}${r}) and < 2 ** ${8*(s+1)-1}${r}`:`>= ${e}${r} and <= ${n}${r}`,new G.ERR_OUT_OF_RANGE("value",i,t)}Y(r,i,s)}function Q(t,e){if("number"!==typeof t)throw new G.ERR_INVALID_ARG_TYPE(e,"number",t)}function J(t,e,n){if(Math.floor(t)!==t)throw Q(t,n),new G.ERR_OUT_OF_RANGE(n||"offset","an integer",t);if(e<0)throw new G.ERR_BUFFER_OUT_OF_BOUNDS;throw new G.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${e}`,t)}q("ERR_BUFFER_OUT_OF_BOUNDS",(function(t){return t?`${t} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),q("ERR_INVALID_ARG_TYPE",(function(t,e){return`The "${t}" argument must be of type number. Received type ${typeof e}`}),TypeError),q("ERR_OUT_OF_RANGE",(function(t,e,n){let r=`The value of "${t}" is out of range.`,i=n;return Number.isInteger(n)&&Math.abs(n)>2**32?i=W(String(n)):"bigint"===typeof n&&(i=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(i=W(i)),i+="n"),r+=` It must be ${e}. Received ${i}`,r}),RangeError);const Z=/[^+/0-9A-Za-z-_]/g;function tt(t){if(t=t.split("=")[0],t=t.trim().replace(Z,""),t.length<2)return"";while(t.length%4!==0)t+="=";return t}function et(t,e){let n;e=e||1/0;const r=t.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function nt(t){const e=[];for(let n=0;n<t.length;++n)e.push(255&t.charCodeAt(n));return e}function rt(t,e){let n,r,i;const s=[];for(let o=0;o<t.length;++o){if((e-=2)<0)break;n=t.charCodeAt(o),r=n>>8,i=n%256,s.push(i),s.push(r)}return s}function it(t){return r.toByteArray(tt(t))}function st(t,e,n,r){let i;for(i=0;i<r;++i){if(i+n>=e.length||i>=t.length)break;e[i+n]=t[i]}return i}function ot(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function at(t){return t!==t}const ct=function(){const t="0123456789abcdef",e=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let i=0;i<16;++i)e[r+i]=t[n]+t[i]}return e}();function lt(t){return"undefined"===typeof BigInt?ut:t}function ut(){throw new Error("BigInt not supported")}},7192:function(t,e,n){"use strict";n(7658);const r=async t=>{const e=[];for await(const n of t)e.push(n);return e};t.exports=r},1131:function(t,e,n){"use strict";async function*r(t,e=1){let n=[];e<1&&(e=1);for await(const r of t){n.push(r);while(n.length>=e)yield n.slice(0,e),n=n.slice(e)}while(n.length)yield n.slice(0,e),n=n.slice(e)}n(7658),t.exports=r},9164:function(t){"use strict";const e=async t=>{for await(const e of t);};t.exports=e},3726:function(t){"use strict";const e=async function*(t,e){for await(const n of t)await e(n)&&(yield n)};t.exports=e},7290:function(t){"use strict";const e=async t=>{let e;for await(const n of t)e=n;return e};t.exports=e},9927:function(t){"use strict";const e=async function*(t,e){for await(const n of t)yield e(n)};t.exports=e},8806:function(t,e,n){"use strict";const r=n(1131);async function*i(t,e=1){for await(const n of r(t,e)){const t=n.map((t=>t().then((t=>({ok:!0,value:t})),(t=>({ok:!1,err:t})))));for(let e=0;e<t.length;e++){const n=await t[e];if(!n.ok)throw n.err;yield n.value}}}t.exports=i},4395:function(t,e,n){"use strict";function r(t){const[e,n]=t[Symbol.asyncIterator]?[t[Symbol.asyncIterator](),Symbol.asyncIterator]:[t[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>e.next(),push:t=>{r.push(t)},next:()=>r.length?{done:!1,value:r.shift()}:e.next(),[n](){return this}}}n(7658),t.exports=r},2100:function(t){const e=(...t)=>{let e;while(t.length)e=t.shift()(e);return e},n=t=>t&&("function"===typeof t[Symbol.asyncIterator]||"function"===typeof t[Symbol.iterator]||"function"===typeof t.next),r=t=>t&&"function"===typeof t.sink&&n(t.source),i=t=>e=>(t.sink(e),t.source),s=(...t)=>{if(r(t[0])){const e=t[0];t[0]=()=>e.source}else if(n(t[0])){const e=t[0];t[0]=()=>e}if(t.length>1&&r(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let e=1;e<t.length-1;e++)r(t[e])&&(t[e]=i(t[e]));return e(...t)};t.exports=s,t.exports.pipe=s,t.exports.rawPipe=e,t.exports.isIterable=n,t.exports.isDuplex=r},6855:function(t){"use strict";const e=async function*(t,e){let n=0;if(!(e<1))for await(const r of t)if(yield r,n++,n===e)return};t.exports=e},535:function(t,e,n){"use strict";n(7658);const r=n(1800),{hasOwnProperty:i}=Object.prototype,{propertyIsEnumerable:s}=Object,o=(t,e,n)=>Object.defineProperty(t,e,{value:n,writable:!0,enumerable:!0,configurable:!0}),a=this,c={concatArrays:!1,ignoreUndefined:!1},l=t=>{const e=[];for(const n in t)i.call(t,n)&&e.push(n);if(Object.getOwnPropertySymbols){const n=Object.getOwnPropertySymbols(t);for(const r of n)s.call(t,r)&&e.push(r)}return e};function u(t){return Array.isArray(t)?h(t):r(t)?d(t):t}function h(t){const e=t.slice(0,0);return l(t).forEach((n=>{o(e,n,u(t[n]))})),e}function d(t){const e=null===Object.getPrototypeOf(t)?Object.create(null):{};return l(t).forEach((n=>{o(e,n,u(t[n]))})),e}const f=(t,e,n,r)=>(n.forEach((n=>{"undefined"===typeof e[n]&&r.ignoreUndefined||(n in t&&t[n]!==Object.getPrototypeOf(t)?o(t,n,g(t[n],e[n],r)):o(t,n,u(e[n])))})),t),p=(t,e,n)=>{let r=t.slice(0,0),s=0;return[t,e].forEach((e=>{const a=[];for(let n=0;n<e.length;n++)i.call(e,n)&&(a.push(String(n)),o(r,s++,e===t?e[n]:u(e[n])));r=f(r,e,l(e).filter((t=>!a.includes(t))),n)})),r};function g(t,e,n){return n.concatArrays&&Array.isArray(t)&&Array.isArray(e)?p(t,e,n):r(e)&&r(t)?f(t,e,l(e),n):u(e)}t.exports=function(...t){const e=g(u(c),this!==a&&this||{},c);let n={_:{}};for(const i of t)if(void 0!==i){if(!r(i))throw new TypeError("`"+i+"` is not an Option Object");n=g(n,{_:i},e)}return n._}},1800:function(t){"use strict";t.exports=t=>{if("[object Object]"!==Object.prototype.toString.call(t))return!1;const e=Object.getPrototypeOf(t);return null===e||e===Object.prototype}},716:function(t,e,n){t.exports=n(55)},55:function(t,e){(function(n,r){"use strict";var i={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function s(t){if(!Array.isArray(t)&&!ArrayBuffer.isView(t))return!1;for(var e=0;e<t.length;e++)if(!Number.isInteger(t[e])||t[e]<0||t[e]>255)return!1;return!0}function o(t,e){return(65535&t)*e+(((t>>>16)*e&65535)<<16)}function a(t,e){return t<<e|t>>>32-e}function c(t){return t^=t>>>16,t=o(t,2246822507),t^=t>>>13,t=o(t,3266489909),t^=t>>>16,t}function l(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var n=[0,0,0,0];return n[3]+=t[3]+e[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=t[2]+e[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=t[1]+e[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=t[0]+e[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function u(t,e){t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]],e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]];var n=[0,0,0,0];return n[3]+=t[3]*e[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=t[2]*e[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=t[3]*e[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=t[1]*e[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=t[2]*e[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=t[3]*e[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=t[0]*e[3]+t[1]*e[2]+t[2]*e[1]+t[3]*e[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function h(t,e){return e%=64,32===e?[t[1],t[0]]:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e|t[0]>>>32-e]:(e-=32,[t[1]<<e|t[0]>>>32-e,t[0]<<e|t[1]>>>32-e])}function d(t,e){return e%=64,0===e?t:e<32?[t[0]<<e|t[1]>>>32-e,t[1]<<e]:[t[1]<<e-32,0]}function f(t,e){return[t[0]^e[0],t[1]^e[1]]}function p(t){return t=f(t,[0,t[0]>>>1]),t=u(t,[4283543511,3981806797]),t=f(t,[0,t[0]>>>1]),t=u(t,[3301882366,444984403]),t=f(t,[0,t[0]>>>1]),t}i.x86.hash32=function(t,e){if(i.inputValidation&&!s(t))return r;e=e||0;for(var n=t.length%4,l=t.length-n,u=e,h=0,d=3432918353,f=461845907,p=0;p<l;p+=4)h=t[p]|t[p+1]<<8|t[p+2]<<16|t[p+3]<<24,h=o(h,d),h=a(h,15),h=o(h,f),u^=h,u=a(u,13),u=o(u,5)+3864292196;switch(h=0,n){case 3:h^=t[p+2]<<16;case 2:h^=t[p+1]<<8;case 1:h^=t[p],h=o(h,d),h=a(h,15),h=o(h,f),u^=h}return u^=t.length,u=c(u),u>>>0},i.x86.hash128=function(t,e){if(i.inputValidation&&!s(t))return r;e=e||0;for(var n=t.length%16,l=t.length-n,u=e,h=e,d=e,f=e,p=0,g=0,m=0,y=0,w=597399067,b=2869860233,v=951274213,E=2716044179,_=0;_<l;_+=16)p=t[_]|t[_+1]<<8|t[_+2]<<16|t[_+3]<<24,g=t[_+4]|t[_+5]<<8|t[_+6]<<16|t[_+7]<<24,m=t[_+8]|t[_+9]<<8|t[_+10]<<16|t[_+11]<<24,y=t[_+12]|t[_+13]<<8|t[_+14]<<16|t[_+15]<<24,p=o(p,w),p=a(p,15),p=o(p,b),u^=p,u=a(u,19),u+=h,u=o(u,5)+1444728091,g=o(g,b),g=a(g,16),g=o(g,v),h^=g,h=a(h,17),h+=d,h=o(h,5)+197830471,m=o(m,v),m=a(m,17),m=o(m,E),d^=m,d=a(d,15),d+=f,d=o(d,5)+2530024501,y=o(y,E),y=a(y,18),y=o(y,w),f^=y,f=a(f,13),f+=u,f=o(f,5)+850148119;switch(p=0,g=0,m=0,y=0,n){case 15:y^=t[_+14]<<16;case 14:y^=t[_+13]<<8;case 13:y^=t[_+12],y=o(y,E),y=a(y,18),y=o(y,w),f^=y;case 12:m^=t[_+11]<<24;case 11:m^=t[_+10]<<16;case 10:m^=t[_+9]<<8;case 9:m^=t[_+8],m=o(m,v),m=a(m,17),m=o(m,E),d^=m;case 8:g^=t[_+7]<<24;case 7:g^=t[_+6]<<16;case 6:g^=t[_+5]<<8;case 5:g^=t[_+4],g=o(g,b),g=a(g,16),g=o(g,v),h^=g;case 4:p^=t[_+3]<<24;case 3:p^=t[_+2]<<16;case 2:p^=t[_+1]<<8;case 1:p^=t[_],p=o(p,w),p=a(p,15),p=o(p,b),u^=p}return u^=t.length,h^=t.length,d^=t.length,f^=t.length,u+=h,u+=d,u+=f,h+=u,d+=u,f+=u,u=c(u),h=c(h),d=c(d),f=c(f),u+=h,u+=d,u+=f,h+=u,d+=u,f+=u,("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(f>>>0).toString(16)).slice(-8)},i.x64.hash128=function(t,e){if(i.inputValidation&&!s(t))return r;e=e||0;for(var n=t.length%16,o=t.length-n,a=[0,e],c=[0,e],g=[0,0],m=[0,0],y=[2277735313,289559509],w=[1291169091,658871167],b=0;b<o;b+=16)g=[t[b+4]|t[b+5]<<8|t[b+6]<<16|t[b+7]<<24,t[b]|t[b+1]<<8|t[b+2]<<16|t[b+3]<<24],m=[t[b+12]|t[b+13]<<8|t[b+14]<<16|t[b+15]<<24,t[b+8]|t[b+9]<<8|t[b+10]<<16|t[b+11]<<24],g=u(g,y),g=h(g,31),g=u(g,w),a=f(a,g),a=h(a,27),a=l(a,c),a=l(u(a,[0,5]),[0,1390208809]),m=u(m,w),m=h(m,33),m=u(m,y),c=f(c,m),c=h(c,31),c=l(c,a),c=l(u(c,[0,5]),[0,944331445]);switch(g=[0,0],m=[0,0],n){case 15:m=f(m,d([0,t[b+14]],48));case 14:m=f(m,d([0,t[b+13]],40));case 13:m=f(m,d([0,t[b+12]],32));case 12:m=f(m,d([0,t[b+11]],24));case 11:m=f(m,d([0,t[b+10]],16));case 10:m=f(m,d([0,t[b+9]],8));case 9:m=f(m,[0,t[b+8]]),m=u(m,w),m=h(m,33),m=u(m,y),c=f(c,m);case 8:g=f(g,d([0,t[b+7]],56));case 7:g=f(g,d([0,t[b+6]],48));case 6:g=f(g,d([0,t[b+5]],40));case 5:g=f(g,d([0,t[b+4]],32));case 4:g=f(g,d([0,t[b+3]],24));case 3:g=f(g,d([0,t[b+2]],16));case 2:g=f(g,d([0,t[b+1]],8));case 1:g=f(g,[0,t[b]]),g=u(g,y),g=h(g,31),g=u(g,w),a=f(a,g)}return a=f(a,[0,t.length]),c=f(c,[0,t.length]),a=l(a,c),c=l(c,a),a=p(a),c=p(c),a=l(a,c),c=l(c,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(c[0]>>>0).toString(16)).slice(-8)+("00000000"+(c[1]>>>0).toString(16)).slice(-8)},t.exports&&(e=t.exports=i),e.murmurHash3=i})()},9437:function(t,e,n){"use strict";const r=n(5711),i=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class s extends Error{constructor(t){super(),t instanceof Error?(this.originalError=t,({message:t}=t)):(this.originalError=new Error(t),this.originalError.stack=this.stack),this.name="AbortError",this.message=t}}const o=(t,e,n)=>{const r=n.retries-(e-1);return t.attemptNumber=e,t.retriesLeft=r,t},a=t=>i.includes(t),c=(t,e)=>new Promise(((n,i)=>{e={onFailedAttempt:()=>{},retries:10,...e};const c=r.operation(e);c.attempt((async r=>{try{n(await t(r))}catch(l){if(!(l instanceof Error))return void i(new TypeError(`Non-error was thrown: "${l}". You should only throw errors.`));if(l instanceof s)c.stop(),i(l.originalError);else if(l instanceof TypeError&&!a(l.message))c.stop(),i(l);else{o(l,r,e);try{await e.onFailedAttempt(l)}catch(l){return void i(l)}c.retry(l)||i(c.mainError())}}}))}));t.exports=c,t.exports["default"]=c,t.exports.AbortError=s},6425:function(t,e,n){"use strict";t.exports=n(9507)},9507:function(t,e,n){"use strict";var r=e;function i(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(7156),r.BufferWriter=n(8252),r.Reader=n(9799),r.BufferReader=n(8894),r.util=n(7102),r.rpc=n(7753),r.roots=n(358),r.configure=i,i()},9799:function(t,e,n){"use strict";n(3767),n(8585),n(8696),t.exports=c;var r,i=n(7102),s=i.LongBits,o=i.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function c(t){this.buf=t,this.pos=0,this.len=t.length}var l="undefined"!==typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new c(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new c(t);throw Error("illegal buffer")},u=function(){return i.Buffer?function(t){return(c.create=function(t){return i.Buffer.isBuffer(t)?new r(t):l(t)})(t)}:l};function h(){var t=new s(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function d(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function f(){if(this.pos+8>this.len)throw a(this,8);return new s(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,c.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return t}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},c.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},c.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},c.prototype.skip=function(t){if("number"===typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while(4!==(t=7&this.uint32()))this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},c._configure=function(t){r=t,c.create=u(),r._configure();var e=i.Long?"toLong":"toNumber";i.merge(c.prototype,{int64:function(){return h.call(this)[e](!1)},uint64:function(){return h.call(this)[e](!0)},sint64:function(){return h.call(this).zzDecode()[e](!1)},fixed64:function(){return f.call(this)[e](!0)},sfixed64:function(){return f.call(this)[e](!1)}})}},8894:function(t,e,n){"use strict";t.exports=s;var r=n(9799);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(7102);function s(t){r.call(this,t)}s._configure=function(){i.Buffer&&(s.prototype._slice=i.Buffer.prototype.slice)},s.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},s._configure()},358:function(t){"use strict";t.exports={}},7753:function(t,e,n){"use strict";var r=e;r.Service=n(964)},964:function(t,e,n){"use strict";t.exports=i;var r=n(7102);function i(t,e,n){if("function"!==typeof t)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(r.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function t(e,n,i,s,o){if(!s)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(t,a,e,n,i,s);if(a.rpcImpl)try{return a.rpcImpl(e,n[a.requestDelimited?"encodeDelimited":"encode"](s).finish(),(function(t,n){if(t)return a.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",n,e),o(null,n)}a.end(!0)}))}catch(c){return a.emit("error",c,e),void setTimeout((function(){o(c)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},6350:function(t,e,n){"use strict";t.exports=i;var r=n(7102);function i(t,e){this.lo=t>>>0,this.hi=e>>>0}var s=i.zero=new i(0,0);s.toNumber=function(){return 0},s.zzEncode=s.zzDecode=function(){return this},s.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(t){if(0===t)return s;var e=t<0;e&&(t=-t);var n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new i(n,r)},i.from=function(t){if("number"===typeof t)return i.fromNumber(t);if(r.isString(t)){if(!r.Long)return i.fromNumber(parseInt(t,10));t=r.Long.fromString(t)}return t.low||t.high?new i(t.low>>>0,t.high>>>0):s},i.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(t){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;i.fromHash=function(t){return t===o?s:new i((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},i.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},i.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},7102:function(t,e,n){"use strict";n(3767),n(8585),n(8696);var r=e;function i(t,e,n){for(var r=Object.keys(e),i=0;i<r.length;++i)void 0!==t[r[i]]&&n||(t[r[i]]=e[r[i]]);return t}function s(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}r.asPromise=n(5186),r.base64=n(8673),r.EventEmitter=n(8825),r.float=n(2913),r.inquire=n(6332),r.utf8=n(9561),r.pool=n(1168),r.LongBits=n(6350),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t},r.isString=function(t){return"string"===typeof t||t instanceof String},r.isObject=function(t){return t&&"object"===typeof t},r.isset=r.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var t=r.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(t){return"number"===typeof t?r.Buffer?r._Buffer_allocUnsafe(t):new r.Array(t):r.Buffer?r._Buffer_from(t):"undefined"===typeof Uint8Array?t:new Uint8Array(t)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(t){return t?r.LongBits.from(t).toHash():r.LongBits.zeroHash},r.longFromHash=function(t,e){var n=r.LongBits.fromHash(t);return r.Long?r.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},r.merge=i,r.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},r.newError=s,r.ProtocolError=s("ProtocolError"),r.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},r.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var t=r.Buffer;t?(r._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},r._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},7156:function(t,e,n){"use strict";t.exports=h;var r,i=n(7102),s=i.LongBits,o=i.base64,a=i.utf8;function c(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function l(){}function u(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return i.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function f(t,e,n){e[n]=255&t}function p(t,e,n){while(t>127)e[n++]=127&t|128,t>>>=7;e[n]=t}function g(t,e){this.len=t,this.next=void 0,this.val=e}function m(t,e,n){while(t.hi)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;while(t.lo>127)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function y(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}h.create=d(),h.alloc=function(t){return new i.Array(t)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(t,e,n){return this.tail=this.tail.next=new c(t,e,n),this.len+=e,this},g.prototype=Object.create(c.prototype),g.prototype.fn=p,h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new g((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(m,10,s.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=s.from(t);return this._push(m,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=s.from(t).zzEncode();return this._push(m,e.length(),e)},h.prototype.bool=function(t){return this._push(f,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(y,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=s.from(t);return this._push(y,4,e.lo)._push(y,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(i.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(i.float.writeDoubleLE,8,t)};var w=i.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var r=0;r<t.length;++r)e[n+r]=t[r]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(f,1,0);if(i.isString(t)){var n=h.alloc(e=o.length(t));o.decode(t,n,0),t=n}return this.uint32(e)._push(w,e,t)},h.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(f,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},h.prototype.finish=function(){var t=this.head.next,e=this.constructor.alloc(this.len),n=0;while(t)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},h._configure=function(t){r=t,h.create=d(),r._configure()}},8252:function(t,e,n){"use strict";n(3767),n(8585),n(8696),t.exports=s;var r=n(7156);(s.prototype=Object.create(r.prototype)).constructor=s;var i=n(7102);function s(){r.call(this)}function o(t,e,n){t.length<40?i.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}s._configure=function(){s.alloc=i._Buffer_allocUnsafe,s.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var r=0;r<t.length;)e[n++]=t[r++]}},s.prototype.bytes=function(t){i.isString(t)&&(t=i._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(s.writeBytesBuffer,e,t),this},s.prototype.string=function(t){var e=i.Buffer.byteLength(t);return this.uint32(e),e&&this._push(o,e,t),this},s._configure()},8385:function(t,e,n){const r=n(890),i=n(4553),s=n(8258),o=n(8593);function a(t,e,n,s,o){const a=[].slice.call(arguments,1),c=a.length,l="function"===typeof a[c-1];if(!l&&!r())throw new Error("Callback required as last argument");if(!l){if(c<1)throw new Error("Too few arguments provided");return 1===c?(n=e,e=s=void 0):2!==c||e.getContext||(s=n,n=e,e=void 0),new Promise((function(r,o){try{const o=i.create(n,s);r(t(o,e,s))}catch(a){o(a)}}))}if(c<2)throw new Error("Too few arguments provided");2===c?(o=n,n=e,e=s=void 0):3===c&&(e.getContext&&"undefined"===typeof o?(o=s,s=void 0):(o=s,s=n,n=e,e=void 0));try{const r=i.create(n,s);o(null,t(r,e,s))}catch(u){o(u)}}e.create=i.create,e.toCanvas=a.bind(null,s.render),e.toDataURL=a.bind(null,s.renderToDataURL),e.toString=a.bind(null,(function(t,e,n){return o.render(t,n)}))},890:function(t){t.exports=function(){return"function"===typeof Promise&&Promise.prototype&&Promise.prototype.then}},9070:function(t,e,n){n(7658);const r=n(4288).getSymbolSize;e.getRowColCoords=function(t){if(1===t)return[];const e=Math.floor(t/7)+2,n=r(t),i=145===n?26:2*Math.ceil((n-13)/(2*e-2)),s=[n-7];for(let r=1;r<e-1;r++)s[r]=s[r-1]-i;return s.push(6),s.reverse()},e.getPositions=function(t){const n=[],r=e.getRowColCoords(t),i=r.length;for(let e=0;e<i;e++)for(let t=0;t<i;t++)0===e&&0===t||0===e&&t===i-1||e===i-1&&0===t||n.push([r[e],r[t]]);return n}},6355:function(t,e,n){const r=n(5461),i=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"," ","$","%","*","+","-",".","/",":"];function s(t){this.mode=r.ALPHANUMERIC,this.data=t}s.getBitsLength=function(t){return 11*Math.floor(t/2)+t%2*6},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(t){let e;for(e=0;e+2<=this.data.length;e+=2){let n=45*i.indexOf(this.data[e]);n+=i.indexOf(this.data[e+1]),t.put(n,11)}this.data.length%2&&t.put(i.indexOf(this.data[e]),6)},t.exports=s},495:function(t,e,n){function r(){this.buffer=[],this.length=0}n(7658),r.prototype={get:function(t){const e=Math.floor(t/8);return 1===(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(let n=0;n<e;n++)this.putBit(1===(t>>>e-n-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){const e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}},t.exports=r},3880:function(t,e,n){function r(t){if(!t||t<1)throw new Error("BitMatrix size must be defined and greater than 0");this.size=t,this.data=new Uint8Array(t*t),this.reservedBit=new Uint8Array(t*t)}n(3767),n(8585),n(8696),r.prototype.set=function(t,e,n,r){const i=t*this.size+e;this.data[i]=n,r&&(this.reservedBit[i]=!0)},r.prototype.get=function(t,e){return this.data[t*this.size+e]},r.prototype.xor=function(t,e,n){this.data[t*this.size+e]^=n},r.prototype.isReserved=function(t,e){return this.reservedBit[t*this.size+e]},t.exports=r},4754:function(t,e,n){n(3767),n(8585),n(8696);const r=n(4700),i=n(5461);function s(t){this.mode=i.BYTE,"string"===typeof t&&(t=r(t)),this.data=new Uint8Array(t)}s.getBitsLength=function(t){return 8*t},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(t){for(let e=0,n=this.data.length;e<n;e++)t.put(this.data[e],8)},t.exports=s},9757:function(t,e,n){const r=n(2839),i=[1,1,1,1,1,1,1,1,1,1,2,2,1,2,2,4,1,2,4,4,2,4,4,4,2,4,6,5,2,4,6,6,2,5,8,8,4,5,8,8,4,5,8,11,4,8,10,11,4,9,12,16,4,9,16,16,6,10,12,18,6,10,17,16,6,11,16,19,6,13,18,21,7,14,21,25,8,16,20,25,8,17,23,25,9,17,23,34,9,18,25,30,10,20,27,32,12,21,29,35,12,23,34,37,12,25,34,40,13,26,35,42,14,28,38,45,15,29,40,48,16,31,43,51,17,33,45,54,18,35,48,57,19,37,51,60,19,38,53,63,20,40,56,66,21,43,59,70,22,45,62,74,24,47,65,77,25,49,68,81],s=[7,10,13,17,10,16,22,28,15,26,36,44,20,36,52,64,26,48,72,88,36,64,96,112,40,72,108,130,48,88,132,156,60,110,160,192,72,130,192,224,80,150,224,264,96,176,260,308,104,198,288,352,120,216,320,384,132,240,360,432,144,280,408,480,168,308,448,532,180,338,504,588,196,364,546,650,224,416,600,700,224,442,644,750,252,476,690,816,270,504,750,900,300,560,810,960,312,588,870,1050,336,644,952,1110,360,700,1020,1200,390,728,1050,1260,420,784,1140,1350,450,812,1200,1440,480,868,1290,1530,510,924,1350,1620,540,980,1440,1710,570,1036,1530,1800,570,1064,1590,1890,600,1120,1680,1980,630,1204,1770,2100,660,1260,1860,2220,720,1316,1950,2310,750,1372,2040,2430];e.getBlocksCount=function(t,e){switch(e){case r.L:return i[4*(t-1)+0];case r.M:return i[4*(t-1)+1];case r.Q:return i[4*(t-1)+2];case r.H:return i[4*(t-1)+3];default:return}},e.getTotalCodewordsCount=function(t,e){switch(e){case r.L:return s[4*(t-1)+0];case r.M:return s[4*(t-1)+1];case r.Q:return s[4*(t-1)+2];case r.H:return s[4*(t-1)+3];default:return}}},2839:function(t,e){function n(t){if("string"!==typeof t)throw new Error("Param is not a string");const n=t.toLowerCase();switch(n){case"l":case"low":return e.L;case"m":case"medium":return e.M;case"q":case"quartile":return e.Q;case"h":case"high":return e.H;default:throw new Error("Unknown EC Level: "+t)}}e.L={bit:1},e.M={bit:0},e.Q={bit:3},e.H={bit:2},e.isValid=function(t){return t&&"undefined"!==typeof t.bit&&t.bit>=0&&t.bit<4},e.from=function(t,r){if(e.isValid(t))return t;try{return n(t)}catch(i){return r}}},3375:function(t,e,n){const r=n(4288).getSymbolSize,i=7;e.getPositions=function(t){const e=r(t);return[[0,0],[e-i,0],[0,e-i]]}},7874:function(t,e,n){const r=n(4288),i=1335,s=21522,o=r.getBCHDigit(i);e.getEncodedBits=function(t,e){const n=t.bit<<3|e;let a=n<<10;while(r.getBCHDigit(a)-o>=0)a^=i<<r.getBCHDigit(a)-o;return(n<<10|a)^s}},7512:function(t,e,n){n(3767),n(8585),n(8696);const r=new Uint8Array(512),i=new Uint8Array(256);(function(){let t=1;for(let e=0;e<255;e++)r[e]=t,i[t]=e,t<<=1,256&t&&(t^=285);for(let e=255;e<512;e++)r[e]=r[e-255]})(),e.log=function(t){if(t<1)throw new Error("log("+t+")");return i[t]},e.exp=function(t){return r[t]},e.mul=function(t,e){return 0===t||0===e?0:r[i[t]+i[e]]}},9176:function(t,e,n){const r=n(5461),i=n(4288);function s(t){this.mode=r.KANJI,this.data=t}s.getBitsLength=function(t){return 13*t},s.prototype.getLength=function(){return this.data.length},s.prototype.getBitsLength=function(){return s.getBitsLength(this.data.length)},s.prototype.write=function(t){let e;for(e=0;e<this.data.length;e++){let n=i.toSJIS(this.data[e]);if(n>=33088&&n<=40956)n-=33088;else{if(!(n>=57408&&n<=60351))throw new Error("Invalid SJIS character: "+this.data[e]+"\nMake sure your charset is UTF-8");n-=49472}n=192*(n>>>8&255)+(255&n),t.put(n,13)}},t.exports=s},1840:function(t,e){e.Patterns={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7};const n={N1:3,N2:3,N3:40,N4:10};function r(t,n,r){switch(t){case e.Patterns.PATTERN000:return(n+r)%2===0;case e.Patterns.PATTERN001:return n%2===0;case e.Patterns.PATTERN010:return r%3===0;case e.Patterns.PATTERN011:return(n+r)%3===0;case e.Patterns.PATTERN100:return(Math.floor(n/2)+Math.floor(r/3))%2===0;case e.Patterns.PATTERN101:return n*r%2+n*r%3===0;case e.Patterns.PATTERN110:return(n*r%2+n*r%3)%2===0;case e.Patterns.PATTERN111:return(n*r%3+(n+r)%2)%2===0;default:throw new Error("bad maskPattern:"+t)}}e.isValid=function(t){return null!=t&&""!==t&&!isNaN(t)&&t>=0&&t<=7},e.from=function(t){return e.isValid(t)?parseInt(t,10):void 0},e.getPenaltyN1=function(t){const e=t.size;let r=0,i=0,s=0,o=null,a=null;for(let c=0;c<e;c++){i=s=0,o=a=null;for(let l=0;l<e;l++){let e=t.get(c,l);e===o?i++:(i>=5&&(r+=n.N1+(i-5)),o=e,i=1),e=t.get(l,c),e===a?s++:(s>=5&&(r+=n.N1+(s-5)),a=e,s=1)}i>=5&&(r+=n.N1+(i-5)),s>=5&&(r+=n.N1+(s-5))}return r},e.getPenaltyN2=function(t){const e=t.size;let r=0;for(let n=0;n<e-1;n++)for(let i=0;i<e-1;i++){const e=t.get(n,i)+t.get(n,i+1)+t.get(n+1,i)+t.get(n+1,i+1);4!==e&&0!==e||r++}return r*n.N2},e.getPenaltyN3=function(t){const e=t.size;let r=0,i=0,s=0;for(let n=0;n<e;n++){i=s=0;for(let o=0;o<e;o++)i=i<<1&2047|t.get(n,o),o>=10&&(1488===i||93===i)&&r++,s=s<<1&2047|t.get(o,n),o>=10&&(1488===s||93===s)&&r++}return r*n.N3},e.getPenaltyN4=function(t){let e=0;const r=t.data.length;for(let n=0;n<r;n++)e+=t.data[n];const i=Math.abs(Math.ceil(100*e/r/5)-10);return i*n.N4},e.applyMask=function(t,e){const n=e.size;for(let i=0;i<n;i++)for(let s=0;s<n;s++)e.isReserved(s,i)||e.xor(s,i,r(t,s,i))},e.getBestMask=function(t,n){const r=Object.keys(e.Patterns).length;let i=0,s=1/0;for(let o=0;o<r;o++){n(o),e.applyMask(o,t);const r=e.getPenaltyN1(t)+e.getPenaltyN2(t)+e.getPenaltyN3(t)+e.getPenaltyN4(t);e.applyMask(o,t),r<s&&(s=r,i=o)}return i}},5461:function(t,e,n){const r=n(3552),i=n(3555);function s(t){if("string"!==typeof t)throw new Error("Param is not a string");const n=t.toLowerCase();switch(n){case"numeric":return e.NUMERIC;case"alphanumeric":return e.ALPHANUMERIC;case"kanji":return e.KANJI;case"byte":return e.BYTE;default:throw new Error("Unknown mode: "+t)}}e.NUMERIC={id:"Numeric",bit:1,ccBits:[10,12,14]},e.ALPHANUMERIC={id:"Alphanumeric",bit:2,ccBits:[9,11,13]},e.BYTE={id:"Byte",bit:4,ccBits:[8,16,16]},e.KANJI={id:"Kanji",bit:8,ccBits:[8,10,12]},e.MIXED={bit:-1},e.getCharCountIndicator=function(t,e){if(!t.ccBits)throw new Error("Invalid mode: "+t);if(!r.isValid(e))throw new Error("Invalid version: "+e);return e>=1&&e<10?t.ccBits[0]:e<27?t.ccBits[1]:t.ccBits[2]},e.getBestModeForData=function(t){return i.testNumeric(t)?e.NUMERIC:i.testAlphanumeric(t)?e.ALPHANUMERIC:i.testKanji(t)?e.KANJI:e.BYTE},e.toString=function(t){if(t&&t.id)return t.id;throw new Error("Invalid mode")},e.isValid=function(t){return t&&t.bit&&t.ccBits},e.from=function(t,n){if(e.isValid(t))return t;try{return s(t)}catch(r){return n}}},9186:function(t,e,n){const r=n(5461);function i(t){this.mode=r.NUMERIC,this.data=t.toString()}i.getBitsLength=function(t){return 10*Math.floor(t/3)+(t%3?t%3*3+1:0)},i.prototype.getLength=function(){return this.data.length},i.prototype.getBitsLength=function(){return i.getBitsLength(this.data.length)},i.prototype.write=function(t){let e,n,r;for(e=0;e+3<=this.data.length;e+=3)n=this.data.substr(e,3),r=parseInt(n,10),t.put(r,10);const i=this.data.length-e;i>0&&(n=this.data.substr(e),r=parseInt(n,10),t.put(r,3*i+1))},t.exports=i},823:function(t,e,n){n(3767),n(8585),n(8696);const r=n(7512);e.mul=function(t,e){const n=new Uint8Array(t.length+e.length-1);for(let i=0;i<t.length;i++)for(let s=0;s<e.length;s++)n[i+s]^=r.mul(t[i],e[s]);return n},e.mod=function(t,e){let n=new Uint8Array(t);while(n.length-e.length>=0){const t=n[0];for(let s=0;s<e.length;s++)n[s]^=r.mul(e[s],t);let i=0;while(i<n.length&&0===n[i])i++;n=n.slice(i)}return n},e.generateECPolynomial=function(t){let n=new Uint8Array([1]);for(let i=0;i<t;i++)n=e.mul(n,new Uint8Array([1,r.exp(i)]));return n}},4553:function(t,e,n){n(3767),n(8585),n(8696);const r=n(4288),i=n(2839),s=n(495),o=n(3880),a=n(9070),c=n(3375),l=n(1840),u=n(9757),h=n(4365),d=n(9693),f=n(7874),p=n(5461),g=n(8439);function m(t,e){const n=t.size,r=c.getPositions(e);for(let i=0;i<r.length;i++){const e=r[i][0],s=r[i][1];for(let r=-1;r<=7;r++)if(!(e+r<=-1||n<=e+r))for(let i=-1;i<=7;i++)s+i<=-1||n<=s+i||(r>=0&&r<=6&&(0===i||6===i)||i>=0&&i<=6&&(0===r||6===r)||r>=2&&r<=4&&i>=2&&i<=4?t.set(e+r,s+i,!0,!0):t.set(e+r,s+i,!1,!0))}}function y(t){const e=t.size;for(let n=8;n<e-8;n++){const e=n%2===0;t.set(n,6,e,!0),t.set(6,n,e,!0)}}function w(t,e){const n=a.getPositions(e);for(let r=0;r<n.length;r++){const e=n[r][0],i=n[r][1];for(let n=-2;n<=2;n++)for(let r=-2;r<=2;r++)-2===n||2===n||-2===r||2===r||0===n&&0===r?t.set(e+n,i+r,!0,!0):t.set(e+n,i+r,!1,!0)}}function b(t,e){const n=t.size,r=d.getEncodedBits(e);let i,s,o;for(let a=0;a<18;a++)i=Math.floor(a/3),s=a%3+n-8-3,o=1===(r>>a&1),t.set(i,s,o,!0),t.set(s,i,o,!0)}function v(t,e,n){const r=t.size,i=f.getEncodedBits(e,n);let s,o;for(s=0;s<15;s++)o=1===(i>>s&1),s<6?t.set(s,8,o,!0):s<8?t.set(s+1,8,o,!0):t.set(r-15+s,8,o,!0),s<8?t.set(8,r-s-1,o,!0):s<9?t.set(8,15-s-1+1,o,!0):t.set(8,15-s-1,o,!0);t.set(r-8,8,1,!0)}function E(t,e){const n=t.size;let r=-1,i=n-1,s=7,o=0;for(let a=n-1;a>0;a-=2){6===a&&a--;while(1){for(let n=0;n<2;n++)if(!t.isReserved(i,a-n)){let r=!1;o<e.length&&(r=1===(e[o]>>>s&1)),t.set(i,a-n,r),s--,-1===s&&(o++,s=7)}if(i+=r,i<0||n<=i){i-=r,r=-r;break}}}}function _(t,e,n){const i=new s;n.forEach((function(e){i.put(e.mode.bit,4),i.put(e.getLength(),p.getCharCountIndicator(e.mode,t)),e.write(i)}));const o=r.getSymbolTotalCodewords(t),a=u.getTotalCodewordsCount(t,e),c=8*(o-a);i.getLengthInBits()+4<=c&&i.put(0,4);while(i.getLengthInBits()%8!==0)i.putBit(0);const l=(c-i.getLengthInBits())/8;for(let r=0;r<l;r++)i.put(r%2?17:236,8);return S(i,t,e)}function S(t,e,n){const i=r.getSymbolTotalCodewords(e),s=u.getTotalCodewordsCount(e,n),o=i-s,a=u.getBlocksCount(e,n),c=i%a,l=a-c,d=Math.floor(i/a),f=Math.floor(o/a),p=f+1,g=d-f,m=new h(g);let y=0;const w=new Array(a),b=new Array(a);let v=0;const E=new Uint8Array(t.buffer);for(let r=0;r<a;r++){const t=r<l?f:p;w[r]=E.slice(y,y+t),b[r]=m.encode(w[r]),y+=t,v=Math.max(v,t)}const _=new Uint8Array(i);let S,A,C=0;for(S=0;S<v;S++)for(A=0;A<a;A++)S<w[A].length&&(_[C++]=w[A][S]);for(S=0;S<g;S++)for(A=0;A<a;A++)_[C++]=b[A][S];return _}function A(t,e,n,i){let s;if(Array.isArray(t))s=g.fromArray(t);else{if("string"!==typeof t)throw new Error("Invalid data");{let r=e;if(!r){const e=g.rawSplit(t);r=d.getBestVersionForData(e,n)}s=g.fromString(t,r||40)}}const a=d.getBestVersionForData(s,n);if(!a)throw new Error("The amount of data is too big to be stored in a QR Code");if(e){if(e<a)throw new Error("\nThe chosen QR Code version cannot contain this amount of data.\nMinimum version required to store current data is: "+a+".\n")}else e=a;const c=_(e,n,s),u=r.getSymbolSize(e),h=new o(u);return m(h,e),y(h),w(h,e),v(h,n,0),e>=7&&b(h,e),E(h,c),isNaN(i)&&(i=l.getBestMask(h,v.bind(null,h,n))),l.applyMask(i,h),v(h,n,i),{modules:h,version:e,errorCorrectionLevel:n,maskPattern:i,segments:s}}e.create=function(t,e){if("undefined"===typeof t||""===t)throw new Error("No input text");let n,s,o=i.M;return"undefined"!==typeof e&&(o=i.from(e.errorCorrectionLevel,i.M),n=d.from(e.version),s=l.from(e.maskPattern),e.toSJISFunc&&r.setToSJISFunction(e.toSJISFunc)),A(t,n,o,s)}},4365:function(t,e,n){n(3767),n(8585),n(8696);const r=n(823);function i(t){this.genPoly=void 0,this.degree=t,this.degree&&this.initialize(this.degree)}i.prototype.initialize=function(t){this.degree=t,this.genPoly=r.generateECPolynomial(this.degree)},i.prototype.encode=function(t){if(!this.genPoly)throw new Error("Encoder not initialized");const e=new Uint8Array(t.length+this.degree);e.set(t);const n=r.mod(e,this.genPoly),i=this.degree-n.length;if(i>0){const t=new Uint8Array(this.degree);return t.set(n,i),t}return n},t.exports=i},3555:function(t,e){const n="[0-9]+",r="[A-Z $%*+\\-./:]+";let i="(?:[u3000-u303F]|[u3040-u309F]|[u30A0-u30FF]|[uFF00-uFFEF]|[u4E00-u9FAF]|[u2605-u2606]|[u2190-u2195]|u203B|[u2010u2015u2018u2019u2025u2026u201Cu201Du2225u2260]|[u0391-u0451]|[u00A7u00A8u00B1u00B4u00D7u00F7])+";i=i.replace(/u/g,"\\u");const s="(?:(?![A-Z0-9 $%*+\\-./:]|"+i+")(?:.|[\r\n]))+";e.KANJI=new RegExp(i,"g"),e.BYTE_KANJI=new RegExp("[^A-Z0-9 $%*+\\-./:]+","g"),e.BYTE=new RegExp(s,"g"),e.NUMERIC=new RegExp(n,"g"),e.ALPHANUMERIC=new RegExp(r,"g");const o=new RegExp("^"+i+"$"),a=new RegExp("^"+n+"$"),c=new RegExp("^[A-Z0-9 $%*+\\-./:]+$");e.testKanji=function(t){return o.test(t)},e.testNumeric=function(t){return a.test(t)},e.testAlphanumeric=function(t){return c.test(t)}},8439:function(t,e,n){n(7658);const r=n(5461),i=n(9186),s=n(6355),o=n(4754),a=n(9176),c=n(3555),l=n(4288),u=n(8716);function h(t){return unescape(encodeURIComponent(t)).length}function d(t,e,n){const r=[];let i;while(null!==(i=t.exec(n)))r.push({data:i[0],index:i.index,mode:e,length:i[0].length});return r}function f(t){const e=d(c.NUMERIC,r.NUMERIC,t),n=d(c.ALPHANUMERIC,r.ALPHANUMERIC,t);let i,s;l.isKanjiModeEnabled()?(i=d(c.BYTE,r.BYTE,t),s=d(c.KANJI,r.KANJI,t)):(i=d(c.BYTE_KANJI,r.BYTE,t),s=[]);const o=e.concat(n,i,s);return o.sort((function(t,e){return t.index-e.index})).map((function(t){return{data:t.data,mode:t.mode,length:t.length}}))}function p(t,e){switch(e){case r.NUMERIC:return i.getBitsLength(t);case r.ALPHANUMERIC:return s.getBitsLength(t);case r.KANJI:return a.getBitsLength(t);case r.BYTE:return o.getBitsLength(t)}}function g(t){return t.reduce((function(t,e){const n=t.length-1>=0?t[t.length-1]:null;return n&&n.mode===e.mode?(t[t.length-1].data+=e.data,t):(t.push(e),t)}),[])}function m(t){const e=[];for(let n=0;n<t.length;n++){const i=t[n];switch(i.mode){case r.NUMERIC:e.push([i,{data:i.data,mode:r.ALPHANUMERIC,length:i.length},{data:i.data,mode:r.BYTE,length:i.length}]);break;case r.ALPHANUMERIC:e.push([i,{data:i.data,mode:r.BYTE,length:i.length}]);break;case r.KANJI:e.push([i,{data:i.data,mode:r.BYTE,length:h(i.data)}]);break;case r.BYTE:e.push([{data:i.data,mode:r.BYTE,length:h(i.data)}])}}return e}function y(t,e){const n={},i={start:{}};let s=["start"];for(let o=0;o<t.length;o++){const a=t[o],c=[];for(let t=0;t<a.length;t++){const l=a[t],u=""+o+t;c.push(u),n[u]={node:l,lastCount:0},i[u]={};for(let t=0;t<s.length;t++){const o=s[t];n[o]&&n[o].node.mode===l.mode?(i[o][u]=p(n[o].lastCount+l.length,l.mode)-p(n[o].lastCount,l.mode),n[o].lastCount+=l.length):(n[o]&&(n[o].lastCount=l.length),i[o][u]=p(l.length,l.mode)+4+r.getCharCountIndicator(l.mode,e))}}s=c}for(let r=0;r<s.length;r++)i[s[r]].end=0;return{map:i,table:n}}function w(t,e){let n;const c=r.getBestModeForData(t);if(n=r.from(e,c),n!==r.BYTE&&n.bit<c.bit)throw new Error('"'+t+'" cannot be encoded with mode '+r.toString(n)+".\n Suggested mode is: "+r.toString(c));switch(n!==r.KANJI||l.isKanjiModeEnabled()||(n=r.BYTE),n){case r.NUMERIC:return new i(t);case r.ALPHANUMERIC:return new s(t);case r.KANJI:return new a(t);case r.BYTE:return new o(t)}}e.fromArray=function(t){return t.reduce((function(t,e){return"string"===typeof e?t.push(w(e,null)):e.data&&t.push(w(e.data,e.mode)),t}),[])},e.fromString=function(t,n){const r=f(t,l.isKanjiModeEnabled()),i=m(r),s=y(i,n),o=u.find_path(s.map,"start","end"),a=[];for(let e=1;e<o.length-1;e++)a.push(s.table[o[e]].node);return e.fromArray(g(a))},e.rawSplit=function(t){return e.fromArray(f(t,l.isKanjiModeEnabled()))}},4288:function(t,e){let n;const r=[0,26,44,70,100,134,172,196,242,292,346,404,466,532,581,655,733,815,901,991,1085,1156,1258,1364,1474,1588,1706,1828,1921,2051,2185,2323,2465,2611,2761,2876,3034,3196,3362,3532,3706];e.getSymbolSize=function(t){if(!t)throw new Error('"version" cannot be null or undefined');if(t<1||t>40)throw new Error('"version" should be in range from 1 to 40');return 4*t+17},e.getSymbolTotalCodewords=function(t){return r[t]},e.getBCHDigit=function(t){let e=0;while(0!==t)e++,t>>>=1;return e},e.setToSJISFunction=function(t){if("function"!==typeof t)throw new Error('"toSJISFunc" is not a valid function.');n=t},e.isKanjiModeEnabled=function(){return"undefined"!==typeof n},e.toSJIS=function(t){return n(t)}},3552:function(t,e){e.isValid=function(t){return!isNaN(t)&&t>=1&&t<=40}},9693:function(t,e,n){const r=n(4288),i=n(9757),s=n(2839),o=n(5461),a=n(3552),c=7973,l=r.getBCHDigit(c);function u(t,n,r){for(let i=1;i<=40;i++)if(n<=e.getCapacity(i,r,t))return i}function h(t,e){return o.getCharCountIndicator(t,e)+4}function d(t,e){let n=0;return t.forEach((function(t){const r=h(t.mode,e);n+=r+t.getBitsLength()})),n}function f(t,n){for(let r=1;r<=40;r++){const i=d(t,r);if(i<=e.getCapacity(r,n,o.MIXED))return r}}e.from=function(t,e){return a.isValid(t)?parseInt(t,10):e},e.getCapacity=function(t,e,n){if(!a.isValid(t))throw new Error("Invalid QR Code version");"undefined"===typeof n&&(n=o.BYTE);const s=r.getSymbolTotalCodewords(t),c=i.getTotalCodewordsCount(t,e),l=8*(s-c);if(n===o.MIXED)return l;const u=l-h(n,t);switch(n){case o.NUMERIC:return Math.floor(u/10*3);case o.ALPHANUMERIC:return Math.floor(u/11*2);case o.KANJI:return Math.floor(u/13);case o.BYTE:default:return Math.floor(u/8)}},e.getBestVersionForData=function(t,e){let n;const r=s.from(e,s.M);if(Array.isArray(t)){if(t.length>1)return f(t,r);if(0===t.length)return 1;n=t[0]}else n=t;return u(n.mode,n.getLength(),r)},e.getEncodedBits=function(t){if(!a.isValid(t)||t<7)throw new Error("Invalid QR Code version");let e=t<<12;while(r.getBCHDigit(e)-l>=0)e^=c<<r.getBCHDigit(e)-l;return t<<12|e}},8258:function(t,e,n){const r=n(8920);function i(t,e,n){t.clearRect(0,0,e.width,e.height),e.style||(e.style={}),e.height=n,e.width=n,e.style.height=n+"px",e.style.width=n+"px"}function s(){try{return document.createElement("canvas")}catch(t){throw new Error("You need to specify a canvas element")}}e.render=function(t,e,n){let o=n,a=e;"undefined"!==typeof o||e&&e.getContext||(o=e,e=void 0),e||(a=s()),o=r.getOptions(o);const c=r.getImageWidth(t.modules.size,o),l=a.getContext("2d"),u=l.createImageData(c,c);return r.qrToImageData(u.data,t,o),i(l,a,c),l.putImageData(u,0,0),a},e.renderToDataURL=function(t,n,r){let i=r;"undefined"!==typeof i||n&&n.getContext||(i=n,n=void 0),i||(i={});const s=e.render(t,n,i),o=i.type||"image/png",a=i.rendererOpts||{};return s.toDataURL(o,a.quality)}},8593:function(t,e,n){const r=n(8920);function i(t,e){const n=t.a/255,r=e+'="'+t.hex+'"';return n<1?r+" "+e+'-opacity="'+n.toFixed(2).slice(1)+'"':r}function s(t,e,n){let r=t+e;return"undefined"!==typeof n&&(r+=" "+n),r}function o(t,e,n){let r="",i=0,o=!1,a=0;for(let c=0;c<t.length;c++){const l=Math.floor(c%e),u=Math.floor(c/e);l||o||(o=!0),t[c]?(a++,c>0&&l>0&&t[c-1]||(r+=o?s("M",l+n,.5+u+n):s("m",i,0),i=0,o=!1),l+1<e&&t[c+1]||(r+=s("h",a),a=0)):i++}return r}e.render=function(t,e,n){const s=r.getOptions(e),a=t.modules.size,c=t.modules.data,l=a+2*s.margin,u=s.color.light.a?"<path "+i(s.color.light,"fill")+' d="M0 0h'+l+"v"+l+'H0z"/>':"",h="<path "+i(s.color.dark,"stroke")+' d="'+o(c,a,s.margin)+'"/>',d='viewBox="0 0 '+l+" "+l+'"',f=s.width?'width="'+s.width+'" height="'+s.width+'" ':"",p='<svg xmlns="http://www.w3.org/2000/svg" '+f+d+' shape-rendering="crispEdges">'+u+h+"</svg>\n";return"function"===typeof n&&n(null,p),p}},8920:function(t,e,n){function r(t){if("number"===typeof t&&(t=t.toString()),"string"!==typeof t)throw new Error("Color should be defined as hex string");let e=t.slice().replace("#","").split("");if(e.length<3||5===e.length||e.length>8)throw new Error("Invalid hex color: "+t);3!==e.length&&4!==e.length||(e=Array.prototype.concat.apply([],e.map((function(t){return[t,t]})))),6===e.length&&e.push("F","F");const n=parseInt(e.join(""),16);return{r:n>>24&255,g:n>>16&255,b:n>>8&255,a:255&n,hex:"#"+e.slice(0,6).join("")}}n(7658),e.getOptions=function(t){t||(t={}),t.color||(t.color={});const e="undefined"===typeof t.margin||null===t.margin||t.margin<0?4:t.margin,n=t.width&&t.width>=21?t.width:void 0,i=t.scale||4;return{width:n,scale:n?4:i,margin:e,color:{dark:r(t.color.dark||"#000000ff"),light:r(t.color.light||"#ffffffff")},type:t.type,rendererOpts:t.rendererOpts||{}}},e.getScale=function(t,e){return e.width&&e.width>=t+2*e.margin?e.width/(t+2*e.margin):e.scale},e.getImageWidth=function(t,n){const r=e.getScale(t,n);return Math.floor((t+2*n.margin)*r)},e.qrToImageData=function(t,n,r){const i=n.modules.size,s=n.modules.data,o=e.getScale(i,r),a=Math.floor((i+2*r.margin)*o),c=r.margin*o,l=[r.color.light,r.color.dark];for(let e=0;e<a;e++)for(let n=0;n<a;n++){let u=4*(e*a+n),h=r.color.light;if(e>=c&&n>=c&&e<a-c&&n<a-c){const t=Math.floor((e-c)/o),r=Math.floor((n-c)/o);h=l[s[t*i+r]?1:0]}t[u++]=h.r,t[u++]=h.g,t[u++]=h.b,t[u]=h.a}}},3864:function(t,e,n){n(3767),n(8585),n(8696);const{instantiate:r}=n(5713);function i(t={}){if(!i.supported)return null;var e=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return r(new Response(new Blob([e],{type:"application/wasm"})),t)}i.supported="undefined"!==typeof WebAssembly,t.exports=i},7393:function(t,e,n){const r=n(2282),i=n(3864),s=async(t,e,n,s,o)=>{const a=await i();return new r(a,t,e,n,s,o)};t.exports={Rabin:r,create:s}},2282:function(t,e,n){n(3767),n(8585),n(8696);class r{constructor(t,e=12,n=8192,r=32768,i=64,s){this.bits=e,this.min=n,this.max=r,this.asModule=t,this.rabin=new t.Rabin(e,n,r,i,s),this.polynomial=s}fingerprint(t){const{__retain:e,__release:n,__allocArray:r,__getInt32Array:i,Int32Array_ID:s,Uint8Array_ID:o}=this.asModule,a=new Int32Array(Math.ceil(t.length/this.min)),c=e(r(s,a)),l=e(r(o,t)),u=this.rabin.fingerprint(l,c),h=i(u);n(l),n(c);const d=h.indexOf(0);return d>=0?h.subarray(0,d):h}}t.exports=r},5431:function(t,e,n){"use strict";n.d(e,{z:function(){return s}});var r,i=function(){return Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))};function s(t,e){void 0===e&&(e={});var n=e.registrationOptions;void 0===n&&(n={}),delete e.registrationOptions;var s=function(t){var n=[],r=arguments.length-1;while(r-- >0)n[r]=arguments[r+1];e&&e[t]&&e[t].apply(e,n)};"serviceWorker"in navigator&&r.then((function(){i()?(c(t,s,n),navigator.serviceWorker.ready.then((function(t){s("ready",t)})).catch((function(t){return o(s,t)}))):(a(t,s,n),navigator.serviceWorker.ready.then((function(t){s("ready",t)})).catch((function(t){return o(s,t)})))}))}function o(t,e){navigator.onLine||t("offline"),t("error",e)}function a(t,e,n){navigator.serviceWorker.register(t,n).then((function(t){e("registered",t),t.waiting?e("updated",t):t.onupdatefound=function(){e("updatefound",t);var n=t.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?e("updated",t):e("cached",t))}}})).catch((function(t){return o(e,t)}))}function c(t,e,n){fetch(t).then((function(r){404===r.status?(e("error",new Error("Service worker not found at "+t)),l()):-1===r.headers.get("content-type").indexOf("javascript")?(e("error",new Error("Expected "+t+" to have javascript content-type, but received "+r.headers.get("content-type"))),l()):a(t,e,n)})).catch((function(t){return o(e,t)}))}function l(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){return o(emit,t)}))}"undefined"!==typeof window&&(r="undefined"!==typeof Promise?new Promise((function(t){return window.addEventListener("load",t)})):{then:function(t){return window.addEventListener("load",t)}})},5711:function(t,e,n){t.exports=n(7334)},7334:function(t,e,n){n(7658);var r=n(8463);e.operation=function(t){var n=e.timeouts(t);return new r(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},e.timeouts=function(t){if(t instanceof Array)return[].concat(t);var e={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var n in t)e[n]=t[n];if(e.minTimeout>e.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var r=[],i=0;i<e.retries;i++)r.push(this.createTimeout(i,e));return t&&t.forever&&!r.length&&r.push(this.createTimeout(i,e)),r.sort((function(t,e){return t-e})),r},e.createTimeout=function(t,e){var n=e.randomize?Math.random()+1:1,r=Math.round(n*Math.max(e.minTimeout,1)*Math.pow(e.factor,t));return r=Math.min(r,e.maxTimeout),r},e.wrap=function(t,n,r){if(n instanceof Array&&(r=n,n=null),!r)for(var i in r=[],t)"function"===typeof t[i]&&r.push(i);for(var s=0;s<r.length;s++){var o=r[s],a=t[o];t[o]=function(r){var i=e.operation(n),s=Array.prototype.slice.call(arguments,1),o=s.pop();s.push((function(t){i.retry(t)||(t&&(arguments[0]=i.mainError()),o.apply(this,arguments))})),i.attempt((function(){r.apply(t,s)}))}.bind(t,a),t[o].options=n}}},8463:function(t,e,n){function r(t,e){"boolean"===typeof e&&(e={forever:e}),this._originalTimeouts=JSON.parse(JSON.stringify(t)),this._timeouts=t,this._options=e||{},this._maxRetryTime=e&&e.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}n(7658),n(541),t.exports=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(t){if(this._timeout&&clearTimeout(this._timeout),!t)return!1;var e=(new Date).getTime();if(t&&e-this._operationStart>=this._maxRetryTime)return this._errors.push(t),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(t);var n=this._timeouts.shift();if(void 0===n){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1)}var r=this;return this._timer=setTimeout((function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout((function(){r._operationTimeoutCb(r._attempts)}),r._operationTimeout),r._options.unref&&r._timeout.unref()),r._fn(r._attempts)}),n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(t,e){this._fn=t,e&&(e.timeout&&(this._operationTimeout=e.timeout),e.cb&&(this._operationTimeoutCb=e.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout((function(){n._operationTimeoutCb()}),n._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},r.prototype.try=function(t){console.log("Using RetryOperation.try() is deprecated"),this.attempt(t)},r.prototype.start=function(t){console.log("Using RetryOperation.start() is deprecated"),this.attempt(t)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(0===this._errors.length)return null;for(var t={},e=null,n=0,r=0;r<this._errors.length;r++){var i=this._errors[r],s=i.message,o=(t[s]||0)+1;t[s]=o,o>=n&&(e=i,n=o)}return e}},1946:function(t,e,n){"use strict";n(7658),n(541);const r=7;function i(t,e){return t+s(e)}function s(t){let e=t;return e-=e>>1&1431655765,e=(858993459&e)+(e>>2&858993459),16843009*(e+(e>>4)&252645135)>>24}function o(t,e){return t[0]-e[0]}function a(t){return t[1]}t.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(t,e){let n=this._internalPositionFor(t,!1);if(void 0===e)-1!==n&&(this._unsetInternalPos(n),this._unsetBit(t),this._changedLength=!0,this._changedData=!0);else{let r=!1;-1===n?(n=this._data.length,this._setBit(t),this._changedData=!0):r=!0,this._setInternalPos(n,t,e,r),this._changedLength=!0}}unset(t){this.set(t,void 0)}get(t){this._sortData();const e=this._internalPositionFor(t,!0);if(-1!==e)return this._data[e][1]}push(t){return this.set(this.length,t),this.length}get length(){if(this._sortData(),this._changedLength){const t=this._data[this._data.length-1];this._length=t?t[0]+1:0,this._changedLength=!1}return this._length}forEach(t){let e=0;while(e<this.length)t(this.get(e),e,this),e++}map(t){let e=0,n=new Array(this.length);while(e<this.length)n[e]=t(this.get(e),e,this),e++;return n}reduce(t,e){let n=0,r=e;while(n<this.length){const e=this.get(n);r=t(r,e,n),n++}return r}find(t){let e,n,r=0;while(r<this.length&&!e)n=this.get(r),e=t(n),r++;return e?n:void 0}_internalPositionFor(t,e){const n=this._bytePosFor(t,e);if(n>=this._bitArrays.length)return-1;const o=this._bitArrays[n],a=t-n*r,c=(o&1<<a)>0;if(!c)return-1;const l=this._bitArrays.slice(0,n).reduce(i,0),u=~(4294967295<<a+1),h=s(o&u),d=l+h-1;return d}_bytePosFor(t,e){const n=Math.floor(t/r),i=n+1;while(!e&&this._bitArrays.length<i)this._bitArrays.push(0);return n}_setBit(t){const e=this._bytePosFor(t,!1);this._bitArrays[e]|=1<<t-e*r}_unsetBit(t){const e=this._bytePosFor(t,!1);this._bitArrays[e]&=~(1<<t-e*r)}_setInternalPos(t,e,n,r){const i=this._data,s=[e,n];if(r)this._sortData(),i[t]=s;else{if(i.length)if(i[i.length-1][0]>=e)i.push(s);else if(i[0][0]<=e)i.unshift(s);else{const t=Math.round(i.length/2);this._data=i.slice(0,t).concat(s).concat(i.slice(t))}else this._data.push(s);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(t){this._data.splice(t,1)}_sortData(){this._changedData&&this._data.sort(o),this._changedData=!1}bitField(){const t=[];let e,n=8,r=0,i=0;const s=this._bitArrays.slice();while(s.length||r){0===r&&(e=s.shift(),r=7);const o=Math.min(r,n),a=~(255<<o),c=e&a;i|=c<<8-n,e>>>=o,r-=o,n-=o,n&&(r||s.length)||(t.push(i),i=0,n=8)}for(var o=t.length-1;o>0;o--){const e=t[o];if(0!==e)break;t.pop()}return t}compactArray(){return this._sortData(),this._data.map(a)}}},1978:function(t,e,n){"use strict";function r(t,e,n){void 0===n&&(n=!1),n&&(e/=t,t=1);var r,i=[],s=0,o=0,a=function(){var n=s+e,c=Date.now();if(c<n)return void 0!==r&&clearTimeout(r),void(r=setTimeout(a,n-c));s=c,o=0;for(var l=0,u=i.splice(0,t);l<u.length;l++){var h=u[l];o++,h()}r=i.length?setTimeout(a,e):void 0};return function(n){return new Promise((function(c,l){var u=function(){return Promise.resolve().then(n).then(c).catch(l)},h=Date.now();void 0===r&&h-s>e&&(s=h,o=0),o++<t?u():(i.push(u),void 0===r&&(r=setTimeout(a,s+e-h)))}))}}n(7658),Object.defineProperty(e,"__esModule",{value:!0}),t.exports=r,e["default"]=r},2706:function(t){t.exports=r;var e=128,n=127;function r(t,i){var s,o=0,a=(i=i||0,0),c=i,l=t.length;do{if(c>=l||a>49)throw r.bytes=0,new RangeError("Could not decode varint");s=t[c++],o+=a<28?(s&n)<<a:(s&n)*Math.pow(2,a),a+=7}while(s>=e);return r.bytes=c-i,o}},799:function(t){t.exports=s;var e=128,n=127,r=~n,i=Math.pow(2,31);function s(t,n,o){if(Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw s.bytes=0,new RangeError("Could not encode varint");n=n||[],o=o||0;var a=o;while(t>=i)n[o++]=255&t|e,t/=128;while(t&r)n[o++]=255&t|e,t>>>=7;return n[o]=0|t,s.bytes=o-a+1,n}},2611:function(t,e,n){t.exports={encode:n(799),decode:n(2706),encodingLength:n(3303)}},3303:function(t){var e=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),i=Math.pow(2,28),s=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);t.exports=function(t){return t<e?1:t<n?2:t<r?3:t<i?4:t<s?5:t<o?6:t<a?7:t<c?8:t<l?9:10}},89:function(t,e){"use strict";e.Z=(t,e)=>{const n=t.__vccOpts||t;for(const[r,i]of e)n[r]=i;return n}},65:function(t,e,n){"use strict";n.d(e,{MT:function(){return tt}});n(7658),n(541);var r=n(3396),i=n(4870);function s(){return o().__VUE_DEVTOOLS_GLOBAL_HOOK__}function o(){return"undefined"!==typeof navigator&&"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{}}const a="function"===typeof Proxy,c="devtools-plugin:setup",l="plugin:settings:set";let u,h;function d(){var t;return void 0!==u||("undefined"!==typeof window&&window.performance?(u=!0,h=window.performance):"undefined"!==typeof n.g&&(null===(t=n.g.perf_hooks)||void 0===t?void 0:t.performance)?(u=!0,h=n.g.perf_hooks.performance):u=!1),u}function f(){return d()?h.now():Date.now()}class p{constructor(t,e){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=e;const n={};if(t.settings)for(const o in t.settings){const e=t.settings[o];n[o]=e.defaultValue}const r=`__vue-devtools-plugin-settings__${t.id}`;let i=Object.assign({},n);try{const t=localStorage.getItem(r),e=JSON.parse(t);Object.assign(i,e)}catch(s){}this.fallbacks={getSettings(){return i},setSettings(t){try{localStorage.setItem(r,JSON.stringify(t))}catch(s){}i=t},now(){return f()}},e&&e.on(l,((t,e)=>{t===this.plugin.id&&this.fallbacks.setSettings(e)})),this.proxiedOn=new Proxy({},{get:(t,e)=>this.target?this.target.on[e]:(...t)=>{this.onQueue.push({method:e,args:t})}}),this.proxiedTarget=new Proxy({},{get:(t,e)=>this.target?this.target[e]:"on"===e?this.proxiedOn:Object.keys(this.fallbacks).includes(e)?(...t)=>(this.targetQueue.push({method:e,args:t,resolve:()=>{}}),this.fallbacks[e](...t)):(...t)=>new Promise((n=>{this.targetQueue.push({method:e,args:t,resolve:n})}))})}async setRealTarget(t){this.target=t;for(const e of this.onQueue)this.target.on[e.method](...e.args);for(const e of this.targetQueue)e.resolve(await this.target[e.method](...e.args))}}function g(t,e){const n=t,r=o(),i=s(),l=a&&n.enableEarlyProxy;if(!i||!r.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&l){const t=l?new p(n,i):null,s=r.__VUE_DEVTOOLS_PLUGINS__=r.__VUE_DEVTOOLS_PLUGINS__||[];s.push({pluginDescriptor:n,setupFn:e,proxy:t}),t&&e(t.proxiedTarget)}else i.emit(c,t,e)}
/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */
var m="store";function y(t,e){Object.keys(t).forEach((function(n){return e(t[n],n)}))}function w(t){return null!==t&&"object"===typeof t}function b(t){return t&&"function"===typeof t.then}function v(t,e){return function(){return t(e)}}function E(t,e,n){return e.indexOf(t)<0&&(n&&n.prepend?e.unshift(t):e.push(t)),function(){var n=e.indexOf(t);n>-1&&e.splice(n,1)}}function _(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;A(t,n,[],t._modules.root,!0),S(t,n,e)}function S(t,e,n){var s=t._state,o=t._scope;t.getters={},t._makeLocalGettersCache=Object.create(null);var a=t._wrappedGetters,c={},l={},u=(0,i.B)(!0);u.run((function(){y(a,(function(e,n){c[n]=v(e,t),l[n]=(0,r.Fl)((function(){return c[n]()})),Object.defineProperty(t.getters,n,{get:function(){return l[n].value},enumerable:!0})}))})),t._state=(0,i.qj)({data:e}),t._scope=u,t.strict&&N(t),s&&n&&t._withCommit((function(){s.data=null})),o&&o.stop()}function A(t,e,n,r,i){var s=!n.length,o=t._modules.getNamespace(n);if(r.namespaced&&(t._modulesNamespaceMap[o],t._modulesNamespaceMap[o]=r),!s&&!i){var a=D(e,n.slice(0,-1)),c=n[n.length-1];t._withCommit((function(){a[c]=r.state}))}var l=r.context=C(t,o,n);r.forEachMutation((function(e,n){var r=o+n;T(t,r,e,l)})),r.forEachAction((function(e,n){var r=e.root?n:o+n,i=e.handler||e;k(t,r,i,l)})),r.forEachGetter((function(e,n){var r=o+n;R(t,r,e,l)})),r.forEachChild((function(r,s){A(t,e,n.concat(s),r,i)}))}function C(t,e,n){var r=""===e,i={dispatch:r?t.dispatch:function(n,r,i){var s=O(n,r,i),o=s.payload,a=s.options,c=s.type;return a&&a.root||(c=e+c),t.dispatch(c,o)},commit:r?t.commit:function(n,r,i){var s=O(n,r,i),o=s.payload,a=s.options,c=s.type;a&&a.root||(c=e+c),t.commit(c,o,a)}};return Object.defineProperties(i,{getters:{get:r?function(){return t.getters}:function(){return I(t,e)}},state:{get:function(){return D(t.state,n)}}}),i}function I(t,e){if(!t._makeLocalGettersCache[e]){var n={},r=e.length;Object.keys(t.getters).forEach((function(i){if(i.slice(0,r)===e){var s=i.slice(r);Object.defineProperty(n,s,{get:function(){return t.getters[i]},enumerable:!0})}})),t._makeLocalGettersCache[e]=n}return t._makeLocalGettersCache[e]}function T(t,e,n,r){var i=t._mutations[e]||(t._mutations[e]=[]);i.push((function(e){n.call(t,r.state,e)}))}function k(t,e,n,r){var i=t._actions[e]||(t._actions[e]=[]);i.push((function(e){var i=n.call(t,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:t.getters,rootState:t.state},e);return b(i)||(i=Promise.resolve(i)),t._devtoolHook?i.catch((function(e){throw t._devtoolHook.emit("vuex:error",e),e})):i}))}function R(t,e,n,r){t._wrappedGetters[e]||(t._wrappedGetters[e]=function(t){return n(r.state,r.getters,t.state,t.getters)})}function N(t){(0,r.YP)((function(){return t._state.data}),(function(){0}),{deep:!0,flush:"sync"})}function D(t,e){return e.reduce((function(t,e){return t[e]}),t)}function O(t,e,n){return w(t)&&t.type&&(n=e,e=t,t=t.type),{type:t,payload:e,options:n}}var P="vuex bindings",x="vuex:mutations",M="vuex:actions",L="vuex",B=0;function U(t,e){g({id:"org.vuejs.vuex",app:t,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[P]},(function(n){n.addTimelineLayer({id:x,label:"Vuex Mutations",color:F}),n.addTimelineLayer({id:M,label:"Vuex Actions",color:F}),n.addInspector({id:L,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree((function(n){if(n.app===t&&n.inspectorId===L)if(n.filter){var r=[];K(r,e._modules.root,n.filter,""),n.rootNodes=r}else n.rootNodes=[$(e._modules.root,"")]})),n.on.getInspectorState((function(n){if(n.app===t&&n.inspectorId===L){var r=n.nodeId;I(e,r),n.state=G(W(e._modules,r),"root"===r?e.getters:e._makeLocalGettersCache,r)}})),n.on.editInspectorState((function(n){if(n.app===t&&n.inspectorId===L){var r=n.nodeId,i=n.path;"root"!==r&&(i=r.split("/").filter(Boolean).concat(i)),e._withCommit((function(){n.set(e._state.data,i,n.state.value)}))}})),e.subscribe((function(t,e){var r={};t.payload&&(r.payload=t.payload),r.state=e,n.notifyComponentUpdate(),n.sendInspectorTree(L),n.sendInspectorState(L),n.addTimelineEvent({layerId:x,event:{time:Date.now(),title:t.type,data:r}})})),e.subscribeAction({before:function(t,e){var r={};t.payload&&(r.payload=t.payload),t._id=B++,t._time=Date.now(),r.state=e,n.addTimelineEvent({layerId:M,event:{time:t._time,title:t.type,groupId:t._id,subtitle:"start",data:r}})},after:function(t,e){var r={},i=Date.now()-t._time;r.duration={_custom:{type:"duration",display:i+"ms",tooltip:"Action duration",value:i}},t.payload&&(r.payload=t.payload),r.state=e,n.addTimelineEvent({layerId:M,event:{time:Date.now(),title:t.type,groupId:t._id,subtitle:"end",data:r}})}})}))}var F=8702998,z=6710886,V=16777215,j={label:"namespaced",textColor:V,backgroundColor:z};function H(t){return t&&"root"!==t?t.split("/").slice(-2,-1)[0]:"Root"}function $(t,e){return{id:e||"root",label:H(e),tags:t.namespaced?[j]:[],children:Object.keys(t._children).map((function(n){return $(t._children[n],e+n+"/")}))}}function K(t,e,n,r){r.includes(n)&&t.push({id:r||"root",label:r.endsWith("/")?r.slice(0,r.length-1):r||"Root",tags:e.namespaced?[j]:[]}),Object.keys(e._children).forEach((function(i){K(t,e._children[i],n,r+i+"/")}))}function G(t,e,n){e="root"===n?e:e[n];var r=Object.keys(e),i={state:Object.keys(t.state).map((function(e){return{key:e,editable:!0,value:t.state[e]}}))};if(r.length){var s=q(e);i.getters=Object.keys(s).map((function(t){return{key:t.endsWith("/")?H(t):t,editable:!1,value:Y((function(){return s[t]}))}}))}return i}function q(t){var e={};return Object.keys(t).forEach((function(n){var r=n.split("/");if(r.length>1){var i=e,s=r.pop();r.forEach((function(t){i[t]||(i[t]={_custom:{value:{},display:t,tooltip:"Module",abstract:!0}}),i=i[t]._custom.value})),i[s]=Y((function(){return t[n]}))}else e[n]=Y((function(){return t[n]}))})),e}function W(t,e){var n=e.split("/").filter((function(t){return t}));return n.reduce((function(t,r,i){var s=t[r];if(!s)throw new Error('Missing module "'+r+'" for path "'+e+'".');return i===n.length-1?s:s._children}),"root"===e?t:t.root._children)}function Y(t){try{return t()}catch(e){return e}}var X=function(t,e){this.runtime=e,this._children=Object.create(null),this._rawModule=t;var n=t.state;this.state=("function"===typeof n?n():n)||{}},Q={namespaced:{configurable:!0}};Q.namespaced.get=function(){return!!this._rawModule.namespaced},X.prototype.addChild=function(t,e){this._children[t]=e},X.prototype.removeChild=function(t){delete this._children[t]},X.prototype.getChild=function(t){return this._children[t]},X.prototype.hasChild=function(t){return t in this._children},X.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)},X.prototype.forEachChild=function(t){y(this._children,t)},X.prototype.forEachGetter=function(t){this._rawModule.getters&&y(this._rawModule.getters,t)},X.prototype.forEachAction=function(t){this._rawModule.actions&&y(this._rawModule.actions,t)},X.prototype.forEachMutation=function(t){this._rawModule.mutations&&y(this._rawModule.mutations,t)},Object.defineProperties(X.prototype,Q);var J=function(t){this.register([],t,!1)};function Z(t,e,n){if(e.update(n),n.modules)for(var r in n.modules){if(!e.getChild(r))return void 0;Z(t.concat(r),e.getChild(r),n.modules[r])}}J.prototype.get=function(t){return t.reduce((function(t,e){return t.getChild(e)}),this.root)},J.prototype.getNamespace=function(t){var e=this.root;return t.reduce((function(t,n){return e=e.getChild(n),t+(e.namespaced?n+"/":"")}),"")},J.prototype.update=function(t){Z([],this.root,t)},J.prototype.register=function(t,e,n){var r=this;void 0===n&&(n=!0);var i=new X(e,n);if(0===t.length)this.root=i;else{var s=this.get(t.slice(0,-1));s.addChild(t[t.length-1],i)}e.modules&&y(e.modules,(function(e,i){r.register(t.concat(i),e,n)}))},J.prototype.unregister=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1],r=e.getChild(n);r&&r.runtime&&e.removeChild(n)},J.prototype.isRegistered=function(t){var e=this.get(t.slice(0,-1)),n=t[t.length-1];return!!e&&e.hasChild(n)};function tt(t){return new et(t)}var et=function(t){var e=this;void 0===t&&(t={});var n=t.plugins;void 0===n&&(n=[]);var r=t.strict;void 0===r&&(r=!1);var i=t.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new J(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=i;var s=this,o=this,a=o.dispatch,c=o.commit;this.dispatch=function(t,e){return a.call(s,t,e)},this.commit=function(t,e,n){return c.call(s,t,e,n)},this.strict=r;var l=this._modules.root.state;A(this,l,[],this._modules.root),S(this,l),n.forEach((function(t){return t(e)}))},nt={state:{configurable:!0}};et.prototype.install=function(t,e){t.provide(e||m,this),t.config.globalProperties.$store=this;var n=void 0!==this._devtools&&this._devtools;n&&U(t,this)},nt.state.get=function(){return this._state.data},nt.state.set=function(t){0},et.prototype.commit=function(t,e,n){var r=this,i=O(t,e,n),s=i.type,o=i.payload,a=(i.options,{type:s,payload:o}),c=this._mutations[s];c&&(this._withCommit((function(){c.forEach((function(t){t(o)}))})),this._subscribers.slice().forEach((function(t){return t(a,r.state)})))},et.prototype.dispatch=function(t,e){var n=this,r=O(t,e),i=r.type,s=r.payload,o={type:i,payload:s},a=this._actions[i];if(a){try{this._actionSubscribers.slice().filter((function(t){return t.before})).forEach((function(t){return t.before(o,n.state)}))}catch(l){0}var c=a.length>1?Promise.all(a.map((function(t){return t(s)}))):a[0](s);return new Promise((function(t,e){c.then((function(e){try{n._actionSubscribers.filter((function(t){return t.after})).forEach((function(t){return t.after(o,n.state)}))}catch(l){0}t(e)}),(function(t){try{n._actionSubscribers.filter((function(t){return t.error})).forEach((function(e){return e.error(o,n.state,t)}))}catch(l){0}e(t)}))}))}},et.prototype.subscribe=function(t,e){return E(t,this._subscribers,e)},et.prototype.subscribeAction=function(t,e){var n="function"===typeof t?{before:t}:t;return E(n,this._actionSubscribers,e)},et.prototype.watch=function(t,e,n){var i=this;return(0,r.YP)((function(){return t(i.state,i.getters)}),e,Object.assign({},n))},et.prototype.replaceState=function(t){var e=this;this._withCommit((function(){e._state.data=t}))},et.prototype.registerModule=function(t,e,n){void 0===n&&(n={}),"string"===typeof t&&(t=[t]),this._modules.register(t,e),A(this,this.state,t,this._modules.get(t),n.preserveState),S(this,this.state)},et.prototype.unregisterModule=function(t){var e=this;"string"===typeof t&&(t=[t]),this._modules.unregister(t),this._withCommit((function(){var n=D(e.state,t.slice(0,-1));delete n[t[t.length-1]]})),_(this)},et.prototype.hasModule=function(t){return"string"===typeof t&&(t=[t]),this._modules.isRegistered(t)},et.prototype.hotUpdate=function(t){this._modules.update(t),_(this,!0)},et.prototype._withCommit=function(t){var e=this._committing;this._committing=!0,t(),this._committing=e},Object.defineProperties(et.prototype,nt);st((function(t,e){var n={};return rt(e).forEach((function(e){var r=e.key,i=e.val;n[r]=function(){var e=this.$store.state,n=this.$store.getters;if(t){var r=ot(this.$store,"mapState",t);if(!r)return;e=r.context.state,n=r.context.getters}return"function"===typeof i?i.call(this,e,n):e[i]},n[r].vuex=!0})),n})),st((function(t,e){var n={};return rt(e).forEach((function(e){var r=e.key,i=e.val;n[r]=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=this.$store.commit;if(t){var s=ot(this.$store,"mapMutations",t);if(!s)return;r=s.context.commit}return"function"===typeof i?i.apply(this,[r].concat(e)):r.apply(this.$store,[i].concat(e))}})),n})),st((function(t,e){var n={};return rt(e).forEach((function(e){var r=e.key,i=e.val;i=t+i,n[r]=function(){if(!t||ot(this.$store,"mapGetters",t))return this.$store.getters[i]},n[r].vuex=!0})),n})),st((function(t,e){var n={};return rt(e).forEach((function(e){var r=e.key,i=e.val;n[r]=function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=this.$store.dispatch;if(t){var s=ot(this.$store,"mapActions",t);if(!s)return;r=s.context.dispatch}return"function"===typeof i?i.apply(this,[r].concat(e)):r.apply(this.$store,[i].concat(e))}})),n}));function rt(t){return it(t)?Array.isArray(t)?t.map((function(t){return{key:t,val:t}})):Object.keys(t).map((function(e){return{key:e,val:t[e]}})):[]}function it(t){return Array.isArray(t)||w(t)}function st(t){return function(e,n){return"string"!==typeof e?(n=e,e=""):"/"!==e.charAt(e.length-1)&&(e+="/"),t(e,n)}}function ot(t,e,n){var r=t._modulesNamespaceMap[n];return r}},4727:function(t,e,n){"use strict";t.exports=n.p+"img/remixicon.symbol.230157b7.svg"},4581:function(t,e,n){"use strict";var r,i,s;(function(o,a){i=[n(9145)],r=a,s="function"===typeof r?r.apply(e,i):r,void 0===s||(t.exports=s)})(0,(function(t){var e=t.Reader,n=t.Writer,r=t.util,i=t.roots["default"]||(t.roots["default"]={});return i.RPC=function(){function s(t){if(this.subscriptions=[],this.messages=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.subscriptions=r.emptyArray,s.prototype.messages=r.emptyArray,s.prototype.control=null,Object.defineProperty(s.prototype,"_control",{get:r.oneOfGetter(o=["control"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){if(e||(e=n.create()),null!=t.subscriptions&&t.subscriptions.length)for(var r=0;r<t.subscriptions.length;++r)i.RPC.SubOpts.encode(t.subscriptions[r],e.uint32(10).fork()).ldelim();if(null!=t.messages&&t.messages.length)for(r=0;r<t.messages.length;++r)i.RPC.Message.encode(t.messages[r],e.uint32(18).fork()).ldelim();return null!=t.control&&Object.hasOwnProperty.call(t,"control")&&i.RPC.ControlMessage.encode(t.control,e.uint32(26).fork()).ldelim(),e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.subscriptions&&s.subscriptions.length||(s.subscriptions=[]),s.subscriptions.push(i.RPC.SubOpts.decode(t,t.uint32()));break;case 2:s.messages&&s.messages.length||(s.messages=[]),s.messages.push(i.RPC.Message.decode(t,t.uint32()));break;case 3:s.control=i.RPC.ControlMessage.decode(t,t.uint32());break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC)return t;var e=new i.RPC;if(t.subscriptions){if(!Array.isArray(t.subscriptions))throw TypeError(".RPC.subscriptions: array expected");e.subscriptions=[];for(var n=0;n<t.subscriptions.length;++n){if("object"!==typeof t.subscriptions[n])throw TypeError(".RPC.subscriptions: object expected");e.subscriptions[n]=i.RPC.SubOpts.fromObject(t.subscriptions[n])}}if(t.messages){if(!Array.isArray(t.messages))throw TypeError(".RPC.messages: array expected");e.messages=[];for(n=0;n<t.messages.length;++n){if("object"!==typeof t.messages[n])throw TypeError(".RPC.messages: object expected");e.messages[n]=i.RPC.Message.fromObject(t.messages[n])}}if(null!=t.control){if("object"!==typeof t.control)throw TypeError(".RPC.control: object expected");e.control=i.RPC.ControlMessage.fromObject(t.control)}return e},s.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.subscriptions=[],n.messages=[]),t.subscriptions&&t.subscriptions.length){n.subscriptions=[];for(var r=0;r<t.subscriptions.length;++r)n.subscriptions[r]=i.RPC.SubOpts.toObject(t.subscriptions[r],e)}if(t.messages&&t.messages.length){n.messages=[];for(r=0;r<t.messages.length;++r)n.messages[r]=i.RPC.Message.toObject(t.messages[r],e)}return null!=t.control&&t.hasOwnProperty("control")&&(n.control=i.RPC.ControlMessage.toObject(t.control,e),e.oneofs&&(n._control="control")),n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s.SubOpts=function(){function s(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.subscribe=null,s.prototype.topic=null,Object.defineProperty(s.prototype,"_subscribe",{get:r.oneOfGetter(o=["subscribe"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_topic",{get:r.oneOfGetter(o=["topic"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){return e||(e=n.create()),null!=t.subscribe&&Object.hasOwnProperty.call(t,"subscribe")&&e.uint32(8).bool(t.subscribe),null!=t.topic&&Object.hasOwnProperty.call(t,"topic")&&e.uint32(18).string(t.topic),e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.SubOpts;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.subscribe=t.bool();break;case 2:s.topic=t.string();break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.SubOpts)return t;var e=new i.RPC.SubOpts;return null!=t.subscribe&&(e.subscribe=Boolean(t.subscribe)),null!=t.topic&&(e.topic=String(t.topic)),e},s.toObject=function(t,e){e||(e={});var n={};return null!=t.subscribe&&t.hasOwnProperty("subscribe")&&(n.subscribe=t.subscribe,e.oneofs&&(n._subscribe="subscribe")),null!=t.topic&&t.hasOwnProperty("topic")&&(n.topic=t.topic,e.oneofs&&(n._topic="topic")),n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.Message=function(){function s(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.from=null,s.prototype.data=null,s.prototype.seqno=null,s.prototype.topic="",s.prototype.signature=null,s.prototype.key=null,Object.defineProperty(s.prototype,"_from",{get:r.oneOfGetter(o=["from"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_data",{get:r.oneOfGetter(o=["data"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_seqno",{get:r.oneOfGetter(o=["seqno"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_signature",{get:r.oneOfGetter(o=["signature"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_key",{get:r.oneOfGetter(o=["key"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){return e||(e=n.create()),null!=t.from&&Object.hasOwnProperty.call(t,"from")&&e.uint32(10).bytes(t.from),null!=t.data&&Object.hasOwnProperty.call(t,"data")&&e.uint32(18).bytes(t.data),null!=t.seqno&&Object.hasOwnProperty.call(t,"seqno")&&e.uint32(26).bytes(t.seqno),e.uint32(34).string(t.topic),null!=t.signature&&Object.hasOwnProperty.call(t,"signature")&&e.uint32(42).bytes(t.signature),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(50).bytes(t.key),e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var s=void 0===n?t.len:t.pos+n,o=new i.RPC.Message;while(t.pos<s){var a=t.uint32();switch(a>>>3){case 1:o.from=t.bytes();break;case 2:o.data=t.bytes();break;case 3:o.seqno=t.bytes();break;case 4:o.topic=t.string();break;case 5:o.signature=t.bytes();break;case 6:o.key=t.bytes();break;default:t.skipType(7&a);break}}if(!o.hasOwnProperty("topic"))throw r.ProtocolError("missing required 'topic'",{instance:o});return o},s.fromObject=function(t){if(t instanceof i.RPC.Message)return t;var e=new i.RPC.Message;return null!=t.from&&("string"===typeof t.from?r.base64.decode(t.from,e.from=r.newBuffer(r.base64.length(t.from)),0):t.from.length&&(e.from=t.from)),null!=t.data&&("string"===typeof t.data?r.base64.decode(t.data,e.data=r.newBuffer(r.base64.length(t.data)),0):t.data.length&&(e.data=t.data)),null!=t.seqno&&("string"===typeof t.seqno?r.base64.decode(t.seqno,e.seqno=r.newBuffer(r.base64.length(t.seqno)),0):t.seqno.length&&(e.seqno=t.seqno)),null!=t.topic&&(e.topic=String(t.topic)),null!=t.signature&&("string"===typeof t.signature?r.base64.decode(t.signature,e.signature=r.newBuffer(r.base64.length(t.signature)),0):t.signature.length&&(e.signature=t.signature)),null!=t.key&&("string"===typeof t.key?r.base64.decode(t.key,e.key=r.newBuffer(r.base64.length(t.key)),0):t.key.length&&(e.key=t.key)),e},s.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.topic=""),null!=t.from&&t.hasOwnProperty("from")&&(n.from=e.bytes===String?r.base64.encode(t.from,0,t.from.length):e.bytes===Array?Array.prototype.slice.call(t.from):t.from,e.oneofs&&(n._from="from")),null!=t.data&&t.hasOwnProperty("data")&&(n.data=e.bytes===String?r.base64.encode(t.data,0,t.data.length):e.bytes===Array?Array.prototype.slice.call(t.data):t.data,e.oneofs&&(n._data="data")),null!=t.seqno&&t.hasOwnProperty("seqno")&&(n.seqno=e.bytes===String?r.base64.encode(t.seqno,0,t.seqno.length):e.bytes===Array?Array.prototype.slice.call(t.seqno):t.seqno,e.oneofs&&(n._seqno="seqno")),null!=t.topic&&t.hasOwnProperty("topic")&&(n.topic=t.topic),null!=t.signature&&t.hasOwnProperty("signature")&&(n.signature=e.bytes===String?r.base64.encode(t.signature,0,t.signature.length):e.bytes===Array?Array.prototype.slice.call(t.signature):t.signature,e.oneofs&&(n._signature="signature")),null!=t.key&&t.hasOwnProperty("key")&&(n.key=e.bytes===String?r.base64.encode(t.key,0,t.key.length):e.bytes===Array?Array.prototype.slice.call(t.key):t.key,e.oneofs&&(n._key="key")),n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.ControlMessage=function(){function s(t){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return s.prototype.ihave=r.emptyArray,s.prototype.iwant=r.emptyArray,s.prototype.graft=r.emptyArray,s.prototype.prune=r.emptyArray,s.encode=function(t,e){if(e||(e=n.create()),null!=t.ihave&&t.ihave.length)for(var r=0;r<t.ihave.length;++r)i.RPC.ControlIHave.encode(t.ihave[r],e.uint32(10).fork()).ldelim();if(null!=t.iwant&&t.iwant.length)for(r=0;r<t.iwant.length;++r)i.RPC.ControlIWant.encode(t.iwant[r],e.uint32(18).fork()).ldelim();if(null!=t.graft&&t.graft.length)for(r=0;r<t.graft.length;++r)i.RPC.ControlGraft.encode(t.graft[r],e.uint32(26).fork()).ldelim();if(null!=t.prune&&t.prune.length)for(r=0;r<t.prune.length;++r)i.RPC.ControlPrune.encode(t.prune[r],e.uint32(34).fork()).ldelim();return e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.ControlMessage;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.ihave&&s.ihave.length||(s.ihave=[]),s.ihave.push(i.RPC.ControlIHave.decode(t,t.uint32()));break;case 2:s.iwant&&s.iwant.length||(s.iwant=[]),s.iwant.push(i.RPC.ControlIWant.decode(t,t.uint32()));break;case 3:s.graft&&s.graft.length||(s.graft=[]),s.graft.push(i.RPC.ControlGraft.decode(t,t.uint32()));break;case 4:s.prune&&s.prune.length||(s.prune=[]),s.prune.push(i.RPC.ControlPrune.decode(t,t.uint32()));break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.ControlMessage)return t;var e=new i.RPC.ControlMessage;if(t.ihave){if(!Array.isArray(t.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");e.ihave=[];for(var n=0;n<t.ihave.length;++n){if("object"!==typeof t.ihave[n])throw TypeError(".RPC.ControlMessage.ihave: object expected");e.ihave[n]=i.RPC.ControlIHave.fromObject(t.ihave[n])}}if(t.iwant){if(!Array.isArray(t.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");e.iwant=[];for(n=0;n<t.iwant.length;++n){if("object"!==typeof t.iwant[n])throw TypeError(".RPC.ControlMessage.iwant: object expected");e.iwant[n]=i.RPC.ControlIWant.fromObject(t.iwant[n])}}if(t.graft){if(!Array.isArray(t.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");e.graft=[];for(n=0;n<t.graft.length;++n){if("object"!==typeof t.graft[n])throw TypeError(".RPC.ControlMessage.graft: object expected");e.graft[n]=i.RPC.ControlGraft.fromObject(t.graft[n])}}if(t.prune){if(!Array.isArray(t.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");e.prune=[];for(n=0;n<t.prune.length;++n){if("object"!==typeof t.prune[n])throw TypeError(".RPC.ControlMessage.prune: object expected");e.prune[n]=i.RPC.ControlPrune.fromObject(t.prune[n])}}return e},s.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.ihave=[],n.iwant=[],n.graft=[],n.prune=[]),t.ihave&&t.ihave.length){n.ihave=[];for(var r=0;r<t.ihave.length;++r)n.ihave[r]=i.RPC.ControlIHave.toObject(t.ihave[r],e)}if(t.iwant&&t.iwant.length){n.iwant=[];for(r=0;r<t.iwant.length;++r)n.iwant[r]=i.RPC.ControlIWant.toObject(t.iwant[r],e)}if(t.graft&&t.graft.length){n.graft=[];for(r=0;r<t.graft.length;++r)n.graft[r]=i.RPC.ControlGraft.toObject(t.graft[r],e)}if(t.prune&&t.prune.length){n.prune=[];for(r=0;r<t.prune.length;++r)n.prune[r]=i.RPC.ControlPrune.toObject(t.prune[r],e)}return n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.ControlIHave=function(){function s(t){if(this.messageIDs=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.topicID=null,s.prototype.messageIDs=r.emptyArray,Object.defineProperty(s.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){if(e||(e=n.create()),null!=t.topicID&&Object.hasOwnProperty.call(t,"topicID")&&e.uint32(10).string(t.topicID),null!=t.messageIDs&&t.messageIDs.length)for(var r=0;r<t.messageIDs.length;++r)e.uint32(18).bytes(t.messageIDs[r]);return e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.ControlIHave;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.topicID=t.string();break;case 2:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),s.messageIDs.push(t.bytes());break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.ControlIHave)return t;var e=new i.RPC.ControlIHave;if(null!=t.topicID&&(e.topicID=String(t.topicID)),t.messageIDs){if(!Array.isArray(t.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");e.messageIDs=[];for(var n=0;n<t.messageIDs.length;++n)"string"===typeof t.messageIDs[n]?r.base64.decode(t.messageIDs[n],e.messageIDs[n]=r.newBuffer(r.base64.length(t.messageIDs[n])),0):t.messageIDs[n].length&&(e.messageIDs[n]=t.messageIDs[n])}return e},s.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.messageIDs=[]),null!=t.topicID&&t.hasOwnProperty("topicID")&&(n.topicID=t.topicID,e.oneofs&&(n._topicID="topicID")),t.messageIDs&&t.messageIDs.length){n.messageIDs=[];for(var i=0;i<t.messageIDs.length;++i)n.messageIDs[i]=e.bytes===String?r.base64.encode(t.messageIDs[i],0,t.messageIDs[i].length):e.bytes===Array?Array.prototype.slice.call(t.messageIDs[i]):t.messageIDs[i]}return n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.ControlIWant=function(){function s(t){if(this.messageIDs=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return s.prototype.messageIDs=r.emptyArray,s.encode=function(t,e){if(e||(e=n.create()),null!=t.messageIDs&&t.messageIDs.length)for(var r=0;r<t.messageIDs.length;++r)e.uint32(10).bytes(t.messageIDs[r]);return e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.ControlIWant;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.messageIDs&&s.messageIDs.length||(s.messageIDs=[]),s.messageIDs.push(t.bytes());break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.ControlIWant)return t;var e=new i.RPC.ControlIWant;if(t.messageIDs){if(!Array.isArray(t.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");e.messageIDs=[];for(var n=0;n<t.messageIDs.length;++n)"string"===typeof t.messageIDs[n]?r.base64.decode(t.messageIDs[n],e.messageIDs[n]=r.newBuffer(r.base64.length(t.messageIDs[n])),0):t.messageIDs[n].length&&(e.messageIDs[n]=t.messageIDs[n])}return e},s.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.messageIDs=[]),t.messageIDs&&t.messageIDs.length){n.messageIDs=[];for(var i=0;i<t.messageIDs.length;++i)n.messageIDs[i]=e.bytes===String?r.base64.encode(t.messageIDs[i],0,t.messageIDs[i].length):e.bytes===Array?Array.prototype.slice.call(t.messageIDs[i]):t.messageIDs[i]}return n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.ControlGraft=function(){function s(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.topicID=null,Object.defineProperty(s.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){return e||(e=n.create()),null!=t.topicID&&Object.hasOwnProperty.call(t,"topicID")&&e.uint32(10).string(t.topicID),e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.ControlGraft;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.topicID=t.string();break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.ControlGraft)return t;var e=new i.RPC.ControlGraft;return null!=t.topicID&&(e.topicID=String(t.topicID)),e},s.toObject=function(t,e){e||(e={});var n={};return null!=t.topicID&&t.hasOwnProperty("topicID")&&(n.topicID=t.topicID,e.oneofs&&(n._topicID="topicID")),n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.ControlPrune=function(){function s(t){if(this.peers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.topicID=null,s.prototype.peers=r.emptyArray,s.prototype.backoff=null,Object.defineProperty(s.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_backoff",{get:r.oneOfGetter(o=["backoff"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){if(e||(e=n.create()),null!=t.topicID&&Object.hasOwnProperty.call(t,"topicID")&&e.uint32(10).string(t.topicID),null!=t.peers&&t.peers.length)for(var r=0;r<t.peers.length;++r)i.RPC.PeerInfo.encode(t.peers[r],e.uint32(18).fork()).ldelim();return null!=t.backoff&&Object.hasOwnProperty.call(t,"backoff")&&e.uint32(24).uint64(t.backoff),e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.ControlPrune;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.topicID=t.string();break;case 2:s.peers&&s.peers.length||(s.peers=[]),s.peers.push(i.RPC.PeerInfo.decode(t,t.uint32()));break;case 3:s.backoff=t.uint64();break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.ControlPrune)return t;var e=new i.RPC.ControlPrune;if(null!=t.topicID&&(e.topicID=String(t.topicID)),t.peers){if(!Array.isArray(t.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");e.peers=[];for(var n=0;n<t.peers.length;++n){if("object"!==typeof t.peers[n])throw TypeError(".RPC.ControlPrune.peers: object expected");e.peers[n]=i.RPC.PeerInfo.fromObject(t.peers[n])}}return null!=t.backoff&&(r.Long?(e.backoff=r.Long.fromValue(t.backoff)).unsigned=!0:"string"===typeof t.backoff?e.backoff=parseInt(t.backoff,10):"number"===typeof t.backoff?e.backoff=t.backoff:"object"===typeof t.backoff&&(e.backoff=new r.LongBits(t.backoff.low>>>0,t.backoff.high>>>0).toNumber(!0))),e},s.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.peers=[]),null!=t.topicID&&t.hasOwnProperty("topicID")&&(n.topicID=t.topicID,e.oneofs&&(n._topicID="topicID")),t.peers&&t.peers.length){n.peers=[];for(var s=0;s<t.peers.length;++s)n.peers[s]=i.RPC.PeerInfo.toObject(t.peers[s],e)}return null!=t.backoff&&t.hasOwnProperty("backoff")&&("number"===typeof t.backoff?n.backoff=e.longs===String?String(t.backoff):t.backoff:n.backoff=e.longs===String?r.Long.prototype.toString.call(t.backoff):e.longs===Number?new r.LongBits(t.backoff.low>>>0,t.backoff.high>>>0).toNumber(!0):t.backoff,e.oneofs&&(n._backoff="backoff")),n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s.PeerInfo=function(){function s(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var o;return s.prototype.peerID=null,s.prototype.signedPeerRecord=null,Object.defineProperty(s.prototype,"_peerID",{get:r.oneOfGetter(o=["peerID"]),set:r.oneOfSetter(o)}),Object.defineProperty(s.prototype,"_signedPeerRecord",{get:r.oneOfGetter(o=["signedPeerRecord"]),set:r.oneOfSetter(o)}),s.encode=function(t,e){return e||(e=n.create()),null!=t.peerID&&Object.hasOwnProperty.call(t,"peerID")&&e.uint32(10).bytes(t.peerID),null!=t.signedPeerRecord&&Object.hasOwnProperty.call(t,"signedPeerRecord")&&e.uint32(18).bytes(t.signedPeerRecord),e},s.decode=function(t,n){t instanceof e||(t=e.create(t));var r=void 0===n?t.len:t.pos+n,s=new i.RPC.PeerInfo;while(t.pos<r){var o=t.uint32();switch(o>>>3){case 1:s.peerID=t.bytes();break;case 2:s.signedPeerRecord=t.bytes();break;default:t.skipType(7&o);break}}return s},s.fromObject=function(t){if(t instanceof i.RPC.PeerInfo)return t;var e=new i.RPC.PeerInfo;return null!=t.peerID&&("string"===typeof t.peerID?r.base64.decode(t.peerID,e.peerID=r.newBuffer(r.base64.length(t.peerID)),0):t.peerID.length&&(e.peerID=t.peerID)),null!=t.signedPeerRecord&&("string"===typeof t.signedPeerRecord?r.base64.decode(t.signedPeerRecord,e.signedPeerRecord=r.newBuffer(r.base64.length(t.signedPeerRecord)),0):t.signedPeerRecord.length&&(e.signedPeerRecord=t.signedPeerRecord)),e},s.toObject=function(t,e){e||(e={});var n={};return null!=t.peerID&&t.hasOwnProperty("peerID")&&(n.peerID=e.bytes===String?r.base64.encode(t.peerID,0,t.peerID.length):e.bytes===Array?Array.prototype.slice.call(t.peerID):t.peerID,e.oneofs&&(n._peerID="peerID")),null!=t.signedPeerRecord&&t.hasOwnProperty("signedPeerRecord")&&(n.signedPeerRecord=e.bytes===String?r.base64.encode(t.signedPeerRecord,0,t.signedPeerRecord.length):e.bytes===Array?Array.prototype.slice.call(t.signedPeerRecord):t.signedPeerRecord,e.oneofs&&(n._signedPeerRecord="signedPeerRecord")),n},s.prototype.toJSON=function(){return this.constructor.toObject(this,t.util.toJSONOptions)},s}(),s}(),i}))},1901:function(t){(function(){t.exports=m;var e=86400,n=3200,r=146097*n/400,i=e*r,s=1e3*i,o=864e13,a=4294967296,c=1e6,l="000000000",u=Math.trunc||function(t){var e=t-t%1;return 0==e&&(t<0||0===t&&1/t!=1/0)?-0:e},h=m.prototype,d=(m.fromDate=function(t){return new m(+t)},m.fromInt64BE=E(0,1,2,3,0,4),m.fromInt64LE=E(3,2,1,0,4,0),m.fromString=function(t){var e,n=new m;t=(t+="").replace(/^\s*[+\-]?\d+/,(function(t){t=+t;var e=1970+(t-1970)%400;return n.year=t-e,e})).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,(function(t,n,r){return n<0&&(r*=-1),e=6e4*(60*+n+ +r),""})).replace(/\.\d+$/,(function(t){return n.nano=+(t+l).substr(1,9),""})).split(/\D+/);if(1<t.length?t[1]--:t[1]=0,n.time=e=Date.UTC.apply(Date,t)-(e||0),isNaN(e))throw new TypeError("Invalid Date");return y(n)},m.fromTimeT=function(t){return b(t,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(t){return this.nano+=+t||0,this},h.getNano=function(){var t=y(this);return(t.time%1e3*c+ +t.nano+1e9)%1e9},h.getTimeT=function(){var t=y(this),i=Math.floor(t.time/1e3);t=t.year;return t&&(i+=t*r*e/n),i},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return w(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(t){var e=this,n=e.toDate(),r={H:function(){return S(n.getUTCHours())},L:function(){return A(n.getUTCMilliseconds(),3)},M:function(){return S(n.getUTCMinutes())},N:function(){return A(e.getNano(),9)},S:function(){return S(n.getUTCSeconds())},Y:function(){var t=e.getYear();return 999999<t?"+"+t:9999<t?"+"+A(t,6):0<=t?A(t,4):-999999<=t?"-"+A(-t,6):t},a:function(){return p[n.getUTCDay()]},b:function(){return f[n.getUTCMonth()]},d:function(){return S(n.getUTCDate())},e:function(){return function(t){return(9<t?"":" ")+(0|t)}(n.getUTCDate())},m:function(){return S(n.getUTCMonth()+1)}};return function t(e){return e.replace(/%./g,(function(e){var n=e[1],i=g[n];n=r[n];return i?t(i):n?n():e}))}(t||d)},h.writeInt64BE=v(0,1,2,3,0,4),h.writeInt64LE=v(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],p=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"\t",X:"%T",Z:"GMT",z:"+0000"};return m;function m(t,e,n){var r=this;if(!(r instanceof m))return new m(t,e,n);r.time=+t||0,r.nano=+e||0,r.year=+n||0,y(r)}function y(t){var e,r,i,a=t.year,l=t.time,h=t.nano,d=((h<0||c<=h)&&(h-=(r=Math.floor(h/c))*c,l+=r,r=1),a%n);return(l<-o||o<l||d)&&((e=u(l/s))&&(a+=e*n,l-=e*s),(i=w(l)).setUTCFullYear(d+i.getUTCFullYear()),i=(l=+i)+(e=u((a-=d)/n))*s,e&&-o<=i&&i<=o&&(a-=e*n,l=i),r=1),r&&(t.year=a,t.time=l,t.nano=h),t}function w(t){var e=new Date(0);return e.setTime(t),e}function b(t,e){t=+t||0;var r=u((e=(0|e)*a)/i)+u(t/i);e=e%i+t%i,t=u(e/i);return t&&(r+=t,e-=t*i),new m(1e3*e,0,r*n)}function v(t,i,s,o,c,l){return function(t,i){var s=y(this);t=t||new Array(8),_(t,i|=0);var o=Math.floor(s.time/1e3),d=(s=s.year*(r*e/n),u(s/a)+u(o/a));s=s%a+o%a,o=Math.floor(s/a);return o&&(d+=o,s-=o*a),h(t,i+c,d),h(t,i+l,s),t};function h(e,n,r){e[n+t]=r>>24&255,e[n+i]=r>>16&255,e[n+s]=r>>8&255,e[n+o]=255&r}}function E(t,e,n,r,i,s){return function(t,e){_(t,e|=0);var n=o(t,e+i);return b(o(t,e+s),n)};function o(i,s){return 16777216*i[s+t]+(i[s+e]<<16|i[s+n]<<8|i[s+r])}}function _(t,e){if(t=t&&t.length,null==t)throw new TypeError("Invalid Buffer");if(t<e+8)throw new RangeError("Out of range")}function S(t){return(9<t?"":"0")+(0|t)}function A(t,e){return(l+(0|t)).substr(-e)}})()},2039:function(t,e,n){"use strict";n.d(e,{Ue:function(){return H6}});var r={};n.r(r),n.d(r,{base58btc:function(){return Ct},base58flickr:function(){return It}});var i={};n.r(i),n.d(i,{base32:function(){return Tt},base32hex:function(){return Dt},base32hexpad:function(){return Pt},base32hexpadupper:function(){return xt},base32hexupper:function(){return Ot},base32pad:function(){return Rt},base32padupper:function(){return Nt},base32upper:function(){return kt},base32z:function(){return Mt}});var s={};n.r(s),n.d(s,{base64:function(){return Lt},base64pad:function(){return Bt},base64url:function(){return Ut},base64urlpad:function(){return Ft}});var o={};n.r(o),n.d(o,{code:function(){return wn},createLink:function(){return mn},createNode:function(){return gn},decode:function(){return vn},encode:function(){return bn},name:function(){return yn},prepare:function(){return fn},validate:function(){return pn}});var a={};n.r(a),n.d(a,{code:function(){return Ji},decode:function(){return ts},encode:function(){return Zi},name:function(){return Qi}});var c={};n.r(c),n.d(c,{code:function(){return ys},decode:function(){return bs},encode:function(){return ws},format:function(){return vs},name:function(){return ms},parse:function(){return _s},stringify:function(){return vs}});var l={};n.r(l),n.d(l,{code:function(){return Bs},decode:function(){return $s},encode:function(){return Hs},name:function(){return Ls},toGeneral:function(){return js}});var u={};n.r(u),n.d(u,{identity:function(){return Ys}});var h={};n.r(h),n.d(h,{identity:function(){return Xs}});var d={};n.r(d),n.d(d,{base2:function(){return Qs}});var f={};n.r(f),n.d(f,{base8:function(){return Js}});var p={};n.r(p),n.d(p,{base10:function(){return Zs}});var g={};n.r(g),n.d(g,{base16:function(){return to},base16upper:function(){return eo}});var m={};n.r(m),n.d(m,{base36:function(){return no},base36upper:function(){return ro}});var y={};n.r(y),n.d(y,{base256emoji:function(){return lo}});var w={};n.r(w),n.d(w,{sha256:function(){return ho},sha512:function(){return fo}});var b={};n.r(b),n.d(b,{code:function(){return go},decode:function(){return yo},encode:function(){return mo},name:function(){return po}});var v={};n.r(v),n.d(v,{code:function(){return Eo},decode:function(){return So},encode:function(){return _o},name:function(){return vo}});var E={};n.r(E),n.d(E,{RsaPrivateKey:function(){return hf},RsaPublicKey:function(){return uf},fromJwk:function(){return pf},generateKeyPair:function(){return gf},unmarshalRsaPrivateKey:function(){return df},unmarshalRsaPublicKey:function(){return ff}});var _={};n.r(_),n.d(_,{Ed25519PrivateKey:function(){return Cp},Ed25519PublicKey:function(){return Ap},generateKeyPair:function(){return kp},generateKeyPairFromSeed:function(){return Rp},unmarshalEd25519PrivateKey:function(){return Ip},unmarshalEd25519PublicKey:function(){return Tp}});var S={};n.r(S),n.d(S,{Secp256k1PrivateKey:function(){return Fp},Secp256k1PublicKey:function(){return Up},generateKeyPair:function(){return jp},unmarshalSecp256k1PrivateKey:function(){return zp},unmarshalSecp256k1PublicKey:function(){return Vp}});var A={};n.r(A),n.d(A,{InvalidValueError:function(){return oP},MissingRepoOptionsError:function(){return aP},NonReversibleMigrationError:function(){return rP},NotInitializedRepoError:function(){return iP},RequiredParameterError:function(){return sP}});var C={};n.r(C),n.d(C,{identity:function(){return SL}});var I={};n.r(I),n.d(I,{base2:function(){return AL}});var T={};n.r(T),n.d(T,{base8:function(){return CL}});var k={};n.r(k),n.d(k,{base10:function(){return IL}});var R={};n.r(R),n.d(R,{base16:function(){return TL},base16upper:function(){return kL}});var N={};n.r(N),n.d(N,{base32:function(){return RL},base32hex:function(){return PL},base32hexpad:function(){return ML},base32hexpadupper:function(){return LL},base32hexupper:function(){return xL},base32pad:function(){return DL},base32padupper:function(){return OL},base32upper:function(){return NL},base32z:function(){return BL}});var D={};n.r(D),n.d(D,{base36:function(){return UL},base36upper:function(){return FL}});var O={};n.r(O),n.d(O,{base58btc:function(){return zL},base58flickr:function(){return VL}});var P={};n.r(P),n.d(P,{base64:function(){return jL},base64pad:function(){return HL},base64url:function(){return $L},base64urlpad:function(){return KL}});var x={};n.r(x),n.d(x,{base256emoji:function(){return QL}});var M={};n.r(M),n.d(M,{sha256:function(){return kB},sha512:function(){return RB}});var L={};n.r(L),n.d(L,{identity:function(){return xB}});var B={};n.r(B),n.d(B,{code:function(){return LB},decode:function(){return UB},encode:function(){return BB},name:function(){return MB}});var U={};n.r(U),n.d(U,{code:function(){return jB},decode:function(){return $B},encode:function(){return HB},name:function(){return VB}});var F={};n.r(F),n.d(F,{identity:function(){return hF}});var z={};n.r(z),n.d(z,{base2:function(){return dF}});var V={};n.r(V),n.d(V,{base8:function(){return fF}});var j={};n.r(j),n.d(j,{base10:function(){return pF}});var H={};n.r(H),n.d(H,{base16:function(){return gF},base16upper:function(){return mF}});var $={};n.r($),n.d($,{base32:function(){return yF},base32hex:function(){return EF},base32hexpad:function(){return SF},base32hexpadupper:function(){return AF},base32hexupper:function(){return _F},base32pad:function(){return bF},base32padupper:function(){return vF},base32upper:function(){return wF},base32z:function(){return CF}});var K={};n.r(K),n.d(K,{base36:function(){return IF},base36upper:function(){return TF}});var G={};n.r(G),n.d(G,{base58btc:function(){return kF},base58flickr:function(){return RF}});var q={};n.r(q),n.d(q,{base64:function(){return NF},base64pad:function(){return DF},base64url:function(){return OF},base64urlpad:function(){return PF}});var W={};n.r(W),n.d(W,{base256emoji:function(){return FF}});var Y={};n.r(Y),n.d(Y,{sha256:function(){return mz},sha512:function(){return yz}});var X={};n.r(X),n.d(X,{identity:function(){return _z}});var Q={};n.r(Q),n.d(Q,{code:function(){return Az},decode:function(){return Iz},encode:function(){return Cz},name:function(){return Sz}});var J={};n.r(J),n.d(J,{code:function(){return Nz},decode:function(){return Oz},encode:function(){return Dz},name:function(){return Rz}});var Z={};n.r(Z),n.d(Z,{Decoder:function(){return qG},Encoder:function(){return GG},PacketType:function(){return KG},protocol:function(){return $G}});var tt={};n.r(tt),n.d(tt,{abortedError:function(){return y6},notFoundError:function(){return m6}});n(7658);var et=n(9610),nt=et,rt=n(6338),it=n(2978);n(3767),n(8585),n(8696);function st(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";var n=0,r=0,i=0,s=e.length;while(i!==s&&0===e[i])i++,n++;var o=(s-i)*u+1>>>0,l=new Uint8Array(o);while(i!==s){for(var h=e[i],d=0,f=o-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}var p=o-r;while(p!==o&&0===l[p])p++;for(var g=c.repeat(n);p<o;++p)g+=t.charAt(l[p]);return g}function d(t){if("string"!==typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;var e=0;if(" "!==t[e]){var r=0,i=0;while(t[e]===c)r++,e++;var s=(t.length-e)*l+1>>>0,o=new Uint8Array(s);while(t[e]){var u=n[t.charCodeAt(e)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,e++}if(" "!==t[e]){var f=s-i;while(f!==s&&0===o[f])f++;var p=new Uint8Array(r+(s-f)),g=r;while(f!==s)p[g++]=o[f++];return p}}}function f(t){var n=d(t);if(n)return n;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var ot=st,at=ot,ct=at;const lt=new Uint8Array(0),ut=t=>{const e=t.match(/../g);return e?new Uint8Array(e.map((t=>parseInt(t,16)))):lt},ht=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0},dt=t=>{if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ft=t=>(new TextEncoder).encode(t),pt=t=>(new TextDecoder).decode(t);class gt{constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class mt{constructor(t,e,n){if(this.name=t,this.prefix=e,void 0===e.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=n}decode(t){if("string"===typeof t){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(t){return wt(this,t)}}class yt{constructor(t){this.decoders=t}or(t){return wt(this,t)}decode(t){const e=t[0],n=this.decoders[e];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const wt=(t,e)=>new yt({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class bt{constructor(t,e,n,r){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=r,this.encoder=new gt(t,e,n),this.decoder=new mt(t,e,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const vt=({name:t,prefix:e,encode:n,decode:r})=>new bt(t,e,n,r),Et=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=ct(n,e);return vt({prefix:t,name:e,encode:r,decode:t=>dt(i(t))})},_t=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;while("="===t[s-1])--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const e=i[t[u]];if(void 0===e)throw new SyntaxError(`Non-${r} character`);c=c<<n|e,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},St=(t,e,n)=>{const r="="===e[e.length-1],i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c){a=a<<8|t[c],o+=8;while(o>n)o-=n,s+=e[i&a>>o]}if(o&&(s+=e[i&a<<n-o]),r)while(s.length*n&7)s+="=";return s},At=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>vt({prefix:e,name:t,encode(t){return St(t,r,n)},decode(e){return _t(e,r,n,t)}}),Ct=Et({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),It=Et({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Tt=At({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),kt=At({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Rt=At({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Nt=At({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Dt=At({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ot=At({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Pt=At({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),xt=At({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Mt=At({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Lt=At({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Bt=At({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ut=At({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ft=At({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function zt(t){return Object.assign(it(t),{error:it(`${t}:error`),trace:it(`${t}:trace`)})}it.formatters.b=t=>null==t?"undefined":Ct.baseEncode(t),it.formatters.t=t=>null==t?"undefined":Tt.baseEncode(t),it.formatters.m=t=>null==t?"undefined":Lt.baseEncode(t),it.formatters.p=t=>null==t?"undefined":t.toString(),it.formatters.c=t=>null==t?"undefined":t.toString(),it.formatters.k=t=>null==t?"undefined":t.toString();var Vt=n(1196),jt=n(8947);const Ht=jt.Reader,$t=jt.Writer,Kt=jt.util,Gt=jt.roots["ipfs-unixfs"]||(jt.roots["ipfs-unixfs"]={}),qt=Gt.Data=(()=>{function t(t){if(this.blocksizes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.Type=0,t.prototype.Data=Kt.newBuffer([]),t.prototype.filesize=Kt.Long?Kt.Long.fromBits(0,0,!0):0,t.prototype.blocksizes=Kt.emptyArray,t.prototype.hashType=Kt.Long?Kt.Long.fromBits(0,0,!0):0,t.prototype.fanout=Kt.Long?Kt.Long.fromBits(0,0,!0):0,t.prototype.mode=0,t.prototype.mtime=null,t.encode=function(t,e){if(e||(e=$t.create()),e.uint32(8).int32(t.Type),null!=t.Data&&Object.hasOwnProperty.call(t,"Data")&&e.uint32(18).bytes(t.Data),null!=t.filesize&&Object.hasOwnProperty.call(t,"filesize")&&e.uint32(24).uint64(t.filesize),null!=t.blocksizes&&t.blocksizes.length)for(var n=0;n<t.blocksizes.length;++n)e.uint32(32).uint64(t.blocksizes[n]);return null!=t.hashType&&Object.hasOwnProperty.call(t,"hashType")&&e.uint32(40).uint64(t.hashType),null!=t.fanout&&Object.hasOwnProperty.call(t,"fanout")&&e.uint32(48).uint64(t.fanout),null!=t.mode&&Object.hasOwnProperty.call(t,"mode")&&e.uint32(56).uint32(t.mode),null!=t.mtime&&Object.hasOwnProperty.call(t,"mtime")&&Gt.UnixTime.encode(t.mtime,e.uint32(66).fork()).ldelim(),e},t.decode=function(t,e){t instanceof Ht||(t=Ht.create(t));var n=void 0===e?t.len:t.pos+e,r=new Gt.Data;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.Type=t.int32();break;case 2:r.Data=t.bytes();break;case 3:r.filesize=t.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2===(7&i)){var s=t.uint32()+t.pos;while(t.pos<s)r.blocksizes.push(t.uint64())}else r.blocksizes.push(t.uint64());break;case 5:r.hashType=t.uint64();break;case 6:r.fanout=t.uint64();break;case 7:r.mode=t.uint32();break;case 8:r.mtime=Gt.UnixTime.decode(t,t.uint32());break;default:t.skipType(7&i);break}}if(!r.hasOwnProperty("Type"))throw Kt.ProtocolError("missing required 'Type'",{instance:r});return r},t.fromObject=function(t){if(t instanceof Gt.Data)return t;var e=new Gt.Data;switch(t.Type){case"Raw":case 0:e.Type=0;break;case"Directory":case 1:e.Type=1;break;case"File":case 2:e.Type=2;break;case"Metadata":case 3:e.Type=3;break;case"Symlink":case 4:e.Type=4;break;case"HAMTShard":case 5:e.Type=5;break}if(null!=t.Data&&("string"===typeof t.Data?Kt.base64.decode(t.Data,e.Data=Kt.newBuffer(Kt.base64.length(t.Data)),0):t.Data.length&&(e.Data=t.Data)),null!=t.filesize&&(Kt.Long?(e.filesize=Kt.Long.fromValue(t.filesize)).unsigned=!0:"string"===typeof t.filesize?e.filesize=parseInt(t.filesize,10):"number"===typeof t.filesize?e.filesize=t.filesize:"object"===typeof t.filesize&&(e.filesize=new Kt.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");e.blocksizes=[];for(var n=0;n<t.blocksizes.length;++n)Kt.Long?(e.blocksizes[n]=Kt.Long.fromValue(t.blocksizes[n])).unsigned=!0:"string"===typeof t.blocksizes[n]?e.blocksizes[n]=parseInt(t.blocksizes[n],10):"number"===typeof t.blocksizes[n]?e.blocksizes[n]=t.blocksizes[n]:"object"===typeof t.blocksizes[n]&&(e.blocksizes[n]=new Kt.LongBits(t.blocksizes[n].low>>>0,t.blocksizes[n].high>>>0).toNumber(!0))}if(null!=t.hashType&&(Kt.Long?(e.hashType=Kt.Long.fromValue(t.hashType)).unsigned=!0:"string"===typeof t.hashType?e.hashType=parseInt(t.hashType,10):"number"===typeof t.hashType?e.hashType=t.hashType:"object"===typeof t.hashType&&(e.hashType=new Kt.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),null!=t.fanout&&(Kt.Long?(e.fanout=Kt.Long.fromValue(t.fanout)).unsigned=!0:"string"===typeof t.fanout?e.fanout=parseInt(t.fanout,10):"number"===typeof t.fanout?e.fanout=t.fanout:"object"===typeof t.fanout&&(e.fanout=new Kt.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),null!=t.mode&&(e.mode=t.mode>>>0),null!=t.mtime){if("object"!==typeof t.mtime)throw TypeError(".Data.mtime: object expected");e.mtime=Gt.UnixTime.fromObject(t.mtime)}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.blocksizes=[]),e.defaults){if(n.Type=e.enums===String?"Raw":0,e.bytes===String?n.Data="":(n.Data=[],e.bytes!==Array&&(n.Data=Kt.newBuffer(n.Data))),Kt.Long){var r=new Kt.Long(0,0,!0);n.filesize=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.filesize=e.longs===String?"0":0;if(Kt.Long){r=new Kt.Long(0,0,!0);n.hashType=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.hashType=e.longs===String?"0":0;if(Kt.Long){r=new Kt.Long(0,0,!0);n.fanout=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.fanout=e.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=t.Type&&t.hasOwnProperty("Type")&&(n.Type=e.enums===String?Gt.Data.DataType[t.Type]:t.Type),null!=t.Data&&t.hasOwnProperty("Data")&&(n.Data=e.bytes===String?Kt.base64.encode(t.Data,0,t.Data.length):e.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),null!=t.filesize&&t.hasOwnProperty("filesize")&&("number"===typeof t.filesize?n.filesize=e.longs===String?String(t.filesize):t.filesize:n.filesize=e.longs===String?Kt.Long.prototype.toString.call(t.filesize):e.longs===Number?new Kt.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){n.blocksizes=[];for(var i=0;i<t.blocksizes.length;++i)"number"===typeof t.blocksizes[i]?n.blocksizes[i]=e.longs===String?String(t.blocksizes[i]):t.blocksizes[i]:n.blocksizes[i]=e.longs===String?Kt.Long.prototype.toString.call(t.blocksizes[i]):e.longs===Number?new Kt.LongBits(t.blocksizes[i].low>>>0,t.blocksizes[i].high>>>0).toNumber(!0):t.blocksizes[i]}return null!=t.hashType&&t.hasOwnProperty("hashType")&&("number"===typeof t.hashType?n.hashType=e.longs===String?String(t.hashType):t.hashType:n.hashType=e.longs===String?Kt.Long.prototype.toString.call(t.hashType):e.longs===Number?new Kt.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),null!=t.fanout&&t.hasOwnProperty("fanout")&&("number"===typeof t.fanout?n.fanout=e.longs===String?String(t.fanout):t.fanout:n.fanout=e.longs===String?Kt.Long.prototype.toString.call(t.fanout):e.longs===Number?new Kt.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),null!=t.mode&&t.hasOwnProperty("mode")&&(n.mode=t.mode),null!=t.mtime&&t.hasOwnProperty("mtime")&&(n.mtime=Gt.UnixTime.toObject(t.mtime,e)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.DataType=function(){const t={},e=Object.create(t);return e[t[0]="Raw"]=0,e[t[1]="Directory"]=1,e[t[2]="File"]=2,e[t[3]="Metadata"]=3,e[t[4]="Symlink"]=4,e[t[5]="HAMTShard"]=5,e}(),t})(),Wt=(Gt.UnixTime=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.Seconds=Kt.Long?Kt.Long.fromBits(0,0,!1):0,t.prototype.FractionalNanoseconds=0,t.encode=function(t,e){return e||(e=$t.create()),e.uint32(8).int64(t.Seconds),null!=t.FractionalNanoseconds&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&e.uint32(21).fixed32(t.FractionalNanoseconds),e},t.decode=function(t,e){t instanceof Ht||(t=Ht.create(t));var n=void 0===e?t.len:t.pos+e,r=new Gt.UnixTime;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.Seconds=t.int64();break;case 2:r.FractionalNanoseconds=t.fixed32();break;default:t.skipType(7&i);break}}if(!r.hasOwnProperty("Seconds"))throw Kt.ProtocolError("missing required 'Seconds'",{instance:r});return r},t.fromObject=function(t){if(t instanceof Gt.UnixTime)return t;var e=new Gt.UnixTime;return null!=t.Seconds&&(Kt.Long?(e.Seconds=Kt.Long.fromValue(t.Seconds)).unsigned=!1:"string"===typeof t.Seconds?e.Seconds=parseInt(t.Seconds,10):"number"===typeof t.Seconds?e.Seconds=t.Seconds:"object"===typeof t.Seconds&&(e.Seconds=new Kt.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),null!=t.FractionalNanoseconds&&(e.FractionalNanoseconds=t.FractionalNanoseconds>>>0),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults){if(Kt.Long){var r=new Kt.Long(0,0,!1);n.Seconds=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.Seconds=e.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=t.Seconds&&t.hasOwnProperty("Seconds")&&("number"===typeof t.Seconds?n.Seconds=e.longs===String?String(t.Seconds):t.Seconds:n.Seconds=e.longs===String?Kt.Long.prototype.toString.call(t.Seconds):e.longs===Number?new Kt.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),null!=t.FractionalNanoseconds&&t.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=t.FractionalNanoseconds),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),Gt.Metadata=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.MimeType="",t.encode=function(t,e){return e||(e=$t.create()),null!=t.MimeType&&Object.hasOwnProperty.call(t,"MimeType")&&e.uint32(10).string(t.MimeType),e},t.decode=function(t,e){t instanceof Ht||(t=Ht.create(t));var n=void 0===e?t.len:t.pos+e,r=new Gt.Metadata;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.MimeType=t.string();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof Gt.Metadata)return t;var e=new Gt.Metadata;return null!=t.MimeType&&(e.MimeType=String(t.MimeType)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.MimeType=""),null!=t.MimeType&&t.hasOwnProperty("MimeType")&&(n.MimeType=t.MimeType),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),qt),Yt=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],Xt=["directory","hamt-sharded-directory"],Qt=parseInt("0644",8),Jt=parseInt("0755",8);function Zt(t){if(null!=t)return"number"===typeof t?4095&t:(t=t.toString(),"0"===t.substring(0,1)?4095&parseInt(t,8):4095&parseInt(t,10))}function te(t){if(null==t)return;let e;if(null!=t.secs&&(e={secs:t.secs,nsecs:t.nsecs}),null!=t.Seconds&&(e={secs:t.Seconds,nsecs:t.FractionalNanoseconds}),Array.isArray(t)&&(e={secs:t[0],nsecs:t[1]}),t instanceof Date){const n=t.getTime(),r=Math.floor(n/1e3);e={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(null!=e&&null!=e.nsecs&&(e.nsecs<0||e.nsecs>999999999))throw Vt(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}class ee{static unmarshal(t){const e=Wt.decode(t),n=Wt.toObject(e,{defaults:!1,arrays:!0,longs:Number,objects:!1}),r=new ee({type:Yt[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return r._originalMode=n.mode||0,r}constructor(t={type:"file"}){const{type:e,data:n,blockSizes:r,hashType:i,fanout:s,mtime:o,mode:a}=t;if(e&&!Yt.includes(e))throw Vt(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE");this.type=e||"file",this.data=n,this.hashType=i,this.fanout=s,this.blockSizes=r||[],this._originalMode=0,this.mode=Zt(a),o&&(this.mtime=te(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(t){this._mode=this.isDirectory()?Jt:Qt;const e=Zt(t);void 0!==e&&(this._mode=e)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&Xt.includes(this.type))}addBlockSize(t){this.blockSizes.push(t)}removeBlockSize(t){this.blockSizes.splice(t,1)}fileSize(){if(this.isDirectory())return 0;let t=0;return this.blockSizes.forEach((e=>{t+=e})),this.data&&(t+=this.data.length),t}marshal(){let t;switch(this.type){case"raw":t=Wt.DataType.Raw;break;case"directory":t=Wt.DataType.Directory;break;case"file":t=Wt.DataType.File;break;case"metadata":t=Wt.DataType.Metadata;break;case"symlink":t=Wt.DataType.Symlink;break;case"hamt-sharded-directory":t=Wt.DataType.HAMTShard;break;default:throw Vt(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE")}let e,n,r=this.data;if(this.data&&this.data.length||(r=void 0),null!=this.mode&&(e=4294963200&this._originalMode|(Zt(this.mode)||0),e!==Qt||this.isDirectory()||(e=void 0),e===Jt&&this.isDirectory()&&(e=void 0)),null!=this.mtime){const t=te(this.mtime);t&&(n={Seconds:t.secs,FractionalNanoseconds:t.nsecs},0===n.FractionalNanoseconds&&delete n.FractionalNanoseconds)}const i={Type:t,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:e,mtime:n};return Wt.encode(i).finish()}}var ne=ae,re=128,ie=127,se=~ie,oe=Math.pow(2,31);function ae(t,e,n){e=e||[],n=n||0;var r=n;while(t>=oe)e[n++]=255&t|re,t/=128;while(t&se)e[n++]=255&t|re,t>>>=7;return e[n]=0|t,ae.bytes=n-r+1,e}var ce=he,le=128,ue=127;function he(t,e){var n,r=0,i=(e=e||0,0),s=e,o=t.length;do{if(s>=o)throw he.bytes=0,new RangeError("Could not decode varint");n=t[s++],r+=i<28?(n&ue)<<i:(n&ue)*Math.pow(2,i),i+=7}while(n>=le);return he.bytes=s-e,r}var de=Math.pow(2,7),fe=Math.pow(2,14),pe=Math.pow(2,21),ge=Math.pow(2,28),me=Math.pow(2,35),ye=Math.pow(2,42),we=Math.pow(2,49),be=Math.pow(2,56),ve=Math.pow(2,63),Ee=function(t){return t<de?1:t<fe?2:t<pe?3:t<ge?4:t<me?5:t<ye?6:t<we?7:t<be?8:t<ve?9:10},_e={encode:ne,decode:ce,encodingLength:Ee},Se=_e,Ae=Se;const Ce=(t,e=0)=>{const n=Ae.decode(t,e);return[n,Ae.decode.bytes]},Ie=(t,e,n=0)=>(Ae.encode(t,e,n),e),Te=t=>Ae.encodingLength(t),ke=(t,e)=>{const n=e.byteLength,r=Te(t),i=r+Te(n),s=new Uint8Array(i+n);return Ie(t,s,0),Ie(n,s,r),s.set(e,i),new De(t,n,e,s)},Re=t=>{const e=dt(t),[n,r]=Ce(e),[i,s]=Ce(e.subarray(r)),o=e.subarray(r+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new De(n,i,o,e)},Ne=(t,e)=>{if(t===e)return!0;{const n=e;return t.code===n.code&&t.size===n.size&&n.bytes instanceof Uint8Array&&ht(t.bytes,n.bytes)}};class De{constructor(t,e,n,r){this.code=t,this.size=e,this.digest=n,this.bytes=r}}const Oe=(t,e)=>{const{bytes:n,version:r}=t;switch(r){case 0:return Be(n,xe(t),e||Ct.encoder);default:return Ue(n,xe(t),e||Tt.encoder)}},Pe=new WeakMap,xe=t=>{const e=Pe.get(t);if(null==e){const e=new Map;return Pe.set(t,e),e}return e};class Me{constructor(t,e,n,r){this.code=e,this.version=t,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:t,multihash:e}=this;if(t!==Fe)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==ze)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Me.createV0(e)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:t,digest:e}=this.multihash,n=ke(t,e);return Me.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(t){return Me.equals(this,t)}static equals(t,e){const n=e;return n&&t.code===n.code&&t.version===n.version&&Ne(t.multihash,n.multihash)}toString(t){return Oe(this,t)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(t){if(null==t)return null;const e=t;if(e instanceof Me)return e;if(null!=e["/"]&&e["/"]===e.bytes||e.asCID===e){const{version:t,code:n,multihash:r,bytes:i}=e;return new Me(t,n,r,i||Ve(t,n,r.bytes))}if(!0===e[je]){const{version:t,multihash:n,code:r}=e,i=Re(n);return Me.create(t,r,i)}return null}static create(t,e,n){if("number"!==typeof e)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(t){case 0:if(e!==Fe)throw new Error(`Version 0 CID must use dag-pb (code: ${Fe}) block encoding`);return new Me(t,e,n,n.bytes);case 1:{const r=Ve(t,e,n.bytes);return new Me(t,e,n,r)}default:throw new Error("Invalid version")}}static createV0(t){return Me.create(0,Fe,t)}static createV1(t,e){return Me.create(1,t,e)}static decode(t){const[e,n]=Me.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return e}static decodeFirst(t){const e=Me.inspectBytes(t),n=e.size-e.multihashSize,r=dt(t.subarray(n,n+e.multihashSize));if(r.byteLength!==e.multihashSize)throw new Error("Incorrect length");const i=r.subarray(e.multihashSize-e.digestSize),s=new De(e.multihashCode,e.digestSize,i,r),o=0===e.version?Me.createV0(s):Me.createV1(e.codec,s);return[o,t.subarray(e.size)]}static inspectBytes(t){let e=0;const n=()=>{const[n,r]=Ce(t.subarray(e));return e+=r,n};let r=n(),i=Fe;if(18===r?(r=0,e=0):i=n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=e,o=n(),a=n(),c=e+a,l=c-s;return{version:r,codec:i,multihashCode:o,digestSize:a,multihashSize:l,size:c}}static parse(t,e){const[n,r]=Le(t,e),i=Me.decode(r);return xe(i).set(n,t),i}}const Le=(t,e)=>{switch(t[0]){case"Q":{const n=e||Ct;return[Ct.prefix,n.decode(`${Ct.prefix}${t}`)]}case Ct.prefix:{const n=e||Ct;return[Ct.prefix,n.decode(t)]}case Tt.prefix:{const n=e||Tt;return[Tt.prefix,n.decode(t)]}default:if(null==e)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}},Be=(t,e,n)=>{const{prefix:r}=n;if(r!==Ct.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);const i=e.get(r);if(null==i){const i=n.encode(t).slice(1);return e.set(r,i),i}return i},Ue=(t,e,n)=>{const{prefix:r}=n,i=e.get(r);if(null==i){const i=n.encode(t);return e.set(r,i),i}return i},Fe=112,ze=18,Ve=(t,e,n)=>{const r=Te(t),i=r+Te(e),s=new Uint8Array(i+n.byteLength);return Ie(t,s,0),Ie(e,s,r),s.set(n,i),s},je=Symbol.for("@ipld/js-cid/CID"),He=new TextDecoder;function $e(t,e){let n=0;for(let r=0;;r+=7){if(r>=64)throw new Error("protobuf: varint overflow");if(e>=t.length)throw new Error("protobuf: unexpected end of data");const i=t[e++];if(n+=r<28?(127&i)<<r:(127&i)*2**r,i<128)break}return[n,e]}function Ke(t,e){let n;[n,e]=$e(t,e);const r=e+n;if(n<0||r<0)throw new Error("protobuf: invalid length");if(r>t.length)throw new Error("protobuf: unexpected end of data");return[t.subarray(e,r),r]}function Ge(t,e){let n;return[n,e]=$e(t,e),[7&n,n>>3,e]}function qe(t){const e={},n=t.length;let r=0;while(r<n){let n,i;if([n,i,r]=Ge(t,r),1===i){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Hash`);if(void 0!==e.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==e.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,r]=Ke(t,r)}else if(2===i){if(void 0!==e.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Name`);if(void 0!==e.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,r]=Ke(t,r),e.Name=He.decode(i)}else{if(3!==i)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`);if(void 0!==e.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Tsize`);[e.Tsize,r]=$e(t,r)}}if(r>n)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function We(t){const e=t.length;let n,r,i=0,s=!1;while(i<e){let e,o;if([e,o,i]=Ge(t,i),2!==e)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${e}`);if(1===o){if(r)throw new Error("protobuf: (PBNode) duplicate Data section");[r,i]=Ke(t,i),n&&(s=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(s)throw new Error("protobuf: (PBNode) duplicate Links section");let e;n||(n=[]),[e,i]=Ke(t,i),n.push(qe(e))}}}if(i>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return r&&(o.Data=r),o.Links=n||[],o}const Ye=new TextEncoder,Xe=2**32,Qe=2**31;function Je(t,e){let n=e.length;if("number"===typeof t.Tsize){if(t.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(t.Tsize))throw new Error("Tsize too large for encoding");n=nn(e,n,t.Tsize)-1,e[n]=24}if("string"===typeof t.Name){const r=Ye.encode(t.Name);n-=r.length,e.set(r,n),n=nn(e,n,r.length)-1,e[n]=18}return t.Hash&&(n-=t.Hash.length,e.set(t.Hash,n),n=nn(e,n,t.Hash.length)-1,e[n]=10),e.length-n}function Ze(t){const e=en(t),n=new Uint8Array(e);let r=e;if(t.Data&&(r-=t.Data.length,n.set(t.Data,r),r=nn(n,r,t.Data.length)-1,n[r]=10),t.Links)for(let i=t.Links.length-1;i>=0;i--){const e=Je(t.Links[i],n.subarray(0,r));r-=e,r=nn(n,r,e)-1,n[r]=18}return n}function tn(t){let e=0;if(t.Hash){const n=t.Hash.length;e+=1+n+rn(n)}if("string"===typeof t.Name){const n=Ye.encode(t.Name).length;e+=1+n+rn(n)}return"number"===typeof t.Tsize&&(e+=1+rn(t.Tsize)),e}function en(t){let e=0;if(t.Data){const n=t.Data.length;e+=1+n+rn(n)}if(t.Links)for(const n of t.Links){const t=tn(n);e+=1+t+rn(t)}return e}function nn(t,e,n){e-=rn(n);const r=e;while(n>=Qe)t[e++]=127&n|128,n/=128;while(n>=128)t[e++]=127&n|128,n>>>=7;return t[e]=n,r}function rn(t){return t%2===0&&t++,Math.floor((sn(t)+6)/7)}function sn(t){let e=0;return t>=Xe&&(t=Math.floor(t/Xe),e=32),t>=65536&&(t>>>=16,e+=16),t>=256&&(t>>>=8,e+=8),e+on[t]}const on=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],an=["Data","Links"],cn=["Hash","Name","Tsize"],ln=new TextEncoder;function un(t,e){if(t===e)return 0;const n=t.Name?ln.encode(t.Name):[],r=e.Name?ln.encode(e.Name):[];let i=n.length,s=r.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(n[o]!==r[o]){i=n[o],s=r[o];break}return i<s?-1:s<i?1:0}function hn(t,e){return!Object.keys(t).some((t=>!e.includes(t)))}function dn(t){if("object"===typeof t.asCID){const e=Me.asCID(t);if(!e)throw new TypeError("Invalid DAG-PB form");return{Hash:e}}if("object"!==typeof t||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");const e={};if(t.Hash){let r=Me.asCID(t.Hash);try{r||("string"===typeof t.Hash?r=Me.parse(t.Hash):t.Hash instanceof Uint8Array&&(r=Me.decode(t.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(e.Hash=r)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return"string"===typeof t.Name&&(e.Name=t.Name),"number"===typeof t.Tsize&&(e.Tsize=t.Tsize),e}function fn(t){if((t instanceof Uint8Array||"string"===typeof t)&&(t={Data:t}),"object"!==typeof t||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");const e={};if(void 0!==t.Data)if("string"===typeof t.Data)e.Data=ln.encode(t.Data);else{if(!(t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");e.Data=t.Data}if(void 0!==t.Links){if(!Array.isArray(t.Links))throw new TypeError("Invalid DAG-PB form");e.Links=t.Links.map(dn),e.Links.sort(un)}else e.Links=[];return e}function pn(t){if(!t||"object"!==typeof t||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");if(!hn(t,an))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==t.Data&&!(t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(t.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let e=0;e<t.Links.length;e++){const n=t.Links[e];if(!n||"object"!==typeof n||Array.isArray(n))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!hn(n,cn))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!n.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(n.Hash.asCID!==n.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==n.Name&&"string"!==typeof n.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==n.Tsize&&("number"!==typeof n.Tsize||n.Tsize%1!==0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e>0&&-1===un(n,t.Links[e-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function gn(t,e=[]){return fn({Data:t,Links:e})}function mn(t,e,n){return dn({Hash:n,Name:t,Tsize:e})}const yn="dag-pb",wn=112;function bn(t){pn(t);const e={};return t.Links&&(e.Links=t.Links.map((t=>{const e={};return t.Hash&&(e.Hash=t.Hash.bytes),void 0!==t.Name&&(e.Name=t.Name),void 0!==t.Tsize&&(e.Tsize=t.Tsize),e}))),t.Data&&(e.Data=t.Data),Ze(e)}function vn(t){const e=We(t),n={};return e.Data&&(n.Data=e.Data),e.Links&&(n.Links=e.Links.map((t=>{const e={};try{e.Hash=Me.decode(t.Hash)}catch(n){}if(!e.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==t.Name&&(e.Name=t.Name),void 0!==t.Tsize&&(e.Tsize=t.Tsize),e}))),n}const En=["string","number","bigint","symbol"],_n=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Sn(t){if(null===t)return"null";if(void 0===t)return"undefined";if(!0===t||!1===t)return"boolean";const e=typeof t;if(En.includes(e))return e;if("function"===e)return"Function";if(Array.isArray(t))return"Array";if(An(t))return"Buffer";const n=Cn(t);return n||"Object"}function An(t){return t&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t)}function Cn(t){const e=Object.prototype.toString.call(t).slice(8,-1);if(_n.includes(e))return e}class In{constructor(t,e,n){this.major=t,this.majorEncoded=t<<5,this.name=e,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}}In.uint=new In(0,"uint",!0),In.negint=new In(1,"negint",!0),In.bytes=new In(2,"bytes",!0),In.string=new In(3,"string",!0),In.array=new In(4,"array",!1),In.map=new In(5,"map",!1),In.tag=new In(6,"tag",!1),In.float=new In(7,"float",!0),In.false=new In(7,"false",!0),In.true=new In(7,"true",!0),In.null=new In(7,"null",!0),In.undefined=new In(7,"undefined",!0),In.break=new In(7,"break",!0);class Tn{constructor(t,e,n){this.type=t,this.value=e,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const kn=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"===typeof globalThis.Buffer.isBuffer,Rn=new TextDecoder,Nn=new TextEncoder;function Dn(t){return kn&&globalThis.Buffer.isBuffer(t)}function On(t){return t instanceof Uint8Array?Dn(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t:Uint8Array.from(t)}const Pn=kn?(t,e,n)=>n-e>64?globalThis.Buffer.from(t.subarray(e,n)).toString("utf8"):Vn(t,e,n):(t,e,n)=>n-e>64?Rn.decode(t.subarray(e,n)):Vn(t,e,n),xn=kn?t=>t.length>64?globalThis.Buffer.from(t):zn(t):t=>t.length>64?Nn.encode(t):zn(t),Mn=t=>Uint8Array.from(t),Ln=kn?(t,e,n)=>Dn(t)?new Uint8Array(t.subarray(e,n)):t.slice(e,n):(t,e,n)=>t.slice(e,n),Bn=kn?(t,e)=>(t=t.map((t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t))),On(globalThis.Buffer.concat(t,e))):(t,e)=>{const n=new Uint8Array(e);let r=0;for(let i of t)r+i.length>n.length&&(i=i.subarray(0,n.length-r)),n.set(i,r),r+=i.length;return n},Un=kn?t=>globalThis.Buffer.allocUnsafe(t):t=>new Uint8Array(t);function Fn(t,e){if(Dn(t)&&Dn(e))return t.compare(e);for(let n=0;n<t.length;n++)if(t[n]!==e[n])return t[n]<e[n]?-1:1;return 0}function zn(t,e=1/0){let n;const r=t.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function Vn(t,e,n){const r=[];while(e<n){const i=t[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=n){let n,r,a,c;switch(o){case 1:i<128&&(s=i);break;case 2:n=t[e+1],128===(192&n)&&(c=(31&i)<<6|63&n,c>127&&(s=c));break;case 3:n=t[e+1],r=t[e+2],128===(192&n)&&128===(192&r)&&(c=(15&i)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:n=t[e+1],r=t[e+2],a=t[e+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),e+=o}return Hn(r)}const jn=4096;function Hn(t){const e=t.length;if(e<=jn)return String.fromCharCode.apply(String,t);let n="",r=0;while(r<e)n+=String.fromCharCode.apply(String,t.slice(r,r+=jn));return n}const $n=256;class Kn{constructor(t=$n){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let e=this.chunks[this.chunks.length-1];const n=this.cursor+t.length;if(n<=this.maxCursor+1){const n=e.length-(this.maxCursor-this.cursor)-1;e.set(t,n)}else{if(e){const t=e.length-(this.maxCursor-this.cursor)-1;t<e.length&&(this.chunks[this.chunks.length-1]=e.subarray(0,t),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(e=Un(this.chunkSize),this.chunks.push(e),this.maxCursor+=e.length,null===this._initReuseChunk&&(this._initReuseChunk=e),e.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let e;if(1===this.chunks.length){const n=this.chunks[0];t&&this.cursor>n.length/2?(e=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=Ln(n,0,this.cursor)}else e=Bn(this.chunks,this.cursor);return t&&this.reset(),e}}const Gn="CBOR decode error:",qn="CBOR encode error:",Wn=[];function Yn(t,e,n){if(t.length-e<n)throw new Error(`${Gn} not enough data for type`)}Wn[23]=1,Wn[24]=2,Wn[25]=3,Wn[26]=5,Wn[27]=9;const Xn=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Qn(t,e,n){Yn(t,e,1);const r=t[e];if(!0===n.strict&&r<Xn[0])throw new Error(`${Gn} integer encoded in more bytes than necessary (strict decode)`);return r}function Jn(t,e,n){Yn(t,e,2);const r=t[e]<<8|t[e+1];if(!0===n.strict&&r<Xn[1])throw new Error(`${Gn} integer encoded in more bytes than necessary (strict decode)`);return r}function Zn(t,e,n){Yn(t,e,4);const r=16777216*t[e]+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];if(!0===n.strict&&r<Xn[2])throw new Error(`${Gn} integer encoded in more bytes than necessary (strict decode)`);return r}function tr(t,e,n){Yn(t,e,8);const r=16777216*t[e]+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3],i=16777216*t[e+4]+(t[e+5]<<16)+(t[e+6]<<8)+t[e+7],s=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&s<Xn[3])throw new Error(`${Gn} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===n.allowBigInt)return s;throw new Error(`${Gn} integers outside of the safe integer range are not supported`)}function er(t,e,n,r){return new Tn(In.uint,Qn(t,e+1,r),2)}function nr(t,e,n,r){return new Tn(In.uint,Jn(t,e+1,r),3)}function rr(t,e,n,r){return new Tn(In.uint,Zn(t,e+1,r),5)}function ir(t,e,n,r){return new Tn(In.uint,tr(t,e+1,r),9)}function sr(t,e){return or(t,0,e.value)}function or(t,e,n){if(n<Xn[0]){const r=Number(n);t.push([e|r])}else if(n<Xn[1]){const r=Number(n);t.push([24|e,r])}else if(n<Xn[2]){const r=Number(n);t.push([25|e,r>>>8,255&r])}else if(n<Xn[3]){const r=Number(n);t.push([26|e,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<Xn[4]))throw new Error(`${Gn} encountered BigInt larger than allowable range`);{const n=[27|e,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),s=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&s,s>>=8,n[3]=255&s,s>>=8,n[2]=255&s,s>>=8,n[1]=255&s,t.push(n)}}}function ar(t,e,n,r){return new Tn(In.negint,-1-Qn(t,e+1,r),2)}function cr(t,e,n,r){return new Tn(In.negint,-1-Jn(t,e+1,r),3)}function lr(t,e,n,r){return new Tn(In.negint,-1-Zn(t,e+1,r),5)}sr.encodedSize=function(t){return or.encodedSize(t.value)},or.encodedSize=function(t){return t<Xn[0]?1:t<Xn[1]?2:t<Xn[2]?3:t<Xn[3]?5:9},sr.compareTokens=function(t,e){return t.value<e.value?-1:t.value>e.value?1:0};const ur=BigInt(-1),hr=BigInt(1);function dr(t,e,n,r){const i=tr(t,e+1,r);if("bigint"!==typeof i){const t=-1-i;if(t>=Number.MIN_SAFE_INTEGER)return new Tn(In.negint,t,9)}if(!0!==r.allowBigInt)throw new Error(`${Gn} integers outside of the safe integer range are not supported`);return new Tn(In.negint,ur-BigInt(i),9)}function fr(t,e){const n=e.value,r="bigint"===typeof n?n*ur-hr:-1*n-1;or(t,e.type.majorEncoded,r)}function pr(t,e,n,r){Yn(t,e,n+r);const i=Ln(t,e+n,e+n+r);return new Tn(In.bytes,i,n+r)}function gr(t,e,n,r){return pr(t,e,1,n)}function mr(t,e,n,r){return pr(t,e,2,Qn(t,e+1,r))}function yr(t,e,n,r){return pr(t,e,3,Jn(t,e+1,r))}function wr(t,e,n,r){return pr(t,e,5,Zn(t,e+1,r))}function br(t,e,n,r){const i=tr(t,e+1,r);if("bigint"===typeof i)throw new Error(`${Gn} 64-bit integer bytes lengths not supported`);return pr(t,e,9,i)}function vr(t){return void 0===t.encodedBytes&&(t.encodedBytes=t.type===In.string?xn(t.value):t.value),t.encodedBytes}function Er(t,e){const n=vr(e);or(t,e.type.majorEncoded,n.length),t.push(n)}function _r(t,e){return t.length<e.length?-1:t.length>e.length?1:Fn(t,e)}function Sr(t,e,n,r,i){const s=n+r;Yn(t,e,s);const o=new Tn(In.string,Pn(t,e+n,e+s),s);return!0===i.retainStringBytes&&(o.byteValue=Ln(t,e+n,e+s)),o}function Ar(t,e,n,r){return Sr(t,e,1,n,r)}function Cr(t,e,n,r){return Sr(t,e,2,Qn(t,e+1,r),r)}function Ir(t,e,n,r){return Sr(t,e,3,Jn(t,e+1,r),r)}function Tr(t,e,n,r){return Sr(t,e,5,Zn(t,e+1,r),r)}function kr(t,e,n,r){const i=tr(t,e+1,r);if("bigint"===typeof i)throw new Error(`${Gn} 64-bit integer string lengths not supported`);return Sr(t,e,9,i,r)}fr.encodedSize=function(t){const e=t.value,n="bigint"===typeof e?e*ur-hr:-1*e-1;return n<Xn[0]?1:n<Xn[1]?2:n<Xn[2]?3:n<Xn[3]?5:9},fr.compareTokens=function(t,e){return t.value<e.value?1:t.value>e.value?-1:0},Er.encodedSize=function(t){const e=vr(t);return or.encodedSize(e.length)+e.length},Er.compareTokens=function(t,e){return _r(vr(t),vr(e))};const Rr=Er;function Nr(t,e,n,r){return new Tn(In.array,r,n)}function Dr(t,e,n,r){return Nr(t,e,1,n)}function Or(t,e,n,r){return Nr(t,e,2,Qn(t,e+1,r))}function Pr(t,e,n,r){return Nr(t,e,3,Jn(t,e+1,r))}function xr(t,e,n,r){return Nr(t,e,5,Zn(t,e+1,r))}function Mr(t,e,n,r){const i=tr(t,e+1,r);if("bigint"===typeof i)throw new Error(`${Gn} 64-bit integer array lengths not supported`);return Nr(t,e,9,i)}function Lr(t,e,n,r){if(!1===r.allowIndefinite)throw new Error(`${Gn} indefinite length items not allowed`);return Nr(t,e,1,1/0)}function Br(t,e){or(t,In.array.majorEncoded,e.value)}function Ur(t,e,n,r){return new Tn(In.map,r,n)}function Fr(t,e,n,r){return Ur(t,e,1,n)}function zr(t,e,n,r){return Ur(t,e,2,Qn(t,e+1,r))}function Vr(t,e,n,r){return Ur(t,e,3,Jn(t,e+1,r))}function jr(t,e,n,r){return Ur(t,e,5,Zn(t,e+1,r))}function Hr(t,e,n,r){const i=tr(t,e+1,r);if("bigint"===typeof i)throw new Error(`${Gn} 64-bit integer map lengths not supported`);return Ur(t,e,9,i)}function $r(t,e,n,r){if(!1===r.allowIndefinite)throw new Error(`${Gn} indefinite length items not allowed`);return Ur(t,e,1,1/0)}function Kr(t,e){or(t,In.map.majorEncoded,e.value)}function Gr(t,e,n,r){return new Tn(In.tag,n,1)}function qr(t,e,n,r){return new Tn(In.tag,Qn(t,e+1,r),2)}function Wr(t,e,n,r){return new Tn(In.tag,Jn(t,e+1,r),3)}function Yr(t,e,n,r){return new Tn(In.tag,Zn(t,e+1,r),5)}function Xr(t,e,n,r){return new Tn(In.tag,tr(t,e+1,r),9)}function Qr(t,e){or(t,In.tag.majorEncoded,e.value)}Br.compareTokens=sr.compareTokens,Br.encodedSize=function(t){return or.encodedSize(t.value)},Kr.compareTokens=sr.compareTokens,Kr.encodedSize=function(t){return or.encodedSize(t.value)},Qr.compareTokens=sr.compareTokens,Qr.encodedSize=function(t){return or.encodedSize(t.value)};const Jr=20,Zr=21,ti=22,ei=23;function ni(t,e,n,r){if(!1===r.allowUndefined)throw new Error(`${Gn} undefined values are not supported`);return!0===r.coerceUndefinedToNull?new Tn(In["null"],null,1):new Tn(In.undefined,void 0,1)}function ri(t,e,n,r){if(!1===r.allowIndefinite)throw new Error(`${Gn} indefinite length items not allowed`);return new Tn(In["break"],void 0,1)}function ii(t,e,n){if(n){if(!1===n.allowNaN&&Number.isNaN(t))throw new Error(`${Gn} NaN values are not supported`);if(!1===n.allowInfinity&&(t===1/0||t===-1/0))throw new Error(`${Gn} Infinity values are not supported`)}return new Tn(In.float,t,e)}function si(t,e,n,r){return ii(fi(t,e+1),3,r)}function oi(t,e,n,r){return ii(gi(t,e+1),5,r)}function ai(t,e,n,r){return ii(yi(t,e+1),9,r)}function ci(t,e,n){const r=e.value;if(!1===r)t.push([In.float.majorEncoded|Jr]);else if(!0===r)t.push([In.float.majorEncoded|Zr]);else if(null===r)t.push([In.float.majorEncoded|ti]);else if(void 0===r)t.push([In.float.majorEncoded|ei]);else{let e,i=!1;n&&!0===n.float64||(di(r),e=fi(hi,1),r===e||Number.isNaN(r)?(hi[0]=249,t.push(hi.slice(0,3)),i=!0):(pi(r),e=gi(hi,1),r===e&&(hi[0]=250,t.push(hi.slice(0,5)),i=!0))),i||(mi(r),e=yi(hi,1),hi[0]=251,t.push(hi.slice(0,9)))}}ci.encodedSize=function(t,e){const n=t.value;if(!1===n||!0===n||null===n||void 0===n)return 1;if(!e||!0!==e.float64){di(n);let t=fi(hi,1);if(n===t||Number.isNaN(n))return 3;if(pi(n),t=gi(hi,1),n===t)return 5}return 9};const li=new ArrayBuffer(9),ui=new DataView(li,1),hi=new Uint8Array(li,0);function di(t){if(t===1/0)ui.setUint16(0,31744,!1);else if(t===-1/0)ui.setUint16(0,64512,!1);else if(Number.isNaN(t))ui.setUint16(0,32256,!1);else{ui.setFloat32(0,t);const e=ui.getUint32(0),n=(2139095040&e)>>23,r=8388607&e;if(255===n)ui.setUint16(0,31744,!1);else if(0===n)ui.setUint16(0,(2147483648&t)>>16|r>>13,!1);else{const t=n-127;t<-24?ui.setUint16(0,0):t<-14?ui.setUint16(0,(2147483648&e)>>16|1<<24+t,!1):ui.setUint16(0,(2147483648&e)>>16|t+15<<10|r>>13,!1)}}}function fi(t,e){if(t.length-e<2)throw new Error(`${Gn} not enough data for float16`);const n=(t[e]<<8)+t[e+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let s;return s=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-s:s}function pi(t){ui.setFloat32(0,t,!1)}function gi(t,e){if(t.length-e<4)throw new Error(`${Gn} not enough data for float32`);const n=(t.byteOffset||0)+e;return new DataView(t.buffer,n,4).getFloat32(0,!1)}function mi(t){ui.setFloat64(0,t,!1)}function yi(t,e){if(t.length-e<8)throw new Error(`${Gn} not enough data for float64`);const n=(t.byteOffset||0)+e;return new DataView(t.buffer,n,8).getFloat64(0,!1)}function wi(t,e,n){throw new Error(`${Gn} encountered invalid minor (${n}) for major ${t[e]>>>5}`)}function bi(t){return()=>{throw new Error(`${Gn} ${t}`)}}ci.compareTokens=sr.compareTokens;const vi=[];for(let K6=0;K6<=23;K6++)vi[K6]=wi;vi[24]=er,vi[25]=nr,vi[26]=rr,vi[27]=ir,vi[28]=wi,vi[29]=wi,vi[30]=wi,vi[31]=wi;for(let K6=32;K6<=55;K6++)vi[K6]=wi;vi[56]=ar,vi[57]=cr,vi[58]=lr,vi[59]=dr,vi[60]=wi,vi[61]=wi,vi[62]=wi,vi[63]=wi;for(let K6=64;K6<=87;K6++)vi[K6]=gr;vi[88]=mr,vi[89]=yr,vi[90]=wr,vi[91]=br,vi[92]=wi,vi[93]=wi,vi[94]=wi,vi[95]=bi("indefinite length bytes/strings are not supported");for(let K6=96;K6<=119;K6++)vi[K6]=Ar;vi[120]=Cr,vi[121]=Ir,vi[122]=Tr,vi[123]=kr,vi[124]=wi,vi[125]=wi,vi[126]=wi,vi[127]=bi("indefinite length bytes/strings are not supported");for(let K6=128;K6<=151;K6++)vi[K6]=Dr;vi[152]=Or,vi[153]=Pr,vi[154]=xr,vi[155]=Mr,vi[156]=wi,vi[157]=wi,vi[158]=wi,vi[159]=Lr;for(let K6=160;K6<=183;K6++)vi[K6]=Fr;vi[184]=zr,vi[185]=Vr,vi[186]=jr,vi[187]=Hr,vi[188]=wi,vi[189]=wi,vi[190]=wi,vi[191]=$r;for(let K6=192;K6<=215;K6++)vi[K6]=Gr;vi[216]=qr,vi[217]=Wr,vi[218]=Yr,vi[219]=Xr,vi[220]=wi,vi[221]=wi,vi[222]=wi,vi[223]=wi;for(let K6=224;K6<=243;K6++)vi[K6]=bi("simple values are not supported");vi[244]=wi,vi[245]=wi,vi[246]=wi,vi[247]=ni,vi[248]=bi("simple values are not supported"),vi[249]=si,vi[250]=oi,vi[251]=ai,vi[252]=wi,vi[253]=wi,vi[254]=wi,vi[255]=ri;const Ei=[];for(let K6=0;K6<24;K6++)Ei[K6]=new Tn(In.uint,K6,1);for(let K6=-1;K6>=-24;K6--)Ei[31-K6]=new Tn(In.negint,K6,1);function _i(t){switch(t.type){case In["false"]:return Mn([244]);case In["true"]:return Mn([245]);case In["null"]:return Mn([246]);case In.bytes:return t.value.length?void 0:Mn([64]);case In.string:return""===t.value?Mn([96]):void 0;case In.array:return 0===t.value?Mn([128]):void 0;case In.map:return 0===t.value?Mn([160]):void 0;case In.uint:return t.value<24?Mn([Number(t.value)]):void 0;case In.negint:if(t.value>=-24)return Mn([31-Number(t.value)])}}Ei[64]=new Tn(In.bytes,new Uint8Array(0),1),Ei[96]=new Tn(In.string,"",1),Ei[128]=new Tn(In.array,0,1),Ei[160]=new Tn(In.map,0,1),Ei[244]=new Tn(In["false"],!1,1),Ei[245]=new Tn(In["true"],!0,1),Ei[246]=new Tn(In["null"],null,1);const Si={float64:!1,mapSorter:Oi,quickEncodeToken:_i};function Ai(){const t=[];return t[In.uint.major]=sr,t[In.negint.major]=fr,t[In.bytes.major]=Er,t[In.string.major]=Rr,t[In.array.major]=Br,t[In.map.major]=Kr,t[In.tag.major]=Qr,t[In.float.major]=ci,t}const Ci=Ai(),Ii=new Kn;class Ti{constructor(t,e){this.obj=t,this.parent=e}includes(t){let e=this;do{if(e.obj===t)return!0}while(e=e.parent);return!1}static createCheck(t,e){if(t&&t.includes(e))throw new Error(`${qn} object contains circular references`);return new Ti(e,t)}}const ki={null:new Tn(In["null"],null),undefined:new Tn(In.undefined,void 0),true:new Tn(In["true"],!0),false:new Tn(In["false"],!1),emptyArray:new Tn(In.array,0),emptyMap:new Tn(In.map,0)},Ri={number(t,e,n,r){return Number.isInteger(t)&&Number.isSafeInteger(t)?new Tn(t>=0?In.uint:In.negint,t):new Tn(In.float,t)},bigint(t,e,n,r){return t>=BigInt(0)?new Tn(In.uint,t):new Tn(In.negint,t)},Uint8Array(t,e,n,r){return new Tn(In.bytes,t)},string(t,e,n,r){return new Tn(In.string,t)},boolean(t,e,n,r){return t?ki.true:ki.false},null(t,e,n,r){return ki.null},undefined(t,e,n,r){return ki.undefined},ArrayBuffer(t,e,n,r){return new Tn(In.bytes,new Uint8Array(t))},DataView(t,e,n,r){return new Tn(In.bytes,new Uint8Array(t.buffer,t.byteOffset,t.byteLength))},Array(t,e,n,r){if(!t.length)return!0===n.addBreakTokens?[ki.emptyArray,new Tn(In["break"])]:ki.emptyArray;r=Ti.createCheck(r,t);const i=[];let s=0;for(const o of t)i[s++]=Ni(o,n,r);return n.addBreakTokens?[new Tn(In.array,t.length),i,new Tn(In["break"])]:[new Tn(In.array,t.length),i]},Object(t,e,n,r){const i="Object"!==e,s=i?t.keys():Object.keys(t),o=i?t.size:s.length;if(!o)return!0===n.addBreakTokens?[ki.emptyMap,new Tn(In["break"])]:ki.emptyMap;r=Ti.createCheck(r,t);const a=[];let c=0;for(const l of s)a[c++]=[Ni(l,n,r),Ni(i?t.get(l):t[l],n,r)];return Di(a,n),n.addBreakTokens?[new Tn(In.map,o),a,new Tn(In["break"])]:[new Tn(In.map,o),a]}};Ri.Map=Ri.Object,Ri.Buffer=Ri.Uint8Array;for(const K6 of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Ri[`${K6}Array`]=Ri.DataView;function Ni(t,e={},n){const r=Sn(t),i=e&&e.typeEncoders&&e.typeEncoders[r]||Ri[r];if("function"===typeof i){const s=i(t,r,e,n);if(null!=s)return s}const s=Ri[r];if(!s)throw new Error(`${qn} unsupported type: ${r}`);return s(t,r,e,n)}function Di(t,e){e.mapSorter&&t.sort(e.mapSorter)}function Oi(t,e){const n=Array.isArray(t[0])?t[0][0]:t[0],r=Array.isArray(e[0])?e[0][0]:e[0];if(n.type!==r.type)return n.type.compare(r.type);const i=n.type.major,s=Ci[i].compareTokens(n,r);return 0===s&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function Pi(t,e,n,r){if(Array.isArray(e))for(const i of e)Pi(t,i,n,r);else n[e.type.major](t,e,r)}function xi(t,e,n){const r=Ni(t,n);if(!Array.isArray(r)&&n.quickEncodeToken){const t=n.quickEncodeToken(r);if(t)return t;const i=e[r.type.major];if(i.encodedSize){const t=i.encodedSize(r,n),e=new Kn(t);if(i(e,r,n),1!==e.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return On(e.chunks[0])}}return Ii.reset(),Pi(Ii,r,e,n),Ii.toBytes(!0)}function Mi(t,e){return e=Object.assign({},Si,e),xi(t,Ci,e)}const Li={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Bi{constructor(t,e={}){this.pos=0,this.data=t,this.options=e}done(){return this.pos>=this.data.length}next(){const t=this.data[this.pos];let e=Ei[t];if(void 0===e){const n=vi[t];if(!n)throw new Error(`${Gn} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);const r=31&t;e=n(this.data,this.pos,r,this.options)}return this.pos+=e.encodedLength,e}}const Ui=Symbol.for("DONE"),Fi=Symbol.for("BREAK");function zi(t,e,n){const r=[];for(let i=0;i<t.value;i++){const s=ji(e,n);if(s===Fi){if(t.value===1/0)break;throw new Error(`${Gn} got unexpected break to lengthed array`)}if(s===Ui)throw new Error(`${Gn} found array but not enough entries (got ${i}, expected ${t.value})`);r[i]=s}return r}function Vi(t,e,n){const r=!0===n.useMaps,i=r?void 0:{},s=r?new Map:void 0;for(let o=0;o<t.value;o++){const a=ji(e,n);if(a===Fi){if(t.value===1/0)break;throw new Error(`${Gn} got unexpected break to lengthed map`)}if(a===Ui)throw new Error(`${Gn} found map but not enough entries (got ${o} [no key], expected ${t.value})`);if(!0!==r&&"string"!==typeof a)throw new Error(`${Gn} non-string keys not supported (got ${typeof a})`);const c=ji(e,n);if(c===Ui)throw new Error(`${Gn} found map but not enough entries (got ${o} [no value], expected ${t.value})`);r?s.set(a,c):i[a]=c}return r?s:i}function ji(t,e){if(t.done())return Ui;const n=t.next();if(n.type===In["break"])return Fi;if(n.type.terminal)return n.value;if(n.type===In.array)return zi(n,t,e);if(n.type===In.map)return Vi(n,t,e);if(n.type===In.tag){if(e.tags&&"function"===typeof e.tags[n.value]){const r=ji(t,e);return e.tags[n.value](r)}throw new Error(`${Gn} tag not supported (${n.value})`)}throw new Error("unsupported")}function Hi(t,e){if(!(t instanceof Uint8Array))throw new Error(`${Gn} data to decode must be a Uint8Array`);e=Object.assign({},Li,e);const n=e.tokenizer||new Bi(t,e),r=ji(n,e);if(r===Ui)throw new Error(`${Gn} did not find any content to decode`);if(r===Fi)throw new Error(`${Gn} got unexpected break`);if(!n.done())throw new Error(`${Gn} too many terminals, data makes no sense`);return r}const $i=42;function Ki(t){if(t.asCID!==t&&t["/"]!==t.bytes)return null;const e=Me.asCID(t);if(!e)return null;const n=new Uint8Array(e.bytes.byteLength+1);return n.set(e.bytes,1),[new Tn(In.tag,$i),new Tn(In.bytes,n)]}function Gi(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function qi(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Wi={float64:!0,typeEncoders:{Object:Ki,undefined:Gi,number:qi}};function Yi(t){if(0!==t[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Me.decode(t.subarray(1))}const Xi={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};Xi.tags[$i]=Yi;const Qi="dag-cbor",Ji=113,Zi=t=>Mi(t,Wi),ts=t=>Hi(t,Xi),es=({name:t,code:e,encode:n})=>new ns(t,e,n);class ns{constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?ke(this.code,e):e.then((t=>ke(this.code,t)))}throw Error("Unknown type, must be binary type")}}class rs extends Array{constructor(){super(),this.inRecursive=[]}prefix(t){const e=this.inRecursive[this.inRecursive.length-1];e&&(e.type===In.array&&(e.elements++,1!==e.elements&&t.push([44])),e.type===In.map&&(e.elements++,1!==e.elements&&(e.elements%2===1?t.push([44]):t.push([58]))))}[In.uint.major](t,e){this.prefix(t);const n=String(e.value),r=[];for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i);t.push(r)}[In.negint.major](t,e){this[In.uint.major](t,e)}[In.bytes.major](t,e){throw new Error(`${qn} unsupported type: Uint8Array`)}[In.string.major](t,e){this.prefix(t);const n=xn(JSON.stringify(e.value));t.push(n.length>32?On(n):n)}[In.array.major](t,e){this.prefix(t),this.inRecursive.push({type:In.array,elements:0}),t.push([91])}[In.map.major](t,e){this.prefix(t),this.inRecursive.push({type:In.map,elements:0}),t.push([123])}[In.tag.major](t,e){}[In.float.major](t,e){if("break"===e.type.name){const e=this.inRecursive.pop();if(e){if(e.type===In.array)t.push([93]);else{if(e.type!==In.map)throw new Error("Unexpected recursive type; this should not happen!");t.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===e.value)throw new Error(`${qn} unsupported type: undefined`);if(this.prefix(t),"true"===e.type.name)return void t.push([116,114,117,101]);if("false"===e.type.name)return void t.push([102,97,108,115,101]);if("null"===e.type.name)return void t.push([110,117,108,108]);const n=String(e.value),r=[];let i=!1;for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s),i||46!==r[s]&&101!==r[s]&&69!==r[s]||(i=!0);i||(r.push(46),r.push(48)),t.push(r)}}function is(t,e){if(Array.isArray(t[0])||Array.isArray(e[0]))throw new Error(`${qn} complex map keys are not supported`);const n=t[0],r=e[0];if(n.type!==In.string||r.type!==In.string)throw new Error(`${qn} non-string map keys are not supported`);if(n<r)return-1;if(n>r)return 1;throw new Error(`${qn} unexpected duplicate map keys, this is not supported`)}const ss={addBreakTokens:!0,mapSorter:is};function os(t,e){return e=Object.assign({},ss,e),xi(t,new rs,e)}class as{constructor(t,e={}){this.pos=0,this.data=t,this.options=e,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let t=this.ch();while(32===t||9===t||13===t||10===t)t=this.data[++this.pos]}expect(t){if(this.data.length-this.pos<t.length)throw new Error(`${Gn} unexpected end of input at position ${this.pos}`);for(let e=0;e<t.length;e++)if(this.data[this.pos++]!==t[e])throw new Error(`${Gn} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...t)}'`)}parseNumber(){const t=this.pos;let e=!1,n=!1;const r=t=>{while(!this.done()){const e=this.ch();if(!t.includes(e))break;this.pos++}};if(45===this.ch()&&(e=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new Tn(In.uint,0,this.pos-t);this.pos++,n=!0}if(r([48,49,50,51,52,53,54,55,56,57]),e&&this.pos===t+1)throw new Error(`${Gn} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(n)throw new Error(`${Gn} unexpected token at position ${this.pos}`);n=!0,this.pos++,r([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(n=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,r([48,49,50,51,52,53,54,55,56,57]));const i=String.fromCharCode.apply(null,this.data.subarray(t,this.pos)),s=parseFloat(i);return n?new Tn(In.float,s,this.pos-t):!0!==this.options.allowBigInt||Number.isSafeInteger(s)?new Tn(s>=0?In.uint:In.negint,s,this.pos-t):new Tn(s>=0?In.uint:In.negint,BigInt(i),this.pos-t)}parseString(){if(34!==this.ch())throw new Error(`${Gn} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let i=this.pos,s=0;i<this.data.length&&s<65536;i++,s++){const t=this.data[i];if(92===t||t<32||t>=128)break;if(34===t){const t=String.fromCharCode.apply(null,this.data.subarray(this.pos,i));return this.pos=i+1,new Tn(In.string,t,s)}}const t=this.pos,e=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${Gn} unexpected end of unicode escape sequence at position ${this.pos}`);let t=0;for(let e=0;e<4;e++){let e=this.ch();if(e>=48&&e<=57)e-=48;else if(e>=97&&e<=102)e=e-97+10;else{if(!(e>=65&&e<=70))throw new Error(`${Gn} unexpected unicode escape character at position ${this.pos}`);e=e-65+10}t=16*t+e,this.pos++}return t},r=()=>{const t=this.ch();let n,r,i,s,o=null,a=t>239?4:t>223?3:t>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${Gn} unexpected unicode sequence at position ${this.pos}`);switch(a){case 1:t<128&&(o=t);break;case 2:n=this.data[this.pos+1],128===(192&n)&&(s=(31&t)<<6|63&n,s>127&&(o=s));break;case 3:n=this.data[this.pos+1],r=this.data[this.pos+2],128===(192&n)&&128===(192&r)&&(s=(15&t)<<12|(63&n)<<6|63&r,s>2047&&(s<55296||s>57343)&&(o=s));break;case 4:n=this.data[this.pos+1],r=this.data[this.pos+2],i=this.data[this.pos+3],128===(192&n)&&128===(192&r)&&128===(192&i)&&(s=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&i,s>65535&&s<1114112&&(o=s))}null===o?(o=65533,a=1):o>65535&&(o-=65536,e.push(o>>>10&1023|55296),o=56320|1023&o),e.push(o),this.pos+=a};while(!this.done()){const i=this.ch();let s;switch(i){case 92:if(this.pos++,this.done())throw new Error(`${Gn} unexpected string termination at position ${this.pos}`);switch(s=this.ch(),this.pos++,s){case 34:case 39:case 92:case 47:e.push(s);break;case 98:e.push(8);break;case 116:e.push(9);break;case 110:e.push(10);break;case 102:e.push(12);break;case 114:e.push(13);break;case 117:e.push(n());break;default:throw new Error(`${Gn} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new Tn(In.string,Hn(e),this.pos-t);default:if(i<32)throw new Error(`${Gn} invalid control character at position ${this.pos}`);i<128?(e.push(i),this.pos++):r()}}throw new Error(`${Gn} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new Tn(In.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new Tn(In.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new Tn(In["null"],null,4);case 102:return this.expect([102,97,108,115,101]),new Tn(In["false"],!1,5);case 116:return this.expect([116,114,117,101]),new Tn(In["true"],!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${Gn} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new Tn(In["break"],void 0,1);if(44!==this.ch())throw new Error(`${Gn} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new Tn(In["break"],void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new Tn(In["break"],void 0,1);if(44!==this.ch())throw new Error(`${Gn} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new Tn(In["break"],void 0,1);const t=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${Gn} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),t}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${Gn} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function cs(t,e){return e=Object.assign({tokenizer:new as(t,e)},e),Hi(t,e)}function ls(t){if(t.asCID!==t&&t["/"]!==t.bytes)return null;const e=Me.asCID(t);if(!e)return null;const n=e.toString();return[new Tn(In.map,1/0,1),new Tn(In.string,"/",1),new Tn(In.string,n,n.length),new Tn(In["break"],void 0,1)]}function us(t){const e=Lt.encode(t).slice(1);return[new Tn(In.map,1/0,1),new Tn(In.string,"/",1),new Tn(In.map,1/0,1),new Tn(In.string,"bytes",5),new Tn(In.string,e,e.length),new Tn(In["break"],void 0,1),new Tn(In["break"],void 0,1)]}function hs(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function ds(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const fs={typeEncoders:{Object:ls,Uint8Array:us,Buffer:us,undefined:hs,number:ds}};class ps extends as{constructor(t,e){super(t,e),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const t=this._next();if(t.type===In.map){const t=this._next();if(t.type===In.string&&"/"===t.value){const t=this._next();if(t.type===In.string){const e=this._next();if(e.type!==In["break"])throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(t),new Tn(In.tag,42,0)}if(t.type===In.map){const t=this._next();if(t.type===In.string&&"bytes"===t.value){const t=this._next();if(t.type===In.string){for(let t=0;t<2;t++){const t=this._next();if(t.type!==In["break"])throw new Error("Invalid encoded Bytes form")}const e=Lt.decode(`m${t.value}`);return new Tn(In.bytes,e,t.value.length)}this.tokenBuffer.push(t)}this.tokenBuffer.push(t)}this.tokenBuffer.push(t)}this.tokenBuffer.push(t)}return t}}const gs={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};gs.tags[42]=Me.parse;const ms="dag-json",ys=297,ws=t=>os(t,fs),bs=t=>{const e=Object.assign(gs,{tokenizer:new ps(t,gs)});return cs(t,e)},vs=t=>Es.decode(ws(t)),Es=new TextDecoder,_s=t=>bs(Ss.encode(t)),Ss=new TextEncoder;function As(t){return Ut.encode(t).slice(1)}function Cs(t){return Ut.decode(`u${t}`)}function Is(t){const[e,n,r]=t;return{payload:n,signatures:[{protected:e,signature:r}],link:Me.decode(Cs(n))}}function Ts(t){const e={signature:Cs(t.signature)};return t.header&&(e.header=t.header),t.protected&&(e.protected=Cs(t.protected)),e}function ks(t){const e=Cs(t.payload);try{Me.decode(e)}catch(n){throw new Error("Not a valid DagJWS")}return{payload:e,signatures:t.signatures.map(Ts)}}function Rs(t){const e={signature:As(t.signature)};return t.header&&(e.header=t.header),t.protected&&(e.protected=As(t.protected)),e}function Ns(t){const e={payload:As(t.payload),signatures:t.signatures.map(Rs)};return e.link=Me.decode(new Uint8Array(t.payload)),e}function Ds(t){const[e,n,r,i,s]=t,o={ciphertext:i,iv:r,protected:e,tag:s};return n&&(o.recipients=[{encrypted_key:n}]),o}function Os(t){const e={};return t.encrypted_key&&(e.encrypted_key=Cs(t.encrypted_key)),t.header&&(e.header=t.header),e}function Ps(t){const e={ciphertext:Cs(t.ciphertext),protected:Cs(t.protected),iv:Cs(t.iv),tag:Cs(t.tag)};return t.aad&&(e.aad=Cs(t.aad)),t.recipients&&(e.recipients=t.recipients.map(Os)),t.unprotected&&(e.unprotected=t.unprotected),e}function xs(t){const e={};return t.encrypted_key&&(e.encrypted_key=As(t.encrypted_key)),t.header&&(e.header=t.header),e}function Ms(t){const e={ciphertext:As(t.ciphertext),protected:As(t.protected),iv:As(t.iv),tag:As(t.tag)};return t.aad&&(e.aad=As(t.aad)),t.recipients&&(e.recipients=t.recipients.map(xs)),t.unprotected&&(e.unprotected=t.unprotected),e}const Ls="dag-jose",Bs=133;function Us(t){return"payload"in t&&"string"===typeof t.payload&&"signatures"in t&&Array.isArray(t.signatures)}function Fs(t){return"payload"in t&&t.payload instanceof Uint8Array&&"signatures"in t&&Array.isArray(t.signatures)}function zs(t){return"ciphertext"in t&&t.ciphertext instanceof Uint8Array&&"iv"in t&&t.iv instanceof Uint8Array&&"protected"in t&&t.protected instanceof Uint8Array&&"tag"in t&&t.tag instanceof Uint8Array}function Vs(t){return"ciphertext"in t&&"string"===typeof t.ciphertext&&"iv"in t&&"string"===typeof t.iv&&"protected"in t&&"string"===typeof t.protected&&"tag"in t&&"string"===typeof t.tag}function js(t){if("string"===typeof t){const e=t.split(".");if(3===e.length)return Is(e);if(5===e.length)return Ds(e);throw new Error("Not a valid JOSE string")}if(Us(t)||Vs(t))return t;throw new Error("Not a valid unencoded JOSE object")}function Hs(t){let e;if("string"===typeof t&&(t=js(t)),Us(t))e=ks(t);else{if(!Vs(t))throw new Error("Not a valid JOSE object");e=Ps(t)}return new Uint8Array(Zi(e))}function $s(t){let e;try{e=ts(t)}catch(n){throw new Error("Not a valid DAG-JOSE object")}if(Fs(e))return Ns(e);if(zs(e))return Ms(e);throw new Error("Not a valid DAG-JOSE object")}const Ks=0,Gs="identity",qs=dt,Ws=t=>ke(Ks,qs(t)),Ys={code:Ks,name:Gs,encode:qs,digest:Ws},Xs=vt({prefix:"\0",name:"identity",encode:t=>pt(t),decode:t=>ft(t)}),Qs=At({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Js=At({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Zs=Et({prefix:"9",name:"base10",alphabet:"0123456789"}),to=At({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),eo=At({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),no=Et({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ro=Et({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),io=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),so=io.reduce(((t,e,n)=>(t[n]=e,t)),[]),oo=io.reduce(((t,e,n)=>(t[e.codePointAt(0)]=n,t)),[]);function ao(t){return t.reduce(((t,e)=>(t+=so[e],t)),"")}function co(t){const e=[];for(const n of t){const t=oo[n.codePointAt(0)];if(void 0===t)throw new Error(`Non-base256emoji character: ${n}`);e.push(t)}return new Uint8Array(e)}const lo=vt({prefix:"🚀",name:"base256emoji",encode:ao,decode:co}),uo=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),ho=es({name:"sha2-256",code:18,encode:uo("SHA-256")}),fo=es({name:"sha2-512",code:19,encode:uo("SHA-512")}),po="raw",go=85,mo=t=>dt(t),yo=t=>dt(t),wo=new TextEncoder,bo=new TextDecoder,vo="json",Eo=512,_o=t=>wo.encode(JSON.stringify(t)),So=t=>JSON.parse(bo.decode(t)),Ao={...h,...d,...f,...p,...g,...i,...m,...r,...s,...y},Co={...w,...u},Io={raw:b,json:v};function To(){}class ko extends Error{constructor(t="not initialized"){super(t),this.name="NotInitializedError",this.code=ko.code}}ko.code="ERR_NOT_INITIALIZED";class Ro extends Error{constructor(t="cannot initialize an initializing node"){super(t),this.name="AlreadyInitializingError",this.code=No.code}}Ro.code="ERR_ALREADY_INITIALIZING";class No extends Error{constructor(t="cannot re-initialize an initialized node"){super(t),this.name="AlreadyInitializedError",this.code=No.code}}No.code="ERR_ALREADY_INITIALIZED";class Do extends Error{constructor(t="not started"){super(t),this.name="NotStartedError",this.code=Do.code}}Do.code="ERR_NOT_STARTED";class Oo extends Error{constructor(t="cannot start, already startin"){super(t),this.name="AlreadyStartingError",this.code=Oo.code}}Oo.code="ERR_ALREADY_STARTING";class Po extends Error{constructor(t="cannot start, already started"){super(t),this.name="AlreadyStartedError",this.code=Po.code}}Po.code="ERR_ALREADY_STARTED";class xo extends Error{constructor(t="not enabled"){super(t),this.name="NotEnabledError",this.code=xo.code}}function Mo(t){return null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Lo(t=0){return null!=globalThis.Buffer?.alloc?Mo(globalThis.Buffer.alloc(t)):new Uint8Array(t)}function Bo(t=0){return null!=globalThis.Buffer?.allocUnsafe?Mo(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Uo(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}xo.code="ERR_NOT_ENABLED";const Fo=Uo("utf8","u",(t=>{const e=new TextDecoder("utf8");return"u"+e.decode(t)}),(t=>{const e=new TextEncoder;return e.encode(t.substring(1))})),zo=Uo("ascii","a",(t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}),(t=>{t=t.substring(1);const e=Bo(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e})),Vo={utf8:Fo,"utf-8":Fo,hex:Ao.base16,latin1:zo,ascii:zo,binary:zo,...Ao};var jo=Vo;function Ho(t,e="utf8"){const n=jo[e];if(null==n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${t}`):Mo(globalThis.Buffer.from(t,"utf-8"))}var $o=n(8957);n(541);function Ko(t){return Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ko(t)}function Go(t,e){if("object"!==Ko(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!==Ko(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function qo(t){var e=Go(t,"string");return"symbol"===Ko(e)?e:String(e)}function Wo(t,e,n){return e=qo(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class Yo{constructor(){Wo(this,"index",0),Wo(this,"input","")}new(t){return this.index=0,this.input=t,this}readAtomically(t){const e=this.index,n=t();return void 0===n&&(this.index=e),n}parseWith(t){const e=t();if(this.index===this.input.length)return e}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(t){return this.readAtomically((()=>{const e=this.readChar();if(e===t)return e}))}readSeparator(t,e,n){return this.readAtomically((()=>{if(!(e>0&&void 0===this.readGivenChar(t)))return n()}))}readNumber(t,e,n,r){return this.readAtomically((()=>{let i=0,s=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*r)-1;while(1){const n=this.readAtomically((()=>{const e=this.readChar();if(void 0===e)return;const n=Number.parseInt(e,t);return Number.isNaN(n)?void 0:n}));if(void 0===n)break;if(i*=t,i+=n,i>c)return;if(s+=1,void 0!==e&&s>e)return}return 0===s||!n&&a&&s>1?void 0:i}))}readIPv4Addr(){return this.readAtomically((()=>{const t=new Uint8Array(4);for(let e=0;e<t.length;e++){const n=this.readSeparator(".",e,(()=>this.readNumber(10,3,!1,1)));if(void 0===n)return;t[e]=n}return t}))}readIPv6Addr(){const t=t=>{for(let e=0;e<t.length/2;e++){const n=2*e;if(e<t.length-3){const r=this.readSeparator(":",e,(()=>this.readIPv4Addr()));if(void 0!==r)return t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2],t[n+3]=r[3],[n+4,!0]}const r=this.readSeparator(":",e,(()=>this.readNumber(16,4,!0,2)));if(void 0===r)return[n,!1];t[n]=r>>8,t[n+1]=255&r}return[t.length,!1]};return this.readAtomically((()=>{const e=new Uint8Array(16),[n,r]=t(e);if(16===n)return e;if(r)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const i=new Uint8Array(14),s=16-(n+2),[o]=t(i.subarray(0,s));return e.set(i.subarray(0,o),16-o),e}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const Xo=45,Qo=15,Jo=new Yo;function Zo(t){if(!(t.length>Qo))return Jo.new(t).parseWith((()=>Jo.readIPv4Addr()))}function ta(t){if(!(t.length>Xo))return Jo.new(t).parseWith((()=>Jo.readIPv6Addr()))}function ea(t){if(!(t.length>Xo))return Jo.new(t).parseWith((()=>Jo.readIPAddr()))}function na(t){return Boolean(Zo(t))}function ra(t){return Boolean(ta(t))}function ia(t){return Boolean(ea(t))}function sa(t,e="utf8"){const n=jo[e];if(null==n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(t).substring(1):globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8")}const oa=na,aa=ra,ca=function(t){let e=0;if(t=t.toString().trim(),oa(t)){const n=new Uint8Array(e+4);return t.split(/\./g).forEach((t=>{n[e++]=255&parseInt(t,10)})),n}if(aa(t)){const n=t.split(":",8);let r;for(r=0;r<n.length;r++){const t=oa(n[r]);let e;t&&(e=ca(n[r]),n[r]=sa(e.slice(0,2),"base16")),null!=e&&++r<8&&n.splice(r,0,sa(e.slice(2,4),"base16"))}if(""===n[0])while(n.length<8)n.unshift("0");else if(""===n[n.length-1])while(n.length<8)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);const t=[r,1];for(r=9-n.length;r>0;r--)t.push("0");n.splice.apply(n,t)}const i=new Uint8Array(e+16);for(r=0;r<n.length;r++){const t=parseInt(n[r],16);i[e++]=t>>8&255,i[e++]=255&t}return i}throw new Error("invalid ip address")},la=function(t,e=0,n){e=~~e,n=n??t.length-e;const r=new DataView(t.buffer);if(4===n){const r=[];for(let i=0;i<n;i++)r.push(t[e+i]);return r.join(".")}if(16===n){const t=[];for(let i=0;i<n;i+=2)t.push(r.getUint16(e+i).toString(16));return t.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},ua=-1,ha={},da={},fa=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ua,"ip6zone"],[53,ua,"dns",!0],[54,ua,"dns4",!0],[55,ua,"dns6",!0],[56,ua,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ua,"unix",!1,!0],[421,ua,"ipfs"],[421,ua,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ua,"garlic64"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,ua,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ua,"memory"]];function pa(t,e,n,r,i){return{code:t,size:e,name:n,resolvable:Boolean(r),path:Boolean(i)}}function ga(t){if("number"===typeof t){if(null!=da[t])return da[t];throw new Error(`no protocol with code: ${t}`)}if("string"===typeof t){if(null!=ha[t])return ha[t];throw new Error(`no protocol with name: ${t}`)}throw new Error("invalid protocol id type: "+typeof t)}fa.forEach((t=>{const e=pa(...t);da[e.code]=e,ha[e.name]=e}));var ma=n(1786);function ya(t,e){null==e&&(e=t.reduce(((t,e)=>t+e.length),0));const n=Bo(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return Mo(n)}function wa(t,e){const n=ga(t);switch(n.code){case 4:case 41:return Sa(e);case 6:case 273:case 33:case 132:return Ca(e).toString();case 53:case 54:case 55:case 56:case 400:case 777:return Ta(e);case 421:return Da(e);case 444:return xa(e);case 445:return xa(e);case 466:return Na(e);default:return sa(e,"base16")}}function ba(t,e){const n=ga(t);switch(n.code){case 4:return _a(e);case 41:return _a(e);case 6:case 273:case 33:case 132:return Aa(parseInt(e,10));case 53:case 54:case 55:case 56:case 400:case 777:return Ia(e);case 421:return ka(e);case 444:return Oa(e);case 445:return Pa(e);case 466:return Ra(e);default:return Ho(e,"base16")}}const va=Object.values(Ao).map((t=>t.decoder)),Ea=function(){let t=va[0].or(va[1]);return va.slice(2).forEach((e=>t=t.or(e))),t}();function _a(t){if(!ia(t))throw new Error("invalid ip address");return ca(t)}function Sa(t){const e=la(t,0,t.length);if(null==e)throw new Error("ipBuff is required");if(!ia(e))throw new Error("invalid ip address");return e}function Aa(t){const e=new ArrayBuffer(2),n=new DataView(e);return n.setUint16(0,t),new Uint8Array(e)}function Ca(t){const e=new DataView(t.buffer);return e.getUint16(t.byteOffset)}function Ia(t){const e=Ho(t),n=Uint8Array.from(ma.encode(e.length));return ya([n,e],n.length+e.length)}function Ta(t){const e=ma.decode(t);if(t=t.slice(ma.decode.bytes),t.length!==e)throw new Error("inconsistent lengths");return sa(t)}function ka(t){let e;e="Q"===t[0]||"1"===t[0]?Re(Ct.decode(`z${t}`)).bytes:Me.parse(t).multihash.bytes;const n=Uint8Array.from(ma.encode(e.length));return ya([n,e],n.length+e.length)}function Ra(t){const e=Ea.decode(t),n=Uint8Array.from(ma.encode(e.length));return ya([n,e],n.length+e.length)}function Na(t){const e=ma.decode(t),n=t.slice(ma.decode.bytes);if(n.length!==e)throw new Error("inconsistent lengths");return"u"+sa(n,"base64url")}function Da(t){const e=ma.decode(t),n=t.slice(ma.decode.bytes);if(n.length!==e)throw new Error("inconsistent lengths");return sa(n,"base58btc")}function Oa(t){const e=t.split(":");if(2!==e.length)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(16!==e[0].length)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const n=Tt.decode("b"+e[0]),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const i=Aa(r);return ya([n,i],n.length+i.length)}function Pa(t){const e=t.split(":");if(2!==e.length)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(56!==e[0].length)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const n=Tt.decode(`b${e[0]}`),r=parseInt(e[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const i=Aa(r);return ya([n,i],n.length+i.length)}function xa(t){const e=t.slice(0,t.length-2),n=t.slice(t.length-2),r=sa(e,"base32"),i=Ca(n);return`${r}:${i}`}function Ma(t){const e=[],n=t.split("/").slice(1);if(1===n.length&&""===n[0])return[];for(let r=0;r<n.length;r++){const i=n[r],s=ga(i);if(0!==s.size){if(r++,r>=n.length)throw Wa("invalid address: "+t);if(!0===s.path){e.push([i,qa(n.slice(r).join("/"))]);break}e.push([i,n[r]])}else e.push([i])}return e}function La(t){const e=[];return t.map((t=>{const n=Ya(t);return e.push(n.name),t.length>1&&null!=t[1]&&e.push(t[1]),null})),qa(e.join("/"))}function Ba(t){return t.map((t=>{Array.isArray(t)||(t=[t]);const e=Ya(t);return t.length>1?[e.code,ba(e.code,t[1])]:[e.code]}))}function Ua(t){return t.map((t=>{const e=Ya(t);return null!=t[1]?[e.code,wa(e.code,t[1])]:[e.code]}))}function Fa(t){return Ka(ya(t.map((t=>{const e=Ya(t);let n=Uint8Array.from(ma.encode(e.code));return t.length>1&&null!=t[1]&&(n=ya([n,t[1]])),n}))))}function za(t,e){if(t.size>0)return t.size/8;if(0===t.size)return 0;{const t=ma.decode(e);return t+(ma.decode.bytes??0)}}function Va(t){const e=[];let n=0;while(n<t.length){const r=ma.decode(t,n),i=ma.decode.bytes??0,s=ga(r),o=za(s,t.slice(n+i));if(0===o){e.push([r]),n+=i;continue}const a=t.slice(n+i,n+i+o);if(n+=o+i,n>t.length)throw Wa("Invalid address Uint8Array: "+sa(t,"base16"));e.push([r,a])}return e}function ja(t){const e=Va(t),n=Ua(e);return La(n)}function Ha(t){t=qa(t);const e=Ma(t),n=Ba(e);return Fa(n)}function $a(t){return Ha(t)}function Ka(t){const e=Ga(t);if(null!=e)throw e;return Uint8Array.from(t)}function Ga(t){try{Va(t)}catch(uS){return uS}}function qa(t){return"/"+t.trim().split("/").filter((t=>t)).join("/")}function Wa(t){return new Error("Error parsing address: "+t)}function Ya(t){const e=ga(t[0]);return e}function Xa(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0}var Qa,Ja,Za,tc,ec=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)},nc=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n};const rc=Symbol.for("nodejs.util.inspect.custom"),ic=[ga("dns").code,ga("dns4").code,ga("dns6").code,ga("dnsaddr").code],sc=[ga("p2p").code,ga("ipfs").code],oc=new Map,ac=Symbol.for("@multiformats/js-multiaddr/multiaddr");function cc(t,e){if(null==t)throw new Error("requires node address object");if(null==e)throw new Error("requires transport protocol");let n;switch(t.family){case 4:n="ip4";break;case 6:n="ip6";break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new hc("/"+[n,t.address,e,t.port].join("/"))}function lc(t){return!!uc(t)&&t.protos().some((t=>t.resolvable))}function uc(t){return Boolean(t?.[ac])}class hc{constructor(t){if(Qa.set(this,void 0),Ja.set(this,void 0),Za.set(this,void 0),this[tc]=!0,null==t&&(t=""),t instanceof Uint8Array)this.bytes=Ka(t);else if("string"===typeof t){if(t.length>0&&"/"!==t.charAt(0))throw new Error(`multiaddr "${t}" must start with a "/"`);this.bytes=$a(t)}else{if(!uc(t))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=Ka(t.bytes)}}toString(){return null==ec(this,Qa,"f")&&nc(this,Qa,ja(this.bytes),"f"),ec(this,Qa,"f")}toJSON(){return this.toString()}toOptions(){const t=this.protoCodes(),e=this.toString().split("/").slice(1);let n,r;if(e.length>2)ic.includes(t[0])&&sc.includes(t[1])?(n=ga("tcp").name,r=443):(n=ga(e[2]).name,r=parseInt(e[3]));else{if(!ic.includes(t[0]))throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');n=ga("tcp").name,r=443}const i={family:41===t[0]||55===t[0]?6:4,host:e[1],transport:n,port:r};return i}protos(){return this.protoCodes().map((t=>Object.assign({},ga(t))))}protoCodes(){const t=[],e=this.bytes;let n=0;while(n<e.length){const r=ma.decode(e,n),i=ma.decode.bytes??0,s=ga(r),o=za(s,e.slice(n+i));n+=o+i,t.push(r)}return t}protoNames(){return this.protos().map((t=>t.name))}tuples(){return null==ec(this,Ja,"f")&&nc(this,Ja,Va(this.bytes),"f"),ec(this,Ja,"f")}stringTuples(){return null==ec(this,Za,"f")&&nc(this,Za,Ua(this.tuples()),"f"),ec(this,Za,"f")}encapsulate(t){return t=new hc(t),new hc(this.toString()+t.toString())}decapsulate(t){const e=t.toString(),n=this.toString(),r=n.lastIndexOf(e);if(r<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${t.toString()}`);return new hc(n.slice(0,r))}decapsulateCode(t){const e=this.tuples();for(let n=e.length-1;n>=0;n--)if(e[n][0]===t)return new hc(Fa(e.slice(0,n)));return this}getPeerId(){try{const t=this.stringTuples().filter((t=>t[0]===ha.ipfs.code)),e=t.pop();if(null!=e?.[1]){const t=e[1];return"Q"===t[0]||"1"===t[0]?sa(Ct.decode(`z${t}`),"base58btc"):sa(Me.parse(t).multihash.bytes,"base58btc")}return null}catch(t){return null}}getPath(){let t=null;try{t=this.stringTuples().filter((t=>{const e=ga(t[0]);return!0===e.path}))[0][1],null==t&&(t=null)}catch{t=null}return t}equals(t){return Xa(this.bytes,t.bytes)}async resolve(t){const e=this.protos().find((t=>t.resolvable));if(null==e)return[this];const n=oc.get(e.name);if(null==n)throw Vt(new Error(`no available resolver for ${e.name}`),"ERR_NO_AVAILABLE_RESOLVER");const r=await n(this,t);return r.map((t=>new hc(t)))}nodeAddress(){const t=this.toOptions();if("tcp"!==t.transport&&"udp"!==t.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${t.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:t.family,address:t.host,port:t.port}}isThinWaistAddress(t){const e=(t??this).protos();return 2===e.length&&((4===e[0].code||41===e[0].code)&&(6===e[1].code||273===e[1].code))}[(Qa=new WeakMap,Ja=new WeakMap,Za=new WeakMap,tc=ac,rc)](){return`Multiaddr(${ja(this.bytes)})`}}function dc(t){return new hc(t)}const fc=Uc("dns4"),pc=Uc("dns6"),gc=Uc("dnsaddr"),mc=Bc(Uc("dns"),gc,fc,pc),yc=Bc(Uc("ip4"),Uc("ip6")),wc=Bc(Lc(yc,Uc("tcp")),Lc(mc,Uc("tcp"))),bc=Lc(yc,Uc("udp")),vc=Lc(bc,Uc("utp")),Ec=Lc(bc,Uc("quic")),_c=Bc(Lc(wc,Uc("ws")),Lc(mc,Uc("ws"))),Sc=Bc(Lc(wc,Uc("wss")),Lc(mc,Uc("wss"))),Ac=Bc(Lc(wc,Uc("http")),Lc(yc,Uc("http")),Lc(mc,Uc("http"))),Cc=Bc(Lc(wc,Uc("https")),Lc(yc,Uc("https")),Lc(mc,Uc("https"))),Ic=Bc(Lc(_c,Uc("p2p-webrtc-star"),Uc("p2p")),Lc(Sc,Uc("p2p-webrtc-star"),Uc("p2p")),Lc(_c,Uc("p2p-webrtc-star")),Lc(Sc,Uc("p2p-webrtc-star"))),Tc=(Bc(Lc(_c,Uc("p2p-websocket-star"),Uc("p2p")),Lc(Sc,Uc("p2p-websocket-star"),Uc("p2p")),Lc(_c,Uc("p2p-websocket-star")),Lc(Sc,Uc("p2p-websocket-star"))),Bc(Lc(Ac,Uc("p2p-webrtc-direct"),Uc("p2p")),Lc(Cc,Uc("p2p-webrtc-direct"),Uc("p2p")),Lc(Ac,Uc("p2p-webrtc-direct")),Lc(Cc,Uc("p2p-webrtc-direct")))),kc=Bc(_c,Sc,Ac,Cc,Ic,Tc,wc,vc,Ec,mc),Rc=(Bc(Lc(kc,Uc("p2p-stardust"),Uc("p2p")),Lc(kc,Uc("p2p-stardust"))),Bc(Lc(kc,Uc("p2p")),Ic,Tc,Uc("p2p"))),Nc=Bc(Lc(Rc,Uc("p2p-circuit"),Rc),Lc(Rc,Uc("p2p-circuit")),Lc(Uc("p2p-circuit"),Rc),Lc(kc,Uc("p2p-circuit")),Lc(Uc("p2p-circuit"),kc),Uc("p2p-circuit")),Dc=()=>Bc(Lc(Nc,Dc),Nc),Oc=Dc(),Pc=Bc(Lc(Oc,Rc,Oc),Lc(Rc,Oc),Lc(Oc,Rc),Oc,Rc),xc=Pc;function Mc(t){function e(e){let n;try{n=dc(e)}catch(uS){return!1}const r=t(n.protoNames());return null!==r&&(!0===r||!1===r?r:0===r.length)}return e}function Lc(...t){function e(e){if(e.length<t.length)return null;let n=e;return t.some((t=>(n="function"===typeof t?t().partialMatch(e):t.partialMatch(e),Array.isArray(n)&&(e=n),null===n))),n}return{toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Mc(e),partialMatch:e}}function Bc(...t){function e(e){let n=null;return t.some((t=>{const r="function"===typeof t?t().partialMatch(e):t.partialMatch(e);return null!=r&&(n=r,!0)})),n}const n={toString:function(){return"{ "+t.join(" ")+" }"},input:t,matches:Mc(e),partialMatch:e};return n}function Uc(t){const e=t;function n(t){let n;try{n=dc(t)}catch(uS){return!1}const r=n.protoNames();return 1===r.length&&r[0]===e}function r(t){return 0===t.length?null:t[0]===e?t.slice(1):null}return{toString:function(){return e},matches:n,partialMatch:r}}var Fc=n(5248);const zc=/^\/(ip[fn]s)\/([^/?#]+)/,Vc=1,jc=2,Hc=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/,$c=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function Kc(t){try{return Wc(t)?Boolean(Me.parse(t)):t instanceof Uint8Array?Boolean(Me.decode(t)):Boolean(Me.asCID(t))}catch{return!1}}function Gc(t,e,n=Vc,r=jc){const i=Yc(t);if(!1===i)return!1;const s=i.match(e);if(null==s)return!1;if("ipfs"!==s[n])return!1;let o=s[r];return null!=o&&e===Hc&&(o=o.toLowerCase()),Kc(o)}function qc(t,e,n=Vc,r=jc){const i=Yc(t);if(!1===i)return!1;const s=i.match(e);if(null==s)return!1;if("ipns"!==s[n])return!1;let o=s[r];if(null!=o&&e===Hc){if(o=o.toLowerCase(),Kc(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));const{hostname:t}=new Fc.URL(`http://${o}`);return $c.test(t)}catch(a){return!1}}return!0}function Wc(t){return"string"===typeof t}function Yc(t){return t instanceof Uint8Array?sa(t,"base58btc"):!!Wc(t)&&t}const Xc=t=>Gc(t,zc)||qc(t,zc),Qc=t=>Gc(t,zc),Jc=t=>qc(t,zc);let Zc=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce(((t,e)=>(e&=63,t+=e<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_",t)),"");const tl="/",el=(new TextEncoder).encode(tl),nl=el[0];class rl{constructor(t,e){if("string"===typeof t)this._buf=Ho(t);else{if(!(t instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=t}if(null==e&&(e=!0),e&&this.clean(),0===this._buf.byteLength||this._buf[0]!==nl)throw new Error("Invalid key")}toString(t="utf8"){return sa(this._buf,t)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(t){return new rl(t.join(tl))}static random(){return new rl(Zc().replace(/-/g,""))}static asKey(t){return t instanceof Uint8Array||"string"===typeof t?new rl(t):"function"===typeof t.uint8Array?new rl(t.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=el),this._buf[0]!==nl){const t=new Uint8Array(this._buf.byteLength+1);t.fill(nl,0,1),t.set(this._buf,1),this._buf=t}while(this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===nl)this._buf=this._buf.subarray(0,-1)}less(t){const e=this.list(),n=t.list();for(let r=0;r<e.length;r++){if(n.length<r+1)return!1;const t=e[r],i=n[r];if(t<i)return!0;if(t>i)return!1}return e.length<n.length}reverse(){return rl.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const t=this.namespaces();return t[t.length-1]}list(){return this.toString().split(tl).slice(1)}type(){return il(this.baseNamespace())}name(){return sl(this.baseNamespace())}instance(t){return new rl(this.toString()+":"+t)}path(){let t=this.parent().toString();return t.endsWith(tl)||(t+=tl),t+=this.type(),new rl(t)}parent(){const t=this.list();return 1===t.length?new rl(tl):new rl(t.slice(0,-1).join(tl))}child(t){return this.toString()===tl?t:t.toString()===tl?this:new rl(this.toString()+t.toString(),!1)}isAncestorOf(t){return t.toString()!==this.toString()&&t.toString().startsWith(this.toString())}isDecendantOf(t){return t.toString()!==this.toString()&&this.toString().startsWith(t.toString())}isTopLevel(){return 1===this.list().length}concat(...t){return rl.withNamespaces([...this.namespaces(),...ol(t.map((t=>t.namespaces())))])}}function il(t){const e=t.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function sl(t){const e=t.split(":");return e[e.length-1]}function ol(t){return[].concat(...t)}var al=n(3162);let cl=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/giu;function ll(t="",e="ms"){var n=null;return t=(t+"").replace(/(\d)[,_](\d)/g,"$1$2"),t.replace(cl,(function(t,e,r){r=ul(r),r&&(n=(n||0)+parseFloat(e,10)*r)})),n&&n/(ul(e)||1)}function ul(t){return ll[t]||ll[t.toLowerCase().replace(/s$/,"")]}ll.nanosecond=ll.ns=1e-6,ll["µs"]=ll["μs"]=ll.us=ll.microsecond=.001,ll.millisecond=ll.ms=ll[""]=1,ll.second=ll.sec=ll.s=1e3*ll.ms,ll.minute=ll.min=ll.m=60*ll.s,ll.hour=ll.hr=ll.h=60*ll.m,ll.day=ll.d=24*ll.h,ll.week=ll.wk=ll.w=7*ll.d,ll.month=ll.b=30.4375*ll.d,ll.year=ll.yr=ll.y=365.25*ll.d;var hl=ll;class dl extends Error{constructor(t="request timed out"){super(t),this.name="TimeoutError",this.code=dl.code}}function fl(t,e){return(...n)=>{const r=n[null==e?n.length-1:e];if(!r||!r.timeout)return t(...n);const i="string"===typeof r.timeout?hl(r.timeout):r.timeout,s=new $o.TimeoutController(i);r.signal=(0,al.anySignal)([r.signal,s.signal]);const o=t(...n),a=new Promise(((t,e)=>{s.signal.addEventListener("abort",(()=>{e(new dl)}))})),c=Date.now(),l=()=>{if(s.signal.aborted)throw new dl;const t=Date.now()-c;if(t>i)throw s.abort(),new dl};return o[Symbol.asyncIterator]?async function*(){const t=o[Symbol.asyncIterator]();try{while(1){const{value:e,done:n}=await Promise.race([t.next(),a]);if(n)break;l(),yield e}}catch(uS){throw l(),uS}finally{s.clear(),t.return&&t.return()}}():(async()=>{try{const t=await Promise.race([o,a]);return l(),t}catch(uS){throw l(),uS}finally{s.clear()}})()}}dl.code="ERR_TIMEOUT";const pl="/ipfs/";function gl(t){if(t instanceof Uint8Array)try{t=Me.decode(t)}catch(uS){throw Vt(uS,"ERR_INVALID_CID")}let e=Me.asCID(t);if(e)return{cid:e,path:void 0};t=t.toString(),t.startsWith(pl)&&(t=t.substring(pl.length));const n=t.split("/");let r;try{e=Me.parse(n.shift()||"")}catch(uS){throw Vt(uS,"ERR_INVALID_CID")}return n.length&&(r=`/${n.join("/")}`),{cid:e,path:r}}const ml="ERR_BAD_PATH",yl="This command must be run in online mode. Try running 'ipfs daemon' first.",wl=new rl("/local/filesroot"),bl=262144,vl=t=>{const e=Me.asCID(t);if(e)return`/ipfs/${t}`;const n=t.toString();try{return`/ipfs/${Me.parse(n)}`}catch{}if(Xc(n))return n;throw Vt(new Error(`invalid path: ${t}`),ml)},El=t=>t instanceof Uint8Array?Me.decode(t).toString():(t=t.toString(),0===t.indexOf("/ipfs/")&&(t=t.substring("/ipfs/".length)),"/"===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1)),t),_l=async function(t,e,n,r={}){const{cid:i,path:s}=gl(n);s&&(r.path=s);let o=i,a=r.path||"";if(a.startsWith("/")&&(a=a.substring(1)),r.path)try{for await(const{value:n,remainderPath:s}of Cl(i,r.path,e,t,{signal:r.signal})){if(!Me.asCID(n))break;a=s,o=n}}catch(uS){throw uS.message.startsWith("Object has no property")&&(uS.message=`no link named "${a.split("/")[0]}" under ${o}`,uS.code="ERR_NO_LINK"),uS}return{cid:o,remainderPath:a||""}},Sl=t=>{if("file"!==t.type&&"directory"!==t.type&&"raw"!==t.type)throw new Error(`Unknown node type '${t.type}'`);const e={cid:t.cid,path:t.path,name:t.name,size:t.size,type:"file"};return"directory"===t.type&&(e.type="dir"),"file"===t.type&&(e.size=t.unixfs.fileSize()),"file"!==t.type&&"directory"!==t.type||(e.mode=t.unixfs.mode,void 0!==t.unixfs.mtime&&(e.mtime=t.unixfs.mtime)),e},Al=fl((async(t,e)=>await t)),Cl=async function*(t,e,n,r,i){const s=async t=>{const e=await n.getCodec(t.code),s=await r.blocks.get(t,i);return e.decode(s)},o=e.split("/").filter(Boolean);let a=await s(t),c=t;while(o.length){const n=o.shift();if(!n)throw Vt(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(t.code===wn&&Array.isArray(a.Links)){const t=a.Links.find((t=>t.Name===n));if(t){yield{value:t.Hash,remainderPath:o.join("/")},a=await s(t.Hash),c=t.Hash;continue}}if(!Object.prototype.hasOwnProperty.call(a,n))throw Vt(new Error(`no link named "${n}" under ${c}`),"ERR_NO_LINK");a=a[n],yield{value:a,remainderPath:o.join("/")},Me.asCID(a)&&(c=a,a=await s(a))}yield{value:a,remainderPath:""}};class Il{static create({start:t,stop:e}){return new Il(t,e)}static async start(t,e){const{state:n,activate:r}=t;switch(n.status){case"stopped":try{const n=r(e);t.state={status:"starting",ready:n};const i=await n;return t.state={status:"started",value:i},i}catch(i){throw t.state={status:"stopped"},i}case"starting":throw new Oo;case"started":throw new Po;case"stopping":return await n.ready,await Il.start(t,e);default:return Il.panic(t)}}static async stop(t){const{state:e,deactivate:n}=t;switch(e.status){case"stopped":break;case"starting":try{await e.ready}catch(r){}return await Il.stop(t);case"stopping":return await e.ready;case"started":n&&await n(e.value),t.state={status:"stopped"};break;default:Il.panic(e)}}static try({state:t}){switch(t.status){case"started":return t.value;default:return null}}static async use({state:t},e){switch(t.status){case"started":return t.value;case"starting":return await Al(t.ready,e);default:throw new Do}}static panic({state:t}){const e=JSON.stringify({status:t.status});throw RangeError(`Service in invalid state ${e}, should never happen if you see this please report a bug`)}constructor(t,e){this.activate=t,this.deactivate=e,this.state={status:"stopped"}}async use(t){return await Il.use(this,t)}try(){return Il.try(this)}}function Tl({network:t,preload:e,peerId:n,keychain:r,repo:i,ipns:s,mfsPreload:o,print:a,hashers:c,options:l}){const u=async()=>{const{libp2p:u}=await Il.start(t,{peerId:n,repo:i,print:a,hashers:c,options:l});await Promise.all([s.startOnline({keychain:r,libp2p:u,peerId:n,repo:i}),e.start(),o.start()])};return u}function kl({network:t,preload:e,ipns:n,repo:r,mfsPreload:i}){const s=async()=>{await Promise.all([e.stop(),n.stop(),i.stop()]),await Il.stop(t),await r.close()};return s}var Rl=n(5470);class Nl{constructor(t){this.lru=Rl(t)}get(t){const e=this.lru.get(t);if(e)return e.expire&&e.expire<Date.now()?void this.lru.remove(t):e.value}set(t,e,n){this.lru.set(t,{value:e,expire:Date.now()+n})}has(t){const e=this.get(t);return!!e}remove(t){this.lru.remove(t)}clear(){this.lru.clear()}}var Dl=n(9835);n(2801);class Ol extends Error{constructor(t){super(t),this.name="TimeoutError"}}class Pl extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const xl=t=>void 0===globalThis.DOMException?new Pl(t):new DOMException(t),Ml=t=>{const e=void 0===t.reason?xl("This operation was aborted."):t.reason;return e instanceof Error?e:xl(e)};function Ll(t,e,n,r){let i;const s=new Promise(((s,o)=>{if("number"!==typeof e||1!==Math.sign(e))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e!==Number.POSITIVE_INFINITY){if(r={customTimers:{setTimeout:setTimeout,clearTimeout:clearTimeout},...r},r.signal){const{signal:t}=r;t.aborted&&o(Ml(t)),t.addEventListener("abort",(()=>{o(Ml(t))}))}i=r.customTimers.setTimeout.call(void 0,(()=>{if("function"===typeof n){try{s(n())}catch(a){o(a)}return}const r="string"===typeof n?n:`Promise timed out after ${e} milliseconds`,i=n instanceof Error?n:new Ol(r);"function"===typeof t.cancel&&t.cancel(),o(i)}),e),(async()=>{try{s(await t)}catch(e){o(e)}finally{r.customTimers.clearTimeout.call(void 0,i)}})()}else s(t)}));return s.clear=()=>{clearTimeout(i),i=void 0},s}function Bl(t,e,n){let r=0,i=t.length;while(i>0){const s=Math.trunc(i/2);let o=r+s;n(t[o],e)<=0?(r=++o,i-=s+1):i=s}return r}var Ul,Fl=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class zl{constructor(){Ul.set(this,[])}enqueue(t,e){e={priority:0,...e};const n={priority:e.priority,run:t};if(this.size&&Fl(this,Ul,"f")[this.size-1].priority>=e.priority)return void Fl(this,Ul,"f").push(n);const r=Bl(Fl(this,Ul,"f"),n,((t,e)=>e.priority-t.priority));Fl(this,Ul,"f").splice(r,0,n)}dequeue(){const t=Fl(this,Ul,"f").shift();return null===t||void 0===t?void 0:t.run}filter(t){return Fl(this,Ul,"f").filter((e=>e.priority===t.priority)).map((t=>t.run))}get size(){return Fl(this,Ul,"f").length}}Ul=new WeakMap;var Vl,jl,Hl,$l,Kl,Gl,ql,Wl,Yl,Xl,Ql,Jl,Zl,tu,eu,nu,ru,iu,su,ou,au,cu,lu,uu,hu,du,fu=function(t,e,n,r,i){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!i)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof e?t!==e||!i:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?i.call(t,n):i?i.value=n:e.set(t,n),n},pu=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};const gu=new Ol;class mu extends Error{}class yu extends Dl{constructor(t){var e,n,r,i;if(super(),Vl.add(this),jl.set(this,void 0),Hl.set(this,void 0),$l.set(this,0),Kl.set(this,void 0),Gl.set(this,void 0),ql.set(this,0),Wl.set(this,void 0),Yl.set(this,void 0),Xl.set(this,void 0),Ql.set(this,void 0),Jl.set(this,0),Zl.set(this,void 0),tu.set(this,void 0),eu.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:zl,...t},!("number"===typeof t.intervalCap&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(e=t.intervalCap)||void 0===e?void 0:e.toString())&&void 0!==n?n:""}\` (${typeof t.intervalCap})`);if(void 0===t.interval||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(i=null===(r=t.interval)||void 0===r?void 0:r.toString())&&void 0!==i?i:""}\` (${typeof t.interval})`);fu(this,jl,t.carryoverConcurrencyCount,"f"),fu(this,Hl,t.intervalCap===Number.POSITIVE_INFINITY||0===t.interval,"f"),fu(this,Kl,t.intervalCap,"f"),fu(this,Gl,t.interval,"f"),fu(this,Xl,new t.queueClass,"f"),fu(this,Ql,t.queueClass,"f"),this.concurrency=t.concurrency,this.timeout=t.timeout,fu(this,eu,!0===t.throwOnTimeout,"f"),fu(this,tu,!1===t.autoStart,"f")}get concurrency(){return pu(this,Zl,"f")}set concurrency(t){if(!("number"===typeof t&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);fu(this,Zl,t,"f"),pu(this,Vl,"m",hu).call(this)}async add(t,e={}){return new Promise(((n,r)=>{const i=async()=>{var i,s,o;fu(this,Jl,(s=pu(this,Jl,"f"),s++,s),"f"),fu(this,$l,(o=pu(this,$l,"f"),o++,o),"f");try{if(null===(i=e.signal)||void 0===i?void 0:i.aborted)return void r(new mu("The task was aborted."));const s=void 0===this.timeout&&void 0===e.timeout?t({signal:e.signal}):Ll(Promise.resolve(t({signal:e.signal})),void 0===e.timeout?this.timeout:e.timeout,(()=>{(void 0===e.throwOnTimeout?pu(this,eu,"f"):e.throwOnTimeout)&&r(gu)})),o=await s;n(o),this.emit("completed",o)}catch(a){r(a),this.emit("error",a)}pu(this,Vl,"m",iu).call(this)};pu(this,Xl,"f").enqueue(i,e),pu(this,Vl,"m",cu).call(this),this.emit("add")}))}async addAll(t,e){return Promise.all(t.map((async t=>this.add(t,e))))}start(){return pu(this,tu,"f")?(fu(this,tu,!1,"f"),pu(this,Vl,"m",hu).call(this),this):this}pause(){fu(this,tu,!0,"f")}clear(){fu(this,Xl,new(pu(this,Ql,"f")),"f")}async onEmpty(){0!==pu(this,Xl,"f").size&&await pu(this,Vl,"m",du).call(this,"empty")}async onSizeLessThan(t){pu(this,Xl,"f").size<t||await pu(this,Vl,"m",du).call(this,"next",(()=>pu(this,Xl,"f").size<t))}async onIdle(){0===pu(this,Jl,"f")&&0===pu(this,Xl,"f").size||await pu(this,Vl,"m",du).call(this,"idle")}get size(){return pu(this,Xl,"f").size}sizeBy(t){return pu(this,Xl,"f").filter(t).length}get pending(){return pu(this,Jl,"f")}get isPaused(){return pu(this,tu,"f")}}jl=new WeakMap,Hl=new WeakMap,$l=new WeakMap,Kl=new WeakMap,Gl=new WeakMap,ql=new WeakMap,Wl=new WeakMap,Yl=new WeakMap,Xl=new WeakMap,Ql=new WeakMap,Jl=new WeakMap,Zl=new WeakMap,tu=new WeakMap,eu=new WeakMap,Vl=new WeakSet,nu=function(){return pu(this,Hl,"f")||pu(this,$l,"f")<pu(this,Kl,"f")},ru=function(){return pu(this,Jl,"f")<pu(this,Zl,"f")},iu=function(){var t;fu(this,Jl,(t=pu(this,Jl,"f"),t--,t),"f"),pu(this,Vl,"m",cu).call(this),this.emit("next")},su=function(){this.emit("empty"),0===pu(this,Jl,"f")&&this.emit("idle")},ou=function(){pu(this,Vl,"m",uu).call(this),pu(this,Vl,"m",lu).call(this),fu(this,Yl,void 0,"f")},au=function(){const t=Date.now();if(void 0===pu(this,Wl,"f")){const e=pu(this,ql,"f")-t;if(!(e<0))return void 0===pu(this,Yl,"f")&&fu(this,Yl,setTimeout((()=>{pu(this,Vl,"m",ou).call(this)}),e),"f"),!0;fu(this,$l,pu(this,jl,"f")?pu(this,Jl,"f"):0,"f")}return!1},cu=function(){if(0===pu(this,Xl,"f").size)return pu(this,Wl,"f")&&clearInterval(pu(this,Wl,"f")),fu(this,Wl,void 0,"f"),pu(this,Vl,"m",su).call(this),!1;if(!pu(this,tu,"f")){const t=!pu(this,Vl,"a",au);if(pu(this,Vl,"a",nu)&&pu(this,Vl,"a",ru)){const e=pu(this,Xl,"f").dequeue();return!!e&&(this.emit("active"),e(),t&&pu(this,Vl,"m",lu).call(this),!0)}}return!1},lu=function(){pu(this,Hl,"f")||void 0!==pu(this,Wl,"f")||(fu(this,Wl,setInterval((()=>{pu(this,Vl,"m",uu).call(this)}),pu(this,Gl,"f")),"f"),fu(this,ql,Date.now()+pu(this,Gl,"f"),"f"))},uu=function(){0===pu(this,$l,"f")&&0===pu(this,Jl,"f")&&pu(this,Wl,"f")&&(clearInterval(pu(this,Wl,"f")),fu(this,Wl,void 0,"f")),fu(this,$l,pu(this,jl,"f")?pu(this,Jl,"f"):0,"f"),pu(this,Vl,"m",hu).call(this)},hu=function(){while(pu(this,Vl,"m",cu).call(this));},du=async function(t,e){return new Promise((n=>{const r=()=>{e&&!e()||(this.off(t,r),n())};this.on(t,r)}))};var wu=n(3785);const bu=new Nl(1e3),vu=6e4,Eu=yu["default"]?yu["default"]:yu,_u=new Eu({concurrency:4}),Su=t=>{if(t.Path)return t.Path;throw new Error(t.Message)};async function Au(t,e){const n=async(t,e={})=>{const n=new URLSearchParams(e);n.set("arg",t);const r=n.toString();if(!e.nocache&&bu.has(r)){const t=bu.get(r);return Su(t)}const i=await _u.add((async()=>{const t=await wu.get("https://ipfs.io/api/v0/dns",{searchParams:n}),e=new URL(t.url).search.slice(1),r=await t.json();return bu.set(e,r,vu),r}));return Su(i)};return n(t,e)}function Cu(t){return t.endsWith(".eth")&&(t=t.replace(/.eth$/,".eth.link")),t}function Iu(){const t=async(t,e={recursive:!0})=>{if("string"!==typeof t)throw new Error("Invalid arguments, domain must be a string");return t=Cu(t),Au(t,e)};return fl(t)}function Tu({network:t}){return()=>{const e=t.try();return null!=e&&Boolean(e.libp2p.isStarted())}}const ku=Symbol.for("@libp2p/peer-id");function Ru(t){return null!=t&&Boolean(t[ku])}const Nu=Symbol.for("nodejs.util.inspect.custom"),Du=Object.values(Ao).map((t=>t.decoder)).reduce(((t,e)=>t.or(e)),Ao.identity.decoder),Ou=114,Pu=36,xu=37;class Mu{constructor(t){this.type=t.type,this.multihash=t.multihash,this.privateKey=t.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[ku](){return!0}toString(){return null==this.string&&(this.string=Ct.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Me.createV1(Ou,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(t){if(t instanceof Uint8Array)return Xa(this.multihash.bytes,t);if("string"===typeof t)return zu(t).equals(this);if(null!=t?.multihash?.bytes)return Xa(this.multihash.bytes,t.multihash.bytes);throw new Error("not valid Id")}[Nu](){return`PeerId(${this.toString()})`}}class Lu extends Mu{constructor(t){super({...t,type:"RSA"}),this.type="RSA",this.publicKey=t.publicKey}}class Bu extends Mu{constructor(t){super({...t,type:"Ed25519"}),this.type="Ed25519",this.publicKey=t.multihash.digest}}class Uu extends Mu{constructor(t){super({...t,type:"secp256k1"}),this.type="secp256k1",this.publicKey=t.multihash.digest}}function Fu(t){if("RSA"===t.type)return new Lu(t);if("Ed25519"===t.type)return new Bu(t);if("secp256k1"===t.type)return new Uu(t);throw Vt(new Error("Not a PeerId"),"ERR_INVALID_PARAMETERS")}function zu(t,e){if(e=e??Du,"1"===t.charAt(0)||"Q"===t.charAt(0)){const e=Re(Ct.decode(`z${t}`));return t.startsWith("12D")?new Bu({multihash:e}):t.startsWith("16U")?new Uu({multihash:e}):new Lu({multihash:e})}return Vu(Du.decode(t))}function Vu(t){try{const e=Re(t);if(e.code===Ys.code){if(e.digest.length===Pu)return new Bu({multihash:e});if(e.digest.length===xu)return new Uu({multihash:e})}if(e.code===ho.code)return new Lu({multihash:e})}catch{return ju(Me.decode(t))}throw new Error("Supplied PeerID CID is invalid")}function ju(t){if(null==t||null==t.multihash||null==t.version||1===t.version&&t.code!==Ou)throw new Error("Supplied PeerID CID is invalid");const e=t.multihash;if(e.code===ho.code)return new Lu({multihash:t.multihash});if(e.code===Ys.code){if(e.digest.length===Pu)return new Bu({multihash:t.multihash});if(e.digest.length===xu)return new Uu({multihash:t.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function Hu(t,e){return t.length===Pu?new Bu({multihash:ke(Ys.code,t),privateKey:e}):t.length===xu?new Uu({multihash:ke(Ys.code,t),privateKey:e}):new Lu({multihash:await ho.digest(t),publicKey:t,privateKey:e})}function $u({repo:t,codecs:e,bases:n,name:r}){async function i(i,s={}){if(!Xc(i))throw new Error("invalid argument "+i);if(Jc(i))for await(const t of r.resolve(i,s))i=t;const[,o,a,...c]=i.split("/"),l=s.cidBase?await n.getBase(s.cidBase):void 0,u=Ku(a);if(0===c.length){const t=l?l.encoder.encode(u):a;return`/${o}/${t}`}const h=Me.decode(u);i=c.join("/");const d=Cl(h,i,e,t,s);let f=h,p=i;for await(const t of d)Me.asCID(t.value)&&(f=t.value,p=t.remainderPath);return`/ipfs/${f.toString(l&&l.encoder)}${p?"/"+p:""}`}return fl(i)}function Ku(t){try{return zu(t).toBytes()}catch{return Me.parse(t).bytes}}async function Gu(t){let e;for await(const n of t)e=n;return e}function qu({addAll:t}){return(e,n={})=>{let r;const i=Me.asCID(e);return r=t(i?[{cid:i,...n}]:[{path:e.toString(),...n}],n),Gu(r)}}async function*Wu(t){if(null===t||void 0===t)throw Vt(new Error(`Unexpected input: ${t}`),"ERR_UNEXPECTED_INPUT");const e=Me.asCID(t);if(e)yield Yu({cid:e});else{if(!(t instanceof String||"string"===typeof t)){if(null!=t.cid||null!=t.path)return yield Yu(t);if(Symbol.iterator in t){const e=t[Symbol.iterator](),n=e.next();if(n.done)return e;if(Me.asCID(n.value)||n.value instanceof String||"string"===typeof n.value){yield Yu({cid:n.value});for(const t of e)yield Yu({cid:t});return}if(null!=n.value.cid||null!=n.value.path){yield Yu(n.value);for(const t of e)yield Yu(t);return}throw Vt(new Error("Unexpected input: "+typeof t),"ERR_UNEXPECTED_INPUT")}if(Symbol.asyncIterator in t){const e=t[Symbol.asyncIterator](),n=await e.next();if(n.done)return e;if(Me.asCID(n.value)||n.value instanceof String||"string"===typeof n.value){yield Yu({cid:n.value});for await(const t of e)yield Yu({cid:t});return}if(null!=n.value.cid||null!=n.value.path){yield Yu(n.value);for await(const t of e)yield Yu(t);return}throw Vt(new Error("Unexpected input: "+typeof t),"ERR_UNEXPECTED_INPUT")}throw Vt(new Error("Unexpected input: "+typeof t),"ERR_UNEXPECTED_INPUT")}yield Yu({path:t})}}function Yu(t){const e=t.cid||`${t.path}`;if(!e)throw Vt(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");const n={path:e,recursive:!1!==t.recursive};return null!=t.metadata&&(n.metadata=t.metadata),n}const Xu={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function Qu({repo:t,codecs:e}){async function*n(n,r={}){const i=async function*(){for await(const{path:r,recursive:i,metadata:s}of Wu(n)){const{cid:n}=await _l(t,e,r),{reason:o}=await t.pins.isPinnedWithType(n,[Xu.recursive,Xu.direct]);if("recursive"===o&&!i)throw new Error(`${n} already pinned recursively`);i?await t.pins.pinRecursively(n,{metadata:s}):await t.pins.pinDirectly(n,{metadata:s}),yield n}},s=Boolean(r.lock);if(!s)return void(yield*i());const o=await t.gcLock.readLock();try{yield*i()}finally{o()}}return fl(n)}function Ju(t,e,n){const r={type:t,cid:e};return n&&(r.metadata=n),r}function Zu({repo:t,codecs:e}){async function*n(n={}){let r=Xu.all;if(n.type&&(r=n.type,!Object.keys(Xu).includes(r)))throw Vt(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let i=!1;for await(const{path:s}of Wu(n.paths)){const{cid:n}=await _l(t,e,s),{reason:o,pinned:a,parent:c,metadata:l}=await t.pins.isPinnedWithType(n,r);if(!a)throw Vt(new Error(`path '${s}' is not pinned`),"ERR_NOT_PINNED");switch(o){case Xu.direct:case Xu.recursive:i=!0,yield Ju(o,n,l);break;default:i=!0,yield Ju(`${Xu.indirect} through ${c}`,n,l)}}if(!i)throw new Error("No match found")}else{if(r===Xu.recursive||r===Xu.all)for await(const{cid:e,metadata:n}of t.pins.recursiveKeys())yield Ju(Xu.recursive,e,n);if(r===Xu.indirect||r===Xu.all)for await(const e of t.pins.indirectKeys(n))yield Ju(Xu.indirect,e);if(r===Xu.direct||r===Xu.all)for await(const{cid:e,metadata:n}of t.pins.directKeys())yield Ju(Xu.direct,e,n)}}return fl(n)}function th({rmAll:t}){async function e(e,n={}){const r=await Gu(t([{path:e,...n}],n));if(!r)throw new Error("CID expected");return r}return e}function eh({repo:t,codecs:e}){async function*n(n,r={}){const i=await t.gcLock.readLock();try{for await(const{path:r,recursive:i}of Wu(n)){const{cid:n}=await _l(t,e,r),{pinned:s,reason:o}=await t.pins.isPinnedWithType(n,Xu.all);if(!s)throw new Error(`${n} is not pinned`);switch(o){case Xu.recursive:if(!i)throw new Error(`${n} is pinned recursively`);await t.pins.unpin(n),yield n;break;case Xu.direct:await t.pins.unpin(n),yield n;break;default:throw new Error(`${n} is pinned indirectly under ${o}`)}}}finally{i()}}return fl(n)}class nh{constructor({codecs:t,repo:e}){const n=Qu({codecs:t,repo:e});this.addAll=n,this.add=qu({addAll:n});const r=eh({codecs:t,repo:e});this.rmAll=r,this.rm=th({rmAll:r}),this.ls=Zu({codecs:t,repo:e}),this.remote={add:(t,e={})=>Promise.reject(new Error("Not implemented")),ls:async function*(t,e={}){return Promise.reject(new Error("Not implemented"))},rm:(t,e={})=>Promise.reject(new Error("Not implemented")),rmAll:(t,e={})=>Promise.reject(new Error("Not implemented")),service:{add:(t,e)=>Promise.reject(new Error("Not implemented")),rm:(t,e={})=>Promise.reject(new Error("Not implemented")),ls:(t={})=>Promise.reject(new Error("Not implemented"))}}}}function rh(t){return t=t||new Error("Cannot open database"),Vt(t,"ERR_DB_OPEN_FAILED")}function ih(t){return t=t||new Error("Delete failed"),Vt(t,"ERR_DB_DELETE_FAILED")}function sh(t){return t=t||new Error("Write failed"),Vt(t,"ERR_DB_WRITE_FAILED")}function oh(t){return t=t||new Error("Not Found"),Vt(t,"ERR_NOT_FOUND")}var ah=n(1901),ch=n(4609),lh=n(3206),uh=n(1355),hh=n(3319),dh=n(1539);function fh(){dh._configure(),ch._configure(lh),uh._configure(hh)}fh();const ph=["uint64","int64","sint64","fixed64","sfixed64"];function gh(t){for(const e of ph){if(null==t[e])continue;const n=t[e];t[e]=function(){return BigInt(n.call(this).toString())}}return t}function mh(t){return gh(new ch(t))}function yh(t){for(const e of ph){if(null==t[e])continue;const n=t[e];t[e]=function(t){return n.call(this,t.toString())}}return t}function wh(){return yh(uh.create())}function bh(t,e){const n=mh(t instanceof Uint8Array?t:t.subarray());return e.decode(n)}function vh(t,e){const n=wh();return e.encode(t,n,{lengthDelimited:!1}),n.finish()}var Eh,_h,Sh,Ah,Ch;function Ih(t,e,n,r){return{name:t,type:e,encode:n,decode:r}}function Th(t){function e(e){if(null==t[e.toString()])throw new Error("Invalid enum value");return t[e]}const n=function(t,n){const r=e(t);n.int32(r)},r=function(t){const n=t.int32();return e(n)};return Ih("enum",Eh.VARINT,n,r)}function kh(t,e){return Ih("message",Eh.LENGTH_DELIMITED,t,e)}(function(t){t[t["VARINT"]=0]="VARINT",t[t["BIT64"]=1]="BIT64",t[t["LENGTH_DELIMITED"]=2]="LENGTH_DELIMITED",t[t["START_GROUP"]=3]="START_GROUP",t[t["END_GROUP"]=4]="END_GROUP",t[t["BIT32"]=5]="BIT32"})(Eh||(Eh={})),function(t){t["RSA"]="RSA",t["Ed25519"]="Ed25519",t["Secp256k1"]="Secp256k1"}(_h||(_h={})),function(t){t[t["RSA"]=0]="RSA",t[t["Ed25519"]=1]="Ed25519",t[t["Secp256k1"]=2]="Secp256k1"}(Sh||(Sh={})),function(t){t.codec=()=>Th(Sh)}(_h||(_h={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),null!=t.Type&&(e.uint32(8),_h.codec().encode(t.Type,e)),null!=t.Data&&(e.uint32(18),e.bytes(t.Data)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.Type=_h.codec().decode(t);break;case 2:n.Data=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(Ah||(Ah={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),null!=t.Type&&(e.uint32(8),_h.codec().encode(t.Type,e)),null!=t.Data&&(e.uint32(18),e.bytes(t.Data)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.Type=_h.codec().decode(t);break;case 2:n.Data=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(Ch||(Ch={}));n(3655),n(8774);var Rh=n(6143),Nh={get(t=globalThis){const e=t.crypto;if(null==e||null==e.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return e}};var Dh=n(8666);n(3322);function Oh(t,e){let n=Uint8Array.from(t.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=e){if(n.length>e)throw new Error("byte array longer than desired length");n=ya([new Uint8Array(e-n.length),n])}return sa(n,"base64url")}function Ph(t){const e=xh(t);return new Rh.jsbn.BigInteger(sa(e,"base16"),16)}function xh(t,e){let n=Ho(t,"base64urlpad");if(null!=e){if(n.length>e)throw new Error("byte array longer than desired length");n=ya([new Uint8Array(e-n.length),n])}return n}const Mh={"P-256":256,"P-384":384,"P-521":521},Lh=Object.keys(Mh);Lh.join(" / ");function Bh(t){const e=t?.algorithm??"AES-GCM";let n=t?.keyLength??16;const r=t?.nonceLength??12,i=t?.digest??"SHA-256",s=t?.saltLength??16,o=t?.iterations??32767,a=Nh.get();async function c(t,c){const l=a.getRandomValues(new Uint8Array(s)),u=a.getRandomValues(new Uint8Array(r)),h={name:e,iv:u};"string"===typeof c&&(c=Ho(c));const d={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},f=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),p=await a.subtle.deriveKey(d,f,{name:e,length:n},!0,["encrypt"]),g=await a.subtle.encrypt(h,p,t);return ya([l,h.iv,new Uint8Array(g)])}async function l(t,c){const l=t.subarray(0,s),u=t.subarray(s,s+r),h=t.subarray(s+r),d={name:e,iv:u};"string"===typeof c&&(c=Ho(c));const f={name:"PBKDF2",salt:l,iterations:o,hash:{name:i}},p=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),g=await a.subtle.deriveKey(f,p,{name:e,length:n},!0,["decrypt"]),m=await a.subtle.decrypt(d,g,h);return new Uint8Array(m)}n*=8;const u={encrypt:c,decrypt:l};return u}async function Uh(t,e){const n=Lt.decode(t),r=Bh();return await r.decrypt(n,e)}n(517);var Fh=n(6245),zh=n.t(Fh,2);
/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
const Vh=BigInt(0),jh=BigInt(1),Hh=BigInt(2),$h=BigInt(3),Kh=BigInt(8),Gh=Object.freeze({a:Vh,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:jh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")});function qh(t){const{a:e,b:n}=Gh,r=gd(t*t),i=gd(r*t);return gd(i+e*t+n)}const Wh=Gh.a===Vh;class Yh extends Error{constructor(t){super(t)}}class Xh{constructor(t,e,n){this.x=t,this.y=e,this.z=n}static fromAffine(t){if(!(t instanceof Jh))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new Xh(t.x,t.y,jh)}static toAffineBatch(t){const e=bd(t.map((t=>t.z)));return t.map(((t,n)=>t.toAffine(e[n])))}static normalizeZ(t){return Xh.toAffineBatch(t).map(Xh.fromAffine)}equals(t){if(!(t instanceof Xh))throw new TypeError("JacobianPoint expected");const{x:e,y:n,z:r}=this,{x:i,y:s,z:o}=t,a=gd(r*r),c=gd(o*o),l=gd(e*c),u=gd(i*a),h=gd(gd(n*o)*c),d=gd(gd(s*r)*a);return l===u&&h===d}negate(){return new Xh(this.x,gd(-this.y),this.z)}double(){const{x:t,y:e,z:n}=this,r=gd(t*t),i=gd(e*e),s=gd(i*i),o=t+i,a=gd(Hh*(gd(o*o)-r-s)),c=gd($h*r),l=gd(c*c),u=gd(l-Hh*a),h=gd(c*(a-u)-Kh*s),d=gd(Hh*e*n);return new Xh(u,h,d)}add(t){if(!(t instanceof Xh))throw new TypeError("JacobianPoint expected");const{x:e,y:n,z:r}=this,{x:i,y:s,z:o}=t;if(i===Vh||s===Vh)return this;if(e===Vh||n===Vh)return t;const a=gd(r*r),c=gd(o*o),l=gd(e*c),u=gd(i*a),h=gd(gd(n*o)*c),d=gd(gd(s*r)*a),f=gd(u-l),p=gd(d-h);if(f===Vh)return p===Vh?this.double():Xh.ZERO;const g=gd(f*f),m=gd(f*g),y=gd(l*g),w=gd(p*p-m-Hh*y),b=gd(p*(y-w)-h*m),v=gd(r*o*f);return new Xh(w,b,v)}subtract(t){return this.add(t.negate())}multiplyUnsafe(t){const e=Xh.ZERO;if("bigint"===typeof t&&t===Vh)return e;let n=pd(t);if(n===jh)return this;if(!Wh){let t=e,r=this;while(n>Vh)n&jh&&(t=t.add(r)),r=r.double(),n>>=jh;return t}let{k1neg:r,k1:i,k2neg:s,k2:o}=_d(n),a=e,c=e,l=this;while(i>Vh||o>Vh)i&jh&&(a=a.add(l)),o&jh&&(c=c.add(l)),l=l.double(),i>>=jh,o>>=jh;return r&&(a=a.negate()),s&&(c=c.negate()),c=new Xh(gd(c.x*Gh.beta),c.y,c.z),a.add(c)}precomputeWindow(t){const e=Wh?128/t+1:256/t+1,n=[];let r=this,i=r;for(let s=0;s<e;s++){i=r,n.push(i);for(let e=1;e<2**(t-1);e++)i=i.add(r),n.push(i);r=i.double()}return n}wNAF(t,e){!e&&this.equals(Xh.BASE)&&(e=Jh.BASE);const n=e&&e._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&Qh.get(e);r||(r=this.precomputeWindow(n),e&&1!==n&&(r=Xh.normalizeZ(r),Qh.set(e,r)));let i=Xh.ZERO,s=Xh.ZERO;const o=1+(Wh?128/n:256/n),a=2**(n-1),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){const e=h*a;let n=Number(t&c);if(t>>=u,n>a&&(n-=l,t+=jh),0===n){let t=r[e];h%2&&(t=t.negate()),s=s.add(t)}else{let t=r[e+Math.abs(n)-1];n<0&&(t=t.negate()),i=i.add(t)}}return{p:i,f:s}}multiply(t,e){let n,r,i=pd(t);if(Wh){const{k1neg:t,k1:s,k2neg:o,k2:a}=_d(i);let{p:c,f:l}=this.wNAF(s,e),{p:u,f:h}=this.wNAF(a,e);t&&(c=c.negate()),o&&(u=u.negate()),u=new Xh(gd(u.x*Gh.beta),u.y,u.z),n=c.add(u),r=l.add(h)}else{const{p:t,f:s}=this.wNAF(i,e);n=t,r=s}return Xh.normalizeZ([n,r])[0]}toAffine(t=wd(this.z)){const{x:e,y:n,z:r}=this,i=t,s=gd(i*i),o=gd(s*i),a=gd(e*s),c=gd(n*o),l=gd(r*i);if(l!==jh)throw new Error("invZ was invalid");return new Jh(a,c)}}Xh.BASE=new Xh(Gh.Gx,Gh.Gy,jh),Xh.ZERO=new Xh(Vh,jh,Vh);const Qh=new WeakMap;class Jh{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,Qh.delete(this)}hasEvenY(){return this.y%Hh===Vh}static fromCompressedHex(t){const e=32===t.length,n=dd(e?t:t.subarray(1));if(!kd(n))throw new Error("Point is not on curve");const r=qh(n);let i=yd(r);const s=(i&jh)===jh;if(e)s&&(i=gd(-i));else{const e=1===(1&t[0]);e!==s&&(i=gd(-i))}const o=new Jh(n,i);return o.assertValidity(),o}static fromUncompressedHex(t){const e=dd(t.subarray(1,33)),n=dd(t.subarray(33,65)),r=new Jh(e,n);return r.assertValidity(),r}static fromHex(t){const e=fd(t),n=e.length,r=e[0];if(32===n||33===n&&(2===r||3===r))return this.fromCompressedHex(e);if(65===n&&4===r)return this.fromUncompressedHex(e);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${n}`)}static fromPrivateKey(t){return Jh.BASE.multiply(Nd(t))}static fromSignature(t,e,n){t=fd(t);const r=Sd(t),{r:i,s:s}=Od(e);if(0!==n&&1!==n)throw new Error("Cannot recover signature: invalid recovery bit");const o=1&n?"03":"02",a=Jh.fromHex(o+ad(i)),{n:c}=Gh,l=wd(i,c),u=gd(-r*l,c),h=gd(s*l,c),d=Jh.BASE.multiplyAndAddUnsafe(a,u,h);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(t=!1){return hd(this.toHex(t))}toHex(t=!1){const e=ad(this.x);if(t){const t=this.hasEvenY()?"02":"03";return`${t}${e}`}return`04${e}${ad(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const t="Point is not on elliptic curve",{x:e,y:n}=this;if(!kd(e)||!kd(n))throw new Error(t);const r=gd(n*n),i=qh(e);if(gd(r-i)!==Vh)throw new Error(t)}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new Jh(this.x,gd(-this.y))}double(){return Xh.fromAffine(this).double().toAffine()}add(t){return Xh.fromAffine(this).add(Xh.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return Xh.fromAffine(this).multiply(t,this).toAffine()}multiplyAndAddUnsafe(t,e,n){const r=Xh.fromAffine(this),i=e===Vh||e===jh||this!==Jh.BASE?r.multiplyUnsafe(e):r.multiply(e),s=Xh.fromAffine(t).multiplyUnsafe(n),o=i.add(s);return o.equals(Xh.ZERO)?void 0:o.toAffine()}}function Zh(t){return Number.parseInt(t[0],16)>=8?"00"+t:t}function td(t){if(t.length<2||2!==t[0])throw new Error(`Invalid signature integer tag: ${sd(t)}`);const e=t[1],n=t.subarray(2,e+2);if(!e||n.length!==e)throw new Error("Invalid signature integer: wrong length");if(0===n[0]&&n[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:dd(n),left:t.subarray(e+2)}}function ed(t){if(t.length<2||48!=t[0])throw new Error(`Invalid signature tag: ${sd(t)}`);if(t[1]!==t.length-2)throw new Error("Invalid signature: incorrect length");const{data:e,left:n}=td(t.subarray(2)),{data:r,left:i}=td(n);if(i.length)throw new Error(`Invalid signature: left bytes after parsing: ${sd(i)}`);return{r:e,s:r}}Jh.BASE=new Jh(Gh.Gx,Gh.Gy),Jh.ZERO=new Jh(Vh,Vh);class nd{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromCompact(t){const e=t instanceof Uint8Array,n="Signature.fromCompact";if("string"!==typeof t&&!e)throw new TypeError(`${n}: Expected string or Uint8Array`);const r=e?sd(t):t;if(128!==r.length)throw new Error(`${n}: Expected 64-byte hex`);return new nd(ud(r.slice(0,64)),ud(r.slice(64,128)))}static fromDER(t){const e=t instanceof Uint8Array;if("string"!==typeof t&&!e)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:n,s:r}=ed(e?t:hd(t));return new nd(n,r)}static fromHex(t){return this.fromDER(t)}assertValidity(){const{r:t,s:e}=this;if(!Td(t))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Td(e))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const t=Gh.n>>jh;return this.s>t}normalizeS(){return this.hasHighS()?new nd(this.r,Gh.n-this.s):this}toDERRawBytes(t=!1){return hd(this.toDERHex(t))}toDERHex(t=!1){const e=Zh(ld(this.s));if(t)return e;const n=Zh(ld(this.r)),r=ld(n.length/2),i=ld(e.length/2),s=ld(n.length/2+e.length/2+4);return`30${s}02${r}${n}02${i}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return hd(this.toCompactHex())}toCompactHex(){return ad(this.r)+ad(this.s)}}function rd(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const e=t[r];n.set(e,i),i+=e.length}return n}const id=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function sd(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");let e="";for(let n=0;n<t.length;n++)e+=id[t[n]];return e}const od=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function ad(t){if("bigint"!==typeof t)throw new Error("Expected bigint");if(!(Vh<=t&&t<od))throw new Error("Expected number < 2^256");return t.toString(16).padStart(64,"0")}function cd(t){const e=hd(ad(t));if(32!==e.length)throw new Error("Error: expected 32 bytes");return e}function ld(t){const e=t.toString(16);return 1&e.length?`0${e}`:e}function ud(t){if("string"!==typeof t)throw new TypeError("hexToNumber: expected string, got "+typeof t);return BigInt(`0x${t}`)}function hd(t){if("string"!==typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+t.length);const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=2*n,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[n]=s}return e}function dd(t){return ud(sd(t))}function fd(t){return t instanceof Uint8Array?Uint8Array.from(t):hd(t)}function pd(t){if("number"===typeof t&&Number.isSafeInteger(t)&&t>0)return BigInt(t);if("bigint"===typeof t&&Td(t))return t;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function gd(t,e=Gh.P){const n=t%e;return n>=Vh?n:e+n}function md(t,e){const{P:n}=Gh;let r=t;while(e-- >Vh)r*=r,r%=n;return r}function yd(t){const{P:e}=Gh,n=BigInt(6),r=BigInt(11),i=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),c=t*t*t%e,l=c*c*t%e,u=md(l,$h)*l%e,h=md(u,$h)*l%e,d=md(h,Hh)*c%e,f=md(d,r)*d%e,p=md(f,i)*f%e,g=md(p,o)*p%e,m=md(g,a)*g%e,y=md(m,o)*p%e,w=md(y,$h)*l%e,b=md(w,s)*f%e,v=md(b,n)*c%e;return md(v,Hh)}function wd(t,e=Gh.P){if(t===Vh||e<=Vh)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=gd(t,e),r=e,i=Vh,s=jh,o=jh,a=Vh;while(n!==Vh){const t=r/n,e=r%n,c=i-o*t,l=s-a*t;r=n,n=e,i=o,s=a,o=c,a=l}const c=r;if(c!==jh)throw new Error("invert: does not exist");return gd(i,e)}function bd(t,e=Gh.P){const n=new Array(t.length),r=t.reduce(((t,r,i)=>r===Vh?t:(n[i]=t,gd(t*r,e))),jh),i=wd(r,e);return t.reduceRight(((t,r,i)=>r===Vh?t:(n[i]=gd(t*n[i],e),gd(t*r,e))),i),n}const vd=(t,e)=>(t+e/Hh)/e,Ed={a1:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),b1:-jh*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a2:BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),b2:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),POW_2_128:BigInt("0x100000000000000000000000000000000")};function _d(t){const{n:e}=Gh,{a1:n,b1:r,a2:i,b2:s,POW_2_128:o}=Ed,a=vd(s*t,e),c=vd(-r*t,e);let l=gd(t-a*n-c*i,e),u=gd(-a*r-c*s,e);const h=l>o,d=u>o;if(h&&(l=e-l),d&&(u=e-u),l>o||u>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+t);return{k1neg:h,k1:l,k2neg:d,k2:u}}function Sd(t){const{n:e}=Gh,n=t.length,r=8*n-256;let i=dd(t);return r>0&&(i>>=BigInt(r)),i>=e&&(i-=e),i}let Ad,Cd;class Id{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...t){return $d.hmacSha256(this.k,...t)}hmacSync(...t){return Cd(this.k,...t)}checkSync(){if("function"!==typeof Cd)throw new Yh("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(t=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),t),this.v=await this.hmac(this.v),0!==t.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),t),this.v=await this.hmac(this.v))}reseedSync(t=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),t),this.v=this.hmacSync(this.v),0!==t.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),t),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.checkSync(),this.incr(),this.v=this.hmacSync(this.v),this.v}}function Td(t){return Vh<t&&t<Gh.n}function kd(t){return Vh<t&&t<Gh.P}function Rd(t,e,n){const r=dd(t);if(!Td(r))return;const{n:i}=Gh,s=Jh.BASE.multiply(r),o=gd(s.x,i);if(o===Vh)return;const a=gd(wd(r,i)*gd(e+n*o,i),i);if(a===Vh)return;const c=new nd(o,a),l=(s.x===c.r?0:2)|Number(s.y&jh);return{sig:c,recovery:l}}function Nd(t){let e;if("bigint"===typeof t)e=t;else if("number"===typeof t&&Number.isSafeInteger(t)&&t>0)e=BigInt(t);else if("string"===typeof t){if(64!==t.length)throw new Error("Expected 32 bytes of private key");e=ud(t)}else{if(!(t instanceof Uint8Array))throw new TypeError("Expected valid private key");if(32!==t.length)throw new Error("Expected 32 bytes of private key");e=dd(t)}if(!Td(e))throw new Error("Expected private key: 0 < key < n");return e}function Dd(t){return t instanceof Jh?(t.assertValidity(),t):Jh.fromHex(t)}function Od(t){if(t instanceof nd)return t.assertValidity(),t;try{return nd.fromDER(t)}catch(e){return nd.fromCompact(t)}}function Pd(t,e=!1){return Jh.fromPrivateKey(t).toRawBytes(e)}function xd(t){const e=t.length>32?t.slice(0,32):t;return dd(e)}function Md(t){const e=xd(t),n=gd(e,Gh.n);return Ld(n<Vh?e:n)}function Ld(t){return cd(t)}function Bd(t,e,n){if(null==t)throw new Error(`sign: expected valid message hash, not "${t}"`);const r=fd(t),i=Nd(e),s=[Ld(i),Md(r)];if(null!=n){!0===n&&(n=$d.randomBytes(32));const t=fd(n);if(32!==t.length)throw new Error("sign: Expected 32 bytes of extra data");s.push(t)}const o=rd(...s),a=xd(r);return{seed:o,m:a,d:i}}function Ud(t,e){let{sig:n,recovery:r}=t;const{canonical:i,der:s,recovered:o}=Object.assign({canonical:!0,der:!0},e);i&&n.hasHighS()&&(n=n.normalizeS(),r^=1);const a=s?n.toDERRawBytes():n.toCompactRawBytes();return o?[a,r]:a}async function Fd(t,e,n={}){const{seed:r,m:i,d:s}=Bd(t,e,n.extraEntropy);let o;const a=new Id;await a.reseed(r);while(!(o=Rd(await a.generate(),i,s)))await a.reseed();return Ud(o,n)}const zd={strict:!0};function Vd(t,e,n,r=zd){let i;try{i=Od(t),e=fd(e)}catch(g){return!1}const{r:s,s:o}=i;if(r.strict&&i.hasHighS())return!1;const a=Sd(e);let c;try{c=Dd(n)}catch(g){return!1}const{n:l}=Gh,u=wd(o,l),h=gd(a*u,l),d=gd(s*u,l),f=Jh.BASE.multiplyAndAddUnsafe(c,h,d);if(!f)return!1;const p=gd(f.x,l);return p===s}Jh.BASE._setWindowSize(8);const jd={node:zh,web:"object"===typeof self&&"crypto"in self?self.crypto:void 0},Hd={},$d={bytesToHex:sd,hexToBytes:hd,concatBytes:rd,mod:gd,invert:wd,isValidPrivateKey(t){try{return Nd(t),!0}catch(e){return!1}},_bigintTo32Bytes:cd,_normalizePrivateKey:Nd,hashToPrivateKey:t=>{if(t=fd(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const e=gd(dd(t),Gh.n-jh)+jh;return cd(e)},randomBytes:(t=32)=>{if(jd.web)return jd.web.getRandomValues(new Uint8Array(t));if(jd.node){const{randomBytes:e}=jd.node;return Uint8Array.from(e(t))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>$d.hashToPrivateKey($d.randomBytes(40)),sha256:async(...t)=>{if(jd.web){const e=await jd.web.subtle.digest("SHA-256",rd(...t));return new Uint8Array(e)}if(jd.node){const{createHash:e}=jd.node,n=e("sha256");return t.forEach((t=>n.update(t))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(t,...e)=>{if(jd.web){const n=await jd.web.subtle.importKey("raw",t,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=rd(...e),i=await jd.web.subtle.sign("HMAC",n,r);return new Uint8Array(i)}if(jd.node){const{createHmac:n}=jd.node,r=n("sha256",t);return e.forEach((t=>r.update(t))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(t,...e)=>{let n=Hd[t];if(void 0===n){const e=await $d.sha256(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=rd(e,e),Hd[t]=n}return $d.sha256(n,...e)},taggedHashSync:(t,...e)=>{if("function"!==typeof Ad)throw new Yh("sha256Sync is undefined, you need to set it");let n=Hd[t];if(void 0===n){const e=Ad(Uint8Array.from(t,(t=>t.charCodeAt(0))));n=rd(e,e),Hd[t]=n}return Ad(n,...e)},precompute(t=8,e=Jh.BASE){const n=e===Jh.BASE?e:new Jh(e.x,e.y);return n._setWindowSize(t),n.multiply($h),n}};function Kd(t){if(isNaN(t)||t<=0)throw Vt(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return $d.randomBytes(t)}Object.defineProperties($d,{sha256Sync:{configurable:!1,get(){return Ad},set(t){Ad||(Ad=t)}},hmacSha256Sync:{configurable:!1,get(){return Cd},set(t){Cd||(Cd=t)}}});n(536);function Gd(t){const e=Rh.asn1.fromDer(sa(t,"ascii")),n=Rh.pki.privateKeyFromAsn1(e);return{kty:"RSA",n:Oh(n.n),e:Oh(n.e),d:Oh(n.d),p:Oh(n.p),q:Oh(n.q),dp:Oh(n.dP),dq:Oh(n.dQ),qi:Oh(n.qInv),alg:"RS256"}}function qd(t){if(null==t.n||null==t.e||null==t.d||null==t.p||null==t.q||null==t.dp||null==t.dq||null==t.qi)throw Vt(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");const e=Rh.pki.privateKeyToAsn1({n:Ph(t.n),e:Ph(t.e),d:Ph(t.d),p:Ph(t.p),q:Ph(t.q),dP:Ph(t.dp),dQ:Ph(t.dq),qInv:Ph(t.qi)});return Ho(Rh.asn1.toDer(e).getBytes(),"ascii")}function Wd(t){const e=Rh.asn1.fromDer(sa(t,"ascii")),n=Rh.pki.publicKeyFromAsn1(e);return{kty:"RSA",n:Oh(n.n),e:Oh(n.e)}}function Yd(t){if(null==t.n||null==t.e)throw Vt(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");const e=Rh.pki.publicKeyToAsn1({n:Ph(t.n),e:Ph(t.e)});return Ho(Rh.asn1.toDer(e).getBytes(),"ascii")}function Xd(t,e){return e.map((e=>Ph(t[e])))}function Qd(t){return Rh.pki.setRsaPrivateKey(...Xd(t,["n","e","d","p","q","dp","dq","qi"]))}function Jd(t){return Rh.pki.setRsaPublicKey(...Xd(t,["n","e"]))}async function Zd(t){const e=await Nh.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:t,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await rf(e);return{privateKey:n[0],publicKey:n[1]}}async function tf(t){const e=await Nh.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),n=[e,await sf(t)],r=await rf({privateKey:n[0],publicKey:n[1]});return{privateKey:r[0],publicKey:r[1]}}async function ef(t,e){const n=await Nh.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Nh.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,Uint8Array.from(e));return new Uint8Array(r,0,r.byteLength)}async function nf(t,e,n){const r=await Nh.get().subtle.importKey("jwk",t,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Nh.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,e,n)}async function rf(t){if(null==t.privateKey||null==t.publicKey)throw Vt(new Error("Private and public key are required"),"ERR_INVALID_PARAMETERS");return await Promise.all([Nh.get().subtle.exportKey("jwk",t.privateKey),Nh.get().subtle.exportKey("jwk",t.publicKey)])}async function sf(t){return await Nh.get().subtle.importKey("jwk",{kty:t.kty,n:t.n,e:t.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function of(t,e,n,r){const i=e?Jd(t):Qd(t),s=sa(Uint8Array.from(n),"ascii"),o=r(s,i);return Ho(o,"ascii")}function af(t,e){return of(t,!0,e,((t,e)=>e.encrypt(t)))}function cf(t,e){return of(t,!1,e,((t,e)=>e.decrypt(t)))}async function lf(t,e){const n=Bh(),r=await n.encrypt(t,e);return Lt.encode(r)}class uf{constructor(t){this._key=t}async verify(t,e){return await nf(this._key,e,t)}marshal(){return Yd(this._key)}get bytes(){return Ah.encode({Type:_h.RSA,Data:this.marshal()}).subarray()}encrypt(t){return af(this._key,t)}equals(t){return Xa(this.bytes,t.bytes)}async hash(){const{bytes:t}=await ho.digest(this.bytes);return t}}class hf{constructor(t,e){this._key=t,this._publicKey=e}genSecret(){return Kd(16)}async sign(t){return await ef(this._key,t)}get public(){if(null==this._publicKey)throw Vt(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new uf(this._publicKey)}decrypt(t){return cf(this._key,t)}marshal(){return qd(this._key)}get bytes(){return Ch.encode({Type:_h.RSA,Data:this.marshal()}).subarray()}equals(t){return Xa(this.bytes,t.bytes)}async hash(){const{bytes:t}=await ho.digest(this.bytes);return t}async id(){const t=await this.public.hash();return sa(t,"base58btc")}async export(t,e="pkcs-8"){if("pkcs-8"===e){const e=new Rh.util.ByteBuffer(this.marshal()),n=Rh.asn1.fromDer(e),r=Rh.pki.privateKeyFromAsn1(n),i={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Rh.pki.encryptRsaPrivateKey(r,t,i)}if("libp2p-key"===e)return await lf(this.bytes,t);throw Vt(new Error(`export format '${e}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function df(t){const e=Gd(t),n=await tf(e);return new hf(n.privateKey,n.publicKey)}function ff(t){const e=Wd(t);return new uf(e)}async function pf(t){const e=await tf(t);return new hf(e.privateKey,e.publicKey)}async function gf(t){const e=await Zd(t);return new hf(e.privateKey,e.publicKey)}var mf=n(2049),yf=n.t(mf,2);
/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
const wf=BigInt(0),bf=BigInt(1),vf=BigInt(2),Ef=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),_f=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:Ef,n:Ef,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),Sf=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),Af=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),Cf=(BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235")),If=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Tf=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),kf=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class Rf{constructor(t,e,n,r){this.x=t,this.y=e,this.z=n,this.t=r}static fromAffine(t){if(!(t instanceof Mf))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return t.equals(Mf.ZERO)?Rf.ZERO:new Rf(t.x,t.y,bf,qf(t.x*t.y))}static toAffineBatch(t){const e=Yf(t.map((t=>t.z)));return t.map(((t,n)=>t.toAffine(e[n])))}static normalizeZ(t){return this.toAffineBatch(t).map(this.fromAffine)}equals(t){Nf(t);const{x:e,y:n,z:r}=this,{x:i,y:s,z:o}=t,a=qf(e*o),c=qf(i*r),l=qf(n*o),u=qf(s*r);return a===c&&l===u}negate(){return new Rf(qf(-this.x),this.y,this.z,qf(-this.t))}double(){const{x:t,y:e,z:n}=this,{a:r}=_f,i=qf(t*t),s=qf(e*e),o=qf(vf*qf(n*n)),a=qf(r*i),c=t+e,l=qf(qf(c*c)-i-s),u=a+s,h=u-o,d=a-s,f=qf(l*h),p=qf(u*d),g=qf(l*d),m=qf(h*u);return new Rf(f,p,m,g)}add(t){Nf(t);const{x:e,y:n,z:r,t:i}=this,{x:s,y:o,z:a,t:c}=t,l=qf((n-e)*(o+s)),u=qf((n+e)*(o-s)),h=qf(u-l);if(h===wf)return this.double();const d=qf(r*vf*c),f=qf(i*vf*a),p=f+d,g=u+l,m=f-d,y=qf(p*h),w=qf(g*m),b=qf(p*m),v=qf(h*g);return new Rf(y,w,v,b)}subtract(t){return this.add(t.negate())}precomputeWindow(t){const e=1+256/t,n=[];let r=this,i=r;for(let s=0;s<e;s++){i=r,n.push(i);for(let e=1;e<2**(t-1);e++)i=i.add(r),n.push(i);r=i.double()}return n}wNAF(t,e){!e&&this.equals(Rf.BASE)&&(e=Mf.BASE);const n=e&&e._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=e&&xf.get(e);r||(r=this.precomputeWindow(n),e&&1!==n&&(r=Rf.normalizeZ(r),xf.set(e,r)));let i=Rf.ZERO,s=Rf.ZERO;const o=1+256/n,a=2**(n-1),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){const e=h*a;let n=Number(t&c);if(t>>=u,n>a&&(n-=l,t+=bf),0===n){let t=r[e];h%2&&(t=t.negate()),s=s.add(t)}else{let t=r[e+Math.abs(n)-1];n<0&&(t=t.negate()),i=i.add(t)}}return Rf.normalizeZ([i,s])[0]}multiply(t,e){return this.wNAF(rp(t,_f.l),e)}multiplyUnsafe(t){let e=rp(t,_f.l,!1);const n=Rf.BASE,r=Rf.ZERO;if(e===wf)return r;if(this.equals(r)||e===bf)return this;if(this.equals(n))return this.wNAF(e);let i=r,s=this;while(e>wf)e&bf&&(i=i.add(s)),s=s.double(),e>>=bf;return i}isSmallOrder(){return this.multiplyUnsafe(_f.h).equals(Rf.ZERO)}isTorsionFree(){return this.multiplyUnsafe(_f.l).equals(Rf.ZERO)}toAffine(t=Wf(this.z)){const{x:e,y:n,z:r}=this,i=qf(e*t),s=qf(n*t),o=qf(r*t);if(o!==bf)throw new Error("invZ was invalid");return new Mf(i,s)}fromRistrettoBytes(){Of()}toRistrettoBytes(){Of()}fromRistrettoHash(){Of()}}function Nf(t){if(!(t instanceof Rf))throw new TypeError("ExtendedPoint expected")}function Df(t){if(!(t instanceof Pf))throw new TypeError("RistrettoPoint expected")}function Of(){throw new Error("Legacy method: switch to RistrettoPoint")}Rf.BASE=new Rf(_f.Gx,_f.Gy,bf,qf(_f.Gx*_f.Gy)),Rf.ZERO=new Rf(wf,bf,bf,wf);class Pf{constructor(t){this.ep=t}static calcElligatorRistrettoMap(t){const{d:e}=_f,n=qf(Af*t*t),r=qf((n+bf)*Tf);let i=BigInt(-1);const s=qf((i-e*n)*qf(n+e));let{isValid:o,value:a}=Jf(r,s),c=qf(a*t);Hf(c)||(c=qf(-c)),o||(a=c),o||(i=n);const l=qf(i*(n-bf)*kf-s),u=a*a,h=qf((a+a)*s),d=qf(l*Cf),f=qf(bf-u),p=qf(bf+u);return new Rf(qf(h*p),qf(f*d),qf(d*p),qf(h*f))}static hashToCurve(t){t=np(t,64);const e=Gf(t.slice(0,32)),n=this.calcElligatorRistrettoMap(e),r=Gf(t.slice(32,64)),i=this.calcElligatorRistrettoMap(r);return new Pf(n.add(i))}static fromHex(t){t=np(t,32);const{a:e,d:n}=_f,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",i=Gf(t);if(!ep(jf(i),t)||Hf(i))throw new Error(r);const s=qf(i*i),o=qf(bf+e*s),a=qf(bf-e*s),c=qf(o*o),l=qf(a*a),u=qf(e*n*c-l),{isValid:h,value:d}=Zf(qf(u*l)),f=qf(d*a),p=qf(d*f*u);let g=qf((i+i)*f);Hf(g)&&(g=qf(-g));const m=qf(o*p),y=qf(g*m);if(!h||Hf(y)||m===wf)throw new Error(r);return new Pf(new Rf(g,m,bf,y))}toRawBytes(){let{x:t,y:e,z:n,t:r}=this.ep;const i=qf(qf(n+e)*qf(n-e)),s=qf(t*e),o=qf(s*s),{value:a}=Zf(qf(i*o)),c=qf(a*i),l=qf(a*s),u=qf(c*l*r);let h;if(Hf(r*u)){let n=qf(e*Af),r=qf(t*Af);t=n,e=r,h=qf(c*If)}else h=l;Hf(t*u)&&(e=qf(-e));let d=qf((n-e)*h);return Hf(d)&&(d=qf(-d)),jf(d)}toHex(){return Ff(this.toRawBytes())}toString(){return this.toHex()}equals(t){Df(t);const e=this.ep,n=t.ep,r=qf(e.x*n.y)===qf(e.y*n.x),i=qf(e.y*n.y)===qf(e.x*n.x);return r||i}add(t){return Df(t),new Pf(this.ep.add(t.ep))}subtract(t){return Df(t),new Pf(this.ep.subtract(t.ep))}multiply(t){return new Pf(this.ep.multiply(t))}multiplyUnsafe(t){return new Pf(this.ep.multiplyUnsafe(t))}}Pf.BASE=new Pf(Rf.BASE),Pf.ZERO=new Pf(Rf.ZERO);const xf=new WeakMap;class Mf{constructor(t,e){this.x=t,this.y=e}_setWindowSize(t){this._WINDOW_SIZE=t,xf.delete(this)}static fromHex(t,e=!0){const{d:n,P:r}=_f;t=np(t,32);const i=t.slice();i[31]=-129&t[31];const s=$f(i);if(e&&s>=r)throw new Error("Expected 0 < hex < P");if(!e&&s>=Sf)throw new Error("Expected 0 < hex < 2**256");const o=qf(s*s),a=qf(o-bf),c=qf(n*o+bf);let{isValid:l,value:u}=Jf(a,c);if(!l)throw new Error("Point.fromHex: invalid y coordinate");const h=(u&bf)===bf,d=0!==(128&t[31]);return d!==h&&(u=qf(-u)),new Mf(u,s)}static async fromPrivateKey(t){return(await cp(t)).point}toRawBytes(){const t=jf(this.y);return t[31]|=this.x&bf?128:0,t}toHex(){return Ff(this.toRawBytes())}toX25519(){const{y:t}=this,e=qf((bf+t)*Wf(bf-t));return jf(e)}isTorsionFree(){return Rf.fromAffine(this).isTorsionFree()}equals(t){return this.x===t.x&&this.y===t.y}negate(){return new Mf(qf(-this.x),this.y)}add(t){return Rf.fromAffine(this).add(Rf.fromAffine(t)).toAffine()}subtract(t){return this.add(t.negate())}multiply(t){return Rf.fromAffine(this).multiply(t,this).toAffine()}}Mf.BASE=new Mf(_f.Gx,_f.Gy),Mf.ZERO=new Mf(wf,bf);class Lf{constructor(t,e){this.r=t,this.s=e,this.assertValidity()}static fromHex(t){const e=np(t,64),n=Mf.fromHex(e.slice(0,32),!1),r=$f(e.slice(32,64));return new Lf(n,r)}assertValidity(){const{r:t,s:e}=this;if(!(t instanceof Mf))throw new Error("Expected Point instance");return rp(e,_f.l,!1),this}toRawBytes(){const t=new Uint8Array(64);return t.set(this.r.toRawBytes()),t.set(jf(this.s),32),t}toHex(){return Ff(this.toRawBytes())}}function Bf(...t){if(!t.every((t=>t instanceof Uint8Array)))throw new Error("Expected Uint8Array list");if(1===t.length)return t[0];const e=t.reduce(((t,e)=>t+e.length),0),n=new Uint8Array(e);for(let r=0,i=0;r<t.length;r++){const e=t[r];n.set(e,i),i+=e.length}return n}const Uf=Array.from({length:256},((t,e)=>e.toString(16).padStart(2,"0")));function Ff(t){if(!(t instanceof Uint8Array))throw new Error("Uint8Array expected");let e="";for(let n=0;n<t.length;n++)e+=Uf[t[n]];return e}function zf(t){if("string"!==typeof t)throw new TypeError("hexToBytes: expected string, got "+typeof t);if(t.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const e=new Uint8Array(t.length/2);for(let n=0;n<e.length;n++){const r=2*n,i=t.slice(r,r+2),s=Number.parseInt(i,16);if(Number.isNaN(s)||s<0)throw new Error("Invalid byte sequence");e[n]=s}return e}function Vf(t){const e=32,n=t.toString(16).padStart(2*e,"0");return zf(n)}function jf(t){return Vf(t).reverse()}function Hf(t){return(qf(t)&bf)===bf}function $f(t){if(!(t instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Ff(Uint8Array.from(t).reverse()))}const Kf=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function Gf(t){return qf($f(t)&Kf)}function qf(t,e=_f.P){const n=t%e;return n>=wf?n:e+n}function Wf(t,e=_f.P){if(t===wf||e<=wf)throw new Error(`invert: expected positive integers, got n=${t} mod=${e}`);let n=qf(t,e),r=e,i=wf,s=bf,o=bf,a=wf;while(n!==wf){const t=r/n,e=r%n,c=i-o*t,l=s-a*t;r=n,n=e,i=o,s=a,o=c,a=l}const c=r;if(c!==bf)throw new Error("invert: does not exist");return qf(i,e)}function Yf(t,e=_f.P){const n=new Array(t.length),r=t.reduce(((t,r,i)=>r===wf?t:(n[i]=t,qf(t*r,e))),bf),i=Wf(r,e);return t.reduceRight(((t,r,i)=>r===wf?t:(n[i]=qf(t*n[i],e),qf(t*r,e))),i),n}function Xf(t,e){const{P:n}=_f;let r=t;while(e-- >wf)r*=r,r%=n;return r}function Qf(t){const{P:e}=_f,n=BigInt(5),r=BigInt(10),i=BigInt(20),s=BigInt(40),o=BigInt(80),a=t*t%e,c=a*t%e,l=Xf(c,vf)*c%e,u=Xf(l,bf)*t%e,h=Xf(u,n)*u%e,d=Xf(h,r)*h%e,f=Xf(d,i)*d%e,p=Xf(f,s)*f%e,g=Xf(p,o)*p%e,m=Xf(g,o)*p%e,y=Xf(m,r)*h%e,w=Xf(y,vf)*t%e;return{pow_p_5_8:w,b2:c}}function Jf(t,e){const n=qf(e*e*e),r=qf(n*n*e),i=Qf(t*r).pow_p_5_8;let s=qf(t*n*i);const o=qf(e*s*s),a=s,c=qf(s*Af),l=o===t,u=o===qf(-t),h=o===qf(-t*Af);return l&&(s=a),(u||h)&&(s=c),Hf(s)&&(s=qf(-s)),{isValid:l||u,value:s}}function Zf(t){return Jf(bf,t)}function tp(t){return qf($f(t),_f.l)}function ep(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function np(t,e){const n=t instanceof Uint8Array?Uint8Array.from(t):zf(t);if("number"===typeof e&&n.length!==e)throw new Error(`Expected ${e} bytes`);return n}function rp(t,e,n=!0){if(!e)throw new TypeError("Specify max value");if("number"===typeof t&&Number.isSafeInteger(t)&&(t=BigInt(t)),"bigint"===typeof t&&t<e)if(n){if(wf<t)return t}else if(wf<=t)return t;throw new TypeError("Expected valid scalar: 0 < scalar < max")}function ip(t){return t[0]&=248,t[31]&=127,t[31]|=64,t}function sp(t){if(t="bigint"===typeof t||"number"===typeof t?Vf(rp(t,Sf)):np(t),32!==t.length)throw new Error("Expected 32 bytes");return t}function op(t){const e=ip(t.slice(0,32)),n=t.slice(32,64),r=tp(e),i=Mf.BASE.multiply(r),s=i.toRawBytes();return{head:e,prefix:n,scalar:r,point:i,pointBytes:s}}let ap;async function cp(t){return op(await gp.sha512(sp(t)))}async function lp(t){return(await cp(t)).pointBytes}async function up(t,e){t=np(t);const{prefix:n,scalar:r,pointBytes:i}=await cp(e),s=tp(await gp.sha512(n,t)),o=Mf.BASE.multiply(s),a=tp(await gp.sha512(o.toRawBytes(),i,t)),c=qf(s+a*r,_f.l);return new Lf(o,c).toRawBytes()}function hp(t,e,n){e=np(e),n instanceof Mf||(n=Mf.fromHex(n,!1));const{r:r,s:i}=t instanceof Lf?t.assertValidity():Lf.fromHex(t),s=Rf.BASE.multiplyUnsafe(i);return{r:r,s:i,SB:s,pub:n,msg:e}}function dp(t,e,n,r){const i=tp(r),s=Rf.fromAffine(t).multiplyUnsafe(i),o=Rf.fromAffine(e).add(s);return o.subtract(n).multiplyUnsafe(_f.h).equals(Rf.ZERO)}async function fp(t,e,n){const{r:r,SB:i,msg:s,pub:o}=hp(t,e,n),a=await gp.sha512(r.toRawBytes(),o.toRawBytes(),s);return dp(o,r,i,a)}Mf.BASE._setWindowSize(8);const pp={node:yf,web:"object"===typeof self&&"crypto"in self?self.crypto:void 0},gp={bytesToHex:Ff,hexToBytes:zf,concatBytes:Bf,getExtendedPublicKey:cp,mod:qf,invert:Wf,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:t=>{if(t=np(t),t.length<40||t.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return qf($f(t),_f.l-bf)+bf},randomBytes:(t=32)=>{if(pp.web)return pp.web.getRandomValues(new Uint8Array(t));if(pp.node){const{randomBytes:e}=pp.node;return new Uint8Array(e(t).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>gp.randomBytes(32),sha512:async(...t)=>{const e=Bf(...t);if(pp.web){const t=await pp.web.subtle.digest("SHA-512",e.buffer);return new Uint8Array(t)}if(pp.node)return Uint8Array.from(pp.node.createHash("sha512").update(e).digest());throw new Error("The environment doesn't have sha512 function")},precompute(t=8,e=Mf.BASE){const n=e.equals(Mf.BASE)?e:new Mf(e.x,e.y);return n._setWindowSize(t),n.multiply(vf),n},sha512Sync:void 0};Object.defineProperties(gp,{sha512Sync:{configurable:!1,get(){return ap},set(t){ap||(ap=t)}}});const mp=32,yp=64,wp=32;async function bp(){const t=gp.randomPrivateKey(),e=await lp(t),n=Sp(t,e);return{privateKey:n,publicKey:e}}async function vp(t){if(t.length!==wp)throw new TypeError('"seed" must be 32 bytes in length.');if(!(t instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const e=t,n=await lp(e),r=Sp(e,n);return{privateKey:r,publicKey:n}}async function Ep(t,e){const n=t.subarray(0,wp);return await up(e,n)}async function _p(t,e,n){return await fp(e,n,t)}function Sp(t,e){const n=new Uint8Array(yp);for(let r=0;r<wp;r++)n[r]=t[r],n[wp+r]=e[r];return n}class Ap{constructor(t){this._key=Np(t,mp)}async verify(t,e){return await _p(this._key,e,t)}marshal(){return this._key}get bytes(){return Ah.encode({Type:_h.Ed25519,Data:this.marshal()}).subarray()}equals(t){return Xa(this.bytes,t.bytes)}async hash(){const{bytes:t}=await ho.digest(this.bytes);return t}}class Cp{constructor(t,e){this._key=Np(t,yp),this._publicKey=Np(e,mp)}async sign(t){return await Ep(this._key,t)}get public(){return new Ap(this._publicKey)}marshal(){return this._key}get bytes(){return Ch.encode({Type:_h.Ed25519,Data:this.marshal()}).subarray()}equals(t){return Xa(this.bytes,t.bytes)}async hash(){const{bytes:t}=await ho.digest(this.bytes);return t}async id(){const t=await Ys.digest(this.public.bytes);return Ct.encode(t.bytes).substring(1)}async export(t,e="libp2p-key"){if("libp2p-key"===e)return await lf(this.bytes,t);throw Vt(new Error(`export format '${e}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function Ip(t){if(t.length>yp){t=Np(t,yp+mp);const e=t.subarray(0,yp),n=t.subarray(yp,t.length);return new Cp(e,n)}t=Np(t,yp);const e=t.subarray(0,yp),n=t.subarray(mp);return new Cp(e,n)}function Tp(t){return t=Np(t,mp),new Ap(t)}async function kp(){const{privateKey:t,publicKey:e}=await bp();return new Cp(t,e)}async function Rp(t){const{privateKey:e,publicKey:n}=await vp(t);return new Cp(e,n)}function Np(t,e){if(t=Uint8Array.from(t??[]),t.length!==e)throw Vt(new Error(`Key must be a Uint8Array of length ${e}, got ${t.length}`),"ERR_INVALID_KEY_TYPE");return t}function Dp(){return $d.randomPrivateKey()}async function Op(t,e){const{digest:n}=await ho.digest(e);try{return await Fd(n,t)}catch(uS){throw Vt(uS,"ERR_INVALID_INPUT")}}async function Pp(t,e,n){try{const{digest:r}=await ho.digest(n);return Vd(e,r,t)}catch(uS){throw Vt(uS,"ERR_INVALID_INPUT")}}function xp(t){const e=Jh.fromHex(t).toRawBytes(!0);return e}function Mp(t){try{Pd(t,!0)}catch(uS){throw Vt(uS,"ERR_INVALID_PRIVATE_KEY")}}function Lp(t){try{Jh.fromHex(t)}catch(uS){throw Vt(uS,"ERR_INVALID_PUBLIC_KEY")}}function Bp(t){try{return Pd(t,!0)}catch(uS){throw Vt(uS,"ERR_INVALID_PRIVATE_KEY")}}class Up{constructor(t){Lp(t),this._key=t}async verify(t,e){return await Pp(this._key,e,t)}marshal(){return xp(this._key)}get bytes(){return Ah.encode({Type:_h.Secp256k1,Data:this.marshal()}).subarray()}equals(t){return Xa(this.bytes,t.bytes)}async hash(){const{bytes:t}=await ho.digest(this.bytes);return t}}class Fp{constructor(t,e){this._key=t,this._publicKey=e??Bp(t),Mp(this._key),Lp(this._publicKey)}async sign(t){return await Op(this._key,t)}get public(){return new Up(this._publicKey)}marshal(){return this._key}get bytes(){return Ch.encode({Type:_h.Secp256k1,Data:this.marshal()}).subarray()}equals(t){return Xa(this.bytes,t.bytes)}async hash(){const{bytes:t}=await ho.digest(this.bytes);return t}async id(){const t=await this.public.hash();return sa(t,"base58btc")}async export(t,e="libp2p-key"){if("libp2p-key"===e)return await lf(this.bytes,t);throw Vt(new Error(`export format '${e}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function zp(t){return new Fp(t)}function Vp(t){return new Up(t)}async function jp(){const t=await Dp();return new Fp(t)}const Hp={rsa:E,ed25519:_,secp256k1:S};function $p(t){const e=Object.keys(Hp).join(" / ");return Vt(new Error(`invalid or unsupported key type ${t}. Must be ${e}`),"ERR_UNSUPPORTED_KEY_TYPE")}function Kp(t){if(t=t.toLowerCase(),"rsa"===t||"ed25519"===t||"secp256k1"===t)return Hp[t];throw $p(t)}async function Gp(t,e){return await Kp(t).generateKeyPair(e??2048)}function qp(t){const e=Ah.decode(t),n=e.Data??new Uint8Array;switch(e.Type){case _h.RSA:return Hp.rsa.unmarshalRsaPublicKey(n);case _h.Ed25519:return Hp.ed25519.unmarshalEd25519PublicKey(n);case _h.Secp256k1:return Hp.secp256k1.unmarshalSecp256k1PublicKey(n);default:throw $p(e.Type??"RSA")}}function Wp(t,e){return e=(e??"rsa").toLowerCase(),Kp(e),t.bytes}async function Yp(t){const e=Ch.decode(t),n=e.Data??new Uint8Array;switch(e.Type){case _h.RSA:return await Hp.rsa.unmarshalRsaPrivateKey(n);case _h.Ed25519:return Hp.ed25519.unmarshalEd25519PrivateKey(n);case _h.Secp256k1:return Hp.secp256k1.unmarshalSecp256k1PrivateKey(n);default:throw $p(e.Type??"RSA")}}function Xp(t,e){return e=(e??"rsa").toLowerCase(),Kp(e),t.bytes}async function Qp(t,e){try{const n=await Uh(t,e);return await Yp(n)}catch(i){}const n=Rh.pki.decryptRsaPrivateKey(t,e);if(null===n)throw Vt(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let r=Rh.asn1.toDer(Rh.pki.privateKeyToAsn1(n));return r=Ho(r.getBytes(),"ascii"),await Hp.rsa.unmarshalRsaPrivateKey(r)}const Jp="ERR_IPNS_EXPIRED_RECORD",Zp="ERR_UNRECOGNIZED_VALIDITY",tg="ERR_SIGNATURE_CREATION",eg="ERR_SIGNATURE_VERIFICATION",ng="ERR_UNRECOGNIZED_FORMAT",rg="ERR_UNDEFINED_PARAMETER",ig="ERR_INVALID_RECORD_DATA",sg="ERR_INVALID_EMBEDDED_KEY",og="ERR_MISSING_PRIVATE_KEY";var ag;(function(t){let e,n,r;(function(t){t["EOL"]="EOL"})(e=t.ValidityType||(t.ValidityType={})),function(t){t[t["EOL"]=0]="EOL"}(n||(n={})),function(t){t.codec=()=>Th(n)}(e=t.ValidityType||(t.ValidityType={})),t.codec=()=>(null==r&&(r=kh(((e,n,r={})=>{!1!==r.lengthDelimited&&n.fork(),null!=e.value&&(n.uint32(10),n.bytes(e.value)),null!=e.signature&&(n.uint32(18),n.bytes(e.signature)),null!=e.validityType&&(n.uint32(24),t.ValidityType.codec().encode(e.validityType,n)),null!=e.validity&&(n.uint32(34),n.bytes(e.validity)),null!=e.sequence&&(n.uint32(40),n.uint64(e.sequence)),null!=e.ttl&&(n.uint32(48),n.uint64(e.ttl)),null!=e.pubKey&&(n.uint32(58),n.bytes(e.pubKey)),null!=e.signatureV2&&(n.uint32(66),n.bytes(e.signatureV2)),null!=e.data&&(n.uint32(74),n.bytes(e.data)),!1!==r.lengthDelimited&&n.ldelim()}),((e,n)=>{const r={},i=null==n?e.len:e.pos+n;while(e.pos<i){const n=e.uint32();switch(n>>>3){case 1:r.value=e.bytes();break;case 2:r.signature=e.bytes();break;case 3:r.validityType=t.ValidityType.codec().decode(e);break;case 4:r.validity=e.bytes();break;case 5:r.sequence=e.uint64();break;case 6:r.ttl=e.uint64();break;case 7:r.pubKey=e.bytes();break;case 8:r.signatureV2=e.bytes();break;case 9:r.data=e.bytes();break;default:e.skipType(7&n);break}}return r}))),r),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(ag||(ag={}));const cg=zt("ipns:utils"),lg=Ho("/ipns/");function ug(t){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(t).trim().match(e);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),i=parseInt(n[2],10)-1,s=parseInt(n[3],10),o=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),l=parseInt(n[7].slice(0,-6),10);return new Date(Date.UTC(r,i,s,o,a,c,l))}const hg=async(t,e)=>{if(null==e||null==t){const t=new Error("one or more of the provided parameters are not defined");throw cg.error(t),Vt(t,rg)}let n;if(null!=e.pubKey){try{n=qp(e.pubKey)}catch(uS){throw cg.error(uS),uS}const r=await Hu(e.pubKey);if(!r.equals(t))throw Vt(new Error("Embedded public key did not match PeerID"),sg)}else null!=t.publicKey&&(n=qp(t.publicKey));if(null!=n)return n;throw Vt(new Error("no public key is available"),rg)},dg=(t,e,n)=>{const r=Ho(e);return ya([t,n,r])},fg=t=>{const e=Ho("ipns-signature:");return ya([e,t])},pg=t=>ag.encode(t),gg=t=>{const e=ag.decode(t);return null!=e.sequence&&(e.sequence=BigInt(e.sequence)),null!=e.ttl&&(e.ttl=BigInt(e.ttl)),{value:e.value??new Uint8Array(0),signature:e.signature??new Uint8Array(0),validityType:e.validityType??ag.ValidityType.EOL,validity:e.validity??new Uint8Array(0),sequence:e.sequence??0n,pubKey:e.pubKey,ttl:e.ttl??void 0,signatureV2:e.signatureV2,data:e.data}},mg=t=>ya([lg,t.toBytes()]),yg=t=>Vu(t.slice(lg.length)),wg=(t,e,n,r,i)=>{let s;if(n!==ag.ValidityType.EOL)throw Vt(new Error("Unknown validity type"),Zp);s=0;const o={Value:t,Validity:e,ValidityType:s,Sequence:r,TTL:i};return Mi(o)},bg=t=>{const e=Hi(t);if(0!==e.ValidityType)throw Vt(new Error("Unknown validity type"),Zp);return e.ValidityType=ag.ValidityType.EOL,Number.isInteger(e.Sequence)&&(e.Sequence=BigInt(e.Sequence)),Number.isInteger(e.TTL)&&(e.TTL=BigInt(e.TTL)),e},vg=zt("ipns"),Eg=Ys.code,_g="/ipns/",Sg=_g.length,Ag=async(t,e,n,r)=>{const i=new ah(Date.now()+Number(r)),s=ag.ValidityType.EOL,[o,a]=r.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await Cg(t,e,n,s,i,c)},Cg=async(t,e,n,r,i,s)=>{n=BigInt(n);const o=Ho(i.toString());if(null==t.privateKey)throw Vt(new Error("Missing private key"),og);const a=await Yp(t.privateKey),c=await kg(a,e,r,o),l=wg(e,o,r,n,s),u=fg(l),h=await a.sign(u),d={value:e,signature:c,validityType:r,validity:o,sequence:n,ttl:s,signatureV2:h,data:l};if(null!=t.publicKey){const e=Re(t.toBytes());e.code===Eg&&Xa(t.publicKey,e.digest)||(d.pubKey=t.publicKey)}return vg("ipns entry for %b created",e),d},Ig=t=>kt.encode(t).slice(1),Tg=t=>new rl(`/ipns/${Ig(t)}`),kg=async(t,e,n,r)=>{try{const i=dg(e,n,r);return await t.sign(i)}catch(i){throw vg.error("record signature creation failed",i),Vt(new Error("record signature creation failed"),tg)}},Rg=zt("ipfs:ipns:publisher"),Ng=oh().code,Dg=36e5;class Og{constructor(t,e){this._routing=t,this._datastore=e}async publishWithEOL(t,e,n,r){const i=await this._updateOrCreateRecord(t,e,n,r);return this._putRecordToRouting(i,t,r)}publish(t,e,n){return this.publishWithEOL(t,e,Dg,n)}async _putRecordToRouting(t,e,n){if(!Ru(e)){const t="peerId received is not valid";throw Rg.error(t),Vt(new Error(t),"ERR_INVALID_PEER_ID")}if(null==e.publicKey)throw Vt(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");const r=mg(e);return await this._publishEntry(r,t,n),t}async _publishEntry(t,e,n){try{const r=await this._routing.put(t,e,n);return Rg(`ipns record for ${sa(t,"base32")} was stored in the routing`),r}catch(uS){const n=`ipns record for ${sa(t,"base32")} could not be stored in the routing - ${uS.stack}`;throw Rg.error(n),Rg.error(uS),Vt(new Error(n),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(t,e={}){if(!Ru(t)){const t="peerId received is not valid";throw Rg.error(t),Vt(new Error(t),"ERR_INVALID_PEER_ID")}const n=!1!==e.checkRouting;try{const e=await this._datastore.get(Tg(t.toBytes()));return this._unmarshalData(e)}catch(uS){if(uS.code!==Ng){const e=`unexpected error getting the ipns record ${t.toString()} from datastore`;throw Rg.error(e),Vt(new Error(e),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw Vt(uS,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{const e=mg(t),n=await this._routing.get(e);return this._unmarshalData(n)}catch(uS){throw Rg.error(uS),uS}}}_unmarshalData(t){try{return gg(t)}catch(uS){throw Vt(uS,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(t,e,n,r){if(!Ru(t)){const t="peerId received is not valid";throw Rg.error(t),Vt(new Error(t),"ERR_INVALID_PEER_ID")}const i={checkRouting:!0};let s;try{s=await this._getPublished(t,i)}catch(uS){if(uS.code!==Ng){const n=`unexpected error when determining the last published IPNS record for ${t.toString()} ${uS.stack}`;throw Rg.error(n),Vt(new Error(n),"ERR_DETERMINING_PUBLISHED_RECORD")}}let o,a=0n;s&&void 0!==s.sequence&&(a=Xa(s.value,e)?s.sequence:s.sequence+BigInt(1));try{o=await Ag(t,e,a,n)}catch(uS){const n=`ipns record for ${e} could not be created`;throw Rg.error(uS),Vt(new Error(n),"ERR_CREATING_IPNS_RECORD")}try{const n=pg(o);return await this._datastore.put(Tg(t.toBytes()),n,r),Rg(`ipns record for ${sa(e,"base32")} was stored in the datastore`),n}catch(uS){const n=`ipns record for ${e} could not be stored in the datastore`;throw Rg.error(n),Vt(new Error(n),"ERR_STORING_IN_DATASTORE")}}}Og.defaultRecordLifetime=Dg;const Pg=zt("ipfs:ipns:republisher"),xg=6e4,Mg=60*xg,Lg=4*Mg,Bg=24*Mg;class Ug{constructor(t,e,n,r,i={pass:""}){this._publisher=t,this._datastore=e,this._peerId=n,this._keychain=r,this._options=i,this._republishHandle=null}async start(){if(this._republishHandle)throw Vt(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");const t={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:e=>{t._timeoutId=setTimeout((async()=>{t._timeoutId=null;try{t._inflightTask=t._task(),await t._inflightTask,t._task&&t.runPeriodically(e)}catch(uS){Pg.error(uS)}}),e())},cancel:async()=>{null!=t._timeoutId&&clearTimeout(t._timeoutId),t._task=null,await t._inflightTask}},{pass:e}=this._options;let n=!0;t._task=async()=>{const t=new $o.TimeoutController(3e4);try{await this._republishEntries(this._peerId,e,{signal:t.signal})}finally{t.clear()}},t.runPeriodically((()=>n?(n=!1,this._options.initialBroadcastInterval||xg):this._options.broadcastInterval||Lg)),this._republishHandle=t}async stop(){const t=this._republishHandle;if(!t)throw Vt(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await t.cancel()}async _republishEntries(t,e,n){try{await this._republishEntry(t,n)}catch(uS){const e="cannot republish entry for the node's private key";return void Pg.error(e)}if(e)try{const t=await this._keychain.listKeys();for(const r of t){if("self"===r.name)continue;const t=await this._keychain.exportKey(r.name,e),i=await Qp(t,e),s=await Hu(i.public.bytes,i.bytes);await this._republishEntry(s,n)}}catch(uS){Pg.error(uS)}}async _republishEntry(t,e){try{const n=await this._getPreviousValue(t);await this._publisher.publishWithEOL(t,n,Bg,e)}catch(uS){if("ERR_NO_ENTRY_FOUND"===uS.code)return;throw uS}}async _getPreviousValue(t){if(!Ru(t))throw Vt(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{const e=await this._datastore.get(Tg(t.toBytes()));if(!(e instanceof Uint8Array))throw Vt(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{const t=gg(e);return t.value}catch(uS){throw Pg.error(uS),Vt(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(uS){if(uS&&uS.notFound)throw Vt(new Error(`no previous entry for record with id: ${t.toString()}`),"ERR_NO_ENTRY_FOUND");throw uS}}}const Fg=zt("ipns:validator"),zg=async(t,e)=>{const{value:n,validityType:r,validity:i}=e;let s,o,a;if(null==e.signatureV2||null==e.data)throw Vt(new Error("missing data or signatureV2"),eg);o=e.signatureV2,s=fg(e.data),Vg(e);try{a=await t.verify(s,o)}catch(uS){a=!1}if(!a)throw Fg.error("record signature verification failed"),Vt(new Error("record signature verification failed"),eg);if(null!=i&&r===ag.ValidityType.EOL){let t;try{t=ug(sa(i))}catch(c){throw Fg.error("unrecognized validity format (not an rfc3339 format)"),Vt(new Error("unrecognized validity format (not an rfc3339 format)"),ng)}if(t.getTime()<Date.now())throw Fg.error("record has expired"),Vt(new Error("record has expired"),Jp)}else if(null!=r)throw Fg.error("unrecognized validity type"),Vt(new Error("unrecognized validity type"),Zp);Fg("ipns entry for %b is valid",n)},Vg=t=>{if(null==t.data)throw Vt(new Error("Record data is missing"),ig);const e=bg(t.data);if(!Xa(e.Value,t.value))throw Vt(new Error('Field "value" did not match between protobuf and CBOR'),eg);if(!Xa(e.Validity,t.validity))throw Vt(new Error('Field "validity" did not match between protobuf and CBOR'),eg);if(e.ValidityType!==t.validityType)throw Vt(new Error('Field "validityType" did not match between protobuf and CBOR'),eg);if(e.Sequence!==t.sequence)throw Vt(new Error('Field "sequence" did not match between protobuf and CBOR'),eg);if(e.TTL!==t.ttl)throw Vt(new Error('Field "ttl" did not match between protobuf and CBOR'),eg)},jg=async(t,e)=>{const n=yg(t),r=gg(e),i=await hg(n,r);await zg(i,r)},Hg=zt("ipfs:ipns:resolver"),$g=oh().code,Kg=32;class Gg{constructor(t){this._routing=t}async resolve(t,e={}){if("string"!==typeof t)throw Vt(new Error("invalid name"),"ERR_INVALID_NAME");const n=e.recursive&&"true"===e.recursive.toString(),r=t.split("/");if(3!==r.length||""!==r[0])throw Vt(new Error("invalid name"),"ERR_INVALID_NAME");const i=r[2];let s=1/0;n&&(s=Kg);const o=await this.resolver(i,s,e);return Hg(`${t} was locally resolved correctly`),o}async resolver(t,e,n){if(0===e){const t=`could not resolve name (recursion limit of ${Kg} exceeded)`;throw Hg.error(t),Vt(new Error(t),"ERR_RESOLVE_RECURSION_LIMIT")}const r=await this._resolveName(t,n),i=r.split("/");return"ipfs"!==i[1]&&e?this.resolver(i[2],e-1,n):r}async _resolveName(t,e){const n=zu(t),r=mg(n);let i;try{i=await this._routing.get(r,e)}catch(uS){if(Hg.error("could not get record from routing",uS),uS.code===$g)throw Vt(new Error(`record requested for ${t} was not found in the network`),"ERR_NO_RECORD_FOUND");throw Vt(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,i)}async _validateRecord(t,e){await jg(ya([Ho("/ipns/"),t.toBytes()]),e);const n=gg(e);return sa(n.value)}}class qg{constructor(t){this.lru=Rl(t)}get(t){const e=this.lru.get(t);if(e)return e.expire&&e.expire<Date.now()?void this.lru.remove(t):e.value}set(t,e,n){this.lru.set(t,{value:e,expire:Date.now()+n})}has(t){const e=this.get(t);return!!e}remove(t){this.lru.remove(t)}clear(){this.lru.clear()}}const Wg=zt("ipfs:ipns"),Yg=6e4;class Xg{constructor(t,e,n,r,i){this.publisher=new Og(t,e),this.republisher=new Ug(this.publisher,e,n,r,i),this.resolver=new Gg(t),this.cache=new qg(1e3),this.routing=t}async publish(t,e,n=Og.defaultRecordLifetime,r){try{await this.publisher.publishWithEOL(t,e,n,r),Wg(`IPNS value ${sa(e,"base32")} was published correctly`);const i=t.toString(),s=parseFloat(n),o=s<Yg?s:Yg;return this.cache.set(i,e,o),Wg(`IPNS value ${sa(e,"base32")} was cached correctly`),{name:i,value:e}}catch(uS){throw Wg.error(uS),uS}}async resolve(t,e={}){if("string"!==typeof t)throw Vt(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!e.nocache&&!e.recursive){const e=t.split("/")[2],n=this.cache.get(e);if(n)return n}try{const n=await this.resolver.resolve(t,e);return Wg(`IPNS record from ${t} was resolved correctly`),n}catch(uS){throw Wg.error(uS),uS}}async initializeKeyspace(t,e,n){return this.publish(t,e,Og.defaultRecordLifetime,n)}}async function Qg(t){const e=[];for await(const n of t)e.push(n);return e}const Jg=(t,e)=>async function*(){const n=await Qg(t);yield*n.sort(e)}();async function Zg(t){for await(const e of t);}async function*tm(t,e){for await(const n of t)await e(n)&&(yield n)}async function*em(t,e){let n=0;if(!(e<1))for await(const r of t)if(yield r,n++,n===e)return}class nm{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(t,e,n){return Promise.reject(new Error(".put is not implemented"))}get(t,e){return Promise.reject(new Error(".get is not implemented"))}has(t,e){return Promise.reject(new Error(".has is not implemented"))}delete(t,e){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(t,e={}){for await(const{key:n,value:r}of t)await this.put(n,r,e),yield{key:n,value:r}}async*getMany(t,e={}){for await(const n of t)yield this.get(n,e)}async*deleteMany(t,e={}){for await(const n of t)await this.delete(n,e),yield n}batch(){let t=[],e=[];return{put(e,n){t.push({key:e,value:n})},delete(t){e.push(t)},commit:async n=>{await Zg(this.putMany(t,n)),t=[],await Zg(this.deleteMany(e,n)),e=[]}}}async*_all(t,e){throw new Error("._all is not implemented")}async*_allKeys(t,e){throw new Error("._allKeys is not implemented")}query(t,e){let n=this._all(t,e);if(null!=t.prefix&&(n=tm(n,(e=>e.key.toString().startsWith(t.prefix)))),Array.isArray(t.filters)&&(n=t.filters.reduce(((t,e)=>tm(t,e)),n)),Array.isArray(t.orders)&&(n=t.orders.reduce(((t,e)=>Jg(t,e)),n)),null!=t.offset){let e=0;n=tm(n,(()=>e++>=t.offset))}return null!=t.limit&&(n=em(n,t.limit)),n}queryKeys(t,e){let n=this._allKeys(t,e);if(null!=t.prefix&&(n=tm(n,(e=>e.toString().startsWith(t.prefix)))),Array.isArray(t.filters)&&(n=t.filters.reduce(((t,e)=>tm(t,e)),n)),Array.isArray(t.orders)&&(n=t.orders.reduce(((t,e)=>Jg(t,e)),n)),null!=t.offset){let e=0;n=tm(n,(()=>e++>=t.offset))}return null!=t.limit&&(n=em(n,t.limit)),n}}class rm{constructor(t){if(!(t>0)||0!==(t-1&t))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(t),this.mask=t-1,this.top=0,this.btm=0,this.next=null}push(t){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=t,this.top=this.top+1&this.mask,!0)}shift(){const t=this.buffer[this.btm];if(void 0!==t)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,t}isEmpty(){return void 0===this.buffer[this.btm]}}class im{constructor(t={}){this.hwm=t.splitLimit??16,this.head=new rm(this.hwm),this.tail=this.head,this.size=0}calculateSize(t){return null!=t?.byteLength?t.byteLength:1}push(t){if(null!=t?.value&&(this.size+=this.calculateSize(t.value)),!this.head.push(t)){const e=this.head;this.head=e.next=new rm(2*this.head.buffer.length),this.head.push(t)}}shift(){let t=this.tail.shift();if(void 0===t&&null!=this.tail.next){const e=this.tail.next;this.tail.next=null,this.tail=e,t=this.tail.shift()}return null!=t?.value&&(this.size-=this.calculateSize(t.value)),t}isEmpty(){return this.head.isEmpty()}}function sm(t={}){const e=t=>{const e=t.shift();if(null==e)return{done:!0};if(null!=e.error)throw e.error;return{done:!0===e.done,value:e.value}};return am(e,t)}function om(t={}){const e=t=>{let e;const n=[];while(!t.isEmpty()){if(e=t.shift(),null==e)break;if(null!=e.error)throw e.error;!1===e.done&&n.push(e.value)}return null==e?{done:!0}:{done:!0===e.done,value:n}};return am(e,t)}function am(t,e){e=e??{};let n,r,i,s=e.onEnd,o=new im;const a=async()=>o.isEmpty()?i?{done:!0}:await new Promise(((e,i)=>{r=s=>{r=null,o.push(s);try{e(t(o))}catch(uS){i(uS)}return n}})):t(o),c=t=>null!=r?r(t):(o.push(t),n),l=t=>(o=new im,null!=r?r({error:t}):(o.push({error:t}),n)),u=t=>{if(i)return n;if(!0!==e?.objectMode&&null==t?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:t})},h=t=>i?n:(i=!0,null!=t?l(t):c({done:!0})),d=()=>(o=new im,h(),{done:!0}),f=t=>(h(t),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:a,return:d,throw:f,push:u,end:h,get readableLength(){return o.size}},null==s)return n;const p=n;return n={[Symbol.asyncIterator](){return this},next(){return p.next()},throw(t){return p.throw(t),null!=s&&(s(t),s=void 0),{done:!0}},return(){return p.return(),null!=s&&(s(),s=void 0),{done:!0}},push:u,end(t){return p.end(t),null!=s&&(s(t),s=void 0),n},get readableLength(){return p.readableLength}},n}const cm=zt("datastore:core:tiered");class lm extends nm{constructor(t){super(),this.stores=t.slice()}async open(){try{await Promise.all(this.stores.map((t=>t.open())))}catch(uS){throw rh()}}async put(t,e,n){try{await Promise.all(this.stores.map((r=>r.put(t,e,n))))}catch(uS){throw sh()}}async get(t,e){for(const n of this.stores)try{const r=await n.get(t,e);if(r)return r}catch(uS){cm.error(uS)}throw oh()}async has(t,e){for(const n of this.stores)if(await n.has(t,e))return!0;return!1}async delete(t,e){try{await Promise.all(this.stores.map((n=>n.delete(t,e))))}catch(uS){throw ih()}}async*putMany(t,e={}){let n;const r=this.stores.map((t=>{const r=sm({objectMode:!0});return Zg(t.putMany(r,e)).catch((t=>{n=t})),r}));try{for await(const e of t){if(n)throw n;r.forEach((t=>t.push(e))),yield e}}finally{r.forEach((t=>t.end()))}}async*deleteMany(t,e={}){let n;const r=this.stores.map((t=>{const r=sm({objectMode:!0});return Zg(t.deleteMany(r,e)).catch((t=>{n=t})),r}));try{for await(const e of t){if(n)throw n;r.forEach((t=>t.push(e))),yield e}}finally{r.forEach((t=>t.end()))}}async close(){await Promise.all(this.stores.map((t=>t.close())))}batch(){const t=this.stores.map((t=>t.batch()));return{put:(e,n)=>{t.forEach((t=>t.put(e,n)))},delete:e=>{t.forEach((t=>t.delete(e)))},commit:async e=>{for(const n of t)await n.commit(e)}}}query(t,e){return this.stores[this.stores.length-1].query(t,e)}queryKeys(t,e){return this.stores[this.stores.length-1].queryKeys(t,e)}}var um=n(6759);const hm=(t,e)=>{const n=e.map(((t,e)=>({entry:ag.decode(t),index:e})));return n.sort(((t,e)=>{if(null!=t.entry.signatureV2&&null==e.entry.signatureV2)return-1;if(null==t.entry.signatureV2&&null!=e.entry.signatureV2)return 1;const n=t.entry.sequence??0n,r=e.entry.sequence??0n;if(n>r)return-1;if(n<r)return 1;const i=t.entry.validity??new Uint8Array(0),s=e.entry.validity??new Uint8Array(0),o=ug(sa(i)),a=ug(sa(s));return o.getTime()>a.getTime()?-1:o.getTime()<a.getTime()?1:0})),n[0].index},dm="SHARDING",fm="_README";class pm extends nm{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(t,e){this.data[t.toString()]=e}async get(t){const e=await this.has(t);if(!e)throw oh();return this.data[t.toString()]}async has(t){return void 0!==this.data[t.toString()]}async delete(t){delete this.data[t.toString()]}async*_all(){yield*Object.entries(this.data).map((([t,e])=>({key:new rl(t),value:e})))}async*_allKeys(){yield*Object.entries(this.data).map((([t])=>new rl(t)))}}async function*gm(...t){const e=sm({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(t.map((async t=>{for await(const n of t)e.push(n)}))),e.end()}catch(uS){e.end(uS)}})),yield*e}const mm=(...t)=>{let e;while(t.length>0)e=t.shift()(e);return e},ym=t=>null!=t&&("function"===typeof t[Symbol.asyncIterator]||"function"===typeof t[Symbol.iterator]||"function"===typeof t.next),wm=t=>null!=t&&"function"===typeof t.sink&&ym(t.source),bm=t=>e=>{const n=t.sink(e);if(null!=n.then){const e=sm({objectMode:!0});n.then((()=>{e.end()}),(t=>{e.end(t)}));const r=async function*(){yield*t.source,e.end()};return gm(e,r())}return t.source};function vm(t,...e){if(wm(t)){const e=t;t=()=>e.source}else if(ym(t)){const e=t;t=()=>e}const n=[t,...e];if(n.length>1&&wm(n[n.length-1])&&(n[n.length-1]=n[n.length-1].sink),n.length>2)for(let r=1;r<n.length-1;r++)wm(n[r])&&(n[r]=bm(n[r]));return mm(...n)}new rl(dm),new rl(fm);const Em="/record/";function _m(t){return sa(t,"base32")}function Sm(t){("string"===typeof t||t instanceof String)&&(t=Ho(t.toString()));const e=sa(t,"base64url");return`${Em}${e}`}function Am(t){if(t.substring(0,Em.length)!==Em)throw Vt(new Error("topic received is not from a record"),"ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const e=t.substring(Em.length);return Ho(e,"base64url")}const Cm=zt("datastore-pubsub:publisher");class Im extends nm{constructor(t,e,n,r,i,s){if(super(),!r)throw Vt(new TypeError("missing validator"),"ERR_INVALID_PARAMETERS");if("function"!==typeof r)throw Vt(new TypeError("missing validate function"),"ERR_INVALID_PARAMETERS");if("function"!==typeof i)throw Vt(new TypeError("missing select function"),"ERR_INVALID_PARAMETERS");if(s&&"function"!==typeof s)throw Vt(new TypeError("invalid subscriptionKeyFn received"),"ERR_INVALID_PARAMETERS");this._pubsub=t,this._datastore=e,this._peerId=n,this._validator=r,this._selector=i,this._handleSubscriptionKeyFn=s,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(t,e,n){if(!(t instanceof Uint8Array)){const t="datastore key does not have a valid format";throw Cm.error(t),Vt(new Error(t),"ERR_INVALID_DATASTORE_KEY")}if(!(e instanceof Uint8Array)){const t="received value is not a Uint8Array";throw Cm.error(t),Vt(new Error(t),"ERR_INVALID_VALUE_RECEIVED")}const r=Sm(t);Cm(`publish value for topic ${r}`),await this._pubsub.publish(r,e)}async get(t,e){if(!(t instanceof Uint8Array)){const t="datastore key does not have a valid format";throw Cm.error(t),Vt(new Error(t),"ERR_INVALID_DATASTORE_KEY")}const n=Sm(t),r=await this._pubsub.getTopics();if(r&&Array.isArray(r)&&r.indexOf(n)>-1)return this._getLocal(t,e);try{await this._pubsub.subscribe(n)}catch(uS){const e=`cannot subscribe topic ${n}`;throw Cm.error(e),Vt(new Error(e),"ERR_SUBSCRIBING_TOPIC")}return Cm(`subscribed values for key ${n}`),this._getLocal(t)}unsubscribe(t){const e=Sm(t);return this._pubsub.unsubscribe(e)}async _getLocal(t,e){const n=new rl("/"+_m(t),!1);let r;try{r=await this._datastore.get(n,e)}catch(uS){if("ERR_NOT_FOUND"!==uS.code){const t=`unexpected error getting the ipns record for ${n.toString()}`;throw Cm.error(t),Vt(new Error(t),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const e=`local record requested was not found for ${n.toString()}`;throw Cm.error(e),Vt(new Error(e),"ERR_NOT_FOUND")}if(!(r instanceof Uint8Array)){const t="found record that we couldn't convert to a value";throw Cm.error(t),Vt(new Error(t),"ERR_INVALID_RECORD_RECEIVED")}return r}async _onMessage(t){const e=t.detail;if("signed"!==e.type)return void Cm.error("unsigned message received, this module can only work with signed messages");const{data:n,from:r,topic:i}=e;let s;try{s=Am(i)}catch(uS){return void Cm.error(uS)}if(Cm(`message received for topic ${i}`),this._peerId.equals(r))Cm("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let t;try{t=await this._handleSubscriptionKeyFn(s)}catch(uS){return void Cm.error("message discarded by the subscriptionKeyFn")}s=t}try{await this._storeIfSubscriptionIsBetter(s,n)}catch(uS){Cm.error(uS)}}}async _storeIfSubscriptionIsBetter(t,e,n){let r=!1;try{r=await this._isBetter(t,e)}catch(uS){if("ERR_NOT_VALID_RECORD"!==uS.code)throw uS}r&&await this._storeRecord(t,e,n)}async _validateRecord(t,e){return this._validator(t,e)}async _selectRecord(t,e){const n=await this._selector(t,e);return 0===n}async _isBetter(t,e){try{await this._validateRecord(t,e)}catch(uS){const e="record received through pubsub is not valid";throw Cm.error(e),Vt(new Error(e),"ERR_NOT_VALID_RECORD")}const n=new rl(t);let r;try{r=await this._getLocal(n.uint8Array())}catch(uS){return!0}return!Xa(r,e)&&this._selectRecord(t,[r,e])}async _storeRecord(t,e,n){const r=new rl("/"+_m(t),!1);await this._datastore.put(r,e,n),Cm(`record for ${Sm(t)} was stored in the datastore`)}}const Tm=zt("ipfs:ipns:pubsub");class km{constructor(t,e,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new Im(t,e,n,jg,hm,this._handleSubscriptionKey)}async put(t,e,n){try{await this._pubsubDs.put(t,e,n)}catch(uS){throw Tm.error(uS),uS}}async get(t,e){let n,r;try{n=await this._pubsubDs.get(t,e)}catch(s){r=s}const i=t.slice(0,Sg);if(sa(i)===_g){const e=Ct.encode(t).substring(1),n=Ct.encode(t.slice(Sg)).substring(1);this._subscriptions[e]=n,Tm(`subscribed to pubsub topic ${e}, id ${n}`)}if(r)throw r;return n}_handleSubscriptionKey(t){t instanceof Uint8Array&&(t=sa(t,"base58btc"));const e=this._subscriptions[t];if(!e)throw Vt(new Error(`key ${t} does not correspond to a subscription`),"ERR_INVALID_KEY");try{const t=mg(zu(e));return t}catch(uS){throw Tm.error(uS),uS}}getSubscriptions(){const t=Object.values(this._subscriptions).filter(Boolean);return t.map((t=>`${_g}${t}`))}async cancel(t){if("string"!==typeof t)throw Vt(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");t.startsWith(_g)&&(t=t.substring(Sg));const e=Object.keys(this._subscriptions).find((e=>this._subscriptions[e]===t));if(!e)return{canceled:!1};const n=Ho(e);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[e],Tm(`unsubscribed pubsub ${e}: ${t}`),{canceled:!0}}}var Rm;function Nm(t){const e=t.getUTCFullYear(),n=String(t.getUTCMonth()+1).padStart(2,"0"),r=String(t.getUTCDate()).padStart(2,"0"),i=String(t.getUTCHours()).padStart(2,"0"),s=String(t.getUTCMinutes()).padStart(2,"0"),o=String(t.getUTCSeconds()).padStart(2,"0"),a=t.getUTCMilliseconds(),c=String(1e3*a*1e3).padStart(9,"0");return`${e}-${n}-${r}T${i}:${s}:${o}.${c}Z`}function Dm(t){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(t).trim().match(e);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),i=parseInt(n[2],10)-1,s=parseInt(n[3],10),o=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),l=parseInt(n[7].slice(0,-6),10);return new Date(Date.UTC(r,i,s,o,a,c,l))}(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.key&&t.key.byteLength>0)&&(e.uint32(10),e.bytes(t.key)),(!0===n.writeDefaults||null!=t.value&&t.value.byteLength>0)&&(e.uint32(18),e.bytes(t.value)),!0!==n.writeDefaults&&""===t.timeReceived||(e.uint32(42),e.string(t.timeReceived)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.key=t.bytes();break;case 2:n.value=t.bytes();break;case 5:n.timeReceived=t.string();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(Rm||(Rm={}));class Om{constructor(t,e,n){if(!(t instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(e instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=t,this.value=e,this.timeReceived=n}serialize(){return Rm.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Nm(this.timeReceived)}}static deserialize(t){const e=Rm.decode(t);return new Om(e.key,e.value,new Date(e.timeReceived))}static fromDeserialized(t){const e=Dm(t.timeReceived);if(null==t.key)throw new Error("key missing from deserialized object");if(null==t.value)throw new Error("value missing from deserialized object");const n=new Om(t.key,t.value,e);return n}}const Pm=zt("ipfs:ipns:offline-datastore");class xm{constructor(t){this._datastore=t,this.stores=[]}async put(t,e,n){if(!(t instanceof Uint8Array))throw Vt(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(e instanceof Uint8Array))throw Vt(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let r;try{r=this._routingKey(t)}catch(uS){throw Pm.error(uS),Vt(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const i=new Om(t,e,new Date);await this._datastore.put(r,i.serialize(),n)}async get(t,e){if(!(t instanceof Uint8Array))throw Vt(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(t)}catch(uS){throw Pm.error(uS),Vt(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const r=await this._datastore.get(n,e);let i;try{i=Om.deserialize(r)}catch(uS){throw Pm.error(uS),uS}return i.value}_routingKey(t){return new rl("/dht/record/"+sa(t,"base32"),!1)}}const Mm=zt("ipfs:ipns:dht-datastore");class Lm{constructor(t){this._dht=t}async put(t,e,n){try{await Zg(this._dht.put(t,e,n))}catch(uS){throw Mm.error(uS),uS}}async get(t,e){for await(const n of this._dht.get(t,e))if("VALUE"===n.name)return n.value;throw oh()}}function Bm({libp2p:t,repo:e,peerId:n,options:r}){const i=[];let s;if(um(r,"EXPERIMENTAL.ipnsPubsub",!1)&&(s=new km(t.pubsub,e.datastore,n),i.push(s)),!0!==um(r,"offline",!1)&&["dht","dhtclient","dhtserver"].includes(um(r,"config.Routing.Type","none"))&&i.push(new Lm(t.dht)),um(r,"offline",!1)||0===i.length){const t=new xm(e.datastore);i.push(t)}return new lm(i)}const Um=zt("ipfs:components:ipns");class Fm{constructor(t={pass:""}){this.options=t,this.offline=null,this.online=null}getIPNS(){const t=this.online||this.offline;if(t)return t;throw new ko}get routing(){return this.getIPNS().routing}startOffline({repo:t,peerId:e,keychain:n}){if(null!=this.offline)throw new No;Um("initializing IPNS keyspace (offline)");const r=new xm(t.datastore),i=new Xg(r,t.datastore,e,n,this.options);this.offline=i}async startOnline({libp2p:t,repo:e,peerId:n,keychain:r}){if(null!=this.online)throw new No;const i=Bm({libp2p:t,repo:e,peerId:n,options:this.options}),s=new Xg(i,e.datastore,n,r,this.options);await s.republisher.start(),this.online=s}async stop(){const t=this.online;t&&(await t.republisher.stop(),this.online=null)}publish(t,e,n,r){return this.getIPNS().publish(t,e,n,r)}resolve(t,e){return this.getIPNS().resolve(t,e)}initializeKeyspace(t,e,n){return this.getIPNS().initializeKeyspace(t,e,n)}}async function zm({ipns:t,repo:e,codecs:n},r,i){if(Jc(r))return t.resolve(r);const{cid:s,path:o}=gl(r);await Zg(Cl(s,o||"",n,e,i))}const Vm=zt("ipfs:name:publish");function jm({ipns:t,repo:e,codecs:n,peerId:r,isOnline:i,keychain:s}){const o=async t=>{let e;if("self"===t&&null!=r.privateKey)e=await Yp(r.privateKey);else try{const n=await s.exportKey(t,"temp");e=await Qp(n,"temp")}catch(uS){throw Vm.error(uS),Vt(uS,"ERR_CANNOT_GET_KEY")}return Hu(e.public.bytes,e.bytes)};async function a(r,s={}){const a=!(!1===s.resolve),c=s.lifetime||"24h",l=s.key||"self";if(!i())throw Vt(new Error(yl),"OFFLINE_ERROR");try{r=vl(r)}catch(uS){throw Vm.error(uS),uS}let u=0;try{u=hl(c)||0,u=parseFloat(u.toFixed(6))}catch(uS){throw Vm.error(uS),uS}const h=await Promise.all([o(l),a?zm({ipns:t,repo:e,codecs:n},r):Promise.resolve()]),d=Ho(r),f=await t.publish(h[0],d,u,s);return{name:f.name,value:sa(f.value)}}return fl(a)}var Hm=n(6209);const $m=nt.bind({ignoreUndefined:!0}),Km=zt("ipfs:name:resolve"),Gm=(t,e)=>e.length>0?t+"/"+e.join("/"):t;function qm({dns:t,ipns:e,isOnline:n,options:{offline:r}}){async function*i(i,s={}){if(s=$m({nocache:!1,recursive:!0},s),r&&s&&s.nocache)throw Vt(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!n()&&!r)throw Vt(new Error(yl),"OFFLINE_ERROR");let o=i.toString();o.startsWith("/ipns/")||(o=`/ipns/${o}`);let[a,c,...l]=o.slice(1).split("/");try{if("1"===c.substring(0,1)){const t=zu(c),e=Re(t.toBytes()),n=Me.createV1(114,e);c=n.toString(no)}else{const t=Me.parse(c);1===t.version&&(c=t.toString(no))}}catch(uS){if(Hm(c))return void(yield Gm(await t(c,s),l));throw Km.error(uS),Vt(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}const u=await e.resolve(`/${a}/${c}`,s);yield Gm(u instanceof Uint8Array?sa(u):u,l)}return fl(i)}function Wm(t,e){if(!t||!e||!e.ipnsPubsub)throw Vt(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(t.routing instanceof km)return t.routing;const n=(t.routing.stores||[]).find((t=>t instanceof km));if(!n)throw Vt(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return n}function Ym({ipns:t,options:e}){const n=e.EXPERIMENTAL;async function r(e,r={}){const i=Wm(t,n);return i.cancel(e,r)}return fl(r)}function Xm({ipns:t,options:e}){const n=e.EXPERIMENTAL;async function r(e={}){try{return{enabled:Boolean(Wm(t,n))}}catch(uS){return{enabled:!1}}}return fl(r)}function Qm({ipns:t,options:e}){const n=e.EXPERIMENTAL;async function r(e={}){const r=Wm(t,n);return r.getSubscriptions(e)}return fl(r)}class Jm{constructor({ipns:t,options:e}){this.cancel=Ym({ipns:t,options:e}),this.state=Xm({ipns:t,options:e}),this.subs=Qm({ipns:t,options:e})}}class Zm{constructor({dns:t,ipns:e,repo:n,codecs:r,peerId:i,isOnline:s,keychain:o,options:a}){this.publish=jm({ipns:e,repo:n,codecs:r,peerId:i,isOnline:s,keychain:o}),this.resolve=qm({dns:t,ipns:e,isOnline:s,options:a}),this.pubsub=new Jm({ipns:e,options:a})}}const ty=oh().code,ey={default:"<dst>",edges:"<src> -> <dst>"};function ny({repo:t,codecs:e,resolve:n,preload:r}){async function*i(i,s={}){if(0===s.maxDepth)return;if(s.edges&&s.format&&s.format!==ey.default)throw new Error("Cannot set edges to true and also specify format");if(s.format=s.edges?ey.edges:s.format,"number"!==typeof s.maxDepth&&(s.maxDepth=s.recursive?1/0:1),s.timeout){const t=new $o.TimeoutController(s.timeout),e=[t.signal];s.signal&&e.push(s.signal),s.signal=(0,al.anySignal)(e)}const o=Array.isArray(i)?i:[i],a=o.map((t=>ry(r,t,s)));for(const r of a)try{yield*iy(n,t,e,r,s)}catch(uS){yield{ref:"",err:uS.message}}}return i}function ry(t,e,n){const{cid:r,path:i}=gl(e);return!1!==n.preload&&t(r),`/ipfs/${r}${i||""}`}async function*iy(t,e,n,r,i){const s=await t(r,i),{cid:o}=gl(s),a=null!=i.maxDepth?i.maxDepth:1/0,c=i.unique||!1;for await(const l of oy(e,n,o,a,c,i))l.parent&&(l.isDuplicate||(yield{ref:sy(l.parent.cid,l.node.cid,l.node.name,i.format)}))}function sy(t,e,n="",r=ey.default){let i=r.replace(/<src>/g,t.toString());return i=i.replace(/<dst>/g,e.toString()),i=i.replace(/<linkname>/g,n),i}async function*oy(t,e,n,r,i,s){const o=new Set;async function*a(n,c){const l=c+1;if(!(l>r))try{for await(const r of ay(t,e,n.cid,s))yield{parent:n,node:r,isDuplicate:i&&o.has(r.cid.toString())},i&&o.add(r.cid.toString()),yield*a(r,l)}catch(uS){throw uS.code===ty&&(uS.message=`Could not find object with CID: ${n.cid}`),uS}}yield*a({cid:n},0)}async function*ay(t,e,n,r){const i=await t.blocks.get(n,r),s=await e.getCodec(n.code),o=s.decode(i),a=n.code===wn,c=[];for(const[l,u]of cy(o,c)){if(a){const t=l.match(/^Links\/(\d+)\/Hash$/);if(t){const e=Number(t[1]);if(e<o.Links.length){yield{name:o.Links[e].Name,cid:u};continue}}}yield{name:l,cid:u}}}const cy=function*(t,e){if(null!=t&&!(t instanceof Uint8Array)){for(const[n,r]of Object.entries(t)){const t=[...e,n];if(null!=r&&"object"===typeof r)if(Array.isArray(r))for(const[e,n]of r.entries()){const r=[...t,e],i=Me.asCID(n);i?yield[r.join("/"),i]:"object"===typeof n&&(yield*cy(n,r))}else{const e=Me.asCID(r);e?yield[t.join("/"),e]:yield*cy(r,t)}}return[]}};function ly({repo:t}){async function*e(e={}){for await(const n of t.blocks.queryKeys({},{signal:e.signal}))yield{ref:n.toString()}}return fl(e)}function uy({network:t}){async function e(e={}){const{bitswap:n}=await t.use(e),r=n.getWantlist();return Array.from(r).map((t=>t[1].cid))}return fl(e)}function hy({network:t}){async function e(e,n={}){const{bitswap:r}=await t.use(n),i=r.wantlistForPeer(e);return Array.from(i).map((t=>t[1].cid))}return fl(e)}function dy({network:t}){async function e(e,n={}){const{bitswap:r}=await t.use(n);return Array.isArray(e)||(e=[e]),r.unwant(e)}return fl(e)}function fy({network:t}){async function e(e={}){const n=(await t.use(e)).bitswap,r=n.stat().snapshot;return{provideBufLen:parseInt(r.providesBufferLength.toString()),blocksReceived:BigInt(r.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map((t=>t[1].cid)),peers:n.peers(),dupBlksReceived:BigInt(r.dupBlksReceived.toString()),dupDataReceived:BigInt(r.dupDataReceived.toString()),dataReceived:BigInt(r.dataReceived.toString()),blocksSent:BigInt(r.blocksSent.toString()),dataSent:BigInt(r.dataSent.toString())}}return fl(e)}class py{constructor({network:t}){this.wantlist=uy({network:t}),this.wantlistForPeer=hy({network:t}),this.unwant=dy({network:t}),this.stat=fy({network:t})}}function gy(t){try{return xc.matches(t)}catch(uS){return!1}}function my({repo:t}){async function e(e,n={}){if(!gy(e))throw new Error(`${e} is not a valid Multiaddr`);const r=await t.config.getAll(n),i=r.Bootstrap||[];return i.push(e.toString()),r.Bootstrap=Array.from(new Set(i)).sort(((t,e)=>t.localeCompare(e))),await t.config.replace(r),{Peers:[e]}}return fl(e)}function yy({repo:t}){async function e(e={}){const n=await t.config.getAll(e),r=n.Bootstrap||[];return n.Bootstrap=[],await t.config.replace(n),{Peers:r.map((t=>dc(t)))}}return fl(e)}function wy({repo:t}){async function e(e={}){const n=await t.config.get("Bootstrap",e);return{Peers:(n||[]).map((t=>dc(t)))}}return fl(e)}var by=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});function vy({repo:t}){async function e(e={}){const n=await t.config.getAll(e);return n.Bootstrap=by().Bootstrap,await t.config.replace(n),{Peers:by().Bootstrap.map((t=>dc(t)))}}return fl(e)}function Ey({repo:t}){async function e(e,n={}){if(!gy(e))throw new Error(`${e} is not a valid Multiaddr`);const r=await t.config.getAll(n);return r.Bootstrap=(r.Bootstrap||[]).filter((t=>t.toString()!==e.toString())),await t.config.replace(r),{Peers:[e]}}return fl(e)}class _y{constructor({repo:t}){this.add=my({repo:t}),this.list=wy({repo:t}),this.rm=Ey({repo:t}),this.clear=yy({repo:t}),this.reset=vy({repo:t})}}function Sy({preload:t,repo:e}){async function n(n,r={}){return!1!==r.preload&&t(n),e.blocks.get(n,r)}return fl(n)}function Ay({codecs:t,hashers:e,repo:n,preload:r}){async function i(i,s={}){const o=s.pin?await n.gcLock.readLock():null;try{const o=null!=s.version?s.version:0,a=s.format||(0===o?"dag-pb":"raw"),c=await e.getHasher(s.mhtype||"sha2-256"),l=await c.digest(i),u=await t.getCodec(a),h=Me.create(o,u.code,l);return await n.blocks.put(h,i,{signal:s.signal}),!1!==s.preload&&r(h),!0===s.pin&&await n.pins.pinRecursively(h,{signal:s.signal}),h}finally{o&&o()}}return fl(i)}function Cy(){const t={};return t.promise=new Promise(((e,n)=>{t.resolve=e,t.reject=n})),t}const Iy=globalThis.CustomEvent??Event;async function*Ty(t,e={}){let n=e.concurrency??1/0;n<1&&(n=1/0);const r=null!=e.ordered&&e.ordered,i=new EventTarget,s=[];let o,a=Cy(),c=Cy(),l=!1,u=!1;function h(){return r?s[0]?.done:Boolean(s.find((t=>t.done)))}function*d(){while(s.length>0&&s[0].done){const t=s[0];if(s.shift(),!t.ok)throw u=!0,a.resolve(),t.err;yield t.value,a.resolve()}}function*f(){while(h())for(let t=0;t<s.length;t++)if(s[t].done){const e=s[t];if(s.splice(t,1),t--,!e.ok)throw u=!0,a.resolve(),e.err;yield e.value,a.resolve()}}i.addEventListener("task-complete",(()=>{c.resolve()})),Promise.resolve().then((async()=>{try{for await(const e of t){if(s.length===n&&(a=Cy(),await a.promise),u)break;const t={done:!1};s.push(t),e().then((e=>{t.done=!0,t.ok=!0,t.value=e,i.dispatchEvent(new Iy("task-complete"))}),(e=>{t.done=!0,t.err=e,i.dispatchEvent(new Iy("task-complete"))}))}l=!0,i.dispatchEvent(new Iy("task-complete"))}catch(uS){o=uS,i.dispatchEvent(new Iy("task-complete"))}}));while(1){if(h()||(c=Cy(),await c.promise),null!=o)throw o;if(r?yield*d():yield*f(),l&&0===s.length)break}}async function*ky(t,e){for await(const n of t)yield e(n)}function Ry(t){return t instanceof Uint8Array?Me.decode(t):Me.parse(t.toString())}const Ny=8;function Dy({repo:t}){async function*e(e,n={}){Array.isArray(e)||(e=[e]);const r=await t.gcLock.writeLock();try{yield*vm(e,(e=>ky(e,(e=>async()=>{e=Ry(e);const r={cid:e};try{const n=await t.blocks.has(e);if(!n)throw Vt(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await t.blocks.delete(e)}catch(uS){n.force||(uS.message=`cannot remove ${e}: ${uS.message}`,r.error=uS)}return r}))),(t=>Ty(t,{concurrency:Ny})),(t=>tm(t,(()=>!n.quiet))))}finally{r()}}return fl(e)}function Oy({repo:t,preload:e}){async function n(n,r={}){n=Ry(n),!1!==r.preload&&e(n);const i=await t.blocks.get(n);return{cid:n,size:i.length}}return fl(n)}class Py{constructor({codecs:t,hashers:e,preload:n,repo:r}){this.get=Sy({preload:n,repo:r}),this.put=Ay({codecs:t,hashers:e,preload:n,repo:r}),this.rm=Dy({repo:r}),this.stat=Oy({preload:n,repo:r})}}async function*xy(t,e={}){const n=t.getReader();try{while(1){const t=await n.read();if(t.done)return;yield t.value}}finally{!0!==e.preventCancel&&await n.cancel(),n.releaseLock()}}function My(t){return"function"===typeof t.stream?xy(t.stream()):xy(new Response(t).body)}function Ly(t){const[e,n]=null!=t[Symbol.asyncIterator]?[t[Symbol.asyncIterator](),Symbol.asyncIterator]:[t[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>e.next(),push:t=>{r.push(t)},next:()=>r.length>0?{done:!1,value:r.shift()}:e.next(),[n](){return this}}}function By(t){return ArrayBuffer.isView(t)||t instanceof ArrayBuffer}function Uy(t){return t.constructor&&("Blob"===t.constructor.name||"File"===t.constructor.name)&&"function"===typeof t.stream}function Fy(t){return"object"===typeof t&&(t.path||t.content)}const zy=t=>t&&"function"===typeof t.getReader;async function*Vy(t){yield t}async function jy(t){if(By(t))return Vy(Hy(t));if("string"===typeof t||t instanceof String)return Vy(Hy(t.toString()));if(Uy(t))return My(t);if(zy(t)&&(t=xy(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const e=Ly(t),{value:n,done:r}=await e.peek();if(r)return Vy(new Uint8Array(0));if(e.push(n),Number.isInteger(n))return Vy(Uint8Array.from(await Qg(e)));if(By(n)||"string"===typeof n||n instanceof String)return ky(e,Hy)}throw Vt(new Error(`Unexpected input: ${t}`),"ERR_UNEXPECTED_INPUT")}function Hy(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?Uint8Array.from(t):Ho(t.toString())}async function*$y(t,e){if(null===t||void 0===t)throw Vt(new Error(`Unexpected input: ${t}`),"ERR_UNEXPECTED_INPUT");if("string"===typeof t||t instanceof String)yield Ky(t.toString(),e);else if(By(t)||Uy(t))yield Ky(t,e);else{if(zy(t)&&(t=xy(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const n=Ly(t),{value:r,done:i}=await n.peek();if(i)return void(yield{content:[]});if(n.push(r),Number.isInteger(r)||By(r)||"string"===typeof r||r instanceof String)return void(yield Ky(n,e));throw Vt(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!Fy(t))throw Vt(new Error('Unexpected input: cannot convert "'+typeof t+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield Ky(t,e)}}async function Ky(t,e){const{path:n,mode:r,mtime:i,content:s}=t,o={path:n||"",mode:Zt(r),mtime:te(i)};return s?o.content=await e(s):n||(o.content=await e(t)),o}function Gy(t){return $y(t,jy)}function qy({addAll:t}){async function e(e,n={}){const r=await Gu(t(Gy(e),n));if(null==r)throw Error("Failed to add a file, if you see this please report a bug");return r}return e}async function*Wy(t,e=1){let n=[];e<1&&(e=1);for await(const r of t){n.push(r);while(n.length>=e)yield n.slice(0,e),n=n.slice(e)}while(n.length>0)yield n.slice(0,e),n=n.slice(e)}async function*Yy(t,e=1){for await(const n of Wy(t,e)){const t=n.map((async t=>await t().then((t=>({ok:!0,value:t})),(t=>({ok:!1,err:t})))));for(let e=0;e<t.length;e++){const n=await t[e];if(!n.ok)throw n.err;yield n.value}}}var Xy=n(512);function Qy(t){const e=new Array(4);for(let n=0;n<4;n++)e[n]=255&t,t>>=8;return new Uint8Array(e)}es({name:"murmur3-32",code:35,encode:t=>Qy(Xy.x86.hash32(t))});const Jy=es({name:"murmur3-128",code:34,encode:t=>ut(Xy.x64.hash128(t))});es({name:"murmur3-x64-64",code:34,encode:t=>ut(Xy.x64.hash128(t)).subarray(0,8)});async function Zy(t){return(await Jy.encode(t)).slice(0,8).reverse()}const tw={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:ho,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:Zy,hamtHashCode:34,hamtBucketBits:8};var ew=(t={})=>{const e=nt.bind({ignoreUndefined:!0});return e(tw,t)};const nw=async(t,e,n)=>{n.codec||(n.codec=o),n.hasher||(n.hasher=ho),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===o&&n.hasher!==ho&&(n.cidVersion=1);const r=await n.hasher.digest(t),i=Me.create(n.cidVersion,n.codec.code,r);return n.onlyHash||await e.put(i,t,{signal:n.signal}),i};var rw=nw;const iw=async(t,e,n)=>{const r=new ee({type:"directory",mtime:t.mtime,mode:t.mode}),i=bn(fn({Data:r.marshal()})),s=await rw(i,e,n),o=t.path;return{cid:s,path:o,unixfs:r,size:i.length}};var sw=iw;async function ow(t,e){return e(await Qg(t))}var aw=ow;function cw(t,e,n){return lw(t,e,n)}async function lw(t,e,n){const r=[];for await(const i of Wy(t,n.maxChildrenPerNode))r.push(await e(i));return r.length>1?lw(r,e,n):r[0]}var uw=cw;async function hw(t,e,n){const r=new pw(n.layerRepeat);let i=0,s=1,o=r;for await(const a of Wy(t,n.maxChildrenPerNode))o.isFull()&&(o!==r&&r.addChild(await o.reduce(e)),i&&i%n.layerRepeat===0&&s++,o=new fw(s,n.layerRepeat,i),i++),o.append(a);return o&&o!==r&&r.addChild(await o.reduce(e)),r.reduce(e)}var dw=hw;class fw{constructor(t,e,n=0){this.maxDepth=t,this.layerRepeat=e,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:t,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;const t=this._findParent(this.node,this.currentDepth);return!t||(this._addNextNodeToParent(t),!1)}_addNextNodeToParent(t){this.parent=t;const e={children:[],depth:t.depth+1,parent:t,maxDepth:this.maxDepth,maxChildren:Math.floor(t.children.length/this.layerRepeat)*this.layerRepeat};t.children.push(e),this.currentDepth=e.depth,this.node=e}append(t){this.node.data=t}reduce(t){return this._reduce(this.root,t)}async _reduce(t,e){let n=[];return t.children.length&&(n=await Promise.all(t.children.filter((t=>t.data)).map((t=>this._reduce(t,e))))),e((t.data||[]).concat(n))}_findParent(t,e){const n=t.parent;if(n&&0!==n.depth)return n.children.length!==n.maxChildren&&n.maxChildren?n:this._findParent(n,e)}}class pw extends fw{constructor(t){super(0,t),this.root.depth=0,this.currentDepth=1}addChild(t){this.root.children.push(t)}reduce(t){return t((this.root.data||[]).concat(this.root.children))}}async function*gw(t,e,n){for await(let r of t.content)yield async()=>{let i;n.progress(r.length,t.path);const s={codec:o,cidVersion:n.cidVersion,hasher:n.hasher,onlyHash:n.onlyHash};return n.rawLeaves?(s.codec=b,s.cidVersion=1):(i=new ee({type:n.leafType,data:r}),r=bn({Data:i.marshal(),Links:[]})),{cid:await rw(r,e,s),unixfs:i,size:r.length}}}var mw=gw;const yw={flat:aw,balanced:uw,trickle:dw};async function*ww(t,e,n){let r,i,s=-1;i="function"===typeof n.bufferImporter?n.bufferImporter:mw;for await(const o of Yy(i(t,e,n),n.blockWriteConcurrency))s++,0!==s?(1===s&&r&&(yield r,r=null),yield o):r=o;r&&(r.single=!0,yield r)}const bw=(t,e,n)=>{async function r(r){if(1===r.length&&r[0].single&&n.reduceSingleLeafToSelf){const i=r[0];if(void 0!==t.mtime||void 0!==t.mode){let r=await e.get(i.cid);i.unixfs=new ee({type:"file",mtime:t.mtime,mode:t.mode,data:r}),r=bn(fn({Data:i.unixfs.marshal()})),i.cid=await rw(r,e,{...n,codec:o,hasher:n.hasher,cidVersion:n.cidVersion}),i.size=r.length}return{cid:i.cid,path:t.path,unixfs:i.unixfs,size:i.size}}const i=new ee({type:"file",mtime:t.mtime,mode:t.mode}),s=r.filter((t=>!(t.cid.code!==go||!t.size)||(!(!t.unixfs||t.unixfs.data||!t.unixfs.fileSize())||Boolean(t.unixfs&&t.unixfs.data&&t.unixfs.data.length)))).map((t=>t.cid.code===go?(i.addBlockSize(t.size),{Name:"",Tsize:t.size,Hash:t.cid}):(t.unixfs&&t.unixfs.data?i.addBlockSize(t.unixfs.data.length):i.addBlockSize(t.unixfs&&t.unixfs.fileSize()||0),{Name:"",Tsize:t.size,Hash:t.cid}))),a={Data:i.marshal(),Links:s},c=bn(fn(a)),l=await rw(c,e,n);return{cid:l,path:t.path,unixfs:i,size:c.length+a.Links.reduce(((t,e)=>t+e.Tsize),0)}}return r};function vw(t,e,n){const r=yw[n.strategy];if(!r)throw Vt(new Error(`Unknown importer build strategy name: ${n.strategy}`),"ERR_BAD_STRATEGY");return r(ww(t,e,n),bw(t,e,n),n)}var Ew=vw;const _w=Symbol.for("@achingbrain/uint8arraylist");function Sw(t,e){if(null==e||e<0)throw new RangeError("index is out of bounds");let n=0;for(const r of t){const t=n+r.byteLength;if(e<t)return{buf:r,index:e-n};n=t}throw new RangeError("index is out of bounds")}function Aw(t){return Boolean(t?.[_w])}class Cw{constructor(...t){Object.defineProperty(this,_w,{value:!0}),this.bufs=[],this.length=0,t.length>0&&this.appendAll(t)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...t){this.appendAll(t)}appendAll(t){let e=0;for(const n of t)if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.push(n);else{if(!Aw(n))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");e+=n.byteLength,this.bufs.push(...n.bufs)}this.length+=e}prepend(...t){this.prependAll(t)}prependAll(t){let e=0;for(const n of t.reverse())if(n instanceof Uint8Array)e+=n.byteLength,this.bufs.unshift(n);else{if(!Aw(n))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");e+=n.byteLength,this.bufs.unshift(...n.bufs)}this.length+=e}get(t){const e=Sw(this.bufs,t);return e.buf[e.index]}set(t,e){const n=Sw(this.bufs,t);n.buf[n.index]=e}write(t,e=0){if(t instanceof Uint8Array)for(let n=0;n<t.length;n++)this.set(e+n,t[n]);else{if(!Aw(t))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let n=0;n<t.length;n++)this.set(e+n,t.get(n))}}consume(t){if(t=Math.trunc(t),!(Number.isNaN(t)||t<=0)){if(t===this.byteLength)return this.bufs=[],void(this.length=0);while(this.bufs.length>0){if(!(t>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(t),this.length-=t;break}t-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(t,e){const{bufs:n,length:r}=this._subList(t,e);return ya(n,r)}subarray(t,e){const{bufs:n,length:r}=this._subList(t,e);return 1===n.length?n[0]:ya(n,r)}sublist(t,e){const{bufs:n,length:r}=this._subList(t,e),i=new Cw;return i.length=r,i.bufs=n,i}_subList(t,e){if(t=t??0,e=e??this.length,t<0&&(t=this.length+t),e<0&&(e=this.length+e),t<0||e>this.length)throw new RangeError("index is out of bounds");if(t===e)return{bufs:[],length:0};if(0===t&&e===this.length)return{bufs:[...this.bufs],length:this.length};const n=[];let r=0;for(let i=0;i<this.bufs.length;i++){const s=this.bufs[i],o=r,a=o+s.byteLength;if(r=a,t>=a)continue;const c=t>=o&&t<a,l=e>o&&e<=a;if(c&&l){if(t===o&&e===a){n.push(s);break}const r=t-o;n.push(s.subarray(r,r+(e-t)));break}if(c){if(0===t){n.push(s);continue}n.push(s.subarray(t-o))}else{if(l){if(e===a){n.push(s);break}n.push(s.subarray(0,e-o));break}n.push(s)}}return{bufs:n,length:e-t}}indexOf(t,e=0){if(!Aw(t)&&!(t instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=t instanceof Uint8Array?t:t.subarray();if(e=Number(e??0),isNaN(e)&&(e=0),e<0&&(e=this.length+e),e<0&&(e=0),0===t.length)return e>this.length?this.length:e;const r=n.byteLength;if(0===r)throw new TypeError("search must be at least 1 byte long");const i=256,s=new Int32Array(i);for(let u=0;u<i;u++)s[u]=-1;for(let u=0;u<r;u++)s[n[u]]=u;const o=s,a=this.byteLength-n.byteLength,c=n.byteLength-1;let l;for(let u=e;u<=a;u+=l){l=0;for(let t=c;t>=0;t--){const e=this.get(u+t);if(n[t]!==e){l=Math.max(1,t-o[e]);break}}if(0===l)return u}return-1}getInt8(t){const e=this.subarray(t,t+1),n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getInt8(0)}setInt8(t,e){const n=Bo(1),r=new DataView(n.buffer,n.byteOffset,n.byteLength);r.setInt8(0,e),this.write(n,t)}getInt16(t,e){const n=this.subarray(t,t+2),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getInt16(0,e)}setInt16(t,e,n){const r=Lo(2),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setInt16(0,e,n),this.write(r,t)}getInt32(t,e){const n=this.subarray(t,t+4),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getInt32(0,e)}setInt32(t,e,n){const r=Lo(4),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setInt32(0,e,n),this.write(r,t)}getBigInt64(t,e){const n=this.subarray(t,t+8),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getBigInt64(0,e)}setBigInt64(t,e,n){const r=Lo(8),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setBigInt64(0,e,n),this.write(r,t)}getUint8(t){const e=this.subarray(t,t+1),n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getUint8(0)}setUint8(t,e){const n=Bo(1),r=new DataView(n.buffer,n.byteOffset,n.byteLength);r.setUint8(0,e),this.write(n,t)}getUint16(t,e){const n=this.subarray(t,t+2),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getUint16(0,e)}setUint16(t,e,n){const r=Lo(2),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setUint16(0,e,n),this.write(r,t)}getUint32(t,e){const n=this.subarray(t,t+4),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getUint32(0,e)}setUint32(t,e,n){const r=Lo(4),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setUint32(0,e,n),this.write(r,t)}getBigUint64(t,e){const n=this.subarray(t,t+8),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getBigUint64(0,e)}setBigUint64(t,e,n){const r=Lo(8),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setBigUint64(0,e,n),this.write(r,t)}getFloat32(t,e){const n=this.subarray(t,t+4),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat32(0,e)}setFloat32(t,e,n){const r=Lo(4),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setFloat32(0,e,n),this.write(r,t)}getFloat64(t,e){const n=this.subarray(t,t+8),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat64(0,e)}setFloat64(t,e,n){const r=Lo(8),i=new DataView(r.buffer,r.byteOffset,r.byteLength);i.setFloat64(0,e,n),this.write(r,t)}equals(t){if(null==t)return!1;if(!(t instanceof Cw))return!1;if(t.bufs.length!==this.bufs.length)return!1;for(let e=0;e<this.bufs.length;e++)if(!Xa(this.bufs[e],t.bufs[e]))return!1;return!0}static fromUint8Arrays(t,e){const n=new Cw;return n.bufs=t,null==e&&(e=t.reduce(((t,e)=>t+e.byteLength),0)),n.length=e,n}}var Iw=n(9566);async function*Tw(t,e){let n,r,i;if(e.minChunkSize&&e.maxChunkSize&&e.avgChunkSize)i=e.avgChunkSize,n=e.minChunkSize,r=e.maxChunkSize;else{if(!e.avgChunkSize)throw Vt(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");i=e.avgChunkSize,n=i/3,r=i+i/2}if(n<16)throw Vt(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");r<n&&(r=n),i<n&&(i=n);const s=Math.floor(Math.log2(i));for await(const o of Rw(t,{min:n,max:r,bits:s,window:e.window,polynomial:e.polynomial}))yield o}var kw=Tw;async function*Rw(t,e){const n=await(0,Iw.create)(e.bits,e.min,e.max,e.window),r=new Cw;for await(const i of t){r.append(i);const t=n.fingerprint(i);for(let e=0;e<t.length;e++){const n=t[e],i=r.slice(0,n);r.consume(n),yield i}}r.length&&(yield r.subarray(0))}async function*Nw(t,e){let n=new Cw,r=0,i=!1;const s=e.maxChunkSize;for await(const o of t){n.append(o),r+=o.length;while(r>=s)if(yield n.slice(0,s),i=!0,s===n.length)n=new Cw,r=0;else{const t=new Cw;t.append(n.sublist(s)),n=t,r-=s}}i&&!r||(yield n.subarray(0,r))}var Dw=Nw;async function*Ow(t){for await(const e of t){if(void 0===e.length)throw Vt(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"===typeof e||e instanceof String)yield Ho(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else{if(!(e instanceof Uint8Array))throw Vt(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield e}}}var Pw=Ow;function xw(t){return Symbol.iterator in t}function Mw(t){return Symbol.asyncIterator in t}function Lw(t){try{if(t instanceof Uint8Array)return async function*(){yield t}();if(xw(t))return async function*(){yield*t}();if(Mw(t))return t}catch{throw Vt(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw Vt(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*Bw(t,e,n){for await(const r of t)if(r.path&&("./"===r.path.substring(0,2)&&(n.wrapWithDirectory=!0),r.path=r.path.split("/").filter((t=>t&&"."!==t)).join("/")),r.content){let t,i;t="function"===typeof n.chunker?n.chunker:"rabin"===n.chunker?kw:Dw,i="function"===typeof n.chunkValidator?n.chunkValidator:Pw;const s={path:r.path,mtime:r.mtime,mode:r.mode,content:t(i(Lw(r.content),n),n)};yield()=>Ew(s,e,n)}else{if(!r.path)throw new Error("Import candidate must have content or path or both");{const t={path:r.path,mtime:r.mtime,mode:r.mode};yield()=>sw(t,e,n)}}}var Uw=Bw;class Fw{constructor(t,e){this.options=e||{},this.root=t.root,this.dir=t.dir,this.path=t.path,this.dirty=t.dirty,this.flat=t.flat,this.parent=t.parent,this.parentKey=t.parentKey,this.unixfs=t.unixfs,this.mode=t.mode,this.mtime=t.mtime,this.cid=void 0,this.size=void 0}async put(t,e){}get(t){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(t){}}var zw=Fw;class Vw extends zw{constructor(t,e){super(t,e),this._children={}}async put(t,e){this.cid=void 0,this.size=void 0,this._children[t]=e}get(t){return Promise.resolve(this._children[t])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){const t=Object.keys(this._children);for(let e=0;e<t.length;e++){const n=t[e];yield{key:n,child:this._children[n]}}}async*flush(t){const e=Object.keys(this._children),n=[];for(let c=0;c<e.length;c++){let r=this._children[e[c]];if(r instanceof zw)for await(const e of r.flush(t))r=e,yield r;null!=r.size&&r.cid&&n.push({Name:e[c],Tsize:r.size,Hash:r.cid})}const r=new ee({type:"directory",mtime:this.mtime,mode:this.mode}),i={Data:r.marshal(),Links:n},s=bn(fn(i)),o=await rw(s,t,this.options),a=s.length+i.Links.reduce(((t,e)=>t+(null==e.Tsize?0:e.Tsize)),0);this.cid=o,this.size=a,yield{cid:o,unixfs:r,path:this.path,size:a}}}var jw=Vw,Hw=n(9963);class $w{constructor(t,e,n=0){this._options=t,this._popCount=0,this._parent=e,this._posAtParent=n,this._children=new Hw,this.key=null}async put(t,e){const n=await this._findNewBucketAndPos(t);await n.bucket._putAt(n,t,e)}async get(t){const e=await this._findChild(t);if(null!=e)return e.value}async del(t){const e=await this._findPlace(t),n=e.bucket._at(e.pos);null!=n&&n.key===t&&e.bucket._delAt(e.pos)}leafCount(){const t=this._children.compactArray();return t.reduce(((t,e)=>e instanceof $w?t+e.leafCount():t+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const t=this._children.compactArray();for(const e of t)e instanceof $w?yield*e.eachLeafSeries():yield e}serialize(t,e){const n=[];return e(this._children.reduce(((n,r,i)=>(null!=r&&(r instanceof $w?n.push(r.serialize(t,e)):n.push(t(r,i))),n)),n))}async asyncTransform(t,e){return await Ww(this,t,e)}toJSON(){return this.serialize(Gw,qw)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(t){const e=await this._findPlace(t),n=e.bucket._at(e.pos);if(!(n instanceof $w))return null!=n&&n.key===t?n:void 0}async _findPlace(t){const e=this._options.hash("string"===typeof t?Ho(t):t),n=await e.take(this._options.bits),r=this._children.get(n);return r instanceof $w?await r._findPlace(e):{bucket:this,pos:n,hash:e,existingChild:r}}async _findNewBucketAndPos(t){const e=await this._findPlace(t);if(null!=e.existingChild&&e.existingChild.key!==t){const t=new $w(this._options,e.bucket,e.pos);e.bucket._putObjectAt(e.pos,t);const n=await t._findPlace(e.existingChild.hash);return n.bucket._putAt(n,e.existingChild.key,e.existingChild.value),await t._findNewBucketAndPos(e.hash)}return e}_putAt(t,e,n){this._putObjectAt(t.pos,{key:e,value:n,hash:t.hash})}_putObjectAt(t,e){null==this._children.get(t)&&this._popCount++,this._children.set(t,e)}_delAt(t){if(-1===t)throw new Error("Invalid position");null!=this._children.get(t)&&this._popCount--,this._children.unset(t),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const t=this._children.find(Kw);if(null!=t&&!(t instanceof $w)){const e=t.hash;e.untake(this._options.bits);const n={pos:this._posAtParent,hash:e,bucket:this._parent};this._parent._putAt(n,t.key,t.value)}}else this._parent._delAt(this._posAtParent)}_at(t){return this._children.get(t)}}function Kw(t){return Boolean(t)}function Gw(t,e){return t.key}function qw(t){return t}async function Ww(t,e,n){const r=[];for(const i of t._children.compactArray())if(i instanceof $w)await Ww(i,e,n);else{const n=await e(i);r.push({bitField:t._children.bitField(),children:n})}return await n(r)}const Yw=[255,254,252,248,240,224,192,128],Xw=[1,3,7,15,31,63,127,255];class Qw{constructor(t){this._value=t,this._currentBytePos=t.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(t){let e=t,n=0;while(e>0&&this._haveBits()){const t=this._value[this._currentBytePos],r=this._currentBitPos+1,i=Math.min(r,e),s=Jw(t,r-i,i);n=(n<<i)+s,e-=i,this._currentBitPos-=i,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(t){this._currentBitPos+=t;while(this._currentBitPos>7)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function Jw(t,e,n){const r=Zw(e,n);return(t&r)>>>e}function Zw(t,e){return Yw[t]&Xw[Math.min(e+t-1,7)]}function tb(t){function e(e){return e instanceof eb?e:new eb(e,t)}return e}class eb{constructor(t,e){if(!(t instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=t,this._hashFn=e,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(t){let e=t;while(this._availableBits<e)await this._produceMoreBits();let n=0;while(e>0){const t=this._buffers[this._currentBufferIndex],r=Math.min(t.availableBits(),e),i=t.take(r);n=(n<<r)+i,e-=r,this._availableBits-=r,0===t.availableBits()&&this._currentBufferIndex++}return n}untake(t){let e=t;while(e>0){const t=this._buffers[this._currentBufferIndex],n=Math.min(t.totalBits()-t.availableBits(),e);t.untake(n),e-=n,this._availableBits+=n,this._currentBufferIndex>0&&t.totalBits()===t.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const t=this._depth>0?ya([this._value,Uint8Array.from([this._depth])]):this._value,e=await this._hashFn(t),n=new Qw(e);this._buffers.push(n),this._availableBits+=n.availableBits()}}function nb(t){if(null==t||null==t.hashFn)throw new Error("please define an options.hashFn");const e={bits:t.bits??8,hash:tb(t.hashFn)};return new $w(e)}class rb extends zw{constructor(t,e){super(t,e),this._bucket=nb({hashFn:e.hamtHashFn,bits:e.hamtBucketBits})}async put(t,e){await this._bucket.put(t,e)}get(t){return this._bucket.get(t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:t,value:e}of this._bucket.eachLeafSeries())yield{key:t,child:e}}async*flush(t){for await(const e of sb(this._bucket,t,this,this.options))yield{...e,path:this.path}}}var ib=rb;async function*sb(t,e,n,r){const i=t._children,s=[];let o=0;for(let f=0;f<i.length;f++){const t=i.get(f);if(!t)continue;const n=f.toString(16).toUpperCase().padStart(2,"0");if(t instanceof $w){let i;for await(const n of await sb(t,e,null,r))i=n;if(!i)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:n,Tsize:i.size,Hash:i.cid}),o+=i.size}else if("function"===typeof t.value.flush){const r=t.value;let i;for await(const t of r.flush(e))i=t,yield i;const a=n+t.key;s.push({Name:a,Tsize:i.size,Hash:i.cid}),o+=i.size}else{const e=t.value;if(!e.cid)continue;const r=n+t.key,i=e.size;s.push({Name:r,Tsize:i,Hash:e.cid}),o+=i}}const a=Uint8Array.from(i.bitField().reverse()),c=new ee({type:"hamt-sharded-directory",data:a,fanout:t.tableSize(),hashType:r.hamtHashCode,mtime:n&&n.mtime,mode:n&&n.mode}),l={Data:c.marshal(),Links:s},u=bn(fn(l)),h=await rw(u,e,r),d=u.length+o;yield{cid:h,unixfs:c,size:d}}async function ob(t,e,n,r){let i=e;e instanceof jw&&e.directChildrenCount()>=n&&(i=await ab(e,r));const s=i.parent;if(s){if(i!==e){if(t&&(t.parent=i),!i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return ob(i,s,n,r)}return i}async function ab(t,e){const n=new ib({root:t.root,dir:!0,parent:t.parent,parentKey:t.parentKey,path:t.path,dirty:t.dirty,flat:!1,mtime:t.mtime,mode:t.mode},e);for await(const{key:r,child:i}of t.eachChildSeries())await n.put(r,i);return n}var cb=ob;const lb=(t="")=>(t.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean);var ub=lb;async function hb(t,e,n){const r=ub(t.path||""),i=r.length-1;let s=e,o="";for(let a=0;a<r.length;a++){const c=r[a];o+=`${o?"/":""}${c}`;const l=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,l)await s.put(c,t),e=await cb(null,s,n.shardSplitThreshold,n);else{let t=await s.get(c);t&&t instanceof zw||(t=new jw({root:!1,dir:!0,parent:s,parentKey:c,path:o,dirty:!0,flat:!0,mtime:t&&t.unixfs&&t.unixfs.mtime,mode:t&&t.unixfs&&t.unixfs.mode},n)),await s.put(c,t),s=t}}return e}async function*db(t,e){t instanceof zw?yield*t.flush(e):t&&t.unixfs&&t.unixfs.isDirectory()&&(yield t)}async function*fb(t,e,n){let r=new jw({root:!0,dir:!0,path:"",dirty:!0,flat:!0},n);for await(const i of t)i&&(r=await hb(i,r,n),i.unixfs&&i.unixfs.isDirectory()||(yield i));if(n.wrapWithDirectory)yield*db(r,e);else for await(const i of r.eachChildSeries())i&&(yield*db(i.child,e))}var pb=fb;async function*gb(t,e,n={}){const r=ew(n);let i,s,o;i="function"===typeof n.dagBuilder?n.dagBuilder:Uw,s="function"===typeof n.treeBuilder?n.treeBuilder:pb,o=Symbol.asyncIterator in t||Symbol.iterator in t?t:[t];for await(const a of s(Yy(i(o,e,r),r.fileImportConcurrency),e,r))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}async function*mb(t,e){if("string"===typeof t||t instanceof String||By(t)||Uy(t)||t._readableState)throw Vt(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(zy(t)&&(t=xy(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const n=Ly(t),{value:r,done:i}=await n.peek();if(i)return void(yield*[]);if(n.push(r),Number.isInteger(r))throw Vt(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(r._readableState)return void(yield*ky(n,(t=>yb({content:t},e))));if(By(r))return void(yield yb({content:n},e));if(Fy(r)||r[Symbol.iterator]||r[Symbol.asyncIterator]||zy(r)||Uy(r))return void(yield*ky(n,(t=>yb(t,e))))}if(Fy(t))throw Vt(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");throw Vt(new Error("Unexpected input: "+typeof t),"ERR_UNEXPECTED_INPUT")}async function yb(t,e){const{path:n,mode:r,mtime:i,content:s}=t,o={path:n||"",mode:Zt(r),mtime:te(i)};return s?o.content=await e(s):n||(o.content=await e(t)),o}function wb(t){return mb(t,jy)}const bb=t=>{if(t){if(t.startsWith("size-")){const e=t.split("-")[1],n=parseInt(e);if(isNaN(n))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:n}}if(t.startsWith("rabin"))return{chunker:"rabin",...vb(t)};throw new Error(`Unrecognized chunker option: ${t}`)}return{chunker:"fixed"}},vb=t=>{const e={},n=t.split("-");switch(n.length){case 1:e.avgChunkSize=262144;break;case 2:e.avgChunkSize=Eb(n[1],"avg");break;case 4:e.minChunkSize=Eb(n[1],"min"),e.avgChunkSize=Eb(n[2],"avg"),e.maxChunkSize=Eb(n[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return e},Eb=(t,e)=>{const n=parseInt(t);if(isNaN(n))throw new Error(`Chunker parameter ${e} must be an integer`);return n},_b=nt.bind({ignoreUndefined:!0});function Sb({repo:t,preload:e,hashers:n,options:r}){const i=r&&r.sharding;async function*s(r,s={}){const o=_b({shardSplitThreshold:i?1e3:1/0,strategy:"balanced"},s,{...bb(s.chunker)});o.hashAlg&&"sha2-256"!==o.hashAlg&&1!==o.cidVersion&&(o.cidVersion=1),o.trickle&&(o.strategy="trickle"),"trickle"===o.strategy&&(o.leafType="raw",o.reduceSingleLeafToSelf=!1),o.cidVersion>0&&void 0===o.rawLeaves&&(o.rawLeaves=!0),void 0!==o.hashAlg&&void 0===o.rawLeaves&&(o.rawLeaves=!0),delete o.trickle;const a={};if(o.progress){const t=o.progress;o.progress=(e,n)=>{a[n]||(a[n]=0),a[n]+=e,t(a[n],n)}}let c;null!=o.hashAlg&&(c=await n.getHasher(o.hashAlg));const l=vm(wb(r),(e=>gb(e,t.blocks,{...o,hasher:c,pin:!1})),Ab(o),Cb(e,o),Ib(t,o)),u=await t.gcLock.readLock();try{for await(const t of l){const e=t.path??t.cid.toString();delete a[e],yield{...t,path:e}}}finally{u()}}return fl(s)}function Ab(t){async function*e(e){for await(const n of e){let e=n.cid;1===t.cidVersion&&(e=e.toV1());let r=n.path?n.path:e.toString();t.wrapWithDirectory&&!n.path&&(r=""),yield{path:r,cid:e,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return e}function Cb(t,e){async function*n(n){for await(const r of n){const n=!r.path||e.wrapWithDirectory?""===r.path:!r.path.includes("/"),i=n&&!e.onlyHash&&!1!==e.preload;i&&t(r.cid),yield r}}return n}function Ib(t,e){async function*n(n){for await(const r of n){const n=!(r.path&&r.path.includes("/")),i=(null==e.pin||e.pin)&&n&&!e.onlyHash;i&&await t.pins.pinRecursively(r.cid),yield r}}return n}const Tb=async function(t){return(await Jy.encode(t)).slice(0,8).reverse()},kb=(t,e,n)=>Promise.all(t.map((t=>{if(null==t.Name)throw new Error("Unexpected Link without a Name");if(2===t.Name.length){const r=parseInt(t.Name,16);return e._putObjectAt(r,new $w({hash:n._options.hash,bits:n._options.bits},e,r))}return n.put(t.Name.substring(2),!0)}))),Rb=t=>t.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Nb=t=>{let e=t.bucket;const n=[];while(e._parent)n.push(e),e=e._parent;return n.push(e),n.reverse()},Db=async(t,e,n,r,i)=>{if(!r){const t=nb({hashFn:Tb});r={rootBucket:t,hamtDepth:1,lastBucket:t}}await kb(t.Links,r.lastBucket,r.rootBucket);const s=await r.rootBucket._findNewBucketAndPos(e);let o=Rb(s.pos);const a=Nb(s);a.length>r.hamtDepth&&(r.lastBucket=a[r.hamtDepth],o=Rb(r.lastBucket._posAtParent));const c=t.Links.find((t=>{if(null==t.Name)return!1;const n=t.Name.substring(0,2),r=t.Name.substring(2);return n===o&&(!r||r===e)}));if(!c)return null;if(null!=c.Name&&c.Name.substring(2)===e)return c.Hash;r.hamtDepth++;const l=await n.get(c.Hash,i);return t=vn(l),Db(t,e,n,r,i)};var Ob=Db;function Pb(t,e,n,r){const i=t.length,s=e+i;return n>=s||r<e?new Uint8Array(0):(r>=e&&r<s&&(t=t.subarray(0,r-e)),n>=e&&n<s&&(t=t.subarray(n-e)),t)}var xb=Pb;const Mb=(t,e,n)=>{if(e||(e=0),e<0)throw Vt(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(e>t)throw Vt(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(n||0===n||(n=t-e),n<0)throw Vt(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return e+n>t&&(n=t-e),{offset:e,length:n}};var Lb=Mb;async function Bb(t,e,n,r,i,s,o,a){if(e instanceof Uint8Array)return void n.push(xb(e,r,i,s));if(null==e.Data)throw Vt(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=ee.unmarshal(e.Data)}catch(uS){throw Vt(uS,"ERR_NOT_UNIXFS")}if(null!=c.data){const t=c.data,e=xb(t,r,i,s);n.push(e),r+=e.byteLength}const l=[];for(let u=0;u<e.Links.length;u++){const t=e.Links[u],n=r,o=n+c.blockSizes[u];if((i>=n&&i<o||s>=n&&s<=o||i<n&&s>o)&&l.push({link:t,blockStart:r}),r=o,r>s)break}await vm(l,(e=>ky(e,(e=>async()=>{const n=await t.get(e.link.Hash,{signal:a.signal});return{...e,block:n}}))),(t=>Ty(t,{ordered:!0})),(async e=>{for await(const{link:r,block:c,blockStart:l}of e){let e;switch(r.Hash.code){case wn:e=vn(c);break;case go:e=c;break;default:return void n.end(Vt(new Error(`Unsupported codec: ${r.Hash.code}`),"ERR_NOT_UNIXFS"))}o.add((async()=>{await Bb(t,e,n,l,i,s,o,a)}))}}))}const Ub=(t,e,n,r,i,s,o)=>{async function*a(t={}){const r=n.fileSize();if(void 0===r)throw new Error("File was a directory");const{offset:i,length:s}=Lb(r,t.offset,t.length);if(0===s)return;const a=new yu({concurrency:1}),c=sm();a.add((async()=>{await Bb(o,e,c,0,i,i+s,a,t)})),a.on("error",(t=>{c.end(t)}));let l=0;for await(const e of c)null!=e&&(l+=e.byteLength,l===s&&c.end(),yield e)}return a};var Fb=Ub;const zb=(t,e,n,r,i,s,o)=>{async function*a(t={}){const n=t.offset||0,a=t.length||e.Links.length,c=e.Links.slice(n,a);for(const e of c){const n=await i(e.Hash,e.Name||"",`${r}/${e.Name||""}`,[],s+1,o,t);n.entry&&(yield n.entry)}}return a};var Vb=zb;const jb=(t,e,n,r,i,s,o)=>{function a(t={}){return Hb(e,r,i,s,o,t)}return a};async function*Hb(t,e,n,r,i,s){const o=t.Links;for(const a of o){const o=null!=a.Name?a.Name.substring(2):null;if(o){const t=await n(a.Hash,o,`${e}/${o}`,[],r+1,i,s);yield t.entry}else{const o=await i.get(a.Hash);t=vn(o);for await(const a of Hb(t,e,n,r,i,s))yield a}}}var $b=jb;const Kb=(t,e)=>{const n=t.Links.find((t=>t.Name===e));return n&&n.Hash},Gb={raw:Fb,file:Fb,directory:Vb,"hamt-sharded-directory":$b,metadata:(t,e,n,r,i,s,o)=>()=>[],symlink:(t,e,n,r,i,s,o)=>()=>[]},qb=async(t,e,n,r,i,s,o,a)=>{const c=await o.get(t,a),l=vn(c);let u,h;if(e||(e=t.toString()),null==l.Data)throw Vt(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{u=ee.unmarshal(l.Data)}catch(uS){throw Vt(uS,"ERR_NOT_UNIXFS")}if(n||(n=e),r.length){let t;if(t=u&&"hamt-sharded-directory"===u.type?await Ob(l,r[0],o):Kb(l,r[0]),!t)throw Vt(new Error("file does not exist"),"ERR_NOT_FOUND");const e=r.shift(),i=`${n}/${e}`;h={cid:t,toResolve:r,name:e||"",path:i}}return{entry:{type:u.isDirectory()?"directory":"file",name:e,path:n,cid:t,content:Gb[u.type](t,l,u,n,i,s,o),unixfs:u,depth:s,node:l,size:u.fileSize()},next:h}};var Wb=qb;const Yb=t=>{async function*e(e={}){const{offset:n,length:r}=Lb(t.length,e.offset,e.length);yield xb(t,0,n,n+r)}return e},Xb=async(t,e,n,r,i,s,o,a)=>{if(r.length)throw Vt(new Error(`No link named ${n} found in raw node ${t}`),"ERR_NOT_FOUND");const c=await o.get(t,a);return{entry:{type:"raw",name:e,path:n,cid:t,content:Yb(c),depth:s,size:c.length,node:c}}};var Qb=Xb;const Jb=async(t,e,n,r,i,s,o,a)=>{const c=await o.get(t),l=ts(c);let u=l,h=n;while(r.length){const i=r[0];if(!(i in u))throw Vt(new Error(`No property named ${i} found in cbor node ${t}`),"ERR_NO_PROP");{r.shift(),h=`${h}/${i}`;const o=Me.asCID(u[i]);if(o)return{entry:{type:"object",name:e,path:n,cid:t,node:c,depth:s,size:c.length,content:async function*(){yield l}},next:{cid:o,name:i,path:h,toResolve:r}};u=u[i]}}return{entry:{type:"object",name:e,path:n,cid:t,node:c,depth:s,size:c.length,content:async function*(){yield l}}}};var Zb=Jb;const tv=t=>{async function*e(e={}){const{offset:n,length:r}=Lb(t.length,e.offset,e.length);yield xb(t,0,n,n+r)}return e},ev=async(t,e,n,r,i,s,o,a)=>{if(r.length)throw Vt(new Error(`No link named ${n} found in raw node ${t}`),"ERR_NOT_FOUND");const c=await Re(t.multihash.bytes);return{entry:{type:"identity",name:e,path:n,cid:t,content:tv(c.digest),depth:s,size:c.digest.length,node:c.digest}}};var nv=ev;const rv={[wn]:Wb,[go]:Qb,[Ji]:Zb,[Ys.code]:nv};function iv(t,e,n,r,i,s,o){const a=rv[t.code];if(!a)throw Vt(new Error(`No resolver for code ${t.code}`),"ERR_NO_RESOLVER");return a(t,e,n,r,iv,i,s,o)}var sv=iv;const ov=(t="")=>(t.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),av=t=>{if(t instanceof Uint8Array)return{cid:Me.decode(t),toResolve:[]};const e=Me.asCID(t);if(e)return{cid:e,toResolve:[]};if("string"===typeof t){0===t.indexOf("/ipfs/")&&(t=t.substring(6));const e=ov(t);return{cid:Me.parse(e[0]),toResolve:e.slice(1)}}throw Vt(new Error(`Unknown path type ${t}`),"ERR_BAD_PATH")};async function*cv(t,e,n={}){let{cid:r,toResolve:i}=av(t),s=r.toString(),o=s;const a=i.length;while(1){const c=await sv(r,s,o,i,a,e,n);if(!c.entry&&!c.next)throw Vt(new Error(`Could not resolve ${t}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;i=c.next.toResolve,r=c.next.cid,s=c.next.name,o=c.next.path}}async function lv(t,e,n={}){const r=await Gu(cv(t,e,n));if(!r)throw Vt(new Error(`Could not resolve ${t}`),"ERR_NOT_FOUND");return r}async function*uv(t,e,n={}){const r=await lv(t,e,n);if(r&&(yield r,"directory"===r.type))for await(const s of i(r,n))yield s;async function*i(t,e){for await(const n of t.content(e))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*i(n,e))}}function hv({repo:t,preload:e}){async function*n(n,r={}){if(n=El(n),!1!==r.preload){const t=n.split("/");e(Me.parse(t[0]))}const i=await lv(n,t.blocks,r);if("directory"===i.type)throw new Error("this dag node is a directory");if(!i.content)throw new Error("this dag node has no content");yield*i.content(r)}return fl(n)}"0".charCodeAt(0),Ho("ustar\0","binary"),Ho("ustar ","binary"),Ho(" \0","binary");function dv(t){const e=async function*(){let e=yield,n=new Cw;for await(const r of t)if(null!=e){n.append(r);while(n.length>=e){const t=n.sublist(0,e);if(n.consume(e),e=yield t,null==e){n.length>0&&(e=yield n,n=new Cw);break}}}else n.append(r),e=yield n,n=new Cw;if(null!=e)throw Object.assign(new Error(`stream ended before ${e} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return e.next(),e}var fv=n(7870);async function pv(t){let e=new Uint8Array(0);for await(const n of t)e=ya([e,n],e.length+n.length);return e}const gv="0000000000000000000",mv="7777777777777777777",yv="0".charCodeAt(0),wv=Ho("ustar\0","binary"),bv=Ho("00","binary"),vv=parseInt("7777",8),Ev=257,_v=263,Sv=function(t){switch(t){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72;default:return 0}},Av=function(t){let e=256;for(let n=0;n<148;n++)e+=t[n];for(let n=156;n<512;n++)e+=t[n];return e},Cv=function(t,e){const n=t.toString(8);return n.length>e?Ho(mv.slice(0,e)+" "):Ho(gv.slice(0,e-n.length)+n+" ")},Iv=function(t){const e=Ho(t).byteLength;let n=Math.floor(Math.log(e)/Math.log(10))+1;return e+n>=Math.pow(10,n)&&n++,`${e+n}${t}`};function Tv(t){let e="";null!=t.name&&(e+=Iv(" path="+t.name+"\n")),null!=t.linkname&&(e+=Iv(" linkpath="+t.linkname+"\n"));const n=t.pax;if(null!=n)for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e+=Iv(" "+r+"="+n[r]+"\n"));return Ho(e)}function kv(t){const e=new Uint8Array(512);let n=t.name,r="";if(5===t.typeflag&&"/"!==n[n.length-1]&&(n+="/"),Ho(n).byteLength!==n.length)return null;while(Ho(n).byteLength>100){const t=n.indexOf("/");if(-1===t)return null;r+=""!==r?"/"+n.slice(0,t):n.slice(0,t),n=n.slice(t+1)}return Ho(n).byteLength>100||Ho(r).byteLength>155||null!=t.linkname&&Ho(t.linkname).byteLength>100?null:(e.set(Ho(n),0),e.set(Cv(t.mode&vv,6),100),e.set(Cv(t.uid,6),108),e.set(Cv(t.gid,6),116),e.set(Cv(t.size,11),124),e.set(Cv(t.mtime.getTime()/1e3|0,11),136),e[156]=yv+Sv(t.type),null!=t.linkname&&e.set(Ho(t.linkname),157),e.set(wv,Ev),e.set(bv,_v),null!=t.uname&&e.set(Ho(t.uname),265),null!=t.gname&&e.set(Ho(t.gname),297),e.set(Cv(t.devmajor??0,6),329),e.set(Cv(t.devminor??0,6),337),null!=r&&e.set(Ho(r),345),e.set(Cv(Av(e),6),148),e)}const{S_IFMT:Rv,S_IFBLK:Nv,S_IFCHR:Dv,S_IFDIR:Ov,S_IFIFO:Pv,S_IFLNK:xv}=fv,Mv=parseInt("755",8),Lv=parseInt("644",8),Bv=new Uint8Array(1024);function Uv(t=0){switch(t&Rv){case Nv:return"block-device";case Dv:return"character-device";case Ov:return"directory";case Pv:return"fifo";case xv:return"symlink";default:return"file"}}function Fv(t){return t&=511,0!==t?Bv.subarray(0,512-t):new Uint8Array(0)}function zv(t){if(null==t.pax){const e=kv(t);if(null!=e)return e}return Vv(t)}function Vv(t){const e=Tv(t),n={name:"PaxHeader",mode:t.mode,uid:t.uid,gid:t.gid,size:e.length,mtime:t.mtime,type:"pax-header",linkname:t.linkname,uname:t.uname,gname:t.gname,devmajor:t.devmajor,devminor:t.devminor};return new Cw(kv(n)??new Uint8Array(0),e,Fv(e.length),kv({...n,size:t.size,type:t.type})??new Uint8Array(0)).subarray()}function jv(){return async function*(t){for await(let{header:e,body:n}of t){const t={...e,size:"symlink"===e.type?0:e.size??0,type:e.type??Uv(e.mode),mode:e.mode??("directory"===e.type?Mv:Lv),uid:e.uid??0,gid:e.gid??0,mtime:e.mtime??new Date};if("string"===typeof n&&(n=Ho(n)),n instanceof Uint8Array||Aw(n)){t.size=n.length,yield zv(t),yield Aw(n)?n.subarray():n,yield Fv(t.size);continue}if("symlink"===t.type&&null==t.linkname){if(null==n)throw new Error("type was symlink but no linkname or body specified");t.linkname=sa(await pv(n)),yield zv(t);continue}if(yield zv(t),"file"!==t.type&&"contiguous-file"!==t.type)continue;let r=0;for await(const e of n??[])r+=e.length,yield Aw(e)?e.subarray():e;if(r!==t.size)throw new Error(`size mismatch, wrote ${r} of ${t.size} bytes`);yield Fv(t.size)}yield Bv}}n(2087);
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
const Hv=4,$v=0,Kv=1,Gv=2;function qv(t){let e=t.length;while(--e>=0)t[e]=0}const Wv=0,Yv=1,Xv=2,Qv=3,Jv=258,Zv=29,tE=256,eE=tE+1+Zv,nE=30,rE=19,iE=2*eE+1,sE=15,oE=16,aE=7,cE=256,lE=16,uE=17,hE=18,dE=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),fE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),pE=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gE=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mE=512,yE=new Array(2*(eE+2));qv(yE);const wE=new Array(2*nE);qv(wE);const bE=new Array(mE);qv(bE);const vE=new Array(Jv-Qv+1);qv(vE);const EE=new Array(Zv);qv(EE);const _E=new Array(nE);function SE(t,e,n,r,i){this.static_tree=t,this.extra_bits=e,this.extra_base=n,this.elems=r,this.max_length=i,this.has_stree=t&&t.length}let AE,CE,IE;function TE(t,e){this.dyn_tree=t,this.max_code=0,this.stat_desc=e}qv(_E);const kE=t=>t<256?bE[t]:bE[256+(t>>>7)],RE=(t,e)=>{t.pending_buf[t.pending++]=255&e,t.pending_buf[t.pending++]=e>>>8&255},NE=(t,e,n)=>{t.bi_valid>oE-n?(t.bi_buf|=e<<t.bi_valid&65535,RE(t,t.bi_buf),t.bi_buf=e>>oE-t.bi_valid,t.bi_valid+=n-oE):(t.bi_buf|=e<<t.bi_valid&65535,t.bi_valid+=n)},DE=(t,e,n)=>{NE(t,n[2*e],n[2*e+1])},OE=(t,e)=>{let n=0;do{n|=1&t,t>>>=1,n<<=1}while(--e>0);return n>>>1},PE=t=>{16===t.bi_valid?(RE(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)},xE=(t,e)=>{const n=e.dyn_tree,r=e.max_code,i=e.stat_desc.static_tree,s=e.stat_desc.has_stree,o=e.stat_desc.extra_bits,a=e.stat_desc.extra_base,c=e.stat_desc.max_length;let l,u,h,d,f,p,g=0;for(d=0;d<=sE;d++)t.bl_count[d]=0;for(n[2*t.heap[t.heap_max]+1]=0,l=t.heap_max+1;l<iE;l++)u=t.heap[l],d=n[2*n[2*u+1]+1]+1,d>c&&(d=c,g++),n[2*u+1]=d,u>r||(t.bl_count[d]++,f=0,u>=a&&(f=o[u-a]),p=n[2*u],t.opt_len+=p*(d+f),s&&(t.static_len+=p*(i[2*u+1]+f)));if(0!==g){do{d=c-1;while(0===t.bl_count[d])d--;t.bl_count[d]--,t.bl_count[d+1]+=2,t.bl_count[c]--,g-=2}while(g>0);for(d=c;0!==d;d--){u=t.bl_count[d];while(0!==u)h=t.heap[--l],h>r||(n[2*h+1]!==d&&(t.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),u--)}}},ME=(t,e,n)=>{const r=new Array(sE+1);let i,s,o=0;for(i=1;i<=sE;i++)o=o+n[i-1]<<1,r[i]=o;for(s=0;s<=e;s++){let e=t[2*s+1];0!==e&&(t[2*s]=OE(r[e]++,e))}},LE=()=>{let t,e,n,r,i;const s=new Array(sE+1);for(n=0,r=0;r<Zv-1;r++)for(EE[r]=n,t=0;t<1<<dE[r];t++)vE[n++]=r;for(vE[n-1]=r,i=0,r=0;r<16;r++)for(_E[r]=i,t=0;t<1<<fE[r];t++)bE[i++]=r;for(i>>=7;r<nE;r++)for(_E[r]=i<<7,t=0;t<1<<fE[r]-7;t++)bE[256+i++]=r;for(e=0;e<=sE;e++)s[e]=0;t=0;while(t<=143)yE[2*t+1]=8,t++,s[8]++;while(t<=255)yE[2*t+1]=9,t++,s[9]++;while(t<=279)yE[2*t+1]=7,t++,s[7]++;while(t<=287)yE[2*t+1]=8,t++,s[8]++;for(ME(yE,eE+1,s),t=0;t<nE;t++)wE[2*t+1]=5,wE[2*t]=OE(t,5);AE=new SE(yE,dE,tE+1,eE,sE),CE=new SE(wE,fE,0,nE,sE),IE=new SE(new Array(0),pE,0,rE,aE)},BE=t=>{let e;for(e=0;e<eE;e++)t.dyn_ltree[2*e]=0;for(e=0;e<nE;e++)t.dyn_dtree[2*e]=0;for(e=0;e<rE;e++)t.bl_tree[2*e]=0;t.dyn_ltree[2*cE]=1,t.opt_len=t.static_len=0,t.sym_next=t.matches=0},UE=t=>{t.bi_valid>8?RE(t,t.bi_buf):t.bi_valid>0&&(t.pending_buf[t.pending++]=t.bi_buf),t.bi_buf=0,t.bi_valid=0},FE=(t,e,n,r)=>{const i=2*e,s=2*n;return t[i]<t[s]||t[i]===t[s]&&r[e]<=r[n]},zE=(t,e,n)=>{const r=t.heap[n];let i=n<<1;while(i<=t.heap_len){if(i<t.heap_len&&FE(e,t.heap[i+1],t.heap[i],t.depth)&&i++,FE(e,r,t.heap[i],t.depth))break;t.heap[n]=t.heap[i],n=i,i<<=1}t.heap[n]=r},VE=(t,e,n)=>{let r,i,s,o,a=0;if(0!==t.sym_next)do{r=255&t.pending_buf[t.sym_buf+a++],r+=(255&t.pending_buf[t.sym_buf+a++])<<8,i=t.pending_buf[t.sym_buf+a++],0===r?DE(t,i,e):(s=vE[i],DE(t,s+tE+1,e),o=dE[s],0!==o&&(i-=EE[s],NE(t,i,o)),r--,s=kE(r),DE(t,s,n),o=fE[s],0!==o&&(r-=_E[s],NE(t,r,o)))}while(a<t.sym_next);DE(t,cE,e)},jE=(t,e)=>{const n=e.dyn_tree,r=e.stat_desc.static_tree,i=e.stat_desc.has_stree,s=e.stat_desc.elems;let o,a,c,l=-1;for(t.heap_len=0,t.heap_max=iE,o=0;o<s;o++)0!==n[2*o]?(t.heap[++t.heap_len]=l=o,t.depth[o]=0):n[2*o+1]=0;while(t.heap_len<2)c=t.heap[++t.heap_len]=l<2?++l:0,n[2*c]=1,t.depth[c]=0,t.opt_len--,i&&(t.static_len-=r[2*c+1]);for(e.max_code=l,o=t.heap_len>>1;o>=1;o--)zE(t,n,o);c=s;do{o=t.heap[1],t.heap[1]=t.heap[t.heap_len--],zE(t,n,1),a=t.heap[1],t.heap[--t.heap_max]=o,t.heap[--t.heap_max]=a,n[2*c]=n[2*o]+n[2*a],t.depth[c]=(t.depth[o]>=t.depth[a]?t.depth[o]:t.depth[a])+1,n[2*o+1]=n[2*a+1]=c,t.heap[1]=c++,zE(t,n,1)}while(t.heap_len>=2);t.heap[--t.heap_max]=t.heap[1],xE(t,e),ME(n,l,t.bl_count)},HE=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),e[2*(n+1)+1]=65535,r=0;r<=n;r++)i=o,o=e[2*(r+1)+1],++a<c&&i===o||(a<l?t.bl_tree[2*i]+=a:0!==i?(i!==s&&t.bl_tree[2*i]++,t.bl_tree[2*lE]++):a<=10?t.bl_tree[2*uE]++:t.bl_tree[2*hE]++,a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4))},$E=(t,e,n)=>{let r,i,s=-1,o=e[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=n;r++)if(i=o,o=e[2*(r+1)+1],!(++a<c&&i===o)){if(a<l)do{DE(t,i,t.bl_tree)}while(0!==--a);else 0!==i?(i!==s&&(DE(t,i,t.bl_tree),a--),DE(t,lE,t.bl_tree),NE(t,a-3,2)):a<=10?(DE(t,uE,t.bl_tree),NE(t,a-3,3)):(DE(t,hE,t.bl_tree),NE(t,a-11,7));a=0,s=i,0===o?(c=138,l=3):i===o?(c=6,l=3):(c=7,l=4)}},KE=t=>{let e;for(HE(t,t.dyn_ltree,t.l_desc.max_code),HE(t,t.dyn_dtree,t.d_desc.max_code),jE(t,t.bl_desc),e=rE-1;e>=3;e--)if(0!==t.bl_tree[2*gE[e]+1])break;return t.opt_len+=3*(e+1)+5+5+4,e},GE=(t,e,n,r)=>{let i;for(NE(t,e-257,5),NE(t,n-1,5),NE(t,r-4,4),i=0;i<r;i++)NE(t,t.bl_tree[2*gE[i]+1],3);$E(t,t.dyn_ltree,e-1),$E(t,t.dyn_dtree,n-1)},qE=t=>{let e,n=4093624447;for(e=0;e<=31;e++,n>>>=1)if(1&n&&0!==t.dyn_ltree[2*e])return $v;if(0!==t.dyn_ltree[18]||0!==t.dyn_ltree[20]||0!==t.dyn_ltree[26])return Kv;for(e=32;e<tE;e++)if(0!==t.dyn_ltree[2*e])return Kv;return $v};let WE=!1;const YE=t=>{WE||(LE(),WE=!0),t.l_desc=new TE(t.dyn_ltree,AE),t.d_desc=new TE(t.dyn_dtree,CE),t.bl_desc=new TE(t.bl_tree,IE),t.bi_buf=0,t.bi_valid=0,BE(t)},XE=(t,e,n,r)=>{NE(t,(Wv<<1)+(r?1:0),3),UE(t),RE(t,n),RE(t,~n),n&&t.pending_buf.set(t.window.subarray(e,e+n),t.pending),t.pending+=n},QE=t=>{NE(t,Yv<<1,3),DE(t,cE,yE),PE(t)},JE=(t,e,n,r)=>{let i,s,o=0;t.level>0?(t.strm.data_type===Gv&&(t.strm.data_type=qE(t)),jE(t,t.l_desc),jE(t,t.d_desc),o=KE(t),i=t.opt_len+3+7>>>3,s=t.static_len+3+7>>>3,s<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==e?XE(t,e,n,r):t.strategy===Hv||s===i?(NE(t,(Yv<<1)+(r?1:0),3),VE(t,yE,wE)):(NE(t,(Xv<<1)+(r?1:0),3),GE(t,t.l_desc.max_code+1,t.d_desc.max_code+1,o+1),VE(t,t.dyn_ltree,t.dyn_dtree)),BE(t),r&&UE(t)},ZE=(t,e,n)=>(t.pending_buf[t.sym_buf+t.sym_next++]=e,t.pending_buf[t.sym_buf+t.sym_next++]=e>>8,t.pending_buf[t.sym_buf+t.sym_next++]=n,0===e?t.dyn_ltree[2*n]++:(t.matches++,e--,t.dyn_ltree[2*(vE[n]+tE+1)]++,t.dyn_dtree[2*kE(e)]++),t.sym_next===t.sym_end);var t_=YE,e_=XE,n_=JE,r_=ZE,i_=QE,s_={_tr_init:t_,_tr_stored_block:e_,_tr_flush_block:n_,_tr_tally:r_,_tr_align:i_};const o_=(t,e,n,r)=>{let i=65535&t|0,s=t>>>16&65535|0,o=0;while(0!==n){o=n>2e3?2e3:n,n-=o;do{i=i+e[r++]|0,s=s+i|0}while(--o);i%=65521,s%=65521}return i|s<<16|0};var a_=o_;const c_=()=>{let t,e=[];for(var n=0;n<256;n++){t=n;for(var r=0;r<8;r++)t=1&t?3988292384^t>>>1:t>>>1;e[n]=t}return e},l_=new Uint32Array(c_()),u_=(t,e,n,r)=>{const i=l_,s=r+n;t^=-1;for(let o=r;o<s;o++)t=t>>>8^i[255&(t^e[o])];return-1^t};var h_=u_,d_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},f_={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:p_,_tr_stored_block:g_,_tr_flush_block:m_,_tr_tally:y_,_tr_align:w_}=s_,{Z_NO_FLUSH:b_,Z_PARTIAL_FLUSH:v_,Z_FULL_FLUSH:E_,Z_FINISH:__,Z_BLOCK:S_,Z_OK:A_,Z_STREAM_END:C_,Z_STREAM_ERROR:I_,Z_DATA_ERROR:T_,Z_BUF_ERROR:k_,Z_DEFAULT_COMPRESSION:R_,Z_FILTERED:N_,Z_HUFFMAN_ONLY:D_,Z_RLE:O_,Z_FIXED:P_,Z_DEFAULT_STRATEGY:x_,Z_UNKNOWN:M_,Z_DEFLATED:L_}=f_,B_=9,U_=15,F_=8,z_=29,V_=256,j_=V_+1+z_,H_=30,$_=19,K_=2*j_+1,G_=15,q_=3,W_=258,Y_=W_+q_+1,X_=32,Q_=42,J_=57,Z_=69,tS=73,eS=91,nS=103,rS=113,iS=666,sS=1,oS=2,aS=3,cS=4,lS=3,uS=(t,e)=>(t.msg=d_[e],e),hS=t=>2*t-(t>4?9:0),dS=t=>{let e=t.length;while(--e>=0)t[e]=0},fS=t=>{let e,n,r,i=t.w_size;e=t.hash_size,r=e;do{n=t.head[--r],t.head[r]=n>=i?n-i:0}while(--e);e=i,r=e;do{n=t.prev[--r],t.prev[r]=n>=i?n-i:0}while(--e)};let pS=(t,e,n)=>(e<<t.hash_shift^n)&t.hash_mask,gS=pS;const mS=t=>{const e=t.state;let n=e.pending;n>t.avail_out&&(n=t.avail_out),0!==n&&(t.output.set(e.pending_buf.subarray(e.pending_out,e.pending_out+n),t.next_out),t.next_out+=n,e.pending_out+=n,t.total_out+=n,t.avail_out-=n,e.pending-=n,0===e.pending&&(e.pending_out=0))},yS=(t,e)=>{m_(t,t.block_start>=0?t.block_start:-1,t.strstart-t.block_start,e),t.block_start=t.strstart,mS(t.strm)},wS=(t,e)=>{t.pending_buf[t.pending++]=e},bS=(t,e)=>{t.pending_buf[t.pending++]=e>>>8&255,t.pending_buf[t.pending++]=255&e},vS=(t,e,n,r)=>{let i=t.avail_in;return i>r&&(i=r),0===i?0:(t.avail_in-=i,e.set(t.input.subarray(t.next_in,t.next_in+i),n),1===t.state.wrap?t.adler=a_(t.adler,e,i,n):2===t.state.wrap&&(t.adler=h_(t.adler,e,i,n)),t.next_in+=i,t.total_in+=i,i)},ES=(t,e)=>{let n,r,i=t.max_chain_length,s=t.strstart,o=t.prev_length,a=t.nice_match;const c=t.strstart>t.w_size-Y_?t.strstart-(t.w_size-Y_):0,l=t.window,u=t.w_mask,h=t.prev,d=t.strstart+W_;let f=l[s+o-1],p=l[s+o];t.prev_length>=t.good_match&&(i>>=2),a>t.lookahead&&(a=t.lookahead);do{if(n=e,l[n+o]===p&&l[n+o-1]===f&&l[n]===l[s]&&l[++n]===l[s+1]){s+=2,n++;do{}while(l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&l[++s]===l[++n]&&s<d);if(r=W_-(d-s),s=d-W_,r>o){if(t.match_start=e,o=r,r>=a)break;f=l[s+o-1],p=l[s+o]}}}while((e=h[e&u])>c&&0!==--i);return o<=t.lookahead?o:t.lookahead},_S=t=>{const e=t.w_size;let n,r,i;do{if(r=t.window_size-t.lookahead-t.strstart,t.strstart>=e+(e-Y_)&&(t.window.set(t.window.subarray(e,e+e-r),0),t.match_start-=e,t.strstart-=e,t.block_start-=e,t.insert>t.strstart&&(t.insert=t.strstart),fS(t),r+=e),0===t.strm.avail_in)break;if(n=vS(t.strm,t.window,t.strstart+t.lookahead,r),t.lookahead+=n,t.lookahead+t.insert>=q_){i=t.strstart-t.insert,t.ins_h=t.window[i],t.ins_h=gS(t,t.ins_h,t.window[i+1]);while(t.insert)if(t.ins_h=gS(t,t.ins_h,t.window[i+q_-1]),t.prev[i&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=i,i++,t.insert--,t.lookahead+t.insert<q_)break}}while(t.lookahead<Y_&&0!==t.strm.avail_in)},SS=(t,e)=>{let n,r,i,s=t.pending_buf_size-5>t.w_size?t.w_size:t.pending_buf_size-5,o=0,a=t.strm.avail_in;do{if(n=65535,i=t.bi_valid+42>>3,t.strm.avail_out<i)break;if(i=t.strm.avail_out-i,r=t.strstart-t.block_start,n>r+t.strm.avail_in&&(n=r+t.strm.avail_in),n>i&&(n=i),n<s&&(0===n&&e!==__||e===b_||n!==r+t.strm.avail_in))break;o=e===__&&n===r+t.strm.avail_in?1:0,g_(t,0,0,o),t.pending_buf[t.pending-4]=n,t.pending_buf[t.pending-3]=n>>8,t.pending_buf[t.pending-2]=~n,t.pending_buf[t.pending-1]=~n>>8,mS(t.strm),r&&(r>n&&(r=n),t.strm.output.set(t.window.subarray(t.block_start,t.block_start+r),t.strm.next_out),t.strm.next_out+=r,t.strm.avail_out-=r,t.strm.total_out+=r,t.block_start+=r,n-=r),n&&(vS(t.strm,t.strm.output,t.strm.next_out,n),t.strm.next_out+=n,t.strm.avail_out-=n,t.strm.total_out+=n)}while(0===o);return a-=t.strm.avail_in,a&&(a>=t.w_size?(t.matches=2,t.window.set(t.strm.input.subarray(t.strm.next_in-t.w_size,t.strm.next_in),0),t.strstart=t.w_size,t.insert=t.strstart):(t.window_size-t.strstart<=a&&(t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,t.insert>t.strstart&&(t.insert=t.strstart)),t.window.set(t.strm.input.subarray(t.strm.next_in-a,t.strm.next_in),t.strstart),t.strstart+=a,t.insert+=a>t.w_size-t.insert?t.w_size-t.insert:a),t.block_start=t.strstart),t.high_water<t.strstart&&(t.high_water=t.strstart),o?cS:e!==b_&&e!==__&&0===t.strm.avail_in&&t.strstart===t.block_start?oS:(i=t.window_size-t.strstart,t.strm.avail_in>i&&t.block_start>=t.w_size&&(t.block_start-=t.w_size,t.strstart-=t.w_size,t.window.set(t.window.subarray(t.w_size,t.w_size+t.strstart),0),t.matches<2&&t.matches++,i+=t.w_size,t.insert>t.strstart&&(t.insert=t.strstart)),i>t.strm.avail_in&&(i=t.strm.avail_in),i&&(vS(t.strm,t.window,t.strstart,i),t.strstart+=i,t.insert+=i>t.w_size-t.insert?t.w_size-t.insert:i),t.high_water<t.strstart&&(t.high_water=t.strstart),i=t.bi_valid+42>>3,i=t.pending_buf_size-i>65535?65535:t.pending_buf_size-i,s=i>t.w_size?t.w_size:i,r=t.strstart-t.block_start,(r>=s||(r||e===__)&&e!==b_&&0===t.strm.avail_in&&r<=i)&&(n=r>i?i:r,o=e===__&&0===t.strm.avail_in&&n===r?1:0,g_(t,t.block_start,n,o),t.block_start+=n,mS(t.strm)),o?aS:sS)},AS=(t,e)=>{let n,r;for(;;){if(t.lookahead<Y_){if(_S(t),t.lookahead<Y_&&e===b_)return sS;if(0===t.lookahead)break}if(n=0,t.lookahead>=q_&&(t.ins_h=gS(t,t.ins_h,t.window[t.strstart+q_-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),0!==n&&t.strstart-n<=t.w_size-Y_&&(t.match_length=ES(t,n)),t.match_length>=q_)if(r=y_(t,t.strstart-t.match_start,t.match_length-q_),t.lookahead-=t.match_length,t.match_length<=t.max_lazy_match&&t.lookahead>=q_){t.match_length--;do{t.strstart++,t.ins_h=gS(t,t.ins_h,t.window[t.strstart+q_-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart}while(0!==--t.match_length);t.strstart++}else t.strstart+=t.match_length,t.match_length=0,t.ins_h=t.window[t.strstart],t.ins_h=gS(t,t.ins_h,t.window[t.strstart+1]);else r=y_(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++;if(r&&(yS(t,!1),0===t.strm.avail_out))return sS}return t.insert=t.strstart<q_-1?t.strstart:q_-1,e===__?(yS(t,!0),0===t.strm.avail_out?aS:cS):t.sym_next&&(yS(t,!1),0===t.strm.avail_out)?sS:oS},CS=(t,e)=>{let n,r,i;for(;;){if(t.lookahead<Y_){if(_S(t),t.lookahead<Y_&&e===b_)return sS;if(0===t.lookahead)break}if(n=0,t.lookahead>=q_&&(t.ins_h=gS(t,t.ins_h,t.window[t.strstart+q_-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart),t.prev_length=t.match_length,t.prev_match=t.match_start,t.match_length=q_-1,0!==n&&t.prev_length<t.max_lazy_match&&t.strstart-n<=t.w_size-Y_&&(t.match_length=ES(t,n),t.match_length<=5&&(t.strategy===N_||t.match_length===q_&&t.strstart-t.match_start>4096)&&(t.match_length=q_-1)),t.prev_length>=q_&&t.match_length<=t.prev_length){i=t.strstart+t.lookahead-q_,r=y_(t,t.strstart-1-t.prev_match,t.prev_length-q_),t.lookahead-=t.prev_length-1,t.prev_length-=2;do{++t.strstart<=i&&(t.ins_h=gS(t,t.ins_h,t.window[t.strstart+q_-1]),n=t.prev[t.strstart&t.w_mask]=t.head[t.ins_h],t.head[t.ins_h]=t.strstart)}while(0!==--t.prev_length);if(t.match_available=0,t.match_length=q_-1,t.strstart++,r&&(yS(t,!1),0===t.strm.avail_out))return sS}else if(t.match_available){if(r=y_(t,0,t.window[t.strstart-1]),r&&yS(t,!1),t.strstart++,t.lookahead--,0===t.strm.avail_out)return sS}else t.match_available=1,t.strstart++,t.lookahead--}return t.match_available&&(r=y_(t,0,t.window[t.strstart-1]),t.match_available=0),t.insert=t.strstart<q_-1?t.strstart:q_-1,e===__?(yS(t,!0),0===t.strm.avail_out?aS:cS):t.sym_next&&(yS(t,!1),0===t.strm.avail_out)?sS:oS},IS=(t,e)=>{let n,r,i,s;const o=t.window;for(;;){if(t.lookahead<=W_){if(_S(t),t.lookahead<=W_&&e===b_)return sS;if(0===t.lookahead)break}if(t.match_length=0,t.lookahead>=q_&&t.strstart>0&&(i=t.strstart-1,r=o[i],r===o[++i]&&r===o[++i]&&r===o[++i])){s=t.strstart+W_;do{}while(r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&r===o[++i]&&i<s);t.match_length=W_-(s-i),t.match_length>t.lookahead&&(t.match_length=t.lookahead)}if(t.match_length>=q_?(n=y_(t,1,t.match_length-q_),t.lookahead-=t.match_length,t.strstart+=t.match_length,t.match_length=0):(n=y_(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++),n&&(yS(t,!1),0===t.strm.avail_out))return sS}return t.insert=0,e===__?(yS(t,!0),0===t.strm.avail_out?aS:cS):t.sym_next&&(yS(t,!1),0===t.strm.avail_out)?sS:oS},TS=(t,e)=>{let n;for(;;){if(0===t.lookahead&&(_S(t),0===t.lookahead)){if(e===b_)return sS;break}if(t.match_length=0,n=y_(t,0,t.window[t.strstart]),t.lookahead--,t.strstart++,n&&(yS(t,!1),0===t.strm.avail_out))return sS}return t.insert=0,e===__?(yS(t,!0),0===t.strm.avail_out?aS:cS):t.sym_next&&(yS(t,!1),0===t.strm.avail_out)?sS:oS};function kS(t,e,n,r,i){this.good_length=t,this.max_lazy=e,this.nice_length=n,this.max_chain=r,this.func=i}const RS=[new kS(0,0,0,0,SS),new kS(4,4,8,4,AS),new kS(4,5,16,8,AS),new kS(4,6,32,32,AS),new kS(4,4,16,16,CS),new kS(8,16,32,32,CS),new kS(8,16,128,128,CS),new kS(8,32,128,256,CS),new kS(32,128,258,1024,CS),new kS(32,258,258,4096,CS)],NS=t=>{t.window_size=2*t.w_size,dS(t.head),t.max_lazy_match=RS[t.level].max_lazy,t.good_match=RS[t.level].good_length,t.nice_match=RS[t.level].nice_length,t.max_chain_length=RS[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=q_-1,t.match_available=0,t.ins_h=0};function DS(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=L_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*K_),this.dyn_dtree=new Uint16Array(2*(2*H_+1)),this.bl_tree=new Uint16Array(2*(2*$_+1)),dS(this.dyn_ltree),dS(this.dyn_dtree),dS(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(G_+1),this.heap=new Uint16Array(2*j_+1),dS(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*j_+1),dS(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const OS=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.status!==Q_&&e.status!==J_&&e.status!==Z_&&e.status!==tS&&e.status!==eS&&e.status!==nS&&e.status!==rS&&e.status!==iS?1:0},PS=t=>{if(OS(t))return uS(t,I_);t.total_in=t.total_out=0,t.data_type=M_;const e=t.state;return e.pending=0,e.pending_out=0,e.wrap<0&&(e.wrap=-e.wrap),e.status=2===e.wrap?J_:e.wrap?Q_:rS,t.adler=2===e.wrap?0:1,e.last_flush=-2,p_(e),A_},xS=t=>{const e=PS(t);return e===A_&&NS(t.state),e},MS=(t,e)=>OS(t)||2!==t.state.wrap?I_:(t.state.gzhead=e,A_),LS=(t,e,n,r,i,s)=>{if(!t)return I_;let o=1;if(e===R_&&(e=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),i<1||i>B_||n!==L_||r<8||r>15||e<0||e>9||s<0||s>P_||8===r&&1!==o)return uS(t,I_);8===r&&(r=9);const a=new DS;return t.state=a,a.strm=t,a.status=Q_,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=i+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+q_-1)/q_),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<i+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=e,a.strategy=s,a.method=n,xS(t)},BS=(t,e)=>LS(t,e,L_,U_,F_,x_),US=(t,e)=>{if(OS(t)||e>S_||e<0)return t?uS(t,I_):I_;const n=t.state;if(!t.output||0!==t.avail_in&&!t.input||n.status===iS&&e!==__)return uS(t,0===t.avail_out?k_:I_);const r=n.last_flush;if(n.last_flush=e,0!==n.pending){if(mS(t),0===t.avail_out)return n.last_flush=-1,A_}else if(0===t.avail_in&&hS(e)<=hS(r)&&e!==__)return uS(t,k_);if(n.status===iS&&0!==t.avail_in)return uS(t,k_);if(n.status===Q_&&0===n.wrap&&(n.status=rS),n.status===Q_){let e=L_+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=D_||n.level<2?0:n.level<6?1:6===n.level?2:3,e|=r<<6,0!==n.strstart&&(e|=X_),e+=31-e%31,bS(n,e),0!==n.strstart&&(bS(n,t.adler>>>16),bS(n,65535&t.adler)),t.adler=1,n.status=rS,mS(t),0!==n.pending)return n.last_flush=-1,A_}if(n.status===J_)if(t.adler=0,wS(n,31),wS(n,139),wS(n,8),n.gzhead)wS(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),wS(n,255&n.gzhead.time),wS(n,n.gzhead.time>>8&255),wS(n,n.gzhead.time>>16&255),wS(n,n.gzhead.time>>24&255),wS(n,9===n.level?2:n.strategy>=D_||n.level<2?4:0),wS(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(wS(n,255&n.gzhead.extra.length),wS(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(t.adler=h_(t.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Z_;else if(wS(n,0),wS(n,0),wS(n,0),wS(n,0),wS(n,0),wS(n,9===n.level?2:n.strategy>=D_||n.level<2?4:0),wS(n,lS),n.status=rS,mS(t),0!==n.pending)return n.last_flush=-1,A_;if(n.status===Z_){if(n.gzhead.extra){let e=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;while(n.pending+r>n.pending_buf_size){let i=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+i),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>e&&(t.adler=h_(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex+=i,mS(t),0!==n.pending)return n.last_flush=-1,A_;e=0,r-=i}let i=new Uint8Array(n.gzhead.extra);n.pending_buf.set(i.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>e&&(t.adler=h_(t.adler,n.pending_buf,n.pending-e,e)),n.gzindex=0}n.status=tS}if(n.status===tS){if(n.gzhead.name){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=h_(t.adler,n.pending_buf,n.pending-r,r)),mS(t),0!==n.pending)return n.last_flush=-1,A_;r=0}e=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,wS(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=h_(t.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=eS}if(n.status===eS){if(n.gzhead.comment){let e,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(t.adler=h_(t.adler,n.pending_buf,n.pending-r,r)),mS(t),0!==n.pending)return n.last_flush=-1,A_;r=0}e=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,wS(n,e)}while(0!==e);n.gzhead.hcrc&&n.pending>r&&(t.adler=h_(t.adler,n.pending_buf,n.pending-r,r))}n.status=nS}if(n.status===nS){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(mS(t),0!==n.pending))return n.last_flush=-1,A_;wS(n,255&t.adler),wS(n,t.adler>>8&255),t.adler=0}if(n.status=rS,mS(t),0!==n.pending)return n.last_flush=-1,A_}if(0!==t.avail_in||0!==n.lookahead||e!==b_&&n.status!==iS){let r=0===n.level?SS(n,e):n.strategy===D_?TS(n,e):n.strategy===O_?IS(n,e):RS[n.level].func(n,e);if(r!==aS&&r!==cS||(n.status=iS),r===sS||r===aS)return 0===t.avail_out&&(n.last_flush=-1),A_;if(r===oS&&(e===v_?w_(n):e!==S_&&(g_(n,0,0,!1),e===E_&&(dS(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),mS(t),0===t.avail_out))return n.last_flush=-1,A_}return e!==__?A_:n.wrap<=0?C_:(2===n.wrap?(wS(n,255&t.adler),wS(n,t.adler>>8&255),wS(n,t.adler>>16&255),wS(n,t.adler>>24&255),wS(n,255&t.total_in),wS(n,t.total_in>>8&255),wS(n,t.total_in>>16&255),wS(n,t.total_in>>24&255)):(bS(n,t.adler>>>16),bS(n,65535&t.adler)),mS(t),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?A_:C_)},FS=t=>{if(OS(t))return I_;const e=t.state.status;return t.state=null,e===rS?uS(t,T_):A_},zS=(t,e)=>{let n=e.length;if(OS(t))return I_;const r=t.state,i=r.wrap;if(2===i||1===i&&r.status!==Q_||r.lookahead)return I_;if(1===i&&(t.adler=a_(t.adler,e,n,0)),r.wrap=0,n>=r.w_size){0===i&&(dS(r.head),r.strstart=0,r.block_start=0,r.insert=0);let t=new Uint8Array(r.w_size);t.set(e.subarray(n-r.w_size,n),0),e=t,n=r.w_size}const s=t.avail_in,o=t.next_in,a=t.input;t.avail_in=n,t.next_in=0,t.input=e,_S(r);while(r.lookahead>=q_){let t=r.strstart,e=r.lookahead-(q_-1);do{r.ins_h=gS(r,r.ins_h,r.window[t+q_-1]),r.prev[t&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=t,t++}while(--e);r.strstart=t,r.lookahead=q_-1,_S(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=q_-1,r.match_available=0,t.next_in=o,t.input=a,t.avail_in=s,r.wrap=i,A_};var VS=BS,jS=LS,HS=xS,$S=PS,KS=MS,GS=US,qS=FS,WS=zS,YS="pako deflate (from Nodeca project)",XS={deflateInit:VS,deflateInit2:jS,deflateReset:HS,deflateResetKeep:$S,deflateSetHeader:KS,deflate:GS,deflateEnd:qS,deflateSetDictionary:WS,deflateInfo:YS};const QS=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);var JS=function(t){const e=Array.prototype.slice.call(arguments,1);while(e.length){const n=e.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const e in n)QS(n,e)&&(t[e]=n[e])}}return t},ZS=t=>{let e=0;for(let r=0,i=t.length;r<i;r++)e+=t[r].length;const n=new Uint8Array(e);for(let r=0,i=0,s=t.length;r<s;r++){let e=t[r];n.set(e,i),i+=e.length}return n},tA={assign:JS,flattenChunks:ZS};let eA=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch($6){eA=!1}const nA=new Uint8Array(256);for(let K6=0;K6<256;K6++)nA[K6]=K6>=252?6:K6>=248?5:K6>=240?4:K6>=224?3:K6>=192?2:1;nA[254]=nA[254]=1;var rA=t=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(t);let e,n,r,i,s,o=t.length,a=0;for(i=0;i<o;i++)n=t.charCodeAt(i),55296===(64512&n)&&i+1<o&&(r=t.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(e=new Uint8Array(a),s=0,i=0;s<a;i++)n=t.charCodeAt(i),55296===(64512&n)&&i+1<o&&(r=t.charCodeAt(i+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),i++)),n<128?e[s++]=n:n<2048?(e[s++]=192|n>>>6,e[s++]=128|63&n):n<65536?(e[s++]=224|n>>>12,e[s++]=128|n>>>6&63,e[s++]=128|63&n):(e[s++]=240|n>>>18,e[s++]=128|n>>>12&63,e[s++]=128|n>>>6&63,e[s++]=128|63&n);return e};const iA=(t,e)=>{if(e<65534&&t.subarray&&eA)return String.fromCharCode.apply(null,t.length===e?t:t.subarray(0,e));let n="";for(let r=0;r<e;r++)n+=String.fromCharCode(t[r]);return n};var sA=(t,e)=>{const n=e||t.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(t.subarray(0,e));let r,i;const s=new Array(2*n);for(i=0,r=0;r<n;){let e=t[r++];if(e<128){s[i++]=e;continue}let o=nA[e];if(o>4)s[i++]=65533,r+=o-1;else{e&=2===o?31:3===o?15:7;while(o>1&&r<n)e=e<<6|63&t[r++],o--;o>1?s[i++]=65533:e<65536?s[i++]=e:(e-=65536,s[i++]=55296|e>>10&1023,s[i++]=56320|1023&e)}}return iA(s,i)},oA=(t,e)=>{e=e||t.length,e>t.length&&(e=t.length);let n=e-1;while(n>=0&&128===(192&t[n]))n--;return n<0||0===n?e:n+nA[t[n]]>e?n:e},aA={string2buf:rA,buf2string:sA,utf8border:oA};function cA(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var lA=cA;const uA=Object.prototype.toString,{Z_NO_FLUSH:hA,Z_SYNC_FLUSH:dA,Z_FULL_FLUSH:fA,Z_FINISH:pA,Z_OK:gA,Z_STREAM_END:mA,Z_DEFAULT_COMPRESSION:yA,Z_DEFAULT_STRATEGY:wA,Z_DEFLATED:bA}=f_;function vA(t){this.options=tA.assign({level:yA,method:bA,chunkSize:16384,windowBits:15,memLevel:8,strategy:wA},t||{});let e=this.options;e.raw&&e.windowBits>0?e.windowBits=-e.windowBits:e.gzip&&e.windowBits>0&&e.windowBits<16&&(e.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lA,this.strm.avail_out=0;let n=XS.deflateInit2(this.strm,e.level,e.method,e.windowBits,e.memLevel,e.strategy);if(n!==gA)throw new Error(d_[n]);if(e.header&&XS.deflateSetHeader(this.strm,e.header),e.dictionary){let t;if(t="string"===typeof e.dictionary?aA.string2buf(e.dictionary):"[object ArrayBuffer]"===uA.call(e.dictionary)?new Uint8Array(e.dictionary):e.dictionary,n=XS.deflateSetDictionary(this.strm,t),n!==gA)throw new Error(d_[n]);this._dict_set=!0}}function EA(t,e){const n=new vA(e);if(n.push(t,!0),n.err)throw n.msg||d_[n.err];return n.result}function _A(t,e){return e=e||{},e.raw=!0,EA(t,e)}function SA(t,e){return e=e||{},e.gzip=!0,EA(t,e)}vA.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize;let i,s;if(this.ended)return!1;for(s=e===~~e?e:!0===e?pA:hA,"string"===typeof t?n.input=aA.string2buf(t):"[object ArrayBuffer]"===uA.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(s===dA||s===fA)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(i=XS.deflate(n,s),i===mA)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),i=XS.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===gA;if(0!==n.avail_out){if(s>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},vA.prototype.onData=function(t){this.chunks.push(t)},vA.prototype.onEnd=function(t){t===gA&&(this.result=tA.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var AA=vA,CA=EA,IA=_A,TA=SA,kA=f_,RA={Deflate:AA,deflate:CA,deflateRaw:IA,gzip:TA,constants:kA};const NA=16209,DA=16191;var OA=function(t,e){let n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,w,b,v,E,_,S,A,C;const I=t.state;n=t.next_in,A=t.input,r=n+(t.avail_in-5),i=t.next_out,C=t.output,s=i-(e-t.avail_out),o=i+(t.avail_out-257),a=I.dmax,c=I.wsize,l=I.whave,u=I.wnext,h=I.window,d=I.hold,f=I.bits,p=I.lencode,g=I.distcode,m=(1<<I.lenbits)-1,y=(1<<I.distbits)-1;t:do{f<15&&(d+=A[n++]<<f,f+=8,d+=A[n++]<<f,f+=8),w=p[d&m];e:for(;;){if(b=w>>>24,d>>>=b,f-=b,b=w>>>16&255,0===b)C[i++]=65535&w;else{if(!(16&b)){if(0===(64&b)){w=p[(65535&w)+(d&(1<<b)-1)];continue e}if(32&b){I.mode=DA;break t}t.msg="invalid literal/length code",I.mode=NA;break t}v=65535&w,b&=15,b&&(f<b&&(d+=A[n++]<<f,f+=8),v+=d&(1<<b)-1,d>>>=b,f-=b),f<15&&(d+=A[n++]<<f,f+=8,d+=A[n++]<<f,f+=8),w=g[d&y];n:for(;;){if(b=w>>>24,d>>>=b,f-=b,b=w>>>16&255,!(16&b)){if(0===(64&b)){w=g[(65535&w)+(d&(1<<b)-1)];continue n}t.msg="invalid distance code",I.mode=NA;break t}if(E=65535&w,b&=15,f<b&&(d+=A[n++]<<f,f+=8,f<b&&(d+=A[n++]<<f,f+=8)),E+=d&(1<<b)-1,E>a){t.msg="invalid distance too far back",I.mode=NA;break t}if(d>>>=b,f-=b,b=i-s,E>b){if(b=E-b,b>l&&I.sane){t.msg="invalid distance too far back",I.mode=NA;break t}if(_=0,S=h,0===u){if(_+=c-b,b<v){v-=b;do{C[i++]=h[_++]}while(--b);_=i-E,S=C}}else if(u<b){if(_+=c+u-b,b-=u,b<v){v-=b;do{C[i++]=h[_++]}while(--b);if(_=0,u<v){b=u,v-=b;do{C[i++]=h[_++]}while(--b);_=i-E,S=C}}}else if(_+=u-b,b<v){v-=b;do{C[i++]=h[_++]}while(--b);_=i-E,S=C}while(v>2)C[i++]=S[_++],C[i++]=S[_++],C[i++]=S[_++],v-=3;v&&(C[i++]=S[_++],v>1&&(C[i++]=S[_++]))}else{_=i-E;do{C[i++]=C[_++],C[i++]=C[_++],C[i++]=C[_++],v-=3}while(v>2);v&&(C[i++]=C[_++],v>1&&(C[i++]=C[_++]))}break}}break}}while(n<r&&i<o);v=f>>3,n-=v,f-=v<<3,d&=(1<<f)-1,t.next_in=n,t.next_out=i,t.avail_in=n<r?r-n+5:5-(n-r),t.avail_out=i<o?o-i+257:257-(i-o),I.hold=d,I.bits=f};const PA=15,xA=852,MA=592,LA=0,BA=1,UA=2,FA=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),zA=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),VA=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),jA=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),HA=(t,e,n,r,i,s,o,a)=>{const c=a.bits;let l,u,h,d,f,p,g=0,m=0,y=0,w=0,b=0,v=0,E=0,_=0,S=0,A=0,C=null;const I=new Uint16Array(PA+1),T=new Uint16Array(PA+1);let k,R,N,D=null;for(g=0;g<=PA;g++)I[g]=0;for(m=0;m<r;m++)I[e[n+m]]++;for(b=c,w=PA;w>=1;w--)if(0!==I[w])break;if(b>w&&(b=w),0===w)return i[s++]=20971520,i[s++]=20971520,a.bits=1,0;for(y=1;y<w;y++)if(0!==I[y])break;for(b<y&&(b=y),_=1,g=1;g<=PA;g++)if(_<<=1,_-=I[g],_<0)return-1;if(_>0&&(t===LA||1!==w))return-1;for(T[1]=0,g=1;g<PA;g++)T[g+1]=T[g]+I[g];for(m=0;m<r;m++)0!==e[n+m]&&(o[T[e[n+m]]++]=m);if(t===LA?(C=D=o,p=20):t===BA?(C=FA,D=zA,p=257):(C=VA,D=jA,p=0),A=0,m=0,g=y,f=s,v=b,E=0,h=-1,S=1<<b,d=S-1,t===BA&&S>xA||t===UA&&S>MA)return 1;for(;;){k=g-E,o[m]+1<p?(R=0,N=o[m]):o[m]>=p?(R=D[o[m]-p],N=C[o[m]-p]):(R=96,N=0),l=1<<g-E,u=1<<v,y=u;do{u-=l,i[f+(A>>E)+u]=k<<24|R<<16|N|0}while(0!==u);l=1<<g-1;while(A&l)l>>=1;if(0!==l?(A&=l-1,A+=l):A=0,m++,0===--I[g]){if(g===w)break;g=e[n+o[m]]}if(g>b&&(A&d)!==h){0===E&&(E=b),f+=y,v=g-E,_=1<<v;while(v+E<w){if(_-=I[v+E],_<=0)break;v++,_<<=1}if(S+=1<<v,t===BA&&S>xA||t===UA&&S>MA)return 1;h=A&d,i[h]=b<<24|v<<16|f-s|0}}return 0!==A&&(i[f+A]=g-E<<24|64<<16|0),a.bits=b,0};var $A=HA;const KA=0,GA=1,qA=2,{Z_FINISH:WA,Z_BLOCK:YA,Z_TREES:XA,Z_OK:QA,Z_STREAM_END:JA,Z_NEED_DICT:ZA,Z_STREAM_ERROR:tC,Z_DATA_ERROR:eC,Z_MEM_ERROR:nC,Z_BUF_ERROR:rC,Z_DEFLATED:iC}=f_,sC=16180,oC=16181,aC=16182,cC=16183,lC=16184,uC=16185,hC=16186,dC=16187,fC=16188,pC=16189,gC=16190,mC=16191,yC=16192,wC=16193,bC=16194,vC=16195,EC=16196,_C=16197,SC=16198,AC=16199,CC=16200,IC=16201,TC=16202,kC=16203,RC=16204,NC=16205,DC=16206,OC=16207,PC=16208,xC=16209,MC=16210,LC=16211,BC=852,UC=592,FC=15,zC=FC,VC=t=>(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24);function jC(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const HC=t=>{if(!t)return 1;const e=t.state;return!e||e.strm!==t||e.mode<sC||e.mode>LC?1:0},$C=t=>{if(HC(t))return tC;const e=t.state;return t.total_in=t.total_out=e.total=0,t.msg="",e.wrap&&(t.adler=1&e.wrap),e.mode=sC,e.last=0,e.havedict=0,e.flags=-1,e.dmax=32768,e.head=null,e.hold=0,e.bits=0,e.lencode=e.lendyn=new Int32Array(BC),e.distcode=e.distdyn=new Int32Array(UC),e.sane=1,e.back=-1,QA},KC=t=>{if(HC(t))return tC;const e=t.state;return e.wsize=0,e.whave=0,e.wnext=0,$C(t)},GC=(t,e)=>{let n;if(HC(t))return tC;const r=t.state;return e<0?(n=0,e=-e):(n=5+(e>>4),e<48&&(e&=15)),e&&(e<8||e>15)?tC:(null!==r.window&&r.wbits!==e&&(r.window=null),r.wrap=n,r.wbits=e,KC(t))},qC=(t,e)=>{if(!t)return tC;const n=new jC;t.state=n,n.strm=t,n.window=null,n.mode=sC;const r=GC(t,e);return r!==QA&&(t.state=null),r},WC=t=>qC(t,zC);let YC,XC,QC=!0;const JC=t=>{if(QC){YC=new Int32Array(512),XC=new Int32Array(32);let e=0;while(e<144)t.lens[e++]=8;while(e<256)t.lens[e++]=9;while(e<280)t.lens[e++]=7;while(e<288)t.lens[e++]=8;$A(GA,t.lens,0,288,YC,0,t.work,{bits:9}),e=0;while(e<32)t.lens[e++]=5;$A(qA,t.lens,0,32,XC,0,t.work,{bits:5}),QC=!1}t.lencode=YC,t.lenbits=9,t.distcode=XC,t.distbits=5},ZC=(t,e,n,r)=>{let i;const s=t.state;return null===s.window&&(s.wsize=1<<s.wbits,s.wnext=0,s.whave=0,s.window=new Uint8Array(s.wsize)),r>=s.wsize?(s.window.set(e.subarray(n-s.wsize,n),0),s.wnext=0,s.whave=s.wsize):(i=s.wsize-s.wnext,i>r&&(i=r),s.window.set(e.subarray(n-r,n-r+i),s.wnext),r-=i,r?(s.window.set(e.subarray(n-r,n),0),s.wnext=r,s.whave=s.wsize):(s.wnext+=i,s.wnext===s.wsize&&(s.wnext=0),s.whave<s.wsize&&(s.whave+=i))),0},tI=(t,e)=>{let n,r,i,s,o,a,c,l,u,h,d,f,p,g,m,y,w,b,v,E,_,S,A=0;const C=new Uint8Array(4);let I,T;const k=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(HC(t)||!t.output||!t.input&&0!==t.avail_in)return tC;n=t.state,n.mode===mC&&(n.mode=yC),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,h=a,d=c,S=QA;t:for(;;)switch(n.mode){case sC:if(0===n.wrap){n.mode=yC;break}while(u<16){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,C[0]=255&l,C[1]=l>>>8&255,n.check=h_(n.check,C,2,0),l=0,u=0,n.mode=oC;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){t.msg="incorrect header check",n.mode=xC;break}if((15&l)!==iC){t.msg="unknown compression method",n.mode=xC;break}if(l>>>=4,u-=4,_=8+(15&l),0===n.wbits&&(n.wbits=_),_>15||_>n.wbits){t.msg="invalid window size",n.mode=xC;break}n.dmax=1<<n.wbits,n.flags=0,t.adler=n.check=1,n.mode=512&l?pC:mC,l=0,u=0;break;case oC:while(u<16){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(n.flags=l,(255&n.flags)!==iC){t.msg="unknown compression method",n.mode=xC;break}if(57344&n.flags){t.msg="unknown header flags set",n.mode=xC;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=h_(n.check,C,2,0)),l=0,u=0,n.mode=aC;case aC:while(u<32){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,C[2]=l>>>16&255,C[3]=l>>>24&255,n.check=h_(n.check,C,4,0)),l=0,u=0,n.mode=cC;case cC:while(u<16){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=h_(n.check,C,2,0)),l=0,u=0,n.mode=lC;case lC:if(1024&n.flags){while(u<16){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(C[0]=255&l,C[1]=l>>>8&255,n.check=h_(n.check,C,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=uC;case uC:if(1024&n.flags&&(f=n.length,f>a&&(f=a),f&&(n.head&&(_=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(s,s+f),_)),512&n.flags&&4&n.wrap&&(n.check=h_(n.check,r,f,s)),a-=f,s+=f,n.length-=f),n.length))break t;n.length=0,n.mode=hC;case hC:if(2048&n.flags){if(0===a)break t;f=0;do{_=r[s+f++],n.head&&_&&n.length<65536&&(n.head.name+=String.fromCharCode(_))}while(_&&f<a);if(512&n.flags&&4&n.wrap&&(n.check=h_(n.check,r,f,s)),a-=f,s+=f,_)break t}else n.head&&(n.head.name=null);n.length=0,n.mode=dC;case dC:if(4096&n.flags){if(0===a)break t;f=0;do{_=r[s+f++],n.head&&_&&n.length<65536&&(n.head.comment+=String.fromCharCode(_))}while(_&&f<a);if(512&n.flags&&4&n.wrap&&(n.check=h_(n.check,r,f,s)),a-=f,s+=f,_)break t}else n.head&&(n.head.comment=null);n.mode=fC;case fC:if(512&n.flags){while(u<16){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(4&n.wrap&&l!==(65535&n.check)){t.msg="header crc mismatch",n.mode=xC;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),t.adler=n.check=0,n.mode=mC;break;case pC:while(u<32){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}t.adler=n.check=VC(l),l=0,u=0,n.mode=gC;case gC:if(0===n.havedict)return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,ZA;t.adler=n.check=1,n.mode=mC;case mC:if(e===YA||e===XA)break t;case yC:if(n.last){l>>>=7&u,u-=7&u,n.mode=DC;break}while(u<3){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}switch(n.last=1&l,l>>>=1,u-=1,3&l){case 0:n.mode=wC;break;case 1:if(JC(n),n.mode=AC,e===XA){l>>>=2,u-=2;break t}break;case 2:n.mode=EC;break;case 3:t.msg="invalid block type",n.mode=xC}l>>>=2,u-=2;break;case wC:l>>>=7&u,u-=7&u;while(u<32){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if((65535&l)!==(l>>>16^65535)){t.msg="invalid stored block lengths",n.mode=xC;break}if(n.length=65535&l,l=0,u=0,n.mode=bC,e===XA)break t;case bC:n.mode=vC;case vC:if(f=n.length,f){if(f>a&&(f=a),f>c&&(f=c),0===f)break t;i.set(r.subarray(s,s+f),o),a-=f,s+=f,c-=f,o+=f,n.length-=f;break}n.mode=mC;break;case EC:while(u<14){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){t.msg="too many length or distance symbols",n.mode=xC;break}n.have=0,n.mode=_C;case _C:while(n.have<n.ncode){while(u<3){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}n.lens[k[n.have++]]=7&l,l>>>=3,u-=3}while(n.have<19)n.lens[k[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,I={bits:n.lenbits},S=$A(KA,n.lens,0,19,n.lencode,0,n.work,I),n.lenbits=I.bits,S){t.msg="invalid code lengths set",n.mode=xC;break}n.have=0,n.mode=SC;case SC:while(n.have<n.nlen+n.ndist){for(;;){if(A=n.lencode[l&(1<<n.lenbits)-1],m=A>>>24,y=A>>>16&255,w=65535&A,m<=u)break;if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(w<16)l>>>=m,u-=m,n.lens[n.have++]=w;else{if(16===w){T=m+2;while(u<T){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(l>>>=m,u-=m,0===n.have){t.msg="invalid bit length repeat",n.mode=xC;break}_=n.lens[n.have-1],f=3+(3&l),l>>>=2,u-=2}else if(17===w){T=m+3;while(u<T){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}l>>>=m,u-=m,_=0,f=3+(7&l),l>>>=3,u-=3}else{T=m+7;while(u<T){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}l>>>=m,u-=m,_=0,f=11+(127&l),l>>>=7,u-=7}if(n.have+f>n.nlen+n.ndist){t.msg="invalid bit length repeat",n.mode=xC;break}while(f--)n.lens[n.have++]=_}}if(n.mode===xC)break;if(0===n.lens[256]){t.msg="invalid code -- missing end-of-block",n.mode=xC;break}if(n.lenbits=9,I={bits:n.lenbits},S=$A(GA,n.lens,0,n.nlen,n.lencode,0,n.work,I),n.lenbits=I.bits,S){t.msg="invalid literal/lengths set",n.mode=xC;break}if(n.distbits=6,n.distcode=n.distdyn,I={bits:n.distbits},S=$A(qA,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,I),n.distbits=I.bits,S){t.msg="invalid distances set",n.mode=xC;break}if(n.mode=AC,e===XA)break t;case AC:n.mode=CC;case CC:if(a>=6&&c>=258){t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,OA(t,d),o=t.next_out,i=t.output,c=t.avail_out,s=t.next_in,r=t.input,a=t.avail_in,l=n.hold,u=n.bits,n.mode===mC&&(n.back=-1);break}for(n.back=0;;){if(A=n.lencode[l&(1<<n.lenbits)-1],m=A>>>24,y=A>>>16&255,w=65535&A,m<=u)break;if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(y&&0===(240&y)){for(b=m,v=y,E=w;;){if(A=n.lencode[E+((l&(1<<b+v)-1)>>b)],m=A>>>24,y=A>>>16&255,w=65535&A,b+m<=u)break;if(0===a)break t;a--,l+=r[s++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=m,u-=m,n.back+=m,n.length=w,0===y){n.mode=NC;break}if(32&y){n.back=-1,n.mode=mC;break}if(64&y){t.msg="invalid literal/length code",n.mode=xC;break}n.extra=15&y,n.mode=IC;case IC:if(n.extra){T=n.extra;while(u<T){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=TC;case TC:for(;;){if(A=n.distcode[l&(1<<n.distbits)-1],m=A>>>24,y=A>>>16&255,w=65535&A,m<=u)break;if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(0===(240&y)){for(b=m,v=y,E=w;;){if(A=n.distcode[E+((l&(1<<b+v)-1)>>b)],m=A>>>24,y=A>>>16&255,w=65535&A,b+m<=u)break;if(0===a)break t;a--,l+=r[s++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=m,u-=m,n.back+=m,64&y){t.msg="invalid distance code",n.mode=xC;break}n.offset=w,n.extra=15&y,n.mode=kC;case kC:if(n.extra){T=n.extra;while(u<T){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){t.msg="invalid distance too far back",n.mode=xC;break}n.mode=RC;case RC:if(0===c)break t;if(f=d-c,n.offset>f){if(f=n.offset-f,f>n.whave&&n.sane){t.msg="invalid distance too far back",n.mode=xC;break}f>n.wnext?(f-=n.wnext,p=n.wsize-f):p=n.wnext-f,f>n.length&&(f=n.length),g=n.window}else g=i,p=o-n.offset,f=n.length;f>c&&(f=c),c-=f,n.length-=f;do{i[o++]=g[p++]}while(--f);0===n.length&&(n.mode=CC);break;case NC:if(0===c)break t;i[o++]=n.length,c--,n.mode=CC;break;case DC:if(n.wrap){while(u<32){if(0===a)break t;a--,l|=r[s++]<<u,u+=8}if(d-=c,t.total_out+=d,n.total+=d,4&n.wrap&&d&&(t.adler=n.check=n.flags?h_(n.check,i,d,o-d):a_(n.check,i,d,o-d)),d=c,4&n.wrap&&(n.flags?l:VC(l))!==n.check){t.msg="incorrect data check",n.mode=xC;break}l=0,u=0}n.mode=OC;case OC:if(n.wrap&&n.flags){while(u<32){if(0===a)break t;a--,l+=r[s++]<<u,u+=8}if(4&n.wrap&&l!==(4294967295&n.total)){t.msg="incorrect length check",n.mode=xC;break}l=0,u=0}n.mode=PC;case PC:S=JA;break t;case xC:S=eC;break t;case MC:return nC;case LC:default:return tC}return t.next_out=o,t.avail_out=c,t.next_in=s,t.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==t.avail_out&&n.mode<xC&&(n.mode<DC||e!==WA))&&ZC(t,t.output,t.next_out,d-t.avail_out),h-=t.avail_in,d-=t.avail_out,t.total_in+=h,t.total_out+=d,n.total+=d,4&n.wrap&&d&&(t.adler=n.check=n.flags?h_(n.check,i,d,t.next_out-d):a_(n.check,i,d,t.next_out-d)),t.data_type=n.bits+(n.last?64:0)+(n.mode===mC?128:0)+(n.mode===AC||n.mode===bC?256:0),(0===h&&0===d||e===WA)&&S===QA&&(S=rC),S},eI=t=>{if(HC(t))return tC;let e=t.state;return e.window&&(e.window=null),t.state=null,QA},nI=(t,e)=>{if(HC(t))return tC;const n=t.state;return 0===(2&n.wrap)?tC:(n.head=e,e.done=!1,QA)},rI=(t,e)=>{const n=e.length;let r,i,s;return HC(t)?tC:(r=t.state,0!==r.wrap&&r.mode!==gC?tC:r.mode===gC&&(i=1,i=a_(i,e,n,0),i!==r.check)?eC:(s=ZC(t,e,n,n),s?(r.mode=MC,nC):(r.havedict=1,QA)))};var iI=KC,sI=GC,oI=$C,aI=WC,cI=qC,lI=tI,uI=eI,hI=nI,dI=rI,fI="pako inflate (from Nodeca project)",pI={inflateReset:iI,inflateReset2:sI,inflateResetKeep:oI,inflateInit:aI,inflateInit2:cI,inflate:lI,inflateEnd:uI,inflateGetHeader:hI,inflateSetDictionary:dI,inflateInfo:fI};function gI(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var mI=gI;const yI=Object.prototype.toString,{Z_NO_FLUSH:wI,Z_FINISH:bI,Z_OK:vI,Z_STREAM_END:EI,Z_NEED_DICT:_I,Z_STREAM_ERROR:SI,Z_DATA_ERROR:AI,Z_MEM_ERROR:CI}=f_;function II(t){this.options=tA.assign({chunkSize:65536,windowBits:15,to:""},t||{});const e=this.options;e.raw&&e.windowBits>=0&&e.windowBits<16&&(e.windowBits=-e.windowBits,0===e.windowBits&&(e.windowBits=-15)),!(e.windowBits>=0&&e.windowBits<16)||t&&t.windowBits||(e.windowBits+=32),e.windowBits>15&&e.windowBits<48&&0===(15&e.windowBits)&&(e.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lA,this.strm.avail_out=0;let n=pI.inflateInit2(this.strm,e.windowBits);if(n!==vI)throw new Error(d_[n]);if(this.header=new mI,pI.inflateGetHeader(this.strm,this.header),e.dictionary&&("string"===typeof e.dictionary?e.dictionary=aA.string2buf(e.dictionary):"[object ArrayBuffer]"===yI.call(e.dictionary)&&(e.dictionary=new Uint8Array(e.dictionary)),e.raw&&(n=pI.inflateSetDictionary(this.strm,e.dictionary),n!==vI)))throw new Error(d_[n])}function TI(t,e){const n=new II(e);if(n.push(t),n.err)throw n.msg||d_[n.err];return n.result}function kI(t,e){return e=e||{},e.raw=!0,TI(t,e)}II.prototype.push=function(t,e){const n=this.strm,r=this.options.chunkSize,i=this.options.dictionary;let s,o,a;if(this.ended)return!1;for(o=e===~~e?e:!0===e?bI:wI,"[object ArrayBuffer]"===yI.call(t)?n.input=new Uint8Array(t):n.input=t,n.next_in=0,n.avail_in=n.input.length;;){0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),s=pI.inflate(n,o),s===_I&&i&&(s=pI.inflateSetDictionary(n,i),s===vI?s=pI.inflate(n,o):s===AI&&(s=_I));while(n.avail_in>0&&s===EI&&n.state.wrap>0&&0!==t[n.next_in])pI.inflateReset(n),s=pI.inflate(n,o);switch(s){case SI:case AI:case _I:case CI:return this.onEnd(s),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||s===EI))if("string"===this.options.to){let t=aA.utf8border(n.output,n.next_out),e=n.next_out-t,i=aA.buf2string(n.output,t);n.next_out=e,n.avail_out=r-e,e&&n.output.set(n.output.subarray(t,t+e),0),this.onData(i)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(s!==vI||0!==a){if(s===EI)return s=pI.inflateEnd(this.strm),this.onEnd(s),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},II.prototype.onData=function(t){this.chunks.push(t)},II.prototype.onEnd=function(t){t===vI&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=tA.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg};var RI=II,NI=TI,DI=kI,OI=TI,PI=f_,xI={Inflate:RI,inflate:NI,inflateRaw:DI,ungzip:OI,constants:PI};const{Deflate:MI,deflate:LI,deflateRaw:BI,gzip:UI}=RA,{Inflate:FI,inflate:zI,inflateRaw:VI,ungzip:jI}=xI;var HI=MI,$I=LI,KI=BI,GI=UI,qI=FI,WI=zI,YI=VI,XI=jI,QI=f_,JI={Deflate:HI,deflate:$I,deflateRaw:KI,gzip:GI,Inflate:qI,inflate:WI,inflateRaw:YI,ungzip:XI,constants:QI};const ZI=6;function tT({repo:t,preload:e}){async function*n(n,r={}){if(null!=r.compressionLevel&&(r.compressionLevel<-1||r.compressionLevel>9))throw Vt(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(!1!==r.preload){let t;try{t=El(n).split("/")}catch(uS){throw Vt(uS,"ERR_INVALID_PATH")}e(Me.parse(t[0]))}const i=Me.asCID(n)||n,s=await lv(i,t.blocks,r);if("file"===s.type||"raw"===s.type){const t=[];return r.compress&&!0!==r.archive?t.push(s.content):t.push([{header:{name:s.path,mode:"file"===s.type&&s.unixfs.mode,mtime:"file"===s.type&&s.unixfs.mtime?new Date(1e3*s.unixfs.mtime.secs):void 0,size:s.size,type:"file"},body:s.content()}],jv()),r.compress&&t.push((async function*(t){const e=await pv(t);yield JI.gzip(e,{level:r.compressionLevel||ZI})})),void(yield*vm(...t))}if("directory"!==s.type)throw Vt(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");{const e=[uv(i,t.blocks,r),async function*(t){for await(const e of t){const t={header:{name:e.path,size:e.size}};if("file"===e.type)t.header.type="file",t.header.mode=null!=e.unixfs.mode?e.unixfs.mode:void 0,t.header.mtime=e.unixfs.mtime?new Date(1e3*e.unixfs.mtime.secs):void 0,t.body=e.content();else if("raw"===e.type)t.header.type="file",t.body=e.content();else{if("directory"!==e.type)throw Vt(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");t.header.type="directory",t.header.mode=null!=e.unixfs.mode?e.unixfs.mode:void 0,t.header.mtime=e.unixfs.mtime?new Date(1e3*e.unixfs.mtime.secs):void 0}yield t}},jv()];if(r.compress){if(!r.archive)throw Vt(new Error("file is not regular"),"ERR_INVALID_PATH");r.compress&&e.push((async function*(t){const e=await pv(t);yield JI.gzip(e,{level:r.compressionLevel||ZI})}))}yield*vm(...e)}}return fl(n)}function eT({repo:t,preload:e}){async function*n(n,r={}){const i=El(n),s=i.split("/");!1!==r.preload&&e(Me.parse(s[0]));const o=Me.asCID(i)||i,a=await lv(o,t.blocks,r);if("file"!==a.type){if("directory"!==a.type)throw Vt(new Error(`Unknown UnixFS type ${a.type}`),"ERR_UNKNOWN_UNIXFS_TYPE");for await(const t of a.content())yield Sl(t)}else yield Sl(a)}return fl(n)}class nT{constructor({preload:t,repo:e,hashers:n,options:r}){const i=Sb({preload:t,repo:e,options:r,hashers:n});this.addAll=i,this.add=qy({addAll:i}),this.cat=hv({repo:e,preload:t}),this.get=tT({repo:e,preload:t}),this.ls=eT({repo:e,preload:t})}}const rT="0.17.0",iT="e8b7b66bfa98c2a1c0d0bfc19f698d7d00b6c888",sT="^0.157.0";function oT({repo:t}){async function e(e={}){const n=await t.version.get();return{version:rT,commit:iT,repo:`${n}`,"ipfs-core":rT,"interface-ipfs-core":sT}}return fl(e)}const aT=zt("ipfs:components:id");function cT({peerId:t,network:e}){async function n(n={}){const r=e.try();if(!r){if(n.peerId)throw new Do;if(null==t.publicKey)throw Vt(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:t,publicKey:sa(t.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${rT}`,protocolVersion:"9000",protocols:[]}}const{libp2p:i}=r,s=n.peerId?n.peerId:t,o=await lT(s,i,n),a=sa(o.metadata.get("AgentVersion")||new Uint8Array),c=sa(o.metadata.get("ProtocolVersion")||new Uint8Array),l=o.id.toString(),u=o.publicKey?sa(o.publicKey,"base64pad"):"";return{id:s,publicKey:u,addresses:(o.addresses||[]).map((t=>{const e=t.toString();return e.endsWith(`/p2p/${l}`)?e:`${e}/p2p/${l}`})).sort().map((t=>dc(t))),agentVersion:a,protocolVersion:c,protocols:(o.protocols||[]).sort()}}return fl(n)}async function lT(t,e,n){let r=await e.peerStore.get(t);r||(r=await uT(t,e,n));let i=t.publicKey?t.publicKey:await e.peerStore.keyBook.get(t);if(null==i)try{i=await e.getPublicKey(t,n)}catch(uS){aT.error("Could not load public key for",t.toString(),uS)}return{...r,publicKey:i,metadata:r.metadata||new Map,addresses:r.addresses.map((t=>t.multiaddr))}}async function uT(t,e,n){if(null==e.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(const i of e.dht.findPeer(t,n))if("FINAL_PEER"===i.name)break;const r=await e.peerStore.get(t);if(!r)throw Vt(new Error("Could not find peer"),"ERR_NOT_FOUND");return r}var hT=dT;function dT(t,e,n){var r,i,s;if(Array.isArray(e)&&(r=e.slice(0)),"string"==typeof e&&(r=e.split(".")),"symbol"==typeof e&&(r=[e]),!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");if(i=r.pop(),!i)return!1;fT(i);while(s=r.shift())if(fT(s),"undefined"==typeof t[s]&&(t[s]={}),t=t[s],!t||"object"!=typeof t)return!1;return t[i]=n,!0}function fT(t){if("__proto__"==t||"constructor"==t||"prototype"==t)throw new Error("setting of prototype values not supported")}const pT={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:t=>(hT(t,"Discovery.MDNS.Enabled",!1),hT(t,"Discovery.webRTCStar.Enabled",!1),t.Swarm={...t.Swarm||{},DisableNatPortMap:!0},t)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:t=>(hT(t,"Discovery.MDNS.Enabled",!0),hT(t,"Discovery.webRTCStar.Enabled",!0),hT(t,"Swarm",{...t.Swarm||{},DisableNatPortMap:!1}),t)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:t=>{const e=by();return hT(t,"Addresses.API",e.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),hT(t,"Addresses.Gateway",e.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),hT(t,"Addresses.Swarm",e.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),hT(t,"Addresses.Delegates",[]),hT(t,"Bootstrap",[]),hT(t,"Discovery.MDNS.Enabled",!1),hT(t,"Discovery.webRTCStar.Enabled",!1),hT(t,"Swarm",{...t.Swarm||{},DisableNatPortMap:!0}),t}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:t=>{const e=by();return hT(t,"Addresses.API",e.Addresses.API),hT(t,"Addresses.Gateway",e.Addresses.Gateway),hT(t,"Addresses.Swarm",e.Addresses.Swarm),hT(t,"Addresses.Delegates",e.Addresses.Delegates),hT(t,"Bootstrap",e.Bootstrap),hT(t,"Discovery.MDNS.Enabled",e.Discovery.MDNS.Enabled),hT(t,"Discovery.webRTCStar.Enabled",e.Discovery.webRTCStar.Enabled),hT(t,"Swarm",{...t.Swarm||{},DisableNatPortMap:!1}),t}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:t=>{const e=t.Swarm||{},n=e.ConnMgr||{};return n.LowWater=20,n.HighWater=40,e.ConnMgr=n,t.Swarm=e,t}},"default-power":{description:'Inverse of "lowpower" profile.',transform:t=>{const e=by();return t.Swarm=e.Swarm,t}}},gT=zt("ipfs:core:config");function mT({repo:t}){return{getAll:fl(e),get:fl(n),set:fl(r),replace:fl(i),profiles:{apply:fl(s),list:fl(yT)}};async function e(e={}){return t.config.getAll(e)}async function n(e,n){return e?t.config.get(e,n):Promise.reject(new Error("key argument is required"))}async function r(e,n,r){return t.config.set(e,n,r)}async function i(e,n){return t.config.replace(e,n)}async function s(e,n={dryRun:!1}){const{dryRun:r}=n,i=pT[e];if(!i)throw new Error(`No profile with name '${e}' exists`);try{const e=await t.config.getAll(n);let s=JSON.parse(JSON.stringify(e));return s=i.transform(s),r||await t.config.replace(s,n),delete e.Identity.PrivKey,delete s.Identity.PrivKey,{original:e,updated:s}}catch(uS){throw gT(uS),new Error(`Could not apply profile '${e}' to config: ${uS.message}`)}}}async function yT(t){return Object.keys(pT).map((t=>({name:t,description:pT[t].description})))}function wT({enumerable:t=!0,configurable:e=!1}={}){return{enumerable:t,configurable:e,writable:!1}}function*bT(t,e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))for(const[n,r]of e.entries()){const e=[...t,n],i=Me.asCID(r);i?yield[e.join("/"),i]:"object"===typeof r&&(yield*vT(r,e))}else{const n=Me.asCID(e);n?yield[t.join("/"),n]:yield*vT(e,t)}}function*vT(t,e){if(!(null==t||t instanceof Uint8Array))for(const[n,r]of Object.entries(t)){const t=[...e,n];yield*bT(t,r)}}function*ET(t,e){if(Array.isArray(e))for(const[n,r]of e.entries()){const e=[...t,n];yield e.join("/"),"object"!==typeof r||Me.asCID(r)||(yield*_T(r,e))}else yield*_T(e,t)}function*_T(t,e){if(null!=t&&"object"===typeof t)for(const[n,r]of Object.entries(t)){const t=[...e,n];yield t.join("/"),null==r||r instanceof Uint8Array||"object"!==typeof r||Me.asCID(r)||(yield*ET(t,r))}}function ST(t,e){let n=t;for(const[r,i]of e.entries()){if(n=n[i],null==n)throw new Error(`Object has no property at ${e.slice(0,r+1).map((t=>`[${JSON.stringify(t)}]`)).join("")}`);const t=Me.asCID(n);if(t)return{value:t,remaining:e.slice(r+1).join("/")}}return{value:n}}class AT{constructor({cid:t,bytes:e,value:n}){if(!t||!e||"undefined"===typeof n)throw new Error("Missing required argument");this.cid=t,this.bytes=e,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:wT(),bytes:wT(),value:wT(),asBlock:wT()})}links(){return vT(this.value,[])}tree(){return _T(this.value,[])}get(t="/"){return ST(this.value,t.split("/").filter(Boolean))}}function CT({bytes:t,cid:e,value:n,codec:r}){const i=void 0!==n?n:r&&r.decode(t);if(void 0===i)throw new Error('Missing required argument, must either provide "value" or "codec"');return new AT({cid:e,bytes:t,value:i})}function IT(t){const e=Zi({version:1,roots:t}),n=ma.encode(e.length),r=new Uint8Array(n.length+e.length);return r.set(n,0),r.set(e,n.length),r}function TT(t){return{async setRoots(e){const n=IT(e);await t.write(n)},async writeBlock(e){const{cid:n,bytes:r}=e;await t.write(new Uint8Array(ma.encode(n.bytes.length+r.length))),await t.write(n.bytes),r.length&&await t.write(r)},async close(){await t.end()}}}function kT(){}function RT(){const t=[];let e=null,n=kT,r=!1,i=null,s=kT;const o=()=>(e||(e=new Promise((t=>{n=()=>{e=null,n=kT,t()}}))),e),a={write(e){t.push(e);const n=o();return s(),n},async end(){r=!0;const t=o();s(),await t}},c={async next(){const e=t.shift();return e?(0===t.length&&n(),{done:!1,value:e}):r?(n(),{done:!0,value:void 0}):(i||(i=new Promise((t=>{s=()=>(i=null,s=kT,t(c.next()))}))),i)}};return{writer:a,iterator:c}}const NT={Null:t=>null===t,Int:t=>Number.isInteger(t),Float:t=>"number"===typeof t&&Number.isFinite(t),String:t=>"string"===typeof t,Bool:t=>"boolean"===typeof t,Bytes:t=>t instanceof Uint8Array,Link:t=>!NT.Null(t)&&"object"===typeof t&&t.asCID===t,List:t=>Array.isArray(t),Map:t=>!NT.Null(t)&&"object"===typeof t&&t.asCID!==t&&!NT.List(t)&&!NT.Bytes(t)},DT={Int:NT.Int,"CarHeader > version":t=>DT.Int(t),"CarHeader > roots (anon) > valueType (anon)":NT.Link,"CarHeader > roots (anon)":t=>NT.List(t)&&Array.prototype.every.call(t,DT["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":t=>DT["CarHeader > roots (anon)"](t),CarHeader:t=>{const e=t&&Object.keys(t);return NT.Map(t)&&["version"].every((t=>e.includes(t)))&&Object.entries(t).every((([t,e])=>DT["CarHeader > "+t]&&DT["CarHeader > "+t](e)))}},OT=DT.CarHeader,PT={SHA2_256:18,LENGTH:32,DAG_PB:112},xT=40;async function MT(t){const e=await t.upTo(8);if(!e.length)throw new Error("Unexpected end of data");const n=ma.decode(e);return t.seek(ma.decode.bytes),n}async function LT(t){const e=await t.exactly(xT),n=new DataView(e.buffer,e.byteOffset,e.byteLength);let r=0;const i={version:2,characteristics:[n.getBigUint64(r,!0),n.getBigUint64(r+=8,!0)],dataOffset:Number(n.getBigUint64(r+=8,!0)),dataSize:Number(n.getBigUint64(r+=8,!0)),indexOffset:Number(n.getBigUint64(r+=8,!0))};return t.seek(xT),i}async function BT(t,e){const n=await MT(t);if(0===n)throw new Error("Invalid CAR header (zero length)");const r=await t.exactly(n);t.seek(n);const i=ts(r);if(!OT(i))throw new Error("Invalid CAR header format");if(1!==i.version&&2!==i.version||void 0!==e&&i.version!==e)throw new Error(`Invalid CAR version: ${i.version}${void 0!==e?` (expected ${e})`:""}`);const s=Array.isArray(i.roots);if(1===i.version&&!s||2===i.version&&s)throw new Error("Invalid CAR header format");if(1===i.version)return i;const o=await LT(t);t.seek(o.dataOffset-t.pos);const a=await BT(t,1);return Object.assign(a,o)}async function UT(t){const e=await t.upTo(8);ma.decode(e);const n=ma.decode.bytes,r=ma.decode(e.subarray(ma.decode.bytes)),i=ma.decode.bytes,s=n+i+r,o=await t.exactly(s);return t.seek(s),o}async function FT(t){const e=await t.exactly(2);if(e[0]===PT.SHA2_256&&e[1]===PT.LENGTH){const e=await t.exactly(34);t.seek(34);const n=Re(e);return Me.create(0,PT.DAG_PB,n)}const n=await MT(t);if(1!==n)throw new Error(`Unexpected CID version (${n})`);const r=await MT(t),i=await UT(t),s=Re(i);return Me.create(n,r,s)}async function zT(t){const e=t.pos;let n=await MT(t);if(0===n)throw new Error("Invalid CAR section (zero length)");n+=t.pos-e;const r=await FT(t),i=n-Number(t.pos-e);return{cid:r,length:n,blockLength:i}}async function VT(t){const{cid:e,blockLength:n}=await zT(t),r=await t.exactly(n);return t.seek(n),{bytes:r,cid:e}}async function jT(t){const e=t.pos,{cid:n,length:r,blockLength:i}=await zT(t),s={cid:n,length:r,blockLength:i,offset:e,blockOffset:t.pos};return t.seek(s.blockLength),s}function HT(t){const e=(async()=>{const e=await BT(t);if(2===e.version){const n=t.pos-e.dataOffset;t=qT(t,e.dataSize-n)}return e})();return{header:()=>e,async*blocks(){await e;while((await t.upTo(8)).length>0)yield await VT(t)},async*blocksIndex(){await e;while((await t.upTo(8)).length>0)yield await jT(t)}}}function $T(t){let e=0;return{async upTo(n){return t.subarray(e,e+Math.min(n,t.length-e))},async exactly(n){if(n>t.length-e)throw new Error("Unexpected end of data");return t.subarray(e,e+n)},seek(t){e+=t},get pos(){return e}}}function KT(t){let e=0,n=0,r=0,i=new Uint8Array(0);const s=async e=>{n=i.length-r;const s=[i.subarray(r)];while(n<e){const e=await t();if(null==e)break;n<0?e.length>n&&s.push(e.subarray(-n)):s.push(e),n+=e.length}i=new Uint8Array(s.reduce(((t,e)=>t+e.length),0));let o=0;for(const t of s)i.set(t,o),o+=t.length;r=0};return{async upTo(t){return i.length-r<t&&await s(t),i.subarray(r,r+Math.min(i.length-r,t))},async exactly(t){if(i.length-r<t&&await s(t),i.length-r<t)throw new Error("Unexpected end of data");return i.subarray(r,r+t)},seek(t){e+=t,r+=t},get pos(){return e}}}function GT(t){const e=t[Symbol.asyncIterator]();async function n(){const t=await e.next();return t.done?null:t.value}return KT(n)}function qT(t,e){let n=0;return{async upTo(r){let i=await t.upTo(r);return i.length+n>e&&(i=i.subarray(0,e-n)),i},async exactly(r){const i=await t.exactly(r);if(i.length+n>e)throw new Error("Unexpected end of data");return i},seek(e){n+=e,t.seek(e)},get pos(){return t.pos}}}class WT{constructor(t,e){this._encoder=e,this._mutex=e.setRoots(t),this._ended=!1}async put(t){if(!(t.bytes instanceof Uint8Array)||!t.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const e=Me.asCID(t.cid);if(!e)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then((()=>this._encoder.writeBlock({cid:e,bytes:t.bytes}))),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(t){t=QT(t);const{encoder:e,iterator:n}=XT(),r=new WT(t,e),i=new YT(n);return{writer:r,out:i}}static createAppender(){const{encoder:t,iterator:e}=XT();t.setRoots=()=>Promise.resolve();const n=new WT([],t),r=new YT(e);return{writer:n,out:r}}static async updateRootsInBytes(t,e){const n=$T(t);await BT(n);const r=IT(e);if(Number(n.pos)!==r.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${r.length} bytes)`);return t.set(r,0),t}}class YT{constructor(t){this._iterator=t}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function XT(){const t=RT(),{writer:e,iterator:n}=t,r=TT(e);return{encoder:r,iterator:n}}function QT(t){if(void 0===t)return[];if(!Array.isArray(t)){const e=Me.asCID(t);if(!e)throw new TypeError("roots must be a single CID or an array of CIDs");return[e]}const e=[];for(const n of t){const t=Me.asCID(n);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(t)}return e}const JT=async({cid:t,load:e,seen:n})=>{n=n||new Set;const r=t.toString(Ct);if(n.has(r))return;const i=await e(t);if(n.add(r),null!==i)for(const[,s]of i.links())await JT({cid:s,load:e,seen:n})},ZT=zt("ipfs:components:dag:import"),tk=[go,Eo];function ek({repo:t,preload:e,codecs:n}){async function*r(r,i={}){!1!==i.preload&&e(r);const s=Me.asCID(r);if(!s)throw new Error(`Unexpected error converting CID type: ${r}`);ZT(`Exporting ${s} as car`);const{writer:o,out:a}=await WT.create([s]);let c=null;(async()=>{try{const e=nk(t,o,{signal:i.signal,timeout:i.timeout},n);await JT({cid:s,load:e})}catch(e){c=e}finally{o.close()}})();for await(const t of a){if(c)break;yield t}if(c)throw c}return fl(r)}function nk(t,e,n,r){return async i=>{const s=await r.getCodec(i.code);if(!s)throw new Error(`Can't decode links in block with codec 0x${i.code.toString(16)} to form complete DAG`);const o=await t.blocks.get(i,n);return ZT(`Adding block ${i} to car`),await e.put({cid:i,bytes:o}),tk.includes(i.code)?null:CT({bytes:o,cid:i,codec:s})}}async function rk(t){for await(const e of t)return e}function ik({codecs:t,repo:e,preload:n}){const r=async function(r,i={}){if(!1!==i.preload&&n(r),i.path){const n=i.localResolve?await rk(Cl(r,i.path,t,e,i)):await Gu(Cl(r,i.path,t,e,i)),s=n;if(!s)throw Vt(new Error("Not found"),"ERR_NOT_FOUND");return s}const s=await t.getCodec(r.code),o=await e.blocks.get(r,i),a=s.decode(o);return{value:a,remainderPath:""}};return fl(r)}class sk{constructor(t,e,n){this._version=t,this._roots=e,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class ok extends sk{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(t){const{version:e,roots:n,iterator:r}=await ck(t);return new ok(e,n,r)}static async fromIterable(t){const{version:e,roots:n,iterator:r}=await lk(t);return new ok(e,n,r)}}class ak extends(null){[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;const t=this._iterable[Symbol.asyncIterator]();return{async next(){const e=await t.next();return e.done?e:{done:!1,value:e.value.cid}}}}static async fromBytes(t){const{version:e,roots:n,iterator:r}=await ck(t);return new ak(e,n,r)}static async fromIterable(t){const{version:e,roots:n,iterator:r}=await lk(t);return new ak(e,n,r)}}async function ck(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return uk($T(t))}async function lk(t){if(!t||"function"!==typeof t[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return uk(GT(t))}async function uk(t){const e=HT(t),{version:n,roots:r}=await e.header();return{version:n,roots:r,iterator:e.blocks()}}const hk=zt("ipfs:components:dag:import");function dk({repo:t}){async function*e(e,n={}){const r=await t.gcLock.readLock();try{const r={signal:n.signal,timeout:n.timeout},i=Ly(e),{value:s,done:o}=await i.peek();if(o)return;let a;s&&i.push(s),a=s instanceof Uint8Array?[i]:i;for await(const e of a){const i=await fk(t,r,e);if(!1!==n.pinRoots)for(const e of i){let n="";try{await t.blocks.has(e)?(hk(`Pinning root ${e}`),await t.pins.pinRecursively(e)):n="blockstore: block not found"}catch(uS){n=uS.message}yield{root:{cid:e,pinErrorMsg:n}}}}}finally{r()}}return fl(e)}async function fk(t,e,n){const r=await ok.fromIterable(n),i=await r.getRoots();return await Zg(t.blocks.putMany(ky(r,(({cid:t,bytes:e})=>(hk(`Import block ${t}`),{key:t,value:e}))),{signal:e.signal})),i}function pk({repo:t,codecs:e,hashers:n,preload:r}){async function i(i,s={}){const o=s.pin?await t.gcLock.readLock():null;try{const o=await e.getCodec(s.storeCodec||"dag-cbor");if(!o)throw new Error(`Unknown storeCodec ${s.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(s.inputCodec){if(!(i instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");const t=await e.getCodec(s.inputCodec);if(!t)throw new Error(`Unknown inputCodec ${s.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);i=t.decode(i)}const a=null!=s.version?s.version:1,c=await n.getHasher(s.hashAlg||"sha2-256");if(!c)throw new Error(`Unknown hash algorithm ${s.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);const l=o.encode(i),u=await c.digest(l),h=Me.create(a,o.code,u);return await t.blocks.put(h,l,{signal:s.signal}),s.pin&&await t.pins.pinRecursively(h),!1!==s.preload&&r(h),h}finally{o&&o()}}return fl(i)}function gk({repo:t,codecs:e,preload:n}){async function r(r,i={}){const{cid:s}=gl(r);return!1!==i.preload&&n(s),_l(t,e,r,i)}return fl(r)}class mk{constructor({repo:t,codecs:e,hashers:n,preload:r}){this.export=ek({repo:t,preload:r,codecs:e}),this.get=ik({codecs:e,repo:t,preload:r}),this.import=dk({repo:t}),this.resolve=gk({repo:t,codecs:e,preload:r}),this.put=pk({repo:t,codecs:e,hashers:n,preload:r})}}const yk=(t,e)=>e,wk=(t,e,n,r)=>{if(null!=r&&!1===r.assumeHttp)return`tcp://${t}:${e}`;let i="tcp",s=`:${e}`;const o=n[n.length-1];return"tcp"===o.protocol&&(i="443"===e?"https":"http",s="443"===e||"80"===e?"":s),`${i}://${t}${s}`},bk={ip4:yk,ip6:(t,e,n,r)=>1===r.length&&"ip6"===r[0].protocol?e:`[${e}]`,tcp:(t,e,n,r,i)=>r.some((t=>["http","https","ws","wss"].includes(t.protocol)))?`${t}:${e}`:wk(t,e,r,i),udp:(t,e)=>`udp://${t}:${e}`,dnsaddr:yk,dns4:yk,dns6:yk,ipfs:(t,e)=>`${t}/ipfs/${e}`,p2p:(t,e)=>`${t}/p2p/${e}`,http:t=>`http://${t}`,https:t=>`https://${t}`,ws:t=>`ws://${t}`,wss:t=>`wss://${t}`,"p2p-websocket-star":t=>`${t}/p2p-websocket-star`,"p2p-webrtc-star":t=>`${t}/p2p-webrtc-star`,"p2p-webrtc-direct":t=>`${t}/p2p-webrtc-direct`};function vk(t,e){const n=dc(t),r=n.toString().split("/").slice(1);return n.tuples().map((t=>({protocol:r.shift()??"",content:null!=t[1]?r.shift()??"":""}))).reduce(((t,n,r,i)=>{const s=bk[n.protocol];if(null==s)throw new Error(`Unsupported protocol ${n.protocol}`);return s(t,n.content,r,i,e)}),"")}function Ek(t){if(!Array.isArray(t))throw new TypeError("Expected an array, got "+typeof t);t=[...t];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}const _k=zt("ipfs:preload"),Sk=yu["default"]?yu["default"]:yu,Ak=new Sk({concurrency:4});function Ck(t,e={}){return _k(t),Ak.add((async()=>{const n=await wu.post(t,{signal:e.signal}),r=n.body.getReader();try{while(1){const{done:t}=await r.read();if(t)return}}finally{r.releaseLock()}}))}const Ik=zt("ipfs:preload");function Tk(t={}){if(t.enabled=Boolean(t.enabled),t.addresses=t.addresses||[],t.cache=t.cache||1e3,!t.enabled||!t.addresses.length){Ik("preload disabled");const t=()=>{};return Object.assign(t,{start:()=>{},stop:()=>{}})}let e=!0,n=[];const r=t.addresses.map((t=>vk(t))),i=Rl(t.cache),s=async t=>{try{if(e)throw new Error(`preload ${t} but preloader is not started`);const s=t.toString();if(i.has(s))return;i.set(s,!0);const o=Ek(r);let a=!1;const c=Date.now();for(const t of o){if(e)throw new Error(`preload aborted for ${s}`);let r;try{r=new AbortController,n=n.concat(r),await Ck(`${t}/api/v0/refs?r=true&arg=${encodeURIComponent(s)}`,{signal:r.signal}),a=!0}catch(uS){"aborted"!==uS.type&&Ik.error(uS)}finally{n=n.filter((t=>t!==r))}if(a)break}Ik(`${a?"":"un"}successfully preloaded ${s} in ${Date.now()-c}ms`)}catch(uS){Ik.error(uS)}};return s.start=()=>{e=!1},s.stop=()=>{e=!0,Ik(`aborting ${n.length} pending preload request(s)`),n.forEach((t=>t.abort())),n=[]},s}const kk=zt("ipfs:mfs-preload");function Rk({preload:t,files:e,options:n={}}){if(n.interval=n.interval||3e4,!n.enabled){kk("MFS preload disabled");const t=async()=>{};return{start:t,stop:t}}let r,i="";const s=async()=>{try{const n=await e.stat("/"),r=n.cid.toString();i!==r&&(kk(`preloading updated MFS root ${i} -> ${n.cid}`),await t(n.cid),i=r)}catch(uS){kk.error("failed to preload MFS root",uS)}finally{r=setTimeout(s,n.interval)}};return{async start(){const t=await e.stat("/");i=t.cid.toString(),kk(`monitoring MFS root ${t.cid}`),r=setTimeout(s,n.interval)},stop(){clearTimeout(r)}}}class Nk extends Error{constructor(t){super(t),this.name="TimeoutError"}}class Dk extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const Ok=t=>void 0===globalThis.DOMException?new Dk(t):new DOMException(t),Pk=t=>{const e=void 0===t.reason?Ok("This operation was aborted."):t.reason;return e instanceof Error?e:Ok(e)};function xk(t,e){const{milliseconds:n,fallback:r,message:i,customTimers:s={setTimeout:setTimeout,clearTimeout:clearTimeout}}=e;let o;const a=new Promise(((a,c)=>{if("number"!==typeof n||1!==Math.sign(n))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(n!==Number.POSITIVE_INFINITY){if(e.signal){const{signal:t}=e;t.aborted&&c(Pk(t)),t.addEventListener("abort",(()=>{c(Pk(t))}))}o=s.setTimeout.call(void 0,(()=>{if(r){try{a(r())}catch(o){c(o)}return}const e="string"===typeof i?i:`Promise timed out after ${n} milliseconds`,s=i instanceof Error?i:new Nk(e);"function"===typeof t.cancel&&t.cancel(),c(s)}),n),(async()=>{try{a(await t)}catch(e){c(e)}finally{s.clearTimeout.call(void 0,o)}})()}else a(t)}));return a.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},a}const Mk="lock:worker:request-read",Lk="lock:worker:release-read",Bk="lock:master:grant-read",Uk="lock:worker:request-write",Fk="lock:worker:release-write",zk="lock:master:grant-write",Vk={},jk=t=>{t.addEventListener("message",(e=>{jk.dispatchEvent("message",t,e)})),null!=t.port&&t.port.addEventListener("message",(e=>{jk.dispatchEvent("message",t,e)}))};jk.addEventListener=(t,e)=>{null==Vk[t]&&(Vk[t]=[]),Vk[t].push(e)},jk.removeEventListener=(t,e)=>{null!=Vk[t]&&(Vk[t]=Vk[t].filter((t=>t===e)))},jk.dispatchEvent=function(t,e,n){null!=Vk[t]&&Vk[t].forEach((t=>t(e,n)))};var Hk=jk;const $k=(t,e,n,r,i)=>(s,o)=>{if(o.data.type!==n)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};t.dispatchEvent(new MessageEvent(e,{data:{name:a.name,handler:async()=>(s.postMessage({type:i,name:a.name,identifier:a.identifier}),await new Promise((t=>{const e=n=>{if(null==n||null==n.data)return;const i={type:n.data.type,name:n.data.name,identifier:n.data.identifier};i.type===r&&i.identifier===a.identifier&&(s.removeEventListener("message",e),t())};s.addEventListener("message",e)})))}}))},Kk=(t,e,n,r)=>async()=>{const i=Zc();return globalThis.postMessage({type:e,identifier:i,name:t}),await new Promise((e=>{const s=o=>{if(null==o||null==o.data)return;const a={type:o.data.type,identifier:o.data.identifier};a.type===n&&a.identifier===i&&(globalThis.removeEventListener("message",s),e((()=>{globalThis.postMessage({type:r,identifier:i,name:t})})))};globalThis.addEventListener("message",s)}))},Gk={singleProcess:!1};var qk=t=>{t=Object.assign({},Gk,t);const e=Boolean(globalThis.document)||t.singleProcess;if(e){const t=new EventTarget;return Hk.addEventListener("message",$k(t,"requestReadLock",Mk,Lk,Bk)),Hk.addEventListener("message",$k(t,"requestWriteLock",Uk,Fk,zk)),t}return{isWorker:!0,readLock:t=>Kk(t,Mk,Bk,Lk),writeLock:t=>Kk(t,Uk,zk,Fk)}};const Wk={};let Yk;async function Xk(t,e){let n;const r=new Promise((t=>{n=t}));return t.add((async()=>await xk((async()=>await new Promise((t=>{n((()=>{t()}))})))(),{milliseconds:e.timeout}))),await r}const Qk=(t,e)=>{if(!0===Yk.isWorker)return{readLock:Yk.readLock(t,e),writeLock:Yk.writeLock(t,e)};const n=new yu({concurrency:1});let r;return{async readLock(){if(null!=r)return await Xk(r,e);r=new yu({concurrency:e.concurrency,autoStart:!1});const t=r,i=Xk(r,e);return n.add((async()=>(t.start(),await t.onIdle().then((()=>{r===t&&(r=null)}))))),await i},async writeLock(){return r=null,await Xk(n,e)}}},Jk={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function Zk(t){const e=Object.assign({},Jk,t);return null==Yk&&(Yk=qk(e),!0!==Yk.isWorker&&(Yk.addEventListener("requestReadLock",(t=>{null!=Wk[t.data.name]&&Wk[t.data.name].readLock().then((async e=>await t.data.handler().finally((()=>e()))))})),Yk.addEventListener("requestWriteLock",(async t=>{null!=Wk[t.data.name]&&Wk[t.data.name].writeLock().then((async e=>await t.data.handler().finally((()=>e()))))})))),null==Wk[e.name]&&(Wk[e.name]=Qk(e.name,e)),Wk[e.name]}let tR;function eR(t=!1){if(tR)return tR;const e=Zk({singleProcess:t});return tR={readLock:t=>async(...n)=>{const r=await e.readLock();try{return await t.apply(null,n)}finally{r()}},writeLock:t=>async(...n)=>{const r=await e.writeLock();try{return await t.apply(null,n)}finally{r()}}},tR}const nR=zt("ipfs:mfs:utils:with-mfs-root");async function rR(t,e){if(e&&e.signal&&e.signal.aborted)throw Vt(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});let n;await t.repo.datastore.open();try{const e=await t.repo.datastore.get(wl);n=Me.decode(e)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;nR("Creating new MFS root");const i=bn({Data:new ee({type:"directory"}).marshal(),Links:[]}),s=await ho.digest(i);if(n=Me.createV0(s),await t.repo.blocks.put(n,i),e&&e.signal&&e.signal.aborted)throw Vt(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await t.repo.datastore.put(wl,n.bytes)}return nR(`Loaded MFS root /ipfs/${n}`),n}function iR(t=""){return(t.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}const sR="ipfs",oR=async(t,e,n)=>{const r=await rR(t,n);let i={entryType:"file"},s="";if(s=Me.asCID(e)?`/ipfs/${e}`:e.toString(),s=s.trim(),s=s.replace(/(\/\/+)/g,"/"),s.endsWith("/")&&s.length>1&&(s=s.substring(0,s.length-1)),!s)throw Vt(new Error("paths must not be empty"),"ERR_NO_PATH");if("/"!==s.substring(0,1))throw Vt(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");"/"===s.substring(s.length-1)&&(s=s.substring(0,s.length-1));const o=iR(s);if(o[0]===sR){let t;t=2===o.length?`/${o.join("/")}`:`/${o.slice(0,o.length-1).join("/")}`,i={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:t,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{const t=`/${sR}/${r}${o.length?"/"+o.join("/"):""}`,e=`/${sR}/${r}/${o.slice(0,o.length-1).join("/")}`;i={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:e,mfsPath:t,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}const a="mfs"===i.type?i.mfsPath:i.path;try{const e=await lv(a,t.repo.blocks,n);i.cid=e.cid,i.mfsPath=`/ipfs/${e.path}`,i.entryType=e.type,i.content=e.content,"file"!==i.entryType&&"directory"!==i.entryType||"file"!==e.type&&"directory"!==e.type||(i.unixfs=e.unixfs)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}return i.exists=Boolean(i.cid),i},aR=nt.bind({ignoreUndefined:!0}),cR=zt("ipfs:mfs:stat"),lR={withLocal:!1};function uR(t){async function e(e,n={}){n=aR(lR,n),cR(`Fetching stats for ${e}`);const{type:r,cid:i,mfsPath:s}=await oR(t,e,n),o="ipfs"===r&&i?i:s;let a;try{a=await lv(o,t.repo.blocks)}catch(uS){if("ERR_NOT_FOUND"===uS.code)throw Vt(new Error(`${e} does not exist`),"ERR_NOT_FOUND");throw uS}if(!hR[a.type])throw new Error(`Cannot stat codec ${a.cid.code}`);return hR[a.type](a)}return fl(e)}const hR={raw:t=>({cid:t.cid,size:t.node.length,cumulativeSize:t.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:t=>{const e={cid:t.cid,type:"file",size:t.unixfs.fileSize(),cumulativeSize:bn(t.node).length+(t.node.Links||[]).reduce(((t,e)=>t+(e.Tsize||0)),0),blocks:t.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:t.unixfs.mode};return t.unixfs.mtime&&(e.mtime=t.unixfs.mtime),e},directory:t=>{const e={cid:t.cid,type:"directory",size:0,cumulativeSize:bn(t.node).length+(t.node.Links||[]).reduce(((t,e)=>t+(e.Tsize||0)),0),blocks:t.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:t.unixfs.mode};return t.unixfs.mtime&&(e.mtime=t.unixfs.mtime),e},object:t=>({cid:t.cid,size:t.node.length,cumulativeSize:t.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:t=>({cid:t.cid,size:t.node.length,cumulativeSize:t.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})},dR=zt("ipfs:mfs:utils:to-trail");async function fR(t,e){dR(`Creating trail for path ${e}`);const n=[];for await(const r of cv(e,t.repo.blocks))n.push({name:r.name,cid:r.cid,size:r.size,type:r.type});return n}const pR=async(t,e,n)=>{n.codec||(n.codec=o),n.hasher||(n.hasher=ho),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===o&&n.hasher!==ho&&(n.cidVersion=1);const r=await n.hasher.digest(t),i=Me.create(n.cidVersion,n.codec.code,r);return n.onlyHash||await e.put(i,t,{signal:n.signal}),i},gR=Jy.code,mR=8;async function yR(t){return(await Jy.encode(t)).subarray(0,8).reverse()}class wR{constructor(t,e){this.options=e||{},this.root=t.root,this.dir=t.dir,this.path=t.path,this.dirty=t.dirty,this.flat=t.flat,this.parent=t.parent,this.parentKey=t.parentKey,this.unixfs=t.unixfs,this.mode=t.mode,this.mtime=t.mtime,this.cid=void 0,this.size=void 0}async put(t,e){}get(t){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(t){}}class bR extends wR{constructor(t,e){super(t,e),this._bucket=nb({hashFn:yR,bits:mR})}async put(t,e){await this._bucket.put(t,e)}get(t){return this._bucket.get(t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:t,value:e}of this._bucket.eachLeafSeries())yield{key:t,child:e}}async*flush(t){yield*vR(this._bucket,t,this,this.options)}}async function*vR(t,e,n,r){const i=t._children,s=[];let o=0;for(let f=0;f<i.length;f++){const t=i.get(f);if(!t)continue;const n=f.toString(16).toUpperCase().padStart(2,"0");if(t instanceof $w){let i;for await(const n of await vR(t,e,null,r))i=n;if(!i)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:n,Tsize:i.size,Hash:i.cid}),o+=i.size}else if("function"===typeof t.value.flush){const r=t.value;let i;for await(const t of r.flush(e))i=t,yield i;const a=n+t.key;s.push({Name:a,Tsize:i.size,Hash:i.cid}),o+=i.size}else{const e=t.value;if(!e.cid)continue;const r=n+t.key,i=e.size;s.push({Name:r,Tsize:i,Hash:e.cid}),o+=i}}const a=Uint8Array.from(i.bitField().reverse()),c=new ee({type:"hamt-sharded-directory",data:a,fanout:t.tableSize(),hashType:gR,mtime:n&&n.mtime,mode:n&&n.mode}),l={Data:c.marshal(),Links:s},u=bn(fn(l)),h=await pR(u,e,r),d=u.length+o;yield{cid:h,node:l,size:d}}const ER=zt("ipfs:mfs:core:utils:hamt-utils"),_R=async(t,e,n,r)=>{if(!r.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");const i=Uint8Array.from(n._children.bitField().reverse()),s=ee.unmarshal(r.parent.Data),o=new ee({type:"hamt-sharded-directory",data:i,fanout:n.tableSize(),hashType:gR,mode:s.mode,mtime:s.mtime}),a=await t.hashers.getHasher(r.hashAlg),c={Data:o.marshal(),Links:e.sort(((t,e)=>(t.Name||"").localeCompare(e.Name||"")))},l=bn(c),u=await a.digest(l),h=Me.create(r.cidVersion,wn,u);return r.flush&&await t.repo.blocks.put(h,l),{node:c,cid:h,size:e.reduce(((t,e)=>t+(e.Tsize||0)),l.length)}},SR=async(t,e,n,r,i)=>{const s=new $w({hash:n._options.hash,bits:n._options.bits},r,i);return r._putObjectAt(i,s),await CR(t,e,s,n),s},AR=async t=>{const e=nb({hashFn:yR,bits:mR});return await Promise.all(t.map((async t=>{const n=t.Name||"";if(2===n.length){const t=parseInt(n,16),r=new $w({hash:e._options.hash,bits:e._options.bits},e,t);return e._putObjectAt(t,r),Promise.resolve()}return e.put(n.substring(2),{size:t.Tsize,cid:t.Hash})}))),e},CR=async(t,e,n,r)=>{await Promise.all(e.map((async e=>{const i=e.Name||"";if(2===i.length){ER("Populating sub bucket",i);const s=parseInt(i,16),o=await t.repo.blocks.get(e.Hash),a=vn(o),c=new $w({hash:r._options.hash,bits:r._options.bits},n,s);return n._putObjectAt(s,c),await CR(t,a.Links,c,r),Promise.resolve()}return r.put(i.substring(2),{size:e.Tsize,cid:e.Hash})})))},IR=t=>t.toString(16).toUpperCase().padStart(2,"0").substring(0,2),TR=async(t,e,n)=>{const r=await AR(n.Links),i=await r._findNewBucketAndPos(e),s=[{bucket:i.bucket,prefix:IR(i.pos)}];let o=i.bucket;while(o!==r)s.push({bucket:o,prefix:IR(o._posAtParent)}),o=o._parent;s.reverse(),s[0].node=n;for(let a=0;a<s.length;a++){const n=s[a];if(!n.node)throw new Error("Could not generate HAMT path");const i=n.node.Links.filter((t=>(t.Name||"").substring(0,2)===n.prefix)).pop();if(!i){ER(`Link ${n.prefix}${e} will be added`);continue}if(i.Name===`${n.prefix}${e}`){ER(`Link ${n.prefix}${e} will be replaced`);continue}ER(`Found subshard ${n.prefix}`);const o=await t.repo.blocks.get(i.Hash),c=vn(o);if(!s[a+1]){ER(`Loaded new subshard ${n.prefix}`),await SR(t,c.Links,r,n.bucket,parseInt(n.prefix,16));const i=await r._findNewBucketAndPos(e);s.push({bucket:i.bucket,prefix:IR(i.pos),node:c});continue}const l=s[a+1];await CR(t,c.Links,l.bucket,r),l.node=c}return await r.put(e,!0),s.reverse(),{rootBucket:r,path:s}},kR=async(t,e,n={})=>{const r=new bR({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:n.mtime,mode:n.mode},n);for(let s=0;s<e.length;s++)await r._bucket.put(e[s].name,{size:e[s].size,cid:e[s].cid});const i=await Gu(r.flush(t.repo.blocks));if(!i)throw new Error("Flushing shard yielded no result");return i},RR=zt("ipfs:mfs:core:utils:add-link");async function NR(t,e){let n=e.parent;if(e.parentCid){const r=Me.asCID(e.parentCid);if(null===r)throw Vt(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(r.code!==wn)throw Vt(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");RR(`Loading parent node ${r}`);const i=await t.repo.blocks.get(r);n=vn(i)}if(!n)throw Vt(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!e.cid)throw Vt(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!e.name)throw Vt(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!e.size&&0!==e.size)throw Vt(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!n.Data)throw Vt(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");const r=ee.unmarshal(n.Data);return"hamt-sharded-directory"===r.type?(RR("Adding link to sharded directory"),PR(t,{...e,parent:n})):n.Links.length>=e.shardSplitThreshold?(RR("Converting directory to sharded directory"),DR(t,{...e,parent:n,mtime:r.mtime,mode:r.mode})):(RR(`Adding ${e.name} (${e.cid}) to regular directory`),OR(t,{...e,parent:n}))}const DR=async(t,e)=>{const n=await kR(t,e.parent.Links.map((t=>({name:t.Name||"",size:t.Tsize||0,cid:t.Hash}))).concat({name:e.name,size:e.size,cid:e.cid}),e);return RR(`Converted directory to sharded directory ${n.cid}`),n},OR=async(t,e)=>{const n=e.parent.Links.filter((t=>t.Name!==e.name));if(n.push({Name:e.name,Tsize:e.size,Hash:e.cid}),!e.parent.Data)throw Vt(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");const r=ee.unmarshal(e.parent.Data);let i;if(r.mtime){const t=Date.now(),e=Math.floor(t/1e3);r.mtime={secs:e,nsecs:1e3*(t-1e3*e)},i=r.marshal()}else i=e.parent.Data;e.parent=fn({Data:i,Links:n});const s=await t.hashers.getHasher(e.hashAlg),o=bn(e.parent),a=await s.digest(o),c=Me.create(e.cidVersion,wn,a);return e.flush&&await t.repo.blocks.put(c,o),{node:e.parent,cid:c,size:o.length}},PR=async(t,e)=>{const{shard:n,path:r}=await xR(t,e),i=await Gu(n.flush(t.repo.blocks));if(!i)throw new Error("No result from flushing shard");const s=await t.repo.blocks.get(i.cid),o=vn(s),a=e.parent.Links.filter((t=>(t.Name||"").substring(0,2)!==r[0].prefix)),c=o.Links.find((t=>(t.Name||"").substring(0,2)===r[0].prefix));if(!c)throw new Error(`No link found with prefix ${r[0].prefix}`);return a.push(c),_R(t,a,r[0].bucket,e)},xR=async(t,e)=>{const n={name:e.name,cid:e.cid,size:e.size};if(!e.parent.Data)throw Vt(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");const r=await AR(e.parent.Links),i=ee.unmarshal(e.parent.Data),s=new bR({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:i.mode},e);s._bucket=r,i.mtime&&(s.mtime={secs:Math.round(Date.now()/1e3)});const o=await r._findNewBucketAndPos(n.name),a=MR(o);a[0].node=e.parent;let c=0;while(c<a.length){const e=a[c];c++;const i=e.node;if(!i)throw new Error("Segment had no node");const s=i.Links.find((t=>(t.Name||"").substring(0,2)===e.prefix));if(!s){RR(`Link ${e.prefix}${n.name} will be added`),c=a.length;break}if(s.Name===`${e.prefix}${n.name}`){RR(`Link ${e.prefix}${n.name} will be replaced`),c=a.length;break}if((s.Name||"").length>2){RR(`Link ${s.Name} ${s.Hash} will be replaced with a subshard`),c=a.length;break}RR(`Found subshard ${e.prefix}`);const o=await t.repo.blocks.get(s.Hash),l=vn(o);if(!a[c]){RR(`Loaded new subshard ${e.prefix}`),await SR(t,l.Links,r,e.bucket,parseInt(e.prefix,16));const i=await r._findNewBucketAndPos(n.name);a.push({bucket:i.bucket,prefix:IR(i.pos),node:l});break}const u=a[c];await CR(t,l.Links,u.bucket,r),u.node=l}return await s._bucket.put(n.name,{size:n.size,cid:n.cid}),{shard:s,path:a}},MR=t=>{const e=[{bucket:t.bucket,prefix:IR(t.pos)}];let n=t.bucket._parent,r=t.bucket._posAtParent;while(n)e.push({bucket:n,prefix:IR(r)}),r=n._posAtParent,n=n._parent;return e.reverse(),e},LR=zt("ipfs:mfs:utils:update-tree"),BR={shardSplitThreshold:1e3};async function UR(t,e,n){n=Object.assign({},BR,n),LR("Trail",e),e=e.slice().reverse();let r,i=0;for await(const o of t.repo.blocks.getMany(e.map((t=>t.cid)))){const s=vn(o),a=e[i].cid,c=e[i].name;if(i++,!r){r={cid:a,name:c,size:o.length};continue}const l=await NR(t,{parent:s,name:r.name,cid:r.cid,size:r.size,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold,hashAlg:n.hashAlg,cidVersion:n.cidVersion});r={cid:l.cid,name:c,size:l.size}}const{cid:s}=r;return LR(`Final CID ${s}`),s}const FR=zt("ipfs:mfs:utils:update-mfs-root");async function zR(t,e,n){if(n&&n.signal&&n.signal.aborted)throw Vt(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return FR(`New MFS root will be ${e}`),await t.repo.datastore.put(wl,e.bytes),e}async function VR(t,e,n){const r=new ee({type:e,mode:n.mode,mtime:n.mtime}),i=await t.hashers.getHasher(n.hashAlg),s={Data:r.marshal(),Links:[]},o=bn(s),a=await i.digest(o),c=Me.create(n.cidVersion,wn,a);return n.flush&&await t.repo.blocks.put(c,o),{cid:c,node:s}}const jR=nt.bind({ignoreUndefined:!0}),HR=zt("ipfs:mfs:mkdir"),$R={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function KR(t){async function e(e,n={}){const r=jR($R,n);if(!e)throw new Error("no path given to Mkdir");if(e=e.trim(),"/"===e){if(r.parents)return;throw Vt(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if("/"!==e.substring(0,1))throw Vt(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");HR(`Creating ${e}`);const i=iR(e);if("ipfs"===i[0])throw Vt(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");const s=await rR(t,r);let o;const a=[],c=await VR(t,"directory",r);for(let u=0;u<=i.length;u++){const n=i.slice(0,u),l=`/ipfs/${s}/${n.join("/")}`;try{if(o=await lv(l,t.repo.blocks),"file"!==o.type&&"directory"!==o.type)throw Vt(new Error(`${e} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(u===i.length){if(r.parents)return;throw Vt(new Error("file already exists"),"ERR_ALREADY_EXISTS")}a.push({name:o.name,cid:o.cid})}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;if(u<i.length&&!r.parents)throw Vt(new Error(`Intermediate directory path ${l} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await GR(t,n[n.length-1],c,a[a.length-1],a,r)}}const l=await UR(t,a,r);await zR(t,l,r)}return fl(e)}const GR=async(t,e,n,r,i,s)=>{HR(`Adding empty dir called ${e} to ${r.cid}`);const o=await NR(t,{parent:r.node,parentCid:r.cid,size:0,cid:n.cid,name:e,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});i[i.length-1].cid=o.cid,i.push({name:e,cid:n.cid})},qR=nt.bind({ignoreUndefined:!0}),WR=zt("ipfs:mfs:cp"),YR={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function XR(t){async function e(e,n,r={}){const i=qR(YR,r);Array.isArray(e)||(e=[e]);const s=await Promise.all(e.map((e=>oR(t,e,i))));let o=await oR(t,n,i);if(!s.length||!o)throw Vt(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");const a=s.find((t=>!t.exists));if(a)throw Vt(new Error(`${a.path} does not exist`),"ERR_INVALID_PARAMS");const c=QR(o);if(o.exists){if(WR("Destination exists"),1===s.length&&!c)throw Vt(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(WR("Destination does not exist"),s.length>1){if(!i.parents)throw Vt(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await KR(t)(o.path,i),o=await oR(t,o.path,i)}else if(o.parts.length>1){const e=`/${o.parts.slice(0,-1).join("/")}`;try{await uR(t)(e,i)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;if(!i.parents)throw Vt(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await KR(t)(e,i),o=await oR(t,o.path,i)}}const l=QR(o)?o.mfsPath:o.mfsDirectory,u=await fR(t,l);if(1===s.length){const e=s.pop();if(!e)throw Vt(new Error("could not find source"),"ERR_INVALID_PARAMS");const n=c?e.name:o.name;return WR(`Only one source, copying to destination ${c?"directory":"file"} ${n}`),JR(t,e,n,u,i)}return WR("Multiple sources, wrapping in a directory"),ZR(t,s,o,u,i)}return fl(e)}const QR=t=>t.unixfs&&t.unixfs.type&&t.unixfs.type.includes("directory"),JR=async(t,e,n,r,i)=>{let s=r.pop();if(!s)throw Vt(new Error("destination had no parent"),"ERR_INVALID_PARAMS");s=await tN(t,e,n,s,i),r.push(s);const o=await UR(t,r,i);await zR(t,o,i)},ZR=async(t,e,n,r,i)=>{for(let o=0;o<e.length;o++){const r=e[o];n=await tN(t,r,r.name,n,i)}r[r.length-1]=n;const s=await UR(t,r,i);await zR(t,s,i)},tN=async(t,e,n,r,i)=>{const s=await t.repo.blocks.get(e.cid),{node:o,cid:a,size:c}=await NR(t,{parentCid:r.cid,size:s.length,cid:e.cid,name:n,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});return r.node=o,r.cid=a,r.size=c,r},eN=zt("ipfs:mfs:core:utils:remove-link");async function nN(t,e){let n=e.parent;if(e.parentCid){const r=Me.asCID(e.parentCid);if(null===r)throw Vt(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");eN(`Loading parent node ${r}`);const i=await t.repo.blocks.get(r);n=vn(i)}if(!n)throw Vt(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!e.name)throw Vt(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!n.Data)throw Vt(new Error("Parent node had no data"),"ERR_INVALID_NODE");const r=ee.unmarshal(n.Data);return"hamt-sharded-directory"===r.type?(eN(`Removing ${e.name} from sharded directory`),iN(t,{...e,parent:n})):(eN(`Removing link ${e.name} regular directory`),rN(t,{...e,parent:n}))}const rN=async(t,e)=>{e.parent.Links=e.parent.Links.filter((t=>t.Name!==e.name));const n=await bn(e.parent),r=await t.hashers.getHasher(e.hashAlg),i=await r.digest(n),s=Me.create(e.cidVersion,wn,i);return await t.repo.blocks.put(s,n),eN(`Updated regular directory ${s}`),{node:e.parent,cid:s}},iN=async(t,e)=>{const{rootBucket:n,path:r}=await TR(t,e.name,e.parent);await n.del(e.name);const{node:i}=await sN(t,r,e.name,e);return _R(t,i.Links,n,e)},sN=async(t,e,n,r)=>{const i=e.pop();if(!i)throw Vt(new Error("Could not find parent"),"EINVALIDPARENT");const{bucket:s,prefix:o,node:a}=i;if(!a)throw Vt(new Error("Could not find parent"),"EINVALIDPARENT");const c=a.Links.find((t=>(t.Name||"").substring(0,2)===o));if(!c)throw Vt(new Error(`No link found with prefix ${o} for file ${n}`),"ERR_NOT_FOUND");if(c.Name===`${o}${n}`){eN(`Removing existing link ${c.Name}`);const e=a.Links.filter((t=>t.Name!==c.Name));return await s.del(n),_R(t,e,s,r)}eN(`Descending into sub-shard ${c.Name} for ${o}${n}`);const l=await sN(t,e,n,r);let u=l.cid,h=l.size,d=o;if(1===l.node.Links.length){eN(`Removing subshard for ${o}`);const t=l.node.Links[0];d=`${o}${(t.Name||"").substring(2)}`,u=t.Hash,h=t.Tsize||0}return eN(`Updating shard ${o} with name ${d}`),oN(t,s,a,o,d,h,u,r)},oN=(t,e,n,r,i,s,o,a)=>{const c=n.Links.filter((t=>t.Name!==r));return c.push({Name:i,Tsize:s,Hash:o}),_R(t,c,e,a)},aN=nt.bind({ignoreUndefined:!0}),cN={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function lN(t){async function e(e,n={}){const r=aN(cN,n);Array.isArray(e)||(e=[e]);const i=await Promise.all(e.map((e=>oR(t,e,r))));if(!i.length)throw Vt(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");i.forEach((t=>{if("/"===t.path)throw Vt(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")}));for(const s of i)await uN(t,s.path,r)}return fl(e)}const uN=async(t,e,n)=>{const r=await oR(t,e,n),i=await fR(t,r.mfsPath),s=i[i.length-1];i.pop();const o=i[i.length-1];if(!o)throw Vt(new Error(`${e} does not exist`),"ERR_NOT_FOUND");if("directory"===s.type&&!n.recursive)throw Vt(new Error(`${e} is a directory, use -r to remove directories`),"ERR_WAS_DIR");const{cid:a}=await nN(t,{parentCid:o.cid,name:s.name,hashAlg:n.hashAlg,cidVersion:n.cidVersion,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold});o.cid=a;const c=await UR(t,i,n);await zR(t,c,n)},hN=nt.bind({ignoreUndefined:!0}),dN=zt("ipfs:mfs:touch"),fN={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function pN(t,e,n){let r=0;return(t.includes("x")||t.includes("X")&&(n||1&e||8&e||64&e))&&(r+=1),t.includes("w")&&(r+=2),t.includes("r")&&(r+=4),r}function gN(t,e){let n=0;return t.includes("u")&&(n+=e<<6),t.includes("g")&&(n+=e<<3),t.includes("o")&&(n+=e),n}function mN(t,e,n){return e.includes("t")&&(n+=parseInt("1000",8)),e.includes("s")&&(t.includes("u")&&(n+=parseInt("4000",8)),t.includes("g")&&(n+=parseInt("2000",8))),n}function yN(t,e,n){e||(e=0);const r=t.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!r)throw new Error(`Invalid file mode: ${t}`);let[,i,s,o]=r;"a"!==i&&i||(i="ugo");let a=pN(o,e,n);return a=gN(i,a),a=mN(i,o,a),"="===s?(i.includes("u")&&(e&=parseInt("7077",8),e|=a),i.includes("g")&&(e&=parseInt("7707",8),e|=a),i.includes("o")&&(e&=parseInt("7770",8),e|=a),e):"+"===s?a|e:"-"===s?a^e:e}function wN(t,e){if(t instanceof String||"string"===typeof t){const n=`${t}`;t=n.match(/^\d+$/g)?parseInt(n,8):0+n.split(",").reduce(((t,n)=>yN(n,t,e.isDirectory())),e.mode||0)}return t}function bN(t){async function e(e,n,r={}){const i=hN(fN,r);dN(`Fetching stats for ${e}`);const{cid:s,mfsDirectory:o,name:a}=await oR(t,e,i);if(s.code!==wn)throw Vt(new Error(`${e} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(i.recursive){const r=await vm((async function*(){for await(const r of uv(s,t.repo.blocks)){if("file"!==r.type&&"directory"!==r.type)throw Vt(new Error(`${e} was not a UnixFS node`),"ERR_NOT_UNIXFS");r.unixfs.mode=wN(n,r.unixfs);const t=fn({Data:r.unixfs.marshal(),Links:r.node.Links});yield{path:r.path,content:t}}}),(e=>gb(e,t.repo.blocks,{...i,pin:!1,dagBuilder:async function*(t,e,n){for await(const r of t)yield async function(){const t=r.content,i=bn(t),s=await pR(i,e,n);if(!t.Data)throw Vt(new Error(`${s} had no data`),"ERR_INVALID_NODE");const o=ee.unmarshal(t.Data);return{cid:s,size:i.length,path:r.path,unixfs:o}}}})),(t=>Gu(t)));if(!r)throw Vt(new Error(`Could not chmod ${e}`),"ERR_COULD_NOT_CHMOD");return await lN(t)(e,i),void await XR(t)(`/ipfs/${r.cid}`,e,i)}const c=await t.repo.blocks.get(s),l=vn(c);if(!l.Data)throw Vt(new Error(`${s} had no data`),"ERR_INVALID_NODE");const u=ee.unmarshal(l.Data);u.mode=wN(n,u);const h=bn({Data:u.marshal(),Links:l.Links}),d=i.hashAlg||fN.hashAlg,f=await t.hashers.getHasher(d),p=await f.digest(h),g=Me.create(i.cidVersion,wn,p);i.flush&&await t.repo.blocks.put(g,h);const m=await fR(t,o),y=m[m.length-1],w=Me.decode(y.cid.bytes),b=await t.repo.blocks.get(w),v=vn(b),E=await NR(t,{parent:v,name:a,cid:g,size:h.length,flush:i.flush,hashAlg:d,cidVersion:s.version,shardSplitThreshold:1/0});y.cid=E.cid;const _=await UR(t,m,i);await zR(t,_,i)}return fl(e)}const vN=nt.bind({ignoreUndefined:!0}),EN={};function _N(t){async function e(e,n={}){n=vN(EN,n);const{cid:r}=await uR(t)(e,n);return r}return fl(e)}const SN=nt.bind({ignoreUndefined:!0}),AN={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};function CN(t){async function e(e,n,r={}){const i=SN(AN,r);await XR(t)(e,n,i),await lN(t)(e,{...i,recursive:!0})}return fl(e)}const IN=nt.bind({ignoreUndefined:!0}),TN=zt("ipfs:mfs:touch"),kN={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};function RN(t){async function e(e,n={}){const r=IN(kN,n);r.mtime=r.mtime||new Date,TN(`Touching ${e} mtime: ${r.mtime}`);const{cid:i,mfsDirectory:s,name:o,exists:a}=await oR(t,e,r),c=n.hashAlg||kN.hashAlg,l=await t.hashers.getHasher(c);let u,h,d=r.cidVersion;if(a){if(i.code!==wn)throw Vt(new Error(`${e} was not a UnixFS node`),"ERR_NOT_UNIXFS");d=i.version;const n=await t.repo.blocks.get(i),s=vn(n);if(!s.Data)throw Vt(new Error(`${e} had no data`),"ERR_INVALID_NODE");const o=ee.unmarshal(s.Data);o.mtime=r.mtime,u=bn({Data:o.marshal(),Links:s.Links});const a=await l.digest(u);h=Me.create(r.cidVersion,wn,a),r.flush&&await t.repo.blocks.put(h,u)}else{const e=new ee({type:"file",mtime:r.mtime});u=bn({Data:e.marshal(),Links:[]});const n=await l.digest(u);h=Me.create(r.cidVersion,wn,n),r.flush&&await t.repo.blocks.put(h,u)}const f=await fR(t,s),p=f[f.length-1],g=p.cid,m=await t.repo.blocks.get(g),y=vn(m),w=await NR(t,{parent:y,name:o,cid:h,size:u.length,flush:r.flush,shardSplitThreshold:r.shardSplitThreshold,hashAlg:r.hashAlg,cidVersion:d});p.cid=w.cid;const b=await UR(t,f,r);await zR(t,b,r)}return fl(e)}const NN=nt.bind({ignoreUndefined:!0}),DN={offset:0,length:1/0};function ON(t){function e(e,n={}){return n=NN(DN,n),{[Symbol.asyncIterator]:async function*(){const r=await oR(t,e,n),i=await lv(r.mfsPath,t.repo.blocks);if("file"!==i.type)throw Vt(new Error(`${e} was not a file`),"ERR_NOT_FILE");if(!i.content)throw Vt(new Error(`Could not load content stream from ${e}`),"ERR_NO_CONTENT");for await(const t of i.content({offset:n.offset,length:n.length}))yield t}}}return fl(e)}const PN=zt("ipfs:mfs:utils:to-async-iterator");function xN(t){if(!t)throw Vt(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if(("string"===typeof t||t instanceof String)&&(PN("Content was a string"),t=Ho(t.toString())),t.length)return PN("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield t}};if(t[Symbol.asyncIterator])return PN("Content was an async iterator"),t;if(t[Symbol.iterator])return PN("Content was an iterator"),t;if(global.Blob&&t instanceof global.Blob){PN("Content was an HTML5 Blob");let e=0;const n={next:()=>e>t.size?{done:!0}:new Promise(((n,r)=>{const i=t.slice(e,bl);e+=bl;const s=new global.FileReader,o=t=>{if(s.removeEventListener("loadend",o,!1),t.error)return r(t.error);n({done:!1,value:new Uint8Array(s.result)})};s.addEventListener("loadend",o),s.readAsArrayBuffer(i)}))};return{[Symbol.asyncIterator]:()=>n}}throw Vt(new Error(`Don't know how to convert ${t} into an async iterator`),"ERR_INVALID_PARAMS")}const MN=nt.bind({ignoreUndefined:!0}),LN=zt("ipfs:mfs:write"),BN={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(t,e)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};function UN(t){async function e(e,n,r={}){const i=MN(BN,r);let s,o,a;if(LN("Reading source, destination and parent"),await eR().readLock((async()=>{s=await xN(n),o=await oR(t,e,i),a=await oR(t,o.mfsDirectory,i)}))(),LN("Read source, destination and parent"),!i.parents&&!a.exists)throw Vt(new Error("directory does not exist"),"ERR_NO_EXIST");if(null==s)throw Vt(new Error("could not create source"),"ERR_NO_SOURCE");if(null==o)throw Vt(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!i.create&&!o.exists)throw Vt(new Error("file does not exist"),"ERR_NO_EXIST");if("file"!==o.entryType)throw Vt(new Error("not a file"),"ERR_NOT_A_FILE");return FN(t,e,s,o,i)}return fl(e)}const FN=async(t,e,n,r,i)=>{const s=await zN(t,n,r,i);await eR().writeLock((async()=>{const n=iR(e),r=n.pop();if(null==r)throw Vt(new Error("source does not exist"),"ERR_NO_EXIST");let o=!1;try{await uR(t)(`/${n.join("/")}`,i),o=!0}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}o||await KR(t)(`/${n.join("/")}`,i);const a=await oR(t,e,i),c=await fR(t,a.mfsDirectory),l=c[c.length-1];if(!l)throw Vt(new Error("directory does not exist"),"ERR_NO_EXIST");if(!l.type||!l.type.includes("directory"))throw Vt(new Error(`cannot write to ${l.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");const u=await t.repo.blocks.get(l.cid),h=vn(u),d=await NR(t,{parent:h,name:r,cid:s.cid,size:s.size,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold,hashAlg:i.hashAlg,cidVersion:i.cidVersion});l.cid=d.cid;const f=await UR(t,c,i);await zR(t,f,i)}))()},zN=async(t,e,n,r)=>{n.exists?LN(`Overwriting file ${n.cid} offset ${r.offset} length ${r.length}`):LN(`Writing file offset ${r.offset} length ${r.length}`);const i=[];if(r.offset>0)if(n.unixfs){if(LN(`Writing first ${r.offset} bytes of original file`),i.push((()=>n.content({offset:0,length:r.offset}))),n.unixfs.fileSize()<r.offset){const t=r.offset-n.unixfs.fileSize();LN(`Writing zeros for extra ${t} bytes`),i.push(jN(t))}}else LN(`Writing zeros for first ${r.offset} bytes`),i.push(jN(r.offset));i.push(VN(e,r.length));const s=$N(HN(i),(t=>{if(n.unixfs&&!r.truncate){const e=n.unixfs.fileSize();if(e>t)return LN(`Writing last ${e-t} of ${e} bytes from original file starting at offset ${t}`),n.content({offset:t});LN("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}));let o,a;void 0!==r.mode&&null!==r.mode?o=Zt(r.mode):n&&n.unixfs&&(o=n.unixfs.mode),null!=r.mtime?a=te(r.mtime):n&&n.unixfs&&(a=n.unixfs.mtime);const c=await t.hashers.getHasher(r.hashAlg),l=await Gu(gb([{content:s,mode:o,mtime:a}],t.repo.blocks,{progress:r.progress,hasher:c,cidVersion:r.cidVersion,strategy:r.strategy,rawLeaves:r.rawLeaves,reduceSingleLeafToSelf:r.reduceSingleLeafToSelf,leafType:r.leafType}));if(!l)throw Vt(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return LN(`Wrote ${l.cid}`),{cid:l.cid,size:l.size}},VN=(t,e)=>async function*(){let n=0;for await(const r of t){if(n+=r.length,n>e)return void(yield r.subarray(0,e-n));yield r}},jN=(t,e=bl)=>{const n=new Uint8Array(e);async function*r(){while(1)yield n}return VN(r(),t)},HN=async function*(t){for(let e=0;e<t.length;e++)yield*t[e]()},$N=async function*(t,e){let n=0;for await(const r of t)n+=r.length,yield r;for await(const r of e(n))n+=r.length,yield r},KN=t=>{const e={cid:t.cid,name:t.name,type:"directory"===t.type?"directory":"file",size:t.size};return"file"!==t.type&&"directory"!==t.type||(e.mode=t.unixfs.mode,e.mtime=t.unixfs.mtime),e};function GN(t){async function*e(e,n={}){const r=await oR(t,e,n),i=await lv(r.mfsPath,t.repo.blocks);"directory"!==i.type?yield KN(i):yield*ky(i.content(n),KN)}return fl(e)}const qN={stat:uR},WN={chmod:bN,cp:XR,flush:_N,mkdir:KR,mv:CN,rm:lN,touch:RN},YN={write:UN,read:ON,ls:GN},XN=({options:t,mfs:e,operations:n,lock:r})=>{Object.keys(n).forEach((i=>{e[i]=r(n[i](t))}))},QN={repoOwner:!0,repo:null};function JN(t){const{repoOwner:e}=Object.assign({},QN||{},t),n=eR(e),r=t=>n.readLock(t),i=t=>n.writeLock(t),s={};return XN({options:t,mfs:s,operations:qN,lock:r}),XN({options:t,mfs:s,operations:WN,lock:i}),Object.keys(YN).forEach((e=>{s[e]=YN[e](t)})),s}function ZN({repo:t,preload:e,hashers:n,options:r}){const i=JN({repo:t,repoOwner:!1!==r.repoOwner,hashers:n}),s=t=>{const n=(...n)=>{const r=n.filter((t=>Qc(t)||Kc(t)));if(r.length){const t=n[n.length-1];t&&!1!==t.preload&&r.forEach((t=>e(t)))}return t(...n)};return n};return{...i,chmod:i.chmod,cp:s(i.cp),mkdir:i.mkdir,stat:s(i.stat),rm:i.rm,read:s(i.read),touch:i.touch,write:i.write,mv:s(i.mv),flush:i.flush,ls:s((async function*(...t){for await(const e of i.ls(...t))yield{...e,size:e.size||0}}))}}function tD({keychain:t}){const e=(e,n)=>t.exportKey(e,n);return fl(e)}const eD="Ed25519",nD=2048;function rD({keychain:t}){const e=(e,n={type:eD,size:nD})=>t.createKey(e,n.type||eD,n.size||nD);return fl(e)}function iD({keychain:t}){const e=(e,n,r)=>t.importKey(e,n,r);return fl(e)}function sD({keychain:t}){const e=e=>t.findKeyByName(e);return fl(e)}function oD({keychain:t}){const e=()=>t.listKeys();return fl(e)}function aD({keychain:t}){const e=async(e,n)=>{const r=await t.renameKey(e,n);return{was:e,now:r.name,id:r.id,overwrite:!1}};return fl(e)}function cD({keychain:t}){const e=e=>t.removeKey(e);return fl(e)}class lD{constructor({keychain:t}){this.gen=rD({keychain:t}),this.list=oD({keychain:t}),this.rm=cD({keychain:t}),this.rename=aD({keychain:t}),this.export=tD({keychain:t}),this.import=iD({keychain:t}),this.info=sD({keychain:t})}}function uD({repo:t,preload:e}){async function n(n,r={}){!1!==r.preload&&e(n);const i=await t.blocks.get(n,r);return vn(i)}return fl(n)}function hD({repo:t,preload:e}){const n=uD({repo:t,preload:e});async function r(t,e={}){const r=await n(t,e);return r.Data||new Uint8Array(0)}return fl(r)}function dD(t,e=[]){for(const r in t){const i=t[r];if("/"===r&&1===Object.keys(t).length)try{e.push({Name:"",Tsize:0,Hash:Me.parse(i)});continue}catch(n){}const s=Me.asCID(i);s?e.push({Name:"",Tsize:0,Hash:s}):(Array.isArray(i)&&dD(i,e),i&&"object"===typeof i&&dD(i,e))}return e}function fD({repo:t,codecs:e}){async function n(n,r={}){const i=await e.getCodec(n.code),s=await t.blocks.get(n,r),o=i.decode(s);switch(n.code){case go:return[];case wn:return o.Links;case Ji:case ys:return dD(o);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}return fl(n)}function pD({repo:t,preload:e}){async function n(n={}){let r;if(n.template){if("unixfs-dir"!==n.template)throw new Error("unknown template");r=new ee({type:"directory"}).marshal()}const i=bn({Data:r,Links:[]}),s=await ho.digest(i),o=Me.createV0(s);return await t.blocks.put(o,i,{signal:n.signal}),!1!==n.preload&&e(o),o}return fl(n)}function gD({repo:t,preload:e}){async function n(n,r={}){const i=await t.gcLock.readLock();try{const i=bn(n),s=await ho.digest(i),o=Me.createV1(wn,s);return await t.blocks.put(o,i,{signal:r.signal}),!1!==r.preload&&e(o),r.pin&&await t.pins.pinRecursively(o,{signal:r.signal}),o}finally{i()}}return fl(n)}function mD({repo:t,preload:e}){const n=uD({repo:t,preload:e});async function r(t,e={}){const r=await n(t,e),i=bn(r),s=i.length,o=r.Links.reduce(((t,e)=>t+(e.Tsize||0)),0);return{Hash:t,NumLinks:r.Links.length,BlockSize:s,LinksSize:s-(r.Data||[]).length,DataSize:(r.Data||[]).length,CumulativeSize:s+o}}return fl(r)}function yD({repo:t,preload:e}){const n=uD({repo:t,preload:e}),r=gD({repo:t,preload:e});async function i(t,e,i={}){const s=await n(t,i);return r({...s,Links:s.Links.concat([e])},i)}return fl(i)}function wD({repo:t,preload:e}){const n=uD({repo:t,preload:e}),r=gD({repo:t,preload:e});async function i(t,e,i={}){const s=await n(t,i),o=ya([s.Data||[],e]);return r({...s,Data:o},i)}return fl(i)}function bD({repo:t,preload:e}){const n=uD({repo:t,preload:e}),r=gD({repo:t,preload:e});async function i(t,e,i={}){const s=await n(t,i),o=("string"===typeof e?e:e.Name)||"";return s.Links=s.Links.filter((t=>t.Name!==o)),r(s,i)}return fl(i)}function vD({repo:t,preload:e}){const n=uD({repo:t,preload:e}),r=gD({repo:t,preload:e});async function i(t,e,i={}){const s=await n(t,i);return r({...s,Data:e},i)}return fl(i)}class ED{constructor({repo:t,preload:e}){this.addLink=yD({repo:t,preload:e}),this.appendData=wD({repo:t,preload:e}),this.rmLink=bD({repo:t,preload:e}),this.setData=vD({repo:t,preload:e})}}class _D{constructor({repo:t,codecs:e,preload:n}){this.data=hD({repo:t,preload:n}),this.get=uD({repo:t,preload:n}),this.links=fD({repo:t,codecs:e}),this.new=pD({repo:t,preload:n}),this.put=gD({repo:t,preload:n}),this.stat=mD({repo:t,preload:n}),this.patch=new ED({repo:t,preload:n})}}const SD=zt("ipfs:repo:gc");function AD({repo:t,hashers:e}){async function*n(n={}){const r=Date.now();let i;try{i=await rR({repo:t,hashers:e},n),await t.pins.pinRecursively(i),yield*t.gc()}finally{i&&await t.pins.unpin(i)}SD(`Complete (${Date.now()-r}ms)`)}return fl(n)}function CD({repo:t}){async function e(e={}){const n=await t.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}return fl(e)}const ID=12;function TD({repo:t}){async function e(e={}){try{await t._checkInitialized(e)}catch(uS){const e=[/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some((e=>e.test(uS.message)));if(e)return ID;throw uS}return t.version.get()}return fl(e)}class kD{constructor({repo:t,hashers:e}){this.gc=AD({repo:t,hashers:e}),this.stat=CD({repo:t}),this.version=TD({repo:t}),this.setApiAddr=e=>t.apiAddr.set(e)}}function RD(t,e){let n;if(n=t.metrics?e.peer?t.metrics.forPeer(e.peer):e.proto?t.metrics.forProtocol(e.proto):t.metrics.getGlobal():void 0,!n)return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0};const r=n.getMovingAverages(),i=n.getSnapshot();return{totalIn:i.dataReceived,totalOut:i.dataSent,rateIn:r.dataReceived[6e4].movingAverage/60,rateOut:r.dataSent[6e4].movingAverage/60}}function ND({network:t}){const e=async function*(e={}){const{libp2p:n}=await t.use(e);if(!e.poll)return void(yield RD(n,e));const r=e.interval||1e3;let i,s=-1;try{if(s="string"===typeof r?hl(r)||-1:r,!s||s<0)throw new Error("invalid duration")}catch(uS){throw Vt(uS,"ERR_INVALID_POLL_INTERVAL")}try{while(1)yield RD(n,e),await new Promise((t=>{i=setTimeout(t,s)}))}finally{clearTimeout(i)}};return fl(e)}class DD{constructor({repo:t,network:e}){this.repo=CD({repo:t}),this.bw=ND({network:e}),this.bitswap=fy({network:e})}}var OD=PD;function PD(t,e,n){if(!t)return n;var r,i;if(Array.isArray(e)&&(r=e.slice(0)),"string"==typeof e&&(r=e.split(".")),"symbol"==typeof e&&(r=[e]),!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");while(r.length){if(i=r.shift(),!t)return n;if(t=t[i],void 0===t)return n}return t}async function xD(t){let e=0;for await(const n of t)e++;return e}const MD=it("ipfs:repo:migrator:migration-8");function LD(t){return t.child?LD(t.child):t}function BD(t){try{const e=Tt.decode(`b${t.toString().toLowerCase().slice(1)}`),n=Me.decode(e).multihash.bytes,r=Tt.encode(n).slice(1).toUpperCase();return new rl(`/${r}`,!1)}catch(uS){return t}}function UD(t){try{const e=Tt.decode(`b${t.toString().toLowerCase().slice(1)}`),n=Re(e),r=Tt.encode(Me.createV1(go,n).bytes).slice(1);return new rl(`/${r.toUpperCase()}`,!1)}catch{return t}}async function FD(t,e,n){const r=t.blocks;await r.open();const i=LD(r),s=await xD(i.queryKeys({filters:[t=>{const e=n(t);return e.toString()!==t.toString()}]}));try{let t=0;for await(const r of i.query({})){const o=n(r.key);o.toString()!==r.key.toString()&&(t+=1,MD(`Migrating Block from ${r.key} to ${o}`,await i.has(r.key)),await i.delete(r.key),await i.put(o,r.value),e(t/s*100,`Migrated Block from ${r.key} to ${o}`))}}finally{await r.close()}}const zD={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(t,e=(()=>{}))=>FD(t,e,BD),revert:(t,e=(()=>{}))=>FD(t,e,UD)},VD=jt.Reader,jD=jt.Writer,HD=(jt.util,jt.roots["default"]||(jt.roots["default"]={})),$D=HD.ipfs=(()=>{const t={};return t.pin=function(){const t={};return t.Set=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.version=0,t.prototype.fanout=0,t.prototype.seed=0,t.encode=function(t,e){return e||(e=jD.create()),null!=t.version&&Object.hasOwnProperty.call(t,"version")&&e.uint32(8).uint32(t.version),null!=t.fanout&&Object.hasOwnProperty.call(t,"fanout")&&e.uint32(16).uint32(t.fanout),null!=t.seed&&Object.hasOwnProperty.call(t,"seed")&&e.uint32(29).fixed32(t.seed),e},t.decode=function(t,e){t instanceof VD||(t=VD.create(t));var n=void 0===e?t.len:t.pos+e,r=new HD.ipfs.pin.Set;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.version=t.uint32();break;case 2:r.fanout=t.uint32();break;case 3:r.seed=t.fixed32();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof HD.ipfs.pin.Set)return t;var e=new HD.ipfs.pin.Set;return null!=t.version&&(e.version=t.version>>>0),null!=t.fanout&&(e.fanout=t.fanout>>>0),null!=t.seed&&(e.seed=t.seed>>>0),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.version=0,n.fanout=0,n.seed=0),null!=t.version&&t.hasOwnProperty("version")&&(n.version=t.version),null!=t.fanout&&t.hasOwnProperty("fanout")&&(n.fanout=t.fanout),null!=t.seed&&t.hasOwnProperty("seed")&&(n.seed=t.seed),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t}(),t}(),t})();var KD=n(336);const GD=new rl("/local/pins"),qD=256,WD=8192,YD=Me.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),XD={direct:"direct",recursive:"recursive"};function QD(t){return new rl(`/${Tt.encode(t.multihash.bytes).toUpperCase().substring(1)}`)}function JD(t,e){for(let n=0;n<t.byteLength;n++){if(t[n]<e[n])return-1;if(t[n]>e[n])return 1}return t.byteLength>e.byteLength?1:t.byteLength<e.byteLength?-1:0}const ZD=$D.pin.Set;function tO(t){const e=t.Data;if(!e)throw new Error("No data present");const n=ma.decode(e),r=ma.decode.bytes;if(r<=0)throw new Error("Invalid Set header length");if(r+n>e.length)throw new Error("Impossibly large set header length");const i=e.slice(r,n+r),s=ZD.toObject(ZD.decode(i),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(1!==s.version)throw new Error(`Unsupported Set version: ${s.version}`);if(s.fanout>t.Links.length)throw new Error("Impossibly large fanout");return{header:s,data:e.slice(n+r)}}function eO(t,e){const n=new Uint8Array(4),r=new DataView(n.buffer);r.setUint32(0,t,!0);const i=Ho(e.toString()),s=ya([n,i],n.byteLength+i.byteLength);return KD(sa(s))}async function*nO(t,e){const n=tO(e);let r=0;for(const i of e.Links){if(r<n.header.fanout){const e=i.Hash;if(!YD.equals(e)){const n=await t.get(e),r=vn(n);yield*nO(t,r)}}else yield i.Hash;r++}}async function*rO(t,e,n){const r=e.Links.find((t=>t.Name===n));if(!r)throw new Error("No link found with name "+n);const i=await t.get(r.Hash),s=vn(i);yield*nO(t,s)}function iO(t,e){return n(e,0);async function n(e,r){const i=ZD.encode({version:1,fanout:qD,seed:r}).finish(),s=ma.encode(i.length),o=ya([s,i]),a=[];for(let t=0;t<qD;t++)a.push({Name:"",Tsize:1,Hash:YD});if(e.length<=WD){const t=e.map((t=>({link:{Name:"",Tsize:1,Hash:t.key},data:t.data||new Uint8Array}))).sort(((t,e)=>JD(t.link.Hash.bytes,e.link.Hash.bytes))),n=a.concat(t.map((t=>t.link))),r=ya([o,...t.map((t=>t.data))]);return{Data:r,Links:n}}{const t=e.reduce(((t,e)=>{const n=eO(r,e.key)%qD;return t[n]=n in t?t[n].concat([e]):[e],t}),[]);let i=0;for(const e of t){const t=await n(e,r+1);await c(t,i),i++}return{Data:o,Links:a}}async function c(e,n){const r=bn(e),i=await ho.digest(r),s=Me.createV0(i);await t.put(s,r);const o=e.Links.reduce(((t,e)=>t+(e.Tsize||0)),0)+r.length;a[n]={Name:"",Tsize:o,Hash:s}}}}async function sO(t,e,n){const r=await iO(t,n.map((t=>({key:t})))),i=bn(r),s=await ho.digest(i),o=Me.createV0(s);await t.put(o,i);const a=r.Links.reduce(((t,e)=>t+e.Tsize),0)+i.length;return{Name:e,Tsize:a,Hash:o}}async function oO(t,e,n,r){if(!await e.has(GD))return;const i=await e.get(GD),s=Me.decode(i),o=await t.get(s),a=vn(o);let c=0;const l=await xD(rO(t,a,XD.recursive))+await xD(rO(t,a,XD.direct));for await(const u of rO(t,a,XD.recursive)){c++;const t={depth:1/0};0!==u.version&&(t.version=u.version),u.code!==wn&&(t.codec=u.code),await n.put(QD(u),Mi(t)),r(c/l*100,`Migrated recursive pin ${u}`)}for await(const u of rO(t,a,XD.direct)){c++;const t={depth:0};0!==u.version&&(t.version=u.version),u.code!==wn&&(t.codec=u.code),await n.put(QD(u),Mi(t)),r(c/l*100,`Migrated direct pin ${u}`)}await t.delete(s),await e.delete(GD)}async function aO(t,e,n,r){const i=[],s=[];let o=0;const a=await xD(n.queryKeys({}));for await(const{key:d,value:f}of n.query({})){o++;const t=Hi(f),e=Me.create(t.version||0,t.codec||wn,Re(Tt.decode("b"+d.toString().toLowerCase().split("/").pop())));0===t.depth?(r(o/a*100,`Reverted direct pin ${e}`),s.push(e)):(r(o/a*100,`Reverted recursive pin ${e}`),i.push(e))}r(100,"Updating pin root");const c={Links:[await sO(t,XD.direct,s),await sO(t,XD.recursive,i)]},l=bn(c),u=await ho.digest(l),h=Me.createV0(u);await t.put(h,l),await e.put(GD,h.bytes)}async function cO(t,e,n){const r=t.blocks,i=t.datastore,s=t.pins;await r.open(),await i.open(),await s.open();try{await n(r,i,s,e)}finally{await s.close(),await i.close(),await r.close()}}const lO={version:9,description:"Migrates pins to datastore",migrate:(t,e=(()=>{}))=>cO(t,e,oO),revert:(t,e=(()=>{}))=>cO(t,e,aO)},uO=new rl("/config"),hO=new rl("/version");function dO(t){let e=t;while(e.db||e.child)if(e=e.db||e.child,"level-js"===e.type||"Level"===e.constructor.name)return e}async function fO(t,e,n){const r=await e(t);if(r)return r;const i=dO(n);return!!i&&new Promise(((e,n)=>{const r=i.store("readonly").get(t.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{e(Boolean(r.result))}}))}async function pO(t,e,n,r){if(await n(t))return e(t);const i=dO(r);if(!i)throw oh();return new Promise(((e,n)=>{const r=i.store("readonly").get(t.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{if(r.result)return e(r.result);n(oh())}}))}function gO(t){const e=t.get.bind(t),n=t.has.bind(t);return t.get=r=>pO(r,e,n,t),t.has=e=>fO(e,n,t),t}function mO(t){return{...t,root:gO(t.root),datastore:gO(t.datastore),pins:gO(t.pins),keys:gO(t.keys)}}async function yO(t,e,n=(()=>{})){const r=dO(e);if(!r)return void n(`${t} did not need an upgrade`);n(`Upgrading ${t}`);const i=(t,e)=>[{type:"del",key:t},{type:"put",key:Ho(t),value:e}];await _O(r,i)}async function wO(t,e,n=(()=>{})){const r=dO(e);if(!r)return void n(`${t} did not need a downgrade`);n(`Downgrading ${t}`);const i=(t,e)=>[{type:"del",key:t},{type:"put",key:sa(t),value:e}];await _O(r,i)}function bO(t){return t.child?bO(t.child):t}async function vO(t,e,n){const r=Object.entries(t).map((([t,e])=>({key:t,backend:bO(e)}))).filter((({key:t,backend:e})=>"LevelDatastore"===e.constructor.name)).map((({key:t,backend:e})=>({name:t,store:e})));e(0,`Migrating ${r.length} dbs`);let i=0;const s=t=>{e(Math.round(i/r.length*100),t)};for(const{name:o,store:a}of r){await a.open();try{await n(o,a,s)}finally{i++,await a.close()}}e(100,`Migrated ${r.length} dbs`)}const EO={version:10,description:"Migrates datastore-level keys to binary",migrate:(t,e=(()=>{}))=>vO(t,e,yO),revert:(t,e=(()=>{}))=>vO(t,e,wO)};function _O(t,e){function n(e,n){const r=t.store("readwrite"),i=r.transaction;let s,o=0;function a(){const t=e[o++],n=t.key;let c;try{c="del"===t.type?r.delete(n):r.put(t.value,n)}catch(uS){return s=uS,void i.abort()}o<e.length&&(c.onsuccess=a)}i.onabort=()=>n(s||i.error||new Error("aborted by user")),i.oncomplete=()=>n(),a()}return new Promise(((r,i)=>{const s=t.iterator(),o=t=>t;function a(){const t=(t,o,c)=>{if(t||void 0===o){const t=t=>{t?i(t):r()};s.end(t)}else n(e(o,c),a)};s.next(t)}s._deserializeKey=s._deserializeValue=o,a()}))}const SO=new rl("/local/filesroot");async function AO(t,e=(()=>{})){if(e(100,"Migrating MFS root to repo datastore"),await t.root.open(),await t.datastore.open(),await t.root.has(SO)){const e=await t.root.get(SO);await t.datastore.put(SO,e),await t.root.delete(SO)}await t.datastore.close(),await t.root.close(),e(100,"Stored MFS root in repo datastore")}async function CO(t,e=(()=>{})){if(e(100,"Migrating MFS root to repo root datastore"),await t.root.open(),await t.datastore.open(),await t.datastore.has(SO)){const e=await t.datastore.get(SO);await t.root.put(SO,e),await t.datastore.delete(SO)}await t.datastore.close(),await t.root.close(),e(100,"Stored MFS root in repo root datastore")}const IO={version:11,description:"Store mfs root in the datastore",migrate:AO,revert:CO},TO=jt.Reader,kO=jt.Writer,RO=jt.util,NO=jt.roots["default"]||(jt.roots["default"]={}),DO=NO.Protocols=(()=>{function t(t){if(this.protocols=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.protocols=RO.emptyArray,t.encode=function(t,e){if(e||(e=kO.create()),null!=t.protocols&&t.protocols.length)for(var n=0;n<t.protocols.length;++n)e.uint32(10).string(t.protocols[n]);return e},t.decode=function(t,e){t instanceof TO||(t=TO.create(t));var n=void 0===e?t.len:t.pos+e,r=new NO.Protocols;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.protocols&&r.protocols.length||(r.protocols=[]),r.protocols.push(t.string());break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof NO.Protocols)return t;var e=new NO.Protocols;if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Protocols.protocols: array expected");e.protocols=[];for(var n=0;n<t.protocols.length;++n)e.protocols[n]=String(t.protocols[n])}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.protocols=[]),t.protocols&&t.protocols.length){n.protocols=[];for(var r=0;r<t.protocols.length;++r)n.protocols[r]=t.protocols[r]}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),OO=jt.Reader,PO=jt.Writer,xO=jt.util,MO=jt.roots["default"]||(jt.roots["default"]={}),LO=MO.Addresses=(()=>{function t(t){if(this.addrs=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.addrs=xO.emptyArray,t.prototype.certifiedRecord=null,t.encode=function(t,e){if(e||(e=PO.create()),null!=t.addrs&&t.addrs.length)for(var n=0;n<t.addrs.length;++n)MO.Addresses.Address.encode(t.addrs[n],e.uint32(10).fork()).ldelim();return null!=t.certifiedRecord&&Object.hasOwnProperty.call(t,"certifiedRecord")&&MO.Addresses.CertifiedRecord.encode(t.certifiedRecord,e.uint32(18).fork()).ldelim(),e},t.decode=function(t,e){t instanceof OO||(t=OO.create(t));var n=void 0===e?t.len:t.pos+e,r=new MO.Addresses;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.addrs&&r.addrs.length||(r.addrs=[]),r.addrs.push(MO.Addresses.Address.decode(t,t.uint32()));break;case 2:r.certifiedRecord=MO.Addresses.CertifiedRecord.decode(t,t.uint32());break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof MO.Addresses)return t;var e=new MO.Addresses;if(t.addrs){if(!Array.isArray(t.addrs))throw TypeError(".Addresses.addrs: array expected");e.addrs=[];for(var n=0;n<t.addrs.length;++n){if("object"!==typeof t.addrs[n])throw TypeError(".Addresses.addrs: object expected");e.addrs[n]=MO.Addresses.Address.fromObject(t.addrs[n])}}if(null!=t.certifiedRecord){if("object"!==typeof t.certifiedRecord)throw TypeError(".Addresses.certifiedRecord: object expected");e.certifiedRecord=MO.Addresses.CertifiedRecord.fromObject(t.certifiedRecord)}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.addrs=[]),e.defaults&&(n.certifiedRecord=null),t.addrs&&t.addrs.length){n.addrs=[];for(var r=0;r<t.addrs.length;++r)n.addrs[r]=MO.Addresses.Address.toObject(t.addrs[r],e)}return null!=t.certifiedRecord&&t.hasOwnProperty("certifiedRecord")&&(n.certifiedRecord=MO.Addresses.CertifiedRecord.toObject(t.certifiedRecord,e)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.Address=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}let e;return t.prototype.multiaddr=xO.newBuffer([]),t.prototype.isCertified=null,Object.defineProperty(t.prototype,"_isCertified",{get:xO.oneOfGetter(e=["isCertified"]),set:xO.oneOfSetter(e)}),t.encode=function(t,e){return e||(e=PO.create()),null!=t.multiaddr&&Object.hasOwnProperty.call(t,"multiaddr")&&e.uint32(10).bytes(t.multiaddr),null!=t.isCertified&&Object.hasOwnProperty.call(t,"isCertified")&&e.uint32(16).bool(t.isCertified),e},t.decode=function(t,e){t instanceof OO||(t=OO.create(t));var n=void 0===e?t.len:t.pos+e,r=new MO.Addresses.Address;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.multiaddr=t.bytes();break;case 2:r.isCertified=t.bool();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof MO.Addresses.Address)return t;var e=new MO.Addresses.Address;return null!=t.multiaddr&&("string"===typeof t.multiaddr?xO.base64.decode(t.multiaddr,e.multiaddr=xO.newBuffer(xO.base64.length(t.multiaddr)),0):t.multiaddr.length&&(e.multiaddr=t.multiaddr)),null!=t.isCertified&&(e.isCertified=Boolean(t.isCertified)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.multiaddr="":(n.multiaddr=[],e.bytes!==Array&&(n.multiaddr=xO.newBuffer(n.multiaddr)))),null!=t.multiaddr&&t.hasOwnProperty("multiaddr")&&(n.multiaddr=e.bytes===String?xO.base64.encode(t.multiaddr,0,t.multiaddr.length):e.bytes===Array?Array.prototype.slice.call(t.multiaddr):t.multiaddr),null!=t.isCertified&&t.hasOwnProperty("isCertified")&&(n.isCertified=t.isCertified,e.oneofs&&(n._isCertified="isCertified")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t}(),t.CertifiedRecord=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.seq=xO.Long?xO.Long.fromBits(0,0,!0):0,t.prototype.raw=xO.newBuffer([]),t.encode=function(t,e){return e||(e=PO.create()),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(8).uint64(t.seq),null!=t.raw&&Object.hasOwnProperty.call(t,"raw")&&e.uint32(18).bytes(t.raw),e},t.decode=function(t,e){t instanceof OO||(t=OO.create(t));var n=void 0===e?t.len:t.pos+e,r=new MO.Addresses.CertifiedRecord;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.seq=t.uint64();break;case 2:r.raw=t.bytes();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof MO.Addresses.CertifiedRecord)return t;var e=new MO.Addresses.CertifiedRecord;return null!=t.seq&&(xO.Long?(e.seq=xO.Long.fromValue(t.seq)).unsigned=!0:"string"===typeof t.seq?e.seq=parseInt(t.seq,10):"number"===typeof t.seq?e.seq=t.seq:"object"===typeof t.seq&&(e.seq=new xO.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),null!=t.raw&&("string"===typeof t.raw?xO.base64.decode(t.raw,e.raw=xO.newBuffer(xO.base64.length(t.raw)),0):t.raw.length&&(e.raw=t.raw)),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults){if(xO.Long){var r=new xO.Long(0,0,!0);n.seq=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.seq=e.longs===String?"0":0;e.bytes===String?n.raw="":(n.raw=[],e.bytes!==Array&&(n.raw=xO.newBuffer(n.raw)))}return null!=t.seq&&t.hasOwnProperty("seq")&&("number"===typeof t.seq?n.seq=e.longs===String?String(t.seq):t.seq:n.seq=e.longs===String?xO.Long.prototype.toString.call(t.seq):e.longs===Number?new xO.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),null!=t.raw&&t.hasOwnProperty("raw")&&(n.raw=e.bytes===String?xO.base64.encode(t.raw,0,t.raw.length):e.bytes===Array?Array.prototype.slice.call(t.raw):t.raw),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t}(),t})(),BO=jt.Reader,UO=jt.Writer,FO=jt.util,zO=jt.roots["default"]||(jt.roots["default"]={}),VO=zO.Peer=(()=>{function t(t){if(this.addresses=[],this.protocols=[],this.metadata=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}let e;return t.prototype.addresses=FO.emptyArray,t.prototype.protocols=FO.emptyArray,t.prototype.metadata=FO.emptyArray,t.prototype.pubKey=null,t.prototype.peerRecordEnvelope=null,Object.defineProperty(t.prototype,"_pubKey",{get:FO.oneOfGetter(e=["pubKey"]),set:FO.oneOfSetter(e)}),Object.defineProperty(t.prototype,"_peerRecordEnvelope",{get:FO.oneOfGetter(e=["peerRecordEnvelope"]),set:FO.oneOfSetter(e)}),t.encode=function(t,e){if(e||(e=UO.create()),null!=t.addresses&&t.addresses.length)for(var n=0;n<t.addresses.length;++n)zO.Address.encode(t.addresses[n],e.uint32(10).fork()).ldelim();if(null!=t.protocols&&t.protocols.length)for(n=0;n<t.protocols.length;++n)e.uint32(18).string(t.protocols[n]);if(null!=t.metadata&&t.metadata.length)for(n=0;n<t.metadata.length;++n)zO.Metadata.encode(t.metadata[n],e.uint32(26).fork()).ldelim();return null!=t.pubKey&&Object.hasOwnProperty.call(t,"pubKey")&&e.uint32(34).bytes(t.pubKey),null!=t.peerRecordEnvelope&&Object.hasOwnProperty.call(t,"peerRecordEnvelope")&&e.uint32(42).bytes(t.peerRecordEnvelope),e},t.decode=function(t,e){t instanceof BO||(t=BO.create(t));var n=void 0===e?t.len:t.pos+e,r=new zO.Peer;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.addresses&&r.addresses.length||(r.addresses=[]),r.addresses.push(zO.Address.decode(t,t.uint32()));break;case 2:r.protocols&&r.protocols.length||(r.protocols=[]),r.protocols.push(t.string());break;case 3:r.metadata&&r.metadata.length||(r.metadata=[]),r.metadata.push(zO.Metadata.decode(t,t.uint32()));break;case 4:r.pubKey=t.bytes();break;case 5:r.peerRecordEnvelope=t.bytes();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof zO.Peer)return t;var e=new zO.Peer;if(t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".Peer.addresses: array expected");e.addresses=[];for(var n=0;n<t.addresses.length;++n){if("object"!==typeof t.addresses[n])throw TypeError(".Peer.addresses: object expected");e.addresses[n]=zO.Address.fromObject(t.addresses[n])}}if(t.protocols){if(!Array.isArray(t.protocols))throw TypeError(".Peer.protocols: array expected");e.protocols=[];for(n=0;n<t.protocols.length;++n)e.protocols[n]=String(t.protocols[n])}if(t.metadata){if(!Array.isArray(t.metadata))throw TypeError(".Peer.metadata: array expected");e.metadata=[];for(n=0;n<t.metadata.length;++n){if("object"!==typeof t.metadata[n])throw TypeError(".Peer.metadata: object expected");e.metadata[n]=zO.Metadata.fromObject(t.metadata[n])}}return null!=t.pubKey&&("string"===typeof t.pubKey?FO.base64.decode(t.pubKey,e.pubKey=FO.newBuffer(FO.base64.length(t.pubKey)),0):t.pubKey.length&&(e.pubKey=t.pubKey)),null!=t.peerRecordEnvelope&&("string"===typeof t.peerRecordEnvelope?FO.base64.decode(t.peerRecordEnvelope,e.peerRecordEnvelope=FO.newBuffer(FO.base64.length(t.peerRecordEnvelope)),0):t.peerRecordEnvelope.length&&(e.peerRecordEnvelope=t.peerRecordEnvelope)),e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.addresses=[],n.protocols=[],n.metadata=[]),t.addresses&&t.addresses.length){n.addresses=[];for(var r=0;r<t.addresses.length;++r)n.addresses[r]=zO.Address.toObject(t.addresses[r],e)}if(t.protocols&&t.protocols.length){n.protocols=[];for(r=0;r<t.protocols.length;++r)n.protocols[r]=t.protocols[r]}if(t.metadata&&t.metadata.length){n.metadata=[];for(r=0;r<t.metadata.length;++r)n.metadata[r]=zO.Metadata.toObject(t.metadata[r],e)}return null!=t.pubKey&&t.hasOwnProperty("pubKey")&&(n.pubKey=e.bytes===String?FO.base64.encode(t.pubKey,0,t.pubKey.length):e.bytes===Array?Array.prototype.slice.call(t.pubKey):t.pubKey,e.oneofs&&(n._pubKey="pubKey")),null!=t.peerRecordEnvelope&&t.hasOwnProperty("peerRecordEnvelope")&&(n.peerRecordEnvelope=e.bytes===String?FO.base64.encode(t.peerRecordEnvelope,0,t.peerRecordEnvelope.length):e.bytes===Array?Array.prototype.slice.call(t.peerRecordEnvelope):t.peerRecordEnvelope,e.oneofs&&(n._peerRecordEnvelope="peerRecordEnvelope")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),jO=(zO.Address=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}let e;return t.prototype.multiaddr=FO.newBuffer([]),t.prototype.isCertified=null,Object.defineProperty(t.prototype,"_isCertified",{get:FO.oneOfGetter(e=["isCertified"]),set:FO.oneOfSetter(e)}),t.encode=function(t,e){return e||(e=UO.create()),null!=t.multiaddr&&Object.hasOwnProperty.call(t,"multiaddr")&&e.uint32(10).bytes(t.multiaddr),null!=t.isCertified&&Object.hasOwnProperty.call(t,"isCertified")&&e.uint32(16).bool(t.isCertified),e},t.decode=function(t,e){t instanceof BO||(t=BO.create(t));var n=void 0===e?t.len:t.pos+e,r=new zO.Address;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.multiaddr=t.bytes();break;case 2:r.isCertified=t.bool();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof zO.Address)return t;var e=new zO.Address;return null!=t.multiaddr&&("string"===typeof t.multiaddr?FO.base64.decode(t.multiaddr,e.multiaddr=FO.newBuffer(FO.base64.length(t.multiaddr)),0):t.multiaddr.length&&(e.multiaddr=t.multiaddr)),null!=t.isCertified&&(e.isCertified=Boolean(t.isCertified)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.multiaddr="":(n.multiaddr=[],e.bytes!==Array&&(n.multiaddr=FO.newBuffer(n.multiaddr)))),null!=t.multiaddr&&t.hasOwnProperty("multiaddr")&&(n.multiaddr=e.bytes===String?FO.base64.encode(t.multiaddr,0,t.multiaddr.length):e.bytes===Array?Array.prototype.slice.call(t.multiaddr):t.multiaddr),null!=t.isCertified&&t.hasOwnProperty("isCertified")&&(n.isCertified=t.isCertified,e.oneofs&&(n._isCertified="isCertified")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),zO.Metadata=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.key="",t.prototype.value=FO.newBuffer([]),t.encode=function(t,e){return e||(e=UO.create()),null!=t.key&&Object.hasOwnProperty.call(t,"key")&&e.uint32(10).string(t.key),null!=t.value&&Object.hasOwnProperty.call(t,"value")&&e.uint32(18).bytes(t.value),e},t.decode=function(t,e){t instanceof BO||(t=BO.create(t));var n=void 0===e?t.len:t.pos+e,r=new zO.Metadata;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.key=t.string();break;case 2:r.value=t.bytes();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof zO.Metadata)return t;var e=new zO.Metadata;return null!=t.key&&(e.key=String(t.key)),null!=t.value&&("string"===typeof t.value?FO.base64.decode(t.value,e.value=FO.newBuffer(FO.base64.length(t.value)),0):t.value.length&&(e.value=t.value)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.key="",e.bytes===String?n.value="":(n.value=[],e.bytes!==Array&&(n.value=FO.newBuffer(n.value)))),null!=t.key&&t.hasOwnProperty("key")&&(n.key=t.key),null!=t.value&&t.hasOwnProperty("value")&&(n.value=e.bytes===String?FO.base64.encode(t.value,0,t.value.length):e.bytes===Array?Array.prototype.slice.call(t.value):t.value),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),jt.Reader),HO=jt.Writer,$O=jt.util,KO=jt.roots["default"]||(jt.roots["default"]={}),GO=KO.Envelope=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.publicKey=$O.newBuffer([]),t.prototype.payloadType=$O.newBuffer([]),t.prototype.payload=$O.newBuffer([]),t.prototype.signature=$O.newBuffer([]),t.encode=function(t,e){return e||(e=HO.create()),null!=t.publicKey&&Object.hasOwnProperty.call(t,"publicKey")&&e.uint32(10).bytes(t.publicKey),null!=t.payloadType&&Object.hasOwnProperty.call(t,"payloadType")&&e.uint32(18).bytes(t.payloadType),null!=t.payload&&Object.hasOwnProperty.call(t,"payload")&&e.uint32(26).bytes(t.payload),null!=t.signature&&Object.hasOwnProperty.call(t,"signature")&&e.uint32(42).bytes(t.signature),e},t.decode=function(t,e){t instanceof jO||(t=jO.create(t));var n=void 0===e?t.len:t.pos+e,r=new KO.Envelope;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.publicKey=t.bytes();break;case 2:r.payloadType=t.bytes();break;case 3:r.payload=t.bytes();break;case 5:r.signature=t.bytes();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof KO.Envelope)return t;var e=new KO.Envelope;return null!=t.publicKey&&("string"===typeof t.publicKey?$O.base64.decode(t.publicKey,e.publicKey=$O.newBuffer($O.base64.length(t.publicKey)),0):t.publicKey.length&&(e.publicKey=t.publicKey)),null!=t.payloadType&&("string"===typeof t.payloadType?$O.base64.decode(t.payloadType,e.payloadType=$O.newBuffer($O.base64.length(t.payloadType)),0):t.payloadType.length&&(e.payloadType=t.payloadType)),null!=t.payload&&("string"===typeof t.payload?$O.base64.decode(t.payload,e.payload=$O.newBuffer($O.base64.length(t.payload)),0):t.payload.length&&(e.payload=t.payload)),null!=t.signature&&("string"===typeof t.signature?$O.base64.decode(t.signature,e.signature=$O.newBuffer($O.base64.length(t.signature)),0):t.signature.length&&(e.signature=t.signature)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.publicKey="":(n.publicKey=[],e.bytes!==Array&&(n.publicKey=$O.newBuffer(n.publicKey))),e.bytes===String?n.payloadType="":(n.payloadType=[],e.bytes!==Array&&(n.payloadType=$O.newBuffer(n.payloadType))),e.bytes===String?n.payload="":(n.payload=[],e.bytes!==Array&&(n.payload=$O.newBuffer(n.payload))),e.bytes===String?n.signature="":(n.signature=[],e.bytes!==Array&&(n.signature=$O.newBuffer(n.signature)))),null!=t.publicKey&&t.hasOwnProperty("publicKey")&&(n.publicKey=e.bytes===String?$O.base64.encode(t.publicKey,0,t.publicKey.length):e.bytes===Array?Array.prototype.slice.call(t.publicKey):t.publicKey),null!=t.payloadType&&t.hasOwnProperty("payloadType")&&(n.payloadType=e.bytes===String?$O.base64.encode(t.payloadType,0,t.payloadType.length):e.bytes===Array?Array.prototype.slice.call(t.payloadType):t.payloadType),null!=t.payload&&t.hasOwnProperty("payload")&&(n.payload=e.bytes===String?$O.base64.encode(t.payload,0,t.payload.length):e.bytes===Array?Array.prototype.slice.call(t.payload):t.payload),null!=t.signature&&t.hasOwnProperty("signature")&&(n.signature=e.bytes===String?$O.base64.encode(t.signature,0,t.signature.length):e.bytes===Array?Array.prototype.slice.call(t.signature):t.signature),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t})(),qO=jt.Reader,WO=jt.Writer,YO=jt.util,XO=jt.roots["default"]||(jt.roots["default"]={}),QO=XO.PeerRecord=(()=>{function t(t){if(this.addresses=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.peerId=YO.newBuffer([]),t.prototype.seq=YO.Long?YO.Long.fromBits(0,0,!0):0,t.prototype.addresses=YO.emptyArray,t.encode=function(t,e){if(e||(e=WO.create()),null!=t.peerId&&Object.hasOwnProperty.call(t,"peerId")&&e.uint32(10).bytes(t.peerId),null!=t.seq&&Object.hasOwnProperty.call(t,"seq")&&e.uint32(16).uint64(t.seq),null!=t.addresses&&t.addresses.length)for(var n=0;n<t.addresses.length;++n)XO.PeerRecord.AddressInfo.encode(t.addresses[n],e.uint32(26).fork()).ldelim();return e},t.decode=function(t,e){t instanceof qO||(t=qO.create(t));var n=void 0===e?t.len:t.pos+e,r=new XO.PeerRecord;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.peerId=t.bytes();break;case 2:r.seq=t.uint64();break;case 3:r.addresses&&r.addresses.length||(r.addresses=[]),r.addresses.push(XO.PeerRecord.AddressInfo.decode(t,t.uint32()));break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof XO.PeerRecord)return t;var e=new XO.PeerRecord;if(null!=t.peerId&&("string"===typeof t.peerId?YO.base64.decode(t.peerId,e.peerId=YO.newBuffer(YO.base64.length(t.peerId)),0):t.peerId.length&&(e.peerId=t.peerId)),null!=t.seq&&(YO.Long?(e.seq=YO.Long.fromValue(t.seq)).unsigned=!0:"string"===typeof t.seq?e.seq=parseInt(t.seq,10):"number"===typeof t.seq?e.seq=t.seq:"object"===typeof t.seq&&(e.seq=new YO.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0))),t.addresses){if(!Array.isArray(t.addresses))throw TypeError(".PeerRecord.addresses: array expected");e.addresses=[];for(var n=0;n<t.addresses.length;++n){if("object"!==typeof t.addresses[n])throw TypeError(".PeerRecord.addresses: object expected");e.addresses[n]=XO.PeerRecord.AddressInfo.fromObject(t.addresses[n])}}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.addresses=[]),e.defaults)if(e.bytes===String?n.peerId="":(n.peerId=[],e.bytes!==Array&&(n.peerId=YO.newBuffer(n.peerId))),YO.Long){var r=new YO.Long(0,0,!0);n.seq=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.seq=e.longs===String?"0":0;if(null!=t.peerId&&t.hasOwnProperty("peerId")&&(n.peerId=e.bytes===String?YO.base64.encode(t.peerId,0,t.peerId.length):e.bytes===Array?Array.prototype.slice.call(t.peerId):t.peerId),null!=t.seq&&t.hasOwnProperty("seq")&&("number"===typeof t.seq?n.seq=e.longs===String?String(t.seq):t.seq:n.seq=e.longs===String?YO.Long.prototype.toString.call(t.seq):e.longs===Number?new YO.LongBits(t.seq.low>>>0,t.seq.high>>>0).toNumber(!0):t.seq),t.addresses&&t.addresses.length){n.addresses=[];for(var i=0;i<t.addresses.length;++i)n.addresses[i]=XO.PeerRecord.AddressInfo.toObject(t.addresses[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.AddressInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.multiaddr=YO.newBuffer([]),t.encode=function(t,e){return e||(e=WO.create()),null!=t.multiaddr&&Object.hasOwnProperty.call(t,"multiaddr")&&e.uint32(10).bytes(t.multiaddr),e},t.decode=function(t,e){t instanceof qO||(t=qO.create(t));var n=void 0===e?t.len:t.pos+e,r=new XO.PeerRecord.AddressInfo;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.multiaddr=t.bytes();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof XO.PeerRecord.AddressInfo)return t;var e=new XO.PeerRecord.AddressInfo;return null!=t.multiaddr&&("string"===typeof t.multiaddr?YO.base64.decode(t.multiaddr,e.multiaddr=YO.newBuffer(YO.base64.length(t.multiaddr)),0):t.multiaddr.length&&(e.multiaddr=t.multiaddr)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.multiaddr="":(n.multiaddr=[],e.bytes!==Array&&(n.multiaddr=YO.newBuffer(n.multiaddr)))),null!=t.multiaddr&&t.hasOwnProperty("multiaddr")&&(n.multiaddr=e.bytes===String?YO.base64.encode(t.multiaddr,0,t.multiaddr.length):e.bytes===Array?Array.prototype.slice.call(t.multiaddr):t.multiaddr),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t}(),t})();async function JO(t,e=(()=>{})){e(0,"Storing each peerstore key under a single datastore key"),await t.datastore.open();const n={},r=[];for await(const{key:i,value:s}of t.datastore.query({prefix:"/peers"})){r.push(i);const t=i.toString(),[,e,o,a,c]=t.split("/");if("peers"===e&&(["protos","addrs","metadata","keys"].includes(o)&&a))if(n[a]=n[a]||{addresses:[],protocols:[],metadata:[]},"protos"===o){const t=DO.decode(s);n[a].protocols=t.protocols.sort()}else if("addrs"===o){const t=LO.decode(s);n[a].addresses=t.addrs.sort(((t,e)=>dc(t.multiaddr).toString().localeCompare(dc(e.multiaddr).toString()))),t.certifiedRecord&&t.certifiedRecord.raw&&(n[a].peerRecordEnvelope=t.certifiedRecord.raw)}else"metadata"===o?n[a].metadata.push({key:c,value:s}):"keys"===o&&(n[a].pubKey=s)}e(33,"Read peer data from store");for(const i of r)await t.datastore.delete(i);e(66,"Removed existing peer data from store");for(const i of Object.keys(n)){const e=n[i];e.metadata=e.metadata.sort(((t,e)=>t.key.localeCompare(e.key)));const r=VO.encode(e).finish();await t.datastore.put(new rl(`/peers/${i}`),r)}await t.datastore.close(),e(100,"Stored each peerstore key under a single datastore key")}async function ZO(t,e=(()=>{})){e(0,"Storing each peerstore key under a multiple datastore keys"),await t.datastore.open();const n={},r=[];for await(const{key:i,value:s}of t.datastore.query({prefix:"/peers"})){r.push(i);const t=i.toString(),[,,e]=t.split("/");n[e]=VO.decode(s)}e(33,"Read peer data from store");for(const i of r)await t.datastore.delete(i);e(66,"Removed existing peer data from store");for(const[i,s]of Object.entries(n)){if(s.protocols&&s.protocols.length>0&&await t.datastore.put(new rl(`/peers/protos/${i}`),DO.encode({protocols:s.protocols}).finish()),s.addresses&&s.addresses.length>0){const e=s.peerRecordEnvelope;let n;if(e){const t=GO.decode(e),r=QO.decode(t.payload);n={raw:e,seq:r.seq}}await t.datastore.put(new rl(`/peers/addrs/${i}`),LO.encode({addrs:s.addresses,certifiedRecord:n}).finish())}if(s.metadata&&s.metadata.length>0)for(const{key:e,value:n}of s.metadata)await t.datastore.put(new rl(`/peers/metadata/${i}/${e}`),n);s.pubKey&&await t.datastore.put(new rl(`/peers/keys/${i}`),s.pubKey)}await t.datastore.close(),e(100,"Stored each peerstore key under multiple datastore keys")}jt.util.Long=void 0,jt.configure();const tP={version:12,description:"Store each peerstore peer under a single datastore key",migrate:JO,revert:ZO},eP={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0};var nP=[Object.assign({version:1},eP),Object.assign({version:2},eP),Object.assign({version:3},eP),Object.assign({version:4},eP),Object.assign({version:5},eP),Object.assign({version:6},eP),Object.assign({version:7},eP),zD,lO,EO,IO,tP];class rP extends Error{constructor(t){super(t),this.name="NonReversibleMigrationError",this.code=rP.code,this.message=t}}rP.code="ERR_NON_REVERSIBLE_MIGRATION";class iP extends Error{constructor(t){super(t),this.name="NotInitializedRepoError",this.code=iP.code,this.message=t}}iP.code="ERR_NOT_INITIALIZED_REPO";class sP extends Error{constructor(t){super(t),this.name="RequiredParameterError",this.code=sP.code,this.message=t}}sP.code="ERR_REQUIRED_PARAMETER";class oP extends Error{constructor(t){super(t),this.name="InvalidValueError",this.code=oP.code,this.message=t}}oP.code="ERR_INVALID_VALUE";class aP extends Error{constructor(t){super(t),this.name="MissingRepoOptionsError",this.code=aP.code,this.message=t}}aP.code="ERR_MISSING_REPO_OPTIONS";const cP=it("ipfs:repo:migrator:repo:init");async function lP(t){if(!t)throw new aP("Please pass repo options when trying to open a repo");const e=t.root;try{await e.open();const t=await e.has(hO),n=await e.has(uO);return!(!t||!n)||(cP(`Version entry present: ${t}`),cP(`Config entry present: ${n}`),!1)}catch(n){return cP("While checking if repo is initialized error was thrown: "+n.message),!1}finally{if(void 0!==e)try{await e.close()}catch{}}}async function uP(t){if(!await lP(t))throw new iP("Repo is not initialized!");const e=t.root;await e.open();try{return parseInt(sa(await e.get(hO)))}finally{await e.close()}}async function hP(t,e){if(!e)throw new aP("Please pass repo options when trying to open a repo");const n=e.root;await n.open(),await n.put(hO,Ho(String(t))),await n.close()}const dP=it("ipfs:repo:migrator");function fP(t){return t=t||nP,Array.isArray(t)&&0!==t.length?t[t.length-1].version:0}async function pP(t,e,n,r,i={}){const s=i.ignoreLock??!1,o=i.onProgress,a=i.isDryRun??!1,c=i.migrations??nP;if(!t)throw new yP.RequiredParameterError("Path argument is required!");if(!n)throw new yP.RequiredParameterError("repoOptions argument is required!");if(!r)throw new yP.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(r)||r<=0)throw new yP.InvalidValueError("Version has to be positive integer!");e=mO(e);const l=await uP(e);if(l===r)return void dP("Nothing to migrate.");if(l>r)throw new yP.InvalidValueError(`Current repo's version (${l}) is higher then toVersion (${r}), you probably wanted to revert it?`);let u;mP(c,l,r),a||s||(u=await n.repoLock.lock(t));try{for(const t of c){if(void 0!==r&&t.version>r)break;if(!(t.version<=l)){dP(`Migrating version ${t.version}`);try{if(!a){let n=()=>{};o&&(n=(e,n)=>o(t.version,e.toFixed(2),n)),await t.migrate(e,n)}}catch(h){const n=t.version-1;throw dP(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${n}`),await hP(n,e),new Error(`During migration to version ${t.version} exception was raised: ${h.stack||h.message||h}`)}dP(`Migrating to version ${t.version} finished`)}}a||await hP(r||fP(c),e),dP("Repo successfully migrated",void 0!==r?`to version ${r}!`:"to latest version!")}finally{a||s||!u||await u.close()}}async function gP(t,e,n,r,i={}){const s=i.ignoreLock??!1,o=i.onProgress,a=i.isDryRun??!1,c=i.migrations??nP;if(!t)throw new yP.RequiredParameterError("Path argument is required!");if(!n)throw new yP.RequiredParameterError("repoOptions argument is required!");if(!r)throw new yP.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(r)||r<=0)throw new yP.InvalidValueError("Version has to be positive integer!");e=mO(e);const l=await uP(e);if(l===r)return void dP("Nothing to revert.");if(l<r)throw new yP.InvalidValueError(`Current repo's version (${l}) is lower then toVersion (${r}), you probably wanted to migrate it?`);let u;mP(c,r,l,!0),a||s||(u=await n.repoLock.lock(t)),dP(`Reverting from version ${l} to ${r}`);try{const t=c.slice().reverse();for(const n of t){if(n.version<=r)break;if(!(n.version>l)){dP(`Reverting migration version ${n.version}`);try{if(!a){let t=()=>{};o&&(t=(t,e)=>o(n.version,t.toFixed(2),e)),await n.revert(e,t)}}catch(h){const t=n.version;throw dP(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${t}`),await hP(t,e),h.message=`During reversion to version ${n.version} exception was raised: ${h.message}`,h}dP(`Reverting to version ${n.version} finished`)}}a||await hP(r,e),dP(`All migrations successfully reverted to version ${r}!`)}finally{a||s||!u||await u.close()}}function mP(t,e,n,r=!1){let i=0;for(const s of t){if(s.version>n)break;if(s.version>e){if(r&&!s.revert)throw new yP.NonReversibleMigrationError(`It is not possible to revert to version ${e} because migration version ${s.version} is not reversible. Cancelling reversion.`);i++}}if(i!==n-e)throw new yP.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${e} to ${n}`)}const yP=A;var wP=n(9149);class bP extends Error{constructor(t){super(t),this.name="LockExistsError",this.code=bP.code}}bP.code="ERR_LOCK_EXISTS";class vP extends Error{constructor(t){super(t),this.name="NotFoundError",this.code=vP.code}}vP.code="ERR_NOT_FOUND";class EP extends Error{constructor(t){super(t),this.name="InvalidRepoVersionError",this.code=EP.code}}EP.code="ERR_INVALID_REPO_VERSION";const _P="ERR_REPO_NOT_INITIALIZED",SP="ERR_REPO_ALREADY_OPEN",AP="ERR_REPO_ALREADY_CLOSED";async function CP(t,e,n){const r=await e(t);if(r)return r;const i=TP(n);return!!i&&new Promise(((e,n)=>{const r=i.store("readonly").get(t.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{e(Boolean(r.result))}}))}async function IP(t,e,n,r){if(await n(t))return e(t);const i=TP(r);if(!i)throw new vP;return new Promise(((e,n)=>{const r=i.store("readonly").get(t.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{if(r.result)return e(r.result);n(new vP)}}))}function TP(t){let e=t;while(e.db||e.child)if(e=e.db||e.child,"level-js"===e.type||"Level"===e.constructor.name)return e}const kP=it("ipfs:repo:version"),RP=new rl("version");function NP(t){return{async exists(){return CP(RP,t.has.bind(t),t)},async get(){const e=await IP(RP,t.get.bind(t),t.has.bind(t),t);return parseInt(sa(e),10)},set(e){return t.put(RP,Ho(String(e)))},async check(t){const e=await this.get();kP("comparing version: %s and %s",e,t);const n=6===e&&7===t||6===t&&7===e;return e===t||n}}}const DP=yu["default"]?yu["default"]:yu,OP=new rl("config");function PP(t){const e=new DP({concurrency:1}),n={async getAll(e={}){const n=await IP(OP,t.get.bind(t),t.has.bind(t),t);return JSON.parse(sa(n))},async get(t,e={}){if(null==t)throw new vP(`Key ${t} does not exist in config`);const n=await this.getAll(e),r=OD(n,t);if(void 0===r)throw new vP(`Key ${t} does not exist in config`);return r},set(t,n,i={}){if("string"!==typeof t&&!(t instanceof String))throw Vt(new Error("Invalid key type: "+typeof t),"ERR_INVALID_KEY");if(void 0===n||n instanceof Uint8Array)throw Vt(new Error("Invalid value type: "+typeof n),"ERR_INVALID_VALUE");return e.add((()=>r({key:t,value:n},i.signal)))},replace(t,n={}){if(!t||t instanceof Uint8Array)throw Vt(new Error("Invalid value type: "+typeof t),"ERR_INVALID_VALUE");return e.add((()=>r({key:void 0,value:t},n.signal)))},async exists(){return CP(OP,t.has.bind(t),t)}};return n;async function r(t,e){if(e&&e.aborted)return;const r=t.key,s=t.value;if(r){const t=await n.getAll();return"object"===typeof t&&null!==t&&hT(t,r,s),i(t)}return i(s)}function i(e){const n=Ho(JSON.stringify(e,null,2));return t.put(OP,n)}}function xP(t){if("object"!==typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return(null===e||e===Object.prototype||null===Object.getPrototypeOf(e))&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)}function MP(t,e={}){if(!xP(t)&&!Array.isArray(t))throw new TypeError("Expected a plain object or array");const{deep:n,compare:r}=e,i=[],s=[],o=t=>{const e=i.indexOf(t);if(-1!==e)return s[e];const n=[];return i.push(t),s.push(n),n.push(...t.map((t=>Array.isArray(t)?o(t):xP(t)?a(t):t))),n},a=t=>{const e=i.indexOf(t);if(-1!==e)return s[e];const c={},l=Object.keys(t).sort(r);i.push(t),s.push(c);for(const r of l){const e=t[r];let i;i=n&&Array.isArray(e)?o(e):n&&xP(e)?a(e):e,Object.defineProperty(c,r,{...Object.getOwnPropertyDescriptor(t,r),value:i})}return c};return Array.isArray(t)?n?o(t):t.slice():a(t)}const LP=new rl("datastore_spec");function BP(t){return{exists(){return t.has(LP)},async get(){const e=await t.get(LP);return JSON.parse(sa(e))},async set(e){return t.put(LP,Ho(JSON.stringify(MP(e,{deep:!0}))))}}}const UP=new rl("api");function FP(t){return{async get(){const e=await t.get(UP);return e&&e.toString()},set(e){return t.put(UP,Ho(e.toString()))},delete(){return t.delete(UP)}}}n(4633);function zP(t){return{open(){return t.open()},close(){return t.close()},query(e,n){return t.query(e,n)},queryKeys(e,n){return t.queryKeys(e,n)},async get(e,n){const r=VP(e);return r.isIdentity?Promise.resolve(r.digest):t.get(e,n)},async*getMany(t,e){for await(const n of t)yield this.get(n,e)},async put(e,n,r){const{isIdentity:i}=VP(e);i||await t.put(e,n,r)},async*putMany(e,n){const r=sm({objectMode:!0}),i=globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout;i((async()=>{try{await Zg(t.putMany(async function*(){for await(const{key:t,value:n}of e)VP(t).isIdentity||(yield{key:t,value:n}),r.push({key:t,value:n})}())),r.end()}catch(uS){r.end(uS)}})),yield*r},has(e,n){const{isIdentity:r}=VP(e);return r?Promise.resolve(!0):t.has(e,n)},delete(e,n){const{isIdentity:r}=VP(e);return r?Promise.resolve():t.delete(e,n)},deleteMany(e,n){return t.deleteMany(tm(e,(t=>!VP(t).isIdentity)),n)},batch(){const e=t.batch();return{put(t,n){const{isIdentity:r}=VP(t);r||e.put(t,n)},delete(t){const{isIdentity:n}=VP(t);n||e.delete(t)},commit:t=>e.commit(t)}}}}function VP(t){const e=Me.asCID(t);if(null==e)throw Vt(new Error("Not a valid cid"),"ERR_INVALID_CID");return e.multihash.code!==Ys.code?{isIdentity:!1}:{isIdentity:!0,digest:e.multihash.digest}}const jP=it("ipfs:repo:lock:memory"),HP="repo.lock",$P={};async function KP(t){const e=t+"/"+HP;if(jP("locking %s",e),!0===$P[e])throw new bP(`Lock already being held for file: ${e}`);$P[e]=!0;const n={async close(){$P[e]&&delete $P[e]}};return n}async function GP(t){const e=t+"/"+HP;return jP(`checking lock: ${e}`),Boolean($P[e])}const qP={lock:KP,locked:GP};var WP={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:qP},YP={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};function XP(t){const e=Me.asCID(t);if(null==e)throw Vt(new Error("Not a valid cid"),"ERR_INVALID_CID");const n=Tt.encode(e.multihash.bytes);return new rl("/"+n.slice(1).toUpperCase(),!1)}function QP(t){return Re(Tt.decode(`b${t.toString().toLowerCase().substring(1)}`))}const JP=it("ipfs:repo:utils:walk-dag");async function*ZP(t,e,n,r){try{const i=await e.get(t,r),s=await n(t.code),o=CT({bytes:i,cid:t,codec:s});for(const[,t]of o.links())yield t,yield*ZP(t,e,n,r)}catch(uS){throw JP("Could not walk DAG for CID",t.toString(),uS),uS}}class tx extends Map{constructor(t={}){if(super(),!(t.maxSize&&t.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"===typeof t.maxAge&&0===t.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=t.maxSize,this.maxAge=t.maxAge||Number.POSITIVE_INFINITY,this.onEviction=t.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(t){if("function"===typeof this.onEviction)for(const[e,n]of t)this.onEviction(e,n.value)}_deleteIfExpired(t,e){return"number"===typeof e.expiry&&e.expiry<=Date.now()&&("function"===typeof this.onEviction&&this.onEviction(t,e.value),this.delete(t))}_getOrDeleteIfExpired(t,e){const n=this._deleteIfExpired(t,e);if(!1===n)return e.value}_getItemValue(t,e){return e.expiry?this._getOrDeleteIfExpired(t,e):e.value}_peek(t,e){const n=e.get(t);return this._getItemValue(t,n)}_set(t,e){this.cache.set(t,e),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(t,e){this.oldCache.delete(t),this._set(t,e)}*_entriesAscending(){for(const t of this.oldCache){const[e,n]=t;if(!this.cache.has(e)){const r=this._deleteIfExpired(e,n);!1===r&&(yield t)}}for(const t of this.cache){const[e,n]=t,r=this._deleteIfExpired(e,n);!1===r&&(yield t)}}get(t){if(this.cache.has(t)){const e=this.cache.get(t);return this._getItemValue(t,e)}if(this.oldCache.has(t)){const e=this.oldCache.get(t);if(!1===this._deleteIfExpired(t,e))return this._moveToRecent(t,e),e.value}}set(t,e,{maxAge:n=this.maxAge}={}){const r="number"===typeof n&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(t)?this.cache.set(t,{value:e,expiry:r}):this._set(t,{value:e,expiry:r})}has(t){return this.cache.has(t)?!this._deleteIfExpired(t,this.cache.get(t)):!!this.oldCache.has(t)&&!this._deleteIfExpired(t,this.oldCache.get(t))}peek(t){return this.cache.has(t)?this._peek(t,this.cache):this.oldCache.has(t)?this._peek(t,this.oldCache):void 0}delete(t){const e=this.cache.delete(t);return e&&this._size--,this.oldCache.delete(t)||e}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(t){if(!(t&&t>0))throw new TypeError("`maxSize` must be a number greater than 0");const e=[...this._entriesAscending()],n=e.length-t;n<0?(this.cache=new Map(e),this.oldCache=new Map,this._size=e.length):(n>0&&this._emitEvictions(e.slice(0,n)),this.oldCache=new Map(e.slice(n)),this.cache=new Map,this._size=0),this.maxSize=t}*keys(){for(const[t]of this)yield t}*values(){for(const[,t]of this)yield t}*[Symbol.iterator](){for(const t of this.cache){const[e,n]=t,r=this._deleteIfExpired(e,n);!1===r&&(yield[e,n.value])}for(const t of this.oldCache){const[e,n]=t;if(!this.cache.has(e)){const t=this._deleteIfExpired(e,n);!1===t&&(yield[e,n.value])}}}*entriesDescending(){let t=[...this.cache];for(let e=t.length-1;e>=0;--e){const n=t[e],[r,i]=n,s=this._deleteIfExpired(r,i);!1===s&&(yield[r,i.value])}t=[...this.oldCache];for(let e=t.length-1;e>=0;--e){const n=t[e],[r,i]=n;if(!this.cache.has(r)){const t=this._deleteIfExpired(r,i);!1===t&&(yield[r,i.value])}}}*entriesAscending(){for(const[t,e]of this._entriesAscending())yield[t,e.value]}get size(){if(!this._size)return this.oldCache.size;let t=0;for(const e of this.oldCache.keys())this.cache.has(e)||t++;return Math.min(this._size+t,this.maxSize)}entries(){return this.entriesAscending()}forEach(t,e=this){for(const[n,r]of this.entriesAscending())t.call(e,r,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const ex=2048;function nx(t){const e=`Invalid type '${t}', must be one of {direct, indirect, recursive, all}`;return Vt(new Error(e),"ERR_INVALID_PIN_TYPE")}class rx{constructor({pinstore:t,blockstore:e,loadCodec:n}){this.pinstore=t,this.blockstore=e,this.loadCodec=n,this.log=it("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(t,e={}){await this.blockstore.get(t,e);const n={depth:0};return 0!==t.version&&(n.version=t.version),t.code!==wn&&(n.codec=t.code),e.metadata&&(n.metadata=e.metadata),this.pinstore.put(XP(t),Mi(n))}unpin(t,e){return this.pinstore.delete(XP(t),e)}async pinRecursively(t,e={}){await this.fetchCompleteDag(t,e);const n={depth:1/0};0!==t.version&&(n.version=t.version),t.code!==wn&&(n.codec=t.code),e.metadata&&(n.metadata=e.metadata),await this.pinstore.put(XP(t),Mi(n))}async*directKeys(t){for await(const e of this.pinstore.query({filters:[t=>{const e=Hi(t.value);return 0===e.depth}]})){const t=Hi(e.value),n=t.version||0,r=null!=t.codec?t.codec:wn,i=QP(e.key);yield{cid:Me.create(n,r,i),metadata:t.metadata}}}async*recursiveKeys(t){for await(const e of this.pinstore.query({filters:[t=>{const e=Hi(t.value);return e.depth===1/0}]})){const t=Hi(e.value),n=t.version||0,r=null!=t.codec?t.codec:wn,i=QP(e.key);yield{cid:Me.create(n,r,i),metadata:t.metadata}}}async*indirectKeys(t){for await(const{cid:e}of this.recursiveKeys())for await(const n of ZP(e,this.blockstore,this.loadCodec,t)){const t=[Xu.recursive],e=await this.isPinnedWithType(n,t);e.pinned||(yield n)}}async isPinnedWithType(t,e,n){Array.isArray(e)||(e=[e]);const r=e.includes(Xu.all),i=e.includes(Xu.direct),s=e.includes(Xu.recursive),o=e.includes(Xu.indirect);if(s||i||r){const n=await rk(this.pinstore.query({prefix:XP(t).toString(),filters:[t=>{if(r)return!0;const n=Hi(t.value);return e.includes(0===n.depth?Xu.direct:Xu.recursive)}],limit:1}));if(n){const e=Hi(n.value);return{cid:t,pinned:!0,reason:0===e.depth?Xu.direct:Xu.recursive,metadata:e.metadata}}}const a=this;async function*c(t,e){for await(const{cid:n}of e)for await(const e of ZP(n,a.blockstore,a.loadCodec))if(e.equals(t))return void(yield n)}if(r||o){const e=await rk(c(t,this.recursiveKeys()));if(e)return{cid:t,pinned:!0,reason:Xu.indirect,parent:e}}return{cid:t,pinned:!1}}async fetchCompleteDag(t,e={}){const n=new tx({maxSize:e.cidCacheMaxSize??ex}),r=async(t,e)=>{if(n.has(t.toString()))return;n.set(t.toString(),!0);const i=await this.blockstore.get(t,e),s=await this.loadCodec(t.code),o=CT({bytes:i,cid:t,codec:s});await Promise.all([...o.links()].map((([,t])=>r(t,e))))};await r(t,e)}static checkPinType(t){if("string"!==typeof t||!Object.keys(Xu).includes(t))throw nx(t);return!0}}function ix(t,e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){return e.get(t,n)},async*getMany(t,n){yield*e.getMany(t,n)},async put(t,n,r){await e.put(t,n,r)},async*putMany(t,n){yield*e.putMany(t,n)},has(t,n){return e.has(t,n)},async delete(n,r){return await sx(n,t),e.delete(n,r)},deleteMany(n,r){return e.deleteMany(ky(n,(async e=>(await sx(e,t),e))),r)},batch(){return e.batch()}}}async function sx(t,e){const{pinned:n,reason:r}=await e.isPinnedWithType(t,Xu.all);if(n)throw Vt(new Error(`pinned: ${r}`),"ERR_BLOCK_PINNED")}async function*ox(t,e=1){for await(const n of Wy(t,e)){const t=n.map((async t=>await t().then((t=>({ok:!0,value:t})),(t=>({ok:!1,err:t})))));for(let e=0;e<t.length;e++){const n=await t[e];if(!n.ok)throw n.err;yield n.value}}}const ax=it("ipfs:repo:gc"),cx=oh().code,lx=256,ux=new rl("/local/filesroot");function hx({gcLock:t,pins:e,blockstore:n,root:r,loadCodec:i}){async function*s(){const s=Date.now();ax("Creating set of marked blocks");const o=await t.writeLock();try{const t=await dx({pins:e,blockstore:n,root:r,loadCodec:i}),o=n.queryKeys({});yield*fx({blockstore:n},t,o),ax(`Complete (${Date.now()-s}ms)`)}finally{o()}}return s}async function dx({pins:t,blockstore:e,loadCodec:n,root:r}){const i=async function*(){let t;try{t=await r.get(ux)}catch(uS){if(uS.code===cx)return void ax("No blocks in MFS");throw uS}const i=Me.decode(t);yield i,yield*ZP(i,e,n)}(),s=gm(ky(t.recursiveKeys(),(({cid:t})=>t)),t.indirectKeys(),ky(t.directKeys(),(({cid:t})=>t)),i),o=new Set;for await(const a of gm(s,i))o.add(Tt.encode(a.multihash.bytes));return o}async function*fx({blockstore:t},e,n){let r=0,i=0;const s=async n=>async function(){r++;try{const r=Tt.encode(n.multihash.bytes);if(e.has(r))return null;try{await t.delete(n),i++}catch(uS){return{err:new Error(`Could not delete block with CID ${n}: ${uS.message}`)}}return{cid:n}}catch(uS){const e=`Could delete block with CID ${n}`;return ax(e,uS),{err:new Error(e+`: ${uS.message}`)}}};yield*vm(ox(ky(n,s),lx),(t=>tm(t,Boolean))),ax(`Marked set has ${e.size} unique blocks. Blockstore has ${r} blocks. Deleted ${i} blocks.`)}const px=it("ipfs:repo"),gx=Number.MAX_SAFE_INTEGER,mx="repoAutoMigrate";class yx{constructor(t,e,n,r){if("string"!==typeof t)throw new Error("missing repo path");if("function"!==typeof e)throw new Error("missing codec loader");this.options=nt(WP,r),this.closed=!0,this.path=t,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;const i=n.blocks,s=n.pins;this.pins=new rx({pinstore:s,blockstore:i,loadCodec:e});const o=ix(this.pins,i);this.blocks=zP(o),this.version=NP(this.root),this.config=PP(this.root),this.spec=BP(this.root),this.apiAddr=FP(this.root),this.gcLock=Zk({name:t,singleProcess:!1!==this.options.repoOwner}),this.gc=hx({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:e})}async init(t){px("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(vx(t)),await this.spec.set(Ex(t)),await this.version.set(ID)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch(uS){return!1}}async open(){if(!this.closed)throw Vt(new Error("repo is already open"),SP);px("opening at: %s",this.path);try{await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),px("acquired repo.lock");const t=await this.version.check(ID);if(!t){if(!await this._isAutoMigrationEnabled())throw new EP("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");await this._migrate(ID,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys})}px("creating datastore"),await this.datastore.open(),px("creating blocks"),await this.blocks.open(),px("creating keystore"),await this.keys.open(),px("creating pins"),await this.pins.pinstore.open(),this.closed=!1,px("all opened")}catch(uS){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(t){px("error removing lock",t)}throw uS}}async _openRoot(){try{await this.root.open()}catch(uS){if("Already open"!==uS.message)throw uS}}async _openLock(){const t=await this.options.repoLock.lock(this.path);if("function"!==typeof t.close)throw Vt(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return t}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){let t;px("init check");try{[t]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(uS){if("ERR_NOT_FOUND"===uS.code)throw Vt(new Error("repo is not initialized yet"),_P,{path:this.path});throw uS}if(!t)throw Vt(new Error("repo is not initialized yet"),_P,{path:this.path})}async close(){if(this.closed)throw Vt(new Error("repo is already closed"),AP);px("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(uS){if(uS.code!==_P&&!uS.message.startsWith("ENOENT"))throw uS}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map((t=>t&&t.close()))),px("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[t,e,n,r,i]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),wx(this.datastore),wx(this.keys)]),s=e.size+r+i;return{repoPath:this.path,storageMax:t,version:n,numObjects:e.count,repoSize:s}}throw Vt(new Error("repo is not initialized yet"),_P,{path:this.path})}async _isAutoMigrationEnabled(){if(void 0!==this.options.autoMigrate)return this.options.autoMigrate;let t;try{t=await this.config.get(mx)}catch(e){if(e.code!==vP.code)throw e;t=!0}return t}async _migrate(t,e){const n=await this.version.get();return n>t?(px(`reverting to version ${t}`),gP(this.path,e,this.options,t,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(px(`migrating to version ${t}`),pP(this.path,e,this.options,t,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const t=await this.config.get("Datastore.StorageMax");return BigInt(wP(t))}catch(uS){return BigInt(gx)}}async _blockStat(){let t=BigInt(0),e=BigInt(0);if(this.blocks)for await(const{key:n,value:r}of this.blocks.query({}))t+=BigInt(1),e+=BigInt(r.byteLength),e+=BigInt(n.bytes.byteLength);return{count:t,size:e}}}async function wx(t){let e=BigInt(0);for await(const n of t.query({}))e+=BigInt(n.value.byteLength),e+=BigInt(n.key.uint8Array().byteLength);return e}function bx(t,e,n,r){return new yx(t,e,n,r)}function vx(t){return t.Datastore=Object.assign({},YP,OD(t,"datastore")),t}function Ex(t){const e={...YP.Spec,...OD(t,"Datastore.Spec")};return{type:e.type,mounts:e.mounts.map((t=>({mountpoint:t.mountpoint,type:t.child.type,path:t.child.path,shardFunc:t.child.shardFunc})))}}async function*_x(t,e){const n=await Qg(t);yield*n.sort(e)}var Sx=n(7914);class Ax extends nm{constructor(t,e={}){super(),this.db="string"===typeof t?new Sx.Level(t,{...e,keyEncoding:"utf8",valueEncoding:"view"}):t,this.opts={createIfMissing:!0,compression:!1,...e}}async open(){try{await this.db.open(this.opts)}catch(uS){throw rh(uS)}}async put(t,e){try{await this.db.put(t.toString(),e)}catch(uS){throw sh(uS)}}async get(t){let e;try{e=await this.db.get(t.toString())}catch(uS){if(uS.notFound)throw oh(uS);throw sh(uS)}return e}async has(t){try{await this.db.get(t.toString())}catch(uS){if(uS.notFound)return!1;throw uS}return!0}async delete(t){try{await this.db.del(t.toString())}catch(uS){throw ih(uS)}}close(){return this.db&&this.db.close()}batch(){const t=[];return{put:(e,n)=>{t.push({type:"put",key:e.toString(),value:n})},delete:e=>{t.push({type:"del",key:e.toString()})},commit:()=>this.db.batch(t)}}query(t){let e=this._query({values:!0,prefix:t.prefix});Array.isArray(t.filters)&&(e=t.filters.reduce(((t,e)=>tm(t,e)),e)),Array.isArray(t.orders)&&(e=t.orders.reduce(((t,e)=>_x(t,e)),e));const{offset:n,limit:r}=t;if(n){let t=0;e=tm(e,(()=>t++>=n))}return r&&(e=em(e,r)),e}queryKeys(t){let e=ky(this._query({values:!1,prefix:t.prefix}),(({key:t})=>t));Array.isArray(t.filters)&&(e=t.filters.reduce(((t,e)=>tm(t,e)),e)),Array.isArray(t.orders)&&(e=t.orders.reduce(((t,e)=>_x(t,e)),e));const{offset:n,limit:r}=t;if(n){let t=0;e=tm(e,(()=>t++>=n))}return r&&(e=em(e,r)),e}_query(t){const e={keys:!0,keyEncoding:"buffer",values:t.values};if(null!=t.prefix){const n=t.prefix.toString();e.gte=n,e.lt=n+"ÿ"}const n=this.db.iterator(e);if(n[Symbol.asyncIterator])return Cx(n);if(null!=n.next&&null!=n.end)return Ix(n);throw new Error("Level returned incompatible iterator")}}async function*Cx(t){for await(const[e,n]of t)yield{key:new rl(e,!1),value:n};await t.close()}function Ix(t){return{[Symbol.asyncIterator](){return{next:()=>new Promise(((e,n)=>{t.next(((r,i,s)=>r?n(r):null==i?t.end((t=>{if(t)return n(t);e({done:!0,value:void 0})})):void e({done:!1,value:{key:new rl(i,!1),value:s}})))})),return:()=>new Promise(((e,n)=>{t.end((t=>{if(t)return n(t);e({done:!0,value:void 0})}))}))}}}}var Tx=n(1555),kx=n(2386),Rx=n(4753),Nx=n(5101);const Dx=(t,e)=>async function*(){const n=await Nx(t);yield*n.sort(e)}();class Ox{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(t,e,n){return Promise.reject(new Error(".put is not implemented"))}get(t,e){return Promise.reject(new Error(".get is not implemented"))}has(t,e){return Promise.reject(new Error(".has is not implemented"))}delete(t,e){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(t,e={}){for await(const{key:n,value:r}of t)await this.put(n,r,e),yield{key:n,value:r}}async*getMany(t,e={}){for await(const n of t)yield this.get(n,e)}async*deleteMany(t,e={}){for await(const n of t)await this.delete(n,e),yield n}batch(){let t=[],e=[];return{put(e,n){t.push({key:e,value:n})},delete(t){e.push(t)},commit:async n=>{await Tx(this.putMany(t,n)),t=[],await Tx(this.deleteMany(e,n)),e=[]}}}async*_all(t,e){throw new Error("._all is not implemented")}async*_allKeys(t,e){throw new Error("._allKeys is not implemented")}query(t,e){let n=this._all(t,e);if(null!=t.prefix&&(n=kx(n,(e=>e.key.toString().startsWith(t.prefix||"")))),Array.isArray(t.filters)&&(n=t.filters.reduce(((t,e)=>kx(t,e)),n)),Array.isArray(t.orders)&&(n=t.orders.reduce(((t,e)=>Dx(t,e)),n)),null!=t.offset){let e=0;n=kx(n,(()=>e++>=(t.offset||0)))}return null!=t.limit&&(n=Rx(n,t.limit)),n}queryKeys(t,e){let n=this._allKeys(t,e);if(null!=t.prefix&&(n=kx(n,(e=>e.toString().startsWith(t.prefix||"")))),Array.isArray(t.filters)&&(n=t.filters.reduce(((t,e)=>kx(t,e)),n)),Array.isArray(t.orders)&&(n=t.orders.reduce(((t,e)=>Dx(t,e)),n)),null!=t.offset){let e=0;n=kx(n,(()=>e++>=t.offset))}return null!=t.limit&&(n=Rx(n,t.limit)),n}}function Px(t){const e=Me.asCID(t);if(!e)throw Vt(new Error("Not a valid cid"),"ERR_INVALID_CID");return new rl("/"+Tt.encode(e.multihash.bytes).slice(1).toUpperCase(),!1)}function xx(t){return Me.createV1(go,Re(Tt.decode("b"+t.toString().slice(1).toLowerCase())))}function Mx(t){const e=t.substring(0,1);if("/"===e)return Mx(t.substring(1));let n,r;n="b"===e.toLowerCase()?t=>Tt.decode(t.toLowerCase()).subarray(2):"c"===e.toLowerCase()?t=>Rt.decode(t.toLowerCase()).subarray(2):"z"===e?t=>Ct.decode(t).subarray(2):"Q"===e?t=>Ct.decode("z"+t):t=>Tt.decode("b"+t.toLowerCase()).subarray(2);for(let s=1;s<t.length;s++)try{r=n(t.substring(0,s))}catch(uS){if("Unexpected end of data"!==uS.message)throw uS}let i="/C";return r&&(i=`/${Tt.encode(r).slice(1,-1).toUpperCase()||"C"}`),i}function Lx(t){return{...t,prefix:t.prefix?Mx(t.prefix):void 0,filters:t.filters?t.filters.map((t=>e=>t({key:xx(e.key),value:e.value}))):void 0,orders:t.orders?t.orders.map((t=>(e,n)=>t({key:xx(e.key),value:e.value},{key:xx(n.key),value:n.value}))):void 0}}function Bx(t){return{...t,prefix:t.prefix?Mx(t.prefix):void 0,filters:t.filters?t.filters.map((t=>e=>t(xx(e)))):void 0,orders:t.orders?t.orders.map((t=>(e,n)=>t(xx(e),xx(n)))):void 0}}class Ux extends Ox{constructor(t){super(),this.child=t}open(){return this.child.open()}close(){return this.child.close()}async*query(t,e){for await(const{key:n,value:r}of this.child.query(Lx(t),e))yield{key:xx(n),value:r}}async*queryKeys(t,e){for await(const n of this.child.queryKeys(Bx(t),e))yield xx(n)}async get(t,e){return this.child.get(Px(t),e)}async*getMany(t,e){for await(const n of t)yield this.get(n,e)}async put(t,e,n){await this.child.put(Px(t),e,n)}async*putMany(t,e){const n=sm({objectMode:!0}),r=globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout;r((async()=>{try{const r=this.child;await Zg(this.child.putMany(async function*(){for await(const i of t){const t=Px(i.key),s=await r.has(t,e);s||(yield{key:t,value:i.value}),n.push(i)}}())),n.end()}catch(uS){n.end(uS)}})),yield*n}has(t,e){return this.child.has(Px(t),e)}delete(t,e){return this.child.delete(Px(t),e)}deleteMany(t,e){const n=sm({objectMode:!0});return Zg(this.child.deleteMany(async function*(){for await(const e of t)yield Px(e),n.push(e);n.end()}(),e)).catch((t=>{n.end(t)})),n}}function Fx(t,e,n){const r=n.path||"ipfs";return bx(r,(t=>e.getCodec(t)),{root:new Ax(r,{prefix:"",version:2}),blocks:new Ux(new Ax(`${r}/blocks`,{prefix:"",version:2})),datastore:new Ax(`${r}/datastore`,{prefix:"",version:2}),keys:new Ax(`${r}/keys`,{prefix:"",version:2}),pins:new Ax(`${r}/pins`,{prefix:"",version:2})},{autoMigrate:n.autoMigrate,onMigrationProgress:n.onMigrationProgress||t,repoLock:qP})}const zx={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var Vx;function jx(t){return t instanceof Uint8Array?{get(e){return t[e]},set(e,n){t[e]=n}}:{get(e){return t.get(e)},set(e,n){t.set(e,n)}}}(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.publicKey&&t.publicKey.byteLength>0)&&(e.uint32(10),e.bytes(t.publicKey)),(!0===n.writeDefaults||null!=t.payloadType&&t.payloadType.byteLength>0)&&(e.uint32(18),e.bytes(t.payloadType)),(!0===n.writeDefaults||null!=t.payload&&t.payload.byteLength>0)&&(e.uint32(26),e.bytes(t.payload)),(!0===n.writeDefaults||null!=t.signature&&t.signature.byteLength>0)&&(e.uint32(42),e.bytes(t.signature)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.publicKey=t.bytes();break;case 2:n.payloadType=t.bytes();break;case 3:n.payload=t.bytes();break;case 5:n.signature=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(Vx||(Vx={}));const Hx=4294967296;class $x{constructor(t=0,e=0){this.hi=t,this.lo=e}toBigInt(t){if(!0===t)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!==0){const t=1+~this.lo>>>0;let e=~this.hi>>>0;return 0===t&&(e=e+1>>>0),-(BigInt(t)+(BigInt(e)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(t){return Number(this.toBigInt(t))}zzDecode(){const t=-(1&this.lo),e=((this.lo>>>1|this.hi<<31)^t)>>>0,n=(this.hi>>>1^t)>>>0;return new $x(n,e)}zzEncode(){const t=this.hi>>31,e=((this.hi<<1|this.lo>>>31)^t)>>>0,n=(this.lo<<1^t)>>>0;return new $x(e,n)}toBytes(t,e=0){const n=jx(t);while(this.hi>0)n.set(e++,127&this.lo|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;while(this.lo>127)n.set(e++,127&this.lo|128),this.lo=this.lo>>>7;n.set(e++,this.lo)}static fromBigInt(t){if(0n===t)return new $x;const e=t<0;e&&(t=-t);let n=0|Number(t>>32n),r=0|Number(t-(BigInt(n)<<32n));return e&&(n=~n>>>0,r=~r>>>0,++r>Hx&&(r=0,++n>Hx&&(n=0))),new $x(n,r)}static fromNumber(t){if(0===t)return new $x;const e=t<0;e&&(t=-t);let n=t>>>0,r=(t-n)/4294967296>>>0;return e&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new $x(r,n)}static fromBytes(t,e=0){const n=jx(t),r=new $x;let i=0;if(t.length-e>4){for(;i<4;++i)if(r.lo=(r.lo|(127&n.get(e))<<7*i)>>>0,n.get(e++)<128)return r;if(r.lo=(r.lo|(127&n.get(e))<<28)>>>0,r.hi=(r.hi|(127&n.get(e))>>4)>>>0,n.get(e++)<128)return r;i=0}else for(;i<4;++i){if(e>=t.length)throw RangeError(`index out of range: ${e} > ${t.length}`);if(r.lo=(r.lo|(127&n.get(e))<<7*i)>>>0,n.get(e++)<128)return r}if(t.length-e>4){for(;i<5;++i)if(r.hi=(r.hi|(127&n.get(e))<<7*i+3)>>>0,n.get(e++)<128)return r}else if(e<t.byteLength)for(;i<5;++i){if(e>=t.length)throw RangeError(`index out of range: ${e} > ${t.length}`);if(r.hi=(r.hi|(127&n.get(e))<<7*i+3)>>>0,n.get(e++)<128)return r}throw RangeError("invalid varint encoding")}}const Kx=Math.pow(2,7),Gx=Math.pow(2,14),qx=Math.pow(2,21),Wx=Math.pow(2,28),Yx=Math.pow(2,35),Xx=Math.pow(2,42),Qx=Math.pow(2,49),Jx=Math.pow(2,56),Zx=Math.pow(2,63),tM={encodingLength(t){return t<Kx?1:t<Gx?2:t<qx?3:t<Wx?4:t<Yx?5:t<Xx?6:t<Qx?7:t<Jx?8:t<Zx?9:10},encode(t,e,n=0){if(null!=Number.MAX_SAFE_INTEGER&&t>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return null==e&&(e=Bo(tM.encodingLength(t))),$x.fromNumber(t).toBytes(e,n),e},decode(t,e=0){return $x.fromBytes(t,e).toNumber(!0)}};class eM{constructor(t){const{peerId:e,payloadType:n,payload:r,signature:i}=t;this.peerId=e,this.payloadType=n,this.payload=r,this.signature=i}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=Vx.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(t){return Xa(this.marshal(),t.marshal())}async validate(t){const e=nM(t,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");const n=qp(this.peerId.publicKey);return await n.verify(e.subarray(),this.signature)}}eM.createFromProtobuf=async t=>{const e=Vx.decode(t),n=await Hu(e.publicKey);return new eM({peerId:n,payloadType:e.payloadType,payload:e.payload,signature:e.signature})},eM.seal=async(t,e)=>{if(null==e.privateKey)throw new Error("Missing private key");const n=t.domain,r=t.codec,i=t.marshal(),s=nM(n,r,i),o=await Yp(e.privateKey),a=await o.sign(s.subarray());return new eM({peerId:e,payloadType:r,payload:i,signature:a})},eM.openAndCertify=async(t,e)=>{const n=await eM.createFromProtobuf(t),r=await n.validate(e);if(!r)throw Vt(new Error("envelope signature is not valid for the given domain"),zx.ERR_SIGNATURE_NOT_VALID);return n};const nM=(t,e,n)=>{const r=Ho(t),i=tM.encode(r.byteLength),s=tM.encode(e.length),o=tM.encode(n.length);return new Cw(i,r,s,e,o,n)};function rM(t,e){const n=(t,e)=>t.toString().localeCompare(e.toString());return t.length===e.length&&(e.sort(n),t.sort(n).every(((t,n)=>e[n].equals(t))))}var iM;(function(t){let e,n;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.multiaddr&&t.multiaddr.byteLength>0)&&(e.uint32(10),e.bytes(t.multiaddr)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={multiaddr:new Uint8Array(0)},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.multiaddr=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(e=t.AddressInfo||(t.AddressInfo={})),t.codec=()=>(null==n&&(n=kh(((e,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),(!0===r.writeDefaults||null!=e.peerId&&e.peerId.byteLength>0)&&(n.uint32(10),n.bytes(e.peerId)),!0!==r.writeDefaults&&0n===e.seq||(n.uint32(16),n.uint64(e.seq)),null!=e.addresses)for(const i of e.addresses)n.uint32(26),t.AddressInfo.codec().encode(i,n,{writeDefaults:!0});!1!==r.lengthDelimited&&n.ldelim()}),((e,n)=>{const r={peerId:new Uint8Array(0),seq:0n,addresses:[]},i=null==n?e.len:e.pos+n;while(e.pos<i){const n=e.uint32();switch(n>>>3){case 1:r.peerId=e.bytes();break;case 2:r.seq=e.uint64();break;case 3:r.addresses.push(t.AddressInfo.codec().decode(e,e.uint32()));break;default:e.skipType(7&n);break}}return r}))),n),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(iM||(iM={}));const sM="libp2p-peer-record",oM=Uint8Array.from([3,1]);class aM{constructor(t){this.domain=aM.DOMAIN,this.codec=aM.CODEC;const{peerId:e,multiaddrs:n,seqNumber:r}=t;this.peerId=e,this.multiaddrs=n??[],this.seqNumber=r??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=iM.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((t=>({multiaddr:t.bytes})))})),this.marshaled}equals(t){return t instanceof aM&&(!!this.peerId.equals(t.peerId)&&(this.seqNumber===t.seqNumber&&!!rM(this.multiaddrs,t.multiaddrs)))}}aM.createFromProtobuf=t=>{const e=iM.decode(t),n=Vu(e.peerId),r=(e.addresses??[]).map((t=>dc(t.multiaddr))),i=e.seq;return new aM({peerId:n,multiaddrs:r,seqNumber:i})},aM.DOMAIN=sM,aM.CODEC=oM;const cM=Symbol.for("@libp2p/topology");function lM(t){return null!=t&&Boolean(t[cM])}const uM=()=>{};class hM{constructor(t){this.min=t.min??0,this.max=t.max??1/0,this.peers=new Set,this.onConnect=t.onConnect??uM,this.onDisconnect=t.onDisconnect??uM}get[Symbol.toStringTag](){return cM.toString()}get[cM](){return!0}async setRegistrar(t){this.registrar=t}disconnect(t){this.onDisconnect(t)}}function dM(t){return new hM(t)}var fM,pM=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class gM extends EventTarget{constructor(){super(...arguments),fM.set(this,new Map)}listenerCount(t){const e=pM(this,fM,"f").get(t);return null==e?0:e.length}addEventListener(t,e,n){super.addEventListener(t,e,n);let r=pM(this,fM,"f").get(t);null==r&&(r=[],pM(this,fM,"f").set(t,r)),r.push({callback:e,once:(!0!==n&&!1!==n&&n?.once)??!1})}removeEventListener(t,e,n){super.removeEventListener(t.toString(),e??null,n);let r=pM(this,fM,"f").get(t);null!=r&&(r=r.filter((({callback:t})=>t!==e)),pM(this,fM,"f").set(t,r))}dispatchEvent(t){const e=super.dispatchEvent(t);let n=pM(this,fM,"f").get(t.type);return null==n||(n=n.filter((({once:t})=>!t)),pM(this,fM,"f").set(t.type,n)),e}}fM=new WeakMap;class mM extends Event{constructor(t,e){super(t,e),this.detail=e?.detail}}const yM=globalThis.CustomEvent??mM;class wM{constructor(t,e,n){this.gossip=t,this.msgs=new Map,this.history=[],this.msgIdToStrFn=n;for(let r=0;r<e;r++)this.history[r]=[]}get size(){return this.msgs.size}put(t,e,n=!1){const{msgIdStr:r}=t;return!this.msgs.has(r)&&(this.msgs.set(r,{message:e,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...t,topic:e.topic}),!0)}observeDuplicate(t,e){const n=this.msgs.get(t);n&&!n.validated&&n.originatingPeers.add(e)}get(t){return this.msgs.get(this.msgIdToStrFn(t))?.message}getWithIWantCount(t,e){const n=this.msgs.get(t);if(!n)return null;const r=(n.iwantCounts.get(e)??0)+1;return n.iwantCounts.set(e,r),{msg:n.message,count:r}}getGossipIDs(t){const e=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach((n=>{const r=this.msgs.get(n.msgIdStr);if(r&&r.validated&&t.has(n.topic)){let t=e.get(n.topic);t||(t=[],e.set(n.topic,t)),t.push(n.msgId)}}));return e}validate(t){const e=this.msgs.get(t);if(!e)return null;const{message:n,originatingPeers:r}=e;return e.validated=!0,e.originatingPeers=new Set,{message:n,originatingPeers:r}}shift(){const t=this.history[this.history.length-1];t.forEach((t=>{this.msgs.delete(t.msgIdStr)})),this.history.pop(),this.history.unshift([])}remove(t){const e=this.msgs.get(t);return e?(this.msgs.delete(t),e):null}}var bM=n(4581);const{RPC:vM}=bM,EM=1e3,_M=60*EM,SM="/floodsub/1.0.0",AM="/meshsub/1.0.0",CM="/meshsub/1.1.0",IM=6,TM=4,kM=12,RM=4,NM=2,DM=5,OM=3,PM=6,xM=.25,MM=3,LM=100,BM=EM,UM=_M,FM=16,zM=_M,VM=15,jM=300,HM=EM,$M=60,KM=2,GM=10*EM,qM=5e3,WM=10,YM=3*EM,XM=2*_M,QM=12e4,JM="ERR_TOPIC_VALIDATOR_REJECT",ZM="ERR_TOPIC_VALIDATOR_IGNORE",tL=0,eL=128,nL=1e3,rL=1e3;function iL(t=[],e){return{subscriptions:[],messages:t,control:e?{graft:e.graft||[],prune:e.prune||[],ihave:e.ihave||[],iwant:e.iwant||[]}:void 0}}function sL(t){if(t.length<=1)return t;const e=()=>Math.floor(Math.random()*Math.floor(t.length));for(let n=0;n<t.length;n++){const r=e(),i=t[n];t[n]=t[r],t[r]=i}return t}function oL(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";var n=0,r=0,i=0,s=e.length;while(i!==s&&0===e[i])i++,n++;var o=(s-i)*u+1>>>0,l=new Uint8Array(o);while(i!==s){for(var h=e[i],d=0,f=o-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}var p=o-r;while(p!==o&&0===l[p])p++;for(var g=c.repeat(n);p<o;++p)g+=t.charAt(l[p]);return g}function d(t){if("string"!==typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;var e=0;if(" "!==t[e]){var r=0,i=0;while(t[e]===c)r++,e++;var s=(t.length-e)*l+1>>>0,o=new Uint8Array(s);while(t[e]){var u=n[t.charCodeAt(e)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,e++}if(" "!==t[e]){var f=s-i;while(f!==s&&0===o[f])f++;var p=new Uint8Array(r+(s-f)),g=r;while(f!==s)p[g++]=o[f++];return p}}}function f(t){var n=d(t);if(n)return n;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var aL=oL,cL=aL,lL=cL;new Uint8Array(0);const uL=t=>{if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},hL=t=>(new TextEncoder).encode(t),dL=t=>(new TextDecoder).decode(t);class fL{constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class pL{constructor(t,e,n){if(this.name=t,this.prefix=e,void 0===e.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=n}decode(t){if("string"===typeof t){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(t){return mL(this,t)}}class gL{constructor(t){this.decoders=t}or(t){return mL(this,t)}decode(t){const e=t[0],n=this.decoders[e];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const mL=(t,e)=>new gL({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class yL{constructor(t,e,n,r){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=r,this.encoder=new fL(t,e,n),this.decoder=new pL(t,e,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const wL=({name:t,prefix:e,encode:n,decode:r})=>new yL(t,e,n,r),bL=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=lL(n,e);return wL({prefix:t,name:e,encode:r,decode:t=>uL(i(t))})},vL=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;while("="===t[s-1])--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const e=i[t[u]];if(void 0===e)throw new SyntaxError(`Non-${r} character`);c=c<<n|e,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},EL=(t,e,n)=>{const r="="===e[e.length-1],i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c){a=a<<8|t[c],o+=8;while(o>n)o-=n,s+=e[i&a>>o]}if(o&&(s+=e[i&a<<n-o]),r)while(s.length*n&7)s+="=";return s},_L=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>wL({prefix:e,name:t,encode(t){return EL(t,r,n)},decode(e){return vL(e,r,n,t)}}),SL=wL({prefix:"\0",name:"identity",encode:t=>dL(t),decode:t=>hL(t)}),AL=_L({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),CL=_L({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),IL=bL({prefix:"9",name:"base10",alphabet:"0123456789"}),TL=_L({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),kL=_L({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),RL=_L({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),NL=_L({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),DL=_L({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),OL=_L({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),PL=_L({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),xL=_L({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ML=_L({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),LL=_L({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),BL=_L({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),UL=bL({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),FL=bL({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),zL=bL({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),VL=bL({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),jL=_L({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),HL=_L({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$L=_L({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),KL=_L({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),GL=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),qL=GL.reduce(((t,e,n)=>(t[n]=e,t)),[]),WL=GL.reduce(((t,e,n)=>(t[e.codePointAt(0)]=n,t)),[]);function YL(t){return t.reduce(((t,e)=>(t+=qL[e],t)),"")}function XL(t){const e=[];for(const n of t){const t=WL[n.codePointAt(0)];if(void 0===t)throw new Error(`Non-base256emoji character: ${n}`);e.push(t)}return new Uint8Array(e)}const QL=wL({prefix:"🚀",name:"base256emoji",encode:YL,decode:XL});var JL=rB,ZL=128,tB=127,eB=~tB,nB=Math.pow(2,31);function rB(t,e,n){e=e||[],n=n||0;var r=n;while(t>=nB)e[n++]=255&t|ZL,t/=128;while(t&eB)e[n++]=255&t|ZL,t>>>=7;return e[n]=0|t,rB.bytes=n-r+1,e}var iB=aB,sB=128,oB=127;function aB(t,e){var n,r=0,i=(e=e||0,0),s=e,o=t.length;do{if(s>=o)throw aB.bytes=0,new RangeError("Could not decode varint");n=t[s++],r+=i<28?(n&oB)<<i:(n&oB)*Math.pow(2,i),i+=7}while(n>=sB);return aB.bytes=s-e,r}var cB=Math.pow(2,7),lB=Math.pow(2,14),uB=Math.pow(2,21),hB=Math.pow(2,28),dB=Math.pow(2,35),fB=Math.pow(2,42),pB=Math.pow(2,49),gB=Math.pow(2,56),mB=Math.pow(2,63),yB=function(t){return t<cB?1:t<lB?2:t<uB?3:t<hB?4:t<dB?5:t<fB?6:t<pB?7:t<gB?8:t<mB?9:10},wB={encode:JL,decode:iB,encodingLength:yB},bB=wB,vB=bB;const EB=(t,e,n=0)=>(vB.encode(t,e,n),e),_B=t=>vB.encodingLength(t),SB=(t,e)=>{const n=e.byteLength,r=_B(t),i=r+_B(n),s=new Uint8Array(i+n);return EB(t,s,0),EB(n,s,r),s.set(e,i),new AB(t,n,e,s)};class AB{constructor(t,e,n,r){this.code=t,this.size=e,this.digest=n,this.bytes=r}}const CB=({name:t,code:e,encode:n})=>new IB(t,e,n);class IB{constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?SB(this.code,e):e.then((t=>SB(this.code,t)))}throw Error("Unknown type, must be binary type")}}const TB=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),kB=CB({name:"sha2-256",code:18,encode:TB("SHA-256")}),RB=CB({name:"sha2-512",code:19,encode:TB("SHA-512")}),NB=0,DB="identity",OB=uL,PB=t=>SB(NB,OB(t)),xB={code:NB,name:DB,encode:OB,digest:PB},MB="raw",LB=85,BB=t=>uL(t),UB=t=>uL(t),FB=new TextEncoder,zB=new TextDecoder,VB="json",jB=512,HB=t=>FB.encode(JSON.stringify(t)),$B=t=>JSON.parse(zB.decode(t));class KB{constructor(t,e,n,r){this.code=e,this.version=t,this.multihash=n,this.bytes=r,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:cid_hidden,byteLength:cid_hidden,code:cid_readonly,version:cid_readonly,multihash:cid_readonly,bytes:cid_readonly,_baseCache:cid_hidden,asCID:cid_hidden})}toV0(){switch(this.version){case 0:return this;default:{const{code:t,multihash:e}=this;if(t!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return KB.createV0(e)}}}toV1(){switch(this.version){case 0:{const{code:t,digest:e}=this.multihash,n=Digest.create(t,e);return KB.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(t){return t&&this.code===t.code&&this.version===t.version&&Digest.equals(this.multihash,t.multihash)}toString(t){const{bytes:e,version:n,_baseCache:r}=this;switch(n){case 0:return cid_toStringV0(e,r,t||base58btc.encoder);default:return cid_toStringV1(e,r,t||base32.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(t){return deprecate(/^0\.0/,IS_CID_DEPRECATION),!(!t||!t[cid_cidSymbol]&&t.asCID!==t)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(t){if(t instanceof KB)return t;if(null!=t&&t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new KB(e,n,r,i||cid_encodeCID(e,n,r.bytes))}if(null!=t&&!0===t[cid_cidSymbol]){const{version:e,multihash:n,code:r}=t,i=Digest.decode(n);return KB.create(e,r,i)}return null}static create(t,e,n){if("number"!==typeof e)throw new Error("String codecs are no longer supported");switch(t){case 0:if(e!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new KB(t,e,n,n.bytes);case 1:{const r=cid_encodeCID(t,e,n.bytes);return new KB(t,e,n,r)}default:throw new Error("Invalid version")}}static createV0(t){return KB.create(0,cid_DAG_PB_CODE,t)}static createV1(t,e){return KB.create(1,t,e)}static decode(t){const[e,n]=KB.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return e}static decodeFirst(t){const e=KB.inspectBytes(t),n=e.size-e.multihashSize,r=coerce(t.subarray(n,n+e.multihashSize));if(r.byteLength!==e.multihashSize)throw new Error("Incorrect length");const i=r.subarray(e.multihashSize-e.digestSize),s=new Digest.Digest(e.multihashCode,e.digestSize,i,r),o=0===e.version?KB.createV0(s):KB.createV1(e.codec,s);return[o,t.subarray(e.size)]}static inspectBytes(t){let e=0;const n=()=>{const[n,r]=varint.decode(t.subarray(e));return r,n};let r=n(),i=cid_DAG_PB_CODE;if(18===r?(0,0):1===r&&n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=e,o=n(),a=n(),c=e+a,l=c-s;return{version:r,codec:i,multihashCode:o,digestSize:a,multihashSize:l,size:c}}static parse(t,e){const[n,r]=cid_parseCIDtoBytes(t,e),i=KB.decode(r);return i._baseCache.set(n,t),i}}Symbol.for("@ipld/js-cid/CID");const GB={...C,...I,...T,...k,...R,...N,...D,...O,...P,...x};function qB(t){return null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function WB(t=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?qB(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function YB(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const XB=YB("utf8","u",(t=>{const e=new TextDecoder("utf8");return"u"+e.decode(t)}),(t=>{const e=new TextEncoder;return e.encode(t.substring(1))})),QB=YB("ascii","a",(t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}),(t=>{t=t.substring(1);const e=WB(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e})),JB={utf8:XB,"utf-8":XB,hex:GB.base16,latin1:QB,ascii:QB,binary:QB,...GB};var ZB=JB;function tU(t,e="utf8"){const n=ZB[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(t).substring(1):globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8")}function eU(t){return tU(t,"base64")}const nU="StrictSign",rU="StrictNoSign";var iU,sU,oU,aU,cU,lU;function uU(t){switch(t){case oU.Ignore:return aU.Ignore;case oU.Reject:return aU.Reject}}async function hU(t,e){switch(t){case nU:{if(!e)throw Error("Must provide PeerId");if(null==e.privateKey)throw Error("Cannot sign message, no private key present");if(null==e.publicKey)throw Error("Cannot sign message, no public key present");const t=await Yp(e.privateKey);return{type:sU.Signing,author:e,key:e.publicKey,privateKey:t}}case rU:return{type:sU.Anonymous};default:throw new Error(`Unknown signature policy "${t}"`)}}(function(t){t["StrictSign"]="StrictSign",t["StrictNoSign"]="StrictNoSign"})(iU||(iU={})),function(t){t[t["Signing"]=0]="Signing",t[t["Anonymous"]=1]="Anonymous"}(sU||(sU={})),function(t){t["Accept"]="accept",t["Ignore"]="ignore",t["Reject"]="reject"}(oU||(oU={})),function(t){t["Error"]="error",t["Ignore"]="ignore",t["Reject"]="reject",t["Blacklisted"]="blacklisted"}(aU||(aU={})),function(t){t["InvalidSignature"]="invalid_signature",t["InvalidSeqno"]="invalid_seqno",t["InvalidPeerId"]="invalid_peerid",t["SignaturePresent"]="signature_present",t["SeqnoPresent"]="seqno_present",t["FromPresent"]="from_present",t["TransformFailed"]="transform_failed"}(cU||(cU={})),function(t){t["duplicate"]="duplicate",t["invalid"]="invalid",t["valid"]="valid"}(lU||(lU={}));const dU="ERR_INVALID_PEER_SCORE_PARAMS",fU={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},pU={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function gU(t={}){return{...fU,...t,topics:t.topics?Object.entries(t.topics).reduce(((t,[e,n])=>(t[e]=mU(n),t)),{}):{}}}function mU(t={}){return{...pU,...t}}function yU(t){for(const[n,r]of Object.entries(t.topics))try{wU(r)}catch(e){throw Vt(new Error(`invalid score parameters for topic ${n}: ${e.message}`),dU)}if(t.topicScoreCap<0)throw Vt(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),dU);if(null===t.appSpecificScore||void 0===t.appSpecificScore)throw Vt(new Error("missing application specific score function"),dU);if(t.IPColocationFactorWeight>0)throw Vt(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),dU);if(0!==t.IPColocationFactorWeight&&t.IPColocationFactorThreshold<1)throw Vt(new Error("invalid IPColocationFactorThreshold; must be at least 1"),dU);if(t.behaviourPenaltyWeight>0)throw Vt(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),dU);if(0!==t.behaviourPenaltyWeight&&(t.behaviourPenaltyDecay<=0||t.behaviourPenaltyDecay>=1))throw Vt(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),dU);if(t.decayInterval<1e3)throw Vt(new Error("invalid DecayInterval; must be at least 1s"),dU);if(t.decayToZero<=0||t.decayToZero>=1)throw Vt(new Error("invalid DecayToZero; must be between 0 and 1"),dU)}function wU(t){if(t.topicWeight<0)throw Vt(new Error("invalid topic weight; must be >= 0"),dU);if(0===t.timeInMeshQuantum)throw Vt(new Error("invalid TimeInMeshQuantum; must be non zero"),dU);if(t.timeInMeshWeight<0)throw Vt(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),dU);if(0!==t.timeInMeshWeight&&t.timeInMeshQuantum<=0)throw Vt(new Error("invalid TimeInMeshQuantum; must be positive"),dU);if(0!==t.timeInMeshWeight&&t.timeInMeshCap<=0)throw Vt(new Error("invalid TimeInMeshCap; must be positive"),dU);if(t.firstMessageDeliveriesWeight<0)throw Vt(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),dU);if(0!==t.firstMessageDeliveriesWeight&&(t.firstMessageDeliveriesDecay<=0||t.firstMessageDeliveriesDecay>=1))throw Vt(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),dU);if(0!==t.firstMessageDeliveriesWeight&&t.firstMessageDeliveriesCap<=0)throw Vt(new Error("invalid FirstMessageDeliveriesCap; must be positive"),dU);if(t.meshMessageDeliveriesWeight>0)throw Vt(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),dU);if(0!==t.meshMessageDeliveriesWeight&&(t.meshMessageDeliveriesDecay<=0||t.meshMessageDeliveriesDecay>=1))throw Vt(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),dU);if(0!==t.meshMessageDeliveriesWeight&&t.meshMessageDeliveriesCap<=0)throw Vt(new Error("invalid MeshMessageDeliveriesCap; must be positive"),dU);if(0!==t.meshMessageDeliveriesWeight&&t.meshMessageDeliveriesThreshold<=0)throw Vt(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),dU);if(t.meshMessageDeliveriesWindow<0)throw Vt(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),dU);if(0!==t.meshMessageDeliveriesWeight&&t.meshMessageDeliveriesActivation<1e3)throw Vt(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),dU);if(t.meshFailurePenaltyWeight>0)throw Vt(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),dU);if(0!==t.meshFailurePenaltyWeight&&(t.meshFailurePenaltyDecay<=0||t.meshFailurePenaltyDecay>=1))throw Vt(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),dU);if(t.invalidMessageDeliveriesWeight>0)throw Vt(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),dU);if(t.invalidMessageDeliveriesDecay<=0||t.invalidMessageDeliveriesDecay>=1)throw Vt(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),dU)}const bU={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function vU(t={}){return{...bU,...t}}function EU(t,e,n,r){let i=0;Object.entries(e.topics).forEach((([t,e])=>{const r=n.topics[t];if(void 0===r)return;let s=0;if(e.inMesh){let t=e.meshTime/r.timeInMeshQuantum;t>r.timeInMeshCap&&(t=r.timeInMeshCap),s+=t*r.timeInMeshWeight}let o=e.firstMessageDeliveries;if(o>r.firstMessageDeliveriesCap&&(o=r.firstMessageDeliveriesCap),s+=o*r.firstMessageDeliveriesWeight,e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<r.meshMessageDeliveriesThreshold){const t=r.meshMessageDeliveriesThreshold-e.meshMessageDeliveries,n=t*t;s+=n*r.meshMessageDeliveriesWeight}const a=e.meshFailurePenalty;s+=a*r.meshFailurePenaltyWeight;const c=e.invalidMessageDeliveries*e.invalidMessageDeliveries;s+=c*r.invalidMessageDeliveriesWeight,i+=s*r.topicWeight})),n.topicScoreCap>0&&i>n.topicScoreCap&&(i=n.topicScoreCap);const s=n.appSpecificScore(t);if(i+=s*n.appSpecificWeight,e.ips.forEach((t=>{if(n.IPColocationFactorWhitelist.has(t))return;const e=r.get(t),s=e?e.size:0;if(s>n.IPColocationFactorThreshold){const t=s-n.IPColocationFactorThreshold,e=t*t;i+=e*n.IPColocationFactorWeight}})),e.behaviourPenalty>n.behaviourPenaltyThreshold){const t=e.behaviourPenalty-n.behaviourPenaltyThreshold,r=t*t;i+=r*n.behaviourPenaltyWeight}return i}var _U,SU=n(7051);(function(t){t[t["unknown"]=0]="unknown",t[t["valid"]=1]="valid",t[t["invalid"]=2]="invalid",t[t["ignored"]=3]="ignored"})(_U||(_U={}));class AU{constructor(){this.records=new Map,this.queue=new SU}ensureRecord(t){let e=this.records.get(t);if(e)return e;e={status:_U.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(t,e);const n={msgId:t,expire:Date.now()+QM};return this.queue.push(n),e}gc(){const t=Date.now();let e=this.queue.peekFront();while(e&&e.expire<t)this.records.delete(e.msgId),this.queue.shift(),e=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function CU(t){return null!=t&&"function"===typeof t.start&&"function"===typeof t.stop}function IU(t){return null!=t&&"function"===typeof t.init}class TU{constructor(t={}){this.started=!1,null!=t.peerId&&this.setPeerId(t.peerId),null!=t.addressManager&&this.setAddressManager(t.addressManager),null!=t.peerStore&&this.setPeerStore(t.peerStore),null!=t.upgrader&&this.setUpgrader(t.upgrader),null!=t.metrics&&this.setMetrics(t.metrics),null!=t.registrar&&this.setRegistrar(t.registrar),null!=t.connectionManager&&this.setConnectionManager(t.connectionManager),null!=t.transportManager&&this.setTransportManager(t.transportManager),null!=t.connectionGater&&this.setConnectionGater(t.connectionGater),null!=t.contentRouting&&this.setContentRouting(t.contentRouting),null!=t.peerRouting&&this.setPeerRouting(t.peerRouting),null!=t.datastore&&this.setDatastore(t.datastore),null!=t.connectionProtector&&this.setConnectionProtector(t.connectionProtector),null!=t.dht&&this.setDHT(t.dht),null!=t.pubsub&&this.setPubSub(t.pubsub),null!=t.dialer&&this.setDialer(t.dialer)}isStarted(){return this.started}async beforeStart(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.beforeStart&&await t.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{await t.start()}))),this.started=!0}async afterStart(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.afterStart&&await t.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.beforeStop&&await t.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{await t.stop()}))),this.started=!1}async afterStop(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.afterStop&&await t.afterStop()})))}setPeerId(t){return this.peerId=t,t}getPeerId(){if(null==this.peerId)throw Vt(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this.peerId}setMetrics(t){return this.metrics=t,IU(t)&&t.init(this),t}getMetrics(){return this.metrics}setAddressManager(t){return this.addressManager=t,IU(t)&&t.init(this),t}getAddressManager(){if(null==this.addressManager)throw Vt(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this.addressManager}setPeerStore(t){return this.peerStore=t,IU(t)&&t.init(this),t}getPeerStore(){if(null==this.peerStore)throw Vt(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this.peerStore}setUpgrader(t){return this.upgrader=t,IU(t)&&t.init(this),t}getUpgrader(){if(null==this.upgrader)throw Vt(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this.upgrader}setRegistrar(t){return this.registrar=t,IU(t)&&t.init(this),t}getRegistrar(){if(null==this.registrar)throw Vt(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this.registrar}setConnectionManager(t){return this.connectionManager=t,IU(t)&&t.init(this),t}getConnectionManager(){if(null==this.connectionManager)throw Vt(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this.connectionManager}setTransportManager(t){return this.transportManager=t,IU(t)&&t.init(this),t}getTransportManager(){if(null==this.transportManager)throw Vt(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this.transportManager}setConnectionGater(t){return this.connectionGater=t,IU(t)&&t.init(this),t}getConnectionGater(){if(null==this.connectionGater)throw Vt(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this.connectionGater}setContentRouting(t){return this.contentRouting=t,IU(t)&&t.init(this),t}getContentRouting(){if(null==this.contentRouting)throw Vt(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this.contentRouting}setPeerRouting(t){return this.peerRouting=t,IU(t)&&t.init(this),t}getPeerRouting(){if(null==this.peerRouting)throw Vt(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this.peerRouting}setDatastore(t){return this.datastore=t,IU(t)&&t.init(this),t}getDatastore(){if(null==this.datastore)throw Vt(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this.datastore}setConnectionProtector(t){return this.connectionProtector=t,IU(t)&&t.init(this),t}getConnectionProtector(){return this.connectionProtector}setDHT(t){return this.dht=t,IU(t)&&t.init(this),t}getDHT(){if(null==this.dht)throw Vt(new Error("dht not set"),"ERR_SERVICE_MISSING");return this.dht}setPubSub(t){return this.pubsub=t,IU(t)&&t.init(this),t}getPubSub(){if(null==this.pubsub)throw Vt(new Error("pubsub not set"),"ERR_SERVICE_MISSING");return this.pubsub}setDialer(t){return this.dialer=t,IU(t)&&t.init(this),t}getDialer(){if(null==this.dialer)throw Vt(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this.dialer}}const kU=zt("libp2p:gossipsub:score");class RU{constructor(t,e,n){this.params=t,this.metrics=e,this.peerStats=new Map,this.peerIPs=new Map,this.scoreCache=new Map,this.deliveryRecords=new AU,this.components=new TU,yU(t),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??EU}init(t){this.components=t}get size(){return this.peerStats.size}start(){this._backgroundInterval?kU("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),kU("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),kU("stopped")):kU("Peer score already stopped")}background(){this.refreshScores(),this.updateIPs(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([t,e])=>[t,e])))}refreshScores(){const t=Date.now(),e=this.params.decayToZero;this.peerStats.forEach(((n,r)=>{n.connected?(Object.entries(n.topics).forEach((([n,r])=>{const i=this.params.topics[n];void 0!==i&&(r.firstMessageDeliveries*=i.firstMessageDeliveriesDecay,r.firstMessageDeliveries<e&&(r.firstMessageDeliveries=0),r.meshMessageDeliveries*=i.meshMessageDeliveriesDecay,r.meshMessageDeliveries<e&&(r.meshMessageDeliveries=0),r.meshFailurePenalty*=i.meshFailurePenaltyDecay,r.meshFailurePenalty<e&&(r.meshFailurePenalty=0),r.invalidMessageDeliveries*=i.invalidMessageDeliveriesDecay,r.invalidMessageDeliveries<e&&(r.invalidMessageDeliveries=0),r.inMesh&&(r.meshTime=t-r.graftTime,r.meshTime>i.meshMessageDeliveriesActivation&&(r.meshMessageDeliveriesActive=!0)))})),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<e&&(n.behaviourPenalty=0)):t>n.expire&&(this.removeIPs(r,n.ips),this.peerStats.delete(r),this.scoreCache.delete(r))}))}score(t){this.metrics?.scoreFnCalls.inc();const e=this.peerStats.get(t);if(!e)return 0;const n=Date.now(),r=this.scoreCache.get(t);if(r&&r.cacheUntil>n)return r.score;this.metrics?.scoreFnRuns.inc();const i=this.computeScore(t,e,this.params,this.peerIPs),s=n+this.scoreCacheValidityMs;return r?(this.metrics?.scoreCachedDelta.observe(Math.abs(i-r.score)),r.score=i,r.cacheUntil=s):this.scoreCache.set(t,{score:i,cacheUntil:s}),i}addPenalty(t,e,n){const r=this.peerStats.get(t);r&&(r.behaviourPenalty+=e,this.metrics?.onScorePenalty(n))}addPeer(t){const e={connected:!0,expire:0,topics:{},ips:[],behaviourPenalty:0};this.peerStats.set(t,e);const n=this.getIPs(t);this.setIPs(t,n,e.ips),e.ips=n}removePeer(t){const e=this.peerStats.get(t);if(e){if(this.score(t)>0)return this.removeIPs(t,e.ips),void this.peerStats.delete(t);Object.entries(e.topics).forEach((([t,e])=>{e.firstMessageDeliveries=0;const n=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.inMesh&&e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<n){const t=n-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.inMesh=!1,e.meshMessageDeliveriesActive=!1})),e.connected=!1,e.expire=Date.now()+this.params.retainScore}}graft(t,e){const n=this.peerStats.get(t);if(n){const t=this.getPtopicStats(n,e);t&&(t.inMesh=!0,t.graftTime=Date.now(),t.meshTime=0,t.meshMessageDeliveriesActive=!1)}}prune(t,e){const n=this.peerStats.get(t);if(n){const t=this.getPtopicStats(n,e);if(t){const n=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n){const e=n-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.meshMessageDeliveriesActive=!1,t.inMesh=!1}}}validateMessage(t){this.deliveryRecords.ensureRecord(t)}deliverMessage(t,e,n){this.markFirstMessageDelivery(t,n);const r=this.deliveryRecords.ensureRecord(e),i=Date.now();r.status===_U.unknown?(r.status=_U.valid,r.validated=i,r.peers.forEach((e=>{e!==t.toString()&&this.markDuplicateMessageDelivery(e,n)}))):kU("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",t,i-r.firstSeen,_U[r.status])}rejectInvalidMessage(t,e){this.markInvalidMessageDelivery(t,e)}rejectMessage(t,e,n,r){switch(r){case aU.Error:return void this.markInvalidMessageDelivery(t,n);case aU.Blacklisted:return}const i=this.deliveryRecords.ensureRecord(e);if(i.status===_U.unknown){if(r===aU.Ignore)return i.status=_U.ignored,void i.peers.clear();i.status=_U.invalid,this.markInvalidMessageDelivery(t,n),i.peers.forEach((t=>{this.markInvalidMessageDelivery(t,n)})),i.peers.clear()}else kU("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",t,Date.now()-i.firstSeen,_U[i.status])}duplicateMessage(t,e,n){const r=this.deliveryRecords.ensureRecord(e);if(!r.peers.has(t))switch(r.status){case _U.unknown:r.peers.add(t);break;case _U.valid:r.peers.add(t),this.markDuplicateMessageDelivery(t,n,r.validated);break;case _U.invalid:this.markInvalidMessageDelivery(t,n);break;case _U.ignored:break}}markInvalidMessageDelivery(t,e){const n=this.peerStats.get(t);if(n){const t=this.getPtopicStats(n,e);t&&(t.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(t,e){const n=this.peerStats.get(t);if(n){const t=this.getPtopicStats(n,e);if(t){let n=this.params.topics[e].firstMessageDeliveriesCap;t.firstMessageDeliveries=Math.min(n,t.firstMessageDeliveries+1),t.inMesh&&(n=this.params.topics[e].meshMessageDeliveriesCap,t.meshMessageDeliveries=Math.min(n,t.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(t,e,n){const r=this.peerStats.get(t);if(r){const t=void 0!==n?Date.now():0,i=this.getPtopicStats(r,e);if(i&&i.inMesh){const r=this.params.topics[e];if(void 0!==n){const i=t-n,s=i>r.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(e,i,s),s)return}const s=r.meshMessageDeliveriesCap;i.meshMessageDeliveries=Math.min(s,i.meshMessageDeliveries+1)}}}getIPs(t){return this.components.getConnectionManager().getConnections(zu(t)).map((t=>t.remoteAddr.toOptions().host))}setIPs(t,e,n){t:for(const r of e){for(const t of n)if(r===t)continue t;let e=this.peerIPs.get(r);e||(e=new Set,this.peerIPs.set(r,e)),e.add(t)}t:for(const r of n){for(const t of e)if(r===t)continue t;const n=this.peerIPs.get(r);n&&(n.delete(t),n.size||this.peerIPs.delete(r))}}removeIPs(t,e){e.forEach((e=>{const n=this.peerIPs.get(e);n&&(n.delete(t),n.size||this.peerIPs.delete(e))}))}updateIPs(){this.peerStats.forEach(((t,e)=>{const n=this.getIPs(e);this.setIPs(e,n,t.ips),t.ips=n}))}getPtopicStats(t,e){let n=t.topics[e];return void 0!==n?n:void 0!==this.params.topics[e]?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},t.topics[e]=n,n):null}}class NU{constructor(t,e,n){this.gossipsubIWantFollowupMs=t,this.msgIdToStrFn=e,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*t}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(t,e){const n=Math.floor(Math.random()*e.length),r=e[n],i=this.msgIdToStrFn(r);let s=this.promises.get(i);s||(s=new Map,this.promises.set(i,s));const o=Date.now();s.has(t)||(s.set(t,o+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(i)||this.requestMsByMsg.set(i,o)))}getBrokenPromises(){const t=Date.now(),e=new Map;let n=0;return this.promises.forEach(((r,i)=>{r.forEach(((i,s)=>{i<t&&(e.set(s,(e.get(s)??0)+1),r.delete(s),n++)})),r.size||this.promises.delete(i)})),this.metrics?.iwantPromiseBroken.inc(n),e}deliverMessage(t){this.trackMessage(t);const e=this.promises.get(t);e&&(this.promises.delete(t),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(e.size)))}rejectMessage(t,e){switch(this.trackMessage(t),e){case aU.Error:return}this.promises.delete(t)}clear(){this.promises.clear()}prune(){const t=Date.now()-this.requestMsByMsgExpire;for(const[e,n]of this.requestMsByMsg.entries()){if(!(n<t))break;this.requestMsByMsg.delete(e)}}trackMessage(t){if(this.metrics){const e=this.requestMsByMsg.get(t);void 0!==e&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-e)/1e3),this.requestMsByMsg.delete(t))}}}class DU{constructor(t){this.entries=new Map,this.validityMs=t.validityMs}get size(){return this.entries.size}put(t,e){this.entries.set(t,{value:e,validUntilMs:Date.now()+this.validityMs})}prune(){const t=Date.now();for(const[e,n]of this.entries.entries()){if(!(n.validUntilMs<t))break;this.entries.delete(e)}}has(t){return this.entries.has(t)}get(t){const e=this.entries.get(t);return e&&e.validUntilMs>=Date.now()?e.value:void 0}clear(){this.entries.clear()}}var OU,PU,xU,MU,LU,BU;function UU(t,e,n){return{protocolsEnabled:t.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:t.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:t.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:t.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:t.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:t.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:t.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:t.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:t.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:t.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:t.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:t.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:t.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:t.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:t.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:t.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:t.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:t.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:t.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:t.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:t.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:t.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:t.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:t.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:t.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:t.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:t.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:t.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:t.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:t.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:t.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:t.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:t.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:t.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:t.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:t.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:t.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:t.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:t.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:t.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*n.maxMeshMessageDeliveriesWindowSec,.5*n.maxMeshMessageDeliveriesWindowSec,1*n.maxMeshMessageDeliveriesWindowSec,2*n.maxMeshMessageDeliveriesWindowSec,4*n.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:t.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),scoreFnCalls:t.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:t.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:t.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:t.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:t.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:t.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:t.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:t.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:t.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*n.behaviourPenaltyThreshold,.5*n.behaviourPenaltyThreshold,1*n.behaviourPenaltyThreshold,2*n.behaviourPenaltyThreshold,4*n.behaviourPenaltyThreshold]}),ihaveRcvIgnored:t.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:t.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:t.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:t.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:t.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:t.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:t.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedPeers:t.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:t.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantPromiseDeliveryTime:t.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*n.gossipPromiseExpireSec,1*n.gossipPromiseExpireSec,2*n.gossipPromiseExpireSec,4*n.gossipPromiseExpireSec]}),cacheSize:t.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:t.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),topicStrToLabel:e,toTopic(t){return this.topicStrToLabel.get(t)??t},onJoin(t){this.topicSubscriptionStatus.set({topicStr:t},1),this.meshPeerCounts.set({topicStr:t},0)},onLeave(t){this.topicSubscriptionStatus.set({topicStr:t},0),this.meshPeerCounts.set({topicStr:t},0)},onAddToMesh(t,e,n){const r=this.toTopic(t);this.meshPeerInclusionEvents.inc({topic:r,reason:e},n)},onRemoveFromMesh(t,e,n){const r=this.toTopic(t);this.meshPeerChurnEvents.inc({topic:r,reason:e},n)},onReportValidationMcacheHit(t){this.asyncValidationMcacheHit.inc({hit:t?"hit":"miss"})},onReportValidation(t,e){const n=this.toTopic(t);this.asyncValidationResult.inc({topic:n,acceptance:e})},onScorePenalty(t){this.scoringPenalties.inc({penalty:t},1)},onIhaveRcv(t,e,n){const r=this.toTopic(t);this.ihaveRcvMsgids.inc({topic:r},e),this.ihaveRcvNotSeenMsgids.inc({topic:r},n)},onIwantRcv(t,e){for(const[n,r]of t){const t=this.toTopic(n);this.iwantRcvMsgids.inc({topic:t},r)}this.iwantRcvDonthaveMsgids.inc(e)},onForwardMsg(t,e){const n=this.toTopic(t);this.msgForwardCount.inc({topic:n},1),this.msgForwardPeers.inc({topic:n},e)},onPublishMsg(t,e,n,r){const i=this.toTopic(t);this.msgPublishCount.inc({topic:i},1),this.msgPublishBytes.inc({topic:i},n*r),this.msgPublishPeers.inc({topic:i},n),this.msgPublishPeersByGroup.inc({topic:i,peerGroup:"direct"},e.direct),this.msgPublishPeersByGroup.inc({topic:i,peerGroup:"floodsub"},e.floodsub),this.msgPublishPeersByGroup.inc({topic:i,peerGroup:"mesh"},e.mesh),this.msgPublishPeersByGroup.inc({topic:i,peerGroup:"fanout"},e.fanout)},onMsgRecvPreValidation(t){const e=this.toTopic(t);this.msgReceivedPreValidation.inc({topic:e},1)},onMsgRecvResult(t,e){const n=this.toTopic(t);this.msgReceivedStatus.inc({topic:n,status:e})},onMsgRecvInvalid(t,e){const n=this.toTopic(t),r=e.reason===aU.Error?e.error:e.reason;this.msgReceivedInvalid.inc({topic:n,error:r},1)},onDuplicateMsgDelivery(t,e,n){if(this.duplicateMsgDeliveryDelay.observe(e/1e3),n){const e=this.toTopic(t);this.duplicateMsgLateDelivery.inc({topic:e},1)}},onRpcRecv(t,e){this.rpcRecvBytes.inc(e),this.rpcRecvCount.inc(1),t.subscriptions&&this.rpcRecvSubscription.inc(t.subscriptions.length),t.messages&&this.rpcRecvMessage.inc(t.messages.length),t.control&&(this.rpcRecvControl.inc(1),t.control.ihave&&this.rpcRecvIHave.inc(t.control.ihave.length),t.control.iwant&&this.rpcRecvIWant.inc(t.control.iwant.length),t.control.graft&&this.rpcRecvGraft.inc(t.control.graft.length),t.control.prune&&this.rpcRecvPrune.inc(t.control.prune.length))},onRpcSent(t,e){if(this.rpcSentBytes.inc(e),this.rpcSentCount.inc(1),t.subscriptions&&this.rpcSentSubscription.inc(t.subscriptions.length),t.messages&&this.rpcSentMessage.inc(t.messages.length),t.control){const e=t.control.ihave?.length??0,n=t.control.iwant?.length??0,r=t.control.graft?.length??0,i=t.control.prune?.length??0;e>0&&this.rpcSentIHave.inc(e),n>0&&this.rpcSentIWant.inc(n),r>0&&this.rpcSentGraft.inc(r),i>0&&this.rpcSentPrune.inc(i),(e>0||n>0||r>0||i>0)&&this.rpcSentControl.inc(1)}},registerScores(t,e){let n=0,r=0,i=0,s=0;for(const o of t)o>=e.graylistThreshold&&n++,o>=e.publishThreshold&&r++,o>=e.gossipThreshold&&i++,o>=0&&s++;this.peersByScoreThreshold.set({threshold:BU.graylist},n),this.peersByScoreThreshold.set({threshold:BU.publish},r),this.peersByScoreThreshold.set({threshold:BU.gossip},i),this.peersByScoreThreshold.set({threshold:BU.mesh},s),this.score.set(t)},registerScoreWeights(t){for(const[e,n]of t.byTopic)this.scoreWeights.set({topic:e,p:"p1"},n.p1w),this.scoreWeights.set({topic:e,p:"p2"},n.p2w),this.scoreWeights.set({topic:e,p:"p3"},n.p3w),this.scoreWeights.set({topic:e,p:"p3b"},n.p3bw),this.scoreWeights.set({topic:e,p:"p4"},n.p4w);this.scoreWeights.set({p:"p5"},t.p5w),this.scoreWeights.set({p:"p6"},t.p6w),this.scoreWeights.set({p:"p7"},t.p7w)},registerScorePerMesh(t,e){const n=new Map;t.forEach(((t,e)=>{const r=this.topicStrToLabel.get(e)??"unknown";let i=n.get(r);i||(i=new Set,n.set(r,i)),t.forEach((t=>i?.add(t)))}));for(const[r,i]of n){const t=[];i.forEach((n=>{t.push(e.get(n)??0)})),this.scorePerMesh.set({topic:r},t)}}}}function FU(t,e){e||(e=t.reduce(((t,e)=>t+e.length),0));const n=WB(e);let r=0;for(const i of t)n.set(i,r),r+=i.length;return qB(n)}function zU(t,e="utf8"){const n=ZB[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${t}`):qB(globalThis.Buffer.from(t,"utf-8"))}(function(t){t["forward"]="forward",t["publish"]="publish"})(OU||(OU={})),function(t){t["Fanout"]="fanout",t["Random"]="random",t["Subscribed"]="subscribed",t["Outbound"]="outbound",t["NotEnough"]="not_enough",t["Opportunistic"]="opportunistic"}(PU||(PU={})),function(t){t["Dc"]="disconnected",t["BadScore"]="bad_score",t["Prune"]="prune",t["Unsub"]="unsubscribed",t["Excess"]="excess"}(xU||(xU={})),function(t){t["GraftBackoff"]="graft_backoff",t["BrokenPromise"]="broken_promise",t["MessageDeficit"]="message_deficit",t["IPColocation"]="IP_colocation"}(MU||(MU={})),function(t){t["LowScore"]="low_score",t["MaxIhave"]="max_ihave",t["MaxIasked"]="max_iasked"}(LU||(LU={})),function(t){t["graylist"]="graylist",t["publish"]="publish",t["gossip"]="gossip",t["mesh"]="mesh"}(BU||(BU={}));n(6509);var VU=n(3350);const jU={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function HU(t,e,n,r,i){if("sha1"!==i&&"sha2-256"!==i&&"sha2-512"!==i){const t=Object.keys(jU).join(" / ");throw Vt(new Error(`Hash '${i}' is unknown or not supported. Must be ${t}`),"ERR_UNSUPPORTED_HASH_TYPE")}const s=jU[i],o=VU(t,e,n,r,s);return Dh.encode64(o,null)}function $U(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0}const KU=zU("libp2p-pubsub:");async function GU(t,e,n,r){switch(t.type){case sU.Signing:{const i={from:t.author.toBytes(),data:r,seqno:Kd(8),topic:e,signature:void 0,key:void 0},s=FU([KU,vM.Message.encode(i).finish()]);i.signature=await t.privateKey.sign(s),i.key=t.key;const o={type:"signed",from:t.author,data:n,sequenceNumber:BigInt(`0x${tU(i.seqno,"base16")}`),topic:e,signature:i.signature,key:i.key};return{raw:i,msg:o}}case sU.Anonymous:return{raw:{from:void 0,data:r,seqno:void 0,topic:e,signature:void 0,key:void 0},msg:{type:"unsigned",data:n,topic:e}}}}async function qU(t,e){switch(t){case rU:return null!=e.signature?{valid:!1,error:cU.SignaturePresent}:null!=e.seqno?{valid:!1,error:cU.SeqnoPresent}:null!=e.key?{valid:!1,error:cU.FromPresent}:{valid:!0,message:{type:"unsigned",topic:e.topic,data:e.data??new Uint8Array(0)}};case nU:{if(null==e.seqno)return{valid:!1,error:cU.InvalidSeqno};if(8!==e.seqno.length)return{valid:!1,error:cU.InvalidSeqno};if(null==e.signature)return{valid:!1,error:cU.InvalidSignature};if(null==e.from)return{valid:!1,error:cU.InvalidPeerId};let t,r;try{t=Vu(e.from)}catch(n){return{valid:!1,error:cU.InvalidPeerId}}if(e.key){if(r=qp(e.key),void 0!==t.publicKey&&!$U(r.bytes,t.publicKey))return{valid:!1,error:cU.InvalidPeerId}}else{if(null==t.publicKey)return{valid:!1,error:cU.InvalidPeerId};r=qp(t.publicKey)}const i={from:e.from,data:e.data,seqno:e.seqno,topic:e.topic,signature:void 0,key:void 0},s=FU([KU,vM.Message.encode(i).finish()]);return await r.verify(s,e.signature)?{valid:!0,message:{type:"signed",from:t,data:e.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${tU(e.seqno,"base16")}`),topic:e.topic,signature:e.signature,key:e.key??Wp(r)}}:{valid:!1,error:cU.InvalidSignature}}}}function WU(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";var n=0,r=0,i=0,s=e.length;while(i!==s&&0===e[i])i++,n++;var o=(s-i)*u+1>>>0,l=new Uint8Array(o);while(i!==s){for(var h=e[i],d=0,f=o-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}var p=o-r;while(p!==o&&0===l[p])p++;for(var g=c.repeat(n);p<o;++p)g+=t.charAt(l[p]);return g}function d(t){if("string"!==typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;var e=0;if(" "!==t[e]){var r=0,i=0;while(t[e]===c)r++,e++;var s=(t.length-e)*l+1>>>0,o=new Uint8Array(s);while(t[e]){var u=n[t.charCodeAt(e)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,e++}if(" "!==t[e]){var f=s-i;while(f!==s&&0===o[f])f++;var p=new Uint8Array(r+(s-f)),g=r;while(f!==s)p[g++]=o[f++];return p}}}function f(t){var n=d(t);if(n)return n;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var YU=WU,XU=YU,QU=XU;new Uint8Array(0);const JU=t=>{if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},ZU=t=>(new TextEncoder).encode(t),tF=t=>(new TextDecoder).decode(t);class eF{constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class nF{constructor(t,e,n){if(this.name=t,this.prefix=e,void 0===e.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=n}decode(t){if("string"===typeof t){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(t){return iF(this,t)}}class rF{constructor(t){this.decoders=t}or(t){return iF(this,t)}decode(t){const e=t[0],n=this.decoders[e];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const iF=(t,e)=>new rF({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class sF{constructor(t,e,n,r){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=r,this.encoder=new eF(t,e,n),this.decoder=new nF(t,e,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const oF=({name:t,prefix:e,encode:n,decode:r})=>new sF(t,e,n,r),aF=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=QU(n,e);return oF({prefix:t,name:e,encode:r,decode:t=>JU(i(t))})},cF=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;while("="===t[s-1])--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const e=i[t[u]];if(void 0===e)throw new SyntaxError(`Non-${r} character`);c=c<<n|e,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lF=(t,e,n)=>{const r="="===e[e.length-1],i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c){a=a<<8|t[c],o+=8;while(o>n)o-=n,s+=e[i&a>>o]}if(o&&(s+=e[i&a<<n-o]),r)while(s.length*n&7)s+="=";return s},uF=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>oF({prefix:e,name:t,encode(t){return lF(t,r,n)},decode(e){return cF(e,r,n,t)}}),hF=oF({prefix:"\0",name:"identity",encode:t=>tF(t),decode:t=>ZU(t)}),dF=uF({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),fF=uF({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),pF=aF({prefix:"9",name:"base10",alphabet:"0123456789"}),gF=uF({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mF=uF({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),yF=uF({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),wF=uF({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bF=uF({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vF=uF({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),EF=uF({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_F=uF({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),SF=uF({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),AF=uF({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),CF=uF({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),IF=aF({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),TF=aF({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),kF=aF({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),RF=aF({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),NF=uF({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),DF=uF({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),OF=uF({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),PF=uF({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),xF=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),MF=xF.reduce(((t,e,n)=>(t[n]=e,t)),[]),LF=xF.reduce(((t,e,n)=>(t[e.codePointAt(0)]=n,t)),[]);function BF(t){return t.reduce(((t,e)=>(t+=MF[e],t)),"")}function UF(t){const e=[];for(const n of t){const t=LF[n.codePointAt(0)];if(void 0===t)throw new Error(`Non-base256emoji character: ${n}`);e.push(t)}return new Uint8Array(e)}const FF=oF({prefix:"🚀",name:"base256emoji",encode:BF,decode:UF});var zF=KF,VF=128,jF=127,HF=~jF,$F=Math.pow(2,31);function KF(t,e,n){e=e||[],n=n||0;var r=n;while(t>=$F)e[n++]=255&t|VF,t/=128;while(t&HF)e[n++]=255&t|VF,t>>>=7;return e[n]=0|t,KF.bytes=n-r+1,e}var GF=YF,qF=128,WF=127;function YF(t,e){var n,r=0,i=(e=e||0,0),s=e,o=t.length;do{if(s>=o)throw YF.bytes=0,new RangeError("Could not decode varint");n=t[s++],r+=i<28?(n&WF)<<i:(n&WF)*Math.pow(2,i),i+=7}while(n>=qF);return YF.bytes=s-e,r}var XF=Math.pow(2,7),QF=Math.pow(2,14),JF=Math.pow(2,21),ZF=Math.pow(2,28),tz=Math.pow(2,35),ez=Math.pow(2,42),nz=Math.pow(2,49),rz=Math.pow(2,56),iz=Math.pow(2,63),sz=function(t){return t<XF?1:t<QF?2:t<JF?3:t<ZF?4:t<tz?5:t<ez?6:t<nz?7:t<rz?8:t<iz?9:10},oz={encode:zF,decode:GF,encodingLength:sz},az=oz,cz=az;const lz=(t,e,n=0)=>(cz.encode(t,e,n),e),uz=t=>cz.encodingLength(t),hz=(t,e)=>{const n=e.byteLength,r=uz(t),i=r+uz(n),s=new Uint8Array(i+n);return lz(t,s,0),lz(n,s,r),s.set(e,i),new dz(t,n,e,s)};class dz{constructor(t,e,n,r){this.code=t,this.size=e,this.digest=n,this.bytes=r}}const fz=({name:t,code:e,encode:n})=>new pz(t,e,n);class pz{constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?hz(this.code,e):e.then((t=>hz(this.code,t)))}throw Error("Unknown type, must be binary type")}}const gz=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),mz=fz({name:"sha2-256",code:18,encode:gz("SHA-256")}),yz=fz({name:"sha2-512",code:19,encode:gz("SHA-512")}),wz=0,bz="identity",vz=JU,Ez=t=>hz(wz,vz(t)),_z={code:wz,name:bz,encode:vz,digest:Ez},Sz="raw",Az=85,Cz=t=>JU(t),Iz=t=>JU(t),Tz=new TextEncoder,kz=new TextDecoder,Rz="json",Nz=512,Dz=t=>Tz.encode(JSON.stringify(t)),Oz=t=>JSON.parse(kz.decode(t));class Pz{constructor(t,e,n,r){this.code=e,this.version=t,this.multihash=n,this.bytes=r,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:src_cid_hidden,byteLength:src_cid_hidden,code:src_cid_readonly,version:src_cid_readonly,multihash:src_cid_readonly,bytes:src_cid_readonly,_baseCache:src_cid_hidden,asCID:src_cid_hidden})}toV0(){switch(this.version){case 0:return this;default:{const{code:t,multihash:e}=this;if(t!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Pz.createV0(e)}}}toV1(){switch(this.version){case 0:{const{code:t,digest:e}=this.multihash,n=Digest.create(t,e);return Pz.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(t){return t&&this.code===t.code&&this.version===t.version&&Digest.equals(this.multihash,t.multihash)}toString(t){const{bytes:e,version:n,_baseCache:r}=this;switch(n){case 0:return src_cid_toStringV0(e,r,t||base58btc.encoder);default:return src_cid_toStringV1(e,r,t||base32.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(t){return cid_deprecate(/^0\.0/,cid_IS_CID_DEPRECATION),!(!t||!t[src_cid_cidSymbol]&&t.asCID!==t)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(t){if(t instanceof Pz)return t;if(null!=t&&t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new Pz(e,n,r,i||src_cid_encodeCID(e,n,r.bytes))}if(null!=t&&!0===t[src_cid_cidSymbol]){const{version:e,multihash:n,code:r}=t,i=Digest.decode(n);return Pz.create(e,r,i)}return null}static create(t,e,n){if("number"!==typeof e)throw new Error("String codecs are no longer supported");switch(t){case 0:if(e!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new Pz(t,e,n,n.bytes);case 1:{const r=src_cid_encodeCID(t,e,n.bytes);return new Pz(t,e,n,r)}default:throw new Error("Invalid version")}}static createV0(t){return Pz.create(0,src_cid_DAG_PB_CODE,t)}static createV1(t,e){return Pz.create(1,t,e)}static decode(t){const[e,n]=Pz.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return e}static decodeFirst(t){const e=Pz.inspectBytes(t),n=e.size-e.multihashSize,r=coerce(t.subarray(n,n+e.multihashSize));if(r.byteLength!==e.multihashSize)throw new Error("Incorrect length");const i=r.subarray(e.multihashSize-e.digestSize),s=new Digest.Digest(e.multihashCode,e.digestSize,i,r),o=0===e.version?Pz.createV0(s):Pz.createV1(e.codec,s);return[o,t.subarray(e.size)]}static inspectBytes(t){let e=0;const n=()=>{const[n,r]=varint.decode(t.subarray(e));return r,n};let r=n(),i=src_cid_DAG_PB_CODE;if(18===r?(0,0):1===r&&n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const s=e,o=n(),a=n(),c=e+a,l=c-s;return{version:r,codec:i,multihashCode:o,digestSize:a,multihashSize:l,size:c}}static parse(t,e){const[n,r]=src_cid_parseCIDtoBytes(t,e),i=Pz.decode(r);return i._baseCache.set(n,t),i}}Symbol.for("@ipld/js-cid/CID");const xz={...F,...z,...V,...j,...H,...$,...K,...G,...q,...W};function Mz(t){return null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Lz(t=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?Mz(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Bz(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const Uz=Bz("utf8","u",(t=>{const e=new TextDecoder("utf8");return"u"+e.decode(t)}),(t=>{const e=new TextEncoder;return e.encode(t.substring(1))})),Fz=Bz("ascii","a",(t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}),(t=>{t=t.substring(1);const e=Lz(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e})),zz={utf8:Uz,"utf-8":Uz,hex:xz.base16,latin1:Fz,ascii:Fz,binary:Fz,...xz};var Vz=zz;function jz(t,e="utf8"){const n=Vz[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${t}`):Mz(globalThis.Buffer.from(t,"utf-8"))}const Hz=(t,e)=>{const n=jz(e.toString(16).padStart(16,"0"),"base16"),r=new Uint8Array(t.length+n.length);return r.set(t,0),r.set(n,t.length),r};function $z(t){if("signed"!==t.type)throw new Error("expected signed message type");if(null==t.sequenceNumber)throw Error("missing seqno field");return Hz(t.from.toBytes(),t.sequenceNumber)}async function Kz(t){return await kB.encode(t.data)}function Gz(t,e,n,r,i){let s=0;const o=new Map;if(Object.entries(e.topics).forEach((([t,e])=>{const r=i.get(t)??"unknown",a=n.topics[t];if(void 0===a)return;let c=o.get(r);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(r,c));let l=0,u=0,h=0,d=0,f=0;if(e.inMesh){const t=Math.max(e.meshTime/a.timeInMeshQuantum,a.timeInMeshCap);l+=t*a.timeInMeshWeight}let p=e.firstMessageDeliveries;if(p>a.firstMessageDeliveriesCap&&(p=a.firstMessageDeliveriesCap),u+=p*a.firstMessageDeliveriesWeight,e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const t=a.meshMessageDeliveriesThreshold-e.meshMessageDeliveries,n=t*t;h+=n*a.meshMessageDeliveriesWeight}const g=e.meshFailurePenalty;d+=g*a.meshFailurePenaltyWeight;const m=e.invalidMessageDeliveries*e.invalidMessageDeliveries;f+=m*a.invalidMessageDeliveriesWeight,s+=(l+u+h+d+f)*a.topicWeight,c.p1w+=l,c.p2w+=u,c.p3w+=h,c.p3bw+=d,c.p4w+=f})),n.topicScoreCap>0&&s>n.topicScoreCap){s=n.topicScoreCap;const t=n.topicScoreCap/s;for(const e of o.values())e.p1w*=t,e.p2w*=t,e.p3w*=t,e.p3bw*=t,e.p4w*=t}let a=0,c=0,l=0;const u=n.appSpecificScore(t);a+=u*n.appSpecificWeight,e.ips.forEach((t=>{if(n.IPColocationFactorWhitelist.has(t))return;const e=r.get(t),i=e?e.size:0;if(i>n.IPColocationFactorThreshold){const t=i-n.IPColocationFactorThreshold,e=t*t;c+=e*n.IPColocationFactorWeight}}));const h=e.behaviourPenalty*e.behaviourPenalty;return l+=h*n.behaviourPenaltyWeight,s+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:s}}function qz(t,e,n,r,i){const s={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of t){const t=e.get(o);if(t){const e=Gz(o,t,n,r,i);for(const[t,n]of e.byTopic){let e=s.byTopic.get(t);e||(e={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},s.byTopic.set(t,e)),e.p1w.push(n.p1w),e.p2w.push(n.p2w),e.p3w.push(n.p3w),e.p3bw.push(n.p3bw),e.p4w.push(n.p4w)}s.p5w.push(e.p5w),s.p6w.push(e.p6w),s.p7w.push(e.p7w),s.score.push(e.score)}else s.p5w.push(0),s.p6w.push(0),s.p7w.push(0),s.score.push(0)}return s}function Wz(t,e,n=(()=>!0)){const r=new Set;if(e<=0)return r;for(const i of t){if(r.size>=e)break;n(i)&&(r.add(i),t.delete(i))}return r}function Yz(t,e){return Wz(t,e,(()=>!0))}class Xz extends Error{constructor(t,e){super(t??"The operation was aborted"),this.type="aborted",this.code=e??"ABORT_ERR"}}function Qz(t){if(null!=t){if("function"===typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"===typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();if("function"===typeof t.next)return t}throw new Error("argument is not an iterator or iterable")}function Jz(t,e,n){const r=n??{},i=Qz(t);async function*s(){let n;const s=()=>{null!=n&&n()};e.addEventListener("abort",s);while(1){let o;try{if(e.aborted){const{abortMessage:t,abortCode:e}=r;throw new Xz(t,e)}const t=new Promise(((t,e)=>{n=()=>{const{abortMessage:t,abortCode:n}=r;e(new Xz(t,n))}}));o=await Promise.race([t,i.next()]),n=null}catch(uS){e.removeEventListener("abort",s);const o="aborted"===uS.type&&e.aborted;if(o&&null!=r.onAbort&&await r.onAbort(t),"function"===typeof i.return)try{const t=i.return();t instanceof Promise&&t.catch((t=>{null!=r.onReturnError&&r.onReturnError(t)}))}catch(uS){null!=r.onReturnError&&r.onReturnError(uS)}if(o&&!0===r.returnOnAbort)return;throw uS}if(!0===o.done)break;yield o.value}e.removeEventListener("abort",s)}return s()}function Zz(t,e,n){return r=>t(Jz(r,e,n))}function tV(t,e,n){return{sink:Zz(t.sink,e,{...n,onAbort:void 0}),source:Jz(t.source,e,n)}}function eV(t){return null!=globalThis?.Buffer?.allocUnsafe?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t)}const nV=t=>{const e=tM.encodingLength(t),n=eV(e);return tM.encode(t,n),nV.bytes=e,n};function rV(t){t=t??{};const e=t.lengthEncoder??nV,n=async function*(t){for await(const n of t){const t=e(n.byteLength);t instanceof Uint8Array?yield t:yield*t,n instanceof Uint8Array?yield n:yield*n}};return n}nV.bytes=0,rV.single=(t,e)=>{e=e??{};const n=e.lengthEncoder??nV;return new Cw(n(t.byteLength),t)};const iV=8,sV=4194304;var oV;(function(t){t[t["LENGTH"]=0]="LENGTH",t[t["DATA"]=1]="DATA"})(oV||(oV={}));const aV=t=>{const e=tM.decode(t);return aV.bytes=tM.encodingLength(e),e};function cV(t){const e=async function*(e){const n=new Cw;let r=oV.LENGTH,i=-1;const s=t?.lengthDecoder??aV,o=t?.maxLengthLength??iV,a=t?.maxDataLength??sV;for await(const c of e){n.append(c);while(n.byteLength>0){if(r===oV.LENGTH)try{if(i=s(n),i<0)throw Vt(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(i>a)throw Vt(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const e=s.bytes;n.consume(e),null!=t?.onLength&&t.onLength(i),r=oV.DATA}catch(uS){if(uS instanceof RangeError){if(n.byteLength>o)throw Vt(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw uS}if(r===oV.DATA){if(n.byteLength<i)break;const e=n.sublist(0,i);n.consume(i),null!=t?.onData&&t.onData(e),yield e,r=oV.LENGTH}}}if(n.byteLength>0)throw Vt(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")};return e}aV.bytes=0,cV.fromReader=(t,e)=>{let n=1;const r=async function*(){while(1)try{const{done:e,value:r}=await t.next(n);if(!0===e)return;null!=r&&(yield r)}catch(uS){if("ERR_UNDER_READ"===uS.code)return{done:!0,value:null};throw uS}finally{n=1}}(),i=t=>{n=t};return cV({...e??{},onLength:i})(r)};class lV{constructor(t,e,n){this.rawStream=t,this.pushable=sm({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,vm(Jz(this.pushable,this.closeController.signal,{returnOnAbort:!0}),rV(),this.rawStream).catch(e)}get protocol(){return this.rawStream.stat.protocol}push(t){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(t)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class uV{constructor(t){this.rawStream=t,this.closeController=new AbortController,this.source=Jz(vm(this.rawStream,cV()),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var hV;(function(t){t[t["started"]=0]="started",t[t["stopped"]=1]="stopped"})(hV||(hV={}));class dV extends gM{constructor(t={}){super(),this.multicodecs=[CM,AM],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=sm({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.components=new TU,this.directPeerInitial=null,this.status={code:hV.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{const t=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((t=>{this.log("Error running heartbeat",t)})).finally((()=>{if(null!=t&&t(),this.status.code===hV.started){clearTimeout(this.status.heartbeatTimeout);let t=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;t<.25*this.opts.heartbeatInterval&&(t+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,t)}}))};const e={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:IM,Dlo:TM,Dhi:kM,Dscore:RM,Dout:NM,Dlazy:PM,heartbeatInterval:BM,fanoutTTL:UM,mcacheLength:DM,mcacheGossip:OM,seenTTL:XM,gossipsubIWantFollowupMs:YM,prunePeers:FM,pruneBackoff:zM,graftFloodThreshold:GM,opportunisticGraftPeers:KM,opportunisticGraftTicks:$M,directConnectTicks:jM,...t,scoreParams:gU(t.scoreParams),scoreThresholds:vU(t.scoreThresholds)};if(this.globalSignaturePolicy=e.globalSignaturePolicy??nU,e.fallbackToFloodsub&&this.multicodecs.push(SM),this.log=zt(e.debugName??"libp2p:gossipsub"),this.opts=e,this.direct=new Set(e.directPeers.map((t=>t.id.toString()))),this.seenCache=new DU({validityMs:e.seenTTL}),this.publishedMessageIds=new DU({validityMs:e.seenTTL}),t.msgIdFn)this.msgIdFn=t.msgIdFn;else switch(this.globalSignaturePolicy){case nU:this.msgIdFn=$z;break;case rU:this.msgIdFn=Kz;break}if(t.fastMsgIdFn&&(this.fastMsgIdFn=t.fastMsgIdFn,this.fastMsgIdCache=new DU({validityMs:e.seenTTL})),this.msgIdToStrFn=t.msgIdToStrFn??eU,this.mcache=t.messageCache||new wM(e.mcacheGossip,e.mcacheLength,this.msgIdToStrFn),t.dataTransform&&(this.dataTransform=t.dataTransform),t.metricsRegister){if(!t.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const n=Math.max(...Object.values(e.scoreParams.topics).map((t=>t.meshMessageDeliveriesWindow)),rL),r=UU(t.metricsRegister,t.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:e.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:n/1e3});r.mcacheSize.addCollect((()=>this.onScrapeMetrics(r)));for(const t of this.multicodecs)r.protocolsEnabled.set({protocol:t},1);this.metrics=r}else this.metrics=null;this.gossipTracer=new NU(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new RU(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:e.heartbeatInterval}),this.maxInboundStreams=t.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams}getPeers(){return[...this.peers.keys()].map((t=>zu(t)))}isStarted(){return this.status.code===hV.started}async init(t){this.components=t,this.score.init(t)}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await hU(this.globalSignaturePolicy,this.components.getPeerId()),this.outboundInflightQueue=sm({objectMode:!0}),vm(this.outboundInflightQueue,(async t=>{for await(const{peerId:e,connection:n}of t)await this.createOutboundStream(e,n)})).catch((t=>this.log.error("outbound inflight queue error",t))),await Promise.all(this.opts.directPeers.map((async t=>{await this.components.getPeerStore().addressBook.add(t.id,t.addrs)})));const t=this.components.getRegistrar();await Promise.all(this.multicodecs.map((e=>t.handle(e,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const e=dM({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map((n=>t.register(n,e)))),r=setTimeout(this.runHeartbeat,LM);this.status={code:hV.started,registrarTopologyIds:n,heartbeatTimeout:r,hearbeatStartMs:Date.now()+LM},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async t=>await this.connect(t))))})).catch((t=>{this.log(t)}))}),HM),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==hV.started)return;const{registrarTopologyIds:t}=this.status;this.status={code:hV.stopped};const e=this.components.getRegistrar();t.forEach((t=>e.unregister(t))),this.outboundInflightQueue.end();for(const n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(const n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:t,connection:e}){if(!this.isStarted())return;const n=e.remotePeer;this.addPeer(n,e.stat.direction),this.createInboundStream(n,t),this.outboundInflightQueue.push({peerId:n,connection:e})}onPeerConnected(t,e){this.isStarted()&&(this.addPeer(t,e.stat.direction),this.outboundInflightQueue.push({peerId:t,connection:e}))}onPeerDisconnected(t){this.log("connection ended %p",t),this.removePeer(t)}async createOutboundStream(t,e){if(!this.isStarted())return;const n=t.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{const r=new lV(await e.newStream(this.multicodecs),(t=>this.log.error("outbound pipe error",t)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",t),this.streamsOutbound.set(n,r);const i=r.protocol;i===SM&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:i},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(r){this.log.error("createOutboundStream error",r)}}async createInboundStream(t,e){if(!this.isStarted())return;const n=t.toString();if(!this.peers.has(n))return;const r=this.streamsInbound.get(n);void 0!==r&&(this.log("replacing existing inbound steam %s",n),r.close()),this.log("create inbound stream %s",n);const i=new uV(e);this.streamsInbound.set(n,i),this.pipePeerReadStream(t,i.source).catch((t=>this.log(t)))}addPeer(t,e){const n=t.toString();this.peers.has(n)||(this.log("new peer %p",t),this.peers.add(n),this.score.addPeer(n),this.outbound.has(n)||this.outbound.set(n,"outbound"===e))}removePeer(t){const e=t.toString();if(!this.peers.has(e))return;this.log("delete peer %p",t),this.peers.delete(e);const n=this.streamsOutbound.get(e),r=this.streamsInbound.get(e);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),r?.close(),this.streamsOutbound.delete(e),this.streamsInbound.delete(e);for(const i of this.topics.values())i.delete(e);for(const[i,s]of this.mesh)!0===s.delete(e)&&this.metrics?.onRemoveFromMesh(i,xU.Dc,1);for(const i of this.fanout.values())i.delete(e);this.floodsubPeers.delete(e),this.gossip.delete(e),this.control.delete(e),this.outbound.delete(e),this.score.removePeer(e),this.acceptFromWhitelist.delete(e)}get started(){return this.status.code===hV.started}getMeshPeers(t){const e=this.mesh.get(t);return e?Array.from(e):[]}getSubscribers(t){const e=this.topics.get(t);return(e?Array.from(e):[]).map((t=>zu(t)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(t,e){try{await vm(e,(async e=>{for await(const r of e)try{const e=r.subarray(),n=vM.decode(e);this.metrics?.onRpcRecv(n,e.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(t,n):this.handleReceivedRpc(t,n).catch((t=>this.log(t)))}catch(n){this.log(n)}}))}catch(uS){this.log.error(uS),this.onPeerDisconnected(t)}}async handleReceivedRpc(t,e){if(!this.acceptFrom(t.toString()))return this.log("received message from unacceptable peer %p",t),void this.metrics?.rpcRecvNotAccepted.inc();if(this.log("rpc from %p",t),e.subscriptions&&e.subscriptions.length>0&&(e.subscriptions.forEach((e=>{this.handleReceivedSubscription(t,e)})),this.dispatchEvent(new yM("subscription-change",{detail:{peerId:t,subscriptions:e.subscriptions.filter((t=>null!==t.topic)).map((t=>({topic:t.topic??"",subscribe:Boolean(t.subscribe)})))}}))),e.messages)for(const n of e.messages){const e=this.handleReceivedMessage(t,n).catch((t=>this.log(t)));this.opts.awaitRpcMessageHandler&&await e}e.control&&await this.handleControlMessage(t.toString(),e.control)}handleReceivedSubscription(t,e){if(null==e.topic)return;this.log("subscription update from %p topic %s",t,e.topic);let n=this.topics.get(e.topic);null==n&&(n=new Set,this.topics.set(e.topic,n)),e.subscribe?n.add(t.toString()):n.delete(t.toString())}async handleReceivedMessage(t,e){this.metrics?.onMsgRecvPreValidation(e.topic);const n=await this.validateReceivedMessage(t,e);switch(this.metrics?.onMsgRecvResult(e.topic,n.code),n.code){case lU.duplicate:return this.score.duplicateMessage(t.toString(),n.msgIdStr,e.topic),void this.mcache.observeDuplicate(n.msgIdStr,t.toString());case lU.invalid:if(n.msgIdStr){const r=n.msgIdStr;this.score.rejectMessage(t.toString(),r,e.topic,n.reason),this.gossipTracer.rejectMessage(r,n.reason)}else this.score.rejectInvalidMessage(t.toString(),e.topic);return void this.metrics?.onMsgRecvInvalid(e.topic,n);case lU.valid:if(this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,e,!this.opts.asyncValidation),this.subscriptions.has(e.topic)){const e=this.components.getPeerId().equals(t);e&&!this.opts.emitSelf||(super.dispatchEvent(new yM("gossipsub:message",{detail:{propagationSource:t,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new yM("message",{detail:n.msg})))}this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,e,t.toString())}}async validateReceivedMessage(t,e){const n=this.fastMsgIdFn?.(e),r=n?this.fastMsgIdCache?.get(n):void 0;if(r)return{code:lU.duplicate,msgIdStr:r};const i=await qU(this.globalSignaturePolicy,e);if(!i.valid)return{code:lU.invalid,reason:aU.Error,error:i.error};const s=i.message;try{this.dataTransform&&(s.data=this.dataTransform.inboundTransform(e.topic,s.data))}catch(u){return this.log("Invalid message, transform failed",u),{code:lU.invalid,reason:aU.Error,error:cU.TransformFailed}}const o=await this.msgIdFn(s),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(n&&this.fastMsgIdCache?.put(n,a),this.seenCache.has(a))return{code:lU.duplicate,msgIdStr:a};this.seenCache.put(a);const l=this.topicValidators.get(e.topic);if(null!=l){let e;try{e=await l(s.topic,s,t)}catch(u){const t=u.code;t===ZM&&(e=oU.Ignore),e=t===JM?oU.Reject:oU.Ignore}if(e!==oU.Accept)return{code:lU.invalid,reason:uU(e),msgIdStr:a}}return{code:lU.valid,messageId:c,msg:s}}getScore(t){return this.score.score(t)}sendSubscriptions(t,e,n){this.sendRpc(t,{subscriptions:e.map((t=>({topic:t,subscribe:n}))),messages:[]})}async handleControlMessage(t,e){if(void 0===e)return;const n=e.ihave?this.handleIHave(t,e.ihave):[],r=e.iwant?this.handleIWant(t,e.iwant):[],i=e.graft?await this.handleGraft(t,e.graft):[];e.prune&&await this.handlePrune(t,e.prune),(n.length||r.length||i.length)&&this.sendRpc(t,iL(r,{iwant:n,prune:i}))}acceptFrom(t){if(this.direct.has(t))return!0;const e=Date.now(),n=this.acceptFromWhitelist.get(t);if(n&&n.messagesAccepted<eL&&n.acceptUntil>=e)return n.messagesAccepted+=1,!0;const r=this.score.score(t);return r>=tL?this.acceptFromWhitelist.set(t,{messagesAccepted:0,acceptUntil:e+nL}):this.acceptFromWhitelist.delete(t),r>=this.opts.scoreThresholds.graylistThreshold}handleIHave(t,e){if(!e.length)return[];const n=this.score.score(t);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",t,n),this.metrics?.ihaveRcvIgnored.inc({reason:LU.LowScore}),[];const r=(this.peerhave.get(t)??0)+1;if(this.peerhave.set(t,r),r>WM)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",t,r),this.metrics?.ihaveRcvIgnored.inc({reason:LU.MaxIhave}),[];const i=this.iasked.get(t)??0;if(i>=qM)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",t,i),this.metrics?.ihaveRcvIgnored.inc({reason:LU.MaxIasked}),[];const s=new Map;if(e.forEach((({topicID:t,messageIDs:e})=>{if(!t||!e||!this.mesh.has(t))return;let n=0;e.forEach((t=>{const e=this.msgIdToStrFn(t);this.seenCache.has(e)||(s.set(e,t),n++)})),this.metrics?.onIhaveRcv(t,e.length,n)})),!s.size)return[];let o=s.size;o+i>qM&&(o=qM-i),this.log("IHAVE: Asking for %d out of %d messages from %s",o,s.size,t);let a=Array.from(s.values());return sL(a),a=a.slice(0,o),this.iasked.set(t,i+o),this.gossipTracer.addPromise(t,a),[{messageIDs:a}]}handleIWant(t,e){if(!e.length)return[];const n=this.score.score(t);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",t,n),[];const r=new Map,i=new Map;let s=0;return e.forEach((({messageIDs:e})=>{e&&e.forEach((e=>{const n=this.msgIdToStrFn(e),o=this.mcache.getWithIWantCount(n,t);null!=o?(i.set(o.msg.topic,1+(i.get(o.msg.topic)??0)),o.count>MM?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",t,e):r.set(n,o.msg)):s++}))})),this.metrics?.onIwantRcv(i,s),r.size?(this.log("IWANT: Sending %d messages to %s",r.size,t),Array.from(r.values())):(this.log("IWANT: Could not provide any wanted messages to %s",t),[])}async handleGraft(t,e){const n=[],r=this.score.score(t),i=Date.now();let s=this.opts.doPX;return e.forEach((({topicID:e})=>{if(!e)return;const o=this.mesh.get(e);if(!o)return void(s=!1);if(o.has(t))return;if(this.direct.has(t))return this.log("GRAFT: ignoring request from direct peer %s",t),n.push(e),void(s=!1);const a=this.backoff.get(e)?.get(t);if("number"===typeof a&&i<a){this.log("GRAFT: ignoring backed off peer %s",t),this.score.addPenalty(t,1,MU.GraftBackoff),s=!1;const r=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return i<r&&this.score.addPenalty(t,1,MU.GraftBackoff),this.addBackoff(t,e),void n.push(e)}return r<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",t,r,e),n.push(e),s=!1,void this.addBackoff(t,e)):o.size>=this.opts.Dhi&&!this.outbound.get(t)?(n.push(e),void this.addBackoff(t,e)):(this.log("GRAFT: Add mesh link from %s in %s",t,e),this.score.graft(t,e),o.add(t),void this.metrics?.onAddToMesh(e,PU.Subscribed,1))})),n.length?await Promise.all(n.map((e=>this.makePrune(t,e,s)))):[]}async handlePrune(t,e){const n=this.score.score(t);for(const{topicID:r,backoff:i,peers:s}of e){if(null==r)continue;const e=this.mesh.get(r);if(!e)return;if(this.log("PRUNE: Remove mesh link to %s in %s",t,r),this.score.prune(t,r),e.has(t)&&(e.delete(t),this.metrics?.onRemoveFromMesh(r,xU.Unsub,1)),"number"===typeof i&&i>0?this.doAddBackoff(t,r,1e3*i):this.addBackoff(t,r),s&&s.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",t,n,r);continue}await this.pxConnect(s)}}}addBackoff(t,e){this.doAddBackoff(t,e,this.opts.pruneBackoff)}doAddBackoff(t,e,n){let r=this.backoff.get(e);r||(r=new Map,this.backoff.set(e,r));const i=Date.now()+n,s=r.get(t)??0;s<i&&r.set(t,i)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((t,e)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",e,t),this.score.addPenalty(e,t,MU.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%VM!==0)return;const t=Date.now();this.backoff.forEach(((e,n)=>{e.forEach(((n,r)=>{n<t&&e.delete(r)})),0===e.size&&this.backoff.delete(n)}))}async directConnect(){const t=[];this.direct.forEach((e=>{this.streamsOutbound.has(e)||t.push(e)})),await Promise.all(t.map((async t=>await this.connect(t))))}async pxConnect(t){t.length>this.opts.prunePeers&&(sL(t),t=t.slice(0,this.opts.prunePeers));const e=[];await Promise.all(t.map((async t=>{if(!t.peerID)return;const n=Vu(t.peerID).toString();if(!this.peers.has(n))if(t.signedPeerRecord)try{const r=await eM.openAndCertify(t.signedPeerRecord,"libp2p-peer-record"),i=r.peerId;if(!r.peerId.equals(n))return void this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",i,n);if(!await this.components.getPeerStore().addressBook.consumePeerRecord(r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");e.push(n)}catch(r){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else e.push(n)}))),e.length&&await Promise.all(e.map((async t=>await this.connect(t))))}async connect(t){this.log("Initiating connection with %s",t);const e=zu(t),n=await this.components.getConnectionManager().openConnection(e);for(const r of this.multicodecs)for(const t of this.components.getRegistrar().getTopologies(r))t.onConnect(e,n)}subscribe(t){if(this.status.code!==hV.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(t)){this.subscriptions.add(t);for(const e of this.peers.keys())this.sendSubscriptions(e,[t],!0)}this.join(t)}unsubscribe(t){if(this.status.code!==hV.started)throw new Error("Pubsub is not started");const e=this.subscriptions.delete(t);if(this.log("unsubscribe from %s - am subscribed %s",t,e),e)for(const n of this.peers.keys())this.sendSubscriptions(n,[t],!1);this.leave(t).catch((t=>{this.log(t)}))}join(t){if(this.status.code!==hV.started)throw new Error("Gossipsub has not started");if(this.mesh.has(t))return;this.log("JOIN %s",t),this.metrics?.onJoin(t);const e=new Set,n=this.fanout.get(t);if(n&&(this.fanout.delete(t),this.fanoutLastpub.delete(t),n.forEach((t=>{!this.direct.has(t)&&this.score.score(t)>=0&&e.add(t)})),this.metrics?.onAddToMesh(t,PU.Fanout,e.size)),e.size<this.opts.D){const n=e.size,r=this.getRandomGossipPeers(t,this.opts.D,(t=>!e.has(t)&&!this.direct.has(t)&&this.score.score(t)>=0));r.forEach((t=>{e.add(t)})),this.metrics?.onAddToMesh(t,PU.Random,e.size-n)}this.mesh.set(t,e),e.forEach((e=>{this.log("JOIN: Add mesh link to %s in %s",e,t),this.sendGraft(e,t)}))}async leave(t){if(this.status.code!==hV.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",t),this.metrics?.onLeave(t);const e=this.mesh.get(t);e&&(await Promise.all(Array.from(e).map((async e=>(this.log("LEAVE: Remove mesh link to %s in %s",e,t),await this.sendPrune(e,t))))),this.mesh.delete(t))}selectPeersToForward(t,e,n){const r=new Set,i=this.topics.get(t);i&&(this.direct.forEach((t=>{i.has(t)&&e!==t&&!n?.has(t)&&r.add(t)})),this.floodsubPeers.forEach((t=>{i.has(t)&&e!==t&&!n?.has(t)&&this.score.score(t)>=this.opts.scoreThresholds.publishThreshold&&r.add(t)})));const s=this.mesh.get(t);return s&&s.size>0&&s.forEach((t=>{e===t||n?.has(t)||r.add(t)})),r}selectPeersToPublish(t){const e=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},r=this.topics.get(t);if(r)if(this.opts.floodPublish)r.forEach((t=>{this.direct.has(t)?(e.add(t),n.direct++):this.score.score(t)>=this.opts.scoreThresholds.publishThreshold&&(e.add(t),n.floodsub++)}));else{this.direct.forEach((t=>{r.has(t)&&(e.add(t),n.direct++)})),this.floodsubPeers.forEach((t=>{r.has(t)&&this.score.score(t)>=this.opts.scoreThresholds.publishThreshold&&(e.add(t),n.floodsub++)}));const i=this.mesh.get(t);if(i&&i.size>0)i.forEach((t=>{e.add(t),n.mesh++}));else{const r=this.fanout.get(t);if(r&&r.size>0)r.forEach((t=>{e.add(t),n.fanout++}));else{const r=this.getRandomGossipPeers(t,this.opts.D,(t=>this.score.score(t)>=this.opts.scoreThresholds.publishThreshold));r.size>0&&(this.fanout.set(t,r),r.forEach((t=>{e.add(t),n.fanout++})))}this.fanoutLastpub.set(t,Date.now())}}return{tosend:e,tosendCount:n}}forwardMessage(t,e,n,r){n&&this.score.deliverMessage(n,t,e.topic);const i=this.selectPeersToForward(e.topic,n,r),s=iL([e]);i.forEach((t=>{this.sendRpc(t,s)})),this.metrics?.onForwardMsg(e.topic,i.size)}async publish(t,e){const n=this.dataTransform?this.dataTransform.outboundTransform(t,e):e;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:r,msg:i}=await GU(this.publishConfig,t,e,n),s=await this.msgIdFn(i),o=this.msgIdToStrFn(s);if(this.seenCache.has(o))throw Error("PublishError.Duplicate");const{tosend:a,tosendCount:c}=this.selectPeersToPublish(t),l=!0===this.opts.emitSelf&&this.subscriptions.has(t);if(0===a.size&&!this.opts.allowPublishToZeroPeers&&!l)throw Error("PublishError.InsufficientPeers");this.seenCache.put(o),this.mcache.put({msgId:s,msgIdStr:o},r,!0),this.publishedMessageIds.put(o);const u=iL([r]);for(const h of a){const t=this.sendRpc(h,u);t||a.delete(h)}return this.metrics?.onPublishMsg(t,c,a.size,null!=r.data?r.data.length:0),l&&(a.add(this.components.getPeerId().toString()),super.dispatchEvent(new yM("gossipsub:message",{detail:{propagationSource:this.components.getPeerId(),msgId:o,msg:i}})),super.dispatchEvent(new yM("message",{detail:i}))),{recipients:Array.from(a.values()).map((t=>zu(t)))}}reportMessageValidationResult(t,e,n){if(n===oU.Accept){const r=this.mcache.validate(t);if(this.metrics?.onReportValidationMcacheHit(null!==r),null!=r){const{message:i,originatingPeers:s}=r;this.score.deliverMessage(e.toString(),t,i.topic),this.forwardMessage(t,r.message,e.toString(),s),this.metrics?.onReportValidation(i.topic,n)}}else{const r=this.mcache.remove(t);if(this.metrics?.onReportValidationMcacheHit(null!==r),r){const i=uU(n),{message:s,originatingPeers:o}=r;this.score.rejectMessage(e.toString(),t,s.topic,i);for(const e of o)this.score.rejectMessage(e,t,s.topic,i);this.metrics?.onReportValidation(s.topic,n)}}}sendGraft(t,e){const n=[{topicID:e}],r=iL([],{graft:n});this.sendRpc(t,r)}async sendPrune(t,e){const n=[await this.makePrune(t,e,this.opts.doPX)],r=iL([],{prune:n});this.sendRpc(t,r)}sendRpc(t,e){const n=this.streamsOutbound.get(t);if(!n)return this.log(`Cannot send RPC to ${t} as there is no open stream to it available`),!1;const r=this.control.get(t);r&&(this.piggybackControl(t,e,r),this.control.delete(t));const i=this.gossip.get(t);i&&(this.piggybackGossip(t,e,i),this.gossip.delete(t));const s=vM.encode(e).finish();try{n.push(s)}catch(o){return this.log.error(`Cannot send rpc to ${t}`,o),r&&this.control.set(t,r),i&&this.gossip.set(t,i),!1}return this.metrics?.onRpcSent(e,s.length),!0}piggybackControl(t,e,n){const r=(n.graft||[]).filter((({topicID:e})=>(e&&this.mesh.get(e)||new Set).has(t))),i=(n.prune||[]).filter((({topicID:e})=>!(e&&this.mesh.get(e)||new Set).has(t)));(r.length||i.length)&&(e.control?(e.control.graft=e.control.graft&&e.control.graft.concat(r),e.control.prune=e.control.prune&&e.control.prune.concat(i)):e.control={graft:r,prune:i,ihave:[],iwant:[]})}piggybackGossip(t,e,n){e.control||(e.control={ihave:[],iwant:[],graft:[],prune:[]}),e.control.ihave=n}async sendGraftPrune(t,e,n){const r=this.opts.doPX;for(const[i,s]of t){const t=s.map((t=>({topicID:t})));let o=[];const a=e.get(i);a&&(o=await Promise.all(a.map((async t=>await this.makePrune(i,t,r&&!n.get(i))))),e.delete(i));const c=iL([],{graft:t,prune:o});this.sendRpc(i,c)}for(const[i,s]of e){const t=await Promise.all(s.map((async t=>await this.makePrune(i,t,r&&!n.get(i))))),e=iL([],{prune:t});this.sendRpc(i,e)}}emitGossip(t){const e=this.mcache.getGossipIDs(new Set(t.keys()));for(const[n,r]of t)this.doEmitGossip(n,r,e.get(n)??[])}doEmitGossip(t,e,n){if(!n.length)return;if(sL(n),n.length>qM&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!e.size)return;let r=this.opts.Dlazy;const i=xM*e.size;let s=e;i>r&&(r=i),r>s.size?r=s.size:s=sL(Array.from(s)).slice(0,r),s.forEach((e=>{let r=n;n.length>qM&&(r=sL(r.slice()).slice(0,qM)),this.pushGossip(e,{topicID:t,messageIDs:r})}))}flush(){for(const[t,e]of this.gossip.entries())this.gossip.delete(t),this.sendRpc(t,iL([],{ihave:e}));for(const[t,e]of this.control.entries())this.control.delete(t),this.sendRpc(t,iL([],{graft:e.graft,prune:e.prune}))}pushGossip(t,e){this.log("Add gossip to %s",t);const n=this.gossip.get(t)||[];this.gossip.set(t,n.concat(e))}async makePrune(t,e,n){if(this.score.prune(t,e),this.streamsOutbound.get(t).protocol===AM)return{topicID:e,peers:[]};const r=this.opts.pruneBackoff/1e3;if(!n)return{topicID:e,peers:[],backoff:r};const i=this.getRandomGossipPeers(e,this.opts.prunePeers,(e=>e!==t&&this.score.score(e)>=0)),s=await Promise.all(Array.from(i).map((async t=>{const e=zu(t);return{peerID:e.toBytes(),signedPeerRecord:await this.components.getPeerStore().addressBook.getRawEnvelope(e)}})));return{topicID:e,peers:s,backoff:r}}async heartbeat(){const{D:t,Dlo:e,Dhi:n,Dscore:r,Dout:i,fanoutTTL:s}=this.opts;this.heartbeatTicks++;const o=new Map,a=t=>{let e=o.get(t);return void 0===e&&(e=this.score.score(t),o.set(t,e)),e},c=new Map,l=new Map,u=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const h=new Map;this.mesh.forEach(((s,o)=>{const d=this.topics.get(o),f=new Set,p=new Set;if(h.set(o,p),d){const t=sL(Array.from(d)),e=this.backoff.get(o);for(const n of t){const t=this.streamsOutbound.get(n);if(t&&this.multicodecs.includes(t.protocol)&&!s.has(n)&&!this.direct.has(n)){const t=a(n);e&&e.has(n)||!(t>=0)||f.add(n),t>=this.opts.scoreThresholds.gossipThreshold&&p.add(n)}}}const g=(t,e)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",t,o),this.addBackoff(t,o),s.delete(t),a(t)>=this.opts.scoreThresholds.gossipThreshold&&p.add(t),this.metrics?.onRemoveFromMesh(o,e,1);const n=l.get(t);n?n.push(o):l.set(t,[o])},m=(t,e)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",t,o),this.score.graft(t,o),s.add(t),p.delete(t),this.metrics?.onAddToMesh(o,e,1);const n=c.get(t);n?n.push(o):c.set(t,[o])};if(s.forEach((t=>{const e=a(t);e<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",t,e,o),g(t,xU.BadScore),u.set(t,!0))})),s.size<e){const e=t-s.size,n=Yz(f,e);n.forEach((t=>{m(t,PU.NotEnough)}))}if(s.size>n){let e=Array.from(s);e.sort(((t,e)=>a(e)-a(t))),e=e.slice(0,r).concat(sL(e.slice(r)));let n=0;if(e.slice(0,t).forEach((t=>{this.outbound.get(t)&&n++})),n<i){const r=t=>{const n=e[t];for(let r=t;r>0;r--)e[r]=e[r-1];e[0]=n};if(n>0){let i=n;for(let n=1;n<t&&i>0;n++)this.outbound.get(e[n])&&(r(n),i--)}let i=t-n;for(let n=t;n<e.length&&i>0;n++)this.outbound.get(e[n])&&(r(n),i--)}e.slice(t).forEach((t=>{g(t,xU.Excess)}))}if(s.size>=e){let t=0;if(s.forEach((e=>{this.outbound.get(e)&&t++})),t<i){const e=i-t,n=Wz(f,e,(t=>!0===this.outbound.get(t)));n.forEach((t=>{m(t,PU.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&s.size>1){const t=Array.from(s).sort(((t,e)=>a(t)-a(e))),e=Math.floor(s.size/2),n=a(t[e]);if(n<this.opts.scoreThresholds.opportunisticGraftThreshold){const t=this.opts.opportunisticGraftPeers,e=Wz(f,t,(t=>a(t)>n));for(const n of e)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",n,o),m(n,PU.Opportunistic)}}}));const d=Date.now();this.fanoutLastpub.forEach(((t,e)=>{t+s<d&&(this.fanout.delete(e),this.fanoutLastpub.delete(e))})),this.fanout.forEach(((e,n)=>{const r=this.topics.get(n);e.forEach((t=>{(!r.has(t)||a(t)<this.opts.scoreThresholds.publishThreshold)&&e.delete(t)}));const i=this.topics.get(n),s=[],o=new Set;if(h.set(n,o),i){const t=sL(Array.from(i));for(const n of t){const t=this.streamsOutbound.get(n);if(t&&this.multicodecs.includes(t.protocol)&&!e.has(n)&&!this.direct.has(n)){const t=a(n);t>=this.opts.scoreThresholds.publishThreshold&&s.push(n),t>=this.opts.scoreThresholds.gossipThreshold&&o.add(n)}}}if(e.size<t){const n=t-e.size;s.slice(0,n).forEach((t=>{e.add(t),o?.delete(t)}))}})),this.emitGossip(h),await this.sendGraftPrune(c,l,u),this.flush(),this.mcache.shift(),this.dispatchEvent(new yM("gossipsub:heartbeat"))}getRandomGossipPeers(t,e,n=(()=>!0)){const r=this.topics.get(t);if(!r)return new Set;let i=[];return r.forEach((t=>{const e=this.streamsOutbound.get(t);e&&this.multicodecs.includes(e.protocol)&&n(t)&&i.push(t)})),i=sL(i),e>0&&i.length>e&&(i=i.slice(0,e)),new Set(i)}onScrapeMetrics(t){t.mcacheSize.set(this.mcache.size),t.cacheSize.set({cache:"direct"},this.direct.size),t.cacheSize.set({cache:"seenCache"},this.seenCache.size),t.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),t.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),t.cacheSize.set({cache:"mcache"},this.mcache.size),t.cacheSize.set({cache:"score"},this.score.size),t.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),t.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),t.cacheSize.set({cache:"topics"},this.topics.size),t.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),t.cacheSize.set({cache:"mesh"},this.mesh.size),t.cacheSize.set({cache:"fanout"},this.fanout.size),t.cacheSize.set({cache:"peers"},this.peers.size),t.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),t.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),t.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),t.cacheSize.set({cache:"gossip"},this.gossip.size),t.cacheSize.set({cache:"control"},this.control.size),t.cacheSize.set({cache:"peerhave"},this.peerhave.size),t.cacheSize.set({cache:"outbound"},this.outbound.size);let e=0;for(const s of this.backoff.values())e+=s.size;t.cacheSize.set({cache:"backoff"},e);for(const[s,o]of this.topics)t.topicPeersCount.set({topicStr:s},o.size);for(const[s,o]of this.mesh)t.meshPeerCounts.set({topicStr:s},o.size);const n=[],r=new Map;t.behaviourPenalty.reset();for(const s of this.peers.keys()){const e=this.score.score(s);n.push(e),r.set(s,e),t.behaviourPenalty.observe(this.score.peerStats.get(s)?.behaviourPenalty??0)}t.registerScores(n,this.opts.scoreThresholds),t.registerScorePerMesh(this.mesh,r);const i=qz(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,t.topicStrToLabel);t.registerScoreWeights(i)}}dV.multicodec=CM;const fV=()=>({gossipsub:t=>{const e=new dV({allowPublishToZeroPeers:!0,fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128});return e.init({getPeerId(){return t.peerId},getPeerStore(){return t.peerStore},getRegistrar(){return t.registrar},getConnectionManager(){return t.connectionManager}}),e}}),pV=zt("libp2p-delegated-peer-routing"),gV=3e4,mV=4;var yV,wV;(function(t){t[t["SENDING_QUERY"]=0]="SENDING_QUERY",t[t["PEER_RESPONSE"]=1]="PEER_RESPONSE",t[t["FINAL_PEER"]=2]="FINAL_PEER",t[t["QUERY_ERROR"]=3]="QUERY_ERROR",t[t["PROVIDER"]=4]="PROVIDER",t[t["VALUE"]=5]="VALUE",t[t["ADDING_PEER"]=6]="ADDING_PEER",t[t["DIALING_PEER"]=7]="DIALING_PEER"})(yV||(yV={})),function(t){t[t["PUT_VALUE"]=0]="PUT_VALUE",t[t["GET_VALUE"]=1]="GET_VALUE",t[t["ADD_PROVIDER"]=2]="ADD_PROVIDER",t[t["GET_PROVIDERS"]=3]="GET_PROVIDERS",t[t["FIND_NODE"]=4]="FIND_NODE",t[t["PING"]=5]="PING"}(wV||(wV={}));class bV{constructor(t){if(null==t)throw new Error("missing ipfs http client");this.client=t,this.started=!1,this.abortController=new AbortController,this.httpQueue=new yu({concurrency:mV});const{protocol:e,host:n,port:r}=t.getEndpointConfig();pV(`enabled DelegatedPeerRouting via ${e}://${n}:${r}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(t,e={}){pV("findPeer starts: %p",t),e.timeout=e.timeout??gV,e.signal=al([this.abortController.signal].concat(null!=e.signal?[e.signal]:[]));const n=Cy(),r=Cy();this.httpQueue.add((async()=>(n.resolve(),await r.promise)));try{await n.promise;for await(const n of this.client.dht.findPeer(t,e))if("FINAL_PEER"===n.name){const t={id:n.peer.id,multiaddrs:n.peer.multiaddrs,protocols:[]};return t}}catch(uS){throw pV.error("findPeer errored: %o",uS),uS}finally{r.resolve(),pV("findPeer finished: %p",t)}throw Vt(new Error("Not found"),"ERR_NOT_FOUND")}async*getClosestPeers(t,e={}){let n;const r=Me.asCID(t);n=null!=r?r:Vu(t),pV("getClosestPeers starts: %s",n),e.timeout=e.timeout??gV,e.signal=al([this.abortController.signal].concat(null!=e.signal?[e.signal]:[]));const i=Cy(),s=Cy();this.httpQueue.add((async()=>(i.resolve(),await s.promise)));try{await i.promise;for await(const t of this.client.dht.query(n,e))"PEER_RESPONSE"===t.name&&(yield*t.closer.map((t=>({id:t.id,multiaddrs:t.multiaddrs,protocols:[]}))))}catch(uS){throw pV.error("getClosestPeers errored:",uS),uS}finally{s.resolve(),pV("getClosestPeers finished: %b",t)}}}function vV(t){return()=>new bV(t)}const EV=zt("libp2p:delegated-content-routing"),_V=3e4,SV=4,AV=2;var CV,IV;(function(t){t[t["SENDING_QUERY"]=0]="SENDING_QUERY",t[t["PEER_RESPONSE"]=1]="PEER_RESPONSE",t[t["FINAL_PEER"]=2]="FINAL_PEER",t[t["QUERY_ERROR"]=3]="QUERY_ERROR",t[t["PROVIDER"]=4]="PROVIDER",t[t["VALUE"]=5]="VALUE",t[t["ADDING_PEER"]=6]="ADDING_PEER",t[t["DIALING_PEER"]=7]="DIALING_PEER"})(CV||(CV={})),function(t){t[t["PUT_VALUE"]=0]="PUT_VALUE",t[t["GET_VALUE"]=1]="GET_VALUE",t[t["ADD_PROVIDER"]=2]="ADD_PROVIDER",t[t["GET_PROVIDERS"]=3]="GET_PROVIDERS",t[t["FIND_NODE"]=4]="FIND_NODE",t[t["PING"]=5]="PING"}(IV||(IV={}));class TV{constructor(t){if(null==t)throw new Error("missing ipfs http client");this.client=t,this.started=!1,this.abortController=new AbortController,this.httpQueue=new yu({concurrency:SV}),this.httpQueueRefs=new yu({concurrency:AV});const{protocol:e,host:n,port:r}=t.getEndpointConfig();EV(`enabled DelegatedContentRouting via ${e}://${n}:${r}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(t,e={}){EV("findProviders starts: %c",t),e.timeout=e.timeout??_V,e.signal=al([this.abortController.signal].concat(null!=e.signal?[e.signal]:[]));const n=Cy(),r=Cy();this.httpQueue.add((async()=>(n.resolve(),await r.promise)));try{await n.promise;for await(const n of this.client.dht.findProvs(t,e))"PROVIDER"===n.name&&(yield*n.providers.map((t=>{const e={id:t.id,protocols:[],multiaddrs:t.multiaddrs};return e})))}catch(uS){throw EV.error("findProviders errored:",uS),uS}finally{r.resolve(),EV("findProviders finished: %c",t)}}async provide(t,e={}){EV("provide starts: %c",t),e.timeout=e.timeout??_V,e.signal=al([this.abortController.signal].concat(null!=e.signal?[e.signal]:[])),await this.httpQueueRefs.add((async()=>{await this.client.block.stat(t,e),await Zg(this.client.dht.provide(t,e))})),EV("provide finished: %c",t)}async put(t,e,n={}){EV("put value start: %b",t),n.timeout=n.timeout??_V,n.signal=al([this.abortController.signal].concat(null!=n.signal?[n.signal]:[])),await this.httpQueue.add((async()=>{await Zg(this.client.dht.put(t,e,n))})),EV("put value finished: %b",t)}async get(t,e={}){return EV("get value start: %b",t),e.timeout=e.timeout??_V,e.signal=al([this.abortController.signal].concat(null!=e.signal?[e.signal]:[])),await this.httpQueue.add((async()=>{for await(const n of this.client.dht.get(t,e))if("VALUE"===n.name)return EV("get value finished: %b",t),n.value;throw Vt(new Error("Not found"),"ERR_NOT_FOUND")}))}}function kV(t){return()=>new TV(t)}const RV=t=>Promise.reject(new Error(`No base found for "${t}"`));class NV{constructor(t){this._basesByName={},this._basesByPrefix={},this._loadBase=t.loadBase||RV;for(const e of t.bases)this.addBase(e)}addBase(t){if(this._basesByName[t.name]||this._basesByPrefix[t.prefix])throw new Error(`Codec already exists for codec "${t.name}"`);this._basesByName[t.name]=t,this._basesByPrefix[t.prefix]=t}removeBase(t){delete this._basesByName[t.name],delete this._basesByPrefix[t.prefix]}async getBase(t){if(this._basesByName[t])return this._basesByName[t];if(this._basesByPrefix[t])return this._basesByPrefix[t];const e=await this._loadBase(t);return null==this._basesByName[e.name]&&null==this._basesByPrefix[e.prefix]&&this.addBase(e),e}listBases(){return Object.values(this._basesByName)}}const DV=t=>Promise.reject(new Error(`No codec found for "${t}"`));class OV{constructor(t){this._codecsByName={},this._codecsByCode={},this._loadCodec=t.loadCodec||DV;for(const e of t.codecs)this.addCodec(e)}addCodec(t){if(this._codecsByName[t.name]||this._codecsByCode[t.code])throw new Error(`Resolver already exists for codec "${t.name}"`);this._codecsByName[t.name]=t,this._codecsByCode[t.code]=t}removeCodec(t){delete this._codecsByName[t.name],delete this._codecsByCode[t.code]}async getCodec(t){const e="string"===typeof t?this._codecsByName:this._codecsByCode;if(e[t])return e[t];const n=await this._loadCodec(t);return null==e[t]&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}}const PV=t=>Promise.reject(new Error(`No hasher found for "${t}"`));class xV{constructor(t){this._hashersByName={},this._hashersByCode={},this._loadHasher=t.loadHasher||PV;for(const e of t.hashers)this.addHasher(e)}addHasher(t){if(this._hashersByName[t.name]||this._hashersByCode[t.code])throw new Error(`Resolver already exists for codec "${t.name}"`);this._hashersByName[t.name]=t,this._hashersByCode[t.code]=t}removeHasher(t){delete this._hashersByName[t.name],delete this._hashersByCode[t.code]}async getHasher(t){const e="string"===typeof t?this._hashersByName:this._hashersByCode;if(e[t])return e[t];const n=await this._loadHasher(t);return null==e[t]&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}}function MV(t){try{t=vk(dc(t))}catch(uS){}return t=t.toString(),t}var LV=()=>{};const BV=zt("ipfs-http-client:lib:error-handler"),UV=nt.bind({ignoreUndefined:!0}),FV=rt.isBrowser||rt.isWebWorker?location.protocol:"http",zV=rt.isBrowser||rt.isWebWorker?location.hostname:"localhost",VV=rt.isBrowser||rt.isWebWorker?location.port:"5001",jV=(t={})=>{let e,n,r={};if("string"===typeof t||uc(t))e=new URL(MV(t));else if(t instanceof URL)e=t;else if("string"===typeof t.url||uc(t.url))e=new URL(MV(t.url)),r=t;else if(t.url instanceof URL)e=t.url,r=t;else{r=t||{};const n=(r.protocol||FV).replace(":",""),i=(r.host||zV).split(":")[0],s=r.port||VV;e=new URL(`${n}://${i}:${s}`)}if(r.apiPath?e.pathname=r.apiPath:"/"!==e.pathname&&void 0!==e.pathname||(e.pathname="api/v0"),rt.isNode){const t=LV(e);n=r.agent||new t({keepAlive:!0,maxSockets:6})}return{...r,host:e.host,protocol:e.protocol.replace(":",""),port:Number(e.port),apiPath:e.pathname,url:e,agent:n}},HV=async t=>{let e;try{if((t.headers.get("Content-Type")||"").startsWith("application/json")){const n=await t.json();BV(n),e=n.Message||n.message}else e=await t.text()}catch(uS){BV("Failed to parse error response",uS),e=uS.message}let n=new wu.HTTPError(t);throw e&&(e.includes("deadline has elapsed")&&(n=new wu.TimeoutError),e&&e.includes("context deadline exceeded")&&(n=new wu.TimeoutError)),e&&e.includes("request timed out")&&(n=new wu.TimeoutError),e&&(n.message=e),n},$V=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,KV=t=>t.replace($V,(function(t){return"-"+t.toLowerCase()})),GV=t=>"string"===typeof t?hl(t):t;class qV extends wu{constructor(t={}){const e=jV(t);super({timeout:GV(e.timeout||0)||void 0,headers:e.headers,base:`${e.url}`,handleError:HV,transformSearchParams:t=>{const e=new URLSearchParams;for(const[n,r]of t)"undefined"!==r&&"null"!==r&&"signal"!==n&&e.append(KV(n),r),"timeout"!==n||isNaN(r)||e.append(KV(n),r);return e},agent:e.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;const n=this.fetch;this.fetch=(t,r={})=>("string"!==typeof t||t.startsWith("/")||(t=`${e.url}/${t}`),n.call(this,t,UV(r,{method:"POST"})))}}wu.HTTPError;const WV=t=>e=>t(new qV(e),e);function YV(t){if(null!=t)return"string"===typeof t?t:t.toString(8).padStart(4,"0")}function XV(t){if(null==t)return;let e;if(null!=t.secs&&(e={secs:t.secs,nsecs:t.nsecs}),null!=t.Seconds&&(e={secs:t.Seconds,nsecs:t.FractionalNanoseconds}),Array.isArray(t)&&(e={secs:t[0],nsecs:t[1]}),t instanceof Date){const n=t.getTime(),r=Math.floor(n/1e3);e={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(null!=e&&null!=e.nsecs&&(e.nsecs<0||e.nsecs>999999999))throw Vt(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}function QV({arg:t,searchParams:e,hashAlg:n,mtime:r,mode:i,...s}={}){e&&(s={...s,...e}),n&&(s.hash=n),null!=r&&(r=XV(r),s.mtime=r.secs,s.mtimeNsecs=r.nsecs),null!=i&&(s.mode=YV(i)),s.timeout&&!isNaN(s.timeout)&&(s.timeout=`${s.timeout}ms`),void 0===t||null===t?t=[]:Array.isArray(t)||(t=[t]);const o=new URLSearchParams(s);return t.forEach((t=>o.append("arg",t))),o}const JV=WV((t=>{async function e(e={}){const n=await(await t.post("bitswap/wantlist",{signal:e.signal,searchParams:QV(e),headers:e.headers})).json();return(n.Keys||[]).map((t=>Me.parse(t["/"])))}return e})),ZV=WV((t=>{async function e(e,n={}){const r=await(await t.post("bitswap/wantlist",{signal:n.signal,searchParams:QV({...n,peer:e.toString()}),headers:n.headers})).json();return(r.Keys||[]).map((t=>Me.parse(t["/"])))}return e})),tj=WV((t=>{async function e(e={}){const n=await t.post("bitswap/stat",{searchParams:QV(e),signal:e.signal,headers:e.headers});return ej(await n.json())}return e}));function ej(t){return{provideBufLen:t.ProvideBufLen,wantlist:(t.Wantlist||[]).map((t=>Me.parse(t["/"]))),peers:(t.Peers||[]).map((t=>zu(t))),blocksReceived:BigInt(t.BlocksReceived),dataReceived:BigInt(t.DataReceived),blocksSent:BigInt(t.BlocksSent),dataSent:BigInt(t.DataSent),dupBlksReceived:BigInt(t.DupBlksReceived),dupDataReceived:BigInt(t.DupDataReceived)}}const nj=WV((t=>{async function e(e,n={}){const r=await t.post("bitswap/unwant",{signal:n.signal,searchParams:QV({arg:e.toString(),...n}),headers:n.headers});return r.json()}return e}));function rj(t){return{wantlist:JV(t),wantlistForPeer:ZV(t),unwant:nj(t),stat:tj(t)}}const ij=WV((t=>{async function e(e,n={}){const r=await t.post("block/get",{signal:n.signal,searchParams:QV({arg:e.toString(),...n}),headers:n.headers});return new Uint8Array(await r.arrayBuffer())}return e}));async function sj(t){if(By(t))return new Blob([t]);if("string"===typeof t||t instanceof String)return new Blob([t.toString()]);if(Uy(t))return t;if(zy(t)&&(t=xy(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const e=Ly(t),{value:n,done:r}=await e.peek();if(r)return oj(e);if(e.push(n),Number.isInteger(n))return new Blob([Uint8Array.from(await Qg(e))]);if(By(n)||"string"===typeof n||n instanceof String)return oj(e)}throw Vt(new Error(`Unexpected input: ${t}`),"ERR_UNEXPECTED_INPUT")}async function oj(t){const e=[];for await(const n of t)e.push(n);return new Blob(e)}function aj(t){return mb(t,sj,!0)}function cj(t){if(null!=t)return"string"===typeof t?t:t.toString(8).padStart(4,"0")}async function lj(t,e,n={}){const r=[],i=new FormData;let s=0,o=0;for await(const{content:a,path:c,mode:l,mtime:u}of aj(t)){let t="";const e=a?"file":"dir";s>0&&(t=`-${s}`);let n=e+t;const h=[];if(null!==l&&void 0!==l&&h.push(`mode=${cj(l)}`),null!=u){const{secs:t,nsecs:e}=u;h.push(`mtime=${t}`),null!=e&&h.push(`mtime-nsecs=${e}`)}if(h.length&&(n=`${n}?${h.join("&")}`),a){i.set(n,a,null!=c?encodeURIComponent(c):void 0);const t=o+a.size;r.push({name:c,start:o,end:t}),o=t}else{if(null==c)throw new Error("path or content or both must be set");i.set(n,new File([""],encodeURIComponent(c),{type:"application/x-directory"}))}s++}return{total:o,parts:r,headers:n,body:i}}function uj(t){return t.filter(Boolean)}function hj(...t){return(0,al.anySignal)(uj(t))}const dj=WV((t=>{async function e(n,r={}){const i=new AbortController,s=hj(i.signal,r.signal);let o;try{const e=await t.post("block/put",{signal:s,searchParams:QV(r),...await lj([n],i,r.headers)});o=await e.json()}catch(uS){if("dag-pb"===r.format)return e(n,{...r,format:"protobuf"});if("dag-cbor"===r.format)return e(n,{...r,format:"cbor"});throw uS}return Me.parse(o.Key)}return e})),fj=WV((t=>{async function*e(e,n={}){Array.isArray(e)||(e=[e]);const r=await t.post("block/rm",{signal:n.signal,searchParams:QV({arg:e.map((t=>t.toString())),"stream-channels":!0,...n}),headers:n.headers});for await(const t of r.ndjson())yield pj(t)}return e}));function pj(t){const e={cid:Me.parse(t.Hash)};return t.Error&&(e.error=new Error(t.Error)),e}const gj=WV((t=>{async function e(e,n={}){const r=await t.post("block/stat",{signal:n.signal,searchParams:QV({arg:e.toString(),...n}),headers:n.headers}),i=await r.json();return{cid:Me.parse(i.Key),size:i.Size}}return e}));function mj(t){return{get:ij(t),put:dj(t),rm:fj(t),stat:gj(t)}}const yj=WV((t=>{async function e(e,n={}){const r=await t.post("bootstrap/add",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),{Peers:i}=await r.json();return{Peers:i.map((t=>dc(t)))}}return e})),wj=WV((t=>{async function e(e={}){const n=await t.post("bootstrap/rm",{signal:e.signal,searchParams:QV({...e,all:!0}),headers:e.headers}),{Peers:r}=await n.json();return{Peers:r.map((t=>dc(t)))}}return e})),bj=WV((t=>{async function e(e={}){const n=await t.post("bootstrap/list",{signal:e.signal,searchParams:QV(e),headers:e.headers}),{Peers:r}=await n.json();return{Peers:r.map((t=>dc(t)))}}return e})),vj=WV((t=>{async function e(e={}){const n=await t.post("bootstrap/add",{signal:e.signal,searchParams:QV({...e,default:!0}),headers:e.headers}),{Peers:r}=await n.json();return{Peers:r.map((t=>dc(t)))}}return e})),Ej=WV((t=>{async function e(e,n={}){const r=await t.post("bootstrap/rm",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),{Peers:i}=await r.json();return{Peers:i.map((t=>dc(t)))}}return e}));function _j(t){return{add:yj(t),clear:wj(t),list:bj(t),reset:vj(t),rm:Ej(t)}}const Sj=WV((t=>{async function e(e,n={}){const r=await t.post("config/profile/apply",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return{original:i.OldCfg,updated:i.NewCfg}}return e}));function Aj(t){if(null==t)return t;const e=/^[A-Z]+$/,n={};return Object.keys(t).reduce(((n,r)=>(e.test(r)?n[r.toLowerCase()]=t[r]:e.test(r[0])?n[r[0].toLowerCase()+r.slice(1)]=t[r]:n[r]=t[r],n)),n)}const Cj=WV((t=>{async function e(e={}){const n=await t.post("config/profile/list",{signal:e.signal,searchParams:QV(e),headers:e.headers}),r=await n.json();return r.map((t=>Aj(t)))}return e}));function Ij(t){return{apply:Sj(t),list:Cj(t)}}const Tj=WV((t=>{const e=async(e,n={})=>{if(!e)throw new Error("key argument is required");const r=await t.post("config",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return i.Value};return e})),kj=WV((t=>{const e=async(e={})=>{const n=await t.post("config/show",{signal:e.signal,searchParams:QV({...e}),headers:e.headers}),r=await n.json();return r};return e})),Rj=WV((t=>{const e=async(e,n={})=>{const r=new AbortController,i=hj(r.signal,n.signal),s=await t.post("config/replace",{signal:i,searchParams:QV(n),...await lj([Ho(JSON.stringify(e))],r,n.headers)});await s.text()};return e})),Nj=WV((t=>{const e=async(e,n,r={})=>{if("string"!==typeof e)throw new Error("Invalid key type");const i={...r,...Dj(e,n)},s=await t.post("config",{signal:r.signal,searchParams:QV(i),headers:r.headers});await s.text()};return e})),Dj=(t,e)=>{switch(typeof e){case"boolean":return{arg:[t,e.toString()],bool:!0};case"string":return{arg:[t,e]};default:return{arg:[t,JSON.stringify(e)],json:!0}}};function Oj(t){return{getAll:kj(t),get:Tj(t),set:Nj(t),replace:Rj(t),profiles:Ij(t)}}const Pj=WV((t=>{async function*e(e,n={}){const r=await t.post("dag/export",{signal:n.signal,searchParams:QV({arg:e.toString()}),headers:n.headers});yield*r.iterator()}return e}));async function*xj(t,e,n,r,i){const s=async t=>{const e=await n.getCodec(t.code),s=await r(t,i);return e.decode(s)},o=e.split("/").filter(Boolean);let a=await s(t),c=t;while(o.length){const t=o.shift();if(!t)throw Vt(new Error(`Could not resolve path "${e}"`),"ERR_INVALID_PATH");if(!Object.prototype.hasOwnProperty.call(a,t))throw Vt(new Error(`no link named "${t}" under ${c}`),"ERR_NO_LINK");a=a[t],yield{value:a,remainderPath:o.join("/")};const n=Me.asCID(a);n&&(c=n,a=await s(a))}yield{value:a,remainderPath:""}}const Mj=(t,e)=>{const n=WV(((e,n)=>{const r=ij(n),i=async(e,n={})=>{if(n.path){const i=n.localResolve?await rk(xj(e,n.path,t,r,n)):await Gu(xj(e,n.path,t,r,n)),s=i;if(!s)throw Vt(new Error("Not found"),"ERR_NOT_FOUND");return s}const i=await t.getCodec(e.code),s=await r(e,n),o=i.decode(s);return{value:o,remainderPath:""}};return i}));return n(e)},Lj=WV((t=>{async function*e(e,n={}){const r=new AbortController,i=hj(r.signal,n.signal),{headers:s,body:o}=await lj(e,r,n.headers),a=await t.post("dag/import",{signal:i,headers:s,body:o,searchParams:QV({"pin-roots":n.pinRoots})});for await(const{Root:t}of a.ndjson())if(void 0!==t){const{Cid:{"/":e},PinErrorMsg:n}=t;yield{root:{cid:Me.parse(e),pinErrorMsg:n}}}}return e})),Bj=(t,e)=>{const n=WV((e=>{const n=async(n,r={})=>{const i={storeCodec:"dag-cbor",hashAlg:"sha2-256",...r};let s;if(i.inputCodec){if(!(n instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");s=n}else{const e=await t.getCodec(i.storeCodec);s=e.encode(n),i.inputCodec=i.storeCodec}const o=new AbortController,a=hj(o.signal,i.signal),c=await e.post("dag/put",{timeout:i.timeout,signal:a,searchParams:QV(i),...await lj([s],o,i.headers)}),l=await c.json();return Me.parse(l.Cid["/"])};return n}));return n(e)},Uj=WV((t=>{const e=async(e,n={})=>{const r=await t.post("dag/resolve",{signal:n.signal,searchParams:QV({arg:`${e}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers}),i=await r.json();return{cid:Me.parse(i.Cid["/"]),remainderPath:i.RemPath}};return e}));function Fj(t,e){return{export:Pj(e),get:Mj(t,e),import:Lj(e),put:Bj(t,e),resolve:Uj(e)}}const zj=0,Vj=1,jj=2,Hj=3,$j=4,Kj=5,Gj=6,qj=7,Wj=t=>{if(t.Type===zj)return{name:"SENDING_QUERY",type:t.Type};if(t.Type===Vj)return{from:zu(t.ID),name:"PEER_RESPONSE",type:t.Type,messageType:0,messageName:"PUT_VALUE",closer:(t.Responses||[]).map((({ID:t,Addrs:e})=>({id:zu(t),multiaddrs:e.map((t=>dc(t))),protocols:[]}))),providers:(t.Responses||[]).map((({ID:t,Addrs:e})=>({id:zu(t),multiaddrs:e.map((t=>dc(t))),protocols:[]})))};if(t.Type===jj){let e={id:t.ID??zu(t.ID),multiaddrs:[],protocols:[]};return t.Responses&&t.Responses.length&&(e={id:zu(t.Responses[0].ID),multiaddrs:t.Responses[0].Addrs.map((t=>dc(t))),protocols:[]}),{name:"FINAL_PEER",type:t.Type,peer:e}}if(t.Type===Hj)return{name:"QUERY_ERROR",type:t.Type,error:new Error(t.Extra)};if(t.Type===$j)return{name:"PROVIDER",type:t.Type,providers:t.Responses.map((({ID:t,Addrs:e})=>({id:zu(t),multiaddrs:e.map((t=>dc(t))),protocols:[]})))};if(t.Type===Kj)return{name:"VALUE",type:t.Type,value:Ho(t.Extra,"base64pad")};if(t.Type===Gj){const e=t.Responses.map((({ID:t})=>zu(t)));if(!e.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:t.Type,peer:e[0]}}if(t.Type===qj)return{name:"DIALING_PEER",type:t.Type,peer:zu(t.ID)};throw new Error("Unknown DHT event type")},Yj=WV((t=>{async function*e(e,n={}){const r=await t.post("dht/findpeer",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers});for await(const t of r.ndjson())yield Wj(t)}return e})),Xj=WV((t=>{async function*e(e,n={}){const r=await t.post("dht/findprovs",{signal:n.signal,searchParams:QV({arg:e.toString(),...n}),headers:n.headers});for await(const t of r.ndjson())yield Wj(t)}return e})),Qj=WV((t=>{async function*e(e,n={}){const r=await t.post("dht/get",{signal:n.signal,searchParams:QV({arg:e instanceof Uint8Array?sa(e):e.toString(),...n}),headers:n.headers});for await(const t of r.ndjson())yield Wj(t)}return e})),Jj=WV((t=>{async function*e(e,n={recursive:!1}){const r=Array.isArray(e)?e:[e],i=await t.post("dht/provide",{signal:n.signal,searchParams:QV({arg:r.map((t=>t.toString())),...n}),headers:n.headers});for await(const t of i.ndjson())yield Wj(t)}return e})),Zj=WV((t=>{async function*e(e,n,r={}){const i=new AbortController,s=hj(i.signal,r.signal),o=await t.post("dht/put",{signal:s,searchParams:QV({arg:e instanceof Uint8Array?sa(e):e.toString(),...r}),...await lj([n],i,r.headers)});for await(const t of o.ndjson())yield Wj(t)}return e})),tH=WV((t=>{async function*e(e,n={}){const r=await t.post("dht/query",{signal:n.signal,searchParams:QV({arg:e.toString(),...n}),headers:n.headers});for await(const t of r.ndjson())yield Wj(t)}return e}));function eH(t){return{findPeer:Yj(t),findProvs:Xj(t),get:Qj(t),provide:Jj(t),put:Zj(t),query:tH(t)}}const nH=WV((t=>{async function e(e={}){const n=await t.post("diag/cmds",{signal:e.signal,searchParams:QV(e),headers:e.headers});return n.json()}return e})),rH=WV((t=>{async function e(e={}){const n=await t.post("diag/net",{signal:e.signal,searchParams:QV(e),headers:e.headers});return n.json()}return e})),iH=WV((t=>{async function e(e={}){const n=await t.post("diag/sys",{signal:e.signal,searchParams:QV(e),headers:e.headers});return n.json()}return e}));function sH(t){return{cmds:nH(t),net:rH(t),sys:iH(t)}}const oH=WV((t=>{async function e(e,n,r={}){const i=await t.post("files/chmod",{signal:r.signal,searchParams:QV({arg:e,mode:n,...r}),headers:r.headers});await i.text()}return e})),aH=WV((t=>{async function e(e,n,r={}){const i=Array.isArray(e)?e:[e],s=await t.post("files/cp",{signal:r.signal,searchParams:QV({arg:i.concat(n).map((t=>Me.asCID(t)?`/ipfs/${t}`:t)),...r}),headers:r.headers});await s.text()}return e})),cH=WV((t=>{async function e(e,n={}){if(!e||"string"!==typeof e)throw new Error("ipfs.files.flush requires a path");const r=await t.post("files/flush",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return Me.parse(i.Cid)}return e}));function lH(t){const e=Aj(t);return Object.prototype.hasOwnProperty.call(e,"mode")&&(e.mode=parseInt(e.mode,8)),Object.prototype.hasOwnProperty.call(e,"mtime")&&(e.mtime={secs:e.mtime,nsecs:e.mtimeNsecs||0},delete e.mtimeNsecs),e}const uH=WV((t=>{async function*e(e,n={}){if(!e)throw new Error("ipfs.files.ls requires a path");const r=await t.post("files/ls",{signal:n.signal,searchParams:QV({arg:Me.asCID(e)?`/ipfs/${e}`:e,long:!0,...n,stream:!0}),headers:n.headers});for await(const t of r.ndjson())if("Entries"in t)for(const e of t.Entries||[])yield hH(lH(e));else yield hH(lH(t))}return e}));function hH(t){return t.hash&&(t.cid=Me.parse(t.hash)),delete t.hash,t.type=1===t.type?"directory":"file",t}const dH=WV((t=>{async function e(e,n={}){const r=await t.post("files/mkdir",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers});await r.text()}return e})),fH=WV((t=>{async function e(e,n,r={}){Array.isArray(e)||(e=[e]);const i=await t.post("files/mv",{signal:r.signal,searchParams:QV({arg:e.concat(n),...r}),headers:r.headers});await i.text()}return e}));var pH=n(1128);const gH=WV((t=>{async function*e(e,n={}){const r=await t.post("files/read",{signal:n.signal,searchParams:QV({arg:e,count:n.length,...n}),headers:n.headers});yield*pH(r.body)}return e})),mH=WV((t=>{async function e(e,n={}){const r=await t.post("files/rm",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.text();if(""!==i){const t=new wu.HTTPError(r);throw t.message=i,t}}return e})),yH=WV((t=>{async function e(e,n={}){const r=await t.post("files/stat",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return i.WithLocality=i.WithLocality||!1,wH(lH(i))}return e}));function wH(t){return t.cid=Me.parse(t.hash),delete t.hash,t}const bH=WV((t=>{async function e(e,n={}){const r=await t.post("files/touch",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers});await r.text()}return e})),vH=WV((t=>{async function e(e,n,r={}){const i=new AbortController,s=hj(i.signal,r.signal),o=await t.post("files/write",{signal:s,searchParams:QV({arg:e,streamChannels:!0,count:r.length,...r}),...await lj([{content:n,path:"arg",mode:YV(r.mode),mtime:XV(r.mtime)}],i,r.headers)});await o.text()}return e}));function EH(t){return{chmod:oH(t),cp:aH(t),flush:cH(t),ls:uH(t),mkdir:dH(t),mv:fH(t),read:gH(t),rm:mH(t),stat:yH(t),touch:bH(t),write:vH(t)}}const _H=WV((t=>{const e=async(t,e,n={})=>{throw Vt(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};return e})),SH=WV((t=>{async function e(e,n={type:"Ed25519"}){const r=await t.post("key/gen",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return Aj(i)}return e})),AH=WV((t=>{async function e(e,n,r,i={}){const s=await t.post("key/import",{signal:i.signal,searchParams:QV({arg:e,pem:n,password:r,...i}),headers:i.headers}),o=await s.json();return Aj(o)}return e})),CH=WV((t=>{const e=async(t,e={})=>{throw Vt(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};return e})),IH=WV((t=>{async function e(e={}){const n=await t.post("key/list",{signal:e.signal,searchParams:QV(e),headers:e.headers}),r=await n.json();return(r.Keys||[]).map((t=>Aj(t)))}return e})),TH=WV((t=>{async function e(e,n,r={}){const i=await t.post("key/rename",{signal:r.signal,searchParams:QV({arg:[e,n],...r}),headers:r.headers});return Aj(await i.json())}return e})),kH=WV((t=>{async function e(e,n={}){const r=await t.post("key/rm",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return Aj(i.Keys[0])}return e}));function RH(t){return{export:_H(t),gen:SH(t),import:AH(t),info:CH(t),list:IH(t),rename:TH(t),rm:kH(t)}}const NH=WV((t=>{async function e(e,n,r={}){const i=await t.post("log/level",{signal:r.signal,searchParams:QV({arg:[e,n],...r}),headers:r.headers});return Aj(await i.json())}return e})),DH=WV((t=>{async function e(e={}){const n=await t.post("log/ls",{signal:e.signal,searchParams:QV(e),headers:e.headers}),r=await n.json();return r.Strings}return e})),OH=WV((t=>{async function*e(e={}){const n=await t.post("log/tail",{signal:e.signal,searchParams:QV(e),headers:e.headers});yield*n.ndjson()}return e}));function PH(t){return{level:NH(t),ls:DH(t),tail:OH(t)}}const xH=WV((t=>{async function e(e,n={}){const r=await t.post("name/publish",{signal:n.signal,searchParams:QV({arg:`${e}`,...n}),headers:n.headers});return Aj(await r.json())}return e})),MH=WV((t=>{async function*e(e,n={}){const r=await t.post("name/resolve",{signal:n.signal,searchParams:QV({arg:e,stream:!0,...n}),headers:n.headers});for await(const t of r.ndjson())yield t.Path}return e})),LH=WV((t=>{async function e(e,n={}){const r=await t.post("name/pubsub/cancel",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers});return Aj(await r.json())}return e})),BH=WV((t=>{async function e(e={}){const n=await t.post("name/pubsub/state",{signal:e.signal,searchParams:QV(e),headers:e.headers});return Aj(await n.json())}return e})),UH=WV((t=>{async function e(e={}){const n=await t.post("name/pubsub/subs",{signal:e.signal,searchParams:QV(e),headers:e.headers}),r=await n.json();return r.Strings||[]}return e}));function FH(t){return{cancel:LH(t),state:BH(t),subs:UH(t)}}function zH(t){return{publish:xH(t),resolve:MH(t),pubsub:FH(t)}}const VH=WV((t=>{async function e(e,n={}){const r=await t.post("object/data",{signal:n.signal,searchParams:QV({arg:`${e instanceof Uint8Array?Me.decode(e):e}`,...n}),headers:n.headers}),i=await r.arrayBuffer();return new Uint8Array(i,0,i.byteLength)}return e})),jH=WV((t=>{async function e(e,n={}){const r=await t.post("object/get",{signal:n.signal,searchParams:QV({arg:`${e instanceof Uint8Array?Me.decode(e):e}`,dataEncoding:"base64",...n}),headers:n.headers}),i=await r.json();return{Data:Ho(i.Data,"base64pad"),Links:(i.Links||[]).map((t=>({Name:t.Name,Hash:Me.parse(t.Hash),Tsize:t.Size})))}}return e})),HH=WV((t=>{async function e(e,n={}){const r=await t.post("object/links",{signal:n.signal,searchParams:QV({arg:`${e instanceof Uint8Array?Me.decode(e):e}`,...n}),headers:n.headers}),i=await r.json();return(i.Links||[]).map((t=>({Name:t.Name,Tsize:t.Size,Hash:Me.parse(t.Hash)})))}return e})),$H=WV((t=>{async function e(e={}){const n=await t.post("object/new",{signal:e.signal,searchParams:QV({arg:e.template,...e}),headers:e.headers}),{Hash:r}=await n.json();return Me.parse(r)}return e})),KH=(t,e)=>{const n=WV((n=>{const r=Bj(t,e);async function i(t,e={}){return r(t,{...e,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}return i}));return n(e)},GH=WV((t=>{async function e(e,n={}){const r=await t.post("object/stat",{signal:n.signal,searchParams:QV({arg:`${e}`,...n}),headers:n.headers}),i=await r.json();return{...i,Hash:Me.parse(i.Hash)}}return e})),qH=WV((t=>{async function e(e,n,r={}){const i=await t.post("object/patch/add-link",{signal:r.signal,searchParams:QV({arg:[`${e}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...r}),headers:r.headers}),{Hash:s}=await i.json();return Me.parse(s)}return e})),WH=WV((t=>{async function e(e,n,r={}){const i=new AbortController,s=hj(i.signal,r.signal),o=await t.post("object/patch/append-data",{signal:s,searchParams:QV({arg:`${e}`,...r}),...await lj([n],i,r.headers)}),{Hash:a}=await o.json();return Me.parse(a)}return e})),YH=WV((t=>{async function e(e,n,r={}){const i=await t.post("object/patch/rm-link",{signal:r.signal,searchParams:QV({arg:[`${e}`,n.Name||n.name||null],...r}),headers:r.headers}),{Hash:s}=await i.json();return Me.parse(s)}return e})),XH=WV((t=>{async function e(e,n,r={}){const i=new AbortController,s=hj(i.signal,r.signal),o=await t.post("object/patch/set-data",{signal:s,searchParams:QV({arg:[`${e}`],...r}),...await lj([n],i,r.headers)}),{Hash:a}=await o.json();return Me.parse(a)}return e}));function QH(t){return{addLink:qH(t),appendData:WH(t),rmLink:YH(t),setData:XH(t)}}function JH(t,e){return{data:VH(e),get:jH(e),links:HH(e),new:$H(e),put:KH(t,e),stat:GH(e),patch:QH(e)}}const ZH=WV((t=>{async function*e(e,n={}){for await(const{path:r,recursive:i,metadata:s}of Wu(e)){const e=await t.post("pin/add",{signal:n.signal,searchParams:QV({...n,arg:r,recursive:i,metadata:s?JSON.stringify(s):void 0,stream:!0}),headers:n.headers});for await(const t of e.ndjson())if(t.Pins)for(const e of t.Pins)yield Me.parse(e);else yield Me.parse(t)}}return e}));function t$(t){const e=ZH(t);return WV((()=>{async function t(t,n={}){return Gu(e([{path:t,...n}],n))}return t}))(t)}function e$(t,e,n){const r={type:t,cid:Me.parse(e)};return n&&(r.metadata=n),r}const n$=WV((t=>{async function*e(e={}){let n=[];e.paths&&(n=Array.isArray(e.paths)?e.paths:[e.paths]);const r=await t.post("pin/ls",{signal:e.signal,searchParams:QV({...e,arg:n.map((t=>`${t}`)),stream:!0}),headers:e.headers});for await(const t of r.ndjson()){if(t.Keys){for(const e of Object.keys(t.Keys))yield e$(t.Keys[e].Type,e,t.Keys[e].Metadata);return}yield e$(t.Type,t.Cid,t.Metadata)}}return e})),r$=WV((t=>{async function*e(e,n={}){for await(const{path:r,recursive:i}of Wu(e)){const e=new URLSearchParams(n.searchParams);e.append("arg",`${r}`),null!=i&&e.set("recursive",String(i));const s=await t.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:QV({...n,arg:`${r}`,recursive:i})});for await(const t of s.ndjson())t.Pins?yield*t.Pins.map((t=>Me.parse(t))):yield Me.parse(t)}}return e})),i$=t=>{const e=r$(t);return WV((()=>{async function t(t,n={}){return Gu(e([{path:t,...n}],n))}return t}))(t)},s$=({Name:t,Status:e,Cid:n})=>({cid:Me.parse(n),name:t,status:e}),o$=t=>{if("string"===typeof t&&""!==t)return t;throw new TypeError("service name must be passed")},a$=t=>{if(Me.asCID(t))return t.toString();throw new TypeError("CID instance expected instead of "+typeof t)},c$=({service:t,cid:e,name:n,status:r,all:i})=>{const s=QV({service:o$(t),name:n,force:!!i||void 0});if(e)for(const o of e)s.append("cid",a$(o));if(r)for(const o of r)s.append("status",o);return s},l$=({cid:t,service:e,background:n,name:r,origins:i})=>{const s=QV({arg:a$(t),service:o$(e),name:r,background:!!n||void 0});if(i)for(const o of i)s.append("origin",o.toString());return s};function u$(t){async function e(e,{timeout:n,signal:r,headers:i,...s}){const o=await t.post("pin/remote/add",{timeout:n,signal:r,headers:i,searchParams:l$({cid:e,...s})});return s$(await o.json())}return e}function h$(t){async function*e({timeout:e,signal:n,headers:r,...i}){const s=await t.post("pin/remote/ls",{timeout:e,signal:n,headers:r,searchParams:c$(i)});for await(const t of s.ndjson())yield s$(t)}return e}function d$(t){async function e({timeout:e,signal:n,headers:r,...i}){await t.post("pin/remote/rm",{timeout:e,signal:n,headers:r,searchParams:c$({...i,all:!1})})}return e}function f$(t){async function e({timeout:e,signal:n,headers:r,...i}){await t.post("pin/remote/rm",{timeout:e,signal:n,headers:r,searchParams:c$({...i,all:!0})})}return e}function p$(t){const e=String(t);if("undefined"===e)throw Error("endpoint is required");return"/"===e[e.length-1]?e.slice(0,-1):e}function g$(t){return{service:t.Service,endpoint:new URL(t.ApiEndpoint),...t.Stat&&{stat:m$(t.Stat)}}}function m$(t){switch(t.Status){case"valid":{const{Pinning:e,Pinned:n,Queued:r,Failed:i}=t.PinCount;return{status:"valid",pinCount:{queued:r,pinning:e,pinned:n,failed:i}}}case"invalid":return{status:"invalid"};default:return{status:t.Status}}}function y$(t){async function e(e,n){const{endpoint:r,key:i,headers:s,timeout:o,signal:a}=n;await t.post("pin/remote/service/add",{timeout:o,signal:a,searchParams:QV({arg:[e,p$(r),i]}),headers:s})}return e}function w$(t){async function e(e={}){const{stat:n,headers:r,timeout:i,signal:s}=e,o=await t.post("pin/remote/service/ls",{timeout:i,signal:s,headers:r,searchParams:!0===n?QV({stat:n}):void 0}),{RemoteServices:a}=await o.json();return a.map(g$)}return e}function b$(t){async function e(e,n={}){await t.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:QV({arg:e})})}return e}function v$(t){const e=new qV(t);return{add:y$(e),ls:w$(e),rm:b$(e)}}function E$(t){const e=new qV(t);return{add:u$(e),ls:h$(e),rm:d$(e),rmAll:f$(e),service:v$(t)}}function _$(t){return{addAll:ZH(t),add:t$(t),ls:n$(t),rmAll:r$(t),rm:i$(t),remote:E$(t)}}const S$=t=>Array.isArray(t)?t.map(A$):t,A$=t=>sa(C$(t)),C$=t=>Ut.decode(t),I$=t=>BigInt(`0x${sa(Ut.decode(t),"base16")}`),T$=t=>Ut.encode(Ho(t)),k$=WV((t=>{async function e(e={}){const{Strings:n}=await(await t.post("pubsub/ls",{signal:e.signal,searchParams:QV(e),headers:e.headers})).json();return S$(n)||[]}return e})),R$=WV((t=>{async function e(e,n={}){const r=await t.post("pubsub/peers",{signal:n.signal,searchParams:QV({arg:T$(e),...n}),headers:n.headers}),{Strings:i}=await r.json();return i||[]}return e})),N$=WV((t=>{async function e(e,n,r={}){const i=QV({arg:T$(e),...r}),s=new AbortController,o=hj(s.signal,r.signal),a=await t.post("pubsub/pub",{signal:o,searchParams:i,...await lj([n],s,r.headers)});await a.text()}return e})),D$=zt("ipfs-http-client:pubsub:subscribe"),O$=(t,e)=>WV((t=>{async function n(n,r,i={}){let s,o;i.signal=e.subscribe(n,r,i.signal);const a=new Promise(((t,e)=>{s=t,o=e})),c=setTimeout((()=>s()),1e3);return t.post("pubsub/sub",{signal:i.signal,searchParams:QV({arg:T$(n),...i}),headers:i.headers}).catch((t=>{e.unsubscribe(n,r),o(t)})).then((t=>{clearTimeout(c),t&&(P$(t,{onMessage:t=>{r&&("function"!==typeof r?"function"===typeof r.handleEvent&&r.handleEvent(t):r(t))},onEnd:()=>e.unsubscribe(n,r),onError:i.onError}),s())})),a}return n}))(t);async function P$(t,{onMessage:e,onEnd:n,onError:r}){r=r||D$;try{for await(const n of t.ndjson())try{if(!n.from)continue;null!=n.from&&null!=n.seqno?e({type:"signed",from:zu(n.from),data:C$(n.data),sequenceNumber:I$(n.seqno),topic:A$(n.topicIDs[0]),key:C$(n.key??"u"),signature:C$(n.signature??"u")}):e({type:"unsigned",data:C$(n.data),topic:A$(n.topicIDs[0])})}catch(uS){uS.message=`Failed to parse pubsub message: ${uS.message}`,r(uS,!1,n)}}catch(uS){x$(uS)||r(uS,!0)}finally{n()}}const x$=t=>{switch(t.type){case"aborted":return!0;case"abort":return!0;default:return"AbortError"===t.name}},M$=(t,e)=>{async function n(t,n){e.unsubscribe(t,n)}return n};class L${constructor(){this._subs=new Map}subscribe(t,e,n){const r=this._subs.get(t)||[];if(r.find((t=>t.handler===e)))throw new Error(`Already subscribed to ${t} with this handler`);const i=new AbortController;return this._subs.set(t,[{handler:e,controller:i}].concat(r)),n&&n.addEventListener("abort",(()=>this.unsubscribe(t,e))),i.signal}unsubscribe(t,e){const n=this._subs.get(t)||[];let r;e?(this._subs.set(t,n.filter((t=>t.handler!==e))),r=n.filter((t=>t.handler===e))):(this._subs.set(t,[]),r=n),(this._subs.get(t)||[]).length||this._subs.delete(t),r.forEach((t=>t.controller.abort()))}}function B$(t){const e=new L$;return{ls:k$(t),peers:R$(t),publish:N$(t),subscribe:O$(t,e),unsubscribe:M$(t,e)}}const U$=WV((t=>{async function*e(e={}){const n=await t.post("refs/local",{signal:e.signal,transform:Aj,searchParams:QV(e),headers:e.headers});yield*n.ndjson()}return e})),F$=WV(((t,e)=>{const n=async function*(e,n={}){const r=Array.isArray(e)?e:[e],i=await t.post("refs",{signal:n.signal,searchParams:QV({arg:r.map((t=>`${t instanceof Uint8Array?Me.decode(t):t}`)),...n}),headers:n.headers,transform:Aj});yield*i.ndjson()};return Object.assign(n,{local:U$(e)})})),z$=WV((t=>{async function*e(e={}){const n=await t.post("repo/gc",{signal:e.signal,searchParams:QV(e),headers:e.headers,transform:t=>({err:t.Error?new Error(t.Error):null,cid:(t.Key||{})["/"]?Me.parse(t.Key["/"]):null})});yield*n.ndjson()}return e})),V$=WV((t=>{async function e(e={}){const n=await t.post("repo/stat",{signal:e.signal,searchParams:QV(e),headers:e.headers}),r=await n.json();return{numObjects:BigInt(r.NumObjects),repoSize:BigInt(r.RepoSize),repoPath:r.RepoPath,version:r.Version,storageMax:BigInt(r.StorageMax)}}return e})),j$=WV((t=>{async function e(e={}){const n=await(await t.post("repo/version",{signal:e.signal,searchParams:QV(e),headers:e.headers})).json();return n.Version}return e}));function H$(t){return{gc:z$(t),stat:V$(t),version:j$(t)}}const $$=WV((t=>{async function*e(e={}){const n=await t.post("stats/bw",{signal:e.signal,searchParams:QV(e),headers:e.headers,transform:t=>({totalIn:BigInt(t.TotalIn),totalOut:BigInt(t.TotalOut),rateIn:parseFloat(t.RateIn),rateOut:parseFloat(t.RateOut)})});yield*n.ndjson()}return e}));function K$(t){return{bitswap:tj(t),repo:V$(t),bw:$$(t)}}const G$=WV((t=>{async function e(e={}){const n=await t.post("swarm/addrs",{signal:e.signal,searchParams:QV(e),headers:e.headers}),{Addrs:r}=await n.json();return Object.keys(r).map((t=>({id:zu(t),addrs:(r[t]||[]).map((t=>dc(t)))})))}return e})),q$=WV((t=>{async function e(e,n={}){const r=await t.post("swarm/connect",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),{Strings:i}=await r.json();return i||[]}return e})),W$=WV((t=>{async function e(e,n={}){const r=await t.post("swarm/disconnect",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),{Strings:i}=await r.json();return i||[]}return e})),Y$=WV((t=>{async function e(e={}){const n=await t.post("swarm/addrs/local",{signal:e.signal,searchParams:QV(e),headers:e.headers}),{Strings:r}=await n.json();return(r||[]).map((t=>dc(t)))}return e})),X$=WV((t=>{async function e(e={}){const n=await t.post("swarm/peers",{signal:e.signal,searchParams:QV(e),headers:e.headers}),{Peers:r}=await n.json();return(r||[]).map((t=>({addr:dc(t.Addr),peer:zu(t.Peer),muxer:t.Muxer,latency:t.Latency,streams:t.Streams,direction:null==t.Direction?void 0:0===t.Direction?"inbound":"outbound"})))}return e}));function Q$(t){return{addrs:G$(t),connect:q$(t),disconnect:W$(t),localAddrs:Y$(t),peers:X$(t)}}const J$=WV((t=>{async function*e(e,n={}){const r=new AbortController,i=hj(r.signal,n.signal),{headers:s,body:o,total:a,parts:c}=await lj(e,r,n.headers),[l,u]="function"===typeof n.progress?Z$(a,c,n.progress):[void 0,void 0],h=await t.post("add",{searchParams:QV({"stream-channels":!0,...n,progress:Boolean(l)}),onUploadProgress:u,signal:i,headers:s,body:o});for await(let t of h.ndjson())t=Aj(t),void 0!==t.hash?yield eK(t):l&&l(t.bytes||0,t.name)}return e})),Z$=(t,e,n)=>e?[void 0,tK(t,e,n)]:[n,void 0],tK=(t,e,n)=>{let r=0;const i=e.length;return({loaded:s,total:o})=>{const a=Math.floor(s/o*t);while(r<i){const{start:t,end:i,name:s}=e[r];if(a<i){n(a-t,s);break}n(i-t,s),r+=1}}};function eK({name:t,hash:e,size:n,mode:r,mtime:i,mtimeNsecs:s}){const o={path:t,cid:Me.parse(e),size:parseInt(n)};return null!=r&&(o.mode=parseInt(r,8)),null!=i&&(o.mtime={secs:i,nsecs:s||0}),o}function nK(t){const e=J$(t);return WV((()=>{async function t(t,n={}){return await Gu(e(Gy(t),n))}return t}))(t)}const rK=WV((t=>{async function*e(e,n={}){const r=await t.post("cat",{signal:n.signal,searchParams:QV({arg:e.toString(),...n}),headers:n.headers});yield*r.iterator()}return e})),iK=WV((t=>{const e=async(e={})=>{const n=await t.post("commands",{signal:e.signal,searchParams:QV(e),headers:e.headers});return n.json()};return e})),sK=WV((t=>{const e=async(e,n={})=>{const r=await t.post("dns",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),i=await r.json();return i.Path};return e})),oK=WV((t=>()=>{const e=new URL(t.opts.base||"");return{host:e.hostname,port:e.port,protocol:e.protocol,pathname:e.pathname,"api-path":e.pathname}})),aK=WV((t=>{async function*e(e,n={}){const r={arg:`${e instanceof Uint8Array?Me.decode(e):e}`,...n};r.compressionLevel&&(r["compression-level"]=r.compressionLevel,delete r.compressionLevel);const i=await t.post("get",{signal:n.signal,searchParams:QV(r),headers:n.headers});yield*i.iterator()}return e})),cK=WV((t=>{async function e(e={}){const n=await t.post("id",{signal:e.signal,searchParams:QV({arg:e.peerId?e.peerId.toString():void 0,...e}),headers:e.headers}),r=await n.json(),i={...Aj(r)};return i.id=zu(i.id),i.addresses&&(i.addresses=i.addresses.map((t=>dc(t)))),i}return e})),lK=t=>{const e=cK(t);async function n(t={}){const n=await e(t);return Boolean(n&&n.addresses&&n.addresses.length)}return n},uK=WV(((t,e)=>{async function*n(n,r={}){const i=`${n instanceof Uint8Array?Me.decode(n):n}`;async function s(t){let n=t.Hash;if(n.includes("/")){const t=n.startsWith("/ipfs/")?n:`/ipfs/${n}`,r=await yH(e)(t);n=r.cid}else n=Me.parse(n);const r={name:t.Name,path:i+(t.Name?`/${t.Name}`:""),size:t.Size,cid:n,type:hK(t)};return t.Mode&&(r.mode=parseInt(t.Mode,8)),void 0!==t.Mtime&&null!==t.Mtime&&(r.mtime={secs:t.Mtime},void 0!==t.MtimeNsecs&&null!==t.MtimeNsecs&&(r.mtime.nsecs=t.MtimeNsecs)),r}const o=await t.post("ls",{signal:r.signal,searchParams:QV({arg:i,...r}),headers:r.headers});for await(let t of o.ndjson()){if(t=t.Objects,!t)throw new Error("expected .Objects in results");if(t=t[0],!t)throw new Error("expected one array in results.Objects");const e=t.Links;if(!Array.isArray(e))throw new Error("expected one array in results.Objects[0].Links");if(!e.length)return void(yield s(t));yield*e.map(s)}}return n}));function hK(t){switch(t.Type){case 1:case 5:return"dir";case 2:return"file";default:return"file"}}const dK=WV((t=>{async function e(e={}){const n=await t.post("dns",{signal:e.signal,searchParams:QV(e),headers:e.headers});return Aj(await n.json())}return e})),fK=WV((t=>{async function*e(e,n={}){const r=await t.post("ping",{signal:n.signal,searchParams:QV({arg:`${e}`,...n}),headers:n.headers,transform:Aj});yield*r.ndjson()}return e})),pK=WV((t=>{async function e(e,n={}){const r=await t.post("resolve",{signal:n.signal,searchParams:QV({arg:e,...n}),headers:n.headers}),{Path:i}=await r.json();return i}return e})),gK=WV((t=>{const e=async(t={})=>{throw Vt(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};return e})),mK=WV((t=>{async function e(e={}){const n=await t.post("shutdown",{signal:e.signal,searchParams:QV(e),headers:e.headers});await n.text()}return e})),yK=WV((t=>{async function e(e={}){const n=await t.post("version",{signal:e.signal,searchParams:QV(e),headers:e.headers});return{...Aj(await n.json()),"ipfs-http-client":"1.0.0"}}return e}));n(4701),n(1819);function wK(t={}){const e={name:Ys.name,code:Ys.code,encode:t=>t,decode:t=>t},n=Object.values(Ao);(t.ipld&&t.ipld.bases?t.ipld.bases:[]).forEach((t=>n.push(t)));const r=new NV({bases:n,loadBase:t.ipld&&t.ipld.loadBase}),i=Object.values(Io);[o,a,c,l,e].concat(t.ipld&&t.ipld.codecs||[]).forEach((t=>i.push(t)));const s=new OV({codecs:i,loadCodec:t.ipld&&t.ipld.loadCodec}),u=Object.values(Co);(t.ipld&&t.ipld.hashers?t.ipld.hashers:[]).forEach((t=>u.push(t)));const h=new xV({hashers:u,loadHasher:t.ipld&&t.ipld.loadHasher}),d={add:nK(t),addAll:J$(t),bitswap:rj(t),block:mj(t),bootstrap:_j(t),cat:rK(t),commands:iK(t),config:Oj(t),dag:Fj(s,t),dht:eH(t),diag:sH(t),dns:sK(t),files:EH(t),get:aK(t),getEndpointConfig:oK(t),id:cK(t),isOnline:lK(t),key:RH(t),log:PH(t),ls:uK(t),mount:dK(t),name:zH(t),object:JH(s,t),pin:_$(t),ping:fK(t),pubsub:B$(t),refs:F$(t),repo:H$(t),resolve:pK(t),start:gK(t),stats:K$(t),stop:mK(t),swarm:Q$(t),version:yK(t),bases:r,codecs:s,hashers:h};return d}const bK=421,vK=290,EK=2e3,_K=Object.create(null);_K["open"]="0",_K["close"]="1",_K["ping"]="2",_K["pong"]="3",_K["message"]="4",_K["upgrade"]="5",_K["noop"]="6";const SK=Object.create(null);Object.keys(_K).forEach((t=>{SK[_K[t]]=t}));const AK={type:"error",data:"parser error"},CK="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),IK="function"===typeof ArrayBuffer,TK=t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,kK=({type:t,data:e},n,r)=>CK&&e instanceof Blob?n?r(e):RK(e,r):IK&&(e instanceof ArrayBuffer||TK(e))?n?r(e):RK(new Blob([e]),r):r(_K[t]+(e||"")),RK=(t,e)=>{const n=new FileReader;return n.onload=function(){const t=n.result.split(",")[1];e("b"+t)},n.readAsDataURL(t)};var NK=kK;const DK="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",OK="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let K6=0;K6<DK.length;K6++)OK[DK.charCodeAt(K6)]=K6;const PK=t=>{let e,n,r,i,s,o=.75*t.length,a=t.length,c=0;"="===t[t.length-1]&&(o--,"="===t[t.length-2]&&o--);const l=new ArrayBuffer(o),u=new Uint8Array(l);for(e=0;e<a;e+=4)n=OK[t.charCodeAt(e)],r=OK[t.charCodeAt(e+1)],i=OK[t.charCodeAt(e+2)],s=OK[t.charCodeAt(e+3)],u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|i>>2,u[c++]=(3&i)<<6|63&s;return l},xK="function"===typeof ArrayBuffer,MK=(t,e)=>{if("string"!==typeof t)return{type:"message",data:BK(t,e)};const n=t.charAt(0);if("b"===n)return{type:"message",data:LK(t.substring(1),e)};const r=SK[n];return r?t.length>1?{type:SK[n],data:t.substring(1)}:{type:SK[n]}:AK},LK=(t,e)=>{if(xK){const n=PK(t);return BK(n,e)}return{base64:!0,data:t}},BK=(t,e)=>{switch(e){case"blob":return t instanceof ArrayBuffer?new Blob([t]):t;case"arraybuffer":default:return t}};var UK=MK;const FK=String.fromCharCode(30),zK=(t,e)=>{const n=t.length,r=new Array(n);let i=0;t.forEach(((t,s)=>{NK(t,!1,(t=>{r[s]=t,++i===n&&e(r.join(FK))}))}))},VK=(t,e)=>{const n=t.split(FK),r=[];for(let i=0;i<n.length;i++){const t=UK(n[i],e);if(r.push(t),"error"===t.type)break}return r},jK=4;function HK(t){if(t)return $K(t)}function $K(t){for(var e in HK.prototype)t[e]=HK.prototype[e];return t}HK.prototype.on=HK.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},HK.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},HK.prototype.off=HK.prototype.removeListener=HK.prototype.removeAllListeners=HK.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var i=0;i<r.length;i++)if(n=r[i],n===e||n.fn===e){r.splice(i,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},HK.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){n=n.slice(0);r=0;for(var i=n.length;r<i;++r)n[r].apply(this,e)}return this},HK.prototype.emitReserved=HK.prototype.emit,HK.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},HK.prototype.hasListeners=function(t){return!!this.listeners(t).length};const KK=(()=>"undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")())();function GK(t,...e){return e.reduce(((e,n)=>(t.hasOwnProperty(n)&&(e[n]=t[n]),e)),{})}const qK=setTimeout,WK=clearTimeout;function YK(t,e){e.useNativeTimers?(t.setTimeoutFn=qK.bind(KK),t.clearTimeoutFn=WK.bind(KK)):(t.setTimeoutFn=setTimeout.bind(KK),t.clearTimeoutFn=clearTimeout.bind(KK))}const XK=1.33;function QK(t){return"string"===typeof t?JK(t):Math.ceil((t.byteLength||t.size)*XK)}function JK(t){let e=0,n=0;for(let r=0,i=t.length;r<i;r++)e=t.charCodeAt(r),e<128?n+=1:e<2048?n+=2:e<55296||e>=57344?n+=3:(r++,n+=4);return n}class ZK extends Error{constructor(t,e,n){super(t),this.description=e,this.context=n,this.type="TransportError"}}class tG extends HK{constructor(t){super(),this.writable=!1,YK(this,t),this.opts=t,this.query=t.query,this.readyState="",this.socket=t.socket}onError(t,e,n){return super.emitReserved("error",new ZK(t,e,n)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(t){"open"===this.readyState&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const e=UK(t,this.socket.binaryType);this.onPacket(e)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}}const eG="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),nG=64,rG={};let iG,sG=0,oG=0;function aG(t){let e="";do{e=eG[t%nG]+e,t=Math.floor(t/nG)}while(t>0);return e}function cG(){const t=aG(+new Date);return t!==iG?(sG=0,iG=t):t+"."+aG(sG++)}for(;oG<nG;oG++)rG[eG[oG]]=oG;function lG(t){let e="";for(let n in t)t.hasOwnProperty(n)&&(e.length&&(e+="&"),e+=encodeURIComponent(n)+"="+encodeURIComponent(t[n]));return e}function uG(t){let e={},n=t.split("&");for(let r=0,i=n.length;r<i;r++){let t=n[r].split("=");e[decodeURIComponent(t[0])]=decodeURIComponent(t[1])}return e}let hG=!1;try{hG="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(uS){}const dG=hG;function fG(t){const e=t.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!e||dG))return new XMLHttpRequest}catch(n){}if(!e)try{return new(KK[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function pG(){}const gG=function(){const t=new fG({xdomain:!1});return null!=t.responseType}();class mG extends tG{constructor(t){if(super(t),this.polling=!1,"undefined"!==typeof location){const e="https:"===location.protocol;let n=location.port;n||(n=e?"443":"80"),this.xd="undefined"!==typeof location&&t.hostname!==location.hostname||n!==t.port,this.xs=t.secure!==e}const e=t&&t.forceBase64;this.supportsBinary=gG&&!e}get name(){return"polling"}doOpen(){this.poll()}pause(t){this.readyState="pausing";const e=()=>{this.readyState="paused",t()};if(this.polling||!this.writable){let t=0;this.polling&&(t++,this.once("pollComplete",(function(){--t||e()}))),this.writable||(t++,this.once("drain",(function(){--t||e()})))}else e()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const e=t=>{if("opening"===this.readyState&&"open"===t.type&&this.onOpen(),"close"===t.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(t)};VK(t,this.socket.binaryType).forEach(e),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const t=()=>{this.write([{type:"close"}])};"open"===this.readyState?t():this.once("open",t)}write(t){this.writable=!1,zK(t,(t=>{this.doWrite(t,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let t=this.query||{};const e=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(t[this.opts.timestampParam]=cG()),this.supportsBinary||t.sid||(t.b64=1),this.opts.port&&("https"===e&&443!==Number(this.opts.port)||"http"===e&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const r=lG(t),i=-1!==this.opts.hostname.indexOf(":");return e+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}request(t={}){return Object.assign(t,{xd:this.xd,xs:this.xs},this.opts),new yG(this.uri(),t)}doWrite(t,e){const n=this.request({method:"POST",data:t});n.on("success",e),n.on("error",((t,e)=>{this.onError("xhr post error",t,e)}))}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",((t,e)=>{this.onError("xhr poll error",t,e)})),this.pollXhr=t}}class yG extends HK{constructor(t,e){super(),YK(this,e),this.opts=e,this.method=e.method||"GET",this.uri=t,this.async=!1!==e.async,this.data=void 0!==e.data?e.data:null,this.create()}create(){const t=GK(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this.opts.xd,t.xscheme=!!this.opts.xs;const e=this.xhr=new fG(t);try{e.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){e.setDisableHeaderCheck&&e.setDisableHeaderCheck(!0);for(let t in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(t)&&e.setRequestHeader(t,this.opts.extraHeaders[t])}}catch(n){}if("POST"===this.method)try{e.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{e.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in e&&(e.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(e.timeout=this.opts.requestTimeout),e.onreadystatechange=()=>{4===e.readyState&&(200===e.status||1223===e.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"===typeof e.status?e.status:0)}),0))},e.send(this.data)}catch(n){return void this.setTimeoutFn((()=>{this.onError(n)}),0)}"undefined"!==typeof document&&(this.index=yG.requestsCount++,yG.requests[this.index]=this)}onError(t){this.emitReserved("error",t,this.xhr),this.cleanup(!0)}cleanup(t){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=pG,t)try{this.xhr.abort()}catch(e){}"undefined"!==typeof document&&delete yG.requests[this.index],this.xhr=null}}onLoad(){const t=this.xhr.responseText;null!==t&&(this.emitReserved("data",t),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(yG.requestsCount=0,yG.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",wG);else if("function"===typeof addEventListener){const t="onpagehide"in KK?"pagehide":"unload";addEventListener(t,wG,!1)}function wG(){for(let t in yG.requests)yG.requests.hasOwnProperty(t)&&yG.requests[t].abort()}const bG=(()=>{const t="function"===typeof Promise&&"function"===typeof Promise.resolve;return t?t=>Promise.resolve().then(t):(t,e)=>e(t,0)})(),vG=KK.WebSocket||KK.MozWebSocket,EG=!0,_G="arraybuffer",SG="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class AG extends tG{constructor(t){super(t),this.supportsBinary=!t.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const t=this.uri(),e=this.opts.protocols,n=SG?{}:GK(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=EG&&!SG?e?new vG(t,e):new vG(t):new vG(t,e,n)}catch(uS){return this.emitReserved("error",uS)}this.ws.binaryType=this.socket.binaryType||_G,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let e=0;e<t.length;e++){const n=t[e],r=e===t.length-1;NK(n,this.supportsBinary,(t=>{const e={};if(!EG&&(n.options&&(e.compress=n.options.compress),this.opts.perMessageDeflate)){const n="string"===typeof t?Buffer.byteLength(t):t.length;n<this.opts.perMessageDeflate.threshold&&(e.compress=!1)}try{EG?this.ws.send(t):this.ws.send(t,e)}catch(i){}r&&bG((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){let t=this.query||{};const e=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===e&&443!==Number(this.opts.port)||"ws"===e&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(t[this.opts.timestampParam]=cG()),this.supportsBinary||(t.b64=1);const r=lG(t),i=-1!==this.opts.hostname.indexOf(":");return e+"://"+(i?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}check(){return!!vG}}const CG={websocket:AG,polling:mG},IG=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,TG=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function kG(t){const e=t,n=t.indexOf("["),r=t.indexOf("]");-1!=n&&-1!=r&&(t=t.substring(0,n)+t.substring(n,r).replace(/:/g,";")+t.substring(r,t.length));let i=IG.exec(t||""),s={},o=14;while(o--)s[TG[o]]=i[o]||"";return-1!=n&&-1!=r&&(s.source=e,s.host=s.host.substring(1,s.host.length-1).replace(/;/g,":"),s.authority=s.authority.replace("[","").replace("]","").replace(/;/g,":"),s.ipv6uri=!0),s.pathNames=RG(s,s["path"]),s.queryKey=NG(s,s["query"]),s}function RG(t,e){const n=/\/{2,9}/g,r=e.replace(n,"/").split("/");return"/"!=e.slice(0,1)&&0!==e.length||r.splice(0,1),"/"==e.slice(-1)&&r.splice(r.length-1,1),r}function NG(t,e){const n={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(t,e,r){e&&(n[e]=r)})),n}class DG extends HK{constructor(t,e={}){super(),t&&"object"===typeof t&&(e=t,t=null),t?(t=kG(t),e.hostname=t.host,e.secure="https"===t.protocol||"wss"===t.protocol,e.port=t.port,t.query&&(e.query=t.query)):e.host&&(e.hostname=kG(e.host).host),YK(this,e),this.secure=null!=e.secure?e.secure:"undefined"!==typeof location&&"https:"===location.protocol,e.hostname&&!e.port&&(e.port=this.secure?"443":"80"),this.hostname=e.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=e.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=e.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},e),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"===typeof this.opts.query&&(this.opts.query=uG(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"===typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(t){const e=Object.assign({},this.opts.query);e.EIO=jK,e.transport=t,this.id&&(e.sid=this.id);const n=Object.assign({},this.opts.transportOptions[t],this.opts,{query:e,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new CG[t](n)}open(){let t;if(this.opts.rememberUpgrade&&DG.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))t="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);t=this.transports[0]}this.readyState="opening";try{t=this.createTransport(t)}catch(e){return this.transports.shift(),void this.open()}t.open(),this.setTransport(t)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(t=>this.onClose("transport close",t)))}probe(t){let e=this.createTransport(t),n=!1;DG.priorWebsocketSuccess=!1;const r=()=>{n||(e.send([{type:"ping",data:"probe"}]),e.once("packet",(t=>{if(!n)if("pong"===t.type&&"probe"===t.data){if(this.upgrading=!0,this.emitReserved("upgrading",e),!e)return;DG.priorWebsocketSuccess="websocket"===e.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(e),e.send([{type:"upgrade"}]),this.emitReserved("upgrade",e),e=null,this.upgrading=!1,this.flush())}))}else{const t=new Error("probe error");t.transport=e.name,this.emitReserved("upgradeError",t)}})))};function i(){n||(n=!0,l(),e.close(),e=null)}const s=t=>{const n=new Error("probe error: "+t);n.transport=e.name,i(),this.emitReserved("upgradeError",n)};function o(){s("transport closed")}function a(){s("socket closed")}function c(t){e&&t.name!==e.name&&i()}const l=()=>{e.removeListener("open",r),e.removeListener("error",s),e.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};e.once("open",r),e.once("error",s),e.once("close",o),this.once("close",a),this.once("upgrading",c),e.open()}onOpen(){if(this.readyState="open",DG.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let t=0;const e=this.upgrades.length;for(;t<e;t++)this.probe(this.upgrades[t])}}onPacket(t){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const e=new Error("server error");e.code=t.data,this.onError(e);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this.upgrades=this.filterUpgrades(t.upgrades),this.pingInterval=t.pingInterval,this.pingTimeout=t.pingTimeout,this.maxPayload=t.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this.getWritablePackets();this.transport.send(t),this.prevBufferLen=t.length,this.emitReserved("flush")}}getWritablePackets(){const t=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!t)return this.writeBuffer;let e=1;for(let n=0;n<this.writeBuffer.length;n++){const t=this.writeBuffer[n].data;if(t&&(e+=QK(t)),n>0&&e>this.maxPayload)return this.writeBuffer.slice(0,n);e+=2}return this.writeBuffer}write(t,e,n){return this.sendPacket("message",t,e,n),this}send(t,e,n){return this.sendPacket("message",t,e,n),this}sendPacket(t,e,n,r){if("function"===typeof e&&(r=e,e=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;n=n||{},n.compress=!1!==n.compress;const i={type:t,data:e,options:n};this.emitReserved("packetCreate",i),this.writeBuffer.push(i),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this.onClose("forced close"),this.transport.close()},e=()=>{this.off("upgrade",e),this.off("upgradeError",e),t()},n=()=>{this.once("upgrade",e),this.once("upgradeError",e)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():t()})):this.upgrading?n():t()),this}onError(t){DG.priorWebsocketSuccess=!1,this.emitReserved("error",t),this.onClose("transport error",t)}onClose(t,e){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",t,e),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(t){const e=[];let n=0;const r=t.length;for(;n<r;n++)~this.transports.indexOf(t[n])&&e.push(t[n]);return e}}DG.protocol=jK;DG.protocol;function OG(t,e="",n){let r=t;n=n||"undefined"!==typeof location&&location,null==t&&(t=n.protocol+"//"+n.host),"string"===typeof t&&("/"===t.charAt(0)&&(t="/"===t.charAt(1)?n.protocol+t:n.host+t),/^(https?|wss?):\/\//.test(t)||(t="undefined"!==typeof n?n.protocol+"//"+t:"https://"+t),r=kG(t)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":"),s=i?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+s+":"+r.port+e,r.href=r.protocol+"://"+s+(n&&n.port===r.port?"":":"+r.port),r}const PG="function"===typeof ArrayBuffer,xG=t=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,MG=Object.prototype.toString,LG="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===MG.call(Blob),BG="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===MG.call(File);function UG(t){return PG&&(t instanceof ArrayBuffer||xG(t))||LG&&t instanceof Blob||BG&&t instanceof File}function FG(t,e){if(!t||"object"!==typeof t)return!1;if(Array.isArray(t)){for(let e=0,n=t.length;e<n;e++)if(FG(t[e]))return!0;return!1}if(UG(t))return!0;if(t.toJSON&&"function"===typeof t.toJSON&&1===arguments.length)return FG(t.toJSON(),!0);for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)&&FG(t[n]))return!0;return!1}function zG(t){const e=[],n=t.data,r=t;return r.data=VG(n,e),r.attachments=e.length,{packet:r,buffers:e}}function VG(t,e){if(!t)return t;if(UG(t)){const n={_placeholder:!0,num:e.length};return e.push(t),n}if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=VG(t[r],e);return n}if("object"===typeof t&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=VG(t[r],e));return n}return t}function jG(t,e){return t.data=HG(t.data,e),t.attachments=void 0,t}function HG(t,e){if(!t)return t;if(t&&!0===t._placeholder){const n="number"===typeof t.num&&t.num>=0&&t.num<e.length;if(n)return e[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=HG(t[n],e);else if("object"===typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=HG(t[n],e));return t}const $G=5;var KG;(function(t){t[t["CONNECT"]=0]="CONNECT",t[t["DISCONNECT"]=1]="DISCONNECT",t[t["EVENT"]=2]="EVENT",t[t["ACK"]=3]="ACK",t[t["CONNECT_ERROR"]=4]="CONNECT_ERROR",t[t["BINARY_EVENT"]=5]="BINARY_EVENT",t[t["BINARY_ACK"]=6]="BINARY_ACK"})(KG||(KG={}));class GG{constructor(t){this.replacer=t}encode(t){return t.type!==KG.EVENT&&t.type!==KG.ACK||!FG(t)?[this.encodeAsString(t)]:(t.type=t.type===KG.EVENT?KG.BINARY_EVENT:KG.BINARY_ACK,this.encodeAsBinary(t))}encodeAsString(t){let e=""+t.type;return t.type!==KG.BINARY_EVENT&&t.type!==KG.BINARY_ACK||(e+=t.attachments+"-"),t.nsp&&"/"!==t.nsp&&(e+=t.nsp+","),null!=t.id&&(e+=t.id),null!=t.data&&(e+=JSON.stringify(t.data,this.replacer)),e}encodeAsBinary(t){const e=zG(t),n=this.encodeAsString(e.packet),r=e.buffers;return r.unshift(n),r}}class qG extends HK{constructor(t){super(),this.reviver=t}add(t){let e;if("string"===typeof t){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");e=this.decodeString(t),e.type===KG.BINARY_EVENT||e.type===KG.BINARY_ACK?(this.reconstructor=new WG(e),0===e.attachments&&super.emitReserved("decoded",e)):super.emitReserved("decoded",e)}else{if(!UG(t)&&!t.base64)throw new Error("Unknown type: "+t);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");e=this.reconstructor.takeBinaryData(t),e&&(this.reconstructor=null,super.emitReserved("decoded",e))}}decodeString(t){let e=0;const n={type:Number(t.charAt(0))};if(void 0===KG[n.type])throw new Error("unknown packet type "+n.type);if(n.type===KG.BINARY_EVENT||n.type===KG.BINARY_ACK){const r=e+1;while("-"!==t.charAt(++e)&&e!=t.length);const i=t.substring(r,e);if(i!=Number(i)||"-"!==t.charAt(e))throw new Error("Illegal attachments");n.attachments=Number(i)}if("/"===t.charAt(e+1)){const r=e+1;while(++e){const n=t.charAt(e);if(","===n)break;if(e===t.length)break}n.nsp=t.substring(r,e)}else n.nsp="/";const r=t.charAt(e+1);if(""!==r&&Number(r)==r){const r=e+1;while(++e){const n=t.charAt(e);if(null==n||Number(n)!=n){--e;break}if(e===t.length)break}n.id=Number(t.substring(r,e+1))}if(t.charAt(++e)){const r=this.tryParse(t.substr(e));if(!qG.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(t){try{return JSON.parse(t,this.reviver)}catch(e){return!1}}static isPayloadValid(t,e){switch(t){case KG.CONNECT:return"object"===typeof e;case KG.DISCONNECT:return void 0===e;case KG.CONNECT_ERROR:return"string"===typeof e||"object"===typeof e;case KG.EVENT:case KG.BINARY_EVENT:return Array.isArray(e)&&e.length>0;case KG.ACK:case KG.BINARY_ACK:return Array.isArray(e)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class WG{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const t=jG(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function YG(t,e,n){return t.on(e,n),function(){t.off(e,n)}}const XG=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class QG extends HK{constructor(t,e,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=e,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[YG(t,"open",this.onopen.bind(this)),YG(t,"packet",this.onpacket.bind(this)),YG(t,"error",this.onerror.bind(this)),YG(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io["_reconnecting"]||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...e){if(XG.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');e.unshift(t);const n={type:KG.EVENT,data:e,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"===typeof e[e.length-1]){const t=this.ids++,r=e.pop();this._registerAckCallback(t,r),n.id=t}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,i=this.flags.volatile&&(!r||!this.connected);return i||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(t,e){const n=this.flags.timeout;if(void 0===n)return void(this.acks[t]=e);const r=this.io.setTimeoutFn((()=>{delete this.acks[t];for(let e=0;e<this.sendBuffer.length;e++)this.sendBuffer[e].id===t&&this.sendBuffer.splice(e,1);e.call(this,new Error("operation has timed out"))}),n);this.acks[t]=(...t)=>{this.io.clearTimeoutFn(r),e.apply(this,[null,...t])}}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){"function"==typeof this.auth?this.auth((t=>{this.packet({type:KG.CONNECT,data:t})})):this.packet({type:KG.CONNECT,data:this.auth})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,e){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,e)}onpacket(t){const e=t.nsp===this.nsp;if(e)switch(t.type){case KG.CONNECT:if(t.data&&t.data.sid){const e=t.data.sid;this.onconnect(e)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case KG.EVENT:case KG.BINARY_EVENT:this.onevent(t);break;case KG.ACK:case KG.BINARY_ACK:this.onack(t);break;case KG.DISCONNECT:this.ondisconnect();break;case KG.CONNECT_ERROR:this.destroy();const e=new Error(t.data.message);e.data=t.data.data,this.emitReserved("connect_error",e);break}}onevent(t){const e=t.data||[];null!=t.id&&e.push(this.ack(t.id)),this.connected?this.emitEvent(e):this.receiveBuffer.push(Object.freeze(e))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const e=this._anyListeners.slice();for(const n of e)n.apply(this,t)}super.emit.apply(this,t)}ack(t){const e=this;let n=!1;return function(...r){n||(n=!0,e.packet({type:KG.ACK,id:t,data:r}))}}onack(t){const e=this.acks[t.id];"function"===typeof e&&(e.apply(this,t.data),delete this.acks[t.id])}onconnect(t){this.id=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((t=>this.emitEvent(t))),this.receiveBuffer=[],this.sendBuffer.forEach((t=>{this.notifyOutgoingListeners(t),this.packet(t)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((t=>t())),this.subs=void 0),this.io["_destroy"](this)}disconnect(){return this.connected&&this.packet({type:KG.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const e=this._anyListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const e=this._anyOutgoingListeners;for(let n=0;n<e.length;n++)if(t===e[n])return e.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const e=this._anyOutgoingListeners.slice();for(const n of e)n.apply(this,t.data)}}}function JG(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}JG.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),n=Math.floor(e*this.jitter*t);t=0==(1&Math.floor(10*e))?t-n:t+n}return 0|Math.min(t,this.max)},JG.prototype.reset=function(){this.attempts=0},JG.prototype.setMin=function(t){this.ms=t},JG.prototype.setMax=function(t){this.max=t},JG.prototype.setJitter=function(t){this.jitter=t};class ZG extends HK{constructor(t,e){var n;super(),this.nsps={},this.subs=[],t&&"object"===typeof t&&(e=t,t=void 0),e=e||{},e.path=e.path||"/socket.io",this.opts=e,YK(this,e),this.reconnection(!1!==e.reconnection),this.reconnectionAttempts(e.reconnectionAttempts||1/0),this.reconnectionDelay(e.reconnectionDelay||1e3),this.reconnectionDelayMax(e.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=e.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new JG({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==e.timeout?2e4:e.timeout),this._readyState="closed",this.uri=t;const r=e.parser||Z;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==e.autoConnect,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,this):this._reconnection}reconnectionAttempts(t){return void 0===t?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var e;return void 0===t?this._reconnectionDelay:(this._reconnectionDelay=t,null===(e=this.backoff)||void 0===e||e.setMin(t),this)}randomizationFactor(t){var e;return void 0===t?this._randomizationFactor:(this._randomizationFactor=t,null===(e=this.backoff)||void 0===e||e.setJitter(t),this)}reconnectionDelayMax(t){var e;return void 0===t?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,null===(e=this.backoff)||void 0===e||e.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new DG(this.uri,this.opts);const e=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=YG(e,"open",(function(){n.onopen(),t&&t()})),i=YG(e,"error",(e=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",e),t?t(e):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const t=this._timeout;0===t&&r();const n=this.setTimeoutFn((()=>{r(),e.close(),e.emit("error",new Error("timeout"))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}return this.subs.push(r),this.subs.push(i),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(YG(t,"ping",this.onping.bind(this)),YG(t,"data",this.ondata.bind(this)),YG(t,"error",this.onerror.bind(this)),YG(t,"close",this.onclose.bind(this)),YG(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(e){this.onclose("parse error",e)}}ondecoded(t){bG((()=>{this.emitReserved("packet",t)}),this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,e){let n=this.nsps[t];return n||(n=new QG(this,t,e),this.nsps[t]=n),n}_destroy(t){const e=Object.keys(this.nsps);for(const n of e){const t=this.nsps[n];if(t.active)return}this._close()}_packet(t){const e=this.encoder.encode(t);for(let n=0;n<e.length;n++)this.engine.write(e[n],t.options)}cleanup(){this.subs.forEach((t=>t())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(t,e){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,e),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const e=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),t.skipReconnect||t.open((e=>{e?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",e)):t.onreconnect()})))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const tq={};function eq(t,e){"object"===typeof t&&(e=t,t=void 0),e=e||{};const n=OG(t,e.path||"/socket.io"),r=n.source,i=n.id,s=n.path,o=tq[i]&&s in tq[i]["nsps"],a=e.forceNew||e["force new connection"]||!1===e.multiplex||o;let c;return a?c=new ZG(r,e):(tq[i]||(tq[i]=new ZG(r,e)),c=tq[i]),n.query&&!e.query&&(e.query=n.queryKey),c.socket(n.path,e)}Object.assign(eq,{Manager:ZG,Socket:QG,io:eq,connect:eq});var nq=n(5317);const rq=65536,iq=5e3;class sq{constructor(t,e){this.label=t.label,this.open=Cy(),this.channel=t,this.channel.binaryType="arraybuffer",this.log=e.log,"number"===typeof this.channel.bufferedAmountLowThreshold&&(this.channel.bufferedAmountLowThreshold=rq),t.addEventListener("message",(t=>{e.onMessage(t)})),t.addEventListener("bufferedamountlow",(()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()})),t.addEventListener("open",(()=>{this.open.resolve(),e.onOpen()})),t.addEventListener("close",(()=>{e.onClose()})),t.addEventListener("error",(n=>{if("Transport channel closed"===n.error?.message)return this.close();e.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',t.readyState,n.error?.message,n.error?.errorDetail);const r=n.error instanceof Error?n.error:new Error(`datachannel error: ${n.error?.message} ${n.error?.errorDetail}`);e.onError(Vt(r,"ERR_DATA_CHANNEL"))}));let n=!1;this.closingInterval=setInterval((()=>{"closing"===t.readyState?(n&&e.onClose(),n=!0):n=!1}),iq)}async send(t){await this.open.promise,this.channel.send(t),this.channel.bufferedAmount>rq&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=Cy())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}}var oq=n(6190);const aq={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function cq(){if("undefined"===typeof globalThis)throw Vt(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");const t={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(null==t.RTCPeerConnection)throw Vt(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return t}class lq extends gM{constructor(t){super(),this.id=t.id??sa(nq(4),"hex").slice(0,7),this.log=zt(`libp2p:webrtc-peer:${t.logPrefix}:${this.id}`),this.wrtc=t.wrtc??cq(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},aq,t.peerConnectionConfig)),this.closed=!1,this.connected=Cy(),this.source=sm(),this.sink=async t=>{if(await this.connected.promise,null==this.channel)throw Vt(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(const e of t)await this.channel.send(e);await this.close()}}handleDataChannelEvent(t){const e=t.channel;null!=e?this.channel=new sq(e,{log:this.log,onMessage:t=>{this.source.push(new Uint8Array(t.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new yM("ready"))},onClose:()=>{this.close().catch((t=>{this.log("error closing connection after channel close",t)}))},onError:t=>{this.close(t).catch((t=>{this.log("error closing connection after channel error",t)}))}}):this.close(Vt(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch((t=>{this.log("Error closing after event channel was found to be null",t)}))}async close(t){if(this.closed=!0,null==t&&null!=this.channel)while(this.channel.bufferedAmount>0)await oq(100);this.channel?.close(),this.peerConnection.close(),this.source.end(t),this.dispatchEvent(new yM("close"))}}class uq extends gM{constructor(t){super(),this.log=t.log,this.peerConnection=t.peerConnection,this.wrtc=t.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",(()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch((t=>{this.log.error("could not renegotiate %o",t)}))}))}async handleSignal(t){return this.log('incoming signal "%s"',t.type),"offer"===t.type?await this.handleOffer(t):"answer"===t.type?await this.handleAnswer(t):"candidate"===t.type?await this.handleCandidate(t):"renegotiate"===t.type?await this.handleRenegotiate(t):"goodbye"===t.type?await this.handleGoodye(t):void this.log(`Unknown signal type ${t.type}`)}async handleOffer(t){}async handleAnswer(t){}async handleRenegotiate(t){}async handleGoodye(t){this.peerConnection.close()}async handleCandidate(t){const e=new this.wrtc.RTCIceCandidate(t.candidate);try{await this.peerConnection.addIceCandidate(e)}catch(uS){if(null!=e.address&&!e.address.endsWith(".local"))throw Vt(uS,"ERR_ADD_ICE_CANDIDATE");this.log("ignoring unsupported ICE candidate.")}}}const hq=zt("libp2p:webrtc-peer:receiver");class dq extends lq{constructor(t={}){super({...t,logPrefix:"receiver"}),this.handshake=new fq({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:t.answerOptions}),this.handshake.addEventListener("signal",(t=>this.dispatchEvent(new yM("signal",{detail:t.detail})))),this.peerConnection.addEventListener("datachannel",(t=>{this.handleDataChannelEvent(t)}))}handleSignal(t){this.handshake.handleSignal(t).catch((e=>{this.log("error handling signal %o %o",t,e)}))}}class fq extends uq{constructor(t){super(t),this.options=t,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){hq.trace("renegotiate"),this.dispatchEvent(new yM("signal",{detail:{type:"renegotiate"}}))}async handleOffer(t){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(t));for(const n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];const e=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(e),hq.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new yM("signal",{detail:this.peerConnection.localDescription??e}))}async handleCandidate(t){null!=this.peerConnection.remoteDescription&&null!=this.peerConnection.remoteDescription.type?await super.handleCandidate(t):this.iceCandidates.push(t)}}class pq extends Error{constructor(t){super(t),this.name="TimeoutError"}}class gq extends Error{constructor(t){super(),this.name="AbortError",this.message=t}}const mq=t=>void 0===globalThis.DOMException?new gq(t):new DOMException(t),yq=t=>{const e=void 0===t.reason?mq("This operation was aborted."):t.reason;return e instanceof Error?e:mq(e)};function wq(t,e,n,r){let i;const s=new Promise(((s,o)=>{if("number"!==typeof e||1!==Math.sign(e))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${e}\``);if(e!==Number.POSITIVE_INFINITY){if(r={customTimers:{setTimeout:setTimeout,clearTimeout:clearTimeout},...r},r.signal){const{signal:t}=r;t.aborted&&o(yq(t)),t.addEventListener("abort",(()=>{o(yq(t))}))}i=r.customTimers.setTimeout.call(void 0,(()=>{if("function"===typeof n){try{s(n())}catch(a){o(a)}return}const r="string"===typeof n?n:`Promise timed out after ${e} milliseconds`,i=n instanceof Error?n:new pq(r);"function"===typeof t.cancel&&t.cancel(),o(i)}),e),(async()=>{try{s(await t)}catch(e){o(e)}finally{r.customTimers.clearTimeout.call(void 0,i)}})()}else s(t)}));return s.clear=()=>{clearTimeout(i),i=void 0},s}const bq=t=>{const e=t.on||t.addListener||t.addEventListener,n=t.off||t.removeListener||t.removeEventListener;if(!e||!n)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(t),removeListener:n.bind(t)}};function vq(t,e,n){let r;const i=new Promise(((i,s)=>{if(n={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...n},!(n.count>=0)||n.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(n.count))throw new TypeError("The `count` option should be at least 0 or more");const o=[e].flat(),a=[],{addListener:c,removeListener:l}=bq(t),u=(...t)=>{const e=n.multiArgs?t:t[0];n.filter&&!n.filter(e)||(a.push(e),n.count===a.length&&(r(),i(a)))},h=t=>{r(),s(t)};r=()=>{for(const t of o)l(t,u);for(const t of n.rejectionEvents)l(t,h)};for(const t of o)c(t,u);for(const t of n.rejectionEvents)c(t,h);n.resolveImmediately&&i(a)}));if(i.cancel=r,"number"===typeof n.timeout){const t=wq(i,n.timeout);return t.cancel=r,t}return i}function Eq(t,e,n){"function"===typeof n&&(n={filter:n}),n={...n,count:1,resolveImmediately:!1};const r=vq(t,e,n),i=r.then((t=>t[0]));return i.cancel=r.cancel,i}const _q=zt("libp2p:webrtc-peer:initator"),Sq=1e3;class Aq extends lq{constructor(t={}){super({...t,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(t.dataChannelLabel??sa(nq(20),"hex").slice(0,7),t.dataChannelInit)}),this.handshake=new Cq({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:t.offerOptions}),this.handshake.addEventListener("signal",(t=>{this.dispatchEvent(new yM("signal",{detail:t.detail}))}))}handleSignal(t){this.handshake.handleSignal(t).catch((e=>{this.log("error handling signal %o %o",t,e)}))}}class Cq extends uq{constructor(t){super(t),this.options=t,this.status="idle",this.peerConnection.addEventListener("icecandidate",(t=>{if(null==t.candidate)return;const e={type:"candidate",candidate:{candidate:t.candidate.candidate,sdpMLineIndex:t.candidate.sdpMLineIndex,sdpMid:t.candidate.sdpMid}};_q.trace("create candidate",e),this.dispatchEvent(new yM("signal",{detail:e})),this.dispatchEvent(new yM("ice-candidate"))}))}async handleRenegotiate(){if("negotiating"===this.status)return void this.log("already negotiating, queueing");this.status="negotiating";const t=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(t),await Eq(this,"ice-candidate"),await oq(Sq),_q.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new yM("signal",{detail:this.peerConnection.localDescription??t}))}async handleAnswer(t){_q.trace("handle answer",t),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(t)),this.status="idle"}}const Iq=zt("libp2p:webrtc-star:socket");function Tq(t,e){const{sink:n,source:r}=t,i={remoteAddr:e.remoteAddr,async sink(t){null!=e.signal&&(t=Jz(t,e.signal));try{await n(t)}catch(uS){"aborted"!==uS.type&&Iq.error(uS)}},source:null!=e.signal?Jz(r,e.signal):r,timeline:{open:Date.now()},async close(){if(t.closed)return;const e=Date.now(),n=setTimeout((()=>{if(null!=i.remoteAddr){const{host:t,port:n}=i.remoteAddr.toOptions();Iq("timeout closing socket to %s:%s after %dms, destroying it manually",t,n,Date.now()-e)}t.closed||t.close().catch((t=>{Iq.error("could not close socket",t)}))}),EK);try{await t.close()}finally{clearTimeout(n)}}};return t.addEventListener("close",(()=>{null==i.timeline.close&&(i.timeline.close=Date.now())}),{once:!0}),i}function kq(t){const e=t.toString().split("/"),n=t.protos()[1].name,r=t.protos()[2].name,i=t.stringTuples()[1][1];if("tcp"!==n||"ws"!==r&&"wss"!==r)throw new Error(`invalid multiaddr: ${t.toString()}`);if(!lc(t))return`http://${e[2]}:${e[4]}`;if("ws"===r)return`http://${e[2]}${null==i||"80"===i?"":`:${i}`}`;if("wss"===r)return`https://${e[2]}${null==i||"443"===i?"":`:${i}`}`;throw new Error("invalid multiaddr: "+t.toString())}function Rq(t){const e="/libp2p-webrtc-star";if(t.startsWith(e)){t=t.substring(e.length,t.length);let n=dc(t);const r=n.stringTuples().filter((t=>421===t[0]))[0];if(null==r[1])throw new Error("invalid multiaddr: "+t);n=n.decapsulate("p2p"),n=n.encapsulate("/p2p-webrtc-star"),n=n.encapsulate(`/p2p/${r[1]}`),t=n.toString()}return t}const Nq=zt("libp2p:webrtc-star:listener"),Dq={transports:["websocket"],path:"/socket.io-next/"};class Oq extends gM{constructor(t,e,n,r,i){super(),this.signallingAddr=e,this.socket=eq(t,Dq),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=r,this.channelOptions=i,this.handleWsHandshake=this.handleWsHandshake.bind(this);let s=!1;this.socket.on("connect_error",(t=>{s&&"TransportError"===t.type||this.dispatchEvent(new yM("error",{detail:t}))})),this.socket.on("error",(t=>{this.dispatchEvent(new yM("error",{detail:t}))})),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",(t=>{this.dispatchEvent(new yM("peer",{detail:t}))})),this.socket.on("connect",(()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),s&&this.dispatchEvent(new yM("reconnect"))})),this.socket.once("connect",(()=>{s=!0,this.dispatchEvent(new yM("listening"))})),this.socket.on("disconnect",(()=>{this.dispatchEvent(new yM("disconnect"))}))}_createChannel(t,e,n){const r={...this.channelOptions},i=new dq(r),s=t=>{const e=t.detail;Nq.error("incoming connection errored",e)};return i.addEventListener("error",s),i.addEventListener("close",(()=>{i.removeEventListener("error",s)}),{once:!0}),i.addEventListener("signal",(r=>{const i=r.detail;this.socket.emit("ss-handshake",{intentId:t,srcMultiaddr:e,dstMultiaddr:n,answer:!0,signal:i})})),i.addEventListener("ready",(()=>{const e=Tq(i,{remoteAddr:this.signallingAddr});Nq("new inbound connection %s",e.remoteAddr);try{this.upgrader.upgradeInbound(e).then((n=>{Nq("inbound connection %s upgraded",e.remoteAddr),this.connections.push(e);const r=()=>{this.connections=this.connections.filter((t=>t!==e)),this.channels.delete(t),this.pendingSignals.delete(t)};i.addEventListener("close",r,{once:!0}),this.dispatchEvent(new yM("connection",{detail:n})),this.handler(n)})).catch((t=>{Nq.error("inbound connection failed to upgrade",t),e.close().catch((t=>{Nq.error("inbound connection failed to close after failing to upgrade",t)}))}))}catch(uS){Nq.error("inbound connection failed to upgrade",uS),e.close().catch((t=>{Nq.error("inbound connection failed to close after failing to upgrade",t)}))}}),{once:!0}),i}handleWsHandshake(t){if(Nq('incoming handshake. signal type "%s" is answer %s',t.signal.type,t.answer),!0===t.answer||null!=t.err||null==t.intentId)return;const e=t.intentId;let n=this.pendingSignals.get(e);null==n&&(n=[],this.pendingSignals.set(e,n)),n.push(t);let r=this.channels.get(e);if(null==r){if("offer"!==t.signal.type)return void Nq("handshake is not an offer and channel does not exist, buffering until we receive an offer");Nq("creating new channel to handle offer handshake"),r=this._createChannel(t.intentId,t.srcMultiaddr,t.dstMultiaddr),this.channels.set(e,r)}else Nq("channel already exists, using it to handle handshake");while(n.length>0){const t=n.shift();null!=t?.signal&&r.handleSignal(t.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map((async t=>await t.close())),...Array.from(this.channels.values()).map((async t=>await t.close()))]),this.dispatchEvent(new yM("close"))}}class Pq extends gM{constructor(t,e,n,r,i){super(),this.upgrader=t,this.handler=e,this.peerId=n,this.transport=r,this.options=i}async listen(t){if(null!=this.listeningAddr)throw Vt(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const e=Cy();let n;this.listeningAddr=t,n=t.protoCodes().includes(bK)?t:t.encapsulate(`/p2p/${this.peerId.toString()}`);const r=this.signallingUrl=kq(t);Nq("connecting to signalling server on: %s",this.signallingUrl);const i=new Oq(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);return i.addEventListener("error",(t=>{const n=t.detail;Nq("error connecting to signalling server %o",n),i.close().catch((t=>{Nq.error("error closing server after error",t)})),e.reject(n)})),i.addEventListener("listening",(()=>{Nq("connected to signalling server"),this.dispatchEvent(new yM("listening")),e.resolve()})),i.addEventListener("peer",(t=>{this.transport.peerDiscovered(t.detail)})),i.addEventListener("connection",(e=>{const n=e.detail;if(null==n.remoteAddr)try{n.remoteAddr=t.decapsulateCode(bK).encapsulate(`/p2p/${n.remotePeer.toString()}`)}catch(uS){Nq.error("could not determine remote address",uS)}this.dispatchEvent(new yM("connection",{detail:n}))})),i.addEventListener("disconnect",(()=>{this.transport.sigServers.delete(r)})),i.addEventListener("reconnect",(()=>{this.transport.sigServers.set(r,i)})),this.transport.sigServers.set(this.signallingUrl,i),await e.promise}async close(){if(null!=this.signallingUrl){const t=this.transport.sigServers.get(this.signallingUrl);null!=t&&(await t.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new yM("close")),this.listeningAddr=void 0}getAddrs(){return null!=this.listeningAddr?[this.listeningAddr]:[]}}function xq(t,e,n,r,i){return new Pq(t,e,n,r,i)}function Mq(t,e){if(t.length!==e.length)throw new Error("Inputs should have the same length");const n=Bo(t.length);for(let r=0;r<t.length;r++)n[r]=t[r]^e[r];return Mo(n)}const Lq=Symbol.for("@libp2p/transport");var Bq;(function(t){t[t["FATAL_ALL"]=0]="FATAL_ALL",t[t["NO_FATAL"]=1]="NO_FATAL"})(Bq||(Bq={}));const Uq=Symbol.for("@libp2p/peer-discovery");const Fq="RTCPeerConnection"in globalThis,zq=zt("libp2p:webrtc-star"),Vq=()=>{};class jq extends gM{constructor(){super(...arguments),this.started=!1}get[Uq](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(t){return!!this.isStarted()&&super.dispatchEvent(t)}}class Hq{constructor(t){null!=t?.wrtc&&(this.wrtc=t.wrtc),this.sigServers=new Map,this._discovery=new jq,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[Lq](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(t,e){const n=await this._connect(t,e),r=Tq(n,{remoteAddr:t,signal:e.signal});zq("new outbound connection %s",r.remoteAddr);const i=await e.upgrader.upgradeOutbound(r);return zq("outbound connection %s upgraded",r.remoteAddr),i}async _connect(t,e){if(!0===e.signal?.aborted)throw new Xz;const n={...e.channelOptions??{}};null!=this.wrtc&&(n.wrtc=this.wrtc);const r=t.toOptions(),i=sa(nq(36),"hex");return await new Promise(((s,o)=>{const a=this.sigServers.get(kq(t));if(null==a?.socket)return o(Vt(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let c=!1;zq("dialing %s:%s",r.host,r.port);const l=new Aq(n),u=t=>{const e=t.detail;if(!c){const t=`connection error ${r.host}:${r.port}: ${e.message}`;zq.error(t),f(e)}},h=()=>{c=!0,zq("connection opened %s:%s",r.host,r.port),f()},d=()=>{zq.error("connection aborted %s:%s",r.host,r.port),l.close().finally((()=>{f(new Xz)}))},f=t=>{l.removeEventListener("ready",h),e.signal?.removeEventListener("abort",d),null==t?s(l):o(t)};l.addEventListener("ready",h,{once:!0}),l.addEventListener("close",(()=>{l.removeEventListener("error",u)})),e.signal?.addEventListener("abort",d),l.addEventListener("signal",(e=>{const n=e.detail;a.socket.emit("ss-handshake",{intentId:i,srcMultiaddr:a.signallingAddr.toString(),dstMultiaddr:t.toString(),signal:n})})),a.socket.on("ws-handshake",(t=>{t.intentId===i&&null!=t.err&&l.close().finally((()=>{o(Vt(new Error(t.err),"ERR_SIGNALLING_FAILED"))})),t.intentId!==i||null==t.answer||l.closed||l.handleSignal(t.signal)}))}))}createListener(t){if(!Fq&&null==this.wrtc)throw Vt(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(t.channelOptions=t.channelOptions??{},null!=this.wrtc&&(t.channelOptions.wrtc=this.wrtc),null==this.peerId)throw Vt(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return xq(t.upgrader,t.handler??Vq,this.peerId,this,t)}filter(t){return t=Array.isArray(t)?t:[t],t.filter((t=>!t.protoCodes().includes(vK)&&Ic.matches(t)))}peerDiscovered(t){zq("peer discovered: %s",t),t=Rq(t);const e=dc(t),n=e.getPeerId();if(null==n)return;const r=zu(n);this._discovery.dispatchEvent(new yM("peer",{detail:{id:r,multiaddrs:[e],protocols:[]}}))}}function $q(t={}){const e=new Hq(t);return{transport:t=>(e.peerId=t.peerId,e),discovery:e.discovery}}function Kq(){const t=$q(),e={transports:[t.transport],peerDiscovery:[t.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1},metrics:{enabled:!0}};return e}var Gq,qq;async function*Wq(t,e){yield*ky(t,(async t=>(await e.addressBook.add(t.id,t.multiaddrs),t)))}function Yq(t){const e=new Set;return tm(t,(t=>!e.has(t.id.toString())&&(e.add(t.id.toString()),!0)))}async function*Xq(t,e=1){let n=0;for await(const r of t)n++,yield r;if(n<e)throw Vt(new Error("not found"),"NOT_FOUND")}(function(t){t["NOT_STARTED_YET"]="The libp2p node is not started yet",t["DHT_DISABLED"]="DHT is not available",t["PUBSUB_DISABLED"]="PubSub is not available",t["CONN_ENCRYPTION_REQUIRED"]="At least one connection encryption module is required",t["ERR_TRANSPORTS_REQUIRED"]="At least one transport module is required",t["ERR_PROTECTOR_REQUIRED"]="Private network is enforced, but no protector was provided",t["NOT_FOUND"]="Not found"})(Gq||(Gq={})),function(t){t["DHT_DISABLED"]="ERR_DHT_DISABLED",t["ERR_PUBSUB_DISABLED"]="ERR_PUBSUB_DISABLED",t["PUBSUB_NOT_STARTED"]="ERR_PUBSUB_NOT_STARTED",t["DHT_NOT_STARTED"]="ERR_DHT_NOT_STARTED",t["CONN_ENCRYPTION_REQUIRED"]="ERR_CONN_ENCRYPTION_REQUIRED",t["ERR_TRANSPORTS_REQUIRED"]="ERR_TRANSPORTS_REQUIRED",t["ERR_PROTECTOR_REQUIRED"]="ERR_PROTECTOR_REQUIRED",t["ERR_PEER_DIAL_INTERCEPTED"]="ERR_PEER_DIAL_INTERCEPTED",t["ERR_CONNECTION_INTERCEPTED"]="ERR_CONNECTION_INTERCEPTED",t["ERR_INVALID_PROTOCOLS_FOR_STREAM"]="ERR_INVALID_PROTOCOLS_FOR_STREAM",t["ERR_CONNECTION_ENDED"]="ERR_CONNECTION_ENDED",t["ERR_CONNECTION_FAILED"]="ERR_CONNECTION_FAILED",t["ERR_NODE_NOT_STARTED"]="ERR_NODE_NOT_STARTED",t["ERR_ALREADY_ABORTED"]="ERR_ALREADY_ABORTED",t["ERR_TOO_MANY_ADDRESSES"]="ERR_TOO_MANY_ADDRESSES",t["ERR_NO_VALID_ADDRESSES"]="ERR_NO_VALID_ADDRESSES",t["ERR_RELAYED_DIAL"]="ERR_RELAYED_DIAL",t["ERR_DIALED_SELF"]="ERR_DIALED_SELF",t["ERR_DISCOVERED_SELF"]="ERR_DISCOVERED_SELF",t["ERR_DUPLICATE_TRANSPORT"]="ERR_DUPLICATE_TRANSPORT",t["ERR_ENCRYPTION_FAILED"]="ERR_ENCRYPTION_FAILED",t["ERR_HOP_REQUEST_FAILED"]="ERR_HOP_REQUEST_FAILED",t["ERR_INVALID_KEY"]="ERR_INVALID_KEY",t["ERR_INVALID_MESSAGE"]="ERR_INVALID_MESSAGE",t["ERR_INVALID_PARAMETERS"]="ERR_INVALID_PARAMETERS",t["ERR_INVALID_PEER"]="ERR_INVALID_PEER",t["ERR_MUXER_UNAVAILABLE"]="ERR_MUXER_UNAVAILABLE",t["ERR_NOT_FOUND"]="ERR_NOT_FOUND",t["ERR_TIMEOUT"]="ERR_TIMEOUT",t["ERR_TRANSPORT_UNAVAILABLE"]="ERR_TRANSPORT_UNAVAILABLE",t["ERR_TRANSPORT_DIAL_FAILED"]="ERR_TRANSPORT_DIAL_FAILED",t["ERR_UNSUPPORTED_PROTOCOL"]="ERR_UNSUPPORTED_PROTOCOL",t["ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED"]="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",t["ERR_INVALID_MULTIADDR"]="ERR_INVALID_MULTIADDR",t["ERR_SIGNATURE_NOT_VALID"]="ERR_SIGNATURE_NOT_VALID",t["ERR_FIND_SELF"]="ERR_FIND_SELF",t["ERR_NO_ROUTERS_AVAILABLE"]="ERR_NO_ROUTERS_AVAILABLE",t["ERR_CONNECTION_NOT_MULTIPLEXED"]="ERR_CONNECTION_NOT_MULTIPLEXED",t["ERR_NO_DIAL_TOKENS"]="ERR_NO_DIAL_TOKENS",t["ERR_KEYCHAIN_REQUIRED"]="ERR_KEYCHAIN_REQUIRED",t["ERR_INVALID_CMS"]="ERR_INVALID_CMS",t["ERR_MISSING_KEYS"]="ERR_MISSING_KEYS",t["ERR_NO_KEY"]="ERR_NO_KEY",t["ERR_INVALID_KEY_NAME"]="ERR_INVALID_KEY_NAME",t["ERR_INVALID_KEY_TYPE"]="ERR_INVALID_KEY_TYPE",t["ERR_KEY_ALREADY_EXISTS"]="ERR_KEY_ALREADY_EXISTS",t["ERR_INVALID_KEY_SIZE"]="ERR_INVALID_KEY_SIZE",t["ERR_KEY_NOT_FOUND"]="ERR_KEY_NOT_FOUND",t["ERR_OLD_KEY_NAME_INVALID"]="ERR_OLD_KEY_NAME_INVALID",t["ERR_NEW_KEY_NAME_INVALID"]="ERR_NEW_KEY_NAME_INVALID",t["ERR_PASSWORD_REQUIRED"]="ERR_PASSWORD_REQUIRED",t["ERR_PEM_REQUIRED"]="ERR_PEM_REQUIRED",t["ERR_CANNOT_READ_KEY"]="ERR_CANNOT_READ_KEY",t["ERR_MISSING_PRIVATE_KEY"]="ERR_MISSING_PRIVATE_KEY",t["ERR_MISSING_PUBLIC_KEY"]="ERR_MISSING_PUBLIC_KEY",t["ERR_INVALID_OLD_PASS_TYPE"]="ERR_INVALID_OLD_PASS_TYPE",t["ERR_INVALID_NEW_PASS_TYPE"]="ERR_INVALID_NEW_PASS_TYPE",t["ERR_INVALID_PASS_LENGTH"]="ERR_INVALID_PASS_LENGTH",t["ERR_NOT_IMPLEMENTED"]="ERR_NOT_IMPLEMENTED",t["ERR_WRONG_PING_ACK"]="ERR_WRONG_PING_ACK",t["ERR_INVALID_RECORD"]="ERR_INVALID_RECORD",t["ERR_ALREADY_SUCCEEDED"]="ERR_ALREADY_SUCCEEDED",t["ERR_NO_HANDLER_FOR_PROTOCOL"]="ERR_NO_HANDLER_FOR_PROTOCOL",t["ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"]="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",t["ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS"]="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",t["ERR_CONNECTION_DENIED"]="ERR_CONNECTION_DENIED"}(qq||(qq={}));var Qq=n(7550),Jq=n(1528);const Zq=zt("libp2p:peer-routing");class tW{constructor(t,e){this.components=t,this.routers=e.routers,this.refreshManagerInit=e.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||0===this.routers.length||null!=this.timeoutId||!1===this.refreshManagerInit.enabled||(this.timeoutId=(0,Qq.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){if(null==this.abortController)try{this.abortController=new $o.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(0,Jq.setMaxListeners)?.(1/0,this.abortController.signal)}catch{}await Zg(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(uS){Zq.error(uS)}finally{this.abortController?.clear(),this.abortController=void 0}}async stop(){(0,Qq.clearDelayedInterval)(this.timeoutId),this.abortController?.abort(),this.started=!1}async findPeer(t,e){if(0===this.routers.length)throw Vt(new Error("No peer routers available"),qq.ERR_NO_ROUTERS_AVAILABLE);if(t.toString()===this.components.peerId.toString())throw Vt(new Error("Should not try to find self"),qq.ERR_FIND_SELF);const n=await vm(gm(...this.routers.map((n=>async function*(){try{yield await n.findPeer(t,e)}catch(uS){Zq.error(uS)}}()))),(t=>tm(t,Boolean)),(t=>Wq(t,this.components.peerStore)),(async t=>await rk(t)));if(null!=n)return n;throw Vt(new Error(Gq.NOT_FOUND),qq.ERR_NOT_FOUND)}async*getClosestPeers(t,e){if(0===this.routers.length)throw Vt(new Error("No peer routers available"),qq.ERR_NO_ROUTERS_AVAILABLE);yield*vm(gm(...this.routers.map((n=>n.getClosestPeers(t,e)))),(t=>Wq(t,this.components.peerStore)),(t=>Yq(t)),(t=>Xq(t)))}}class eW{constructor(t,e){this.routers=e.routers??[],this.started=!1,this.components=t}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(t,e={}){if(0===this.routers.length)throw Vt(new Error("No content this.routers available"),qq.ERR_NO_ROUTERS_AVAILABLE);yield*vm(gm(...this.routers.map((n=>n.findProviders(t,e)))),(t=>Wq(t,this.components.peerStore)),(t=>Yq(t)),(t=>Xq(t)))}async provide(t,e={}){if(0===this.routers.length)throw Vt(new Error("No content routers available"),qq.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map((async n=>await n.provide(t,e))))}async put(t,e,n){if(!this.isStarted())throw Vt(new Error(Gq.NOT_STARTED_YET),qq.DHT_NOT_STARTED);const r=this.components.dht;null!=r&&await Zg(r.put(t,e,n))}async get(t,e){if(!this.isStarted())throw Vt(new Error(Gq.NOT_STARTED_YET),qq.DHT_NOT_STARTED);const n=this.components.dht;if(null!=n)for await(const r of n.get(t,e))if("VALUE"===r.name)return r.value;throw Vt(new Error(Gq.NOT_FOUND),qq.ERR_NOT_FOUND)}async*getMany(t,e,n){if(!this.isStarted())throw Vt(new Error(Gq.NOT_STARTED_YET),qq.DHT_NOT_STARTED);if(null==e||0===e)return;let r=0;const i=this.components.dht;if(null!=i)for await(const s of i.get(t,n))if("VALUE"===s.name&&(yield{from:s.from,val:s.value},r++,r===e))break;if(0===r)throw Vt(new Error(Gq.NOT_FOUND),qq.ERR_NOT_FOUND)}}function nW(t){const e=t.getPeerId();if(null==e)throw Vt(new Error(`${t.toString()} does not have a valid peer type`),qq.ERR_INVALID_MULTIADDR);try{return zu(e)}catch(uS){throw Vt(new Error(`${t.toString()} is not a valid peer type`),qq.ERR_INVALID_MULTIADDR)}}function rW(t){if(Ru(t))return{id:t,multiaddrs:[],protocols:[]};let e;return"string"===typeof t&&(t=dc(t)),uc(t)&&(e=t,t=nW(t)),{id:t,multiaddrs:null!=e?[e]:[],protocols:[]}}const iW=t=>t;class sW extends gM{constructor(t,e){super();const{listen:n=[],announce:r=[]}=e;this.components=t,this.listen=new Set(n.map((t=>t.toString()))),this.announce=new Set(r.map((t=>t.toString()))),this.observed=new Set,this.announceFilter=e.announceFilter??iW}getListenAddrs(){return Array.from(this.listen).map((t=>dc(t)))}getAnnounceAddrs(){return Array.from(this.announce).map((t=>dc(t)))}getObservedAddrs(){return Array.from(this.observed).map((t=>dc(t)))}confirmObservedAddr(t){}removeObservedAddr(t){}addObservedAddr(t){let e=dc(t);const n=e.getPeerId();if(null!=n){const t=zu(n);t.equals(this.components.peerId)&&(e=e.decapsulate(dc(`/p2p/${this.components.peerId.toString()}`)))}const r=e.toString();this.observed.has(r)||(this.observed.add(r),this.dispatchEvent(new yM("change:addresses")))}getAddresses(){let t=this.getAnnounceAddrs().map((t=>t.toString()));0===t.length&&(t=this.components.transportManager.getAddrs().map((t=>t.toString()))),t=t.concat(this.getObservedAddrs().map((t=>t.toString())));const e=new Set(t);return this.announceFilter(Array.from(e).map((t=>dc(t)))).map((t=>t.getPeerId()===this.components.peerId.toString()?t:t.encapsulate(`/p2p/${this.components.peerId.toString()}`)))}}const oW=zt("libp2p:connection-manager:latency-monitor:visibility-change-emitter");class aW extends gM{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",null!=globalThis.document&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let t="hidden",e="visibilitychange";"undefined"!==typeof globalThis.document.hidden?(t="hidden",e="visibilitychange"):"undefined"!==typeof globalThis.document.mozHidden?(t="mozHidden",e="mozvisibilitychange"):"undefined"!==typeof globalThis.document.msHidden?(t="msHidden",e="msvisibilitychange"):"undefined"!==typeof globalThis.document.webkitHidden&&(t="webkitHidden",e="webkitvisibilitychange"),this.hidden=t,this.visibilityChange=e}_addVisibilityChangeListener(){"undefined"===typeof globalThis.document.addEventListener||"undefined"===typeof document[this.hidden]?oW("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(void 0!==this.hidden&&void 0!==document[this.hidden])return null==document[this.hidden]}_handleVisibilityChange(){const t=!1===globalThis.document[this.hidden];oW(t?"Page Visible":"Page Hidden"),this.dispatchEvent(new yM("visibilityChange",{detail:t}))}}const cW=zt("libp2p:connection-manager:latency-monitor");class lW extends gM{constructor(t={}){super();const{latencyCheckIntervalMs:e,dataEmitIntervalMs:n,asyncTestFn:r,latencyRandomPercentage:i}=t;this.latencyCheckIntervalMs=e??500,this.latencyRandomPercentage=i??10,this.latencyCheckMultiply=this.latencyRandomPercentage/100*2*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=null===n||0===n?void 0:n??5e3,cW("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),null!=this.dataEmitIntervalMs?cW("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):cW("Not emitting summaries"),this.asyncTestFn=r,null!=globalThis.process?.hrtime?(cW("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=t=>{const e=this.now(t);return 1e3*e[0]+e[1]/1e6}):"undefined"!==typeof window&&null!=window.performance?.now?(cW("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=t=>Math.round(this.now()-t)):(cW("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=t=>this.now()-t),this.latencyData=this.initLatencyData()}start(){uW()&&(this.visibilityChangeEmitter=new aW,this.visibilityChangeEmitter.addEventListener("visibilityChange",(t=>{const{detail:e}=t;e?this._startTimers():(this._emitSummary(),this._stopTimers())}))),!0===this.visibilityChangeEmitter?.isVisible()&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){null==this.checkLatencyID&&(this.checkLatency(),null!=this.dataEmitIntervalMs&&(this.emitIntervalID=setInterval((()=>this._emitSummary()),this.dataEmitIntervalMs),"function"===typeof this.emitIntervalID.unref&&this.emitIntervalID.unref()))}_stopTimers(){null!=this.checkLatencyID&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),null!=this.emitIntervalID&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){const t=this.getSummary();t.events>0&&this.dispatchEvent(new yM("data",{detail:t}))}getSummary(){const t={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),cW.trace("Summary: %O",t),t}checkLatency(){const t=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,e={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+t),startTime:this.now()},n=()=>{if(null==this.checkLatencyID)return;const t=this.getDeltaMS(e.startTime)-e.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,t),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,t),this.latencyData.totalMs+=t,cW.trace("MS: %s Data: %O",t,this.latencyData)};cW.trace("localData: %O",e),this.checkLatencyID=setTimeout((()=>{null!=this.asyncTestFn?(e.deltaOffset=0,e.startTime=this.now(),this.asyncTestFn(n)):(e.deltaOffset-=1,n())}),e.deltaOffset),"function"===typeof this.checkLatencyID.unref&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function uW(){return"undefined"!==typeof globalThis.window}var hW=n(5748);const dW="OPEN",fW="CLOSING",pW="CLOSED";function gW(t,e){const n={[Symbol.iterator]:()=>n,next:()=>{const n=t.next(),r=n.value;if(!0===n.done||null==r){const t={done:!0,value:void 0};return t}return{done:!1,value:e(r)}}};return n}class mW{constructor(t){if(this.map=new Map,null!=t)for(const[e,n]of t.entries())this.map.set(e.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(t){this.map.delete(t.toString())}entries(){return gW(this.map.entries(),(t=>[zu(t[0]),t[1]]))}forEach(t){this.map.forEach(((e,n)=>{t(e,zu(n),this)}))}get(t){return this.map.get(t.toString())}has(t){return this.map.has(t.toString())}set(t,e){this.map.set(t.toString(),e)}keys(){return gW(this.map.keys(),(t=>zu(t)))}values(){return this.map.values()}get size(){return this.map.size}}class yW{constructor(t){if(this.set=new Set,null!=t)for(const e of t)this.set.add(e.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(t){this.set.add(t.toString())}clear(){this.set.clear()}delete(t){this.set.delete(t.toString())}entries(){return gW(this.set.entries(),(t=>{const e=zu(t[0]);return[e,e]}))}forEach(t){this.set.forEach((e=>{const n=zu(e);t(n,n,this)}))}has(t){return this.set.has(t.toString())}values(){return gW(this.set.values(),(t=>zu(t)))}intersection(t){const e=new yW;for(const n of t)this.has(n)&&e.add(n);return e}difference(t){const e=new yW;for(const n of this)t.has(n)||e.add(n);return e}union(t){const e=new yW;for(const n of t)e.add(n);for(const n of this)e.add(n);return e}}class wW{constructor(t){if(this.list=[],null!=t)for(const e of t)this.list.push(e.toString())}[Symbol.iterator](){return mapIterable(this.list.entries(),(t=>peerIdFromString(t[1])))}concat(t){const e=new wW(this);for(const n of t)e.push(n);return e}entries(){return mapIterable(this.list.entries(),(t=>[t[0],peerIdFromString(t[1])]))}every(t){return this.list.every(((e,n)=>t(peerIdFromString(e),n,this)))}filter(t){const e=new wW;return this.list.forEach(((n,r)=>{const i=peerIdFromString(n);t(i,r,this)&&e.push(i)})),e}find(t){const e=this.list.find(((e,n)=>t(peerIdFromString(e),n,this)));if(null!=e)return peerIdFromString(e)}findIndex(t){return this.list.findIndex(((e,n)=>t(peerIdFromString(e),n,this)))}forEach(t){this.list.forEach(((e,n)=>{t(peerIdFromString(e),n,this)}))}includes(t){return this.list.includes(t.toString())}indexOf(t){return this.list.indexOf(t.toString())}pop(){const t=this.list.pop();if(null!=t)return peerIdFromString(t)}push(...t){for(const e of t)this.list.push(e.toString())}shift(){const t=this.list.shift();if(null!=t)return peerIdFromString(t)}unshift(...t){let e=this.list.length;for(let n=t.length-1;n>-1;n--)this.list.unshift(t[n].toString());return e}get length(){return this.list.length}}const bW="keep-alive";var vW=n(8278);const EW=zt("libp2p:connection-manager"),_W={maxConnections:1/0,minConnections:0,maxData:1/0,maxSentData:1/0,maxReceivedData:1/0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},SW="libp2p",AW="connection-manager",CW=6e4;class IW extends gM{constructor(t,e){if(super(),this.opts=nt.call({ignoreUndefined:!0},_W,e),this.opts.maxConnections<this.opts.minConnections)throw Vt(new Error("Connection Manager maxConnections must be greater than minConnections"),qq.ERR_INVALID_PARAMETERS);EW("options: %o",this.opts),this.components=t,this.connections=new Map,this.started=!1,this._checkMetrics=this._checkMetrics.bind(this),this.latencyMonitor=new lW({latencyCheckIntervalMs:e.pollInterval,dataEmitIntervalMs:e.pollInterval});try{(0,Jq.setMaxListeners)?.(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=e.startupReconnectTimeout??CW,this.dialTimeout=e.dialTimeout??3e4,this.allow=(e.allow??[]).map((t=>dc(t))),this.deny=(e.deny??[]).map((t=>dc(t))),this.inboundConnectionRateLimiter=new vW.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){null!=this.components.metrics&&(this.timer=this.timer??hW(this._checkMetrics,this.opts.pollInterval)),this.components.metrics?.updateComponentMetric({system:SW,component:AW,metric:"connections",label:"direction",value:()=>{const t={inbound:0,outbound:0};for(const e of this.connections.values())for(const n of e)"inbound"===n.stat.direction?t.inbound++:t.outbound++;return t}}),this.components.metrics?.updateComponentMetric({system:SW,component:AW,metric:"protocol-streams-total",label:"protocol",value:()=>{const t={};for(const e of this.connections.values())for(const n of e)for(const e of n.streams){const n=`${e.stat.direction} ${e.stat.protocol??"unnegotiated"}`;t[n]=(t[n]??0)+1}return t}}),this.components.metrics?.updateComponentMetric({system:SW,component:AW,metric:"protocol-streams-per-connection-90th-percentile",label:"protocol",value:()=>{const t={};for(const n of this.connections.values())for(const e of n){const n={};for(const t of e.streams){const e=`${t.stat.direction} ${t.stat.protocol??"unnegotiated"}`;n[e]=(n[e]??0)+1}for(const[e,r]of Object.entries(n))t[e]=t[e]??[],t[e].push(r)}const e={};for(let[n,r]of Object.entries(t)){r=r.sort(((t,e)=>t-e));const t=Math.floor(.9*r.length);e[n]=r[t]}return e}}),this.latencyMonitor.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this.latencyMonitor.addEventListener("data",this._onLatencyMeasure),this.started=!0,EW("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then((async()=>{const t=[];for(const e of await this.components.peerStore.all()){const n=await this.components.peerStore.getTags(e.id),r=n.filter((t=>t.name===bW)).length>0;r&&t.push(e.id)}this.connectOnStartupController?.clear(),this.connectOnStartupController=new $o.TimeoutController(this.startupReconnectTimeout);try{(0,Jq.setMaxListeners)?.(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(t.map((async t=>{await this.openConnection(t,{signal:this.connectOnStartupController?.signal}).catch((t=>{EW.error(t)}))})))})).catch((t=>{EW.error(t)})).finally((()=>{this.connectOnStartupController?.clear()}))}async beforeStop(){this.connectOnStartupController?.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){this.timer?.clear(),this.latencyMonitor.removeEventListener("data",this._onLatencyMeasure),this.latencyMonitor.stop(),this.started=!1,await this._close(),EW("stopped")}async _close(){const t=[];for(const e of this.connections.values())for(const n of e)t.push((async()=>{try{await n.close()}catch(uS){EW.error(uS)}})());EW("closing %d connections",t.length),await Promise.all(t),this.connections.clear()}async _checkMetrics(){const t=this.components.metrics;if(null!=t)try{const e=t.getGlobal().getMovingAverages(),n=e.dataReceived[this.opts.movingAverageInterval].movingAverage;await this._checkMaxLimit("maxReceivedData",n);const r=e.dataSent[this.opts.movingAverageInterval].movingAverage;await this._checkMaxLimit("maxSentData",r);const i=n+r;await this._checkMaxLimit("maxData",i),EW.trace("metrics update",i)}finally{this.timer=hW(this._checkMetrics,this.opts.pollInterval)}}onConnect(t){this._onConnect(t).catch((t=>{EW.error(t)}))}async _onConnect(t){const{detail:e}=t;if(!this.started)return void await e.close();const n=e.remotePeer,r=n.toString(),i=this.connections.get(r);null!=i?i.push(e):this.connections.set(r,[e]),null!=n.publicKey&&await this.components.peerStore.keyBook.set(n,n.publicKey);const s=this.getConnections().length,o=s-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",s,o),this.dispatchEvent(new yM("peer:connect",{detail:e}))}onDisconnect(t){const{detail:e}=t;if(!this.started)return;const n=e.remotePeer.toString();let r=this.connections.get(n);null!=r&&r.length>1?(r=r.filter((t=>t.id!==e.id)),this.connections.set(n,r)):null!=r&&(this.connections.delete(n),this.dispatchEvent(new yM("peer:disconnect",{detail:e})),this.components.metrics?.onPeerDisconnected(e.remotePeer))}getConnections(t){if(null!=t)return this.connections.get(t.toString())??[];let e=[];for(const n of this.connections.values())e=e.concat(n);return e}async openConnection(t,e={}){EW("dial to %p",t);const n=this.getConnections(t);if(n.length>0)return EW("had an existing connection to %p",t),n[0];let r;if(null==e?.signal){r=new $o.TimeoutController(this.dialTimeout),e.signal=r.signal;try{(0,Jq.setMaxListeners)?.(1/0,r.signal)}catch{}}try{const n=await this.components.dialer.dial(t,e);let r=this.connections.get(t.toString());null==r&&(r=[],this.connections.set(t.toString(),r));let i=!1;for(const t of r)t.id===n.id&&(i=!0);return i||r.push(n),n}finally{null!=r&&r.clear()}}async closeConnections(t){const e=this.connections.get(t.toString())??[];await Promise.all(e.map((async t=>await t.close())))}getAll(t){if(!Ru(t))throw Vt(new Error("peerId must be an instance of peer-id"),qq.ERR_INVALID_PARAMETERS);const e=t.toString(),n=this.connections.get(e);return null!=n?n.filter((t=>t.stat.status===dW)):[]}_onLatencyMeasure(t){const{detail:e}=t;this._checkMaxLimit("maxEventLoopDelay",e.avgMs,1).catch((t=>{EW.error(t)}))}async _checkMaxLimit(t,e,n=1){const r=this.opts[t];EW.trace("checking limit of %s. current value: %d of %d",t,e,r),e>r&&(EW("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,t,e,r,n),await this._pruneConnections(n))}async _pruneConnections(t){const e=this.getConnections(),n=new mW;for(const s of e){const t=s.remotePeer;if(n.has(t))continue;const e=await this.components.peerStore.getTags(t);n.set(t,e.reduce(((t,e)=>t+e.value),0))}const r=e.sort(((t,e)=>{const r=n.get(t.remotePeer)??0,i=n.get(e.remotePeer)??0;return r>i?1:r<i?-1:0})),i=[];for(const s of r)if(EW("too many connections open - closing a connection to %p",s.remotePeer),i.push(s),i.length===t)break;await Promise.all(i.map((async t=>{try{await t.close()}catch(uS){EW.error(uS)}this.onDisconnect(new yM("connectionEnd",{detail:t}))})))}async acceptIncomingConnection(t){const e=this.deny.some((e=>t.remoteAddr.toString().startsWith(e.toString())));if(e)return EW("connection from %s refused - connection remote address was in deny list",t.remoteAddr),!1;const n=this.allow.some((e=>t.remoteAddr.toString().startsWith(e.toString())));if(n)return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return EW("connection from %s refused - incomingPendingConnections exceeded by peer %s",t.remoteAddr),!1;if(t.remoteAddr.isThinWaistAddress()){const e=t.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(e,1)}catch{return EW("connection from %s refused - inboundConnectionThreshold exceeded by host %s",e,t.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(EW("connection from %s refused - maxConnections exceeded",t.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}}const TW=zt("libp2p:connection-manager:auto-dialler"),kW={enabled:!0,minConnections:0,autoDialInterval:1e4};class RW{constructor(t,e){this.components=t,this.options=nt.call({ignoreUndefined:!0},kW,e),this.running=!1,this._autoDial=this._autoDial.bind(this),TW("options: %j",this.options)}isStarted(){return this.running}async start(){this.options.enabled?(this.running=!0,this._autoDial().catch((t=>{TW.error("could start autodial",t)})),TW("started")):TW("not enabled")}async stop(){this.options.enabled?(this.running=!1,null!=this.autoDialTimeout&&this.autoDialTimeout.clear(),TW("stopped")):TW("not enabled")}async _autoDial(){null!=this.autoDialTimeout&&this.autoDialTimeout.clear();const t=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=t)return void(this.autoDialTimeout=hW(this._autoDial,this.options.autoDialInterval));const e=await this.components.peerStore.all(),n=await vm(e.sort((()=>Math.random()>.5?1:-1)),(t=>tm(t,(t=>!t.id.equals(this.components.peerId)))),(t=>_x(t,((t,e)=>e.protocols.length>t.protocols.length||null!=e.id.publicKey&&null==t.id.publicKey?1:-1))),(async t=>await Qg(t)));for(let r=0;this.running&&r<n.length&&this.components.connectionManager.getConnections().length<t;r++){if(!this.running)return;const t=n[r];if(0===this.components.connectionManager.getConnections(t.id).length){TW("connecting to a peerStore stored peer %p",t.id);try{await this.components.connectionManager.openConnection(t.id)}catch(uS){TW.error("could not connect to peerStore stored peer",uS)}}}this.running&&(this.autoDialTimeout=hW(this._autoDial,this.options.autoDialInterval))}}var NW;(function(t){let e,n,r,i,s,o;(function(t){t["SUCCESS"]="SUCCESS",t["HOP_SRC_ADDR_TOO_LONG"]="HOP_SRC_ADDR_TOO_LONG",t["HOP_DST_ADDR_TOO_LONG"]="HOP_DST_ADDR_TOO_LONG",t["HOP_SRC_MULTIADDR_INVALID"]="HOP_SRC_MULTIADDR_INVALID",t["HOP_DST_MULTIADDR_INVALID"]="HOP_DST_MULTIADDR_INVALID",t["HOP_NO_CONN_TO_DST"]="HOP_NO_CONN_TO_DST",t["HOP_CANT_DIAL_DST"]="HOP_CANT_DIAL_DST",t["HOP_CANT_OPEN_DST_STREAM"]="HOP_CANT_OPEN_DST_STREAM",t["HOP_CANT_SPEAK_RELAY"]="HOP_CANT_SPEAK_RELAY",t["HOP_CANT_RELAY_TO_SELF"]="HOP_CANT_RELAY_TO_SELF",t["STOP_SRC_ADDR_TOO_LONG"]="STOP_SRC_ADDR_TOO_LONG",t["STOP_DST_ADDR_TOO_LONG"]="STOP_DST_ADDR_TOO_LONG",t["STOP_SRC_MULTIADDR_INVALID"]="STOP_SRC_MULTIADDR_INVALID",t["STOP_DST_MULTIADDR_INVALID"]="STOP_DST_MULTIADDR_INVALID",t["STOP_RELAY_REFUSED"]="STOP_RELAY_REFUSED",t["MALFORMED_MESSAGE"]="MALFORMED_MESSAGE"})(e=t.Status||(t.Status={})),function(t){t[t["SUCCESS"]=100]="SUCCESS",t[t["HOP_SRC_ADDR_TOO_LONG"]=220]="HOP_SRC_ADDR_TOO_LONG",t[t["HOP_DST_ADDR_TOO_LONG"]=221]="HOP_DST_ADDR_TOO_LONG",t[t["HOP_SRC_MULTIADDR_INVALID"]=250]="HOP_SRC_MULTIADDR_INVALID",t[t["HOP_DST_MULTIADDR_INVALID"]=251]="HOP_DST_MULTIADDR_INVALID",t[t["HOP_NO_CONN_TO_DST"]=260]="HOP_NO_CONN_TO_DST",t[t["HOP_CANT_DIAL_DST"]=261]="HOP_CANT_DIAL_DST",t[t["HOP_CANT_OPEN_DST_STREAM"]=262]="HOP_CANT_OPEN_DST_STREAM",t[t["HOP_CANT_SPEAK_RELAY"]=270]="HOP_CANT_SPEAK_RELAY",t[t["HOP_CANT_RELAY_TO_SELF"]=280]="HOP_CANT_RELAY_TO_SELF",t[t["STOP_SRC_ADDR_TOO_LONG"]=320]="STOP_SRC_ADDR_TOO_LONG",t[t["STOP_DST_ADDR_TOO_LONG"]=321]="STOP_DST_ADDR_TOO_LONG",t[t["STOP_SRC_MULTIADDR_INVALID"]=350]="STOP_SRC_MULTIADDR_INVALID",t[t["STOP_DST_MULTIADDR_INVALID"]=351]="STOP_DST_MULTIADDR_INVALID",t[t["STOP_RELAY_REFUSED"]=390]="STOP_RELAY_REFUSED",t[t["MALFORMED_MESSAGE"]=400]="MALFORMED_MESSAGE"}(n||(n={})),function(t){t.codec=()=>Th(n)}(e=t.Status||(t.Status={})),function(t){t["HOP"]="HOP",t["STOP"]="STOP",t["STATUS"]="STATUS",t["CAN_HOP"]="CAN_HOP"}(r=t.Type||(t.Type={})),function(t){t[t["HOP"]=1]="HOP",t[t["STOP"]=2]="STOP",t[t["STATUS"]=3]="STATUS",t[t["CAN_HOP"]=4]="CAN_HOP"}(i||(i={})),function(t){t.codec=()=>Th(i)}(r=t.Type||(t.Type={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{if(!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.id&&t.id.byteLength>0)&&(e.uint32(10),e.bytes(t.id)),null!=t.addrs)for(const r of t.addrs)e.uint32(18),e.bytes(r);!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={id:new Uint8Array(0),addrs:[]},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.id=t.bytes();break;case 2:n.addrs.push(t.bytes());break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(s=t.Peer||(t.Peer={})),t.codec=()=>(null==o&&(o=kh(((e,n,r={})=>{!1!==r.lengthDelimited&&n.fork(),null!=e.type&&(n.uint32(8),t.Type.codec().encode(e.type,n)),null!=e.srcPeer&&(n.uint32(18),t.Peer.codec().encode(e.srcPeer,n,{writeDefaults:!1})),null!=e.dstPeer&&(n.uint32(26),t.Peer.codec().encode(e.dstPeer,n,{writeDefaults:!1})),null!=e.code&&(n.uint32(32),t.Status.codec().encode(e.code,n)),!1!==r.lengthDelimited&&n.ldelim()}),((e,n)=>{const r={},i=null==n?e.len:e.pos+n;while(e.pos<i){const n=e.uint32();switch(n>>>3){case 1:r.type=t.Type.codec().decode(e);break;case 2:r.srcPeer=t.Peer.codec().decode(e,e.uint32());break;case 3:r.dstPeer=t.Peer.codec().decode(e,e.uint32());break;case 4:r.code=t.Status.codec().decode(e);break;default:e.skipType(7&n);break}}return r}))),o),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(NW||(NW={}));const DW=zt("libp2p:stream:converter");function OW(t,e={}){const{stream:n,remoteAddr:r}=t,{sink:i,source:s}=n,o=async function*(){for await(const t of s)yield*t}(),a={async sink(t){null!=e.signal&&(t=Jz(t,e.signal));try{await i(t),await c()}catch(uS){"aborted"!==uS.type&&DW(uS)}},source:null!=e.signal?Jz(o,e.signal):o,remoteAddr:r,timeline:{open:Date.now(),close:void 0},async close(){await i(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){return null==a.timeline.close&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}const PW="/libp2p/circuit/relay/0.1.0";function xW(t){const e=new Map;async function n(n){const r=n.toString().split("/p2p-circuit").find((t=>""!==t)),s=dc(r),o=s.getPeerId();if(null==o)throw new Error("Could not determine relay peer from multiaddr");const a=zu(o);await t.peerStore.addressBook.add(a,[s]);const c=await t.connectionManager.openConnection(a),l=c.remoteAddr.encapsulate("/p2p-circuit");e.set(c.remotePeer.toString(),l),i.dispatchEvent(new yM("listening"))}function r(){const t=[];for(const n of e.values())t.push(n);return t}const i=Object.assign(new gM,{close:async()=>await Promise.resolve(),listen:n,getAddrs:r});return t.connectionManager.addEventListener("peer:disconnect",(t=>{const{detail:n}=t,r=e.delete(n.remotePeer.toString());r&&i.dispatchEvent(new yM("close"))})),i}function MW(t,e){t.write({type:NW.Type.STATUS,code:e})}function LW(t,e){try{null!=t.dstPeer?.addrs&&t.dstPeer.addrs.forEach((t=>dc(t)))}catch(uS){throw MW(e,t.type===NW.Type.HOP?NW.Status.HOP_DST_MULTIADDR_INVALID:NW.Status.STOP_DST_MULTIADDR_INVALID),uS}try{null!=t.srcPeer?.addrs&&t.srcPeer.addrs.forEach((t=>dc(t)))}catch(uS){throw MW(e,t.type===NW.Type.HOP?NW.Status.HOP_SRC_MULTIADDR_INVALID:NW.Status.STOP_SRC_MULTIADDR_INVALID),uS}}function BW(t){const e=sm(),n=dv(t.source),r=Cy();let i;const s=t.sink(async function*(){yield*e;const t=await r.promise;yield*t}());s.catch((t=>{i=t}));const o={sink:async t=>null!=i?await Promise.reject(i):(r.resolve(t),await s),source:n};return{reader:n,writer:e,stream:o,rest:()=>e.end(),write:e.push,read:async()=>{const t=await n.next();if(null!=t.value)return t.value}}}const UW=zt("libp2p:circuit:stream-handler");class FW{constructor(t){const{stream:e,maxLength:n=4096}=t;this.stream=e,this.shake=BW(this.stream),this.decoder=cV.fromReader(this.shake.reader,{maxDataLength:n})}async read(){const t=await this.decoder.next();if(null!=t.value){const e=NW.decode(t.value);return UW("read message type",e.type),e}UW("read received no value, closing stream"),this.close()}write(t){UW("write message type %s",t.type),this.shake.write(rV.single(NW.encode(t)))}rest(){return this.shake.rest(),this.shake.stream}end(t){this.write(t),this.close()}close(){UW("closing the stream"),this.rest().sink([]).catch((t=>{UW.error(t)}))}}const zW=zt("libp2p:circuit:stop");function VW(t){const{connection:e,request:n,streamHandler:r}=t;try{LW(n,r)}catch(uS){return void zW.error("invalid stop request via peer %p %o",e.remotePeer,uS)}return zW("stop request is valid"),r.write({type:NW.Type.STATUS,code:NW.Status.SUCCESS}),r.rest()}async function jW(t){const{connection:e,request:n,signal:r}=t,i=await e.newStream(PW,{signal:r});zW("starting stop request to %p",e.remotePeer);const s=new FW({stream:i});s.write(n);const o=await s.read();if(null!=o){if(o.code===NW.Status.SUCCESS)return zW("stop request to %p was successful",e.remotePeer),s.rest();zW("stop request failed with code %d",o.code),s.close()}else s.close()}const HW=zt("libp2p:circuit:hop");async function $W(t){const{connection:e,request:n,streamHandler:r,circuit:i,connectionManager:s}=t;if(!i.hopEnabled())return HW("HOP request received but we are not acting as a relay"),r.end({type:NW.Type.STATUS,code:NW.Status.HOP_CANT_SPEAK_RELAY});try{LW(n,r)}catch(uS){return void HW.error("invalid hop request via peer %p %o",e.remotePeer,uS)}if(null==n.dstPeer)return void HW("HOP request received but we do not receive a dstPeer");const o=Vu(n.dstPeer.id),a=s.getConnections(o);if(0===a.length&&!i.hopActive())return HW("HOP request received but we are not connected to the destination peer"),r.end({type:NW.Type.STATUS,code:NW.Status.HOP_NO_CONN_TO_DST});if(0===a.length)return HW("did not have connection to remote peer"),r.end({type:NW.Type.STATUS,code:NW.Status.HOP_NO_CONN_TO_DST});const c={type:NW.Type.STOP,dstPeer:n.dstPeer,srcPeer:n.srcPeer};let l;try{HW("performing STOP request");const t=await jW({connection:a[0],request:c});if(null==t)throw new Error("Could not stop");l=t}catch(uS){return void HW.error(uS)}HW("hop request from %p is valid",e.remotePeer),r.write({type:NW.Type.STATUS,code:NW.Status.SUCCESS});const u=r.rest();return HW("creating related connections"),await vm(u,l,u)}async function KW(t){const{connection:e,request:n,signal:r}=t,i=await e.newStream(PW,{signal:r}),s=new FW({stream:i});s.write(n);const o=await s.read();if(null==o)throw Vt(new Error("HOP request had no response"),qq.ERR_HOP_REQUEST_FAILED);if(o.code===NW.Status.SUCCESS)return HW("hop request was successful"),s.rest();throw HW("hop request failed with code %d, closing stream",o.code),s.close(),Vt(new Error(`HOP request failed with code "${o.code??"unknown"}"`),qq.ERR_HOP_REQUEST_FAILED)}async function GW(t){const{connection:e,signal:n}=t,r=await e.newStream(PW,{signal:n}),i=new FW({stream:r});i.write({type:NW.Type.CAN_HOP});const s=await i.read();return await i.close(),null!=s&&s.code===NW.Status.SUCCESS}function qW(t){const{connection:e,streamHandler:n,circuit:r}=t,i=r.hopEnabled();HW("can hop (%s) request from %p",i,e.remotePeer),n.end({type:NW.Type.STATUS,code:i?NW.Status.SUCCESS:NW.Status.HOP_CANT_SPEAK_RELAY})}const WW=zt("libp2p:circuit");class YW{constructor(t,e){this._init=e,this.components=t,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(PW,(t=>{this._onProtocol(t).catch((t=>{WW.error(t)}))})).catch((t=>{WW.error(t)})))}async stop(){await this.components.registrar.unhandle(PW)}hopEnabled(){return!0}hopActive(){return!0}get[Lq](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(t){const{connection:e,stream:n}=t,r=new $o.TimeoutController(this._init.hop.timeout);try{(0,Jq.setMaxListeners)?.(1/0,r.signal)}catch{}try{const t=tV(n,r.signal),i=new FW({stream:{...n,...t}}),s=await i.read();if(null==s)return WW("request was invalid, could not read from stream"),i.write({type:NW.Type.STATUS,code:NW.Status.MALFORMED_MESSAGE}),void i.close();let o;switch(s.type){case NW.Type.CAN_HOP:WW("received CAN_HOP request from %p",e.remotePeer),await qW({circuit:this,connection:e,streamHandler:i});break;case NW.Type.HOP:WW("received HOP request from %p",e.remotePeer),await $W({connection:e,request:s,streamHandler:i,circuit:this,connectionManager:this.components.connectionManager});break;case NW.Type.STOP:WW("received STOP request from %p",e.remotePeer),o=await VW({connection:e,request:s,streamHandler:i});break;default:return WW("Request of type %s not supported",s.type),i.write({type:NW.Type.STATUS,code:NW.Status.MALFORMED_MESSAGE}),void i.close()}if(null!=o){const t=e.remoteAddr.encapsulate("/p2p-circuit").encapsulate(dc(s.dstPeer?.addrs[0])),n=dc(s.srcPeer?.addrs[0]),r=OW({stream:o,remoteAddr:t,localAddr:n}),i=s.type===NW.Type.HOP?"relay":"inbound";WW("new %s connection %s",i,r.remoteAddr);const a=await this.components.upgrader.upgradeInbound(r);WW("%s connection %s upgraded",i,r.remoteAddr),null!=this.handler&&this.handler(a)}}finally{r.clear()}}async dial(t,e={}){const n=t.toString().split("/p2p-circuit"),r=dc(n[0]),i=dc(n[n.length-1]),s=r.getPeerId(),o=i.getPeerId();if(null==s||null==o){const t="Circuit relay dial failed as addresses did not have peer id";throw WW.error(t),Vt(new Error(t),qq.ERR_RELAYED_DIAL)}const a=zu(s),c=zu(o);let l=!1;const u=this.components.connectionManager.getConnections(a);let h=u[0];null==h&&(await this.components.peerStore.addressBook.add(a,[r]),h=await this.components.connectionManager.openConnection(a,e),l=!0);try{const n=await KW({...e,connection:h,request:{type:NW.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map((t=>t.bytes))},dstPeer:{id:c.toBytes(),addrs:[dc(i).bytes]}}}),s=r.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),o=OW({stream:n,remoteAddr:t,localAddr:s});return WW("new outbound connection %s",o.remoteAddr),await this.components.upgrader.upgradeOutbound(o)}catch(uS){throw WW.error("Circuit relay dial failed",uS),l&&await h.close(),uS}}createListener(t){return this.handler=t.handler,xW({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(t){return t=Array.isArray(t)?t:[t],t.filter((t=>Oc.matches(t)))}}async function XW(t){const e=(new TextEncoder).encode(t),n=await ho.digest(e);return Me.createV0(n)}const QW=6e4,JW=15*QW,ZW=30*QW,tY=290,eY="hop_relay",nY="true",rY="/libp2p/relay";var iY=n(2346);const sY="[a-fA-F\\d:]",oY=t=>t&&t.includeBoundaries?`(?:(?<=\\s|^)(?=${sY})|(?<=${sY})(?=\\s|$))`:"",aY="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",cY="[a-fA-F\\d]{1,4}",lY=`\n(?:\n(?:${cY}:){7}(?:${cY}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${cY}:){6}(?:${aY}|:${cY}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${cY}:){5}(?::${aY}|(?::${cY}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${cY}:){4}(?:(?::${cY}){0,1}:${aY}|(?::${cY}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${cY}:){3}(?:(?::${cY}){0,2}:${aY}|(?::${cY}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${cY}:){2}(?:(?::${cY}){0,3}:${aY}|(?::${cY}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${cY}:){1}(?:(?::${cY}){0,4}:${aY}|(?::${cY}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${cY}){0,5}:${aY}|(?::${cY}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),uY=new RegExp(`(?:^${aY}$)|(?:^${lY}$)`),hY=new RegExp(`^${aY}$`),dY=new RegExp(`^${lY}$`),fY=t=>t&&t.exact?uY:new RegExp(`(?:${oY(t)}${aY}${oY(t)})|(?:${oY(t)}${lY}${oY(t)})`,"g");fY.v4=t=>t&&t.exact?hY:new RegExp(`${oY(t)}${aY}${oY(t)}`,"g"),fY.v6=t=>t&&t.exact?dY:new RegExp(`${oY(t)}${lY}${oY(t)}`,"g");var pY=fY,gY=n(3246);const{isValid:mY,parse:yY}=gY,wY=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],bY=wY.map((t=>new iY.Netmask(t)));function vY(t){for(let e of bY)if(e.contains(t))return!0;return!1}function EY(t){return/^::$/.test(t)||/^::1$/.test(t)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(t)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(t)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(t)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(t)||/^ff([0-9a-fA-F]{2,2}):/i.test(t)}var _Y=t=>{if(mY(t)){const e=yY(t);if("ipv4"===e.kind())return vY(e.toNormalizedString());if("ipv6"===e.kind())return EY(t)}else if(ia(t)&&pY.v6().test(t))return EY(t)},SY=_Y;function AY(t){const{address:e}=t.nodeAddress();return Boolean(SY(e))}function CY(t,e){const n=AY(t.multiaddr),r=AY(e.multiaddr);return n&&!r?1:!n&&r||t.isCertified&&!e.isCertified?-1:!t.isCertified&&e.isCertified?1:0}const IY=zt("libp2p:auto-relay"),TY=()=>{};class kY{constructor(t,e){this.components=t,this.addressSorter=e.addressSorter??CY,this.maxListeners=e.maxListeners??1,this.listenRelays=new Set,this.onError=e.onError??TY,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",(t=>{this._onProtocolChange(t).catch((t=>{IY.error(t)}))})),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(t){const{peerId:e,protocols:n}=t.detail,r=e.toString(),i=n.find((t=>t===PW));if(null!=i){if(!this.listenRelays.has(r))try{const t=this.components.connectionManager.getConnections(e);if(0===t.length)return;const n=t[0];if(n.remoteAddr.protoCodes().includes(tY))return void IY(`relayed connection to ${r} will not be used to hop on`);const i=await GW({connection:n});i&&(await this.components.peerStore.metadataBook.setValue(e,eY,Ho(nY)),await this._addListenRelay(n,r))}catch(uS){this.onError(uS)}}else this.listenRelays.has(r)&&await this._removeListenRelay(r)}_onPeerDisconnected(t){const e=t.detail,n=e.remotePeer,r=n.toString();this.listenRelays.has(r)&&this._removeListenRelay(r).catch((t=>{IY.error(t)}))}async _addListenRelay(t,e){try{if(this.listenRelays.size>=this.maxListeners)return;const n=await vm(await this.components.peerStore.addressBook.get(t.remotePeer),(t=>_x(t,this.addressSorter)),(async t=>await Qg(t))),r=await Promise.all(n.map((async e=>{try{let n=e.multiaddr;return null==n.getPeerId()&&(n=n.encapsulate(`/p2p/${t.remotePeer.toString()}`)),n=n.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([n]),!0}catch(uS){IY.error("error listening on circuit address",uS),this.onError(uS)}return!1})));r.includes(!0)&&this.listenRelays.add(e)}catch(uS){this.onError(uS),this.listenRelays.delete(e)}}async _removeListenRelay(t){this.listenRelays.delete(t)&&await this._listenOnAvailableHopRelays([t])}async _listenOnAvailableHopRelays(t=[]){if(this.listenRelays.size>=this.maxListeners)return;const e=[],n=await this.components.peerStore.all();for(const{id:r,metadata:i}of n){const n=r.toString();if(this.listenRelays.has(n))continue;if(t.includes(n))continue;const s=i.get(eY);if(null==s||sa(s)!==nY)continue;const o=this.components.connectionManager.getConnections(r);if(0!==o.length){if(await this._addListenRelay(o[0],n),this.listenRelays.size>=this.maxListeners)return}else e.push(r)}for(const r of e)if(await this._tryToListenOnRelay(r),this.listenRelays.size>=this.maxListeners)return;try{const t=await XW(rY);for await(const e of this.components.contentRouting.findProviders(t)){if(0===e.multiaddrs.length)continue;const t=e.id;if(!t.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(t,e.multiaddrs),await this._tryToListenOnRelay(t),this.listenRelays.size>=this.maxListeners))return}}catch(uS){this.onError(uS)}}async _tryToListenOnRelay(t){try{const e=await this.components.connectionManager.openConnection(t);await this._addListenRelay(e,t.toString())}catch(uS){IY.error("Could not use %p as relay",t,uS),this.onError(uS,`could not connect and listen on known hop relay ${t.toString()}`)}}}const RY=zt("libp2p:relay");class NY{constructor(t,e){this.components=t,this.autoRelay=!1!==e.autoRelay?.enabled?new kY(t,{addressSorter:e.addressSorter,...e.autoRelay}):void 0,this.started=!1,this.init=e,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){!1!==this.init.hop.enabled&&!1!==this.init.advertise.enabled&&(this.timeout=(0,Qq.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){null!=this.timeout&&(0,Qq.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{const t=await XW(rY);await this.components.contentRouting.provide(t)}catch(uS){uS.code===qq.ERR_NO_ROUTERS_AVAILABLE?(RY.error("a content router, such as a DHT, must be provided in order to advertise the relay service",uS),await this.stop()):RY.error(uS)}}}var DY=n(4203);n(4669),n(4760);const OY=Rh.pki,PY=(t,e)=>{const n=OY.rsa.setPublicKey(e.n,e.e),r=OY.createCertificate();r.publicKey=n,r.serialNumber="01",r.validity.notBefore=new Date,r.validity.notAfter=new Date,r.validity.notAfter.setFullYear(r.validity.notBefore.getFullYear()+10);const i=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:t.id}];return r.setSubject(i),r.setIssuer(i),r.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),r.sign(e),r};async function xY(t,e){const n=t.map(e),r=await Promise.all(n),i=r.findIndex((t=>t));return t[i]}const MY=zt("libp2p:keychain:cms"),LY=new WeakMap;class BY{constructor(t,e){if(null==t)throw Vt(new Error("keychain is required"),qq.ERR_KEYCHAIN_REQUIRED);this.keychain=t,LY.set(this,{dek:e})}async encrypt(t,e){if(!(e instanceof Uint8Array))throw Vt(new Error("Plain data must be a Uint8Array"),qq.ERR_INVALID_PARAMETERS);const n=await this.keychain.findKeyByName(t),r=await this.keychain.getPrivateKey(t),i=LY.get(this);if(null==i)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const s=i.dek,o=Rh.pki.decryptRsaPrivateKey(r,s),a=await PY(n,o),c=Rh.pkcs7.createEnvelopedData();c.addRecipient(a),c.content=Rh.util.createBuffer(e),c.encrypt();const l=Rh.asn1.toDer(c.toAsn1()).getBytes();return Ho(l,"ascii")}async decrypt(t){if(!(t instanceof Uint8Array))throw Vt(new Error("CMS data is required"),qq.ERR_INVALID_PARAMETERS);let e;try{const n=Rh.util.createBuffer(sa(t,"ascii")),r=Rh.asn1.fromDer(n);e=Rh.pkcs7.messageFromAsn1(r)}catch(uS){throw MY.error(uS),Vt(new Error("Invalid CMS"),qq.ERR_INVALID_CMS)}const n=e.recipients.filter((t=>t.issuer.find((t=>"O"===t.shortName&&"ipfs"===t.value)))).filter((t=>t.issuer.find((t=>"CN"===t.shortName)))).map((t=>({recipient:t,keyId:t.issuer.find((t=>"CN"===t.shortName)).value}))),r=await xY(n,(async t=>{try{const e=await this.keychain.findKeyById(t.keyId);if(null!=e)return!0}catch(uS){return!1}return!1}));if(null==r){const t=n.map((t=>t.keyId));throw Vt(new Error(`Decryption needs one of the key(s): ${t.join(", ")}`),qq.ERR_MISSING_KEYS,{missingKeys:t})}const i=await this.keychain.findKeyById(r.keyId);if(null==i)throw Vt(new Error("No key available to decrypto"),qq.ERR_NO_KEY);const s=await this.keychain.getPrivateKey(i.name),o=LY.get(this);if(null==o)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const a=o.dek,c=Rh.pki.decryptRsaPrivateKey(s,a);return e.decrypt(r.recipient,c),Ho(e.content.getBytes(),"ascii")}}const UY=zt("libp2p:keychain"),FY="/pkcs8/",zY="/info/",VY=new WeakMap,jY={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},HY={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function $Y(t){return null!=t&&("string"===typeof t&&(t===DY(t.trim())&&t.length>0))}async function KY(){const t=200,e=1e3,n=Math.random()*(e-t)+t;await new Promise((t=>setTimeout(t,n)))}function GY(t){return new rl(FY+t)}function qY(t){return new rl(zY+t)}class WY{constructor(t,e){if(this.components=t,this.init=nt(HY,e),null!=this.init.pass&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(null!=this.init.dek?.keyLength&&this.init.dek.keyLength<jY.minKeyLength)throw new Error(`dek.keyLength must be least ${jY.minKeyLength} bytes`);if(null!=this.init.dek?.salt?.length&&this.init.dek.salt.length<jY.minSaltLength)throw new Error(`dek.saltLength must be least ${jY.minSaltLength} bytes`);if(null!=this.init.dek?.iterationCount&&this.init.dek.iterationCount<jY.minIterationCount)throw new Error(`dek.iterationCount must be least ${jY.minIterationCount}`);const n=null!=this.init.pass&&null!=this.init.dek?.salt?HU(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";VY.set(this,{dek:n}),this.started=!1}isStarted(){return this.started}async start(){const t=qY("self");await this.components.datastore.has(t)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){const t=VY.get(this);if(null==t)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const e=t.dek;return new BY(this,e)}static generateOptions(){const t=Object.assign({},HY),e=3*Math.ceil(jY.minSaltLength/3);return t.dek.salt=sa(Kd(e),"base64"),t}static get options(){return HY}async createKey(t,e,n=2048){if(!$Y(t)||"self"===t)throw await KY(),Vt(new Error("Invalid key name"),qq.ERR_INVALID_KEY_NAME);if("string"!==typeof e)throw await KY(),Vt(new Error("Invalid key type"),qq.ERR_INVALID_KEY_TYPE);const r=GY(t),i=await this.components.datastore.has(r);if(i)throw await KY(),Vt(new Error("Key name already exists"),qq.ERR_KEY_ALREADY_EXISTS);switch(e.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await KY(),Vt(new Error("Invalid RSA key size"),qq.ERR_INVALID_KEY_SIZE);break;default:break}let s;try{const i=await Gp(e,n),o=await i.id(),a=VY.get(this);if(null==a)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const c=a.dek,l=await i.export(c);s={name:t,id:o};const u=this.components.datastore.batch();u.put(r,Ho(l)),u.put(qY(t),Ho(JSON.stringify(s))),await u.commit()}catch(uS){throw await KY(),uS}return s}async listKeys(){const t={prefix:zY},e=[];for await(const n of this.components.datastore.query(t))e.push(JSON.parse(sa(n.value)));return e}async findKeyById(t){try{const e=await this.listKeys();return e.find((e=>e.id===t))}catch(uS){throw await KY(),uS}}async findKeyByName(t){if(!$Y(t))throw await KY(),Vt(new Error(`Invalid key name '${t}'`),qq.ERR_INVALID_KEY_NAME);const e=qY(t);try{const t=await this.components.datastore.get(e);return JSON.parse(sa(t))}catch(uS){throw await KY(),UY.error(uS),Vt(new Error(`Key '${t}' does not exist.`),qq.ERR_KEY_NOT_FOUND)}}async removeKey(t){if(!$Y(t)||"self"===t)throw await KY(),Vt(new Error(`Invalid key name '${t}'`),qq.ERR_INVALID_KEY_NAME);const e=GY(t),n=await this.findKeyByName(t),r=this.components.datastore.batch();return r.delete(e),r.delete(qY(t)),await r.commit(),n}async renameKey(t,e){if(!$Y(t)||"self"===t)throw await KY(),Vt(new Error(`Invalid old key name '${t}'`),qq.ERR_OLD_KEY_NAME_INVALID);if(!$Y(e)||"self"===e)throw await KY(),Vt(new Error(`Invalid new key name '${e}'`),qq.ERR_NEW_KEY_NAME_INVALID);const n=GY(t),r=GY(e),i=qY(t),s=qY(e),o=await this.components.datastore.has(r);if(o)throw await KY(),Vt(new Error(`Key '${e}' already exists`),qq.ERR_KEY_ALREADY_EXISTS);try{const t=await this.components.datastore.get(n),o=await this.components.datastore.get(i),a=JSON.parse(sa(o));a.name=e;const c=this.components.datastore.batch();return c.put(r,t),c.put(s,Ho(JSON.stringify(a))),c.delete(n),c.delete(i),await c.commit(),a}catch(uS){throw await KY(),uS}}async exportKey(t,e){if(!$Y(t))throw await KY(),Vt(new Error(`Invalid key name '${t}'`),qq.ERR_INVALID_KEY_NAME);if(null==e)throw await KY(),Vt(new Error("Password is required"),qq.ERR_PASSWORD_REQUIRED);const n=GY(t);try{const t=await this.components.datastore.get(n),r=sa(t),i=VY.get(this);if(null==i)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const s=i.dek,o=await Qp(r,s);return await o.export(e)}catch(uS){throw await KY(),uS}}async importKey(t,e,n){if(!$Y(t)||"self"===t)throw await KY(),Vt(new Error(`Invalid key name '${t}'`),qq.ERR_INVALID_KEY_NAME);if(null==e)throw await KY(),Vt(new Error("PEM encoded key is required"),qq.ERR_PEM_REQUIRED);const r=GY(t),i=await this.components.datastore.has(r);if(i)throw await KY(),Vt(new Error(`Key '${t}' already exists`),qq.ERR_KEY_ALREADY_EXISTS);let s,o;try{s=await Qp(e,n)}catch(uS){throw await KY(),Vt(new Error("Cannot read the key, most likely the password is wrong"),qq.ERR_CANNOT_READ_KEY)}try{o=await s.id();const t=VY.get(this);if(null==t)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const n=t.dek;e=await s.export(n)}catch(uS){throw await KY(),uS}const a={name:t,id:o},c=this.components.datastore.batch();return c.put(r,Ho(e)),c.put(qY(t),Ho(JSON.stringify(a))),await c.commit(),a}async importPeer(t,e){try{if(!$Y(t))throw Vt(new Error(`Invalid key name '${t}'`),qq.ERR_INVALID_KEY_NAME);if(null==e)throw Vt(new Error("PeerId is required"),qq.ERR_MISSING_PRIVATE_KEY);if(null==e.privateKey)throw Vt(new Error("PeerId.privKey is required"),qq.ERR_MISSING_PRIVATE_KEY);const n=await Yp(e.privateKey),r=GY(t),i=await this.components.datastore.has(r);if(i)throw await KY(),Vt(new Error(`Key '${t}' already exists`),qq.ERR_KEY_ALREADY_EXISTS);const s=VY.get(this);if(null==s)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const o=s.dek,a=await n.export(o),c={name:t,id:e.toString()},l=this.components.datastore.batch();return l.put(r,Ho(a)),l.put(qY(t),Ho(JSON.stringify(c))),await l.commit(),c}catch(uS){throw await KY(),uS}}async getPrivateKey(t){if(!$Y(t))throw await KY(),Vt(new Error(`Invalid key name '${t}'`),qq.ERR_INVALID_KEY_NAME);try{const e=GY(t),n=await this.components.datastore.get(e);return sa(n)}catch(uS){throw await KY(),UY.error(uS),Vt(new Error(`Key '${t}' does not exist.`),qq.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(t,e){if("string"!==typeof t)throw await KY(),Vt(new Error(`Invalid old pass type '${typeof t}'`),qq.ERR_INVALID_OLD_PASS_TYPE);if("string"!==typeof e)throw await KY(),Vt(new Error(`Invalid new pass type '${typeof e}'`),qq.ERR_INVALID_NEW_PASS_TYPE);if(e.length<20)throw await KY(),Vt(new Error(`Invalid pass length ${e.length}`),qq.ERR_INVALID_PASS_LENGTH);UY("recreating keychain");const n=VY.get(this);if(null==n)throw Vt(new Error("dek missing"),qq.ERR_INVALID_PARAMETERS);const r=n.dek;this.init.pass=e;const i=null!=e&&null!=this.init.dek?.salt?HU(e,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";VY.set(this,{dek:i});const s=await this.listKeys();for(const o of s){const t=await this.components.datastore.get(GY(o.name)),e=sa(t),n=await Qp(e,r),s=i.toString(),a=await n.export(s),c=this.components.datastore.batch(),l={name:o.name,id:o.id};c.put(GY(o.name),Ho(a)),c.put(qY(o.name),Ho(JSON.stringify(l))),await c.commit()}UY("keychain reconstructed")}}async function*YY(t,e){for await(const n of t)await e(n),yield n}const XY=3e4,QY=3e4,JY=100,ZY=4,tX=25,eX={computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50};class nX{constructor(t){if("number"!==typeof t)throw new Error("must provide a timespan to the moving average constructor");if(t<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");this.timespan=t,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(t,e){return 1-Math.exp(-(t-e)/this.timespan)}push(t,e){if(null!=this.previousTime){const n=this.alpha(t,this.previousTime),r=e-this.movingAverage,i=n*r;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+r*i),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*r}else this.movingAverage=e;this.previousTime=t}}function rX(t){return new nX(t)}class iX extends gM{constructor(t){super(),this.enabled=t.enabled,this.queue=[],this.stats={dataReceived:0n,dataSent:0n},this.frequencyLastTime=Date.now(),this.frequencyAccumulators={},this.movingAverages={dataReceived:[],dataSent:[]},this.computeThrottleMaxQueueSize=t.computeThrottleMaxQueueSize,this.computeThrottleTimeout=t.computeThrottleTimeout,this._update=this._update.bind(this),this.movingAverageIntervals=t.movingAverageIntervals;for(let e=0;e<t.initialCounters.length;e++){const n=t.initialCounters[e];this.stats[n]=0n,this.movingAverages[n]=[];for(let t=0;t<this.movingAverageIntervals.length;t++){const e=this.movingAverageIntervals[t],r=this.movingAverages[n][e]=rX(e);r.push(this.frequencyLastTime,0)}}}start(){this.enabled&&this.queue.length>0&&this._resetComputeTimeout()}stop(){null!=this.timeout&&(this.timeout.clear(),this.timeout=null)}getSnapshot(){return Object.assign({},this.stats)}getMovingAverages(){return Object.assign({},this.movingAverages)}push(t,e){this.queue.push([t,e,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this.timeout=hW(this._update,this._nextTimeout())}_nextTimeout(){const t=this.queue.length/this.computeThrottleMaxQueueSize,e=Math.max(this.computeThrottleTimeout*(1-t),0);return e}_update(){if(this.timeout=null,this.queue.length>0){let t=["",0,0];for(t of this.queue)this._applyOp(t);this.queue=[],t.length>2&&""!==t[0]&&this._updateFrequency(t[2]),this.dispatchEvent(new yM("update",{detail:this.stats}))}}_updateFrequency(t){const e=t-this.frequencyLastTime;this._updateFrequencyFor("dataReceived",e,t),this._updateFrequencyFor("dataSent",e,t),this.frequencyLastTime=t}_updateFrequencyFor(t,e,n){const r=this.frequencyAccumulators[t]??0;this.frequencyAccumulators[t]=0;const i=e??1,s=r/i*1e3;let o=this.movingAverages[t];null==o&&(o=this.movingAverages[t]=[]);const a=this.movingAverageIntervals;for(let c=0;c<a.length;c++){const t=a[c];let e=o[t];null==e&&(e=o[t]=rX(t)),e.push(n,s)}}_applyOp(t){const e=t[0],n=t[1];if("number"!==typeof n)throw new Error("invalid increment number");let r;r=Object.prototype.hasOwnProperty.call(this.stats,e)?this.stats[e]:this.stats[e]=0n,this.stats[e]=r+BigInt(n),null==this.frequencyAccumulators[e]&&(this.frequencyAccumulators[e]=0),this.frequencyAccumulators[e]+=n}}const sX=["dataReceived","dataSent"],oX={in:"dataReceived",out:"dataSent"};class aX{constructor(t){this.enabled=t.enabled,this.statsInit={...t,initialCounters:sX},this.globalStats=new iX(this.statsInit),this.peerStats=new Map,this.protocolStats=new Map,this.oldPeers=Rl(t.maxOldPeersRetention??eX.maxOldPeersRetention),this.running=!1,this._onMessage=this._onMessage.bind(this),this.systems=new Map}isStarted(){return this.running}async start(){this.enabled&&(this.running=!0)}async stop(){if(this.running){this.running=!1,this.globalStats.stop();for(const t of this.peerStats.values())t.stop();for(const t of this.protocolStats.values())t.stop()}}getGlobal(){return this.globalStats}getPeers(){return Array.from(this.peerStats.keys())}getComponentMetrics(){return this.systems}updateComponentMetric(t){const{system:e="libp2p",component:n,metric:r,value:i,label:s,help:o}=t;this.systems.has(e)||this.systems.set(e,new Map);const a=this.systems.get(e);if(null==a)throw new Error("Unknown metric system");a.has(n)||a.set(n,new Map);const c=a.get(n);if(null==c)throw new Error("Unknown metric component");c.set(r,{label:s,help:o,calculate:"function"!==typeof i?()=>i:i})}forPeer(t){const e=t.toString();return this.peerStats.get(e)??this.oldPeers.get(e)}getProtocols(){return Array.from(this.protocolStats.keys())}forProtocol(t){return this.protocolStats.get(t)}onPeerDisconnected(t){const e=t.toString(),n=this.peerStats.get(e);null!=n&&(n.stop(),this.peerStats.delete(e),this.oldPeers.set(e,n))}_onMessage(t){if(!this.running)return;const{remotePeer:e,protocol:n,direction:r,dataLength:i}=t,s=oX[r];let o=this.forPeer(e);if(null==o){const t=new iX(this.statsInit);this.peerStats.set(e.toString(),t),o=t}if(o.push(s,i),this.globalStats.push(s,i),null!=n){let t=this.forProtocol(n);if(null==t){const e=new iX(this.statsInit);this.protocolStats.set(n,e),t=e}t.push(s,i)}}updatePlaceholder(t,e){if(!this.running)return;const n=t.toString(),r=this.peerStats.get(n)??this.oldPeers.get(n),i=e.toString(),s=this.peerStats.get(i)??this.oldPeers.get(i);let o=r;null!=s&&(o=cX(s,o),this.oldPeers.remove(i)),this.peerStats.delete(t.toString()),this.peerStats.set(i,o),o.start()}trackStream(t){const{stream:e,remotePeer:n,protocol:r}=t;if(!this.running)return;const i=e.source;e.source=YY(i,(t=>this._onMessage({remotePeer:n,protocol:r,direction:"in",dataLength:t.byteLength})));const s=e.sink;e.sink=async t=>await vm(t,(t=>YY(t,(t=>{this._onMessage({remotePeer:n,protocol:r,direction:"out",dataLength:t.byteLength})}))),s)}}function cX(t,e){return t.stop(),e.stop(),t.queue=[...t.queue,...e.queue],t}async function lX(t){try{const e=await t;return{status:"fulfilled",value:e,isFulfilled:!0,isRejected:!1}}catch(e){return{status:"rejected",reason:e,isFulfilled:!1,isRejected:!0}}}function uX(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function hX(t,e,n){uX(t,e),e.set(t,n)}function dX(t,e,n){if(e.set)e.set.call(t,n);else{if(!e.writable)throw new TypeError("attempted to set read only private field");e.value=n}}function fX(t,e,n){if(!e.has(t))throw new TypeError("attempted to "+n+" private field on non-instance");return e.get(t)}function pX(t,e,n){var r=fX(t,e,"set");return dX(t,r,n),n}function gX(t,e){return e.get?e.get.call(t):e.value}function mX(t,e){var n=fX(t,e,"get");return gX(t,n)}let yX;class wX{constructor(t){Wo(this,"value",void 0),Wo(this,"next",void 0),this.value=t}}var bX=new WeakMap,vX=new WeakMap,EX=new WeakMap;yX=Symbol.iterator;class _X{constructor(){hX(this,bX,{writable:!0,value:void 0}),hX(this,vX,{writable:!0,value:void 0}),hX(this,EX,{writable:!0,value:void 0}),this.clear()}enqueue(t){var e;const n=new wX(t);mX(this,bX)?(mX(this,vX).next=n,pX(this,vX,n)):(pX(this,bX,n),pX(this,vX,n)),pX(this,EX,(e=mX(this,EX),e++,e))}dequeue(){var t;const e=mX(this,bX);if(e)return pX(this,bX,mX(this,bX).next),pX(this,EX,(t=mX(this,EX),t--,t)),e.value}clear(){pX(this,bX,void 0),pX(this,vX,void 0),pX(this,EX,0)}get size(){return mX(this,EX)}*[yX](){let t=mX(this,bX);while(t)yield t.value,t=t.next}}function SX(t){if(!Number.isInteger(t)&&t!==Number.POSITIVE_INFINITY||!(t>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const e=new _X;let n=0;const r=()=>{n--,e.size>0&&e.dequeue()()},i=async(t,e,i)=>{n++;const s=(async()=>t(...i))();e(s);try{await s}catch{}r()},s=(r,s,o)=>{e.enqueue(i.bind(void 0,r,s,o)),(async()=>{await Promise.resolve(),n<t&&e.size>0&&e.dequeue()()})()},o=(t,...e)=>new Promise((n=>{s(t,n,e)}));return Object.defineProperties(o,{activeCount:{get:()=>n},pendingCount:{get:()=>e.size},clearQueue:{value:()=>{e.clear()}}}),o}async function AX(t,e={}){const{concurrency:n=Number.POSITIVE_INFINITY}=e,r=SX(n);return Promise.all(t.map((t=>t&&"function"===typeof t.then?lX(t):lX("function"===typeof t?r((()=>t())):Promise.resolve(t)))))}class CX extends Map{constructor(t){super();const{system:e,component:n,metric:r,metrics:i}=t;this.system=e??"libp2p",this.component=n,this.metric=r,this.metrics=i,this.updateComponentMetric()}set(t,e){return super.set(t,e),this.updateComponentMetric(),this}delete(t){const e=super.delete(t);return this.updateComponentMetric(),e}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metrics.updateComponentMetric({system:this.system,component:this.component,metric:this.metric,value:this.size})}}function IX(t){const{system:e,component:n,metric:r,metrics:i}=t;let s;return s=null!=i?new CX({system:e,component:n,metric:r,metrics:i}):new Map,s}const TX=zt("libp2p:transports");class kX extends gM{constructor(t,e={}){super(),this.components=t,this.started=!1,this.transports=new Map,this.listeners=IX({component:"transport-manager",metric:"listeners",metrics:this.components.metrics}),this.faultTolerance=e.faultTolerance??RX.FATAL_ALL}add(t){const e=t[Symbol.toStringTag];if(null==e)throw Vt(new Error("Transport must have a valid tag"),qq.ERR_INVALID_KEY);if(this.transports.has(e))throw Vt(new Error("There is already a transport with this tag"),qq.ERR_DUPLICATE_TRANSPORT);TX("adding transport %s",e),this.transports.set(e,t),this.listeners.has(e)||this.listeners.set(e,[])}isStarted(){return this.started}async start(){const t=this.components.addressManager.getListenAddrs();await this.listen(t),this.started=!0}async stop(){const t=[];for(const[e,n]of this.listeners){TX("closing listeners for %s",e);while(n.length>0){const e=n.pop();null!=e&&t.push(e.close())}}await Promise.all(t),TX("all listeners closed");for(const e of this.listeners.keys())this.listeners.set(e,[]);this.started=!1}async dial(t,e){const n=this.transportForMultiaddr(t);if(null==n)throw Vt(new Error(`No transport available for address ${String(t)}`),qq.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(t,{...e,upgrader:this.components.upgrader})}catch(uS){throw null==uS.code&&(uS.code=qq.ERR_TRANSPORT_DIAL_FAILED),uS}}getAddrs(){let t=[];for(const e of this.listeners.values())for(const n of e)t=[...t,...n.getAddrs()];return t}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(t){for(const e of this.transports.values()){const n=e.filter([t]);if(n.length>0)return e}}async listen(t){if(null==t||0===t.length)return void TX("no addresses were provided for listening, this node is dial only");const e=[];for(const[n,r]of this.transports.entries()){const i=r.filter(t),s=[];for(const t of i){TX("creating listener for %s on %s",n,t);const e=r.createListener({upgrader:this.components.upgrader});let i=this.listeners.get(n);null==i&&(i=[],this.listeners.set(n,i)),i.push(e),e.addEventListener("listening",(()=>{this.dispatchEvent(new yM("listener:listening",{detail:e}))})),e.addEventListener("close",(()=>{this.dispatchEvent(new yM("listener:close",{detail:e}))})),s.push(e.listen(t))}if(0===s.length){e.push(n);continue}const o=await AX(s),a=o.find((t=>t.isFulfilled));if(null==a&&this.faultTolerance!==RX.NO_FATAL)throw Vt(new Error(`Transport (${n}) could not listen on any available address`),qq.ERR_NO_VALID_ADDRESSES)}if(e.length===this.transports.size){const t=`no valid addresses were provided for transports [${e.join(", ")}]`;if(this.faultTolerance===RX.FATAL_ALL)throw Vt(new Error(t),qq.ERR_NO_VALID_ADDRESSES);TX(`libp2p in dial mode only: ${t}`)}}async remove(t){TX("removing %s",t);for(const e of this.listeners.get(t)??[])await e.close();this.transports.delete(t),this.listeners.delete(t)}async removeAll(){const t=[];for(const e of this.transports.keys())t.push(this.remove(e));await Promise.all(t)}}var RX;(function(t){t[t["FATAL_ALL"]=0]="FATAL_ALL",t[t["NO_FATAL"]=1]="NO_FATAL"})(RX||(RX={}));const NX="/multistream/1.0.0",DX=1024,OX=zt("libp2p:mss"),PX=Ho("\n");function xX(t){const e=new Cw(t,PX);return rV.single(e)}function MX(t,e,n={}){const r=xX(e);!0===n.writeBytes?t.push(r.subarray()):t.push(r)}function LX(t,e,n={}){const r=new Cw;for(const i of e)r.append(xX(i));!0===n.writeBytes?t.push(r.subarray()):t.push(r)}async function BX(t,e){let n=1;const r={[Symbol.asyncIterator]:()=>r,next:async()=>await t.next(n)};let i=r;null!=e?.signal&&(i=Jz(r,e.signal));const s=t=>{n=t},o=await vm(i,cV({onLength:s,maxDataLength:DX}),(async t=>await rk(t)));if(null==o||0===o.length)throw Vt(new Error("no buffer returned"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==PX[0])throw OX.error("Invalid mss message - missing newline - %s",o.subarray()),Vt(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}async function UX(t,e){const n=await BX(t,e);return sa(n.subarray())}const FX=zt("libp2p:mss:select");async function zX(t,e,n={}){e=Array.isArray(e)?[...e]:[e];const{reader:r,writer:i,rest:s,stream:o}=BW(t),a=e.shift();if(null==a)throw new Error("At least one protocol must be specified");FX('select: write ["%s", "%s"]',NX,a);const c=Ho(NX),l=Ho(a);LX(i,[c,l],n);let u=await UX(r,n);if(FX('select: read "%s"',u),u===NX&&(u=await UX(r,n),FX('select: read "%s"',u)),u===a)return s(),{stream:o,protocol:a};for(const h of e){FX('select: write "%s"',h),MX(i,Ho(h),n);const t=await UX(r,n);if(FX('select: read "%s" for "%s"',t,h),t===h)return s(),{stream:o,protocol:h}}throw s(),Vt(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")}const VX=zt("libp2p:mss:handle");async function jX(t,e,n){e=Array.isArray(e)?e:[e];const{writer:r,reader:i,rest:s,stream:o}=BW(t);while(1){const t=await UX(i,n);if(VX('read "%s"',t),t!==NX){if(e.includes(t))return MX(r,Ho(t),n),VX('respond with "%s" for "%s"',t,t),s(),{stream:o,protocol:t};"ls"!==t?(MX(r,Ho("na"),n),VX('respond with "na" for "%s"',t)):(MX(r,new Cw(...e.map((t=>xX(Ho(t))))),n),VX('respond with "%s" for %s',e,t))}else VX('respond with "%s" for "%s"',NX,t),MX(r,Ho(NX),n)}}var HX=n(2163);const $X=Symbol.for("@libp2p/connection");const KX=zt("libp2p:connection");class GX{constructor(t){const{remoteAddr:e,remotePeer:n,newStream:r,close:i,getStreams:s,stat:o}=t;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=e,this.remotePeer=n,this.stat={...o,status:dW},this._newStream=r,this._close=i,this._getStreams=s,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[$X](){return!0}get streams(){return this._getStreams()}async newStream(t,e){if(this.stat.status===fW)throw Vt(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===pW)throw Vt(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(t)||(t=[t]);const n=await this._newStream(t,e);return n.stat.direction="outbound",n}addStream(t){t.stat.direction="inbound"}removeStream(t){}async close(){if(this.stat.status!==pW&&!this._closing){this.stat.status=fW;try{this.streams.forEach((t=>t.close()))}catch(uS){KX.error(uS)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=pW}}}function qX(t){return new GX(t)}const WX=zt("libp2p:registrar"),YX=32,XX=64;class QX{constructor(t){this.topologies=new Map,this.handlers=new Map,this.components=t,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(t){const e=this.handlers.get(t);if(null==e)throw Vt(new Error(`No handler registered for protocol ${t}`),qq.ERR_NO_HANDLER_FOR_PROTOCOL);return e}getTopologies(t){const e=this.topologies.get(t);return null==e?[]:[...e.values()]}async handle(t,e,n){if(this.handlers.has(t))throw Vt(new Error(`Handler already registered for protocol ${t}`),qq.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const r=nt.bind({ignoreUndefined:!0})({maxInboundStreams:YX,maxOutboundStreams:XX},n);this.handlers.set(t,{handler:e,options:r}),await this.components.peerStore.protoBook.add(this.components.peerId,[t])}async unhandle(t){const e=Array.isArray(t)?t:[t];e.forEach((t=>{this.handlers.delete(t)})),await this.components.peerStore.protoBook.remove(this.components.peerId,e)}async register(t,e){if(!lM(e))throw WX.error("topology must be an instance of interfaces/topology"),Vt(new Error("topology must be an instance of interfaces/topology"),qq.ERR_INVALID_PARAMETERS);const n=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let r=this.topologies.get(t);return null==r&&(r=new Map,this.topologies.set(t,r)),r.set(n,e),await e.setRegistrar(this),n}unregister(t){for(const[e,n]of this.topologies.entries())n.has(t)&&(n.delete(t),0===n.size&&this.topologies.delete(e))}_onDisconnect(t){const e=t.detail;this.components.peerStore.protoBook.get(e.remotePeer).then((t=>{for(const n of t){const t=this.topologies.get(n);if(null!=t)for(const n of t.values())n.onDisconnect(e.remotePeer)}})).catch((t=>{WX.error(t)}))}_onProtocolChange(t){const{peerId:e,protocols:n,oldProtocols:r}=t.detail,i=r.filter((t=>!n.includes(t))),s=n.filter((t=>!r.includes(t)));for(const o of i){const t=this.topologies.get(o);if(null!=t)for(const n of t.values())n.onDisconnect(e)}for(const o of s){const t=this.topologies.get(o);if(null!=t)for(const n of t.values()){const t=this.components.connectionManager.getConnections(e)[0];null!=t&&n.onConnect(e,t)}}}}const JX=zt("libp2p:upgrader");function ZX(t,e){try{const{options:n}=e.getHandler(t);return n.maxInboundStreams}catch(uS){if(uS.code!==qq.ERR_NO_HANDLER_FOR_PROTOCOL)throw uS}return YX}function tQ(t,e){try{const{options:n}=e.getHandler(t);return n.maxOutboundStreams}catch(uS){if(uS.code!==qq.ERR_NO_HANDLER_FOR_PROTOCOL)throw uS}return XX}function eQ(t,e,n){let r=0;return n.streams.forEach((n=>{n.stat.direction===e&&n.stat.protocol===t&&r++})),r}class nQ extends gM{constructor(t,e){super(),this.components=t,this.connectionEncryption=new Map,e.connectionEncryption.forEach((t=>{this.connectionEncryption.set(t.protocol,t)})),this.muxers=new Map,e.muxers.forEach((t=>{this.muxers.set(t.protocol,t)})),this.inboundUpgradeTimeout=e.inboundUpgradeTimeout}async upgradeInbound(t){const e=await this.components.connectionManager.acceptIncomingConnection(t);if(!e)throw Vt(new Error("connection denied"),qq.ERR_CONNECTION_DENIED);let n,r,i,s,o,a,c;const l=this.components.metrics,u=new $o.TimeoutController(this.inboundUpgradeTimeout);try{(0,Jq.setMaxListeners)?.(1/0,u.signal)}catch{}try{const e=tV(t,u.signal);if(t.source=e.source,t.sink=e.sink,await this.components.connectionGater.denyInboundConnection(t))throw Vt(new Error("The multiaddr connection is blocked by gater.acceptConnection"),qq.ERR_CONNECTION_INTERCEPTED);if(null!=l){({setTarget:a,proxy:c}=HX());const e=`${(1e9*Math.random()).toString(36)}${Date.now()}`;a({toString:()=>e}),l.trackStream({stream:t,remotePeer:c})}JX("starting the inbound connection upgrade");let h=t;const d=this.components.connectionProtector;null!=d&&(JX("protecting the inbound connection"),h=await d.protect(t));try{if(({conn:n,remotePeer:r,protocol:o}=await this._encryptInbound(h)),await this.components.connectionGater.denyInboundEncryptedConnection(r,{...h,...n}))throw Vt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),qq.ERR_CONNECTION_INTERCEPTED);if(this.muxers.size>0){const t=await this._multiplexInbound({...h,...n},this.muxers);s=t.muxerFactory,i=t.stream}else i=n}catch(uS){throw JX.error("Failed to upgrade inbound connection",uS),uS}if(await this.components.connectionGater.denyInboundUpgradedConnection(r,{...h,...n}))throw Vt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),qq.ERR_CONNECTION_INTERCEPTED);return null!=l&&(l.updatePlaceholder(c,r),a(r)),JX("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:o,direction:"inbound",maConn:t,upgradedConn:i,muxerFactory:s,remotePeer:r})}finally{this.components.connectionManager.afterUpgradeInbound(),u.clear()}}async upgradeOutbound(t,e){const n=t.remoteAddr.getPeerId();if(null==n)throw Vt(new Error("outbound connection must have a peer id"),qq.ERR_INVALID_MULTIADDR);const r=zu(n);if(await this.components.connectionGater.denyOutboundConnection(r,t))throw Vt(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),qq.ERR_CONNECTION_INTERCEPTED);let i,s,o,a,c,l,u;const h=this.components.metrics;if(null!=h){({setTarget:l,proxy:u}=HX());const e=`${(1e9*Math.random()).toString(36)}${Date.now()}`;l({toB58String:()=>e}),h.trackStream({stream:t,remotePeer:u})}JX("Starting the outbound connection upgrade");let d=t;if(!0!==e?.skipProtection){const e=this.components.connectionProtector;null!=e&&(d=await e.protect(t))}try{if(i=d,!0!==e?.skipEncryption){if(({conn:i,remotePeer:s,protocol:a}=await this._encryptOutbound(d,r)),await this.components.connectionGater.denyOutboundEncryptedConnection(s,{...d,...i}))throw Vt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),qq.ERR_CONNECTION_INTERCEPTED)}else a="native",s=r;if(o=i,null!=e?.muxerFactory)c=e.muxerFactory;else if(this.muxers.size>0){const t=await this._multiplexOutbound({...d,...i},this.muxers);c=t.muxerFactory,o=t.stream}}catch(uS){throw JX.error("Failed to upgrade outbound connection",uS),await t.close(uS),uS}if(await this.components.connectionGater.denyOutboundUpgradedConnection(s,{...d,...i}))throw Vt(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),qq.ERR_CONNECTION_INTERCEPTED);return null!=h&&(h.updatePlaceholder(u,s),l(s)),JX("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:t,upgradedConn:o,muxerFactory:c,remotePeer:s})}_createConnection(t){const{cryptoProtocol:e,direction:n,maConn:r,upgradedConn:i,remotePeer:s,muxerFactory:o}=t;let a,c,l;null!=o&&(a=o.createStreamMuxer({direction:n,onIncomingStream:t=>{null!=l&&Promise.resolve().then((async()=>{const e=this.components.registrar.getProtocols(),{stream:r,protocol:i}=await jX(t,e);JX("%s: incoming stream opened on %s",n,i);const o=this.components.metrics;if(null!=o&&o.trackStream({stream:r,remotePeer:s,protocol:i}),null==l)return;const a=ZX(i,this.components.registrar),c=eQ(i,"inbound",l);c!==a?(t.source=r.source,t.sink=r.sink,t.stat.protocol=i,this.components.peerStore.protoBook.add(s,[i]).catch((t=>JX.error(t))),l.addStream(t),this._onStream({connection:l,stream:t,protocol:i})):t.abort(Vt(new Error(`Too many inbound protocol streams for protocol "${i}" - limit ${a}`),qq.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS))})).catch((e=>{JX.error(e),null==t.stat.timeline.close&&t.close()}))},onStreamEnd:t=>{l?.removeStream(t.id)}}),c=async(t,e={})=>{if(null==a)throw Vt(new Error("Stream is not multiplexed"),qq.ERR_MUXER_UNAVAILABLE);JX("%s: starting new stream on %s",n,t);const r=await a.newStream(),i=this.components.metrics;let o;try{if(null==e.signal){JX("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",t),o=new $o.TimeoutController(3e4),e.signal=o.signal;try{(0,Jq.setMaxListeners)?.(1/0,o.signal)}catch{}}const{stream:n,protocol:a}=await zX(r,t,e);null!=i&&i.trackStream({stream:n,remotePeer:s,protocol:a});const c=tQ(a,this.components.registrar),u=eQ(a,"outbound",l);if(u===c){const t=Vt(new Error(`Too many outbound protocol streams for protocol "${a}" - limit ${c}`),qq.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw r.abort(t),t}return this.components.peerStore.protoBook.add(s,[a]).catch((t=>JX.error(t))),r.source=n.source,r.sink=n.sink,r.stat.protocol=a,r}catch(uS){if(JX.error("could not create new stream",uS),null==r.stat.timeline.close&&r.close(),null!=uS.code)throw uS;throw Vt(uS,qq.ERR_UNSUPPORTED_PROTOCOL)}finally{null!=o&&o.clear()}},vm(i,a,i).catch(JX.error));const u=r.timeline;r.timeline=new Proxy(u,{set:(...t)=>(null!=l&&"close"===t[1]&&null!=t[2]&&null==u.close&&(async()=>{try{"OPEN"===l.stat.status&&await l.close()}catch(uS){JX.error(uS)}finally{this.dispatchEvent(new yM("connectionEnd",{detail:l}))}})().catch((t=>{JX.error(t)})),Reflect.set(...t))}),r.timeline.upgraded=Date.now();const h=()=>{throw Vt(new Error("connection is not multiplexed"),qq.ERR_CONNECTION_NOT_MULTIPLEXED)};return l=qX({remoteAddr:r.remoteAddr,remotePeer:s,stat:{status:"OPEN",direction:n,timeline:r.timeline,multiplexer:a?.protocol,encryption:e},newStream:c??h,getStreams:()=>null!=a?a.streams:h(),close:async()=>{await r.close(),null!=a&&a.close()}}),this.dispatchEvent(new yM("connection",{detail:l})),l}_onStream(t){const{connection:e,stream:n,protocol:r}=t,{handler:i}=this.components.registrar.getHandler(r);i({connection:e,stream:n})}async _encryptInbound(t){const e=Array.from(this.connectionEncryption.keys());JX("handling inbound crypto protocol selection",e);try{const{stream:n,protocol:r}=await jX(t,e,{writeBytes:!0}),i=this.connectionEncryption.get(r);if(null==i)throw new Error(`no crypto module found for ${r}`);return JX("encrypting inbound connection..."),{...await i.secureInbound(this.components.peerId,n),protocol:r}}catch(uS){throw Vt(uS,qq.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(t,e){const n=Array.from(this.connectionEncryption.keys());JX("selecting outbound crypto protocol",n);try{const{stream:r,protocol:i}=await zX(t,n,{writeBytes:!0}),s=this.connectionEncryption.get(i);if(null==s)throw new Error(`no crypto module found for ${i}`);return JX("encrypting outbound connection to %p",e),{...await s.secureOutbound(this.components.peerId,r,e),protocol:i}}catch(uS){throw Vt(uS,qq.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(t,e){const n=Array.from(e.keys());JX("outbound selecting muxer %s",n);try{const{stream:r,protocol:i}=await zX(t,n,{writeBytes:!0});JX("%s selected as muxer protocol",i);const s=e.get(i);return{stream:r,muxerFactory:s}}catch(uS){throw JX.error("error multiplexing outbound stream",uS),Vt(uS,qq.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(t,e){const n=Array.from(e.keys());JX("inbound handling muxers %s",n);try{const{stream:r,protocol:i}=await jX(t,n,{writeBytes:!0}),s=e.get(i);return{stream:r,muxerFactory:s}}catch(uS){throw JX.error("error multiplexing inbound stream",uS),Vt(uS,qq.ERR_MUXER_UNAVAILABLE)}}}var rQ;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{if(!1!==n.lengthDelimited&&e.fork(),null!=t.protocolVersion&&(e.uint32(42),e.string(t.protocolVersion)),null!=t.agentVersion&&(e.uint32(50),e.string(t.agentVersion)),null!=t.publicKey&&(e.uint32(10),e.bytes(t.publicKey)),null!=t.listenAddrs)for(const r of t.listenAddrs)e.uint32(18),e.bytes(r);if(null!=t.observedAddr&&(e.uint32(34),e.bytes(t.observedAddr)),null!=t.protocols)for(const r of t.protocols)e.uint32(26),e.string(r);null!=t.signedPeerRecord&&(e.uint32(66),e.bytes(t.signedPeerRecord)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={listenAddrs:[],protocols:[]},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 5:n.protocolVersion=t.string();break;case 6:n.agentVersion=t.string();break;case 1:n.publicKey=t.bytes();break;case 2:n.listenAddrs.push(t.bytes());break;case 4:n.observedAddr=t.bytes();break;case 3:n.protocols.push(t.string());break;case 8:n.signedPeerRecord=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(rQ||(rQ={}));const iQ="0.0.0",sQ="libp2p",oQ=`js-libp2p/${iQ}`,aQ="0.1.0",cQ="id",lQ="id/push",uQ="1.0.0",hQ="1.0.0",dQ=zt("libp2p:identify"),fQ=8192;class pQ{constructor(t,e){this.components=t,this.started=!1,this.init=e,this.identifyProtocolStr=`/${e.protocolPrefix}/${cQ}/${uQ}`,this.identifyPushProtocolStr=`/${e.protocolPrefix}/${lQ}/${hQ}`,this.host={protocolVersion:`${e.protocolPrefix}/${aQ}`,...e.host},this.components.connectionManager.addEventListener("peer:connect",(t=>{const e=t.detail;this.identify(e).catch(dQ.error)})),this.components.peerStore.addEventListener("change:multiaddrs",(t=>{const{peerId:e}=t.detail;this.components.peerId.equals(e)&&this.pushToPeerStore().catch((t=>dQ.error(t)))})),this.components.peerStore.addEventListener("change:protocols",(t=>{const{peerId:e}=t.detail;this.components.peerId.equals(e)&&this.pushToPeerStore().catch((t=>dQ.error(t)))}))}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",Ho(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",Ho(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,(t=>{this._handleIdentify(t).catch((t=>{dQ.error(t)}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,(t=>{this._handlePush(t).catch((t=>{dQ.error(t)}))}),{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(t){const e=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),n=this.components.addressManager.getAddresses().map((t=>t.bytes)),r=await this.components.peerStore.protoBook.get(this.components.peerId),i=t.map((async t=>{let i;const s=new $o.TimeoutController(this.init.timeout);try{(0,Jq.setMaxListeners)?.(1/0,s.signal)}catch{}try{i=await t.newStream([this.identifyPushProtocolStr],{signal:s.signal});const o=tV(i,s.signal);await o.sink(vm([rQ.encode({listenAddrs:n,signedPeerRecord:e,protocols:r})],rV()))}catch(uS){dQ.error("could not push identify update to peer",uS)}finally{null!=i&&i.close(),s.clear()}}));await Promise.all(i)}async pushToPeerStore(){if(!this.isStarted())return;const t=[];for(const e of this.components.connectionManager.getConnections()){const n=e.remotePeer,r=await this.components.peerStore.get(n);r.protocols.includes(this.identifyPushProtocolStr)&&t.push(e)}await this.push(t)}async _identify(t,e={}){let n,r,i=e.signal;if(null==i){n=new $o.TimeoutController(this.init.timeout),i=n.signal;try{(0,Jq.setMaxListeners)?.(1/0,n.signal)}catch{}}try{r=await t.newStream([this.identifyProtocolStr],{signal:i});const e=tV(r,i),n=await vm([],e,cV({maxDataLength:this.init.maxIdentifyMessageSize??fQ}),(async t=>await rk(t)));if(null==n)throw Vt(new Error("No data could be retrieved"),qq.ERR_CONNECTION_ENDED);try{return rQ.decode(n)}catch(uS){throw Vt(uS,qq.ERR_INVALID_MESSAGE)}}finally{null!=n&&n.clear(),null!=r&&r.close()}}async identify(t,e={}){const n=await this._identify(t,e),{publicKey:r,listenAddrs:i,protocols:s,observedAddr:o,signedPeerRecord:a,agentVersion:c,protocolVersion:l}=n;if(null==r)throw Vt(new Error("public key was missing from identify message"),qq.ERR_MISSING_PUBLIC_KEY);const u=await Hu(r);if(!t.remotePeer.equals(u))throw Vt(new Error("identified peer does not match the expected peer"),qq.ERR_INVALID_PEER);if(this.components.peerId.equals(u))throw Vt(new Error("identified peer is our own peer id?"),qq.ERR_INVALID_PEER);const h=pQ.getCleanMultiaddr(o);if(null!=a){dQ("received signed peer record from %p",u);try{const t=await eM.openAndCertify(a,aM.DOMAIN);if(!t.peerId.equals(u))throw Vt(new Error("identified peer does not match the expected peer"),qq.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(t))return await this.components.peerStore.protoBook.set(u,s),null!=c&&await this.components.peerStore.metadataBook.setValue(u,"AgentVersion",Ho(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(u,"ProtocolVersion",Ho(l)),void dQ("identify completed for peer %p and protocols %o",u,s)}catch(uS){dQ("received invalid envelope, discard it and fallback to listenAddrs is available",uS)}}else dQ("no signed peer record received from %p",u);dQ("falling back to legacy addresses from %p",u);try{await this.components.peerStore.addressBook.set(u,i.map((t=>dc(t))))}catch(uS){dQ.error("received invalid addrs",uS)}await this.components.peerStore.protoBook.set(u,s),null!=c&&await this.components.peerStore.metadataBook.setValue(u,"AgentVersion",Ho(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(u,"ProtocolVersion",Ho(l)),dQ("identify completed for peer %p and protocols %o",u,s),dQ("received observed address of %s",h?.toString())}async _handleIdentify(t){const{connection:e,stream:n}=t,r=new $o.TimeoutController(this.init.timeout);try{(0,Jq.setMaxListeners)?.(1/0,r.signal)}catch{}try{const t=this.components.peerId.publicKey??new Uint8Array(0),i=await this.components.peerStore.get(this.components.peerId),s=this.components.addressManager.getAddresses().map((t=>t.decapsulateCode(ga("p2p").code)));let o=i.peerRecordEnvelope;if(s.length>0&&null==o){const t=new aM({peerId:this.components.peerId,multiaddrs:s}),e=await eM.seal(t,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(e),o=e.marshal().subarray()}const a=rQ.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:t,listenAddrs:s.map((t=>t.bytes)),signedPeerRecord:o,observedAddr:e.remoteAddr.bytes,protocols:i.protocols}),c=tV(n,r.signal),l=vm([a],rV());await c.sink(l)}catch(uS){dQ.error("could not respond to identify request",uS)}finally{n.close(),r.clear()}}async _handlePush(t){const{connection:e,stream:n}=t,r=new $o.TimeoutController(this.init.timeout);try{(0,Jq.setMaxListeners)?.(1/0,r.signal)}catch{}let i;try{const t=tV(n,r.signal),e=await vm([],t,cV({maxDataLength:this.init.maxIdentifyMessageSize??fQ}),(async t=>await rk(t)));null!=e&&(i=rQ.decode(e))}catch(uS){return dQ.error("received invalid message",uS)}finally{n.close(),r.clear()}if(null==i)return dQ.error("received invalid message");const s=e.remotePeer;if(this.components.peerId.equals(s))dQ("received push from ourselves?");else{if(dQ("received push from %p",s),null!=i.signedPeerRecord){dQ("received signedPeerRecord in push");try{const t=await eM.openAndCertify(i.signedPeerRecord,aM.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(t))return dQ("consumed signedPeerRecord sent in push"),void await this.components.peerStore.protoBook.set(s,i.protocols);dQ("failed to consume signedPeerRecord sent in push")}catch(uS){dQ("received invalid envelope, discard it and fallback to listenAddrs is available",uS)}}else dQ("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(s,i.listenAddrs.map((t=>dc(t))))}catch(uS){dQ.error("received invalid addrs",uS)}try{await this.components.peerStore.protoBook.set(s,i.protocols)}catch(uS){dQ.error("received invalid protocols",uS)}dQ("handled push from %p",s)}}static getCleanMultiaddr(t){if(null!=t&&t.length>0)try{return dc(t)}catch{}}}var gQ,mQ;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),!0!==n.writeDefaults&&""===t.identifier||(e.uint32(10),e.string(t.identifier)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={identifier:""},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.identifier=t.string();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(gQ||(gQ={})),function(t){let e,n,r;(function(t){t["OK"]="OK",t["NOT_FOUND"]="NOT_FOUND",t["ERROR"]="ERROR"})(e=t.StatusCode||(t.StatusCode={})),function(t){t[t["OK"]=0]="OK",t[t["NOT_FOUND"]=1]="NOT_FOUND",t[t["ERROR"]=2]="ERROR"}(n||(n={})),function(t){t.codec=()=>Th(n)}(e=t.StatusCode||(t.StatusCode={})),t.codec=()=>(null==r&&(r=kh(((e,r,i={})=>{!1!==i.lengthDelimited&&r.fork(),(!0===i.writeDefaults||null!=e.status&&0!==n[e.status])&&(r.uint32(8),t.StatusCode.codec().encode(e.status,r)),(!0===i.writeDefaults||null!=e.data&&e.data.byteLength>0)&&(r.uint32(18),r.bytes(e.data)),!1!==i.lengthDelimited&&r.ldelim()}),((n,r)=>{const i={status:e.OK,data:new Uint8Array(0)},s=null==r?n.len:n.pos+r;while(n.pos<s){const e=n.uint32();switch(e>>>3){case 1:i.status=t.StatusCode.codec().decode(n);break;case 2:i.data=n.bytes();break;default:n.skipType(7&e);break}}return i}))),r),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(mQ||(mQ={}));const yQ="0.0.1",wQ="fetch",bQ=zt("libp2p:fetch");class vQ{constructor(t,e){this.started=!1,this.components=t,this.protocol=`/${e.protocolPrefix??"libp2p"}/${wQ}/${yQ}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=e}async start(){await this.components.registrar.handle(this.protocol,(t=>{this.handleMessage(t).catch((t=>{bQ.error(t)})).finally((()=>{t.stream.close()}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(t,e,n={}){bQ("dialing %s to %p",this.protocol,t);const r=await this.components.connectionManager.openConnection(t,n);let i,s,o=n.signal;if(null==o){i=new $o.TimeoutController(this.init.timeout),o=i.signal;try{(0,Jq.setMaxListeners)?.(1/0,i.signal)}catch{}}try{s=await r.newStream([this.protocol],{signal:o});const t=tV(s,o),n=await vm([gQ.encode({identifier:e})],rV(),t,cV(),(async function(t){const e=await rk(t);if(null==e)throw Vt(new Error("No data received"),qq.ERR_INVALID_MESSAGE);const n=mQ.decode(e);switch(n.status){case mQ.StatusCode.OK:return n.data;case mQ.StatusCode.NOT_FOUND:return null;case mQ.StatusCode.ERROR:{const t=(new TextDecoder).decode(n.data);throw Vt(new Error("Error in fetch protocol response: "+t),qq.ERR_INVALID_PARAMETERS)}default:throw Vt(new Error("Unknown response status"),qq.ERR_INVALID_MESSAGE)}}));return n??null}finally{null!=i&&i.clear(),null!=s&&s.close()}}async handleMessage(t){const{stream:e}=t,n=this;await vm(e,cV(),(async function*(t){const e=await rk(t);if(null==e)throw Vt(new Error("No data received"),qq.ERR_INVALID_MESSAGE);const r=gQ.decode(e);let i;const s=n._getLookupFunction(r.identifier);if(null!=s){const t=await s(r.identifier);i=null!=t?{status:mQ.StatusCode.OK,data:t}:{status:mQ.StatusCode.NOT_FOUND,data:new Uint8Array(0)}}else{const t=(new TextEncoder).encode("No lookup function registered for key: "+r.identifier);i={status:mQ.StatusCode.ERROR,data:t}}yield mQ.encode(i)}),rV(),e)}_getLookupFunction(t){for(const e of this.lookupFunctions.keys())if(t.startsWith(e))return this.lookupFunctions.get(e)}registerLookupFunction(t,e){if(this.lookupFunctions.has(t))throw Vt(new Error("Fetch protocol handler for key prefix '"+t+"' already registered"),qq.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(t,e)}unregisterLookupFunction(t,e){if(null!=e){const n=this.lookupFunctions.get(t);if(n!==e)return}this.lookupFunctions.delete(t)}}const EQ=32,_Q="1.0.0",SQ="ping",AQ=zt("libp2p:ping");class CQ{constructor(t,e){this.components=t,this.started=!1,this.protocol=`/${e.protocolPrefix}/${SQ}/${_Q}`,this.init=e}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(t){const{stream:e}=t;vm(e,e).catch((t=>{AQ.error(t)}))}async ping(t,e={}){AQ("dialing %s to %p",this.protocol,t);const n=Date.now(),r=Kd(EQ),i=await this.components.connectionManager.openConnection(t,e);let s,o,a=e.signal;if(null==a){s=new $o.TimeoutController(this.init.timeout),a=s.signal;try{(0,Jq.setMaxListeners)?.(1/0,s.signal)}catch{}}try{o=await i.newStream([this.protocol],{signal:a});const t=tV(o,a),e=await vm([r],t,(async t=>await rk(t))),s=Date.now();if(null==e||!Xa(r,e.subarray()))throw Vt(new Error("Received wrong ping ack"),qq.ERR_WRONG_PING_ACK);return s-n}finally{null!=s&&s.clear(),null!=o&&o.close()}}}async function IQ(){throw new Error("Not supported in browsers")}var TQ=n(8346);const kQ="object"===typeof window&&"object"===typeof document&&9===document.nodeType,RQ=TQ(),NQ=kQ&&!RQ,DQ=RQ&&!kQ,OQ=RQ&&kQ,PQ="undefined"!==typeof globalThis.process&&"undefined"!==typeof globalThis.process.release&&"node"===globalThis.process.release.name&&!RQ,xQ="function"===typeof importScripts&&"undefined"!==typeof self&&"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,MQ=("undefined"!==typeof globalThis.process&&"undefined"!==typeof globalThis.process.env&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"],"undefined"!==typeof navigator&&"ReactNative"===navigator.product);var LQ=n(7341);function BQ(t){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(t)||/^::1$/.test(t)}function UQ(t){const{address:e}=t.nodeAddress();return BQ(e)}const FQ=zt("libp2p:nat"),zQ=7200;function VQ(t=1024,e=65535){return Math.floor(Math.random()*(e-t+1)+t)}class jQ{constructor(t,e){if(this.components=t,this.started=!1,this.enabled=e.enabled,this.externalAddress=e.externalAddress,this.localAddress=e.localAddress,this.description=e.description??`${sQ}@${iQ} ${this.components.peerId.toString()}`,this.ttl=e.ttl??zQ,this.keepAlive=e.keepAlive??!0,this.gateway=e.gateway,this.ttl<zQ)throw Vt(new Error(`NatManager ttl should be at least ${zQ} seconds`),qq.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){NQ||!this.enabled||this.started||(this.started=!0,this._start().catch((t=>{FQ.error(t)})))}async _start(){const t=this.components.transportManager.getAddrs();for(const e of t){const{family:t,host:n,port:r,transport:i}=e.toOptions();if(!e.isThinWaistAddress()||"tcp"!==i)continue;if(UQ(e))continue;if(4!==t)continue;const s=await this._getClient(),o=this.externalAddress??await s.externalIp();if(LQ(o))throw new Error(`${o} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);const a=VQ();FQ(`opening uPnP connection from ${o}:${a} to ${n}:${r}`),await s.map({publicPort:a,localPort:r,localAddress:this.localAddress,protocol:"TCP"===i.toUpperCase()?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(cc({family:4,address:o,port:a},i))}}async _getClient(){return null!=this.client||(this.client=await IQ({description:this.description,ttl:this.ttl,keepAlive:this.keepAlive,gateway:this.gateway})),this.client}async stop(){if(!NQ&&null!=this.client)try{await this.client.close(),this.client=void 0}catch(uS){FQ.error(uS)}}}const HQ=zt("libp2p:peer-record-updater");class $Q{constructor(t){this.components=t,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then((async()=>{const t=new aM({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((t=>t.decapsulateCode(ga("p2p").code)))}),e=await eM.seal(t,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(e)})).catch((t=>{HQ.error("Could not update self peer record: %o",t)}))}}class KQ{constructor(t){this.dht=t}async findPeer(t,e={}){for await(const n of this.dht.findPeer(t,e))if("FINAL_PEER"===n.name)return n.peer;throw Vt(new Error(Gq.NOT_FOUND),qq.ERR_NOT_FOUND)}async*getClosestPeers(t,e={}){for await(const n of this.dht.getClosestPeers(t,e))"FINAL_PEER"===n.name&&(yield n.peer)}}const GQ={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"},qQ=zt("libp2p:peer-store:address-book"),WQ="change:multiaddrs";async function YQ(){return!0}class XQ{constructor(t,e,n){this.dispatchEvent=t,this.store=e,this.addressFilter=n??YQ}async consumePeerRecord(t){qQ.trace("consumePeerRecord await write lock");const e=await this.store.lock.writeLock();let n,r,i;qQ.trace("consumePeerRecord got write lock");try{let e;try{e=aM.createFromProtobuf(t.payload)}catch(uS){return qQ.error("invalid peer record received"),!1}n=e.peerId;const s=e.multiaddrs;if(!n.equals(t.peerId))return qQ("signing key does not match PeerId in the PeerRecord"),!1;if(null==s||0===s.length)return!1;if(await this.store.has(n)&&(r=await this.store.load(n),null!=r.peerRecordEnvelope)){const t=await eM.createFromProtobuf(r.peerRecordEnvelope),n=aM.createFromProtobuf(t.payload);if(n.seqNumber>=e.seqNumber)return qQ("sequence number was lower or equal to existing sequence number - stored: %d received: %d",n.seqNumber,e.seqNumber),!1}const o=await QQ(n,s,this.addressFilter,!0);i=await this.store.patchOrCreate(n,{addresses:o,peerRecordEnvelope:t.marshal().subarray()}),qQ("stored provided peer record for %p",e.peerId)}finally{qQ.trace("consumePeerRecord release write lock"),e()}return this.dispatchEvent(new yM(WQ,{detail:{peerId:n,multiaddrs:i.addresses.map((({multiaddr:t})=>t)),oldMultiaddrs:null==r?[]:r.addresses.map((({multiaddr:t})=>t))}})),!0}async getRawEnvelope(t){qQ.trace("getRawEnvelope await read lock");const e=await this.store.lock.readLock();qQ.trace("getRawEnvelope got read lock");try{const e=await this.store.load(t);return e.peerRecordEnvelope}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{qQ.trace("getRawEnvelope release read lock"),e()}}async getPeerRecord(t){const e=await this.getRawEnvelope(t);if(null!=e)return await eM.createFromProtobuf(e)}async get(t){t=Fu(t),qQ.trace("get wait for read lock");const e=await this.store.lock.readLock();qQ.trace("get got read lock");try{const e=await this.store.load(t);return e.addresses}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{qQ.trace("get release read lock"),e()}return[]}async set(t,e){if(t=Fu(t),!Array.isArray(e))throw qQ.error("multiaddrs must be an array of Multiaddrs"),Vt(new Error("multiaddrs must be an array of Multiaddrs"),GQ.ERR_INVALID_PARAMETERS);qQ.trace("set await write lock");const n=await this.store.lock.writeLock();qQ.trace("set got write lock");let r,i,s=!1;try{const n=await QQ(t,e,this.addressFilter);if(0===n.length)return;try{if(r=await this.store.load(t),s=!0,new Set([...n.map((({multiaddr:t})=>t.toString())),...r.addresses.map((({multiaddr:t})=>t.toString()))]).size===r.addresses.length&&n.length===r.addresses.length)return}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}i=await this.store.patchOrCreate(t,{addresses:n}),qQ("set multiaddrs for %p",t)}finally{qQ.trace("set multiaddrs for %p",t),qQ("set release write lock"),n()}this.dispatchEvent(new yM(WQ,{detail:{peerId:t,multiaddrs:i.addresses.map((t=>t.multiaddr)),oldMultiaddrs:null==r?[]:r.addresses.map((({multiaddr:t})=>t))}})),s||this.dispatchEvent(new yM("peer",{detail:{id:t,multiaddrs:i.addresses.map((t=>t.multiaddr)),protocols:i.protocols}}))}async add(t,e){if(t=Fu(t),!Array.isArray(e))throw qQ.error("multiaddrs must be an array of Multiaddrs"),Vt(new Error("multiaddrs must be an array of Multiaddrs"),GQ.ERR_INVALID_PARAMETERS);qQ.trace("add await write lock");const n=await this.store.lock.writeLock();let r,i,s;qQ.trace("add got write lock");try{const n=await QQ(t,e,this.addressFilter);if(0===n.length)return;try{if(i=await this.store.load(t),r=!0,new Set([...n.map((({multiaddr:t})=>t.toString())),...i.addresses.map((({multiaddr:t})=>t.toString()))]).size===i.addresses.length)return}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}s=await this.store.mergeOrCreate(t,{addresses:n}),qQ("added multiaddrs for %p",t)}finally{qQ.trace("set release write lock"),n()}this.dispatchEvent(new yM(WQ,{detail:{peerId:t,multiaddrs:s.addresses.map((t=>t.multiaddr)),oldMultiaddrs:null==i?[]:i.addresses.map((({multiaddr:t})=>t))}})),!0===r&&this.dispatchEvent(new yM("peer",{detail:{id:t,multiaddrs:s.addresses.map((t=>t.multiaddr)),protocols:s.protocols}}))}async delete(t){t=Fu(t),qQ.trace("delete await write lock");const e=await this.store.lock.writeLock();let n;qQ.trace("delete got write lock");try{try{n=await this.store.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(t,{addresses:[]})}finally{qQ.trace("delete release write lock"),e()}null!=n&&this.dispatchEvent(new yM(WQ,{detail:{peerId:t,multiaddrs:[],oldMultiaddrs:null==n?[]:n.addresses.map((({multiaddr:t})=>t))}}))}}async function QQ(t,e,n,r=!1){return await vm(e,(t=>YY(t,(t=>{if(!uc(t))throw qQ.error("multiaddr must be an instance of Multiaddr"),Vt(new Error("multiaddr must be an instance of Multiaddr"),GQ.ERR_INVALID_PARAMETERS)}))),(e=>tm(e,(async e=>await n(t,e)))),(t=>ky(t,(t=>({multiaddr:t,isCertified:r})))),(async t=>await Qg(t)))}const JQ=zt("libp2p:peer-store:key-book"),ZQ="change:pubkey";class tJ{constructor(t,e){this.dispatchEvent=t,this.store=e}async set(t,e){if(t=Fu(t),!(e instanceof Uint8Array))throw JQ.error("publicKey must be an instance of Uint8Array to store data"),Vt(new Error("publicKey must be an instance of PublicKey"),GQ.ERR_INVALID_PARAMETERS);JQ.trace("set await write lock");const n=await this.store.lock.writeLock();JQ.trace("set got write lock");let r,i=!1;try{try{if(r=await this.store.load(t),null!=r.pubKey&&Xa(r.pubKey,e))return}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(t,{pubKey:e}),i=!0}finally{JQ.trace("set release write lock"),n()}i&&this.dispatchEvent(new yM(ZQ,{detail:{peerId:t,publicKey:e,oldPublicKey:null==r?void 0:r.pubKey}}))}async get(t){t=Fu(t),JQ.trace("get await write lock");const e=await this.store.lock.readLock();JQ.trace("get got write lock");try{const e=await this.store.load(t);return e.pubKey}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{JQ("get release write lock"),e()}}async delete(t){t=Fu(t),JQ.trace("delete await write lock");const e=await this.store.lock.writeLock();let n;JQ.trace("delete got write lock");try{try{n=await this.store.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(t,{pubKey:void 0})}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{JQ.trace("delete release write lock"),e()}this.dispatchEvent(new yM(ZQ,{detail:{peerId:t,publicKey:void 0,oldPublicKey:null==n?void 0:n.pubKey}}))}}const eJ=zt("libp2p:peer-store:metadata-book"),nJ="change:metadata";class rJ{constructor(t,e){this.dispatchEvent=t,this.store=e}async get(t){t=Fu(t),eJ.trace("get await read lock");const e=await this.store.lock.readLock();eJ.trace("get got read lock");try{const e=await this.store.load(t);return e.metadata}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{eJ.trace("get release read lock"),e()}return new Map}async getValue(t,e){t=Fu(t),eJ.trace("getValue await read lock");const n=await this.store.lock.readLock();eJ.trace("getValue got read lock");try{const n=await this.store.load(t);return n.metadata.get(e)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{eJ.trace("getValue release write lock"),n()}}async set(t,e){if(t=Fu(t),!(e instanceof Map))throw eJ.error("valid metadata must be provided to store data"),Vt(new Error("valid metadata must be provided"),GQ.ERR_INVALID_PARAMETERS);eJ.trace("set await write lock");const n=await this.store.lock.writeLock();let r;eJ.trace("set got write lock");try{try{r=await this.store.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}await this.store.mergeOrCreate(t,{metadata:e})}finally{eJ.trace("set release write lock"),n()}this.dispatchEvent(new yM(nJ,{detail:{peerId:t,metadata:e,oldMetadata:null==r?new Map:r.metadata}}))}async setValue(t,e,n){if(t=Fu(t),"string"!==typeof e||!(n instanceof Uint8Array))throw eJ.error("valid key and value must be provided to store data"),Vt(new Error("valid key and value must be provided"),GQ.ERR_INVALID_PARAMETERS);eJ.trace("setValue await write lock");const r=await this.store.lock.writeLock();let i,s;eJ.trace("setValue got write lock");try{try{i=await this.store.load(t);const r=i.metadata.get(e);if(null!=r&&Xa(n,r))return}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}s=await this.store.mergeOrCreate(t,{metadata:new Map([[e,n]])})}finally{eJ.trace("setValue release write lock"),r()}this.dispatchEvent(new yM(nJ,{detail:{peerId:t,metadata:s.metadata,oldMetadata:null==i?new Map:i.metadata}}))}async delete(t){t=Fu(t),eJ.trace("delete await write lock");const e=await this.store.lock.writeLock();let n;eJ.trace("delete got write lock");try{try{n=await this.store.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}null!=n&&await this.store.patch(t,{metadata:new Map})}finally{eJ.trace("delete release write lock"),e()}null!=n&&this.dispatchEvent(new yM(nJ,{detail:{peerId:t,metadata:new Map,oldMetadata:n.metadata}}))}async deleteValue(t,e){t=Fu(t),eJ.trace("deleteValue await write lock");const n=await this.store.lock.writeLock();let r,i;eJ.trace("deleteValue got write lock");try{i=await this.store.load(t),r=i.metadata,r.delete(e),await this.store.patch(t,{metadata:r})}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{eJ.trace("deleteValue release write lock"),n()}null!=r&&this.dispatchEvent(new yM(nJ,{detail:{peerId:t,metadata:r,oldMetadata:null==i?new Map:i.metadata}}))}}const iJ=zt("libp2p:peer-store:proto-book"),sJ="change:protocols";class oJ{constructor(t,e){this.dispatchEvent=t,this.store=e}async get(t){iJ.trace("get wait for read lock");const e=await this.store.lock.readLock();iJ.trace("get got read lock");try{const e=await this.store.load(t);return e.protocols}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}finally{iJ.trace("get release read lock"),e()}return[]}async set(t,e){if(t=Fu(t),!Array.isArray(e))throw iJ.error("protocols must be provided to store data"),Vt(new Error("protocols must be provided"),GQ.ERR_INVALID_PARAMETERS);iJ.trace("set await write lock");const n=await this.store.lock.writeLock();let r,i;iJ.trace("set got write lock");try{try{if(r=await this.store.load(t),new Set([...e]).size===r.protocols.length)return}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}i=await this.store.patchOrCreate(t,{protocols:e}),iJ("stored provided protocols for %p",t)}finally{iJ.trace("set release write lock"),n()}this.dispatchEvent(new yM(sJ,{detail:{peerId:t,protocols:i.protocols,oldProtocols:null==r?[]:r.protocols}}))}async add(t,e){if(t=Fu(t),!Array.isArray(e))throw iJ.error("protocols must be provided to store data"),Vt(new Error("protocols must be provided"),GQ.ERR_INVALID_PARAMETERS);iJ.trace("add await write lock");const n=await this.store.lock.writeLock();let r,i;iJ.trace("add got write lock");try{try{if(r=await this.store.load(t),new Set([...r.protocols,...e]).size===r.protocols.length)return}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}i=await this.store.mergeOrCreate(t,{protocols:e}),iJ("added provided protocols for %p",t)}finally{iJ.trace("add release write lock"),n()}this.dispatchEvent(new yM(sJ,{detail:{peerId:t,protocols:i.protocols,oldProtocols:null==r?[]:r.protocols}}))}async remove(t,e){if(t=Fu(t),!Array.isArray(e))throw iJ.error("protocols must be provided to store data"),Vt(new Error("protocols must be provided"),GQ.ERR_INVALID_PARAMETERS);iJ.trace("remove await write lock");const n=await this.store.lock.writeLock();let r,i;iJ.trace("remove got write lock");try{try{r=await this.store.load(t);const n=new Set(r.protocols);for(const t of e)n.delete(t);if(r.protocols.length===n.size)return;e=Array.from(n)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}i=await this.store.patchOrCreate(t,{protocols:e})}finally{iJ.trace("remove release write lock"),n()}this.dispatchEvent(new yM(sJ,{detail:{peerId:t,protocols:i.protocols,oldProtocols:null==r?[]:r.protocols}}))}async delete(t){t=Fu(t),iJ.trace("delete await write lock");const e=await this.store.lock.writeLock();let n;iJ.trace("delete got write lock");try{try{n=await this.store.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(t,{protocols:[]})}finally{iJ.trace("delete release write lock"),e()}null!=n&&this.dispatchEvent(new yM(sJ,{detail:{peerId:t,protocols:[],oldProtocols:n.protocols}}))}}var aJ,cJ,lJ;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{if(!1!==n.lengthDelimited&&e.fork(),null!=t.addresses)for(const r of t.addresses)e.uint32(10),cJ.codec().encode(r,e,{writeDefaults:!0});if(null!=t.protocols)for(const r of t.protocols)e.uint32(18),e.string(r);if(null!=t.metadata)for(const r of t.metadata)e.uint32(26),lJ.codec().encode(r,e,{writeDefaults:!0});null!=t.pubKey&&(e.uint32(34),e.bytes(t.pubKey)),null!=t.peerRecordEnvelope&&(e.uint32(42),e.bytes(t.peerRecordEnvelope)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={addresses:[],protocols:[],metadata:[]},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.addresses.push(cJ.codec().decode(t,t.uint32()));break;case 2:n.protocols.push(t.string());break;case 3:n.metadata.push(lJ.codec().decode(t,t.uint32()));break;case 4:n.pubKey=t.bytes();break;case 5:n.peerRecordEnvelope=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(aJ||(aJ={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.multiaddr&&t.multiaddr.byteLength>0)&&(e.uint32(10),e.bytes(t.multiaddr)),null!=t.isCertified&&(e.uint32(16),e.bool(t.isCertified)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={multiaddr:new Uint8Array(0)},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.multiaddr=t.bytes();break;case 2:n.isCertified=t.bool();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(cJ||(cJ={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),!0!==n.writeDefaults&&""===t.key||(e.uint32(10),e.string(t.key)),(!0===n.writeDefaults||null!=t.value&&t.value.byteLength>0)&&(e.uint32(18),e.bytes(t.value)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={key:"",value:new Uint8Array(0)},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.key=t.string();break;case 2:n.value=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(lJ||(lJ={}));const uJ=zt("libp2p:peer-store:store"),hJ="/peers/";class dJ{constructor(t){this.components=t,this.lock=Zk({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(t){if(null==t.type)throw uJ.error("peerId must be an instance of peer-id to store data"),Vt(new Error("peerId must be an instance of peer-id"),GQ.ERR_INVALID_PARAMETERS);const e=t.toCID().toString();return new rl(`${hJ}${e}`)}async has(t){return await this.components.datastore.has(this._peerIdToDatastoreKey(t))}async delete(t){await this.components.datastore.delete(this._peerIdToDatastoreKey(t))}async load(t){const e=await this.components.datastore.get(this._peerIdToDatastoreKey(t)),n=aJ.decode(e),r=new Map;for(const i of n.metadata)r.set(i.key,i.value);return{...n,id:t,addresses:n.addresses.map((({multiaddr:t,isCertified:e})=>({multiaddr:dc(t),isCertified:e??!1}))),metadata:r,pubKey:n.pubKey??void 0,peerRecordEnvelope:n.peerRecordEnvelope??void 0}}async save(t){if(null!=t.pubKey&&null!=t.id.publicKey&&!Xa(t.pubKey,t.id.publicKey))throw uJ.error("peer publicKey bytes do not match peer id publicKey bytes"),Vt(new Error("publicKey bytes do not match peer id publicKey bytes"),GQ.ERR_INVALID_PARAMETERS);const e=new Set,n=t.addresses.filter((t=>!e.has(t.multiaddr.toString())&&(e.add(t.multiaddr.toString()),!0))).sort(((t,e)=>t.multiaddr.toString().localeCompare(e.multiaddr.toString()))).map((({multiaddr:t,isCertified:e})=>({multiaddr:t.bytes,isCertified:e}))),r=[];[...t.metadata.keys()].sort().forEach((e=>{const n=t.metadata.get(e);null!=n&&r.push({key:e,value:n})}));const i=aJ.encode({addresses:n,protocols:t.protocols.sort(),pubKey:t.pubKey,metadata:r,peerRecordEnvelope:t.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(t.id),i.subarray()),await this.load(t.id)}async patch(t,e){const n=await this.load(t);return await this._patch(t,e,n)}async patchOrCreate(t,e){let n;try{n=await this.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS;n={id:t,addresses:[],protocols:[],metadata:new Map}}return await this._patch(t,e,n)}async _patch(t,e,n){return await this.save({...n,...e,id:t})}async merge(t,e){const n=await this.load(t);return await this._merge(t,e,n)}async mergeOrCreate(t,e){let n;try{n=await this.load(t)}catch(uS){if(uS.code!==GQ.ERR_NOT_FOUND)throw uS;n={id:t,addresses:[],protocols:[],metadata:new Map}}return await this._merge(t,e,n)}async _merge(t,e,n){const r=new Map;return n.addresses.forEach((t=>{r.set(t.multiaddr.toString(),t.isCertified)})),(e.addresses??[]).forEach((t=>{const e=t.multiaddr.toString(),n=Boolean(r.get(e)),i=n||t.isCertified;r.set(e,i)})),await this.save({id:t,addresses:Array.from(r.entries()).map((([t,e])=>({multiaddr:dc(t),isCertified:e}))),protocols:Array.from(new Set([...n.protocols??[],...e.protocols??[]])),metadata:new Map([...n.metadata?.entries()??[],...e.metadata?.entries()??[]]),pubKey:e.pubKey??(null!=n?n.pubKey:void 0),peerRecordEnvelope:e.peerRecordEnvelope??(null!=n?n.peerRecordEnvelope:void 0)})}async*all(){for await(const t of this.components.datastore.queryKeys({prefix:hJ})){const e=t.toString().split("/")[2],n=Tt.decode(e);yield this.load(Vu(n))}}}var fJ,pJ;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{if(!1!==n.lengthDelimited&&e.fork(),null!=t.tags)for(const r of t.tags)e.uint32(10),pJ.codec().encode(r,e,{writeDefaults:!0});!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={tags:[]},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.tags.push(pJ.codec().decode(t,t.uint32()));break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(fJ||(fJ={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),!0!==n.writeDefaults&&""===t.name||(e.uint32(10),e.string(t.name)),null!=t.value&&(e.uint32(16),e.uint32(t.value)),null!=t.expiry&&(e.uint32(24),e.uint64(t.expiry)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={name:""},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.name=t.string();break;case 2:n.value=t.uint32();break;case 3:n.expiry=t.uint64();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(pJ||(pJ={}));const gJ=zt("libp2p:peer-store");class mJ extends gM{constructor(t,e={}){super(),this.components=t,this.store=new dJ(t),this.addressBook=new XQ(this.dispatchEvent.bind(this),this.store,e.addressFilter),this.keyBook=new tJ(this.dispatchEvent.bind(this),this.store),this.metadataBook=new rJ(this.dispatchEvent.bind(this),this.store),this.protoBook=new oJ(this.dispatchEvent.bind(this),this.store)}async forEach(t){gJ.trace("getPeers await read lock");const e=await this.store.lock.readLock();gJ.trace("getPeers got read lock");try{for await(const e of this.store.all())e.id.equals(this.components.peerId)||t(e)}finally{gJ.trace("getPeers release read lock"),e()}}async all(){const t=[];return await this.forEach((e=>{t.push(e)})),t}async delete(t){gJ.trace("delete await write lock");const e=await this.store.lock.writeLock();gJ.trace("delete got write lock");try{await this.store.delete(t)}finally{gJ.trace("delete release write lock"),e()}}async get(t){gJ.trace("get await read lock");const e=await this.store.lock.readLock();gJ.trace("get got read lock");try{return await this.store.load(t)}finally{gJ.trace("get release read lock"),e()}}async has(t){gJ.trace("has await read lock");const e=await this.store.lock.readLock();gJ.trace("has got read lock");try{return await this.store.has(t)}finally{gJ.trace("has release read lock"),e()}}async tagPeer(t,e,n={}){const r=n.value??0,i=Math.round(r),s=n.ttl??void 0;if(i!==r||i<0||i>100)throw Vt(new Error("Tag value must be between 0-100"),"ERR_TAG_VALUE_OUT_OF_BOUNDS");const o=await this.metadataBook.getValue(t,"tags");let a=[];null!=o&&(a=fJ.decode(o).tags);for(const c of a)if(c.name===e)throw Vt(new Error("Peer already tagged"),"ERR_DUPLICATE_TAG");a.push({name:e,value:i,expiry:null==s?void 0:BigInt(Date.now()+s)}),await this.metadataBook.setValue(t,"tags",fJ.encode({tags:a}).subarray())}async unTagPeer(t,e){const n=await this.metadataBook.getValue(t,"tags");let r=[];null!=n&&(r=fJ.decode(n).tags),r=r.filter((t=>t.name!==e)),await this.metadataBook.setValue(t,"tags",fJ.encode({tags:r}).subarray())}async getTags(t){const e=await this.metadataBook.getValue(t,"tags");let n=[];null!=e&&(n=fJ.decode(e).tags);const r=BigInt(Date.now()),i=n.filter((t=>null==t.expiry||t.expiry>r));return i.length!==n.length&&await this.metadataBook.setValue(t,"tags",fJ.encode({tags:i}).subarray()),i.map((t=>({name:t.name,value:t.value??0})))}}class yJ{constructor(t){this.dht=t}async provide(t){await Zg(this.dht.provide(t))}async*findProviders(t,e={}){for await(const n of this.dht.findProviders(t,e))"PROVIDER"===n.name&&(yield*n.providers)}async put(t,e,n){await Zg(this.dht.put(t,e,n))}async get(t,e){for await(const n of this.dht.get(t,e))if("VALUE"===n.name)return n.value;throw Vt(new Error("Not found"),"ERR_NOT_FOUND")}}class wJ{constructor(t={}){this._started=!1,this._peerId=t.peerId,this._addressManager=t.addressManager,this._peerStore=t.peerStore,this._upgrader=t.upgrader,this._metrics=t.metrics,this._registrar=t.registrar,this._connectionManager=t.connectionManager,this._transportManager=t.transportManager,this._connectionGater=t.connectionGater,this._contentRouting=t.contentRouting,this._peerRouting=t.peerRouting,this._datastore=t.datastore,this._connectionProtector=t.connectionProtector,this._dht=t.dht,this._pubsub=t.pubsub,this._dialer=t.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.beforeStart&&await t.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{await t.start()}))),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.afterStart&&await t.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.beforeStop&&await t.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{await t.stop()}))),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter((t=>CU(t))).map((async t=>{null!=t.afterStop&&await t.afterStop()})))}get peerId(){if(null==this._peerId)throw Vt(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(t){this._peerId=t}get addressManager(){if(null==this._addressManager)throw Vt(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(t){this._addressManager=t}get peerStore(){if(null==this._peerStore)throw Vt(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(t){this._peerStore=t}get upgrader(){if(null==this._upgrader)throw Vt(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(t){this._upgrader=t}get registrar(){if(null==this._registrar)throw Vt(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(t){this._registrar=t}get connectionManager(){if(null==this._connectionManager)throw Vt(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(t){this._connectionManager=t}get transportManager(){if(null==this._transportManager)throw Vt(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(t){this._transportManager=t}get connectionGater(){if(null==this._connectionGater)throw Vt(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(t){this._connectionGater=t}get contentRouting(){if(null==this._contentRouting)throw Vt(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(t){this._contentRouting=t}get peerRouting(){if(null==this._peerRouting)throw Vt(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(t){this._peerRouting=t}get datastore(){if(null==this._datastore)throw Vt(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(t){this._datastore=t}get connectionProtector(){return this._connectionProtector}set connectionProtector(t){this._connectionProtector=t}get dialer(){if(null==this._dialer)throw Vt(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(t){this._dialer=t}get metrics(){return this._metrics}set metrics(t){this._metrics=t}get dht(){return this._dht}set dht(t){this._dht=t}get pubsub(){return this._pubsub}set pubsub(t){this._pubsub=t}}var bJ=n(3707);const vJ=globalThis.fetch,EJ=globalThis.Headers;globalThis.Request,globalThis.Response;function _J(t,e,n){return`${t}?name=${e}&type=${n}`}async function SJ(t,e){const n=await vJ(t,{headers:new EJ({accept:"application/dns-json"}),signal:e}),r=await n.json();return r}function AJ(t,e){return`${e}_${t}`}const CJ=Object.assign(it("dns-over-http-resolver"),{error:it("dns-over-http-resolver:error")});class IJ{constructor(t={}){this._cache=new bJ({max:t?.maxCache??100}),this._TXTcache=new bJ({max:t?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=t.request??SJ,this._abortControllers=[]}cancel(){this._abortControllers.forEach((t=>t.abort()))}getServers(){return this._servers}_getShuffledServers(){const t=[...this._servers];for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*e),r=t[e];t[e]=t[n],t[n]=r}return t}setServers(t){this._servers=t}async resolve(t,e="A"){switch(e){case"A":return await this.resolve4(t);case"AAAA":return await this.resolve6(t);case"TXT":return await this.resolveTxt(t);default:throw new Error(`${e} is not supported`)}}async resolve4(t){const e="A",n=this._cache.get(AJ(t,e));if(null!=n)return n;let r=!1;for(const i of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(_J(i,t,e),n.signal),s=r.Answer.map((t=>t.data)),o=Math.min(...r.Answer.map((t=>t.TTL)));return this._cache.set(AJ(t,e),s,{ttl:o}),s}catch(uS){n.signal.aborted&&(r=!0),CJ.error(`${i} could not resolve ${t} record ${e}`)}finally{this._abortControllers=this._abortControllers.filter((t=>t!==n))}}if(r)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${t} record ${e}`)}async resolve6(t){const e="AAAA",n=this._cache.get(AJ(t,e));if(null!=n)return n;let r=!1;for(const i of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(_J(i,t,e),n.signal),s=r.Answer.map((t=>t.data)),o=Math.min(...r.Answer.map((t=>t.TTL)));return this._cache.set(AJ(t,e),s,{ttl:o}),s}catch(uS){n.signal.aborted&&(r=!0),CJ.error(`${i} could not resolve ${t} record ${e}`)}finally{this._abortControllers=this._abortControllers.filter((t=>t!==n))}}if(r)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${t} record ${e}`)}async resolveTxt(t){const e="TXT",n=this._TXTcache.get(AJ(t,e));if(null!=n)return n;let r=!1;for(const i of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(_J(i,t,e),n.signal),s=r.Answer.map((t=>[t.data.replace(/['"]+/g,"")])),o=Math.min(...r.Answer.map((t=>t.TTL)));return this._TXTcache.set(AJ(t,e),s,{ttl:o}),s}catch(uS){n.signal.aborted&&(r=!0),CJ.error(`${i} could not resolve ${t} record ${e}`)}finally{this._abortControllers=this._abortControllers.filter((t=>t!==n))}}if(r)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${t} record ${e}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}var TJ=IJ,kJ=TJ;const{code:RJ}=ga("dnsaddr");async function NJ(t,e={}){const n=new kJ;null!=e.signal&&e.signal.addEventListener("abort",(()=>{n.cancel()}));const r=t.getPeerId(),[,i]=t.stringTuples().find((([t])=>t===RJ))??[];if(null==i)throw new Error("No hostname found in multiaddr");const s=await n.resolveTxt(`_dnsaddr.${i}`);let o=s.flat().map((t=>t.split("=")[1]));return null!=r&&(o=o.filter((t=>t.includes(r)))),o}const DJ={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:t=>t},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:JY,maxDialsPerPeer:ZY,dialTimeout:XY,inboundUpgradeTimeout:QY,resolvers:{dnsaddr:NJ},addressSorter:CY},connectionGater:{},transportManager:{faultTolerance:RX.FATAL_ALL},metrics:{enabled:!1,computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:JW,enabled:!1,ttl:ZW},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:oQ},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};function OJ(t){const e=nt(DJ,t);if(null==e.transports||e.transports.length<1)throw Vt(new Error(Gq.ERR_TRANSPORTS_REQUIRED),qq.ERR_TRANSPORTS_REQUIRED);if(null==e.connectionEncryption||0===e.connectionEncryption.length)throw Vt(new Error(Gq.CONN_ENCRYPTION_REQUIRED),qq.CONN_ENCRYPTION_REQUIRED);if(null===e.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw Vt(new Error(Gq.ERR_PROTECTOR_REQUIRED),qq.ERR_PROTECTOR_REQUIRED);return e.identify.host.agentVersion===oQ&&(PQ||DQ?e.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(NQ||xQ||OQ||MQ)&&(e.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),e}var PJ;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.id&&t.id.byteLength>0)&&(e.uint32(10),e.bytes(t.id)),null!=t.pubKey&&(e.uint32(18),e.bytes(t.pubKey)),null!=t.privKey&&(e.uint32(26),e.bytes(t.privKey)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={id:new Uint8Array(0)},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.id=t.bytes();break;case 2:n.pubKey=t.bytes();break;case 3:n.privKey=t.bytes();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(PJ||(PJ={}));const xJ=async()=>{const t=await Gp("Ed25519"),e=await LJ(t);if("Ed25519"===e.type)return e;throw new Error(`Generated unexpected PeerId type "${e.type}"`)},MJ=async t=>{const e=await Gp("RSA",t?.bits??2048),n=await LJ(e);if("RSA"===n.type)return n;throw new Error(`Generated unexpected PeerId type "${n.type}"`)};async function LJ(t){return await Hu(Wp(t.public),Xp(t))}class BJ extends gM{get[Uq](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}get lan(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}get(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}findProviders(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}findPeer(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}getClosestPeers(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}provide(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}put(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}async getMode(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}async setMode(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}async refreshRoutingTable(){throw Vt(new Error(Gq.DHT_DISABLED),qq.DHT_DISABLED)}}class UJ extends gM{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}get multicodecs(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}getPeers(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}getTopics(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}subscribe(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}unsubscribe(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}getSubscribers(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}async publish(){throw Vt(new Error(Gq.PUBSUB_DISABLED),qq.ERR_PUBSUB_DISABLED)}}class FJ extends Error{constructor(t="The operation was aborted"){super(t),this.code=FJ.code,this.type=FJ.type}static get code(){return"ABORT_ERR"}static get type(){return"aborted"}}var zJ=n(2119);const VJ=zt("libp2p:dialer:dial-request");class jJ{constructor(t){const{addrs:e,dialAction:n,dialer:r}=t;this.addrs=e,this.dialer=r,this.dialAction=n}async run(t={}){const e=this.dialer.getTokens(this.addrs.length);if(e.length<1)throw Vt(new Error("No dial tokens available"),qq.ERR_NO_DIAL_TOKENS);const n=new zJ;for(const o of e)n.push(o).catch((t=>{VJ.error(t)}));const r=this.addrs.map((()=>{const t=new AbortController;try{(0,Jq.setMaxListeners)?.(1/0,t.signal)}catch{}return t}));if(null!=t.signal)try{(0,Jq.setMaxListeners)?.(1/0,t.signal)}catch{}let i=0,s=!1;try{return await Promise.any(this.addrs.map((async(o,a)=>{const c=await n.shift();if(s)throw this.dialer.releaseToken(e.splice(e.indexOf(c),1)[0]),Vt(new Error("dialAction already succeeded"),qq.ERR_ALREADY_SUCCEEDED);const l=r[a];if(null==l)throw Vt(new Error("dialAction did not come with an AbortController"),qq.ERR_INVALID_PARAMETERS);let u;try{const e=l.signal;u=await this.dialAction(o,{...t,signal:null!=t.signal?(0,al.anySignal)([e,t.signal]):e}),r[a]=void 0}finally{i++,this.addrs.length-i>=e.length?n.push(c).catch((t=>{VJ.error(t)})):this.dialer.releaseToken(e.splice(e.indexOf(c),1)[0])}if(null==u)throw Vt(new Error("dialAction led to empty object"),qq.ERR_TRANSPORT_DIAL_FAILED);return s=!0,u})))}finally{r.forEach((t=>{void 0!==t&&t.abort()})),e.forEach((t=>this.dialer.releaseToken(t)))}}}const HJ=zt("libp2p:dialer"),$J="dialler",KJ="pending-dials",GJ="pending-dial-targets";class qJ{constructor(t,e={}){this.started=!1,this.addressSorter=e.addressSorter??CY,this.maxAddrsToDial=e.maxAddrsToDial??tX,this.timeout=e.dialTimeout??XY,this.maxDialsPerPeer=e.maxDialsPerPeer??ZY,this.tokens=[...new Array(e.maxParallelDials??JY)].map(((t,e)=>e)),this.components=t,this.pendingDials=IX({component:$J,metric:KJ,metrics:e.metrics}),this.pendingDialTargets=IX({component:$J,metric:GJ,metrics:t.metrics});for(const[n,r]of Object.entries(e.resolvers??{}))oc.set(n,r)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(const t of this.pendingDials.values())try{t.controller.abort()}catch(uS){HJ.error(uS)}this.pendingDials.clear();for(const t of this.pendingDialTargets.values())t.reject(new FJ("Dialer was destroyed"));this.pendingDialTargets.clear()}async dial(t,e={}){const{id:n,multiaddrs:r}=rW(t);if(this.components.peerId.equals(n))throw Vt(new Error("Tried to dial self"),qq.ERR_DIALED_SELF);if(HJ("check multiaddrs %p",n),null!=r&&r.length>0&&(HJ("storing multiaddrs %p",n,r),await this.components.peerStore.addressBook.add(n,r)),await this.components.connectionGater.denyDialPeer(n))throw Vt(new Error("The dial request is blocked by gater.allowDialPeer"),qq.ERR_PEER_DIAL_INTERCEPTED);HJ("creating dial target for %p",n);const i=await this._createCancellableDialTarget(n,e);if(0===i.addrs.length)throw Vt(new Error("The dial request has no valid addresses"),qq.ERR_NO_VALID_ADDRESSES);const s=this.pendingDials.get(i.id)??this._createPendingDial(i,e);try{const t=await s.promise;return HJ("dial succeeded to %s",i.id),t}catch(uS){throw HJ("dial failed to %s",i.id,uS),s.controller.signal.aborted&&(uS.code=qq.ERR_TIMEOUT),HJ.error(uS),uS}finally{s.destroy()}}async _createCancellableDialTarget(t,e){const n=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,r=new Promise(((t,e)=>{this.pendingDialTargets.set(n,{resolve:t,reject:e})}));try{const n=await Promise.race([this._createDialTarget(t,e),r]);return n}finally{this.pendingDialTargets.delete(n)}}async _createDialTarget(t,e){const n=this._resolve.bind(this),r=await vm(await this.components.peerStore.addressBook.get(t),(e=>tm(e,(async e=>!await this.components.connectionGater.denyDialMultiaddr(t,e.multiaddr)))),(t=>_x(t,this.addressSorter)),(async function*(t){for await(const r of t)yield*await n(r.multiaddr,e)}),(t=>tm(t,(t=>Boolean(this.components.transportManager.transportForMultiaddr(t))))),(e=>ky(e,(e=>t.toString()===e.getPeerId()?e:e.encapsulate(`/p2p/${t.toString()}`)))),(async t=>await Qg(t)));if(r.length>this.maxAddrsToDial)throw await this.components.peerStore.delete(t),Vt(new Error("dial with more addresses than allowed"),qq.ERR_TOO_MANY_ADDRESSES);return{id:t.toString(),addrs:r}}_createPendingDial(t,e={}){const n=async(t,e={})=>{if(!0===e.signal?.aborted)throw Vt(new Error("already aborted"),qq.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(t,e).catch((e=>{throw HJ.error("dial to %s failed",t,e),e}))},r=new jJ({addrs:t.addrs,dialAction:n,dialer:this}),i=new $o.TimeoutController(this.timeout),s=[i.signal];null!=e.signal&&s.push(e.signal);const o=(0,al.anySignal)(s);try{(0,Jq.setMaxListeners)?.(1/0,o)}catch{}const a={dialRequest:r,controller:i,promise:r.run({...e,signal:o}),destroy:()=>{i.clear(),this.pendingDials.delete(t.id)}};return this.pendingDials.set(t.id,a),a}getTokens(t){const e=Math.min(t,this.maxDialsPerPeer,this.tokens.length),n=this.tokens.splice(0,e);return HJ("%d tokens request, returning %d, %d remaining",t,e,this.tokens.length),n}releaseToken(t){this.tokens.includes(t)||(HJ("token %d released",t),this.tokens.push(t))}async _resolve(t,e){const n=t.protoNames().includes("dnsaddr");if(!n)return[t];const r=await this._resolveRecord(t,e),i=await Promise.all(r.map((async t=>await this._resolve(t,e)))),s=i.flat();return s.reduce(((t,e)=>(null==t.find((t=>t.equals(e)))&&t.push(e),t)),[])}async _resolveRecord(t,e){try{t=dc(t.toString());const n=await t.resolve(e);return n}catch(uS){return HJ.error(`multiaddr ${t.toString()} could not be resolved`,uS),[]}}}const WJ=zt("libp2p");class YJ extends gM{constructor(t){super(),this.started=!1,this.peerId=t.peerId;const e=this.components=new wJ({peerId:t.peerId,datastore:t.datastore??new pm,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...t.connectionGater}});e.peerStore=new mJ(e,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore}),this.services=[e],t.metrics.enabled&&(this.metrics=this.components.metrics=new aX(t.metrics)),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",(t=>{const{detail:e}=t;this.dispatchEvent(new yM("peer:discovery",{detail:e}))})),null!=t.connectionProtector&&(this.components.connectionProtector=t.connectionProtector(e)),this.components.upgrader=new nQ(this.components,{connectionEncryption:(t.connectionEncryption??[]).map((t=>this.configureComponent(t(this.components)))),muxers:(t.streamMuxers??[]).map((t=>this.configureComponent(t(this.components)))),inboundUpgradeTimeout:t.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new qJ(this.components,t.connectionManager),this.connectionManager=this.components.connectionManager=new IW(this.components,t.connectionManager),this.registrar=this.components.registrar=new QX(this.components),this.components.transportManager=new kX(this.components,t.transportManager),this.components.addressManager=new sW(this.components,t.addresses),this.configureComponent(new $Q(this.components)),this.configureComponent(new RW(this.components,{enabled:t.connectionManager.autoDial,minConnections:t.connectionManager.minConnections,autoDialInterval:t.connectionManager.autoDialInterval}));const n=WY.generateOptions();this.keychain=this.configureComponent(new WY(this.components,{...n,...t.keychain})),this.services.push(new jQ(this.components,t.nat)),t.transports.forEach((t=>{this.components.transportManager.add(this.configureComponent(t(this.components)))})),this.identifyService=new pQ(this.components,{...t.identify}),this.configureComponent(this.identifyService),null!=t.dht?this.dht=this.components.dht=t.dht(this.components):this.dht=new BJ,null!=t.pubsub?this.pubsub=this.components.pubsub=t.pubsub(this.components):this.pubsub=new UJ;const r=(t.peerRouters??[]).map((t=>this.configureComponent(t(this.components))));null!=t.dht&&(r.push(this.configureComponent(new KQ(this.dht))),this.dht.addEventListener("peer",(t=>{this.onDiscoveryPeer(t)}))),this.peerRouting=this.components.peerRouting=this.configureComponent(new tW(this.components,{...t.peerRouting,routers:r}));const i=(t.contentRouters??[]).map((t=>this.configureComponent(t(this.components))));null!=t.dht&&i.push(this.configureComponent(new yJ(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new eW(this.components,{routers:i})),t.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new YW(this.components,t.relay))),this.configureComponent(new NY(this.components,{addressSorter:t.connectionManager.addressSorter,...t.relay}))),this.fetchService=this.configureComponent(new vQ(this.components,{...t.fetch})),this.pingService=this.configureComponent(new CQ(this.components,{...t.ping}));for(const s of t.peerDiscovery??[]){const t=this.configureComponent(s(this.components));t.addEventListener("peer",(t=>{this.onDiscoveryPeer(t)}))}}configureComponent(t){return CU(t)&&this.services.push(t),t}async start(){if(!this.started){this.started=!0,WJ("libp2p is starting");try{await Promise.all(this.services.map((async t=>{null!=t.beforeStart&&await t.beforeStart()}))),await Promise.all(this.services.map((t=>t.start()))),await Promise.all(this.services.map((async t=>{null!=t.afterStart&&await t.afterStart()}))),WJ("libp2p has started")}catch(uS){throw WJ.error("An error occurred starting libp2p",uS),await this.stop(),uS}}}async stop(){this.started&&(WJ("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map((async t=>{null!=t.beforeStop&&await t.beforeStop()}))),await Promise.all(this.services.map((t=>t.stop()))),await Promise.all(this.services.map((async t=>{null!=t.afterStop&&await t.afterStop()}))),WJ("libp2p has stopped"))}isStarted(){return this.started}getConnections(t){return this.components.connectionManager.getConnections(t)}getPeers(){const t=new yW;for(const e of this.components.connectionManager.getConnections())t.add(e.remotePeer);return Array.from(t)}async dial(t,e={}){const{id:n,multiaddrs:r}=rW(t);return await this.components.peerStore.addressBook.add(n,r),await this.components.connectionManager.openConnection(n,e)}async dialProtocol(t,e,n={}){if(null==e)throw Vt(new Error("no protocols were provided to open a stream"),qq.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(e=Array.isArray(e)?e:[e],0===e.length)throw Vt(new Error("no protocols were provided to open a stream"),qq.ERR_INVALID_PROTOCOLS_FOR_STREAM);const r=await this.dial(t,n);return await r.newStream(e,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}async hangUp(t){const{id:e}=rW(t);await this.components.connectionManager.closeConnections(e)}async getPublicKey(t,e={}){if(WJ("getPublicKey %p",t),null!=t.publicKey)return t.publicKey;const n=await this.peerStore.get(t);if(null!=n.pubKey)return n.pubKey;if(null==this.dht)throw Vt(new Error("Public key was not in the peer store and the DHT is not enabled"),qq.ERR_NO_ROUTERS_AVAILABLE);const r=ya([Ho("/pk/"),t.multihash.digest]);for await(const i of this.dht.get(r,e))if("VALUE"===i.name){const e=qp(i.value);return await this.peerStore.keyBook.set(t,i.value),e.bytes}throw Vt(new Error(`Node not responding with its public key: ${t.toString()}`),qq.ERR_INVALID_RECORD)}async fetch(t,e,n={}){const{id:r,multiaddrs:i}=rW(t);return null!=i&&await this.components.peerStore.addressBook.add(r,i),await this.fetchService.fetch(r,e,n)}async ping(t,e={}){const{id:n,multiaddrs:r}=rW(t);return r.length>0&&await this.components.peerStore.addressBook.add(n,r),await this.pingService.ping(n,e)}async handle(t,e,n){Array.isArray(t)||(t=[t]),await Promise.all(t.map((async t=>{await this.components.registrar.handle(t,e,n)})))}async unhandle(t){Array.isArray(t)||(t=[t]),await Promise.all(t.map((async t=>{await this.components.registrar.unhandle(t)})))}onDiscoveryPeer(t){const{detail:e}=t;e.id.toString()!==this.peerId.toString()?(e.multiaddrs.length>0&&this.components.peerStore.addressBook.add(e.id,e.multiaddrs).catch((t=>WJ.error(t))),e.protocols.length>0&&this.components.peerStore.protoBook.set(e.id,e.protocols).catch((t=>WJ.error(t))),this.dispatchEvent(new yM("peer:discovery",{detail:e}))):WJ.error(new Error(qq.ERR_DISCOVERED_SELF))}}async function XJ(t){return null==t.peerId&&(t.peerId=await xJ()),new YJ(OJ(t))}async function QJ(t){return await XJ(t)}var JJ=n(1918);const ZJ=1e3,tZ=60*ZJ,eZ=60*tZ,nZ=36*eZ,rZ="/lan",iZ="/ipfs",sZ="/kad/1.0.0",oZ="/dht/record",aZ="/dht/provider",cZ=256,lZ=24*eZ,uZ=eZ,hZ=20,dZ=3,fZ=Number(5*tZ),pZ=Number(30*ZJ),gZ=Number(5*tZ),mZ=Number(30*ZJ),yZ=Number(30*ZJ),wZ=Ho("/pk/");function bZ(t){return{...t,multiaddrs:t.multiaddrs.filter((t=>{const[[e,n]]=t.stringTuples();return(4===e||6===e)&&(null!=n&&!LQ(n))}))}}function vZ(t){return{...t,multiaddrs:t.multiaddrs.filter((t=>{const[[e,n]]=t.stringTuples();return(4===e||6===e)&&(null!=n&&LQ(n))}))}}async function EZ(t){const e=await ho.digest(t);return e.digest}async function _Z(t){return await EZ(t.toBytes())}function SZ(t){return new rl(`${oZ}/${sa(t,"base32")}`,!1)}function AZ(t){return ya([wZ,t.toBytes()])}function CZ(t){return"/pk/"===sa(t.subarray(0,4))}function IZ(t){return Vu(t.subarray(4))}function TZ(t,e){const n=new Date,r=new Om(t,e,n);return r.serialize()}function kZ(t,e=100){let n;return()=>{clearTimeout(n),n=setTimeout((()=>t()),e)}}const RZ="kad-close",NZ=50,DZ=20,OZ=1e4,PZ=10,xZ="routing-table-size",MZ="ping-queue-size",LZ="ping-running";class BZ{constructor(t,e){const{kBucketSize:n,pingTimeout:r,lan:i,pingConcurrency:s,protocol:o,tagName:a,tagValue:c}=e;this.components=t,this.log=zt(`libp2p:kad-dht:${i?"lan":"wan"}:routing-table`),this.kBucketSize=n??DZ,this.pingTimeout=r??OZ,this.pingConcurrency=s??PZ,this.lan=i,this.running=!1,this.protocol=o,this.tagName=a??RZ,this.tagValue=c??NZ;const l=()=>{this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:MZ,value:this.pingQueue.size}),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:LZ,value:this.pingQueue.pending})};this.pingQueue=new yu({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",l),this.pingQueue.addListener("next",l),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0;const t=new JJ({localNodeId:await _Z(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=t,t.on("ping",this._onPing),this._tagPeers(t)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(t){let e=new yW;const n=kZ((()=>{const n=new yW(t.closest(t.localNodeId,DZ).map((t=>t.peer))),r=n.difference(e),i=e.difference(n);Promise.resolve().then((async()=>{for(const t of r)await this.components.peerStore.tagPeer(t,this.tagName,{value:this.tagValue});for(const t of i)await this.components.peerStore.unTagPeer(t,this.tagName)})).catch((t=>{this.log.error("Could not update peer tags",t)})),e=n}));t.on("added",(()=>{n()})),t.on("removed",(()=>{n()}))}_onPing(t,e){this.pingQueue.add((async()=>{if(!this.running)return;let n=0;try{await Promise.all(t.map((async t=>{let e;try{e=new $o.TimeoutController(this.pingTimeout);const r={signal:e.signal};this.log("pinging old contact %p",t.peer);const i=await this.components.connectionManager.openConnection(t.peer,r),s=await i.newStream(this.protocol,r);s.close(),n++}catch(uS){this.running&&null!=this.kb&&(this.log.error("could not ping peer %p",t.peer,uS),this.log("evicting old contact after ping failed %p",t),this.kb.remove(t.id))}finally{null!=e&&e.clear(),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:xZ,value:this.size})}}))),this.running&&n<t.length&&null!=this.kb&&(this.log("adding new contact %p",e.peer),this.kb.add(e))}catch(uS){this.log.error("could not process k-bucket ping event",uS)}})).catch((t=>{this.log.error("could not process k-bucket ping event",t)}))}get size(){return null==this.kb?0:this.kb.count()}async find(t){const e=await _Z(t),n=this.closestPeer(e);if(null!=n&&t.equals(n))return n}closestPeer(t){const e=this.closestPeers(t,1);if(e.length>0)return e[0]}closestPeers(t,e=this.kBucketSize){if(null==this.kb)return[];const n=this.kb.closest(t,e);return n.map((t=>t.peer))}async add(t){if(null==this.kb)throw new Error("RoutingTable is not started");const e=await _Z(t);this.kb.add({id:e,peer:t}),this.log("added %p with kad id %b",t,e),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:xZ,value:this.size})}async remove(t){if(null==this.kb)throw new Error("RoutingTable is not started");const e=await _Z(t);this.kb.remove(e),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:xZ,value:this.size})}}var UZ=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];const FZ=15;class zZ{constructor(t){const{peerRouting:e,routingTable:n,refreshInterval:r,refreshQueryTimeout:i,lan:s}=t;this.log=zt(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table:refresh`),this.peerRouting=e,this.routingTable=n,this.refreshInterval=r??gZ,this.refreshQueryTimeout=i??mZ,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(t=!1){this.log("refreshing routing table");const e=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(e);this.log(`max common prefix length ${e}`),this.log(`tracked CPLs [ ${n.map((t=>t.toISOString())).join(", ")} ]`),Promise.all(n.map((async(r,i)=>{try{if(await this._refreshCommonPrefixLength(i,r,t),0===this._numPeersForCpl(e)){const e=Math.min(2*(i+1),n.length-1);for(let n=i+1;n<e+1;n++)try{await this._refreshCommonPrefixLength(n,r,t)}catch(uS){this.log.error(uS)}}}catch(uS){this.log.error(uS)}}))).catch((t=>{this.log.error(t)})).then((()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()})).catch((t=>{this.log.error(t)}))}async _refreshCommonPrefixLength(t,e,n){if(!n&&e.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",t);const r=await this._generateRandomPeerId(t);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",t,r,this.routingTable.size);const i=new $o.TimeoutController(this.refreshQueryTimeout);try{const e=await xD(this.peerRouting.getClosestPeers(r.toBytes(),{signal:i.signal}));this.log(`found ${e} peers that were close to imaginary peer %p`,r),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",t,r,this.routingTable.size)}finally{i.clear()}}_getTrackedCommonPrefixLengthsForRefresh(t){t>FZ&&(t=FZ);const e=[];for(let n=0;n<=t;n++)e[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return e}async _generateRandomPeerId(t){if(null==this.routingTable.kb)throw new Error("Routing table not started");const e=Kd(2),n=(e[1]<<8)+e[0],r=await this._makePeerId(this.routingTable.kb.localNodeId,n,t);return Vu(r)}async _makePeerId(t,e,n){if(n>FZ)throw new Error(`Cannot generate peer ID for common prefix length greater than ${FZ}`);const r=new DataView(t.buffer,t.byteOffset,t.byteLength),i=r.getUint16(0,!1),s=i^32768>>n,o=65535<<16-(n+1),a=s&o|e&~o,c=UZ[a],l=new ArrayBuffer(34),u=new DataView(l,0,l.byteLength);return u.setUint8(0,ho.code),u.setUint8(1,32),u.setUint32(2,c,!1),new Uint8Array(u.buffer,u.byteOffset,u.byteLength)}_maxCommonPrefix(){let t=0;for(const e of this._prefixLengths())e>t&&(t=e);return t}_numPeersForCpl(t){let e=0;for(const n of this._prefixLengths())n===t&&e++;return e}*_prefixLengths(){if(null!=this.routingTable.kb)for(const{id:t}of this.routingTable.kb.toIterable()){const e=Mq(this.routingTable.kb.localNodeId,t);let n=0;for(const t of e){if(0!==t)break;n++}yield n}}}var VZ,jZ;(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),null!=t.key&&(e.uint32(10),e.bytes(t.key)),null!=t.value&&(e.uint32(18),e.bytes(t.value)),null!=t.author&&(e.uint32(26),e.bytes(t.author)),null!=t.signature&&(e.uint32(34),e.bytes(t.signature)),null!=t.timeReceived&&(e.uint32(42),e.string(t.timeReceived)),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.key=t.bytes();break;case 2:n.value=t.bytes();break;case 3:n.author=t.bytes();break;case 4:n.signature=t.bytes();break;case 5:n.timeReceived=t.string();break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(VZ||(VZ={})),function(t){let e,n,r,i,s,o;(function(t){t["PUT_VALUE"]="PUT_VALUE",t["GET_VALUE"]="GET_VALUE",t["ADD_PROVIDER"]="ADD_PROVIDER",t["GET_PROVIDERS"]="GET_PROVIDERS",t["FIND_NODE"]="FIND_NODE",t["PING"]="PING"})(e=t.MessageType||(t.MessageType={})),function(t){t[t["PUT_VALUE"]=0]="PUT_VALUE",t[t["GET_VALUE"]=1]="GET_VALUE",t[t["ADD_PROVIDER"]=2]="ADD_PROVIDER",t[t["GET_PROVIDERS"]=3]="GET_PROVIDERS",t[t["FIND_NODE"]=4]="FIND_NODE",t[t["PING"]=5]="PING"}(n||(n={})),function(t){t.codec=()=>Th(n)}(e=t.MessageType||(t.MessageType={})),function(t){t["NOT_CONNECTED"]="NOT_CONNECTED",t["CONNECTED"]="CONNECTED",t["CAN_CONNECT"]="CAN_CONNECT",t["CANNOT_CONNECT"]="CANNOT_CONNECT"}(r=t.ConnectionType||(t.ConnectionType={})),function(t){t[t["NOT_CONNECTED"]=0]="NOT_CONNECTED",t[t["CONNECTED"]=1]="CONNECTED",t[t["CAN_CONNECT"]=2]="CAN_CONNECT",t[t["CANNOT_CONNECT"]=3]="CANNOT_CONNECT"}(i||(i={})),function(t){t.codec=()=>Th(i)}(r=t.ConnectionType||(t.ConnectionType={})),function(e){let n;e.codec=()=>(null==n&&(n=kh(((e,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),null!=e.id&&(n.uint32(10),n.bytes(e.id)),null==e.addrs)throw new Error('Protocol error: required field "addrs" was not found in object');for(const t of e.addrs)n.uint32(18),n.bytes(t);null!=e.connection&&(n.uint32(24),t.ConnectionType.codec().encode(e.connection,n)),!1!==r.lengthDelimited&&n.ldelim()}),((e,n)=>{const r={addrs:[]},i=null==n?e.len:e.pos+n;while(e.pos<i){const n=e.uint32();switch(n>>>3){case 1:r.id=e.bytes();break;case 2:r.addrs.push(e.bytes());break;case 3:r.connection=t.ConnectionType.codec().decode(e);break;default:e.skipType(7&n);break}}return r}))),n),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(s=t.Peer||(t.Peer={})),t.codec=()=>(null==o&&(o=kh(((e,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),null!=e.type&&(n.uint32(8),t.MessageType.codec().encode(e.type,n)),null!=e.clusterLevelRaw&&(n.uint32(80),n.int32(e.clusterLevelRaw)),null!=e.key&&(n.uint32(18),n.bytes(e.key)),null!=e.record&&(n.uint32(26),n.bytes(e.record)),null==e.closerPeers)throw new Error('Protocol error: required field "closerPeers" was not found in object');for(const i of e.closerPeers)n.uint32(66),t.Peer.codec().encode(i,n);if(null==e.providerPeers)throw new Error('Protocol error: required field "providerPeers" was not found in object');for(const i of e.providerPeers)n.uint32(74),t.Peer.codec().encode(i,n);!1!==r.lengthDelimited&&n.ldelim()}),((e,n)=>{const r={closerPeers:[],providerPeers:[]},i=null==n?e.len:e.pos+n;while(e.pos<i){const n=e.uint32();switch(n>>>3){case 1:r.type=t.MessageType.codec().decode(e);break;case 10:r.clusterLevelRaw=e.int32();break;case 2:r.key=e.bytes();break;case 3:r.record=e.bytes();break;case 8:r.closerPeers.push(t.Peer.codec().decode(e,e.uint32()));break;case 9:r.providerPeers.push(t.Peer.codec().decode(e,e.uint32()));break;default:e.skipType(7&n);break}}return r}))),o),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(jZ||(jZ={}));const HZ=jZ.MessageType,$Z=jZ.ConnectionType,KZ=Object.keys(HZ);class GZ{constructor(t,e,n){if(!(e instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=t,this.key=e,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){const t=this.clusterLevelRaw-1;return t<0?0:t}set clusterLevel(t){this.clusterLevelRaw=t}serialize(){return jZ.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(qZ),providerPeers:this.providerPeers.map(qZ),record:null==this.record?void 0:this.record.serialize().subarray()})}static deserialize(t){const e=jZ.decode(t),n=new GZ(e.type??jZ.MessageType.PUT_VALUE,e.key??Uint8Array.from([]),e.clusterLevelRaw??0);return n.closerPeers=e.closerPeers.map(WZ),n.providerPeers=e.providerPeers.map(WZ),null!=e.record?.length&&(n.record=Om.deserialize(e.record)),n}}function qZ(t){const e={id:t.id.toBytes(),addrs:(t.multiaddrs??[]).map((t=>t.bytes)),connection:$Z.CONNECTED};return e}function WZ(t){if(null==t.id)throw new Error("Invalid peer in message");return{id:Vu(t.id),multiaddrs:(t.addrs??[]).map((t=>dc(t))),protocols:[]}}function YZ(t){return{...t,name:"SENDING_QUERY",type:0,messageName:t.type,messageType:KZ.indexOf(t.type.toString())}}function XZ(t){return{...t,name:"PEER_RESPONSE",type:1,messageName:t.messageType,closer:null!=t.closer?t.closer:[],providers:null!=t.providers?t.providers:[]}}function QZ(t){return{...t,name:"FINAL_PEER",type:2}}function JZ(t){return{...t,name:"QUERY_ERROR",type:3}}function ZZ(t){return{...t,name:"PROVIDER",type:4}}function t1(t){return{...t,name:"VALUE",type:5}}function e1(t){return{...t,name:"DIALING_PEER",type:7}}class n1 extends gM{constructor(t,e){super();const{protocol:n,lan:r}=e;this.components=t,this.log=zt(`libp2p:kad-dht:${r?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,e,n={}){if(!this.running)return;let r;this.log("sending %s to %p",e.type,t),yield e1({peer:t}),yield YZ({to:t,type:e.type});try{const r=await this.components.connectionManager.openConnection(t,n),i=await r.newStream(this.protocol,n),s=await this._writeReadMessage(i,e.serialize(),n);yield XZ({from:t,messageType:s.type,closer:s.closerPeers,providers:s.providerPeers,record:s.record})}catch(uS){yield JZ({from:t,error:uS})}finally{null!=r&&r.close()}}async*sendMessage(t,e,n={}){if(!this.running)return;let r;this.log("sending %s to %p",e.type,t),yield e1({peer:t}),yield YZ({to:t,type:e.type});try{const r=await this.components.connectionManager.openConnection(t,n),i=await r.newStream(this.protocol,n);await this._writeMessage(i,e.serialize(),n),yield XZ({from:t,messageType:e.type})}catch(uS){yield JZ({from:t,error:uS})}finally{null!=r&&r.close()}}async _writeMessage(t,e,n){null!=n.signal&&(t=tV(t,n.signal)),await vm([e],rV(),t,Zg)}async _writeReadMessage(t,e,n){null!=n.signal&&(t=tV(t,n.signal));const r=await vm([e],rV(),t,cV(),(async t=>{const e=await rk(t);if(null!=e)return e;throw Vt(new Error("No message received"),"ERR_NO_MESSAGE_RECEIVED")})),i=GZ.deserialize(r);return i.closerPeers.forEach((t=>{this.dispatchEvent(new yM("peer",{detail:t}))})),i.providerPeers.forEach((t=>{this.dispatchEvent(new yM("peer",{detail:t}))})),i}}function r1(t,e){const n=e.key,r=sa(n),i=r.split("/");if(i.length<3)return;const s=t[i[1].toString()];if(null==s){const t="Invalid record keytype";throw Vt(new Error(t),"ERR_INVALID_RECORD_KEY_TYPE")}return s(n,e.value)}const i1=async(t,e)=>{if(!(t instanceof Uint8Array))throw Vt(new Error('"key" must be a Uint8Array'),"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(t.byteLength<5)throw Vt(new Error("invalid public key record"),"ERR_INVALID_RECORD_KEY_TOO_SHORT");const n=sa(t.subarray(0,4));if("/pk/"!==n)throw Vt(new Error("key was not prefixed with /pk/"),"ERR_INVALID_RECORD_KEY_BAD_PREFIX");const r=t.slice(4),i=await ho.digest(e);if(!Xa(r,i.bytes))throw Vt(new Error("public key does not match passed in key"),"ERR_INVALID_RECORD_HASH_MISMATCH")},s1={pk:i1};function o1(t,e,n){if(0===n.length){const t="No records given";throw Vt(new Error(t),"ERR_NO_RECORDS_RECEIVED")}const r=sa(e),i=r.split("/");if(i.length<3){const t="Record key does not have a selector function";throw Vt(new Error(t),"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const s=t[i[1].toString()];if(null==s){const t=`Unrecognized key prefix: ${i[1]}`;throw Vt(new Error(t),"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===n.length?0:s(e,n)}function a1(t,e){return 0}const c1={pk:a1};class l1{constructor(t,e){const{validators:n,selectors:r,peerRouting:i,queryManager:s,routingTable:o,network:a,lan:c}=e;this.components=t,this.log=zt(`libp2p:kad-dht:${c?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=r,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.network=a}async putLocal(t,e){const n=SZ(t);await this.components.datastore.put(n,e)}async getLocal(t){this.log("getLocal %b",t);const e=SZ(t);this.log("fetching record for key %k",e);const n=await this.components.datastore.get(e);this.log("found %k in local datastore",e);const r=Om.deserialize(n);return await r1(this.validators,r),r}async*sendCorrectionRecord(t,e,n,r={}){this.log("sendCorrection for %b",t);const i=await TZ(t,n);for(const{value:s,from:o}of e){if(Xa(s,n)){this.log("record was ok");continue}if(this.components.peerId.equals(o)){try{const e=SZ(t);this.log(`Storing corrected record for key ${e.toString()}`),await this.components.datastore.put(e,i.subarray())}catch(uS){this.log.error("Failed error correcting self",uS)}continue}let e=!1;const a=new GZ(HZ.PUT_VALUE,t,0);a.record=Om.deserialize(i);for await(const t of this.network.sendRequest(o,a,r))"PEER_RESPONSE"===t.name&&null!=t.record&&Xa(t.record.value,Om.deserialize(i).value)&&(e=!0),yield t;e||(yield JZ({from:o,error:Vt(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(t,e,n={}){this.log("put key %b value %b",t,e);const r=await TZ(t,e),i=SZ(t);this.log(`storing record for key ${i.toString()}`),await this.components.datastore.put(i,r.subarray()),yield*vm(this.peerRouting.getClosestPeers(t,{signal:n.signal}),(e=>ky(e,(e=>async()=>{if("FINAL_PEER"!==e.name)return[e];const i=[],s=new GZ(HZ.PUT_VALUE,t,0);s.record=Om.deserialize(r),this.log("send put to %p",e.peer.id);for await(const t of this.network.sendRequest(e.peer.id,s,n))i.push(t),"PEER_RESPONSE"===t.name&&(null!=t.record&&Xa(t.record.value,Om.deserialize(r).value)||i.push(JZ({from:e.peer.id,error:Vt(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})));return i}))),(t=>Ty(t,{ordered:!1,concurrency:dZ})),(async function*(t){for await(const e of t)yield*e}))}async*get(t,e={}){this.log("get %b",t);const n=[];for await(const o of this.getMany(t,e))"VALUE"===o.name&&n.push(o),yield o;if(0===n.length)return;const r=n.map((t=>t.value));let i=0;try{i=o1(this.selectors,t,r)}catch(uS){if("ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"!==uS.code)throw uS}const s=r[i];if(this.log("GetValue %b %b",t,s),null==s)throw Vt(new Error("best value was not found"),"ERR_NOT_FOUND");yield*this.sendCorrectionRecord(t,n,s,e),yield n[i]}async*getMany(t,e={}){this.log("getMany values for %b",t);try{const e=await this.getLocal(t);yield t1({value:e.value,from:this.components.peerId})}catch(uS){this.log("error getting local value for %b",t,uS)}const n=await EZ(t),r=this.routingTable.closestPeers(n);this.log("found %d peers in routing table",r.length);const i=this,s=async function*({peer:e,signal:n}){for await(const r of i.peerRouting.getValueOrPeers(e,t,{signal:n}))yield r,"PEER_RESPONSE"===r.name&&null!=r.record&&(yield t1({from:e,value:r.record.value}))};yield*this.queryManager.run(t,r,s,e)}}class u1{constructor(t,e){const{network:n,peerRouting:r,queryManager:i,routingTable:s,providers:o,lan:a}=e;this.components=t,this.log=zt(`libp2p:kad-dht:${a?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=r,this.queryManager=i,this.routingTable=s,this.providers=o}async*provide(t,e,n={}){this.log("provide %s",t),await this.providers.addProvider(t,this.components.peerId);const r=new GZ(HZ.ADD_PROVIDER,t.bytes,0);r.providerPeers=[{id:this.components.peerId,multiaddrs:e,protocols:[]}];let i=0;const s=e=>async()=>{if("FINAL_PEER"!==e.name)return[e];const s=[];this.log("putProvider %s to %p",t,e.peer.id);try{this.log("sending provider record for %s to %p",t,e.peer.id);for await(const o of this.network.sendMessage(e.peer.id,r,n))"PEER_RESPONSE"===o.name&&(this.log("sent provider record for %s to %p",t,e.peer.id),i++),s.push(o)}catch(uS){this.log.error("error sending provide record to peer %p",e.peer.id,uS),s.push(JZ({from:e.peer.id,error:uS}))}return s};yield*vm(this.peerRouting.getClosestPeers(t.multihash.bytes,n),(t=>ky(t,(t=>s(t)))),(t=>Ty(t,{ordered:!1,concurrency:dZ})),(async function*(t){for await(const e of t)yield*e})),this.log("sent provider records to %d peers",i)}async*findProviders(t,e){const n=this.routingTable.kBucketSize,r=t.multihash.bytes,i=await EZ(r),s=this;this.log("findProviders %c",t);const o=await this.providers.getProviders(t);if(o.length>0){const t=[];for(const e of o.slice(0,n))t.push({id:e,multiaddrs:(await this.components.peerStore.addressBook.get(e)??[]).map((t=>t.multiaddr)),protocols:[]});yield XZ({from:this.components.peerId,messageType:HZ.GET_PROVIDERS,providers:t}),yield ZZ({from:this.components.peerId,providers:t})}if(o.length>=n)return;const a=async function*({peer:t,signal:e}){const n=new GZ(HZ.GET_PROVIDERS,r,0);yield*s.network.sendRequest(t,n,{signal:e})},c=new Set(o.map((t=>t.toString())));for await(const l of this.queryManager.run(r,this.routingTable.closestPeers(i),a,e))if(yield l,"PEER_RESPONSE"===l.name){this.log("Found %d provider entries for %c and %d closer peers",l.providers.length,t,l.closer.length);const e=[];for(const t of l.providers)c.has(t.id.toString())||(c.add(t.id.toString()),e.push(t));if(e.length>0&&(yield ZZ({from:l.from,providers:e})),c.size===n)return}}}class h1{constructor(t,e){this.originDhtKey=t,this.capacity=e,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map((t=>t.peerId))}async add(t){if(null!=this.peerDistances.find((e=>e.peerId.equals(t))))return;const e=await _Z(t),n={peerId:t,distance:Mq(this.originDhtKey,e)};this.peerDistances.push(n),this.peerDistances.sort(((t,e)=>JD(t.distance,e.distance))),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(t){if(0===t.length)return!1;if(0===this.length)return!0;const e=await Promise.all(t.map(_Z)),n=this.peerDistances[this.peerDistances.length-1].distance;for(const r of e){const t=Mq(this.originDhtKey,r);if(JD(t,n)<0)return!0}return!1}}class d1{constructor(t,e){const{routingTable:n,network:r,validators:i,queryManager:s,lan:o}=e;this.components=t,this.routingTable=n,this.network=r,this.validators=i,this.queryManager=s,this.log=zt(`libp2p:kad-dht:${o?"lan":"wan"}:peer-routing`)}async findPeerLocal(t){let e;const n=await this.routingTable.find(t);if(null!=n){this.log("findPeerLocal found %p in routing table",t);try{e=await this.components.peerStore.get(n)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}}if(null==e)try{e=await this.components.peerStore.get(t)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}if(null!=e)return this.log("findPeerLocal found %p in peer store",t),{id:e.id,multiaddrs:e.addresses.map((t=>t.multiaddr)),protocols:[]}}async*_getValueSingle(t,e,n={}){const r=new GZ(HZ.GET_VALUE,e,0);yield*this.network.sendRequest(t,r,n)}async*getPublicKeyFromNode(t,e={}){const n=AZ(t);for await(const r of this._getValueSingle(t,n,e))if(yield r,"PEER_RESPONSE"===r.name&&null!=r.record){const e=await Hu(Wp({bytes:r.record.value}));if(!e.equals(t))throw Vt(new Error("public key does not match id"),"ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(null==e.publicKey)throw Vt(new Error("public key missing"),"ERR_PUBLIC_KEY_MISSING");yield t1({from:t,value:e.publicKey})}throw Vt(new Error(`Node not responding with its public key: ${t.toString()}`),"ERR_INVALID_RECORD")}async*findPeer(t,e={}){this.log("findPeer %p",t);const n=await this.findPeerLocal(t);if(null!=n)return this.log("found local"),void(yield QZ({from:this.components.peerId,peer:n}));const r=await _Z(t),i=this.routingTable.closestPeers(r),s=i.find((e=>e.equals(t)));if(null!=s)try{const e=await this.components.peerStore.get(t);return this.log("found in peerStore"),void(yield QZ({from:this.components.peerId,peer:{id:e.id,multiaddrs:e.addresses.map((t=>t.multiaddr)),protocols:[]}}))}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}const o=this,a=async function*({peer:e,signal:n}){const r=new GZ(HZ.FIND_NODE,t.toBytes(),0);for await(const i of o.network.sendRequest(e,r,{signal:n}))if(yield i,"PEER_RESPONSE"===i.name){const e=i.closer.find((e=>e.id.equals(t)));null!=e&&(yield QZ({from:i.from,peer:e}))}};let c=!1;for await(const l of this.queryManager.run(t.toBytes(),i,a,e))"FINAL_PEER"===l.name&&(c=!0),yield l;c||(yield JZ({from:this.components.peerId,error:Vt(new Error("Not found"),"ERR_NOT_FOUND")}))}async*getClosestPeers(t,e={}){this.log("getClosestPeers to %b",t);const n=await EZ(t),r=this.routingTable.closestPeers(n),i=this,s=new h1(n,this.routingTable.kBucketSize);await Promise.all(r.map((async t=>await s.add(t))));const o=async function*({peer:e,signal:n}){i.log("closerPeersSingle %s from %p",sa(t,"base32"),e);const r=new GZ(HZ.FIND_NODE,t,0);yield*i.network.sendRequest(e,r,{signal:n})};for await(const a of this.queryManager.run(t,r,o,e))yield a,"PEER_RESPONSE"===a.name&&await Promise.all(a.closer.map((async t=>await s.add(t.id))));this.log("found %d peers close to %b",s.length,t);for(const a of s.peers)yield QZ({from:this.components.peerId,peer:{id:a,multiaddrs:(await this.components.peerStore.addressBook.get(a)??[]).map((t=>t.multiaddr)),protocols:[]}})}async*getValueOrPeers(t,e,n={}){for await(const r of this._getValueSingle(t,e,n)){if("PEER_RESPONSE"===r.name&&null!=r.record)try{await this._verifyRecordOnline(r.record)}catch(uS){const e="invalid record received, discarded";this.log(e),yield JZ({from:r.from,error:Vt(new Error(e),"ERR_INVALID_RECORD")});continue}yield r}}async _verifyRecordOnline(t){if(null==t.timeReceived)throw Vt(new Error("invalid record received"),"ERR_INVALID_RECORD");await r1(this.validators,new Om(t.key,t.value,t.timeReceived))}async getCloserPeersOffline(t,e){const n=await EZ(t),r=this.routingTable.closestPeers(n),i=[];for(const s of r)if(!s.equals(e))try{const t=await this.components.peerStore.addressBook.get(s),e=await this.components.peerStore.protoBook.get(s);i.push({id:s,multiaddrs:t.map((t=>t.multiaddr)),protocols:e})}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}return i.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",i.length,t,e):this.log("getCloserPeersOffline could not find peer closer to %b than %p",t,e),i}}const f1=zt("libp2p:kad-dht:providers");class p1{constructor(t,e={}){const{cacheSize:n,cleanupInterval:r,provideValidity:i}=e;this.components=t,this.cleanupInterval=r??uZ,this.provideValidity=i??lZ,this.cache=Rl(n??cZ),this.syncQueue=new yu({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval((()=>{this._cleanup().catch((t=>{f1.error(t)}))}),this.cleanupInterval))}async stop(){this.started=!1,null!=this.cleaner&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){return await this.syncQueue.add((async()=>{const t=Date.now();let e=0,n=0;const r=new Map,i=this.components.datastore.batch(),s=this.components.datastore.query({prefix:aZ});for await(const o of s)try{const{cid:t,peerId:s}=y1(o.key),a=b1(o.value).getTime(),c=Date.now(),l=c-a,u=l>this.provideValidity;if(f1("comparing: %d - %d = %d > %d %s",c,a,l,this.provideValidity,u?"(expired)":""),u){n++,i.delete(o.key);const e=r.get(t)??new Set;e.add(s),r.set(t,e)}e++}catch(uS){f1.error(uS.message)}r.size>0?(f1("deleting %d / %d entries",n,e),await i.commit()):f1("nothing to delete");for(const[o,a]of r){const t=g1(o),e=this.cache.get(t);if(null!=e){for(const t of a)e.delete(t);0===e.size?this.cache.remove(t):this.cache.set(t,e)}}f1("Cleanup successful (%dms)",Date.now()-t)}))}async _getProvidersMap(t){const e=g1(t);let n=this.cache.get(e);return null==n&&(n=await w1(this.components.datastore,t),this.cache.set(e,n)),n}async addProvider(t,e){return await this.syncQueue.add((async()=>{f1("%p provides %s",e,t);const n=await this._getProvidersMap(t);f1("loaded %s provs",n.size);const r=new Date;n.set(e.toString(),r);const i=g1(t);this.cache.set(i,n),await m1(this.components.datastore,t,e,r)}))}async getProviders(t){return await this.syncQueue.add((async()=>{f1("get providers for %s",t);const e=await this._getProvidersMap(t);return[...e.keys()].map((t=>zu(t)))}))}}function g1(t){const e="string"===typeof t?t:sa(t.multihash.bytes,"base32");return`${aZ}/${e}`}async function m1(t,e,n,r){const i=[g1(e),"/",n.toString()].join(""),s=new rl(i),o=Uint8Array.from(ma.encode(r.getTime()));return await t.put(s,o)}function y1(t){const e=t.toString().split("/");if(5!==e.length)throw new Error(`incorrectly formatted provider entry key in datastore: ${t.toString()}`);return{cid:e[3],peerId:e[4]}}async function w1(t,e){const n=new Map,r=t.query({prefix:g1(e)});for await(const i of r){const{peerId:t}=y1(i.key);n.set(t,b1(i.value))}return n}function b1(t){return new Date(ma.decode(t))}const v1=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*E1(t){const{key:e,startingPeer:n,ourPeerId:r,signal:i,query:s,alpha:o,pathIndex:a,numPaths:c,cleanUp:l,queryFuncTimeout:u,log:h,peersSeen:d}=t,f=new yu({concurrency:o}),p=await EZ(e);function g(t,n){if(null==t)return;d.add(t);const o=BigInt("0x"+sa(Mq(n,p),"base16"));f.add((async()=>{let n;const l=[i];null!=u&&(n=new $o.TimeoutController(u),l.push(n.signal));const m=(0,al.anySignal)(l);try{for await(const n of s({key:e,peer:t,signal:m,pathIndex:a,numPaths:c})){if(m.aborted)return;if("PEER_RESPONSE"===n.name)for(const i of n.closer){if(d.has(i.id)){h("already seen %p in query",i.id);continue}if(r.equals(i.id)){h("not querying ourselves");continue}const n=await _Z(i.id),s=BigInt("0x"+sa(Mq(n,p),"base16"));s>o?h("skipping %p as they are not closer to %b than %p",i.id,e,t):(h("querying closer peer %p",i.id),g(i.id,n))}f.emit("completed",n)}n?.clear()}catch(uS){i.aborted?f.emit("error",uS):f.emit("completed",JZ({from:t,error:uS}))}finally{n?.clear()}}),{priority:v1-o}).catch((t=>{h.error(t)}))}g(n,await _Z(n)),yield*_1(f,i,l,h)}async function*_1(t,e,n,r){let i=Cy(),s=!0;const o=[],a=()=>{s&&(r("clean up queue, results %d, queue size %d, pending tasks %d",o.length,t.size,t.pending),s=!1,t.clear(),o.splice(0,o.length))};t.on("completed",(t=>{o.push(t),i.resolve()})),t.on("error",(t=>{r("queue error",t),a(),i.reject(t)})),t.on("idle",(()=>{r("queue idle"),s=!1,i.resolve()})),e.addEventListener("abort",(()=>{r("abort queue");const t=s;a(),t&&i.reject(Vt(new Error("Query aborted"),"ERR_QUERY_ABORTED"))})),n.addEventListener("cleanup",(()=>{a(),i.resolve()}));while(s){await i.promise,i=Cy();while(o.length>0){const t=o.shift();null!=t&&(yield t)}}yield*o}const S1="running-queries";class A1{constructor(t,e){const{lan:n=!1,disjointPaths:r=hZ,alpha:i=dZ}=e;this.components=t,this.disjointPaths=r??hZ,this.controllers=new Set,this.running=!1,this.alpha=i??dZ,this.lan=n,this.queries=0}isStarted(){return this.running}async start(){this.running=!0}async stop(){this.running=!1;for(const t of this.controllers)t.abort();this.controllers.clear()}async*run(t,e,n,r={}){if(!this.running)throw new Error("QueryManager not started");let i;if(null==r.signal){i=new $o.TimeoutController(yZ),r.signal=i.signal;try{null!=Jq.setMaxListeners&&(0,Jq.setMaxListeners)(1/0,i.signal)}catch{}}const s=new AbortController;this.controllers.add(s);const o=[s.signal];null!=r.signal&&o.push(r.signal);const a=(0,al.anySignal)(o);try{null!=Jq.setMaxListeners&&(0,Jq.setMaxListeners)(1/0,a)}catch{}const c=zt(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+sa(t,"base58btc")),l=e.slice(0,Math.min(this.disjointPaths,e.length)),u=Date.now(),h=new gM;try{if(c("query:start"),this.queries++,this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:S1,value:this.queries}),0===e.length)return void c.error("Running query with no peers");const i=new yW,s=l.map(((e,s)=>E1({key:t,startingPeer:e,ourPeerId:this.components.peerId,signal:a,query:n,pathIndex:s,numPaths:l.length,alpha:this.alpha,cleanUp:h,queryFuncTimeout:r.queryFuncTimeout,log:c,peersSeen:i})));for await(const t of gm(...s))yield t,"QUERY_ERROR"===t.name&&c("error",t.error)}catch(uS){if(this.running||"ERR_QUERY_ABORTED"!==uS.code)throw uS}finally{this.controllers.delete(s),null!=i&&i.clear(),this.queries--,this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:S1,value:this.queries}),h.dispatchEvent(new yM("cleanup")),c("query:done in %dms",Date.now()-u)}}}const C1=zt("libp2p:kad-dht:rpc:handlers:add-provider");class I1{constructor(t){const{providers:e}=t;this.providers=e}async handle(t,e){if(C1("start"),null==e.key||0===e.key.length)throw Vt(new Error("Missing key"),"ERR_MISSING_KEY");let n;try{n=Me.decode(e.key)}catch(uS){throw Vt(new Error("Invalid CID"),"ERR_INVALID_CID")}null!=e.providerPeers&&0!==e.providerPeers.length||C1.error("no providers found in message"),await Promise.all(e.providerPeers.map((async e=>{e.id.equals(t)?e.multiaddrs.length<1?C1("no valid addresses for provider %p. Ignore",t):(C1("received provider %p for %s (addrs %s)",t,n,e.multiaddrs.map((t=>t.toString()))),await this.providers.addProvider(n,e.id)):C1("invalid provider peer %p from %p",e.id,t)})))}}const T1=zt("libp2p:kad-dht:rpc:handlers:find-node");class k1{constructor(t,e){const{peerRouting:n,lan:r}=e;this.components=t,this.peerRouting=n,this.lan=Boolean(r)}async handle(t,e){T1("incoming request from %p for peers closer to %b",t,e.key);let n=[];n=Xa(this.components.peerId.toBytes(),e.key)?[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((t=>t.decapsulateCode(ga("p2p").code))),protocols:[]}]:await this.peerRouting.getCloserPeersOffline(e.key,t),n=n.map(this.lan?vZ:bZ).filter((({multiaddrs:t})=>t.length));const r=new GZ(e.type,new Uint8Array(0),e.clusterLevel);return n.length>0?r.closerPeers=n:T1("could not find any peers closer to %b than %p",e.key,t),r}}const R1=zt("libp2p:kad-dht:rpc:handlers:get-providers");class N1{constructor(t,e){const{peerRouting:n,providers:r,lan:i}=e;this.components=t,this.peerRouting=n,this.providers=r,this.lan=Boolean(i)}async handle(t,e){let n;try{n=Me.decode(e.key)}catch(uS){throw Vt(new Error("Invalid CID"),"ERR_INVALID_CID")}R1("%p asking for providers for %s",t,n);const[r,i]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(e.key,t)]),s=await this._getPeers(r),o=await this._getPeers(i.map((({id:t})=>t))),a=new GZ(e.type,e.key,e.clusterLevel);return s.length>0&&(a.providerPeers=s),o.length>0&&(a.closerPeers=o),R1("got %s providers %s closerPeers",s.length,o.length),a}async _getAddresses(t){const e=await this.components.peerStore.addressBook.get(t);return e.map((t=>t.multiaddr))}async _getPeers(t){const e=[],n=this.lan?vZ:bZ;for(const r of t){const t=n({id:r,multiaddrs:await this._getAddresses(r),protocols:[]});t.multiaddrs.length>0&&e.push(t)}return e}}const D1=zt("libp2p:kad-dht:rpc:handlers:get-value");class O1{constructor(t,e){const{peerRouting:n}=e;this.components=t,this.peerRouting=n}async handle(t,e){const n=e.key;if(D1("%p asked for key %b",t,n),null==n||0===n.length)throw Vt(new Error("Invalid key"),"ERR_INVALID_KEY");const r=new GZ(HZ.GET_VALUE,n,e.clusterLevel);if(CZ(n)){D1("is public key");const t=IZ(n);let e;try{const n=await this.components.peerStore.keyBook.get(t);if(null==n)throw Vt(new Error("No public key found in key book"),"ERR_NOT_FOUND");e=n}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}if(null!=e)return D1("returning found public key"),r.record=new Om(n,e,new Date),r}const[i,s]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(e.key,t)]);return null!=i&&(D1("had record for %b in local datastore",n),r.record=i),s.length>0&&(D1("had %s closer peers in routing table",s.length),r.closerPeers=s),r}async _checkLocalDatastore(t){D1("checkLocalDatastore looking for %b",t);const e=SZ(t);let n;try{n=await this.components.datastore.get(e)}catch(uS){if("ERR_NOT_FOUND"===uS.code)return;throw uS}const r=Om.deserialize(n);if(null==r)throw Vt(new Error("Invalid record"),"ERR_INVALID_RECORD");if(!(null==r.timeReceived||Date.now()-r.timeReceived.getTime()>nZ))return r;await this.components.datastore.delete(e)}}const P1=zt("libp2p:kad-dht:rpc:handlers:ping");class x1{async handle(t,e){return P1("ping from %p",t),e}}class M1{constructor(t,e){const{validators:n}=e;this.components=t,this.log=zt("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(t,e){const n=e.key;this.log("%p asked us to store value for key %b",t,n);const r=e.record;if(null==r){const e=`Empty record from: ${t.toString()}`;throw this.log.error(e),Vt(new Error(e),"ERR_EMPTY_RECORD")}try{await r1(this.validators,r),r.timeReceived=new Date;const t=SZ(r.key);await this.components.datastore.put(t,r.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,t)}catch(uS){this.log("did not put record for key %b into datastore %o",n,uS)}return e}}class L1{constructor(t,e){const{providers:n,peerRouting:r,validators:i,lan:s}=e;this.log=zt("libp2p:kad-dht:rpc"),this.routingTable=e.routingTable,this.handlers={[HZ.GET_VALUE]:new O1(t,{peerRouting:r}),[HZ.PUT_VALUE]:new M1(t,{validators:i}),[HZ.FIND_NODE]:new k1(t,{peerRouting:r,lan:s}),[HZ.ADD_PROVIDER]:new I1({providers:n}),[HZ.GET_PROVIDERS]:new N1(t,{peerRouting:r,providers:n,lan:s}),[HZ.PING]:new x1}}async handleMessage(t,e){try{await this.routingTable.add(t)}catch(uS){this.log.error("Failed to update the kbucket store",uS)}const n=this.handlers[e.type];if(null!=n)return await n.handle(t,e);this.log.error(`no handler found for message type: ${e.type}`)}onIncomingStream(t){Promise.resolve().then((async()=>{const{stream:e,connection:n}=t,r=n.remotePeer;try{await this.routingTable.add(r)}catch(uS){this.log.error(uS)}const i=this;await vm(e,cV(),(async function*(t){for await(const e of t){const t=GZ.deserialize(e);i.log("incoming %s from %p",t.type,r);const n=await i.handleMessage(r,t);null!=n&&(yield n.serialize())}}),rV(),e)})).catch((t=>{this.log.error(t)}))}}class B1 extends gM{constructor(t,e){super();const{protocol:n,lan:r}=e;this.components=t,this.log=zt("libp2p:kad-dht:topology-listener:"+(r?"lan":"wan")),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;const t=dM({onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new yM("peer",{detail:t}))}});this.registrarId=await this.components.registrar.register(this.protocol,t)}stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class U1{constructor(t,e){const{peerRouting:n,lan:r,count:i,interval:s,queryTimeout:o}=e;this.components=t,this.log=zt(`libp2p:kad-dht:${r?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=n,this.count=i??hZ,this.interval=s??fZ,this.queryTimeout=o??pZ}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}_querySelf(){Promise.resolve().then((async()=>{const t=new $o.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;const e=(0,al.anySignal)([this.controller.signal,t.signal]);try{null!=Jq.setMaxListeners&&(0,Jq.setMaxListeners)(1/0,e)}catch{}const n=await vm(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:e}),(t=>em(t,this.count)),(async t=>await xD(t)));this.log("query ran successfully - found %d peers",n)}catch(uS){this.log("query error",uS)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),t.clear()}})).catch((t=>{this.log("query error",t)}))}}const F1=32,z1=64;class V1 extends gM{constructor(t,e){super();const{kBucketSize:n,clientMode:r,validators:i,selectors:s,querySelfInterval:o,lan:a,protocolPrefix:c,pingTimeout:l,pingConcurrency:u,maxInboundStreams:h,maxOutboundStreams:d}=e;this.running=!1,this.components=t,this.lan=Boolean(a),this.log=zt("libp2p:kad-dht:"+(!0===a?"lan":"wan")),this.protocol=`${c??iZ}${!0===a?rZ:""}${sZ}`,this.kBucketSize=n??20,this.clientMode=r??!0,this.maxInboundStreams=h??F1,this.maxOutboundStreams=d??z1,this.routingTable=new BZ(t,{kBucketSize:n,lan:this.lan,pingTimeout:l,pingConcurrency:u,protocol:this.protocol}),this.providers=new p1(t),this.validators={...s1,...i},this.selectors={...c1,...s},this.network=new n1(t,{protocol:this.protocol,lan:this.lan}),this.queryManager=new A1(t,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:a}),this.peerRouting=new d1(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new l1(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new u1(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new zZ({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new L1(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new B1(t,{protocol:this.protocol,lan:this.lan}),this.querySelf=new U1(t,{peerRouting:this.peerRouting,interval:o,lan:this.lan}),this.network.addEventListener("peer",(t=>{const e=t.detail;this.onPeerConnect(e).catch((t=>{this.log.error("could not add %p to routing table",e.id,t)})),this.dispatchEvent(new yM("peer",{detail:e}))})),this.topologyListener.addEventListener("peer",(t=>{const e=t.detail;Promise.resolve().then((async()=>{const t=await this.components.peerStore.addressBook.get(e),n={id:e,multiaddrs:t.map((t=>t.multiaddr)),protocols:[]};await this.onPeerConnect(n)})).catch((t=>{this.log.error("could not add %p to routing table",e,t)}))}))}get[Uq](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(t){if(this.log("peer %p connected with protocols %s",t.id,t.protocols),t=this.lan?vZ(t):bZ(t),0!==t.multiaddrs.length)try{await this.routingTable.add(t.id)}catch(uS){this.log.error("could not add %p to routing table",t.id,uS)}else this.log("ignoring %p as they do not have any %s addresses in %s",t.id,this.lan?"private":"public",t.multiaddrs.map((t=>t.toString())))}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(t){await this.components.registrar.unhandle(this.protocol),"client"===t?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(t,e,n={}){yield*this.contentFetching.put(t,e,n)}async*get(t,e={}){yield*this.contentFetching.get(t,e)}async*provide(t,e={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),e)}async*findProviders(t,e={}){yield*this.contentRouting.findProviders(t,e)}async*findPeer(t,e={}){yield*this.peerRouting.findPeer(t,e)}async*getClosestPeers(t,e={}){yield*this.peerRouting.getClosestPeers(t,e)}async refreshRoutingTable(){await this.routingTableRefresh.refreshTable(!0)}}const j1=zt("libp2p:kad-dht");class H1 extends gM{constructor(t,e,n){super(),this.components=t,this.wan=e,this.lan=n,this.wan.addEventListener("peer",(t=>{this.dispatchEvent(new yM("peer",{detail:t.detail}))})),this.lan.addEventListener("peer",(t=>{this.dispatchEvent(new yM("peer",{detail:t.detail}))}))}get[Uq](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(t){await this.wan.setMode(t)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(t,e,n={}){for await(const r of gm(this.lan.put(t,e,n),this.wan.put(t,e,n)))yield r}async*get(t,e={}){let n=!1,r=!1;for await(const i of gm(this.lan.get(t,e),this.wan.get(t,e)))yield i,"DIALING_PEER"===i.name&&(n=!0),"VALUE"===i.name&&(n=!0,null!=i.value&&(r=!0)),"SENDING_QUERY"===i.name&&(n=!0);if(!n)throw Vt(new Error("No peers found in routing table!"),"ERR_NO_PEERS_IN_ROUTING_TABLE");r||(yield JZ({from:this.components.peerId,error:Vt(new Error("Not found"),"ERR_NOT_FOUND")}))}async*provide(t,e={}){let n=0,r=0;const i=[],s=[this.lan];"server"===await this.wan.getMode()&&s.push(this.wan);for await(const o of gm(...s.map((n=>n.provide(t,e)))))yield o,"SENDING_QUERY"===o.name&&n++,"QUERY_ERROR"===o.name&&i.push(o.error),"PEER_RESPONSE"===o.name&&"ADD_PROVIDER"===o.messageName&&(j1("sent provider record for %s to %p",t,o.from),r++);if(0===r){if(i.length>0)throw Vt(new Error(`Failed to provide to ${i.length} of ${n} peers`),"ERR_PROVIDES_FAILED",{errors:i});throw Vt(new Error("Failed to provide - no peers found"),"ERR_PROVIDES_FAILED")}}async*findProviders(t,e={}){yield*gm(this.lan.findProviders(t,e),this.wan.findProviders(t,e))}async*findPeer(t,e={}){let n=!1;for await(const r of gm(this.lan.findPeer(t,e),this.wan.findPeer(t,e)))yield r,"SENDING_QUERY"!==r.name&&"FINAL_PEER"!==r.name||(n=!0);if(!n)throw Vt(new Error("Peer lookup failed"),"ERR_LOOKUP_FAILED")}async*getClosestPeers(t,e={}){yield*gm(this.lan.getClosestPeers(t,e),this.wan.getClosestPeers(t,e))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}}class $1 extends H1{constructor(t,e){super(t,new V1(t,{protocolPrefix:"/ipfs",...e,lan:!1}),new V1(t,{protocolPrefix:"/ipfs",...e,clientMode:!1,lan:!0}))}}function K1(t){return e=>new $1(e,t)}const G1=zt("libp2p:bootstrap"),q1="bootstrap",W1=50,Y1=12e4,X1=1e3;class Q1 extends gM{constructor(t,e={list:[]}){if(null==e.list||0===e.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=t,this.timeout=e.timeout??X1,this.list=[];for(const n of e.list){if(!Pc.matches(n)){G1.error("Invalid multiaddr");continue}const t=dc(n),e=t.getPeerId();if(null==e){G1.error("Invalid bootstrap multiaddr without peer id");continue}const r={id:zu(e),multiaddrs:[t],protocols:[]};this.list.push(r)}this._init=e}get[Uq](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(G1("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((t=>{G1.error(t)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const t of this.list){if(await this.components.peerStore.tagPeer(t.id,this._init.tagName??q1,{value:this._init.tagValue??W1,ttl:this._init.tagTTL??Y1}),null==this.timer)return;this.dispatchEvent(new yM("peer",{detail:t}))}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function J1(t){return e=>new Q1(e,t)}Q1.tag="bootstrap";var Z1=WebSocket,t0=n(409);function e0(t){return t instanceof ArrayBuffer||"ArrayBuffer"===t?.constructor?.name&&"number"===typeof t?.byteLength}var n0=t=>{t.binaryType="arraybuffer";const e=async()=>await new Promise(((e,n)=>{if(i)return e();if(null!=r)return n(r);const s=e=>{t.removeEventListener("open",o),t.removeEventListener("error",a),e()},o=()=>s(e),a=e=>{s((()=>n(e.error??new Error(`connect ECONNREFUSED ${t.url}`))))};t.addEventListener("open",o),t.addEventListener("error",a)})),n=async function*(){const n=new t0.zN((({push:e,stop:n,fail:r})=>{const i=t=>{let n=null;"string"===typeof t.data&&(n=Ho(t.data)),e0(t.data)&&(n=new Uint8Array(t.data)),t.data instanceof Uint8Array&&(n=t.data),null!=n&&e(n)},s=t=>r(t.error??new Error("Socket error"));return t.addEventListener("message",i),t.addEventListener("error",s),t.addEventListener("close",n),()=>{t.removeEventListener("message",i),t.removeEventListener("error",s),t.removeEventListener("close",n)}}),{highWaterMark:1/0});await e();for await(const t of n)yield e0(t)?new Uint8Array(t):t}();let r,i=1===t.readyState;return t.addEventListener("open",(()=>{i=!0,r=null})),t.addEventListener("close",(()=>{i=!1,r=null})),t.addEventListener("error",(e=>{i||(r=e.error??new Error(`connect ECONNREFUSED ${t.url}`))})),Object.assign(n,{connected:e})},r0=t=>{if(t.readyState>=2)throw new Error("socket closed");if(1!==t.readyState)return new Promise(((e,n)=>{function r(){t.removeEventListener("open",i),t.removeEventListener("error",s)}function i(){r(),e()}function s(e){r(),n(e.error??new Error(`connect ECONNREFUSED ${t.url}`))}t.addEventListener("open",i),t.addEventListener("error",s)}))},i0=(t,e)=>{e=e??{},e.closeOnEnd=!1!==e.closeOnEnd;const n=async n=>{for await(const e of n){try{await r0(t)}catch(uS){if("socket closed"===uS.message)break;throw uS}t.send(e)}if(null!=e.closeOnEnd&&t.readyState<=1)return await new Promise(((e,n)=>{t.addEventListener("close",(t=>{if(t.wasClean||1006===t.code)e();else{const e=Object.assign(new Error("ws error"),{event:t});n(e)}})),setTimeout((()=>t.close()))}))};return n},s0=(t,e)=>{e=e??{};const n=n0(t);let r=e.remoteAddress,i=e.remotePort;if(null!=t.url)try{const e=new URL(t.url);r=e.hostname,i=parseInt(e.port,10)}catch{}if(null==r||null==i)throw new Error("Remote connection did not have address and/or port");const s={sink:i0(t,e),source:n,connected:async()=>await n.connected(),close:async()=>{t.readyState!==t.CONNECTING&&t.readyState!==t.OPEN||await new Promise((e=>{t.addEventListener("close",(()=>{e()})),t.close()}))},destroy:()=>{null!=t.terminate?t.terminate():t.close()},remoteAddress:r,remotePort:i,socket:t};return s};const o0={http:"ws",https:"wss"},a0="ws";var c0=(t,e)=>(0,Fc.relative)(t,e,o0,a0);function l0(t,e){const n="undefined"===typeof window?"":window.location;e=e??{};const r=c0(t,n.toString()),i=new Z1(r,e.websocket);return s0(i,e)}function u0(){throw new Error("WebSocket Servers can not be created in the browser!")}const h0=421,d0=290,f0=6,p0=478,g0=2e3,m0=zt("libp2p:websockets:socket");function y0(t,e,n){n=n??{};const r={async sink(e){null!=n?.signal&&(e=Jz(e,n.signal));try{await t.sink(e)}catch(uS){"aborted"!==uS.type&&m0.error(uS)}},source:null!=n.signal?Jz(t.source,n.signal):t.source,remoteAddr:e,timeline:{open:Date.now()},async close(){const e=Date.now();try{await xk(t.close(),{milliseconds:g0})}catch(uS){const{host:i,port:s}=r.remoteAddr.toOptions();m0("timeout closing stream to %s:%s after %dms, destroying it manually",i,s,Date.now()-e),t.destroy()}finally{r.timeline.close=Date.now()}}};return t.socket.addEventListener("close",(()=>{null==r.timeline.close&&(r.timeline.close=Date.now())}),{once:!0}),r}function w0(t){return t.filter((t=>{if(t.protoCodes().includes(d0))return!1;const e=t.decapsulateCode(h0);return _c.matches(e)||Sc.matches(e)}))}function b0(t){return t.filter((t=>{if(t.protoCodes().includes(d0))return!1;const e=t.decapsulateCode(h0);return Sc.matches(e)&&mc.matches(e.decapsulateCode(f0).decapsulateCode(p0))}))}const v0=zt("libp2p:websockets");class E0{constructor(t){this.init=t}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[Lq](){return!0}async dial(t,e){v0("dialing %s",t),e=e??{};const n=await this._connect(t,e),r=y0(n,t);v0("new outbound connection %s",r.remoteAddr);const i=await e.upgrader.upgradeOutbound(r);return v0("outbound connection %s upgraded",r.remoteAddr),i}async _connect(t,e){if(!0===e?.signal?.aborted)throw new FJ;const n=t.toOptions();v0("dialing %s:%s",n.host,n.port);const r=Cy(),i=t=>{v0.error("connection error:",t),r.reject(t)},s=l0(vk(t),this.init);if(null!=s.socket.on?s.socket.on("error",i):s.socket.onerror=i,null==e.signal)return await Promise.race([s.connected(),r.promise]),v0("connected %s",t),s;let o;const a=new Promise(((t,n)=>{if(o=()=>{n(new FJ),s.close().catch((t=>{v0.error("error closing raw socket",t)}))},!0===e?.signal?.aborted)return o();e?.signal?.addEventListener("abort",o)}));try{await Promise.race([a,r.promise,s.connected()])}finally{null!=o&&e?.signal?.removeEventListener("abort",o)}return v0("connected %s",t),s}createListener(t){return u0({...this.init,...t})}filter(t){return t=Array.isArray(t)?t:[t],null!=this.init?.filter?this.init?.filter(t):NQ||xQ?b0(t):w0(t)}}function _0(t={}){return()=>new E0(t)}function S0(t){return new Uint8Array(t)}var A0;(function(t){t[t["NEW_STREAM"]=0]="NEW_STREAM",t[t["MESSAGE_RECEIVER"]=1]="MESSAGE_RECEIVER",t[t["MESSAGE_INITIATOR"]=2]="MESSAGE_INITIATOR",t[t["CLOSE_RECEIVER"]=3]="CLOSE_RECEIVER",t[t["CLOSE_INITIATOR"]=4]="CLOSE_INITIATOR",t[t["RESET_RECEIVER"]=5]="RESET_RECEIVER",t[t["RESET_INITIATOR"]=6]="RESET_INITIATOR"})(A0||(A0={}));const C0=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),I0=Object.freeze({NEW_STREAM:A0.NEW_STREAM,MESSAGE:A0.MESSAGE_INITIATOR,CLOSE:A0.CLOSE_INITIATOR,RESET:A0.RESET_INITIATOR}),T0=Object.freeze({MESSAGE:A0.MESSAGE_RECEIVER,CLOSE:A0.CLOSE_RECEIVER,RESET:A0.RESET_RECEIVER}),k0=1048576,R0=(t,e)=>e.append(t);async function*N0(t,e={}){let n=new Cw,r=!1,i=Cy(),s=Number(e.size??k0);(isNaN(s)||0===s||s<0)&&(s=k0);const o=e.yieldAfter??0,a=e.serialize??R0;Promise.resolve().then((async()=>{try{let e;for await(const r of t)a(r,n),n.byteLength>=s?(clearTimeout(e),i.resolve()):e=setTimeout((()=>{i.resolve()}),o);clearTimeout(e),i.resolve()}catch(uS){i.reject(uS)}finally{r=!0}}));while(!r)if(await i.promise,i=Cy(),n.byteLength>0){const t=n;n=new Cw,yield t.subarray()}}var D0=N0;const O0=10240;class P0{constructor(){this._pool=S0(O0),this._poolOffset=0}write(t,e){const n=this._pool;let r=this._poolOffset;ma.encode(t.id<<3|t.type,n,r),r+=ma.encode.bytes??0,t.type!==A0.NEW_STREAM&&t.type!==A0.MESSAGE_INITIATOR&&t.type!==A0.MESSAGE_RECEIVER||null==t.data?ma.encode(0,n,r):ma.encode(t.data.length,n,r),r+=ma.encode.bytes??0;const i=n.subarray(this._poolOffset,r);O0-r<100?(this._pool=S0(O0),this._poolOffset=0):this._poolOffset=r,e.append(i),t.type!==A0.NEW_STREAM&&t.type!==A0.MESSAGE_INITIATOR&&t.type!==A0.MESSAGE_RECEIVER||null==t.data||e.append(t.data)}}const x0=new P0;async function*M0(t,e=0){if(null!=e&&0!==e)yield*D0(t,{size:e,serialize:(t,e)=>{for(const n of t)x0.write(n,e)}});else for await(const n of t){const t=new Cw;for(const e of n)x0.write(e,t);yield t.subarray()}}const L0=1<<20,B0=4<<20;class U0{constructor(t=L0,e=B0){this._buffer=new Cw,this._headerInfo=null,this._maxMessageSize=t,this._maxUnprocessedMessageQueueSize=e}write(t){if(null==t||0===t.length)return[];if(this._buffer.append(t),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const e=[];while(0!==this._buffer.length){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(uS){if("ERR_MSG_TOO_BIG"===uS.code)throw uS;break}const{id:t,type:n,length:r,offset:i}=this._headerInfo,s=this._buffer.length-i;if(s<r)break;const o={id:t,type:n};n!==A0.NEW_STREAM&&n!==A0.MESSAGE_INITIATOR&&n!==A0.MESSAGE_RECEIVER||(o.data=this._buffer.sublist(i,i+r)),e.push(o),this._buffer.consume(i+r),this._headerInfo=null}return e}_decodeHeader(t){const{value:e,offset:n}=V0(t),{value:r,offset:i}=V0(t,n),s=7&e;if(null==C0[s])throw new Error(`Invalid type received: ${s}`);if(r>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:e>>3,type:s,offset:n+i,length:r}}}const F0=128,z0=127;function V0(t,e=0){let n,r=0,i=0,s=e;const o=t.length;do{if(s>=o||i>49)throw e=0,new RangeError("Could not decode varint");n=t.get(s++),r+=i<28?(n&z0)<<i:(n&z0)*Math.pow(2,i),i+=7}while(n>=F0);return e=s-e,{value:r,offset:e}}const j0=zt("libp2p:mplex:stream"),H0="ERR_STREAM_RESET",$0="ERR_STREAM_ABORT",K0="ERR_SINK_ENDED",G0="ERR_DOUBLE_SINK";function q0(t){const{id:e,name:n,send:r,onEnd:i,type:s="initiator",maxMsgSize:o=L0}=t,a=new AbortController,c=new AbortController,l=new AbortController,u="initiator"===s?I0:T0,h="initiator"===s?`i${e}`:`r${e}`,d=`${null==n?e:n}`;let f,p=!1,g=!1,m=!1;const y={open:Date.now()},w=t=>{p||(p=!0,j0.trace("%s stream %s source end - err: %o",s,d,t),null!=t&&null==f&&(f=t),g&&(E.stat.timeline.close=Date.now(),null!=i&&i(f)))},b=t=>{g||(g=!0,j0.trace("%s stream %s sink end - err: %o",s,d,t),null!=t&&null==f&&(f=t),p&&(y.close=Date.now(),null!=i&&i(f)))},v=sm({onEnd:w}),E={close:()=>{j0.trace("%s stream %s close",s,d),E.closeRead(),E.closeWrite()},closeRead:()=>{j0.trace("%s stream %s closeRead",s,d),p||v.end()},closeWrite:()=>{if(j0.trace("%s stream %s closeWrite",s,d),!g){l.abort();try{r({id:e,type:u.CLOSE})}catch(uS){j0.trace("%s stream %s error sending close",s,n,uS)}b()}},abort:t=>{j0.trace("%s stream %s abort",s,d,t),v.end(t),a.abort(),b(t)},reset:()=>{const t=Vt(new Error("stream reset"),H0);c.abort(),v.end(t),b(t)},sink:async t=>{if(m)throw Vt(new Error("sink already called on stream"),G0);if(m=!0,g)throw Vt(new Error("stream closed for writing"),K0);t=Jz(t,(0,al.anySignal)([a.signal,c.signal,l.signal]));try{"initiator"===s&&r({id:e,type:I0.NEW_STREAM,data:new Cw(Ho(d))});for await(let n of t)while(n.length>0){if(n.length<=o){r({id:e,type:u.MESSAGE,data:n instanceof Uint8Array?new Cw(n):n});break}n=n instanceof Uint8Array?new Cw(n):n,r({id:e,type:u.MESSAGE,data:n.sublist(0,o)}),n.consume(o)}}catch(uS){if("aborted"===uS.type&&"The operation was aborted"===uS.message){if(l.signal.aborted)return;c.signal.aborted&&(uS.message="stream reset",uS.code=H0),a.signal.aborted&&(uS.message="stream aborted",uS.code=$0)}if(uS.code===H0)j0.trace("%s stream %s reset",s,n);else{j0.trace("%s stream %s error",s,n,uS);try{r({id:e,type:u.RESET})}catch(uS){j0.trace("%s stream %s error sending reset",s,n,uS)}}return v.end(uS),void b(uS)}try{r({id:e,type:u.CLOSE})}catch(uS){j0.trace("%s stream %s error sending close",s,n,uS)}b()},source:v,sourcePush:t=>{v.push(t)},sourceReadableLength(){return v.readableLength},stat:{direction:"initiator"===s?"outbound":"inbound",timeline:y},metadata:{},id:h};return E}const W0=zt("libp2p:mplex"),Y0=1024,X0=1024,Q0=4194304,J0=5;function Z0(t){const e={...t,type:`${C0[t.type]} (${t.type})`};return t.type===A0.NEW_STREAM&&(e.data=sa(t.data instanceof Uint8Array?t.data:t.data.subarray())),t.type!==A0.MESSAGE_INITIATOR&&t.type!==A0.MESSAGE_RECEIVER||(e.data=sa(t.data instanceof Uint8Array?t.data:t.data.subarray(),"base16")),e}class t2{constructor(t){this.protocol="/mplex/6.7.0",t=t??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=t,this.sink=this._createSink();const e=this._createSource();this._source=e,this.source=e,this.closeController=new AbortController,this.rateLimiter=new vW.RateLimiterMemory({points:t.disconnectThreshold??J0,duration:1})}get streams(){const t=[];for(const e of this._streams.initiators.values())t.push(e);for(const e of this._streams.receivers.values())t.push(e);return t}newStream(t){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const e=this._streamId++;t=null==t?e.toString():t.toString();const n=this._streams.initiators;return this._newStream({id:e,name:t,type:"initiator",registry:n})}close(t){this.closeController.signal.aborted||(null!=t?this.streams.forEach((e=>e.abort(t))):this.streams.forEach((t=>t.close())),this.closeController.abort())}_newReceiverStream(t){const{id:e,name:n}=t,r=this._streams.receivers;return this._newStream({id:e,name:n,type:"receiver",registry:r})}_newStream(t){const{id:e,name:n,type:r,registry:i}=t;if(W0("new %s stream %s",r,e),"initiator"===r&&this._streams.initiators.size===(this._init.maxOutboundStreams??X0))throw Vt(new Error("Too many outbound streams open"),"ERR_TOO_MANY_OUTBOUND_STREAMS");if(i.has(e))throw new Error(`${r} stream ${e} already exists!`);const s=t=>{W0.enabled&&W0.trace("%s stream %s send",r,e,Z0(t)),this._source.push(t)},o=()=>{W0("%s stream with id %s and protocol %s ended",r,e,a.stat.protocol),i.delete(e),null!=this._init.onStreamEnd&&this._init.onStreamEnd(a)},a=q0({id:e,name:n,send:s,type:r,onEnd:o,maxMsgSize:this._init.maxMsgSize});return i.set(e,a),a}_createSink(){const t=async t=>{const e=[this.closeController.signal];null!=this._init.signal&&e.push(this._init.signal),t=Jz(t,al(e));try{const e=new U0(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const n of t)for(const t of e.write(n))await this._handleIncoming(t);this._source.end()}catch(uS){W0("error in sink",uS),this._source.end(uS)}};return t}_createSource(){const t=t=>{this.close(t)},e=om({objectMode:!0,onEnd:t});return Object.assign(M0(e,this._init.minSendBytes),{push:e.push,end:e.end,return:e.return})}async _handleIncoming(t){const{id:e,type:n}=t;if(W0.enabled&&W0.trace("incoming message",Z0(t)),t.type===A0.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??Y0)){W0("too many inbound streams open"),this._source.push({id:e,type:A0.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return W0("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this._source.end(new Error("Too many open streams"))}return}const n=this._newReceiverStream({id:e,name:sa(t.data instanceof Uint8Array?t.data:t.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(n))}const r=1===(1&n)?this._streams.initiators:this._streams.receivers,i=r.get(e);if(null==i)return void W0("missing stream %s for message type %s",e,C0[n]);const s=this._init.maxStreamBufferSize??Q0;switch(n){case A0.MESSAGE_INITIATOR:case A0.MESSAGE_RECEIVER:if(i.sourceReadableLength()>s){this._source.push({id:t.id,type:n===A0.MESSAGE_INITIATOR?A0.RESET_RECEIVER:A0.RESET_INITIATOR});const e=Vt(new Error("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers"),"ERR_STREAM_INPUT_BUFFER_FULL");return void i.abort(e)}i.sourcePush(t.data);break;case A0.CLOSE_INITIATOR:case A0.CLOSE_RECEIVER:i.closeRead();break;case A0.RESET_INITIATOR:case A0.RESET_RECEIVER:i.reset();break;default:W0("unknown message type %s",n)}}}class e2{constructor(t={}){this.protocol="/mplex/6.7.0",this._init=t}createStreamMuxer(t={}){return new t2({...t,...this._init})}}function n2(t={}){return()=>new e2(t)}function r2(t,e={}){const n=BW(t),r=cV.fromReader(n.reader,e),i={read:async t=>{const{value:e}=await n.reader.next(t);if(null==e)throw new Error("Value is null");return e},readLP:async()=>{const{value:t}=await r.next();if(null==t)throw new Error("Value is null");return t},readPB:async t=>{const e=await i.readLP();if(null==e)throw new Error("Value is null");const n=e instanceof Uint8Array?e:e.subarray();return t.decode(n)},write:t=>{t instanceof Uint8Array?n.writer.push(t):n.writer.push(t.subarray())},writeLP:t=>{i.write(rV.single(t,e))},writePB:(t,e)=>{i.writeLP(e.encode(t))},pb:t=>({read:async()=>await i.readPB(t),write:e=>i.writePB(e,t)}),unwrap:()=>(n.rest(),n.stream)};return i}function i2(){const t=Cy();let e=!1;return{sink:async n=>{if(e)throw new Error("already piped");e=!0,t.resolve(n)},source:async function*(){const e=await t.promise;yield*e}()}}function s2(){const t=i2(),e=i2();return[{source:t.source,sink:e.sink},{source:e.source,sink:t.sink}]}const o2=65535,a2=o2-16,c2=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var l2=n(3017),u2=n(2578),h2=n(9300),d2=n(5602);const f2={hashSHA256(t){return(0,h2.vp)(t)},getHKDF(t,e){const n=new l2.t(h2.mE,e,t),r=n.expand(96),i=r,s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const t=u2.Au();return{publicKey:t.publicKey,privateKey:t.secretKey}},generateX25519KeyPairFromSeed(t){const e=u2._w(t);return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519SharedKey(t,e){return u2.gi(t,e)},chaCha20Poly1305Encrypt(t,e,n,r){const i=new d2.OK(r);return i.seal(e,t,n)},chaCha20Poly1305Decrypt(t,e,n,r,i){const s=new d2.OK(r);return s.open(e,t,n,i)}},p2=t=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(t):new Uint8Array(t),g2=t=>{const e=p2(2);return new DataView(e.buffer,e.byteOffset,e.byteLength).setUint16(0,t,!1),e};g2.bytes=2;const m2=t=>{if(t.length<2)throw RangeError("Could not decode int16BE");return t instanceof Uint8Array?new DataView(t.buffer,t.byteOffset,t.byteLength).getUint16(0,!1):t.getUint16(0)};function y2(t){return ya([t.ne,t.ciphertext],t.ne.length+t.ciphertext.length)}function w2(t){return ya([t.ne,t.ns,t.ciphertext],t.ne.length+t.ns.length+t.ciphertext.length)}function b2(t){return ya([t.ns,t.ciphertext],t.ns.length+t.ciphertext.length)}function v2(t){if(t.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:t.subarray(0,32),ciphertext:t.subarray(32,t.length),ns:new Uint8Array(0)}}function E2(t){if(t.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:t.subarray(0,32),ns:t.subarray(32,80),ciphertext:t.subarray(80,t.length)}}function _2(t){if(t.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:t.subarray(0,48),ciphertext:t.subarray(48,t.length)}}function S2(t,e){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=a2){let i=n+a2;i>r.length&&(i=r.length);const s=t.encrypt(r.subarray(n,i),t.session);e?.encryptedPackets.increment(),yield g2(s.byteLength),yield s}}}function A2(t,e){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=o2){let i=n+o2;if(i>r.length&&(i=r.length),i-d2.pg<n)throw new Error("Invalid chunk");const s=r.subarray(n,i),o=r.subarray(n,i-d2.pg),{plaintext:a,valid:c}=t.decrypt(s,t.session,o);if(!c)throw e?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");e?.decryptedPackets.increment(),yield a}}}m2.bytes=2;class C2 extends Error{constructor(t="Unexpected Peer"){super(t),this.code=C2.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class I2 extends Error{constructor(t="Invalid crypto exchange"){super(t),this.code=I2.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class T2 extends Error{constructor(t="Invalid crypto transmission"){super(t),this.code=T2.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var k2,R2;async function N2(t,e,n){const r=await O2(t,M2(e));if(null==t.publicKey)throw new Error("PublicKey was missing from local PeerId");return D2(t.publicKey,r,n)}function D2(t,e,n){return R2.encode({identityKey:t,identitySig:e,extensions:n??{webtransportCerthashes:[]}}).subarray()}async function O2(t,e){if(null==t.privateKey)throw new Error("PrivateKey was missing from PeerId");const n=await Yp(t.privateKey);return await n.sign(e)}async function P2(t){return await Hu(t.identityKey)}function x2(t){return R2.decode(t)}function M2(t){const e=Ho("noise-libp2p-static-key:");return ya([e,t],e.length+t.length)}async function L2(t,e,n){const r=await Hu(e.identityKey);if(!r.equals(n))throw new Error("Peer ID doesn't match libp2p public key.");const i=M2(t);if(null==r.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==e.identitySig)throw new Error("Signature was missing from message");const s=qp(r.publicKey),o=await s.verify(i,e.identitySig);if(!o)throw new Error("Static key doesn't match to peer that signed payload!");return r}function B2(t){return t instanceof Uint8Array&&32===t.length}(function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{if(!1!==n.lengthDelimited&&e.fork(),null!=t.webtransportCerthashes)for(const r of t.webtransportCerthashes)e.uint32(10),e.bytes(r);!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={webtransportCerthashes:[]},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.webtransportCerthashes.push(t.bytes());break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())})(k2||(k2={})),function(t){let e;t.codec=()=>(null==e&&(e=kh(((t,e,n={})=>{!1!==n.lengthDelimited&&e.fork(),(!0===n.writeDefaults||null!=t.identityKey&&t.identityKey.byteLength>0)&&(e.uint32(10),e.bytes(t.identityKey)),(!0===n.writeDefaults||null!=t.identitySig&&t.identitySig.byteLength>0)&&(e.uint32(18),e.bytes(t.identitySig)),null!=t.extensions&&(e.uint32(34),k2.codec().encode(t.extensions,e,{writeDefaults:!1})),!1!==n.lengthDelimited&&e.ldelim()}),((t,e)=>{const n={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},r=null==e?t.len:t.pos+e;while(t.pos<r){const e=t.uint32();switch(e>>>3){case 1:n.identityKey=t.bytes();break;case 2:n.identitySig=t.bytes();break;case 4:n.extensions=k2.codec().decode(t,t.uint32());break;default:t.skipType(7&e);break}}return n}))),e),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(R2||(R2={}));const U2=zt("libp2p:noise");let F2;function z2(t){F2(`LOCAL_STATIC_PUBLIC_KEY ${sa(t.publicKey,"hex")}`),F2(`LOCAL_STATIC_PRIVATE_KEY ${sa(t.privateKey,"hex")}`)}function V2(t){t?(F2(`LOCAL_PUBLIC_EPHEMERAL_KEY ${sa(t.publicKey,"hex")}`),F2(`LOCAL_PRIVATE_EPHEMERAL_KEY ${sa(t.privateKey,"hex")}`)):F2("Missing local ephemeral keys.")}function j2(t){F2(`REMOTE_STATIC_PUBLIC_KEY ${sa(t,"hex")}`)}function H2(t){F2(`REMOTE_EPHEMERAL_PUBLIC_KEY ${sa(t,"hex")}`)}function $2(t){t.cs1&&t.cs2?(F2(`CIPHER_STATE_1 ${t.cs1.n.getUint64()} ${sa(t.cs1.k,"hex")}`),F2(`CIPHER_STATE_2 ${t.cs2.n.getUint64()} ${sa(t.cs2.k,"hex")}`)):F2("Missing cipher state.")}F2=c2?U2:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});const K2=0,G2=4294967295,q2="Cipherstate has reached maximum n, a new handshake must be performed";class W2{constructor(t=K2){this.n=t,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,t,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>G2)throw new Error(q2)}}class Y2{constructor(t){this.crypto=t}encryptWithAd(t,e,n){const r=this.encrypt(t.k,t.n,e,n);return t.n.increment(),r}decryptWithAd(t,e,n,r){const{plaintext:i,valid:s}=this.decrypt(t.k,t.n,e,n,r);return s&&t.n.increment(),{plaintext:i,valid:s}}hasKey(t){return!this.isEmptyKey(t.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(t){const e=this.createEmptyKey();return Xa(e,t)}encrypt(t,e,n,r){return e.assertValue(),this.crypto.chaCha20Poly1305Encrypt(r,e.getBytes(),n,t)}encryptAndHash(t,e){let n;return n=this.hasKey(t.cs)?this.encryptWithAd(t.cs,t.h,e):e,this.mixHash(t,n),n}decrypt(t,e,n,r,i){e.assertValue();const s=this.crypto.chaCha20Poly1305Decrypt(r,e.getBytes(),n,t,i);return s?{plaintext:s,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(t,e){let n,r=!0;return this.hasKey(t.cs)?({plaintext:n,valid:r}=this.decryptWithAd(t.cs,t.h,e)):n=e,this.mixHash(t,e),{plaintext:n,valid:r}}dh(t,e){try{const n=this.crypto.generateX25519SharedKey(t,e);return 32===n.length?n:n.subarray(0,32)}catch(n){const t=n;return U2(t.message),new Uint8Array(32)}}mixHash(t,e){t.h=this.getHash(t.h,e)}getHash(t,e){const n=this.crypto.hashSHA256(ya([t,e],t.length+e.length));return n}mixKey(t,e){const[n,r]=this.crypto.getHKDF(t.ck,e);t.cs=this.initializeKey(r),t.ck=n}initializeKey(t){return{k:t,n:new W2}}initializeSymmetric(t){const e=Ho(t,"utf-8"),n=this.hashProtocolName(e),r=n,i=this.createEmptyKey(),s=this.initializeKey(i);return{cs:s,ck:r,h:n}}hashProtocolName(t){if(t.length<=32){const e=new Uint8Array(32);return e.set(t),e}return this.getHash(t,new Uint8Array(0))}split(t){const[e,n]=this.crypto.getHKDF(t.ck,new Uint8Array(0)),r=this.initializeKey(e),i=this.initializeKey(n);return{cs1:r,cs2:i}}writeMessageRegular(t,e){const n=this.encryptWithAd(t,new Uint8Array(0),e),r=this.createEmptyKey(),i=new Uint8Array(0);return{ne:r,ns:i,ciphertext:n}}readMessageRegular(t,e){return this.decryptWithAd(t,new Uint8Array(0),e.ciphertext)}}class X2 extends Y2{initializeInitiator(t,e,n,r){const i="Noise_XX_25519_ChaChaPoly_SHA256",s=this.initializeSymmetric(i);this.mixHash(s,t);const o=new Uint8Array(32);return{ss:s,s:e,rs:n,psk:r,re:o}}initializeResponder(t,e,n,r){const i="Noise_XX_25519_ChaChaPoly_SHA256",s=this.initializeSymmetric(i);this.mixHash(s,t);const o=new Uint8Array(32);return{ss:s,s:e,rs:n,psk:r,re:o}}writeMessageA(t,e,n){const r=new Uint8Array(0);t.e=void 0!==n?n:this.crypto.generateX25519KeyPair();const i=t.e.publicKey;this.mixHash(t.ss,i);const s=this.encryptAndHash(t.ss,e);return{ne:i,ns:r,ciphertext:s}}writeMessageB(t,e){t.e=this.crypto.generateX25519KeyPair();const n=t.e.publicKey;this.mixHash(t.ss,n),this.mixKey(t.ss,this.dh(t.e.privateKey,t.re));const r=t.s.publicKey,i=this.encryptAndHash(t.ss,r);this.mixKey(t.ss,this.dh(t.s.privateKey,t.re));const s=this.encryptAndHash(t.ss,e);return{ne:n,ns:i,ciphertext:s}}writeMessageC(t,e){const n=t.s.publicKey,r=this.encryptAndHash(t.ss,n);this.mixKey(t.ss,this.dh(t.s.privateKey,t.re));const i=this.encryptAndHash(t.ss,e),s=this.createEmptyKey(),o={ne:s,ns:r,ciphertext:i},{cs1:a,cs2:c}=this.split(t.ss);return{h:t.ss.h,messageBuffer:o,cs1:a,cs2:c}}readMessageA(t,e){return B2(e.ne)&&(t.re=e.ne),this.mixHash(t.ss,t.re),this.decryptAndHash(t.ss,e.ciphertext)}readMessageB(t,e){if(B2(e.ne)&&(t.re=e.ne),this.mixHash(t.ss,t.re),!t.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(t.ss,this.dh(t.e.privateKey,t.re));const{plaintext:n,valid:r}=this.decryptAndHash(t.ss,e.ns);r&&B2(n)&&(t.rs=n),this.mixKey(t.ss,this.dh(t.e.privateKey,t.rs));const{plaintext:i,valid:s}=this.decryptAndHash(t.ss,e.ciphertext);return{plaintext:i,valid:r&&s}}readMessageC(t,e){const{plaintext:n,valid:r}=this.decryptAndHash(t.ss,e.ns);if(r&&B2(n)&&(t.rs=n),!t.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(t.ss,this.dh(t.e.privateKey,t.rs));const{plaintext:i,valid:s}=this.decryptAndHash(t.ss,e.ciphertext),{cs1:o,cs2:a}=this.split(t.ss);return{h:t.ss.h,plaintext:i,valid:r&&s,cs1:o,cs2:a}}initSession(t,e,n){const r=this.createEmptyKey(),i=new Uint8Array(32);let s;return s=t?this.initializeInitiator(e,n,i,r):this.initializeResponder(e,n,i,r),{hs:s,i:t,mc:0}}sendMessage(t,e,n){let r;if(0===t.mc)r=this.writeMessageA(t.hs,e,n);else if(1===t.mc)r=this.writeMessageB(t.hs,e);else if(2===t.mc){const{h:n,messageBuffer:i,cs1:s,cs2:o}=this.writeMessageC(t.hs,e);r=i,t.h=n,t.cs1=s,t.cs2=o}else{if(!(t.mc>2))throw new Error("Session invalid.");if(t.i){if(!t.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(t.cs1,e)}else{if(!t.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(t.cs2,e)}}return t.mc++,r}recvMessage(t,e){let n=new Uint8Array(0),r=!1;if(0===t.mc)({plaintext:n,valid:r}=this.readMessageA(t.hs,e));else if(1===t.mc)({plaintext:n,valid:r}=this.readMessageB(t.hs,e));else if(2===t.mc){const{h:i,plaintext:s,valid:o,cs1:a,cs2:c}=this.readMessageC(t.hs,e);n=s,r=o,t.h=i,t.cs1=a,t.cs2=c}return t.mc++,{plaintext:n,valid:r}}}class Q2{constructor(t,e,n,r,i,s,o,a){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=t,this.payload=e,this.prologue=n,this.staticKeypair=i,this.connection=s,o&&(this.remotePeer=o),this.xx=a??new X2(r),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(z2(this.session.hs.s),this.isInitiator){U2("Stage 0 - Initiator starting to send first message.");const t=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(y2(t)),U2("Stage 0 - Initiator finished sending first message."),V2(this.session.hs.e)}else{U2("Stage 0 - Responder waiting to receive first message...");const t=v2((await this.connection.readLP()).subarray()),{valid:e}=this.xx.recvMessage(this.session,t);if(!e)throw new I2("xx handshake stage 0 validation fail");U2("Stage 0 - Responder received first message."),H2(this.session.hs.re)}}async exchange(){if(this.isInitiator){U2("Stage 1 - Initiator waiting to receive first message from responder...");const e=E2((await this.connection.readLP()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new I2("xx handshake stage 1 validation fail");U2("Stage 1 - Initiator received the message."),H2(this.session.hs.re),j2(this.session.hs.rs),U2("Initiator going to check remote's signature...");try{const t=x2(n);this.remotePeer=this.remotePeer||await P2(t),await L2(this.session.hs.rs,t,this.remotePeer),this.setRemoteNoiseExtension(t.extensions)}catch(t){const e=t;throw new C2(`Error occurred while verifying signed payload: ${e.message}`)}U2("All good with the signature!")}else{U2("Stage 1 - Responder sending out first message with signed payload and static key.");const t=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(w2(t)),U2("Stage 1 - Responder sent the second handshake message with signed payload."),V2(this.session.hs.e)}}async finish(){if(this.isInitiator){U2("Stage 2 - Initiator sending third handshake message.");const t=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(b2(t)),U2("Stage 2 - Initiator sent message with signed payload.")}else{U2("Stage 2 - Responder waiting for third handshake message...");const e=_2((await this.connection.readLP()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,e);if(!r)throw new I2("xx handshake stage 2 validation fail");U2("Stage 2 - Responder received the message, finished handshake.");try{const t=x2(n);this.remotePeer=this.remotePeer||await P2(t),await L2(this.session.hs.rs,t,this.remotePeer),this.setRemoteNoiseExtension(t.extensions)}catch(t){const e=t;throw new C2(`Error occurred while verifying signed payload: ${e.message}`)}}$2(this.session)}encrypt(t,e){const n=this.getCS(e);return this.xx.encryptWithAd(n,new Uint8Array(0),t)}decrypt(t,e,n){const r=this.getCS(e,!1);return this.xx.decryptWithAd(r,new Uint8Array(0),t,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(t,e=!0){if(!t.cs1||!t.cs2)throw new I2("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?e?t.cs1:t.cs2:e?t.cs2:t.cs1}setRemoteNoiseExtension(t){t&&(this.remoteExtensions=t)}}function J2(t){return{xxHandshakeSuccesses:t.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:t.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:t.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:t.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:t.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}class Z2{constructor(t={}){this.protocol="/noise";const{staticNoiseKey:e,extensions:n,crypto:r,prologueBytes:i,metrics:s}=t;this.crypto=r??f2,this.extensions=n,this.metrics=s?J2(s):void 0,this.staticKeys=e?this.crypto.generateX25519KeyPairFromSeed(e):this.crypto.generateX25519KeyPair(),this.prologue=i??new Uint8Array(0)}async secureOutbound(t,e,n){const r=r2(e,{lengthEncoder:g2,lengthDecoder:m2,maxDataLength:o2}),i=await this.performHandshake({connection:r,isInitiator:!0,localPeer:t,remotePeer:n}),s=await this.createSecureConnection(r,i);return{conn:s,remoteExtensions:i.remoteExtensions,remotePeer:i.remotePeer}}async secureInbound(t,e,n){const r=r2(e,{lengthEncoder:g2,lengthDecoder:m2,maxDataLength:o2}),i=await this.performHandshake({connection:r,isInitiator:!1,localPeer:t,remotePeer:n}),s=await this.createSecureConnection(r,i);return{conn:s,remotePeer:i.remotePeer,remoteExtensions:i.remoteExtensions}}async performHandshake(t){const e=await N2(t.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(t,e)}async performXXHandshake(t,e){const{isInitiator:n,remotePeer:r,connection:i}=t,s=new Q2(n,e,this.prologue,this.crypto,this.staticKeys,i,r);try{await s.propose(),await s.exchange(),await s.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(o){if(this.metrics?.xxHandshakeErrors.increment(),o instanceof Error)throw o.message=`Error occurred during XX handshake: ${o.message}`,o}return s}async createSecureConnection(t,e){const[n,r]=s2(),i=t.unwrap();return await vm(n,S2(e,this.metrics),i,cV({lengthDecoder:m2}),A2(e,this.metrics),n),r}}function t3(t={}){return()=>new Z2(t)}const e3=nt.bind({ignoreUndefined:!0,concatArrays:!0});function n3({options:t={},peerId:e,multiaddrs:n=[],repo:r,keychainConfig:i={},config:s={}}){const{datastore:o}=r,a=r3({options:t,config:s,datastore:o,keychainConfig:i,peerId:e,multiaddrs:n});return"function"===typeof t.libp2p?t.libp2p({libp2pOptions:a,options:t,config:s,datastore:o,peerId:e}):QJ(a)}function r3({options:t,config:e,datastore:n,keychainConfig:r,peerId:i,multiaddrs:s}){const o=()=>{const t=um(e,"Pubsub.Router")||"gossipsub",n=fV();if(!n[t])throw Vt(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${t} router.`),"ERR_NOT_SUPPORTED");return n[t]},a={datastore:n,peerId:i},c={addresses:{listen:s.map((t=>t.toString())),announce:um(t,"addresses.announce",um(e,"Addresses.Announce",[])),noAnnounce:um(t,"addresses.noAnnounce",um(e,"Addresses.NoAnnounce",[]))},connectionManager:um(t,"connectionManager",{maxConnections:um(t,"config.Swarm.ConnMgr.HighWater",um(e,"Swarm.ConnMgr.HighWater")),minConnections:um(t,"config.Swarm.ConnMgr.LowWater",um(e,"Swarm.ConnMgr.LowWater"))}),keychain:r,identify:{host:{agentVersion:`js-ipfs/${rT}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[n2({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[t3()],relay:{enabled:um(t,"relay.enabled",um(e,"relay.enabled",!0)),hop:{enabled:um(t,"relay.hop.enabled",um(e,"relay.hop.enabled",!1)),active:um(t,"relay.hop.active",um(e,"relay.hop.active",!1))}},nat:{enabled:!um(e,"Swarm.DisableNatPortMap",!1)}};um(t,"config.Pubsub.Enabled",um(e,"Pubsub.Enabled",!0))&&(c.pubsub=o()),"none"!==um(e,"Routing.Type","dhtclient")&&(c.dht=K1({clientMode:"dhtserver"!==um(e,"Routing.Type","dht"),kBucketSize:um(t,"dht.kBucketSize",20),validators:{ipns:jg},selectors:{ipns:hm}}));const l=um(t,"config.Bootstrap",um(e,"Bootstrap",[]));l.length>0&&c.peerDiscovery?.push(J1({list:l}));let u=um(t,"libp2p",void 0);"function"===typeof u&&(u=void 0);const h=e3(a,Kq(),c,u),d=um(t,"config.Addresses.Delegates",um(e,"Addresses.Delegates",[]));if(d.length>0){const t=d[Math.floor(Math.random()*d.length)],e=dc(t).toOptions(),n={host:e.host,protocol:443===parseInt(e.port)?"https":"http",port:e.port},r=wK(n);h.contentRouters?.push(kV(r)),h.peerRouters?.push(vV(r))}return um(t,"config.Discovery.MDNS.Enabled",um(e,"Discovery.MDNS.Enabled",!0))||(h.peerDiscovery=h.peerDiscovery?.filter((t=>{try{if("function"===typeof t)return"@libp2p/mdns"!==t({})[Symbol.toStringTag]}catch{}return!0}))),null==h.transports&&(h.transports=[]),null==h.transports.find((t=>{try{if("function"===typeof t)return"@libp2p/websockets"===t({})[Symbol.toStringTag]}catch{}return!1}))&&h.transports.push(_0()),h}const i3=nt.bind({ignoreUndefined:!0}),s3=zt("ipfs:components:peer:storage");class o3{constructor(t,e,n,r,i){this.print=r,this.peerId=t,this.keychain=e,this.repo=n,this.print=r,this.isNew=i}static async start(t,e,n){const{repoAutoMigrate:r,repo:i,onMigrationProgress:s}=n,o="string"===typeof i||null==i?Fx(t,e,{path:i,autoMigrate:r,onMigrationProgress:s}):i,{peerId:a,keychain:c,isNew:l}=await a3(t,o,n);return new o3(a,c,o,t,l)}}const a3=async(t,e,n)=>{if(!e.closed)return{...await d3(e,n),isNew:!1};try{return await e.open(),{...await d3(e,n),isNew:!1}}catch(uS){if(uS.code!==_P)throw uS;if(n.init&&!1===n.init.allowNew)throw new xo("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await c3(t,e,n),isNew:!0}}},c3=async(t,e,n)=>{const r=n.init||{},i=await e.exists();if(s3("repo exists?",i),!0===i)throw new Error("repo already exists");const s=r.privateKey?await l3(r.privateKey):await u3(t,r),o=h3(s);s3("peer identity: %s",o.PeerID);const a={...i3(p3(by(),r.profiles),n.config),Identity:o};await e.init(a),await e.open(),s3("repo opened");const c={pass:n.pass};try{c.dek=await e.config.get("Keychain.DEK")}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}const l=await n3({options:void 0,multiaddrs:void 0,peerId:s,repo:e,config:a,keychainConfig:c});return await e.datastore.has(new rl("/info/self"))||await l.keychain.importPeer("self",s),await e.config.set("Keychain",{DEK:l.keychain.init.dek}),{peerId:s,keychain:l.keychain}},l3=async t=>{if(s3("using user-supplied private-key"),Ru(t))return t;const e=Ho(t,"base64pad"),n=await Yp(e);return await Hu(n.public.bytes,n.bytes)},u3=(t,{algorithm:e="Ed25519",bits:n=2048})=>{if(t("generating %s keypair...",e),"Ed25519"===e)return xJ();if("RSA"===e)return MJ({bits:n});throw Vt(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},h3=t=>{if(null==t.privateKey)throw Vt(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:t.toString(),PrivKey:sa(t.privateKey,"base64pad")}},d3=async(t,e)=>{const n=e.config,r=e.init&&e.init.profiles||[],i=e.pass,s=await t.config.getAll(),o=f3(p3(s,r),n);if(s!==o&&await t.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new ko("No private key was found in the config, please intialize the repo");const a=Ho(o.Identity.PrivKey,"base64pad"),c=await Yp(a),l=await Hu(c.public.bytes,c.bytes),u=await n3({options:void 0,multiaddrs:void 0,peerId:l,repo:t,config:o,keychainConfig:{pass:i,...o.Keychain}});return{peerId:l,keychain:u.keychain}},f3=(t,e)=>e?i3(t,e):t,p3=(t,e)=>(e||[]).reduce(((t,e)=>{const n=pT[e];if(!n)throw new Error(`Could not find profile with name '${e}'`);return s3("applying profile %s",e),n.transform(t)}),t);var g3=n(1962);function m3(t){let e=new Uint8Array(t.reduce(((t,e)=>t+ma.encodingLength(e)),0)),n=0;for(const r of t)e=ma.encode(r,e,n),n+=ma.encodingLength(r);return e}var y3=m3;class w3{constructor(t,e,n){this._refCounter=1,this.cid=t,this.priority=e||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){const t=this.cid.toString(Ct);return`WantlistEntry <key: ${t}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(t){return this._refCounter===t._refCounter&&this.cid.equals(t.cid)&&this.priority===t.priority&&this.wantType===t.wantType}}const b3=jt.Reader,v3=jt.Writer,E3=jt.util,_3=jt.roots["ipfs-bitswap"]||(jt.roots["ipfs-bitswap"]={}),S3=_3.Message=(()=>{function t(t){if(this.blocks=[],this.payload=[],this.blockPresences=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.wantlist=null,t.prototype.blocks=E3.emptyArray,t.prototype.payload=E3.emptyArray,t.prototype.blockPresences=E3.emptyArray,t.prototype.pendingBytes=0,t.encode=function(t,e){if(e||(e=v3.create()),null!=t.wantlist&&Object.hasOwnProperty.call(t,"wantlist")&&_3.Message.Wantlist.encode(t.wantlist,e.uint32(10).fork()).ldelim(),null!=t.blocks&&t.blocks.length)for(var n=0;n<t.blocks.length;++n)e.uint32(18).bytes(t.blocks[n]);if(null!=t.payload&&t.payload.length)for(n=0;n<t.payload.length;++n)_3.Message.Block.encode(t.payload[n],e.uint32(26).fork()).ldelim();if(null!=t.blockPresences&&t.blockPresences.length)for(n=0;n<t.blockPresences.length;++n)_3.Message.BlockPresence.encode(t.blockPresences[n],e.uint32(34).fork()).ldelim();return null!=t.pendingBytes&&Object.hasOwnProperty.call(t,"pendingBytes")&&e.uint32(40).int32(t.pendingBytes),e},t.decode=function(t,e){t instanceof b3||(t=b3.create(t));var n=void 0===e?t.len:t.pos+e,r=new _3.Message;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.wantlist=_3.Message.Wantlist.decode(t,t.uint32());break;case 2:r.blocks&&r.blocks.length||(r.blocks=[]),r.blocks.push(t.bytes());break;case 3:r.payload&&r.payload.length||(r.payload=[]),r.payload.push(_3.Message.Block.decode(t,t.uint32()));break;case 4:r.blockPresences&&r.blockPresences.length||(r.blockPresences=[]),r.blockPresences.push(_3.Message.BlockPresence.decode(t,t.uint32()));break;case 5:r.pendingBytes=t.int32();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof _3.Message)return t;var e=new _3.Message;if(null!=t.wantlist){if("object"!==typeof t.wantlist)throw TypeError(".Message.wantlist: object expected");e.wantlist=_3.Message.Wantlist.fromObject(t.wantlist)}if(t.blocks){if(!Array.isArray(t.blocks))throw TypeError(".Message.blocks: array expected");e.blocks=[];for(var n=0;n<t.blocks.length;++n)"string"===typeof t.blocks[n]?E3.base64.decode(t.blocks[n],e.blocks[n]=E3.newBuffer(E3.base64.length(t.blocks[n])),0):t.blocks[n].length>=0&&(e.blocks[n]=t.blocks[n])}if(t.payload){if(!Array.isArray(t.payload))throw TypeError(".Message.payload: array expected");e.payload=[];for(n=0;n<t.payload.length;++n){if("object"!==typeof t.payload[n])throw TypeError(".Message.payload: object expected");e.payload[n]=_3.Message.Block.fromObject(t.payload[n])}}if(t.blockPresences){if(!Array.isArray(t.blockPresences))throw TypeError(".Message.blockPresences: array expected");e.blockPresences=[];for(n=0;n<t.blockPresences.length;++n){if("object"!==typeof t.blockPresences[n])throw TypeError(".Message.blockPresences: object expected");e.blockPresences[n]=_3.Message.BlockPresence.fromObject(t.blockPresences[n])}}return null!=t.pendingBytes&&(e.pendingBytes=0|t.pendingBytes),e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.blocks=[],n.payload=[],n.blockPresences=[]),e.defaults&&(n.wantlist=null,n.pendingBytes=0),null!=t.wantlist&&t.hasOwnProperty("wantlist")&&(n.wantlist=_3.Message.Wantlist.toObject(t.wantlist,e)),t.blocks&&t.blocks.length){n.blocks=[];for(var r=0;r<t.blocks.length;++r)n.blocks[r]=e.bytes===String?E3.base64.encode(t.blocks[r],0,t.blocks[r].length):e.bytes===Array?Array.prototype.slice.call(t.blocks[r]):t.blocks[r]}if(t.payload&&t.payload.length){n.payload=[];for(r=0;r<t.payload.length;++r)n.payload[r]=_3.Message.Block.toObject(t.payload[r],e)}if(t.blockPresences&&t.blockPresences.length){n.blockPresences=[];for(r=0;r<t.blockPresences.length;++r)n.blockPresences[r]=_3.Message.BlockPresence.toObject(t.blockPresences[r],e)}return null!=t.pendingBytes&&t.hasOwnProperty("pendingBytes")&&(n.pendingBytes=t.pendingBytes),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/Message"},t.Wantlist=function(){function t(t){if(this.entries=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.entries=E3.emptyArray,t.prototype.full=!1,t.encode=function(t,e){if(e||(e=v3.create()),null!=t.entries&&t.entries.length)for(var n=0;n<t.entries.length;++n)_3.Message.Wantlist.Entry.encode(t.entries[n],e.uint32(10).fork()).ldelim();return null!=t.full&&Object.hasOwnProperty.call(t,"full")&&e.uint32(16).bool(t.full),e},t.decode=function(t,e){t instanceof b3||(t=b3.create(t));var n=void 0===e?t.len:t.pos+e,r=new _3.Message.Wantlist;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.entries&&r.entries.length||(r.entries=[]),r.entries.push(_3.Message.Wantlist.Entry.decode(t,t.uint32()));break;case 2:r.full=t.bool();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof _3.Message.Wantlist)return t;var e=new _3.Message.Wantlist;if(t.entries){if(!Array.isArray(t.entries))throw TypeError(".Message.Wantlist.entries: array expected");e.entries=[];for(var n=0;n<t.entries.length;++n){if("object"!==typeof t.entries[n])throw TypeError(".Message.Wantlist.entries: object expected");e.entries[n]=_3.Message.Wantlist.Entry.fromObject(t.entries[n])}}return null!=t.full&&(e.full=Boolean(t.full)),e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.entries=[]),e.defaults&&(n.full=!1),t.entries&&t.entries.length){n.entries=[];for(var r=0;r<t.entries.length;++r)n.entries[r]=_3.Message.Wantlist.Entry.toObject(t.entries[r],e)}return null!=t.full&&t.hasOwnProperty("full")&&(n.full=t.full),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/Message.Wantlist"},t.WantType=function(){const t={},e=Object.create(t);return e[t[0]="Block"]=0,e[t[1]="Have"]=1,e}(),t.Entry=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.block=E3.newBuffer([]),t.prototype.priority=0,t.prototype.cancel=!1,t.prototype.wantType=0,t.prototype.sendDontHave=!1,t.encode=function(t,e){return e||(e=v3.create()),null!=t.block&&Object.hasOwnProperty.call(t,"block")&&e.uint32(10).bytes(t.block),null!=t.priority&&Object.hasOwnProperty.call(t,"priority")&&e.uint32(16).int32(t.priority),null!=t.cancel&&Object.hasOwnProperty.call(t,"cancel")&&e.uint32(24).bool(t.cancel),null!=t.wantType&&Object.hasOwnProperty.call(t,"wantType")&&e.uint32(32).int32(t.wantType),null!=t.sendDontHave&&Object.hasOwnProperty.call(t,"sendDontHave")&&e.uint32(40).bool(t.sendDontHave),e},t.decode=function(t,e){t instanceof b3||(t=b3.create(t));var n=void 0===e?t.len:t.pos+e,r=new _3.Message.Wantlist.Entry;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.block=t.bytes();break;case 2:r.priority=t.int32();break;case 3:r.cancel=t.bool();break;case 4:r.wantType=t.int32();break;case 5:r.sendDontHave=t.bool();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof _3.Message.Wantlist.Entry)return t;var e=new _3.Message.Wantlist.Entry;switch(null!=t.block&&("string"===typeof t.block?E3.base64.decode(t.block,e.block=E3.newBuffer(E3.base64.length(t.block)),0):t.block.length>=0&&(e.block=t.block)),null!=t.priority&&(e.priority=0|t.priority),null!=t.cancel&&(e.cancel=Boolean(t.cancel)),t.wantType){case"Block":case 0:e.wantType=0;break;case"Have":case 1:e.wantType=1;break}return null!=t.sendDontHave&&(e.sendDontHave=Boolean(t.sendDontHave)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.block="":(n.block=[],e.bytes!==Array&&(n.block=E3.newBuffer(n.block))),n.priority=0,n.cancel=!1,n.wantType=e.enums===String?"Block":0,n.sendDontHave=!1),null!=t.block&&t.hasOwnProperty("block")&&(n.block=e.bytes===String?E3.base64.encode(t.block,0,t.block.length):e.bytes===Array?Array.prototype.slice.call(t.block):t.block),null!=t.priority&&t.hasOwnProperty("priority")&&(n.priority=t.priority),null!=t.cancel&&t.hasOwnProperty("cancel")&&(n.cancel=t.cancel),null!=t.wantType&&t.hasOwnProperty("wantType")&&(n.wantType=e.enums===String?_3.Message.Wantlist.WantType[t.wantType]:t.wantType),null!=t.sendDontHave&&t.hasOwnProperty("sendDontHave")&&(n.sendDontHave=t.sendDontHave),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/Message.Wantlist.Entry"},t}(),t}(),t.Block=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.prefix=E3.newBuffer([]),t.prototype.data=E3.newBuffer([]),t.encode=function(t,e){return e||(e=v3.create()),null!=t.prefix&&Object.hasOwnProperty.call(t,"prefix")&&e.uint32(10).bytes(t.prefix),null!=t.data&&Object.hasOwnProperty.call(t,"data")&&e.uint32(18).bytes(t.data),e},t.decode=function(t,e){t instanceof b3||(t=b3.create(t));var n=void 0===e?t.len:t.pos+e,r=new _3.Message.Block;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.prefix=t.bytes();break;case 2:r.data=t.bytes();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof _3.Message.Block)return t;var e=new _3.Message.Block;return null!=t.prefix&&("string"===typeof t.prefix?E3.base64.decode(t.prefix,e.prefix=E3.newBuffer(E3.base64.length(t.prefix)),0):t.prefix.length>=0&&(e.prefix=t.prefix)),null!=t.data&&("string"===typeof t.data?E3.base64.decode(t.data,e.data=E3.newBuffer(E3.base64.length(t.data)),0):t.data.length>=0&&(e.data=t.data)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.prefix="":(n.prefix=[],e.bytes!==Array&&(n.prefix=E3.newBuffer(n.prefix))),e.bytes===String?n.data="":(n.data=[],e.bytes!==Array&&(n.data=E3.newBuffer(n.data)))),null!=t.prefix&&t.hasOwnProperty("prefix")&&(n.prefix=e.bytes===String?E3.base64.encode(t.prefix,0,t.prefix.length):e.bytes===Array?Array.prototype.slice.call(t.prefix):t.prefix),null!=t.data&&t.hasOwnProperty("data")&&(n.data=e.bytes===String?E3.base64.encode(t.data,0,t.data.length):e.bytes===Array?Array.prototype.slice.call(t.data):t.data),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/Message.Block"},t}(),t.BlockPresenceType=function(){const t={},e=Object.create(t);return e[t[0]="Have"]=0,e[t[1]="DontHave"]=1,e}(),t.BlockPresence=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.cid=E3.newBuffer([]),t.prototype.type=0,t.encode=function(t,e){return e||(e=v3.create()),null!=t.cid&&Object.hasOwnProperty.call(t,"cid")&&e.uint32(10).bytes(t.cid),null!=t.type&&Object.hasOwnProperty.call(t,"type")&&e.uint32(16).int32(t.type),e},t.decode=function(t,e){t instanceof b3||(t=b3.create(t));var n=void 0===e?t.len:t.pos+e,r=new _3.Message.BlockPresence;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.cid=t.bytes();break;case 2:r.type=t.int32();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof _3.Message.BlockPresence)return t;var e=new _3.Message.BlockPresence;switch(null!=t.cid&&("string"===typeof t.cid?E3.base64.decode(t.cid,e.cid=E3.newBuffer(E3.base64.length(t.cid)),0):t.cid.length>=0&&(e.cid=t.cid)),t.type){case"Have":case 0:e.type=0;break;case"DontHave":case 1:e.type=1;break}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(e.bytes===String?n.cid="":(n.cid=[],e.bytes!==Array&&(n.cid=E3.newBuffer(n.cid))),n.type=e.enums===String?"Have":0),null!=t.cid&&t.hasOwnProperty("cid")&&(n.cid=e.bytes===String?E3.base64.encode(t.cid,0,t.cid.length):e.bytes===Array?Array.prototype.slice.call(t.cid):t.cid),null!=t.type&&t.hasOwnProperty("type")&&(n.type=e.enums===String?_3.Message.BlockPresenceType[t.type]:t.type),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,jt.util.toJSONOptions)},t.getTypeUrl=function(t){return void 0===t&&(t="type.googleapis.com"),t+"/Message.BlockPresence"},t}(),t})(),A3={Block:S3.Wantlist.WantType.Block,Have:S3.Wantlist.WantType.Have},C3=(t,e)=>Array.prototype.slice.call(e,0).sort(((e,n)=>{const r=t(e),i=t(n);return r<i?-1:r>i?1:0}));class I3{constructor(t,e){this.set=e?IX({system:"ipfs",component:"bitswap",metric:"wantlist",metrics:e.metrics}):new Map,this._stats=t}get length(){return this.set.size}add(t,e,n){const r=t.toString(Ct),i=this.set.get(r);i?(i.inc(),i.priority=e,i.wantType===A3.Have&&n===A3.Block&&(i.wantType=n)):(this.set.set(r,new w3(t,e,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(t){const e=t.toString(Ct),n=this.set.get(e);n&&(n.dec(),n.hasRefs()||(this.set.delete(e),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(t){this.set.has(t)&&this.set.delete(t)}forEach(t){return this.set.forEach(t)}entries(){return this.set.entries()}sortedEntries(){return new Map(C3((t=>t[1].key),Array.from(this.set.entries())))}contains(t){const e=t.toString(Ct);return this.set.has(e)}get(t){const e=t.toString(Ct);return this.set.get(e)}}I3.Entry=w3;const T3=I3.Entry;class k3{constructor(t,e,n,r,i){this.entry=new T3(t,e,n),this.cancel=Boolean(r),this.sendDontHave=Boolean(i)}get cid(){return this.entry.cid}set cid(t){this.entry.cid=t}get priority(){return this.entry.priority}set priority(t){this.entry.priority=t}get wantType(){return this.entry.wantType}set wantType(t){this.entry.wantType=t}get[Symbol.toStringTag](){const t=this.cid.toString(Ct);return`BitswapMessageEntry ${t} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(t){return this.cancel===t.cancel&&this.sendDontHave===t.sendDontHave&&this.wantType===t.wantType&&this.entry.equals(t.entry)}}const R3=(t,e)=>{const n=["bitswap"];return e&&n.push(e),t&&n.push(`${t.toString().slice(0,8)}`),Object.assign(it(n.join(":")),{error:it(n.concat(["error"]).join(":"))})},N3=(t,e)=>{if(t.size!==e.size)return!1;for(const[n,r]of t){const t=e.get(n);if(void 0===t)return!1;if(r instanceof Uint8Array&&t instanceof Uint8Array&&!Xa(r,t))return!1;if(r instanceof k3&&t instanceof k3&&!r.equals(t))return!1}return!0};class D3{constructor(t){this.full=t,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(t,e,n,r,i){null==n&&(n=D3.WantType.Block);const s=t.toString(Ct),o=this.wantlist.get(s);o?(o.wantType===n&&(o.priority=e),r&&(o.cancel=Boolean(r)),i&&(o.sendDontHave=Boolean(i)),n===D3.WantType.Block&&o.wantType===D3.WantType.Have&&(o.wantType=n)):this.wantlist.set(s,new k3(t,e,n,r,i))}addBlock(t,e){const n=t.toString(Ct);this.blocks.set(n,e)}addHave(t){const e=t.toString(Ct);this.blockPresences.has(e)||this.blockPresences.set(e,D3.BlockPresenceType.Have)}addDontHave(t){const e=t.toString(Ct);this.blockPresences.has(e)||this.blockPresences.set(e,D3.BlockPresenceType.DontHave)}cancel(t){const e=t.toString(Ct);this.wantlist.delete(e),this.addEntry(t,0,D3.WantType.Block,!0,!1)}setPendingBytes(t){this.pendingBytes=t}serializeToBitswap100(){const t={wantlist:{entries:Array.from(this.wantlist.values()).map((t=>({block:t.cid.bytes,priority:Number(t.priority),cancel:Boolean(t.cancel)}))),full:!!this.full||void 0},blocks:Array.from(this.blocks.values())};return S3.encode(t).finish()}serializeToBitswap110(){const t={wantlist:{entries:Array.from(this.wantlist.values()).map((t=>({block:t.cid.bytes,priority:Number(t.priority),wantType:t.wantType,cancel:Boolean(t.cancel),sendDontHave:Boolean(t.sendDontHave)}))),full:!!this.full||void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(const[e,n]of this.blocks.entries()){const r=Me.parse(e),i=r.version,s=r.code,o=r.multihash.code,a=r.multihash.digest.length,c=y3([i,s,o,a]);t.payload.push(new S3.Block({prefix:c,data:n}))}for(const[e,n]of this.blockPresences)t.blockPresences.push(new S3.BlockPresence({cid:Me.parse(e).bytes,type:n}));return this.pendingBytes>0&&(t.pendingBytes=this.pendingBytes),S3.encode(t).finish()}equals(t){return!!(this.full===t.full&&this.pendingBytes===t.pendingBytes&&N3(this.wantlist,t.wantlist)&&N3(this.blocks,t.blocks)&&N3(this.blockPresences,t.blockPresences))}get[Symbol.toStringTag](){const t=Array.from(this.wantlist.keys()),e=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${t}, blocks: ${e}>`}}D3.deserialize=async(t,e)=>{const n=S3.decode(t),r=n.wantlist&&n.wantlist.full||!1,i=new D3(r);return n.wantlist&&n.wantlist.entries&&n.wantlist.entries.forEach((t=>{if(!t.block)return;const e=Me.decode(t.block);i.addEntry(e,t.priority||0,t.wantType,Boolean(t.cancel),Boolean(t.sendDontHave))})),n.blockPresences&&n.blockPresences.forEach((t=>{if(!t.cid)return;const e=Me.decode(t.cid);t.type===D3.BlockPresenceType.Have?i.addHave(e):i.addDontHave(e)})),n.blocks.length>0?(await Promise.all(n.blocks.map((async t=>{const e=await ho.digest(t),n=Me.createV0(e);i.addBlock(n,t)}))),i):n.payload.length>0?(await Promise.all(n.payload.map((async t=>{if(!t.prefix||!t.data)return;const n=g3(t.prefix),r=n[0],s=n[1],o=n[2],a=o===ho.code?ho:e&&await e.getHasher(o);if(!a)throw Vt(new Error("Unknown hash algorithm"),"ERR_UNKNOWN_HASH_ALG");const c=await a.digest(t.data),l=Me.create(r,s,c);i.addBlock(l,t.data)}))),i.setPendingBytes(n.pendingBytes),i):i},D3.blockPresenceSize=t=>t.bytes.length+1,D3.Entry=k3,D3.WantType={Block:S3.Wantlist.WantType.Block,Have:S3.Wantlist.WantType.Have},D3.BlockPresenceType={Have:S3.BlockPresenceType.Have,DontHave:S3.BlockPresenceType.DontHave};const O3=3,P3=Math.pow(2,31)-1,x3=1e3,M3=1;var L3=B3;function B3(t,e,n){var r=null,i=null,s=function(){r&&(clearTimeout(r),i=null,r=null)},o=function(){var t=i;s(),t&&t()},a=function(){if(!e)return t.apply(this,arguments);var o=this,a=arguments,c=n&&!r;return s(),i=function(){t.apply(o,a)},r=setTimeout((function(){if(r=null,!c){var t=i;return i=null,t()}}),e),c?i():void 0};return a.cancel=s,a.flush=o,a}class U3{constructor(t,e,n){this.peerId=e,this.network=n,this.refcnt=1,this._entries=[],this._log=R3(t,"msgqueue"),this.sendEntries=L3(this._sendEntries.bind(this),M3)}addMessage(t){t.empty||this.send(t)}addEntries(t){this._entries=this._entries.concat(t),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const t=new D3(!1);this._entries.forEach((e=>{e.cancel?t.cancel(e.cid):t.addEntry(e.cid,e.priority)})),this._entries=[],this.addMessage(t)}async send(t){try{await this.network.connectTo(this.peerId)}catch(uS){return void this._log.error("cant connect to peer %s: %s",this.peerId.toString(),uS.message)}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,t).catch((t=>{this._log.error("send error: %s",t.message)}))}}class F3{constructor(t,e,n,r){this.peers=IX({system:"ipfs",component:"bitswap",metric:"want-manager-peers",metrics:r.metrics}),this.wantlist=new I3(n,r),this.network=e,this._stats=n,this._peerId=t,this._log=R3(t,"want")}_addEntries(t,e,n){const r=t.map(((t,n)=>new D3.Entry(t,P3-n,D3.WantType.Block,e)));r.forEach((t=>{t.cancel?n?this.wantlist.removeForce(t.cid.toString(Ct)):this.wantlist.remove(t.cid):(this._log("adding to wl"),this.wantlist.add(t.cid,t.priority))}));for(const i of this.peers.values())i.addEntries(r)}_startPeerHandler(t){let e=this.peers.get(t.toString());if(e)return void e.refcnt++;e=new U3(this._peerId,t,this.network);const n=new D3(!0);for(const r of this.wantlist.entries())n.addEntry(r[1].cid,r[1].priority);return e.addMessage(n),this.peers.set(t.toString(),e),e}_stopPeerHandler(t){const e=this.peers.get(t.toString());e&&(e.refcnt--,e.refcnt>0||this.peers.delete(t.toString()))}wantBlocks(t,e={}){this._addEntries(t,!1),e&&e.signal&&e.signal.addEventListener("abort",(()=>{this.cancelWants(t)}))}unwantBlocks(t){this._log("unwant blocks: %s",t.length),this._addEntries(t,!0,!0)}cancelWants(t){this._log("cancel wants: %s",t.length),this._addEntries(t,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(t){this._startPeerHandler(t)}disconnected(t){this._stopPeerHandler(t)}start(){}stop(){this.peers.forEach((t=>this.disconnected(t.peerId)))}}const z3="/ipfs/bitswap/1.0.0",V3="/ipfs/bitswap/1.1.0",j3="/ipfs/bitswap/1.2.0",H3=32,$3=128,K3=3e4;class G3{constructor(t,e,n,r={}){this._log=R3(t.peerId,"network"),this._libp2p=t,this._bitswap=e,this._protocols=[z3],r.b100Only||(this._protocols.unshift(V3),this._protocols.unshift(j3)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=r.hashLoader,this._maxInboundStreams=r.maxInboundStreams??H3,this._maxOutboundStreams=r.maxOutboundStreams??$3,this._incomingStreamTimeout=r.incomingStreamTimeout??K3}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const t=dM({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(const e of this._protocols)this._registrarIds.push(await this._libp2p.registrar.register(e,t));this._libp2p.getConnections().forEach((t=>{this._onPeerConnect(t.remotePeer)}))}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(const t of this._registrarIds)this._libp2p.registrar.unregister(t);this._registrarIds=[]}}_onConnection({stream:t,connection:e}){if(!this._running)return;const n=new $o.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then((async()=>{this._log("incoming new bitswap %s connection from %p",t.stat.protocol,e.remotePeer),await vm(Jz(t.source,n.signal),cV(),(async t=>{for await(const r of t){try{const t=await D3.deserialize(r.subarray(),this._hashLoader);await this._bitswap._receiveMessage(e.remotePeer,t)}catch(uS){this._bitswap._receiveError(uS);break}n.reset()}}))})).catch((e=>{this._log(e),t.abort(e)})).finally((()=>{n.clear(),t.close()}))}_onPeerConnect(t){this._bitswap._onPeerConnected(t)}_onPeerDisconnect(t){this._bitswap._onPeerDisconnected(t)}findProviders(t,e={}){return this._libp2p.contentRouting.findProviders(t,e)}async findAndConnect(t,e){const n=[];let r=0;for await(const i of this.findProviders(t,e))if(this._log(`connecting to provider ${i.id}`),n.push(this.connectTo(i.id,e).catch((t=>{this._log.error(t)}))),r++,r===O3)break;await Promise.all(n)}async provide(t,e){await this._libp2p.contentRouting.provide(t,e)}async sendMessage(t,e){if(!this._running)throw new Error("network isn't running");const n=t.toString();this._log("sendMessage to %s",n,e);const r=await this._libp2p.dial(t),i=await r.newStream([j3,V3,z3]);await q3(i,e,this._log),this._updateSentStats(t,e.blocks)}async connectTo(t,e){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(t,e)}_updateSentStats(t,e){const n=t.toString();if(this._stats){for(const t of e.values())this._stats.push(n,"dataSent",t.length);this._stats.push(n,"blocksSent",e.size)}}}async function q3(t,e,n){try{let n;switch(t.stat.protocol){case z3:n=e.serializeToBitswap100();break;case V3:case j3:n=e.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+t.stat.protocol)}await vm([n],rV(),t)}catch(uS){n(uS)}finally{t.close()}}class W3{constructor(t){this.partner=t,this.wantlist=new I3,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(t){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=t}receivedBytes(t){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=t}wants(t,e,n){this.wantlist.add(t,e,n)}cancelWant(t){this.wantlist.remove(t)}wantlistContains(t){return this.wantlist.get(t)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class Y3 extends Map{constructor(t,e){super(),this._cmp=e||this._defaultSort,this._keys=[];for(const[n,r]of t||[])this.set(n,r)}update(t){if(t<0||t>=this._keys.length)return;const e=this._keys[t];this._keys.splice(t,1);const n=this._find(e);this._keys.splice(n,0,e)}set(t,e){if(this.has(t)){const e=this.indexOf(t);this._keys.splice(e,1)}super.set(t,e);const n=this._find(t);return this._keys.splice(n,0,t),this}clear(){super.clear(),this._keys=[]}delete(t){if(!this.has(t))return!1;const e=this.indexOf(t);return this._keys.splice(e,1),super.delete(t)}indexOf(t){if(!this.has(t))return-1;const e=this._find(t);if(this._keys[e]===t)return e;for(let n=1;n<this._keys.length;n++){if(this._keys[e+n]===t)return e+n;if(this._keys[e-n]===t)return e-n}return-1}_find(t){let e=0,n=this._keys.length;while(e<n){const r=e+n>>>1,i=this._kCmp(this._keys[r],t);if(i<0)e=r+1;else{if(!(i>0))return r;n=r}}return e}*keys(){for(const t of this._keys)yield t}*values(){for(const t of this._keys)yield this.get(t)}*entries(){for(const t of this._keys)yield[t,this.get(t)]}*[Symbol.iterator](){yield*this.entries()}forEach(t,e){if(t)for(const n of this._keys)t.apply(e,[[n,this.get(n)]])}_defaultSort(t,e){return t[0]<e[0]?-1:e[0]<t[0]?1:0}_kCmp(t,e){return this._cmp([t,this.get(t)],[e,this.get(e)])}}const X3={hasNewInfo(){return!1},merge(){}};class Q3{constructor(t=X3){this._taskMerger=t,this._byPeer=new Y3([],J3.compare)}pushTasks(t,e){let n=this._byPeer.get(t.toString());n||(n=new J3(t,this._taskMerger)),n.pushTasks(e),this._byPeer.set(t.toString(),n)}popTasks(t){const e=this._head();if(void 0===e)return{tasks:[],pendingSize:0};const{tasks:n,pendingSize:r}=e.popTasks(t);if(0===n.length)return{tasks:n,pendingSize:r};const i=e.peerId;return e.isIdle()?this._byPeer.delete(i.toString()):this._byPeer.update(0),{peerId:i,tasks:n,pendingSize:r}}_head(){if(0!==this._byPeer.size)for(const[,t]of this._byPeer)return t}remove(t,e){const n=this._byPeer.get(e.toString());n&&n.remove(t)}tasksDone(t,e){const n=this._byPeer.get(t.toString());if(!n)return;const r=this._byPeer.indexOf(t.toString());for(const i of e)n.taskDone(i);this._byPeer.update(r)}}class J3{constructor(t,e){this.peerId=t,this._taskMerger=e,this._activeTotalSize=0,this._pending=new Z3,this._active=new Set}pushTasks(t){for(const e of t)this._pushTask(e)}_pushTask(t){if(!this._taskHasMoreInfoThanActiveTasks(t))return;const e=this._pending.get(t.topic);if(e)return t.priority>e.priority&&this._pending.updatePriority(t.topic,t.priority),void this._taskMerger.merge(t,e);this._pending.add(t)}_taskHasMoreInfoThanActiveTasks(t){const e=[];for(const n of this._active)n.topic===t.topic&&e.push(n);return 0===e.length||this._taskMerger.hasNewInfo(t,e)}popTasks(t){let e=0;const n=[],r=this._pending.tasks();for(let i=0;i<r.length&&e<t;i++){const t=r[i];n.push(t),e+=t.size,this._pending.delete(t.topic),this._activeTotalSize+=t.size,this._active.add(t)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(t){this._active.has(t)&&(this._activeTotalSize-=t.size,this._active.delete(t))}remove(t){this._pending.delete(t)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(t,e){return 0===t[1]._pending.length?1:0===e[1]._pending.length?-1:t[1]._activeTotalSize===e[1]._activeTotalSize?e[1]._pending.length-t[1]._pending.length:t[1]._activeTotalSize-e[1]._activeTotalSize}}class Z3{constructor(){this._tasks=new Y3([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce(((t,e)=>t+e.task.size),0)}get(t){return(this._tasks.get(t)||{}).task}add(t){this._tasks.set(t.topic,{created:Date.now(),task:t})}delete(t){this._tasks.delete(t)}tasks(){return[...this._tasks.values()].map((t=>t.task))}updatePriority(t,e){const n=this._tasks.get(t);if(!n)return;const r=this._tasks.indexOf(t);n.task.priority=e,this._tasks.update(r)}_compare(t,e){return t[1].task.priority===e[1].task.priority?t[1].created-e[1].created:e[1].task.priority-t[1].task.priority}}const t6={hasNewInfo(t,e){let n=!1,r=!1;for(const i of e)i.data.haveBlock&&(n=!0),i.data.isWantBlock&&(r=!0);return!(r||!t.data.isWantBlock)||!(n||!t.data.haveBlock)},merge(t,e){const n=t.data,r=e.data;!r.haveBlock&&n.haveBlock&&(r.haveBlock=n.haveBlock,r.blockSize=n.blockSize),!r.isWantBlock&&n.isWantBlock&&(r.isWantBlock=!0,r.haveBlock&&!n.haveBlock||(r.haveBlock=n.haveBlock,e.size=t.size)),r.isWantBlock&&r.haveBlock&&(e.size=r.blockSize)}},e6=D3.WantType,n6=16384,r6=1024;class i6{constructor(t,e,n,r,i,s={}){this._log=R3(t,"engine"),this.blockstore=e,this.network=n,this._stats=r,this._opts=this._processOpts(s),this.ledgerMap=IX({system:"ipfs",component:"bitswap",metric:"ledger-map",metrics:i.metrics}),this._running=!1,this._requestQueue=new Q3(t6)}_processOpts(t){return{maxSizeReplaceHasWithBlock:r6,targetMessageSize:n6,...t}}_scheduleProcessTasks(){setTimeout((()=>{this._processTasks()}))}async _processTasks(){if(!this._running)return;const{peerId:t,tasks:e,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===e.length)return;const r=new D3(!1);r.setPendingBytes(n);const i=[],s=new Map;for(const a of e){const t=Me.parse(a.topic);a.data.haveBlock?a.data.isWantBlock?(i.push(t),s.set(a.topic,a.data)):r.addHave(t):r.addDontHave(t)}const o=await this._getBlocks(i);for(const[a,c]of s){const t=Me.parse(a),e=o.get(a);e?r.addBlock(t,e):c.sendDontHave&&r.addDontHave(t)}if(r.empty)return t&&this._requestQueue.tasksDone(t,e),void this._scheduleProcessTasks();try{t&&await this.network.sendMessage(t,r);for(const[e,n]of o.entries())t&&this.messageSent(t,Me.parse(e),n)}catch(uS){this._log.error(uS)}t&&this._requestQueue.tasksDone(t,e),this._scheduleProcessTasks()}wantlistForPeer(t){const e=t.toString(),n=this.ledgerMap.get(e);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(t){const e=t.toString(),n=this.ledgerMap.get(e);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map((t=>t.partner))}receivedBlocks(t){if(t.length){for(const e of this.ledgerMap.values())for(const n of t){const t=e.wantlistContains(n.cid);if(!t)continue;const r=n.data.length,i=this._sendAsBlock(t.wantType,r);let s=r;i||(s=D3.blockPresenceSize(t.cid)),this._requestQueue.pushTasks(e.partner,[{topic:t.cid.toString(Ct),priority:t.priority,size:s,data:{blockSize:r,isWantBlock:i,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(t,e){const n=this._findOrCreate(t);if(e.empty)return;if(e.full&&(n.wantlist=new I3),this._updateBlockAccounting(e.blocks,n),0===e.wantlist.size)return void this._scheduleProcessTasks();const r=[],i=[];e.wantlist.forEach((t=>{t.cancel?(n.cancelWant(t.cid),r.push(t.cid)):(n.wants(t.cid,t.priority,t.wantType),i.push(t))})),this._cancelWants(t,r),await this._addWants(t,i),this._scheduleProcessTasks()}_cancelWants(t,e){for(const n of e)this._requestQueue.remove(n.toString(Ct),t)}async _addWants(t,e){const n=await this._getBlockSizes(e.map((t=>t.cid))),r=[];for(const i of e){const e=i.cid.toString(Ct),s=n.get(e);if(null==s)i.sendDontHave&&r.push({topic:e,priority:i.priority,size:D3.blockPresenceSize(i.cid),data:{isWantBlock:i.wantType===e6.Block,blockSize:0,haveBlock:!1,sendDontHave:i.sendDontHave}});else{const t=this._sendAsBlock(i.wantType,s);let n=s;t||(n=D3.blockPresenceSize(i.cid)),r.push({topic:e,priority:i.priority,size:n,data:{isWantBlock:t,blockSize:s,haveBlock:!0,sendDontHave:i.sendDontHave}})}this._requestQueue.pushTasks(t,r)}}_sendAsBlock(t,e){return t===e6.Block||e<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(t){const e=await this._getBlocks(t);return new Map([...e].map((([t,e])=>[t,e.length])))}async _getBlocks(t){const e=new Map;return await Promise.all(t.map((async t=>{try{const n=await this.blockstore.get(t);e.set(t.toString(Ct),n)}catch(n){"ERR_NOT_FOUND"!==n.code&&this._log.error("failed to query blockstore for %s: %s",t,n)}}))),e}_updateBlockAccounting(t,e){for(const n of t.values())this._log("got block (%s bytes)",n.length),e.receivedBytes(n.length)}messageSent(t,e,n){const r=this._findOrCreate(t);r.sentBytes(n.length),r.wantlist.remove(e)}numBytesSentTo(t){return this._findOrCreate(t).accounting.bytesSent}numBytesReceivedFrom(t){return this._findOrCreate(t).accounting.bytesRecv}peerDisconnected(t){this.ledgerMap.delete(t.toString())}_findOrCreate(t){const e=t.toString(),n=this.ledgerMap.get(e);if(n)return n;const r=new W3(t);return this.ledgerMap.set(e,r),this._stats&&this._stats.push(e,"peerCount",1),r}start(){this._running=!0}stop(){this._running=!1}}const s6=t=>`unwant:${sa(t.multihash.bytes,"base64")}`,o6=t=>`block:${sa(t.multihash.bytes,"base64")}`;class a6 extends Jq.EventEmitter{constructor(t){super(),this.setMaxListeners(x3),this._log=R3(t,"notif")}hasBlock(t,e){const n=o6(t);this._log(n),this.emit(n,e)}wantBlock(t,e={}){if(!t)throw new Error("Not a valid cid");const n=o6(t),r=s6(t);return this._log(`wantBlock:${t}`),new Promise(((i,s)=>{const o=()=>{this.removeListener(n,a),s(new Error(`Block for ${t} unwanted`))},a=t=>{this.removeListener(r,o),i(t)};this.once(r,o),this.once(n,a),e&&e.signal&&e.signal.addEventListener("abort",(()=>{this.removeListener(n,a),this.removeListener(r,o),s(new Error(`Want for ${t} aborted`))}))}))}unwantBlock(t){const e=s6(t);this._log(e),this.emit(e)}}var c6=n(8830);class l6 extends Jq.EventEmitter{constructor(t,e){super(),this._options=e,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),t.forEach((t=>{this._stats[t]=BigInt(0),this._movingAverages[t]={},this._options.movingAverageIntervals.forEach((e=>{const n=this._movingAverages[t][e]=c6(e);n.push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(t,e){this._enabled&&(this._queue.push([t,e,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const t=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-t),0)}_update(){if(this._timeout=null,this._queue.length){let t;while(this._queue.length){const e=t=this._queue.shift();e&&this._applyOp(e)}t&&this._updateFrequency(t[2]),this.emit("update",this._stats)}}_updateFrequency(t){const e=t-this._frequencyLastTime;e&&Object.keys(this._stats).forEach((n=>{this._updateFrequencyFor(n,e,t)})),this._frequencyLastTime=t}_updateFrequencyFor(t,e,n){const r=this._frequencyAccumulators[t]||0;this._frequencyAccumulators[t]=0;const i=r/e*1e3;let s=this._movingAverages[t];s||(s=this._movingAverages[t]={}),this._options.movingAverageIntervals.forEach((t=>{let e=s[t];e||(e=s[t]=c6(t)),e.push(n,i)}))}_applyOp(t){const e=t[0],n=t[1];if("number"!==typeof n)throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,e)||(this._stats[e]=BigInt(0)),this._stats[e]=BigInt(this._stats[e])+BigInt(n),this._frequencyAccumulators[e]||(this._frequencyAccumulators[e]=0),this._frequencyAccumulators[e]+=n}}const u6={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class h6 extends Jq.EventEmitter{constructor(t,e=[],n=u6){super();const r=Object.assign({},u6,n);if("number"!==typeof r.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!==typeof r.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=e,this._options=r,this._enabled=this._options.enabled,this._global=new l6(e,r),this._global.on("update",(t=>this.emit("update",t))),this._peers=IX({system:"ipfs",component:"bitswap",metric:"stats-peers",metrics:t.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const t of this._peers)t[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(t){const e="string"!==typeof t&&t.toString?t.toString():`${t}`;return this._peers.get(e)}push(t,e,n){if(this._enabled&&(this._global.push(e,n),t)){let r=this._peers.get(t);r||(r=new l6(this._initialCounters,this._options),this._peers.set(t,r)),r.push(e,n)}}disconnected(t){const e=t.toString(),n=this._peers.get(e);n&&(n.stop(),this._peers.delete(e))}}const d6={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},f6=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class p6 extends Ox{constructor(t,e,n={}){super(),this._libp2p=t,this._log=R3(this.peerId),this._options=Object.assign({},d6,n),this._stats=new h6(t,f6,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new G3(t,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=e,this.engine=new i6(this.peerId,e,this.network,this._stats,t),this.wm=new F3(this.peerId,this.network,this._stats,t),this.notifications=new a6(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(t,e){try{await this.engine.messageReceived(t,e)}catch(uS){this._log("failed to receive message",e)}if(0===e.blocks.size)return;const n=[];for(const[r,i]of e.blocks.entries()){const t=Me.parse(r);n.push({wasWanted:this.wm.wantlist.contains(t),cid:t,data:i})}this.wm.cancelWants(n.filter((({wasWanted:t})=>t)).map((({cid:t})=>t))),await Promise.all(n.map((({cid:e,wasWanted:n,data:r})=>this._handleReceivedBlock(t,e,r,n))))}async _handleReceivedBlock(t,e,n,r){this._log("received block");const i=await this.blockstore.has(e);this._updateReceiveCounters(t.toString(),e,n,i),r&&await this.put(e,n)}_updateReceiveCounters(t,e,n,r){this._stats.push(t,"blocksReceived",1),this._stats.push(t,"dataReceived",n.length),r&&(this._stats.push(t,"dupBlksReceived",1),this._stats.push(t,"dupDataReceived",n.length))}_receiveError(t){this._log.error("ReceiveError: %s",t.message)}_onPeerConnected(t){this.wm.connected(t)}_onPeerDisconnected(t){this.wm.disconnected(t),this.engine.peerDisconnected(t),this._stats.disconnected(t)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(t,e){return this.engine.wantlistForPeer(t)}ledgerForPeer(t){return this.engine.ledgerForPeer(t)}async get(t,e={}){const n=(t,e)=>(this.wm.wantBlocks([t],e),this.notifications.wantBlock(t,e));let r=!1;const i=async(t,e)=>{try{const n=await this.blockstore.get(t,e);return n}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;return r||(r=!0,this.network.findAndConnect(t,e).catch((t=>this._log.error(t)))),n(t,e)}},s=new AbortController,o=e.signal?(0,al.anySignal)([e.signal,s.signal]):s.signal;try{const e=await Promise.race([this.notifications.wantBlock(t,{signal:o}),i(t,{signal:o})]);return e}finally{s.abort()}}async*getMany(t,e={}){for await(const n of t)yield this.get(n,e)}unwant(t){const e=Array.isArray(t)?t:[t];this.wm.unwantBlocks(e),e.forEach((t=>this.notifications.unwantBlock(t)))}cancelWants(t){this.wm.cancelWants(Array.isArray(t)?t:[t])}async put(t,e,n){await this.blockstore.put(t,e),this._sendHaveBlockNotifications(t,e)}async*putMany(t,e){for await(const{key:n,value:r}of this.blockstore.putMany(t,e))this._sendHaveBlockNotifications(n,r),yield{key:n,value:r}}_sendHaveBlockNotifications(t,e){this.notifications.hasBlock(t,e),this.engine.receivedBlocks([{cid:t,data:e}]),this.network.provide(t).catch((t=>{this._log.error("Failed to provide: %s",t.message)}))}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}}const g6=(t,e,n={})=>new p6(t,e,n);function m6(t){return t=t||new Error("Not Found"),Vt(t,"ERR_NOT_FOUND")}function y6(t){return t=t||new Error("Aborted"),Vt(t,"ERR_ABORTED")}class w6 extends Ox{constructor(t,e){super(),this.child=t,this.bitswap=e}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(t,e,n={}){await this.has(t)||(this.bitswap.isStarted()?await this.bitswap.put(t,e,n):await this.child.put(t,e,n))}async*putMany(t,e={}){const n=tm(t,(async({key:t})=>!await this.has(t)));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,e):yield*this.child.putMany(n,e)}async get(t,e={}){return!await this.has(t)&&this.bitswap.isStarted()?this.bitswap.get(t,e):this.child.get(t,e)}async*getMany(t,e={}){const n=sm({objectMode:!0}),r=sm({objectMode:!0});Promise.resolve().then((async()=>{for await(const e of t)!await this.has(e)&&this.bitswap.isStarted()?n.push(e):r.push(e);n.end(),r.end()})),yield*gm(this.bitswap.getMany(n,e),this.child.getMany(r,e))}async delete(t,e){await this.child.delete(t,e)}async*deleteMany(t,e){yield*this.child.deleteMany(t,e)}async has(t,e={}){return this.child.has(t,e)}async*query(t,e={}){yield*this.child.query(t,e)}async*queryKeys(t,e={}){yield*this.child.queryKeys(t,e)}}class b6{constructor(t,e,n,r,i){this.peerId=t,this.libp2p=e,this.bitswap=n,this.repo=r,this.blockstore=i}static async start({peerId:t,repo:e,print:n,hashers:r,options:i}){e.closed&&await e.open();const s=await e.config.getAll(),o=await n3({options:i,repo:e,peerId:t,multiaddrs:v6(t,s),config:s,keychainConfig:void 0});await o.start();for(const l of o.getMultiaddrs())n(`Swarm listening on ${l.toString()}`);const a=g6(o,e.blocks,{statsEnabled:!0,hashLoader:r,maxInboundStreams:1024,maxOutboundStreams:1024});await a.start();const c=new w6(e.blocks,a);return e.blocks=c,e.pins.blockstore=c,new b6(t,o,a,e,c)}static async stop(t){t.repo.blocks=t.blockstore.unwrap(),t.repo.pins.blockstore=t.blockstore.unwrap(),await t.bitswap.stop(),await t.libp2p.stop()}}const v6=(t,e)=>{const n=t.toString(),r=[],i=e.Addresses&&e.Addresses.Swarm||[];for(const s of i){let t=dc(s);if(t.protoCodes().includes(E6))throw Vt(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");const e=t.getPeerId();e&&e!==n&&(t=t.encapsulate(`/p2p/${n}`)),r.push(t)}return r},E6=479;function _6({network:t}){async function e(e={}){const n=[],{libp2p:r}=await t.use(e);return await r.peerStore.forEach((t=>{n.push({id:t.id,addrs:t.addresses.map((t=>t.multiaddr))})})),n}return fl(e)}function S6({network:t}){async function e(e,n={}){const{libp2p:r}=await t.use(n);await r.dial(e,n)}return fl(e)}function A6({network:t}){async function e(e,n={}){const{libp2p:r}=await t.use(n);await r.hangUp(e)}return fl(e)}function C6({network:t}){async function e(e={}){const{libp2p:n}=await t.use(e);return n.getMultiaddrs()}return fl(e)}function I6({network:t}){async function e(e={}){const{libp2p:n}=await t.use(e);if(e.verbose){const t=[];for(const r of n.getConnections()){const n={addr:r.remoteAddr,peer:r.remotePeer};(e.verbose||e.direction)&&(n.direction=r.stat.direction),e.verbose&&(n.muxer=r.stat.multiplexer,n.latency="n/a",n.streams=[]),t.push(n)}return t}const r=new Map;for(const t of n.getConnections()){const e={addr:t.remoteAddr,peer:t.remotePeer};r.set(t.remotePeer.toString(),e)}return Array.from(r.values())}return fl(e)}class T6{constructor({network:t}){this.addrs=_6({network:t}),this.connect=S6({network:t}),this.disconnect=A6({network:t}),this.localAddrs=C6({network:t}),this.peers=I6({network:t})}}const k6={success:!0,time:0,text:""};function R6({network:t}){async function*e(e,n={}){const{libp2p:r}=await t.use();n.count=n.count||10;const i=await r.peerStore.get(e);let s=i&&i.id;if(!s){yield{...k6,text:`Looking up peer ${e}`};const t=await r.peerRouting.findPeer(e);s=t&&t.id}if(!s)throw new Error("Peer was not found");yield{...k6,text:`PING ${s.toString()}`};let o=0,a=0;for(let t=0;t<n.count;t++)try{const t=await r.ping(s);a+=t,o++,yield{...k6,time:t}}catch(uS){yield{...k6,success:!1,text:uS.toString()}}if(o){const t=a/o;yield{...k6,text:`Average latency: ${t}ms`}}}return fl(e)}const N6="/ipns/";function D6(t){let e;if(t.startsWith(N6)&&(t=t.substring(N6.length)),"1"!==t[0]&&"Q"!==t[0]||(t=`z${t}`),"z"===t[0]&&(e=Ct.decode(t)),"k"===t[0]&&(e=no.decode(t)),!e)throw new Error("Could not parse string");if(1!==e[0]&&114!==e[1]&&(e=ya([[1,114],e])),40!==e.length)throw new Error("Incorrect length "+e.length);return ya([Ho(N6),e.subarray(2)])}function O6({network:t,repo:e,peerId:n}){const{get:r,put:i,findProvs:s,findPeer:o,provide:a,query:c}={async*get(e,r={}){const{libp2p:i}=await P6(t,n,r),s=e instanceof Uint8Array?e:D6(e);if(null==i.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.get(s,r)},async*put(e,r,i){const{libp2p:s}=await P6(t,n,i),o=e instanceof Uint8Array?e:D6(e);if(null==s.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.put(o,r,i)},async*findProvs(e,r={}){const{libp2p:i}=await P6(t,n,r);if(null==i.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.findProviders(e,{signal:r.signal})},async*findPeer(e,r={}){const{libp2p:i}=await P6(t,n,r);if(null==i.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.findPeer(e,{signal:r.signal})},async*provide(r,i={recursive:!1}){const{libp2p:s}=await P6(t,n,i),o=await e.blocks.has(r);if(!o)throw Vt(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(i.recursive)throw Vt(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(null==s.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.provide(r)},async*query(e,r={}){const{libp2p:i}=await P6(t,n,r);let s;const o=Me.asCID(e);if(s=null!=o?o.multihash.bytes:zu(e.toString()).toBytes(),null==i.dht)throw Vt(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.getClosestPeers(s,r)}};return{get:fl(r),put:fl(i),findProvs:fl(s),findPeer:fl(o),provide:fl(a),query:fl(c)}}const P6=async(t,e,n)=>{const r=await t.use(n);if(null!=r.libp2p.dht)return r;{const t=async function*(){yield{from:e,name:"QUERY_ERROR",type:3,error:new xo("dht not enabled")}};return{libp2p:{dht:{get:t,put:t,findProviders:t,findPeer:t,provide:t,getClosestPeers:t}}}}};function x6({network:t,config:e}){const n=um(e||{},"Pubsub.Enabled",!0),r={};let i;return{subscribe:n?fl(s):M6,unsubscribe:n?fl(o):M6,publish:n?fl(a):M6,ls:n?fl(c):M6,peers:n?fl(l):M6};async function s(e,n,s={}){const{libp2p:o}=await t.use(s);o.pubsub.subscribe(e),null==i&&(i=t=>{const e=t.detail;r[e.topic]&&r[e.topic].forEach((t=>{"function"!==typeof t?null!=t&&null!=t.handleEvent&&t.handleEvent(e):t(e)}))},o.pubsub.addEventListener("message",i)),null!=n&&(null==r[e]&&(r[e]=[]),r[e].push(n))}async function o(e,n,s={}){const{libp2p:o}=await t.use(s);null!=n&&null!=r[e]&&(r[e]=r[e].filter((t=>t!==n)),0===r[e].length&&delete r[e]),"function"!==typeof n&&delete r[e],null==r[e]&&o.pubsub.unsubscribe(e),0===Object.keys(r).length&&(o.pubsub.removeEventListener("message",i),i=void 0)}async function a(e,n,r={}){const{libp2p:i}=await t.use(r);if(!n)throw Vt(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await i.pubsub.publish(e,n)}async function c(e={}){const{libp2p:n}=await t.use(e);return n.pubsub.getTopics()}async function l(e,n={}){const{libp2p:r}=await t.use(n);return r.pubsub.getSubscribers(e)}}const M6=async()=>{throw new xo("pubsub not enabled")},L6=nt.bind({ignoreUndefined:!0}),B6=zt("ipfs"),U6=3e4;class F6{constructor({print:t,storage:e,codecs:n,options:r}){const{peerId:i,repo:s,keychain:o}=e,a=Il.create(b6),c=Tk(r.preload),l=Iu(),u=Tu({network:a}),h=new Fm(r),d=Object.values(Co);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach((t=>d.push(t))),this.hashers=new xV({hashers:d,loadHasher:r.ipld&&r.ipld.loadHasher});const f=Object.values(Ao);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach((t=>f.push(t))),this.bases=new NV({bases:f,loadBase:r.ipld&&r.ipld.loadBase});const p=new nh({repo:s,codecs:n}),g=new Py({codecs:n,hashers:this.hashers,preload:c,repo:s}),m=new Zm({dns:l,ipns:h,repo:s,codecs:n,peerId:i,isOnline:u,keychain:o,options:r}),y=$u({repo:s,codecs:n,bases:this.bases,name:m}),w=new mk({repo:s,codecs:n,hashers:this.hashers,preload:c}),b=Object.assign(ny({repo:s,codecs:n,resolve:y,preload:c}),{local:ly({repo:e.repo})}),{add:v,addAll:E,cat:_,get:S,ls:A}=new nT({preload:c,repo:s,options:r.EXPERIMENTAL,hashers:this.hashers}),C=ZN({repo:s,preload:c,hashers:this.hashers,options:r}),I=Rk({files:C,preload:c,options:r.preload});this.preload=c,this.name=m,this.ipns=h,this.pin=p,this.resolve=y,this.block=g,this.refs=b,this.start=Tl({network:a,peerId:i,repo:s,preload:c,ipns:h,mfsPreload:I,print:t,keychain:o,hashers:this.hashers,options:r}),this.stop=kl({network:a,preload:c,mfsPreload:I,ipns:h,repo:s}),this.dht=O6({network:a,repo:s,peerId:i}),this.pubsub=x6({network:a,config:r.config}),this.dns=l,this.isOnline=u,this.id=cT({network:a,peerId:i}),this.version=oT({repo:s}),this.bitswap=new py({network:a}),this.bootstrap=new _y({repo:s}),this.config=mT({repo:s}),this.ping=R6({network:a}),this.add=v,this.addAll=E,this.cat=_,this.get=S,this.ls=A,this.dag=w,this.files=C,this.key=new lD({keychain:o}),this.object=new _D({preload:c,codecs:n,repo:s}),this.repo=new kD({repo:s,hashers:this.hashers}),this.stats=new DD({repo:s,network:a}),this.swarm=new T6({network:a}),Object.defineProperty(this,"libp2p",{get(){const t=a.try();return t?t.libp2p:void 0}});const T=()=>Promise.reject(Vt(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")),k=async function*(){throw Vt(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};this.commands=T,this.diag={cmds:T,net:T,sys:T},this.log={level:T,ls:T,tail:k},this.mount=T,this.codecs=n}async init(){throw new No}}const z6=async t=>{const e=bn({Data:new ee({type:"directory"}).marshal(),Links:[]}),n=await t.block.put(e,{mhtype:"sha2-256",format:"dag-pb"});return await t.pin.add(n),n},V6=()=>({start:!0,EXPERIMENTAL:{},preload:{enabled:!rt.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}});async function j6(t={}){t=L6(V6(),t);const e=t.init||{},n={name:Ys.name,code:Ys.code,encode:t=>t,decode:t=>t},r=Object.values(Io);[o,a,c,l,n].concat(t.ipld&&t.ipld.codecs||[]).forEach((t=>r.push(t)));const i=new OV({codecs:r,loadCodec:t.ipld&&t.ipld.loadCodec}),s=t.silent?B6:console.log;B6("creating repo");const u=await o3.start(s,i,t);B6("getting repo config");const h=await u.repo.config.getAll(),d=new F6({storage:u,print:s,codecs:i,options:{...t,config:h}});if(B6("starting preload"),await d.preload.start(),B6("starting storage"),d.ipns.startOffline(u),u.isNew&&!e.emptyRepo){const t=await z6(d);if(B6("adding default assets"),await To({addAll:d.addAll,print:s}),B6("initializing IPNS keyspace"),null==u.peerId.publicKey)throw Vt(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");const e=new $o.TimeoutController(U6);try{await d.ipns.initializeKeyspace(u.peerId,Ho(`/ipfs/${t}`),{signal:e.signal})}finally{e.clear()}}return!1!==t.start&&(B6("starting node"),await d.start()),d}n(5057);const H6=j6},7601:function(t,e,n){"use strict";n.d(e,{Ui:function(){return Pe}});n(3767),n(8585),n(8696),n(7658),n(2801);var r=n(3248);function i(t){return t||(t={}),{delay:void 0===t.delay?200:t.delay,initialDelay:void 0===t.initialDelay?0:t.initialDelay,minDelay:void 0===t.minDelay?0:t.minDelay,maxDelay:void 0===t.maxDelay?0:t.maxDelay,factor:void 0===t.factor?0:t.factor,maxAttempts:void 0===t.maxAttempts?3:t.maxAttempts,timeout:void 0===t.timeout?0:t.timeout,jitter:!0===t.jitter,handleError:void 0===t.handleError?null:t.handleError,handleTimeout:void 0===t.handleTimeout?null:t.handleTimeout,beforeAttempt:void 0===t.beforeAttempt?null:t.beforeAttempt,calculateDelay:void 0===t.calculateDelay?null:t.calculateDelay}}async function s(t){return new Promise(((e,n)=>{setTimeout(e,t)}))}function o(t,e){let n=e.delay;if(0===n)return 0;if(e.factor&&(n*=Math.pow(e.factor,t.attemptNum-1),0!==e.maxDelay&&(n=Math.min(n,e.maxDelay))),e.jitter){const t=Math.ceil(e.minDelay),r=Math.floor(n);n=Math.floor(Math.random()*(r-t+1))+t}return Math.round(n)}async function a(t,e){const n=i(e);for(const i of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){const t=n[i];if(!Number.isInteger(t)||t<0)throw new Error(`Value for ${i} must be an integer greater than or equal to 0`)}if(n.factor.constructor!==Number||n.factor<0)throw new Error("Value for factor must be a number greater than or equal to 0");if(n.delay<n.minDelay)throw new Error(`delay cannot be less than minDelay (delay: ${n.delay}, minDelay: ${n.minDelay}`);const r={attemptNum:0,attemptsRemaining:n.maxAttempts?n.maxAttempts:-1,aborted:!1,abort(){r.aborted=!0}},a=n.calculateDelay||o;async function c(){if(n.beforeAttempt&&n.beforeAttempt(r,n),r.aborted){const t=new Error("Attempt aborted");throw t.code="ATTEMPT_ABORTED",t}const e=async t=>{if(n.handleError&&await n.handleError(t,r,n),r.aborted||0===r.attemptsRemaining)throw t;r.attemptNum++;const e=a(r,n);return e&&await s(e),c()};return r.attemptsRemaining>0&&r.attemptsRemaining--,n.timeout?new Promise(((i,s)=>{const o=setTimeout((()=>{if(n.handleTimeout)try{i(n.handleTimeout(r,n))}catch(t){s(t)}else{const t=new Error(`Retry timeout (attemptNum: ${r.attemptNum}, timeout: ${n.timeout})`);t.code="ATTEMPT_TIMEOUT",s(t)}}),n.timeout);t(r,n).then((t=>{clearTimeout(o),i(t)})).catch((t=>{clearTimeout(o),e(t).then(i).catch(s)}))})):t(r,n).catch(e)}const l=n.calculateDelay?n.calculateDelay(r,n):n.initialDelay;return l&&await s(l),c()}const c=t=>t.toLowerCase(),l=/^\s*/g,u=t=>t.replace(l,""),h=/([A-Z])/g,d=(t,e)=>u(t.replace(h,(t=>`${e}${c(t)}`)));"undefined"!==typeof TextEncoder&&new TextEncoder;let f="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});f&&1===f.decode(new Uint8Array).length&&(f=null);const p=()=>new Map,g=t=>void 0===t?null:t;class m{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let y=new m,w=!0;try{"undefined"!==typeof localStorage&&(y=localStorage,w=!1)}catch(xe){}const b=y,v="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name);let E;"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);const _=()=>{if(void 0===E)if(v){E=p();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];"-"===r[0]?(null!==e&&E.set(e,""),e=r):null!==e&&(E.set(e,r),e=null)}null!==e&&E.set(e,"")}else"object"===typeof location?(E=p(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");E.set(`--${d(e,"-")}`,n),E.set(`-${d(e,"-")}`,n)}}))):E=p();return E},S=t=>_().has(t),A=t=>g(v?{NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}[t.toUpperCase()]:b.getItem(t)),C=t=>S("--"+t)||null!==A(t);C("production");const I=128,T=127,k=t=>t.arr[t.pos++],R=t=>{let e=0,n=0;while(1){const r=t.arr[t.pos++];if(e|=(r&T)<<n,n+=7,r<I)return e>>>0;if(n>35)throw new Error("Integer out of range!")}},N=t=>{let e=R(t);if(0===e)return"";{let n=String.fromCodePoint(k(t));if(--e<100)while(e--)n+=String.fromCodePoint(k(t));else while(e>0){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},D=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},O=(t,e)=>{while(e>T)D(t,I|T&e),e>>>=7;D(t,T&e)},P=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;O(t,r);for(let i=0;i<r;i++)D(t,n.codePointAt(i))};var x;(function(t){t[t["Token"]=0]="Token",t[t["PermissionDenied"]=1]="PermissionDenied",t[t["Authenticated"]=2]="Authenticated"})(x||(x={}));const M=(t,e)=>{O(t,x.Token),P(t,e)},L=(t,e,n)=>{switch(R(t)){case x.PermissionDenied:e(N(t));break;case x.Authenticated:n();break}},B={code:4401,reason:"Unauthorized"},U={code:4403,reason:"Forbidden"},F=t=>Array.from(t.entries()).map((([t,e])=>({clientId:t,...e})));var z;(function(t){t[t["Connecting"]=0]="Connecting",t[t["Open"]=1]="Open",t[t["Closing"]=2]="Closing",t[t["Closed"]=3]="Closed"})(z||(z={}));const V=()=>new Map,j=(t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r},H=String.fromCharCode,$=t=>t.toLowerCase(),K=/^\s*/g,G=t=>t.replace(K,""),q=/([A-Z])/g,W=(t,e)=>G(t.replace(q,(t=>`${e}${$(t)}`)));"undefined"!==typeof TextEncoder&&new TextEncoder;let Y="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Y&&1===Y.decode(new Uint8Array).length&&(Y=null);const X=t=>void 0===t?null:t;class Q{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let J=new Q,Z=!0;try{"undefined"!==typeof localStorage&&(J=localStorage,Z=!1)}catch(xe){}const tt=J,et=t=>Z||addEventListener("storage",t),nt="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name),rt="undefined"!==typeof window&&!nt;let it;"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);const st=()=>{if(void 0===it)if(nt){it=V();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];"-"===r[0]?(null!==e&&it.set(e,""),e=r):null!==e&&(it.set(e,r),e=null)}null!==e&&it.set(e,"")}else"object"===typeof location?(it=V(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");it.set(`--${W(e,"-")}`,n),it.set(`-${W(e,"-")}`,n)}}))):it=V();return it},ot=t=>st().has(t),at=t=>X(nt?{NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}[t.toUpperCase()]:tt.getItem(t)),ct=t=>ot("--"+t)||null!==at(t);ct("production");const lt=Math.floor,ut=(t,e)=>t<e?t:e,ht=(t,e)=>t>e?t:e,dt=128,ft=127;class pt{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const gt=()=>new pt,mt=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},yt=t=>{const e=new Uint8Array(mt(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(Dt(t.cbuf.buffer,0,t.cpos),n),e},wt=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},bt=(t,e)=>{while(e>ft)wt(t,dt|ft&e),e>>>=7;wt(t,ft&e)},vt=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;bt(t,r);for(let i=0;i<r;i++)wt(t,n.codePointAt(i))},Et=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=ut(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(ht(2*n,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},_t=(t,e)=>{bt(t,e.byteLength),Et(t,e)};class St{constructor(t){this.arr=t,this.pos=0}}const At=t=>new St(t),Ct=(t,e)=>{const n=Dt(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},It=t=>Ct(t,kt(t)),Tt=t=>t.arr[t.pos++],kt=t=>{let e=0,n=0;while(1){const r=t.arr[t.pos++];if(e|=(r&ft)<<n,n+=7,r<dt)return e>>>0;if(n>35)throw new Error("Integer out of range!")}},Rt=t=>{let e=kt(t);if(0===e)return"";{let n=String.fromCodePoint(Tt(t));if(--e<100)while(e--)n+=String.fromCodePoint(Tt(t));else while(e>0){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},Nt=t=>new Uint8Array(t),Dt=(t,e,n)=>new Uint8Array(t,e,n),Ot=t=>new Uint8Array(t),Pt=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=H(t[n]);return btoa(e)},xt=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),Mt=t=>{const e=atob(t),n=Nt(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},Lt=t=>{const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},Bt=rt?Pt:xt,Ut=rt?Mt:Lt,Ft=new Map;class zt{constructor(t){this.room=t,this.onmessage=null,et((e=>e.key===t&&null!==this.onmessage&&this.onmessage({data:Ut(e.newValue||"")})))}postMessage(t){tt.setItem(this.room,Bt(Ot(t)))}}const Vt="undefined"===typeof BroadcastChannel?zt:BroadcastChannel,jt=t=>j(Ft,t,(()=>{const e=new Set,n=new Vt(t);return n.onmessage=t=>e.forEach((e=>e(t.data))),{bc:n,subs:e}})),Ht=(t,e)=>jt(t).subs.add(e),$t=(t,e)=>jt(t).subs.delete(e),Kt=(t,e)=>{const n=jt(t);n.bc.postMessage(e),n.subs.forEach((t=>t(e)))},Gt=Date.now,qt=()=>new Set,Wt=Array.from;class Yt{constructor(){this._observers=V()}on(t,e){j(this._observers,t,qt).add(e)}once(t,e){const n=(...r)=>{this.off(t,n),e(...r)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return Wt((this._observers.get(t)||V()).values()).forEach((t=>t(...e)))}destroy(){this._observers=V()}}const Xt=Object.keys,Qt=(t,e)=>{const n=[];for(const r in t)n.push(e(t[r],r));return n},Jt=t=>Xt(t).length,Zt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),te=(t,e)=>t===e,ee=(t,e)=>{if(null==t||null==e)return te(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break;case Set:if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break;case Map:if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!ee(t.get(n),e.get(n)))return!1;break;case Object:if(Jt(t)!==Jt(e))return!1;for(const n in t)if(!Zt(t,n)||!ee(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!ee(t[n],e[n]))return!1;break;default:return!1}return!0},ne=3e4;class re extends Yt{constructor(t){super(),this.doc=t,this.clientID=t.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const t=Gt();null!==this.getLocalState()&&ne/2<=t-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const e=[];this.meta.forEach(((n,r)=>{r!==this.clientID&&ne<=t-n.lastUpdated&&this.states.has(r)&&e.push(r)})),e.length>0&&ie(this,e,"timeout")}),lt(ne/10)),t.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(t){const e=this.clientID,n=this.meta.get(e),r=void 0===n?0:n.clock+1,i=this.states.get(e);null===t?this.states.delete(e):this.states.set(e,t),this.meta.set(e,{clock:r,lastUpdated:Gt()});const s=[],o=[],a=[],c=[];null===t?c.push(e):null==i?null!=t&&s.push(e):(o.push(e),ee(i,t)||a.push(e)),(s.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:s,updated:a,removed:c},"local"]),this.emit("update",[{added:s,updated:o,removed:c},"local"])}setLocalStateField(t,e){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[t]:e})}getStates(){return this.states}}const ie=(t,e,n)=>{const r=[];for(let i=0;i<e.length;i++){const n=e[i];if(t.states.has(n)){if(t.states.delete(n),n===t.clientID){const e=t.meta.get(n);t.meta.set(n,{clock:e.clock+1,lastUpdated:Gt()})}r.push(n)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},se=(t,e,n=t.states)=>{const r=e.length,i=gt();bt(i,r);for(let s=0;s<r;s++){const r=e[s],o=n.get(r)||null,a=t.meta.get(r).clock;bt(i,r),bt(i,a),vt(i,JSON.stringify(o))}return yt(i)},oe=(t,e,n)=>{const r=At(e),i=Gt(),s=[],o=[],a=[],c=[],l=kt(r);for(let u=0;u<l;u++){const e=kt(r);let n=kt(r);const l=JSON.parse(Rt(r)),u=t.meta.get(e),h=t.states.get(e),d=void 0===u?0:u.clock;(d<n||d===n&&null===l&&t.states.has(e))&&(null===l?e===t.clientID&&null!=t.getLocalState()?n++:t.states.delete(e):t.states.set(e,l),t.meta.set(e,{clock:n,lastUpdated:i}),void 0===u&&null!==l?s.push(e):void 0!==u&&null===l?c.push(e):null!==l&&(ee(l,h)||a.push(e),o.push(e)))}(s.length>0||a.length>0||c.length>0)&&t.emit("change",[{added:s,updated:a,removed:c},n]),(s.length>0||o.length>0||c.length>0)&&t.emit("update",[{added:s,updated:o,removed:c},n])},ae=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else void 0!==n&&n()}},ce=t=>Qt(t,((t,e)=>`${encodeURIComponent(e)}=${encodeURIComponent(t)}`)).join("&");class le{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach((t=>t.apply(this,e))),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter((t=>t!==e)):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}class ue{constructor(t){this.data=t,this.encoder=gt(),this.decoder=At(new Uint8Array(this.data))}readVarUint(){return kt(this.decoder)}readVarUint8Array(){return It(this.decoder)}writeVarUint(t){return bt(this.encoder,t)}writeVarUint8Array(t){return _t(this.encoder,t)}length(){return mt(this.encoder)}}const he=0,de=1,fe=2,pe=(t,e)=>{bt(t,he);const n=r.gJ(e);_t(t,n)},ge=(t,e,n)=>{bt(t,de),_t(t,r.D$(e,n))},me=(t,e,n)=>ge(e,n,It(t)),ye=(t,e,n)=>{try{r.NG(e,It(t),n)}catch(i){console.error("Caught error while handling a Yjs update",i)}},we=(t,e)=>{bt(t,fe),_t(t,e)},be=ye,ve=(t,e,n,r)=>{const i=kt(t);switch(i){case he:me(t,e,n);break;case de:ye(t,n,r);break;case fe:be(t,n,r);break;default:throw new Error("Unknown message type")}return i};var Ee,_e;(function(t){t[t["Sync"]=0]="Sync",t[t["Awareness"]=1]="Awareness",t[t["Auth"]=2]="Auth",t[t["QueryAwareness"]=3]="QueryAwareness",t[t["Stateless"]=5]="Stateless"})(Ee||(Ee={})),function(t){t["Connecting"]="connecting",t["Connected"]="connected",t["Disconnected"]="disconnected"}(_e||(_e={}));class Se{constructor(){this.encoder=gt()}get(t){return t.encoder}toUint8Array(){return yt(this.encoder)}}class Ae{constructor(t){this.broadcasted=!1,this.message=t}setBroadcasted(t){return this.broadcasted=t,this}apply(t,e=!0){const{message:n}=this,r=n.readVarUint();switch(r){case Ee.Sync:this.applySyncMessage(t,e);break;case Ee.Awareness:this.applyAwarenessMessage(t);break;case Ee.Auth:this.applyAuthMessage(t);break;case Ee.QueryAwareness:this.applyQueryAwarenessMessage(t);break;case Ee.Stateless:t.receiveStateless(Rt(n.decoder));break;default:throw new Error(`Can’t apply message of unknown type: ${r}`)}n.length()>1&&(this.broadcasted?t.broadcast(Se,{encoder:n.encoder}):t.send(Se,{encoder:n.encoder}))}applySyncMessage(t,e){const{message:n}=this;n.writeVarUint(Ee.Sync);const r=ve(n.decoder,n.encoder,t.document,t);e&&r===de&&(t.synced=!0),r!==fe&&r!==de||t.unsyncedChanges>0&&(t.unsyncedChanges-=1)}applyAwarenessMessage(t){const{message:e}=this;oe(t.awareness,e.readVarUint8Array(),t)}applyAuthMessage(t){const{message:e}=this;L(e.decoder,t.permissionDeniedHandler.bind(t),t.authenticatedHandler.bind(t))}applyQueryAwarenessMessage(t){const{message:e}=this;e.writeVarUint(Ee.Awareness),e.writeVarUint8Array(se(t.awareness,Array.from(t.awareness.getStates().keys())))}}class Ce{constructor(t,e={}){this.message=new t,this.encoder=this.message.get(e)}create(){return yt(this.encoder)}send(t){null===t||void 0===t||t.send(this.create())}broadcast(t){Kt(t,this.create())}}class Ie extends Se{constructor(){super(...arguments),this.type=Ee.Sync,this.description="First sync step"}get(t){if("undefined"===typeof t.document)throw new Error("The sync step one message requires document as an argument");return bt(this.encoder,this.type),pe(this.encoder,t.document),this.encoder}}class Te extends Se{constructor(){super(...arguments),this.type=Ee.Sync,this.description="Second sync step"}get(t){if("undefined"===typeof t.document)throw new Error("The sync step two message requires document as an argument");return bt(this.encoder,this.type),ge(this.encoder,t.document),this.encoder}}class ke extends Se{constructor(){super(...arguments),this.type=Ee.QueryAwareness,this.description="Queries awareness states"}get(t){return bt(this.encoder,this.type),this.encoder}}class Re extends Se{constructor(){super(...arguments),this.type=Ee.Auth,this.description="Authentication"}get(t){if("undefined"===typeof t.token)throw new Error("The authentication message requires `token` as an argument.");return bt(this.encoder,this.type),M(this.encoder,t.token),this.encoder}}class Ne extends Se{constructor(){super(...arguments),this.type=Ee.Awareness,this.description="Awareness states update"}get(t){if("undefined"===typeof t.awareness)throw new Error("The awareness message requires awareness as an argument");if("undefined"===typeof t.clients)throw new Error("The awareness message requires clients as an argument");let e;return bt(this.encoder,this.type),e=void 0===t.states?se(t.awareness,t.clients):se(t.awareness,t.clients,t.states),_t(this.encoder,e),this.encoder}}class De extends Se{constructor(){super(...arguments),this.type=Ee.Sync,this.description="A document update"}get(t){return bt(this.encoder,this.type),we(this.encoder,t.update),this.encoder}}class Oe extends Se{constructor(){super(...arguments),this.type=Ee.Stateless,this.description="A stateless message"}get(t){var e;return bt(this.encoder,this.type),vt(this.encoder,null!==(e=t.payload)&&void 0!==e?e:""),this.encoder}}class Pe extends le{constructor(t){super(),this.configuration={name:"",url:"",document:void 0,awareness:void 0,WebSocketPolyfill:void 0,token:null,parameters:{},connect:!0,broadcast:!0,forceSyncInterval:!1,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onSynced:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,quiet:!1},this.subscribedToBroadcastChannel=!1,this.webSocket=null,this.shouldConnect=!0,this.status=_e.Disconnected,this.isSynced=!1,this.unsyncedChanges=0,this.isAuthenticated=!1,this.lastMessageReceived=0,this.mux=ae(),this.intervals={forceSync:null,connectionChecker:null},this.connectionAttempt=null,this.boundConnect=this.connect.bind(this),this.boundBeforeUnload=this.beforeUnload.bind(this),this.boundBroadcastChannelSubscriber=this.broadcastChannelSubscriber.bind(this),this.setConfiguration(t),this.configuration.document=t.document?t.document:new r.QW,this.configuration.awareness=t.awareness?t.awareness:new re(this.document),this.configuration.WebSocketPolyfill=t.WebSocketPolyfill?t.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("status",this.configuration.onStatus),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.awareness.on("update",(()=>{this.emit("awarenessUpdate",{states:F(this.awareness.getStates())})})),this.awareness.on("change",(()=>{this.emit("awarenessChange",{states:F(this.awareness.getStates())})})),this.document.on("update",this.documentUpdateHandler.bind(this)),this.awareness.on("update",this.awarenessUpdateHandler.bind(this)),this.registerEventListeners(),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),this.configuration.forceSyncInterval&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),"undefined"!==typeof t.connect&&(this.shouldConnect=t.connect),this.shouldConnect&&this.connect()}setConfiguration(t={}){this.configuration={...this.configuration,...t}}async connect(){if(this.status===_e.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.unsyncedChanges=0,this.shouldConnect=!0,this.subscribeToBroadcastChannel();const t=()=>{let t=!1;const e=a(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,beforeAttempt:e=>{this.shouldConnect&&!t||e.abort()}}).catch((t=>{if(t&&"ATTEMPT_ABORTED"!==t.code)throw t}));return{retryPromise:e,cancelFunc:()=>{t=!0}}},{retryPromise:e,cancelFunc:n}=t();return this.cancelWebsocketRetry=n,e}createWebSocketConnection(){return new Promise(((t,e)=>{this.webSocket&&(this.webSocket.close(),this.webSocket=null);const n=new this.configuration.WebSocketPolyfill(this.url);n.binaryType="arraybuffer",n.onmessage=this.onMessage.bind(this),n.onclose=this.onClose.bind(this),n.onopen=this.onOpen.bind(this),n.onerror=t=>{e(t)},this.webSocket=n,this.synced=!1,this.status=_e.Connecting,this.emit("status",{status:_e.Connecting}),this.connectionAttempt={resolve:t,reject:e}}))}resolveConnectionAttempt(){var t;null===(t=this.connectionAttempt)||void 0===t||t.resolve(),this.connectionAttempt=null,this.status=_e.Connected,this.emit("status",{status:_e.Connected}),this.emit("connect")}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var t;null===(t=this.connectionAttempt)||void 0===t||t.reject(),this.connectionAttempt=null}get document(){return this.configuration.document}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}checkConnection(){var t;this.status===_e.Connected&&this.lastMessageReceived&&(this.configuration.messageReconnectTimeout>=Gt()-this.lastMessageReceived||null===(t=this.webSocket)||void 0===t||t.close())}forceSync(){this.webSocket&&this.send(Ie,{document:this.document})}beforeUnload(){ie(this.awareness,[this.document.clientID],"window unload")}registerEventListeners(){"undefined"!==typeof window&&(window.addEventListener("online",this.boundConnect),window.addEventListener("beforeunload",this.boundBeforeUnload))}sendStateless(t){this.send(Oe,{payload:t})}documentUpdateHandler(t,e){e!==this&&(this.unsyncedChanges+=1,this.send(De,{update:t},!0))}awarenessUpdateHandler({added:t,updated:e,removed:n},r){const i=t.concat(e).concat(n);this.send(Ne,{awareness:this.awareness,clients:i},!0)}permissionDeniedHandler(t){this.emit("authenticationFailed",{reason:t}),this.isAuthenticated=!1,this.shouldConnect=!1}authenticatedHandler(){this.isAuthenticated=!0,this.emit("authenticated"),this.startSync()}get serverUrl(){while("/"===this.configuration.url[this.configuration.url.length-1])return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){const t=ce(this.configuration.parameters);return`${this.serverUrl}/${this.configuration.name}${0===t.length?"":`?${t}`}`}get synced(){return this.isSynced}set synced(t){this.isSynced!==t&&(this.isSynced=t,this.emit("synced",{state:t}),this.emit("sync",{state:t}))}receiveStateless(t){this.emit("stateless",{payload:t})}get isAuthenticationRequired(){return!!this.configuration.token&&!this.isAuthenticated}disconnect(){if(this.shouldConnect=!1,this.disconnectBroadcastChannel(),null!==this.webSocket)try{this.webSocket.close()}catch{}}async onOpen(t){this.emit("open",{event:t}),this.isAuthenticationRequired?this.send(Re,{token:await this.getToken()}):this.startSync()}async getToken(){if("function"===typeof this.configuration.token){const t=await this.configuration.token();return t}return this.configuration.token}startSync(){this.send(Ie,{document:this.document}),null!==this.awareness.getLocalState()&&this.send(Ne,{awareness:this.awareness,clients:[this.document.clientID]})}send(t,e,n=!1){var r;if(n&&this.mux((()=>{this.broadcast(t,e)})),(null===(r=this.webSocket)||void 0===r?void 0:r.readyState)===z.Open){const n=new Ce(t,e);this.emit("outgoingMessage",{message:n.message}),n.send(this.webSocket)}}onMessage(t){this.resolveConnectionAttempt(),this.lastMessageReceived=Gt();const e=new ue(t.data);this.emit("message",{event:t,message:e}),new Ae(e).apply(this)}onClose(t){this.emit("close",{event:t}),this.webSocket=null,this.isAuthenticated=!1,this.synced=!1,this.status===_e.Connected&&(ie(this.awareness,Array.from(this.awareness.getStates().keys()).filter((t=>t!==this.document.clientID)),this),this.status=_e.Disconnected,this.emit("status",{status:_e.Disconnected}),this.emit("disconnect",{event:t})),t.code===B.code&&(this.configuration.quiet||console.warn("[HocuspocusProvider] An authentication token is required, but you didn’t send one. Try adding a `token` to your HocuspocusProvider configuration. Won’t try again."),this.shouldConnect=!1),t.code===U.code&&(this.configuration.quiet||console.warn("[HocuspocusProvider] The provided authentication token isn’t allowed to connect to this server. Will try again.")),this.connectionAttempt?this.rejectConnectionAttempt():this.shouldConnect&&this.connect(),this.shouldConnect||this.status!==_e.Disconnected&&(this.status=_e.Disconnected,this.emit("status",{status:_e.Disconnected}),this.emit("disconnect",{event:t}))}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),clearInterval(this.intervals.connectionChecker),ie(this.awareness,[this.document.clientID],"provider destroy"),this.stopConnectionAttempt(),this.disconnect(),this.awareness.off("update",this.awarenessUpdateHandler),this.document.off("update",this.documentUpdateHandler),this.removeAllListeners(),"undefined"!==typeof window&&(window.removeEventListener("online",this.boundConnect),window.removeEventListener("beforeunload",this.boundBeforeUnload))}get broadcastChannel(){return`${this.serverUrl}/${this.configuration.name}`}broadcastChannelSubscriber(t){this.mux((()=>{const e=new ue(t);new Ae(e).setBroadcasted(!0).apply(this,!1)}))}subscribeToBroadcastChannel(){this.subscribedToBroadcastChannel||(Ht(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!0),this.mux((()=>{this.broadcast(Ie,{document:this.document}),this.broadcast(Te,{document:this.document}),this.broadcast(ke),this.broadcast(Ne,{awareness:this.awareness,clients:[this.document.clientID]})}))}disconnectBroadcastChannel(){this.send(Ne,{awareness:this.awareness,clients:[this.document.clientID],states:new Map},!0),this.subscribedToBroadcastChannel&&($t(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!1)}broadcast(t,e){this.configuration.broadcast&&this.subscribedToBroadcastChannel&&new Ce(t,e).broadcast(this.broadcastChannel)}setAwarenessField(t,e){this.awareness.setLocalStateField(t,e)}}},2066:function(t,e,n){"use strict";n.d(e,{ML:function(){return In},hj:function(){return kt},vc:function(){return Dn},NB:function(){return On},nU:function(){return it},Nl:function(){return Q},Jo:function(){return Be},EG:function(){return Ge},xh:function(){return Xt},Cf:function(){return Tn},K9:function(){return Pn},P1:function(){return et},x2:function(){return kn},pr:function(){return qe},zK:function(){return Rn},S0:function(){return Nn}});n(7658);var r=n(157),i=n(1460),s=n(203),o=n(1543),a=n(1382);const c=(t,e)=>!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function l(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}const u=(t,e,n)=>{let i=l(t,n);if(!i)return!1;let s=f(i);if(!s){let n=i.blockRange(),r=n&&(0,a.k9)(n);return null!=r&&(e&&e(t.tr.lift(n,r).scrollIntoView()),!0)}let c=s.nodeBefore;if(!c.type.spec.isolating&&D(t,s,e))return!0;if(0==i.parent.content.size&&(h(c,"end")||r.qv.isSelectable(c))){let n=(0,a.dR)(t.doc,i.before(),i.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(e){let i=t.tr.step(n);i.setSelection(h(c,"end")?r.Y1.findFrom(i.doc.resolve(i.mapping.map(s.pos,-1)),-1):r.qv.create(i.doc,s.pos-c.nodeSize)),e(i.scrollIntoView())}return!0}}return!(!c.isAtom||s.depth!=i.depth-1)&&(e&&e(t.tr.delete(s.pos-c.nodeSize,s.pos).scrollIntoView()),!0)};function h(t,e,n=!1){for(let r=t;r;r="start"==e?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}const d=(t,e,n)=>{let{$head:i,empty:s}=t.selection,o=i;if(!s)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):i.parentOffset>0)return!1;o=f(i)}let a=o&&o.nodeBefore;return!(!a||!r.qv.isSelectable(a))&&(e&&e(t.tr.setSelection(r.qv.create(t.doc,o.pos-a.nodeSize)).scrollIntoView()),!0)};function f(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function p(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}const g=(t,e,n)=>{let i=p(t,n);if(!i)return!1;let s=y(i);if(!s)return!1;let c=s.nodeAfter;if(D(t,s,e))return!0;if(0==i.parent.content.size&&(h(c,"start")||r.qv.isSelectable(c))){let n=(0,a.dR)(t.doc,i.before(),i.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(e){let i=t.tr.step(n);i.setSelection(h(c,"start")?r.Y1.findFrom(i.doc.resolve(i.mapping.map(s.pos)),1):r.qv.create(i.doc,i.mapping.map(s.pos))),e(i.scrollIntoView())}return!0}}return!(!c.isAtom||s.depth!=i.depth-1)&&(e&&e(t.tr.delete(s.pos,s.pos+c.nodeSize).scrollIntoView()),!0)},m=(t,e,n)=>{let{$head:i,empty:s}=t.selection,o=i;if(!s)return!1;if(i.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):i.parentOffset<i.parent.content.size)return!1;o=y(i)}let a=o&&o.nodeAfter;return!(!a||!r.qv.isSelectable(a))&&(e&&e(t.tr.setSelection(r.qv.create(t.doc,o.pos)).scrollIntoView()),!0)};function y(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}const w=(t,e)=>{let n,i=t.selection,s=i instanceof r.qv;if(s){if(i.node.isTextblock||!(0,a.Mn)(t.doc,i.from))return!1;n=i.from}else if(n=(0,a.GJ)(t.doc,i.from,-1),null==n)return!1;if(e){let i=t.tr.join(n);s&&i.setSelection(r.qv.create(i.doc,n-t.doc.resolve(n).nodeBefore.nodeSize)),e(i.scrollIntoView())}return!0},b=(t,e)=>{let n,i=t.selection;if(i instanceof r.qv){if(i.node.isTextblock||!(0,a.Mn)(t.doc,i.to))return!1;n=i.to}else if(n=(0,a.GJ)(t.doc,i.to,1),null==n)return!1;return e&&e(t.tr.join(n).scrollIntoView()),!0},v=(t,e)=>{let{$from:n,$to:r}=t.selection,i=n.blockRange(r),s=i&&(0,a.k9)(i);return null!=s&&(e&&e(t.tr.lift(i,s).scrollIntoView()),!0)},E=(t,e)=>{let{$head:n,$anchor:r}=t.selection;return!(!n.parent.type.spec.code||!n.sameParent(r))&&(e&&e(t.tr.insertText("\n").scrollIntoView()),!0)};function _(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const S=(t,e)=>{let{$head:n,$anchor:i}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(i))return!1;let s=n.node(-1),o=n.indexAfter(-1),a=_(s.contentMatchAt(o));if(!a||!s.canReplaceWith(o,o,a))return!1;if(e){let i=n.after(),s=t.tr.replaceWith(i,i,a.createAndFill());s.setSelection(r.Y1.near(s.doc.resolve(i),1)),e(s.scrollIntoView())}return!0},A=(t,e)=>{let n=t.selection,{$from:i,$to:s}=n;if(n instanceof r.C1||i.parent.inlineContent||s.parent.inlineContent)return!1;let o=_(s.parent.contentMatchAt(s.indexAfter()));if(!o||!o.isTextblock)return!1;if(e){let n=(!i.parentOffset&&s.index()<s.parent.childCount?i:s).pos,a=t.tr.insert(n,o.createAndFill());a.setSelection(r.Bs.create(a.doc,n+1)),e(a.scrollIntoView())}return!0},C=(t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if((0,a.Ax)(t.doc,r))return e&&e(t.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),i=r&&(0,a.k9)(r);return null!=i&&(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)};function I(t){return(e,n)=>{let{$from:i,$to:s}=e.selection;if(e.selection instanceof r.qv&&e.selection.node.isBlock)return!(!i.parentOffset||!(0,a.Ax)(e.doc,i.pos))&&(n&&n(e.tr.split(i.pos).scrollIntoView()),!0);if(!i.parent.isBlock)return!1;if(n){let o=s.parentOffset==s.parent.content.size,c=e.tr;(e.selection instanceof r.Bs||e.selection instanceof r.C1)&&c.deleteSelection();let l=0==i.depth?null:_(i.node(-1).contentMatchAt(i.indexAfter(-1))),u=t&&t(s.parent,o),h=u?[u]:o&&l?[{type:l}]:void 0,d=(0,a.Ax)(c.doc,c.mapping.map(i.pos),1,h);if(h||d||!(0,a.Ax)(c.doc,c.mapping.map(i.pos),1,l?[{type:l}]:void 0)||(l&&(h=[{type:l}]),d=!0),d&&(c.split(c.mapping.map(i.pos),1,h),!o&&!i.parentOffset&&i.parent.type!=l)){let t=c.mapping.map(i.before()),e=c.doc.resolve(t);l&&i.node(-1).canReplaceWith(e.index(),e.index()+1,l)&&c.setNodeMarkup(c.mapping.map(i.before()),l)}n(c.scrollIntoView())}return!0}}const T=I(),k=(t,e)=>{let n,{$from:i,to:s}=t.selection,o=i.sharedDepth(s);return 0!=o&&(n=i.before(o),e&&e(t.tr.setSelection(r.qv.create(t.doc,n))),!0)},R=(t,e)=>(e&&e(t.tr.setSelection(new r.C1(t.doc))),!0);function N(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!!(r&&i&&r.type.compatibleContent(i.type))&&(!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),!0):!(!e.parent.canReplace(s,s+1)||!i.isTextblock&&!(0,a.Mn)(t.doc,e.pos))&&(n&&n(t.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),!0))}function D(t,e,n){let i,s,c=e.nodeBefore,l=e.nodeAfter;if(c.type.spec.isolating||l.type.spec.isolating)return!1;if(N(t,e,n))return!0;let u=e.parent.canReplace(e.index(),e.index()+1);if(u&&(i=(s=c.contentMatchAt(c.childCount)).findWrapping(l.type))&&s.matchType(i[0]||l.type).validEnd){if(n){let r=e.pos+l.nodeSize,s=o.HY.empty;for(let t=i.length-1;t>=0;t--)s=o.HY.from(i[t].create(null,s));s=o.HY.from(c.copy(s));let u=t.tr.step(new a.FC(e.pos-1,r,e.pos,r,new o.p2(s,1,0),i.length,!0)),h=r+2*i.length;(0,a.Mn)(u.doc,h)&&u.join(h),n(u.scrollIntoView())}return!0}let d=r.Y1.findFrom(e,1),f=d&&d.$from.blockRange(d.$to),p=f&&(0,a.k9)(f);if(null!=p&&p>=e.depth)return n&&n(t.tr.lift(f,p).scrollIntoView()),!0;if(u&&h(l,"start",!0)&&h(c,"end")){let r=c,i=[];for(;;){if(i.push(r),r.isTextblock)break;r=r.lastChild}let s=l,u=1;for(;!s.isTextblock;s=s.firstChild)u++;if(r.canReplace(r.childCount,r.childCount,s.content)){if(n){let r=o.HY.empty;for(let t=i.length-1;t>=0;t--)r=o.HY.from(i[t].copy(r));let s=t.tr.step(new a.FC(e.pos-i.length,e.pos+l.nodeSize,e.pos+u,e.pos+l.nodeSize-u,new o.p2(r,i.length,0),0,!0));n(s.scrollIntoView())}return!0}}return!1}function O(t){return function(e,n){let i=e.selection,s=t<0?i.$from:i.$to,o=s.depth;while(s.node(o).isInline){if(!o)return!1;o--}return!!s.node(o).isTextblock&&(n&&n(e.tr.setSelection(r.Bs.create(e.doc,t<0?s.start(o):s.end(o)))),!0)}}const P=O(-1),x=O(1);function M(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),c=o&&(0,a.nd)(o,t,e);return!!c&&(r&&r(n.tr.wrap(o,c).scrollIntoView()),!0)}}function L(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:r},$to:{pos:o}}=n.selection.ranges[s];n.doc.nodesBetween(r,o,((r,s)=>{if(i)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)i=!0;else{let e=n.doc.resolve(s),r=e.index();i=e.parent.canReplaceWith(r,r+1,t)}}))}if(!i)return!1;if(r){let i=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:s},$to:{pos:o}}=n.selection.ranges[r];i.setBlockType(s,o,t,e)}r(i.scrollIntoView())}return!0}}function B(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}let U=B(c,u,d),F=B(c,g,m);const z={Enter:B(E,A,C,T),"Mod-Enter":S,Backspace:U,"Mod-Backspace":U,"Shift-Backspace":U,Delete:F,"Mod-Delete":F,"Mod-a":R},V={"Ctrl-h":z["Backspace"],"Alt-Backspace":z["Mod-Backspace"],"Ctrl-d":z["Delete"],"Ctrl-Alt-Backspace":z["Mod-Delete"],"Alt-Delete":z["Mod-Delete"],"Alt-d":z["Mod-Delete"],"Ctrl-a":P,"Ctrl-e":x};for(let xn in z)V[xn]=z[xn];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&os.platform();function j(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,c=i.blockRange(s),l=!1,u=c;if(!c)return!1;if(c.depth>=2&&i.node(c.depth-1).type.compatibleContent(t)&&0==c.startIndex){if(0==i.index(c.depth-1))return!1;let t=n.doc.resolve(c.start-2);u=new o.Ts(t,t,c.depth),c.endIndex<c.parent.childCount&&(c=new o.Ts(i,n.doc.resolve(s.end(c.depth)),c.depth)),l=!0}let h=(0,a.nd)(u,t,e,c);return!!h&&(r&&r(H(n.tr,c,h,l,t).scrollIntoView()),!0)}}function H(t,e,n,r,i){let s=o.HY.empty;for(let a=n.length-1;a>=0;a--)s=o.HY.from(n[a].type.create(n[a].attrs,s));t.step(new a.FC(e.start-(r?2:0),e.end,e.start,e.end,new o.p2(s,0,0),n.length,!0));let c=0;for(let o=0;o<n.length;o++)n[o].type==i&&(c=o+1);let l=n.length-c,u=e.start+n.length-(r?2:0),h=e.parent;for(let o=e.startIndex,d=e.endIndex,f=!0;o<d;o++,f=!1)!f&&(0,a.Ax)(t.doc,u,l)&&(t.split(u,l),u+=2*l),u+=h.child(o).nodeSize;return t}function $(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==t));return!!s&&(!n||(r.node(s.depth-1).type==t?K(e,n,t,s):G(e,n,s)))}}function K(t,e,n,r){let i=t.tr,s=r.end,c=r.$to.end(r.depth);s<c&&(i.step(new a.FC(s-1,c,s,c,new o.p2(o.HY.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new o.Ts(i.doc.resolve(r.$from.pos),i.doc.resolve(c),r.depth));const l=(0,a.k9)(r);if(null==l)return!1;i.lift(r,l);let u=i.mapping.map(s,-1)-1;return(0,a.Mn)(i.doc,u)&&i.join(u),e(i.scrollIntoView()),!0}function G(t,e,n){let r=t.tr,i=n.parent;for(let o=n.end,a=n.endIndex-1,g=n.startIndex;a>g;a--)o-=i.child(a).nodeSize,r.delete(o-1,o+1);let s=r.doc.resolve(n.start),c=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let l=0==n.startIndex,u=n.endIndex==i.childCount,h=s.node(-1),d=s.index(-1);if(!h.canReplace(d+(l?0:1),d+1,c.content.append(u?o.HY.empty:o.HY.from(i))))return!1;let f=s.pos,p=f+c.nodeSize;return r.step(new a.FC(f-(l?1:0),p+(u?1:0),f+1,p-1,new o.p2((l?o.HY.empty:o.HY.from(i.copy(o.HY.empty))).append(u?o.HY.empty:o.HY.from(i.copy(o.HY.empty))),l?0:1,u?0:1),l?0:1)),e(r.scrollIntoView()),!0}function q(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==t));if(!s)return!1;let c=s.startIndex;if(0==c)return!1;let l=s.parent,u=l.child(c-1);if(u.type!=t)return!1;if(n){let r=u.lastChild&&u.lastChild.type==l.type,i=o.HY.from(r?t.create():null),c=new o.p2(o.HY.from(t.create(null,o.HY.from(l.type.create(null,i)))),r?3:1,0),h=s.start,d=s.end;n(e.tr.step(new a.FC(h-(r?3:1),d,h,d,c,1,!0)).scrollIntoView())}return!0}}function W(t){const{state:e,transaction:n}=t;let{selection:r}=n,{doc:i}=n,{storedMarks:s}=n;return{...e,apply:e.apply.bind(e),applyTransaction:e.applyTransaction.bind(e),filterTransaction:e.filterTransaction,plugins:e.plugins,schema:e.schema,reconfigure:e.reconfigure.bind(e),toJSON:e.toJSON.bind(e),get storedMarks(){return s},get selection(){return r},get doc(){return i},get tr(){return r=n.selection,i=n.doc,s=n.storedMarks,n}}}class Y{constructor(t){this.editor=t.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=t.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:t,editor:e,state:n}=this,{view:r}=e,{tr:i}=n,s=this.buildProps(i);return Object.fromEntries(Object.entries(t).map((([t,e])=>{const n=(...t)=>{const n=e(...t)(s);return i.getMeta("preventDispatch")||this.hasCustomState||r.dispatch(i),n};return[t,n]})))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r,o=[],a=!!t,c=t||i.tr,l=()=>(a||!e||c.getMeta("preventDispatch")||this.hasCustomState||s.dispatch(c),o.every((t=>!0===t))),u={...Object.fromEntries(Object.entries(n).map((([t,n])=>{const r=(...t)=>{const r=this.buildProps(c,e),i=n(...t)(r);return o.push(i),u};return[t,r]}))),run:l};return u}createCan(t){const{rawCommands:e,state:n}=this,r=!1,i=t||n.tr,s=this.buildProps(i,r),o=Object.fromEntries(Object.entries(e).map((([t,e])=>[t,(...t)=>e(...t)({...s,dispatch:void 0})])));return{...o,chain:()=>this.createChain(i,r)}}buildProps(t,e=!0){const{rawCommands:n,editor:r,state:i}=this,{view:s}=r;i.storedMarks&&t.setStoredMarks(i.storedMarks);const o={tr:t,editor:r,view:s,state:W({state:i,transaction:t}),dispatch:e?()=>{}:void 0,chain:()=>this.createChain(t),can:()=>this.createCan(t),get commands(){return Object.fromEntries(Object.entries(n).map((([t,e])=>[t,(...t)=>e(...t)(o)])))}};return o}}class X{constructor(){this.callbacks={}}on(t,e){return this.callbacks[t]||(this.callbacks[t]=[]),this.callbacks[t].push(e),this}emit(t,...e){const n=this.callbacks[t];return n&&n.forEach((t=>t.apply(this,e))),this}off(t,e){const n=this.callbacks[t];return n&&(e?this.callbacks[t]=n.filter((t=>t!==e)):delete this.callbacks[t]),this}removeAllListeners(){this.callbacks={}}}function Q(t,e,n){if(void 0===t.config[e]&&t.parent)return Q(t.parent,e,n);if("function"===typeof t.config[e]){const r=t.config[e].bind({...n,parent:t.parent?Q(t.parent,e,n):null});return r}return t.config[e]}function J(t){const e=t.filter((t=>"extension"===t.type)),n=t.filter((t=>"node"===t.type)),r=t.filter((t=>"mark"===t.type));return{baseExtensions:e,nodeExtensions:n,markExtensions:r}}function Z(t){const e=[],{nodeExtensions:n,markExtensions:r}=J(t),i=[...n,...r],s={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return t.forEach((t=>{const n={name:t.name,options:t.options,storage:t.storage},r=Q(t,"addGlobalAttributes",n);if(!r)return;const i=r();i.forEach((t=>{t.types.forEach((n=>{Object.entries(t.attributes).forEach((([t,r])=>{e.push({type:n,name:t,attribute:{...s,...r}})}))}))}))})),i.forEach((t=>{const n={name:t.name,options:t.options,storage:t.storage},r=Q(t,"addAttributes",n);if(!r)return;const i=r();Object.entries(i).forEach((([n,r])=>{const i={...s,...r};(null===r||void 0===r?void 0:r.isRequired)&&void 0===(null===r||void 0===r?void 0:r.default)&&delete i.default,e.push({type:t.name,name:n,attribute:i})}))})),e}function tt(t,e){if("string"===typeof t){if(!e.nodes[t])throw Error(`There is no node type named '${t}'. Maybe you forgot to add the extension?`);return e.nodes[t]}return t}function et(...t){return t.filter((t=>!!t)).reduce(((t,e)=>{const n={...t};return Object.entries(e).forEach((([t,e])=>{const r=n[t];n[t]=r?"class"===t?[n[t],e].join(" "):"style"===t?[n[t],e].join("; "):e:e})),n}),{})}function nt(t,e){return e.filter((t=>t.attribute.rendered)).map((e=>e.attribute.renderHTML?e.attribute.renderHTML(t.attrs)||{}:{[e.name]:t.attrs[e.name]})).reduce(((t,e)=>et(t,e)),{})}function rt(t){return"function"===typeof t}function it(t,e=undefined,...n){return rt(t)?e?t.bind(e)(...n):t(...n):t}function st(t={}){return 0===Object.keys(t).length&&t.constructor===Object}function ot(t){return"string"!==typeof t?t:t.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(t):"true"===t||"false"!==t&&t}function at(t,e){return t.style?t:{...t,getAttrs:n=>{const r=t.getAttrs?t.getAttrs(n):t.attrs;if(!1===r)return!1;const i=e.reduce(((t,e)=>{const r=e.attribute.parseHTML?e.attribute.parseHTML(n):ot(n.getAttribute(e.name));return null===r||void 0===r?t:{...t,[e.name]:r}}),{});return{...r,...i}}}}function ct(t){return Object.fromEntries(Object.entries(t).filter((([t,e])=>("attrs"!==t||!st(e))&&(null!==e&&void 0!==e))))}function lt(t){var e;const n=Z(t),{nodeExtensions:r,markExtensions:i}=J(t),s=null===(e=r.find((t=>Q(t,"topNode"))))||void 0===e?void 0:e.name,a=Object.fromEntries(r.map((e=>{const r=n.filter((t=>t.type===e.name)),i={name:e.name,options:e.options,storage:e.storage},s=t.reduce(((t,n)=>{const r=Q(n,"extendNodeSchema",i);return{...t,...r?r(e):{}}}),{}),o=ct({...s,content:it(Q(e,"content",i)),marks:it(Q(e,"marks",i)),group:it(Q(e,"group",i)),inline:it(Q(e,"inline",i)),atom:it(Q(e,"atom",i)),selectable:it(Q(e,"selectable",i)),draggable:it(Q(e,"draggable",i)),code:it(Q(e,"code",i)),defining:it(Q(e,"defining",i)),isolating:it(Q(e,"isolating",i)),attrs:Object.fromEntries(r.map((t=>{var e;return[t.name,{default:null===(e=null===t||void 0===t?void 0:t.attribute)||void 0===e?void 0:e.default}]})))}),a=it(Q(e,"parseHTML",i));a&&(o.parseDOM=a.map((t=>at(t,r))));const c=Q(e,"renderHTML",i);c&&(o.toDOM=t=>c({node:t,HTMLAttributes:nt(t,r)}));const l=Q(e,"renderText",i);return l&&(o.toText=l),[e.name,o]}))),c=Object.fromEntries(i.map((e=>{const r=n.filter((t=>t.type===e.name)),i={name:e.name,options:e.options,storage:e.storage},s=t.reduce(((t,n)=>{const r=Q(n,"extendMarkSchema",i);return{...t,...r?r(e):{}}}),{}),o=ct({...s,inclusive:it(Q(e,"inclusive",i)),excludes:it(Q(e,"excludes",i)),group:it(Q(e,"group",i)),spanning:it(Q(e,"spanning",i)),code:it(Q(e,"code",i)),attrs:Object.fromEntries(r.map((t=>{var e;return[t.name,{default:null===(e=null===t||void 0===t?void 0:t.attribute)||void 0===e?void 0:e.default}]})))}),a=it(Q(e,"parseHTML",i));a&&(o.parseDOM=a.map((t=>at(t,r))));const c=Q(e,"renderHTML",i);return c&&(o.toDOM=t=>c({mark:t,HTMLAttributes:nt(t,r)})),[e.name,o]})));return new o.V_({topNode:s,nodes:a,marks:c})}function ut(t,e){return e.nodes[t]||e.marks[t]||null}function ht(t,e){return Array.isArray(e)?e.some((e=>{const n="string"===typeof e?e:e.name;return n===t.name})):e}const dt=(t,e=500)=>{let n="";const r=t.parentOffset;return t.parent.nodesBetween(Math.max(0,r-e),r,((t,e,i,s)=>{var o,a;const c=(null===(a=(o=t.type.spec).toText)||void 0===a?void 0:a.call(o,{node:t,pos:e,parent:i,index:s}))||t.textContent||"%leaf%";n+=c.slice(0,Math.max(0,r-e))})),n};function ft(t){return"[object RegExp]"===Object.prototype.toString.call(t)}class pt{constructor(t){this.find=t.find,this.handler=t.handler}}const gt=(t,e)=>{if(ft(e))return e.exec(t);const n=e(t);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=t,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function mt(t){var e;const{editor:n,from:r,to:i,text:s,rules:o,plugin:a}=t,{view:c}=n;if(c.composing)return!1;const l=c.state.doc.resolve(r);if(l.parent.type.spec.code||(null===(e=l.nodeBefore||l.nodeAfter)||void 0===e?void 0:e.marks.find((t=>t.type.spec.code))))return!1;let u=!1;const h=dt(l)+s;return o.forEach((t=>{if(u)return;const e=gt(h,t.find);if(!e)return;const o=c.state.tr,l=W({state:c.state,transaction:o}),d={from:r-(e[0].length-s.length),to:i},{commands:f,chain:p,can:g}=new Y({editor:n,state:l}),m=t.handler({state:l,range:d,match:e,commands:f,chain:p,can:g});null!==m&&o.steps.length&&(o.setMeta(a,{transform:o,from:r,to:i,text:s}),c.dispatch(o),u=!0)})),u}function yt(t){const{editor:e,rules:n}=t,i=new r.Sy({state:{init(){return null},apply(t,e){const n=t.getMeta(i);return n||(t.selectionSet||t.docChanged?null:e)}},props:{handleTextInput(t,r,s,o){return mt({editor:e,from:r,to:s,text:o,rules:n,plugin:i})},handleDOMEvents:{compositionend:t=>(setTimeout((()=>{const{$cursor:r}=t.state.selection;r&&mt({editor:e,from:r.pos,to:r.pos,text:"",rules:n,plugin:i})})),!1)},handleKeyDown(t,r){if("Enter"!==r.key)return!1;const{$cursor:s}=t.state.selection;return!!s&&mt({editor:e,from:s.pos,to:s.pos,text:"\n",rules:n,plugin:i})}},isInputRules:!0});return i}function wt(t){return"number"===typeof t}class bt{constructor(t){this.find=t.find,this.handler=t.handler}}const vt=(t,e)=>{if(ft(e))return[...t.matchAll(e)];const n=e(t);return n?n.map((e=>{const n=[e.text];return n.index=e.index,n.input=t,n.data=e.data,e.replaceWith&&(e.text.includes(e.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(e.replaceWith)),n})):[]};function Et(t){const{editor:e,state:n,from:r,to:i,rule:s}=t,{commands:o,chain:a,can:c}=new Y({editor:e,state:n}),l=[];n.doc.nodesBetween(r,i,((t,e)=>{if(!t.isTextblock||t.type.spec.code)return;const u=Math.max(r,e),h=Math.min(i,e+t.content.size),d=t.textBetween(u-e,h-e,void 0,"￼"),f=vt(d,s.find);f.forEach((t=>{if(void 0===t.index)return;const e=u+t.index+1,r=e+t[0].length,i={from:n.tr.mapping.map(e),to:n.tr.mapping.map(r)},h=s.handler({state:n,range:i,match:t,commands:o,chain:a,can:c});l.push(h)}))}));const u=l.every((t=>null!==t));return u}function _t(t){const{editor:e,rules:n}=t;let i=null,s=!1,o=!1;const a=n.map((t=>new r.Sy({view(t){const e=e=>{var n;i=(null===(n=t.dom.parentElement)||void 0===n?void 0:n.contains(e.target))?t.dom.parentElement:null};return window.addEventListener("dragstart",e),{destroy(){window.removeEventListener("dragstart",e)}}},props:{handleDOMEvents:{drop:t=>(o=i===t.dom.parentElement,!1),paste:(t,e)=>{var n;const r=null===(n=e.clipboardData)||void 0===n?void 0:n.getData("text/html");return s=!!(null===r||void 0===r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:(n,r,i)=>{const a=n[0],c="paste"===a.getMeta("uiEvent")&&!s,l="drop"===a.getMeta("uiEvent")&&!o;if(!c&&!l)return;const u=r.doc.content.findDiffStart(i.doc.content),h=r.doc.content.findDiffEnd(i.doc.content);if(!wt(u)||!h||u===h.b)return;const d=i.tr,f=W({state:i,transaction:d}),p=Et({editor:e,state:f,from:Math.max(u-1,0),to:h.b-1,rule:t});return p&&d.steps.length?d:void 0}})));return a}function St(t){const e=t.filter(((e,n)=>t.indexOf(e)!==n));return[...new Set(e)]}class At{constructor(t,e){this.splittableMarks=[],this.editor=e,this.extensions=At.resolve(t),this.schema=lt(this.extensions),this.extensions.forEach((t=>{var e;this.editor.extensionStorage[t.name]=t.storage;const n={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:ut(t.name,this.schema)};if("mark"===t.type){const r=null===(e=it(Q(t,"keepOnSplit",n)))||void 0===e||e;r&&this.splittableMarks.push(t.name)}const r=Q(t,"onBeforeCreate",n);r&&this.editor.on("beforeCreate",r);const i=Q(t,"onCreate",n);i&&this.editor.on("create",i);const s=Q(t,"onUpdate",n);s&&this.editor.on("update",s);const o=Q(t,"onSelectionUpdate",n);o&&this.editor.on("selectionUpdate",o);const a=Q(t,"onTransaction",n);a&&this.editor.on("transaction",a);const c=Q(t,"onFocus",n);c&&this.editor.on("focus",c);const l=Q(t,"onBlur",n);l&&this.editor.on("blur",l);const u=Q(t,"onDestroy",n);u&&this.editor.on("destroy",u)}))}static resolve(t){const e=At.sort(At.flatten(t)),n=St(e.map((t=>t.name)));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map((t=>`'${t}'`)).join(", ")}]. This can lead to issues.`),e}static flatten(t){return t.map((t=>{const e={name:t.name,options:t.options,storage:t.storage},n=Q(t,"addExtensions",e);return n?[t,...this.flatten(n())]:t})).flat(10)}static sort(t){const e=100;return t.sort(((t,n)=>{const r=Q(t,"priority")||e,i=Q(n,"priority")||e;return r>i?-1:r<i?1:0}))}get commands(){return this.extensions.reduce(((t,e)=>{const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:ut(e.name,this.schema)},r=Q(e,"addCommands",n);return r?{...t,...r()}:t}),{})}get plugins(){const{editor:t}=this,e=At.sort([...this.extensions].reverse()),n=[],r=[],i=e.map((e=>{const i={name:e.name,options:e.options,storage:e.storage,editor:t,type:ut(e.name,this.schema)},o=[],a=Q(e,"addKeyboardShortcuts",i);let c={};if("mark"===e.type&&e.config.exitable&&(c.ArrowRight=()=>Dn.handleExit({editor:t,mark:e})),a){const e=Object.fromEntries(Object.entries(a()).map((([e,n])=>[e,()=>n({editor:t})])));c={...c,...e}}const l=(0,s.h)(c);o.push(l);const u=Q(e,"addInputRules",i);ht(e,t.options.enableInputRules)&&u&&n.push(...u());const h=Q(e,"addPasteRules",i);ht(e,t.options.enablePasteRules)&&h&&r.push(...h());const d=Q(e,"addProseMirrorPlugins",i);if(d){const t=d();o.push(...t)}return o})).flat();return[yt({editor:t,rules:n}),..._t({editor:t,rules:r}),...i]}get attributes(){return Z(this.extensions)}get nodeViews(){const{editor:t}=this,{nodeExtensions:e}=J(this.extensions);return Object.fromEntries(e.filter((t=>!!Q(t,"addNodeView"))).map((e=>{const n=this.attributes.filter((t=>t.type===e.name)),r={name:e.name,options:e.options,storage:e.storage,editor:t,type:tt(e.name,this.schema)},i=Q(e,"addNodeView",r);if(!i)return[];const s=(r,s,o,a)=>{const c=nt(r,n);return i()({editor:t,node:r,getPos:o,decorations:a,HTMLAttributes:c,extension:e})};return[e.name,s]})))}}function Ct(t){return Object.prototype.toString.call(t).slice(8,-1)}function It(t){return"Object"===Ct(t)&&(t.constructor===Object&&Object.getPrototypeOf(t)===Object.prototype)}function Tt(t,e){const n={...t};return It(t)&&It(e)&&Object.keys(e).forEach((r=>{It(e[r])?r in t?n[r]=Tt(t[r],e[r]):Object.assign(n,{[r]:e[r]}):Object.assign(n,{[r]:e[r]})})),n}class kt{constructor(t={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=it(Q(this,"addOptions",{name:this.name}))),this.storage=it(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new kt(t)}configure(t={}){const e=this.extend();return e.options=Tt(this.options,t),e.storage=it(Q(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new kt(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=it(Q(e,"addOptions",{name:e.name})),e.storage=it(Q(e,"addStorage",{name:e.name,options:e.options})),e}}function Rt(t,e,n){const{from:r,to:i}=e,{blockSeparator:s="\n\n",textSerializers:o={}}=n||{};let a="",c=!0;return t.nodesBetween(r,i,((t,n,l,u)=>{var h;const d=null===o||void 0===o?void 0:o[t.type.name];d?(t.isBlock&&!c&&(a+=s,c=!0),l&&(a+=d({node:t,pos:n,parent:l,index:u,range:e}))):t.isText?(a+=null===(h=null===t||void 0===t?void 0:t.text)||void 0===h?void 0:h.slice(Math.max(r,n)-n,i-n),c=!1):t.isBlock&&!c&&(a+=s,c=!0)})),a}function Nt(t){return Object.fromEntries(Object.entries(t.nodes).filter((([,t])=>t.spec.toText)).map((([t,e])=>[t,e.spec.toText])))}const Dt=kt.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:t}=this,{state:e,schema:n}=t,{doc:r,selection:i}=e,{ranges:s}=i,o=Math.min(...s.map((t=>t.$from.pos))),a=Math.max(...s.map((t=>t.$to.pos))),c=Nt(n),l={from:o,to:a};return Rt(r,l,{textSerializers:c})}}})]}}),Ot=()=>({editor:t,view:e})=>(requestAnimationFrame((()=>{var n;t.isDestroyed||(e.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),Pt=(t=!1)=>({commands:e})=>e.setContent("",t),xt=()=>({state:t,tr:e,dispatch:n})=>{const{selection:r}=e,{ranges:i}=r;return!n||(i.forEach((({$from:n,$to:r})=>{t.doc.nodesBetween(n.pos,r.pos,((t,n)=>{if(t.type.isText)return;const{doc:r,mapping:i}=e,s=r.resolve(i.map(n)),o=r.resolve(i.map(n+t.nodeSize)),c=s.blockRange(o);if(!c)return;const l=(0,a.k9)(c);if(t.type.isTextblock){const{defaultType:t}=s.parent.contentMatchAt(s.index());e.setNodeMarkup(c.start,t)}(l||0===l)&&e.lift(c,l)}))})),!0)},Mt=t=>e=>t(e),Lt=()=>({state:t,dispatch:e})=>A(t,e),Bt=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,r=n.$anchor.node();if(r.content.size>0)return!1;const i=t.selection.$anchor;for(let s=i.depth;s>0;s-=1){const n=i.node(s);if(n.type===r.type){if(e){const e=i.before(s),n=i.after(s);t.delete(e,n).scrollIntoView()}return!0}}return!1},Ut=t=>({tr:e,state:n,dispatch:r})=>{const i=tt(t,n.schema),s=e.selection.$anchor;for(let t=s.depth;t>0;t-=1){const n=s.node(t);if(n.type===i){if(r){const n=s.before(t),r=s.after(t);e.delete(n,r).scrollIntoView()}return!0}}return!1},Ft=t=>({tr:e,dispatch:n})=>{const{from:r,to:i}=t;return n&&e.delete(r,i),!0},zt=()=>({state:t,dispatch:e})=>c(t,e),Vt=()=>({commands:t})=>t.keyboardShortcut("Enter"),jt=()=>({state:t,dispatch:e})=>S(t,e);function Ht(t,e,n={strict:!0}){const r=Object.keys(e);return!r.length||r.every((r=>n.strict?e[r]===t[r]:ft(e[r])?e[r].test(t[r]):e[r]===t[r]))}function $t(t,e,n={}){return t.find((t=>t.type===e&&Ht(t.attrs,n)))}function Kt(t,e,n={}){return!!$t(t,e,n)}function Gt(t,e,n={}){if(!t||!e)return;let r=t.parent.childAfter(t.parentOffset);if(t.parentOffset===r.offset&&0!==r.offset&&(r=t.parent.childBefore(t.parentOffset)),!r.node)return;const i=$t([...r.node.marks],e,n);if(!i)return;let s=r.index,o=t.start()+r.offset,a=s+1,c=o+r.node.nodeSize;$t([...r.node.marks],e,n);while(s>0&&i.isInSet(t.parent.child(s-1).marks))s-=1,o-=t.parent.child(s).nodeSize;while(a<t.parent.childCount&&Kt([...t.parent.child(a).marks],e,n))c+=t.parent.child(a).nodeSize,a+=1;return{from:o,to:c}}function qt(t,e){if("string"===typeof t){if(!e.marks[t])throw Error(`There is no mark type named '${t}'. Maybe you forgot to add the extension?`);return e.marks[t]}return t}const Wt=(t,e={})=>({tr:n,state:i,dispatch:s})=>{const o=qt(t,i.schema),{doc:a,selection:c}=n,{$from:l,from:u,to:h}=c;if(s){const t=Gt(l,o,e);if(t&&t.from<=u&&t.to>=h){const e=r.Bs.create(a,t.from,t.to);n.setSelection(e)}}return!0},Yt=t=>e=>{const n="function"===typeof t?t(e):t;for(let t=0;t<n.length;t+=1)if(n[t](e))return!0;return!1};function Xt(t){return t instanceof r.Bs}function Qt(t=0,e=0,n=0){return Math.min(Math.max(t,e),n)}function Jt(t,e=null){if(!e)return null;const n=r.Y1.atStart(t),i=r.Y1.atEnd(t);if("start"===e||!0===e)return n;if("end"===e)return i;const s=n.from,o=i.to;return"all"===e?r.Bs.create(t,Qt(0,s,o),Qt(t.content.size,s,o)):r.Bs.create(t,Qt(e,s,o),Qt(e,s,o))}function Zt(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const te=(t=null,e={})=>({editor:n,view:r,tr:i,dispatch:s})=>{e={scrollIntoView:!0,...e};const o=()=>{Zt()&&r.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(r.focus(),(null===e||void 0===e?void 0:e.scrollIntoView)&&n.commands.scrollIntoView())}))};if(r.hasFocus()&&null===t||!1===t)return!0;if(s&&null===t&&!Xt(n.state.selection))return o(),!0;const a=Jt(i.doc,t)||n.state.selection,c=n.state.selection.eq(a);return s&&(c||i.setSelection(a),c&&i.storedMarks&&i.setStoredMarks(i.storedMarks),o()),!0},ee=(t,e)=>n=>t.every(((t,r)=>e(t,{...n,index:r}))),ne=(t,e)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},t,e);function re(t){const e=`<body>${t}</body>`;return(new window.DOMParser).parseFromString(e,"text/html").body}function ie(t,e,n){if(n={slice:!0,parseOptions:{},...n},"object"===typeof t&&null!==t)try{return Array.isArray(t)&&t.length>0?o.HY.fromArray(t.map((t=>e.nodeFromJSON(t)))):e.nodeFromJSON(t)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",t,"Error:",r),ie("",e,n)}if("string"===typeof t){const r=o.aw.fromSchema(e);return n.slice?r.parseSlice(re(t),n.parseOptions).content:r.parse(re(t),n.parseOptions)}return ie("",e,n)}function se(t,e,n){const i=t.steps.length-1;if(i<e)return;const s=t.steps[i];if(!(s instanceof a.Pu||s instanceof a.FC))return;const o=t.mapping.maps[i];let c=0;o.forEach(((t,e,n,r)=>{0===c&&(c=r)})),t.setSelection(r.Y1.near(t.doc.resolve(c),n))}const oe=t=>t.toString().startsWith("<"),ae=(t,e,n)=>({tr:r,dispatch:i,editor:s})=>{if(i){n={parseOptions:{},updateSelection:!0,...n};const i=ie(e,s.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===i.toString())return!0;let{from:o,to:a}="number"===typeof t?{from:t,to:t}:t,c=!0,l=!0;const u=oe(i)?i:[i];if(u.forEach((t=>{t.check(),c=!!c&&(t.isText&&0===t.marks.length),l=!!l&&t.isBlock})),o===a&&l){const{parent:t}=r.doc.resolve(o),e=t.isTextblock&&!t.type.spec.code&&!t.childCount;e&&(o-=1,a+=1)}c?Array.isArray(e)?r.insertText(e.map((t=>t.text||"")).join(""),o,a):"object"===typeof e&&e&&e.text?r.insertText(e.text,o,a):r.insertText(e,o,a):r.replaceWith(o,a,i),n.updateSelection&&se(r,r.steps.length-1,-1)}return!0},ce=()=>({state:t,dispatch:e})=>w(t,e),le=()=>({state:t,dispatch:e})=>b(t,e),ue=()=>({state:t,dispatch:e})=>u(t,e),he=()=>({state:t,dispatch:e})=>g(t,e);function de(){return"undefined"!==typeof navigator&&/Mac/.test(navigator.platform)}function fe(t){const e=t.split(/-(?!$)/);let n,r,i,s,o=e[e.length-1];"Space"===o&&(o=" ");for(let a=0;a<e.length-1;a+=1){const t=e[a];if(/^(cmd|meta|m)$/i.test(t))s=!0;else if(/^a(lt)?$/i.test(t))n=!0;else if(/^(c|ctrl|control)$/i.test(t))r=!0;else if(/^s(hift)?$/i.test(t))i=!0;else{if(!/^mod$/i.test(t))throw new Error(`Unrecognized modifier name: ${t}`);Zt()||de()?s=!0:r=!0}}return n&&(o=`Alt-${o}`),r&&(o=`Ctrl-${o}`),s&&(o=`Meta-${o}`),i&&(o=`Shift-${o}`),o}const pe=t=>({editor:e,view:n,tr:r,dispatch:i})=>{const s=fe(t).split(/-(?!$)/),o=s.find((t=>!["Alt","Ctrl","Meta","Shift"].includes(t))),a=new KeyboardEvent("keydown",{key:"Space"===o?" ":o,altKey:s.includes("Alt"),ctrlKey:s.includes("Ctrl"),metaKey:s.includes("Meta"),shiftKey:s.includes("Shift"),bubbles:!0,cancelable:!0}),c=e.captureTransaction((()=>{n.someProp("handleKeyDown",(t=>t(n,a)))}));return null===c||void 0===c||c.steps.forEach((t=>{const e=t.map(r.mapping);e&&i&&r.maybeStep(e)})),!0};function ge(t,e,n={}){const{from:r,to:i,empty:s}=t.selection,o=e?tt(e,t.schema):null,a=[];t.doc.nodesBetween(r,i,((t,e)=>{if(t.isText)return;const n=Math.max(r,e),s=Math.min(i,e+t.nodeSize);a.push({node:t,from:n,to:s})}));const c=i-r,l=a.filter((t=>!o||o.name===t.node.type.name)).filter((t=>Ht(t.node.attrs,n,{strict:!1})));if(s)return!!l.length;const u=l.reduce(((t,e)=>t+e.to-e.from),0);return u>=c}const me=(t,e={})=>({state:n,dispatch:r})=>{const i=tt(t,n.schema),s=ge(n,i,e);return!!s&&v(n,r)},ye=()=>({state:t,dispatch:e})=>C(t,e),we=t=>({state:e,dispatch:n})=>{const r=tt(t,e.schema);return $(r)(e,n)},be=()=>({state:t,dispatch:e})=>E(t,e);function ve(t,e){return e.nodes[t]?"node":e.marks[t]?"mark":null}function Ee(t,e){const n="string"===typeof e?[e]:e;return Object.keys(t).reduce(((e,r)=>(n.includes(r)||(e[r]=t[r]),e)),{})}const _e=(t,e)=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=ve("string"===typeof t?t:t.name,r.schema);return!!a&&("node"===a&&(s=tt(t,r.schema)),"mark"===a&&(o=qt(t,r.schema)),i&&n.selection.ranges.forEach((t=>{r.doc.nodesBetween(t.$from.pos,t.$to.pos,((t,r)=>{s&&s===t.type&&n.setNodeMarkup(r,void 0,Ee(t.attrs,e)),o&&t.marks.length&&t.marks.forEach((i=>{o===i.type&&n.addMark(r,r+t.nodeSize,o.create(Ee(i.attrs,e)))}))}))})),!0)},Se=()=>({tr:t,dispatch:e})=>(e&&t.scrollIntoView(),!0),Ae=()=>({tr:t,commands:e})=>e.setTextSelection({from:0,to:t.doc.content.size}),Ce=()=>({state:t,dispatch:e})=>d(t,e),Ie=()=>({state:t,dispatch:e})=>m(t,e),Te=()=>({state:t,dispatch:e})=>k(t,e),ke=()=>({state:t,dispatch:e})=>x(t,e),Re=()=>({state:t,dispatch:e})=>P(t,e);function Ne(t,e,n={}){return ie(t,e,{slice:!1,parseOptions:n})}const De=(t,e=!1,n={})=>({tr:r,editor:i,dispatch:s})=>{const{doc:o}=r,a=Ne(t,i.schema,n);return s&&r.replaceWith(0,o.content.size,a).setMeta("preventUpdate",!e),!0};function Oe(t){for(let e=0;e<t.edgeCount;e+=1){const{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Pe(t,e){for(let n=t.depth;n>0;n-=1){const r=t.node(n);if(e(r))return{pos:n>0?t.before(n):0,start:t.start(n),depth:n,node:r}}}function xe(t){return e=>Pe(e.$from,t)}function Me(t,e){const n=o.PW.fromSchema(e).serializeFragment(t),r=document.implementation.createHTMLDocument(),i=r.createElement("div");return i.appendChild(n),i.innerHTML}function Le(t,e){const n={from:0,to:t.content.size};return Rt(t,n,e)}function Be(t,e){const n=qt(e,t.schema),{from:r,to:i,empty:s}=t.selection,o=[];s?(t.storedMarks&&o.push(...t.storedMarks),o.push(...t.selection.$head.marks())):t.doc.nodesBetween(r,i,(t=>{o.push(...t.marks)}));const a=o.find((t=>t.type.name===n.name));return a?{...a.attrs}:{}}function Ue(t,e){const n=tt(e,t.schema),{from:r,to:i}=t.selection,s=[];t.doc.nodesBetween(r,i,(t=>{s.push(t)}));const o=s.reverse().find((t=>t.type.name===n.name));return o?{...o.attrs}:{}}function Fe(t,e){const n=ve("string"===typeof e?e:e.name,t.schema);return"node"===n?Ue(t,e):"mark"===n?Be(t,e):{}}function ze(t,e,n){const r=[];return t===e?n.resolve(t).marks().forEach((e=>{const i=n.resolve(t-1),s=Gt(i,e.type);s&&r.push({mark:e,...s})})):n.nodesBetween(t,e,((t,e)=>{r.push(...t.marks.map((n=>({from:e,to:e+t.nodeSize,mark:n}))))})),r}function Ve(t,e,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const r=t.find((t=>t.type===e&&t.name===n));return!!r&&r.attribute.keepOnSplit})))}function je(t,e,n={}){const{empty:r,ranges:i}=t.selection,s=e?qt(e,t.schema):null;if(r)return!!(t.storedMarks||t.selection.$from.marks()).filter((t=>!s||s.name===t.type.name)).find((t=>Ht(t.attrs,n,{strict:!1})));let o=0;const a=[];if(i.forEach((({$from:e,$to:n})=>{const r=e.pos,i=n.pos;t.doc.nodesBetween(r,i,((t,e)=>{if(!t.isText&&!t.marks.length)return;const n=Math.max(r,e),s=Math.min(i,e+t.nodeSize),c=s-n;o+=c,a.push(...t.marks.map((t=>({mark:t,from:n,to:s}))))}))})),0===o)return!1;const c=a.filter((t=>!s||s.name===t.mark.type.name)).filter((t=>Ht(t.mark.attrs,n,{strict:!1}))).reduce(((t,e)=>t+e.to-e.from),0),l=a.filter((t=>!s||t.mark.type!==s&&t.mark.type.excludes(s))).reduce(((t,e)=>t+e.to-e.from),0),u=c>0?c+l:c;return u>=o}function He(t,e,n={}){if(!e)return ge(t,null,n)||je(t,null,n);const r=ve(e,t.schema);return"node"===r?ge(t,e,n):"mark"===r&&je(t,e,n)}function $e(t,e){const{nodeExtensions:n}=J(e),r=n.find((e=>e.name===t));if(!r)return!1;const i={name:r.name,options:r.options,storage:r.storage},s=it(Q(r,"group",i));return"string"===typeof s&&s.split(" ").includes("list")}function Ke(t){var e;const n=null===(e=t.type.createAndFill())||void 0===e?void 0:e.toJSON(),r=t.toJSON();return JSON.stringify(n)===JSON.stringify(r)}function Ge(t){return t instanceof r.qv}function qe(t,e,n){const r=0,i=t.state.doc.content.size,s=Qt(e,r,i),o=Qt(n,r,i),a=t.coordsAtPos(s),c=t.coordsAtPos(o,-1),l=Math.min(a.top,c.top),u=Math.max(a.bottom,c.bottom),h=Math.min(a.left,c.left),d=Math.max(a.right,c.right),f=d-h,p=u-l,g=h,m=l,y={top:l,bottom:u,left:h,right:d,width:f,height:p,x:g,y:m};return{...y,toJSON:()=>y}}function We(t,e,n){var r;const{selection:i}=e;let s=null;if(Xt(i)&&(s=i.$cursor),s){const e=null!==(r=t.storedMarks)&&void 0!==r?r:s.marks();return!!n.isInSet(e)||!e.some((t=>t.type.excludes(n)))}const{ranges:o}=i;return o.some((({$from:e,$to:r})=>{let i=0===e.depth&&(t.doc.inlineContent&&t.doc.type.allowsMarkType(n));return t.doc.nodesBetween(e.pos,r.pos,((t,e,r)=>{if(i)return!1;if(t.isInline){const e=!r||r.type.allowsMarkType(n),s=!!n.isInSet(t.marks)||!t.marks.some((t=>t.type.excludes(n)));i=e&&s}return!i})),i}))}const Ye=(t,e={})=>({tr:n,state:r,dispatch:i})=>{const{selection:s}=n,{empty:o,ranges:a}=s,c=qt(t,r.schema);if(i)if(o){const t=Be(r,c);n.addStoredMark(c.create({...t,...e}))}else a.forEach((t=>{const i=t.$from.pos,s=t.$to.pos;r.doc.nodesBetween(i,s,((t,r)=>{const o=Math.max(r,i),a=Math.min(r+t.nodeSize,s),l=t.marks.find((t=>t.type===c));l?t.marks.forEach((t=>{c===t.type&&n.addMark(o,a,c.create({...t.attrs,...e}))})):n.addMark(o,a,c.create(e))}))}));return We(r,n,c)},Xe=(t,e)=>({tr:n})=>(n.setMeta(t,e),!0),Qe=(t,e={})=>({state:n,dispatch:r,chain:i})=>{const s=tt(t,n.schema);return s.isTextblock?i().command((({commands:t})=>{const r=L(s,e)(n);return!!r||t.clearNodes()})).command((({state:t})=>L(s,e)(t,r))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Je=t=>({tr:e,dispatch:n})=>{if(n){const{doc:n}=e,i=Qt(t,0,n.content.size),s=r.qv.create(n,i);e.setSelection(s)}return!0},Ze=t=>({tr:e,dispatch:n})=>{if(n){const{doc:n}=e,{from:i,to:s}="number"===typeof t?{from:t,to:t}:t,o=r.Bs.atStart(n).from,a=r.Bs.atEnd(n).to,c=Qt(i,o,a),l=Qt(s,o,a),u=r.Bs.create(n,c,l);e.setSelection(u)}return!0},tn=t=>({state:e,dispatch:n})=>{const r=tt(t,e.schema);return q(r)(e,n)};function en(t,e){const n=t.storedMarks||t.selection.$to.parentOffset&&t.selection.$from.marks();if(n){const r=n.filter((t=>null===e||void 0===e?void 0:e.includes(t.type.name)));t.tr.ensureMarks(r)}}const nn=({keepMarks:t=!0}={})=>({tr:e,state:n,dispatch:i,editor:s})=>{const{selection:o,doc:c}=e,{$from:l,$to:u}=o,h=s.extensionManager.attributes,d=Ve(h,l.node().type.name,l.node().attrs);if(o instanceof r.qv&&o.node.isBlock)return!(!l.parentOffset||!(0,a.Ax)(c,l.pos))&&(i&&(t&&en(n,s.extensionManager.splittableMarks),e.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;if(i){const i=u.parentOffset===u.parent.content.size;o instanceof r.Bs&&e.deleteSelection();const c=0===l.depth?void 0:Oe(l.node(-1).contentMatchAt(l.indexAfter(-1)));let h=i&&c?[{type:c,attrs:d}]:void 0,f=(0,a.Ax)(e.doc,e.mapping.map(l.pos),1,h);if(h||f||!(0,a.Ax)(e.doc,e.mapping.map(l.pos),1,c?[{type:c}]:void 0)||(f=!0,h=c?[{type:c,attrs:d}]:void 0),f&&(e.split(e.mapping.map(l.pos),1,h),c&&!i&&!l.parentOffset&&l.parent.type!==c)){const t=e.mapping.map(l.before()),n=e.doc.resolve(t);l.node(-1).canReplaceWith(n.index(),n.index()+1,c)&&e.setNodeMarkup(e.mapping.map(l.before()),c)}t&&en(n,s.extensionManager.splittableMarks),e.scrollIntoView()}return!0},rn=t=>({tr:e,state:n,dispatch:i,editor:s})=>{var c;const l=tt(t,n.schema),{$from:u,$to:h}=n.selection,d=n.selection.node;if(d&&d.isBlock||u.depth<2||!u.sameParent(h))return!1;const f=u.node(-1);if(f.type!==l)return!1;const p=s.extensionManager.attributes;if(0===u.parent.content.size&&u.node(-1).childCount===u.indexAfter(-1)){if(2===u.depth||u.node(-3).type!==l||u.index(-2)!==u.node(-2).childCount-1)return!1;if(i){let t=o.HY.empty;const n=u.index(-1)?1:u.index(-2)?2:3;for(let e=u.depth-n;e>=u.depth-3;e-=1)t=o.HY.from(u.node(e).copy(t));const i=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,s=Ve(p,u.node().type.name,u.node().attrs),a=(null===(c=l.contentMatch.defaultType)||void 0===c?void 0:c.createAndFill(s))||void 0;t=t.append(o.HY.from(l.createAndFill(null,a)||void 0));const h=u.before(u.depth-(n-1));e.replace(h,u.after(-i),new o.p2(t,4-n,0));let d=-1;e.doc.nodesBetween(h,e.doc.content.size,((t,e)=>{if(d>-1)return!1;t.isTextblock&&0===t.content.size&&(d=e+1)})),d>-1&&e.setSelection(r.Bs.near(e.doc.resolve(d))),e.scrollIntoView()}return!0}const g=h.pos===u.end()?f.contentMatchAt(0).defaultType:null,m=Ve(p,f.type.name,f.attrs),y=Ve(p,u.node().type.name,u.node().attrs);e.delete(u.pos,h.pos);const w=g?[{type:l,attrs:m},{type:g,attrs:y}]:[{type:l,attrs:m}];if(!(0,a.Ax)(e.doc,u.pos,2))return!1;if(i){const{selection:t,storedMarks:r}=n,{splittableMarks:o}=s.extensionManager,a=r||t.$to.parentOffset&&t.$from.marks();if(e.split(u.pos,2,w).scrollIntoView(),!a||!i)return!0;const c=a.filter((t=>o.includes(t.type.name)));e.ensureMarks(c)}return!0},sn=(t,e)=>{const n=xe((t=>t.type===e))(t.selection);if(!n)return!0;const r=t.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;const i=t.doc.nodeAt(r),s=n.node.type===(null===i||void 0===i?void 0:i.type)&&(0,a.Mn)(t.doc,n.pos);return!s||(t.join(n.pos),!0)},on=(t,e)=>{const n=xe((t=>t.type===e))(t.selection);if(!n)return!0;const r=t.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;const i=t.doc.nodeAt(r),s=n.node.type===(null===i||void 0===i?void 0:i.type)&&(0,a.Mn)(t.doc,r);return!s||(t.join(r),!0)},an=(t,e,n)=>({editor:r,tr:i,state:s,dispatch:o,chain:a,commands:c,can:l})=>{const{extensions:u,splittableMarks:h}=r.extensionManager,d=tt(t,s.schema),f=tt(e,s.schema),{selection:p,storedMarks:g}=s,{$from:m,$to:y}=p,w=m.blockRange(y),b=g||p.$to.parentOffset&&p.$from.marks();if(!w)return!1;const v=xe((t=>$e(t.type.name,u)))(p);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===d)return c.liftListItem(f);if($e(v.node.type.name,u)&&d.validContent(v.node.content)&&o)return a().command((()=>(i.setNodeMarkup(v.pos,d),!0))).command((()=>sn(i,d))).command((()=>on(i,d))).run()}return n&&b&&o?a().command((()=>{const t=l().wrapInList(d),e=b.filter((t=>h.includes(t.type.name)));return i.ensureMarks(e),!!t||c.clearNodes()})).wrapInList(d).command((()=>sn(i,d))).command((()=>on(i,d))).run():a().command((()=>{const t=l().wrapInList(d);return!!t||c.clearNodes()})).wrapInList(d).command((()=>sn(i,d))).command((()=>on(i,d))).run()},cn=(t,e={},n={})=>({state:r,commands:i})=>{const{extendEmptyMarkRange:s=!1}=n,o=qt(t,r.schema),a=je(r,o,e);return a?i.unsetMark(o,{extendEmptyMarkRange:s}):i.setMark(o,e)},ln=(t,e,n={})=>({state:r,commands:i})=>{const s=tt(t,r.schema),o=tt(e,r.schema),a=ge(r,s,n);return a?i.setNode(o):i.setNode(s,n)},un=(t,e={})=>({state:n,commands:r})=>{const i=tt(t,n.schema),s=ge(n,i,e);return s?r.lift(i):r.wrapIn(i,e)},hn=()=>({state:t,dispatch:e})=>{const n=t.plugins;for(let r=0;r<n.length;r+=1){const i=n[r];let s;if(i.spec.isInputRules&&(s=i.getState(t))){if(e){const e=t.tr,n=s.transform;for(let t=n.steps.length-1;t>=0;t-=1)e.step(n.steps[t].invert(n.docs[t]));if(s.text){const n=e.doc.resolve(s.from).marks();e.replaceWith(s.from,s.to,t.schema.text(s.text,n))}else e.delete(s.from,s.to)}return!0}}return!1},dn=()=>({tr:t,dispatch:e})=>{const{selection:n}=t,{empty:r,ranges:i}=n;return r||e&&i.forEach((e=>{t.removeMark(e.$from.pos,e.$to.pos)})),!0},fn=(t,e={})=>({tr:n,state:r,dispatch:i})=>{var s;const{extendEmptyMarkRange:o=!1}=e,{selection:a}=n,c=qt(t,r.schema),{$from:l,empty:u,ranges:h}=a;if(!i)return!0;if(u&&o){let{from:t,to:e}=a;const r=null===(s=l.marks().find((t=>t.type===c)))||void 0===s?void 0:s.attrs,i=Gt(l,c,r);i&&(t=i.from,e=i.to),n.removeMark(t,e,c)}else h.forEach((t=>{n.removeMark(t.$from.pos,t.$to.pos,c)}));return n.removeStoredMark(c),!0},pn=(t,e={})=>({tr:n,state:r,dispatch:i})=>{let s=null,o=null;const a=ve("string"===typeof t?t:t.name,r.schema);return!!a&&("node"===a&&(s=tt(t,r.schema)),"mark"===a&&(o=qt(t,r.schema)),i&&n.selection.ranges.forEach((t=>{const i=t.$from.pos,a=t.$to.pos;r.doc.nodesBetween(i,a,((t,r)=>{s&&s===t.type&&n.setNodeMarkup(r,void 0,{...t.attrs,...e}),o&&t.marks.length&&t.marks.forEach((s=>{if(o===s.type){const c=Math.max(r,i),l=Math.min(r+t.nodeSize,a);n.addMark(c,l,o.create({...s.attrs,...e}))}}))}))})),!0)},gn=(t,e={})=>({state:n,dispatch:r})=>{const i=tt(t,n.schema);return M(i,e)(n,r)},mn=(t,e={})=>({state:n,dispatch:r})=>{const i=tt(t,n.schema);return j(i,e)(n,r)};var yn=Object.freeze({__proto__:null,blur:Ot,clearContent:Pt,clearNodes:xt,command:Mt,createParagraphNear:Lt,deleteCurrentNode:Bt,deleteNode:Ut,deleteRange:Ft,deleteSelection:zt,enter:Vt,exitCode:jt,extendMarkRange:Wt,first:Yt,focus:te,forEach:ee,insertContent:ne,insertContentAt:ae,joinUp:ce,joinDown:le,joinBackward:ue,joinForward:he,keyboardShortcut:pe,lift:me,liftEmptyBlock:ye,liftListItem:we,newlineInCode:be,resetAttributes:_e,scrollIntoView:Se,selectAll:Ae,selectNodeBackward:Ce,selectNodeForward:Ie,selectParentNode:Te,selectTextblockEnd:ke,selectTextblockStart:Re,setContent:De,setMark:Ye,setMeta:Xe,setNode:Qe,setNodeSelection:Je,setTextSelection:Ze,sinkListItem:tn,splitBlock:nn,splitListItem:rn,toggleList:an,toggleMark:cn,toggleNode:ln,toggleWrap:un,undoInputRule:hn,unsetAllMarks:dn,unsetMark:fn,updateAttributes:pn,wrapIn:gn,wrapInList:mn});const wn=kt.create({name:"commands",addCommands(){return{...yn}}}),bn=kt.create({name:"editable",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("editable"),props:{editable:()=>this.editor.options.editable}})]}}),vn=kt.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:t}=this;return[new r.Sy({key:new r.H$("focusEvents"),props:{handleDOMEvents:{focus:(e,n)=>{t.isFocused=!0;const r=t.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1},blur:(e,n)=>{t.isFocused=!1;const r=t.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return e.dispatch(r),!1}}}})]}}),En=kt.create({name:"keymap",addKeyboardShortcuts(){const t=()=>this.editor.commands.first((({commands:t})=>[()=>t.undoInputRule(),()=>t.command((({tr:e})=>{const{selection:n,doc:i}=e,{empty:s,$anchor:o}=n,{pos:a,parent:c}=o,l=r.Y1.atStart(i).from===a;return!(!(s&&l&&c.type.isTextblock)||c.textContent.length)&&t.clearNodes()})),()=>t.deleteSelection(),()=>t.joinBackward(),()=>t.selectNodeBackward()])),e=()=>this.editor.commands.first((({commands:t})=>[()=>t.deleteSelection(),()=>t.deleteCurrentNode(),()=>t.joinForward(),()=>t.selectNodeForward()])),n=()=>this.editor.commands.first((({commands:t})=>[()=>t.newlineInCode(),()=>t.createParagraphNear(),()=>t.liftEmptyBlock(),()=>t.splitBlock()])),i={Enter:n,"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:t,"Mod-Backspace":t,"Shift-Backspace":t,Delete:e,"Mod-Delete":e,"Mod-a":()=>this.editor.commands.selectAll()},s={...i},o={...i,"Ctrl-h":t,"Alt-Backspace":t,"Ctrl-d":e,"Ctrl-Alt-Backspace":e,"Alt-Delete":e,"Alt-d":e,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Zt()||de()?o:s},addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("clearDocument"),appendTransaction:(t,e,n)=>{const i=t.some((t=>t.docChanged))&&!e.doc.eq(n.doc);if(!i)return;const{empty:s,from:o,to:a}=e.selection,c=r.Y1.atStart(e.doc).from,l=r.Y1.atEnd(e.doc).to,u=o===c&&a===l,h=0===n.doc.textBetween(0,n.doc.content.size," "," ").length;if(s||!u||!h)return;const d=n.tr,f=W({state:n,transaction:d}),{commands:p}=new Y({editor:this.editor,state:f});return p.clearNodes(),d.steps.length?d:void 0}})]}}),_n=kt.create({name:"tabindex",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var Sn=Object.freeze({__proto__:null,ClipboardTextSerializer:Dt,Commands:wn,Editable:bn,FocusEvents:vn,Keymap:En,Tabindex:_n});const An='.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}';function Cn(t,e){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const r=document.createElement("style");return e&&r.setAttribute("nonce",e),r.setAttribute("data-tiptap-style",""),r.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(r),r}class In extends X{constructor(t={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(t),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=Cn(An,this.options.injectNonce))}setOptions(t={}){this.options={...this.options,...t},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(t,e=!0){this.setOptions({editable:t}),e&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(t,e){const n=rt(e)?e(t,[...this.state.plugins]):[...this.state.plugins,t],r=this.state.reconfigure({plugins:n});this.view.updateState(r)}unregisterPlugin(t){if(this.isDestroyed)return;const e="string"===typeof t?`${t}$`:t.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((t=>!t.key.startsWith(e)))});this.view.updateState(n)}createExtensionManager(){const t=this.options.enableCoreExtensions?Object.values(Sn):[],e=[...t,...this.options.extensions].filter((t=>["extension","node","mark"].includes(null===t||void 0===t?void 0:t.type)));this.extensionManager=new At(e,this)}createCommandManager(){this.commandManager=new Y({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const t=Ne(this.options.content,this.schema,this.options.parseOptions),e=Jt(t,this.options.autofocus);this.view=new i.tk(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:r.yy.create({doc:t,selection:e||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews();const s=this.view.dom;s.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(t){this.isCapturingTransaction=!0,t(),this.isCapturingTransaction=!1;const e=this.capturedTransaction;return this.capturedTransaction=null,e}dispatchTransaction(t){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void t.steps.forEach((t=>{var e;return null===(e=this.capturedTransaction)||void 0===e?void 0:e.step(t)})):void(this.capturedTransaction=t);const e=this.state.apply(t),n=!this.state.selection.eq(e.selection);this.view.updateState(e),this.emit("transaction",{editor:this,transaction:t}),n&&this.emit("selectionUpdate",{editor:this,transaction:t});const r=t.getMeta("focus"),i=t.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:t}),i&&this.emit("blur",{editor:this,event:i.event,transaction:t}),t.docChanged&&!t.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:t})}getAttributes(t){return Fe(this.state,t)}isActive(t,e){const n="string"===typeof t?t:null,r="string"===typeof t?e:t;return He(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Me(this.state.doc.content,this.schema)}getText(t){const{blockSeparator:e="\n\n",textSerializers:n={}}=t||{};return Le(this.state.doc,{blockSeparator:e,textSerializers:{...Nt(this.schema),...n}})}get isEmpty(){return Ke(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var t;return!(null===(t=this.view)||void 0===t?void 0:t.docView)}}function Tn(t){return new pt({find:t.find,handler:({state:e,range:n,match:r})=>{const i=it(t.getAttributes,void 0,r);if(!1===i||null===i)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];let c=n.to;if(o){const r=a.search(/\S/),l=n.from+a.indexOf(o),u=l+o.length,h=ze(n.from,n.to,e.doc).filter((e=>{const n=e.mark.type.excluded;return n.find((n=>n===t.type&&n!==e.mark.type))})).filter((t=>t.to>l));if(h.length)return null;u<n.to&&s.delete(u,n.to),l>n.from&&s.delete(n.from+r,l),c=n.from+r+o.length,s.addMark(n.from+r,c,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}function kn(t){return new pt({find:t.find,handler:({state:e,range:n,match:r})=>{const i=it(t.getAttributes,void 0,r)||{},{tr:s}=e,o=n.from;let a=n.to;if(r[1]){const e=r[0].lastIndexOf(r[1]);let n=o+e;n>a?n=a:a=n+r[1].length;const c=r[0][r[0].length-1];s.insertText(c,o+r[0].length-1),s.replaceWith(n,a,t.type.create(i))}else r[0]&&s.replaceWith(o,a,t.type.create(i))}})}function Rn(t){return new pt({find:t.find,handler:({state:e,range:n,match:r})=>{const i=e.doc.resolve(n.from),s=it(t.getAttributes,void 0,r)||{};if(!i.node(-1).canReplaceWith(i.index(-1),i.indexAfter(-1),t.type))return null;e.tr.delete(n.from,n.to).setBlockType(n.from,n.from,t.type,s)}})}function Nn(t){return new pt({find:t.find,handler:({state:e,range:n,match:r,chain:i})=>{const s=it(t.getAttributes,void 0,r)||{},o=e.tr.delete(n.from,n.to),c=o.doc.resolve(n.from),l=c.blockRange(),u=l&&(0,a.nd)(l,t.type,s);if(!u)return null;if(o.wrap(l,u),t.keepMarks&&t.editor){const{selection:n,storedMarks:r}=e,{splittableMarks:i}=t.editor.extensionManager,s=r||n.$to.parentOffset&&n.$from.marks();if(s){const t=s.filter((t=>i.includes(t.type.name)));o.ensureMarks(t)}}if(t.keepAttributes){const e="bulletList"===t.type.name||"orderedList"===t.type.name?"listItem":"taskList";i().updateAttributes(e,s).run()}const h=o.doc.resolve(n.from-1).nodeBefore;h&&h.type===t.type&&(0,a.Mn)(o.doc,n.from-1)&&(!t.joinPredicate||t.joinPredicate(r,h))&&o.join(n.from-1)}})}class Dn{constructor(t={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=it(Q(this,"addOptions",{name:this.name}))),this.storage=it(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new Dn(t)}configure(t={}){const e=this.extend();return e.options=Tt(this.options,t),e.storage=it(Q(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new Dn(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=it(Q(e,"addOptions",{name:e.name})),e.storage=it(Q(e,"addStorage",{name:e.name,options:e.options})),e}static handleExit({editor:t,mark:e}){const{tr:n}=t.state,r=t.state.selection.$from,i=r.pos===r.end();if(i){const i=r.marks(),s=!!i.find((t=>(null===t||void 0===t?void 0:t.type.name)===e.name));if(!s)return!1;const o=i.find((t=>(null===t||void 0===t?void 0:t.type.name)===e.name));return o&&n.removeStoredMark(o),n.insertText(" ",r.pos),t.view.dispatch(n),!0}return!1}}class On{constructor(t={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...t},this.name=this.config.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=it(Q(this,"addOptions",{name:this.name}))),this.storage=it(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(t={}){return new On(t)}configure(t={}){const e=this.extend();return e.options=Tt(this.options,t),e.storage=it(Q(e,"addStorage",{name:e.name,options:e.options})),e}extend(t={}){const e=new On(t);return e.parent=this,this.child=e,e.name=t.name?t.name:e.parent.name,t.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${e.name}".`),e.options=it(Q(e,"addOptions",{name:e.name})),e.storage=it(Q(e,"addStorage",{name:e.name,options:e.options})),e}}function Pn(t){return new bt({find:t.find,handler:({state:e,range:n,match:r})=>{const i=it(t.getAttributes,void 0,r);if(!1===i||null===i)return null;const{tr:s}=e,o=r[r.length-1],a=r[0];let c=n.to;if(o){const r=a.search(/\S/),l=n.from+a.indexOf(o),u=l+o.length,h=ze(n.from,n.to,e.doc).filter((e=>{const n=e.mark.type.excluded;return n.find((n=>n===t.type&&n!==e.mark.type))})).filter((t=>t.to>l));if(h.length)return null;u<n.to&&s.delete(u,n.to),l>n.from&&s.delete(n.from+r,l),c=n.from+r+o.length,s.addMark(n.from+r,c,t.type.create(i||{})),s.removeStoredMark(t.type)}}})}},2019:function(t,e,n){"use strict";n.d(e,{Z:function(){return s}});var r=n(2066),i=n(157);const s=r.hj.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize"}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=t=>{const e=(null===t||void 0===t?void 0:t.node)||this.editor.state.doc,n=(null===t||void 0===t?void 0:t.mode)||this.options.mode;if("textSize"===n){const t=e.textBetween(0,e.content.size,void 0," ");return t.length}return e.nodeSize},this.storage.words=t=>{const e=(null===t||void 0===t?void 0:t.node)||this.editor.state.doc,n=e.textBetween(0,e.content.size," "," "),r=n.split(" ").filter((t=>""!==t));return r.length}},addProseMirrorPlugins(){return[new i.Sy({key:new i.H$("characterCount"),filterTransaction:(t,e)=>{const n=this.options.limit;if(!t.docChanged||0===n||null===n||void 0===n)return!0;const r=this.storage.characters({node:e.doc}),i=this.storage.characters({node:t.doc});if(i<=n)return!0;if(r>n&&i>n&&i<=r)return!0;if(r>n&&i>n&&i>r)return!1;const s=t.getMeta("paste");if(!s)return!1;const o=t.selection.$head.pos,a=i-n,c=o-a,l=o;t.deleteRange(c,l);const u=this.storage.characters({node:t.doc});return!(u>n)}})]}})},5017:function(t,e,n){"use strict";n.d(e,{Z:function(){return y}});var r=n(2066),i=(n(7658),n(3248)),s=n(1460),o=n(157);var a=n(7195),c=n(1811),l=n(1383);const u=t=>{const e=document.createElement("span");e.classList.add("ProseMirror-yjs-cursor"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null);const r=document.createTextNode("⁠"),i=document.createTextNode("⁠");return e.insertBefore(r,null),e.insertBefore(n,null),e.insertBefore(i,null),e},h=t=>({style:`background-color: ${t.color}70`,class:"ProseMirror-yjs-selection"}),d=/^#[0-9a-fA-F]{6}$/,f=(t,e,n,r)=>{const o=c.Gt.getState(t),u=o.doc,h=[];return null!=o.snapshot||null!=o.prevSnapshot||null===o.binding?s.EH.create(t.doc,[]):(e.getStates().forEach(((e,c)=>{if(c!==u.clientID&&null!=e.cursor){const f=e.user||{};null==f.color?f.color="#ffa500":d.test(f.color)||console.warn("A user uses an unsupported color format",f),null==f.name&&(f.name=`User: ${c}`);let p=(0,a.SF)(u,o.type,i.og(e.cursor.anchor),o.binding.mapping),g=(0,a.SF)(u,o.type,i.og(e.cursor.head),o.binding.mapping);if(null!==p&&null!==g){const e=l.Fp(t.doc.content.size-1,0);p=l.VV(p,e),g=l.VV(g,e),h.push(s.p.widget(g,(()=>n(f)),{key:c+"",side:10}));const i=l.VV(p,g),o=l.Fp(p,g);h.push(s.p.inline(i,o,r(f),{inclusiveEnd:!0,inclusiveStart:!1}))}}})),s.EH.create(t.doc,h))},p=(t,{cursorBuilder:e=u,selectionBuilder:n=h,getSelection:r=(t=>t.selection)}={},s="cursor")=>new o.Sy({key:c.uJ,state:{init(r,i){return f(i,t,e,n)},apply(r,i,s,o){const a=c.Gt.getState(o),l=r.getMeta(c.uJ);return a&&a.isChangeOrigin||l&&l.awarenessUpdated?f(o,t,e,n):i.map(r.mapping,r.doc)}},props:{decorations:t=>c.uJ.getState(t)},view:e=>{const n=()=>{e.docView&&(0,a.US)(e,c.uJ,{awarenessUpdated:!0})},o=()=>{const n=c.Gt.getState(e.state),o=t.getLocalState()||{};if(null!=n.binding)if(e.hasFocus()){const c=r(e.state),l=(0,a.JR)(c.anchor,n.type,n.binding.mapping),u=(0,a.JR)(c.head,n.type,n.binding.mapping);null!=o.cursor&&i.Uq(i.og(o.cursor.anchor),l)&&i.Uq(i.og(o.cursor.head),u)||t.setLocalStateField(s,{anchor:l,head:u})}else null!=o.cursor&&null!==(0,a.SF)(n.doc,n.type,i.og(o.cursor.anchor),n.binding.mapping)&&t.setLocalStateField(s,null)};return t.on("change",n),e.dom.addEventListener("focusin",o),e.dom.addEventListener("focusout",o),{update:o,destroy:()=>{e.dom.removeEventListener("focusin",o),e.dom.removeEventListener("focusout",o),t.off("change",n),t.setLocalStateField(s,null)}}}}),g=t=>Array.from(t.entries()).map((([t,e])=>({clientId:t,...e.user}))),m=()=>null,y=r.hj.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:t=>{const e=document.createElement("span");e.classList.add("collaboration-cursor__caret"),e.setAttribute("style",`border-color: ${t.color}`);const n=document.createElement("div");return n.classList.add("collaboration-cursor__label"),n.setAttribute("style",`background-color: ${t.color}`),n.insertBefore(document.createTextNode(t.name),null),e.insertBefore(n,null),e},onUpdate:m}},onCreate(){this.options.onUpdate!==m&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:t=>()=>(this.options.user=t,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:t=>({editor:e})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),e.commands.updateUser(t))}},addProseMirrorPlugins(){return[p((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=g(this.options.provider.awareness.states),this.options.provider.awareness.on("update",(()=>{this.storage.users=g(this.options.provider.awareness.states)})),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}})},5808:function(t,e,n){"use strict";n.d(e,{ZP:function(){return J}});var r=n(2066),i=n(1811),s=n(157);n(7658);const o=()=>{let t=!0;return(e,n)=>{if(t){t=!1;try{e()}finally{t=!0}}else void 0!==n&&n()}};var a=n(1543),c=n(1383),l=n(1370),u=n(893);const h=/[\uD800-\uDBFF]/,d=/[\uDC00-\uDFFF]/,f=(t,e)=>{let n=0,r=0;while(n<t.length&&n<e.length&&t[n]===e[n])n++;h.test(t[n-1])&&n--;while(r+n<t.length&&r+n<e.length&&t[t.length-r-1]===e[e.length-r-1])r++;return d.test(t[t.length-r])&&r--,{index:n,remove:t.length-n-r,insert:e.slice(n,e.length-r)}},p=f;var g=n(6969),m=n(3248),y=n(7195),w=n(6157),b=n(6413),v=n(7214),E=n(1634);const _=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&e.sv.get(t.id.client)>t.id.clock&&!m.uY(e.ds,t.id),S=[{light:"#ecd44433",dark:"#ecd444"}],A=(t,e,n)=>{if(!t.has(n)){if(t.size<e.length){const n=u.Ue();t.forEach((t=>n.add(t))),e=e.filter((t=>!n.has(t)))}t.set(n,w.kw(e))}return t.get(n)},C=(t,{colors:e=S,colorMapping:n=new Map,permanentUserData:r=null,onFirstRender:o=(()=>{})}={})=>{let a,c=!1;const l=new s.Sy({props:{editable:t=>{const e=i.Gt.getState(t);return null==e.snapshot&&null==e.prevSnapshot}},key:i.Gt,state:{init:(i,s)=>({type:t,doc:t.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:e,colorMapping:n,permanentUserData:r}),apply:(t,e)=>{const n=t.getMeta(i.Gt);if(void 0!==n){e=Object.assign({},e);for(const t in n)e[t]=n[t]}return e.isChangeOrigin=void 0!==n&&!!n.isChangeOrigin,null!==e.binding&&(void 0===n||null==n.snapshot&&null==n.prevSnapshot||E.Vs(0,(()=>{null==e.binding||e.binding.isDestroyed||(null==n.restore?e.binding._renderSnapshot(n.snapshot,n.prevSnapshot,e):(e.binding._renderSnapshot(n.snapshot,n.snapshot,e),delete e.restore,delete e.snapshot,delete e.prevSnapshot,e.binding._prosemirrorChanged(e.binding.prosemirrorView.state.doc)))}))),e}},view:e=>{const n=new k(t,e);return null!=a&&clearTimeout(a),a=E.Vs(0,(()=>{n._forceRerender(),e.dispatch(e.state.tr.setMeta(i.Gt,{binding:n})),o()})),{update:()=>{const t=l.getState(e.state);null==t.snapshot&&null==t.prevSnapshot&&(c||null!==e.state.doc.content.findDiffStart(e.state.doc.type.createAndFill().content))&&(c=!0,n._prosemirrorChanged(e.state.doc))},destroy:()=>{clearTimeout(a),n.destroy()}}}});return l},I=(t,e,n)=>{if(null!==e&&null!==e.anchor&&null!==e.head){const r=(0,y.SF)(n.doc,n.type,e.anchor,n.mapping),i=(0,y.SF)(n.doc,n.type,e.head,n.mapping);null!==r&&null!==i&&(t=t.setSelection(s.Bs.create(t.doc,r,i)))}},T=(t,e)=>({anchor:(0,y.JR)(e.selection.anchor,t.type,t.mapping),head:(0,y.JR)(e.selection.head,t.type,t.mapping)});class k{constructor(t,e){this.type=t,this.prosemirrorView=e,this.mux=o(),this.isDestroyed=!1,this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=t.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{null===this.beforeTransactionSelection&&(this.beforeTransactionSelection=T(this,e.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),t.observeDeep(this._observeFunction),this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return!!this.prosemirrorView.hasFocus()&&(b.jU&&null===this._domSelectionInView&&(E.Vs(0,(()=>{this._domSelectionInView=null})),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView)}_isDomSelectionInView(){const t=this.prosemirrorView._root.getSelection(),e=this.prosemirrorView._root.createRange();e.setStart(t.anchorNode,t.anchorOffset),e.setEnd(t.focusNode,t.focusOffset);const n=e.getClientRects();0===n.length&&e.startContainer&&e.collapsed&&e.selectNodeContents(e.startContainer);const r=e.getBoundingClientRect(),i=v.JU.documentElement;return r.bottom>=0&&r.right>=0&&r.left<=(window.innerWidth||i.clientWidth||0)&&r.top<=(window.innerHeight||i.clientHeight||0)}renderSnapshot(t,e){e||(e=m.Ox(m.VG(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(i.Gt,{snapshot:t,prevSnapshot:e}))}unrenderSnapshot(){this.mapping=new Map,this.mux((()=>{const t=this.type.toArray().map((t=>N(t,this.prosemirrorView.state.schema,this.mapping))).filter((t=>null!==t)),e=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(t),0,0));e.setMeta(i.Gt,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(e)}))}_forceRerender(){this.mapping=new Map,this.mux((()=>{const t=this.type.toArray().map((t=>N(t,this.prosemirrorView.state.schema,this.mapping))).filter((t=>null!==t)),e=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(t),0,0));this.prosemirrorView.dispatch(e.setMeta(i.Gt,{isChangeOrigin:!0}))}))}_renderSnapshot(t,e,n){t||(t=m.CO(this.doc)),this.mapping=new Map,this.mux((()=>{this.doc.transact((r=>{const s=n.permanentUserData;s&&s.dss.forEach((t=>{m.UQ(r,t,(t=>{}))}));const o=(t,e)=>{const r="added"===t?s.getUserByClientId(e.client):s.getUserByDeletedId(e);return{user:r,type:t,color:A(n.colorMapping,n.colors,r)}},c=m.ud(this.type,new m.aC(e.ds,t.sv)).map((n=>!n._item.deleted||_(n._item,t)||_(n._item,e)?N(n,this.prosemirrorView.state.schema,new Map,t,e,o):null)).filter((t=>null!==t)),l=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(c),0,0));this.prosemirrorView.dispatch(l.setMeta(i.Gt,{isChangeOrigin:!0}))}),i.Gt)}))}_typeChanged(t,e){const n=i.Gt.getState(this.prosemirrorView.state);0!==t.length&&null==n.snapshot&&null==n.prevSnapshot?this.mux((()=>{const t=(t,e)=>this.mapping.delete(e);m.UQ(e,e.deleteSet,(t=>t.constructor===m.ck&&this.mapping.delete(t.content.type))),e.changed.forEach(t),e.changedParentTypes.forEach(t);const n=this.type.toArray().map((t=>R(t,this.prosemirrorView.state.schema,this.mapping))).filter((t=>null!==t));let r=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(n),0,0));I(r,this.beforeTransactionSelection,this),r=r.setMeta(i.Gt,{isChangeOrigin:!0}),null!==this.beforeTransactionSelection&&this._isLocalCursorInView()&&r.scrollIntoView(),this.prosemirrorView.dispatch(r)})):this.renderSnapshot(n.snapshot,n.prevSnapshot)}_prosemirrorChanged(t){this.mux((()=>{this.doc.transact((()=>{K(this.doc,this.type,t,this.mapping),this.beforeTransactionSelection=T(this,this.prosemirrorView.state)}),i.Gt)}))}destroy(){this.isDestroyed=!0,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const R=(t,e,n,r,i,s)=>{const o=n.get(t);if(void 0===o){if(t instanceof m.lt)return N(t,e,n,r,i,s);throw g.Nw()}return o},N=(t,e,n,r,s,o)=>{const a=[],c=t=>{if(t.constructor===m.lt){const i=R(t,e,n,r,s,o);null!==i&&a.push(i)}else{const i=D(t,e,n,r,s,o);null!==i&&i.forEach((t=>{null!==t&&a.push(t)}))}};void 0===r||void 0===s?t.toArray().forEach(c):m.ud(t,new m.aC(s.ds,r.sv)).forEach(c);try{const i=t.getAttributes(r);void 0!==r&&(_(t._item,r)?_(t._item,s)||(i.ychange=o?o("added",t._item.id):{type:"added"}):i.ychange=o?o("removed",t._item.id):{type:"removed"});const c=e.node(t.nodeName,i,a);return n.set(t,c),c}catch(l){return t.doc.transact((e=>{t._item.delete(e)}),i.Gt),n.delete(t),null}},D=(t,e,n,r,s,o)=>{const a=[],c=t.toDelta(r,s,o);try{for(let t=0;t<c.length;t++){const n=c[t],r=[];for(const t in n.attributes)r.push(e.mark(t,n.attributes[t]));a.push(e.text(n.insert,r))}}catch(l){return t.doc.transact((e=>{t._item.delete(e)}),i.Gt),null}return a},O=(t,e)=>{const n=new m.eI,r=t.map((t=>({insert:t.text,attributes:$(t.marks)})));return n.applyDelta(r),e.set(n,t),n},P=(t,e)=>{const n=new m.lt(t.type.name);for(const r in t.attrs){const e=t.attrs[r];null!==e&&"ychange"!==r&&n.setAttribute(r,e)}return n.insert(0,B(t).map((t=>x(t,e)))),e.set(n,t),n},x=(t,e)=>t instanceof Array?O(t,e):P(t,e),M=t=>"object"===typeof t&&null!==t,L=(t,e)=>{const n=Object.keys(t).filter((e=>null!==t[e]));let r=n.length===Object.keys(e).filter((t=>null!==e[t])).length;for(let i=0;i<n.length&&r;i++){const s=n[i],o=t[s],a=e[s];r="ychange"===s||o===a||M(o)&&M(a)&&L(o,a)}return r},B=t=>{const e=t.content.content,n=[];for(let r=0;r<e.length;r++){const t=e[r];if(t.isText){const t=[];for(let n=e[r];r<e.length&&n.isText;n=e[++r])t.push(n);r--,n.push(t)}else n.push(t)}return n},U=(t,e)=>{const n=t.toDelta();return n.length===e.length&&n.every(((t,n)=>t.insert===e[n].text&&l.XP(t.attributes||{}).length===e[n].marks.length&&e[n].marks.every((e=>L(t.attributes[e.type.name]||{},e.attrs)))))},F=(t,e)=>{if(t instanceof m.lt&&!(e instanceof Array)&&G(t,e)){const n=B(e);return t._length===n.length&&L(t.getAttributes(),e.attrs)&&t.toArray().every(((t,e)=>F(t,n[e])))}return t instanceof m.eI&&e instanceof Array&&U(t,e)},z=(t,e)=>t===e||t instanceof Array&&e instanceof Array&&t.length===e.length&&t.every(((t,n)=>e[n]===t)),V=(t,e,n)=>{const r=t.toArray(),i=B(e),s=i.length,o=r.length,a=c.VV(o,s);let l=0,u=0,h=!1;for(;l<a;l++){const t=r[l],e=i[l];if(z(n.get(t),e))h=!0;else if(!F(t,e))break}for(;l+u<a;u++){const t=r[o-u-1],e=i[s-u-1];if(z(n.get(t),e))h=!0;else if(!F(t,e))break}return{equalityFactor:l+u,foundMappedChild:h}},j=t=>{let e="",n=t._start;const r={};while(null!==n)n.deleted||(n.countable&&n.content instanceof m.$_?e+=n.content.str:n.content instanceof m.MM&&(r[n.content.key]=null)),n=n.right;return{str:e,nAttrs:r}},H=(t,e,n)=>{n.set(t,e);const{nAttrs:r,str:i}=j(t),s=e.map((t=>({insert:t.text,attributes:Object.assign({},r,$(t.marks))}))),{insert:o,remove:a,index:c}=p(i,s.map((t=>t.insert)).join(""));t.delete(c,a),t.insert(c,o),t.applyDelta(s.map((t=>({retain:t.insert.length,attributes:t.attributes}))))},$=t=>{const e={};return t.forEach((t=>{"ychange"!==t.type.name&&(e[t.type.name]=t.attrs)})),e},K=(t,e,n,r)=>{if(e instanceof m.lt&&e.nodeName!==n.type.name)throw new Error("node name mismatch!");if(r.set(e,n),e instanceof m.lt){const t=e.getAttributes(),r=n.attrs;for(const n in r)null!==r[n]?t[n]!==r[n]&&"ychange"!==n&&e.setAttribute(n,r[n]):e.removeAttribute(n);for(const n in t)void 0===r[n]&&e.removeAttribute(n)}const s=B(n),o=s.length,a=e.toArray(),l=a.length,u=c.VV(o,l);let h=0,d=0;for(;h<u;h++){const t=a[h],e=s[h];if(!z(r.get(t),e)){if(!F(t,e))break;r.set(t,e)}}for(;d+h+1<u;d++){const t=a[l-d-1],e=s[o-d-1];if(!z(r.get(t),e)){if(!F(t,e))break;r.set(t,e)}}t.transact((()=>{while(l-h-d>0&&o-h-d>0){const n=a[h],i=s[h],c=a[l-d-1],u=s[o-d-1];if(n instanceof m.eI&&i instanceof Array)U(n,i)||H(n,i,r),h+=1;else{let s=n instanceof m.lt&&G(n,i),o=c instanceof m.lt&&G(c,u);if(s&&o){const t=V(n,i,r),e=V(c,u,r);t.foundMappedChild&&!e.foundMappedChild?o=!1:!t.foundMappedChild&&e.foundMappedChild||t.equalityFactor<e.equalityFactor?s=!1:o=!1}s?(K(t,n,i,r),h+=1):o?(K(t,c,u,r),d+=1):(e.delete(h,1),e.insert(h,[x(i,r)]),h+=1)}}const n=l-h-d;if(1===l&&0===o&&a[0]instanceof m.eI?a[0].delete(0,a[0].length):n>0&&e.delete(h,n),h+d<o){const t=[];for(let e=h;e<o-d;e++)t.push(x(s[e],r));e.insert(h,t)}}),i.Gt)},G=(t,e)=>!(e instanceof Array)&&t.nodeName===e.type.name,q=t=>{const e=i.Gk.getState(t).undoManager;if(null!=e)return e.undo(),!0},W=t=>{const e=i.Gk.getState(t).undoManager;if(null!=e)return e.redo(),!0},Y=new Set(["paragraph"]),X=(t,e)=>!(t instanceof m.ck)||!(t.content instanceof m.zc)||!(t.content.type instanceof m.xv||t.content.type instanceof m.lt&&e.has(t.content.type.nodeName))||0===t.content.type._length,Q=({protectedNodes:t=Y,trackedOrigins:e=[],undoManager:n=null}={})=>new s.Sy({key:i.Gk,state:{init:(r,s)=>{const o=i.Gt.getState(s),a=n||new m.H6(o.type,{trackedOrigins:new Set([i.Gt].concat(e)),deleteFilter:e=>X(e,t)});return{undoManager:a,prevSel:null,hasUndoOps:a.undoStack.length>0,hasRedoOps:a.redoStack.length>0}},apply:(t,e,n,r)=>{const s=i.Gt.getState(r).binding,o=e.undoManager,a=o.undoStack.length>0,c=o.redoStack.length>0;return s?{undoManager:o,prevSel:T(s,n),hasUndoOps:a,hasRedoOps:c}:a!==e.hasUndoOps||c!==e.hasRedoOps?Object.assign({},e,{hasUndoOps:o.undoStack.length>0,hasRedoOps:o.redoStack.length>0}):e}},view:t=>{const e=i.Gt.getState(t.state),n=i.Gk.getState(t.state).undoManager;return n.on("stack-item-added",(({stackItem:n})=>{const r=e.binding;r&&n.meta.set(r,i.Gk.getState(t.state).prevSel)})),n.on("stack-item-popped",(({stackItem:t})=>{const n=e.binding;n&&(n.beforeTransactionSelection=t.meta.get(n)||n.beforeTransactionSelection)})),{destroy:()=>{n.destroy()}}}}),J=r.hj.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find((t=>"history"===t.name))&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:t,state:e,dispatch:n})=>{t.setMeta("preventDispatch",!0);const r=i.Gk.getState(e).undoManager;return 0!==r.undoStack.length&&(!n||q(e))},redo:()=>({tr:t,state:e,dispatch:n})=>{t.setMeta("preventDispatch",!0);const r=i.Gk.getState(e).undoManager;return 0!==r.redoStack.length&&(!n||W(e))}}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const t=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[C(t,{onFirstRender:()=>{var t;null===(t=this.options.onFirstRender)||void 0===t||t.apply(this)}}),Q()]}})},3778:function(t,e,n){"use strict";n.d(e,{ZP:function(){return o}});var r=n(2066);const i=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,s=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,o=r.vc.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:t=>t.getAttribute("data-color")||t.style.backgroundColor,renderHTML:t=>t.color?{"data-color":t.color,style:`background-color: ${t.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:t}){return["mark",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setHighlight:t=>({commands:e})=>e.setMark(this.name,t),toggleHighlight:t=>({commands:e})=>e.toggleMark(this.name,t),unsetHighlight:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[(0,r.Cf)({find:i,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:s,type:this.type})]}})},3747:function(t,e,n){"use strict";n.d(e,{ZP:function(){return s}});var r=n(2066);const i=/^\s*(\[([( |x])?\])\s$/,s=r.NB.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:t=>"true"===t.getAttribute("data-checked"),renderHTML:t=>({"data-checked":t.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:t,HTMLAttributes:e}){return["li",(0,r.P1)(this.options.HTMLAttributes,e,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:t.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const t={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...t,Tab:()=>this.editor.commands.sinkListItem(this.name)}:t},addNodeView(){return({node:t,HTMLAttributes:e,getPos:n,editor:r})=>{const i=document.createElement("li"),s=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),c=document.createElement("div");return s.contentEditable="false",a.type="checkbox",a.addEventListener("change",(e=>{if(!r.isEditable&&!this.options.onReadOnlyChecked)return void(a.checked=!a.checked);const{checked:i}=e.target;r.isEditable&&"function"===typeof n&&r.chain().focus(void 0,{scrollIntoView:!1}).command((({tr:t})=>{const e=n(),r=t.doc.nodeAt(e);return t.setNodeMarkup(e,void 0,{...null===r||void 0===r?void 0:r.attrs,checked:i}),!0})).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(t,i)||(a.checked=!a.checked))})),Object.entries(this.options.HTMLAttributes).forEach((([t,e])=>{i.setAttribute(t,e)})),i.dataset.checked=t.attrs.checked,t.attrs.checked&&a.setAttribute("checked","checked"),s.append(a,o),i.append(s,c),Object.entries(e).forEach((([t,e])=>{i.setAttribute(t,e)})),{dom:i,contentDOM:c,update:t=>t.type===this.type&&(i.dataset.checked=t.attrs.checked,t.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[(0,r.S0)({find:i,type:this.type,getAttributes:t=>({checked:"x"===t[t.length-1]})})]}})},1531:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});var r=n(2066);const i=r.NB.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:t}){return["ul",(0,r.P1)(this.options.HTMLAttributes,t,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:t})=>t.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}})},3929:function(t,e,n){"use strict";n.d(e,{Z:function(){return Dt}});n(7658);var r=n(2066);const i=/^\s*>\s$/,s=r.NB.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:t}){return["blockquote",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setBlockquote:()=>({commands:t})=>t.wrapIn(this.name),toggleBlockquote:()=>({commands:t})=>t.toggleWrap(this.name),unsetBlockquote:()=>({commands:t})=>t.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[(0,r.S0)({find:i,type:this.type})]}}),o=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,a=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,c=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,l=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,u=r.vc.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:t=>"normal"!==t.style.fontWeight&&null},{style:"font-weight",getAttrs:t=>/^(bold(er)?|[5-9]\d{2,})$/.test(t)&&null}]},renderHTML({HTMLAttributes:t}){return["strong",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setBold:()=>({commands:t})=>t.setMark(this.name),toggleBold:()=>({commands:t})=>t.toggleMark(this.name),unsetBold:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[(0,r.Cf)({find:o,type:this.type}),(0,r.Cf)({find:c,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:a,type:this.type}),(0,r.K9)({find:l,type:this.type})]}}),h=r.NB.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",(0,r.P1)(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),d=r.vc.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>{const e=t.hasAttribute("style");return!!e&&{}}}]},renderHTML({HTMLAttributes:t}){return["span",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=(0,r.Jo)(t,this.type),i=Object.entries(n).some((([,t])=>!!t));return!!i||e.unsetMark(this.name)}}}}),f=/^\s*([-+*])\s$/,p=r.NB.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:t}){return["ul",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleBulletList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(h.name,this.editor.getAttributes(d.name)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let t=(0,r.S0)({find:f,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=(0,r.S0)({find:f,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(d.name),editor:this.editor})),[t]}}),g=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,m=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,y=r.vc.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:t}){return["code",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setCode:()=>({commands:t})=>t.setMark(this.name),toggleCode:()=>({commands:t})=>t.toggleMark(this.name),unsetCode:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[(0,r.Cf)({find:g,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:m,type:this.type})]}});var w=n(157);const b=/^```([a-z]+)?[\s\n]$/,v=/^~~~([a-z]+)?[\s\n]$/,E=r.NB.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:t=>{var e;const{languageClassPrefix:n}=this.options,r=[...(null===(e=t.firstElementChild)||void 0===e?void 0:e.classList)||[]],i=r.filter((t=>t.startsWith(n))).map((t=>t.replace(n,""))),s=i[0];return s||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:t,HTMLAttributes:e}){return["pre",(0,r.P1)(this.options.HTMLAttributes,e),["code",{class:t.attrs.language?this.options.languageClassPrefix+t.attrs.language:null},0]]},addCommands(){return{setCodeBlock:t=>({commands:e})=>e.setNode(this.name,t),toggleCodeBlock:t=>({commands:e})=>e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:t,$anchor:e}=this.editor.state.selection,n=1===e.pos;return!(!t||e.parent.type.name!==this.name)&&(!(!n&&e.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:t})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:e}=t,{selection:n}=e,{$from:r,empty:i}=n;if(!i||r.parent.type!==this.type)return!1;const s=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith("\n\n");return!(!s||!o)&&t.chain().command((({tr:t})=>(t.delete(r.pos-2,r.pos),!0))).exitCode().run()},ArrowDown:({editor:t})=>{if(!this.options.exitOnArrowDown)return!1;const{state:e}=t,{selection:n,doc:r}=e,{$from:i,empty:s}=n;if(!s||i.parent.type!==this.type)return!1;const o=i.parentOffset===i.parent.nodeSize-2;if(!o)return!1;const a=i.after();if(void 0===a)return!1;const c=r.nodeAt(a);return!c&&t.commands.exitCode()}}},addInputRules(){return[(0,r.zK)({find:b,type:this.type,getAttributes:t=>({language:t[1]})}),(0,r.zK)({find:v,type:this.type,getAttributes:t=>({language:t[1]})})]},addProseMirrorPlugins(){return[new w.Sy({key:new w.H$("codeBlockVSCodeHandler"),props:{handlePaste:(t,e)=>{if(!e.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=e.clipboardData.getData("text/plain"),r=e.clipboardData.getData("vscode-editor-data"),i=r?JSON.parse(r):void 0,s=null===i||void 0===i?void 0:i.mode;if(!n||!s)return!1;const{tr:o}=t.state;return o.replaceSelectionWith(this.type.create({language:s})),o.setSelection(w.Bs.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,"\n")),o.setMeta("paste",!0),t.dispatch(o),!0}}})]}}),_=r.NB.create({name:"doc",topNode:!0,content:"block+"});var S=n(1382);function A(t={}){return new w.Sy({view(e){return new C(e,t)}})}class C{constructor(t,e){this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=e.width||1,this.color=e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map((e=>{let n=t=>{this[e](t)};return t.dom.addEventListener(e,n),{name:e,handler:n}}))}destroy(){this.handlers.forEach((({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e)))}update(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t,e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent;if(n){let n=e.nodeBefore,r=e.nodeAfter;if(n||r){let e=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(e){let i=e.getBoundingClientRect(),s=n?i.bottom:i.top;n&&r&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:i.left,right:i.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!t){let e=this.editorView.coordsAtPos(this.cursorPos);t={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let r,i,s=this.editorView.dom.offsetParent;if(this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!s||s==document.body&&"static"==getComputedStyle(s).position)r=-pageXOffset,i=-pageYOffset;else{let t=s.getBoundingClientRect();r=t.left-s.scrollLeft,i=t.top-s.scrollTop}this.element.style.left=t.left-r+"px",this.element.style.top=t.top-i+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=n&&n.type.spec.disableDropCursor,i="function"==typeof r?r(this.editorView,e,t):r;if(e&&!i){let t=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let e=(0,S.nj)(this.editorView.state.doc,t,this.editorView.dragging.slice);null!=e&&(t=e)}this.setCursor(t),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){t.target!=this.editorView.dom&&this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}const I=r.hj.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[A(this.options)]}});var T=n(203),k=n(1543),R=n(1460);class N extends w.Y1{constructor(t){super(t,t)}map(t,e){let n=t.resolve(e.map(this.head));return N.valid(n)?new N(n):w.Y1.near(n)}content(){return k.p2.empty}eq(t){return t instanceof N&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new N(t.resolve(e.pos))}getBookmark(){return new D(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!O(t)||!P(t))return!1;let n=e.type.spec.allowGapCursor;if(null!=n)return n;let r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(t,e,n=!1){t:for(;;){if(!n&&N.valid(t))return t;let r=t.pos,i=null;for(let n=t.depth;;n--){let s=t.node(n);if(e>0?t.indexAfter(n)<s.childCount:t.index(n)>0){i=s.child(e>0?t.indexAfter(n):t.index(n)-1);break}if(0==n)return null;r+=e;let o=t.doc.resolve(r);if(N.valid(o))return o}for(;;){let s=e>0?i.firstChild:i.lastChild;if(!s){if(i.isAtom&&!i.isText&&!w.qv.isSelectable(i)){t=t.doc.resolve(r+i.nodeSize*e),n=!1;continue t}break}i=s,r+=e;let o=t.doc.resolve(r);if(N.valid(o))return o}return null}}}N.prototype.visible=!1,N.findFrom=N.findGapCursorFrom,w.Y1.jsonID("gapcursor",N);class D{constructor(t){this.pos=t}map(t){return new D(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return N.valid(e)?new N(e):w.Y1.near(e)}}function O(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(0!=n)for(let t=r.child(n-1);;t=t.lastChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}function P(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n!=r.childCount)for(let t=r.child(n);;t=t.firstChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}function x(){return new w.Sy({props:{decorations:F,createSelectionBetween(t,e,n){return e.pos==n.pos&&N.valid(n)?new N(n):null},handleClick:B,handleKeyDown:M,handleDOMEvents:{beforeinput:U}}})}const M=(0,T.$)({ArrowLeft:L("horiz",-1),ArrowRight:L("horiz",1),ArrowUp:L("vert",-1),ArrowDown:L("vert",1)});function L(t,e){const n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,r,i){let s=t.selection,o=e>0?s.$to:s.$from,a=s.empty;if(s instanceof w.Bs){if(!i.endOfTextblock(n)||0==o.depth)return!1;a=!1,o=t.doc.resolve(e>0?o.after():o.before())}let c=N.findGapCursorFrom(o,e,a);return!!c&&(r&&r(t.tr.setSelection(new N(c))),!0)}}function B(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!N.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return!(i&&i.inside>-1&&w.qv.isSelectable(t.state.doc.nodeAt(i.inside)))&&(t.dispatch(t.state.tr.setSelection(new N(r))),!0)}function U(t,e){if("insertCompositionText"!=e.inputType||!(t.state.selection instanceof N))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=k.HY.empty;for(let o=r.length-1;o>=0;o--)i=k.HY.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new k.p2(i,0,0));return s.setSelection(w.Bs.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function F(t){if(!(t.selection instanceof N))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",R.EH.create(t.doc,[R.p.widget(t.selection.head,e,{key:"gapcursor"})])}const z=r.hj.create({name:"gapCursor",addProseMirrorPlugins(){return[x()]},extendNodeSchema(t){var e;const n={name:t.name,options:t.options,storage:t.storage};return{allowGapCursor:null!==(e=(0,r.nU)((0,r.Nl)(t,"allowGapCursor",n)))&&void 0!==e?e:null}}}),V=r.NB.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:t}){return["br",(0,r.P1)(this.options.HTMLAttributes,t)]},renderText(){return"\n"},addCommands(){return{setHardBreak:()=>({commands:t,chain:e,state:n,editor:r})=>t.first([()=>t.exitCode(),()=>t.command((()=>{const{selection:t,storedMarks:i}=n;if(t.$from.parent.type.spec.isolating)return!1;const{keepMarks:s}=this.options,{splittableMarks:o}=r.extensionManager,a=i||t.$to.parentOffset&&t.$from.marks();return e().insertContent({type:this.name}).command((({tr:t,dispatch:e})=>{if(e&&a&&s){const e=a.filter((t=>o.includes(t.type.name)));t.ensureMarks(e)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),j=r.NB.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map((t=>({tag:`h${t}`,attrs:{level:t}})))},renderHTML({node:t,HTMLAttributes:e}){const n=this.options.levels.includes(t.attrs.level),i=n?t.attrs.level:this.options.levels[0];return[`h${i}`,(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setHeading:t=>({commands:e})=>!!this.options.levels.includes(t.level)&&e.setNode(this.name,t),toggleHeading:t=>({commands:e})=>!!this.options.levels.includes(t.level)&&e.toggleNode(this.name,"paragraph",t)}},addKeyboardShortcuts(){return this.options.levels.reduce(((t,e)=>({...t,[`Mod-Alt-${e}`]:()=>this.editor.commands.toggleHeading({level:e})})),{})},addInputRules(){return this.options.levels.map((t=>(0,r.zK)({find:new RegExp(`^(#{1,${t}})\\s$`),type:this.type,getAttributes:{level:t}})))}});var H=200,$=function(){};$.prototype.append=function(t){return t.length?(t=$.from(t),!this.length&&t||t.length<H&&this.leafAppend(t)||this.length<H&&t.leafPrepend(this)||this.appendInner(t)):this},$.prototype.prepend=function(t){return t.length?$.from(t).append(this):this},$.prototype.appendInner=function(t){return new G(this,t)},$.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?$.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},$.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},$.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},$.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(e,n){return r.push(t(e,n))}),e,n),r},$.from=function(t){return t instanceof $?t:t&&t.length?new K(t):$.empty};var K=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,r){for(var i=e;i<n;i++)if(!1===t(this.values[i],r+i))return!1},e.prototype.forEachInvertedInner=function(t,e,n,r){for(var i=e-1;i>=n;i--)if(!1===t(this.values[i],r+i))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=H)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=H)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}($);$.empty=new K([]);var G=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,r){var i=this.left.length;return!(e<i&&!1===this.left.forEachInner(t,e,Math.min(n,i),r))&&(!(n>i&&!1===this.right.forEachInner(t,Math.max(e-i,0),Math.min(this.length,n)-i,r+i))&&void 0)},e.prototype.forEachInvertedInner=function(t,e,n,r){var i=this.left.length;return!(e>i&&!1===this.right.forEachInvertedInner(t,e-i,Math.max(n,i)-i,r+i))&&(!(n<i&&!1===this.left.forEachInvertedInner(t,Math.min(e,i),n,r))&&void 0)},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}($),q=$,W=q;const Y=500;class X{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(0==this.eventCount)return null;let n,r,i=this.items.length;for(;;i--){let t=this.items.get(i-1);if(t.selection){--i;break}}e&&(n=this.remapping(i,this.items.length),r=n.maps.length);let s,o,a=t.tr,c=[],l=[];return this.items.forEach(((t,e)=>{if(!t.step)return n||(n=this.remapping(i,e+1),r=n.maps.length),r--,void l.push(t);if(n){l.push(new J(t.map));let e,i=t.step.map(n.slice(r));i&&a.maybeStep(i).doc&&(e=a.mapping.maps[a.mapping.maps.length-1],c.push(new J(e,void 0,void 0,c.length+l.length))),r--,e&&n.appendMap(e,r)}else a.maybeStep(t.step);return t.selection?(s=n?t.selection.map(n.slice(r)):t.selection,o=new X(this.items.slice(0,i).append(l.reverse().concat(c)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:o,transform:a,selection:s}}addTransform(t,e,n,r){let i=[],s=this.eventCount,o=this.items,a=!r&&o.length?o.get(o.length-1):null;for(let l=0;l<t.steps.length;l++){let n,c=t.steps[l].invert(t.docs[l]),u=new J(t.mapping.maps[l],c,e);(n=a&&a.merge(u))&&(u=n,l?i.pop():o=o.slice(0,o.length-1)),i.push(u),e&&(s++,e=void 0),r||(a=u)}let c=s-n.depth;return c>tt&&(o=Q(o,c),s-=c),new X(o.append(i),s)}remapping(t,e){let n=new S.vs;return this.items.forEach(((e,r)=>{let i=null!=e.mirrorOffset&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:void 0;n.appendMap(e.map,i)}),t,e),n}addMaps(t){return 0==this.eventCount?this:new X(this.items.append(t.map((t=>new J(t)))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-e),i=t.mapping,s=t.steps.length,o=this.eventCount;this.items.forEach((t=>{t.selection&&o--}),r);let a=e;this.items.forEach((e=>{let r=i.getMirror(--a);if(null==r)return;s=Math.min(s,r);let c=i.maps[r];if(e.step){let s=t.steps[r].invert(t.docs[r]),l=e.selection&&e.selection.map(i.slice(a+1,r));l&&o++,n.push(new J(c,s,l))}else n.push(new J(c))}),r);let c=[];for(let h=e;h<s;h++)c.push(new J(i.maps[h]));let l=this.items.slice(0,r).append(c).append(n),u=new X(l,o);return u.emptyItemCount()>Y&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let t=0;return this.items.forEach((e=>{e.step||t++})),t}compress(t=this.items.length){let e=this.remapping(0,t),n=e.maps.length,r=[],i=0;return this.items.forEach(((s,o)=>{if(o>=t)r.push(s),s.selection&&i++;else if(s.step){let t=s.step.map(e.slice(n)),o=t&&t.getMap();if(n--,o&&e.appendMap(o,n),t){let a=s.selection&&s.selection.map(e.slice(n));a&&i++;let c,l=new J(o.invert(),t,a),u=r.length-1;(c=r.length&&r[u].merge(l))?r[u]=c:r.push(l)}}else s.map&&n--}),this.items.length,0),new X(W.from(r.reverse()),i)}}function Q(t,e){let n;return t.forEach(((t,r)=>{if(t.selection&&0==e--)return n=r,!1})),t.slice(n)}X.empty=new X(W.empty,0);class J{constructor(t,e,n,r){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new J(e.getMap().invert(),e,this.selection)}}}class Z{constructor(t,e,n,r){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=r}}const tt=20;function et(t,e,n,r){let i,s=n.getMeta(lt);if(s)return s.historyState;n.getMeta(ut)&&(t=new Z(t.done,t.undone,null,0));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(o&&o.getMeta(lt))return o.getMeta(lt).redo?new Z(t.done.addTransform(n,void 0,r,ct(e)),t.undone,rt(n.mapping.maps[n.steps.length-1]),t.prevTime):new Z(t.done,t.undone.addTransform(n,void 0,r,ct(e)),null,t.prevTime);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(i=n.getMeta("rebased"))?new Z(t.done.rebased(n,i),t.undone.rebased(n,i),it(t.prevRanges,n.mapping),t.prevTime):new Z(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),it(t.prevRanges,n.mapping),t.prevTime);{let i=0==t.prevTime||!o&&(t.prevTime<(n.time||0)-r.newGroupDelay||!nt(n,t.prevRanges)),s=o?it(t.prevRanges,n.mapping):rt(n.mapping.maps[n.steps.length-1]);return new Z(t.done.addTransform(n,i?e.selection.getBookmark():void 0,r,ct(e)),X.empty,s,n.time)}}function nt(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach(((t,r)=>{for(let i=0;i<e.length;i+=2)t<=e[i+1]&&r>=e[i]&&(n=!0)})),n}function rt(t){let e=[];return t.forEach(((t,n,r,i)=>e.push(r,i))),e}function it(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function st(t,e,n,r){let i=ct(e),s=lt.get(e).spec.config,o=(r?t.undone:t.done).popEvent(e,i);if(!o)return;let a=o.selection.resolve(o.transform.doc),c=(r?t.done:t.undone).addTransform(o.transform,e.selection.getBookmark(),s,i),l=new Z(r?c:o.remaining,r?o.remaining:c,null,0);n(o.transform.setSelection(a).setMeta(lt,{redo:r,historyState:l}).scrollIntoView())}let ot=!1,at=null;function ct(t){let e=t.plugins;if(at!=e){ot=!1,at=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){ot=!0;break}}return ot}const lt=new w.H$("history"),ut=new w.H$("closeHistory");function ht(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new w.Sy({key:lt,state:{init(){return new Z(X.empty,X.empty,null,0)},apply(e,n,r){return et(n,r,e,t)}},config:t,props:{handleDOMEvents:{beforeinput(t,e){let n=e.inputType,r="historyUndo"==n?dt:"historyRedo"==n?ft:null;return!!r&&(e.preventDefault(),r(t.state,t.dispatch))}}}})}const dt=(t,e)=>{let n=lt.getState(t);return!(!n||0==n.done.eventCount)&&(e&&st(n,t,e,!1),!0)},ft=(t,e)=>{let n=lt.getState(t);return!(!n||0==n.undone.eventCount)&&(e&&st(n,t,e,!0),!0)};const pt=r.hj.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:t,dispatch:e})=>dt(t,e),redo:()=>({state:t,dispatch:e})=>ft(t,e)}},addProseMirrorPlugins(){return[ht(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),gt=r.NB.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:t}){return["hr",(0,r.P1)(this.options.HTMLAttributes,t)]},addCommands(){return{setHorizontalRule:()=>({chain:t})=>t().insertContent({type:this.name}).command((({tr:t,dispatch:e})=>{var n;if(e){const{$to:e}=t.selection,r=e.end();if(e.nodeAfter)t.setSelection(w.Bs.create(t.doc,e.pos));else{const i=null===(n=e.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();i&&(t.insert(r,i),t.setSelection(w.Bs.create(t.doc,r)))}t.scrollIntoView()}return!0})).run()}},addInputRules(){return[(0,r.x2)({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),mt=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,yt=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,wt=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,bt=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,vt=r.vc.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:t=>"normal"!==t.style.fontStyle&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:t}){return["em",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setItalic:()=>({commands:t})=>t.setMark(this.name),toggleItalic:()=>({commands:t})=>t.toggleMark(this.name),unsetItalic:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[(0,r.Cf)({find:mt,type:this.type}),(0,r.Cf)({find:wt,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:yt,type:this.type}),(0,r.K9)({find:bt,type:this.type})]}}),Et=r.NB.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",(0,r.P1)(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),_t=r.NB.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:t}){return["li",(0,r.P1)(this.options.HTMLAttributes,t),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),St=r.vc.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:t=>{const e=t.hasAttribute("style");return!!e&&{}}}]},renderHTML({HTMLAttributes:t}){return["span",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:t,commands:e})=>{const n=(0,r.Jo)(t,this.type),i=Object.entries(n).some((([,t])=>!!t));return!!i||e.unsetMark(this.name)}}}}),At=/^(\d+)\.\s$/,Ct=r.NB.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:t=>t.hasAttribute("start")?parseInt(t.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:t}){const{start:e,...n}=t;return 1===e?["ol",(0,r.P1)(this.options.HTMLAttributes,n),0]:["ol",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{toggleOrderedList:()=>({commands:t,chain:e})=>this.options.keepAttributes?e().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(_t.name,this.editor.getAttributes(St.name)).run():t.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let t=(0,r.S0)({find:At,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(t=(0,r.S0)({find:At,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(St.name),editor:this.editor})),[t]}}),It=r.NB.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:t}){return["p",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setParagraph:()=>({commands:t})=>t.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Tt=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,kt=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,Rt=r.vc.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:t=>!!t.includes("line-through")&&{}}]},renderHTML({HTMLAttributes:t}){return["s",(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setStrike:()=>({commands:t})=>t.setMark(this.name),toggleStrike:()=>({commands:t})=>t.toggleMark(this.name),unsetStrike:()=>({commands:t})=>t.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[(0,r.Cf)({find:Tt,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:kt,type:this.type})]}}),Nt=r.NB.create({name:"text",group:"inline"}),Dt=r.hj.create({name:"starterKit",addExtensions(){var t,e,n,r,i,o,a,c,l,h,d,f,g,m,w,b,v,S;const A=[];return!1!==this.options.blockquote&&A.push(s.configure(null===(t=this.options)||void 0===t?void 0:t.blockquote)),!1!==this.options.bold&&A.push(u.configure(null===(e=this.options)||void 0===e?void 0:e.bold)),!1!==this.options.bulletList&&A.push(p.configure(null===(n=this.options)||void 0===n?void 0:n.bulletList)),!1!==this.options.code&&A.push(y.configure(null===(r=this.options)||void 0===r?void 0:r.code)),!1!==this.options.codeBlock&&A.push(E.configure(null===(i=this.options)||void 0===i?void 0:i.codeBlock)),!1!==this.options.document&&A.push(_.configure(null===(o=this.options)||void 0===o?void 0:o.document)),!1!==this.options.dropcursor&&A.push(I.configure(null===(a=this.options)||void 0===a?void 0:a.dropcursor)),!1!==this.options.gapcursor&&A.push(z.configure(null===(c=this.options)||void 0===c?void 0:c.gapcursor)),!1!==this.options.hardBreak&&A.push(V.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&A.push(j.configure(null===(h=this.options)||void 0===h?void 0:h.heading)),!1!==this.options.history&&A.push(pt.configure(null===(d=this.options)||void 0===d?void 0:d.history)),!1!==this.options.horizontalRule&&A.push(gt.configure(null===(f=this.options)||void 0===f?void 0:f.horizontalRule)),!1!==this.options.italic&&A.push(vt.configure(null===(g=this.options)||void 0===g?void 0:g.italic)),!1!==this.options.listItem&&A.push(Et.configure(null===(m=this.options)||void 0===m?void 0:m.listItem)),!1!==this.options.orderedList&&A.push(Ct.configure(null===(w=this.options)||void 0===w?void 0:w.orderedList)),!1!==this.options.paragraph&&A.push(It.configure(null===(b=this.options)||void 0===b?void 0:b.paragraph)),!1!==this.options.strike&&A.push(Rt.configure(null===(v=this.options)||void 0===v?void 0:v.strike)),!1!==this.options.text&&A.push(Nt.configure(null===(S=this.options)||void 0===S?void 0:S.text)),A}})},7200:function(t,e,n){"use strict";n.d(e,{ML:function(){return Mr},kg:function(){return Lr}});n(7658);var r=n(2066),i=n(157);function s(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function o(t){var e=s(t).Element;return t instanceof e||t instanceof Element}function a(t){var e=s(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function c(t){if("undefined"===typeof ShadowRoot)return!1;var e=s(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}var l=Math.max,u=Math.min,h=Math.round;function d(){var t=navigator.userAgentData;return null!=t&&t.brands?t.brands.map((function(t){return t.brand+"/"+t.version})).join(" "):navigator.userAgent}function f(){return!/^((?!chrome|android).)*safari/i.test(d())}function p(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var r=t.getBoundingClientRect(),i=1,c=1;e&&a(t)&&(i=t.offsetWidth>0&&h(r.width)/t.offsetWidth||1,c=t.offsetHeight>0&&h(r.height)/t.offsetHeight||1);var l=o(t)?s(t):window,u=l.visualViewport,d=!f()&&n,p=(r.left+(d&&u?u.offsetLeft:0))/i,g=(r.top+(d&&u?u.offsetTop:0))/c,m=r.width/i,y=r.height/c;return{width:m,height:y,top:g,right:p+m,bottom:g+y,left:p,x:p,y:g}}function g(t){var e=s(t),n=e.pageXOffset,r=e.pageYOffset;return{scrollLeft:n,scrollTop:r}}function m(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function y(t){return t!==s(t)&&a(t)?m(t):g(t)}function w(t){return t?(t.nodeName||"").toLowerCase():null}function b(t){return((o(t)?t.ownerDocument:t.document)||window.document).documentElement}function v(t){return p(b(t)).left+g(t).scrollLeft}function E(t){return s(t).getComputedStyle(t)}function _(t){var e=E(t),n=e.overflow,r=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function S(t){var e=t.getBoundingClientRect(),n=h(e.width)/t.offsetWidth||1,r=h(e.height)/t.offsetHeight||1;return 1!==n||1!==r}function A(t,e,n){void 0===n&&(n=!1);var r=a(e),i=a(e)&&S(e),s=b(e),o=p(t,i,n),c={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!n)&&(("body"!==w(e)||_(s))&&(c=y(e)),a(e)?(l=p(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=v(s))),{x:o.left+c.scrollLeft-l.x,y:o.top+c.scrollTop-l.y,width:o.width,height:o.height}}function C(t){var e=p(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function I(t){return"html"===w(t)?t:t.assignedSlot||t.parentNode||(c(t)?t.host:null)||b(t)}function T(t){return["html","body","#document"].indexOf(w(t))>=0?t.ownerDocument.body:a(t)&&_(t)?t:T(I(t))}function k(t,e){var n;void 0===e&&(e=[]);var r=T(t),i=r===(null==(n=t.ownerDocument)?void 0:n.body),o=s(r),a=i?[o].concat(o.visualViewport||[],_(r)?r:[]):r,c=e.concat(a);return i?c:c.concat(k(I(a)))}function R(t){return["table","td","th"].indexOf(w(t))>=0}function N(t){return a(t)&&"fixed"!==E(t).position?t.offsetParent:null}function D(t){var e=/firefox/i.test(d()),n=/Trident/i.test(d());if(n&&a(t)){var r=E(t);if("fixed"===r.position)return null}var i=I(t);c(i)&&(i=i.host);while(a(i)&&["html","body"].indexOf(w(i))<0){var s=E(i);if("none"!==s.transform||"none"!==s.perspective||"paint"===s.contain||-1!==["transform","perspective"].indexOf(s.willChange)||e&&"filter"===s.willChange||e&&s.filter&&"none"!==s.filter)return i;i=i.parentNode}return null}function O(t){var e=s(t),n=N(t);while(n&&R(n)&&"static"===E(n).position)n=N(n);return n&&("html"===w(n)||"body"===w(n)&&"static"===E(n).position)?e:n||D(t)||e}var P="top",x="bottom",M="right",L="left",B="auto",U=[P,x,M,L],F="start",z="end",V="clippingParents",j="viewport",H="popper",$="reference",K=U.reduce((function(t,e){return t.concat([e+"-"+F,e+"-"+z])}),[]),G=[].concat(U,[B]).reduce((function(t,e){return t.concat([e,e+"-"+F,e+"-"+z])}),[]),q="beforeRead",W="read",Y="afterRead",X="beforeMain",Q="main",J="afterMain",Z="beforeWrite",tt="write",et="afterWrite",nt=[q,W,Y,X,Q,J,Z,tt,et];function rt(t){var e=new Map,n=new Set,r=[];function i(t){n.add(t.name);var s=[].concat(t.requires||[],t.requiresIfExists||[]);s.forEach((function(t){if(!n.has(t)){var r=e.get(t);r&&i(r)}})),r.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||i(t)})),r}function it(t){var e=rt(t);return nt.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}function st(t){var e;return function(){return e||(e=new Promise((function(n){Promise.resolve().then((function(){e=void 0,n(t())}))}))),e}}function ot(t){var e=t.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}var at={placement:"bottom",modifiers:[],strategy:"absolute"};function ct(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some((function(t){return!(t&&"function"===typeof t.getBoundingClientRect)}))}function lt(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,r=void 0===n?[]:n,i=e.defaultOptions,s=void 0===i?at:i;return function(t,e,n){void 0===n&&(n=s);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},at,s),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},a=[],c=!1,l={state:i,setOptions:function(n){var a="function"===typeof n?n(i.options):n;h(),i.options=Object.assign({},s,i.options,a),i.scrollParents={reference:o(t)?k(t):t.contextElement?k(t.contextElement):[],popper:k(e)};var c=it(ot([].concat(r,i.options.modifiers)));return i.orderedModifiers=c.filter((function(t){return t.enabled})),u(),l.update()},forceUpdate:function(){if(!c){var t=i.elements,e=t.reference,n=t.popper;if(ct(e,n)){i.rects={reference:A(e,O(n),"fixed"===i.options.strategy),popper:C(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(t){return i.modifiersData[t.name]=Object.assign({},t.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var s=i.orderedModifiers[r],o=s.fn,a=s.options,u=void 0===a?{}:a,h=s.name;"function"===typeof o&&(i=o({state:i,options:u,name:h,instance:l})||i)}else i.reset=!1,r=-1}}},update:st((function(){return new Promise((function(t){l.forceUpdate(),t(i)}))})),destroy:function(){h(),c=!0}};if(!ct(t,e))return l;function u(){i.orderedModifiers.forEach((function(t){var e=t.name,n=t.options,r=void 0===n?{}:n,s=t.effect;if("function"===typeof s){var o=s({state:i,name:e,instance:l,options:r}),c=function(){};a.push(o||c)}}))}function h(){a.forEach((function(t){return t()})),a=[]}return l.setOptions(n).then((function(t){!c&&n.onFirstUpdate&&n.onFirstUpdate(t)})),l}}var ut={passive:!0};function ht(t){var e=t.state,n=t.instance,r=t.options,i=r.scroll,o=void 0===i||i,a=r.resize,c=void 0===a||a,l=s(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&u.forEach((function(t){t.addEventListener("scroll",n.update,ut)})),c&&l.addEventListener("resize",n.update,ut),function(){o&&u.forEach((function(t){t.removeEventListener("scroll",n.update,ut)})),c&&l.removeEventListener("resize",n.update,ut)}}var dt={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:ht,data:{}};function ft(t){return t.split("-")[0]}function pt(t){return t.split("-")[1]}function gt(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function mt(t){var e,n=t.reference,r=t.element,i=t.placement,s=i?ft(i):null,o=i?pt(i):null,a=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(s){case P:e={x:a,y:n.y-r.height};break;case x:e={x:a,y:n.y+n.height};break;case M:e={x:n.x+n.width,y:c};break;case L:e={x:n.x-r.width,y:c};break;default:e={x:n.x,y:n.y}}var l=s?gt(s):null;if(null!=l){var u="y"===l?"height":"width";switch(o){case F:e[l]=e[l]-(n[u]/2-r[u]/2);break;case z:e[l]=e[l]+(n[u]/2-r[u]/2);break;default:}}return e}function yt(t){var e=t.state,n=t.name;e.modifiersData[n]=mt({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var wt={name:"popperOffsets",enabled:!0,phase:"read",fn:yt,data:{}},bt={top:"auto",right:"auto",bottom:"auto",left:"auto"};function vt(t){var e=t.x,n=t.y,r=window,i=r.devicePixelRatio||1;return{x:h(e*i)/i||0,y:h(n*i)/i||0}}function Et(t){var e,n=t.popper,r=t.popperRect,i=t.placement,o=t.variation,a=t.offsets,c=t.position,l=t.gpuAcceleration,u=t.adaptive,h=t.roundOffsets,d=t.isFixed,f=a.x,p=void 0===f?0:f,g=a.y,m=void 0===g?0:g,y="function"===typeof h?h({x:p,y:m}):{x:p,y:m};p=y.x,m=y.y;var w=a.hasOwnProperty("x"),v=a.hasOwnProperty("y"),_=L,S=P,A=window;if(u){var C=O(n),I="clientHeight",T="clientWidth";if(C===s(n)&&(C=b(n),"static"!==E(C).position&&"absolute"===c&&(I="scrollHeight",T="scrollWidth")),i===P||(i===L||i===M)&&o===z){S=x;var k=d&&C===A&&A.visualViewport?A.visualViewport.height:C[I];m-=k-r.height,m*=l?1:-1}if(i===L||(i===P||i===x)&&o===z){_=M;var R=d&&C===A&&A.visualViewport?A.visualViewport.width:C[T];p-=R-r.width,p*=l?1:-1}}var N,D=Object.assign({position:c},u&&bt),B=!0===h?vt({x:p,y:m}):{x:p,y:m};return p=B.x,m=B.y,l?Object.assign({},D,(N={},N[S]=v?"0":"",N[_]=w?"0":"",N.transform=(A.devicePixelRatio||1)<=1?"translate("+p+"px, "+m+"px)":"translate3d("+p+"px, "+m+"px, 0)",N)):Object.assign({},D,(e={},e[S]=v?m+"px":"",e[_]=w?p+"px":"",e.transform="",e))}function _t(t){var e=t.state,n=t.options,r=n.gpuAcceleration,i=void 0===r||r,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,c=void 0===a||a,l={placement:ft(e.placement),variation:pt(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,Et(Object.assign({},l,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:c})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,Et(Object.assign({},l,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var St={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:_t,data:{}};function At(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},i=e.elements[t];a(i)&&w(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(t){var e=r[t];!1===e?i.removeAttribute(t):i.setAttribute(t,!0===e?"":e)})))}))}function Ct(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var r=e.elements[t],i=e.attributes[t]||{},s=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]),o=s.reduce((function(t,e){return t[e]="",t}),{});a(r)&&w(r)&&(Object.assign(r.style,o),Object.keys(i).forEach((function(t){r.removeAttribute(t)})))}))}}var It={name:"applyStyles",enabled:!0,phase:"write",fn:At,effect:Ct,requires:["computeStyles"]};function Tt(t,e,n){var r=ft(t),i=[L,P].indexOf(r)>=0?-1:1,s="function"===typeof n?n(Object.assign({},e,{placement:t})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[L,M].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function kt(t){var e=t.state,n=t.options,r=t.name,i=n.offset,s=void 0===i?[0,0]:i,o=G.reduce((function(t,n){return t[n]=Tt(n,e.rects,s),t}),{}),a=o[e.placement],c=a.x,l=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=c,e.modifiersData.popperOffsets.y+=l),e.modifiersData[r]=o}var Rt={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:kt},Nt={left:"right",right:"left",bottom:"top",top:"bottom"};function Dt(t){return t.replace(/left|right|bottom|top/g,(function(t){return Nt[t]}))}var Ot={start:"end",end:"start"};function Pt(t){return t.replace(/start|end/g,(function(t){return Ot[t]}))}function xt(t,e){var n=s(t),r=b(t),i=n.visualViewport,o=r.clientWidth,a=r.clientHeight,c=0,l=0;if(i){o=i.width,a=i.height;var u=f();(u||!u&&"fixed"===e)&&(c=i.offsetLeft,l=i.offsetTop)}return{width:o,height:a,x:c+v(t),y:l}}function Mt(t){var e,n=b(t),r=g(t),i=null==(e=t.ownerDocument)?void 0:e.body,s=l(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=l(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+v(t),c=-r.scrollTop;return"rtl"===E(i||n).direction&&(a+=l(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:c}}function Lt(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&c(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Bt(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Ut(t,e){var n=p(t,!1,"fixed"===e);return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function Ft(t,e,n){return e===j?Bt(xt(t,n)):o(e)?Ut(e,n):Bt(Mt(b(t)))}function zt(t){var e=k(I(t)),n=["absolute","fixed"].indexOf(E(t).position)>=0,r=n&&a(t)?O(t):t;return o(r)?e.filter((function(t){return o(t)&&Lt(t,r)&&"body"!==w(t)})):[]}function Vt(t,e,n,r){var i="clippingParents"===e?zt(t):[].concat(e),s=[].concat(i,[n]),o=s[0],a=s.reduce((function(e,n){var i=Ft(t,n,r);return e.top=l(i.top,e.top),e.right=u(i.right,e.right),e.bottom=u(i.bottom,e.bottom),e.left=l(i.left,e.left),e}),Ft(t,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function jt(){return{top:0,right:0,bottom:0,left:0}}function Ht(t){return Object.assign({},jt(),t)}function $t(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}function Kt(t,e){void 0===e&&(e={});var n=e,r=n.placement,i=void 0===r?t.placement:r,s=n.strategy,a=void 0===s?t.strategy:s,c=n.boundary,l=void 0===c?V:c,u=n.rootBoundary,h=void 0===u?j:u,d=n.elementContext,f=void 0===d?H:d,g=n.altBoundary,m=void 0!==g&&g,y=n.padding,w=void 0===y?0:y,v=Ht("number"!==typeof w?w:$t(w,U)),E=f===H?$:H,_=t.rects.popper,S=t.elements[m?E:f],A=Vt(o(S)?S:S.contextElement||b(t.elements.popper),l,h,a),C=p(t.elements.reference),I=mt({reference:C,element:_,strategy:"absolute",placement:i}),T=Bt(Object.assign({},_,I)),k=f===H?T:C,R={top:A.top-k.top+v.top,bottom:k.bottom-A.bottom+v.bottom,left:A.left-k.left+v.left,right:k.right-A.right+v.right},N=t.modifiersData.offset;if(f===H&&N){var D=N[i];Object.keys(R).forEach((function(t){var e=[M,x].indexOf(t)>=0?1:-1,n=[P,x].indexOf(t)>=0?"y":"x";R[t]+=D[n]*e}))}return R}function Gt(t,e){void 0===e&&(e={});var n=e,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?G:c,u=pt(r),h=u?a?K:K.filter((function(t){return pt(t)===u})):U,d=h.filter((function(t){return l.indexOf(t)>=0}));0===d.length&&(d=h);var f=d.reduce((function(e,n){return e[n]=Kt(t,{placement:n,boundary:i,rootBoundary:s,padding:o})[ft(n)],e}),{});return Object.keys(f).sort((function(t,e){return f[t]-f[e]}))}function qt(t){if(ft(t)===B)return[];var e=Dt(t);return[Pt(t),e,Pt(e)]}function Wt(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0===o||o,c=n.fallbackPlacements,l=n.padding,u=n.boundary,h=n.rootBoundary,d=n.altBoundary,f=n.flipVariations,p=void 0===f||f,g=n.allowedAutoPlacements,m=e.options.placement,y=ft(m),w=y===m,b=c||(w||!p?[Dt(m)]:qt(m)),v=[m].concat(b).reduce((function(t,n){return t.concat(ft(n)===B?Gt(e,{placement:n,boundary:u,rootBoundary:h,padding:l,flipVariations:p,allowedAutoPlacements:g}):n)}),[]),E=e.rects.reference,_=e.rects.popper,S=new Map,A=!0,C=v[0],I=0;I<v.length;I++){var T=v[I],k=ft(T),R=pt(T)===F,N=[P,x].indexOf(k)>=0,D=N?"width":"height",O=Kt(e,{placement:T,boundary:u,rootBoundary:h,altBoundary:d,padding:l}),U=N?R?M:L:R?x:P;E[D]>_[D]&&(U=Dt(U));var z=Dt(U),V=[];if(s&&V.push(O[k]<=0),a&&V.push(O[U]<=0,O[z]<=0),V.every((function(t){return t}))){C=T,A=!1;break}S.set(T,V)}if(A)for(var j=p?3:1,H=function(t){var e=v.find((function(e){var n=S.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return C=e,"break"},$=j;$>0;$--){var K=H($);if("break"===K)break}e.placement!==C&&(e.modifiersData[r]._skip=!0,e.placement=C,e.reset=!0)}}var Yt={name:"flip",enabled:!0,phase:"main",fn:Wt,requiresIfExists:["offset"],data:{_skip:!1}};function Xt(t){return"x"===t?"y":"x"}function Qt(t,e,n){return l(t,u(e,n))}function Jt(t,e,n){var r=Qt(t,e,n);return r>n?n:r}function Zt(t){var e=t.state,n=t.options,r=t.name,i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0!==o&&o,c=n.boundary,h=n.rootBoundary,d=n.altBoundary,f=n.padding,p=n.tether,g=void 0===p||p,m=n.tetherOffset,y=void 0===m?0:m,w=Kt(e,{boundary:c,rootBoundary:h,padding:f,altBoundary:d}),b=ft(e.placement),v=pt(e.placement),E=!v,_=gt(b),S=Xt(_),A=e.modifiersData.popperOffsets,I=e.rects.reference,T=e.rects.popper,k="function"===typeof y?y(Object.assign({},e.rects,{placement:e.placement})):y,R="number"===typeof k?{mainAxis:k,altAxis:k}:Object.assign({mainAxis:0,altAxis:0},k),N=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,D={x:0,y:0};if(A){if(s){var B,U="y"===_?P:L,z="y"===_?x:M,V="y"===_?"height":"width",j=A[_],H=j+w[U],$=j-w[z],K=g?-T[V]/2:0,G=v===F?I[V]:T[V],q=v===F?-T[V]:-I[V],W=e.elements.arrow,Y=g&&W?C(W):{width:0,height:0},X=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:jt(),Q=X[U],J=X[z],Z=Qt(0,I[V],Y[V]),tt=E?I[V]/2-K-Z-Q-R.mainAxis:G-Z-Q-R.mainAxis,et=E?-I[V]/2+K+Z+J+R.mainAxis:q+Z+J+R.mainAxis,nt=e.elements.arrow&&O(e.elements.arrow),rt=nt?"y"===_?nt.clientTop||0:nt.clientLeft||0:0,it=null!=(B=null==N?void 0:N[_])?B:0,st=j+tt-it-rt,ot=j+et-it,at=Qt(g?u(H,st):H,j,g?l($,ot):$);A[_]=at,D[_]=at-j}if(a){var ct,lt="x"===_?P:L,ut="x"===_?x:M,ht=A[S],dt="y"===S?"height":"width",mt=ht+w[lt],yt=ht-w[ut],wt=-1!==[P,L].indexOf(b),bt=null!=(ct=null==N?void 0:N[S])?ct:0,vt=wt?mt:ht-I[dt]-T[dt]-bt+R.altAxis,Et=wt?ht+I[dt]+T[dt]-bt-R.altAxis:yt,_t=g&&wt?Jt(vt,ht,Et):Qt(g?vt:mt,ht,g?Et:yt);A[S]=_t,D[S]=_t-ht}e.modifiersData[r]=D}}var te={name:"preventOverflow",enabled:!0,phase:"main",fn:Zt,requiresIfExists:["offset"]},ee=function(t,e){return t="function"===typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t,Ht("number"!==typeof t?t:$t(t,U))};function ne(t){var e,n=t.state,r=t.name,i=t.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=ft(n.placement),c=gt(a),l=[L,M].indexOf(a)>=0,u=l?"height":"width";if(s&&o){var h=ee(i.padding,n),d=C(s),f="y"===c?P:L,p="y"===c?x:M,g=n.rects.reference[u]+n.rects.reference[c]-o[c]-n.rects.popper[u],m=o[c]-n.rects.reference[c],y=O(s),w=y?"y"===c?y.clientHeight||0:y.clientWidth||0:0,b=g/2-m/2,v=h[f],E=w-d[u]-h[p],_=w/2-d[u]/2+b,S=Qt(v,_,E),A=c;n.modifiersData[r]=(e={},e[A]=S,e.centerOffset=S-_,e)}}function re(t){var e=t.state,n=t.options,r=n.element,i=void 0===r?"[data-popper-arrow]":r;null!=i&&("string"!==typeof i||(i=e.elements.popper.querySelector(i),i))&&Lt(e.elements.popper,i)&&(e.elements.arrow=i)}var ie={name:"arrow",enabled:!0,phase:"main",fn:ne,effect:re,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function se(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function oe(t){return[P,M,x,L].some((function(e){return t[e]>=0}))}function ae(t){var e=t.state,n=t.name,r=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,o=Kt(e,{elementContext:"reference"}),a=Kt(e,{altBoundary:!0}),c=se(o,r),l=se(a,i,s),u=oe(c),h=oe(l);e.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}var ce={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:ae},le=[dt,wt,St,It,Rt,Yt,te,ie,ce],ue=lt({defaultModifiers:le}),he="tippy-box",de="tippy-content",fe="tippy-backdrop",pe="tippy-arrow",ge="tippy-svg-arrow",me={passive:!0,capture:!0},ye=function(){return document.body};function we(t,e,n){if(Array.isArray(t)){var r=t[e];return null==r?Array.isArray(n)?n[e]:n:r}return t}function be(t,e){var n={}.toString.call(t);return 0===n.indexOf("[object")&&n.indexOf(e+"]")>-1}function ve(t,e){return"function"===typeof t?t.apply(void 0,e):t}function Ee(t,e){return 0===e?t:function(r){clearTimeout(n),n=setTimeout((function(){t(r)}),e)};var n}function _e(t){return t.split(/\s+/).filter(Boolean)}function Se(t){return[].concat(t)}function Ae(t,e){-1===t.indexOf(e)&&t.push(e)}function Ce(t){return t.filter((function(e,n){return t.indexOf(e)===n}))}function Ie(t){return t.split("-")[0]}function Te(t){return[].slice.call(t)}function ke(t){return Object.keys(t).reduce((function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e}),{})}function Re(){return document.createElement("div")}function Ne(t){return["Element","Fragment"].some((function(e){return be(t,e)}))}function De(t){return be(t,"NodeList")}function Oe(t){return be(t,"MouseEvent")}function Pe(t){return!(!t||!t._tippy||t._tippy.reference!==t)}function xe(t){return Ne(t)?[t]:De(t)?Te(t):Array.isArray(t)?t:Te(document.querySelectorAll(t))}function Me(t,e){t.forEach((function(t){t&&(t.style.transitionDuration=e+"ms")}))}function Le(t,e){t.forEach((function(t){t&&t.setAttribute("data-state",e)}))}function Be(t){var e,n=Se(t),r=n[0];return null!=r&&null!=(e=r.ownerDocument)&&e.body?r.ownerDocument:document}function Ue(t,e){var n=e.clientX,r=e.clientY;return t.every((function(t){var e=t.popperRect,i=t.popperState,s=t.props,o=s.interactiveBorder,a=Ie(i.placement),c=i.modifiersData.offset;if(!c)return!0;var l="bottom"===a?c.top.y:0,u="top"===a?c.bottom.y:0,h="right"===a?c.left.x:0,d="left"===a?c.right.x:0,f=e.top-r+l>o,p=r-e.bottom-u>o,g=e.left-n+h>o,m=n-e.right-d>o;return f||p||g||m}))}function Fe(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(e){t[r](e,n)}))}function ze(t,e){var n=e;while(n){var r;if(t.contains(n))return!0;n=null==n.getRootNode||null==(r=n.getRootNode())?void 0:r.host}return!1}var Ve={isTouch:!1},je=0;function He(){Ve.isTouch||(Ve.isTouch=!0,window.performance&&document.addEventListener("mousemove",$e))}function $e(){var t=performance.now();t-je<20&&(Ve.isTouch=!1,document.removeEventListener("mousemove",$e)),je=t}function Ke(){var t=document.activeElement;if(Pe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function Ge(){document.addEventListener("touchstart",He,me),window.addEventListener("blur",Ke)}var qe="undefined"!==typeof window&&"undefined"!==typeof document,We=!!qe&&!!window.msCrypto;var Ye={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Xe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Qe=Object.assign({appendTo:ye,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Ye,Xe),Je=Object.keys(Qe),Ze=function(t){var e=Object.keys(t);e.forEach((function(e){Qe[e]=t[e]}))};function tn(t){var e=t.plugins||[],n=e.reduce((function(e,n){var r,i=n.name,s=n.defaultValue;i&&(e[i]=void 0!==t[i]?t[i]:null!=(r=Qe[i])?r:s);return e}),{});return Object.assign({},t,n)}function en(t,e){var n=e?Object.keys(tn(Object.assign({},Qe,{plugins:e}))):Je,r=n.reduce((function(e,n){var r=(t.getAttribute("data-tippy-"+n)||"").trim();if(!r)return e;if("content"===n)e[n]=r;else try{e[n]=JSON.parse(r)}catch(i){e[n]=r}return e}),{});return r}function nn(t,e){var n=Object.assign({},e,{content:ve(e.content,[t])},e.ignoreAttributes?{}:en(t,e.plugins));return n.aria=Object.assign({},Qe.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?e.interactive:n.aria.expanded,content:"auto"===n.aria.content?e.interactive?null:"describedby":n.aria.content},n}var rn=function(){return"innerHTML"};function sn(t,e){t[rn()]=e}function on(t){var e=Re();return!0===t?e.className=pe:(e.className=ge,Ne(t)?e.appendChild(t):sn(e,t)),e}function an(t,e){Ne(e.content)?(sn(t,""),t.appendChild(e.content)):"function"!==typeof e.content&&(e.allowHTML?sn(t,e.content):t.textContent=e.content)}function cn(t){var e=t.firstElementChild,n=Te(e.children);return{box:e,content:n.find((function(t){return t.classList.contains(de)})),arrow:n.find((function(t){return t.classList.contains(pe)||t.classList.contains(ge)})),backdrop:n.find((function(t){return t.classList.contains(fe)}))}}function ln(t){var e=Re(),n=Re();n.className=he,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Re();function i(n,r){var i=cn(e),s=i.box,o=i.content,a=i.arrow;r.theme?s.setAttribute("data-theme",r.theme):s.removeAttribute("data-theme"),"string"===typeof r.animation?s.setAttribute("data-animation",r.animation):s.removeAttribute("data-animation"),r.inertia?s.setAttribute("data-inertia",""):s.removeAttribute("data-inertia"),s.style.maxWidth="number"===typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?s.setAttribute("role",r.role):s.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||an(o,t.props),r.arrow?a?n.arrow!==r.arrow&&(s.removeChild(a),s.appendChild(on(r.arrow))):s.appendChild(on(r.arrow)):a&&s.removeChild(a)}return r.className=de,r.setAttribute("data-state","hidden"),an(r,t.props),e.appendChild(n),n.appendChild(r),i(t.props,t.props),{popper:e,onUpdate:i}}ln.$$tippy=!0;var un=1,hn=[],dn=[];function fn(t,e){var n,r,i,s,o,a,c,l=nn(t,Object.assign({},Qe,tn(ke(e)))),u=!1,h=!1,d=!1,f=!1,p=[],g=Ee(X,l.interactiveDebounce),m=un++,y=null,w=Ce(l.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},v={id:m,reference:t,popper:Re(),popperInstance:y,props:l,state:b,plugins:w,clearDelayTimeouts:ct,setProps:lt,setContent:ut,show:ht,hide:dt,hideWithInteractivity:ft,enable:ot,disable:at,unmount:pt,destroy:gt};if(!l.render)return v;var E=l.render(v),_=E.popper,S=E.onUpdate;_.setAttribute("data-tippy-root",""),_.id="tippy-"+v.id,v.popper=_,t._tippy=v,_._tippy=v;var A=w.map((function(t){return t.fn(v)})),C=t.hasAttribute("aria-expanded");return q(),L(),P(),x("onCreate",[v]),l.showOnCreate&&it(),_.addEventListener("mouseenter",(function(){v.props.interactive&&v.state.isVisible&&v.clearDelayTimeouts()})),_.addEventListener("mouseleave",(function(){v.props.interactive&&v.props.trigger.indexOf("mouseenter")>=0&&N().addEventListener("mousemove",g)})),v;function I(){var t=v.props.touch;return Array.isArray(t)?t:[t,0]}function T(){return"hold"===I()[0]}function k(){var t;return!(null==(t=v.props.render)||!t.$$tippy)}function R(){return c||t}function N(){var t=R().parentNode;return t?Be(t):document}function D(){return cn(_)}function O(t){return v.state.isMounted&&!v.state.isVisible||Ve.isTouch||s&&"focus"===s.type?0:we(v.props.delay,t?0:1,Qe.delay)}function P(t){void 0===t&&(t=!1),_.style.pointerEvents=v.props.interactive&&!t?"":"none",_.style.zIndex=""+v.props.zIndex}function x(t,e,n){var r;(void 0===n&&(n=!0),A.forEach((function(n){n[t]&&n[t].apply(n,e)})),n)&&(r=v.props)[t].apply(r,e)}function M(){var e=v.props.aria;if(e.content){var n="aria-"+e.content,r=_.id,i=Se(v.props.triggerTarget||t);i.forEach((function(t){var e=t.getAttribute(n);if(v.state.isVisible)t.setAttribute(n,e?e+" "+r:r);else{var i=e&&e.replace(r,"").trim();i?t.setAttribute(n,i):t.removeAttribute(n)}}))}}function L(){if(!C&&v.props.aria.expanded){var e=Se(v.props.triggerTarget||t);e.forEach((function(t){v.props.interactive?t.setAttribute("aria-expanded",v.state.isVisible&&t===R()?"true":"false"):t.removeAttribute("aria-expanded")}))}}function B(){N().removeEventListener("mousemove",g),hn=hn.filter((function(t){return t!==g}))}function U(e){if(!Ve.isTouch||!d&&"mousedown"!==e.type){var n=e.composedPath&&e.composedPath()[0]||e.target;if(!v.props.interactive||!ze(_,n)){if(Se(v.props.triggerTarget||t).some((function(t){return ze(t,n)}))){if(Ve.isTouch)return;if(v.state.isVisible&&v.props.trigger.indexOf("click")>=0)return}else x("onClickOutside",[v,e]);!0===v.props.hideOnClick&&(v.clearDelayTimeouts(),v.hide(),h=!0,setTimeout((function(){h=!1})),v.state.isMounted||j())}}}function F(){d=!0}function z(){d=!1}function V(){var t=N();t.addEventListener("mousedown",U,!0),t.addEventListener("touchend",U,me),t.addEventListener("touchstart",z,me),t.addEventListener("touchmove",F,me)}function j(){var t=N();t.removeEventListener("mousedown",U,!0),t.removeEventListener("touchend",U,me),t.removeEventListener("touchstart",z,me),t.removeEventListener("touchmove",F,me)}function H(t,e){K(t,(function(){!v.state.isVisible&&_.parentNode&&_.parentNode.contains(_)&&e()}))}function $(t,e){K(t,e)}function K(t,e){var n=D().box;function r(t){t.target===n&&(Fe(n,"remove",r),e())}if(0===t)return e();Fe(n,"remove",o),Fe(n,"add",r),o=r}function G(e,n,r){void 0===r&&(r=!1);var i=Se(v.props.triggerTarget||t);i.forEach((function(t){t.addEventListener(e,n,r),p.push({node:t,eventType:e,handler:n,options:r})}))}function q(){T()&&(G("touchstart",Y,{passive:!0}),G("touchend",Q,{passive:!0})),_e(v.props.trigger).forEach((function(t){if("manual"!==t)switch(G(t,Y),t){case"mouseenter":G("mouseleave",Q);break;case"focus":G(We?"focusout":"blur",J);break;case"focusin":G("focusout",J);break}}))}function W(){p.forEach((function(t){var e=t.node,n=t.eventType,r=t.handler,i=t.options;e.removeEventListener(n,r,i)})),p=[]}function Y(t){var e,n=!1;if(v.state.isEnabled&&!Z(t)&&!h){var r="focus"===(null==(e=s)?void 0:e.type);s=t,c=t.currentTarget,L(),!v.state.isVisible&&Oe(t)&&hn.forEach((function(e){return e(t)})),"click"===t.type&&(v.props.trigger.indexOf("mouseenter")<0||u)&&!1!==v.props.hideOnClick&&v.state.isVisible?n=!0:it(t),"click"===t.type&&(u=!n),n&&!r&&st(t)}}function X(t){var e=t.target,n=R().contains(e)||_.contains(e);if("mousemove"!==t.type||!n){var r=rt().concat(_).map((function(t){var e,n=t._tippy,r=null==(e=n.popperInstance)?void 0:e.state;return r?{popperRect:t.getBoundingClientRect(),popperState:r,props:l}:null})).filter(Boolean);Ue(r,t)&&(B(),st(t))}}function Q(t){var e=Z(t)||v.props.trigger.indexOf("click")>=0&&u;e||(v.props.interactive?v.hideWithInteractivity(t):st(t))}function J(t){v.props.trigger.indexOf("focusin")<0&&t.target!==R()||v.props.interactive&&t.relatedTarget&&_.contains(t.relatedTarget)||st(t)}function Z(t){return!!Ve.isTouch&&T()!==t.type.indexOf("touch")>=0}function tt(){et();var e=v.props,n=e.popperOptions,r=e.placement,i=e.offset,s=e.getReferenceClientRect,o=e.moveTransition,c=k()?cn(_).arrow:null,l=s?{getBoundingClientRect:s,contextElement:s.contextElement||R()}:t,u={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(t){var e=t.state;if(k()){var n=D(),r=n.box;["placement","reference-hidden","escaped"].forEach((function(t){"placement"===t?r.setAttribute("data-placement",e.placement):e.attributes.popper["data-popper-"+t]?r.setAttribute("data-"+t,""):r.removeAttribute("data-"+t)})),e.attributes.popper={}}}},h=[{name:"offset",options:{offset:i}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},u];k()&&c&&h.push({name:"arrow",options:{element:c,padding:3}}),h.push.apply(h,(null==n?void 0:n.modifiers)||[]),v.popperInstance=ue(l,_,Object.assign({},n,{placement:r,onFirstUpdate:a,modifiers:h}))}function et(){v.popperInstance&&(v.popperInstance.destroy(),v.popperInstance=null)}function nt(){var t,e=v.props.appendTo,n=R();t=v.props.interactive&&e===ye||"parent"===e?n.parentNode:ve(e,[n]),t.contains(_)||t.appendChild(_),v.state.isMounted=!0,tt()}function rt(){return Te(_.querySelectorAll("[data-tippy-root]"))}function it(t){v.clearDelayTimeouts(),t&&x("onTrigger",[v,t]),V();var e=O(!0),r=I(),i=r[0],s=r[1];Ve.isTouch&&"hold"===i&&s&&(e=s),e?n=setTimeout((function(){v.show()}),e):v.show()}function st(t){if(v.clearDelayTimeouts(),x("onUntrigger",[v,t]),v.state.isVisible){if(!(v.props.trigger.indexOf("mouseenter")>=0&&v.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(t.type)>=0&&u)){var e=O(!1);e?r=setTimeout((function(){v.state.isVisible&&v.hide()}),e):i=requestAnimationFrame((function(){v.hide()}))}}else j()}function ot(){v.state.isEnabled=!0}function at(){v.hide(),v.state.isEnabled=!1}function ct(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(i)}function lt(e){if(!v.state.isDestroyed){x("onBeforeUpdate",[v,e]),W();var n=v.props,r=nn(t,Object.assign({},n,ke(e),{ignoreAttributes:!0}));v.props=r,q(),n.interactiveDebounce!==r.interactiveDebounce&&(B(),g=Ee(X,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?Se(n.triggerTarget).forEach((function(t){t.removeAttribute("aria-expanded")})):r.triggerTarget&&t.removeAttribute("aria-expanded"),L(),P(),S&&S(n,r),v.popperInstance&&(tt(),rt().forEach((function(t){requestAnimationFrame(t._tippy.popperInstance.forceUpdate)}))),x("onAfterUpdate",[v,e])}}function ut(t){v.setProps({content:t})}function ht(){var t=v.state.isVisible,e=v.state.isDestroyed,n=!v.state.isEnabled,r=Ve.isTouch&&!v.props.touch,i=we(v.props.duration,0,Qe.duration);if(!(t||e||n||r)&&!R().hasAttribute("disabled")&&(x("onShow",[v],!1),!1!==v.props.onShow(v))){if(v.state.isVisible=!0,k()&&(_.style.visibility="visible"),P(),V(),v.state.isMounted||(_.style.transition="none"),k()){var s=D(),o=s.box,c=s.content;Me([o,c],0)}a=function(){var t;if(v.state.isVisible&&!f){if(f=!0,_.offsetHeight,_.style.transition=v.props.moveTransition,k()&&v.props.animation){var e=D(),n=e.box,r=e.content;Me([n,r],i),Le([n,r],"visible")}M(),L(),Ae(dn,v),null==(t=v.popperInstance)||t.forceUpdate(),x("onMount",[v]),v.props.animation&&k()&&$(i,(function(){v.state.isShown=!0,x("onShown",[v])}))}},nt()}}function dt(){var t=!v.state.isVisible,e=v.state.isDestroyed,n=!v.state.isEnabled,r=we(v.props.duration,1,Qe.duration);if(!(t||e||n)&&(x("onHide",[v],!1),!1!==v.props.onHide(v))){if(v.state.isVisible=!1,v.state.isShown=!1,f=!1,u=!1,k()&&(_.style.visibility="hidden"),B(),j(),P(!0),k()){var i=D(),s=i.box,o=i.content;v.props.animation&&(Me([s,o],r),Le([s,o],"hidden"))}M(),L(),v.props.animation?k()&&H(r,v.unmount):v.unmount()}}function ft(t){N().addEventListener("mousemove",g),Ae(hn,g),g(t)}function pt(){v.state.isVisible&&v.hide(),v.state.isMounted&&(et(),rt().forEach((function(t){t._tippy.unmount()})),_.parentNode&&_.parentNode.removeChild(_),dn=dn.filter((function(t){return t!==v})),v.state.isMounted=!1,x("onHidden",[v]))}function gt(){v.state.isDestroyed||(v.clearDelayTimeouts(),v.unmount(),W(),delete t._tippy,v.state.isDestroyed=!0,x("onDestroy",[v]))}}function pn(t,e){void 0===e&&(e={});var n=Qe.plugins.concat(e.plugins||[]);Ge();var r=Object.assign({},e,{plugins:n}),i=xe(t),s=i.reduce((function(t,e){var n=e&&fn(e,r);return n&&t.push(n),t}),[]);return Ne(t)?s[0]:s}pn.defaultProps=Qe,pn.setDefaultProps=Ze,pn.currentInput=Ve;Object.assign({},It,{effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow)}});pn.setDefaultProps({render:ln});var gn=pn,mn="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function yn(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}var wn=yn,bn="object"==typeof mn&&mn&&mn.Object===Object&&mn,vn=bn,En=vn,_n="object"==typeof self&&self&&self.Object===Object&&self,Sn=En||_n||Function("return this")(),An=Sn,Cn=An,In=function(){return Cn.Date.now()},Tn=In,kn=/\s/;function Rn(t){var e=t.length;while(e--&&kn.test(t.charAt(e)));return e}var Nn=Rn,Dn=Nn,On=/^\s+/;function Pn(t){return t?t.slice(0,Dn(t)+1).replace(On,""):t}var xn=Pn,Mn=An,Ln=Mn.Symbol,Bn=Ln,Un=Bn,Fn=Object.prototype,zn=Fn.hasOwnProperty,Vn=Fn.toString,jn=Un?Un.toStringTag:void 0;function Hn(t){var e=zn.call(t,jn),n=t[jn];try{t[jn]=void 0;var r=!0}catch(s){}var i=Vn.call(t);return r&&(e?t[jn]=n:delete t[jn]),i}var $n=Hn,Kn=Object.prototype,Gn=Kn.toString;function qn(t){return Gn.call(t)}var Wn=qn,Yn=Bn,Xn=$n,Qn=Wn,Jn="[object Null]",Zn="[object Undefined]",tr=Yn?Yn.toStringTag:void 0;function er(t){return null==t?void 0===t?Zn:Jn:tr&&tr in Object(t)?Xn(t):Qn(t)}var nr=er;function rr(t){return null!=t&&"object"==typeof t}var ir=rr,sr=nr,or=ir,ar="[object Symbol]";function cr(t){return"symbol"==typeof t||or(t)&&sr(t)==ar}var lr=cr,ur=xn,hr=wn,dr=lr,fr=NaN,pr=/^[-+]0x[0-9a-f]+$/i,gr=/^0b[01]+$/i,mr=/^0o[0-7]+$/i,yr=parseInt;function wr(t){if("number"==typeof t)return t;if(dr(t))return fr;if(hr(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=hr(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=ur(t);var n=gr.test(t);return n||mr.test(t)?yr(t.slice(2),n?2:8):pr.test(t)?fr:+t}var br=wr,vr=wn,Er=Tn,_r=br,Sr="Expected a function",Ar=Math.max,Cr=Math.min;function Ir(t,e,n){var r,i,s,o,a,c,l=0,u=!1,h=!1,d=!0;if("function"!=typeof t)throw new TypeError(Sr);function f(e){var n=r,s=i;return r=i=void 0,l=e,o=t.apply(s,n),o}function p(t){return l=t,a=setTimeout(y,e),u?f(t):o}function g(t){var n=t-c,r=t-l,i=e-n;return h?Cr(i,s-r):i}function m(t){var n=t-c,r=t-l;return void 0===c||n>=e||n<0||h&&r>=s}function y(){var t=Er();if(m(t))return w(t);a=setTimeout(y,g(t))}function w(t){return a=void 0,d&&r?f(t):(r=i=void 0,o)}function b(){void 0!==a&&clearTimeout(a),l=0,r=c=i=a=void 0}function v(){return void 0===a?o:w(Er())}function E(){var t=Er(),n=m(t);if(r=arguments,i=this,c=t,n){if(void 0===a)return p(c);if(h)return clearTimeout(a),a=setTimeout(y,e),f(c)}return void 0===a&&(a=setTimeout(y,e)),o}return e=_r(e)||0,vr(n)&&(u=!!n.leading,h="maxWait"in n,s=h?Ar(_r(n.maxWait)||0,e):s,d="trailing"in n?!!n.trailing:d),E.cancel=b,E.flush=v,E}var Tr=Ir;class kr{constructor({editor:t,element:e,view:n,tippyOptions:i={},updateDelay:s=250,shouldShow:o}){this.preventHide=!1,this.shouldShow=({view:t,state:e,from:n,to:i})=>{const{doc:s,selection:o}=e,{empty:a}=o,c=!s.textBetween(n,i).length&&(0,r.xh)(e.selection),l=this.element.contains(document.activeElement),u=t.hasFocus()||l;return!(!u||a||c||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:t})=>{var e;this.preventHide?this.preventHide=!1:(null===t||void 0===t?void 0:t.relatedTarget)&&(null===(e=this.element.parentNode)||void 0===e?void 0:e.contains(t.relatedTarget))||this.hide()},this.tippyBlurHandler=t=>{this.blurHandler({event:t})},this.updateHandler=(t,e)=>{var n,i,s;const{state:o,composing:a}=t,{doc:c,selection:l}=o,u=e&&e.doc.eq(c)&&e.selection.eq(l);if(a||u)return;this.createTooltip();const{ranges:h}=l,d=Math.min(...h.map((t=>t.$from.pos))),f=Math.max(...h.map((t=>t.$to.pos))),p=null===(n=this.shouldShow)||void 0===n?void 0:n.call(this,{editor:this.editor,view:t,state:o,oldState:e,from:d,to:f});p?(null===(i=this.tippy)||void 0===i||i.setProps({getReferenceClientRect:(null===(s=this.tippyOptions)||void 0===s?void 0:s.getReferenceClientRect)||(()=>{if((0,r.EG)(o.selection)){const e=t.nodeDOM(d);if(e)return e.getBoundingClientRect()}return(0,r.pr)(t,d,f)})}),this.show()):this.hide()},this.editor=t,this.element=e,this.view=n,this.updateDelay=s,o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=i,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:t}=this.editor.options,e=!!t.parentElement;!this.tippy&&e&&(this.tippy=gn(t,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(t,e){const{state:n}=t,r=n.selection.$from.pos!==n.selection.$to.pos;this.updateDelay>0&&r?Tr(this.updateHandler,this.updateDelay)(t,e):this.updateHandler(t,e)}show(){var t;null===(t=this.tippy)||void 0===t||t.show()}hide(){var t;null===(t=this.tippy)||void 0===t||t.hide()}destroy(){var t,e;(null===(t=this.tippy)||void 0===t?void 0:t.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(e=this.tippy)||void 0===e||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Rr=t=>new i.Sy({key:"string"===typeof t.pluginKey?new i.H$(t.pluginKey):t.pluginKey,view:e=>new kr({view:e,...t})});r.hj.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Rr({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});var Nr=n(3396),Dr=n(4870);class Or{constructor({editor:t,element:e,view:n,tippyOptions:r={},shouldShow:i}){this.preventHide=!1,this.shouldShow=({view:t,state:e})=>{const{selection:n}=e,{$anchor:r,empty:i}=n,s=1===r.depth,o=r.parent.isTextblock&&!r.parent.type.spec.code&&!r.parent.textContent;return!!(t.hasFocus()&&i&&s&&o&&this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:t})=>{var e;this.preventHide?this.preventHide=!1:(null===t||void 0===t?void 0:t.relatedTarget)&&(null===(e=this.element.parentNode)||void 0===e?void 0:e.contains(t.relatedTarget))||this.hide()},this.tippyBlurHandler=t=>{this.blurHandler({event:t})},this.editor=t,this.element=e,this.view=n,i&&(this.shouldShow=i),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=r,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:t}=this.editor.options,e=!!t.parentElement;!this.tippy&&e&&(this.tippy=gn(t,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(t,e){var n,i,s;const{state:o}=t,{doc:a,selection:c}=o,{from:l,to:u}=c,h=e&&e.doc.eq(a)&&e.selection.eq(c);if(h)return;this.createTooltip();const d=null===(n=this.shouldShow)||void 0===n?void 0:n.call(this,{editor:this.editor,view:t,state:o,oldState:e});d?(null===(i=this.tippy)||void 0===i||i.setProps({getReferenceClientRect:(null===(s=this.tippyOptions)||void 0===s?void 0:s.getReferenceClientRect)||(()=>(0,r.pr)(t,l,u))}),this.show()):this.hide()}show(){var t;null===(t=this.tippy)||void 0===t||t.show()}hide(){var t;null===(t=this.tippy)||void 0===t||t.hide()}destroy(){var t,e;(null===(t=this.tippy)||void 0===t?void 0:t.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(e=this.tippy)||void 0===e||e.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Pr=t=>new i.Sy({key:"string"===typeof t.pluginKey?new i.H$(t.pluginKey):t.pluginKey,view:e=>new Or({view:e,...t})});r.hj.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Pr({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}}),(0,Nr.aZ)({name:"BubbleMenu",props:{pluginKey:{type:[String,Object],default:"bubbleMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const n=(0,Dr.iH)(null);return(0,Nr.bv)((()=>{const{updateDelay:e,editor:r,pluginKey:i,shouldShow:s,tippyOptions:o}=t;r.registerPlugin(Rr({updateDelay:e,editor:r,element:n.value,pluginKey:i,shouldShow:s,tippyOptions:o}))})),(0,Nr.Jd)((()=>{const{pluginKey:e,editor:n}=t;n.unregisterPlugin(e)})),()=>{var t;return(0,Nr.h)("div",{ref:n},null===(t=e.default)||void 0===t?void 0:t.call(e))}}});function xr(t){return(0,Dr.ZM)(((e,n)=>({get(){return e(),t},set(e){t=e,requestAnimationFrame((()=>{requestAnimationFrame((()=>{n()}))}))}})))}class Mr extends r.ML{constructor(t={}){return super(t),this.vueRenderers=(0,Dr.qj)(new Map),this.contentComponent=null,this.reactiveState=xr(this.view.state),this.reactiveExtensionStorage=xr(this.extensionStorage),this.on("transaction",(()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage})),(0,Dr.Xl)(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(t,e){super.registerPlugin(t,e),this.reactiveState.value=this.view.state}unregisterPlugin(t){super.unregisterPlugin(t),this.reactiveState.value=this.view.state}}const Lr=(0,Nr.aZ)({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(t){const e=(0,Dr.iH)(),n=(0,Nr.FN)();return(0,Nr.m0)((()=>{const r=t.editor;r&&r.options.element&&e.value&&(0,Nr.Y3)((()=>{if(!e.value||!r.options.element.firstChild)return;const t=(0,Dr.SU)(e.value);e.value.append(...r.options.element.childNodes),r.contentComponent=n.ctx._,r.setOptions({element:t}),r.createNodeViews()}))})),(0,Nr.Jd)((()=>{const e=t.editor;if(!e)return;if(e.isDestroyed||e.view.setProps({nodeViews:{}}),e.contentComponent=null,!e.options.element.firstChild)return;const n=document.createElement("div");n.append(...e.options.element.childNodes),e.setOptions({element:n})})),{rootEl:e}},render(){const t=[];return this.editor&&this.editor.vueRenderers.forEach((e=>{const n=(0,Nr.h)(Nr.lR,{to:e.teleportElement,key:e.id},(0,Nr.h)(e.component,{ref:e.id,...e.props}));t.push(n)})),(0,Nr.h)("div",{ref:t=>{this.rootEl=t}},...t)}});(0,Nr.aZ)({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(t,{slots:e}){const n=(0,Dr.iH)(null);return(0,Nr.bv)((()=>{const{pluginKey:e,editor:r,tippyOptions:i,shouldShow:s}=t;r.registerPlugin(Pr({pluginKey:e,editor:r,element:n.value,tippyOptions:i,shouldShow:s}))})),(0,Nr.Jd)((()=>{const{pluginKey:e,editor:n}=t;n.unregisterPlugin(e)})),()=>{var t;return(0,Nr.h)("div",{ref:n},null===(t=e.default)||void 0===t?void 0:t.call(e))}}}),(0,Nr.aZ)({props:{as:{type:String,default:"div"}},render(){return(0,Nr.h)(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}}),(0,Nr.aZ)({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var t,e;return(0,Nr.h)(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},null===(e=(t=this.$slots).default)||void 0===e?void 0:e.call(t))}});Boolean},253:function(t,e,n){"use strict";n.d(e,{Ib:function(){return c},OR:function(){return l},iP:function(){return u},rP:function(){return p}});n(7658);var r=n(4870),i=n(3396),s="undefined"!==typeof window;var o,a;function c(t){let e;(0,i.bv)((()=>{t(),(0,i.Y3)((()=>{e=!0}))})),(0,i.dl)((()=>{e&&t()}))}function l(t,e,n={}){if(!s)return;const{target:o=window,passive:a=!1,capture:l=!1}=n;let u,h=!1;const d=n=>{if(h)return;const i=(0,r.SU)(n);i&&!u&&(i.addEventListener(t,e,{capture:l,passive:a}),u=!0)},f=n=>{if(h)return;const i=(0,r.SU)(n);i&&u&&(i.removeEventListener(t,e,l),u=!1)};let p;return(0,i.Ah)((()=>f(o))),(0,i.se)((()=>f(o))),c((()=>d(o))),(0,r.dq)(o)&&(p=(0,i.YP)(o,((t,e)=>{f(e),d(t)}))),()=>{null==p||p(),f(o),h=!0}}function u(){if(!o&&(o=(0,r.iH)(0),a=(0,r.iH)(0),s)){const t=()=>{o.value=window.innerWidth,a.value=window.innerHeight};t(),window.addEventListener("resize",t,{passive:!0}),window.addEventListener("orientationchange",t,{passive:!0})}return{width:o,height:a}}var h=/scroll|auto|overlay/i,d=s?window:void 0;function f(t){const e=1;return"HTML"!==t.tagName&&"BODY"!==t.tagName&&t.nodeType===e}function p(t,e=d){let n=t;while(n&&n!==e&&f(n)){const{overflowY:t}=window.getComputedStyle(n);if(h.test(t))return n;n=n.parentNode}return e}Symbol("van-field")},7214:function(t,e,n){"use strict";n.d(e,{JU:function(){return i},x0:function(){return s}});var r=n(7862);const i="undefined"!==typeof document?document:{},s=("undefined"!==typeof DOMParser&&new DOMParser,t=>r.UI(t,((t,e)=>`${e}:${t};`)).join(""));i.ELEMENT_NODE,i.TEXT_NODE,i.CDATA_SECTION_NODE,i.COMMENT_NODE,i.DOCUMENT_NODE,i.DOCUMENT_TYPE_NODE,i.DOCUMENT_FRAGMENT_NODE},6413:function(t,e,n){"use strict";n.d(e,{jU:function(){return d},UG:function(){return h},hH:function(){return v}});n(7658);var r=n(7862),i=n(654);const s=t=>void 0===t?null:t;class o{constructor(){this.map=new Map}setItem(t,e){this.map.set(t,e)}getItem(t){return this.map.get(t)}}let a=new o,c=!0;try{"undefined"!==typeof localStorage&&(a=localStorage,c=!1)}catch(E){}const l=a;var u=n(7409);const h="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name),d="undefined"!==typeof window&&"undefined"!==typeof document&&!h;"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);let f;const p=[],g=()=>{if(void 0===f)if(h){f=r.Ue();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];"-"===r[0]?(null!==e&&f.set(e,""),e=r):null!==e?(f.set(e,r),e=null):p.push(r)}null!==e&&f.set(e,"")}else"object"===typeof location?(f=r.Ue(),(location.search||"?").slice(1).split("&").forEach((t=>{if(0!==t.length){const[e,n]=t.split("=");f.set(`--${i.NF(e,"-")}`,n),f.set(`-${i.NF(e,"-")}`,n)}}))):f=r.Ue();return f},m=t=>g().has(t),y=t=>s(h?{NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}[t.toUpperCase()]:l.getItem(t)),w=t=>m("--"+t)||null!==y(t),b=(w("production"),h&&u.gB({NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}.FORCE_COLOR,["true","1","2"])),v=!m("no-colors")&&(!h||process.stdout.isTTY||b)&&(!h||m("color")||b||null!==y("COLORTERM")||(y("TERM")||"").includes("color"))},6969:function(t,e,n){"use strict";n.d(e,{Nw:function(){return i},Ue:function(){return r},zR:function(){return s}});const r=t=>new Error(t),i=()=>{throw r("Method unimplemented")},s=()=>{throw r("Unexpected case")}},1634:function(t,e,n){"use strict";n.d(e,{Vs:function(){return s}});n(7658);const r=t=>class{constructor(t){this._=t}destroy(){t(this._)}},i=r(clearTimeout),s=(t,e)=>new i(setTimeout(e,t));r(clearInterval),r((t=>"undefined"!==typeof requestAnimationFrame&&cancelAnimationFrame(t))),r((t=>"undefined"!==typeof cancelIdleCallback&&cancelIdleCallback(t)))},7409:function(t,e,n){"use strict";n.d(e,{PP:function(){return r},gB:function(){return i}});n(3767),n(8585),n(8696);const r=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&r(t,e,n+1)}},i=(t,e)=>e.includes(t)},7862:function(t,e,n){"use strict";n.d(e,{JG:function(){return i},UI:function(){return o},Ue:function(){return r},Yj:function(){return a},Yu:function(){return s}});n(7658);const r=()=>new Map,i=t=>{const e=r();return t.forEach(((t,n)=>{e.set(n,t)})),e},s=(t,e,n)=>{let r=t.get(e);return void 0===r&&t.set(e,r=n()),r},o=(t,e)=>{const n=[];for(const[r,i]of t)n.push(e(i,r));return n},a=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1}},1383:function(t,e,n){"use strict";n.d(e,{Fp:function(){return o},GR:function(){return a},GW:function(){return r},VV:function(){return s},Wn:function(){return i}});const r=Math.floor,i=(Math.ceil,Math.abs),s=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(t,e)=>t<e?t:e),o=(t,e)=>t>e?t:e,a=(Number.isNaN,Math.pow,Math.sign,t=>0!==t?t<0:1/t<0)},1370:function(t,e,n){"use strict";n.d(e,{$m:function(){return a},XP:function(){return r}});n(7658);Object.assign;const r=Object.keys,i=t=>r(t).length,s=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a=(t,e)=>t===e||i(t)===i(e)&&s(t,((t,n)=>(void 0!==t||o(e,n))&&e[n]===t))},6157:function(t,e,n){"use strict";n.d(e,{kw:function(){return c},U7:function(){return a},k$:function(){return u}});n(3767),n(8585),n(8696);var r=n(1383);"undefined"===typeof window||"undefined"!==typeof window.performance&&window.performance;const i="undefined"===typeof crypto?null:crypto,s=null!==i?t=>{const e=new ArrayBuffer(t),n=new Uint8Array(e);return i.getRandomValues(n),e}:t=>{const e=new ArrayBuffer(t),n=new Uint8Array(e);for(let r=0;r<t;r++)n[r]=Math.ceil(4294967295*Math.random()>>>0);return e},o=Math.random,a=()=>new Uint32Array(s(4))[0],c=t=>t[r.GW(o()*t.length)],l=[1e7]+-1e3+-4e3+-8e3+-1e11,u=()=>l.replace(/[018]/g,(t=>(t^a()&15>>t/4).toString(16)))},893:function(t,e,n){"use strict";n.d(e,{Ue:function(){return r}});const r=()=>new Set},654:function(t,e,n){"use strict";n.d(e,{CO:function(){return f},IK:function(){return r},NF:function(){return c},YZ:function(){return u},lz:function(){return d}});n(3767),n(8585),n(8696);const r=String.fromCharCode,i=(String.fromCodePoint,t=>t.toLowerCase()),s=/^\s*/g,o=t=>t.replace(s,""),a=/([A-Z])/g,c=(t,e)=>o(t.replace(a,(t=>`${e}${i(t)}`))),l=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let i=0;i<n;i++)r[i]=e.codePointAt(i);return r},u="undefined"!==typeof TextEncoder?new TextEncoder:null,h=t=>u.encode(t),d=u?h:l;let f="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});f&&1===f.decode(new Uint8Array).length&&(f=null)},4711:function(t,e,n){"use strict";n.d(e,{kU:function(){return p},Dp:function(){return f},ET:function(){return y}});n(3767),n(8585),n(8696);function r(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var i=0;i<t.length;i++){var s=t.charAt(i),o=s.charCodeAt(0);if(255!==n[o])throw new TypeError(s+" is ambiguous");n[o]=i}var a=t.length,c=t.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(e){if(e instanceof Uint8Array||(ArrayBuffer.isView(e)?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):Array.isArray(e)&&(e=Uint8Array.from(e))),!(e instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===e.length)return"";var n=0,r=0,i=0,s=e.length;while(i!==s&&0===e[i])i++,n++;var o=(s-i)*u+1>>>0,l=new Uint8Array(o);while(i!==s){for(var h=e[i],d=0,f=o-1;(0!==h||d<r)&&-1!==f;f--,d++)h+=256*l[f]>>>0,l[f]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,i++}var p=o-r;while(p!==o&&0===l[p])p++;for(var g=c.repeat(n);p<o;++p)g+=t.charAt(l[p]);return g}function d(t){if("string"!==typeof t)throw new TypeError("Expected String");if(0===t.length)return new Uint8Array;var e=0;if(" "!==t[e]){var r=0,i=0;while(t[e]===c)r++,e++;var s=(t.length-e)*l+1>>>0,o=new Uint8Array(s);while(t[e]){var u=n[t.charCodeAt(e)];if(255===u)return;for(var h=0,d=s-1;(0!==u||h<i)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");i=h,e++}if(" "!==t[e]){var f=s-i;while(f!==s&&0===o[f])f++;var p=new Uint8Array(r+(s-f)),g=r;while(f!==s)p[g++]=o[f++];return p}}}function f(t){var n=d(t);if(n)return n;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:f}}var i=r,s=i,o=s,a=n(3914);class c{constructor(t,e,n){this.name=t,this.prefix=e,this.baseEncode=n}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class l{constructor(t,e,n){if(this.name=t,this.prefix=e,void 0===e.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=e.codePointAt(0),this.baseDecode=n}decode(t){if("string"===typeof t){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(t){return h(this,t)}}class u{constructor(t){this.decoders=t}or(t){return h(this,t)}decode(t){const e=t[0],n=this.decoders[e];if(n)return n.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const h=(t,e)=>new u({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class d{constructor(t,e,n,r){this.name=t,this.prefix=e,this.baseEncode=n,this.baseDecode=r,this.encoder=new c(t,e,n),this.decoder=new l(t,e,r)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const f=({name:t,prefix:e,encode:n,decode:r})=>new d(t,e,n,r),p=({prefix:t,name:e,alphabet:n})=>{const{encode:r,decode:i}=o(n,e);return f({prefix:t,name:e,encode:r,decode:t=>(0,a.coerce)(i(t))})},g=(t,e,n,r)=>{const i={};for(let u=0;u<e.length;++u)i[e[u]]=u;let s=t.length;while("="===t[s-1])--s;const o=new Uint8Array(s*n/8|0);let a=0,c=0,l=0;for(let u=0;u<s;++u){const e=i[t[u]];if(void 0===e)throw new SyntaxError(`Non-${r} character`);c=c<<n|e,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},m=(t,e,n)=>{const r="="===e[e.length-1],i=(1<<n)-1;let s="",o=0,a=0;for(let c=0;c<t.length;++c){a=a<<8|t[c],o+=8;while(o>n)o-=n,s+=e[i&a>>o]}if(o&&(s+=e[i&a<<n-o]),r)while(s.length*n&7)s+="=";return s},y=({name:t,prefix:e,bitsPerChar:n,alphabet:r})=>f({prefix:e,name:t,encode(t){return m(t,r,n)},decode(e){return g(e,r,n,t)}})},2056:function(t,e,n){"use strict";n.r(e),n.d(e,{base32:function(){return i},base32hex:function(){return c},base32hexpad:function(){return u},base32hexpadupper:function(){return h},base32hexupper:function(){return l},base32pad:function(){return o},base32padupper:function(){return a},base32upper:function(){return s},base32z:function(){return d}});var r=n(4711);const i=(0,r.ET)({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),s=(0,r.ET)({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),o=(0,r.ET)({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),a=(0,r.ET)({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),c=(0,r.ET)({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),l=(0,r.ET)({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),u=(0,r.ET)({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),h=(0,r.ET)({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),d=(0,r.ET)({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5})},8334:function(t,e,n){"use strict";n.r(e),n.d(e,{base58btc:function(){return i},base58flickr:function(){return s}});var r=n(4711);const i=(0,r.kU)({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),s=(0,r.kU)({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"})},3914:function(t,e,n){"use strict";n.r(e),n.d(e,{coerce:function(){return a},empty:function(){return r},equals:function(){return o},fromHex:function(){return s},fromString:function(){return l},isBinary:function(){return c},toHex:function(){return i},toString:function(){return u}});n(3767),n(8585),n(8696);const r=new Uint8Array(0),i=t=>t.reduce(((t,e)=>t+e.toString(16).padStart(2,"0")),""),s=t=>{const e=t.match(/../g);return e?new Uint8Array(e.map((t=>parseInt(t,16)))):r},o=(t,e)=>{if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0},a=t=>{if(t instanceof Uint8Array&&"Uint8Array"===t.constructor.name)return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},c=t=>t instanceof ArrayBuffer||ArrayBuffer.isView(t),l=t=>(new TextEncoder).encode(t),u=t=>(new TextDecoder).decode(t)},9329:function(t,e,n){"use strict";n.d(e,{k:function(){return c}});n(3767),n(8585),n(8696);var r=n(550),i=n(5226),s=n(8334),o=n(2056),a=n(3914);class c{constructor(t,e,n,r){this.code=e,this.version=t,this.multihash=n,this.bytes=r,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:y,byteLength:y,code:m,version:m,multihash:m,bytes:m,_baseCache:y,asCID:y})}toV0(){switch(this.version){case 0:return this;default:{const{code:t,multihash:e}=this;if(t!==d)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(e.code!==f)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return c.createV0(e)}}}toV1(){switch(this.version){case 0:{const{code:t,digest:e}=this.multihash,n=i.Ue(t,e);return c.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(t){return t&&this.code===t.code&&this.version===t.version&&i.fS(this.multihash,t.multihash)}toString(t){const{bytes:e,version:n,_baseCache:r}=this;switch(n){case 0:return u(e,r,t||s.base58btc.encoder);default:return h(e,r,t||o.base32.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(t){return b(/^0\.0/,v),!(!t||!t[g]&&t.asCID!==t)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(t){if(t instanceof c)return t;if(null!=t&&t.asCID===t){const{version:e,code:n,multihash:r,bytes:i}=t;return new c(e,n,r,i||p(e,n,r.bytes))}if(null!=t&&!0===t[g]){const{version:e,multihash:n,code:r}=t,s=i.Jx(n);return c.create(e,r,s)}return null}static create(t,e,n){if("number"!==typeof e)throw new Error("String codecs are no longer supported");switch(t){case 0:if(e!==d)throw new Error(`Version 0 CID must use dag-pb (code: ${d}) block encoding`);return new c(t,e,n,n.bytes);case 1:{const r=p(t,e,n.bytes);return new c(t,e,n,r)}default:throw new Error("Invalid version")}}static createV0(t){return c.create(0,d,t)}static createV1(t,e){return c.create(1,t,e)}static decode(t){const[e,n]=c.decodeFirst(t);if(n.length)throw new Error("Incorrect length");return e}static decodeFirst(t){const e=c.inspectBytes(t),n=e.size-e.multihashSize,r=(0,a.coerce)(t.subarray(n,n+e.multihashSize));if(r.byteLength!==e.multihashSize)throw new Error("Incorrect length");const s=r.subarray(e.multihashSize-e.digestSize),o=new i.zZ(e.multihashCode,e.digestSize,s,r),l=0===e.version?c.createV0(o):c.createV1(e.codec,o);return[l,t.subarray(e.size)]}static inspectBytes(t){let e=0;const n=()=>{const[n,i]=r.Jx(t.subarray(e));return e+=i,n};let i=n(),s=d;if(18===i?(i=0,e=0):1===i&&(s=n()),0!==i&&1!==i)throw new RangeError(`Invalid CID version ${i}`);const o=e,a=n(),c=n(),l=e+c,u=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(t,e){const[n,r]=l(t,e),i=c.decode(r);return i._baseCache.set(n,t),i}}const l=(t,e)=>{switch(t[0]){case"Q":{const n=e||s.base58btc;return[s.base58btc.prefix,n.decode(`${s.base58btc.prefix}${t}`)]}case s.base58btc.prefix:{const n=e||s.base58btc;return[s.base58btc.prefix,n.decode(t)]}case o.base32.prefix:{const n=e||o.base32;return[o.base32.prefix,n.decode(t)]}default:if(null==e)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[t[0],e.decode(t)]}},u=(t,e,n)=>{const{prefix:r}=n;if(r!==s.base58btc.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);const i=e.get(r);if(null==i){const i=n.encode(t).slice(1);return e.set(r,i),i}return i},h=(t,e,n)=>{const{prefix:r}=n,i=e.get(r);if(null==i){const i=n.encode(t);return e.set(r,i),i}return i},d=112,f=18,p=(t,e,n)=>{const i=r.P$(t),s=i+r.P$(e),o=new Uint8Array(s+n.byteLength);return r.mL(t,o,0),r.mL(e,o,i),o.set(n,s),o},g=Symbol.for("@ipld/js-cid/CID"),m={writable:!1,configurable:!1,enumerable:!0},y={writable:!1,enumerable:!1,configurable:!1},w="0.0.0-dev",b=(t,e)=>{if(!t.test(w))throw new Error(e);console.warn(e)},v="CID.isCID(v) is deprecated and will be removed in the next major release.\nFollowing code pattern:\n\nif (CID.isCID(value)) {\n  doSomethingWithCID(value)\n}\n\nIs replaced with:\n\nconst cid = CID.asCID(value)\nif (cid) {\n  // Make sure to use cid instead of value\n  doSomethingWithCID(cid)\n}\n"},6347:function(t,e,n){"use strict";n.r(e),n.d(e,{code:function(){return s},decode:function(){return a},encode:function(){return o},name:function(){return i}});var r=n(3914);const i="raw",s=85,o=t=>(0,r.coerce)(t),a=t=>(0,r.coerce)(t)},5226:function(t,e,n){"use strict";n.d(e,{Jx:function(){return o},Ue:function(){return s},fS:function(){return a},zZ:function(){return c}});n(3767),n(8585),n(8696);var r=n(3914),i=n(550);const s=(t,e)=>{const n=e.byteLength,r=i.P$(t),s=r+i.P$(n),o=new Uint8Array(s+n);return i.mL(t,o,0),i.mL(n,o,r),o.set(e,s),new c(t,n,e,o)},o=t=>{const e=(0,r.coerce)(t),[n,s]=i.Jx(e),[o,a]=i.Jx(e.subarray(s)),l=e.subarray(s+a);if(l.byteLength!==o)throw new Error("Incorrect length");return new c(n,o,l,e)},a=(t,e)=>t===e||t.code===e.code&&t.size===e.size&&(0,r.equals)(t.bytes,e.bytes);class c{constructor(t,e,n,r){this.code=t,this.size=e,this.digest=n,this.bytes=r}}},8212:function(t,e,n){"use strict";n.d(e,{D:function(){return i}});n(3767),n(8585),n(8696);var r=n(5226);const i=({name:t,code:e,encode:n})=>new s(t,e,n);class s{constructor(t,e,n){this.name=t,this.code=e,this.encode=n}digest(t){if(t instanceof Uint8Array){const e=this.encode(t);return e instanceof Uint8Array?r.Ue(this.code,e):e.then((t=>r.Ue(this.code,t)))}throw Error("Unknown type, must be binary type")}}},7041:function(t,e,n){"use strict";n.r(e),n.d(e,{identity:function(){return l}});var r=n(3914),i=n(5226);const s=0,o="identity",a=r.coerce,c=t=>i.Ue(s,a(t)),l={code:s,name:o,encode:a,digest:c}},1919:function(t,e,n){"use strict";n.r(e),n.d(e,{sha256:function(){return s},sha512:function(){return o}});n(3767),n(8585),n(8696);var r=n(8212);const i=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),s=(0,r.D)({name:"sha2-256",code:18,encode:i("SHA-256")}),o=(0,r.D)({name:"sha2-512",code:19,encode:i("SHA-512")})},2493:function(t,e,n){"use strict";n.d(e,{aI:function(){return i},k0:function(){return r.k}});var r=n(9329),i=(n(550),n(3914));n(8212),n(5226)},550:function(t,e,n){"use strict";n.d(e,{Jx:function(){return I},mL:function(){return T},P$:function(){return k}});var r=c,i=128,s=127,o=~s,a=Math.pow(2,31);function c(t,e,n){e=e||[],n=n||0;var r=n;while(t>=a)e[n++]=255&t|i,t/=128;while(t&o)e[n++]=255&t|i,t>>>=7;return e[n]=0|t,c.bytes=n-r+1,e}var l=d,u=128,h=127;function d(t,e){var n,r=0,i=(e=e||0,0),s=e,o=t.length;do{if(s>=o)throw d.bytes=0,new RangeError("Could not decode varint");n=t[s++],r+=i<28?(n&h)<<i:(n&h)*Math.pow(2,i),i+=7}while(n>=u);return d.bytes=s-e,r}var f=Math.pow(2,7),p=Math.pow(2,14),g=Math.pow(2,21),m=Math.pow(2,28),y=Math.pow(2,35),w=Math.pow(2,42),b=Math.pow(2,49),v=Math.pow(2,56),E=Math.pow(2,63),_=function(t){return t<f?1:t<p?2:t<g?3:t<m?4:t<y?5:t<w?6:t<b?7:t<v?8:t<E?9:10},S={encode:r,decode:l,encodingLength:_},A=S,C=A;const I=(t,e=0)=>{const n=C.decode(t,e);return[n,C.decode.bytes]},T=(t,e,n=0)=>(C.encode(t,e,n),e),k=t=>C.encodingLength(t)},203:function(t,e,n){"use strict";n.d(e,{$:function(){return w},h:function(){return y}});for(var r={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},i={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},s="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),o=("undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)),a="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),c=o||s&&+s[1]<57,l=0;l<10;l++)r[48+l]=r[96+l]=String(l);for(l=1;l<=24;l++)r[l+111]="F"+l;for(l=65;l<=90;l++)r[l]=String.fromCharCode(l+32),i[l]=String.fromCharCode(l);for(var u in r)i.hasOwnProperty(u)||(i[u]=r[u]);function h(t){var e=c&&(t.ctrlKey||t.altKey||t.metaKey)||a&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key,n=!e&&t.key||(t.shiftKey?i:r)[t.keyCode]||t.key||"Unidentified";return"Esc"==n&&(n="Escape"),"Del"==n&&(n="Delete"),"Left"==n&&(n="ArrowLeft"),"Up"==n&&(n="ArrowUp"),"Right"==n&&(n="ArrowRight"),"Down"==n&&(n="ArrowDown"),n}var d=n(157);const f="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function p(t){let e,n,r,i,s=t.split(/-(?!$)/),o=s[s.length-1];"Space"==o&&(o=" ");for(let a=0;a<s.length-1;a++){let t=s[a];if(/^(cmd|meta|m)$/i.test(t))i=!0;else if(/^a(lt)?$/i.test(t))e=!0;else if(/^(c|ctrl|control)$/i.test(t))n=!0;else if(/^s(hift)?$/i.test(t))r=!0;else{if(!/^mod$/i.test(t))throw new Error("Unrecognized modifier name: "+t);f?i=!0:n=!0}}return e&&(o="Alt-"+o),n&&(o="Ctrl-"+o),i&&(o="Meta-"+o),r&&(o="Shift-"+o),o}function g(t){let e=Object.create(null);for(let n in t)e[p(n)]=t[n];return e}function m(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function y(t){return new d.Sy({props:{handleKeyDown:w(t)}})}function w(t){let e=g(t);return function(t,n){let i,s=h(n),o=e[m(s,n)];if(o&&o(t.state,t.dispatch,t))return!0;if(1==s.length&&" "!=s){if(n.shiftKey){let r=e[m(s,n,!1)];if(r&&r(t.state,t.dispatch,t))return!0}if((n.shiftKey||n.altKey||n.metaKey||s.charCodeAt(0)>127)&&(i=r[n.keyCode])&&i!=s){let r=e[m(i,n)];if(r&&r(t.state,t.dispatch,t))return!0}}return!1}}},1543:function(t,e,n){"use strict";n.d(e,{aw:function(){return rt},PW:function(){return bt},HY:function(){return a},vc:function(){return h},ZU:function(){return tt},NB:function(){return O},Ts:function(){return N},e4:function(){return d},V_:function(){return et},p2:function(){return f}});n(7658);function r(t){this.content=t}r.prototype={constructor:r,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var i=n&&n!=t?this.remove(n):this,s=i.find(t),o=i.content.slice();return-1==s?o.push(n||t,e):(o[s+1]=e,n&&(o[s]=n)),new r(o)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new r(n)},addToStart:function(t,e){return new r([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new r(n)},addBefore:function(t,e,n){var i=this.remove(e),s=i.content.slice(),o=i.find(t);return s.splice(-1==o?s.length:o,0,e,n),new r(s)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return t=r.from(t),t.size?new r(t.content.concat(this.subtract(t).content)):this},append:function(t){return t=r.from(t),t.size?new r(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=r.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach((function(e,n){t[e]=n})),t},get size(){return this.content.length>>1}},r.from=function(t){if(t instanceof r)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new r(e)};var i=r;function s(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),o=e.child(r);if(i!=o){if(!i.sameMarkup(o))return n;if(i.isText&&i.text!=o.text){for(let t=0;i.text[t]==o.text[t];t++)n++;return n}if(i.content.size||o.content.size){let t=s(i.content,o.content,n+1);if(null!=t)return t}n+=i.nodeSize}else n+=i.nodeSize}}function o(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(0==i||0==s)return i==s?null:{a:n,b:r};let a=t.child(--i),c=e.child(--s),l=a.nodeSize;if(a!=c){if(!a.sameMarkup(c))return{a:n,b:r};if(a.isText&&a.text!=c.text){let t=0,e=Math.min(a.text.length,c.text.length);while(t<e&&a.text[a.text.length-t-1]==c.text[c.text.length-t-1])t++,n--,r--;return{a:n,b:r}}if(a.content.size||c.content.size){let t=o(a.content,c.content,n-1,r-1);if(t)return t}n-=l,r-=l}else n-=l,r-=l}}class a{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,r=0,i){for(let s=0,o=0;o<e;s++){let a=this.content[s],c=o+a.nodeSize;if(c>t&&!1!==n(a,r+o,i||null,s)&&a.content.size){let i=o+1;a.nodesBetween(Math.max(0,t-i),Math.min(a.content.size,e-i),n,r+i)}o=c}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let i="",s=!0;return this.nodesBetween(t,e,((o,a)=>{o.isText?(i+=o.text.slice(Math.max(t,a)-a,e-a),s=!n):o.isLeaf?(r?i+="function"===typeof r?r(o):r:o.type.spec.leafText&&(i+=o.type.spec.leafText(o)),s=!n):!s&&o.isBlock&&(i+=n,s=!0)}),0),i}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)r.push(t.content[i]);return new a(r,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],r=0;if(e>t)for(let i=0,s=0;s<e;i++){let o=this.content[i],a=s+o.nodeSize;a>t&&((s<t||a>e)&&(o=o.isText?o.cut(Math.max(0,t-s),Math.min(o.text.length,e-s)):o.cut(Math.max(0,t-s-1),Math.min(o.content.size,e-s-1))),n.push(o),r+=o.nodeSize),s=a}return new a(n,r)}cutByIndex(t,e){return t==e?a.empty:0==t&&e==this.content.length?this:new a(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new a(r,i)}addToStart(t){return new a([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new a(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return s(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return o(this,t,e,n)}findIndex(t,e=-1){if(0==t)return l(0,t);if(t==this.size)return l(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=this.child(n),s=r+i.nodeSize;if(s>=t)return s==t||e>0?l(n+1,s):l(n,r);r=s}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return a.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new a(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return a.empty;let e,n=0;for(let r=0;r<t.length;r++){let i=t[r];n+=i.nodeSize,r&&i.isText&&t[r-1].sameMarkup(i)?(e||(e=t.slice(0,r)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new a(e||t,n)}static from(t){if(!t)return a.empty;if(t instanceof a)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new a([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}a.empty=new a([],0);const c={index:0,offset:0};function l(t,e){return c.index=t,c.offset=e,c}function u(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!u(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!u(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}class h{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let i=t[r];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,r));else{if(i.type.excludes(this.type))return t;!n&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(i)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&u(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return h.none;if(t instanceof h)return[t];let e=t.slice();return e.sort(((t,e)=>t.type.rank-e.type.rank)),e}}h.none=[];class d extends Error{}class f{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=g(this.content,t+this.openStart,e);return n&&new f(n,this.openStart,this.openEnd)}removeBetween(t,e){return new f(p(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return f.empty;let n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new f(a.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let i=t.firstChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.firstChild)n++;for(let i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new f(t,n,r)}}function p(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(p(s.content,e-i-1,n-i-1)))}function g(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=g(o.content,e-s-1,n);return a&&t.replaceChild(i,o.copy(a))}function m(t,e,n){if(n.openStart>t.depth)throw new d("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new d("Inconsistent open depths");return y(t,e,n,0)}function y(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=y(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){let{start:i,end:o}=C(n,t);return _(s,S(t,i,o,e,r))}{let r=t.parent,i=r.content;return _(r,i.cut(0,t.parentOffset).append(n.content).append(i.cut(e.parentOffset)))}}return _(s,A(t,e,r))}function w(t,e){if(!e.type.compatibleContent(t.type))throw new d("Cannot join "+e.type.name+" onto "+t.type.name)}function b(t,e,n){let r=t.node(n);return w(r,e.node(n)),r}function v(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function E(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(v(t.nodeAfter,r),s++));for(let a=s;a<o;a++)v(i.child(a),r);e&&e.depth==n&&e.textOffset&&v(e.nodeBefore,r)}function _(t,e){return t.type.checkContent(e),t.copy(e)}function S(t,e,n,r,i){let s=t.depth>i&&b(t,e,i+1),o=r.depth>i&&b(n,r,i+1),c=[];return E(null,t,i,c),s&&o&&e.index(i)==n.index(i)?(w(s,o),v(_(s,S(t,e,n,r,i+1)),c)):(s&&v(_(s,A(t,e,i+1)),c),E(e,n,i,c),o&&v(_(o,A(n,r,i+1)),c)),E(r,null,i,c),new a(c)}function A(t,e,n){let r=[];if(E(null,t,n,r),t.depth>n){let i=b(t,e,n+1);v(_(i,A(t,e,n+1)),r)}return E(e,null,n,r),new a(r)}function C(t,e){let n=e.depth-t.openStart,r=e.node(n),i=r.copy(t.content);for(let s=n-1;s>=0;s--)i=e.node(s).copy(a.from(i));return{start:i.resolveNoCache(t.openStart+n),end:i.resolveNoCache(i.content.size-t.openEnd-n)}}f.empty=new f(a.empty,0,0);class I{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return t=this.resolveDepth(t),0==t?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(t=this.resolveDepth(t),!t)throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1;for(let i=0;i<t;i++)r+=n.child(i).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(0==t.content.size)return h.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){let t=n;n=r,r=t}let i=n.marks;for(var s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,r=t.parent.maybeChild(t.index());for(var i=0;i<n.length;i++)!1!==n[i].type.spec.inclusive||r&&n[i].isInSet(r.marks)||(n=n[i--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new N(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],r=0,i=e;for(let s=t;;){let{index:t,offset:e}=s.content.findIndex(i),o=i-e;if(n.push(s,t,r+e),!o)break;if(s=s.child(t),s.isText)break;i=o-1,r+=e+1}return new I(e,n,i)}static resolveCached(t,e){for(let r=0;r<T.length;r++){let n=T[r];if(n.pos==e&&n.doc==t)return n}let n=T[k]=I.resolve(t,e);return k=(k+1)%R,n}}let T=[],k=0,R=12;class N{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const D=Object.create(null);class O{constructor(t,e,n,r=h.none){this.type=t,this.attrs=e,this.marks=r,this.content=n||a.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,r=0){this.content.nodesBetween(t,e,n,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&u(this.attrs,e||t.defaultAttrs||D)&&h.sameSet(this.marks,n||h.none)}copy(t=null){return t==this.content?this:new O(this.type,this.attrs,t,this.marks)}mark(t){return t==this.marks?this:new O(this.type,this.attrs,this.content,t)}cut(t,e=this.content.size){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return f.empty;let r=this.resolve(t),i=this.resolve(e),s=n?0:r.sharedDepth(e),o=r.start(s),a=r.node(s),c=a.content.cut(r.pos-o,i.pos-o);return new f(c,r.depth-s,i.depth-s)}replace(t,e,n){return m(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(0==t)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let r=this.content.child(e-1);return{node:r,index:e-1,offset:n-r.nodeSize}}resolve(t){return I.resolveCached(this,t)}resolveNoCache(t){return I.resolve(this,t)}rangeHasMark(t,e,n){let r=!1;return e>t&&this.nodesBetween(t,e,(t=>(n.isInSet(t.marks)&&(r=!0),!r))),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),x(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=a.empty,r=0,i=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,r,i),o=s&&s.matchFragment(this.content,e);if(!o||!o.validEnd)return!1;for(let a=r;a<i;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(t).matchType(n),s=i&&i.matchFragment(this.content,e);return!!s&&s.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content);let t=h.none;for(let e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!h.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((t=>t.type.name))}`);this.content.forEach((t=>t.check()))}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((t=>t.toJSON()))),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let r=a.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)}}O.prototype.text=void 0;class P extends O{constructor(t,e,n,r){if(super(t,e,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):x(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new P(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new P(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return 0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function x(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class M{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new L(t,e);if(null==n.next)return M.empty;let r=B(n);n.next&&n.err("Unexpected trailing text");let i=q($(r));return W(i,n),i}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let r=this;for(let i=e;r&&i<n;i++)r=r.matchType(t.child(i).type);return r}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let r=[this];function i(s,o){let c=s.matchFragment(t,n);if(c&&(!e||c.validEnd))return a.from(o.map((t=>t.createAndFill())));for(let t=0;t<s.next.length;t++){let{type:e,next:n}=s.next[t];if(!e.isText&&!e.hasRequiredAttrs()&&-1==r.indexOf(n)){r.push(n);let t=i(n,o.concat(e));if(t)return t}}return null}return i(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){let r=n.shift(),i=r.match;if(i.matchType(t)){let t=[];for(let e=r;e.type;e=e.via)t.push(e.type);return t.reverse()}for(let t=0;t<i.next.length;t++){let{type:s,next:o}=i.next[t];s.isLeaf||s.hasRequiredAttrs()||s.name in e||r.type&&!o.validEnd||(n.push({match:s.contentMatch,type:s,via:r}),e[s.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];function e(n){t.push(n);for(let r=0;r<n.next.length;r++)-1==t.indexOf(n.next[r].next)&&e(n.next[r].next)}return e(this),t.map(((e,n)=>{let r=n+(e.validEnd?"*":" ")+" ";for(let i=0;i<e.next.length;i++)r+=(i?", ":"")+e.next[i].type.name+"->"+t.indexOf(e.next[i].next);return r})).join("\n")}}M.empty=new M(!0);class L{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function B(t){let e=[];do{e.push(U(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function U(t){let e=[];do{e.push(F(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function F(t){let e=H(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=V(t,e)}return e}function z(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function V(t,e){let n=z(t),r=n;return t.eat(",")&&(r="}"!=t.next?z(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function j(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let t=n[s];t.groups.indexOf(e)>-1&&i.push(t)}return 0==i.length&&t.err("No node type or group '"+e+"' found"),i}function H(t){if(t.eat("(")){let e=B(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){let e=j(t,t.next).map((e=>(null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e})));return t.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}t.err("Unexpected token '"+t.next+"'")}function $(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){let i={term:r,to:n};return e[t].push(i),i}function i(t,e){t.forEach((t=>t.to=e))}function s(t,e){if("choice"==t.type)return t.exprs.reduce(((t,n)=>t.concat(s(n,e))),[]);if("seq"!=t.type){if("star"==t.type){let o=n();return r(e,o),i(s(t.expr,o),o),[r(o)]}if("plus"==t.type){let o=n();return i(s(t.expr,e),o),i(s(t.expr,o),o),[r(o)]}if("opt"==t.type)return[r(e)].concat(s(t.expr,e));if("range"==t.type){let o=e;for(let e=0;e<t.min;e++){let e=n();i(s(t.expr,o),e),o=e}if(-1==t.max)i(s(t.expr,o),o);else for(let e=t.min;e<t.max;e++){let e=n();r(o,e),i(s(t.expr,o),e),o=e}return[r(o)]}if("name"==t.type)return[r(e,void 0,t.value)];throw new Error("Unknown expr type")}for(let r=0;;r++){let o=s(t.exprs[r],e);if(r==t.exprs.length-1)return o;i(o,e=n())}}}function K(t,e){return e-t}function G(t,e){let n=[];return r(e),n.sort(K);function r(e){let i=t[e];if(1==i.length&&!i[0].term)return r(i[0].to);n.push(e);for(let t=0;t<i.length;t++){let{term:e,to:s}=i[t];e||-1!=n.indexOf(s)||r(s)}}}function q(t){let e=Object.create(null);return n(G(t,0));function n(r){let i=[];r.forEach((e=>{t[e].forEach((({term:e,to:n})=>{if(!e)return;let r;for(let t=0;t<i.length;t++)i[t][0]==e&&(r=i[t][1]);G(t,n).forEach((t=>{r||i.push([e,r=[]]),-1==r.indexOf(t)&&r.push(t)}))}))}));let s=e[r.join(",")]=new M(r.indexOf(t.length-1)>-1);for(let t=0;t<i.length;t++){let r=i[t][1].sort(K);s.next.push({type:i[t][0],next:e[r.join(",")]||n(r)})}return s}}function W(t,e){for(let n=0,r=[t];n<r.length;n++){let t=r[n],i=!t.validEnd,s=[];for(let e=0;e<t.next.length;e++){let{type:n,next:o}=t.next[e];s.push(n.name),!i||n.isText||n.hasRequiredAttrs()||(i=!1),-1==r.indexOf(o)&&r.push(o)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Y(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function X(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(void 0===i){let e=t[r];if(!e.hasDefault)throw new RangeError("No value supplied for attribute "+r);i=e.default}n[r]=i}return n}function Q(t){let e=Object.create(null);if(t)for(let n in t)e[n]=new Z(t[n]);return e}class J{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Q(n.attrs),this.defaultAttrs=Y(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==M.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:X(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new O(this,this.computeAttrs(t),a.from(e),h.setFrom(n))}createChecked(t=null,e,n){return e=a.from(e),this.checkContent(e),new O(this,this.computeAttrs(t),e,h.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),e=a.from(e),e.size){let t=this.contentMatch.fillBefore(e);if(!t)return null;e=t.append(e)}let r=this.contentMatch.matchFragment(e),i=r&&r.fillBefore(a.empty,!0);return i?new O(this,t,e.append(i),h.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}allowsMarkType(t){return null==this.markSet||this.markSet.indexOf(t)>-1}allowsMarks(t){if(null==this.markSet)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(null==this.markSet)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:h.none:t}static compile(t,e){let n=Object.create(null);t.forEach(((t,r)=>n[t]=new J(t,e,r)));let r=e.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let i in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}class Z{constructor(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default}get isRequired(){return!this.hasDefault}}class tt{constructor(t,e,n,r){this.name=t,this.rank=e,this.schema=n,this.spec=r,this.attrs=Q(r.attrs),this.excluded=null;let i=Y(this.attrs);this.instance=i?new h(this,i):null}create(t=null){return!t&&this.instance?this.instance:new h(this,X(this.attrs,t))}static compile(t,e){let n=Object.create(null),r=0;return t.forEach(((t,i)=>n[t]=new tt(t,r++,e,i))),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}excludes(t){return this.excluded.indexOf(t)>-1}}class et{constructor(t){this.cached=Object.create(null);let e=this.spec={};for(let r in t)e[r]=t[r];e.nodes=i.from(t.nodes),e.marks=i.from(t.marks||{}),this.nodes=J.compile(this.spec.nodes,this),this.marks=tt.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let t=this.nodes[r],e=t.spec.content||"",i=t.spec.marks;t.contentMatch=n[e]||(n[e]=M.parse(e,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.markSet="_"==i?null:i?nt(this,i.split(" ")):""!=i&&t.inlineContent?null:[]}for(let r in this.marks){let t=this.marks[r],e=t.spec.excludes;t.excluded=null==e?[t]:""==e?[]:nt(this,e.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof J))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)}text(t,e){let n=this.nodes.text;return new P(n,n.defaultAttrs,t,h.setFrom(e))}mark(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return O.fromJSON(this,t)}markFromJSON(t){return h.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}}function nt(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let e in t.marks){let r=t.marks[e];("_"==i||r.spec.group&&r.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=r)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}class rt{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((t=>{t.tag?this.tags.push(t):t.style&&this.styles.push(t)})),this.normalizeLists=!this.tags.some((e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;let n=t.nodes[e.node];return n.contentMatch.matchType(n)}))}parse(t,e={}){let n=new dt(this,e,!1);return n.addAll(t,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new dt(this,e,!0);return n.addAll(t,e.from,e.to),f.maxOpen(n.finish())}matchTag(t,e,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(pt(t,n.tag)&&(void 0===n.namespace||t.namespaceURI==n.namespace)&&(!n.context||e.matchesContext(n.context))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}matchStyle(t,e,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],s=r.style;if(!(0!=s.indexOf(t)||r.context&&!n.matchesContext(r.context)||s.length>t.length&&(61!=s.charCodeAt(t.length)||s.slice(t.length+1)!=e))){if(r.getAttrs){let t=r.getAttrs(e);if(!1===t)continue;r.attrs=t||void 0}return r}}}static schemaRules(t){let e=[];function n(t){let n=null==t.priority?50:t.priority,r=0;for(;r<e.length;r++){let t=e[r],i=null==t.priority?50:t.priority;if(i<n)break}e.splice(r,0,t)}for(let r in t.marks){let e=t.marks[r].spec.parseDOM;e&&e.forEach((t=>{n(t=mt(t)),t.mark||t.ignore||t.clearMark||(t.mark=r)}))}for(let r in t.nodes){let e=t.nodes[r].spec.parseDOM;e&&e.forEach((t=>{n(t=mt(t)),t.node||t.ignore||t.mark||(t.node=r)}))}return e}static fromSchema(t){return t.cached.domParser||(t.cached.domParser=new rt(t,rt.schemaRules(t)))}}const it={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},st={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},ot={ol:!0,ul:!0},at=1,ct=2,lt=4;function ut(t,e,n){return null!=e?(e?at:0)|("full"===e?ct:0):t&&"pre"==t.whitespace?at|ct:n&~lt}class ht{constructor(t,e,n,r,i,s,o){this.type=t,this.attrs=e,this.marks=n,this.pendingMarks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=h.none,this.stashMarks=[],this.match=s||(o&lt?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(a.from(t));if(!e){let e,n=this.type.contentMatch;return(e=n.findWrapping(t.type))?(this.match=n,e):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}finish(t){if(!(this.options&at)){let t,e=this.content[this.content.length-1];if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let e=a.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(a.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,n=this.pendingMarks;e<n.length;e++){let r=n[e];(this.type?this.type.allowsMarkType(r.type):yt(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!it.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class dt{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let r,i=e.topNode,s=ut(null,e.preserveWhitespace,0)|(n?lt:0);r=i?new ht(i.type,i.attrs,h.none,h.none,!0,e.topMatch||i.type.contentMatch,s):new ht(n?null:t.schema.topNodeType,null,h.none,h.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){if(3==t.nodeType)this.addTextNode(t);else if(1==t.nodeType){let e=t.getAttribute("style");if(e){let n=this.readStyles(gt(e));if(!n)return;let[r,i]=n,s=this.top;for(let t=0;t<i.length;t++)this.removePendingMark(i[t],s);for(let t=0;t<r.length;t++)this.addPendingMark(r[t]);this.addElement(t);for(let t=0;t<r.length;t++)this.removePendingMark(r[t],s);for(let t=0;t<i.length;t++)this.addPendingMark(i[t])}else this.addElement(t)}}addTextNode(t){let e=t.nodeValue,n=this.top;if(n.options&ct||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(n.options&at)e=n.options&ct?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let r=n.content[n.content.length-1],i=t.previousSibling;(!r||i&&"BR"==i.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let n,r=t.nodeName.toLowerCase();ot.hasOwnProperty(r)&&this.parser.normalizeLists&&ft(t);let i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(i?i.ignore:st.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);let e,n=this.top,s=this.needsBlock;if(it.hasOwnProperty(r))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),e=!0,n.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);this.addAll(t),e&&this.sync(n),this.needsBlock=s}else this.addElementByRule(t,i,!1===i.consuming?n:void 0)}leafFallback(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))}ignoreFallback(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=h.none,n=h.none;t:for(let r=0;r<t.length;r+=2)for(let i;;){let s=this.parser.matchStyle(t[r],t[r+1],this,i);if(!s)continue t;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.forEach((t=>{s.clearMark(t)&&(n=t.addToSet(n))})):e=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(e),!1!==s.consuming)break;i=s}return[e,n]}addElementByRule(t,e,n){let r,i,s;if(e.node)i=this.parser.schema.nodes[e.node],i.isLeaf?this.insertNode(i.create(e.attrs))||this.leafFallback(t):r=this.enter(i,e.attrs||null,e.preserveWhitespace);else{let t=this.parser.schema.marks[e.mark];s=t.create(e.attrs),this.addPendingMark(s)}let o=this.top;if(i&&i.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((t=>this.insertNode(t)));else{let n=t;"string"==typeof e.contentElement?n=t.querySelector(e.contentElement):"function"==typeof e.contentElement?n=e.contentElement(t):e.contentElement&&(n=e.contentElement),this.findAround(t,n,!0),this.addAll(n)}r&&this.sync(o)&&this.open--,s&&this.removePendingMark(s,o)}addAll(t,e,n){let r=e||0;for(let i=e?t.childNodes[e]:t.firstChild,s=null==n?null:t.childNodes[n];i!=s;i=i.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(i);this.findAtPoint(t,r)}findPlace(t){let e,n;for(let r=this.open;r>=0;r--){let i=this.nodes[r],s=i.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,n=i,!s.length))break;if(i.solid)break}if(!e)return!1;this.sync(n);for(let r=0;r<e.length;r++)this.enterInner(e[r],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let n=e.activeMarks;for(let r=0;r<t.marks.length;r++)e.type&&!e.type.allowsMarkType(t.marks[r].type)||(n=t.marks[r].addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n){let r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r}enterInner(t,e=null,n=!1,r){this.closeExtra();let i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t);let s=ut(t,r,i.options);i.options&lt&&0==i.content.length&&(s|=lt),this.nodes.push(new ht(t,e,i.activeMarks,i.pendingMarks,n,null,s)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let e=n.length-1;e>=0;e--)t+=n[e].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){let t=e.compareDocumentPosition(this.find[r].node);t&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),s=(t,o)=>{for(;t>=0;t--){let a=e[t];if(""==a){if(t==e.length-1||0==t)continue;for(;o>=i;o--)if(s(t-1,o))return!0;return!1}{let t=o>0||0==o&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!t||t.name!=a&&-1==t.groups.indexOf(a))return!1;o--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}addPendingMark(t){let e=wt(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let n=this.open;n>=0;n--){let r=this.nodes[n],i=r.pendingMarks.lastIndexOf(t);if(i>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);let e=r.popFromStashMark(t);e&&r.type&&r.type.allowsMarkType(e.type)&&(r.activeMarks=e.addToSet(r.activeMarks))}if(r==e)break}}}function ft(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let t=1==e.nodeType?e.nodeName.toLowerCase():null;t&&ot.hasOwnProperty(t)&&n?(n.appendChild(e),e=n):"li"==t?n=e:t&&(n=null)}}function pt(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function gt(t){let e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(e=n.exec(t))r.push(e[1],e[2].trim());return r}function mt(t){let e={};for(let n in t)e[n]=t[n];return e}function yt(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=t=>{s.push(t);for(let n=0;n<t.edgeCount;n++){let{type:r,next:i}=t.edge(n);if(r==e)return!0;if(s.indexOf(i)<0&&o(i))return!0}};if(o(i.contentMatch))return!0}}function wt(t,e){for(let n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}class bt{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=Et(e).createDocumentFragment());let r=n,i=[];return t.forEach((t=>{if(i.length||t.marks.length){let n=0,s=0;while(n<i.length&&s<t.marks.length){let e=t.marks[s];if(this.marks[e.type.name]){if(!e.eq(i[n][0])||!1===e.type.spec.spanning)break;n++,s++}else s++}while(n<i.length)r=i.pop()[1];while(s<t.marks.length){let n=t.marks[s++],o=this.serializeMark(n,t.isInline,e);o&&(i.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(t,e))})),n}serializeNodeInner(t,e){let{dom:n,contentDOM:r}=bt.renderSpec(Et(e),this.nodes[t.type.name](t));if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let i=this.serializeMark(t.marks[r],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(t,e,n={}){let r=this.marks[t.type.name];return r&&bt.renderSpec(Et(n),r(t,e))}static renderSpec(t,e,n=null){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;let r,i=e[0],s=i.indexOf(" ");s>0&&(n=i.slice(0,s),i=i.slice(s+1));let o=n?t.createElementNS(n,i):t.createElement(i),a=e[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){c=2;for(let t in a)if(null!=a[t]){let e=t.indexOf(" ");e>0?o.setAttributeNS(t.slice(0,e),t.slice(e+1),a[t]):o.setAttribute(t,a[t])}}for(let l=c;l<e.length;l++){let i=e[l];if(0===i){if(l<e.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:o,contentDOM:o}}{let{dom:e,contentDOM:s}=bt.renderSpec(t,i,n);if(o.appendChild(e),s){if(r)throw new RangeError("Multiple content holes");r=s}}}return{dom:o,contentDOM:r}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new bt(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=vt(t.nodes);return e.text||(e.text=t=>t.text),e}static marksFromSchema(t){return vt(t.marks)}}function vt(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function Et(t){return t.document||window.document}},157:function(t,e,n){"use strict";n.d(e,{Bs:function(){return u},C1:function(){return p},H$:function(){return D},Sy:function(){return k},Y1:function(){return o},qv:function(){return d},yy:function(){return I}});n(7658);var r=n(1543),i=n(1382);const s=Object.create(null);class o{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new a(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=r.p2.empty){let n=e.content.lastChild,i=null;for(let r=0;r<e.openEnd;r++)i=n,n=n.lastChild;let s=t.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:c,$to:l}=o[a],u=t.mapping.slice(s);t.replaceRange(u.map(c.pos),u.map(l.pos),a?r.p2.empty:e),0==a&&y(t,s,(n?n.isInline:i&&i.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:s,$to:o}=r[i],a=t.mapping.slice(n),c=a.map(s.pos),l=a.map(o.pos);i?t.deleteRange(c,l):(t.replaceRangeWith(c,l,e),y(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new u(t):m(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let i=t.depth-1;i>=0;i--){let r=e<0?m(t.node(0),t.node(i),t.before(i+1),t.index(i),e,n):m(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,e,n);if(r)return r}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new p(t.node(0))}static atStart(t){return m(t,t,0,0,1)||new p(t)}static atEnd(t){return m(t,t,t.content.size,t.childCount,-1)||new p(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=s[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in s)throw new RangeError("Duplicate use of selection JSON ID "+t);return s[t]=e,e.prototype.jsonID=t,e}getBookmark(){return u.between(this.$anchor,this.$head).getBookmark()}}o.prototype.visible=!0;class a{constructor(t,e){this.$from=t,this.$to=e}}let c=!1;function l(t){c||t.parent.inlineContent||(c=!0,console["warn"]("TextSelection endpoint not pointing into a node with inline content ("+t.parent.type.name+")"))}class u extends o{constructor(t,e=t){l(t),l(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return o.near(n);let r=t.resolve(e.map(this.anchor));return new u(r.parent.inlineContent?r:n,n)}replace(t,e=r.p2.empty){if(super.replace(t,e),e==r.p2.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof u&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new h(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new u(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if(n&&!r||(n=r>=0?1:-1),!e.parent.inlineContent){let t=o.findFrom(e,n,!0)||o.findFrom(e,-n,!0);if(!t)return o.near(e,n);e=t.$head}return t.parent.inlineContent||(0==r?t=e:(t=(o.findFrom(t,-n,!0)||o.findFrom(t,n,!0)).$anchor,t.pos<e.pos!=r<0&&(t=e))),new u(t,e)}}o.jsonID("text",u);class h{constructor(t,e){this.anchor=t,this.head=e}map(t){return new h(t.map(this.anchor),t.map(this.head))}resolve(t){return u.between(t.resolve(this.anchor),t.resolve(this.head))}}class d extends o{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),i=t.resolve(r);return n?o.near(i):new d(i)}content(){return new r.p2(r.HY.from(this.node),0,0)}eq(t){return t instanceof d&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new f(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new d(t.resolve(e.anchor))}static create(t,e){return new d(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}d.prototype.visible=!1,o.jsonID("node",d);class f{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new h(n,n):new f(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&d.isSelectable(n)?new d(e):o.near(e)}}class p extends o{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=r.p2.empty){if(e==r.p2.empty){t.delete(0,t.doc.content.size);let e=o.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new p(t)}map(t){return new p(t)}eq(t){return t instanceof p}getBookmark(){return g}}o.jsonID("all",p);const g={map(){return this},resolve(t){return new p(t)}};function m(t,e,n,r,i,s=!1){if(e.inlineContent)return u.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let r=e.child(o);if(r.isAtom){if(!s&&d.isSelectable(r))return d.create(t,n-(i<0?r.nodeSize:0))}else{let e=m(t,r,n+i,i<0?r.childCount:0,i,s);if(e)return e}n+=r.nodeSize*i}return null}function y(t,e,n){let r=t.steps.length-1;if(r<e)return;let s=t.steps[r];if(!(s instanceof i.Pu||s instanceof i.FC))return;let a,c=t.mapping.maps[r];c.forEach(((t,e,n,r)=>{null==a&&(a=r)})),t.setSelection(o.near(t.doc.resolve(a),n))}const w=1,b=2,v=4;class E extends i.wx{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=(this.updated|w)&~b,this.storedMarks=null,this}get selectionSet(){return(this.updated&w)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=b,this}ensureMarks(t){return r.vc.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&b)>0}addStep(t,e){super.addStep(t,e),this.updated=this.updated&~b,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||r.vc.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();{if(null==n&&(n=e),n=null==n?e:n,!t)return this.deleteRange(e,n);let i=this.storedMarks;if(!i){let t=this.doc.resolve(e);i=n==e?t.marks():t.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,i)),this.selection.empty||this.setSelection(o.near(this.selection.$to)),this}}setMeta(t,e){return this.meta["string"==typeof t?t:t.key]=e,this}getMeta(t){return this.meta["string"==typeof t?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=v,this}get scrolledIntoView(){return(this.updated&v)>0}}function _(t,e){return e&&t?t.bind(e):t}class S{constructor(t,e,n){this.name=t,this.init=_(e.init,n),this.apply=_(e.apply,n)}}const A=[new S("doc",{init(t){return t.doc||t.schema.topNodeType.createAndFill()},apply(t){return t.doc}}),new S("selection",{init(t,e){return t.selection||o.atStart(e.doc)},apply(t){return t.selection}}),new S("storedMarks",{init(t){return t.storedMarks||null},apply(t,e,n,r){return r.selection.$cursor?t.storedMarks:null}}),new S("scrollToSelection",{init(){return 0},apply(t,e){return t.scrolledIntoView?e+1:e}})];class C{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=A.slice(),e&&e.forEach((t=>{if(this.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");this.plugins.push(t),this.pluginsByKey[t.key]=t,t.spec.state&&this.fields.push(new S(t.key,t.spec.state,t))}))}}class I{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let e=this.config.plugins[n];if(e.spec.filterTransaction&&!e.spec.filterTransaction.call(e,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),r=null;for(;;){let i=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let a=r?r[s].n:0,c=r?r[s].state:this,l=a<e.length&&o.spec.appendTransaction.call(o,a?e.slice(a):e,c,n);if(l&&n.filterTransaction(l,s)){if(l.setMeta("appendedTransaction",t),!r){r=[];for(let t=0;t<this.config.plugins.length;t++)r.push(t<s?{state:n,n:e.length}:{state:this,n:0})}e.push(l),n=n.applyInner(l),i=!0}r&&(r[s]={state:n,n:e.length})}}if(!i)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new I(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let i=n[r];e[i.name]=i.apply(t,this[i.name],this,e)}return e}get tr(){return new E(this)}static create(t){let e=new C(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new I(e);for(let r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n}reconfigure(t){let e=new C(this.schema,t.plugins),n=e.fields,r=new I(e);for(let i=0;i<n.length;i++){let e=n[i].name;r[e]=this.hasOwnProperty(e)?this[e]:n[i].init(t,r)}return r}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((t=>t.toJSON()))),t&&"object"==typeof t)for(let n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=t[n],i=r.spec.state;i&&i.toJSON&&(e[n]=i.toJSON.call(r,this[r.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let i=new C(t.schema,t.plugins),s=new I(i);return i.fields.forEach((i=>{if("doc"==i.name)s.doc=r.NB.fromJSON(t.schema,e.doc);else if("selection"==i.name)s.selection=o.fromJSON(s.doc,e.selection);else if("storedMarks"==i.name)e.storedMarks&&(s.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let r in n){let o=n[r],a=o.spec.state;if(o.key==i.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,r))return void(s[i.name]=a.fromJSON.call(o,t,e[r],s))}s[i.name]=i.init(t,s)}})),s}}function T(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):"handleDOMEvents"==r&&(i=T(i,e,{})),n[r]=i}return n}class k{constructor(t){this.spec=t,this.props={},t.props&&T(t.props,this,this.props),this.key=t.key?t.key.key:N("plugin")}getState(t){return t[this.key]}}const R=Object.create(null);function N(t){return t in R?t+"$"+ ++R[t]:(R[t]=0,t+"$")}class D{constructor(t="key"){this.key=N(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}},1382:function(t,e,n){"use strict";n.d(e,{Ax:function(){return V},FC:function(){return C},GJ:function(){return K},Mn:function(){return H},Pu:function(){return A},dR:function(){return Y},k9:function(){return D},nd:function(){return P},nj:function(){return W},vs:function(){return g},wx:function(){return dt}});n(7658),n(541);var r=n(1543);const i=65535,s=Math.pow(2,16);function o(t,e){return t+e*s}function a(t){return t&i}function c(t){return(t-(t&i))/s}const l=1,u=2,h=4,d=8;class f{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(this.delInfo&d)>0}get deletedBefore(){return(this.delInfo&(l|h))>0}get deletedAfter(){return(this.delInfo&(u|h))>0}get deletedAcross(){return(this.delInfo&h)>0}}class p{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&p.empty)return p.empty}recover(t){let e=0,n=a(t);if(!this.inverted)for(let r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+c(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,i=this.inverted?2:1,s=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let c=this.ranges[a]-(this.inverted?r:0);if(c>t)break;let p=this.ranges[a+i],g=this.ranges[a+s],m=c+p;if(t<=m){let i=p?t==c?-1:t==m?1:e:e,s=c+r+(i<0?0:g);if(n)return s;let y=t==(e<0?c:m)?null:o(a/3,t-c),w=t==c?u:t==m?l:h;return(e<0?t!=c:t!=m)&&(w|=d),new f(s,w,y)}r+=g-p}return n?t+r:new f(t+r,0,null)}touches(t,e){let n=0,r=a(e),i=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let e=this.ranges[o]-(this.inverted?n:0);if(e>t)break;let a=this.ranges[o+i],c=e+a;if(t<=c&&o==3*r)return!0;n+=this.ranges[o+s]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let s=this.ranges[r],o=s-(this.inverted?i:0),a=s+(this.inverted?0:i),c=this.ranges[r+e],l=this.ranges[r+n];t(o,o+c,a,a+l),i+=l-c}}invert(){return new p(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?p.empty:new p(t<0?[0,-t,0]:[0,0,t])}}p.empty=new p([]);class g{constructor(t=[],e,n=0,r=t.length){this.maps=t,this.mirror=e,this.from=n,this.to=r}slice(t=0,e=this.maps.length){return new g(this.maps,this.mirror,t,e)}copy(){return new g(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,n=this.maps.length;e<t.maps.length;e++){let r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:void 0)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){let r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:void 0)}}invert(){let t=new g;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let r=0;for(let i=this.from;i<this.to;i++){let n=this.maps[i],s=n.mapResult(t,e);if(null!=s.recover){let e=this.getMirror(i);if(null!=e&&e>i&&e<this.to){i=e,t=this.maps[e].recover(s.recover);continue}}r|=s.delInfo,t=s.pos}return n?t:new f(t,r,null)}}const m=Object.create(null);class y{getMap(){return p.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=m[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in m)throw new RangeError("Duplicate use of step JSON ID "+t);return m[t]=e,e.prototype.jsonID=t,e}}class w{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new w(t,null)}static fail(t){return new w(null,t)}static fromReplace(t,e,n,i){try{return w.ok(t.replace(e,n,i))}catch(s){if(s instanceof r.e4)return w.fail(s.message);throw s}}}function b(t,e,n){let i=[];for(let r=0;r<t.childCount;r++){let s=t.child(r);s.content.size&&(s=s.copy(b(s.content,e,s))),s.isInline&&(s=e(s,n,r)),i.push(s)}return r.HY.fromArray(i)}class v extends y{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),i=n.node(n.sharedDepth(this.to)),s=new r.p2(b(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),i),e.openStart,e.openEnd);return w.fromReplace(t,this.from,this.to,s)}invert(){return new E(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new v(e.pos,n.pos,this.mark)}merge(t){return t instanceof v&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new v(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new v(e.from,e.to,t.markFromJSON(e.mark))}}y.jsonID("addMark",v);class E extends y{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new r.p2(b(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return w.fromReplace(t,this.from,this.to,n)}invert(){return new v(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new E(e.pos,n.pos,this.mark)}merge(t){return t instanceof E&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new E(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new E(e.from,e.to,t.markFromJSON(e.mark))}}y.jsonID("removeMark",E);class _ extends y{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return w.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return w.fromReplace(t,this.pos,this.pos+1,new r.p2(r.HY.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new _(this.pos,e.marks[n]);return new _(this.pos,this.mark)}}return new S(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new _(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new _(e.pos,t.markFromJSON(e.mark))}}y.jsonID("addNodeMark",_);class S extends y{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return w.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return w.fromReplace(t,this.pos,this.pos+1,new r.p2(r.HY.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new _(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new S(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new S(e.pos,t.markFromJSON(e.mark))}}y.jsonID("removeNodeMark",S);class A extends y{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&I(t,this.from,this.to)?w.fail("Structure replace would overwrite content"):w.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new p([this.from,this.to-this.from,this.slice.size])}invert(t){return new A(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new A(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof A)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?r.p2.empty:new r.p2(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new A(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?r.p2.empty:new r.p2(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new A(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new A(e.from,e.to,r.p2.fromJSON(t,e.slice),!!e.structure)}}y.jsonID("replace",A);class C extends y{constructor(t,e,n,r,i,s,o=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=s,this.structure=o}apply(t){if(this.structure&&(I(t,this.from,this.gapFrom)||I(t,this.gapTo,this.to)))return w.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return w.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?w.fromReplace(t,this.from,this.to,n):w.fail("Content does not fit in gap")}getMap(){return new p([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new C(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||i>n.pos?null:new C(e.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new C(e.from,e.to,e.gapFrom,e.gapTo,r.p2.fromJSON(t,e.slice),e.insert,!!e.structure)}}function I(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;while(i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount)s--,i--;if(i>0){let t=r.node(s).maybeChild(r.indexAfter(s));while(i>0){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}function T(t,e,n,r){let i,s,o=[],a=[];t.doc.nodesBetween(e,n,((t,c,l)=>{if(!t.isInline)return;let u=t.marks;if(!r.isInSet(u)&&l.type.allowsMarkType(r.type)){let l=Math.max(c,e),h=Math.min(c+t.nodeSize,n),d=r.addToSet(u);for(let t=0;t<u.length;t++)u[t].isInSet(d)||(i&&i.to==l&&i.mark.eq(u[t])?i.to=h:o.push(i=new E(l,h,u[t])));s&&s.to==l?s.to=h:a.push(s=new v(l,h,r))}})),o.forEach((e=>t.step(e))),a.forEach((e=>t.step(e)))}function k(t,e,n,i){let s=[],o=0;t.doc.nodesBetween(e,n,((t,a)=>{if(!t.isInline)return;o++;let c=null;if(i instanceof r.ZU){let e,n=t.marks;while(e=i.isInSet(n))(c||(c=[])).push(e),n=e.removeFromSet(n)}else i?i.isInSet(t.marks)&&(c=[i]):c=t.marks;if(c&&c.length){let r=Math.min(a+t.nodeSize,n);for(let t=0;t<c.length;t++){let n,i=c[t];for(let t=0;t<s.length;t++){let e=s[t];e.step==o-1&&i.eq(s[t].style)&&(n=e)}n?(n.to=r,n.step=o):s.push({style:i,from:Math.max(a,e),to:r,step:o})}}})),s.forEach((e=>t.step(new E(e.from,e.to,e.style))))}function R(t,e,n,i=n.contentMatch){let s=t.doc.nodeAt(e),o=[],a=e+1;for(let c=0;c<s.childCount;c++){let e=s.child(c),l=a+e.nodeSize,u=i.matchType(e.type);if(u){i=u;for(let r=0;r<e.marks.length;r++)n.allowsMarkType(e.marks[r].type)||t.step(new E(a,l,e.marks[r]))}else o.push(new A(a,l,r.p2.empty));a=l}if(!i.validEnd){let e=i.fillBefore(r.HY.empty,!0);t.replace(a,a,new r.p2(e,0,0))}for(let r=o.length-1;r>=0;r--)t.step(o[r])}function N(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function D(t){let e=t.parent,n=e.content.cutByIndex(t.startIndex,t.endIndex);for(let r=t.depth;;--r){let e=t.$from.node(r),i=t.$from.index(r),s=t.$to.indexAfter(r);if(r<t.depth&&e.canReplace(i,s,n))return r;if(0==r||e.type.spec.isolating||!N(e,i,s))break}return null}function O(t,e,n){let{$from:i,$to:s,depth:o}=e,a=i.before(o+1),c=s.after(o+1),l=a,u=c,h=r.HY.empty,d=0;for(let g=o,m=!1;g>n;g--)m||i.index(g)>0?(m=!0,h=r.HY.from(i.node(g).copy(h)),d++):l--;let f=r.HY.empty,p=0;for(let g=o,m=!1;g>n;g--)m||s.after(g+1)<s.end(g)?(m=!0,f=r.HY.from(s.node(g).copy(f)),p++):u++;t.step(new C(l,u,a,c,new r.p2(h.append(f),d,p),h.size-d,!0))}function P(t,e,n=null,r=t){let i=M(t,e),s=i&&L(r,e);return s?i.map(x).concat({type:e,attrs:n}).concat(s.map(x)):null}function x(t){return{type:t,attrs:null}}function M(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}function L(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let a=o.length?o[o.length-1]:e,c=a.contentMatch;for(let l=r;c&&l<i;l++)c=c.matchType(n.child(l).type);return c&&c.validEnd?o:null}function B(t,e,n){let i=r.HY.empty;for(let a=n.length-1;a>=0;a--){if(i.size){let t=n[a].type.contentMatch.matchFragment(i);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}i=r.HY.from(n[a].type.create(n[a].attrs,i))}let s=e.start,o=e.end;t.step(new C(s,o,s,o,new r.p2(i,0,0),n.length,!0))}function U(t,e,n,i,s){if(!i.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=t.steps.length;t.doc.nodesBetween(e,n,((e,n)=>{if(e.isTextblock&&!e.hasMarkup(i,s)&&F(t.doc,t.mapping.slice(o).map(n),i)){t.clearIncompatible(t.mapping.slice(o).map(n,1),i);let a=t.mapping.slice(o),c=a.map(n,1),l=a.map(n+e.nodeSize,1);return t.step(new C(c,l,c+1,l-1,new r.p2(r.HY.from(i.create(s,null,e.marks)),0,0),1,!0)),!1}}))}function F(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}function z(t,e,n,i,s){let o=t.doc.nodeAt(e);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let a=n.create(i,null,s||o.marks);if(o.isLeaf)return t.replaceWith(e,e+o.nodeSize,a);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new C(e,e+o.nodeSize,e+1,e+o.nodeSize-1,new r.p2(r.HY.from(a),0,0),1,!0))}function V(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let l=i.depth-1,u=n-2;l>s;l--,u--){let t=i.node(l),e=i.index(l);if(t.type.spec.isolating)return!1;let n=t.content.cutByIndex(e,t.childCount),s=r&&r[u]||t;if(s!=t&&(n=n.replaceChild(0,s.type.create(s.attrs))),!t.canReplace(e+1,t.childCount)||!s.type.validContent(n))return!1}let a=i.indexAfter(s),c=r&&r[0];return i.node(s).canReplaceWith(a,a,c?c.type:i.node(s+1).type)}function j(t,e,n=1,i){let s=t.doc.resolve(e),o=r.HY.empty,a=r.HY.empty;for(let c=s.depth,l=s.depth-n,u=n-1;c>l;c--,u--){o=r.HY.from(s.node(c).copy(o));let t=i&&i[u];a=r.HY.from(t?t.type.create(t.attrs,a):s.node(c).copy(a))}t.step(new A(e,e,new r.p2(o.append(a),n,n),!0))}function H(t,e){let n=t.resolve(e),r=n.index();return $(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function $(t,e){return!(!t||!e||t.isLeaf||!t.canAppend(e))}function K(t,e,n=-1){let r=t.resolve(e);for(let i=r.depth;;i--){let t,s,o=r.index(i);if(i==r.depth?(t=r.nodeBefore,s=r.nodeAfter):n>0?(t=r.node(i+1),o++,s=r.node(i).maybeChild(o)):(t=r.node(i).maybeChild(o-1),s=r.node(i+1)),t&&!t.isTextblock&&$(t,s)&&r.node(i).canReplace(o,o+1))return e;if(0==i)break;e=n<0?r.before(i):r.after(i)}}function G(t,e,n){let i=new A(e-n,e+n,r.p2.empty,!0);t.step(i)}function q(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(let i=r.depth-1;i>=0;i--){let t=r.index(i);if(r.node(i).canReplaceWith(t,t,n))return r.before(i+1);if(t>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let t=r.indexAfter(i);if(r.node(i).canReplaceWith(t,t,n))return r.after(i+1);if(t<r.node(i).childCount)return null}return null}function W(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(0==n.openStart&&n.size?2:1);s++)for(let t=r.depth;t>=0;t--){let e=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,n=r.index(t)+(e>0?1:0),o=r.node(t),a=!1;if(1==s)a=o.canReplace(n,n,i);else{let t=o.contentMatchAt(n).findWrapping(i.firstChild.type);a=t&&o.canReplaceWith(n,n,t[0])}if(a)return 0==e?r.pos:e<0?r.before(t+1):r.after(t+1)}return null}function Y(t,e,n=e,i=r.p2.empty){if(e==n&&!i.size)return null;let s=t.resolve(e),o=t.resolve(n);return X(s,o,i)?new A(e,n,i):new Q(s,o,i).fit()}function X(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}y.jsonID("replaceAround",C);class Q{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=r.HY.empty;for(let r=0;r<=t.depth;r++){let e=t.node(r);this.frontier.push({type:e.type,match:e.contentMatchAt(t.indexAfter(r))})}for(let i=t.depth;i>0;i--)this.placed=r.HY.from(t.node(i).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){while(this.unplaced.size){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,i=this.close(t<0?this.$to:n.doc.resolve(t));if(!i)return null;let s=this.placed,o=n.depth,a=i.depth;while(o&&a&&1==s.childCount)s=s.firstChild.content,o--,a--;let c=new r.p2(s,o,a);return t>-1?new C(n.pos,t,this.$to.pos,this.$to.end(),c,e):c.size||n.pos!=this.$to.pos?new A(n.pos,i.pos,c):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<t;n++){let i=e.firstChild;if(e.childCount>1&&(r=0),i.type.spec.isolating&&r<=n){t=n;break}e=i.content}for(let e=1;e<=2;e++)for(let n=1==e?t:this.unplaced.openStart;n>=0;n--){let t,i=null;n?(i=tt(this.unplaced.content,n-1).firstChild,t=i.content):t=this.unplaced.content;let s=t.firstChild;for(let o=this.depth;o>=0;o--){let t,{type:a,match:c}=this.frontier[o],l=null;if(1==e&&(s?c.matchType(s.type)||(l=c.fillBefore(r.HY.from(s),!1)):i&&a.compatibleContent(i.type)))return{sliceDepth:n,frontierDepth:o,parent:i,inject:l};if(2==e&&s&&(t=c.findWrapping(s.type)))return{sliceDepth:n,frontierDepth:o,parent:i,wrap:t};if(i&&c.matchType(i.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,i=tt(t,e);return!(!i.childCount||i.firstChild.isLeaf)&&(this.unplaced=new r.p2(t,e+1,Math.max(n,i.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,i=tt(t,e);if(i.childCount<=1&&e>0){let s=t.size-e<=e+i.size;this.unplaced=new r.p2(J(t,e-1,1),e-1,s?e-1:n)}else this.unplaced=new r.p2(J(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:i,wrap:s}){while(this.depth>e)this.closeFrontierNode();if(s)for(let r=0;r<s.length;r++)this.openFrontierNode(s[r]);let o=this.unplaced,a=n?n.content:o.content,c=o.openStart-t,l=0,u=[],{match:h,type:d}=this.frontier[e];if(i){for(let t=0;t<i.childCount;t++)u.push(i.child(t));h=h.matchFragment(i)}let f=a.size+t-(o.content.size-o.openEnd);while(l<a.childCount){let t=a.child(l),e=h.matchType(t.type);if(!e)break;l++,(l>1||0==c||t.content.size)&&(h=e,u.push(et(t.mark(d.allowedMarks(t.marks)),1==l?c:0,l==a.childCount?f:-1)))}let p=l==a.childCount;p||(f=-1),this.placed=Z(this.placed,e,r.HY.from(u)),this.frontier[e].match=h,p&&f<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let r=0,g=a;r<f;r++){let t=g.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),g=t.content}this.unplaced=p?0==t?r.p2.empty:new r.p2(J(o.content,t-1,1),t-1,f<0?o.openEnd:t-1):new r.p2(J(o.content,t,l),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,e=this.frontier[this.depth];if(!e.type.isTextblock||!nt(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);while(n>1&&r==this.$to.end(--n))++r;return r}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:r}=this.frontier[e],i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=nt(t,e,r,n,i);if(s){for(let n=e-1;n>=0;n--){let{match:e,type:r}=this.frontier[n],i=nt(t,n,r,e,!0);if(!i||i.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;while(this.depth>e.depth)this.closeFrontierNode();e.fit.childCount&&(this.placed=Z(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let e=t.node(n),r=e.type.contentMatch.fillBefore(e.content,!0,t.index(n));this.openFrontierNode(e.type,e.attrs,r)}return t}openFrontierNode(t,e=null,n){let i=this.frontier[this.depth];i.match=i.match.matchType(t),this.placed=Z(this.placed,this.depth,r.HY.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop(),e=t.match.fillBefore(r.HY.empty,!0);e.childCount&&(this.placed=Z(this.placed,this.frontier.length,e))}}function J(t,e,n){return 0==e?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(J(t.firstChild.content,e-1,n)))}function Z(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy(Z(t.lastChild.content,e-1,n)))}function tt(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function et(t,e,n){if(e<=0)return t;let i=t.content;return e>1&&(i=i.replaceChild(0,et(i.firstChild,e-1,1==i.childCount?n-1:0))),e>0&&(i=t.type.contentMatch.fillBefore(i).append(i),n<=0&&(i=i.append(t.type.contentMatch.matchFragment(i).fillBefore(r.HY.empty,!0)))),t.copy(i)}function nt(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!rt(n,s.content,o)?a:null}function rt(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}function it(t){return t.spec.defining||t.spec.definingForContent}function st(t,e,n,i){if(!i.size)return t.deleteRange(e,n);let s=t.doc.resolve(e),o=t.doc.resolve(n);if(X(s,o,i))return t.step(new A(e,n,i));let a=lt(s,t.doc.resolve(n));0==a[a.length-1]&&a.pop();let c=-(s.depth+1);a.unshift(c);for(let r=s.depth,f=s.pos-1;r>0;r--,f--){let t=s.node(r).type.spec;if(t.defining||t.definingAsContext||t.isolating)break;a.indexOf(r)>-1?c=r:s.before(r)==f&&a.splice(1,0,-r)}let l=a.indexOf(c),u=[],h=i.openStart;for(let r=i.content,f=0;;f++){let t=r.firstChild;if(u.push(t),f==i.openStart)break;r=t.content}for(let r=h-1;r>=0;r--){let t=u[r].type,e=it(t);if(e&&s.node(l).type!=t)h=r;else if(e||!t.isTextblock)break}for(let f=i.openStart;f>=0;f--){let e=(f+h+1)%(i.openStart+1),c=u[e];if(c)for(let u=0;u<a.length;u++){let h=a[(u+l)%a.length],d=!0;h<0&&(d=!1,h=-h);let f=s.node(h-1),p=s.index(h-1);if(f.canReplaceWith(p,p,c.type,c.marks))return t.replace(s.before(h),d?o.after(h):n,new r.p2(ot(i.content,0,i.openStart,e),e,i.openEnd))}}let d=t.steps.length;for(let r=a.length-1;r>=0;r--){if(t.replace(e,n,i),t.steps.length>d)break;let c=a[r];c<0||(e=s.before(c),n=o.after(c))}}function ot(t,e,n,i,s){if(e<n){let r=t.firstChild;t=t.replaceChild(0,r.copy(ot(r.content,e+1,n,i,r)))}if(e>i){let e=s.contentMatchAt(0),n=e.fillBefore(t).append(t);t=n.append(e.matchFragment(n).fillBefore(r.HY.empty,!0))}return t}function at(t,e,n,i){if(!i.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let r=q(t.doc,e,i.type);null!=r&&(e=n=r)}t.replaceRange(e,n,new r.p2(r.HY.from(i),0,0))}function ct(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=lt(r,i);for(let o=0;o<s.length;o++){let e=s[o],n=o==s.length-1;if(n&&0==e||r.node(e).type.contentMatch.validEnd)return t.delete(r.start(e),i.end(e));if(e>0&&(n||r.node(e-1).canReplace(r.index(e-1),i.indexAfter(e-1))))return t.delete(r.before(e),i.after(e))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o)return t.delete(r.before(o),n);t.delete(e,n)}function lt(t,e){let n=[],r=Math.min(t.depth,e.depth);for(let i=r;i>=0;i--){let r=t.start(i);if(r<t.pos-(t.depth-i)||e.end(i)>e.pos+(e.depth-i)||t.node(i).type.spec.isolating||e.node(i).type.spec.isolating)break;(r==e.start(i)||i==t.depth&&i==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&i&&e.start(i-1)==r-1)&&n.push(i)}return n}class ut extends y{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return w.fail("No node at attribute step's position");let n=Object.create(null);for(let r in e.attrs)n[r]=e.attrs[r];n[this.attr]=this.value;let i=e.type.create(n,null,e.marks);return w.fromReplace(t,this.pos,this.pos+1,new r.p2(r.HY.from(i),0,e.isLeaf?0:1))}getMap(){return p.empty}invert(t){return new ut(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new ut(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new ut(e.pos,e.attr,e.value)}}y.jsonID("attr",ut);let ht=class extends Error{};ht=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},ht.prototype=Object.create(Error.prototype),ht.prototype.constructor=ht,ht.prototype.name="TransformError";class dt{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new g}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new ht(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=r.p2.empty){let i=Y(this.doc,t,e,n);return i&&this.step(i),this}replaceWith(t,e,n){return this.replace(t,e,new r.p2(r.HY.from(n),0,0))}delete(t,e){return this.replace(t,e,r.p2.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return st(this,t,e,n),this}replaceRangeWith(t,e,n){return at(this,t,e,n),this}deleteRange(t,e){return ct(this,t,e),this}lift(t,e){return O(this,t,e),this}join(t,e=1){return G(this,t,e),this}wrap(t,e){return B(this,t,e),this}setBlockType(t,e=t,n,r=null){return U(this,t,e,n,r),this}setNodeMarkup(t,e,n=null,r){return z(this,t,e,n,r),this}setNodeAttribute(t,e,n){return this.step(new ut(t,e,n)),this}addNodeMark(t,e){return this.step(new _(t,e)),this}removeNodeMark(t,e){if(!(e instanceof r.vc)){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(e=e.isInSet(n.marks),!e)return this}return this.step(new S(t,e)),this}split(t,e=1,n){return j(this,t,e,n),this}addMark(t,e,n){return T(this,t,e,n),this}removeMark(t,e,n){return k(this,t,e,n),this}clearIncompatible(t,e,n){return R(this,t,e,n),this}}},1460:function(t,e,n){"use strict";n.d(e,{EH:function(){return In},p:function(){return Sn},tk:function(){return nr}});n(7658);var r=n(157),i=n(1543),s=n(1382);const o=function(t){for(var e=0;;e++)if(t=t.previousSibling,!t)return e},a=function(t){let e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e};let c=null;const l=function(t,e,n){let r=c||(c=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},u=function(t,e,n,r){return n&&(d(t,e,n,r,-1)||d(t,e,n,r,1))},h=/^(img|br|input|textarea|hr)$/i;function d(t,e,n,r,i){for(;;){if(t==n&&e==r)return!0;if(e==(i<0?0:f(t))){let n=t.parentNode;if(!n||1!=n.nodeType||g(t)||h.test(t.nodeName)||"false"==t.contentEditable)return!1;e=o(t)+(i<0?0:1),t=n}else{if(1!=t.nodeType)return!1;if(t=t.childNodes[e+(i<0?-1:0)],"false"==t.contentEditable)return!1;e=i<0?f(t):0}}}function f(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function p(t,e,n){for(let r=0==e,i=e==f(t);r||i;){if(t==n)return!0;let e=o(t);if(t=t.parentNode,!t)return!1;r=r&&0==e,i=i&&e==f(t)}}function g(t){let e;for(let n=t;n;n=n.parentNode)if(e=n.pmViewDesc)break;return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const m=function(t){return t.focusNode&&u(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function y(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}function w(t){let e=t.activeElement;while(e&&e.shadowRoot)e=e.shadowRoot.activeElement;return e}const b="undefined"!=typeof navigator?navigator:null,v="undefined"!=typeof document?document:null,E=b&&b.userAgent||"",_=/Edge\/(\d+)/.exec(E),S=/MSIE \d/.exec(E),A=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(E),C=!!(S||A||_),I=S?document.documentMode:A?+A[1]:_?+_[1]:0,T=!C&&/gecko\/(\d+)/i.test(E);T&&(/Firefox\/(\d+)/.exec(E)||[0,0])[1];const k=!C&&/Chrome\/(\d+)/.exec(E),R=!!k,N=k?+k[1]:0,D=!C&&!!b&&/Apple Computer/.test(b.vendor),O=D&&(/Mobile\/\w+/.test(E)||!!b&&b.maxTouchPoints>2),P=O||!!b&&/Mac/.test(b.platform),x=/Android \d/.test(E),M=!!v&&"webkitFontSmoothing"in v.documentElement.style,L=M?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function B(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function U(t,e){return"number"==typeof t?t:t[e]}function F(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function z(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;;o=a(o)){if(!o)break;if(1!=o.nodeType)continue;let t=o,n=t==s.body,a=n?B(s):F(t),c=0,l=0;if(e.top<a.top+U(r,"top")?l=-(a.top-e.top+U(i,"top")):e.bottom>a.bottom-U(r,"bottom")&&(l=e.bottom-a.bottom+U(i,"bottom")),e.left<a.left+U(r,"left")?c=-(a.left-e.left+U(i,"left")):e.right>a.right-U(r,"right")&&(c=e.right-a.right+U(i,"right")),c||l)if(n)s.defaultView.scrollBy(c,l);else{let n=t.scrollLeft,r=t.scrollTop;l&&(t.scrollTop+=l),c&&(t.scrollLeft+=c);let i=t.scrollLeft-n,s=t.scrollTop-r;e={left:e.left-i,top:e.top-s,right:e.right-i,bottom:e.bottom-s}}if(n)break}}function V(t){let e,n,r=t.dom.getBoundingClientRect(),i=Math.max(0,r.top);for(let s=(r.left+r.right)/2,o=i+1;o<Math.min(innerHeight,r.bottom);o+=5){let r=t.root.elementFromPoint(s,o);if(!r||r==t.dom||!t.dom.contains(r))continue;let a=r.getBoundingClientRect();if(a.top>=i-20){e=r,n=a.top;break}}return{refDOM:e,refTop:n,stack:j(t.dom)}}function j(t){let e=[],n=t.ownerDocument;for(let r=t;r;r=a(r))if(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t==n)break;return e}function H({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;$(n,0==r?0:r-e)}function $(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let K=null;function G(t){if(t.setActive)return t.setActive();if(K)return t.focus(K);let e=j(t);t.focus(null==K?{get preventScroll(){return K={preventScroll:!0},!0}}:void 0),K||(K=!1,$(e,0))}function q(t,e){let n,r,i=2e8,s=0,o=e.top,a=e.top;for(let c=t.firstChild,u=0;c;c=c.nextSibling,u++){let t;if(1==c.nodeType)t=c.getClientRects();else{if(3!=c.nodeType)continue;t=l(c).getClientRects()}for(let l=0;l<t.length;l++){let h=t[l];if(h.top<=o&&h.bottom>=a){o=Math.max(h.bottom,o),a=Math.min(h.top,a);let t=h.left>e.left?h.left-e.left:h.right<e.left?e.left-h.right:0;if(t<i){n=c,i=t,r=t&&3==n.nodeType?{left:h.right<e.left?h.right:h.left,top:e.top}:e,1==c.nodeType&&t&&(s=u+(e.left>=(h.left+h.right)/2?1:0));continue}}!n&&(e.left>=h.right&&e.top>=h.top||e.left>=h.left&&e.top>=h.bottom)&&(s=u+1)}}return n&&3==n.nodeType?W(n,r):!n||i&&1==n.nodeType?{node:t,offset:s}:q(n,r)}function W(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let n=et(r,1);if(n.top!=n.bottom&&Y(e,n))return{node:t,offset:i+(e.left>=(n.left+n.right)/2?1:0)}}return{node:t,offset:0}}function Y(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function X(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}function Q(t,e,n){let{node:r,offset:i}=q(e,n),s=-1;if(1==r.nodeType&&!r.firstChild){let t=r.getBoundingClientRect();s=t.left!=t.right&&n.left>(t.left+t.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}function J(t,e,n,r){let i=-1;for(let s=e,o=!1;;){if(s==t.dom)break;let e=t.docView.nearestDesc(s,!0);if(!e)return null;if(1==e.dom.nodeType&&(e.node.isBlock&&e.parent&&!o||!e.contentDOM)){let t=e.dom.getBoundingClientRect();if(e.node.isBlock&&e.parent&&!o&&(o=!0,t.left>r.left||t.top>r.top?i=e.posBefore:(t.right<r.left||t.bottom<r.top)&&(i=e.posAfter)),!e.contentDOM&&i<0){let n=e.node.isBlock?r.top<(t.top+t.bottom)/2:r.left<(t.left+t.right)/2;return n?e.posBefore:e.posAfter}}s=e.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}function Z(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let n=t.childNodes[s];if(1==n.nodeType){let t=n.getClientRects();for(let r=0;r<t.length;r++){let i=t[r];if(Y(e,i))return Z(n,e,i)}}if((s=(s+1)%r)==i)break}return t}function tt(t,e){let n,r=t.dom.ownerDocument,i=0;if(r.caretPositionFromPoint)try{let t=r.caretPositionFromPoint(e.left,e.top);t&&({offsetNode:n,offset:i}=t)}catch(l){}if(!n&&r.caretRangeFromPoint){let t=r.caretRangeFromPoint(e.left,e.top);t&&({startContainer:n,startOffset:i}=t)}let s,o=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top);if(!o||!t.dom.contains(1!=o.nodeType?o.parentNode:o)){let n=t.dom.getBoundingClientRect();if(!Y(e,n))return null;if(o=Z(t.dom,e,n),!o)return null}if(D)for(let u=o;n&&u;u=a(u))u.draggable&&(n=void 0);if(o=X(o,e),n){if(T&&1==n.nodeType&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let t,r=n.childNodes[i];"IMG"==r.nodeName&&(t=r.getBoundingClientRect()).right<=e.left&&t.bottom>e.top&&i++}n==t.dom&&i==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?s=t.state.doc.content.size:0!=i&&1==n.nodeType&&"BR"==n.childNodes[i-1].nodeName||(s=J(t,n,i,e))}null==s&&(s=Q(t,o,e));let c=t.docView.nearestDesc(o,!0);return{pos:s,inside:c?c.posAtStart-c.border:-1}}function et(t,e){let n=t.getClientRects();return n.length?n[e<0?0:n.length-1]:t.getBoundingClientRect()}const nt=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function rt(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=M||T;if(3==r.nodeType){if(!o||!nt.test(r.nodeValue)&&(n<0?i:i!=r.nodeValue.length)){let t=i,e=i,s=n<0?1:-1;return n<0&&!i?(e++,s=-1):n>=0&&i==r.nodeValue.length?(t--,s=1):n<0?t--:e++,it(et(l(r,t,e),1),s<0)}{let t=et(l(r,i,i),n);if(T&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let e=et(l(r,i-1,i-1),-1);if(e.top==t.top){let n=et(l(r,i,i+1),-1);if(n.top!=t.top)return it(n,n.left<e.left)}}return t}}let a=t.state.doc.resolve(e-(s||0));if(!a.parent.inlineContent){if(null==s&&i&&(n<0||i==f(r))){let t=r.childNodes[i-1];if(1==t.nodeType)return st(t.getBoundingClientRect(),!1)}if(null==s&&i<f(r)){let t=r.childNodes[i];if(1==t.nodeType)return st(t.getBoundingClientRect(),!0)}return st(r.getBoundingClientRect(),n>=0)}if(null==s&&i&&(n<0||i==f(r))){let t=r.childNodes[i-1],e=3==t.nodeType?l(t,f(t)-(o?0:1)):1!=t.nodeType||"BR"==t.nodeName&&t.nextSibling?null:t;if(e)return it(et(e,1),!1)}if(null==s&&i<f(r)){let t=r.childNodes[i];while(t.pmViewDesc&&t.pmViewDesc.ignoreForCoords)t=t.nextSibling;let e=t?3==t.nodeType?l(t,0,o?0:1):1==t.nodeType?t:null:null;if(e)return it(et(e,-1),!0)}return it(et(3==r.nodeType?l(r):r,-n),n>=0)}function it(t,e){if(0==t.width)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function st(t,e){if(0==t.height)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function ot(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}function at(t,e,n){let r=e.selection,i="up"==n?r.$from:r.$to;return ot(t,e,(()=>{let{node:e}=t.docView.domFromPos(i.pos,"up"==n?-1:1);for(;;){let n=t.docView.nearestDesc(e,!0);if(!n)break;if(n.node.isBlock){e=n.contentDOM||n.dom;break}e=n.dom.parentNode}let r=rt(t,i.pos,1);for(let t=e.firstChild;t;t=t.nextSibling){let e;if(1==t.nodeType)e=t.getClientRects();else{if(3!=t.nodeType)continue;e=l(t,0,t.nodeValue.length).getClientRects()}for(let t=0;t<e.length;t++){let i=e[t];if(i.bottom>i.top+1&&("up"==n?r.top-i.top>2*(i.bottom-r.top):i.bottom-r.bottom>2*(r.bottom-i.top)))return!1}}return!0}))}const ct=/[\u0590-\u08ac]/;function lt(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return ct.test(r.parent.textContent)&&a.modify?ot(t,e,(()=>{let{focusNode:e,focusOffset:i,anchorNode:s,anchorOffset:o}=t.domSelectionRange(),c=a.caretBidiLevel;a.modify("move",n,"character");let l=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:u,focusOffset:h}=t.domSelectionRange(),d=u&&!l.contains(1==u.nodeType?u:u.parentNode)||e==u&&i==h;try{a.collapse(s,o),e&&(e!=s||i!=o)&&a.extend&&a.extend(e,i)}catch(f){}return null!=c&&(a.caretBidiLevel=c),d})):"left"==n||"backward"==n?s:o}let ut=null,ht=null,dt=!1;function ft(t,e,n){return ut==e&&ht==n?dt:(ut=e,ht=n,dt="up"==n||"down"==n?at(t,e,n):lt(t,e,n))}const pt=0,gt=1,mt=2,yt=3;class wt{constructor(t,e,n,r){this.parent=t,this.children=e,this.dom=n,this.contentDOM=r,this.dirty=pt,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let r=this.children[e];if(r==t)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){let n,r;if(t==this.contentDOM)n=t.childNodes[e-1];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;n=t.previousSibling}while(n&&(!(r=n.pmViewDesc)||r.parent!=this))n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}{let n,r;if(t==this.contentDOM)n=t.childNodes[e];else{while(t.parentNode!=this.contentDOM)t=t.parentNode;n=t.nextSibling}while(n&&(!(r=n.pmViewDesc)||r.parent!=this))n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}}let r;if(t==this.dom&&this.contentDOM)r=e>o(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(let e=t;;e=e.parentNode){if(e==this.dom){r=!1;break}if(e.previousSibling)break}if(null==r&&e==t.childNodes.length)for(let e=t;;e=e.parentNode){if(e==this.dom){r=!0;break}if(e.nextSibling)break}}return(null==r?n>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,r=t;r;r=r.parentNode){let i,s=this.getDesc(r);if(s&&(!e||s.node)){if(!n||!(i=s.nodeDOM)||(1==i.nodeType?i.contains(1==t.nodeType?t:t.parentNode):i==t))return s;n=!1}}}getDesc(t){let e=t.pmViewDesc;for(let n=e;n;n=n.parent)if(n==this)return e}posFromDOM(t,e,n){for(let r=t;r;r=r.parentNode){let i=this.getDesc(r);if(i)return i.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let r=this.children[e],i=n+r.size;if(n==t&&i!=n){while(!r.border&&r.children.length)r=r.children[0];return r}if(t<i)return r.descAt(t-n-r.border);n=i}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,r=0;for(let i=0;n<this.children.length;n++){let e=this.children[n],s=i+e.size;if(s>t||e instanceof Ct){r=t-i;break}i=s}if(r)return this.children[n].domFromPos(r-this.children[n].border,e);for(let i;n&&!(i=this.children[n-1]).size&&i instanceof bt&&i.side>=0;n--);if(e<=0){let t,r=!0;for(;;n--,r=!1)if(t=n?this.children[n-1]:null,!t||t.dom.parentNode==this.contentDOM)break;return t&&e&&r&&!t.border&&!t.domAtom?t.domFromPos(t.size,e):{node:this.contentDOM,offset:t?o(t.dom)+1:0}}{let t,r=!0;for(;;n++,r=!1)if(t=n<this.children.length?this.children[n]:null,!t||t.dom.parentNode==this.contentDOM)break;return t&&r&&!t.border&&!t.domAtom?t.domFromPos(0,e):{node:this.contentDOM,offset:t?o(t.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,i=-1;for(let s=n,a=0;;a++){let n=this.children[a],c=s+n.size;if(-1==r&&t<=c){let i=s+n.border;if(t>=i&&e<=c-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(t,e,i);t=s;for(let e=a;e>0;e--){let n=this.children[e-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=o(n.dom)+1;break}t-=n.size}-1==r&&(r=0)}if(r>-1&&(c>e||a==this.children.length-1)){e=c;for(let t=a+1;t<this.children.length;t++){let n=this.children[t];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){i=o(n.dom);break}e+=n.size}-1==i&&(i=this.contentDOM.childNodes.length);break}s=c}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:i}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(1!=e.nodeType||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,r=!1){let i=Math.min(t,e),s=Math.max(t,e);for(let o=0,u=0;o<this.children.length;o++){let a=this.children[o],c=u+a.size;if(i>u&&s<c)return a.setSelection(t-u-a.border,e-u-a.border,n,r);u=c}let a=this.domFromPos(t,t?-1:1),c=e==t?a:this.domFromPos(e,e?-1:1),l=n.getSelection(),h=!1;if((T||D)&&t==e){let{node:t,offset:e}=a;if(3==t.nodeType){if(h=!(!e||"\n"!=t.nodeValue[e-1]),h&&e==t.nodeValue.length)for(let n,r=t;r;r=r.parentNode){if(n=r.nextSibling){"BR"==n.nodeName&&(a=c={node:n.parentNode,offset:o(n)+1});break}let t=r.pmViewDesc;if(t&&t.node&&t.node.isBlock)break}}else{let n=t.childNodes[e-1];h=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(T&&l.focusNode&&l.focusNode!=c.node&&1==l.focusNode.nodeType){let t=l.focusNode.childNodes[l.focusOffset];t&&"false"==t.contentEditable&&(r=!0)}if(!(r||h&&D)&&u(a.node,a.offset,l.anchorNode,l.anchorOffset)&&u(c.node,c.offset,l.focusNode,l.focusOffset))return;let d=!1;if((l.extend||t==e)&&!h){l.collapse(a.node,a.offset);try{t!=e&&l.extend(c.node,c.offset),d=!0}catch(f){}}if(!d){if(t>e){let t=a;a=c,c=t}let n=document.createRange();n.setEnd(c.node,c.offset),n.setStart(a.node,a.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(t){return!this.contentDOM&&"selection"!=t.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,r=0;r<this.children.length;r++){let i=this.children[r],s=n+i.size;if(n==s?t<=s&&e>=n:t<s&&e>n){let r=n+i.border,o=s-i.border;if(t>=r&&e<=o)return this.dirty=t==n||e==s?mt:gt,void(t!=r||e!=o||!i.contentLost&&i.dom.parentNode==this.contentDOM?i.markDirty(t-r,e-r):i.dirty=yt);i.dirty=i.dom!=i.contentDOM||i.dom.parentNode!=this.contentDOM||i.children.length?yt:mt}n=s}this.dirty=mt}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=1==t?mt:gt;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class bt extends wt{constructor(t,e,n,r){let i,s=e.type.toDOM;if("function"==typeof s&&(s=s(n,(()=>i?i.parent?i.parent.posBeforeChild(i):void 0:r))),!e.type.spec.raw){if(1!=s.nodeType){let t=document.createElement("span");t.appendChild(s),s=t}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(t,[],s,null),this.widget=e,this.widget=e,i=this}matchesWidget(t){return this.dirty==pt&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return!!e&&e(t)}ignoreMutation(t){return"selection"!=t.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class vt extends wt{constructor(t,e,n,r){super(t,[],e,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue}}class Et extends wt{constructor(t,e,n,r){super(t,[],n,r),this.mark=e}static create(t,e,n,r){let s=r.nodeViews[e.type.name],o=s&&s(e,r,n);return o&&o.dom||(o=i.PW.renderSpec(document,e.type.spec.toDOM(e,n))),new Et(t,e,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&yt||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(t){return this.dirty!=yt&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),this.dirty!=pt){let t=this.parent;while(!t.node)t=t.parent;t.dirty<this.dirty&&(t.dirty=this.dirty),this.dirty=pt}}slice(t,e,n){let r=Et.create(this.parent,this.mark,!0,n),i=this.children,s=this.size;e<s&&(i=Ht(i,e,s,n)),t>0&&(i=Ht(i,0,t,n));for(let o=0;o<i.length;o++)i[o].parent=r;return r.children=i,r}}class _t extends wt{constructor(t,e,n,r,i,s,o,a,c){super(t,[],i,s),this.node=e,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=o,s&&this.updateChildren(a,c)}static create(t,e,n,r,s,o){let a,c=s.nodeViews[e.type.name],l=c&&c(e,s,(()=>a?a.parent?a.parent.posBeforeChild(a):void 0:o),n,r),u=l&&l.dom,h=l&&l.contentDOM;if(e.isText)if(u){if(3!=u.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else u=document.createTextNode(e.text);else u||({dom:u,contentDOM:h}=i.PW.renderSpec(document,e.type.spec.toDOM(e)));h||e.isText||"BR"==u.nodeName||(u.hasAttribute("contenteditable")||(u.contentEditable="false"),e.type.spec.draggable&&(u.draggable=!0));let d=u;return u=Pt(u,n,e),l?a=new It(t,e,n,r,u,h||null,d,l,s,o+1):e.isText?new At(t,e,n,r,u,d,s):new _t(t,e,n,r,u,h||null,d,s,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(t.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>i.HY.empty)}else t.contentElement=this.contentDOM;else t.getContent=()=>this.node.content;return t}matchesNode(t,e,n){return this.dirty==pt&&t.eq(this.node)&&xt(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,r=e,s=t.composing?this.localCompositionInfo(t,e):null,o=s&&s.pos>-1?s:null,a=s&&s.pos<0,c=new Lt(this,o&&o.node,t);Ft(this.node,this.innerDeco,((e,s,o)=>{e.spec.marks?c.syncToMarks(e.spec.marks,n,t):e.type.side>=0&&!o&&c.syncToMarks(s==this.node.childCount?i.vc.none:this.node.child(s).marks,n,t),c.placeWidget(e,t,r)}),((e,i,o,l)=>{let u;c.syncToMarks(e.marks,n,t),c.findNodeMatch(e,i,o,l)||a&&t.state.selection.from>r&&t.state.selection.to<r+e.nodeSize&&(u=c.findIndexWithChild(s.node))>-1&&c.updateNodeAt(e,i,o,u,t)||c.updateNextNode(e,i,o,t,l)||c.addNode(e,i,o,t,r),r+=e.nodeSize})),c.syncToMarks([],n,t),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==mt)&&(o&&this.protectLocalComposition(t,o),Tt(this.contentDOM,this.children,t),O&&zt(this.dom))}localCompositionInfo(t,e){let{from:n,to:i}=t.state.selection;if(!(t.state.selection instanceof r.Bs)||n<e||i>e+this.node.content.size)return null;let s=t.domSelectionRange(),o=Vt(s.focusNode,s.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let t=o.nodeValue,r=jt(this.node.content,t,n-e,i-e);return r<0?null:{node:o,pos:r,text:t}}return{node:o,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:r}){if(this.getDesc(e))return;let i=e;for(;;i=i.parentNode){if(i.parentNode==this.contentDOM)break;while(i.previousSibling)i.parentNode.removeChild(i.previousSibling);while(i.nextSibling)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let s=new vt(this,i,e,r);t.input.compositionNodes.push(s),this.children=Ht(this.children,n,n+r.length,t,s)}update(t,e,n,r){return!(this.dirty==yt||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)}updateInner(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=pt}updateOuterDeco(t){if(xt(t,this.outerDeco))return;let e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=Dt(this.dom,this.nodeDOM,Nt(this.outerDeco,this.node,e),Nt(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function St(t,e,n,r,i){return Pt(r,e,t),new _t(void 0,t,e,n,r,r,r,i,0)}class At extends _t{constructor(t,e,n,r,i,s,o){super(t,e,n,r,i,null,s,o,0)}parseRule(){let t=this.nodeDOM.parentNode;while(t&&t!=this.dom&&!t.pmIsDeco)t=t.parentNode;return{skip:t||!0}}update(t,e,n,r){return!(this.dirty==yt||this.dirty!=pt&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),this.dirty==pt&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=pt,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return"characterData"!=t.type&&"selection"!=t.type}slice(t,e,n){let r=this.node.cut(t,e),i=document.createTextNode(r.text);return new At(this.parent,r,this.outerDeco,this.innerDeco,i,i,n)}markDirty(t,e){super.markDirty(t,e),this.dom==this.nodeDOM||0!=t&&e!=this.nodeDOM.nodeValue.length||(this.dirty=yt)}get domAtom(){return!1}}class Ct extends wt{parseRule(){return{ignore:!0}}matchesHack(t){return this.dirty==pt&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class It extends _t{constructor(t,e,n,r,i,s,o,a,c,l){super(t,e,n,r,i,s,o,c,l),this.spec=a}update(t,e,n,r){if(this.dirty==yt)return!1;if(this.spec.update){let i=this.spec.update(t,e,n);return i&&this.updateInner(t,e,n,r),i}return!(!this.contentDOM&&!t.isLeaf)&&super.update(t,e,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,r){this.spec.setSelection?this.spec.setSelection(t,e,n):super.setSelection(t,e,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function Tt(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){while(a!=r)r=Mt(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof Et){let e=r?r.previousSibling:t.lastChild;Tt(o.contentDOM,o.children,n),r=e?e.nextSibling:t.firstChild}}while(r)r=Mt(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const kt=function(t){t&&(this.nodeName=t)};kt.prototype=Object.create(null);const Rt=[new kt];function Nt(t,e,n){if(0==t.length)return Rt;let r=n?Rt[0]:new kt,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new kt(o.nodeName));for(let t in o){let s=o[t];null!=s&&(n&&1==i.length&&i.push(r=new kt(e.isInline?"span":"div")),"class"==t?r.class=(r.class?r.class+" ":"")+s:"style"==t?r.style=(r.style?r.style+";":"")+s:"nodeName"!=t&&(r[t]=s))}}}return i}function Dt(t,e,n,r){if(n==Rt&&r==Rt)return e;let i=e;for(let s=0;s<r.length;s++){let e=r[s],o=n[s];if(s){let n;o&&o.nodeName==e.nodeName&&i!=t&&(n=i.parentNode)&&n.nodeName.toLowerCase()==e.nodeName||(n=document.createElement(e.nodeName),n.pmIsDeco=!0,n.appendChild(i),o=Rt[0]),i=n}Ot(i,o||Rt[0],e)}return i}function Ot(t,e,n){for(let r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let e=0;e<r.length;e++)-1==i.indexOf(r[e])&&t.classList.remove(r[e]);for(let e=0;e<i.length;e++)-1==r.indexOf(i[e])&&t.classList.add(i[e]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let n,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;while(n=r.exec(e.style))t.style.removeProperty(n[1])}n.style&&(t.style.cssText+=n.style)}}function Pt(t,e,n){return Dt(t,t,Rt,Nt(e,n,1!=t.nodeType))}function xt(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function Mt(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class Lt{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=Bt(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let r=0,i=this.stack.length>>1,s=Math.min(i,t.length);while(r<s&&(r==i-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning)r++;while(r<i)this.destroyRest(),this.top.dirty=pt,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;while(i<t.length){this.stack.push(this.top,this.index+1);let r=-1;for(let e=this.index;e<Math.min(this.index+3,this.top.children.length);e++){let n=this.top.children[e];if(n.matchesMark(t[i])&&!this.isLocked(n.dom)){r=e;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=Et.create(this.top,t[i],e,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,i++}}findNodeMatch(t,e,n,r){let i,s=-1;if(r>=this.preMatch.index&&(i=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&i.matchesNode(t,e,n))s=this.top.children.indexOf(i,this.index);else for(let o=this.index,a=Math.min(this.top.children.length,o+5);o<a;o++){let r=this.top.children[o];if(r.matchesNode(t,e,n)&&!this.preMatch.matched.has(r)){s=o;break}}return!(s<0)&&(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(t,e,n,r,i){let s=this.top.children[r];return s.dirty==yt&&s.dom==s.contentDOM&&(s.dirty=mt),!!s.update(t,e,n,i)&&(this.destroyBetween(this.index,r),this.index++,!0)}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let e=t.pmViewDesc;if(e)for(let t=this.index;t<this.top.children.length;t++)if(this.top.children[t]==e)return t;return-1}t=e}}updateNextNode(t,e,n,r,i){for(let s=this.index;s<this.top.children.length;s++){let o=this.top.children[s];if(o instanceof _t){let a=this.preMatch.matched.get(o);if(null!=a&&a!=i)return!1;let c=o.dom,l=this.isLocked(c)&&!(t.isText&&o.node&&o.node.isText&&o.nodeDOM.nodeValue==t.text&&o.dirty!=yt&&xt(e,o.outerDeco));if(!l&&o.update(t,e,n,r))return this.destroyBetween(this.index,s),o.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(t,e,n,r,i){this.top.children.splice(this.index++,0,_t.create(this.top,t,e,n,r,i)),this.changed=!0}placeWidget(t,e,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){let r=new bt(this.top,t,e,n);this.top.children.splice(this.index++,0,r),this.changed=!0}else this.index++}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;while(t instanceof Et)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof At)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((D||R)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);"IMG"==t&&(n.className="ProseMirror-separator",n.alt=""),"BR"==t&&(n.className="ProseMirror-trailingBreak");let r=new Ct(this.top,[],n,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||1==t.nodeType&&t.contains(this.lock.parentNode))}}function Bt(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];t:while(i>0){let a;for(;;)if(r){let t=n.children[r-1];if(!(t instanceof Et)){a=t,r--;break}n=t,r=t.children.length}else{if(n==e)break t;r=n.parent.children.indexOf(n),n=n.parent}let c=a.node;if(c){if(c!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}function Ut(t,e){return t.type.side-e.type.side}function Ft(t,e,n,r){let i=e.locals(t),s=0;if(0==i.length){for(let n=0;n<t.childCount;n++){let o=t.child(n);r(o,i,e.forChild(s,o),n),s+=o.nodeSize}return}let o=0,a=[],c=null;for(let l=0;;){if(o<i.length&&i[o].to==s){let t,e=i[o++];while(o<i.length&&i[o].to==s)(t||(t=[e])).push(i[o++]);if(t){t.sort(Ut);for(let e=0;e<t.length;e++)n(t[e],l,!!c)}else n(e,l,!!c)}let u,h;if(c)h=-1,u=c,c=null;else{if(!(l<t.childCount))break;h=l,u=t.child(l++)}for(let t=0;t<a.length;t++)a[t].to<=s&&a.splice(t--,1);while(o<i.length&&i[o].from<=s&&i[o].to>s)a.push(i[o++]);let d=s+u.nodeSize;if(u.isText){let t=d;o<i.length&&i[o].from<t&&(t=i[o].from);for(let e=0;e<a.length;e++)a[e].to<t&&(t=a[e].to);t<d&&(c=u.cut(t-s),u=u.cut(0,t-s),d=t,h=-1)}let f=u.isInline&&!u.isLeaf?a.filter((t=>!t.inline)):a.slice();r(u,f,e.forChild(s,u),h),s=d}}function zt(t){if("UL"==t.nodeName||"OL"==t.nodeName){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}function Vt(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];t=t.childNodes[e-1],e=f(t)}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}function jt(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let c=o.text;while(i<t.childCount){let e=t.child(i++);if(s+=e.nodeSize,!e.isText)break;c+=e.text}if(s>=n){let t=a<r?c.lastIndexOf(e,r-a-1):-1;if(t>=0&&t+e.length+a>=n)return a+t;if(n==r&&c.length>=r+e.length-a&&c.slice(r-a,r-a+e.length)==e)return r}}return-1}function Ht(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let c=t[o],l=a,u=a+=c.size;l>=n||u<=e?s.push(c):(l<e&&s.push(c.slice(0,e-l,r)),i&&(s.push(i),i=void 0),u>n&&s.push(c.slice(n-l,c.size,r)))}return s}function $t(t,e=null){let n=t.domSelectionRange(),i=t.state.doc;if(!n.focusNode)return null;let s=t.docView.nearestDesc(n.focusNode),o=s&&0==s.size,a=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(a<0)return null;let c,l,u=i.resolve(a);if(m(n)){c=u;while(s&&!s.node)s=s.parent;let t=s.node;if(s&&t.isAtom&&r.qv.isSelectable(t)&&s.parent&&(!t.isInline||!p(n.focusNode,n.focusOffset,s.dom))){let t=s.posBefore;l=new r.qv(a==t?u:i.resolve(t))}}else{let e=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(e<0)return null;c=i.resolve(e)}if(!l){let n="pointer"==e||t.state.selection.head<u.pos&&!o?1:-1;l=ee(t,c,u,n)}return l}function Kt(t){return t.editable?t.hasFocus():re(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function Gt(t,e=!1){let n=t.state.selection;if(Zt(t,n),Kt(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&R){let e=t.domSelectionRange(),n=t.domObserver.currentSelection;if(e.anchorNode&&n.anchorNode&&u(e.anchorNode,e.anchorOffset,n.anchorNode,n.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)Jt(t);else{let i,s,{anchor:o,head:a}=n;!qt||n instanceof r.Bs||(n.$from.parent.inlineContent||(i=Wt(t,n.from)),n.empty||n.$from.parent.inlineContent||(s=Wt(t,n.to))),t.docView.setSelection(o,a,t.root,e),qt&&(i&&Xt(i),s&&Xt(s)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Qt(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const qt=D||R&&N<63;function Wt(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(D&&i&&"false"==i.contentEditable)return Yt(i);if((!i||"false"==i.contentEditable)&&(!s||"false"==s.contentEditable)){if(i)return Yt(i);if(s)return Yt(s)}}function Yt(t){return t.contentEditable="true",D&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function Xt(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function Qt(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{n.anchorNode==r&&n.anchorOffset==i||(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout((()=>{Kt(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")}),20))})}function Jt(t){let e=t.domSelection(),n=document.createRange(),r=t.cursorWrapper.dom,i="IMG"==r.nodeName;i?n.setEnd(r.parentNode,o(r)+1):n.setEnd(r,0),n.collapse(!1),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&C&&I<=11&&(r.disabled=!0,r.disabled=!1)}function Zt(t,e){if(e instanceof r.qv){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(te(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else te(t)}function te(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function ee(t,e,n,i){return t.someProp("createSelectionBetween",(r=>r(t,e,n)))||r.Bs.between(e,n,i)}function ne(t){return!(t.editable&&!t.hasFocus())&&re(t)}function re(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function ie(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return u(e.node,e.offset,n.anchorNode,n.anchorOffset)}function se(t,e){let{$anchor:n,$head:i}=t.selection,s=e>0?n.max(i):n.min(i),o=s.parent.inlineContent?s.depth?t.doc.resolve(e>0?s.after():s.before()):null:s;return o&&r.Y1.findFrom(o,e)}function oe(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function ae(t,e,n){let i=t.state.selection;if(!(i instanceof r.Bs)){if(i instanceof r.qv&&i.node.isInline)return oe(t,new r.Bs(e>0?i.$to:i.$from));{let n=se(t.state,e);return!!n&&oe(t,n)}}if(!i.empty||n.indexOf("s")>-1)return!1;if(t.endOfTextblock(e>0?"right":"left")){let n=se(t.state,e);return!!(n&&n instanceof r.qv)&&oe(t,n)}if(!(P&&n.indexOf("m")>-1)){let n,s=i.$head,o=s.textOffset?null:e<0?s.nodeBefore:s.nodeAfter;if(!o||o.isText)return!1;let a=e<0?s.pos-o.nodeSize:s.pos;return!!(o.isAtom||(n=t.docView.descAt(a))&&!n.contentDOM)&&(r.qv.isSelectable(o)?oe(t,new r.qv(e<0?t.state.doc.resolve(s.pos-o.nodeSize):s)):!!M&&oe(t,new r.Bs(t.state.doc.resolve(e<0?a:a+o.nodeSize))))}}function ce(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function le(t){let e=t.pmViewDesc;return e&&0==e.size&&(t.nextSibling||"BR"!=t.nodeName)}function ue(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,a=!1;for(T&&1==n.nodeType&&r<ce(n)&&le(n.childNodes[r])&&(a=!0);;)if(r>0){if(1!=n.nodeType)break;{let t=n.childNodes[r-1];if(le(t))i=n,s=--r;else{if(3!=t.nodeType)break;n=t,r=n.nodeValue.length}}}else{if(de(n))break;{let e=n.previousSibling;while(e&&le(e))i=n.parentNode,s=o(e),e=e.previousSibling;if(e)n=e,r=ce(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}a?fe(t,n,r):i&&fe(t,i,s)}function he(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,a=ce(n);for(;;)if(r<a){if(1!=n.nodeType)break;let t=n.childNodes[r];if(!le(t))break;i=n,s=++r}else{if(de(n))break;{let e=n.nextSibling;while(e&&le(e))i=e.parentNode,s=o(e)+1,e=e.nextSibling;if(e)n=e,r=0,a=ce(n);else{if(n=n.parentNode,n==t.dom)break;r=a=0}}}i&&fe(t,i,s)}function de(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function fe(t,e,n){let r=t.domSelection();if(m(r)){let t=document.createRange();t.setEnd(e,n),t.setStart(e,n),r.removeAllRanges(),r.addRange(t)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout((()=>{t.state==i&&Gt(t)}),50)}function pe(t,e,n){let i=t.state.selection;if(i instanceof r.Bs&&!i.empty||n.indexOf("s")>-1)return!1;if(P&&n.indexOf("m")>-1)return!1;let{$from:s,$to:o}=i;if(!s.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let n=se(t.state,e);if(n&&n instanceof r.qv)return oe(t,n)}if(!s.parent.inlineContent){let n=e<0?s:o,a=i instanceof r.C1?r.Y1.near(n,e):r.Y1.findFrom(n,e);return!!a&&oe(t,a)}return!1}function ge(t,e){if(!(t.state.selection instanceof r.Bs))return!0;let{$head:n,$anchor:i,empty:s}=t.state.selection;if(!n.sameParent(i))return!0;if(!s)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let o=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let r=t.state.tr;return e<0?r.delete(n.pos-o.nodeSize,n.pos):r.delete(n.pos,n.pos+o.nodeSize),t.dispatch(r),!0}return!1}function me(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function ye(t){if(!D||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let n=e.firstChild;me(t,n,"true"),setTimeout((()=>me(t,n,"false")),20)}return!1}function we(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}function be(t,e){let n=e.keyCode,r=we(e);return 8==n||P&&72==n&&"c"==r?ge(t,-1)||ue(t):46==n||P&&68==n&&"c"==r?ge(t,1)||he(t):13==n||27==n||(37==n||P&&66==n&&"c"==r?ae(t,-1,r)||ue(t):39==n||P&&70==n&&"c"==r?ae(t,1,r)||he(t):38==n||P&&80==n&&"c"==r?pe(t,-1,r)||ue(t):40==n||P&&78==n&&"c"==r?ye(t)||pe(t,1,r)||he(t):r==(P?"m":"c")&&(66==n||73==n||89==n||90==n))}function ve(t,e){t.someProp("transformCopied",(n=>{e=n(e,t)}));let n=[],{content:r,openStart:s,openEnd:o}=e;while(s>1&&o>1&&1==r.childCount&&1==r.firstChild.childCount){s--,o--;let t=r.firstChild;n.push(t.type.name,t.attrs!=t.type.defaultAttrs?t.attrs:null),r=t.content}let a=t.someProp("clipboardSerializer")||i.PW.fromSchema(t.state.schema),c=De(),l=c.createElement("div");l.appendChild(a.serializeFragment(r,{document:c}));let u,h=l.firstChild,d=0;while(h&&1==h.nodeType&&(u=Re[h.nodeName.toLowerCase()])){for(let t=u.length-1;t>=0;t--){let e=c.createElement(u[t]);while(l.firstChild)e.appendChild(l.firstChild);l.appendChild(e),d++}h=l.firstChild}h&&1==h.nodeType&&h.setAttribute("data-pm-slice",`${s} ${o}${d?` -${d}`:""} ${JSON.stringify(n)}`);let f=t.someProp("clipboardTextSerializer",(n=>n(e,t)))||e.content.textBetween(0,e.content.size,"\n\n");return{dom:l,text:f}}function Ee(t,e,n,r,s){let o,a,c=s.parent.type.spec.code;if(!n&&!e)return null;let l=e&&(r||c||!n);if(l){if(t.someProp("transformPastedText",(n=>{e=n(e,c||r,t)})),c)return e?new i.p2(i.HY.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):i.p2.empty;let n=t.someProp("clipboardTextParser",(n=>n(e,s,r,t)));if(n)a=n;else{let n=s.marks(),{schema:r}=t.state,a=i.PW.fromSchema(r);o=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach((t=>{let e=o.appendChild(document.createElement("p"));t&&e.appendChild(a.serializeNode(r.text(t,n)))}))}}else t.someProp("transformPastedHTML",(e=>{n=e(n,t)})),o=Oe(n),M&&Pe(o);let u=o&&o.querySelector("[data-pm-slice]"),h=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let i=+h[3];i>0;i--){let t=o.firstChild;while(t&&1!=t.nodeType)t=t.nextSibling;if(!t)break;o=t}if(!a){let e=t.someProp("clipboardParser")||t.someProp("domParser")||i.aw.fromSchema(t.state.schema);a=e.parseSlice(o,{preserveWhitespace:!(!l&&!h),context:s,ruleFromNode(t){return"BR"!=t.nodeName||t.nextSibling||!t.parentNode||_e.test(t.parentNode.nodeName)?null:{ignore:!0}}})}if(h)a=xe(ke(a,+h[1],+h[2]),h[4]);else if(a=i.p2.maxOpen(Se(a.content,s),!0),a.openStart||a.openEnd){let t=0,e=0;for(let n=a.content.firstChild;t<a.openStart&&!n.type.spec.isolating;t++,n=n.firstChild);for(let n=a.content.lastChild;e<a.openEnd&&!n.type.spec.isolating;e++,n=n.lastChild);a=ke(a,t,e)}return t.someProp("transformPasted",(e=>{a=e(a,t)})),a}const _e=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function Se(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let r,s=e.node(n),o=s.contentMatchAt(e.index(n)),a=[];if(t.forEach((t=>{if(!a)return;let e,n=o.findWrapping(t.type);if(!n)return a=null;if(e=a.length&&r.length&&Ce(n,r,t,a[a.length-1],0))a[a.length-1]=e;else{a.length&&(a[a.length-1]=Ie(a[a.length-1],r.length));let e=Ae(t,n);a.push(e),o=o.matchType(e.type),r=n}})),a)return i.HY.from(a)}return t}function Ae(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,i.HY.from(t));return t}function Ce(t,e,n,r,s){if(s<t.length&&s<e.length&&t[s]==e[s]){let o=Ce(t,e,n,r.lastChild,s+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));let a=r.contentMatchAt(r.childCount);if(a.matchType(s==t.length-1?n.type:t[s+1]))return r.copy(r.content.append(i.HY.from(Ae(n,t,s+1))))}}function Ie(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,Ie(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(i.HY.empty,!0);return t.copy(n.append(r))}function Te(t,e,n,r,s,o){let a=e<0?t.firstChild:t.lastChild,c=a.content;return s<r-1&&(c=Te(c,e,n,r,s+1,o)),s>=n&&(c=e<0?a.contentMatchAt(0).fillBefore(c,t.childCount>1||o<=s).append(c):c.append(a.contentMatchAt(a.childCount).fillBefore(i.HY.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,a.copy(c))}function ke(t,e,n){return e<t.openStart&&(t=new i.p2(Te(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new i.p2(Te(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const Re={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ne=null;function De(){return Ne||(Ne=document.implementation.createHTMLDocument("title"))}function Oe(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n,r=De().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(t);if((n=i&&Re[i[1].toLowerCase()])&&(t=n.map((t=>"<"+t+">")).join("")+t+n.map((t=>"</"+t+">")).reverse().join("")),r.innerHTML=t,n)for(let s=0;s<n.length;s++)r=r.querySelector(n[s])||r;return r}function Pe(t){let e=t.querySelectorAll(R?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];1==r.childNodes.length&&" "==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}function xe(t,e){if(!t.size)return t;let n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(c){return t}let{content:s,openStart:o,openEnd:a}=t;for(let l=n.length-2;l>=0;l-=2){let t=r.nodes[n[l]];if(!t||t.hasRequiredAttrs())break;s=i.HY.from(t.create(n[l+1],s)),o++,a++}return new i.p2(s,o,a)}const Me={},Le={},Be={touchstart:!0,touchmove:!0};class Ue{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Fe(t){for(let e in Me){let n=Me[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=e=>{!$e(t,e)||He(t,e)||!t.editable&&e.type in Le||n(t,e)},Be[e]?{passive:!0}:void 0)}D&&t.dom.addEventListener("input",(()=>null)),je(t)}function ze(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function Ve(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}function je(t){t.someProp("handleDOMEvents",(e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=e=>He(t,e))}))}function He(t,e){return t.someProp("handleDOMEvents",(n=>{let r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)}))}function $e(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function Ke(t,e){He(t,e)||!Me[e.type]||!t.editable&&e.type in Le||Me[e.type](t,e)}function Ge(t){return{left:t.clientX,top:t.clientY}}function qe(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}function We(t,e,n,r,i){if(-1==r)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,(e=>o>s.depth?e(t,n,s.nodeAfter,s.before(o),i,!0):e(t,n,s.node(o),s.before(o),i,!1))))return!0;return!1}function Ye(t,e,n){t.focused||t.focus();let r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function Xe(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),i=n.nodeAfter;return!!(i&&i.isAtom&&r.qv.isSelectable(i))&&(Ye(t,new r.qv(n),"pointer"),!0)}function Qe(t,e){if(-1==e)return!1;let n,i,s=t.state.selection;s instanceof r.qv&&(n=s.node);let o=t.state.doc.resolve(e);for(let a=o.depth+1;a>0;a--){let t=a>o.depth?o.nodeAfter:o.node(a);if(r.qv.isSelectable(t)){i=n&&s.$from.depth>0&&a>=s.$from.depth&&o.before(s.$from.depth+1)==s.$from.pos?o.before(s.$from.depth):o.before(a);break}}return null!=i&&(Ye(t,r.qv.create(t.state.doc,i),"pointer"),!0)}function Je(t,e,n,r,i){return We(t,"handleClickOn",e,n,r)||t.someProp("handleClick",(n=>n(t,e,r)))||(i?Qe(t,n):Xe(t,n))}function Ze(t,e,n,r){return We(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",(n=>n(t,e,r)))}function tn(t,e,n,r){return We(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",(n=>n(t,e,r)))||en(t,n,r)}function en(t,e,n){if(0!=n.button)return!1;let i=t.state.doc;if(-1==e)return!!i.inlineContent&&(Ye(t,r.Bs.create(i,0,i.content.size),"pointer"),!0);let s=i.resolve(e);for(let o=s.depth+1;o>0;o--){let e=o>s.depth?s.nodeAfter:s.node(o),n=s.before(o);if(e.inlineContent)Ye(t,r.Bs.create(i,n+1,n+1+e.content.size),"pointer");else{if(!r.qv.isSelectable(e))continue;Ye(t,r.qv.create(i,n),"pointer")}return!0}}function nn(t){return hn(t)}Le.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!on(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!x||!R||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!O||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",(e=>e(t,n)))||be(t,n)?n.preventDefault():ze(t,"key");else{let e=Date.now();t.input.lastIOSEnter=e,t.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{t.input.lastIOSEnter==e&&(t.someProp("handleKeyDown",(e=>e(t,y(13,"Enter")))),t.input.lastIOSEnter=0)}),200)}},Le.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},Le.keypress=(t,e)=>{let n=e;if(on(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||P&&n.metaKey)return;if(t.someProp("handleKeyPress",(e=>e(t,n))))return void n.preventDefault();let i=t.state.selection;if(!(i instanceof r.Bs)||!i.$from.sameParent(i.$to)){let e=String.fromCharCode(n.charCode);/[\r\n]/.test(e)||t.someProp("handleTextInput",(n=>n(t,i.$from.pos,i.$to.pos,e)))||t.dispatch(t.state.tr.insertText(e).scrollIntoView()),n.preventDefault()}};const rn=P?"metaKey":"ctrlKey";Me.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=nn(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&qe(n,t.input.lastClick)&&!n[rn]&&("singleClick"==t.input.lastClick.type?s="doubleClick":"doubleClick"==t.input.lastClick.type&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s};let o=t.posAtCoords(Ge(n));o&&("singleClick"==s?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new sn(t,o,n,!!r)):("doubleClick"==s?Ze:tn)(t,o.pos,o.inside,n)?n.preventDefault():ze(t,"pointer"))};class sn{constructor(t,e,n,i){let s,o;if(this.view=t,this.pos=e,this.event=n,this.flushed=i,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[rn],this.allowDefault=n.shiftKey,e.inside>-1)s=t.state.doc.nodeAt(e.inside),o=e.inside;else{let n=t.state.doc.resolve(e.pos);s=n.parent,o=n.depth?n.before():0}const a=i?null:n.target,c=a?t.docView.nearestDesc(a,!0):null;this.target=c?c.dom:null;let{selection:l}=t.state;(0==n.button&&s.type.spec.draggable&&!1!==s.type.spec.selectable||l instanceof r.qv&&l.from<=o&&l.to>o)&&(this.mightDrag={node:s,pos:o,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!T||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),ze(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>Gt(this.view))),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(Ge(t))),this.updateAllowDefault(t),this.allowDefault||!e?ze(this.view,"pointer"):Je(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||D&&this.mightDrag&&!this.mightDrag.node.isAtom||R&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(Ye(this.view,r.Y1.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):ze(this.view,"pointer")}move(t){this.updateAllowDefault(t),ze(this.view,"pointer"),0==t.buttons&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}function on(t,e){return!!t.composing||!!(D&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}Me.touchstart=t=>{t.input.lastTouch=Date.now(),nn(t),ze(t,"pointer")},Me.touchmove=t=>{t.input.lastTouch=Date.now(),ze(t,"pointer")},Me.contextmenu=t=>nn(t);const an=x?5e3:-1;function cn(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout((()=>hn(t)),e))}function ln(t){t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=un());while(t.input.compositionNodes.length>0)t.input.compositionNodes.pop().markParentsDirty()}function un(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}function hn(t,e=!1){if(!(x&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),ln(t),e||t.docView&&t.docView.dirty){let e=$t(t);return e&&!e.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(e)):t.updateState(t.state),!0}return!1}}function dn(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()}),50)}Le.compositionstart=Le.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((t=>!1===t.type.spec.inclusive))))t.markCursor=t.state.storedMarks||n.marks(),hn(t,!0),t.markCursor=null;else if(hn(t),T&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let e=t.domSelectionRange();for(let n=e.focusNode,r=e.focusOffset;n&&1==n.nodeType&&0!=r;){let e=r<0?n.lastChild:n.childNodes[r-1];if(!e)break;if(3==e.nodeType){t.domSelection().collapse(e,e.nodeValue.length);break}n=e,r=-1}}t.input.composing=!0}cn(t,an)},Le.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,cn(t,20))};const fn=C&&I<15||O&&L<604;function pn(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}function gn(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout((()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?mn(t,r.value,null,t.input.shiftKey,e):mn(t,r.textContent,r.innerHTML,t.input.shiftKey,e)}),50)}function mn(t,e,n,r,s){let o=Ee(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",(e=>e(t,s,o||i.p2.empty))))return!0;if(!o)return!1;let a=pn(o),c=a?t.state.tr.replaceSelectionWith(a,t.input.shiftKey):t.state.tr.replaceSelection(o);return t.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Me.copy=Le.cut=(t,e)=>{let n=e,r=t.state.selection,i="cut"==n.type;if(r.empty)return;let s=fn?null:n.clipboardData,o=r.content(),{dom:a,text:c}=ve(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",c)):dn(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Le.paste=(t,e)=>{let n=e;if(t.composing&&!x)return;let r=fn?null:n.clipboardData;r&&mn(t,r.getData("text/plain"),r.getData("text/html"),t.input.shiftKey,n)?n.preventDefault():gn(t,n)};class yn{constructor(t,e){this.slice=t,this.move=e}}const wn=P?"altKey":"ctrlKey";Me.dragstart=(t,e)=>{let n=e,i=t.input.mouseDown;if(i&&i.done(),!n.dataTransfer)return;let s=t.state.selection,o=s.empty?null:t.posAtCoords(Ge(n));if(o&&o.pos>=s.from&&o.pos<=(s instanceof r.qv?s.to-1:s.to));else if(i&&i.mightDrag)t.dispatch(t.state.tr.setSelection(r.qv.create(t.state.doc,i.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let e=t.docView.nearestDesc(n.target,!0);e&&e.node.type.spec.draggable&&e!=t.docView&&t.dispatch(t.state.tr.setSelection(r.qv.create(t.state.doc,e.posBefore)))}let a=t.state.selection.content(),{dom:c,text:l}=ve(t,a);n.dataTransfer.clearData(),n.dataTransfer.setData(fn?"Text":"text/html",c.innerHTML),n.dataTransfer.effectAllowed="copyMove",fn||n.dataTransfer.setData("text/plain",l),t.dragging=new yn(a,!n[wn])},Me.dragend=t=>{let e=t.dragging;window.setTimeout((()=>{t.dragging==e&&(t.dragging=null)}),50)},Le.dragover=Le.dragenter=(t,e)=>e.preventDefault(),Le.drop=(t,e)=>{let n=e,o=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let a=t.posAtCoords(Ge(n));if(!a)return;let c=t.state.doc.resolve(a.pos),l=o&&o.slice;l?t.someProp("transformPasted",(e=>{l=e(l,t)})):l=Ee(t,n.dataTransfer.getData(fn?"Text":"text/plain"),fn?null:n.dataTransfer.getData("text/html"),!1,c);let u=!(!o||n[wn]);if(t.someProp("handleDrop",(e=>e(t,n,l||i.p2.empty,u))))return void n.preventDefault();if(!l)return;n.preventDefault();let h=l?(0,s.nj)(t.state.doc,c.pos,l):c.pos;null==h&&(h=c.pos);let d=t.state.tr;u&&d.deleteSelection();let f=d.mapping.map(h),p=0==l.openStart&&0==l.openEnd&&1==l.content.childCount,g=d.doc;if(p?d.replaceRangeWith(f,f,l.content.firstChild):d.replaceRange(f,f,l),d.doc.eq(g))return;let m=d.doc.resolve(f);if(p&&r.qv.isSelectable(l.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(l.content.firstChild))d.setSelection(new r.qv(m));else{let e=d.mapping.map(h);d.mapping.maps[d.mapping.maps.length-1].forEach(((t,n,r,i)=>e=i)),d.setSelection(ee(t,m,d.doc.resolve(e)))}t.focus(),t.dispatch(d.setMeta("uiEvent","drop"))},Me.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout((()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&Gt(t)}),20))},Me.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},Me.beforeinput=(t,e)=>{let n=e;if(R&&x&&"deleteContentBackward"==n.inputType){t.domObserver.flushSoon();let{domChangeCount:e}=t.input;setTimeout((()=>{if(t.input.domChangeCount!=e)return;if(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",(e=>e(t,y(8,"Backspace")))))return;let{$cursor:n}=t.state.selection;n&&n.pos>0&&t.dispatch(t.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let ur in Le)Me[ur]=Le[ur];function bn(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class vn{constructor(t,e){this.toDOM=t,this.spec=e||Cn,this.side=this.spec.side||0}map(t,e,n,r){let{pos:i,deleted:s}=t.mapResult(e.from+r,this.side<0?-1:1);return s?null:new Sn(i-n,i-n,this)}valid(){return!0}eq(t){return this==t||t instanceof vn&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&bn(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class En{constructor(t,e){this.attrs=t,this.spec=e||Cn}map(t,e,n,r){let i=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,s=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return i>=s?null:new Sn(i,s,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof En&&bn(this.attrs,t.attrs)&&bn(this.spec,t.spec)}static is(t){return t.type instanceof En}destroy(){}}class _n{constructor(t,e){this.attrs=t,this.spec=e||Cn}map(t,e,n,r){let i=t.mapResult(e.from+r,1);if(i.deleted)return null;let s=t.mapResult(e.to+r,-1);return s.deleted||s.pos<=i.pos?null:new Sn(i.pos-n,s.pos-n,this)}valid(t,e){let n,{index:r,offset:i}=t.content.findIndex(e.from);return i==e.from&&!(n=t.child(r)).isText&&i+n.nodeSize==e.to}eq(t){return this==t||t instanceof _n&&bn(this.attrs,t.attrs)&&bn(this.spec,t.spec)}destroy(){}}class Sn{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new Sn(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new Sn(t,t,new vn(e,n))}static inline(t,e,n,r){return new Sn(t,e,new En(n,r))}static node(t,e,n,r){return new Sn(t,e,new _n(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof En}}const An=[],Cn={};class In{constructor(t,e){this.local=t.length?t:An,this.children=e.length?e:An}static create(t,e){return e.length?xn(e,t,0,Cn):Tn}find(t,e,n){let r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r}findInner(t,e,n,r,i){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=e&&o.to>=t&&(!i||i(o.spec))&&n.push(o.copy(o.from+r,o.to+r))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){let o=this.children[s]+1;this.children[s+2].findInner(t-o,e-o,n,r+o,i)}}map(t,e,n){return this==Tn||0==t.maps.length?this:this.mapInner(t,e,0,0,n||Cn)}mapInner(t,e,n,r,i){let s;for(let o=0;o<this.local.length;o++){let a=this.local[o].map(t,n,r);a&&a.type.valid(e,a)?(s||(s=[])).push(a):i.onRemove&&i.onRemove(this.local[o].spec)}return this.children.length?Rn(this.children,s||[],t,e,n,r,i):s?new In(s.sort(Mn),An):Tn}add(t,e){return e.length?this==Tn?In.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let r,i=0;t.forEach(((t,s)=>{let o,a=s+n;if(o=On(e,t,a)){r||(r=this.children.slice());while(i<r.length&&r[i]<s)i+=3;r[i]==s?r[i+2]=r[i+2].addInner(t,o,a+1):r.splice(i,0,s,s+t.nodeSize,xn(o,t,a+1,Cn)),i+=3}}));let s=Nn(i?Pn(e):e,-n);for(let o=0;o<s.length;o++)s[o].type.valid(t,s[o])||s.splice(o--,1);return new In(s.length?this.local.concat(s).sort(Mn):this.local,r||this.children)}remove(t){return 0==t.length||this==Tn?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,r=this.local;for(let i=0;i<n.length;i+=3){let r,s=n[i]+e,o=n[i+1]+e;for(let e,n=0;n<t.length;n++)(e=t[n])&&e.from>s&&e.to<o&&(t[n]=null,(r||(r=[])).push(e));if(!r)continue;n==this.children&&(n=this.children.slice());let a=n[i+2].removeInner(r,s+1);a!=Tn?n[i+2]=a:(n.splice(i,3),i-=3)}if(r.length)for(let i,s=0;s<t.length;s++)if(i=t[s])for(let t=0;t<r.length;t++)r[t].eq(i,e)&&(r==this.local&&(r=this.local.slice()),r.splice(t--,1));return n==this.children&&r==this.local?this:r.length||n.length?new In(r,n):Tn}forChild(t,e){if(this==Tn)return this;if(e.isLeaf)return In.empty;let n,r;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(n=this.children[o+2]);break}let i=t+1,s=i+e.content.size;for(let o=0;o<this.local.length;o++){let t=this.local[o];if(t.from<s&&t.to>i&&t.type instanceof En){let e=Math.max(i,t.from)-i,n=Math.min(s,t.to)-i;e<n&&(r||(r=[])).push(t.copy(e,n))}}if(r){let t=new In(r.sort(Mn),An);return n?new kn([t,n]):t}return n||Tn}eq(t){if(this==t)return!0;if(!(t instanceof In)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return Ln(this.localsInner(t))}localsInner(t){if(this==Tn)return An;if(t.inlineContent||!this.local.some(En.is))return this.local;let e=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof En||e.push(this.local[n]);return e}}In.empty=new In([],[]),In.removeOverlap=Ln;const Tn=In.empty;class kn{constructor(t){this.members=t}map(t,e){const n=this.members.map((n=>n.map(t,e,Cn)));return kn.from(n)}forChild(t,e){if(e.isLeaf)return In.empty;let n=[];for(let r=0;r<this.members.length;r++){let i=this.members[r].forChild(t,e);i!=Tn&&(i instanceof kn?n=n.concat(i.members):n.push(i))}return kn.from(n)}eq(t){if(!(t instanceof kn)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let r=0;r<this.members.length;r++){let i=this.members[r].localsInner(t);if(i.length)if(e){n&&(e=e.slice(),n=!1);for(let t=0;t<i.length;t++)e.push(i[t])}else e=i}return e?Ln(n?e:e.sort(Mn)):An}static from(t){switch(t.length){case 0:return Tn;case 1:return t[0];default:return new kn(t.every((t=>t instanceof In))?t:t.reduce(((t,e)=>t.concat(e instanceof In?e:e.members)),[]))}}}function Rn(t,e,n,r,i,s,o){let a=t.slice();for(let l=0,u=s;l<n.maps.length;l++){let t=0;n.maps[l].forEach(((e,n,r,s)=>{let o=s-r-(n-e);for(let c=0;c<a.length;c+=3){let s=a[c+1];if(s<0||e>s+u-t)continue;let l=a[c]+u-t;n>=l?a[c+1]=e<=l?-2:-1:r>=i&&o&&(a[c]+=o,a[c+1]+=o)}t+=o})),u=n.maps[l].map(u,-1)}let c=!1;for(let l=0;l<a.length;l+=3)if(a[l+1]<0){if(-2==a[l+1]){c=!0,a[l+1]=-1;continue}let e=n.map(t[l]+s),u=e-i;if(u<0||u>=r.content.size){c=!0;continue}let h=n.map(t[l+1]+s,-1),d=h-i,{index:f,offset:p}=r.content.findIndex(u),g=r.maybeChild(f);if(g&&p==u&&p+g.nodeSize==d){let r=a[l+2].mapInner(n,g,e+1,t[l]+s+1,o);r!=Tn?(a[l]=u,a[l+1]=d,a[l+2]=r):(a[l+1]=-2,c=!0)}else c=!0}if(c){let c=Dn(a,t,e,n,i,s,o),l=xn(c,r,0,o);e=l.local;for(let t=0;t<a.length;t+=3)a[t+1]<0&&(a.splice(t,3),t-=3);for(let t=0,e=0;t<l.children.length;t+=3){let n=l.children[t];while(e<a.length&&a[e]<n)e+=3;a.splice(e,0,l.children[t],l.children[t+1],l.children[t+2])}}return new In(e.sort(Mn),a)}function Nn(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new Sn(i.from+e,i.to+e,i.type))}return n}function Dn(t,e,n,r,i,s,o){function a(t,e){for(let s=0;s<t.local.length;s++){let a=t.local[s].map(r,i,e);a?n.push(a):o.onRemove&&o.onRemove(t.local[s].spec)}for(let n=0;n<t.children.length;n+=3)a(t.children[n+2],t.children[n]+e+1)}for(let c=0;c<t.length;c+=3)-1==t[c+1]&&a(t[c+2],e[c]+s+1);return n}function On(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s,o=0;o<t.length;o++)(s=t[o])&&s.from>n&&s.to<r&&((i||(i=[])).push(s),t[o]=null);return i}function Pn(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function xn(t,e,n,r){let i=[],s=!1;e.forEach(((e,o)=>{let a=On(t,e,o+n);if(a){s=!0;let t=xn(a,e,n+o+1,r);t!=Tn&&i.push(o,o+e.nodeSize,t)}}));let o=Nn(s?Pn(t):t,-n).sort(Mn);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new In(o,i):Tn}function Mn(t,e){return t.from-e.from||t.to-e.to}function Ln(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from!=r.from){s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),Bn(e,i,r.copy(s.from,r.to)));break}s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),Bn(e,i+1,s.copy(r.to,s.to)))}}return e}function Bn(t,e,n){while(e<t.length&&Mn(n,t[e])>0)e++;t.splice(e,0,n)}function Un(t){let e=[];return t.someProp("decorations",(n=>{let r=n(t.state);r&&r!=Tn&&e.push(r)})),t.cursorWrapper&&e.push(In.create(t.state.doc,[t.cursorWrapper.deco])),kn.from(e)}const Fn={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},zn=C&&I<=11;class Vn{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class jn{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new Vn,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((t=>{for(let e=0;e<t.length;e++)this.queue.push(t[e]);C&&I<=11&&t.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),zn&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Fn)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(ne(this.view)){if(this.suppressingSelectionUpdates)return Gt(this.view);if(C&&I<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&u(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e,n=new Set;for(let i=t.focusNode;i;i=a(i))n.add(i);for(let i=t.anchorNode;i;i=a(i))if(n.has(i)){e=i;break}let r=e&&this.view.docView.nearestDesc(e);return r&&r.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.observer?this.observer.takeRecords():[];this.queue.length&&(e=this.queue.concat(e),this.queue.length=0);let n=t.domSelectionRange(),i=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&ne(t)&&!this.ignoreSelectionChange(n),s=-1,o=-1,a=!1,c=[];if(t.editable)for(let r=0;r<e.length;r++){let t=this.registerMutation(e[r],c);t&&(s=s<0?t.from:Math.min(t.from,s),o=o<0?t.to:Math.max(t.to,o),t.typeOver&&(a=!0))}if(T&&c.length>1){let t=c.filter((t=>"BR"==t.nodeName));if(2==t.length){let e=t[0],n=t[1];e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}}let l=null;s<0&&i&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&m(n)&&(l=$t(t))&&l.eq(r.Y1.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,Gt(t),this.currentSelection.set(n),t.scrollToSelection()):(s>-1||i)&&(s>-1&&(t.docView.markDirty(s,o),Kn(t)),this.handleDOMChange(s,o,a,c),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||Gt(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(let n=0;n<t.addedNodes.length;n++)e.push(t.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let r=t.previousSibling,i=t.nextSibling;if(C&&I<=11&&t.addedNodes.length)for(let e=0;e<t.addedNodes.length;e++){let{previousSibling:n,nextSibling:s}=t.addedNodes[e];(!n||Array.prototype.indexOf.call(t.addedNodes,n)<0)&&(r=n),(!s||Array.prototype.indexOf.call(t.addedNodes,s)<0)&&(i=s)}let s=r&&r.parentNode==t.target?o(r)+1:0,a=n.localPosFromDOM(t.target,s,-1),c=i&&i.parentNode==t.target?o(i):t.target.childNodes.length,l=n.localPosFromDOM(t.target,c,1);return{from:a,to:l}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}}}let Hn=new WeakMap,$n=!1;function Kn(t){if(!Hn.has(t)&&(Hn.set(t,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace))){if(t.requiresGeckoHackNode=T,$n)return;console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),$n=!0}}function Gn(t){let e;function n(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0);let r=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return u(a.node,a.offset,s,o)&&([r,i,s,o]=[s,o,r,i]),{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}}function qn(t,e,n){let r,{node:s,fromOffset:o,toOffset:a,from:c,to:l}=t.docView.parseRange(e,n),u=t.domSelectionRange(),h=u.anchorNode;if(h&&t.dom.contains(1==h.nodeType?h:h.parentNode)&&(r=[{node:h,offset:u.anchorOffset}],m(u)||r.push({node:u.focusNode,offset:u.focusOffset})),R&&8===t.input.lastKeyCode)for(let i=a;i>o;i--){let t=s.childNodes[i-1],e=t.pmViewDesc;if("BR"==t.nodeName&&!e){a=i;break}if(!e||e.size)break}let d=t.state.doc,f=t.someProp("domParser")||i.aw.fromSchema(t.state.schema),p=d.resolve(c),g=null,y=f.parse(s,{topNode:p.parent,topMatch:p.parent.contentMatchAt(p.index()),topOpen:!0,from:o,to:a,preserveWhitespace:"pre"!=p.parent.type.whitespace||"full",findPositions:r,ruleFromNode:Wn,context:p});if(r&&null!=r[0].pos){let t=r[0].pos,e=r[1]&&r[1].pos;null==e&&(e=t),g={anchor:t+c,head:e+c}}return{doc:y,sel:g,from:c,to:l}}function Wn(t){let e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(D&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}if(t.parentNode.lastChild==t||D&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Yn=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Xn(t,e,n,i,s){if(e<0){let e=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,n=$t(t,e);if(n&&!t.state.selection.eq(n)){if(R&&x&&13===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",(e=>e(t,y(13,"Enter")))))return;let r=t.state.tr.setSelection(n);"pointer"==e?r.setMeta("pointer",!0):"key"==e&&r.scrollIntoView(),t.dispatch(r)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let c,l,u=t.state.selection,h=qn(t,e,n),d=t.state.doc,f=d.slice(h.from,h.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(c=t.state.selection.to,l="end"):(c=t.state.selection.from,l="start"),t.input.lastKeyCode=null;let p=er(f.content,h.doc.content,h.from,c,l);if((O&&t.input.lastIOSEnter>Date.now()-225||x)&&s.some((t=>1==t.nodeType&&!Yn.test(t.nodeName)))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",(e=>e(t,y(13,"Enter")))))return void(t.input.lastIOSEnter=0);if(!p){if(!(i&&u instanceof r.Bs&&!u.empty&&u.$head.sameParent(u.$anchor))||t.composing||h.sel&&h.sel.anchor!=h.sel.head){if(h.sel){let e=Qn(t,t.state.doc,h.sel);e&&!e.eq(t.state.selection)&&t.dispatch(t.state.tr.setSelection(e))}return}p={start:u.from,endA:u.to,endB:u.to}}if(R&&t.cursorWrapper&&h.sel&&h.sel.anchor==t.cursorWrapper.deco.from&&h.sel.head==h.sel.anchor){let t=p.endB-p.start;h.sel={anchor:h.sel.anchor+t,head:h.sel.anchor+t}}t.input.domChangeCount++,t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof r.Bs&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=h.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=h.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),C&&I<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>h.from&&"  "==h.doc.textBetween(p.start-h.from-1,p.start-h.from+1)&&(p.start--,p.endA--,p.endB--);let g,m=h.doc.resolveNoCache(p.start-h.from),w=h.doc.resolveNoCache(p.endB-h.from),b=d.resolve(p.start),v=m.sameParent(w)&&m.parent.inlineContent&&b.end()>=p.endA;if((O&&t.input.lastIOSEnter>Date.now()-225&&(!v||s.some((t=>"DIV"==t.nodeName||"P"==t.nodeName)))||!v&&m.pos<h.doc.content.size&&(g=r.Y1.findFrom(h.doc.resolve(m.pos+1),1,!0))&&g.head==w.pos)&&t.someProp("handleKeyDown",(e=>e(t,y(13,"Enter")))))return void(t.input.lastIOSEnter=0);if(t.state.selection.anchor>p.start&&Zn(d,p.start,p.endA,m,w)&&t.someProp("handleKeyDown",(e=>e(t,y(8,"Backspace")))))return void(x&&R&&t.domObserver.suppressSelectionUpdates());R&&x&&p.endB==p.start&&(t.input.lastAndroidDelete=Date.now()),x&&!v&&m.start()!=w.start()&&0==w.parentOffset&&m.depth==w.depth&&h.sel&&h.sel.anchor==h.sel.head&&h.sel.head==p.endA&&(p.endB-=2,w=h.doc.resolveNoCache(p.endB-h.from),setTimeout((()=>{t.someProp("handleKeyDown",(function(e){return e(t,y(13,"Enter"))}))}),20));let E,_,S,A=p.start,T=p.endA;if(v)if(m.pos==w.pos)C&&I<=11&&0==m.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout((()=>Gt(t)),20)),E=t.state.tr.delete(A,T),_=d.resolve(p.start).marksAcross(d.resolve(p.endA));else if(p.endA==p.endB&&(S=Jn(m.parent.content.cut(m.parentOffset,w.parentOffset),b.parent.content.cut(b.parentOffset,p.endA-b.start()))))E=t.state.tr,"add"==S.type?E.addMark(A,T,S.mark):E.removeMark(A,T,S.mark);else if(m.parent.child(m.index()).isText&&m.index()==w.index()-(w.textOffset?0:1)){let e=m.parent.textBetween(m.parentOffset,w.parentOffset);if(t.someProp("handleTextInput",(n=>n(t,A,T,e))))return;E=t.state.tr.insertText(e,A,T)}if(E||(E=t.state.tr.replace(A,T,h.doc.slice(p.start-h.from,p.endB-h.from))),h.sel){let e=Qn(t,E.doc,h.sel);e&&!(R&&x&&t.composing&&e.empty&&(p.start!=p.endB||t.input.lastAndroidDelete<Date.now()-100)&&(e.head==A||e.head==E.mapping.map(T)-1)||C&&e.empty&&e.head==A)&&E.setSelection(e)}_&&E.ensureMarks(_),t.dispatch(E.scrollIntoView())}function Qn(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:ee(t,e.resolve(n.anchor),e.resolve(n.head))}function Jn(t,e){let n,r,s,o=t.firstChild.marks,a=e.firstChild.marks,c=o,l=a;for(let i=0;i<a.length;i++)c=a[i].removeFromSet(c);for(let i=0;i<o.length;i++)l=o[i].removeFromSet(l);if(1==c.length&&0==l.length)r=c[0],n="add",s=t=>t.mark(r.addToSet(t.marks));else{if(0!=c.length||1!=l.length)return null;r=l[0],n="remove",s=t=>t.mark(r.removeFromSet(t.marks))}let u=[];for(let i=0;i<e.childCount;i++)u.push(s(e.child(i)));if(i.HY.from(u).eq(t))return{mark:r,type:n}}function Zn(t,e,n,r,i){if(!r.parent.isTextblock||n-e<=i.pos-r.pos||tr(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(tr(s,!0,!0));return!(!o.parent.isTextblock||o.pos>n||tr(o,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function tr(t,e,n){let r=t.depth,i=e?t.end():t.pos;while(r>0&&(e||t.indexAfter(r)==t.node(r).childCount))r--,i++,e=!1;if(n){let e=t.node(r).maybeChild(t.indexAfter(r));while(e&&!e.isLeaf)e=e.firstChild,i++}return i}function er(t,e,n,r,i){let s=t.findDiffStart(e,n);if(null==s)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if("end"==i){let t=Math.max(0,s-Math.min(o,a));r-=o+t-s}if(o<s&&t.size<e.size){let t=r<=s&&r>=o?s-r:0;s-=t,a=s+(a-o),o=s}else if(a<s){let t=r<=s&&r>=a?s-r:0;s-=t,o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}class nr{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Ue,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(lr),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):"function"==typeof t?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=sr(this),ir(this),this.nodeViews=ar(this),this.docView=St(this.state.doc,rr(this),Un(this),this.dom,this),this.domObserver=new jn(this,((t,e,n,r)=>Xn(this,t,e,n,r))),this.domObserver.start(),Fe(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&je(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(lr),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){let n=this.state,r=!1,i=!1;t.storedMarks&&this.composing&&(ln(this),i=!0),this.state=t;let s=n.plugins!=t.plugins||this._props.plugins!=e.plugins;if(s||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let t=ar(this);cr(t,this.nodeViews)&&(this.nodeViews=t,r=!0)}(s||e.handleDOMEvents!=this._props.handleDOMEvents)&&je(this),this.editable=sr(this),ir(this);let o=Un(this),a=rr(this),c=n.plugins==t.plugins||n.doc.eq(t.doc)?t.scrollToSelection>n.scrollToSelection?"to selection":"preserve":"reset",l=r||!this.docView.matchesNode(t.doc,a,o);!l&&t.selection.eq(n.selection)||(i=!0);let u="preserve"==c&&i&&null==this.dom.style.overflowAnchor&&V(this);if(i){this.domObserver.stop();let e=l&&(C||R)&&!this.composing&&!n.selection.empty&&!t.selection.empty&&or(n.selection,t.selection);if(l){let n=R?this.trackWrites=this.domSelectionRange().focusNode:null;!r&&this.docView.update(t.doc,a,o,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=St(t.doc,a,o,this.dom,this)),n&&!this.trackWrites&&(e=!0)}e||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&ie(this))?Gt(this,e):(Zt(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():u&&H(u)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(t=>t(this))));else if(this.state.selection instanceof r.qv){let e=this.docView.domAfterPos(this.state.selection.from);1==e.nodeType&&z(this,e.getBoundingClientRect(),t)}else z(this,this.coordsAtPos(this.state.selection.head,1),t)}destroyPluginViews(){let t;while(t=this.pluginViews.pop())t.destroy&&t.destroy()}updatePluginViews(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let e=this.directPlugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let e=this.state.plugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}}}someProp(t,e){let n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;for(let s=0;s<this.directPlugins.length;s++){let r=this.directPlugins[s].props[t];if(null!=r&&(n=e?e(r):r))return n}let i=this.state.plugins;if(i)for(let s=0;s<i.length;s++){let r=i[s].props[t];if(null!=r&&(n=e?e(r):r))return n}}hasFocus(){if(C){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;while(t&&this.dom!=t&&this.dom.contains(t)){if("false"==t.contentEditable)return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&G(this.dom),Gt(this),this.domObserver.start()}get root(){let t=this._root;if(null==t)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return t||document}posAtCoords(t){return tt(this,t)}coordsAtPos(t,e=1){return rt(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(t,e){return ft(this,e||this.state,t)}pasteHTML(t,e){return mn(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return mn(this,t,null,!0,e||new ClipboardEvent("paste"))}destroy(){this.docView&&(Ve(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Un(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(t){return Ke(this,t)}dispatch(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))}domSelectionRange(){return D&&11===this.root.nodeType&&w(this.dom.ownerDocument)==this.dom?Gn(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function rr(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),e.translate="no",t.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(t.state)),n)for(let t in n)"class"==t&&(e.class+=" "+n[t]),"style"==t?e.style=(e.style?e.style+";":"")+n[t]:e[t]||"contenteditable"==t||"nodeName"==t||(e[t]=String(n[t]))})),[Sn.node(0,t.state.doc.content.size,e)]}function ir(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:Sn.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function sr(t){return!t.someProp("editable",(e=>!1===e(t.state)))}function or(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}function ar(t){let e=Object.create(null);function n(t){for(let n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function cr(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r}function lr(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}},708:function(t,e,n){"use strict";n.d(e,{E:function(){return i}});n(3767),n(8585),n(8696);var r=n(6402);function i(t=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?(0,r.P)(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}},5489:function(t,e,n){"use strict";n.r(e),n.d(e,{concat:function(){return s}});var r=n(708),i=n(6402);function s(t,e){e||(e=t.reduce(((t,e)=>t+e.length),0));const n=(0,r.E)(e);let s=0;for(const r of t)n.set(r,s),s+=r.length;return(0,i.P)(n)}},6555:function(t,e,n){"use strict";n.r(e),n.d(e,{fromString:function(){return X}});var r={};n.r(r),n.d(r,{identity:function(){return p}});var i={};n.r(i),n.d(i,{base2:function(){return g}});var s={};n.r(s),n.d(s,{base8:function(){return m}});var o={};n.r(o),n.d(o,{base10:function(){return y}});var a={};n.r(a),n.d(a,{base16:function(){return w},base16upper:function(){return b}});var c={};n.r(c),n.d(c,{base36:function(){return E},base36upper:function(){return _}});var l={};n.r(l),n.d(l,{base64:function(){return A},base64pad:function(){return C},base64url:function(){return I},base64urlpad:function(){return T}});var u={};n.r(u),n.d(u,{base256emoji:function(){return P}});var h={};n.r(h),n.d(h,{code:function(){return F},decode:function(){return V},encode:function(){return z},name:function(){return U}});var d=n(4711),f=n(3914);const p=(0,d.Dp)({prefix:"\0",name:"identity",encode:t=>(0,f.toString)(t),decode:t=>(0,f.fromString)(t)}),g=(0,d.ET)({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),m=(0,d.ET)({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),y=(0,d.kU)({prefix:"9",name:"base10",alphabet:"0123456789"}),w=(0,d.ET)({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),b=(0,d.ET)({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var v=n(2056);const E=(0,d.kU)({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_=(0,d.kU)({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var S=n(8334);const A=(0,d.ET)({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),C=(0,d.ET)({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),I=(0,d.ET)({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),T=(0,d.ET)({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});n(7658),n(3767),n(8585),n(8696);const k=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),R=k.reduce(((t,e,n)=>(t[n]=e,t)),[]),N=k.reduce(((t,e,n)=>(t[e.codePointAt(0)]=n,t)),[]);function D(t){return t.reduce(((t,e)=>(t+=R[e],t)),"")}function O(t){const e=[];for(const n of t){const t=N[n.codePointAt(0)];if(void 0===t)throw new Error(`Non-base256emoji character: ${n}`);e.push(t)}return new Uint8Array(e)}const P=(0,d.Dp)({prefix:"🚀",name:"base256emoji",encode:D,decode:O});var x=n(1919),M=n(7041);n(6347);const L=new TextEncoder,B=new TextDecoder,U="json",F=512,z=t=>L.encode(JSON.stringify(t)),V=t=>JSON.parse(B.decode(t));n(2493);const j={...r,...i,...s,...o,...a,...v,...c,...S,...l,...u};var H=n(708);function $(t,e,n,r){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:n},decoder:{decode:r}}}const K=$("utf8","u",(t=>{const e=new TextDecoder("utf8");return"u"+e.decode(t)}),(t=>{const e=new TextEncoder;return e.encode(t.substring(1))})),G=$("ascii","a",(t=>{let e="a";for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return e}),(t=>{t=t.substring(1);const e=(0,H.E)(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e})),q={utf8:K,"utf-8":K,hex:j.base16,latin1:G,ascii:G,binary:G,...j};var W=q,Y=n(6402);function X(t,e="utf8"){const n=W[e];if(!n)throw new Error(`Unsupported encoding "${e}"`);return"utf8"!==e&&"utf-8"!==e||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${t}`):(0,Y.P)(globalThis.Buffer.from(t,"utf-8"))}},6402:function(t,e,n){"use strict";n.d(e,{P:function(){return r}});n(3767),n(8585),n(8696);function r(t){return null!=globalThis.Buffer?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}},3989:function(t,e,n){"use strict";n.d(e,{zx:function(){return A}});var r=n(1404),i=n(3396),s=n(610),o=n(2220),a=n(5323),c=n(7936),l=n(5322),u=n(6014),h=n(316),d=n(6048);const[f,p]=(0,s["do"])("loading"),g=Array(12).fill(null).map(((t,e)=>(0,i.Wm)("i",{class:p("line",String(e+1))},null))),m=(0,i.Wm)("svg",{class:p("circular"),viewBox:"25 25 50 50"},[(0,i.Wm)("circle",{cx:"50",cy:"50",r:"20",fill:"none"},null)]),y={size:a.Or,type:(0,a.SQ)("circular"),color:String,vertical:Boolean,textSize:a.Or,textColor:String};var w=(0,i.aZ)({name:f,props:y,setup(t,{slots:e}){const n=(0,i.Fl)((()=>(0,o.l7)({color:t.color},(0,d.Xn)(t.size)))),r=()=>{const r="spinner"===t.type?g:m;return(0,i.Wm)("span",{class:p("spinner",t.type),style:n.value},[e.icon?e.icon():r])},s=()=>{var n;if(e.default)return(0,i.Wm)("span",{class:p("text"),style:{fontSize:(0,d.Nn)(t.textSize),color:null!=(n=t.textColor)?n:t.color}},[e.default()])};return()=>{const{type:e,vertical:n}=t;return(0,i.Wm)("div",{class:p([e,{vertical:n}]),"aria-live":"polite","aria-busy":!0},[r(),s()])}}});const b=(0,r.n)(w);const[v,E]=(0,s["do"])("button"),_=(0,o.l7)({},u.g2,{tag:(0,a.SQ)("button"),text:String,icon:String,type:(0,a.SQ)("default"),size:(0,a.SQ)("normal"),color:String,block:Boolean,plain:Boolean,round:Boolean,square:Boolean,loading:Boolean,hairline:Boolean,disabled:Boolean,iconPrefix:String,nativeType:(0,a.SQ)("button"),loadingSize:a.Or,loadingText:String,loadingType:String,iconPosition:(0,a.SQ)("left")});var S=(0,i.aZ)({name:v,props:_,emits:["click"],setup(t,{emit:e,slots:n}){const r=(0,u.yj)(),s=()=>n.loading?n.loading():(0,i.Wm)(b,{size:t.loadingSize,type:t.loadingType,class:E("loading")},null),o=()=>t.loading?s():n.icon?(0,i.Wm)("div",{class:E("icon")},[n.icon()]):t.icon?(0,i.Wm)(h.JO,{name:t.icon,class:E("icon"),classPrefix:t.iconPrefix},null):void 0,a=()=>{let e;if(e=t.loading?t.loadingText:n.default?n.default():t.text,e)return(0,i.Wm)("span",{class:E("text")},[e])},d=()=>{const{color:e,plain:n}=t;if(e){const t={color:n?e:"white"};return n||(t.background=e),e.includes("gradient")?t.border=0:t.borderColor=e,t}},f=n=>{t.loading?(0,c.PF)(n):t.disabled||(e("click",n),r())};return()=>{const{tag:e,type:n,size:r,block:s,round:c,plain:u,square:h,loading:p,disabled:g,hairline:m,nativeType:y,iconPosition:w}=t,b=[E([n,r,{plain:u,block:s,round:c,square:h,loading:p,disabled:g,hairline:m}]),{[l._K]:m}];return(0,i.Wm)(e,{type:y,class:b,style:d(),disabled:g,onClick:f},{default:()=>[(0,i.Wm)("div",{class:E("content")},["left"===w&&o(),a(),"right"===w&&o()])]})}}});const A=(0,r.n)(S)},9237:function(t,e,n){"use strict";n(1958),n(368),n(6742)},5728:function(t,e,n){"use strict";n.d(e,{bL:function(){return m}});var r=n(1404),i=n(3396),s=n(610),o=n(5323),a=n(2220),c=n(6491),l=n(6014),u=n(316);const[h,d]=(0,s["do"])("cell"),f={tag:(0,o.SQ)("div"),icon:String,size:String,title:o.Or,value:o.Or,label:o.Or,center:Boolean,isLink:Boolean,border:o.J5,required:Boolean,iconPrefix:String,valueClass:o.Vg,labelClass:o.Vg,titleClass:o.Vg,titleStyle:null,arrowDirection:String,clickable:{type:Boolean,default:null}},p=(0,a.l7)({},f,l.g2);var g=(0,i.aZ)({name:h,props:p,setup(t,{slots:e}){const n=(0,l.yj)(),r=()=>{const n=e.label||(0,c.Xq)(t.label);if(n)return(0,i.Wm)("div",{class:[d("label"),t.labelClass]},[e.label?e.label():t.label])},s=()=>{var n;if(e.title||(0,c.Xq)(t.title)){const s=null==(n=e.title)?void 0:n.call(e);if(Array.isArray(s)&&0===s.length)return;return(0,i.Wm)("div",{class:[d("title"),t.titleClass],style:t.titleStyle},[s||(0,i.Wm)("span",null,[t.title]),r()])}},o=()=>{const n=e.value||e.default,r=n||(0,c.Xq)(t.value);if(r)return(0,i.Wm)("div",{class:[d("value"),t.valueClass]},[n?n():(0,i.Wm)("span",null,[t.value])])},a=()=>e.icon?e.icon():t.icon?(0,i.Wm)(u.JO,{name:t.icon,class:d("left-icon"),classPrefix:t.iconPrefix},null):void 0,h=()=>{if(e["right-icon"])return e["right-icon"]();if(t.isLink){const e=t.arrowDirection&&"right"!==t.arrowDirection?`arrow-${t.arrowDirection}`:"arrow";return(0,i.Wm)(u.JO,{name:e,class:d("right-icon")},null)}};return()=>{var r;const{tag:c,size:l,center:u,border:f,isLink:p,required:g}=t,m=null!=(r=t.clickable)?r:p,y={center:u,required:g,clickable:m,borderless:!f};return l&&(y[l]=!!l),(0,i.Wm)(c,{class:d(y),role:m?"button":void 0,tabindex:m?0:void 0,onClick:n},{default:()=>{var t;return[a(),s(),o(),h(),null==(t=e.extra)?void 0:t.call(e)]}})}}});const m=(0,r.n)(g)},923:function(t,e,n){"use strict";n(1958),n(368),n(6742)},140:function(t,e,n){"use strict";n.d(e,{H:function(){return s},t:function(){return i}});let r=2e3;const i=()=>++r,s=t=>{r=t}},6014:function(t,e,n){"use strict";n.d(e,{g2:function(){return i},yj:function(){return o}});var r=n(3396);const i={to:[String,Object],url:String,replace:Boolean};function s({to:t,url:e,replace:n,$router:r}){t&&r?r[n?"replace":"push"](t):e&&(n?location.replace(e):location.href=e)}function o(){const t=(0,r.FN)().proxy;return()=>s(t)}},316:function(t,e,n){"use strict";n.d(e,{JO:function(){return I}});var r=n(1404),i=n(3396),s=n(610),o=n(5323),a=n(6048),c=n(6491);const[l,u]=(0,s["do"])("badge"),h={dot:Boolean,max:o.Or,tag:(0,o.SQ)("div"),color:String,offset:Array,content:o.Or,showZero:o.J5,position:(0,o.SQ)("top-right")};var d=(0,i.aZ)({name:l,props:h,setup(t,{slots:e}){const n=()=>{if(e.content)return!0;const{content:n,showZero:r}=t;return(0,c.Xq)(n)&&""!==n&&(r||0!==n&&"0"!==n)},r=()=>{const{dot:r,max:i,content:s}=t;if(!r&&n())return e.content?e.content():(0,c.Xq)(i)&&(0,c.kE)(s)&&+s>+i?`${i}+`:s},s=t=>t.startsWith("-")?t.replace("-",""):`-${t}`,o=(0,i.Fl)((()=>{const n={background:t.color};if(t.offset){const[r,i]=t.offset,{position:o}=t,[c,l]=o.split("-");e.default?(n[c]="number"===typeof i?(0,a.Nn)("top"===c?i:-i):"top"===c?(0,a.Nn)(i):s(i),n[l]="number"===typeof r?(0,a.Nn)("left"===l?r:-r):"left"===l?(0,a.Nn)(r):s(r)):(n.marginTop=(0,a.Nn)(i),n.marginLeft=(0,a.Nn)(r))}return n})),l=()=>{if(n()||t.dot)return(0,i.Wm)("div",{class:u([t.position,{dot:t.dot,fixed:!!e.default}]),style:o.value},[r()])};return()=>{if(e.default){const{tag:n}=t;return(0,i.Wm)(n,{class:u("wrapper")},{default:()=>[e.default(),l()]})}return l()}}});const f=(0,r.n)(d);var p=n(2220),g=n(140);const[m,y]=(0,s["do"])("config-provider"),w=Symbol(m),b={tag:(0,o.SQ)("div"),theme:(0,o.SQ)("light"),zIndex:Number,themeVars:Object,themeVarsDark:Object,themeVarsLight:Object,iconPrefix:String};function v(t){const e={};return Object.keys(t).forEach((n=>{e[`--van-${(0,a.GL)(n)}`]=t[n]})),e}(0,i.aZ)({name:m,props:b,setup(t,{slots:e}){const n=(0,i.Fl)((()=>v((0,p.l7)({},t.themeVars,"dark"===t.theme?t.themeVarsDark:t.themeVarsLight))));if(p._f){const e=()=>{document.documentElement.classList.add(`van-theme-${t.theme}`)},n=(e=t.theme)=>{document.documentElement.classList.remove(`van-theme-${e}`)};(0,i.YP)((()=>t.theme),((t,r)=>{r&&n(r),e()}),{immediate:!0}),(0,i.dl)(e),(0,i.se)(n),(0,i.Jd)(n)}return(0,i.JJ)(w,t),(0,i.m0)((()=>{void 0!==t.zIndex&&(0,g.H)(t.zIndex)})),()=>(0,i.Wm)(t.tag,{class:y(),style:n.value},{default:()=>{var t;return[null==(t=e.default)?void 0:t.call(e)]}})}});const[E,_]=(0,s["do"])("icon"),S=t=>null==t?void 0:t.includes("/"),A={dot:Boolean,tag:(0,o.SQ)("i"),name:String,size:o.Or,badge:o.Or,color:String,badgeProps:Object,classPrefix:String};var C=(0,i.aZ)({name:E,props:A,setup(t,{slots:e}){const n=(0,i.f3)(w,null),r=(0,i.Fl)((()=>t.classPrefix||(null==n?void 0:n.iconPrefix)||_()));return()=>{const{tag:n,dot:s,name:o,size:c,badge:l,color:u}=t,h=S(o);return(0,i.Wm)(f,(0,i.dG)({dot:s,tag:n,class:[r.value,h?"":`${r.value}-${o}`],style:{color:u,fontSize:(0,a.Nn)(c)},content:l},t.badgeProps),{default:()=>{var t;return[null==(t=e.default)?void 0:t.call(e),h&&(0,i.Wm)("img",{class:_("image"),src:o},null)]}})}}});const I=(0,r.n)(C)},4165:function(t,e,n){"use strict";n(1958),n(368),n(6742)},9591:function(t,e,n){"use strict";n.d(e,{GI:function(){return L}});var r=n(1404),i=n(3396),s=n(9242),o=n(4870),a=n(5323);const c={show:Boolean,zIndex:a.Or,overlay:a.J5,duration:a.Or,teleport:[String,Object],lockScroll:a.J5,lazyRender:a.J5,beforeClose:Function,overlayStyle:Object,overlayClass:a.Vg,transitionAppear:Boolean,closeOnClickOverlay:a.J5};Object.keys(c);var l=n(2220),u=n(610),h=n(6491);function d(t,{args:e=[],done:n,canceled:r}){if(t){const i=t.apply(null,e);(0,h.tI)(i)?i.then((t=>{t?n():r&&r()})).catch(l.ZT):i?n():r&&r()}else n()}var f=n(5322),p=n(253);function g(t){const e=(0,i.FN)();e&&(0,l.l7)(e.proxy,t)}function m(t,e){return t>e?"horizontal":e>t?"vertical":""}function y(){const t=(0,o.iH)(0),e=(0,o.iH)(0),n=(0,o.iH)(0),r=(0,o.iH)(0),i=(0,o.iH)(0),s=(0,o.iH)(0),a=(0,o.iH)(""),c=()=>"vertical"===a.value,l=()=>"horizontal"===a.value,u=()=>{n.value=0,r.value=0,i.value=0,s.value=0,a.value=""},h=n=>{u(),t.value=n.touches[0].clientX,e.value=n.touches[0].clientY},d=o=>{const c=o.touches[0];n.value=(c.clientX<0?0:c.clientX)-t.value,r.value=c.clientY-e.value,i.value=Math.abs(n.value),s.value=Math.abs(r.value);const l=10;(!a.value||i.value<l&&s.value<l)&&(a.value=m(i.value,s.value))};return{move:d,start:h,reset:u,startX:t,startY:e,deltaX:n,deltaY:r,offsetX:i,offsetY:s,direction:a,isVertical:c,isHorizontal:l}}var w=n(7936);let b=0;const v="van-overflow-hidden";function E(t,e){const n=y(),r="01",s="10",o=e=>{n.move(e);const i=n.deltaY.value>0?s:r,o=(0,p.rP)(e.target,t.value),{scrollHeight:a,offsetHeight:c,scrollTop:l}=o;let u="11";0===l?u=c>=a?"00":"01":l+c>=a&&(u="10"),"11"===u||!n.isVertical()||parseInt(u,2)&parseInt(i,2)||(0,w.PF)(e,!0)},a=()=>{document.addEventListener("touchstart",n.start),document.addEventListener("touchmove",o,{passive:!1}),b||document.body.classList.add(v),b++},c=()=>{b&&(document.removeEventListener("touchstart",n.start),document.removeEventListener("touchmove",o),b--,b||document.body.classList.remove(v))},l=()=>e()&&a(),u=()=>e()&&c();(0,p.Ib)(l),(0,i.se)(u),(0,i.Jd)(u),(0,i.YP)(e,(t=>{t?a():c()}))}function _(t){const e=(0,o.iH)(!1);return(0,i.YP)(t,(t=>{t&&(e.value=t)}),{immediate:!0}),t=>()=>e.value?t():null}const S=Symbol();var A=n(140),C=n(316),I=n(6048);const[T,k]=(0,u["do"])("overlay"),R={show:Boolean,zIndex:a.Or,duration:a.Or,className:a.Vg,lockScroll:a.J5,lazyRender:a.J5,customStyle:Object};var N=(0,i.aZ)({name:T,props:R,setup(t,{slots:e}){const n=(0,o.iH)(),r=_((()=>t.show||!t.lazyRender)),a=e=>{t.lockScroll&&(0,w.PF)(e,!0)},c=r((()=>{var r;const o=(0,l.l7)((0,I.As)(t.zIndex),t.customStyle);return(0,h.Xq)(t.duration)&&(o.animationDuration=`${t.duration}s`),(0,i.wy)((0,i.Wm)("div",{ref:n,style:o,class:[k(),t.className]},[null==(r=e.default)?void 0:r.call(e)]),[[s.F8,t.show]])}));return(0,p.OR)("touchmove",a,{target:n}),()=>(0,i.Wm)(s.uT,{name:"van-fade",appear:!0},{default:c})}});const D=(0,r.n)(N);const O=(0,l.l7)({},c,{round:Boolean,position:(0,a.SQ)("center"),closeIcon:(0,a.SQ)("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:(0,a.SQ)("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[P,x]=(0,u["do"])("popup");var M=(0,i.aZ)({name:P,inheritAttrs:!1,props:O,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(t,{emit:e,attrs:n,slots:r}){let a,c;const l=(0,o.iH)(),u=(0,o.iH)(),m=_((()=>t.show||!t.lazyRender)),y=(0,i.Fl)((()=>{const e={zIndex:l.value};if((0,h.Xq)(t.duration)){const n="center"===t.position?"animationDuration":"transitionDuration";e[n]=`${t.duration}s`}return e})),w=()=>{a||(a=!0,l.value=void 0!==t.zIndex?+t.zIndex:(0,A.t)(),e("open"))},b=()=>{a&&d(t.beforeClose,{done(){a=!1,e("close"),e("update:show",!1)}})},v=n=>{e("clickOverlay",n),t.closeOnClickOverlay&&b()},I=()=>{if(t.overlay)return(0,i.Wm)(D,{show:t.show,class:t.overlayClass,zIndex:l.value,duration:t.duration,customStyle:t.overlayStyle,role:t.closeOnClickOverlay?"button":void 0,tabindex:t.closeOnClickOverlay?0:void 0,onClick:v},{default:r["overlay-content"]})},T=t=>{e("clickCloseIcon",t),b()},k=()=>{if(t.closeable)return(0,i.Wm)(C.JO,{role:"button",tabindex:0,name:t.closeIcon,class:[x("close-icon",t.closeIconPosition),f.e9],classPrefix:t.iconPrefix,onClick:T},null)},R=()=>e("opened"),N=()=>e("closed"),O=t=>e("keydown",t),P=m((()=>{var e;const{round:o,position:a,safeAreaInsetTop:c,safeAreaInsetBottom:l}=t;return(0,i.wy)((0,i.Wm)("div",(0,i.dG)({ref:u,style:y.value,role:"dialog",tabindex:0,class:[x({round:o,[a]:a}),{"van-safe-area-top":c,"van-safe-area-bottom":l}],onKeydown:O},n),[null==(e=r.default)?void 0:e.call(r),k()]),[[s.F8,t.show]])})),M=()=>{const{position:e,transition:n,transitionAppear:r}=t,o="center"===e?"van-fade":`van-popup-slide-${e}`;return(0,i.Wm)(s.uT,{name:n||o,appear:r,onAfterEnter:R,onAfterLeave:N},{default:P})};return(0,i.YP)((()=>t.show),(t=>{t&&!a&&(w(),0===n.tabindex&&(0,i.Y3)((()=>{var t;null==(t=u.value)||t.focus()}))),!t&&a&&(a=!1,e("close"))})),g({popupRef:u}),E(u,(()=>t.show&&t.lockScroll)),(0,p.OR)("popstate",(()=>{t.closeOnPopstate&&(b(),c=!1)})),(0,i.bv)((()=>{t.show&&w()})),(0,i.dl)((()=>{c&&(e("update:show",!0),c=!1)})),(0,i.se)((()=>{t.show&&t.teleport&&(b(),c=!0)})),(0,i.JJ)(S,(()=>t.show)),()=>t.teleport?(0,i.Wm)(i.lR,{to:t.teleport},{default:()=>[I(),M()]}):(0,i.Wm)(i.HY,null,[I(),M()])}});const L=(0,r.n)(M)},6316:function(t,e,n){"use strict";n(1958),n(368),n(6742)},2220:function(t,e,n){"use strict";n.d(e,{U2:function(){return a},ZT:function(){return i},_f:function(){return o},l7:function(){return s}});var r=n(6491);function i(){}const s=Object.assign,o="undefined"!==typeof window;function a(t,e){const n=e.split(".");let i=t;return n.forEach((t=>{var e;i=(0,r.Kn)(i)&&null!=(e=i[t])?e:""})),i}},5322:function(t,e,n){"use strict";n.d(e,{_K:function(){return i},e9:function(){return s}});const r="van-hairline",i=`${r}--surround`,s="van-haptics-feedback";Symbol("van-form")},610:function(t,e,n){"use strict";n.d(e,{do:function(){return w}});var r=n(2220),i=n(6048),s=n(6491),o=n(4870);const{hasOwnProperty:a}=Object.prototype;function c(t,e,n){const r=e[n];(0,s.Xq)(r)&&(a.call(t,n)&&(0,s.Kn)(r)?t[n]=l(Object(t[n]),r):t[n]=r)}function l(t,e){return Object.keys(e).forEach((n=>{c(t,e,n)})),t}var u={name:"姓名",tel:"电话",save:"保存",confirm:"确认",cancel:"取消",delete:"删除",loading:"加载中...",noCoupon:"暂无优惠券",nameEmpty:"请填写姓名",addContact:"添加联系人",telInvalid:"请填写正确的电话",vanCalendar:{end:"结束",start:"开始",title:"日期选择",weekdays:["日","一","二","三","四","五","六"],monthTitle:(t,e)=>`${t}年${e}月`,rangePrompt:t=>`最多选择 ${t} 天`},vanCascader:{select:"请选择"},vanPagination:{prev:"上一页",next:"下一页"},vanPullRefresh:{pulling:"下拉即可刷新...",loosing:"释放即可刷新..."},vanSubmitBar:{label:"合计:"},vanCoupon:{unlimited:"无门槛",discount:t=>`${t}折`,condition:t=>`满${t}元可用`},vanCouponCell:{title:"优惠券",count:t=>`${t}张可用`},vanCouponList:{exchange:"兑换",close:"不使用",enable:"可用",disabled:"不可用",placeholder:"输入优惠码"},vanAddressEdit:{area:"地区",areaEmpty:"请选择地区",addressEmpty:"请填写详细地址",addressDetail:"详细地址",defaultAddress:"设为默认收货地址"},vanAddressList:{add:"新增地址"}};const h=(0,o.iH)("zh-CN"),d=(0,o.qj)({"zh-CN":u}),f={messages(){return d[h.value]},use(t,e){h.value=t,this.add({[t]:e})},add(t={}){l(d,t)}};var p=f;function g(t){const e=(0,i._A)(t)+".";return(t,...n)=>{const i=p.messages(),o=(0,r.U2)(i,e+t)||(0,r.U2)(i,t);return(0,s.mf)(o)?o(...n):o}}function m(t,e){return e?"string"===typeof e?` ${t}--${e}`:Array.isArray(e)?e.reduce(((e,n)=>e+m(t,n)),""):Object.keys(e).reduce(((n,r)=>n+(e[r]?m(t,r):"")),""):""}function y(t){return(e,n)=>(e&&"string"!==typeof e&&(n=e,e=""),e=e?`${t}__${e}`:t,`${e}${m(e,n)}`)}function w(t){const e=`van-${t}`;return[e,y(e),g(e)]}},7936:function(t,e,n){"use strict";n.d(e,{PF:function(){return o}});var r=n(253),i=n(6491);(0,i.gn)();const s=t=>t.stopPropagation();function o(t,e){("boolean"!==typeof t.cancelable||t.cancelable)&&t.preventDefault(),e&&s(t)}const{width:a,height:c}=(0,r.iP)()},6048:function(t,e,n){"use strict";n.d(e,{As:function(){return o},GL:function(){return l},Nn:function(){return i},Xn:function(){return s},_A:function(){return c}});var r=n(6491);function i(t){if((0,r.Xq)(t))return(0,r.kE)(t)?`${t}px`:String(t)}function s(t){if((0,r.Xq)(t)){if(Array.isArray(t))return{width:i(t[0]),height:i(t[1])};const e=i(t);return{width:e,height:e}}}function o(t){const e={};return void 0!==t&&(e.zIndex=+t),e}const a=/-(\w)/g,c=t=>t.replace(a,((t,e)=>e.toUpperCase())),l=t=>t.replace(/([A-Z])/g,"-$1").toLowerCase().replace(/^-/,"")},5323:function(t,e,n){"use strict";n.d(e,{J5:function(){return s},Or:function(){return i},SQ:function(){return o},Vg:function(){return r}});const r=null,i=[Number,String],s={type:Boolean,default:!0},o=t=>({type:String,default:t})},6491:function(t,e,n){"use strict";n.d(e,{Kn:function(){return o},Xq:function(){return i},gn:function(){return l},kE:function(){return c},mf:function(){return s},tI:function(){return a}});var r=n(2220);const i=t=>void 0!==t&&null!==t,s=t=>"function"===typeof t,o=t=>null!==t&&"object"===typeof t,a=t=>o(t)&&s(t.then)&&s(t.catch);const c=t=>"number"===typeof t||/^\d+(\.\d+)?$/.test(t),l=()=>!!r._f&&/ios|iphone|ipad|ipod/.test(navigator.userAgent.toLowerCase())},1404:function(t,e,n){"use strict";n.d(e,{n:function(){return i}});var r=n(6048);function i(t){return t.install=e=>{const{name:n}=t;n&&(e.component(n,t),e.component((0,r._A)(`-${n}`),t))},t}},2483:function(t,e,n){"use strict";n.d(e,{PO:function(){return F},p7:function(){return ee}});n(7658),n(541);var r=n(3396),i=n(4870);
/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */
const s="undefined"!==typeof window;function o(t){return t.__esModule||"Module"===t[Symbol.toStringTag]}const a=Object.assign;function c(t,e){const n={};for(const r in e){const i=e[r];n[r]=u(i)?i.map(t):t(i)}return n}const l=()=>{},u=Array.isArray;const h=/\/$/,d=t=>t.replace(h,"");function f(t,e,n="/"){let r,i={},s="",o="";const a=e.indexOf("#");let c=e.indexOf("?");return a<c&&a>=0&&(c=-1),c>-1&&(r=e.slice(0,c),s=e.slice(c+1,a>-1?a:e.length),i=t(s)),a>-1&&(r=r||e.slice(0,a),o=e.slice(a,e.length)),r=E(null!=r?r:e,n),{fullPath:r+(s&&"?")+s+o,path:r,query:i,hash:o}}function p(t,e){const n=e.query?t(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}function g(t,e){return e&&t.toLowerCase().startsWith(e.toLowerCase())?t.slice(e.length)||"/":t}function m(t,e,n){const r=e.matched.length-1,i=n.matched.length-1;return r>-1&&r===i&&y(e.matched[r],n.matched[i])&&w(e.params,n.params)&&t(e.query)===t(n.query)&&e.hash===n.hash}function y(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function w(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!b(t[n],e[n]))return!1;return!0}function b(t,e){return u(t)?v(t,e):u(e)?v(e,t):t===e}function v(t,e){return u(e)?t.length===e.length&&t.every(((t,n)=>t===e[n])):1===t.length&&t[0]===e}function E(t,e){if(t.startsWith("/"))return t;if(!t)return e;const n=e.split("/"),r=t.split("/");let i,s,o=n.length-1;for(i=0;i<r.length;i++)if(s=r[i],"."!==s){if(".."!==s)break;o>1&&o--}return n.slice(0,o).join("/")+"/"+r.slice(i-(i===r.length?1:0)).join("/")}var _,S;(function(t){t["pop"]="pop",t["push"]="push"})(_||(_={})),function(t){t["back"]="back",t["forward"]="forward",t["unknown"]=""}(S||(S={}));function A(t){if(!t)if(s){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return"/"!==t[0]&&"#"!==t[0]&&(t="/"+t),d(t)}const C=/^[^#]+#/;function I(t,e){return t.replace(C,"#")+e}function T(t,e){const n=document.documentElement.getBoundingClientRect(),r=t.getBoundingClientRect();return{behavior:e.behavior,left:r.left-n.left-(e.left||0),top:r.top-n.top-(e.top||0)}}const k=()=>({left:window.pageXOffset,top:window.pageYOffset});function R(t){let e;if("el"in t){const n=t.el,r="string"===typeof n&&n.startsWith("#");0;const i="string"===typeof n?r?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!i)return;e=T(i,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(null!=e.left?e.left:window.pageXOffset,null!=e.top?e.top:window.pageYOffset)}function N(t,e){const n=history.state?history.state.position-e:-1;return n+t}const D=new Map;function O(t,e){D.set(t,e)}function P(t){const e=D.get(t);return D.delete(t),e}let x=()=>location.protocol+"//"+location.host;function M(t,e){const{pathname:n,search:r,hash:i}=e,s=t.indexOf("#");if(s>-1){let e=i.includes(t.slice(s))?t.slice(s).length:1,n=i.slice(e);return"/"!==n[0]&&(n="/"+n),g(n,"")}const o=g(n,t);return o+r+i}function L(t,e,n,r){let i=[],s=[],o=null;const c=({state:s})=>{const a=M(t,location),c=n.value,l=e.value;let u=0;if(s){if(n.value=a,e.value=s,o&&o===c)return void(o=null);u=l?s.position-l.position:0}else r(a);i.forEach((t=>{t(n.value,c,{delta:u,type:_.pop,direction:u?u>0?S.forward:S.back:S.unknown})}))};function l(){o=n.value}function u(t){i.push(t);const e=()=>{const e=i.indexOf(t);e>-1&&i.splice(e,1)};return s.push(e),e}function h(){const{history:t}=window;t.state&&t.replaceState(a({},t.state,{scroll:k()}),"")}function d(){for(const t of s)t();s=[],window.removeEventListener("popstate",c),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",c),window.addEventListener("beforeunload",h),{pauseListeners:l,listen:u,destroy:d}}function B(t,e,n,r=!1,i=!1){return{back:t,current:e,forward:n,replaced:r,position:window.history.length,scroll:i?k():null}}function U(t){const{history:e,location:n}=window,r={value:M(t,n)},i={value:e.state};function s(r,s,o){const a=t.indexOf("#"),c=a>-1?(n.host&&document.querySelector("base")?t:t.slice(a))+r:x()+t+r;try{e[o?"replaceState":"pushState"](s,"",c),i.value=s}catch(l){console.error(l),n[o?"replace":"assign"](c)}}function o(t,n){const o=a({},e.state,B(i.value.back,t,i.value.forward,!0),n,{position:i.value.position});s(t,o,!0),r.value=t}function c(t,n){const o=a({},i.value,e.state,{forward:t,scroll:k()});s(o.current,o,!0);const c=a({},B(r.value,t,null),{position:o.position+1},n);s(t,c,!1),r.value=t}return i.value||s(r.value,{back:null,current:r.value,forward:null,position:e.length-1,replaced:!0,scroll:null},!0),{location:r,state:i,push:c,replace:o}}function F(t){t=A(t);const e=U(t),n=L(t,e.state,e.location,e.replace);function r(t,e=!0){e||n.pauseListeners(),history.go(t)}const i=a({location:"",base:t,go:r,createHref:I.bind(null,t)},e,n);return Object.defineProperty(i,"location",{enumerable:!0,get:()=>e.location.value}),Object.defineProperty(i,"state",{enumerable:!0,get:()=>e.state.value}),i}function z(t){return"string"===typeof t||t&&"object"===typeof t}function V(t){return"string"===typeof t||"symbol"===typeof t}const j={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},H=Symbol("");var $;(function(t){t[t["aborted"]=4]="aborted",t[t["cancelled"]=8]="cancelled",t[t["duplicated"]=16]="duplicated"})($||($={}));function K(t,e){return a(new Error,{type:t,[H]:!0},e)}function G(t,e){return t instanceof Error&&H in t&&(null==e||!!(t.type&e))}const q="[^/]+?",W={sensitive:!1,strict:!1,start:!0,end:!0},Y=/[.+*?^${}()[\]/\\]/g;function X(t,e){const n=a({},W,e),r=[];let i=n.start?"^":"";const s=[];for(const a of t){const t=a.length?[]:[90];n.strict&&!a.length&&(i+="/");for(let e=0;e<a.length;e++){const r=a[e];let o=40+(n.sensitive?.25:0);if(0===r.type)e||(i+="/"),i+=r.value.replace(Y,"\\$&"),o+=40;else if(1===r.type){const{value:t,repeatable:n,optional:c,regexp:l}=r;s.push({name:t,repeatable:n,optional:c});const u=l||q;if(u!==q){o+=10;try{new RegExp(`(${u})`)}catch(h){throw new Error(`Invalid custom RegExp for param "${t}" (${u}): `+h.message)}}let d=n?`((?:${u})(?:/(?:${u}))*)`:`(${u})`;e||(d=c&&a.length<2?`(?:/${d})`:"/"+d),c&&(d+="?"),i+=d,o+=20,c&&(o+=-8),n&&(o+=-20),".*"===u&&(o+=-50)}t.push(o)}r.push(t)}if(n.strict&&n.end){const t=r.length-1;r[t][r[t].length-1]+=.7000000000000001}n.strict||(i+="/?"),n.end?i+="$":n.strict&&(i+="(?:/|$)");const o=new RegExp(i,n.sensitive?"":"i");function c(t){const e=t.match(o),n={};if(!e)return null;for(let r=1;r<e.length;r++){const t=e[r]||"",i=s[r-1];n[i.name]=t&&i.repeatable?t.split("/"):t}return n}function l(e){let n="",r=!1;for(const i of t){r&&n.endsWith("/")||(n+="/"),r=!1;for(const t of i)if(0===t.type)n+=t.value;else if(1===t.type){const{value:s,repeatable:o,optional:a}=t,c=s in e?e[s]:"";if(u(c)&&!o)throw new Error(`Provided param "${s}" is an array but it is not repeatable (* or + modifiers)`);const l=u(c)?c.join("/"):c;if(!l){if(!a)throw new Error(`Missing required param "${s}"`);i.length<2&&(n.endsWith("/")?n=n.slice(0,-1):r=!0)}n+=l}}return n||"/"}return{re:o,score:r,keys:s,parse:c,stringify:l}}function Q(t,e){let n=0;while(n<t.length&&n<e.length){const r=e[n]-t[n];if(r)return r;n++}return t.length<e.length?1===t.length&&80===t[0]?-1:1:t.length>e.length?1===e.length&&80===e[0]?1:-1:0}function J(t,e){let n=0;const r=t.score,i=e.score;while(n<r.length&&n<i.length){const t=Q(r[n],i[n]);if(t)return t;n++}if(1===Math.abs(i.length-r.length)){if(Z(r))return 1;if(Z(i))return-1}return i.length-r.length}function Z(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const tt={type:0,value:""},et=/[a-zA-Z0-9_]/;function nt(t){if(!t)return[[]];if("/"===t)return[[tt]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(t){throw new Error(`ERR (${n})/"${l}": ${t}`)}let n=0,r=n;const i=[];let s;function o(){s&&i.push(s),s=[]}let a,c=0,l="",u="";function h(){l&&(0===n?s.push({type:0,value:l}):1===n||2===n||3===n?(s.length>1&&("*"===a||"+"===a)&&e(`A repeatable param (${l}) must be alone in its segment. eg: '/:ids+.`),s.push({type:1,value:l,regexp:u,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):e("Invalid state to consume buffer"),l="")}function d(){l+=a}while(c<t.length)if(a=t[c++],"\\"!==a||2===n)switch(n){case 0:"/"===a?(l&&h(),o()):":"===a?(h(),n=1):d();break;case 4:d(),n=r;break;case 1:"("===a?n=2:et.test(a)?d():(h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&c--);break;case 2:")"===a?"\\"==u[u.length-1]?u=u.slice(0,-1)+a:n=3:u+=a;break;case 3:h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&c--,u="";break;default:e("Unknown state");break}else r=n,n=4;return 2===n&&e(`Unfinished custom RegExp for param "${l}"`),h(),o(),i}function rt(t,e,n){const r=X(nt(t.path),n);const i=a(r,{record:t,parent:e,children:[],alias:[]});return e&&!i.record.aliasOf===!e.record.aliasOf&&e.children.push(i),i}function it(t,e){const n=[],r=new Map;function i(t){return r.get(t)}function s(t,n,r){const i=!r,c=ot(t);c.aliasOf=r&&r.record;const h=ut(e,t),d=[c];if("alias"in t){const e="string"===typeof t.alias?[t.alias]:t.alias;for(const t of e)d.push(a({},c,{components:r?r.record.components:c.components,path:t,aliasOf:r?r.record:c}))}let f,p;for(const e of d){const{path:a}=e;if(n&&"/"!==a[0]){const t=n.record.path,r="/"===t[t.length-1]?"":"/";e.path=n.record.path+(a&&r+a)}if(f=rt(e,n,h),r?r.alias.push(f):(p=p||f,p!==f&&p.alias.push(f),i&&t.name&&!ct(f)&&o(t.name)),c.children){const t=c.children;for(let e=0;e<t.length;e++)s(t[e],f,r&&r.children[e])}r=r||f,(f.record.components&&Object.keys(f.record.components).length||f.record.name||f.record.redirect)&&u(f)}return p?()=>{o(p)}:l}function o(t){if(V(t)){const e=r.get(t);e&&(r.delete(t),n.splice(n.indexOf(e),1),e.children.forEach(o),e.alias.forEach(o))}else{const e=n.indexOf(t);e>-1&&(n.splice(e,1),t.record.name&&r.delete(t.record.name),t.children.forEach(o),t.alias.forEach(o))}}function c(){return n}function u(t){let e=0;while(e<n.length&&J(t,n[e])>=0&&(t.record.path!==n[e].record.path||!ht(t,n[e])))e++;n.splice(e,0,t),t.record.name&&!ct(t)&&r.set(t.record.name,t)}function h(t,e){let i,s,o,c={};if("name"in t&&t.name){if(i=r.get(t.name),!i)throw K(1,{location:t});0,o=i.record.name,c=a(st(e.params,i.keys.filter((t=>!t.optional)).map((t=>t.name))),t.params&&st(t.params,i.keys.map((t=>t.name)))),s=i.stringify(c)}else if("path"in t)s=t.path,i=n.find((t=>t.re.test(s))),i&&(c=i.parse(s),o=i.record.name);else{if(i=e.name?r.get(e.name):n.find((t=>t.re.test(e.path))),!i)throw K(1,{location:t,currentLocation:e});o=i.record.name,c=a({},e.params,t.params),s=i.stringify(c)}const l=[];let u=i;while(u)l.unshift(u.record),u=u.parent;return{name:o,path:s,params:c,matched:l,meta:lt(l)}}return e=ut({strict:!1,end:!0,sensitive:!1},e),t.forEach((t=>s(t))),{addRoute:s,resolve:h,removeRoute:o,getRoutes:c,getRecordMatcher:i}}function st(t,e){const n={};for(const r of e)r in t&&(n[r]=t[r]);return n}function ot(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:at(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function at(t){const e={},n=t.props||!1;if("component"in t)e.default=n;else for(const r in t.components)e[r]="boolean"===typeof n?n:n[r];return e}function ct(t){while(t){if(t.record.aliasOf)return!0;t=t.parent}return!1}function lt(t){return t.reduce(((t,e)=>a(t,e.meta)),{})}function ut(t,e){const n={};for(const r in t)n[r]=r in e?e[r]:t[r];return n}function ht(t,e){return e.children.some((e=>e===t||ht(t,e)))}const dt=/#/g,ft=/&/g,pt=/\//g,gt=/=/g,mt=/\?/g,yt=/\+/g,wt=/%5B/g,bt=/%5D/g,vt=/%5E/g,Et=/%60/g,_t=/%7B/g,St=/%7C/g,At=/%7D/g,Ct=/%20/g;function It(t){return encodeURI(""+t).replace(St,"|").replace(wt,"[").replace(bt,"]")}function Tt(t){return It(t).replace(_t,"{").replace(At,"}").replace(vt,"^")}function kt(t){return It(t).replace(yt,"%2B").replace(Ct,"+").replace(dt,"%23").replace(ft,"%26").replace(Et,"`").replace(_t,"{").replace(At,"}").replace(vt,"^")}function Rt(t){return kt(t).replace(gt,"%3D")}function Nt(t){return It(t).replace(dt,"%23").replace(mt,"%3F")}function Dt(t){return null==t?"":Nt(t).replace(pt,"%2F")}function Ot(t){try{return decodeURIComponent(""+t)}catch(e){}return""+t}function Pt(t){const e={};if(""===t||"?"===t)return e;const n="?"===t[0],r=(n?t.slice(1):t).split("&");for(let i=0;i<r.length;++i){const t=r[i].replace(yt," "),n=t.indexOf("="),s=Ot(n<0?t:t.slice(0,n)),o=n<0?null:Ot(t.slice(n+1));if(s in e){let t=e[s];u(t)||(t=e[s]=[t]),t.push(o)}else e[s]=o}return e}function xt(t){let e="";for(let n in t){const r=t[n];if(n=Rt(n),null==r){void 0!==r&&(e+=(e.length?"&":"")+n);continue}const i=u(r)?r.map((t=>t&&kt(t))):[r&&kt(r)];i.forEach((t=>{void 0!==t&&(e+=(e.length?"&":"")+n,null!=t&&(e+="="+t))}))}return e}function Mt(t){const e={};for(const n in t){const r=t[n];void 0!==r&&(e[n]=u(r)?r.map((t=>null==t?null:""+t)):null==r?r:""+r)}return e}const Lt=Symbol(""),Bt=Symbol(""),Ut=Symbol(""),Ft=Symbol(""),zt=Symbol("");function Vt(){let t=[];function e(e){return t.push(e),()=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)}}function n(){t=[]}return{add:e,list:()=>t,reset:n}}function jt(t,e,n,r,i){const s=r&&(r.enterCallbacks[i]=r.enterCallbacks[i]||[]);return()=>new Promise(((o,a)=>{const c=t=>{!1===t?a(K(4,{from:n,to:e})):t instanceof Error?a(t):z(t)?a(K(2,{from:e,to:t})):(s&&r.enterCallbacks[i]===s&&"function"===typeof t&&s.push(t),o())},l=t.call(r&&r.instances[i],e,n,c);let u=Promise.resolve(l);t.length<3&&(u=u.then(c)),u.catch((t=>a(t)))}))}function Ht(t,e,n,r){const i=[];for(const s of t){0;for(const t in s.components){let a=s.components[t];if("beforeRouteEnter"===e||s.instances[t])if($t(a)){const o=a.__vccOpts||a,c=o[e];c&&i.push(jt(c,n,r,s,t))}else{let c=a();0,i.push((()=>c.then((i=>{if(!i)return Promise.reject(new Error(`Couldn't resolve component "${t}" at "${s.path}"`));const a=o(i)?i.default:i;s.components[t]=a;const c=a.__vccOpts||a,l=c[e];return l&&jt(l,n,r,s,t)()}))))}}}return i}function $t(t){return"object"===typeof t||"displayName"in t||"props"in t||"__vccOpts"in t}function Kt(t){const e=(0,r.f3)(Ut),n=(0,r.f3)(Ft),s=(0,r.Fl)((()=>e.resolve((0,i.SU)(t.to)))),o=(0,r.Fl)((()=>{const{matched:t}=s.value,{length:e}=t,r=t[e-1],i=n.matched;if(!r||!i.length)return-1;const o=i.findIndex(y.bind(null,r));if(o>-1)return o;const a=Xt(t[e-2]);return e>1&&Xt(r)===a&&i[i.length-1].path!==a?i.findIndex(y.bind(null,t[e-2])):o})),a=(0,r.Fl)((()=>o.value>-1&&Yt(n.params,s.value.params))),c=(0,r.Fl)((()=>o.value>-1&&o.value===n.matched.length-1&&w(n.params,s.value.params)));function u(n={}){return Wt(n)?e[(0,i.SU)(t.replace)?"replace":"push"]((0,i.SU)(t.to)).catch(l):Promise.resolve()}return{route:s,href:(0,r.Fl)((()=>s.value.href)),isActive:a,isExactActive:c,navigate:u}}const Gt=(0,r.aZ)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Kt,setup(t,{slots:e}){const n=(0,i.qj)(Kt(t)),{options:s}=(0,r.f3)(Ut),o=(0,r.Fl)((()=>({[Qt(t.activeClass,s.linkActiveClass,"router-link-active")]:n.isActive,[Qt(t.exactActiveClass,s.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive})));return()=>{const i=e.default&&e.default(n);return t.custom?i:(0,r.h)("a",{"aria-current":n.isExactActive?t.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:o.value},i)}}}),qt=Gt;function Wt(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&(void 0===t.button||0===t.button)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function Yt(t,e){for(const n in e){const r=e[n],i=t[n];if("string"===typeof r){if(r!==i)return!1}else if(!u(i)||i.length!==r.length||r.some(((t,e)=>t!==i[e])))return!1}return!0}function Xt(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const Qt=(t,e,n)=>null!=t?t:null!=e?e:n,Jt=(0,r.aZ)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:n}){const s=(0,r.f3)(zt),o=(0,r.Fl)((()=>t.route||s.value)),c=(0,r.f3)(Bt,0),l=(0,r.Fl)((()=>{let t=(0,i.SU)(c);const{matched:e}=o.value;let n;while((n=e[t])&&!n.components)t++;return t})),u=(0,r.Fl)((()=>o.value.matched[l.value]));(0,r.JJ)(Bt,(0,r.Fl)((()=>l.value+1))),(0,r.JJ)(Lt,u),(0,r.JJ)(zt,o);const h=(0,i.iH)();return(0,r.YP)((()=>[h.value,u.value,t.name]),(([t,e,n],[r,i,s])=>{e&&(e.instances[n]=t,i&&i!==e&&t&&t===r&&(e.leaveGuards.size||(e.leaveGuards=i.leaveGuards),e.updateGuards.size||(e.updateGuards=i.updateGuards))),!t||!e||i&&y(e,i)&&r||(e.enterCallbacks[n]||[]).forEach((e=>e(t)))}),{flush:"post"}),()=>{const i=o.value,s=t.name,c=u.value,l=c&&c.components[s];if(!l)return Zt(n.default,{Component:l,route:i});const d=c.props[s],f=d?!0===d?i.params:"function"===typeof d?d(i):d:null,p=t=>{t.component.isUnmounted&&(c.instances[s]=null)},g=(0,r.h)(l,a({},f,e,{onVnodeUnmounted:p,ref:h}));return Zt(n.default,{Component:g,route:i})||g}}});function Zt(t,e){if(!t)return null;const n=t(e);return 1===n.length?n[0]:n}const te=Jt;function ee(t){const e=it(t.routes,t),n=t.parseQuery||Pt,o=t.stringifyQuery||xt,h=t.history;const d=Vt(),g=Vt(),y=Vt(),w=(0,i.XI)(j);let b=j;s&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const v=c.bind(null,(t=>""+t)),E=c.bind(null,Dt),S=c.bind(null,Ot);function A(t,n){let r,i;return V(t)?(r=e.getRecordMatcher(t),i=n):i=t,e.addRoute(i,r)}function C(t){const n=e.getRecordMatcher(t);n&&e.removeRoute(n)}function I(){return e.getRoutes().map((t=>t.record))}function T(t){return!!e.getRecordMatcher(t)}function D(t,r){if(r=a({},r||w.value),"string"===typeof t){const i=f(n,t,r.path),s=e.resolve({path:i.path},r),o=h.createHref(i.fullPath);return a(i,s,{params:S(s.params),hash:Ot(i.hash),redirectedFrom:void 0,href:o})}let i;if("path"in t)i=a({},t,{path:f(n,t.path,r.path).path});else{const e=a({},t.params);for(const t in e)null==e[t]&&delete e[t];i=a({},t,{params:E(t.params)}),r.params=E(r.params)}const s=e.resolve(i,r),c=t.hash||"";s.params=v(S(s.params));const l=p(o,a({},t,{hash:Tt(c),path:s.path})),u=h.createHref(l);return a({fullPath:l,hash:c,query:o===xt?Mt(t.query):t.query||{}},s,{redirectedFrom:void 0,href:u})}function x(t){return"string"===typeof t?f(n,t,w.value.path):a({},t)}function M(t,e){if(b!==t)return K(8,{from:e,to:t})}function L(t){return F(t)}function B(t){return L(a(x(t),{replace:!0}))}function U(t){const e=t.matched[t.matched.length-1];if(e&&e.redirect){const{redirect:n}=e;let r="function"===typeof n?n(t):n;return"string"===typeof r&&(r=r.includes("?")||r.includes("#")?r=x(r):{path:r},r.params={}),a({query:t.query,hash:t.hash,params:"path"in r?{}:t.params},r)}}function F(t,e){const n=b=D(t),r=w.value,i=t.state,s=t.force,c=!0===t.replace,l=U(n);if(l)return F(a(x(l),{state:"object"===typeof l?a({},i,l.state):i,force:s,replace:c}),e||n);const u=n;let h;return u.redirectedFrom=e,!s&&m(o,r,n)&&(h=K(16,{to:u,from:r}),nt(r,r,!0,!1)),(h?Promise.resolve(h):H(u,r)).catch((t=>G(t)?G(t,2)?t:et(t):Z(t,u,r))).then((t=>{if(t){if(G(t,2))return F(a({replace:c},x(t.to),{state:"object"===typeof t.to?a({},i,t.to.state):i,force:s}),e||u)}else t=q(u,r,!0,c,i);return $(u,r,t),t}))}function z(t,e){const n=M(t,e);return n?Promise.reject(n):Promise.resolve()}function H(t,e){let n;const[r,i,s]=re(t,e);n=Ht(r.reverse(),"beforeRouteLeave",t,e);for(const a of r)a.leaveGuards.forEach((r=>{n.push(jt(r,t,e))}));const o=z.bind(null,t,e);return n.push(o),ne(n).then((()=>{n=[];for(const r of d.list())n.push(jt(r,t,e));return n.push(o),ne(n)})).then((()=>{n=Ht(i,"beforeRouteUpdate",t,e);for(const r of i)r.updateGuards.forEach((r=>{n.push(jt(r,t,e))}));return n.push(o),ne(n)})).then((()=>{n=[];for(const r of t.matched)if(r.beforeEnter&&!e.matched.includes(r))if(u(r.beforeEnter))for(const i of r.beforeEnter)n.push(jt(i,t,e));else n.push(jt(r.beforeEnter,t,e));return n.push(o),ne(n)})).then((()=>(t.matched.forEach((t=>t.enterCallbacks={})),n=Ht(s,"beforeRouteEnter",t,e),n.push(o),ne(n)))).then((()=>{n=[];for(const r of g.list())n.push(jt(r,t,e));return n.push(o),ne(n)})).catch((t=>G(t,8)?t:Promise.reject(t)))}function $(t,e,n){for(const r of y.list())r(t,e,n)}function q(t,e,n,r,i){const o=M(t,e);if(o)return o;const c=e===j,l=s?history.state:{};n&&(r||c?h.replace(t.fullPath,a({scroll:c&&l&&l.scroll},i)):h.push(t.fullPath,i)),w.value=t,nt(t,e,n,c),et()}let W;function Y(){W||(W=h.listen(((t,e,n)=>{if(!at.listening)return;const r=D(t),i=U(r);if(i)return void F(a(i,{replace:!0}),r).catch(l);b=r;const o=w.value;s&&O(N(o.fullPath,n.delta),k()),H(r,o).catch((t=>G(t,12)?t:G(t,2)?(F(t.to,r).then((t=>{G(t,20)&&!n.delta&&n.type===_.pop&&h.go(-1,!1)})).catch(l),Promise.reject()):(n.delta&&h.go(-n.delta,!1),Z(t,r,o)))).then((t=>{t=t||q(r,o,!1),t&&(n.delta&&!G(t,8)?h.go(-n.delta,!1):n.type===_.pop&&G(t,20)&&h.go(-1,!1)),$(r,o,t)})).catch(l)})))}let X,Q=Vt(),J=Vt();function Z(t,e,n){et(t);const r=J.list();return r.length?r.forEach((r=>r(t,e,n))):console.error(t),Promise.reject(t)}function tt(){return X&&w.value!==j?Promise.resolve():new Promise(((t,e)=>{Q.add([t,e])}))}function et(t){return X||(X=!t,Y(),Q.list().forEach((([e,n])=>t?n(t):e())),Q.reset()),t}function nt(e,n,i,o){const{scrollBehavior:a}=t;if(!s||!a)return Promise.resolve();const c=!i&&P(N(e.fullPath,0))||(o||!i)&&history.state&&history.state.scroll||null;return(0,r.Y3)().then((()=>a(e,n,c))).then((t=>t&&R(t))).catch((t=>Z(t,e,n)))}const rt=t=>h.go(t);let st;const ot=new Set,at={currentRoute:w,listening:!0,addRoute:A,removeRoute:C,hasRoute:T,getRoutes:I,resolve:D,options:t,push:L,replace:B,go:rt,back:()=>rt(-1),forward:()=>rt(1),beforeEach:d.add,beforeResolve:g.add,afterEach:y.add,onError:J.add,isReady:tt,install(t){const e=this;t.component("RouterLink",qt),t.component("RouterView",te),t.config.globalProperties.$router=e,Object.defineProperty(t.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,i.SU)(w)}),s&&!st&&w.value===j&&(st=!0,L(h.location).catch((t=>{0})));const n={};for(const i in j)n[i]=(0,r.Fl)((()=>w.value[i]));t.provide(Ut,e),t.provide(Ft,(0,i.qj)(n)),t.provide(zt,w);const o=t.unmount;ot.add(t),t.unmount=function(){ot.delete(t),ot.size<1&&(b=j,W&&W(),W=null,w.value=j,st=!1,X=!1),o()}}};return at}function ne(t){return t.reduce(((t,e)=>t.then((()=>e()))),Promise.resolve())}function re(t,e){const n=[],r=[],i=[],s=Math.max(e.matched.length,t.matched.length);for(let o=0;o<s;o++){const s=e.matched[o];s&&(t.matched.find((t=>y(t,s)))?r.push(s):n.push(s));const a=t.matched[o];a&&(e.matched.find((t=>y(t,a)))||i.push(a))}return[n,r,i]}},2543:function(t,e,n){"use strict";n.d(e,{xk:function(){return Fo}});var r={};n.r(r),n.d(r,{code:function(){return Ir},createLink:function(){return Ar},createNode:function(){return Sr},decode:function(){return kr},encode:function(){return Tr},name:function(){return Cr},prepare:function(){return Er},validate:function(){return _r}});var i={};n.r(i),n.d(i,{abortedError:function(){return Zi},notFoundError:function(){return Ji}});var s={};n.r(s),n.d(s,{code:function(){return vo},decode:function(){return _o},encode:function(){return Eo},name:function(){return bo}});n(7658);Symbol("TIMEOUT");function o(t){if("function"===typeof t.next)return t;if("function"===typeof t[Symbol.iterator])return t[Symbol.iterator]();if("function"===typeof t[Symbol.asyncIterator])return t[Symbol.asyncIterator]();throw new TypeError('"values" does not to conform to any of the iterator or iterable protocols')}function a(){let t,e;const n=new Promise(((n,r)=>{e=n,t=r}));return{promise:n,reject:t,resolve:e}}function c(t,e,n){const r=o(n),i=[],s=[];let c=!1,l=!1,u=0,h=null;function d(){while(s.length>0&&i.length>0){const{resolve:t}=s.shift(),e=i.shift();t({done:!1,value:e})}while(s.length>0&&0===u&&c){const{resolve:t,reject:e}=s.shift();h?(e(h),h=null):t({done:!0,value:void 0})}}async function f(){if(c)d();else if(!l&&!(u+i.length>=t)){l=!0,u++;try{const{done:t,value:e}=await r.next();t?(c=!0,u--,d()):p(e)}catch(e){c=!0,u--,h=e,d()}l=!1,f()}}async function p(t){try{const n=await e(t);i.push(n)}catch(n){c=!0,h=n}u--,d(),f()}async function g(){if(0===i.length){const t=a();return s.push(t),f(),t.promise}const t=i.shift();return f(),{done:!1,value:t}}const m={next:g,[Symbol.asyncIterator]:()=>m};return m}function l(t,e,n){return void 0===e?(e,n)=>n?l(t,e,n):l(t,e):void 0===n?n=>l(t,e,n):c(t,e,n)}var u=n(9437),h=n(7290),d=n(2100),f=(n(3767),n(8585),n(8696),n(2611)),p=n(9329),g=n(5226);const m=["string","number","bigint","symbol"],y=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function w(t){if(null===t)return"null";if(void 0===t)return"undefined";if(!0===t||!1===t)return"boolean";const e=typeof t;if(m.includes(e))return e;if("function"===e)return"Function";if(Array.isArray(t))return"Array";if(b(t))return"Buffer";const n=v(t);return n||"Object"}function b(t){return t&&t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer.call(null,t)}function v(t){const e=Object.prototype.toString.call(t).slice(8,-1);if(y.includes(e))return e}class E{constructor(t,e,n){this.major=t,this.majorEncoded=t<<5,this.name=e,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(t){return this.major<t.major?-1:this.major>t.major?1:0}}E.uint=new E(0,"uint",!0),E.negint=new E(1,"negint",!0),E.bytes=new E(2,"bytes",!0),E.string=new E(3,"string",!0),E.array=new E(4,"array",!1),E.map=new E(5,"map",!1),E.tag=new E(6,"tag",!1),E.float=new E(7,"float",!0),E.false=new E(7,"false",!0),E.true=new E(7,"true",!0),E.null=new E(7,"null",!0),E.undefined=new E(7,"undefined",!0),E.break=new E(7,"break",!0);class _{constructor(t,e,n){this.type=t,this.value=e,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const S=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"===typeof globalThis.Buffer.isBuffer,A=new TextDecoder,C=new TextEncoder;function I(t){return S&&globalThis.Buffer.isBuffer(t)}function T(t){return t instanceof Uint8Array?I(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t:Uint8Array.from(t)}const k=S?(t,e,n)=>n-e>64?globalThis.Buffer.from(t.subarray(e,n)).toString("utf8"):L(t,e,n):(t,e,n)=>n-e>64?A.decode(t.subarray(e,n)):L(t,e,n),R=S?t=>t.length>64?globalThis.Buffer.from(t):M(t):t=>t.length>64?C.encode(t):M(t),N=t=>Uint8Array.from(t),D=S?(t,e,n)=>I(t)?new Uint8Array(t.subarray(e,n)):t.slice(e,n):(t,e,n)=>t.slice(e,n),O=S?(t,e)=>(t=t.map((t=>t instanceof Uint8Array?t:globalThis.Buffer.from(t))),T(globalThis.Buffer.concat(t,e))):(t,e)=>{const n=new Uint8Array(e);let r=0;for(let i of t)r+i.length>n.length&&(i=i.subarray(0,n.length-r)),n.set(i,r),r+=i.length;return n},P=S?t=>globalThis.Buffer.allocUnsafe(t):t=>new Uint8Array(t);function x(t,e){if(I(t)&&I(e))return t.compare(e);for(let n=0;n<t.length;n++)if(t[n]!==e[n])return t[n]<e[n]?-1:1;return 0}function M(t,e=1/0){let n;const r=t.length;let i=null;const s=[];for(let o=0;o<r;++o){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){if(n>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(o+1===r){(e-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(e-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((e-=1)<0)break;s.push(n)}else if(n<2048){if((e-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((e-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function L(t,e,n){const r=[];while(e<n){const i=t[e];let s=null,o=i>239?4:i>223?3:i>191?2:1;if(e+o<=n){let n,r,a,c;switch(o){case 1:i<128&&(s=i);break;case 2:n=t[e+1],128===(192&n)&&(c=(31&i)<<6|63&n,c>127&&(s=c));break;case 3:n=t[e+1],r=t[e+2],128===(192&n)&&128===(192&r)&&(c=(15&i)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(s=c));break;case 4:n=t[e+1],r=t[e+2],a=t[e+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&i)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(s=c))}}null===s?(s=65533,o=1):s>65535&&(s-=65536,r.push(s>>>10&1023|55296),s=56320|1023&s),r.push(s),e+=o}return U(r)}const B=4096;function U(t){const e=t.length;if(e<=B)return String.fromCharCode.apply(String,t);let n="",r=0;while(r<e)n+=String.fromCharCode.apply(String,t.slice(r,r+=B));return n}const F=256;class z{constructor(t=F){this.chunkSize=t,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(t){let e=this.chunks[this.chunks.length-1];const n=this.cursor+t.length;if(n<=this.maxCursor+1){const n=e.length-(this.maxCursor-this.cursor)-1;e.set(t,n)}else{if(e){const t=e.length-(this.maxCursor-this.cursor)-1;t<e.length&&(this.chunks[this.chunks.length-1]=e.subarray(0,t),this.maxCursor=this.cursor-1)}t.length<64&&t.length<this.chunkSize?(e=P(this.chunkSize),this.chunks.push(e),this.maxCursor+=e.length,null===this._initReuseChunk&&(this._initReuseChunk=e),e.set(t,0)):(this.chunks.push(t),this.maxCursor+=t.length)}this.cursor+=t.length}toBytes(t=!1){let e;if(1===this.chunks.length){const n=this.chunks[0];t&&this.cursor>n.length/2?(e=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):e=D(n,0,this.cursor)}else e=O(this.chunks,this.cursor);return t&&this.reset(),e}}const V="CBOR decode error:",j="CBOR encode error:",H=[];function $(t,e,n){if(t.length-e<n)throw new Error(`${V} not enough data for type`)}H[23]=1,H[24]=2,H[25]=3,H[26]=5,H[27]=9;const K=[24,256,65536,4294967296,BigInt("18446744073709551616")];function G(t,e,n){$(t,e,1);const r=t[e];if(!0===n.strict&&r<K[0])throw new Error(`${V} integer encoded in more bytes than necessary (strict decode)`);return r}function q(t,e,n){$(t,e,2);const r=t[e]<<8|t[e+1];if(!0===n.strict&&r<K[1])throw new Error(`${V} integer encoded in more bytes than necessary (strict decode)`);return r}function W(t,e,n){$(t,e,4);const r=16777216*t[e]+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3];if(!0===n.strict&&r<K[2])throw new Error(`${V} integer encoded in more bytes than necessary (strict decode)`);return r}function Y(t,e,n){$(t,e,8);const r=16777216*t[e]+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3],i=16777216*t[e+4]+(t[e+5]<<16)+(t[e+6]<<8)+t[e+7],s=(BigInt(r)<<BigInt(32))+BigInt(i);if(!0===n.strict&&s<K[3])throw new Error(`${V} integer encoded in more bytes than necessary (strict decode)`);if(s<=Number.MAX_SAFE_INTEGER)return Number(s);if(!0===n.allowBigInt)return s;throw new Error(`${V} integers outside of the safe integer range are not supported`)}function X(t,e,n,r){return new _(E.uint,G(t,e+1,r),2)}function Q(t,e,n,r){return new _(E.uint,q(t,e+1,r),3)}function J(t,e,n,r){return new _(E.uint,W(t,e+1,r),5)}function Z(t,e,n,r){return new _(E.uint,Y(t,e+1,r),9)}function tt(t,e){return et(t,0,e.value)}function et(t,e,n){if(n<K[0]){const r=Number(n);t.push([e|r])}else if(n<K[1]){const r=Number(n);t.push([24|e,r])}else if(n<K[2]){const r=Number(n);t.push([25|e,r>>>8,255&r])}else if(n<K[3]){const r=Number(n);t.push([26|e,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<K[4]))throw new Error(`${V} encountered BigInt larger than allowable range`);{const n=[27|e,0,0,0,0,0,0,0];let i=Number(r&BigInt(4294967295)),s=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&i,i>>=8,n[7]=255&i,i>>=8,n[6]=255&i,i>>=8,n[5]=255&i,n[4]=255&s,s>>=8,n[3]=255&s,s>>=8,n[2]=255&s,s>>=8,n[1]=255&s,t.push(n)}}}function nt(t,e,n,r){return new _(E.negint,-1-G(t,e+1,r),2)}function rt(t,e,n,r){return new _(E.negint,-1-q(t,e+1,r),3)}function it(t,e,n,r){return new _(E.negint,-1-W(t,e+1,r),5)}tt.encodedSize=function(t){return et.encodedSize(t.value)},et.encodedSize=function(t){return t<K[0]?1:t<K[1]?2:t<K[2]?3:t<K[3]?5:9},tt.compareTokens=function(t,e){return t.value<e.value?-1:t.value>e.value?1:0};const st=BigInt(-1),ot=BigInt(1);function at(t,e,n,r){const i=Y(t,e+1,r);if("bigint"!==typeof i){const t=-1-i;if(t>=Number.MIN_SAFE_INTEGER)return new _(E.negint,t,9)}if(!0!==r.allowBigInt)throw new Error(`${V} integers outside of the safe integer range are not supported`);return new _(E.negint,st-BigInt(i),9)}function ct(t,e){const n=e.value,r="bigint"===typeof n?n*st-ot:-1*n-1;et(t,e.type.majorEncoded,r)}function lt(t,e,n,r){$(t,e,n+r);const i=D(t,e+n,e+n+r);return new _(E.bytes,i,n+r)}function ut(t,e,n,r){return lt(t,e,1,n)}function ht(t,e,n,r){return lt(t,e,2,G(t,e+1,r))}function dt(t,e,n,r){return lt(t,e,3,q(t,e+1,r))}function ft(t,e,n,r){return lt(t,e,5,W(t,e+1,r))}function pt(t,e,n,r){const i=Y(t,e+1,r);if("bigint"===typeof i)throw new Error(`${V} 64-bit integer bytes lengths not supported`);return lt(t,e,9,i)}function gt(t){return void 0===t.encodedBytes&&(t.encodedBytes=t.type===E.string?R(t.value):t.value),t.encodedBytes}function mt(t,e){const n=gt(e);et(t,e.type.majorEncoded,n.length),t.push(n)}function yt(t,e){return t.length<e.length?-1:t.length>e.length?1:x(t,e)}function wt(t,e,n,r,i){const s=n+r;$(t,e,s);const o=new _(E.string,k(t,e+n,e+s),s);return!0===i.retainStringBytes&&(o.byteValue=D(t,e+n,e+s)),o}function bt(t,e,n,r){return wt(t,e,1,n,r)}function vt(t,e,n,r){return wt(t,e,2,G(t,e+1,r),r)}function Et(t,e,n,r){return wt(t,e,3,q(t,e+1,r),r)}function _t(t,e,n,r){return wt(t,e,5,W(t,e+1,r),r)}function St(t,e,n,r){const i=Y(t,e+1,r);if("bigint"===typeof i)throw new Error(`${V} 64-bit integer string lengths not supported`);return wt(t,e,9,i,r)}ct.encodedSize=function(t){const e=t.value,n="bigint"===typeof e?e*st-ot:-1*e-1;return n<K[0]?1:n<K[1]?2:n<K[2]?3:n<K[3]?5:9},ct.compareTokens=function(t,e){return t.value<e.value?1:t.value>e.value?-1:0},mt.encodedSize=function(t){const e=gt(t);return et.encodedSize(e.length)+e.length},mt.compareTokens=function(t,e){return yt(gt(t),gt(e))};const At=mt;function Ct(t,e,n,r){return new _(E.array,r,n)}function It(t,e,n,r){return Ct(t,e,1,n)}function Tt(t,e,n,r){return Ct(t,e,2,G(t,e+1,r))}function kt(t,e,n,r){return Ct(t,e,3,q(t,e+1,r))}function Rt(t,e,n,r){return Ct(t,e,5,W(t,e+1,r))}function Nt(t,e,n,r){const i=Y(t,e+1,r);if("bigint"===typeof i)throw new Error(`${V} 64-bit integer array lengths not supported`);return Ct(t,e,9,i)}function Dt(t,e,n,r){if(!1===r.allowIndefinite)throw new Error(`${V} indefinite length items not allowed`);return Ct(t,e,1,1/0)}function Ot(t,e){et(t,E.array.majorEncoded,e.value)}function Pt(t,e,n,r){return new _(E.map,r,n)}function xt(t,e,n,r){return Pt(t,e,1,n)}function Mt(t,e,n,r){return Pt(t,e,2,G(t,e+1,r))}function Lt(t,e,n,r){return Pt(t,e,3,q(t,e+1,r))}function Bt(t,e,n,r){return Pt(t,e,5,W(t,e+1,r))}function Ut(t,e,n,r){const i=Y(t,e+1,r);if("bigint"===typeof i)throw new Error(`${V} 64-bit integer map lengths not supported`);return Pt(t,e,9,i)}function Ft(t,e,n,r){if(!1===r.allowIndefinite)throw new Error(`${V} indefinite length items not allowed`);return Pt(t,e,1,1/0)}function zt(t,e){et(t,E.map.majorEncoded,e.value)}function Vt(t,e,n,r){return new _(E.tag,n,1)}function jt(t,e,n,r){return new _(E.tag,G(t,e+1,r),2)}function Ht(t,e,n,r){return new _(E.tag,q(t,e+1,r),3)}function $t(t,e,n,r){return new _(E.tag,W(t,e+1,r),5)}function Kt(t,e,n,r){return new _(E.tag,Y(t,e+1,r),9)}function Gt(t,e){et(t,E.tag.majorEncoded,e.value)}Ot.compareTokens=tt.compareTokens,Ot.encodedSize=function(t){return et.encodedSize(t.value)},zt.compareTokens=tt.compareTokens,zt.encodedSize=function(t){return et.encodedSize(t.value)},Gt.compareTokens=tt.compareTokens,Gt.encodedSize=function(t){return et.encodedSize(t.value)};const qt=20,Wt=21,Yt=22,Xt=23;function Qt(t,e,n,r){if(!1===r.allowUndefined)throw new Error(`${V} undefined values are not supported`);return!0===r.coerceUndefinedToNull?new _(E["null"],null,1):new _(E.undefined,void 0,1)}function Jt(t,e,n,r){if(!1===r.allowIndefinite)throw new Error(`${V} indefinite length items not allowed`);return new _(E["break"],void 0,1)}function Zt(t,e,n){if(n){if(!1===n.allowNaN&&Number.isNaN(t))throw new Error(`${V} NaN values are not supported`);if(!1===n.allowInfinity&&(t===1/0||t===-1/0))throw new Error(`${V} Infinity values are not supported`)}return new _(E.float,t,e)}function te(t,e,n,r){return Zt(ce(t,e+1),3,r)}function ee(t,e,n,r){return Zt(ue(t,e+1),5,r)}function ne(t,e,n,r){return Zt(de(t,e+1),9,r)}function re(t,e,n){const r=e.value;if(!1===r)t.push([E.float.majorEncoded|qt]);else if(!0===r)t.push([E.float.majorEncoded|Wt]);else if(null===r)t.push([E.float.majorEncoded|Yt]);else if(void 0===r)t.push([E.float.majorEncoded|Xt]);else{let e,i=!1;n&&!0===n.float64||(ae(r),e=ce(oe,1),r===e||Number.isNaN(r)?(oe[0]=249,t.push(oe.slice(0,3)),i=!0):(le(r),e=ue(oe,1),r===e&&(oe[0]=250,t.push(oe.slice(0,5)),i=!0))),i||(he(r),e=de(oe,1),oe[0]=251,t.push(oe.slice(0,9)))}}re.encodedSize=function(t,e){const n=t.value;if(!1===n||!0===n||null===n||void 0===n)return 1;if(!e||!0!==e.float64){ae(n);let t=ce(oe,1);if(n===t||Number.isNaN(n))return 3;if(le(n),t=ue(oe,1),n===t)return 5}return 9};const ie=new ArrayBuffer(9),se=new DataView(ie,1),oe=new Uint8Array(ie,0);function ae(t){if(t===1/0)se.setUint16(0,31744,!1);else if(t===-1/0)se.setUint16(0,64512,!1);else if(Number.isNaN(t))se.setUint16(0,32256,!1);else{se.setFloat32(0,t);const e=se.getUint32(0),n=(2139095040&e)>>23,r=8388607&e;if(255===n)se.setUint16(0,31744,!1);else if(0===n)se.setUint16(0,(2147483648&t)>>16|r>>13,!1);else{const t=n-127;t<-24?se.setUint16(0,0):t<-14?se.setUint16(0,(2147483648&e)>>16|1<<24+t,!1):se.setUint16(0,(2147483648&e)>>16|t+15<<10|r>>13,!1)}}}function ce(t,e){if(t.length-e<2)throw new Error(`${V} not enough data for float16`);const n=(t[e]<<8)+t[e+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,i=1023&n;let s;return s=0===r?i*2**-24:31!==r?(i+1024)*2**(r-25):0===i?1/0:NaN,32768&n?-s:s}function le(t){se.setFloat32(0,t,!1)}function ue(t,e){if(t.length-e<4)throw new Error(`${V} not enough data for float32`);const n=(t.byteOffset||0)+e;return new DataView(t.buffer,n,4).getFloat32(0,!1)}function he(t){se.setFloat64(0,t,!1)}function de(t,e){if(t.length-e<8)throw new Error(`${V} not enough data for float64`);const n=(t.byteOffset||0)+e;return new DataView(t.buffer,n,8).getFloat64(0,!1)}function fe(t,e,n){throw new Error(`${V} encountered invalid minor (${n}) for major ${t[e]>>>5}`)}function pe(t){return()=>{throw new Error(`${V} ${t}`)}}re.compareTokens=tt.compareTokens;const ge=[];for(let Ko=0;Ko<=23;Ko++)ge[Ko]=fe;ge[24]=X,ge[25]=Q,ge[26]=J,ge[27]=Z,ge[28]=fe,ge[29]=fe,ge[30]=fe,ge[31]=fe;for(let Ko=32;Ko<=55;Ko++)ge[Ko]=fe;ge[56]=nt,ge[57]=rt,ge[58]=it,ge[59]=at,ge[60]=fe,ge[61]=fe,ge[62]=fe,ge[63]=fe;for(let Ko=64;Ko<=87;Ko++)ge[Ko]=ut;ge[88]=ht,ge[89]=dt,ge[90]=ft,ge[91]=pt,ge[92]=fe,ge[93]=fe,ge[94]=fe,ge[95]=pe("indefinite length bytes/strings are not supported");for(let Ko=96;Ko<=119;Ko++)ge[Ko]=bt;ge[120]=vt,ge[121]=Et,ge[122]=_t,ge[123]=St,ge[124]=fe,ge[125]=fe,ge[126]=fe,ge[127]=pe("indefinite length bytes/strings are not supported");for(let Ko=128;Ko<=151;Ko++)ge[Ko]=It;ge[152]=Tt,ge[153]=kt,ge[154]=Rt,ge[155]=Nt,ge[156]=fe,ge[157]=fe,ge[158]=fe,ge[159]=Dt;for(let Ko=160;Ko<=183;Ko++)ge[Ko]=xt;ge[184]=Mt,ge[185]=Lt,ge[186]=Bt,ge[187]=Ut,ge[188]=fe,ge[189]=fe,ge[190]=fe,ge[191]=Ft;for(let Ko=192;Ko<=215;Ko++)ge[Ko]=Vt;ge[216]=jt,ge[217]=Ht,ge[218]=$t,ge[219]=Kt,ge[220]=fe,ge[221]=fe,ge[222]=fe,ge[223]=fe;for(let Ko=224;Ko<=243;Ko++)ge[Ko]=pe("simple values are not supported");ge[244]=fe,ge[245]=fe,ge[246]=fe,ge[247]=Qt,ge[248]=pe("simple values are not supported"),ge[249]=te,ge[250]=ee,ge[251]=ne,ge[252]=fe,ge[253]=fe,ge[254]=fe,ge[255]=Jt;const me=[];for(let Ko=0;Ko<24;Ko++)me[Ko]=new _(E.uint,Ko,1);for(let Ko=-1;Ko>=-24;Ko--)me[31-Ko]=new _(E.negint,Ko,1);function ye(t){switch(t.type){case E["false"]:return N([244]);case E["true"]:return N([245]);case E["null"]:return N([246]);case E.bytes:return t.value.length?void 0:N([64]);case E.string:return""===t.value?N([96]):void 0;case E.array:return 0===t.value?N([128]):void 0;case E.map:return 0===t.value?N([160]):void 0;case E.uint:return t.value<24?N([Number(t.value)]):void 0;case E.negint:if(t.value>=-24)return N([31-Number(t.value)])}}me[64]=new _(E.bytes,new Uint8Array(0),1),me[96]=new _(E.string,"",1),me[128]=new _(E.array,0,1),me[160]=new _(E.map,0,1),me[244]=new _(E["false"],!1,1),me[245]=new _(E["true"],!0,1),me[246]=new _(E["null"],null,1);const we={float64:!1,mapSorter:Te,quickEncodeToken:ye};function be(){const t=[];return t[E.uint.major]=tt,t[E.negint.major]=ct,t[E.bytes.major]=mt,t[E.string.major]=At,t[E.array.major]=Ot,t[E.map.major]=zt,t[E.tag.major]=Gt,t[E.float.major]=re,t}const ve=be(),Ee=new z;class _e{constructor(t,e){this.obj=t,this.parent=e}includes(t){let e=this;do{if(e.obj===t)return!0}while(e=e.parent);return!1}static createCheck(t,e){if(t&&t.includes(e))throw new Error(`${j} object contains circular references`);return new _e(e,t)}}const Se={null:new _(E["null"],null),undefined:new _(E.undefined,void 0),true:new _(E["true"],!0),false:new _(E["false"],!1),emptyArray:new _(E.array,0),emptyMap:new _(E.map,0)},Ae={number(t,e,n,r){return Number.isInteger(t)&&Number.isSafeInteger(t)?new _(t>=0?E.uint:E.negint,t):new _(E.float,t)},bigint(t,e,n,r){return t>=BigInt(0)?new _(E.uint,t):new _(E.negint,t)},Uint8Array(t,e,n,r){return new _(E.bytes,t)},string(t,e,n,r){return new _(E.string,t)},boolean(t,e,n,r){return t?Se.true:Se.false},null(t,e,n,r){return Se.null},undefined(t,e,n,r){return Se.undefined},ArrayBuffer(t,e,n,r){return new _(E.bytes,new Uint8Array(t))},DataView(t,e,n,r){return new _(E.bytes,new Uint8Array(t.buffer,t.byteOffset,t.byteLength))},Array(t,e,n,r){if(!t.length)return!0===n.addBreakTokens?[Se.emptyArray,new _(E["break"])]:Se.emptyArray;r=_e.createCheck(r,t);const i=[];let s=0;for(const o of t)i[s++]=Ce(o,n,r);return n.addBreakTokens?[new _(E.array,t.length),i,new _(E["break"])]:[new _(E.array,t.length),i]},Object(t,e,n,r){const i="Object"!==e,s=i?t.keys():Object.keys(t),o=i?t.size:s.length;if(!o)return!0===n.addBreakTokens?[Se.emptyMap,new _(E["break"])]:Se.emptyMap;r=_e.createCheck(r,t);const a=[];let c=0;for(const l of s)a[c++]=[Ce(l,n,r),Ce(i?t.get(l):t[l],n,r)];return Ie(a,n),n.addBreakTokens?[new _(E.map,o),a,new _(E["break"])]:[new _(E.map,o),a]}};Ae.Map=Ae.Object,Ae.Buffer=Ae.Uint8Array;for(const Ko of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Ae[`${Ko}Array`]=Ae.DataView;function Ce(t,e={},n){const r=w(t),i=e&&e.typeEncoders&&e.typeEncoders[r]||Ae[r];if("function"===typeof i){const s=i(t,r,e,n);if(null!=s)return s}const s=Ae[r];if(!s)throw new Error(`${j} unsupported type: ${r}`);return s(t,r,e,n)}function Ie(t,e){e.mapSorter&&t.sort(e.mapSorter)}function Te(t,e){const n=Array.isArray(t[0])?t[0][0]:t[0],r=Array.isArray(e[0])?e[0][0]:e[0];if(n.type!==r.type)return n.type.compare(r.type);const i=n.type.major,s=ve[i].compareTokens(n,r);return 0===s&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),s}function ke(t,e,n,r){if(Array.isArray(e))for(const i of e)ke(t,i,n,r);else n[e.type.major](t,e,r)}function Re(t,e,n){const r=Ce(t,n);if(!Array.isArray(r)&&n.quickEncodeToken){const t=n.quickEncodeToken(r);if(t)return t;const i=e[r.type.major];if(i.encodedSize){const t=i.encodedSize(r,n),e=new z(t);if(i(e,r,n),1!==e.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return T(e.chunks[0])}}return Ee.reset(),ke(Ee,r,e,n),Ee.toBytes(!0)}function Ne(t,e){return e=Object.assign({},we,e),Re(t,ve,e)}const De={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Oe{constructor(t,e={}){this.pos=0,this.data=t,this.options=e}done(){return this.pos>=this.data.length}next(){const t=this.data[this.pos];let e=me[t];if(void 0===e){const n=ge[t];if(!n)throw new Error(`${V} no decoder for major type ${t>>>5} (byte 0x${t.toString(16).padStart(2,"0")})`);const r=31&t;e=n(this.data,this.pos,r,this.options)}return this.pos+=e.encodedLength,e}}const Pe=Symbol.for("DONE"),xe=Symbol.for("BREAK");function Me(t,e,n){const r=[];for(let i=0;i<t.value;i++){const s=Be(e,n);if(s===xe){if(t.value===1/0)break;throw new Error(`${V} got unexpected break to lengthed array`)}if(s===Pe)throw new Error(`${V} found array but not enough entries (got ${i}, expected ${t.value})`);r[i]=s}return r}function Le(t,e,n){const r=!0===n.useMaps,i=r?void 0:{},s=r?new Map:void 0;for(let o=0;o<t.value;o++){const a=Be(e,n);if(a===xe){if(t.value===1/0)break;throw new Error(`${V} got unexpected break to lengthed map`)}if(a===Pe)throw new Error(`${V} found map but not enough entries (got ${o} [no key], expected ${t.value})`);if(!0!==r&&"string"!==typeof a)throw new Error(`${V} non-string keys not supported (got ${typeof a})`);if(!0===n.rejectDuplicateMapKeys&&(r&&s.has(a)||!r&&a in i))throw new Error(`${V} found repeat map key "${a}"`);const c=Be(e,n);if(c===Pe)throw new Error(`${V} found map but not enough entries (got ${o} [no value], expected ${t.value})`);r?s.set(a,c):i[a]=c}return r?s:i}function Be(t,e){if(t.done())return Pe;const n=t.next();if(n.type===E["break"])return xe;if(n.type.terminal)return n.value;if(n.type===E.array)return Me(n,t,e);if(n.type===E.map)return Le(n,t,e);if(n.type===E.tag){if(e.tags&&"function"===typeof e.tags[n.value]){const r=Be(t,e);return e.tags[n.value](r)}throw new Error(`${V} tag not supported (${n.value})`)}throw new Error("unsupported")}function Ue(t,e){if(!(t instanceof Uint8Array))throw new Error(`${V} data to decode must be a Uint8Array`);e=Object.assign({},De,e);const n=e.tokenizer||new Oe(t,e),r=Be(n,e);if(r===Pe)throw new Error(`${V} did not find any content to decode`);if(r===xe)throw new Error(`${V} got unexpected break`);if(!n.done())throw new Error(`${V} too many terminals, data makes no sense`);return r}const Fe=42;function ze(t){if(t.asCID!==t)return null;const e=p.k.asCID(t);if(!e)return null;const n=new Uint8Array(e.bytes.byteLength+1);return n.set(e.bytes,1),[new _(E.tag,Fe),new _(E.bytes,n)]}function Ve(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function je(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const He={float64:!0,typeEncoders:{Object:ze,undefined:Ve,number:je}};function $e(t){if(0!==t[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return p.k.decode(t.subarray(1))}const Ke={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};Ke.tags[Fe]=$e;const Ge=113,qe=t=>Ne(t,He),We=t=>Ue(t,Ke),Ye={SHA2_256:18,LENGTH:32,DAG_PB:112};async function Xe(t){const e=await t.upTo(8),n=f.decode(e);return t.seek(f.decode.bytes),n}async function Qe(t){const e=await Xe(t);if(0===e)throw new Error("Invalid CAR header (zero length)");const n=await t.exactly(e);t.seek(e);const r=We(n);if(null==r||Array.isArray(r)||"object"!==typeof r)throw new Error("Invalid CAR header format");if(1!==r.version){if("string"===typeof r.version)throw new Error(`Invalid CAR version: "${r.version}"`);throw new Error(`Invalid CAR version: ${r.version}`)}if(!Array.isArray(r.roots))throw new Error("Invalid CAR header format");if(Object.keys(r).filter((t=>"roots"!==t&&"version"!==t)).length)throw new Error("Invalid CAR header format");return r}async function Je(t){const e=await t.upTo(8);f.decode(e);const n=f.decode.bytes,r=f.decode(e.subarray(f.decode.bytes)),i=f.decode.bytes,s=n+i+r,o=await t.exactly(s);return t.seek(s),o}async function Ze(t){const e=await t.exactly(2);if(e[0]===Ye.SHA2_256&&e[1]===Ye.LENGTH){const e=await t.exactly(34);t.seek(34);const n=g.Jx(e);return p.k.create(0,Ye.DAG_PB,n)}const n=await Xe(t);if(1!==n)throw new Error(`Unexpected CID version (${n})`);const r=await Xe(t),i=await Je(t),s=g.Jx(i);return p.k.create(n,r,s)}async function tn(t){const e=t.pos;let n=await Xe(t);if(0===n)throw new Error("Invalid CAR section (zero length)");n+=t.pos-e;const r=await Ze(t),i=n-(t.pos-e);return{cid:r,length:n,blockLength:i}}async function en(t){const{cid:e,blockLength:n}=await tn(t),r=await t.exactly(n);return t.seek(n),{bytes:r,cid:e}}async function nn(t){const e=t.pos,{cid:n,length:r,blockLength:i}=await tn(t),s={cid:n,length:r,blockLength:i,offset:e,blockOffset:t.pos};return t.seek(s.blockLength),s}function rn(t){const e=Qe(t);return{header:()=>e,async*blocks(){await e;while((await t.upTo(8)).length>0)yield await en(t)},async*blocksIndex(){await e;while((await t.upTo(8)).length>0)yield await nn(t)}}}function sn(t){let e=0;return{async upTo(n){return t.subarray(e,e+Math.min(n,t.length-e))},async exactly(n){if(n>t.length-e)throw new Error("Unexpected end of data");return t.subarray(e,e+n)},seek(t){e+=t},get pos(){return e}}}function on(t){let e=0,n=0,r=0,i=new Uint8Array(0);const s=async e=>{n=i.length-r;const s=[i.subarray(r)];while(n<e){const e=await t();if(null==e)break;n<0?e.length>n&&s.push(e.subarray(-n)):s.push(e),n+=e.length}i=new Uint8Array(s.reduce(((t,e)=>t+e.length),0));let o=0;for(const t of s)i.set(t,o),o+=t.length;r=0};return{async upTo(t){return i.length-r<t&&await s(t),i.subarray(r,r+Math.min(i.length-r,t))},async exactly(t){if(i.length-r<t&&await s(t),i.length-r<t)throw new Error("Unexpected end of data");return i.subarray(r,r+t)},seek(t){e+=t,r+=t},get pos(){return e}}}function an(t){const e=t[Symbol.asyncIterator]();async function n(){const t=await e.next();return t.done?null:t.value}return on(n)}class cn{constructor(t,e,n){this._version=t,this._roots=e,this._blocks=n,this._keys=n.map((t=>t.cid.toString()))}get version(){return this._version}async getRoots(){return this._roots}async has(t){return this._keys.indexOf(t.toString())>-1}async get(t){const e=this._keys.indexOf(t.toString());return e>-1?this._blocks[e]:void 0}async*blocks(){for(const t of this._blocks)yield t}async*cids(){for(const t of this._blocks)yield t.cid}static async fromBytes(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return ln(sn(t))}static async fromIterable(t){if(!t||"function"!==typeof t[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return ln(an(t))}}async function ln(t){const e=rn(t),{version:n,roots:r}=await e.header(),i=[];for await(const s of e.blocks())i.push(s);return new cn(n,r,i)}class un{constructor(t,e,n){this._version=t,this._roots=e,this._iterator=n}get version(){return this._version}async getRoots(){return this._roots}[Symbol.asyncIterator](){return this._iterator}static async fromBytes(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return decodeIndexerComplete(bytesReader(t))}static async fromIterable(t){if(!t||"function"!==typeof t[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return decodeIndexerComplete(asyncIterableReader(t))}}class hn{constructor(t,e,n){this._version=t,this._roots=e,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class dn extends hn{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(t){const{version:e,roots:n,iterator:r}=await pn(t);return new dn(e,n,r)}static async fromIterable(t){const{version:e,roots:n,iterator:r}=await gn(t);return new dn(e,n,r)}}class fn extends(null){[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;const t=this._iterable[Symbol.asyncIterator]();return{async next(){const e=await t.next();return e.done?e:{done:!1,value:e.value.cid}}}}static async fromBytes(t){const{version:e,roots:n,iterator:r}=await pn(t);return new fn(e,n,r)}static async fromIterable(t){const{version:e,roots:n,iterator:r}=await gn(t);return new fn(e,n,r)}}async function pn(t){if(!(t instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return mn(sn(t))}async function gn(t){if(!t||"function"!==typeof t[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return mn(an(t))}async function mn(t){const e=rn(t),{version:n,roots:r}=await e.header();return{version:n,roots:r,iterator:e.blocks()}}function yn(t){const e=qe({version:1,roots:t}),n=f.encode(e.length),r=new Uint8Array(n.length+e.length);return r.set(n,0),r.set(e,n.length),r}function wn(t){return{async setRoots(e){const n=yn(e);await t.write(n)},async writeBlock(e){const{cid:n,bytes:r}=e;await t.write(new Uint8Array(f.encode(n.bytes.length+r.length))),await t.write(n.bytes),r.length&&await t.write(r)},async close(){return t.end()}}}function bn(){}function vn(){const t=[];let e=null,n=bn,r=!1,i=null,s=bn;const o=()=>(e||(e=new Promise((t=>{n=()=>{e=null,n=bn,t()}}))),e),a={write(e){t.push(e);const n=o();return s(),n},async end(){r=!0;const t=o();return s(),t}},c={async next(){const e=t.shift();return e?(0===t.length&&n(),{done:!1,value:e}):r?(n(),{done:!0,value:void 0}):(i||(i=new Promise((t=>{s=()=>(i=null,s=bn,t(c.next()))}))),i)}};return{writer:a,iterator:c}}class En{constructor(t,e){this._encoder=e,this._mutex=e.setRoots(t),this._ended=!1}async put(t){if(!(t.bytes instanceof Uint8Array)||!t.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const e=p.k.asCID(t.cid);if(!e)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then((()=>this._encoder.writeBlock({cid:e,bytes:t.bytes}))),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(t){t=An(t);const{encoder:e,iterator:n}=Sn(),r=new En(t,e),i=new _n(n);return{writer:r,out:i}}static createAppender(){const{encoder:t,iterator:e}=Sn();t.setRoots=()=>Promise.resolve();const n=new En([],t),r=new _n(e);return{writer:n,out:r}}static async updateRootsInBytes(t,e){const n=sn(t);await Qe(n);const r=yn(e);if(n.pos!==r.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${r.length} bytes)`);return t.set(r,0),t}}class _n{constructor(t){this._iterator=t}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function Sn(){const t=vn(),{writer:e,iterator:n}=t,r=wn(e);return{encoder:r,iterator:n}}function An(t){if(void 0===t)return[];if(!Array.isArray(t)){const e=p.k.asCID(t);if(!e)throw new TypeError("roots must be a single CID or an array of CIDs");return[e]}const e=[];for(const n of t){const t=p.k.asCID(n);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");e.push(t)}return e}var Cn=n(8806),In=n(535),Tn=In,kn=n(1919),Rn=n(8212),Nn=n(2493),Dn=n(716);function On(t){const e=new Array(4);for(let n=0;n<4;n++)e[n]=255&t,t>>=8;return new Uint8Array(e)}(0,Rn.D)({name:"murmur3-32",code:35,encode:t=>On(Dn.x86.hash32(t))});const Pn=(0,Rn.D)({name:"murmur3-128",code:34,encode:t=>Nn.aI.fromHex(Dn.x64.hash128(t))});async function xn(t){return(await Pn.encode(t)).slice(0,8).reverse()}const Mn={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:kn.sha256,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:xn,hamtHashCode:34,hamtBucketBits:8};var Ln=(t={})=>{const e=Tn.bind({ignoreUndefined:!0});return e(Mn,t)},Bn=n(9998),Un=n(6425);const Fn=Un.Reader,zn=Un.Writer,Vn=Un.util,jn=Un.roots["ipfs-unixfs"]||(Un.roots["ipfs-unixfs"]={}),Hn=jn.Data=(()=>{function t(t){if(this.blocksizes=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.Type=0,t.prototype.Data=Vn.newBuffer([]),t.prototype.filesize=Vn.Long?Vn.Long.fromBits(0,0,!0):0,t.prototype.blocksizes=Vn.emptyArray,t.prototype.hashType=Vn.Long?Vn.Long.fromBits(0,0,!0):0,t.prototype.fanout=Vn.Long?Vn.Long.fromBits(0,0,!0):0,t.prototype.mode=0,t.prototype.mtime=null,t.encode=function(t,e){if(e||(e=zn.create()),e.uint32(8).int32(t.Type),null!=t.Data&&Object.hasOwnProperty.call(t,"Data")&&e.uint32(18).bytes(t.Data),null!=t.filesize&&Object.hasOwnProperty.call(t,"filesize")&&e.uint32(24).uint64(t.filesize),null!=t.blocksizes&&t.blocksizes.length)for(var n=0;n<t.blocksizes.length;++n)e.uint32(32).uint64(t.blocksizes[n]);return null!=t.hashType&&Object.hasOwnProperty.call(t,"hashType")&&e.uint32(40).uint64(t.hashType),null!=t.fanout&&Object.hasOwnProperty.call(t,"fanout")&&e.uint32(48).uint64(t.fanout),null!=t.mode&&Object.hasOwnProperty.call(t,"mode")&&e.uint32(56).uint32(t.mode),null!=t.mtime&&Object.hasOwnProperty.call(t,"mtime")&&jn.UnixTime.encode(t.mtime,e.uint32(66).fork()).ldelim(),e},t.decode=function(t,e){t instanceof Fn||(t=Fn.create(t));var n=void 0===e?t.len:t.pos+e,r=new jn.Data;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.Type=t.int32();break;case 2:r.Data=t.bytes();break;case 3:r.filesize=t.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2===(7&i)){var s=t.uint32()+t.pos;while(t.pos<s)r.blocksizes.push(t.uint64())}else r.blocksizes.push(t.uint64());break;case 5:r.hashType=t.uint64();break;case 6:r.fanout=t.uint64();break;case 7:r.mode=t.uint32();break;case 8:r.mtime=jn.UnixTime.decode(t,t.uint32());break;default:t.skipType(7&i);break}}if(!r.hasOwnProperty("Type"))throw Vn.ProtocolError("missing required 'Type'",{instance:r});return r},t.fromObject=function(t){if(t instanceof jn.Data)return t;var e=new jn.Data;switch(t.Type){case"Raw":case 0:e.Type=0;break;case"Directory":case 1:e.Type=1;break;case"File":case 2:e.Type=2;break;case"Metadata":case 3:e.Type=3;break;case"Symlink":case 4:e.Type=4;break;case"HAMTShard":case 5:e.Type=5;break}if(null!=t.Data&&("string"===typeof t.Data?Vn.base64.decode(t.Data,e.Data=Vn.newBuffer(Vn.base64.length(t.Data)),0):t.Data.length&&(e.Data=t.Data)),null!=t.filesize&&(Vn.Long?(e.filesize=Vn.Long.fromValue(t.filesize)).unsigned=!0:"string"===typeof t.filesize?e.filesize=parseInt(t.filesize,10):"number"===typeof t.filesize?e.filesize=t.filesize:"object"===typeof t.filesize&&(e.filesize=new Vn.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0))),t.blocksizes){if(!Array.isArray(t.blocksizes))throw TypeError(".Data.blocksizes: array expected");e.blocksizes=[];for(var n=0;n<t.blocksizes.length;++n)Vn.Long?(e.blocksizes[n]=Vn.Long.fromValue(t.blocksizes[n])).unsigned=!0:"string"===typeof t.blocksizes[n]?e.blocksizes[n]=parseInt(t.blocksizes[n],10):"number"===typeof t.blocksizes[n]?e.blocksizes[n]=t.blocksizes[n]:"object"===typeof t.blocksizes[n]&&(e.blocksizes[n]=new Vn.LongBits(t.blocksizes[n].low>>>0,t.blocksizes[n].high>>>0).toNumber(!0))}if(null!=t.hashType&&(Vn.Long?(e.hashType=Vn.Long.fromValue(t.hashType)).unsigned=!0:"string"===typeof t.hashType?e.hashType=parseInt(t.hashType,10):"number"===typeof t.hashType?e.hashType=t.hashType:"object"===typeof t.hashType&&(e.hashType=new Vn.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0))),null!=t.fanout&&(Vn.Long?(e.fanout=Vn.Long.fromValue(t.fanout)).unsigned=!0:"string"===typeof t.fanout?e.fanout=parseInt(t.fanout,10):"number"===typeof t.fanout?e.fanout=t.fanout:"object"===typeof t.fanout&&(e.fanout=new Vn.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0))),null!=t.mode&&(e.mode=t.mode>>>0),null!=t.mtime){if("object"!==typeof t.mtime)throw TypeError(".Data.mtime: object expected");e.mtime=jn.UnixTime.fromObject(t.mtime)}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.blocksizes=[]),e.defaults){if(n.Type=e.enums===String?"Raw":0,e.bytes===String?n.Data="":(n.Data=[],e.bytes!==Array&&(n.Data=Vn.newBuffer(n.Data))),Vn.Long){var r=new Vn.Long(0,0,!0);n.filesize=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.filesize=e.longs===String?"0":0;if(Vn.Long){r=new Vn.Long(0,0,!0);n.hashType=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.hashType=e.longs===String?"0":0;if(Vn.Long){r=new Vn.Long(0,0,!0);n.fanout=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.fanout=e.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=t.Type&&t.hasOwnProperty("Type")&&(n.Type=e.enums===String?jn.Data.DataType[t.Type]:t.Type),null!=t.Data&&t.hasOwnProperty("Data")&&(n.Data=e.bytes===String?Vn.base64.encode(t.Data,0,t.Data.length):e.bytes===Array?Array.prototype.slice.call(t.Data):t.Data),null!=t.filesize&&t.hasOwnProperty("filesize")&&("number"===typeof t.filesize?n.filesize=e.longs===String?String(t.filesize):t.filesize:n.filesize=e.longs===String?Vn.Long.prototype.toString.call(t.filesize):e.longs===Number?new Vn.LongBits(t.filesize.low>>>0,t.filesize.high>>>0).toNumber(!0):t.filesize),t.blocksizes&&t.blocksizes.length){n.blocksizes=[];for(var i=0;i<t.blocksizes.length;++i)"number"===typeof t.blocksizes[i]?n.blocksizes[i]=e.longs===String?String(t.blocksizes[i]):t.blocksizes[i]:n.blocksizes[i]=e.longs===String?Vn.Long.prototype.toString.call(t.blocksizes[i]):e.longs===Number?new Vn.LongBits(t.blocksizes[i].low>>>0,t.blocksizes[i].high>>>0).toNumber(!0):t.blocksizes[i]}return null!=t.hashType&&t.hasOwnProperty("hashType")&&("number"===typeof t.hashType?n.hashType=e.longs===String?String(t.hashType):t.hashType:n.hashType=e.longs===String?Vn.Long.prototype.toString.call(t.hashType):e.longs===Number?new Vn.LongBits(t.hashType.low>>>0,t.hashType.high>>>0).toNumber(!0):t.hashType),null!=t.fanout&&t.hasOwnProperty("fanout")&&("number"===typeof t.fanout?n.fanout=e.longs===String?String(t.fanout):t.fanout:n.fanout=e.longs===String?Vn.Long.prototype.toString.call(t.fanout):e.longs===Number?new Vn.LongBits(t.fanout.low>>>0,t.fanout.high>>>0).toNumber(!0):t.fanout),null!=t.mode&&t.hasOwnProperty("mode")&&(n.mode=t.mode),null!=t.mtime&&t.hasOwnProperty("mtime")&&(n.mtime=jn.UnixTime.toObject(t.mtime,e)),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,Un.util.toJSONOptions)},t.DataType=function(){const t={},e=Object.create(t);return e[t[0]="Raw"]=0,e[t[1]="Directory"]=1,e[t[2]="File"]=2,e[t[3]="Metadata"]=3,e[t[4]="Symlink"]=4,e[t[5]="HAMTShard"]=5,e}(),t})(),$n=(jn.UnixTime=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.Seconds=Vn.Long?Vn.Long.fromBits(0,0,!1):0,t.prototype.FractionalNanoseconds=0,t.encode=function(t,e){return e||(e=zn.create()),e.uint32(8).int64(t.Seconds),null!=t.FractionalNanoseconds&&Object.hasOwnProperty.call(t,"FractionalNanoseconds")&&e.uint32(21).fixed32(t.FractionalNanoseconds),e},t.decode=function(t,e){t instanceof Fn||(t=Fn.create(t));var n=void 0===e?t.len:t.pos+e,r=new jn.UnixTime;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.Seconds=t.int64();break;case 2:r.FractionalNanoseconds=t.fixed32();break;default:t.skipType(7&i);break}}if(!r.hasOwnProperty("Seconds"))throw Vn.ProtocolError("missing required 'Seconds'",{instance:r});return r},t.fromObject=function(t){if(t instanceof jn.UnixTime)return t;var e=new jn.UnixTime;return null!=t.Seconds&&(Vn.Long?(e.Seconds=Vn.Long.fromValue(t.Seconds)).unsigned=!1:"string"===typeof t.Seconds?e.Seconds=parseInt(t.Seconds,10):"number"===typeof t.Seconds?e.Seconds=t.Seconds:"object"===typeof t.Seconds&&(e.Seconds=new Vn.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber())),null!=t.FractionalNanoseconds&&(e.FractionalNanoseconds=t.FractionalNanoseconds>>>0),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults){if(Vn.Long){var r=new Vn.Long(0,0,!1);n.Seconds=e.longs===String?r.toString():e.longs===Number?r.toNumber():r}else n.Seconds=e.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=t.Seconds&&t.hasOwnProperty("Seconds")&&("number"===typeof t.Seconds?n.Seconds=e.longs===String?String(t.Seconds):t.Seconds:n.Seconds=e.longs===String?Vn.Long.prototype.toString.call(t.Seconds):e.longs===Number?new Vn.LongBits(t.Seconds.low>>>0,t.Seconds.high>>>0).toNumber():t.Seconds),null!=t.FractionalNanoseconds&&t.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=t.FractionalNanoseconds),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,Un.util.toJSONOptions)},t})(),jn.Metadata=(()=>{function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.MimeType="",t.encode=function(t,e){return e||(e=zn.create()),null!=t.MimeType&&Object.hasOwnProperty.call(t,"MimeType")&&e.uint32(10).string(t.MimeType),e},t.decode=function(t,e){t instanceof Fn||(t=Fn.create(t));var n=void 0===e?t.len:t.pos+e,r=new jn.Metadata;while(t.pos<n){var i=t.uint32();switch(i>>>3){case 1:r.MimeType=t.string();break;default:t.skipType(7&i);break}}return r},t.fromObject=function(t){if(t instanceof jn.Metadata)return t;var e=new jn.Metadata;return null!=t.MimeType&&(e.MimeType=String(t.MimeType)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.MimeType=""),null!=t.MimeType&&t.hasOwnProperty("MimeType")&&(n.MimeType=t.MimeType),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,Un.util.toJSONOptions)},t})(),Hn),Kn=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],Gn=["directory","hamt-sharded-directory"],qn=parseInt("0644",8),Wn=parseInt("0755",8);function Yn(t){if(null!=t)return"number"===typeof t?4095&t:(t=t.toString(),"0"===t.substring(0,1)?4095&parseInt(t,8):4095&parseInt(t,10))}function Xn(t){if(null==t)return;let e;if(null!=t.secs&&(e={secs:t.secs,nsecs:t.nsecs}),null!=t.Seconds&&(e={secs:t.Seconds,nsecs:t.FractionalNanoseconds}),Array.isArray(t)&&(e={secs:t[0],nsecs:t[1]}),t instanceof Date){const n=t.getTime(),r=Math.floor(n/1e3);e={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(e,"secs")){if(null!=e&&null!=e.nsecs&&(e.nsecs<0||e.nsecs>999999999))throw Bn(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return e}}class Qn{static unmarshal(t){const e=$n.decode(t),n=$n.toObject(e,{defaults:!1,arrays:!0,longs:Number,objects:!1}),r=new Qn({type:Kn[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return r._originalMode=n.mode||0,r}constructor(t={type:"file"}){const{type:e,data:n,blockSizes:r,hashType:i,fanout:s,mtime:o,mode:a}=t;if(e&&!Kn.includes(e))throw Bn(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE");this.type=e||"file",this.data=n,this.hashType=i,this.fanout=s,this.blockSizes=r||[],this._originalMode=0,this.mode=Yn(a),o&&(this.mtime=Xn(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(t){this._mode=this.isDirectory()?Wn:qn;const e=Yn(t);void 0!==e&&(this._mode=e)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&Gn.includes(this.type))}addBlockSize(t){this.blockSizes.push(t)}removeBlockSize(t){this.blockSizes.splice(t,1)}fileSize(){if(this.isDirectory())return 0;let t=0;return this.blockSizes.forEach((e=>{t+=e})),this.data&&(t+=this.data.length),t}marshal(){let t;switch(this.type){case"raw":t=$n.DataType.Raw;break;case"directory":t=$n.DataType.Directory;break;case"file":t=$n.DataType.File;break;case"metadata":t=$n.DataType.Metadata;break;case"symlink":t=$n.DataType.Symlink;break;case"hamt-sharded-directory":t=$n.DataType.HAMTShard;break;default:throw Bn(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE")}let e,n,r=this.data;if(this.data&&this.data.length||(r=void 0),null!=this.mode&&(e=4294963200&this._originalMode|(Yn(this.mode)||0),e!==qn||this.isDirectory()||(e=void 0),e===Wn&&this.isDirectory()&&(e=void 0)),null!=this.mtime){const t=Xn(this.mtime);t&&(n={Seconds:t.secs,FractionalNanoseconds:t.nsecs},0===n.FractionalNanoseconds&&delete n.FractionalNanoseconds)}const i={Type:t,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:e,mtime:n};return $n.encode(i).finish()}}const Jn=new TextDecoder;function Zn(t,e){let n=0;for(let r=0;;r+=7){if(r>=64)throw new Error("protobuf: varint overflow");if(e>=t.length)throw new Error("protobuf: unexpected end of data");const i=t[e++];if(n+=r<28?(127&i)<<r:(127&i)*2**r,i<128)break}return[n,e]}function tr(t,e){let n;[n,e]=Zn(t,e);const r=e+n;if(n<0||r<0)throw new Error("protobuf: invalid length");if(r>t.length)throw new Error("protobuf: unexpected end of data");return[t.subarray(e,r),r]}function er(t,e){let n;return[n,e]=Zn(t,e),[7&n,n>>3,e]}function nr(t){const e={},n=t.length;let r=0;while(r<n){let n,i;if([n,i,r]=er(t,r),1===i){if(e.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Hash`);if(void 0!==e.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==e.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[e.Hash,r]=tr(t,r)}else if(2===i){if(void 0!==e.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Name`);if(void 0!==e.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let i;[i,r]=tr(t,r),e.Name=Jn.decode(i)}else{if(3!==i)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${i}`);if(void 0!==e.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Tsize`);[e.Tsize,r]=Zn(t,r)}}if(r>n)throw new Error("protobuf: (PBLink) unexpected end of data");return e}function rr(t){const e=t.length;let n,r,i=0,s=!1;while(i<e){let e,o;if([e,o,i]=er(t,i),2!==e)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${e}`);if(1===o){if(r)throw new Error("protobuf: (PBNode) duplicate Data section");[r,i]=tr(t,i),n&&(s=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(s)throw new Error("protobuf: (PBNode) duplicate Links section");let e;n||(n=[]),[e,i]=tr(t,i),n.push(nr(e))}}}if(i>e)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return r&&(o.Data=r),o.Links=n||[],o}const ir=new TextEncoder,sr=2**32,or=2**31;function ar(t,e){let n=e.length;if("number"===typeof t.Tsize){if(t.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(t.Tsize))throw new Error("Tsize too large for encoding");n=hr(e,n,t.Tsize)-1,e[n]=24}if("string"===typeof t.Name){const r=ir.encode(t.Name);n-=r.length,e.set(r,n),n=hr(e,n,r.length)-1,e[n]=18}return t.Hash&&(n-=t.Hash.length,e.set(t.Hash,n),n=hr(e,n,t.Hash.length)-1,e[n]=10),e.length-n}function cr(t){const e=ur(t),n=new Uint8Array(e);let r=e;if(t.Data&&(r-=t.Data.length,n.set(t.Data,r),r=hr(n,r,t.Data.length)-1,n[r]=10),t.Links)for(let i=t.Links.length-1;i>=0;i--){const e=ar(t.Links[i],n.subarray(0,r));r-=e,r=hr(n,r,e)-1,n[r]=18}return n}function lr(t){let e=0;if(t.Hash){const n=t.Hash.length;e+=1+n+dr(n)}if("string"===typeof t.Name){const n=ir.encode(t.Name).length;e+=1+n+dr(n)}return"number"===typeof t.Tsize&&(e+=1+dr(t.Tsize)),e}function ur(t){let e=0;if(t.Data){const n=t.Data.length;e+=1+n+dr(n)}if(t.Links)for(const n of t.Links){const t=lr(n);e+=1+t+dr(t)}return e}function hr(t,e,n){e-=dr(n);const r=e;while(n>=or)t[e++]=127&n|128,n/=128;while(n>=128)t[e++]=127&n|128,n>>>=7;return t[e]=n,r}function dr(t){return t%2===0&&t++,Math.floor((fr(t)+6)/7)}function fr(t){let e=0;return t>=sr&&(t=Math.floor(t/sr),e=32),t>=65536&&(t>>>=16,e+=16),t>=256&&(t>>>=8,e+=8),e+pr[t]}const pr=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],gr=["Data","Links"],mr=["Hash","Name","Tsize"],yr=new TextEncoder;function wr(t,e){if(t===e)return 0;const n=t.Name?yr.encode(t.Name):[],r=e.Name?yr.encode(e.Name):[];let i=n.length,s=r.length;for(let o=0,a=Math.min(i,s);o<a;++o)if(n[o]!==r[o]){i=n[o],s=r[o];break}return i<s?-1:s<i?1:0}function br(t,e){return!Object.keys(t).some((t=>!e.includes(t)))}function vr(t){if("object"===typeof t.asCID){const e=p.k.asCID(t);if(!e)throw new TypeError("Invalid DAG-PB form");return{Hash:e}}if("object"!==typeof t||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");const e={};if(t.Hash){let r=p.k.asCID(t.Hash);try{r||("string"===typeof t.Hash?r=p.k.parse(t.Hash):t.Hash instanceof Uint8Array&&(r=p.k.decode(t.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(e.Hash=r)}if(!e.Hash)throw new TypeError("Invalid DAG-PB form");return"string"===typeof t.Name&&(e.Name=t.Name),"number"===typeof t.Tsize&&(e.Tsize=t.Tsize),e}function Er(t){if((t instanceof Uint8Array||"string"===typeof t)&&(t={Data:t}),"object"!==typeof t||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");const e={};if(void 0!==t.Data)if("string"===typeof t.Data)e.Data=yr.encode(t.Data);else{if(!(t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");e.Data=t.Data}if(void 0!==t.Links){if(!Array.isArray(t.Links))throw new TypeError("Invalid DAG-PB form");e.Links=t.Links.map(vr),e.Links.sort(wr)}else e.Links=[];return e}function _r(t){if(!t||"object"!==typeof t||Array.isArray(t))throw new TypeError("Invalid DAG-PB form");if(!br(t,gr))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==t.Data&&!(t.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(t.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let e=0;e<t.Links.length;e++){const n=t.Links[e];if(!n||"object"!==typeof n||Array.isArray(n))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!br(n,mr))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!n.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(n.Hash.asCID!==n.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==n.Name&&"string"!==typeof n.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==n.Tsize&&("number"!==typeof n.Tsize||n.Tsize%1!==0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(e>0&&-1===wr(n,t.Links[e-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function Sr(t,e=[]){return Er({Data:t,Links:e})}function Ar(t,e,n){return vr({Hash:n,Name:t,Tsize:e})}const Cr="dag-pb",Ir=112;function Tr(t){_r(t);const e={};return t.Links&&(e.Links=t.Links.map((t=>{const e={};return t.Hash&&(e.Hash=t.Hash.bytes),void 0!==t.Name&&(e.Name=t.Name),void 0!==t.Tsize&&(e.Tsize=t.Tsize),e}))),t.Data&&(e.Data=t.Data),cr(e)}function kr(t){const e=rr(t),n={};return e.Data&&(n.Data=e.Data),e.Links&&(n.Links=e.Links.map((t=>{const e={};try{e.Hash=p.k.decode(t.Hash)}catch(n){}if(!e.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==t.Name&&(e.Name=t.Name),void 0!==t.Tsize&&(e.Tsize=t.Tsize),e}))),n}const Rr=async(t,e,n)=>{n.codec||(n.codec=r),n.hasher||(n.hasher=kn.sha256),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===r&&n.hasher!==kn.sha256&&(n.cidVersion=1);const i=await n.hasher.digest(t),s=p.k.create(n.cidVersion,n.codec.code,i);return n.onlyHash||await e.put(s,t,{signal:n.signal}),s};var Nr=Rr;const Dr=async(t,e,n)=>{const r=new Qn({type:"directory",mtime:t.mtime,mode:t.mode}),i=Tr(Er({Data:r.marshal()})),s=await Nr(i,e,n),o=t.path;return{cid:s,path:o,unixfs:r,size:i.length}};var Or=Dr,Pr=n(6347),xr=n(7192);async function Mr(t,e){return e(await xr(t))}var Lr=Mr,Br=n(1131);function Ur(t,e,n){return Fr(t,e,n)}async function Fr(t,e,n){const r=[];for await(const i of Br(t,n.maxChildrenPerNode))r.push(await e(i));return r.length>1?Fr(r,e,n):r[0]}var zr=Ur;async function Vr(t,e,n){const r=new $r(n.layerRepeat);let i=0,s=1,o=r;for await(const a of Br(t,n.maxChildrenPerNode))o.isFull()&&(o!==r&&r.addChild(await o.reduce(e)),i&&i%n.layerRepeat===0&&s++,o=new Hr(s,n.layerRepeat,i),i++),o.append(a);return o&&o!==r&&r.addChild(await o.reduce(e)),r.reduce(e)}var jr=Vr;class Hr{constructor(t,e,n=0){this.maxDepth=t,this.layerRepeat=e,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:t,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;const t=this._findParent(this.node,this.currentDepth);return!t||(this._addNextNodeToParent(t),!1)}_addNextNodeToParent(t){this.parent=t;const e={children:[],depth:t.depth+1,parent:t,maxDepth:this.maxDepth,maxChildren:Math.floor(t.children.length/this.layerRepeat)*this.layerRepeat};t.children.push(e),this.currentDepth=e.depth,this.node=e}append(t){this.node.data=t}reduce(t){return this._reduce(this.root,t)}async _reduce(t,e){let n=[];return t.children.length&&(n=await Promise.all(t.children.filter((t=>t.data)).map((t=>this._reduce(t,e))))),e((t.data||[]).concat(n))}_findParent(t,e){const n=t.parent;if(n&&0!==n.depth)return n.children.length!==n.maxChildren&&n.maxChildren?n:this._findParent(n,e)}}class $r extends Hr{constructor(t){super(0,t),this.root.depth=0,this.currentDepth=1}addChild(t){this.root.children.push(t)}reduce(t){return t((this.root.data||[]).concat(this.root.children))}}async function*Kr(t,e,n){for await(let i of t.content)yield async()=>{let s;n.progress(i.length,t.path);const o={codec:r,cidVersion:n.cidVersion,hasher:n.hasher,onlyHash:n.onlyHash};return n.rawLeaves?(o.codec=Pr,o.cidVersion=1):(s=new Qn({type:n.leafType,data:i}),i=Tr({Data:s.marshal(),Links:[]})),{cid:await Nr(i,e,o),unixfs:s,size:i.length}}}var Gr=Kr;const qr={flat:Lr,balanced:zr,trickle:jr};async function*Wr(t,e,n){let r,i,s=-1;i="function"===typeof n.bufferImporter?n.bufferImporter:Gr;for await(const o of Cn(i(t,e,n),n.blockWriteConcurrency))s++,0!==s?(1===s&&r&&(yield r,r=null),yield o):r=o;r&&(r.single=!0,yield r)}const Yr=(t,e,n)=>{async function i(i){if(1===i.length&&i[0].single&&n.reduceSingleLeafToSelf){const s=i[0];if(void 0!==t.mtime||void 0!==t.mode){let i=await e.get(s.cid);s.unixfs=new Qn({type:"file",mtime:t.mtime,mode:t.mode,data:i}),i=Tr(Er({Data:s.unixfs.marshal()})),s.cid=await Nr(i,e,{...n,codec:r,hasher:n.hasher,cidVersion:n.cidVersion}),s.size=i.length}return{cid:s.cid,path:t.path,unixfs:s.unixfs,size:s.size}}const s=new Qn({type:"file",mtime:t.mtime,mode:t.mode}),o=i.filter((t=>!(t.cid.code!==Pr.code||!t.size)||(!(!t.unixfs||t.unixfs.data||!t.unixfs.fileSize())||Boolean(t.unixfs&&t.unixfs.data&&t.unixfs.data.length)))).map((t=>t.cid.code===Pr.code?(s.addBlockSize(t.size),{Name:"",Tsize:t.size,Hash:t.cid}):(t.unixfs&&t.unixfs.data?s.addBlockSize(t.unixfs.data.length):s.addBlockSize(t.unixfs&&t.unixfs.fileSize()||0),{Name:"",Tsize:t.size,Hash:t.cid}))),a={Data:s.marshal(),Links:o},c=Tr(Er(a)),l=await Nr(c,e,n);return{cid:l,path:t.path,unixfs:s,size:c.length+a.Links.reduce(((t,e)=>t+e.Tsize),0)}}return i};function Xr(t,e,n){const r=qr[n.strategy];if(!r)throw Bn(new Error(`Unknown importer build strategy name: ${n.strategy}`),"ERR_BAD_STRATEGY");return r(Wr(t,e,n),Yr(t,e,n),n)}var Qr=Xr,Jr=n(9051),Zr=n(7393);async function*ti(t,e){let n,r,i;if(e.minChunkSize&&e.maxChunkSize&&e.avgChunkSize)i=e.avgChunkSize,n=e.minChunkSize,r=e.maxChunkSize;else{if(!e.avgChunkSize)throw Bn(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");i=e.avgChunkSize,n=i/3,r=i+i/2}if(n<16)throw Bn(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");r<n&&(r=n),i<n&&(i=n);const s=Math.floor(Math.log2(i));for await(const o of ni(t,{min:n,max:r,bits:s,window:e.window,polynomial:e.polynomial}))yield o}var ei=ti;async function*ni(t,e){const n=await(0,Zr.create)(e.bits,e.min,e.max,e.window),r=new Jr;for await(const i of t){r.append(i);const t=n.fingerprint(i);for(let e=0;e<t.length;e++){const n=t[e],i=r.slice(0,n);r.consume(n),yield i}}r.length&&(yield r.slice(0))}async function*ri(t,e){let n=new Jr,r=0,i=!1;const s=e.maxChunkSize;for await(const o of t){n.append(o),r+=o.length;while(r>=s)if(yield n.slice(0,s),i=!0,s===n.length)n=new Jr,r=0;else{const t=new Jr;t.append(n.shallowSlice(s)),n=t,r-=s}}i&&!r||(yield n.slice(0,r))}var ii=ri,si=n(6555);async function*oi(t){for await(const e of t){if(void 0===e.length)throw Bn(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"===typeof e||e instanceof String)yield(0,si.fromString)(e.toString());else if(Array.isArray(e))yield Uint8Array.from(e);else{if(!(e instanceof Uint8Array))throw Bn(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield e}}}var ai=oi;function ci(t){return Symbol.iterator in t}function li(t){return Symbol.asyncIterator in t}function ui(t){try{if(t instanceof Uint8Array)return async function*(){yield t}();if(ci(t))return async function*(){yield*t}();if(li(t))return t}catch{throw Bn(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw Bn(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*hi(t,e,n){for await(const r of t)if(r.path&&("./"===r.path.substring(0,2)&&(n.wrapWithDirectory=!0),r.path=r.path.split("/").filter((t=>t&&"."!==t)).join("/")),r.content){let t,i;t="function"===typeof n.chunker?n.chunker:"rabin"===n.chunker?ei:ii,i="function"===typeof n.chunkValidator?n.chunkValidator:ai;const s={path:r.path,mtime:r.mtime,mode:r.mode,content:t(i(ui(r.content),n),n)};yield()=>Qr(s,e,n)}else{if(!r.path)throw new Error("Import candidate must have content or path or both");{const t={path:r.path,mtime:r.mtime,mode:r.mode};yield()=>Or(t,e,n)}}}var di=hi;class fi{constructor(t,e){this.options=e||{},this.root=t.root,this.dir=t.dir,this.path=t.path,this.dirty=t.dirty,this.flat=t.flat,this.parent=t.parent,this.parentKey=t.parentKey,this.unixfs=t.unixfs,this.mode=t.mode,this.mtime=t.mtime,this.cid=void 0,this.size=void 0}async put(t,e){}get(t){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(t){}}var pi=fi;class gi extends pi{constructor(t,e){super(t,e),this._children={}}async put(t,e){this.cid=void 0,this.size=void 0,this._children[t]=e}get(t){return Promise.resolve(this._children[t])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){const t=Object.keys(this._children);for(let e=0;e<t.length;e++){const n=t[e];yield{key:n,child:this._children[n]}}}async*flush(t){const e=Object.keys(this._children),n=[];for(let c=0;c<e.length;c++){let r=this._children[e[c]];if(r instanceof pi)for await(const e of r.flush(t))r=e,yield r;null!=r.size&&r.cid&&n.push({Name:e[c],Tsize:r.size,Hash:r.cid})}const r=new Qn({type:"directory",mtime:this.mtime,mode:this.mode}),i={Data:r.marshal(),Links:n},s=Tr(Er(i)),o=await Nr(s,t,this.options),a=s.length+i.Links.reduce(((t,e)=>t+(null==e.Tsize?0:e.Tsize)),0);this.cid=o,this.size=a,yield{cid:o,unixfs:r,path:this.path,size:a}}}var mi=gi,yi=n(9800);class wi extends pi{constructor(t,e){super(t,e),this._bucket=(0,yi.createHAMT)({hashFn:e.hamtHashFn,bits:e.hamtBucketBits})}async put(t,e){await this._bucket.put(t,e)}get(t){return this._bucket.get(t)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:t,value:e}of this._bucket.eachLeafSeries())yield{key:t,child:e}}async*flush(t){for await(const e of vi(this._bucket,t,this,this.options))yield{...e,path:this.path}}}var bi=wi;async function*vi(t,e,n,r){const i=t._children,s=[];let o=0;for(let f=0;f<i.length;f++){const t=i.get(f);if(!t)continue;const n=f.toString(16).toUpperCase().padStart(2,"0");if(t instanceof yi.Bucket){let i;for await(const n of await vi(t,e,null,r))i=n;if(!i)throw new Error("Could not flush sharded directory, no subshard found");s.push({Name:n,Tsize:i.size,Hash:i.cid}),o+=i.size}else if("function"===typeof t.value.flush){const r=t.value;let i;for await(const t of r.flush(e))i=t,yield i;const a=n+t.key;s.push({Name:a,Tsize:i.size,Hash:i.cid}),o+=i.size}else{const e=t.value;if(!e.cid)continue;const r=n+t.key,i=e.size;s.push({Name:r,Tsize:i,Hash:e.cid}),o+=i}}const a=Uint8Array.from(i.bitField().reverse()),c=new Qn({type:"hamt-sharded-directory",data:a,fanout:t.tableSize(),hashType:r.hamtHashCode,mtime:n&&n.mtime,mode:n&&n.mode}),l={Data:c.marshal(),Links:s},u=Tr(Er(l)),h=await Nr(u,e,r),d=u.length+o;yield{cid:h,unixfs:c,size:d}}async function Ei(t,e,n,r){let i=e;e instanceof mi&&e.directChildrenCount()>=n&&(i=await _i(e,r));const s=i.parent;if(s){if(i!==e){if(t&&(t.parent=i),!i.parentKey)throw new Error("No parent key found");await s.put(i.parentKey,i)}return Ei(i,s,n,r)}return i}async function _i(t,e){const n=new bi({root:t.root,dir:!0,parent:t.parent,parentKey:t.parentKey,path:t.path,dirty:t.dirty,flat:!1,mtime:t.mtime,mode:t.mode},e);for await(const{key:r,child:i}of t.eachChildSeries())await n.put(r,i);return n}var Si=Ei;const Ai=(t="")=>(t.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean);var Ci=Ai;async function Ii(t,e,n){const r=Ci(t.path||""),i=r.length-1;let s=e,o="";for(let a=0;a<r.length;a++){const c=r[a];o+=`${o?"/":""}${c}`;const l=a===i;if(s.dirty=!0,s.cid=void 0,s.size=void 0,l)await s.put(c,t),e=await Si(null,s,n.shardSplitThreshold,n);else{let t=await s.get(c);t&&t instanceof pi||(t=new mi({root:!1,dir:!0,parent:s,parentKey:c,path:o,dirty:!0,flat:!0,mtime:t&&t.unixfs&&t.unixfs.mtime,mode:t&&t.unixfs&&t.unixfs.mode},n)),await s.put(c,t),s=t}}return e}async function*Ti(t,e){t instanceof pi?yield*t.flush(e):t&&t.unixfs&&t.unixfs.isDirectory()&&(yield t)}async function*ki(t,e,n){let r=new mi({root:!0,dir:!0,path:"",dirty:!0,flat:!0},n);for await(const i of t)i&&(r=await Ii(i,r,n),i.unixfs&&i.unixfs.isDirectory()||(yield i));if(n.wrapWithDirectory)yield*Ti(r,e);else for await(const i of r.eachChildSeries())i&&(yield*Ti(i.child,e))}var Ri=ki;async function*Ni(t,e,n={}){const r=Ln(n);let i,s,o;i="function"===typeof n.dagBuilder?n.dagBuilder:di,s="function"===typeof n.treeBuilder?n.treeBuilder:Ri,o=Symbol.asyncIterator in t||Symbol.iterator in t?t:[t];for await(const a of s(Cn(i(o,e,r),r.fileImportConcurrency),e,r))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}var Di=n(411),Oi=n(7336),Pi=n(4395),xi=n(9927);function Mi(t){return ArrayBuffer.isView(t)||t instanceof ArrayBuffer}function Li(t){return t.constructor&&("Blob"===t.constructor.name||"File"===t.constructor.name)&&"function"===typeof t.stream}function Bi(t){return"object"===typeof t&&(t.path||t.content)}const Ui=t=>t&&"function"===typeof t.getReader;async function*Fi(t){yield t}async function zi(t){if(Mi(t))return Fi(Vi(t));if("string"===typeof t||t instanceof String)return Fi(Vi(t.toString()));if(Li(t))return Oi(t);if(Ui(t)&&(t=Di(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const e=Pi(t),{value:n,done:r}=await e.peek();if(r)return Fi(new Uint8Array(0));if(e.push(n),Number.isInteger(n))return Fi(Uint8Array.from(await xr(e)));if(Mi(n)||"string"===typeof n||n instanceof String)return xi(e,Vi)}throw Bn(new Error(`Unexpected input: ${t}`),"ERR_UNEXPECTED_INPUT")}function Vi(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t instanceof ArrayBuffer?new Uint8Array(t):Array.isArray(t)?Uint8Array.from(t):(0,si.fromString)(t.toString())}async function*ji(t,e){if(null===t||void 0===t)throw Bn(new Error(`Unexpected input: ${t}`),"ERR_UNEXPECTED_INPUT");if("string"===typeof t||t instanceof String)yield Hi(t.toString(),e);else if(Mi(t)||Li(t))yield Hi(t,e);else{if(Ui(t)&&(t=Di(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const n=Pi(t),{value:r,done:i}=await n.peek();if(i)return void(yield{content:[]});if(n.push(r),Number.isInteger(r)||Mi(r)||"string"===typeof r||r instanceof String)return void(yield Hi(n,e));throw Bn(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!Bi(t))throw Bn(new Error('Unexpected input: cannot convert "'+typeof t+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield Hi(t,e)}}async function Hi(t,e){const{path:n,mode:r,mtime:i,content:s}=t,o={path:n||"",mode:Yn(r),mtime:Xn(i)};return s?o.content=await e(s):n||(o.content=await e(t)),o}function $i(t){return ji(t,zi)}async function*Ki(t,e){if("string"===typeof t||t instanceof String||Mi(t)||Li(t)||t._readableState)throw Bn(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(Ui(t)&&(t=Di(t)),Symbol.iterator in t||Symbol.asyncIterator in t){const n=Pi(t),{value:r,done:i}=await n.peek();if(i)return void(yield*[]);if(n.push(r),Number.isInteger(r))throw Bn(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(r._readableState)return void(yield*xi(n,(t=>Gi({content:t},e))));if(Mi(r))return void(yield Gi({content:n},e));if(Bi(r)||r[Symbol.iterator]||r[Symbol.asyncIterator]||Ui(r)||Li(r))return void(yield*xi(n,(t=>Gi(t,e))))}if(Bi(t))throw Bn(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");throw Bn(new Error("Unexpected input: "+typeof t),"ERR_UNEXPECTED_INPUT")}async function Gi(t,e){const{path:n,mode:r,mtime:i,content:s}=t,o={path:n||"",mode:Yn(r),mtime:Xn(i)};return s?o.content=await e(s):n||(o.content=await e(t)),o}function qi(t){return Ki(t,zi)}function Wi(t){return ArrayBuffer.isView(t)||t instanceof ArrayBuffer}function Yi(t){return Boolean(t.constructor)&&("Blob"===t.constructor.name||"File"===t.constructor.name)&&"function"===typeof t.stream}function Xi(t){return"string"===typeof t||t instanceof String||Wi(t)||Yi(t)||"_readableState"in t}function Qi(t){return Xi(t)?$i(t):qi(t)}function Ji(t){return t=t||new Error("Not Found"),Bn(t,"ERR_NOT_FOUND")}function Zi(t){return t=t||new Error("Aborted"),Bn(t,"ERR_ABORTED")}var ts=n(9164),es=n(3726),ns=n(6855);const rs=(t,e)=>async function*(){const n=await xr(t);yield*n.sort(e)}();class is{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(t,e,n){return Promise.reject(new Error(".put is not implemented"))}get(t,e){return Promise.reject(new Error(".get is not implemented"))}has(t,e){return Promise.reject(new Error(".has is not implemented"))}delete(t,e){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(t,e={}){for await(const{key:n,value:r}of t)await this.put(n,r,e),yield{key:n,value:r}}async*getMany(t,e={}){for await(const n of t)yield this.get(n,e)}async*deleteMany(t,e={}){for await(const n of t)await this.delete(n,e),yield n}batch(){let t=[],e=[];return{put(e,n){t.push({key:e,value:n})},delete(t){e.push(t)},commit:async n=>{await ts(this.putMany(t,n)),t=[],await ts(this.deleteMany(e,n)),e=[]}}}async*_all(t,e){throw new Error("._all is not implemented")}async*_allKeys(t,e){throw new Error("._allKeys is not implemented")}query(t,e){let n=this._all(t,e);if(null!=t.prefix&&(n=es(n,(e=>e.key.toString().startsWith(t.prefix||"")))),Array.isArray(t.filters)&&(n=t.filters.reduce(((t,e)=>es(t,e)),n)),Array.isArray(t.orders)&&(n=t.orders.reduce(((t,e)=>rs(t,e)),n)),null!=t.offset){let e=0;n=es(n,(()=>e++>=(t.offset||0)))}return null!=t.limit&&(n=ns(n,t.limit)),n}queryKeys(t,e){let n=this._allKeys(t,e);if(null!=t.prefix&&(n=es(n,(e=>e.toString().startsWith(t.prefix||"")))),Array.isArray(t.filters)&&(n=t.filters.reduce(((t,e)=>es(t,e)),n)),Array.isArray(t.orders)&&(n=t.orders.reduce(((t,e)=>rs(t,e)),n)),null!=t.offset){let e=0;n=es(n,(()=>e++>=t.offset))}return null!=t.limit&&(n=ns(n,t.limit)),n}}n(2056);class ss extends is{constructor(){super(),this.store=new Map}async*blocks(){for(const[t,e]of this.store.entries())yield{cid:Nn.k0.parse(t),bytes:e}}put(t,e){return this.store.set(t.toString(),e),Promise.resolve()}get(t){const e=this.store.get(t.toString());if(!e)throw new Error(`block with cid ${t.toString()} no found`);return Promise.resolve(e)}has(t){return Promise.resolve(this.store.has(t.toString()))}close(){return this.store.clear(),Promise.resolve()}}const os={cidVersion:1,chunker:"fixed",maxChunkSize:262144,hasher:kn.sha256,rawLeaves:!0,wrapWithDirectory:!0,maxChildrenPerNode:174};async function as({input:t,blockstore:e,hasher:n,maxChunkSize:r,maxChildrenPerNode:i,wrapWithDirectory:s,rawLeaves:o}){if(!t||Array.isArray(t)&&!t.length)throw new Error("missing input file(s)");const a=e||new ss,c=await h(d(Qi(t),(t=>Ni(t,a,{...os,hasher:n||os.hasher,maxChunkSize:r||os.maxChunkSize,maxChildrenPerNode:i||os.maxChildrenPerNode,wrapWithDirectory:!1!==s&&os.wrapWithDirectory,rawLeaves:null==o?os.rawLeaves:o}))));if(!c||!c.cid)throw new Error("given input could not be parsed correctly");const l=c.cid,{writer:u,out:f}=await En.create([l]),p=f[Symbol.asyncIterator]();let g;const m=async()=>{for await(const t of a.blocks())await u.put(t);await u.close(),e||await a.close()},y={[Symbol.asyncIterator](){if(null!=g)throw new Error("Multiple iterator not supported");return g=m(),{async next(){const t=await p.next();return t.done&&await g,t}}}};return{root:l,out:y}}const cs=2e3,ls=!1;function us(t){return t&&t.rel}function hs(t,e){function n(n){t[n]=Object.assign({},e,{rel:n})}return e.rel.split(/\s+/).forEach(n),t}function ds(t,e){const n=e.match(/\s*(.+)\s*=\s*"?([^"]+)"?/);return n&&(t[n[1]]=n[2]),t}function fs(t){try{const e=t.match(/<?([^>]*)>(.*)/),n=e[1],r=e[2].split(";"),i={},s=new URL(n,"https://example.com");for(const[t,a]of s.searchParams)i[t]=a;r.shift();let o=r.reduce(ds,{});return o=Object.assign({},i,o),o.url=n,o}catch{return null}}function ps(t,e){if(!t)return!1;e=e||{};const n=e.maxHeaderLength||cs,r=e.throwOnMaxHeaderLengthExceeded||ls;if(t.length>n){if(r)throw new Error("Input string too long, it should be under "+n+" characters.");return!1}return!0}function gs(t,e){return ps(t,e)?t.split(/,\s*</).map(fs).filter(us).reduce(hs,{}):null}var ms=n(7041);const ys=async function(t){return(await Pn.encode(t)).slice(0,8).reverse()},ws=(t,e,n)=>Promise.all(t.map((t=>{if(null==t.Name)throw new Error("Unexpected Link without a Name");if(2===t.Name.length){const r=parseInt(t.Name,16);return e._putObjectAt(r,new yi.Bucket({hash:n._options.hash,bits:n._options.bits},e,r))}return n.put(t.Name.substring(2),!0)}))),bs=t=>t.toString(16).toUpperCase().padStart(2,"0").substring(0,2),vs=t=>{let e=t.bucket;const n=[];while(e._parent)n.push(e),e=e._parent;return n.push(e),n.reverse()},Es=async(t,e,n,r,i)=>{if(!r){const t=(0,yi.createHAMT)({hashFn:ys});r={rootBucket:t,hamtDepth:1,lastBucket:t}}await ws(t.Links,r.lastBucket,r.rootBucket);const s=await r.rootBucket._findNewBucketAndPos(e);let o=bs(s.pos);const a=vs(s);a.length>r.hamtDepth&&(r.lastBucket=a[r.hamtDepth],o=bs(r.lastBucket._posAtParent));const c=t.Links.find((t=>{if(null==t.Name)return!1;const n=t.Name.substring(0,2),r=t.Name.substring(2);return n===o&&(!r||r===e)}));if(!c)return null;if(null!=c.Name&&c.Name.substring(2)===e)return c.Hash;r.hamtDepth++;const l=await n.get(c.Hash,i);return t=kr(l),Es(t,e,n,r,i)};var _s=Es;function Ss(t,e,n,r){const i=t.length,s=e+i;return n>=s||r<e?new Uint8Array(0):(r>=e&&r<s&&(t=t.slice(0,r-e)),n>=e&&n<s&&(t=t.slice(n-e)),t)}var As=Ss;const Cs=(t,e,n)=>{if(e||(e=0),e<0)throw Bn(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(e>t)throw Bn(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(n||0===n||(n=t-e),n<0)throw Bn(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return e+n>t&&(n=t-e),{offset:e,length:n}};var Is=Cs;async function*Ts(t,e,n,r,i=0,s){if(e instanceof Uint8Array){const t=As(e,i,n,r);return t.length&&(yield t),i+=t.length,i}if(null==e.Data)throw Bn(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let o;try{o=Qn.unmarshal(e.Data)}catch(c){throw Bn(c,"ERR_NOT_UNIXFS")}if(o.data&&o.data.length){const t=As(o.data,i,n,r);t.length&&(yield t),i+=o.data.length}let a=i;for(let l=0;l<e.Links.length;l++){const c=e.Links[l],u=i+o.blockSizes[l];if(n>=a&&n<u||r>a&&r<=u||n<a&&r>u){const e=await t.get(c.Hash,{signal:s.signal});let o;switch(c.Hash.code){case Ir:o=await kr(e);break;case Pr.code:o=e;break;case Ge:o=await We(e);break;default:throw Error(`Unsupported codec: ${c.Hash.code}`)}for await(const a of Ts(t,o,n,r,i,s))i+=a.length,yield a}i=u,a=u+1}}const ks=(t,e,n,r,i,s,o)=>{function a(t={}){const r=n.fileSize();if(void 0===r)throw new Error("File was a directory");const{offset:i,length:s}=Is(r,t.offset,t.length),a=i,c=i+s;return Ts(o,e,a,c,0,t)}return a};var Rs=ks;const Ns=(t,e,n,r,i,s,o)=>{async function*a(t={}){const n=t.offset||0,a=t.length||e.Links.length,c=e.Links.slice(n,a);for(const e of c){const n=await i(e.Hash,e.Name||"",`${r}/${e.Name||""}`,[],s+1,o,t);n.entry&&(yield n.entry)}}return a};var Ds=Ns;const Os=(t,e,n,r,i,s,o)=>{function a(t={}){return Ps(e,r,i,s,o,t)}return a};async function*Ps(t,e,n,r,i,s){const o=t.Links;for(const a of o){const o=null!=a.Name?a.Name.substring(2):null;if(o){const t=await n(a.Hash,o,`${e}/${o}`,[],r+1,i,s);yield t.entry}else{const o=await i.get(a.Hash);t=kr(o);for await(const a of Ps(t,e,n,r,i,s))yield a}}}var xs=Os;const Ms=(t,e)=>{const n=t.Links.find((t=>t.Name===e));return n&&n.Hash},Ls={raw:Rs,file:Rs,directory:Ds,"hamt-sharded-directory":xs,metadata:(t,e,n,r,i,s,o)=>()=>[],symlink:(t,e,n,r,i,s,o)=>()=>[]},Bs=async(t,e,n,r,i,s,o,a)=>{const c=await o.get(t,a),l=kr(c);let u,h;if(e||(e=t.toString()),null==l.Data)throw Bn(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{u=Qn.unmarshal(l.Data)}catch(d){throw Bn(d,"ERR_NOT_UNIXFS")}if(n||(n=e),r.length){let t;if(t=u&&"hamt-sharded-directory"===u.type?await _s(l,r[0],o):Ms(l,r[0]),!t)throw Bn(new Error("file does not exist"),"ERR_NOT_FOUND");const e=r.shift(),i=`${n}/${e}`;h={cid:t,toResolve:r,name:e||"",path:i}}return{entry:{type:u.isDirectory()?"directory":"file",name:e,path:n,cid:t,content:Ls[u.type](t,l,u,n,i,s,o),unixfs:u,depth:s,node:l,size:u.fileSize()},next:h}};var Us=Bs;const Fs=t=>{async function*e(e={}){const{offset:n,length:r}=Is(t.length,e.offset,e.length);yield As(t,0,n,n+r)}return e},zs=async(t,e,n,r,i,s,o,a)=>{if(r.length)throw Bn(new Error(`No link named ${n} found in raw node ${t}`),"ERR_NOT_FOUND");const c=await o.get(t,a);return{entry:{type:"raw",name:e,path:n,cid:t,content:Fs(c),depth:s,size:c.length,node:c}}};var Vs=zs;const js=async(t,e,n,r,i,s,o,a)=>{const c=await o.get(t),l=We(c);let u=l,h=n;while(r.length){const i=r[0];if(!(i in u))throw Bn(new Error(`No property named ${i} found in cbor node ${t}`),"ERR_NO_PROP");{r.shift(),h=`${h}/${i}`;const o=p.k.asCID(u[i]);if(o)return{entry:{type:"object",name:e,path:n,cid:t,node:c,depth:s,size:c.length,content:async function*(){yield l}},next:{cid:o,name:i,path:h,toResolve:r}};u=u[i]}}return{entry:{type:"object",name:e,path:n,cid:t,node:c,depth:s,size:c.length,content:async function*(){yield l}}}};var Hs=js;const $s=t=>{async function*e(e={}){const{offset:n,length:r}=Is(t.length,e.offset,e.length);yield As(t,0,n,n+r)}return e},Ks=async(t,e,n,r,i,s,o,a)=>{if(r.length)throw Bn(new Error(`No link named ${n} found in raw node ${t}`),"ERR_NOT_FOUND");const c=await g.Jx(t.multihash.bytes);return{entry:{type:"identity",name:e,path:n,cid:t,content:$s(c.digest),depth:s,size:c.digest.length,node:c.digest}}};var Gs=Ks;const qs={[Ir]:Us,[Pr.code]:Vs,[Ge]:Hs,[ms.identity.code]:Gs};function Ws(t,e,n,r,i,s,o){const a=qs[t.code];if(!a)throw Bn(new Error(`No resolver for code ${t.code}`),"ERR_NO_RESOLVER");return a(t,e,n,r,Ws,i,s,o)}var Ys=Ws;const Xs=(t="")=>(t.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),Qs=t=>{if(t instanceof Uint8Array)return{cid:p.k.decode(t),toResolve:[]};const e=p.k.asCID(t);if(e)return{cid:e,toResolve:[]};if("string"===typeof t){0===t.indexOf("/ipfs/")&&(t=t.substring(6));const e=Xs(t);return{cid:p.k.parse(e[0]),toResolve:e.slice(1)}}throw Bn(new Error(`Unknown path type ${t}`),"ERR_BAD_PATH")};async function*Js(t,e,n={}){let{cid:r,toResolve:i}=Qs(t),s=r.toString(),o=s;const a=i.length;while(1){const c=await Ys(r,s,o,i,a,e,n);if(!c.entry&&!c.next)throw Bn(new Error(`Could not resolve ${t}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;i=c.next.toResolve,r=c.next.cid,s=c.next.name,o=c.next.path}}async function Zs(t,e,n={}){const r=await h(Js(t,e,n));if(!r)throw Bn(new Error(`Could not resolve ${t}`),"ERR_NOT_FOUND");return r}async function*to(t,e,n={}){const r=await Zs(t,e,n);if(r&&(yield r,"directory"===r.type))for await(const s of i(r,n))yield s;async function*i(t,e){for await(const n of t.content(e))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*i(n,e))}}function eo(t,e){if(t===e)return!0;if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.byteLength;n++)if(t[n]!==e[n])return!1;return!0}class no extends is{constructor(t){super(),this.store=t}async get(t){const e=await this.store.get(t);if(!e)throw new Error(`Incomplete CAR. Block missing for CID ${t}`);if(!ro({cid:t,bytes:e}))throw new Error(`Invalid CAR. Hash of block data does not match CID ${t}`);return e}static fromBlockstore(t){return new no(t)}static fromCarReader(t){return new no({get:async e=>{const n=await t.get(e);return null===n||void 0===n?void 0:n.bytes}})}}async function ro({cid:t,bytes:e}){const n=await kn.sha256.digest(e);return eo(n.digest,t.multihash.digest)}async function*io(t,{roots:e,blockstore:n}={}){const r=await dn.fromIterable(so(t)),i=n||new ss;for await(const o of r)await i.put(o.cid,o.bytes);const s=no.fromBlockstore(i);e&&0!==e.length||(e=await r.getRoots());for(const o of e)yield*to(o,s)}function so(t){return Symbol.asyncIterator in t?t:Di(t)}const oo=({enumerable:t=!0,configurable:e=!1}={})=>({enumerable:t,configurable:e,writable:!1}),ao=function*(t,e){if(null!=t&&!(t instanceof Uint8Array))for(const[n,r]of Object.entries(t)){const t=[...e,n];if(null!=r&&"object"===typeof r)if(Array.isArray(r))for(const[e,n]of r.entries()){const r=[...t,e],i=Nn.k0.asCID(n);i?yield[r.join("/"),i]:"object"===typeof n&&(yield*ao(n,r))}else{const e=Nn.k0.asCID(r);e?yield[t.join("/"),e]:yield*ao(r,t)}}},co=function*(t,e){if(null!=t)for(const[n,r]of Object.entries(t)){const t=[...e,n];if(yield t.join("/"),null!=r&&!(r instanceof Uint8Array)&&"object"===typeof r&&!Nn.k0.asCID(r))if(Array.isArray(r))for(const[e,n]of r.entries()){const r=[...t,e];yield r.join("/"),"object"!==typeof n||Nn.k0.asCID(n)||(yield*co(n,r))}else yield*co(r,t)}},lo=(t,e)=>{let n=t;for(const[r,i]of e.entries()){if(n=n[i],null==n)throw new Error(`Object has no property at ${e.slice(0,r+1).map((t=>`[${JSON.stringify(t)}]`)).join("")}`);const t=Nn.k0.asCID(n);if(t)return{value:t,remaining:e.slice(r+1).join("/")}}return{value:n}};class uo{constructor({cid:t,bytes:e,value:n}){if(!t||!e||"undefined"===typeof n)throw new Error("Missing required argument");this.cid=t,this.bytes=e,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:oo(),bytes:oo(),value:oo(),asBlock:oo()})}links(){return ao(this.value,[])}tree(){return co(this.value,[])}get(t="/"){return lo(this.value,t.split("/").filter(Boolean))}}const ho=42;function fo(t){if(t.asCID!==t)return null;const e=p.k.asCID(t);if(!e)return null;const n=new Uint8Array(e.bytes.byteLength+1);return n.set(e.bytes,1),[new _(E.tag,ho),new _(E.bytes,n)]}function po(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function go(t){if(Number.isNaN(t))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(t===1/0||t===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const mo={float64:!0,typeEncoders:{Object:fo,undefined:po,number:go}};function yo(t){if(0!==t[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return p.k.decode(t.subarray(1))}const wo={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};wo.tags[ho]=yo;const bo="dag-cbor",vo=113,Eo=t=>Ne(t,mo),_o=t=>Ue(t,wo);class So{constructor(t,e,n={}){if("number"!==typeof e||e<=0)throw new Error("invalid target chunk size");this._reader=t,this._targetSize=e,this._decoders=[r,Pr,s,...n.decoders||[]]}async*cars(){const t=await this._reader.getRoots();if(1!==t.length)throw new Error(`unexpected number of roots: ${t.length}`);let e;for await(const n of this._cars(t[0]))e=n.channel,n.out&&(yield n.out);if(!e)throw new Error("missing CAR writer channel");e.writer.close(),yield e.out}async _get(t){const e=await this._reader.get(t);if(!e)throw new Error(`missing block for ${t}`);const{bytes:n}=e,r=this._decoders.find((e=>e.code===t.code));if(!r)throw new Error(`missing decoder for ${t.code}`);return new uo({cid:t,bytes:n,value:r.decode(n)})}async*_cars(t,e=[],n=undefined){const r=await this._get(t);if(n=n||Object.assign(En.create(t),{size:0}),n.size>0&&n.size+r.bytes.byteLength>=this._targetSize){n.writer.close();const{out:t}=n;n=Ao(e),yield{channel:n,out:t}}e=e.concat(r),n.size+=r.bytes.byteLength,n.writer.put(r);for(const[,i]of r.links())for await(const t of this._cars(i,e,n))n=t.channel,yield t;if(!n)throw new Error("missing CAR writer channel");yield{channel:n}}static async fromIterable(t,e,n){const r=await cn.fromIterable(t);return new So(r,e,n)}static async fromBlob(t,e,n){const r=await t.arrayBuffer(),i=await cn.fromBytes(new Uint8Array(r));return new So(i,e,n)}}function Ao(t){const e=Object.assign(En.create(t[0].cid),{size:t.reduce(((t,e)=>t+e.bytes.byteLength),0)});for(const n of t)e.writer.put(n);return e}var Co=n(1978);const Io=globalThis.fetch,To=(globalThis.Request,globalThis.Response,globalThis.Blob),ko=globalThis.File,Ro=ss,No=5,Do=3,Oo=52428800,Po=1048576,xo=104857600,Mo=30,Lo=1e4;function Bo(){const t=Co(Mo,Lo);return()=>t((()=>{}))}const Uo=Bo();class Fo{constructor({token:t,endpoint:e=new URL("https://api.web3.storage"),rateLimiter:n,fetch:r=Io}){this.token=t,this.endpoint=e,this.rateLimiter=n||Bo(),this.fetch=r}static headers(t){if(!t)throw new Error("missing token");return{Authorization:`Bearer ${t}`,"X-Client":"web3.storage/js"}}static async put({endpoint:t,token:e,rateLimiter:n=Uo,fetch:r=Io},i,{onRootCidReady:s,onStoredChunk:o,maxRetries:a=No,maxChunkSize:c=Oo,wrapWithDirectory:l=!0,name:u,signal:h}={}){if(c>=xo||c<Po)throw new Error("maximum chunk size must be less than 100MiB and greater than or equal to 1MB");const d=new Ro;try{const{out:f,root:p}=await as({input:Array.from(i).map(Ho),blockstore:d,wrapWithDirectory:l,maxChunkSize:Po,maxChildrenPerNode:1024});s&&s(p.toString());const g=await cn.fromIterable(f);return await Fo.putCar({endpoint:t,token:e,rateLimiter:n,fetch:r},g,{onStoredChunk:o,maxRetries:a,maxChunkSize:c,name:u,signal:h})}finally{await d.close()}}static async putCar({endpoint:t,token:e,rateLimiter:n=Uo,fetch:r=Io},i,{name:s,onStoredChunk:o,maxRetries:a=No,maxChunkSize:c=Oo,decoders:h,signal:d}={}){if(c>=xo||c<Po)throw new Error("maximum chunk size must be less than 100MiB and greater than or equal to 1MB");const f=c,p=new URL("car",t);let g=Fo.headers(e);s&&(g={...g,"X-Name":encodeURIComponent(s)});const m=await i.getRoots();if(null==m[0])throw new Error("missing root CID");if(m.length>1)throw new Error("too many roots");const y=m[0].toString(),w=new So(i,f,{decoders:h}),b=async t=>{const e=[];for await(const n of t)e.push(n);const i=new To(e,{type:"application/vnd.ipld.car"}),s=await u((async()=>{let t;await n();try{t=await r(p.toString(),{method:"POST",headers:g,body:i,signal:d})}catch(s){throw d&&d.aborted?new u.AbortError(s):s}if(429===t.status)throw new Error("rate limited");const e=await t.json();if(!t.ok)throw new Error(e.message);if(e.cid!==y)throw new Error(`root CID mismatch, expected: ${y}, received: ${e.cid}`);return e.cid}),{retries:a});return o&&o(i.size),s},v=l(Do,b);for await(const l of v(w.cars()));return y}static async get({endpoint:t,token:e,rateLimiter:n=Uo,fetch:r=Io},i,s={}){const o=new URL(`car/${i}`,t);await n();const a=await r(o.toString(),{method:"GET",headers:Fo.headers(e),signal:s.signal});if(429===a.status)throw new Error("rate limited");return jo(a)}static async delete({endpoint:t,token:e,rateLimiter:n=Uo},r,i={}){throw console.log("Not deleting",r,t,e,n,i),Error(".delete not implemented yet")}static async status({endpoint:t,token:e,rateLimiter:n=Uo,fetch:r=Io},i,s={}){const o=new URL(`status/${i}`,t);await n();const a=await r(o.toString(),{method:"GET",headers:Fo.headers(e),signal:s.signal});if(429===a.status)throw new Error("rate limited");if(404!==a.status){if(!a.ok)throw new Error(a.statusText);return a.json()}}static async*list(t,{before:e=(new Date).toISOString(),maxResults:n=1/0,signal:r}={}){async function i({endpoint:t,token:e,rateLimiter:n=Uo,fetch:i=Io},{before:s,size:o}){const a=new URLSearchParams({before:s,size:o.toString()}),c=new URL(`user/uploads?${a}`,t);return await n(),i(c.toString(),{method:"GET",headers:{...Fo.headers(e),"Access-Control-Request-Headers":"Link"},signal:r})}let s=0;const o=n>100?100:n;for await(const a of $o(i,t,{before:e,size:o})){if(!a.ok){if(429===a.status)throw new Error("rate limited");const t=await a.json();throw new Error(`${a.status} ${a.statusText} ${t?"- "+t.message:""}`)}const t=await a.json();for(const e of t){if(++s>n)return;yield e}}}put(t,e){return Fo.put(this,t,e)}putCar(t,e){return Fo.putCar(this,t,e)}get(t,e){return Fo.get(this,t,e)}delete(t,e){return Fo.delete(this,t,e)}status(t,e){return Fo.status(this,t,e)}list(t){return Fo.list(this,t)}}async function zo({content:t,path:e,cid:n}){const r=[];for await(const s of t())r.push(s);const i=new ko(r,Vo(e));return Object.assign(i,{cid:n.toString()})}function Vo(t){const e=t.indexOf("/");return-1===e?t:t.substring(e+1)}function jo(t){const e=Object.assign(t,{unixFsIterator:async function*(){if(!t.ok)throw new Error(`Response was not ok: ${t.status} ${t.statusText} - Check for { "ok": false } on the Response object before calling .unixFsIterator`);if(!t.body)throw new Error("No body on response");const e=new Ro;try{for await(const n of io(t.body,{blockstore:e}))yield n}finally{await e.close()}},files:async()=>{if(!t.ok)throw new Error(`Response was not ok: ${t.status} ${t.statusText} - Check for { "ok": false } on the Response object before calling .files`);const n=[];for await(const t of e.unixFsIterator()){if("directory"===t.type)continue;const e=await zo(t);n.push(e)}return n}});return e}function Ho(t){let e;return{path:t.name,get content(){return e=e||t.stream(),e}}}async function*$o(t,e,n){let r=await t(e,n);yield r;let i=gs(r.headers.get("Link")||"");while(i&&i.next)r=await t(e,i.next),yield r,i=gs(r.headers.get("Link")||"")}},7195:function(t,e,n){"use strict";n.d(e,{JR:function(){return h},SF:function(){return f},US:function(){return u}});var r=n(1811),i=n(3248),s=n(6969),o=n(7862),a=n(1634);let c=null;const l=()=>{const t=c;c=null,t.forEach(((t,e)=>{const n=e.state.tr,i=r.Gt.getState(e.state);i&&i.binding&&!i.binding.isDestroyed&&(t.forEach(((t,e)=>{n.setMeta(e,t)})),e.dispatch(n))}))},u=(t,e,n)=>{c||(c=new Map,a.Vs(0,l)),o.Yu(c,t,o.Ue).set(e,n)},h=(t,e,n)=>{if(0===t)return i.w$(e,0);let r=null===e._first?null:e._first.content.type;while(null!==r&&e!==r){if(r instanceof i.eI){if(r._length>=t)return i.w$(r,t);if(t-=r._length,null!==r._item&&null!==r._item.next)r=r._item.next.content.type;else{do{r=null===r._item?null:r._item.parent,t--}while(r!==e&&null!==r&&null!==r._item&&null===r._item.next);null!==r&&r!==e&&(r=null===r._item?null:r._item.next.content.type)}}else{const s=(n.get(r)||{nodeSize:0}).nodeSize;if(null!==r._first&&t<s)r=r._first.content.type,t--;else{if(1===t&&0===r._length&&s>1)return new i.Zi(null===r._item?null:r._item.id,null===r._item?i.BW(r):null,null);if(t-=s,null!==r._item&&null!==r._item.next)r=r._item.next.content.type;else{if(0===t)return r=null===r._item?r:r._item.parent,new i.Zi(null===r._item?null:r._item.id,null===r._item?i.BW(r):null,null);do{r=r._item.parent,t--}while(r!==e&&null===r._item.next);r!==e&&(r=r._item.next.content.type)}}}if(null===r)throw s.zR();if(0===t&&r.constructor!==i.eI&&r!==e)return d(r._item.parent,r._item)}return i.w$(e,e._length)},d=(t,e)=>{let n=null,r=null;return null===t._item?r=i.BW(t):n=i.at(t._item.id.client,t._item.id.clock),new i.Zi(n,r,e.id)},f=(t,e,n,r)=>{const s=i.or(n,t);if(null===s||s.type!==e&&!i.$4(e,s.type._item))return null;let o=s.type,a=0;if(o.constructor===i.eI)a=s.index;else if(null===o._item||!o._item.deleted){let t=o._first,e=0;while(e<o._length&&e<s.index&&null!==t){if(!t.deleted){const n=t.content.type;e++,n instanceof i.eI?a+=n._length:a+=r.get(n).nodeSize}t=t.right}a+=1}while(o!==e&&null!==o._item){const t=o._item.parent;if(null===t._item||!t._item.deleted){a+=1;let e=t._first;while(null!==e){const t=e.content.type;if(t===o)break;e.deleted||(t instanceof i.eI?a+=t._length:a+=r.get(t).nodeSize),e=e.right}}o=t}return a-1}},1811:function(t,e,n){"use strict";n.d(e,{Gk:function(){return s},Gt:function(){return i},uJ:function(){return o}});var r=n(157);const i=new r.H$("y-sync"),s=new r.H$("y-undo"),o=new r.H$("yjs-cursor")},3248:function(t,e,n){"use strict";n.d(e,{MM:function(){return vi},$_:function(){return Ii},zc:function(){return Li},QW:function(){return Ee},ck:function(){return ji},Zi:function(){return rn},aC:function(){return dn},xv:function(){return Xr},H6:function(){return zn},lt:function(){return ei},eI:function(){return oi},NG:function(){return Be},Uq:function(){return hn},or:function(){return un},VG:function(){return ge},at:function(){return tn},og:function(){return sn},w$:function(){return ln},Ox:function(){return fn},D$:function(){return ze},gJ:function(){return Ge},BW:function(){return en},uY:function(){return he},$4:function(){return nn},UQ:function(){return le},CO:function(){return pn},ud:function(){return fr}});n(7658),n(3767),n(8585),n(8696),n(541);var r=n(7862),i=n(893);const s=t=>t[t.length-1],o=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},a=Array.from,c=Array.isArray;class l{constructor(){this._observers=r.Ue()}on(t,e){r.Yu(this._observers,t,i.Ue).add(e)}once(t,e){const n=(...r)=>{this.off(t,n),e(...r)};this.on(t,n)}off(t,e){const n=this._observers.get(t);void 0!==n&&(n.delete(e),0===n.size&&this._observers.delete(t))}emit(t,e){return a((this._observers.get(t)||r.Ue()).values()).forEach((t=>t(...e)))}destroy(){this._observers=r.Ue()}}var u=n(1383),h=(n(2801),n(654)),d=n(6413);const f=t=>new Uint8Array(t),p=(t,e,n)=>new Uint8Array(t,e,n),g=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=h.IK(t[n]);return btoa(e)},m=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),y=t=>{const e=atob(t),n=f(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},w=t=>{const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},b=(d.jU,d.jU,t=>{const e=f(t.byteLength);return e.set(t),e}),v=1,E=2,_=4,S=8,A=32,C=64,I=128,T=31,k=63,R=127,N=2147483647,D=Number.MAX_SAFE_INTEGER,O=(Number.MIN_SAFE_INTEGER,Number.isInteger||(t=>"number"===typeof t&&isFinite(t)&&u.GW(t)===t));Number.isNaN,Number.parseInt;class P{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const x=()=>new P,M=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},L=t=>{const e=new Uint8Array(M(t));let n=0;for(let r=0;r<t.bufs.length;r++){const i=t.bufs[r];e.set(i,n),n+=i.length}return e.set(p(t.cbuf.buffer,0,t.cpos),n),e},B=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(p(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(2*u.Fp(n,e)),t.cpos=0)},U=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(2*n),t.cpos=0),t.cbuf[t.cpos++]=e},F=U,z=(t,e)=>{while(e>R)U(t,I|R&e),e=u.GW(e/128);U(t,R&e)},V=(t,e)=>{const n=u.GR(e);n&&(e=-e),U(t,(e>k?I:0)|(n?C:0)|k&e),e=u.GW(e/64);while(e>0)U(t,(e>R?I:0)|R&e),e=u.GW(e/128)},j=new Uint8Array(3e4),H=j.length/3,$=(t,e)=>{if(e.length<H){const n=h.YZ.encodeInto(e,j).written||0;z(t,n);for(let e=0;e<n;e++)U(t,j[e])}else W(t,h.lz(e))},K=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;z(t,r);for(let i=0;i<r;i++)U(t,n.codePointAt(i))},G=h.YZ&&h.YZ.encodeInto?$:K,q=(t,e)=>{const n=t.cbuf.length,r=t.cpos,i=u.VV(n-r,e.length),s=e.length-i;t.cbuf.set(e.subarray(0,i),r),t.cpos+=i,s>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(u.Fp(2*n,s)),t.cbuf.set(e.subarray(i)),t.cpos=s)},W=(t,e)=>{z(t,e.byteLength),q(t,e)},Y=(t,e)=>{B(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},X=(t,e)=>Y(t,4).setFloat32(0,e,!1),Q=(t,e)=>Y(t,8).setFloat64(0,e,!1),J=(t,e)=>Y(t,8).setBigInt64(0,e,!1),Z=new DataView(new ArrayBuffer(4)),tt=t=>(Z.setFloat32(0,t),Z.getFloat32(0)===t),et=(t,e)=>{switch(typeof e){case"string":U(t,119),G(t,e);break;case"number":O(e)&&u.Wn(e)<=N?(U(t,125),V(t,e)):tt(e)?(U(t,124),X(t,e)):(U(t,123),Q(t,e));break;case"bigint":U(t,122),J(t,e);break;case"object":if(null===e)U(t,126);else if(e instanceof Array){U(t,117),z(t,e.length);for(let n=0;n<e.length;n++)et(t,e[n])}else if(e instanceof Uint8Array)U(t,116),W(t,e);else{U(t,118);const n=Object.keys(e);z(t,n.length);for(let r=0;r<n.length;r++){const i=n[r];G(t,i),et(t,e[i])}}break;case"boolean":U(t,e?120:121);break;default:U(t,127)}};class nt extends P{constructor(t){super(),this.w=t,this.s=null,this.count=0}write(t){this.s===t?this.count++:(this.count>0&&z(this,this.count-1),this.count=1,this.w(this,t),this.s=t)}}const rt=t=>{t.count>0&&(V(t.encoder,1===t.count?t.s:-t.s),t.count>1&&z(t.encoder,t.count-2))};class it{constructor(){this.encoder=new P,this.s=0,this.count=0}write(t){this.s===t?this.count++:(rt(this),this.count=1,this.s=t)}toUint8Array(){return rt(this),L(this.encoder)}}const st=t=>{if(t.count>0){const e=2*t.diff+(1===t.count?0:1);V(t.encoder,e),t.count>1&&z(t.encoder,t.count-2)}};class ot{constructor(){this.encoder=new P,this.s=0,this.count=0,this.diff=0}write(t){this.diff===t-this.s?(this.s=t,this.count++):(st(this),this.count=1,this.diff=t-this.s,this.s=t)}toUint8Array(){return st(this),L(this.encoder)}}class at{constructor(){this.sarr=[],this.s="",this.lensE=new it}write(t){this.s+=t,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(t.length)}toUint8Array(){const t=new P;return this.sarr.push(this.s),this.s="",G(t,this.sarr.join("")),q(t,this.lensE.toUint8Array()),L(t)}}var ct=n(6969);const lt=ct.Ue("Unexpected end of array"),ut=ct.Ue("Integer out of Range");class ht{constructor(t){this.arr=t,this.pos=0}}const dt=t=>new ht(t),ft=t=>t.pos!==t.arr.length,pt=(t,e)=>{const n=p(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},gt=t=>pt(t,yt(t)),mt=t=>t.arr[t.pos++],yt=t=>{let e=0,n=1;const r=t.arr.length;while(t.pos<r){const r=t.arr[t.pos++];if(e+=(r&R)*n,n*=128,r<I)return e;if(e>D)throw ut}throw lt},wt=t=>{let e=t.arr[t.pos++],n=e&k,r=64;const i=(e&C)>0?-1:1;if(0===(e&I))return i*n;const s=t.arr.length;while(t.pos<s){if(e=t.arr[t.pos++],n+=(e&R)*r,r*=128,e<I)return i*n;if(n>D)throw ut}throw lt},bt=t=>{let e=yt(t);if(0===e)return"";{let n=String.fromCodePoint(mt(t));if(--e<100)while(e--)n+=String.fromCodePoint(mt(t));else while(e>0){const r=e<1e4?e:1e4,i=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,i),e-=r}return decodeURIComponent(escape(n))}},vt=t=>h.CO.decode(gt(t)),Et=h.CO?vt:bt,_t=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},St=t=>_t(t,4).getFloat32(0,!1),At=t=>_t(t,8).getFloat64(0,!1),Ct=t=>_t(t,8).getBigInt64(0,!1),It=[t=>{},t=>null,wt,St,At,Ct,t=>!1,t=>!0,Et,t=>{const e=yt(t),n={};for(let r=0;r<e;r++){const e=Et(t);n[e]=Tt(t)}return n},t=>{const e=yt(t),n=[];for(let r=0;r<e;r++)n.push(Tt(t));return n},gt],Tt=t=>It[127-mt(t)](t);class kt extends ht{constructor(t,e){super(t),this.reader=e,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),ft(this)?this.count=yt(this)+1:this.count=-1),this.count--,this.s}}class Rt extends ht{constructor(t){super(t),this.s=0,this.count=0}read(){if(0===this.count){this.s=wt(this);const t=u.GR(this.s);this.count=1,t&&(this.s=-this.s,this.count=yt(this)+2)}return this.count--,this.s}}class Nt extends ht{constructor(t){super(t),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const t=wt(this),e=1&t;this.diff=u.GW(t/2),this.count=1,e&&(this.count=yt(this)+2)}return this.s+=this.diff,this.count--,this.s}}class Dt{constructor(t){this.decoder=new Rt(t),this.str=Et(this.decoder),this.spos=0}read(){const t=this.spos+this.decoder.read(),e=this.str.slice(this.spos,t);return this.spos=t,e}}var Ot=n(6157);const Pt=t=>new Promise(t);var xt=n(7409);const Mt=Symbol;class Lt{constructor(t,e){this.left=t,this.right=e}}const Bt=(t,e)=>new Lt(t,e);var Ut=n(7214);const Ft=Date.now,zt=Mt(),Vt=Mt(),jt=Mt(),Ht=Mt(),$t=Mt(),Kt=Mt(),Gt=Mt(),qt=Mt(),Wt=Mt(),Yt={[zt]:Bt("font-weight","bold"),[Vt]:Bt("font-weight","normal"),[jt]:Bt("color","blue"),[$t]:Bt("color","green"),[Ht]:Bt("color","grey"),[Kt]:Bt("color","red"),[Gt]:Bt("color","purple"),[qt]:Bt("color","orange"),[Wt]:Bt("color","black")},Xt={[zt]:"[1m",[Vt]:"[2m",[jt]:"[34m",[$t]:"[32m",[Ht]:"[37m",[Kt]:"[31m",[Gt]:"[35m",[qt]:"[38;5;208m",[Wt]:"[0m"},Qt=t=>{const e=[],n=[],i=r.Ue();let s=[],o=0;for(;o<t.length;o++){const r=t[o],s=Yt[r];if(void 0!==s)i.set(s.left,s.right);else{if(r.constructor!==String&&r.constructor!==Number)break;{const t=Ut.x0(i);o>0||t.length>0?(e.push("%c"+r),n.push(t)):e.push(r)}}}for(o>0&&(s=n,s.unshift(e.join("")));o<t.length;o++){const e=t[o];e instanceof Symbol||s.push(e)}return s},Jt=t=>{const e=[],n=[];let r=0;for(;r<t.length;r++){const n=t[r],i=Xt[n];if(void 0===i){if(n.constructor!==String&&n.constructor!==Number)break;e.push(n)}}for(r>0&&n.push(e.join(""));r<t.length;r++){const e=t[r];e instanceof Symbol||(e.constructor===Object?n.push(JSON.stringify(e)):n.push(e))}return n},Zt=t=>{const e=[],n=[];let r=0;for(;r<t.length;r++){const n=t[r],i=Xt[n];if(void 0!==i)e.push(i);else{if(n.constructor!==String&&n.constructor!==Number)break;e.push(n)}}for(r>0&&(e.push("[0m"),n.push(e.join("")));r<t.length;r++){const e=t[r];e instanceof Symbol||n.push(e)}return n},te=d.hH?d.UG?Zt:Qt:Jt,ee=(...t)=>{console.log(...te(t)),ne.forEach((e=>e.print(t)))},ne=i.Ue();Ft();const re=t=>({[Symbol.iterator](){return this},next:t}),ie=(t,e)=>re((()=>{let n;do{n=t.next()}while(!n.done&&!e(n.value));return n})),se=(t,e)=>re((()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}}));var oe=n(1370);class ae{constructor(t,e){this.clock=t,this.len=e}}class ce{constructor(){this.clients=new Map}}const le=(t,e,n)=>e.clients.forEach(((e,r)=>{const i=t.doc.store.clients.get(r);for(let s=0;s<e.length;s++){const r=e[s];kn(t,i,r.clock,r.len,n)}})),ue=(t,e)=>{let n=0,r=t.length-1;while(n<=r){const i=u.GW((n+r)/2),s=t[i],o=s.clock;if(o<=e){if(e<o+s.len)return i;n=i+1}else r=i-1}return null},he=(t,e)=>{const n=t.clients.get(e.client);return void 0!==n&&null!==ue(n,e.clock)},de=t=>{t.clients.forEach((t=>{let e,n;for(t.sort(((t,e)=>t.clock-e.clock)),e=1,n=1;e<t.length;e++){const r=t[n-1],i=t[e];r.clock+r.len>=i.clock?r.len=u.Fp(r.len,i.clock+i.len-r.clock):(n<e&&(t[n]=i),n++)}t.length=n}))},fe=t=>{const e=new ce;for(let n=0;n<t.length;n++)t[n].clients.forEach(((r,i)=>{if(!e.clients.has(i)){const s=r.slice();for(let e=n+1;e<t.length;e++)o(s,t[e].clients.get(i)||[]);e.clients.set(i,s)}}));return de(e),e},pe=(t,e,n,i)=>{r.Yu(t.clients,e,(()=>[])).push(new ae(n,i))},ge=()=>new ce,me=t=>{const e=ge();return t.clients.forEach(((t,n)=>{const r=[];for(let e=0;e<t.length;e++){const n=t[e];if(n.deleted){const i=n.id.clock;let s=n.length;if(e+1<t.length)for(let n=t[e+1];e+1<t.length&&n.deleted;n=t[1+ ++e])s+=n.length;r.push(new ae(i,s))}}r.length>0&&e.clients.set(n,r)})),e},ye=(t,e)=>{z(t.restEncoder,e.clients.size),a(e.clients.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{t.resetDsCurVal(),z(t.restEncoder,e);const r=n.length;z(t.restEncoder,r);for(let i=0;i<r;i++){const e=n[i];t.writeDsClock(e.clock),t.writeDsLen(e.len)}}))},we=t=>{const e=new ce,n=yt(t.restDecoder);for(let i=0;i<n;i++){t.resetDsCurVal();const n=yt(t.restDecoder),i=yt(t.restDecoder);if(i>0){const s=r.Yu(e.clients,n,(()=>[]));for(let e=0;e<i;e++)s.push(new ae(t.readDsClock(),t.readDsLen()))}}return e},be=(t,e,n)=>{const r=new ce,i=yt(t.restDecoder);for(let s=0;s<i;s++){t.resetDsCurVal();const i=yt(t.restDecoder),s=yt(t.restDecoder),o=n.clients.get(i)||[],a=bn(n,i);for(let n=0;n<s;n++){const n=t.readDsClock(),s=n+t.readDsLen();if(n<a){a<s&&pe(r,i,a,s-a);let t=En(o,n),c=o[t];!c.deleted&&c.id.clock<n&&(o.splice(t+1,0,zi(e,c,n-c.id.clock)),t++);while(t<o.length){if(c=o[t++],!(c.id.clock<s))break;c.deleted||(s<c.id.clock+c.length&&o.splice(t,0,zi(e,c,s-c.id.clock)),c.delete(e))}}else pe(r,i,n,s-n)}}if(r.clients.size>0){const t=new Re;return z(t.restEncoder,0),ye(t,r),t.toUint8Array()}return null},ve=Ot.U7;class Ee extends l{constructor({guid:t=Ot.k$(),collectionid:e=null,gc:n=!0,gcFilter:r=(()=>!0),meta:i=null,autoLoad:s=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=ve(),this.guid=t,this.collectionid=e,this.share=new Map,this.store=new yn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=s,this.meta=i,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Pt((t=>{this.on("load",(()=>{this.isLoaded=!0,t(this)}))}));const a=()=>Pt((t=>{const e=n=>{void 0!==n&&!0!==n||(this.off("sync",e),t())};this.on("sync",e)}));this.on("sync",(t=>{!1===t&&this.isSynced&&(this.whenSynced=a()),this.isSynced=void 0===t||!0===t,this.isLoaded||this.emit("load",[])})),this.whenSynced=a()}load(){const t=this._item;null===t||this.shouldLoad||Ln(t.parent.doc,(t=>{t.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(a(this.subdocs).map((t=>t.guid)))}transact(t,e=null){return Ln(this,t,e)}get(t,e=ur){const n=r.Yu(this.share,t,(()=>{const t=new e;return t._integrate(this,null),t})),i=n.constructor;if(e!==ur&&i!==e){if(i===ur){const r=new e;r._map=n._map,n._map.forEach((t=>{for(;null!==t;t=t.left)t.parent=r})),r._start=n._start;for(let t=r._start;null!==t;t=t.right)t.parent=r;return r._length=n._length,this.share.set(t,r),r._integrate(this,null),r}throw new Error(`Type with the name ${t} has already been defined with a different constructor`)}return n}getArray(t=""){return this.get(t,Nr)}getText(t=""){return this.get(t,Xr)}getMap(t=""){return this.get(t,Pr)}getXmlFragment(t=""){return this.get(t,Zr)}toJSON(){const t={};return this.share.forEach(((e,n)=>{t[n]=e.toJSON()})),t}destroy(){a(this.subdocs).forEach((t=>t.destroy()));const t=this._item;if(null!==t){this._item=null;const e=t.content;e.doc=new Ee({guid:this.guid,...e.opts,shouldLoad:!1}),e.doc._item=t,Ln(t.parent.doc,(n=>{const r=e.doc;t.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(t,e){super.on(t,e)}off(t,e){super.off(t,e)}}class _e{constructor(t){this.restDecoder=t}resetDsCurVal(){}readDsClock(){return yt(this.restDecoder)}readDsLen(){return yt(this.restDecoder)}}class Se extends _e{readLeftID(){return tn(yt(this.restDecoder),yt(this.restDecoder))}readRightID(){return tn(yt(this.restDecoder),yt(this.restDecoder))}readClient(){return yt(this.restDecoder)}readInfo(){return mt(this.restDecoder)}readString(){return Et(this.restDecoder)}readParentInfo(){return 1===yt(this.restDecoder)}readTypeRef(){return yt(this.restDecoder)}readLen(){return yt(this.restDecoder)}readAny(){return Tt(this.restDecoder)}readBuf(){return b(gt(this.restDecoder))}readJSON(){return JSON.parse(Et(this.restDecoder))}readKey(){return Et(this.restDecoder)}}class Ae{constructor(t){this.dsCurrVal=0,this.restDecoder=t}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=yt(this.restDecoder),this.dsCurrVal}readDsLen(){const t=yt(this.restDecoder)+1;return this.dsCurrVal+=t,t}}class Ce extends Ae{constructor(t){super(t),this.keys=[],yt(t),this.keyClockDecoder=new Nt(gt(t)),this.clientDecoder=new Rt(gt(t)),this.leftClockDecoder=new Nt(gt(t)),this.rightClockDecoder=new Nt(gt(t)),this.infoDecoder=new kt(gt(t),mt),this.stringDecoder=new Dt(gt(t)),this.parentInfoDecoder=new kt(gt(t),mt),this.typeRefDecoder=new Rt(gt(t)),this.lenDecoder=new Rt(gt(t))}readLeftID(){return new Je(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Je(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Tt(this.restDecoder)}readBuf(){return gt(this.restDecoder)}readJSON(){return Tt(this.restDecoder)}readKey(){const t=this.keyClockDecoder.read();if(t<this.keys.length)return this.keys[t];{const t=this.stringDecoder.read();return this.keys.push(t),t}}}class Ie{constructor(){this.restEncoder=x()}toUint8Array(){return L(this.restEncoder)}resetDsCurVal(){}writeDsClock(t){z(this.restEncoder,t)}writeDsLen(t){z(this.restEncoder,t)}}class Te extends Ie{writeLeftID(t){z(this.restEncoder,t.client),z(this.restEncoder,t.clock)}writeRightID(t){z(this.restEncoder,t.client),z(this.restEncoder,t.clock)}writeClient(t){z(this.restEncoder,t)}writeInfo(t){F(this.restEncoder,t)}writeString(t){G(this.restEncoder,t)}writeParentInfo(t){z(this.restEncoder,t?1:0)}writeTypeRef(t){z(this.restEncoder,t)}writeLen(t){z(this.restEncoder,t)}writeAny(t){et(this.restEncoder,t)}writeBuf(t){W(this.restEncoder,t)}writeJSON(t){G(this.restEncoder,JSON.stringify(t))}writeKey(t){G(this.restEncoder,t)}}class ke{constructor(){this.restEncoder=x(),this.dsCurrVal=0}toUint8Array(){return L(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(t){const e=t-this.dsCurrVal;this.dsCurrVal=t,z(this.restEncoder,e)}writeDsLen(t){0===t&&ct.zR(),z(this.restEncoder,t-1),this.dsCurrVal+=t}}class Re extends ke{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new ot,this.clientEncoder=new it,this.leftClockEncoder=new ot,this.rightClockEncoder=new ot,this.infoEncoder=new nt(F),this.stringEncoder=new at,this.parentInfoEncoder=new nt(F),this.typeRefEncoder=new it,this.lenEncoder=new it}toUint8Array(){const t=x();return z(t,0),W(t,this.keyClockEncoder.toUint8Array()),W(t,this.clientEncoder.toUint8Array()),W(t,this.leftClockEncoder.toUint8Array()),W(t,this.rightClockEncoder.toUint8Array()),W(t,L(this.infoEncoder)),W(t,this.stringEncoder.toUint8Array()),W(t,L(this.parentInfoEncoder)),W(t,this.typeRefEncoder.toUint8Array()),W(t,this.lenEncoder.toUint8Array()),q(t,L(this.restEncoder)),L(t)}writeLeftID(t){this.clientEncoder.write(t.client),this.leftClockEncoder.write(t.clock)}writeRightID(t){this.clientEncoder.write(t.client),this.rightClockEncoder.write(t.clock)}writeClient(t){this.clientEncoder.write(t)}writeInfo(t){this.infoEncoder.write(t)}writeString(t){this.stringEncoder.write(t)}writeParentInfo(t){this.parentInfoEncoder.write(t?1:0)}writeTypeRef(t){this.typeRefEncoder.write(t)}writeLen(t){this.lenEncoder.write(t)}writeAny(t){et(this.restEncoder,t)}writeBuf(t){W(this.restEncoder,t)}writeJSON(t){et(this.restEncoder,t)}writeKey(t){const e=this.keyMap.get(t);void 0===e?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(t)):this.keyClockEncoder.write(e)}}const Ne=(t,e,n,r)=>{r=u.Fp(r,e[0].id.clock);const i=En(e,r);z(t.restEncoder,e.length-i),t.writeClient(n),z(t.restEncoder,r);const s=e[i];s.write(t,r-s.id.clock);for(let o=i+1;o<e.length;o++)e[o].write(t,0)},De=(t,e,n)=>{const r=new Map;n.forEach(((t,n)=>{bn(e,n)>t&&r.set(n,t)})),wn(e).forEach(((t,e)=>{n.has(e)||r.set(e,0)})),z(t.restEncoder,r.size),a(r.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([n,r])=>{Ne(t,e.clients.get(n),n,r)}))},Oe=(t,e)=>{const n=r.Ue(),i=yt(t.restDecoder);for(let r=0;r<i;r++){const r=yt(t.restDecoder),i=new Array(r),s=t.readClient();let o=yt(t.restDecoder);n.set(s,{i:0,refs:i});for(let n=0;n<r;n++){const r=t.readInfo();switch(T&r){case 0:{const e=t.readLen();i[n]=new ui(tn(s,o),e),o+=e;break}case 10:{const e=yt(t.restDecoder);i[n]=new Gi(tn(s,o),e),o+=e;break}default:{const a=0===(r&(C|I)),c=new ji(tn(s,o),null,(r&I)===I?t.readLeftID():null,null,(r&C)===C?t.readRightID():null,a?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,a&&(r&A)===A?t.readString():null,Hi(t,r));i[n]=c,o+=c.length}}}}return n},Pe=(t,e,n)=>{const i=[];let s=a(n.keys()).sort(((t,e)=>t-e));if(0===s.length)return null;const o=()=>{if(0===s.length)return null;let t=n.get(s[s.length-1]);while(t.refs.length===t.i){if(s.pop(),!(s.length>0))return null;t=n.get(s[s.length-1])}return t};let c=o();if(null===c&&0===i.length)return null;const l=new yn,u=new Map,h=(t,e)=>{const n=u.get(t);(null==n||n>e)&&u.set(t,e)};let d=c.refs[c.i++];const f=new Map,p=()=>{for(const t of i){const e=t.id.client,r=n.get(e);r?(r.i--,l.clients.set(e,r.refs.slice(r.i)),n.delete(e),r.i=0,r.refs=[]):l.clients.set(e,[t]),s=s.filter((t=>t!==e))}i.length=0};while(1){if(d.constructor!==Gi){const s=r.Yu(f,d.id.client,(()=>bn(e,d.id.client))),o=s-d.id.clock;if(o<0)i.push(d),h(d.id.client,d.id.clock-1),p();else{const r=d.getMissing(t,e);if(null!==r){i.push(d);const t=n.get(r)||{refs:[],i:0};if(t.refs.length!==t.i){d=t.refs[t.i++];continue}h(r,bn(e,r)),p()}else(0===o||o<d.length)&&(d.integrate(t,o),f.set(d.id.client,d.id.clock+d.length))}}if(i.length>0)d=i.pop();else if(null!==c&&c.i<c.refs.length)d=c.refs[c.i++];else{if(c=o(),null===c)break;d=c.refs[c.i++]}}if(l.clients.size>0){const t=new Re;return De(t,l,new Map),z(t.restEncoder,0),{missing:u,update:t.toUint8Array()}}return null},xe=(t,e)=>De(t,e.doc.store,e.beforeState),Me=(t,e,n,r=new Ce(t))=>Ln(e,(t=>{t.local=!1;let e=!1;const n=t.doc,i=n.store,s=Oe(r,n),o=Pe(t,i,s),a=i.pendingStructs;if(a){for(const[t,n]of a.missing)if(n<bn(i,t)){e=!0;break}if(o){for(const[t,e]of o.missing){const n=a.missing.get(t);(null==n||n>e)&&a.missing.set(t,e)}a.update=Gn([a.update,o.update])}}else i.pendingStructs=o;const c=be(r,t,i);if(i.pendingDs){const e=new Ce(dt(i.pendingDs));yt(e.restDecoder);const n=be(e,t,i);i.pendingDs=c&&n?Gn([c,n]):c||n}else i.pendingDs=c;if(e){const e=i.pendingStructs.update;i.pendingStructs=null,Le(t.doc,e)}}),n,!1),Le=(t,e,n,r=Ce)=>{const i=dt(e);Me(i,t,n,new r(i))},Be=(t,e,n)=>Le(t,e,n,Se),Ue=(t,e,n=new Map)=>{De(t,e.store,n),ye(t,me(e.store))},Fe=(t,e=new Uint8Array([0]),n=new Re)=>{const r=je(e);Ue(n,t,r);const i=[n.toUint8Array()];if(t.store.pendingDs&&i.push(t.store.pendingDs),t.store.pendingStructs&&i.push(qn(t.store.pendingStructs.update,e)),i.length>1){if(n.constructor===Te)return $n(i.map(((t,e)=>0===e?t:Jn(t))));if(n.constructor===Re)return Gn(i)}return i[0]},ze=(t,e)=>Fe(t,e,new Te),Ve=t=>{const e=new Map,n=yt(t.restDecoder);for(let r=0;r<n;r++){const n=yt(t.restDecoder),r=yt(t.restDecoder);e.set(n,r)}return e},je=t=>Ve(new _e(dt(t))),He=(t,e)=>(z(t.restEncoder,e.size),a(e.entries()).sort(((t,e)=>e[0]-t[0])).forEach((([e,n])=>{z(t.restEncoder,e),z(t.restEncoder,n)})),t),$e=(t,e)=>He(t,wn(e.store)),Ke=(t,e=new ke)=>(t instanceof Map?He(e,t):$e(e,t),e.toUint8Array()),Ge=t=>Ke(t,new Ie);class qe{constructor(){this.l=[]}}const We=()=>new qe,Ye=(t,e)=>t.l.push(e),Xe=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter((t=>e!==t)),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Qe=(t,e,n)=>xt.PP(t.l,[e,n]);class Je{constructor(t,e){this.client=t,this.clock=e}}const Ze=(t,e)=>t===e||null!==t&&null!==e&&t.client===e.client&&t.clock===e.clock,tn=(t,e)=>new Je(t,e),en=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw ct.zR()},nn=(t,e)=>{while(null!==e){if(e.parent===t)return!0;e=e.parent._item}return!1};class rn{constructor(t,e,n,r=0){this.type=t,this.tname=e,this.item=n,this.assoc=r}}const sn=t=>new rn(null==t.type?null:tn(t.type.client,t.type.clock),t.tname||null,null==t.item?null:tn(t.item.client,t.item.clock),null==t.assoc?0:t.assoc);class on{constructor(t,e,n=0){this.type=t,this.index=e,this.assoc=n}}const an=(t,e,n=0)=>new on(t,e,n),cn=(t,e,n)=>{let r=null,i=null;return null===t._item?i=en(t):r=tn(t._item.id.client,t._item.id.clock),new rn(r,i,e,n)},ln=(t,e,n=0)=>{let r=t._start;if(n<0){if(0===e)return cn(t,null,n);e--}while(null!==r){if(!r.deleted&&r.countable){if(r.length>e)return cn(t,tn(r.id.client,r.id.clock+e),n);e-=r.length}if(null===r.right&&n<0)return cn(t,r.lastId,n);r=r.right}return cn(t,null,n)},un=(t,e)=>{const n=e.store,r=t.item,i=t.type,s=t.tname,o=t.assoc;let a=null,c=0;if(null!==r){if(bn(n,r.client)<=r.clock)return null;const t=Ui(n,r),e=t.item;if(!(e instanceof ji))return null;if(a=e.parent,null===a._item||!a._item.deleted){c=e.deleted||!e.countable?0:t.diff+(o>=0?0:1);let n=e.left;while(null!==n)!n.deleted&&n.countable&&(c+=n.length),n=n.left}}else{if(null!==s)a=e.get(s);else{if(null===i)throw ct.zR();{if(bn(n,i.client)<=i.clock)return null;const{item:t}=Ui(n,i);if(!(t instanceof ji&&t.content instanceof Li))return null;a=t.content.type}}c=o>=0?a._length:0}return an(a,c,t.assoc)},hn=(t,e)=>t===e||null!==t&&null!==e&&t.tname===e.tname&&Ze(t.item,e.item)&&Ze(t.type,e.type)&&t.assoc===e.assoc;class dn{constructor(t,e){this.ds=t,this.sv=e}}const fn=(t,e)=>new dn(t,e),pn=(fn(ge(),new Map),t=>fn(me(t.store),wn(t.store))),gn=(t,e)=>void 0===e?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!he(e.ds,t.id),mn=(t,e)=>{const n=r.Yu(t.meta,mn,i.Ue),s=t.doc.store;n.has(e)||(e.sv.forEach(((e,n)=>{e<bn(s,n)&&Cn(t,tn(n,e))})),le(t,e.ds,(t=>{})),n.add(e))};class yn{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const wn=t=>{const e=new Map;return t.clients.forEach(((t,n)=>{const r=t[t.length-1];e.set(n,r.id.clock+r.length)})),e},bn=(t,e)=>{const n=t.clients.get(e);if(void 0===n)return 0;const r=n[n.length-1];return r.id.clock+r.length},vn=(t,e)=>{let n=t.clients.get(e.id.client);if(void 0===n)n=[],t.clients.set(e.id.client,n);else{const t=n[n.length-1];if(t.id.clock+t.length!==e.id.clock)throw ct.zR()}n.push(e)},En=(t,e)=>{let n=0,r=t.length-1,i=t[r],s=i.id.clock;if(s===e)return r;let o=u.GW(e/(s+i.length-1)*r);while(n<=r){if(i=t[o],s=i.id.clock,s<=e){if(e<s+i.length)return o;n=o+1}else r=o-1;o=u.GW((n+r)/2)}throw ct.zR()},_n=(t,e)=>{const n=t.clients.get(e.client);return n[En(n,e.clock)]},Sn=_n,An=(t,e,n)=>{const r=En(e,n),i=e[r];return i.id.clock<n&&i instanceof ji?(e.splice(r+1,0,zi(t,i,n-i.id.clock)),r+1):r},Cn=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[An(t,n,e.clock)]},In=(t,e,n)=>{const r=e.clients.get(n.client),i=En(r,n.clock),s=r[i];return n.clock!==s.id.clock+s.length-1&&s.constructor!==ui&&r.splice(i+1,0,zi(t,s,n.clock-s.id.clock+1)),s},Tn=(t,e,n)=>{const r=t.clients.get(e.id.client);r[En(r,e.id.clock)]=n},kn=(t,e,n,r,i)=>{if(0===r)return;const s=n+r;let o,a=An(t,e,n);do{o=e[a++],s<o.id.clock+o.length&&An(t,e,s),i(o)}while(a<e.length&&e[a].id.clock<s)};class Rn{constructor(t,e,n){this.doc=t,this.deleteSet=new ce,this.beforeState=wn(t.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=e,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const Nn=(t,e)=>!(0===e.deleteSet.clients.size&&!r.Yj(e.afterState,((t,n)=>e.beforeState.get(n)!==t)))&&(de(e.deleteSet),xe(t,e),ye(t,e.deleteSet),!0),Dn=(t,e,n)=>{const s=e._item;(null===s||s.id.clock<(t.beforeState.get(s.id.client)||0)&&!s.deleted)&&r.Yu(t.changed,e,i.Ue).add(n)},On=(t,e)=>{const n=t[e-1],r=t[e];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(t.splice(e,1),r instanceof ji&&null!==r.parentSub&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},Pn=(t,e,n)=>{for(const[r,i]of t.clients.entries()){const t=e.clients.get(r);for(let r=i.length-1;r>=0;r--){const s=i[r],o=s.clock+s.len;for(let r=En(t,s.clock),i=t[r];r<t.length&&i.id.clock<o;i=t[++r]){const i=t[r];if(s.clock+s.len<=i.id.clock)break;i instanceof ji&&i.deleted&&!i.keep&&n(i)&&i.gc(e,!1)}}}},xn=(t,e)=>{t.clients.forEach(((t,n)=>{const r=e.clients.get(n);for(let e=t.length-1;e>=0;e--){const n=t[e],i=u.VV(r.length-1,1+En(r,n.clock+n.len-1));for(let t=i,e=r[t];t>0&&e.id.clock>=n.clock;e=r[--t])On(r,t)}}))},Mn=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,i=r.store,s=n.deleteSet,o=n._mergeStructs;try{de(s),n.afterState=wn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const t=[];n.changed.forEach(((e,r)=>t.push((()=>{null!==r._item&&r._item.deleted||r._callObserver(n,e)})))),t.push((()=>{n.changedParentTypes.forEach(((e,r)=>t.push((()=>{null!==r._item&&r._item.deleted||(e=e.filter((t=>null===t.target._item||!t.target._item.deleted)),e.forEach((t=>{t.currentTarget=r})),e.sort(((t,e)=>t.path.length-e.path.length)),Qe(r._dEH,e,n))})))),t.push((()=>r.emit("afterTransaction",[n,r])))})),(0,xt.PP)(t,[])}finally{r.gc&&Pn(s,i,r.gcFilter),xn(s,i),n.afterState.forEach(((t,e)=>{const r=n.beforeState.get(e)||0;if(r!==t){const t=i.clients.get(e),n=u.Fp(En(t,r),1);for(let e=t.length-1;e>=n;e--)On(t,e)}}));for(let t=0;t<o.length;t++){const{client:e,clock:n}=o[t].id,r=i.clients.get(e),s=En(r,n);s+1<r.length&&On(r,s+1),s>0&&On(r,s)}if(n.local||n.afterState.get(r.clientID)===n.beforeState.get(r.clientID)||(ee(qt,zt,"[yjs] ",Vt,Kt,"Changed the client-id because another client seems to be using it."),r.clientID=ve()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const t=new Te,e=Nn(t,n);e&&r.emit("update",[t.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const t=new Re,e=Nn(t,n);e&&r.emit("updateV2",[t.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach((t=>{t.clientID=r.clientID,null==t.collectionid&&(t.collectionid=r.collectionid),r.subdocs.add(t)})),l.forEach((t=>r.subdocs.delete(t))),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach((t=>t.destroy()))),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Mn(t,e+1)}}},Ln=(t,e,n=null,r=!0)=>{const i=t._transactionCleanups;let s=!1,o=null;null===t._transaction&&(s=!0,t._transaction=new Rn(t,n,r),i.push(t._transaction),1===i.length&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{o=e(t._transaction)}finally{if(s){const e=t._transaction===i[0];t._transaction=null,e&&Mn(i,0)}}return o};class Bn{constructor(t,e){this.insertions=e,this.deletions=t,this.meta=new Map}}const Un=(t,e,n)=>{le(t,n.deletions,(t=>{t instanceof ji&&e.scope.some((e=>nn(e,t)))&&Fi(t,!1)}))},Fn=(t,e,n)=>{let r=null,i=null;const s=t.doc,o=t.scope;if(Ln(s,(n=>{while(e.length>0&&null===r){const i=s.store,a=e.pop(),c=new Set,l=[];let u=!1;le(n,a.insertions,(t=>{if(t instanceof ji){if(null!==t.redone){let{item:e,diff:r}=Ui(i,t.id);r>0&&(e=Cn(n,tn(e.id.client,e.id.clock+r))),t=e}!t.deleted&&o.some((e=>nn(e,t)))&&l.push(t)}})),le(n,a.deletions,(t=>{t instanceof ji&&o.some((e=>nn(e,t)))&&!he(a.insertions,t.id)&&c.add(t)})),c.forEach((e=>{u=null!==Vi(n,e,c,a.insertions,t.ignoreRemoteMapChanges)||u}));for(let e=l.length-1;e>=0;e--){const r=l[e];t.deleteFilter(r)&&(r.delete(n),u=!0)}r=u?a:null}n.changed.forEach(((t,e)=>{t.has(null)&&e._searchMarker&&(e._searchMarker.length=0)})),i=n}),t),null!=r){const e=i.changedParentTypes;t.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:e},t])}return r};class zn extends l{constructor(t,{captureTimeout:e=500,captureTransaction:n=(t=>!0),deleteFilter:r=(()=>!0),trackedOrigins:i=new Set([null]),ignoreRemoteMapChanges:s=!1,doc:o=(c(t)?t[0].doc:t.doc)}={}){super(),this.scope=[],this.addToScope(t),this.deleteFilter=r,i.add(this),this.trackedOrigins=i,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=o,this.lastChange=0,this.ignoreRemoteMapChanges=s,this.captureTimeout=e,this.afterTransactionHandler=t=>{if(!this.captureTransaction(t)||!this.scope.some((e=>t.changedParentTypes.has(e)))||!this.trackedOrigins.has(t.origin)&&(!t.origin||!this.trackedOrigins.has(t.origin.constructor)))return;const e=this.undoing,n=this.redoing,r=e?this.redoStack:this.undoStack;e?this.stopCapturing():n||this.clear(!1,!0);const i=new ce;t.afterState.forEach(((e,n)=>{const r=t.beforeState.get(n)||0,s=e-r;s>0&&pe(i,n,r,s)}));const s=Ft();let o=!1;if(this.lastChange>0&&s-this.lastChange<this.captureTimeout&&r.length>0&&!e&&!n){const e=r[r.length-1];e.deletions=fe([e.deletions,t.deleteSet]),e.insertions=fe([e.insertions,i])}else r.push(new Bn(t.deleteSet,i)),o=!0;e||n||(this.lastChange=s),le(t,t.deleteSet,(t=>{t instanceof ji&&this.scope.some((e=>nn(e,t)))&&Fi(t,!0)}));const a=[{stackItem:r[r.length-1],origin:t.origin,type:e?"redo":"undo",changedParentTypes:t.changedParentTypes},this];o?this.emit("stack-item-added",a):this.emit("stack-item-updated",a)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",(()=>{this.destroy()}))}addToScope(t){t=c(t)?t:[t],t.forEach((t=>{this.scope.every((e=>e!==t))&&this.scope.push(t)}))}addTrackedOrigin(t){this.trackedOrigins.add(t)}removeTrackedOrigin(t){this.trackedOrigins.delete(t)}clear(t=!0,e=!0){(t&&this.canUndo()||e&&this.canRedo())&&this.doc.transact((n=>{t&&(this.undoStack.forEach((t=>Un(n,this,t))),this.undoStack=[]),e&&(this.redoStack.forEach((t=>Un(n,this,t))),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:t,redoStackCleared:e}])}))}stopCapturing(){this.lastChange=0}undo(){let t;this.undoing=!0;try{t=Fn(this,this.undoStack,"undo")}finally{this.undoing=!1}return t}redo(){let t;this.redoing=!0;try{t=Fn(this,this.redoStack,"redo")}finally{this.redoing=!1}return t}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*Vn(t){const e=yt(t.restDecoder);for(let n=0;n<e;n++){const e=yt(t.restDecoder),n=t.readClient();let r=yt(t.restDecoder);for(let i=0;i<e;i++){const e=t.readInfo();if(10===e){const e=yt(t.restDecoder);yield new Gi(tn(n,r),e),r+=e}else if(0!==(T&e)){const i=0===(e&(C|I)),s=new ji(tn(n,r),null,(e&I)===I?t.readLeftID():null,null,(e&C)===C?t.readRightID():null,i?t.readParentInfo()?t.readString():t.readLeftID():null,i&&(e&A)===A?t.readString():null,Hi(t,e));yield s,r+=s.length}else{const e=t.readLen();yield new ui(tn(n,r),e),r+=e}}}}class jn{constructor(t,e){this.gen=Vn(t),this.curr=null,this.done=!1,this.filterSkips=e,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===Gi);return this.curr}}class Hn{constructor(t){this.currClient=0,this.startClock=0,this.written=0,this.encoder=t,this.clientStructs=[]}}const $n=t=>Gn(t,Se,Te),Kn=(t,e)=>{if(t.constructor===ui){const{client:n,clock:r}=t.id;return new ui(tn(n,r+e),t.length-e)}if(t.constructor===Gi){const{client:n,clock:r}=t.id;return new Gi(tn(n,r+e),t.length-e)}{const n=t,{client:r,clock:i}=n.id;return new ji(tn(r,i+e),null,tn(r,i+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Gn=(t,e=Ce,n=Re)=>{if(1===t.length)return t[0];const r=t.map((t=>new e(dt(t))));let i=r.map((t=>new jn(t,!0))),s=null;const o=new n,a=new Hn(o);while(1){if(i=i.filter((t=>null!==t.curr)),i.sort(((t,e)=>{if(t.curr.id.client===e.curr.id.client){const n=t.curr.id.clock-e.curr.id.clock;return 0===n?t.curr.constructor===e.curr.constructor?0:t.curr.constructor===Gi?1:-1:n}return e.curr.id.client-t.curr.id.client})),0===i.length)break;const t=i[0],e=t.curr.id.client;if(null!==s){let n=t.curr,r=!1;while(null!==n&&n.id.clock+n.length<=s.struct.id.clock+s.struct.length&&n.id.client>=s.struct.id.client)n=t.next(),r=!0;if(null===n||n.id.client!==e||r&&n.id.clock>s.struct.id.clock+s.struct.length)continue;if(e!==s.struct.id.client)Yn(a,s.struct,s.offset),s={struct:n,offset:0},t.next();else if(s.struct.id.clock+s.struct.length<n.id.clock)if(s.struct.constructor===Gi)s.struct.length=n.id.clock+n.length-s.struct.id.clock;else{Yn(a,s.struct,s.offset);const t=n.id.clock-s.struct.id.clock-s.struct.length,r=new Gi(tn(e,s.struct.id.clock+s.struct.length),t);s={struct:r,offset:0}}else{const e=s.struct.id.clock+s.struct.length-n.id.clock;e>0&&(s.struct.constructor===Gi?s.struct.length-=e:n=Kn(n,e)),s.struct.mergeWith(n)||(Yn(a,s.struct,s.offset),s={struct:n,offset:0},t.next())}}else s={struct:t.curr,offset:0},t.next();for(let n=t.curr;null!==n&&n.id.client===e&&n.id.clock===s.struct.id.clock+s.struct.length&&n.constructor!==Gi;n=t.next())Yn(a,s.struct,s.offset),s={struct:n,offset:0}}null!==s&&(Yn(a,s.struct,s.offset),s=null),Xn(a);const c=r.map((t=>we(t))),l=fe(c);return ye(o,l),o.toUint8Array()},qn=(t,e,n=Ce,r=Re)=>{const i=je(e),s=new r,o=new Hn(s),a=new n(dt(t)),c=new jn(a,!1);while(c.curr){const t=c.curr,e=t.id.client,n=i.get(e)||0;if(c.curr.constructor!==Gi)if(t.id.clock+t.length>n){Yn(o,t,u.Fp(n-t.id.clock,0)),c.next();while(c.curr&&c.curr.id.client===e)Yn(o,c.curr,0),c.next()}else while(c.curr&&c.curr.id.client===e&&c.curr.id.clock+c.curr.length<=n)c.next();else c.next()}Xn(o);const l=we(a);return ye(s,l),s.toUint8Array()},Wn=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:L(t.encoder.restEncoder)}),t.encoder.restEncoder=x(),t.written=0)},Yn=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Wn(t),0===t.written&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),z(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Xn=t=>{Wn(t);const e=t.encoder.restEncoder;z(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];z(e,r.written),q(e,r.restEncoder)}},Qn=(t,e,n)=>{const r=new e(dt(t)),i=new jn(r,!1),s=new n,o=new Hn(s);for(let c=i.curr;null!==c;c=i.next())Yn(o,c,0);Xn(o);const a=we(r);return ye(s,a),s.toUint8Array()},Jn=t=>Qn(t,Ce,Te);class Zn{constructor(t,e){this.target=t,this.currentTarget=t,this.transaction=e,this._changes=null,this._keys=null,this._delta=null}get path(){return tr(this.currentTarget,this.target)}deletes(t){return he(this.transaction.deleteSet,t.id)}get keys(){if(null===this._keys){const t=new Map,e=this.target,n=this.transaction.changed.get(e);n.forEach((n=>{if(null!==n){const r=e._map.get(n);let i,o;if(this.adds(r)){let t=r.left;while(null!==t&&this.adds(t))t=t.left;if(this.deletes(r)){if(null===t||!this.deletes(t))return;i="delete",o=s(t.content.getContent())}else null!==t&&this.deletes(t)?(i="update",o=s(t.content.getContent())):(i="add",o=void 0)}else{if(!this.deletes(r))return;i="delete",o=s(r.content.getContent())}t.set(n,{action:i,oldValue:o})}})),this._keys=t}return this._keys}get delta(){return this.changes.delta}adds(t){return t.id.clock>=(this.transaction.beforeState.get(t.id.client)||0)}get changes(){let t=this._changes;if(null===t){const e=this.target,n=i.Ue(),r=i.Ue(),s=[];t={added:n,deleted:r,delta:s,keys:this.keys};const o=this.transaction.changed.get(e);if(o.has(null)){let t=null;const i=()=>{t&&s.push(t)};for(let s=e._start;null!==s;s=s.right)s.deleted?this.deletes(s)&&!this.adds(s)&&(null!==t&&void 0!==t.delete||(i(),t={delete:0}),t.delete+=s.length,r.add(s)):this.adds(s)?(null!==t&&void 0!==t.insert||(i(),t={insert:[]}),t.insert=t.insert.concat(s.content.getContent()),n.add(s)):(null!==t&&void 0!==t.retain||(i(),t={retain:0}),t.retain+=s.length);null!==t&&void 0===t.retain&&i()}this._changes=t}return t}}const tr=(t,e)=>{const n=[];while(null!==e._item&&e!==t){if(null!==e._item.parentSub)n.unshift(e._item.parentSub);else{let t=0,r=e._item.parent._start;while(r!==e._item&&null!==r)r.deleted||t++,r=r.right;n.unshift(t)}e=e._item.parent}return n},er=80;let nr=0;class rr{constructor(t,e){t.marker=!0,this.p=t,this.index=e,this.timestamp=nr++}}const ir=t=>{t.timestamp=nr++},sr=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=nr++},or=(t,e,n)=>{if(t.length>=er){const r=t.reduce(((t,e)=>t.timestamp<e.timestamp?t:e));return sr(r,e,n),r}{const r=new rr(e,n);return t.push(r),r}},ar=(t,e)=>{if(null===t._start||0===e||null===t._searchMarker)return null;const n=0===t._searchMarker.length?null:t._searchMarker.reduce(((t,n)=>u.Wn(e-t.index)<u.Wn(e-n.index)?t:n));let r=t._start,i=0;null!==n&&(r=n.p,i=n.index,ir(n));while(null!==r.right&&i<e){if(!r.deleted&&r.countable){if(e<i+r.length)break;i+=r.length}r=r.right}while(null!==r.left&&i>e)r=r.left,!r.deleted&&r.countable&&(i-=r.length);while(null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock)r=r.left,!r.deleted&&r.countable&&(i-=r.length);return null!==n&&u.Wn(n.index-i)<r.parent.length/er?(sr(n,r,i),n):or(t._searchMarker,r,i)},cr=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const i=t[r];if(n>0){let e=i.p;e.marker=!1;while(e&&(e.deleted||!e.countable))e=e.left,e&&!e.deleted&&e.countable&&(i.index-=e.length);if(null===e||!0===e.marker){t.splice(r,1);continue}i.p=e,e.marker=!0}(e<i.index||n>0&&e===i.index)&&(i.index=u.Fp(e,i.index+n))}},lr=(t,e,n)=>{const i=t,s=e.changedParentTypes;while(1){if(r.Yu(s,t,(()=>[])).push(n),null===t._item)break;t=t._item.parent}Qe(i._eH,n,e)};class ur{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=We(),this._dEH=We(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(t,e){this.doc=t,this._item=e}_copy(){throw ct.Nw()}clone(){throw ct.Nw()}_write(t){}get _first(){let t=this._start;while(null!==t&&t.deleted)t=t.right;return t}_callObserver(t,e){!t.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(t){Ye(this._eH,t)}observeDeep(t){Ye(this._dEH,t)}unobserve(t){Xe(this._eH,t)}unobserveDeep(t){Xe(this._dEH,t)}toJSON(){}}const hr=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const i=[];let s=t._start;while(null!==s&&r>0){if(s.countable&&!s.deleted){const t=s.content.getContent();if(t.length<=e)e-=t.length;else{for(let n=e;n<t.length&&r>0;n++)i.push(t[n]),r--;e=0}}s=s.right}return i},dr=t=>{const e=[];let n=t._start;while(null!==n){if(n.countable&&!n.deleted){const t=n.content.getContent();for(let n=0;n<t.length;n++)e.push(t[n])}n=n.right}return e},fr=(t,e)=>{const n=[];let r=t._start;while(null!==r){if(r.countable&&gn(r,e)){const t=r.content.getContent();for(let e=0;e<t.length;e++)n.push(t[e])}r=r.right}return n},pr=(t,e)=>{let n=0,r=t._start;while(null!==r){if(r.countable&&!r.deleted){const i=r.content.getContent();for(let r=0;r<i.length;r++)e(i[r],n++,t)}r=r.right}},gr=(t,e)=>{const n=[];return pr(t,((r,i)=>{n.push(e(r,i,t))})),n},mr=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){while(null!==e&&e.deleted)e=e.right;if(null===e)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const t=n[r++];return n.length<=r&&(n=null),{done:!1,value:t}}}},yr=(t,e)=>{const n=ar(t,e);let r=t._start;for(null!==n&&(r=n.p,e-=n.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},wr=(t,e,n,r)=>{let i=n;const s=t.doc,o=s.clientID,a=s.store,c=null===n?e._start:n.right;let l=[];const u=()=>{l.length>0&&(i=new ji(tn(o,bn(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Ai(l)),i.integrate(t,0),l=[])};r.forEach((n=>{if(null===n)l.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(n);break;default:switch(u(),n.constructor){case Uint8Array:case ArrayBuffer:i=new ji(tn(o,bn(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new hi(new Uint8Array(n))),i.integrate(t,0);break;case Ee:i=new ji(tn(o,bn(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new mi(n)),i.integrate(t,0);break;default:if(!(n instanceof ur))throw new Error("Unexpected content type in insert operation");i=new ji(tn(o,bn(a,o)),i,i&&i.lastId,c,c&&c.id,e,null,new Li(n)),i.integrate(t,0)}}})),u()},br=ct.Ue("Length exceeded!"),vr=(t,e,n,r)=>{if(n>e._length)throw br;if(0===n)return e._searchMarker&&cr(e._searchMarker,n,r.length),wr(t,e,null,r);const i=n,s=ar(e,n);let o=e._start;for(null!==s&&(o=s.p,n-=s.index,0===n&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&Cn(t,tn(o.id.client,o.id.clock+n));break}n-=o.length}return e._searchMarker&&cr(e._searchMarker,i,r.length),wr(t,e,o,r)},Er=(t,e,n)=>{const r=(e._searchMarker||[]).reduce(((t,e)=>e.index>t.index?e:t),{index:0,p:e._start});let i=r.p;if(i)while(i.right)i=i.right;return wr(t,e,i,n)},_r=(t,e,n,r)=>{if(0===r)return;const i=n,s=r,o=ar(e,n);let a=e._start;for(null!==o&&(a=o.p,n-=o.index);null!==a&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&Cn(t,tn(a.id.client,a.id.clock+n)),n-=a.length);while(r>0&&null!==a)a.deleted||(r<a.length&&Cn(t,tn(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw br;e._searchMarker&&cr(e._searchMarker,i,-s+r)},Sr=(t,e,n)=>{const r=e._map.get(n);void 0!==r&&r.delete(t)},Ar=(t,e,n,r)=>{const i=e._map.get(n)||null,s=t.doc,o=s.clientID;let a;if(null==r)a=new Ai([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new Ai([r]);break;case Uint8Array:a=new hi(r);break;case Ee:a=new mi(r);break;default:if(!(r instanceof ur))throw new Error("Unexpected content type");a=new Li(r)}new ji(tn(o,bn(s.store,o)),i,i&&i.lastId,null,null,e,n,a).integrate(t,0)},Cr=(t,e)=>{const n=t._map.get(e);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Ir=t=>{const e={};return t._map.forEach(((t,n)=>{t.deleted||(e[n]=t.content.getContent()[t.length-1])})),e},Tr=(t,e)=>{const n=t._map.get(e);return void 0!==n&&!n.deleted},kr=t=>ie(t.entries(),(t=>!t[1].deleted));class Rr extends Zn{constructor(t,e){super(t,e),this._transaction=e}}class Nr extends ur{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(t){const e=new Nr;return e.push(t),e}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Nr}clone(){const t=new Nr;return t.insert(0,this.toArray().map((t=>t instanceof ur?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(t,e){super._callObserver(t,e),lr(this,t,new Rr(this,t))}insert(t,e){null!==this.doc?Ln(this.doc,(n=>{vr(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}push(t){null!==this.doc?Ln(this.doc,(e=>{Er(e,this,t)})):this._prelimContent.push(...t)}unshift(t){this.insert(0,t)}delete(t,e=1){null!==this.doc?Ln(this.doc,(n=>{_r(n,this,t,e)})):this._prelimContent.splice(t,e)}get(t){return yr(this,t)}toArray(){return dr(this)}slice(t=0,e=this.length){return hr(this,t,e)}toJSON(){return this.map((t=>t instanceof ur?t.toJSON():t))}map(t){return gr(this,t)}forEach(t){pr(this,t)}[Symbol.iterator](){return mr(this)}_write(t){t.writeTypeRef(Ri)}}const Dr=t=>new Nr;class Or extends Zn{constructor(t,e,n){super(t,e),this.keysChanged=n}}class Pr extends ur{constructor(t){super(),this._prelimContent=null,this._prelimContent=void 0===t?new Map:new Map(t)}_integrate(t,e){super._integrate(t,e),this._prelimContent.forEach(((t,e)=>{this.set(e,t)})),this._prelimContent=null}_copy(){return new Pr}clone(){const t=new Pr;return this.forEach(((e,n)=>{t.set(n,e instanceof ur?e.clone():e)})),t}_callObserver(t,e){lr(this,t,new Or(this,t,e))}toJSON(){const t={};return this._map.forEach(((e,n)=>{if(!e.deleted){const r=e.content.getContent()[e.length-1];t[n]=r instanceof ur?r.toJSON():r}})),t}get size(){return[...kr(this._map)].length}keys(){return se(kr(this._map),(t=>t[0]))}values(){return se(kr(this._map),(t=>t[1].content.getContent()[t[1].length-1]))}entries(){return se(kr(this._map),(t=>[t[0],t[1].content.getContent()[t[1].length-1]]))}forEach(t){this._map.forEach(((e,n)=>{e.deleted||t(e.content.getContent()[e.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(t){null!==this.doc?Ln(this.doc,(e=>{Sr(e,this,t)})):this._prelimContent.delete(t)}set(t,e){return null!==this.doc?Ln(this.doc,(n=>{Ar(n,this,t,e)})):this._prelimContent.set(t,e),e}get(t){return Cr(this,t)}has(t){return Tr(this,t)}clear(){null!==this.doc?Ln(this.doc,(t=>{this.forEach((function(e,n,r){Sr(t,r,n)}))})):this._prelimContent.clear()}_write(t){t.writeTypeRef(Ni)}}const xr=t=>new Pr,Mr=(t,e)=>t===e||"object"===typeof t&&"object"===typeof e&&t&&e&&oe.$m(t,e);class Lr{constructor(t,e,n,r){this.left=t,this.right=e,this.index=n,this.currentAttributes=r}forward(){switch(null===this.right&&ct.zR(),this.right.content.constructor){case vi:this.right.deleted||zr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Br=(t,e,n)=>{while(null!==e.right&&n>0){switch(e.right.content.constructor){case vi:e.right.deleted||zr(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&Cn(t,tn(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},Ur=(t,e,n)=>{const r=new Map,i=ar(e,n);if(i){const e=new Lr(i.p.left,i.p,i.index,r);return Br(t,e,n-i.index)}{const i=new Lr(null,e._start,0,r);return Br(t,i,n)}},Fr=(t,e,n,r)=>{while(null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===vi&&Mr(r.get(n.right.content.key),n.right.content.value)))n.right.deleted||r.delete(n.right.content.key),n.forward();const i=t.doc,s=i.clientID;r.forEach(((r,o)=>{const a=n.left,c=n.right,l=new ji(tn(s,bn(i.store,s)),a,a&&a.lastId,c,c&&c.id,e,null,new vi(o,r));l.integrate(t,0),n.right=l,n.forward()}))},zr=(t,e)=>{const{key:n,value:r}=e;null===r?t.delete(n):t.set(n,r)},Vr=(t,e)=>{while(1){if(null===t.right)break;if(!(t.right.deleted||t.right.content.constructor===vi&&Mr(e[t.right.content.key]||null,t.right.content.value)))break;t.forward()}},jr=(t,e,n,r)=>{const i=t.doc,s=i.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)||null;if(!Mr(l,c)){o.set(a,l);const{left:r,right:u}=n;n.right=new ji(tn(s,bn(i.store,s)),r,r&&r.lastId,u,u&&u.id,e,null,new vi(a,c)),n.right.integrate(t,0),n.forward()}}return o},Hr=(t,e,n,r,i)=>{n.currentAttributes.forEach(((t,e)=>{void 0===i[e]&&(i[e]=null)}));const s=t.doc,o=s.clientID;Vr(n,i);const a=jr(t,e,n,i),c=r.constructor===String?new Ii(r):r instanceof ur?new Li(r):new wi(r);let{left:l,right:u,index:h}=n;e._searchMarker&&cr(e._searchMarker,n.index,c.getLength()),u=new ji(tn(o,bn(s.store,o)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=h,n.forward(),Fr(t,e,n,a)},$r=(t,e,n,r,i)=>{const s=t.doc,o=s.clientID;Vr(n,i);const a=jr(t,e,n,i);t:while(null!==n.right&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===vi))){if(!n.right.deleted)switch(n.right.content.constructor){case vi:{const{key:e,value:s}=n.right.content,o=i[e];if(void 0!==o){if(Mr(o,s))a.delete(e);else{if(0===r)break t;a.set(e,s)}n.right.delete(t)}else n.currentAttributes.set(e,s);break}default:r<n.right.length&&Cn(t,tn(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let i="";for(;r>0;r--)i+="\n";n.right=new ji(tn(o,bn(s.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ii(i)),n.right.integrate(t,0),n.forward()}Fr(t,e,n,a)},Kr=(t,e,n,i,s)=>{let o=e;const a=r.Ue();while(o&&(!o.countable||o.deleted)){if(!o.deleted&&o.content.constructor===vi){const t=o.content;a.set(t.key,t)}o=o.right}let c=0,l=!1;while(e!==o){if(n===e&&(l=!0),!e.deleted){const n=e.content;switch(n.constructor){case vi:{const{key:r,value:o}=n,u=i.get(r)||null;a.get(r)===n&&u!==o||(e.delete(t),c++,l||(s.get(r)||null)!==o||u===o||(null===u?s.delete(r):s.set(r,u))),l||e.deleted||zr(s,n);break}}}e=e.right}return c},Gr=(t,e)=>{while(e&&e.right&&(e.right.deleted||!e.right.countable))e=e.right;const n=new Set;while(e&&(e.deleted||!e.countable)){if(!e.deleted&&e.content.constructor===vi){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},qr=t=>{let e=0;return Ln(t.doc,(n=>{let i=t._start,s=t._start,o=r.Ue();const a=r.JG(o);while(s){if(!1===s.deleted)switch(s.content.constructor){case vi:zr(a,s.content);break;default:e+=Kr(n,i,s,o,a),o=r.JG(a),i=s;break}s=s.right}})),e},Wr=(t,e,n)=>{const i=n,s=r.JG(e.currentAttributes),o=e.right;while(n>0&&null!==e.right){if(!1===e.right.deleted)switch(e.right.content.constructor){case Li:case wi:case Ii:n<e.right.length&&Cn(t,tn(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}o&&Kr(t,o,e.right,s,e.currentAttributes);const a=(e.left||e.right).parent;return a._searchMarker&&cr(a._searchMarker,e.index,-i+n),e};class Yr extends Zn{constructor(t,e,n){super(t,e),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((t=>{null===t?this.childListChanged=!0:this.keysChanged.add(t)}))}get changes(){if(null===this._changes){const t={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=t}return this._changes}get delta(){if(null===this._delta){const t=this.target.doc,e=[];Ln(t,(t=>{const n=new Map,r=new Map;let i=this.target._start,s=null;const o={};let a="",c=0,l=0;const u=()=>{if(null!==s){let t;switch(s){case"delete":t={delete:l},l=0;break;case"insert":t={insert:a},n.size>0&&(t.attributes={},n.forEach(((e,n)=>{null!==e&&(t.attributes[n]=e)}))),a="";break;case"retain":if(t={retain:c},Object.keys(o).length>0){t.attributes={};for(const e in o)t.attributes[e]=o[e]}c=0;break}e.push(t),s=null}};while(null!==i){switch(i.content.constructor){case Li:case wi:this.adds(i)?this.deletes(i)||(u(),s="insert",a=i.content.getContent()[0],u()):this.deletes(i)?("delete"!==s&&(u(),s="delete"),l+=1):i.deleted||("retain"!==s&&(u(),s="retain"),c+=1);break;case Ii:this.adds(i)?this.deletes(i)||("insert"!==s&&(u(),s="insert"),a+=i.content.str):this.deletes(i)?("delete"!==s&&(u(),s="delete"),l+=i.length):i.deleted||("retain"!==s&&(u(),s="retain"),c+=i.length);break;case vi:{const{key:e,value:a}=i.content;if(this.adds(i)){if(!this.deletes(i)){const c=n.get(e)||null;Mr(c,a)?null!==a&&i.delete(t):("retain"===s&&u(),Mr(a,r.get(e)||null)?delete o[e]:o[e]=a)}}else if(this.deletes(i)){r.set(e,a);const t=n.get(e)||null;Mr(t,a)||("retain"===s&&u(),o[e]=t)}else if(!i.deleted){r.set(e,a);const n=o[e];void 0!==n&&(Mr(n,a)?null!==n&&i.delete(t):("retain"===s&&u(),null===a?delete o[e]:o[e]=a))}i.deleted||("insert"===s&&u(),zr(n,i.content));break}}i=i.right}u();while(e.length>0){const t=e[e.length-1];if(void 0===t.retain||void 0!==t.attributes)break;e.pop()}})),this._delta=e}return this._delta}}class Xr extends ur{constructor(t){super(),this._pending=void 0!==t?[()=>this.insert(0,t)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(t,e){super._integrate(t,e);try{this._pending.forEach((t=>t()))}catch(n){console.error(n)}this._pending=null}_copy(){return new Xr}clone(){const t=new Xr;return t.applyDelta(this.toDelta()),t}_callObserver(t,e){super._callObserver(t,e);const n=new Yr(this,t,e),r=t.doc;if(lr(this,t,n),!t.local){let e=!1;for(const[n,i]of t.afterState.entries()){const s=t.beforeState.get(n)||0;if(i!==s&&(kn(t,r.store.clients.get(n),s,i,(t=>{t.deleted||t.content.constructor!==vi||(e=!0)})),e))break}e||le(t,t.deleteSet,(t=>{t instanceof ui||e||t.parent===this&&t.content.constructor===vi&&(e=!0)})),Ln(r,(t=>{e?qr(this):le(t,t.deleteSet,(e=>{e instanceof ui||e.parent===this&&Gr(t,e)}))}))}}toString(){let t="",e=this._start;while(null!==e)!e.deleted&&e.countable&&e.content.constructor===Ii&&(t+=e.content.str),e=e.right;return t}toJSON(){return this.toString()}applyDelta(t,{sanitize:e=!0}={}){null!==this.doc?Ln(this.doc,(n=>{const r=new Lr(null,this._start,0,new Map);for(let i=0;i<t.length;i++){const s=t[i];if(void 0!==s.insert){const o=e||"string"!==typeof s.insert||i!==t.length-1||null!==r.right||"\n"!==s.insert.slice(-1)?s.insert:s.insert.slice(0,-1);("string"!==typeof o||o.length>0)&&Hr(n,this,r,o,s.attributes||{})}else void 0!==s.retain?$r(n,this,r,s.retain,s.attributes||{}):void 0!==s.delete&&Wr(n,r,s.delete)}})):this._pending.push((()=>this.applyDelta(t)))}toDelta(t,e,n){const r=[],i=new Map,s=this.doc;let o="",a=this._start;function c(){if(o.length>0){const t={};let e=!1;i.forEach(((n,r)=>{e=!0,t[r]=n}));const n={insert:o};e&&(n.attributes=t),r.push(n),o=""}}const l=()=>{while(null!==a){if(gn(a,t)||void 0!==e&&gn(a,e))switch(a.content.constructor){case Ii:{const r=i.get("ychange");void 0===t||gn(a,t)?void 0===e||gn(a,e)?void 0!==r&&(c(),i.delete("ychange")):void 0!==r&&r.user===a.id.client&&"added"===r.type||(c(),i.set("ychange",n?n("added",a.id):{type:"added"})):void 0!==r&&r.user===a.id.client&&"removed"===r.type||(c(),i.set("ychange",n?n("removed",a.id):{type:"removed"})),o+=a.content.str;break}case Li:case wi:{c();const t={insert:a.content.getContent()[0]};if(i.size>0){const e={};t.attributes=e,i.forEach(((t,n)=>{e[n]=t}))}r.push(t);break}case vi:gn(a,t)&&(c(),zr(i,a.content));break}a=a.right}c()};return t||e?Ln(s,(n=>{t&&mn(n,t),e&&mn(n,e),l()}),"cleanup"):l(),r}insert(t,e,n){if(e.length<=0)return;const r=this.doc;null!==r?Ln(r,(r=>{const i=Ur(r,this,t);n||(n={},i.currentAttributes.forEach(((t,e)=>{n[e]=t}))),Hr(r,this,i,e,n)})):this._pending.push((()=>this.insert(t,e,n)))}insertEmbed(t,e,n={}){const r=this.doc;null!==r?Ln(r,(r=>{const i=Ur(r,this,t);Hr(r,this,i,e,n)})):this._pending.push((()=>this.insertEmbed(t,e,n)))}delete(t,e){if(0===e)return;const n=this.doc;null!==n?Ln(n,(n=>{Wr(n,Ur(n,this,t),e)})):this._pending.push((()=>this.delete(t,e)))}format(t,e,n){if(0===e)return;const r=this.doc;null!==r?Ln(r,(r=>{const i=Ur(r,this,t);null!==i.right&&$r(r,this,i,e,n)})):this._pending.push((()=>this.format(t,e,n)))}removeAttribute(t){null!==this.doc?Ln(this.doc,(e=>{Sr(e,this,t)})):this._pending.push((()=>this.removeAttribute(t)))}setAttribute(t,e){null!==this.doc?Ln(this.doc,(n=>{Ar(n,this,t,e)})):this._pending.push((()=>this.setAttribute(t,e)))}getAttribute(t){return Cr(this,t)}getAttributes(){return Ir(this)}_write(t){t.writeTypeRef(Di)}}const Qr=t=>new Xr;class Jr{constructor(t,e=(()=>!0)){this._filter=e,this._root=t,this._currentNode=t._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let t=this._currentNode,e=t&&t.content&&t.content.type;if(null!==t&&(!this._firstCall||t.deleted||!this._filter(e)))do{if(e=t.content.type,t.deleted||e.constructor!==ei&&e.constructor!==Zr||null===e._start)while(null!==t){if(null!==t.right){t=t.right;break}t=t.parent===this._root?null:t.parent._item}else t=e._start}while(null!==t&&(t.deleted||!this._filter(t.content.type)));return this._firstCall=!1,null===t?{value:void 0,done:!0}:(this._currentNode=t,{value:t.content.type,done:!1})}}class Zr extends ur{constructor(){super(),this._prelimContent=[]}get firstChild(){const t=this._first;return t?t.content.getContent()[0]:null}_integrate(t,e){super._integrate(t,e),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Zr}clone(){const t=new Zr;return t.insert(0,this.toArray().map((t=>t instanceof ur?t.clone():t))),t}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(t){return new Jr(this,t)}querySelector(t){t=t.toUpperCase();const e=new Jr(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)),n=e.next();return n.done?null:n.value}querySelectorAll(t){return t=t.toUpperCase(),a(new Jr(this,(e=>e.nodeName&&e.nodeName.toUpperCase()===t)))}_callObserver(t,e){lr(this,t,new ri(this,e,t))}toString(){return gr(this,(t=>t.toString())).join("")}toJSON(){return this.toString()}toDOM(t=document,e={},n){const r=t.createDocumentFragment();return void 0!==n&&n._createAssociation(r,this),pr(this,(i=>{r.insertBefore(i.toDOM(t,e,n),null)})),r}insert(t,e){null!==this.doc?Ln(this.doc,(n=>{vr(n,this,t,e)})):this._prelimContent.splice(t,0,...e)}insertAfter(t,e){if(null!==this.doc)Ln(this.doc,(n=>{const r=t&&t instanceof ur?t._item:t;wr(n,this,r,e)}));else{const n=this._prelimContent,r=null===t?0:n.findIndex((e=>e===t))+1;if(0===r&&null!==t)throw ct.Ue("Reference item not found");n.splice(r,0,...e)}}delete(t,e=1){null!==this.doc?Ln(this.doc,(n=>{_r(n,this,t,e)})):this._prelimContent.splice(t,e)}toArray(){return dr(this)}push(t){this.insert(this.length,t)}unshift(t){this.insert(0,t)}get(t){return yr(this,t)}slice(t=0,e=this.length){return hr(this,t,e)}forEach(t){pr(this,t)}_write(t){t.writeTypeRef(Pi)}}const ti=t=>new Zr;class ei extends Zr{constructor(t="UNDEFINED"){super(),this.nodeName=t,this._prelimAttrs=new Map}get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_integrate(t,e){super._integrate(t,e),this._prelimAttrs.forEach(((t,e)=>{this.setAttribute(e,t)})),this._prelimAttrs=null}_copy(){return new ei(this.nodeName)}clone(){const t=new ei(this.nodeName),e=this.getAttributes();for(const n in e)t.setAttribute(n,e[n]);return t.insert(0,this.toArray().map((t=>t instanceof ur?t.clone():t))),t}toString(){const t=this.getAttributes(),e=[],n=[];for(const o in t)n.push(o);n.sort();const r=n.length;for(let o=0;o<r;o++){const r=n[o];e.push(r+'="'+t[r]+'"')}const i=this.nodeName.toLocaleLowerCase(),s=e.length>0?" "+e.join(" "):"";return`<${i}${s}>${super.toString()}</${i}>`}removeAttribute(t){null!==this.doc?Ln(this.doc,(e=>{Sr(e,this,t)})):this._prelimAttrs.delete(t)}setAttribute(t,e){null!==this.doc?Ln(this.doc,(n=>{Ar(n,this,t,e)})):this._prelimAttrs.set(t,e)}getAttribute(t){return Cr(this,t)}hasAttribute(t){return Tr(this,t)}getAttributes(){return Ir(this)}toDOM(t=document,e={},n){const r=t.createElement(this.nodeName),i=this.getAttributes();for(const s in i)r.setAttribute(s,i[s]);return pr(this,(i=>{r.appendChild(i.toDOM(t,e,n))})),void 0!==n&&n._createAssociation(r,this),r}_write(t){t.writeTypeRef(Oi),t.writeKey(this.nodeName)}}const ni=t=>new ei(t.readKey());class ri extends Zn{constructor(t,e,n){super(t,n),this.childListChanged=!1,this.attributesChanged=new Set,e.forEach((t=>{null===t?this.childListChanged=!0:this.attributesChanged.add(t)}))}}class ii extends Pr{constructor(t){super(),this.hookName=t}_copy(){return new ii(this.hookName)}clone(){const t=new ii(this.hookName);return this.forEach(((e,n)=>{t.set(n,e)})),t}toDOM(t=document,e={},n){const r=e[this.hookName];let i;return i=void 0!==r?r.createDom(this):document.createElement(this.hookName),i.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(i,this),i}_write(t){t.writeTypeRef(xi),t.writeKey(this.hookName)}}const si=t=>new ii(t.readKey());class oi extends Xr{get nextSibling(){const t=this._item?this._item.next:null;return t?t.content.type:null}get prevSibling(){const t=this._item?this._item.prev:null;return t?t.content.type:null}_copy(){return new oi}clone(){const t=new oi;return t.applyDelta(this.toDelta()),t}toDOM(t=document,e,n){const r=t.createTextNode(this.toString());return void 0!==n&&n._createAssociation(r,this),r}toString(){return this.toDelta().map((t=>{const e=[];for(const r in t.attributes){const n=[];for(const e in t.attributes[r])n.push({key:e,value:t.attributes[r][e]});n.sort(((t,e)=>t.key<e.key?-1:1)),e.push({nodeName:r,attrs:n})}e.sort(((t,e)=>t.nodeName<e.nodeName?-1:1));let n="";for(let r=0;r<e.length;r++){const t=e[r];n+=`<${t.nodeName}`;for(let e=0;e<t.attrs.length;e++){const r=t.attrs[e];n+=` ${r.key}="${r.value}"`}n+=">"}n+=t.insert;for(let r=e.length-1;r>=0;r--)n+=`</${e[r].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(t){t.writeTypeRef(Mi)}}const ai=t=>new oi;class ci{constructor(t,e){this.id=t,this.length=e}get deleted(){throw ct.Nw()}mergeWith(t){return!1}write(t,e,n){throw ct.Nw()}integrate(t,e){throw ct.Nw()}}const li=0;class ui extends ci{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){e>0&&(this.id.clock+=e,this.length-=e),vn(t.doc.store,this)}write(t,e){t.writeInfo(li),t.writeLen(this.length-e)}getMissing(t,e){return null}}class hi{constructor(t){this.content=t}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new hi(this.content)}splice(t){throw ct.Nw()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeBuf(this.content)}getRef(){return 3}}const di=t=>new hi(t.readBuf());class fi{constructor(t){this.len=t}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new fi(this.len)}splice(t){const e=new fi(this.len-t);return this.len=t,e}mergeWith(t){return this.len+=t.len,!0}integrate(t,e){pe(t.deleteSet,e.id.client,e.id.clock,this.len),e.markDeleted()}delete(t){}gc(t){}write(t,e){t.writeLen(this.len-e)}getRef(){return 1}}const pi=t=>new fi(t.readLen()),gi=(t,e)=>new Ee({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class mi{constructor(t){t._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=t;const e={};this.opts=e,t.gc||(e.gc=!1),t.autoLoad&&(e.autoLoad=!0),null!==t.meta&&(e.meta=t.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new mi(gi(this.doc.guid,this.opts))}splice(t){throw ct.Nw()}mergeWith(t){return!1}integrate(t,e){this.doc._item=e,t.subdocsAdded.add(this.doc),this.doc.shouldLoad&&t.subdocsLoaded.add(this.doc)}delete(t){t.subdocsAdded.has(this.doc)?t.subdocsAdded.delete(this.doc):t.subdocsRemoved.add(this.doc)}gc(t){}write(t,e){t.writeString(this.doc.guid),t.writeAny(this.opts)}getRef(){return 9}}const yi=t=>new mi(gi(t.readString(),t.readAny()));class wi{constructor(t){this.embed=t}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new wi(this.embed)}splice(t){throw ct.Nw()}mergeWith(t){return!1}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeJSON(this.embed)}getRef(){return 5}}const bi=t=>new wi(t.readJSON());class vi{constructor(t,e){this.key=t,this.value=e}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new vi(this.key,this.value)}splice(t){throw ct.Nw()}mergeWith(t){return!1}integrate(t,e){e.parent._searchMarker=null}delete(t){}gc(t){}write(t,e){t.writeKey(this.key),t.writeJSON(this.value)}getRef(){return 6}}const Ei=t=>new vi(t.readKey(),t.readJSON());class _i{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _i(this.arr)}splice(t){const e=new _i(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeString(void 0===e?"undefined":JSON.stringify(e))}}getRef(){return 2}}const Si=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const e=t.readString();"undefined"===e?n.push(void 0):n.push(JSON.parse(e))}return new _i(n)};class Ai{constructor(t){this.arr=t}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Ai(this.arr)}splice(t){const e=new Ai(this.arr.slice(t));return this.arr=this.arr.slice(0,t),e}mergeWith(t){return this.arr=this.arr.concat(t.arr),!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){const n=this.arr.length;t.writeLen(n-e);for(let r=e;r<n;r++){const e=this.arr[r];t.writeAny(e)}}getRef(){return 8}}const Ci=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new Ai(n)};class Ii{constructor(t){this.str=t}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ii(this.str)}splice(t){const e=new Ii(this.str.slice(t));this.str=this.str.slice(0,t);const n=this.str.charCodeAt(t-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,t-1)+"�",e.str="�"+e.str.slice(1)),e}mergeWith(t){return this.str+=t.str,!0}integrate(t,e){}delete(t){}gc(t){}write(t,e){t.writeString(0===e?this.str:this.str.slice(e))}getRef(){return 4}}const Ti=t=>new Ii(t.readString()),ki=[Dr,xr,Qr,ni,ti,si,ai],Ri=0,Ni=1,Di=2,Oi=3,Pi=4,xi=5,Mi=6;class Li{constructor(t){this.type=t}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Li(this.type._copy())}splice(t){throw ct.Nw()}mergeWith(t){return!1}integrate(t,e){this.type._integrate(t.doc,e)}delete(t){let e=this.type._start;while(null!==e)e.deleted?t._mergeStructs.push(e):e.delete(t),e=e.right;this.type._map.forEach((e=>{e.deleted?t._mergeStructs.push(e):e.delete(t)})),t.changed.delete(this.type)}gc(t){let e=this.type._start;while(null!==e)e.gc(t,!0),e=e.right;this.type._start=null,this.type._map.forEach((e=>{while(null!==e)e.gc(t,!0),e=e.left})),this.type._map=new Map}write(t,e){this.type._write(t)}getRef(){return 7}}const Bi=t=>new Li(ki[t.readTypeRef()](t)),Ui=(t,e)=>{let n,r=e,i=0;do{i>0&&(r=tn(r.client,r.clock+i)),n=Sn(t,r),i=r.clock-n.id.clock,r=n.redone}while(null!==r&&n instanceof ji);return{item:n,diff:i}},Fi=(t,e)=>{while(null!==t&&t.keep!==e)t.keep=e,t=t.parent._item},zi=(t,e,n)=>{const{client:r,clock:i}=e.id,s=new ji(tn(r,i+n),e,tn(r,i+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&s.markDeleted(),e.keep&&(s.keep=!0),null!==e.redone&&(s.redone=tn(e.redone.client,e.redone.clock+n)),e.right=s,null!==s.right&&(s.right.left=s),t._mergeStructs.push(s),null!==s.parentSub&&null===s.right&&s.parent._map.set(s.parentSub,s),e.length=n,s},Vi=(t,e,n,r,i)=>{const s=t.doc,o=s.store,a=s.clientID,c=e.redone;if(null!==c)return Cn(t,c);let l,u=e.parent._item,h=null;if(null!==u&&!0===u.deleted){if(null===u.redone&&(!n.has(u)||null===Vi(t,u,n,r,i)))return null;while(null!==u.redone)u=Cn(t,u.redone)}const d=null===u?e.parent:u.content.type;if(null===e.parentSub){h=e.left,l=e;while(null!==h){let e=h;while(null!==e&&e.parent._item!==u)e=null===e.redone?null:Cn(t,e.redone);if(null!==e&&e.parent._item===u){h=e;break}h=h.left}while(null!==l){let e=l;while(null!==e&&e.parent._item!==u)e=null===e.redone?null:Cn(t,e.redone);if(null!==e&&e.parent._item===u){l=e;break}l=l.right}}else if(l=null,e.right&&!i){h=e;while(null!==h&&null!==h.right&&he(r,h.right.id))h=h.right;while(null!==h&&null!==h.redone)h=Cn(t,h.redone);if(h&&null!==h.right)return null}else h=d._map.get(e.parentSub)||null;const f=bn(o,a),p=tn(a,f),g=new ji(p,h,h&&h.lastId,l,l&&l.id,d,e.parentSub,e.content.copy());return e.redone=p,Fi(g,!0),g.integrate(t,0),g};class ji extends ci{constructor(t,e,n,r,i,s,o,a){super(t,a.getLength()),this.origin=n,this.left=e,this.right=r,this.rightOrigin=i,this.parent=s,this.parentSub=o,this.redone=null,this.content=a,this.info=this.content.isCountable()?E:0}set marker(t){(this.info&S)>0!==t&&(this.info^=S)}get marker(){return(this.info&S)>0}get keep(){return(this.info&v)>0}set keep(t){this.keep!==t&&(this.info^=v)}get countable(){return(this.info&E)>0}get deleted(){return(this.info&_)>0}set deleted(t){this.deleted!==t&&(this.info^=_)}markDeleted(){this.info|=_}getMissing(t,e){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=bn(e,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=bn(e,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Je&&this.id.client!==this.parent.client&&this.parent.clock>=bn(e,this.parent.client))return this.parent.client;if(this.origin&&(this.left=In(t,e,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=Cn(t,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===ui||this.right&&this.right.constructor===ui)&&(this.parent=null),this.parent){if(this.parent.constructor===Je){const t=Sn(e,this.parent);t.constructor===ui?this.parent=null:this.parent=t.content.type}}else this.left&&this.left.constructor===ji&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===ji&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(t,e){if(e>0&&(this.id.clock+=e,this.left=In(t,t.doc.store,tn(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(e),this.length-=e),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let e,n=this.left;if(null!==n)e=n.right;else if(null!==this.parentSub){e=this.parent._map.get(this.parentSub)||null;while(null!==e&&null!==e.left)e=e.left}else e=this.parent._start;const r=new Set,i=new Set;while(null!==e&&e!==this.right){if(i.add(e),r.add(e),Ze(this.origin,e.origin)){if(e.id.client<this.id.client)n=e,r.clear();else if(Ze(this.rightOrigin,e.rightOrigin))break}else{if(null===e.origin||!i.has(Sn(t.doc.store,e.origin)))break;r.has(Sn(t.doc.store,e.origin))||(n=e,r.clear())}e=e.right}this.left=n}if(null!==this.left){const t=this.left.right;this.right=t,this.left.right=this}else{let t;if(null!==this.parentSub){t=this.parent._map.get(this.parentSub)||null;while(null!==t&&null!==t.left)t=t.left}else t=this.parent._start,this.parent._start=this;this.right=t}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(t)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),vn(t.doc.store,this),this.content.integrate(t,this),Dn(t,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(t)}else new ui(this.id,this.length).integrate(t,0)}get next(){let t=this.right;while(null!==t&&t.deleted)t=t.right;return t}get prev(){let t=this.left;while(null!==t&&t.deleted)t=t.left;return t}get lastId(){return 1===this.length?this.id:tn(this.id.client,this.id.clock+this.length-1)}mergeWith(t){if(this.constructor===t.constructor&&Ze(t.origin,this.lastId)&&this.right===t&&Ze(this.rightOrigin,t.rightOrigin)&&this.id.client===t.id.client&&this.id.clock+this.length===t.id.clock&&this.deleted===t.deleted&&null===this.redone&&null===t.redone&&this.content.constructor===t.content.constructor&&this.content.mergeWith(t.content)){const e=this.parent._searchMarker;return e&&e.forEach((e=>{e.p===t&&(e.p=this,!this.deleted&&this.countable&&(e.index-=this.length))})),t.keep&&(this.keep=!0),this.right=t.right,null!==this.right&&(this.right.left=this),this.length+=t.length,!0}return!1}delete(t){if(!this.deleted){const e=this.parent;this.countable&&null===this.parentSub&&(e._length-=this.length),this.markDeleted(),pe(t.deleteSet,this.id.client,this.id.clock,this.length),Dn(t,e,this.parentSub),this.content.delete(t)}}gc(t,e){if(!this.deleted)throw ct.zR();this.content.gc(t),e?Tn(t,this,new ui(this.id,this.length)):this.content=new fi(this.length)}write(t,e){const n=e>0?tn(this.id.client,this.id.clock+e-1):this.origin,r=this.rightOrigin,i=this.parentSub,s=this.content.getRef()&T|(null===n?0:I)|(null===r?0:C)|(null===i?0:A);if(t.writeInfo(s),null!==n&&t.writeLeftID(n),null!==r&&t.writeRightID(r),null===n&&null===r){const e=this.parent;if(void 0!==e._item){const n=e._item;if(null===n){const n=en(e);t.writeParentInfo(!0),t.writeString(n)}else t.writeParentInfo(!1),t.writeLeftID(n.id)}else e.constructor===String?(t.writeParentInfo(!0),t.writeString(e)):e.constructor===Je?(t.writeParentInfo(!1),t.writeLeftID(e)):ct.zR();null!==i&&t.writeString(i)}this.content.write(t,e)}}const Hi=(t,e)=>$i[e&T](t),$i=[()=>{ct.zR()},pi,Si,di,Ti,bi,Ei,Bi,Ci,yi,()=>{ct.zR()}],Ki=10;class Gi extends ci{get deleted(){return!0}delete(){}mergeWith(t){return this.constructor===t.constructor&&(this.length+=t.length,!0)}integrate(t,e){ct.zR()}write(t,e){t.writeInfo(Ki),z(t.restEncoder,this.length-e)}getMissing(t,e){return null}}const qi="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:{},Wi="__ $YJS$ __";!0===qi[Wi]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),qi[Wi]=!0}}]);
//# sourceMappingURL=chunk-vendors.073f4087.js.map