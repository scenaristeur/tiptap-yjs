(self["webpackChunknoosphere3"]=self["webpackChunknoosphere3"]||[]).push([[998],{9662:function(e,t,n){var r=n(614),s=n(6330),i=TypeError;e.exports=function(e){if(r(e))return e;throw i(s(e)+" is not a function")}},6077:function(e,t,n){var r=n(614),s=String,i=TypeError;e.exports=function(e){if("object"==typeof e||r(e))return e;throw i("Can't set "+s(e)+" as a prototype")}},5787:function(e,t,n){var r=n(7976),s=TypeError;e.exports=function(e,t){if(r(t,e))return e;throw s("Incorrect invocation")}},9670:function(e,t,n){var r=n(111),s=String,i=TypeError;e.exports=function(e){if(r(e))return e;throw i(s(e)+" is not an object")}},3013:function(e){e.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},260:function(e,t,n){"use strict";var r,s,i,o=n(3013),a=n(9781),c=n(7854),l=n(614),u=n(111),h=n(2597),d=n(648),p=n(6330),f=n(8880),g=n(8052),m=n(7045),y=n(7976),w=n(9518),b=n(7674),v=n(5112),E=n(9711),_=n(9909),S=_.enforce,k=_.get,A=c.Int8Array,T=A&&A.prototype,C=c.Uint8ClampedArray,I=C&&C.prototype,R=A&&w(A),O=T&&w(T),x=Object.prototype,N=c.TypeError,D=v("toStringTag"),P=E("TYPED_ARRAY_TAG"),L="TypedArrayConstructor",M=o&&!!b&&"Opera"!==d(c.opera),B=!1,U={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},V={BigInt64Array:8,BigUint64Array:8},F=function(e){if(!u(e))return!1;var t=d(e);return"DataView"===t||h(U,t)||h(V,t)},j=function(e){var t=w(e);if(u(t)){var n=k(t);return n&&h(n,L)?n[L]:j(t)}},z=function(e){if(!u(e))return!1;var t=d(e);return h(U,t)||h(V,t)},$=function(e){if(z(e))return e;throw N("Target is not a typed array")},H=function(e){if(l(e)&&(!b||y(R,e)))return e;throw N(p(e)+" is not a typed array constructor")},K=function(e,t,n,r){if(a){if(n)for(var s in U){var i=c[s];if(i&&h(i.prototype,e))try{delete i.prototype[e]}catch(o){try{i.prototype[e]=t}catch(l){}}}O[e]&&!n||g(O,e,n?t:M&&T[e]||t,r)}},q=function(e,t,n){var r,s;if(a){if(b){if(n)for(r in U)if(s=c[r],s&&h(s,e))try{delete s[e]}catch(i){}if(R[e]&&!n)return;try{return g(R,e,n?t:M&&R[e]||t)}catch(i){}}for(r in U)s=c[r],!s||s[e]&&!n||g(s,e,t)}};for(r in U)s=c[r],i=s&&s.prototype,i?S(i)[L]=s:M=!1;for(r in V)s=c[r],i=s&&s.prototype,i&&(S(i)[L]=s);if((!M||!l(R)||R===Function.prototype)&&(R=function(){throw N("Incorrect invocation")},M))for(r in U)c[r]&&b(c[r],R);if((!M||!O||O===x)&&(O=R.prototype,M))for(r in U)c[r]&&b(c[r].prototype,O);if(M&&w(I)!==O&&b(I,O),a&&!h(O,D))for(r in B=!0,m(O,D,{configurable:!0,get:function(){return u(this)?this[P]:void 0}}),U)c[r]&&f(c[r],P,r);e.exports={NATIVE_ARRAY_BUFFER_VIEWS:M,TYPED_ARRAY_TAG:B&&P,aTypedArray:$,aTypedArrayConstructor:H,exportTypedArrayMethod:K,exportTypedArrayStaticMethod:q,getTypedArrayConstructor:j,isView:F,isTypedArray:z,TypedArray:R,TypedArrayPrototype:O}},7745:function(e,t,n){var r=n(6244);e.exports=function(e,t){var n=0,s=r(t),i=new e(s);while(s>n)i[n]=t[n++];return i}},1318:function(e,t,n){var r=n(5656),s=n(1400),i=n(6244),o=function(e){return function(t,n,o){var a,c=r(t),l=i(c),u=s(o,l);if(e&&n!=n){while(l>u)if(a=c[u++],a!=a)return!0}else for(;l>u;u++)if((e||u in c)&&c[u]===n)return e||u||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},3658:function(e,t,n){"use strict";var r=n(9781),s=n(3157),i=TypeError,o=Object.getOwnPropertyDescriptor,a=r&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}();e.exports=a?function(e,t){if(s(e)&&!o(e,"length").writable)throw i("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t}},206:function(e,t,n){var r=n(1702);e.exports=r([].slice)},1843:function(e,t,n){var r=n(6244);e.exports=function(e,t){for(var n=r(e),s=new t(n),i=0;i<n;i++)s[i]=e[n-i-1];return s}},1572:function(e,t,n){var r=n(6244),s=n(9303),i=RangeError;e.exports=function(e,t,n,o){var a=r(e),c=s(n),l=c<0?a+c:c;if(l>=a||l<0)throw i("Incorrect index");for(var u=new t(a),h=0;h<a;h++)u[h]=h===l?o:e[h];return u}},4326:function(e,t,n){var r=n(1702),s=r({}.toString),i=r("".slice);e.exports=function(e){return i(s(e),8,-1)}},648:function(e,t,n){var r=n(1694),s=n(614),i=n(4326),o=n(5112),a=o("toStringTag"),c=Object,l="Arguments"==i(function(){return arguments}()),u=function(e,t){try{return e[t]}catch(n){}};e.exports=r?i:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=u(t=c(e),a))?n:l?i(t):"Object"==(r=i(t))&&s(t.callee)?"Arguments":r}},9920:function(e,t,n){var r=n(2597),s=n(3887),i=n(1236),o=n(3070);e.exports=function(e,t,n){for(var a=s(t),c=o.f,l=i.f,u=0;u<a.length;u++){var h=a[u];r(e,h)||n&&r(n,h)||c(e,h,l(t,h))}}},8544:function(e,t,n){var r=n(7293);e.exports=!r((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},8880:function(e,t,n){var r=n(9781),s=n(3070),i=n(9114);e.exports=r?function(e,t,n){return s.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},9114:function(e){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},7045:function(e,t,n){var r=n(6339),s=n(3070);e.exports=function(e,t,n){return n.get&&r(n.get,t,{getter:!0}),n.set&&r(n.set,t,{setter:!0}),s.f(e,t,n)}},8052:function(e,t,n){var r=n(614),s=n(3070),i=n(6339),o=n(3072);e.exports=function(e,t,n,a){a||(a={});var c=a.enumerable,l=void 0!==a.name?a.name:t;if(r(n)&&i(n,l,a),a.global)c?e[t]=n:o(t,n);else{try{a.unsafe?e[t]&&(c=!0):delete e[t]}catch(u){}c?e[t]=n:s.f(e,t,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e}},3072:function(e,t,n){var r=n(7854),s=Object.defineProperty;e.exports=function(e,t){try{s(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},5117:function(e,t,n){"use strict";var r=n(6330),s=TypeError;e.exports=function(e,t){if(!delete e[t])throw s("Cannot delete property "+r(t)+" of "+r(e))}},9781:function(e,t,n){var r=n(7293);e.exports=!r((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4154:function(e){var t="object"==typeof document&&document.all,n="undefined"==typeof t&&void 0!==t;e.exports={all:t,IS_HTMLDDA:n}},317:function(e,t,n){var r=n(7854),s=n(111),i=r.document,o=s(i)&&s(i.createElement);e.exports=function(e){return o?i.createElement(e):{}}},7207:function(e){var t=TypeError,n=9007199254740991;e.exports=function(e){if(e>n)throw t("Maximum allowed index exceeded");return e}},3678:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},9363:function(e){e.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version},6833:function(e,t,n){var r=n(8113);e.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(r)},5268:function(e,t,n){var r=n(4326);e.exports="undefined"!=typeof process&&"process"==r(process)},8113:function(e){e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7392:function(e,t,n){var r,s,i=n(7854),o=n(8113),a=i.process,c=i.Deno,l=a&&a.versions||c&&c.version,u=l&&l.v8;u&&(r=u.split("."),s=r[0]>0&&r[0]<4?1:+(r[0]+r[1])),!s&&o&&(r=o.match(/Edge\/(\d+)/),(!r||r[1]>=74)&&(r=o.match(/Chrome\/(\d+)/),r&&(s=+r[1]))),e.exports=s},748:function(e){e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},1060:function(e,t,n){var r=n(1702),s=Error,i=r("".replace),o=function(e){return String(s(e).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,c=a.test(o);e.exports=function(e,t){if(c&&"string"==typeof e&&!s.prepareStackTrace)while(t--)e=i(e,a,"");return e}},2109:function(e,t,n){var r=n(7854),s=n(1236).f,i=n(8880),o=n(8052),a=n(3072),c=n(9920),l=n(4705);e.exports=function(e,t){var n,u,h,d,p,f,g=e.target,m=e.global,y=e.stat;if(u=m?r:y?r[g]||a(g,{}):(r[g]||{}).prototype,u)for(h in t){if(p=t[h],e.dontCallGetSet?(f=s(u,h),d=f&&f.value):d=u[h],n=l(m?h:g+(y?".":"#")+h,e.forced),!n&&void 0!==d){if(typeof p==typeof d)continue;c(p,d)}(e.sham||d&&d.sham)&&i(p,"sham",!0),o(u,h,p,e)}}},7293:function(e){e.exports=function(e){try{return!!e()}catch(t){return!0}}},2104:function(e,t,n){var r=n(4374),s=Function.prototype,i=s.apply,o=s.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?o.bind(i):function(){return o.apply(i,arguments)})},9974:function(e,t,n){var r=n(1470),s=n(9662),i=n(4374),o=r(r.bind);e.exports=function(e,t){return s(e),void 0===t?e:i?o(e,t):function(){return e.apply(t,arguments)}}},4374:function(e,t,n){var r=n(7293);e.exports=!r((function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}))},6916:function(e,t,n){var r=n(4374),s=Function.prototype.call;e.exports=r?s.bind(s):function(){return s.apply(s,arguments)}},6530:function(e,t,n){var r=n(9781),s=n(2597),i=Function.prototype,o=r&&Object.getOwnPropertyDescriptor,a=s(i,"name"),c=a&&"something"===function(){}.name,l=a&&(!r||r&&o(i,"name").configurable);e.exports={EXISTS:a,PROPER:c,CONFIGURABLE:l}},5668:function(e,t,n){var r=n(1702),s=n(9662);e.exports=function(e,t,n){try{return r(s(Object.getOwnPropertyDescriptor(e,t)[n]))}catch(i){}}},1470:function(e,t,n){var r=n(4326),s=n(1702);e.exports=function(e){if("Function"===r(e))return s(e)}},1702:function(e,t,n){var r=n(4374),s=Function.prototype,i=s.call,o=r&&s.bind.bind(i,i);e.exports=r?o:function(e){return function(){return i.apply(e,arguments)}}},5005:function(e,t,n){var r=n(7854),s=n(614),i=function(e){return s(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?i(r[e]):r[e]&&r[e][t]}},8173:function(e,t,n){var r=n(9662),s=n(8554);e.exports=function(e,t){var n=e[t];return s(n)?void 0:r(n)}},7854:function(e,t,n){var r=function(e){return e&&e.Math==Math&&e};e.exports=r("object"==typeof globalThis&&globalThis)||r("object"==typeof window&&window)||r("object"==typeof self&&self)||r("object"==typeof n.g&&n.g)||function(){return this}()||Function("return this")()},2597:function(e,t,n){var r=n(1702),s=n(7908),i=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return i(s(e),t)}},3501:function(e){e.exports={}},490:function(e,t,n){var r=n(5005);e.exports=r("document","documentElement")},4664:function(e,t,n){var r=n(9781),s=n(7293),i=n(317);e.exports=!r&&!s((function(){return 7!=Object.defineProperty(i("div"),"a",{get:function(){return 7}}).a}))},8361:function(e,t,n){var r=n(1702),s=n(7293),i=n(4326),o=Object,a=r("".split);e.exports=s((function(){return!o("z").propertyIsEnumerable(0)}))?function(e){return"String"==i(e)?a(e,""):o(e)}:o},9587:function(e,t,n){var r=n(614),s=n(111),i=n(7674);e.exports=function(e,t,n){var o,a;return i&&r(o=t.constructor)&&o!==n&&s(a=o.prototype)&&a!==n.prototype&&i(e,a),e}},2788:function(e,t,n){var r=n(1702),s=n(614),i=n(5465),o=r(Function.toString);s(i.inspectSource)||(i.inspectSource=function(e){return o(e)}),e.exports=i.inspectSource},9909:function(e,t,n){var r,s,i,o=n(4811),a=n(7854),c=n(111),l=n(8880),u=n(2597),h=n(5465),d=n(6200),p=n(3501),f="Object already initialized",g=a.TypeError,m=a.WeakMap,y=function(e){return i(e)?s(e):r(e,{})},w=function(e){return function(t){var n;if(!c(t)||(n=s(t)).type!==e)throw g("Incompatible receiver, "+e+" required");return n}};if(o||h.state){var b=h.state||(h.state=new m);b.get=b.get,b.has=b.has,b.set=b.set,r=function(e,t){if(b.has(e))throw g(f);return t.facade=e,b.set(e,t),t},s=function(e){return b.get(e)||{}},i=function(e){return b.has(e)}}else{var v=d("state");p[v]=!0,r=function(e,t){if(u(e,v))throw g(f);return t.facade=e,l(e,v,t),t},s=function(e){return u(e,v)?e[v]:{}},i=function(e){return u(e,v)}}e.exports={set:r,get:s,has:i,enforce:y,getterFor:w}},3157:function(e,t,n){var r=n(4326);e.exports=Array.isArray||function(e){return"Array"==r(e)}},4067:function(e,t,n){var r=n(648);e.exports=function(e){var t=r(e);return"BigInt64Array"==t||"BigUint64Array"==t}},614:function(e,t,n){var r=n(4154),s=r.all;e.exports=r.IS_HTMLDDA?function(e){return"function"==typeof e||e===s}:function(e){return"function"==typeof e}},4705:function(e,t,n){var r=n(7293),s=n(614),i=/#|\.prototype\./,o=function(e,t){var n=c[a(e)];return n==u||n!=l&&(s(t)?r(t):!!t)},a=o.normalize=function(e){return String(e).replace(i,".").toLowerCase()},c=o.data={},l=o.NATIVE="N",u=o.POLYFILL="P";e.exports=o},8554:function(e){e.exports=function(e){return null===e||void 0===e}},111:function(e,t,n){var r=n(614),s=n(4154),i=s.all;e.exports=s.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:r(e)||e===i}:function(e){return"object"==typeof e?null!==e:r(e)}},1913:function(e){e.exports=!1},2190:function(e,t,n){var r=n(5005),s=n(614),i=n(7976),o=n(3307),a=Object;e.exports=o?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return s(t)&&i(t.prototype,a(e))}},6244:function(e,t,n){var r=n(7466);e.exports=function(e){return r(e.length)}},6339:function(e,t,n){var r=n(1702),s=n(7293),i=n(614),o=n(2597),a=n(9781),c=n(6530).CONFIGURABLE,l=n(2788),u=n(9909),h=u.enforce,d=u.get,p=String,f=Object.defineProperty,g=r("".slice),m=r("".replace),y=r([].join),w=a&&!s((function(){return 8!==f((function(){}),"length",{value:8}).length})),b=String(String).split("String"),v=e.exports=function(e,t,n){"Symbol("===g(p(t),0,7)&&(t="["+m(p(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!o(e,"name")||c&&e.name!==t)&&(a?f(e,"name",{value:t,configurable:!0}):e.name=t),w&&n&&o(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?a&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(s){}var r=h(e);return o(r,"source")||(r.source=y(b,"string"==typeof t?t:"")),e};Function.prototype.toString=v((function(){return i(this)&&d(this).source||l(this)}),"toString")},4758:function(e){var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},6277:function(e,t,n){var r=n(1340);e.exports=function(e,t){return void 0===e?arguments.length<2?"":t:r(e)}},3070:function(e,t,n){var r=n(9781),s=n(4664),i=n(3353),o=n(9670),a=n(4948),c=TypeError,l=Object.defineProperty,u=Object.getOwnPropertyDescriptor,h="enumerable",d="configurable",p="writable";t.f=r?i?function(e,t,n){if(o(e),t=a(t),o(n),"function"===typeof e&&"prototype"===t&&"value"in n&&p in n&&!n[p]){var r=u(e,t);r&&r[p]&&(e[t]=n.value,n={configurable:d in n?n[d]:r[d],enumerable:h in n?n[h]:r[h],writable:!1})}return l(e,t,n)}:l:function(e,t,n){if(o(e),t=a(t),o(n),s)try{return l(e,t,n)}catch(r){}if("get"in n||"set"in n)throw c("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},1236:function(e,t,n){var r=n(9781),s=n(6916),i=n(5296),o=n(9114),a=n(5656),c=n(4948),l=n(2597),u=n(4664),h=Object.getOwnPropertyDescriptor;t.f=r?h:function(e,t){if(e=a(e),t=c(t),u)try{return h(e,t)}catch(n){}if(l(e,t))return o(!s(i.f,e,t),e[t])}},8006:function(e,t,n){var r=n(6324),s=n(748),i=s.concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},5181:function(e,t){t.f=Object.getOwnPropertySymbols},9518:function(e,t,n){var r=n(2597),s=n(614),i=n(7908),o=n(6200),a=n(8544),c=o("IE_PROTO"),l=Object,u=l.prototype;e.exports=a?l.getPrototypeOf:function(e){var t=i(e);if(r(t,c))return t[c];var n=t.constructor;return s(n)&&t instanceof n?n.prototype:t instanceof l?u:null}},7976:function(e,t,n){var r=n(1702);e.exports=r({}.isPrototypeOf)},6324:function(e,t,n){var r=n(1702),s=n(2597),i=n(5656),o=n(1318).indexOf,a=n(3501),c=r([].push);e.exports=function(e,t){var n,r=i(e),l=0,u=[];for(n in r)!s(a,n)&&s(r,n)&&c(u,n);while(t.length>l)s(r,n=t[l++])&&(~o(u,n)||c(u,n));return u}},5296:function(e,t){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,s=r&&!n.call({1:2},1);t.f=s?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},7674:function(e,t,n){var r=n(5668),s=n(9670),i=n(6077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{e=r(Object.prototype,"__proto__","set"),e(n,[]),t=n instanceof Array}catch(o){}return function(n,r){return s(n),i(r),t?e(n,r):n.__proto__=r,n}}():void 0)},2140:function(e,t,n){var r=n(6916),s=n(614),i=n(111),o=TypeError;e.exports=function(e,t){var n,a;if("string"===t&&s(n=e.toString)&&!i(a=r(n,e)))return a;if(s(n=e.valueOf)&&!i(a=r(n,e)))return a;if("string"!==t&&s(n=e.toString)&&!i(a=r(n,e)))return a;throw o("Can't convert object to primitive value")}},3887:function(e,t,n){var r=n(5005),s=n(1702),i=n(8006),o=n(5181),a=n(9670),c=s([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=i.f(a(e)),n=o.f;return n?c(t,n(e)):t}},7066:function(e,t,n){"use strict";var r=n(9670);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},4488:function(e,t,n){var r=n(8554),s=TypeError;e.exports=function(e){if(r(e))throw s("Can't call method on "+e);return e}},7152:function(e,t,n){"use strict";var r=n(7854),s=n(2104),i=n(614),o=n(9363),a=n(8113),c=n(206),l=n(8053),u=r.Function,h=/MSIE .\./.test(a)||o&&function(){var e=r.Bun.version.split(".");return e.length<3||0==e[0]&&(e[1]<3||3==e[1]&&0==e[2])}();e.exports=function(e,t){var n=t?2:1;return h?function(r,o){var a=l(arguments.length,1)>n,h=i(r)?r:u(r),d=a?c(arguments,n):[],p=a?function(){s(h,this,d)}:h;return t?e(p,o):e(p)}:e}},6200:function(e,t,n){var r=n(2309),s=n(9711),i=r("keys");e.exports=function(e){return i[e]||(i[e]=s(e))}},5465:function(e,t,n){var r=n(7854),s=n(3072),i="__core-js_shared__",o=r[i]||s(i,{});e.exports=o},2309:function(e,t,n){var r=n(1913),s=n(5465);(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.29.1",mode:r?"pure":"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.29.1/LICENSE",source:"https://github.com/zloirock/core-js"})},6293:function(e,t,n){var r=n(7392),s=n(7293);e.exports=!!Object.getOwnPropertySymbols&&!s((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&r&&r<41}))},261:function(e,t,n){var r,s,i,o,a=n(7854),c=n(2104),l=n(9974),u=n(614),h=n(2597),d=n(7293),p=n(490),f=n(206),g=n(317),m=n(8053),y=n(6833),w=n(5268),b=a.setImmediate,v=a.clearImmediate,E=a.process,_=a.Dispatch,S=a.Function,k=a.MessageChannel,A=a.String,T=0,C={},I="onreadystatechange";d((function(){r=a.location}));var R=function(e){if(h(C,e)){var t=C[e];delete C[e],t()}},O=function(e){return function(){R(e)}},x=function(e){R(e.data)},N=function(e){a.postMessage(A(e),r.protocol+"//"+r.host)};b&&v||(b=function(e){m(arguments.length,1);var t=u(e)?e:S(e),n=f(arguments,1);return C[++T]=function(){c(t,void 0,n)},s(T),T},v=function(e){delete C[e]},w?s=function(e){E.nextTick(O(e))}:_&&_.now?s=function(e){_.now(O(e))}:k&&!y?(i=new k,o=i.port2,i.port1.onmessage=x,s=l(o.postMessage,o)):a.addEventListener&&u(a.postMessage)&&!a.importScripts&&r&&"file:"!==r.protocol&&!d(N)?(s=N,a.addEventListener("message",x,!1)):s=I in g("script")?function(e){p.appendChild(g("script"))[I]=function(){p.removeChild(this),R(e)}}:function(e){setTimeout(O(e),0)}),e.exports={set:b,clear:v}},1400:function(e,t,n){var r=n(9303),s=Math.max,i=Math.min;e.exports=function(e,t){var n=r(e);return n<0?s(n+t,0):i(n,t)}},4599:function(e,t,n){var r=n(7593),s=TypeError;e.exports=function(e){var t=r(e,"number");if("number"==typeof t)throw s("Can't convert number to bigint");return BigInt(t)}},5656:function(e,t,n){var r=n(8361),s=n(4488);e.exports=function(e){return r(s(e))}},9303:function(e,t,n){var r=n(4758);e.exports=function(e){var t=+e;return t!==t||0===t?0:r(t)}},7466:function(e,t,n){var r=n(9303),s=Math.min;e.exports=function(e){return e>0?s(r(e),9007199254740991):0}},7908:function(e,t,n){var r=n(4488),s=Object;e.exports=function(e){return s(r(e))}},7593:function(e,t,n){var r=n(6916),s=n(111),i=n(2190),o=n(8173),a=n(2140),c=n(5112),l=TypeError,u=c("toPrimitive");e.exports=function(e,t){if(!s(e)||i(e))return e;var n,c=o(e,u);if(c){if(void 0===t&&(t="default"),n=r(c,e,t),!s(n)||i(n))return n;throw l("Can't convert object to primitive value")}return void 0===t&&(t="number"),a(e,t)}},4948:function(e,t,n){var r=n(7593),s=n(2190);e.exports=function(e){var t=r(e,"string");return s(t)?t:t+""}},1694:function(e,t,n){var r=n(5112),s=r("toStringTag"),i={};i[s]="z",e.exports="[object z]"===String(i)},1340:function(e,t,n){var r=n(648),s=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return s(e)}},6330:function(e){var t=String;e.exports=function(e){try{return t(e)}catch(n){return"Object"}}},9711:function(e,t,n){var r=n(1702),s=0,i=Math.random(),o=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++s+i,36)}},3307:function(e,t,n){var r=n(6293);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:function(e,t,n){var r=n(9781),s=n(7293);e.exports=r&&s((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},8053:function(e){var t=TypeError;e.exports=function(e,n){if(e<n)throw t("Not enough arguments");return e}},4811:function(e,t,n){var r=n(7854),s=n(614),i=r.WeakMap;e.exports=s(i)&&/native code/.test(String(i))},5112:function(e,t,n){var r=n(7854),s=n(2309),i=n(2597),o=n(9711),a=n(6293),c=n(3307),l=r.Symbol,u=s("wks"),h=c?l["for"]||l:l&&l.withoutSetter||o;e.exports=function(e){return i(u,e)||(u[e]=a&&i(l,e)?l[e]:h("Symbol."+e)),u[e]}},7658:function(e,t,n){"use strict";var r=n(2109),s=n(7908),i=n(6244),o=n(3658),a=n(7207),c=n(7293),l=c((function(){return 4294967297!==[].push.call({length:4294967296},1)})),u=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},h=l||!u();r({target:"Array",proto:!0,arity:1,forced:h},{push:function(e){var t=s(this),n=i(t),r=arguments.length;a(n+r);for(var c=0;c<r;c++)t[n]=arguments[c],n++;return o(t,n),n}})},541:function(e,t,n){"use strict";var r=n(2109),s=n(7908),i=n(6244),o=n(3658),a=n(5117),c=n(7207),l=1!==[].unshift(0),u=function(){try{Object.defineProperty([],"length",{writable:!1}).unshift()}catch(e){return e instanceof TypeError}},h=l||!u();r({target:"Array",proto:!0,arity:1,forced:h},{unshift:function(e){var t=s(this),n=i(t),r=arguments.length;if(r){c(n+r);var l=n;while(l--){var u=l+r;l in t?t[u]=t[l]:a(t,u)}for(var h=0;h<r;h++)t[h]=arguments[h]}return o(t,n+r)}})},2087:function(e,t,n){var r=n(7854),s=n(9781),i=n(7045),o=n(7066),a=n(7293),c=r.RegExp,l=c.prototype,u=s&&a((function(){var e=!0;try{c(".","d")}catch(u){e=!1}var t={},n="",r=e?"dgimsy":"gimsy",s=function(e,r){Object.defineProperty(t,e,{get:function(){return n+=r,!0}})},i={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in e&&(i.hasIndices="d"),i)s(o,i[o]);var a=Object.getOwnPropertyDescriptor(l,"flags").get.call(t);return a!==r||n!==r}));u&&i(l,"flags",{configurable:!0,get:o})},1439:function(e,t,n){"use strict";var r=n(1843),s=n(260),i=s.aTypedArray,o=s.exportTypedArrayMethod,a=s.getTypedArrayConstructor;o("toReversed",(function(){return r(i(this),a(this))}))},7585:function(e,t,n){"use strict";var r=n(260),s=n(1702),i=n(9662),o=n(7745),a=r.aTypedArray,c=r.getTypedArrayConstructor,l=r.exportTypedArrayMethod,u=s(r.TypedArrayPrototype.sort);l("toSorted",(function(e){void 0!==e&&i(e);var t=a(this),n=o(c(t),t);return u(n,e)}))},5315:function(e,t,n){"use strict";var r=n(1572),s=n(260),i=n(4067),o=n(9303),a=n(4599),c=s.aTypedArray,l=s.getTypedArrayConstructor,u=s.exportTypedArrayMethod,h=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(e){return 8===e}}();u("with",{with:function(e,t){var n=c(this),s=o(e),u=i(n)?a(t):+t;return r(n,l(n),s,u)}}["with"],!h)},3767:function(e,t,n){n(1439)},8585:function(e,t,n){n(7585)},8696:function(e,t,n){n(5315)},1091:function(e,t,n){var r=n(2109),s=n(7854),i=n(261).clear;r({global:!0,bind:!0,enumerable:!0,forced:s.clearImmediate!==i},{clearImmediate:i})},2801:function(e,t,n){"use strict";var r=n(2109),s=n(7854),i=n(5005),o=n(9114),a=n(3070).f,c=n(2597),l=n(5787),u=n(9587),h=n(6277),d=n(3678),p=n(1060),f=n(9781),g=n(1913),m="DOMException",y=i("Error"),w=i(m),b=function(){l(this,v);var e=arguments.length,t=h(e<1?void 0:arguments[0]),n=h(e<2?void 0:arguments[1],"Error"),r=new w(t,n),s=y(t);return s.name=m,a(r,"stack",o(1,p(s.stack,1))),u(r,this,b),r},v=b.prototype=w.prototype,E="stack"in y(m),_="stack"in new w(1,2),S=w&&f&&Object.getOwnPropertyDescriptor(s,m),k=!!S&&!(S.writable&&S.configurable),A=E&&!k&&!_;r({global:!0,constructor:!0,forced:g||A},{DOMException:A?b:w});var T=i(m),C=T.prototype;if(C.constructor!==T)for(var I in g||a(C,"constructor",o(1,T)),d)if(c(d,I)){var R=d[I],O=R.s;c(T,O)||a(T,O,o(6,R.c))}},4633:function(e,t,n){n(1091),n(2986)},2986:function(e,t,n){var r=n(2109),s=n(7854),i=n(261).set,o=n(7152),a=s.setImmediate?o(i,!1):i;r({global:!0,bind:!0,enumerable:!0,forced:s.setImmediate!==a},{setImmediate:a})},7966:function(e,t,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=-8,s=-4,i=0,o=1,a=1,c=2,l=5,u=1024,h=2048,d=8192,p=0,f=4,g=8,m=12,y=12,w=16,b="undefined"!==typeof BigUint64Array,v=Symbol(),E=1024;function _(e,t){const n=new Uint32Array(e),r=new Uint16Array(e);var i=n[t+s>>>2]>>>1,o=t>>>1;if(i<=E)return String.fromCharCode.apply(String,r.subarray(o,o+i));const a=[];do{const e=r[o+E-1],t=e>=55296&&e<56320?E-1:E;a.push(String.fromCharCode.apply(String,r.subarray(o,o+=t))),i-=t}while(i>E);return a.join("")+String.fromCharCode.apply(String,r.subarray(o,o+i))}function S(e){const t={};function n(e,t){return e?_(e.buffer,t):"<yet unknown>"}const r=e.env=e.env||{};return r.abort=r.abort||function(e,s,i,o){const a=t.memory||r.memory;throw Error("abort: "+n(a,e)+" at "+n(a,s)+":"+i+":"+o)},r.trace=r.trace||function(e,s){const i=t.memory||r.memory;console.log("trace: "+n(i,e)+(s?" ":"")+Array.prototype.slice.call(arguments,2,2+s).join(", "))},e.Math=e.Math||Math,e.Date=e.Date||Date,t}function k(e,t){const n=t.exports,v=n.memory,E=n.table,S=n["__alloc"],k=n["__retain"],A=n["__rtti_base"]||-1;function T(e){const t=new Uint32Array(v.buffer),n=t[A>>>2];if((e>>>=0)>=n)throw Error("invalid id: "+e);return t[(A+4>>>2)+2*e]}function C(e){const t=new Uint32Array(v.buffer),n=t[A>>>2];if((e>>>=0)>=n)throw Error("invalid id: "+e);return t[(A+4>>>2)+2*e+1]}function I(e){return 31-Math.clz32(e>>>l&31)}function O(e){const t=e.length,n=S(t<<1,o),r=new Uint16Array(v.buffer);for(var s=0,i=n>>>1;s<t;++s)r[i+s]=e.charCodeAt(s);return n}function x(e){const t=v.buffer,n=new Uint32Array(t)[e+r>>>2];if(n!==o)throw Error("not a string: "+e);return _(t,e)}function N(e,t,n){const r=v.buffer;if(n)switch(e){case 2:return new Float32Array(r);case 3:return new Float64Array(r)}else switch(e){case 0:return new(t?Int8Array:Uint8Array)(r);case 1:return new(t?Int16Array:Uint16Array)(r);case 2:return new(t?Int32Array:Uint32Array)(r);case 3:return new(t?BigInt64Array:BigUint64Array)(r)}throw Error("unsupported align: "+e)}function D(e,t){const n=T(e);if(!(n&(a|c)))throw Error("not an array: "+e+" @ "+n);const r=I(n),s=t.length,o=S(s<<r,i),l=S(n&c?w:m,e),b=new Uint32Array(v.buffer);b[l+p>>>2]=k(o),b[l+f>>>2]=o,b[l+g>>>2]=s<<r,n&c&&(b[l+y>>>2]=s);const E=N(r,n&u,n&h);if(n&d)for(let i=0;i<s;++i)E[(o>>>r)+i]=k(t[i]);else E.set(t,o>>>r);return l}function P(e){const t=new Uint32Array(v.buffer),n=t[e+r>>>2],i=T(n);if(!(i&a))throw Error("not an array: "+n);const o=I(i);var l=t[e+f>>>2];const d=i&c?t[e+y>>>2]:t[l+s>>>2]>>>o;return N(o,i&u,i&h).subarray(l>>>=o,l+d)}function L(e){const t=P(e),n=t.length,r=new Array(n);for(let s=0;s<n;s++)r[s]=t[s];return r}function M(e){const t=v.buffer,n=new Uint32Array(t)[e+s>>>2];return t.slice(e,e+n)}function B(e,t,n){return new e(U(e,t,n))}function U(e,t,n){const r=v.buffer,i=new Uint32Array(r),o=i[n+f>>>2];return new e(r,o,i[o+s>>>2]>>>t)}function V(e,t){const n=new Uint32Array(v.buffer);var s=n[e+r>>>2];if(s<=n[A>>>2])do{if(s==t)return!0}while(s=C(s));return!1}return e.__allocString=O,e.__getString=x,e.__allocArray=D,e.__getArrayView=P,e.__getArray=L,e.__getArrayBuffer=M,e.__getInt8Array=B.bind(null,Int8Array,0),e.__getInt8ArrayView=U.bind(null,Int8Array,0),e.__getUint8Array=B.bind(null,Uint8Array,0),e.__getUint8ArrayView=U.bind(null,Uint8Array,0),e.__getUint8ClampedArray=B.bind(null,Uint8ClampedArray,0),e.__getUint8ClampedArrayView=U.bind(null,Uint8ClampedArray,0),e.__getInt16Array=B.bind(null,Int16Array,1),e.__getInt16ArrayView=U.bind(null,Int16Array,1),e.__getUint16Array=B.bind(null,Uint16Array,1),e.__getUint16ArrayView=U.bind(null,Uint16Array,1),e.__getInt32Array=B.bind(null,Int32Array,2),e.__getInt32ArrayView=U.bind(null,Int32Array,2),e.__getUint32Array=B.bind(null,Uint32Array,2),e.__getUint32ArrayView=U.bind(null,Uint32Array,2),b&&(e.__getInt64Array=B.bind(null,BigInt64Array,3),e.__getInt64ArrayView=U.bind(null,BigInt64Array,3),e.__getUint64Array=B.bind(null,BigUint64Array,3),e.__getUint64ArrayView=U.bind(null,BigUint64Array,3)),e.__getFloat32Array=B.bind(null,Float32Array,2),e.__getFloat32ArrayView=U.bind(null,Float32Array,2),e.__getFloat64Array=B.bind(null,Float64Array,3),e.__getFloat64ArrayView=U.bind(null,Float64Array,3),e.__instanceof=V,e.memory=e.memory||v,e.table=e.table||E,R(n,e)}function A(e){return"undefined"!==typeof Response&&e instanceof Response}async function T(e,t){return A(e=await e)?I(e,t):k(S(t||(t={})),await WebAssembly.instantiate(e instanceof WebAssembly.Module?e:await WebAssembly.compile(e),t))}function C(e,t){return k(S(t||(t={})),new WebAssembly.Instance(e instanceof WebAssembly.Module?e:new WebAssembly.Module(e),t))}async function I(e,t){return WebAssembly.instantiateStreaming?k(S(t||(t={})),(await WebAssembly.instantiateStreaming(e,t)).instance):T(A(e=await e)?e.arrayBuffer():e,t)}function R(e,t){var n=t?Object.create(t):{},r=e["__argumentsLength"]?function(t){e["__argumentsLength"].value=t}:e["__setArgumentsLength"]||e["__setargc"]||function(){};for(let s in e){if(!Object.prototype.hasOwnProperty.call(e,s))continue;const t=e[s];let i=s.split("."),o=n;while(i.length>1){let e=i.shift();Object.prototype.hasOwnProperty.call(o,e)||(o[e]={}),o=o[e]}let a=i[0],c=a.indexOf("#");if(c>=0){let n=a.substring(0,c),i=o[n];if("undefined"===typeof i||!i.prototype){let e=function(...t){return e.wrap(e.prototype.constructor(0,...t))};e.prototype={valueOf:function(){return this[v]}},e.wrap=function(t){return Object.create(e.prototype,{[v]:{value:t,writable:!1}})},i&&Object.getOwnPropertyNames(i).forEach((t=>Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t)))),o[n]=e}if(a=a.substring(c+1),o=o[n].prototype,/^(get|set):/.test(a)){if(!Object.prototype.hasOwnProperty.call(o,a=a.substring(4))){let t=e[s.replace("set:","get:")],n=e[s.replace("get:","set:")];Object.defineProperty(o,a,{get:function(){return t(this[v])},set:function(e){n(this[v],e)},enumerable:!0})}}else"constructor"===a?(o[a]=(...e)=>(r(e.length),t(...e))).original=t:(o[a]=function(...e){return r(e.length),t(this[v],...e)}).original=t}else/^(get|set):/.test(a)?Object.prototype.hasOwnProperty.call(o,a=a.substring(4))||Object.defineProperty(o,a,{get:e[s.replace("set:","get:")],set:e[s.replace("get:","set:")],enumerable:!0}):"function"===typeof t&&t!==r?(o[a]=(...e)=>(r(e.length),t(...e))).original=t:o[a]=t}return n}t.instantiate=T,t.instantiateSync=C,t.instantiateStreaming=I,t.demangle=R},9145:function(e,t,n){"use strict";e.exports=n(1444)},1444:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(5770),r.BufferWriter=n(5910),r.Reader=n(8438),r.BufferReader=n(3479),r.util=n(3497),r.rpc=n(1735),r.roots=n(819),r.configure=s,s()},8438:function(e,t,n){"use strict";n(3767),n(8585),n(8696),e.exports=c;var r,s=n(3497),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l="undefined"!==typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},u=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function h(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new i(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"===typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while(4!==(e=7&this.uint32()))this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=u(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},3479:function(e,t,n){"use strict";e.exports=i;var r=n(8438);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(3497);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},819:function(e){"use strict";e.exports={}},1735:function(e,t,n){"use strict";var r=t;r.Service=n(8782)},8782:function(e,t,n){"use strict";e.exports=s;var r=n(3497);function s(e,t,n){if("function"!==typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(c){return a.emit("error",c,t),void setTimeout((function(){o(c)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},5688:function(e,t,n){"use strict";e.exports=s;var r=n(3497);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"===typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},3497:function(e,t,n){"use strict";n(3767),n(8585),n(8696);var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(3551),r.base64=n(8550),r.EventEmitter=n(8447),r.float=n(891),r.inquire=n(4842),r.utf8=n(479),r.pool=n(1387),r.LongBits=n(5688),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"===typeof e||e instanceof String},r.isObject=function(e){return e&&"object"===typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"===typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"===typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},5770:function(e,t,n){"use strict";e.exports=h;var r,s=n(3497),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function l(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t,n){while(e>127)t[n++]=127&e|128,e>>>=7;t[n]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){while(e.hi)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;while(e.lo>127)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},g.prototype=Object.create(c.prototype),g.prototype.fn=f,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var w=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(w,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){var e=this.head.next,t=this.constructor.alloc(this.len),n=0;while(e)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},5910:function(e,t,n){"use strict";n(3767),n(8585),n(8696),e.exports=i;var r=n(5770);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(3497);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},3551:function(e){"use strict";function t(e,t){var n=new Array(arguments.length-1),r=0,s=2,i=!0;while(s<arguments.length)n[r++]=arguments[s++];return new Promise((function(s,o){n[r]=function(e){if(i)if(i=!1,e)o(e);else{var t=new Array(arguments.length-1),n=0;while(n<t.length)t[n++]=arguments[n];s.apply(null,t)}};try{e.apply(t||null,n)}catch(a){i&&(i=!1,o(a))}}))}e.exports=t},8550:function(e,t,n){"use strict";n(7658);var r=t;r.length=function(e){var t=e.length;if(!t)return 0;var n=0;while(--t%4>1&&"="===e.charAt(t))++n;return Math.ceil(3*e.length)/4-n};for(var s=new Array(64),i=new Array(123),o=0;o<64;)i[s[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;r.encode=function(e,t,n){var r,i=null,o=[],a=0,c=0;while(t<n){var l=e[t++];switch(c){case 0:o[a++]=s[l>>2],r=(3&l)<<4,c=1;break;case 1:o[a++]=s[r|l>>4],r=(15&l)<<2,c=2;break;case 2:o[a++]=s[r|l>>6],o[a++]=s[63&l],c=0;break}a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0)}return c&&(o[a++]=s[r],o[a++]=61,1===c&&(o[a++]=61)),i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var a="invalid encoding";r.decode=function(e,t,n){for(var r,s=n,o=0,c=0;c<e.length;){var l=e.charCodeAt(c++);if(61===l&&o>1)break;if(void 0===(l=i[l]))throw Error(a);switch(o){case 0:r=l,o=1;break;case 1:t[n++]=r<<2|(48&l)>>4,r=l,o=2;break;case 2:t[n++]=(15&r)<<4|(60&l)>>2,r=l,o=3;break;case 3:t[n++]=(3&r)<<6|l,o=0;break}}if(1===o)throw Error(a);return n-s},r.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},8447:function(e,t,n){"use strict";function r(){this._listeners={}}n(7658),e.exports=r,r.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},r.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},r.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},891:function(e,t,n){"use strict";function r(e){return"undefined"!==typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function s(e,r,s){t[0]=e,r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3]}function i(e,r,s){t[0]=e,r[s]=n[3],r[s+1]=n[2],r[s+2]=n[1],r[s+3]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function a(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?s:i,e.writeFloatBE=r?i:s,e.readFloatLE=r?o:a,e.readFloatBE=r?a:o}():function(){function t(e,t,n,r){var s=t<0?1:0;if(s&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((s<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((s<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var i=Math.floor(Math.log(t)/Math.LN2),o=8388607&Math.round(t*Math.pow(2,-i)*8388608);e((s<<31|i+127<<23|o)>>>0,n,r)}}function n(e,t,n){var r=e(t,n),s=2*(r>>31)+1,i=r>>>23&255,o=8388607&r;return 255===i?o?NaN:s*(1/0):0===i?1401298464324817e-60*s*o:s*Math.pow(2,i-150)*(o+8388608)}e.writeFloatLE=t.bind(null,s),e.writeFloatBE=t.bind(null,i),e.readFloatLE=n.bind(null,o),e.readFloatBE=n.bind(null,a)}(),"undefined"!==typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function s(e,r,s){t[0]=e,r[s]=n[0],r[s+1]=n[1],r[s+2]=n[2],r[s+3]=n[3],r[s+4]=n[4],r[s+5]=n[5],r[s+6]=n[6],r[s+7]=n[7]}function i(e,r,s){t[0]=e,r[s]=n[7],r[s+1]=n[6],r[s+2]=n[5],r[s+3]=n[4],r[s+4]=n[3],r[s+5]=n[2],r[s+6]=n[1],r[s+7]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function a(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?s:i,e.writeDoubleBE=r?i:s,e.readDoubleLE=r?o:a,e.readDoubleBE=r?a:o}():function(){function t(e,t,n,r,s,i){var o=r<0?1:0;if(o&&(r=-r),0===r)e(0,s,i+t),e(1/r>0?0:2147483648,s,i+n);else if(isNaN(r))e(0,s,i+t),e(2146959360,s,i+n);else if(r>17976931348623157e292)e(0,s,i+t),e((o<<31|2146435072)>>>0,s,i+n);else{var a;if(r<22250738585072014e-324)a=r/5e-324,e(a>>>0,s,i+t),e((o<<31|a/4294967296)>>>0,s,i+n);else{var c=Math.floor(Math.log(r)/Math.LN2);1024===c&&(c=1023),a=r*Math.pow(2,-c),e(4503599627370496*a>>>0,s,i+t),e((o<<31|c+1023<<20|1048576*a&1048575)>>>0,s,i+n)}}}function n(e,t,n,r,s){var i=e(r,s+t),o=e(r,s+n),a=2*(o>>31)+1,c=o>>>20&2047,l=4294967296*(1048575&o)+i;return 2047===c?l?NaN:a*(1/0):0===c?5e-324*a*l:a*Math.pow(2,c-1075)*(l+4503599627370496)}e.writeDoubleLE=t.bind(null,s,0,4),e.writeDoubleBE=t.bind(null,i,4,0),e.readDoubleLE=n.bind(null,o,0,4),e.readDoubleBE=n.bind(null,a,4,0)}(),e}function s(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function i(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function o(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function a(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}n(3767),n(8585),n(8696),e.exports=r(r)},4842:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},1387:function(e){"use strict";function t(e,t,n){var r=n||8192,s=r>>>1,i=null,o=r;return function(n){if(n<1||n>s)return e(n);o+n>r&&(i=e(r),o=0);var a=t.call(i,o,o+=n);return 7&o&&(o=1+(7|o)),a}}e.exports=t},479:function(e,t,n){"use strict";n(7658);var r=t;r.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)n=e.charCodeAt(r),n<128?t+=1:n<2048?t+=2:55296===(64512&n)&&56320===(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},r.read=function(e,t,n){var r=n-t;if(r<1)return"";var s,i=null,o=[],a=0;while(t<n)s=e[t++],s<128?o[a++]=s:s>191&&s<224?o[a++]=(31&s)<<6|63&e[t++]:s>239&&s<365?(s=((7&s)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,o[a++]=55296+(s>>10),o[a++]=56320+(1023&s)):o[a++]=(15&s)<<12|(63&e[t++])<<6|63&e[t++],a>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),a=0);return i?(a&&i.push(String.fromCharCode.apply(String,o.slice(0,a))),i.join("")):String.fromCharCode.apply(String,o.slice(0,a))},r.write=function(e,t,n){for(var r,s,i=n,o=0;o<e.length;++o)r=e.charCodeAt(o),r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&56320===(64512&(s=e.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&s),++o,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-i}},3419:function(e,t,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(t,"__esModule",{value:!0});var r=n(6773);function s(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16}function i(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0}function o(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16}function a(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0}function c(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>8,t[n+1]=e>>>0,t}function l(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t}function u(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function h(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function d(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function p(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function f(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>24,t[n+1]=e>>>16,t[n+2]=e>>>8,t[n+3]=e>>>0,t}function g(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24,t}function m(e,t){void 0===t&&(t=0);var n=u(e,t),r=u(e,t+4);return 4294967296*n+r-4294967296*(r>>31)}function y(e,t){void 0===t&&(t=0);var n=h(e,t),r=h(e,t+4);return 4294967296*n+r}function w(e,t){void 0===t&&(t=0);var n=d(e,t),r=d(e,t+4);return 4294967296*r+n-4294967296*(n>>31)}function b(e,t){void 0===t&&(t=0);var n=p(e,t),r=p(e,t+4);return 4294967296*r+n}function v(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),f(e/4294967296>>>0,t,n),f(e>>>0,t,n+4),t}function E(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),g(e>>>0,t,n),g(e/4294967296>>>0,t,n+4),t}function _(e,t,n){if(void 0===n&&(n=0),e%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,s=1,i=e/8+n-1;i>=n;i--)r+=t[i]*s,s*=256;return r}function S(e,t,n){if(void 0===n&&(n=0),e%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,s=1,i=n;i<n+e/8;i++)r+=t[i]*s,s*=256;return r}function k(e,t,n,s){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===s&&(s=0),e%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var i=1,o=e/8+s-1;o>=s;o--)n[o]=t/i&255,i*=256;return n}function A(e,t,n,s){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===s&&(s=0),e%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var i=1,o=s;o<s+e/8;o++)n[o]=t/i&255,i*=256;return n}function T(e,t){void 0===t&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getFloat32(t)}function C(e,t){void 0===t&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getFloat32(t,!0)}function I(e,t){void 0===t&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getFloat64(t)}function R(e,t){void 0===t&&(t=0);var n=new DataView(e.buffer,e.byteOffset,e.byteLength);return n.getFloat64(t,!0)}function O(e,t,n){void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setFloat32(n,e),t}function x(e,t,n){void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setFloat32(n,e,!0),t}function N(e,t,n){void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setFloat64(n,e),t}function D(e,t,n){void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.setFloat64(n,e,!0),t}t.readInt16BE=s,t.readUint16BE=i,t.readInt16LE=o,t.readUint16LE=a,t.writeUint16BE=c,t.writeInt16BE=c,t.writeUint16LE=l,t.writeInt16LE=l,t.readInt32BE=u,t.readUint32BE=h,t.readInt32LE=d,t.readUint32LE=p,t.writeUint32BE=f,t.writeInt32BE=f,t.writeUint32LE=g,t.writeInt32LE=g,t.readInt64BE=m,t.readUint64BE=y,t.readInt64LE=w,t.readUint64LE=b,t.writeUint64BE=v,t.writeInt64BE=v,t.writeUint64LE=E,t.writeInt64LE=E,t.readUintBE=_,t.readUintLE=S,t.writeUintBE=k,t.writeUintLE=A,t.readFloat32BE=T,t.readFloat32LE=C,t.readFloat64BE=I,t.readFloat64LE=R,t.writeFloat32BE=O,t.writeFloat32LE=x,t.writeFloat64BE=N,t.writeFloat64LE=D},5593:function(e,t,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(t,"__esModule",{value:!0});var r=n(3419),s=n(6835),i=20;function o(e,t,n){for(var s=1634760805,o=857760878,a=2036477234,c=1797285236,l=n[3]<<24|n[2]<<16|n[1]<<8|n[0],u=n[7]<<24|n[6]<<16|n[5]<<8|n[4],h=n[11]<<24|n[10]<<16|n[9]<<8|n[8],d=n[15]<<24|n[14]<<16|n[13]<<8|n[12],p=n[19]<<24|n[18]<<16|n[17]<<8|n[16],f=n[23]<<24|n[22]<<16|n[21]<<8|n[20],g=n[27]<<24|n[26]<<16|n[25]<<8|n[24],m=n[31]<<24|n[30]<<16|n[29]<<8|n[28],y=t[3]<<24|t[2]<<16|t[1]<<8|t[0],w=t[7]<<24|t[6]<<16|t[5]<<8|t[4],b=t[11]<<24|t[10]<<16|t[9]<<8|t[8],v=t[15]<<24|t[14]<<16|t[13]<<8|t[12],E=s,_=o,S=a,k=c,A=l,T=u,C=h,I=d,R=p,O=f,x=g,N=m,D=y,P=w,L=b,M=v,B=0;B<i;B+=2)E=E+A|0,D^=E,D=D>>>16|D<<16,R=R+D|0,A^=R,A=A>>>20|A<<12,_=_+T|0,P^=_,P=P>>>16|P<<16,O=O+P|0,T^=O,T=T>>>20|T<<12,S=S+C|0,L^=S,L=L>>>16|L<<16,x=x+L|0,C^=x,C=C>>>20|C<<12,k=k+I|0,M^=k,M=M>>>16|M<<16,N=N+M|0,I^=N,I=I>>>20|I<<12,S=S+C|0,L^=S,L=L>>>24|L<<8,x=x+L|0,C^=x,C=C>>>25|C<<7,k=k+I|0,M^=k,M=M>>>24|M<<8,N=N+M|0,I^=N,I=I>>>25|I<<7,_=_+T|0,P^=_,P=P>>>24|P<<8,O=O+P|0,T^=O,T=T>>>25|T<<7,E=E+A|0,D^=E,D=D>>>24|D<<8,R=R+D|0,A^=R,A=A>>>25|A<<7,E=E+T|0,M^=E,M=M>>>16|M<<16,x=x+M|0,T^=x,T=T>>>20|T<<12,_=_+C|0,D^=_,D=D>>>16|D<<16,N=N+D|0,C^=N,C=C>>>20|C<<12,S=S+I|0,P^=S,P=P>>>16|P<<16,R=R+P|0,I^=R,I=I>>>20|I<<12,k=k+A|0,L^=k,L=L>>>16|L<<16,O=O+L|0,A^=O,A=A>>>20|A<<12,S=S+I|0,P^=S,P=P>>>24|P<<8,R=R+P|0,I^=R,I=I>>>25|I<<7,k=k+A|0,L^=k,L=L>>>24|L<<8,O=O+L|0,A^=O,A=A>>>25|A<<7,_=_+C|0,D^=_,D=D>>>24|D<<8,N=N+D|0,C^=N,C=C>>>25|C<<7,E=E+T|0,M^=E,M=M>>>24|M<<8,x=x+M|0,T^=x,T=T>>>25|T<<7;r.writeUint32LE(E+s|0,e,0),r.writeUint32LE(_+o|0,e,4),r.writeUint32LE(S+a|0,e,8),r.writeUint32LE(k+c|0,e,12),r.writeUint32LE(A+l|0,e,16),r.writeUint32LE(T+u|0,e,20),r.writeUint32LE(C+h|0,e,24),r.writeUint32LE(I+d|0,e,28),r.writeUint32LE(R+p|0,e,32),r.writeUint32LE(O+f|0,e,36),r.writeUint32LE(x+g|0,e,40),r.writeUint32LE(N+m|0,e,44),r.writeUint32LE(D+y|0,e,48),r.writeUint32LE(P+w|0,e,52),r.writeUint32LE(L+b|0,e,56),r.writeUint32LE(M+v|0,e,60)}function a(e,t,n,r,i){if(void 0===i&&(i=0),32!==e.length)throw new Error("ChaCha: key size must be 32 bytes");if(r.length<n.length)throw new Error("ChaCha: destination is shorter than source");var a,c;if(0===i){if(8!==t.length&&12!==t.length)throw new Error("ChaCha nonce must be 8 or 12 bytes");a=new Uint8Array(16),c=a.length-t.length,a.set(t,c)}else{if(16!==t.length)throw new Error("ChaCha nonce with counter must be 16 bytes");a=t,c=i}for(var u=new Uint8Array(64),h=0;h<n.length;h+=64){o(u,a,e);for(var d=h;d<h+64&&d<n.length;d++)r[d]=n[d]^u[d-h];l(a,0,c)}return s.wipe(u),0===i&&s.wipe(a),r}function c(e,t,n,r){return void 0===r&&(r=0),s.wipe(n),a(e,t,n,n,r)}function l(e,t,n){var r=1;while(n--)r=r+(255&e[t])|0,e[t]=255&r,r>>>=8,t++;if(r>0)throw new Error("ChaCha: counter overflow")}t.streamXOR=a,t.stream=c},5602:function(e,t,n){"use strict";n(3767),n(8585),n(8696);var r=n(5593),s=n(9952),i=n(6835),o=n(3419),a=n(3229);t.Cv=32,t.WH=12,t.pg=16;var c=new Uint8Array(16),l=function(){function e(e){if(this.nonceLength=t.WH,this.tagLength=t.pg,e.length!==t.Cv)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(e)}return e.prototype.seal=function(e,t,n,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var o=new Uint8Array(16);o.set(e,o.length-e.length);var a=new Uint8Array(32);r.stream(this._key,o,a,4);var c,l=t.length+this.tagLength;if(s){if(s.length!==l)throw new Error("ChaCha20Poly1305: incorrect destination length");c=s}else c=new Uint8Array(l);return r.streamXOR(this._key,o,t,c,4),this._authenticate(c.subarray(c.length-this.tagLength,c.length),a,c.subarray(0,c.length-this.tagLength),n),i.wipe(o),c},e.prototype.open=function(e,t,n,s){if(e.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(t.length<this.tagLength)return null;var o=new Uint8Array(16);o.set(e,o.length-e.length);var c=new Uint8Array(32);r.stream(this._key,o,c,4);var l=new Uint8Array(this.tagLength);if(this._authenticate(l,c,t.subarray(0,t.length-this.tagLength),n),!a.equal(l,t.subarray(t.length-this.tagLength,t.length)))return null;var u,h=t.length-this.tagLength;if(s){if(s.length!==h)throw new Error("ChaCha20Poly1305: incorrect destination length");u=s}else u=new Uint8Array(h);return r.streamXOR(this._key,o,t.subarray(0,t.length-this.tagLength),u,4),i.wipe(o),u},e.prototype.clean=function(){return i.wipe(this._key),this},e.prototype._authenticate=function(e,t,n,r){var a=new s.Poly1305(t);r&&(a.update(r),r.length%16>0&&a.update(c.subarray(r.length%16))),a.update(n),n.length%16>0&&a.update(c.subarray(n.length%16));var l=new Uint8Array(8);r&&o.writeUint64LE(r.length,l),a.update(l),o.writeUint64LE(n.length,l),a.update(l);for(var u=a.digest(),h=0;h<u.length;h++)e[h]=u[h];a.clean(),i.wipe(u),i.wipe(l)},e}();t.OK=l},3229:function(e,t){"use strict";function n(e,t,n){return~(e-1)&t|e-1&n}function r(e,t){return(0|e)-(0|t)-1>>>31&1}function s(e,t){if(e.length!==t.length)return 0;for(var n=0,r=0;r<e.length;r++)n|=e[r]^t[r];return 1&n-1>>>8}function i(e,t){return 0!==e.length&&0!==t.length&&0!==s(e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.select=n,t.lessOrEqual=r,t.compare=s,t.equal=i},1737:function(e,t){"use strict";function n(e){return"undefined"!==typeof e.saveState&&"undefined"!==typeof e.restoreState&&"undefined"!==typeof e.cleanSavedState}Object.defineProperty(t,"__esModule",{value:!0}),t.isSerializableHash=n},3017:function(e,t,n){"use strict";n(3767),n(8585),n(8696);var r=n(4135),s=n(6835),i=function(){function e(e,t,n,s){void 0===n&&(n=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=s;var i=r.hmac(this._hash,n,t);this._hmac=new r.HMAC(e,i),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return e.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(0===e)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},e.prototype.expand=function(e){for(var t=new Uint8Array(e),n=0;n<t.length;n++)this._bufpos===this._buffer.length&&this._fillBuffer(),t[n]=this._buffer[this._bufpos++];return t},e.prototype.clean=function(){this._hmac.clean(),s.wipe(this._buffer),s.wipe(this._counter),this._bufpos=0},e}();t.t=i},4135:function(e,t,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(t,"__esModule",{value:!0});var r=n(1737),s=n(3229),i=n(6835),o=function(){function e(e,t){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var n=new Uint8Array(this.blockSize);t.length>this.blockSize?this._inner.update(t).finish(n).clean():n.set(t);for(var s=0;s<n.length;s++)n[s]^=54;this._inner.update(n);for(s=0;s<n.length;s++)n[s]^=106;this._outer.update(n),r.isSerializableHash(this._inner)&&r.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),i.wipe(n)}return e.prototype.reset=function(){if(!r.isSerializableHash(this._inner)||!r.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.clean=function(){r.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),r.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},e.prototype.update=function(e){return this._inner.update(e),this},e.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(!r.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},e.prototype.restoreState=function(e){if(!r.isSerializableHash(this._inner)||!r.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},e.prototype.cleanSavedState=function(e){if(!r.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},e}();function a(e,t,n){var r=new o(e,t);r.update(n);var s=r.digest();return r.clean(),s}t.HMAC=o,t.hmac=a,t.equal=s.equal},6773:function(e,t){"use strict";function n(e,t){var n=e>>>16&65535,r=65535&e,s=t>>>16&65535,i=65535&t;return r*i+(n*i+r*s<<16>>>0)|0}function r(e,t){return e+t|0}function s(e,t){return e-t|0}function i(e,t){return e<<t|e>>>32-t}function o(e,t){return e<<32-t|e>>>t}function a(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e}Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||n,t.add=r,t.sub=s,t.rotl=i,t.rotr=o,t.isInteger=Number.isInteger||a,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},9952:function(e,t,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(t,"__esModule",{value:!0});var r=n(3229),s=n(6835);t.DIGEST_LENGTH=16;var i=function(){function e(e){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var n=e[0]|e[1]<<8;this._r[0]=8191&n;var r=e[2]|e[3]<<8;this._r[1]=8191&(n>>>13|r<<3);var s=e[4]|e[5]<<8;this._r[2]=7939&(r>>>10|s<<6);var i=e[6]|e[7]<<8;this._r[3]=8191&(s>>>7|i<<9);var o=e[8]|e[9]<<8;this._r[4]=255&(i>>>4|o<<12),this._r[5]=o>>>1&8190;var a=e[10]|e[11]<<8;this._r[6]=8191&(o>>>14|a<<2);var c=e[12]|e[13]<<8;this._r[7]=8065&(a>>>11|c<<5);var l=e[14]|e[15]<<8;this._r[8]=8191&(c>>>8|l<<8),this._r[9]=l>>>5&127,this._pad[0]=e[16]|e[17]<<8,this._pad[1]=e[18]|e[19]<<8,this._pad[2]=e[20]|e[21]<<8,this._pad[3]=e[22]|e[23]<<8,this._pad[4]=e[24]|e[25]<<8,this._pad[5]=e[26]|e[27]<<8,this._pad[6]=e[28]|e[29]<<8,this._pad[7]=e[30]|e[31]<<8}return e.prototype._blocks=function(e,t,n){var r=this._fin?0:2048,s=this._h[0],i=this._h[1],o=this._h[2],a=this._h[3],c=this._h[4],l=this._h[5],u=this._h[6],h=this._h[7],d=this._h[8],p=this._h[9],f=this._r[0],g=this._r[1],m=this._r[2],y=this._r[3],w=this._r[4],b=this._r[5],v=this._r[6],E=this._r[7],_=this._r[8],S=this._r[9];while(n>=16){var k=e[t+0]|e[t+1]<<8;s+=8191&k;var A=e[t+2]|e[t+3]<<8;i+=8191&(k>>>13|A<<3);var T=e[t+4]|e[t+5]<<8;o+=8191&(A>>>10|T<<6);var C=e[t+6]|e[t+7]<<8;a+=8191&(T>>>7|C<<9);var I=e[t+8]|e[t+9]<<8;c+=8191&(C>>>4|I<<12),l+=I>>>1&8191;var R=e[t+10]|e[t+11]<<8;u+=8191&(I>>>14|R<<2);var O=e[t+12]|e[t+13]<<8;h+=8191&(R>>>11|O<<5);var x=e[t+14]|e[t+15]<<8;d+=8191&(O>>>8|x<<8),p+=x>>>5|r;var N=0,D=N;D+=s*f,D+=i*(5*S),D+=o*(5*_),D+=a*(5*E),D+=c*(5*v),N=D>>>13,D&=8191,D+=l*(5*b),D+=u*(5*w),D+=h*(5*y),D+=d*(5*m),D+=p*(5*g),N+=D>>>13,D&=8191;var P=N;P+=s*g,P+=i*f,P+=o*(5*S),P+=a*(5*_),P+=c*(5*E),N=P>>>13,P&=8191,P+=l*(5*v),P+=u*(5*b),P+=h*(5*w),P+=d*(5*y),P+=p*(5*m),N+=P>>>13,P&=8191;var L=N;L+=s*m,L+=i*g,L+=o*f,L+=a*(5*S),L+=c*(5*_),N=L>>>13,L&=8191,L+=l*(5*E),L+=u*(5*v),L+=h*(5*b),L+=d*(5*w),L+=p*(5*y),N+=L>>>13,L&=8191;var M=N;M+=s*y,M+=i*m,M+=o*g,M+=a*f,M+=c*(5*S),N=M>>>13,M&=8191,M+=l*(5*_),M+=u*(5*E),M+=h*(5*v),M+=d*(5*b),M+=p*(5*w),N+=M>>>13,M&=8191;var B=N;B+=s*w,B+=i*y,B+=o*m,B+=a*g,B+=c*f,N=B>>>13,B&=8191,B+=l*(5*S),B+=u*(5*_),B+=h*(5*E),B+=d*(5*v),B+=p*(5*b),N+=B>>>13,B&=8191;var U=N;U+=s*b,U+=i*w,U+=o*y,U+=a*m,U+=c*g,N=U>>>13,U&=8191,U+=l*f,U+=u*(5*S),U+=h*(5*_),U+=d*(5*E),U+=p*(5*v),N+=U>>>13,U&=8191;var V=N;V+=s*v,V+=i*b,V+=o*w,V+=a*y,V+=c*m,N=V>>>13,V&=8191,V+=l*g,V+=u*f,V+=h*(5*S),V+=d*(5*_),V+=p*(5*E),N+=V>>>13,V&=8191;var F=N;F+=s*E,F+=i*v,F+=o*b,F+=a*w,F+=c*y,N=F>>>13,F&=8191,F+=l*m,F+=u*g,F+=h*f,F+=d*(5*S),F+=p*(5*_),N+=F>>>13,F&=8191;var j=N;j+=s*_,j+=i*E,j+=o*v,j+=a*b,j+=c*w,N=j>>>13,j&=8191,j+=l*y,j+=u*m,j+=h*g,j+=d*f,j+=p*(5*S),N+=j>>>13,j&=8191;var z=N;z+=s*S,z+=i*_,z+=o*E,z+=a*v,z+=c*b,N=z>>>13,z&=8191,z+=l*w,z+=u*y,z+=h*m,z+=d*g,z+=p*f,N+=z>>>13,z&=8191,N=(N<<2)+N|0,N=N+D|0,D=8191&N,N>>>=13,P+=N,s=D,i=P,o=L,a=M,c=B,l=U,u=V,h=F,d=j,p=z,t+=16,n-=16}this._h[0]=s,this._h[1]=i,this._h[2]=o,this._h[3]=a,this._h[4]=c,this._h[5]=l,this._h[6]=u,this._h[7]=h,this._h[8]=d,this._h[9]=p},e.prototype.finish=function(e,t){void 0===t&&(t=0);var n,r,s,i,o=new Uint16Array(10);if(this._leftover){for(i=this._leftover,this._buffer[i++]=1;i<16;i++)this._buffer[i]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(n=this._h[1]>>>13,this._h[1]&=8191,i=2;i<10;i++)this._h[i]+=n,n=this._h[i]>>>13,this._h[i]&=8191;for(this._h[0]+=5*n,n=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=n,n=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=n,o[0]=this._h[0]+5,n=o[0]>>>13,o[0]&=8191,i=1;i<10;i++)o[i]=this._h[i]+n,n=o[i]>>>13,o[i]&=8191;for(o[9]-=8192,r=(1^n)-1,i=0;i<10;i++)o[i]&=r;for(r=~r,i=0;i<10;i++)this._h[i]=this._h[i]&r|o[i];for(this._h[0]=65535&(this._h[0]|this._h[1]<<13),this._h[1]=65535&(this._h[1]>>>3|this._h[2]<<10),this._h[2]=65535&(this._h[2]>>>6|this._h[3]<<7),this._h[3]=65535&(this._h[3]>>>9|this._h[4]<<4),this._h[4]=65535&(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14),this._h[5]=65535&(this._h[6]>>>2|this._h[7]<<11),this._h[6]=65535&(this._h[7]>>>5|this._h[8]<<8),this._h[7]=65535&(this._h[8]>>>8|this._h[9]<<5),s=this._h[0]+this._pad[0],this._h[0]=65535&s,i=1;i<8;i++)s=(this._h[i]+this._pad[i]|0)+(s>>>16)|0,this._h[i]=65535&s;return e[t+0]=this._h[0]>>>0,e[t+1]=this._h[0]>>>8,e[t+2]=this._h[1]>>>0,e[t+3]=this._h[1]>>>8,e[t+4]=this._h[2]>>>0,e[t+5]=this._h[2]>>>8,e[t+6]=this._h[3]>>>0,e[t+7]=this._h[3]>>>8,e[t+8]=this._h[4]>>>0,e[t+9]=this._h[4]>>>8,e[t+10]=this._h[5]>>>0,e[t+11]=this._h[5]>>>8,e[t+12]=this._h[6]>>>0,e[t+13]=this._h[6]>>>8,e[t+14]=this._h[7]>>>0,e[t+15]=this._h[7]>>>8,this._finished=!0,this},e.prototype.update=function(e){var t,n=0,r=e.length;if(this._leftover){t=16-this._leftover,t>r&&(t=r);for(var s=0;s<t;s++)this._buffer[this._leftover+s]=e[n+s];if(r-=t,n+=t,this._leftover+=t,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(r>=16&&(t=r-r%16,this._blocks(e,n,t),n+=t,r-=t),r){for(s=0;s<r;s++)this._buffer[this._leftover+s]=e[n+s];this._leftover+=r}return this},e.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var e=new Uint8Array(16);return this.finish(e),e},e.prototype.clean=function(){return s.wipe(this._buffer),s.wipe(this._r),s.wipe(this._h),s.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},e}();function o(e,t){var n=new i(e);n.update(t);var r=n.digest();return n.clean(),r}function a(e,n){return e.length===t.DIGEST_LENGTH&&n.length===t.DIGEST_LENGTH&&r.equal(e,n)}t.Poly1305=i,t.oneTimeAuth=o,t.equal=a},3918:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const r=n(2193),s=n(3419),i=n(6835);function o(e,n=t.defaultRandomSource){return n.randomBytes(e)}function a(e=t.defaultRandomSource){const n=o(4,e),r=(0,s.readUint32LE)(n);return(0,i.wipe)(n),r}t.defaultRandomSource=new r.SystemRandomSource,t.randomBytes=o,t.randomUint32=a;const c="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function l(e,n=c,r=t.defaultRandomSource){if(n.length<2)throw new Error("randomString charset is too short");if(n.length>256)throw new Error("randomString charset is too long");let s="";const a=n.length,l=256-256%a;while(e>0){const t=o(Math.ceil(256*e/l),r);for(let r=0;r<t.length&&e>0;r++){const i=t[r];i<l&&(s+=n.charAt(i%a),e--)}(0,i.wipe)(t)}return s}function u(e,n=c,r=t.defaultRandomSource){const s=Math.ceil(e/(Math.log(n.length)/Math.LN2));return l(s,n,r)}t.randomString=l,t.randomStringForEntropy=u},1474:function(e,t,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserRandomSource=void 0;const r=65536;class s{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e="undefined"!==typeof self?self.crypto||self.msCrypto:null;e&&void 0!==e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const t=new Uint8Array(e);for(let n=0;n<t.length;n+=r)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,r)));return t}}t.BrowserRandomSource=s},979:function(e,t,n){"use strict";n(3767),n(8585),n(8696),Object.defineProperty(t,"__esModule",{value:!0}),t.NodeRandomSource=void 0;const r=n(6835);class s{constructor(){this.isAvailable=!1,this.isInstantiated=!1;{const e=n(1586);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const n=new Uint8Array(e);for(let r=0;r<n.length;r++)n[r]=t[r];return(0,r.wipe)(t),n}}t.NodeRandomSource=s},2193:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SystemRandomSource=void 0;const r=n(1474),s=n(979);class i{constructor(){return this.isAvailable=!1,this.name="",this._source=new r.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new s.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}t.SystemRandomSource=i},9300:function(e,t,n){"use strict";n(3767),n(8585),n(8696);var r=n(3419),s=n(6835);t.k=32,t.cn=64;var i=function(){function e(){this.digestLength=t.k,this.blockSize=t.cn,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return e.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},e.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},e.prototype.clean=function(){s.wipe(this._buffer),s.wipe(this._temp),this.reset()},e.prototype.update=function(e,t){if(void 0===t&&(t=e.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var n=0;if(this._bytesHashed+=t,this._bufferLength>0){while(this._bufferLength<this.blockSize&&t>0)this._buffer[this._bufferLength++]=e[n++],t--;this._bufferLength===this.blockSize&&(a(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}t>=this.blockSize&&(n=a(this._temp,this._state,e,n,t),t%=this.blockSize);while(t>0)this._buffer[this._bufferLength++]=e[n++],t--;return this},e.prototype.finish=function(e){if(!this._finished){var t=this._bytesHashed,n=this._bufferLength,s=t/536870912|0,i=t<<3,o=t%64<56?64:128;this._buffer[n]=128;for(var c=n+1;c<o-8;c++)this._buffer[c]=0;r.writeUint32BE(s,this._buffer,o-8),r.writeUint32BE(i,this._buffer,o-4),a(this._temp,this._state,this._buffer,0,o),this._finished=!0}for(c=0;c<this.digestLength/4;c++)r.writeUint32BE(this._state[c],e,4*c);return this},e.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},e.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},e.prototype.restoreState=function(e){return this._state.set(e.state),this._bufferLength=e.bufferLength,e.buffer&&this._buffer.set(e.buffer),this._bytesHashed=e.bytesHashed,this._finished=!1,this},e.prototype.cleanSavedState=function(e){s.wipe(e.state),e.buffer&&s.wipe(e.buffer),e.bufferLength=0,e.bytesHashed=0},e}();t.mE=i;var o=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function a(e,t,n,s,i){while(i>=64){for(var a=t[0],c=t[1],l=t[2],u=t[3],h=t[4],d=t[5],p=t[6],f=t[7],g=0;g<16;g++){var m=s+4*g;e[g]=r.readUint32BE(n,m)}for(g=16;g<64;g++){var y=e[g-2],w=(y>>>17|y<<15)^(y>>>19|y<<13)^y>>>10;y=e[g-15];var b=(y>>>7|y<<25)^(y>>>18|y<<14)^y>>>3;e[g]=(w+e[g-7]|0)+(b+e[g-16]|0)}for(g=0;g<64;g++){w=(((h>>>6|h<<26)^(h>>>11|h<<21)^(h>>>25|h<<7))+(h&d^~h&p)|0)+(f+(o[g]+e[g]|0)|0)|0,b=((a>>>2|a<<30)^(a>>>13|a<<19)^(a>>>22|a<<10))+(a&c^a&l^c&l)|0;f=p,p=d,d=h,h=u+w|0,u=l,l=c,c=a,a=w+b|0}t[0]+=a,t[1]+=c,t[2]+=l,t[3]+=u,t[4]+=h,t[5]+=d,t[6]+=p,t[7]+=f,s+=64,i-=64}return s}function c(e){var t=new i;t.update(e);var n=t.digest();return t.clean(),n}t.vp=c},6835:function(e,t){"use strict";function n(e){for(var t=0;t<e.length;t++)e[t]=0;return e}Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=n},2578:function(e,t,n){"use strict";n(3767),n(8585),n(8696),t.gi=t.Au=t._w=t.KS=t.kz=void 0;const r=n(3918),s=n(6835);function i(e){const t=new Float64Array(16);if(e)for(let n=0;n<e.length;n++)t[n]=e[n];return t}t.kz=32,t.KS=32;const o=new Uint8Array(32);o[0]=9;const a=i([56129,1]);function c(e){let t=1;for(let n=0;n<16;n++){let r=e[n]+t+65535;t=Math.floor(r/65536),e[n]=r-65536*t}e[0]+=t-1+37*(t-1)}function l(e,t,n){const r=~(n-1);for(let s=0;s<16;s++){const n=r&(e[s]^t[s]);e[s]^=n,t[s]^=n}}function u(e,t){const n=i(),r=i();for(let s=0;s<16;s++)r[s]=t[s];c(r),c(r),c(r);for(let s=0;s<2;s++){n[0]=r[0]-65517;for(let t=1;t<15;t++)n[t]=r[t]-65535-(n[t-1]>>16&1),n[t-1]&=65535;n[15]=r[15]-32767-(n[14]>>16&1);const e=n[15]>>16&1;n[14]&=65535,l(r,n,1-e)}for(let s=0;s<16;s++)e[2*s]=255&r[s],e[2*s+1]=r[s]>>8}function h(e,t){for(let n=0;n<16;n++)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}function d(e,t,n){for(let r=0;r<16;r++)e[r]=t[r]+n[r]}function p(e,t,n){for(let r=0;r<16;r++)e[r]=t[r]-n[r]}function f(e,t,n){let r,s,i=0,o=0,a=0,c=0,l=0,u=0,h=0,d=0,p=0,f=0,g=0,m=0,y=0,w=0,b=0,v=0,E=0,_=0,S=0,k=0,A=0,T=0,C=0,I=0,R=0,O=0,x=0,N=0,D=0,P=0,L=0,M=n[0],B=n[1],U=n[2],V=n[3],F=n[4],j=n[5],z=n[6],$=n[7],H=n[8],K=n[9],q=n[10],G=n[11],W=n[12],Y=n[13],J=n[14],Q=n[15];r=t[0],i+=r*M,o+=r*B,a+=r*U,c+=r*V,l+=r*F,u+=r*j,h+=r*z,d+=r*$,p+=r*H,f+=r*K,g+=r*q,m+=r*G,y+=r*W,w+=r*Y,b+=r*J,v+=r*Q,r=t[1],o+=r*M,a+=r*B,c+=r*U,l+=r*V,u+=r*F,h+=r*j,d+=r*z,p+=r*$,f+=r*H,g+=r*K,m+=r*q,y+=r*G,w+=r*W,b+=r*Y,v+=r*J,E+=r*Q,r=t[2],a+=r*M,c+=r*B,l+=r*U,u+=r*V,h+=r*F,d+=r*j,p+=r*z,f+=r*$,g+=r*H,m+=r*K,y+=r*q,w+=r*G,b+=r*W,v+=r*Y,E+=r*J,_+=r*Q,r=t[3],c+=r*M,l+=r*B,u+=r*U,h+=r*V,d+=r*F,p+=r*j,f+=r*z,g+=r*$,m+=r*H,y+=r*K,w+=r*q,b+=r*G,v+=r*W,E+=r*Y,_+=r*J,S+=r*Q,r=t[4],l+=r*M,u+=r*B,h+=r*U,d+=r*V,p+=r*F,f+=r*j,g+=r*z,m+=r*$,y+=r*H,w+=r*K,b+=r*q,v+=r*G,E+=r*W,_+=r*Y,S+=r*J,k+=r*Q,r=t[5],u+=r*M,h+=r*B,d+=r*U,p+=r*V,f+=r*F,g+=r*j,m+=r*z,y+=r*$,w+=r*H,b+=r*K,v+=r*q,E+=r*G,_+=r*W,S+=r*Y,k+=r*J,A+=r*Q,r=t[6],h+=r*M,d+=r*B,p+=r*U,f+=r*V,g+=r*F,m+=r*j,y+=r*z,w+=r*$,b+=r*H,v+=r*K,E+=r*q,_+=r*G,S+=r*W,k+=r*Y,A+=r*J,T+=r*Q,r=t[7],d+=r*M,p+=r*B,f+=r*U,g+=r*V,m+=r*F,y+=r*j,w+=r*z,b+=r*$,v+=r*H,E+=r*K,_+=r*q,S+=r*G,k+=r*W,A+=r*Y,T+=r*J,C+=r*Q,r=t[8],p+=r*M,f+=r*B,g+=r*U,m+=r*V,y+=r*F,w+=r*j,b+=r*z,v+=r*$,E+=r*H,_+=r*K,S+=r*q,k+=r*G,A+=r*W,T+=r*Y,C+=r*J,I+=r*Q,r=t[9],f+=r*M,g+=r*B,m+=r*U,y+=r*V,w+=r*F,b+=r*j,v+=r*z,E+=r*$,_+=r*H,S+=r*K,k+=r*q,A+=r*G,T+=r*W,C+=r*Y,I+=r*J,R+=r*Q,r=t[10],g+=r*M,m+=r*B,y+=r*U,w+=r*V,b+=r*F,v+=r*j,E+=r*z,_+=r*$,S+=r*H,k+=r*K,A+=r*q,T+=r*G,C+=r*W,I+=r*Y,R+=r*J,O+=r*Q,r=t[11],m+=r*M,y+=r*B,w+=r*U,b+=r*V,v+=r*F,E+=r*j,_+=r*z,S+=r*$,k+=r*H,A+=r*K,T+=r*q,C+=r*G,I+=r*W,R+=r*Y,O+=r*J,x+=r*Q,r=t[12],y+=r*M,w+=r*B,b+=r*U,v+=r*V,E+=r*F,_+=r*j,S+=r*z,k+=r*$,A+=r*H,T+=r*K,C+=r*q,I+=r*G,R+=r*W,O+=r*Y,x+=r*J,N+=r*Q,r=t[13],w+=r*M,b+=r*B,v+=r*U,E+=r*V,_+=r*F,S+=r*j,k+=r*z,A+=r*$,T+=r*H,C+=r*K,I+=r*q,R+=r*G,O+=r*W,x+=r*Y,N+=r*J,D+=r*Q,r=t[14],b+=r*M,v+=r*B,E+=r*U,_+=r*V,S+=r*F,k+=r*j,A+=r*z,T+=r*$,C+=r*H,I+=r*K,R+=r*q,O+=r*G,x+=r*W,N+=r*Y,D+=r*J,P+=r*Q,r=t[15],v+=r*M,E+=r*B,_+=r*U,S+=r*V,k+=r*F,A+=r*j,T+=r*z,C+=r*$,I+=r*H,R+=r*K,O+=r*q,x+=r*G,N+=r*W,D+=r*Y,P+=r*J,L+=r*Q,i+=38*E,o+=38*_,a+=38*S,c+=38*k,l+=38*A,u+=38*T,h+=38*C,d+=38*I,p+=38*R,f+=38*O,g+=38*x,m+=38*N,y+=38*D,w+=38*P,b+=38*L,s=1,r=i+s+65535,s=Math.floor(r/65536),i=r-65536*s,r=o+s+65535,s=Math.floor(r/65536),o=r-65536*s,r=a+s+65535,s=Math.floor(r/65536),a=r-65536*s,r=c+s+65535,s=Math.floor(r/65536),c=r-65536*s,r=l+s+65535,s=Math.floor(r/65536),l=r-65536*s,r=u+s+65535,s=Math.floor(r/65536),u=r-65536*s,r=h+s+65535,s=Math.floor(r/65536),h=r-65536*s,r=d+s+65535,s=Math.floor(r/65536),d=r-65536*s,r=p+s+65535,s=Math.floor(r/65536),p=r-65536*s,r=f+s+65535,s=Math.floor(r/65536),f=r-65536*s,r=g+s+65535,s=Math.floor(r/65536),g=r-65536*s,r=m+s+65535,s=Math.floor(r/65536),m=r-65536*s,r=y+s+65535,s=Math.floor(r/65536),y=r-65536*s,r=w+s+65535,s=Math.floor(r/65536),w=r-65536*s,r=b+s+65535,s=Math.floor(r/65536),b=r-65536*s,r=v+s+65535,s=Math.floor(r/65536),v=r-65536*s,i+=s-1+37*(s-1),s=1,r=i+s+65535,s=Math.floor(r/65536),i=r-65536*s,r=o+s+65535,s=Math.floor(r/65536),o=r-65536*s,r=a+s+65535,s=Math.floor(r/65536),a=r-65536*s,r=c+s+65535,s=Math.floor(r/65536),c=r-65536*s,r=l+s+65535,s=Math.floor(r/65536),l=r-65536*s,r=u+s+65535,s=Math.floor(r/65536),u=r-65536*s,r=h+s+65535,s=Math.floor(r/65536),h=r-65536*s,r=d+s+65535,s=Math.floor(r/65536),d=r-65536*s,r=p+s+65535,s=Math.floor(r/65536),p=r-65536*s,r=f+s+65535,s=Math.floor(r/65536),f=r-65536*s,r=g+s+65535,s=Math.floor(r/65536),g=r-65536*s,r=m+s+65535,s=Math.floor(r/65536),m=r-65536*s,r=y+s+65535,s=Math.floor(r/65536),y=r-65536*s,r=w+s+65535,s=Math.floor(r/65536),w=r-65536*s,r=b+s+65535,s=Math.floor(r/65536),b=r-65536*s,r=v+s+65535,s=Math.floor(r/65536),v=r-65536*s,i+=s-1+37*(s-1),e[0]=i,e[1]=o,e[2]=a,e[3]=c,e[4]=l,e[5]=u,e[6]=h,e[7]=d,e[8]=p,e[9]=f,e[10]=g,e[11]=m,e[12]=y,e[13]=w,e[14]=b,e[15]=v}function g(e,t){f(e,t,t)}function m(e,t){const n=i();for(let r=0;r<16;r++)n[r]=t[r];for(let r=253;r>=0;r--)g(n,n),2!==r&&4!==r&&f(n,n,t);for(let r=0;r<16;r++)e[r]=n[r]}function y(e,t){const n=new Uint8Array(32),r=new Float64Array(80),s=i(),o=i(),c=i(),y=i(),w=i(),b=i();for(let i=0;i<31;i++)n[i]=e[i];n[31]=127&e[31]|64,n[0]&=248,h(r,t);for(let i=0;i<16;i++)o[i]=r[i];s[0]=y[0]=1;for(let i=254;i>=0;--i){const e=n[i>>>3]>>>(7&i)&1;l(s,o,e),l(c,y,e),d(w,s,c),p(s,s,c),d(c,o,y),p(o,o,y),g(y,w),g(b,s),f(s,c,s),f(c,o,w),d(w,s,c),p(s,s,c),g(o,s),p(c,y,b),f(s,c,a),d(s,s,y),f(c,c,s),f(s,y,b),f(y,o,r),g(o,w),l(s,o,e),l(c,y,e)}for(let i=0;i<16;i++)r[i+16]=s[i],r[i+32]=c[i],r[i+48]=o[i],r[i+64]=y[i];const v=r.subarray(32),E=r.subarray(16);m(v,v),f(E,E,v);const _=new Uint8Array(32);return u(_,E),_}function w(e){return y(e,o)}function b(e){if(e.length!==t.KS)throw new Error(`x25519: seed must be ${t.KS} bytes`);const n=new Uint8Array(e),r=w(n);return{publicKey:r,secretKey:n}}function v(e){const t=(0,r.randomBytes)(32,e),n=b(t);return(0,s.wipe)(t),n}function E(e,n,r=!1){if(e.length!==t.kz)throw new Error("X25519: incorrect secret key length");if(n.length!==t.kz)throw new Error("X25519: incorrect public key length");const s=y(e,n);if(r){let e=0;for(let t=0;t<s.length;t++)e|=s[t];if(0===e)throw new Error("X25519: invalid shared key")}return s}t._w=b,t.Au=v,t.gi=E},1547:function(e,t){"use strict";const n=Math.exp;e.exports=function(e){if("number"!==typeof e)throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");let t,r,s=0,i=0,o=0,a={};function c(t,r){return 1-n(-(t-r)/e)}return a.push=function(e,n){if(r){const a=c(e,r),l=n-t,u=a*l;t=a*n+(1-a)*t,s=(1-a)*(s+l*u),i=Math.sqrt(s),o=t+a*l}else t=n;r=e},a.movingAverage=function(){return t},a.variance=function(){return s},a.deviation=function(){return i},a.forecast=function(){return o},a}},6551:function(e,t,n){"use strict";n(7658);const{fromCallback:r}=n(63),s=n(7368),{getCallback:i,getOptions:o}=n(9293),a=Symbol("promise"),c=Symbol("status"),l=Symbol("operations"),u=Symbol("finishClose"),h=Symbol("closeCallbacks");class d{constructor(e){if("object"!==typeof e||null===e){const t=null===e?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}this[l]=[],this[h]=[],this[c]="open",this[u]=this[u].bind(this),this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get length(){return this[l].length}put(e,t,n){if("open"!==this[c])throw new s("Batch is not open: cannot call put() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const r=this.db._checkKey(e)||this.db._checkValue(t);if(r)throw r;const i=n&&null!=n.sublevel?n.sublevel:this.db,o=n,a=i.keyEncoding(n&&n.keyEncoding),u=i.valueEncoding(n&&n.valueEncoding),h=a.format;n={...n,keyEncoding:h,valueEncoding:u.format},i!==this.db&&(n.sublevel=null);const d=i.prefixKey(a.encode(e),h),p=u.encode(t);return this._put(d,p,n),this[l].push({...o,type:"put",key:e,value:t}),this}_put(e,t,n){}del(e,t){if("open"!==this[c])throw new s("Batch is not open: cannot call del() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});const n=this.db._checkKey(e);if(n)throw n;const r=t&&null!=t.sublevel?t.sublevel:this.db,i=t,o=r.keyEncoding(t&&t.keyEncoding),a=o.format;return t={...t,keyEncoding:a},r!==this.db&&(t.sublevel=null),this._del(r.prefixKey(o.encode(e),a),t),this[l].push({...i,type:"del",key:e}),this}_del(e,t){}clear(){if("open"!==this[c])throw new s("Batch is not open: cannot call clear() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"});return this._clear(),this[l]=[],this}_clear(){}write(e,t){return t=i(e,t),t=r(t,a),e=o(e),"open"!==this[c]?this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"})):0===this.length?this.close(t):(this[c]="writing",this._write(e,(e=>{this[c]="closing",this[h].push((()=>t(e))),e||this.db.emit("batch",this[l]),this._close(this[u])}))),t[a]}_write(e,t){}close(e){return e=r(e,a),"closing"===this[c]?this[h].push(e):"closed"===this[c]?this.nextTick(e):(this[h].push(e),"writing"!==this[c]&&(this[c]="closing",this._close(this[u]))),e[a]}_close(e){this.nextTick(e)}[u](){this[c]="closed",this.db.detachResource(this);const e=this[h];this[h]=[];for(const t of e)t()}}t.AbstractChainedBatch=d},873:function(e,t,n){"use strict";n(7658);const{fromCallback:r}=n(63),s=n(7368),{getOptions:i,getCallback:o}=n(9293),a=Symbol("promise"),c=Symbol("callback"),l=Symbol("working"),u=Symbol("handleOne"),h=Symbol("handleMany"),d=Symbol("autoClose"),p=Symbol("finishWork"),f=Symbol("returnMany"),g=Symbol("closing"),m=Symbol("handleClose"),y=Symbol("closed"),w=Symbol("closeCallbacks"),b=Symbol("keyEncoding"),v=Symbol("valueEncoding"),E=Symbol("abortOnClose"),_=Symbol("legacy"),S=Symbol("keys"),k=Symbol("values"),A=Symbol("limit"),T=Symbol("count"),C=Object.freeze({}),I=()=>{};let R=!1;class O{constructor(e,t,n){if("object"!==typeof e||null===e){const t=null===e?"null":typeof e;throw new TypeError(`The first argument must be an abstract-level database, received ${t}`)}if("object"!==typeof t||null===t)throw new TypeError("The second argument must be an options object");this[y]=!1,this[w]=[],this[l]=!1,this[g]=!1,this[d]=!1,this[c]=null,this[u]=this[u].bind(this),this[h]=this[h].bind(this),this[m]=this[m].bind(this),this[b]=t[b],this[v]=t[v],this[_]=n,this[A]=Number.isInteger(t.limit)&&t.limit>=0?t.limit:1/0,this[T]=0,this[E]=!!t.abortOnClose,this.db=e,this.db.attachResource(this),this.nextTick=e.nextTick}get count(){return this[T]}get limit(){return this[A]}next(e){let t;if(void 0===e)t=new Promise(((t,n)=>{e=(e,r,s)=>{e?n(e):this[_]?void 0===r&&void 0===s?t():t([r,s]):t(r)}}));else if("function"!==typeof e)throw new TypeError("Callback must be a function");return this[g]?this.nextTick(e,new s("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(e,new s("Iterator is busy: cannot call next() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[l]=!0,this[c]=e,this[T]>=this[A]?this.nextTick(this[u],null):this._next(this[u])),t}_next(e){this.nextTick(e)}nextv(e,t,n){return n=o(t,n),n=r(n,a),t=i(t,C),Number.isInteger(e)?(this[g]?this.nextTick(n,new s("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(n,new s("Iterator is busy: cannot call nextv() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(e<1&&(e=1),this[A]<1/0&&(e=Math.min(e,this[A]-this[T])),this[l]=!0,this[c]=n,e<=0?this.nextTick(this[h],null,[]):this._nextv(e,t,this[h])),n[a]):(this.nextTick(n,new TypeError("The first argument 'size' must be an integer")),n[a])}_nextv(e,t,n){const r=[],s=(t,i,o)=>t?n(t):(this[_]?void 0===i&&void 0===o:void 0===i)?n(null,r):(r.push(this[_]?[i,o]:i),void(r.length===e?n(null,r):this._next(s)));this._next(s)}all(e,t){return t=o(e,t),t=r(t,a),e=i(e,C),this[g]?this.nextTick(t,new s("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"})):this[l]?this.nextTick(t,new s("Iterator is busy: cannot call all() until previous call has completed",{code:"LEVEL_ITERATOR_BUSY"})):(this[l]=!0,this[c]=t,this[d]=!0,this[T]>=this[A]?this.nextTick(this[h],null,[]):this._all(e,this[h])),t[a]}_all(e,t){let n=this[T];const r=[],s=()=>{const e=this[A]<1/0?Math.min(1e3,this[A]-n):1e3;e<=0?this.nextTick(t,null,r):this._nextv(e,C,i)},i=(e,i)=>{e?t(e):0===i.length?t(null,r):(r.push.apply(r,i),n+=i.length,s())};s()}[p](){const e=this[c];return this[E]&&null===e?I:(this[l]=!1,this[c]=null,this[g]&&this._close(this[m]),e)}[f](e,t,n){this[d]?this.close(e.bind(null,t,n)):e(t,n)}seek(e,t){if(t=i(t,C),this[g]);else{if(this[l])throw new s("Iterator is busy: cannot call seek() until next() has completed",{code:"LEVEL_ITERATOR_BUSY"});{const n=this.db.keyEncoding(t.keyEncoding||this[b]),r=n.format;t.keyEncoding!==r&&(t={...t,keyEncoding:r});const s=this.db.prefixKey(n.encode(e),r);this._seek(s,t)}}}_seek(e,t){throw new s("Iterator does not support seek()",{code:"LEVEL_NOT_SUPPORTED"})}close(e){if(e=r(e,a),this[y])this.nextTick(e);else if(this[g])this[w].push(e);else if(this[g]=!0,this[w].push(e),this[l]){if(this[E]){const e=this[p]();e(new s("Aborted on iterator close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))}}else this._close(this[m]);return e[a]}_close(e){this.nextTick(e)}[m](){this[y]=!0,this.db.detachResource(this);const e=this[w];this[w]=[];for(const t of e)t()}async*[Symbol.asyncIterator](){try{let e;while(void 0!==(e=await this.next()))yield e}finally{this[y]||await this.close()}}}class x extends O{constructor(e,t){super(e,t,!0),this[S]=!1!==t.keys,this[k]=!1!==t.values}[u](e,t,n){const r=this[p]();if(e)return r(e);try{t=this[S]&&void 0!==t?this[b].decode(t):void 0,n=this[k]&&void 0!==n?this[v].decode(n):void 0}catch(e){return r(new P("entry",e))}void 0===t&&void 0===n||this[T]++,r(null,t,n)}[h](e,t){const n=this[p]();if(e)return this[f](n,e);try{for(const e of t){const t=e[0],n=e[1];e[0]=this[S]&&void 0!==t?this[b].decode(t):void 0,e[1]=this[k]&&void 0!==n?this[v].decode(n):void 0}}catch(e){return this[f](n,new P("entries",e))}this[T]+=t.length,this[f](n,null,t)}end(e){return R||"undefined"===typeof console||(R=!0,console.warn(new s("The iterator.end() method was renamed to close() and end() is an alias that will be removed in a future version",{code:"LEVEL_LEGACY"}))),this.close(e)}}class N extends O{constructor(e,t){super(e,t,!1)}[u](e,t){const n=this[p]();if(e)return n(e);try{t=void 0!==t?this[b].decode(t):void 0}catch(e){return n(new P("key",e))}void 0!==t&&this[T]++,n(null,t)}[h](e,t){const n=this[p]();if(e)return this[f](n,e);try{for(let e=0;e<t.length;e++){const n=t[e];t[e]=void 0!==n?this[b].decode(n):void 0}}catch(e){return this[f](n,new P("keys",e))}this[T]+=t.length,this[f](n,null,t)}}class D extends O{constructor(e,t){super(e,t,!1)}[u](e,t){const n=this[p]();if(e)return n(e);try{t=void 0!==t?this[v].decode(t):void 0}catch(e){return n(new P("value",e))}void 0!==t&&this[T]++,n(null,t)}[h](e,t){const n=this[p]();if(e)return this[f](n,e);try{for(let e=0;e<t.length;e++){const n=t[e];t[e]=void 0!==n?this[v].decode(n):void 0}}catch(e){return this[f](n,new P("values",e))}this[T]+=t.length,this[f](n,null,t)}}class P extends s{constructor(e,t){super(`Iterator could not decode ${e}`,{code:"LEVEL_DECODE_ERROR",cause:t})}}for(const L of["_ended property","_nexting property","_end method"])Object.defineProperty(x.prototype,L.split(" ")[0],{get(){throw new s(`The ${L} has been removed`,{code:"LEVEL_LEGACY"})},set(){throw new s(`The ${L} has been removed`,{code:"LEVEL_LEGACY"})}});x.keyEncoding=b,x.valueEncoding=v,t.AbstractIterator=x,t.AbstractKeyIterator=N,t.AbstractValueIterator=D},639:function(e,t,n){"use strict";n(7658);const{supports:r}=n(9078),{Transcoder:s}=n(9871),{EventEmitter:i}=n(1528),{fromCallback:o}=n(63),a=n(7368),{AbstractIterator:c}=n(873),{DefaultKeyIterator:l,DefaultValueIterator:u}=n(6094),{DeferredIterator:h,DeferredKeyIterator:d,DeferredValueIterator:p}=n(2879),{DefaultChainedBatch:f}=n(8396),{getCallback:g,getOptions:m}=n(9293),y=n(8418),w=Symbol("promise"),b=Symbol("landed"),v=Symbol("resources"),E=Symbol("closeResources"),_=Symbol("operations"),S=Symbol("undefer"),k=Symbol("deferOpen"),A=Symbol("options"),T=Symbol("status"),C=Symbol("defaultOptions"),I=Symbol("transcoder"),R=Symbol("keyEncoding"),O=Symbol("valueEncoding"),x=()=>{};class N extends i{constructor(e,t){if(super(),"object"!==typeof e||null===e)throw new TypeError("The first argument 'manifest' must be an object");t=m(t);const{keyEncoding:n,valueEncoding:i,passive:o,...a}=t;this[v]=new Set,this[_]=[],this[k]=!0,this[A]=a,this[T]="opening",this.supports=r(e,{status:!0,promises:!0,clear:!0,getMany:!0,deferredOpen:!0,snapshots:!1!==e.snapshots,permanence:!1!==e.permanence,keyIterator:!0,valueIterator:!0,iteratorNextv:!0,iteratorAll:!0,encodings:e.encodings||{},events:Object.assign({},e.events,{opening:!0,open:!0,closing:!0,closed:!0,put:!0,del:!0,batch:!0,clear:!0})}),this[I]=new s(L(this)),this[R]=this[I].encoding(n||"utf8"),this[O]=this[I].encoding(i||"utf8");for(const r of this[I].encodings())this.supports.encodings[r.commonName]||(this.supports.encodings[r.commonName]=!0);this[C]={empty:Object.freeze({}),entry:Object.freeze({keyEncoding:this[R].commonName,valueEncoding:this[O].commonName}),key:Object.freeze({keyEncoding:this[R].commonName})},this.nextTick((()=>{this[k]&&this.open({passive:!1},x)}))}get status(){return this[T]}keyEncoding(e){return this[I].encoding(null!=e?e:this[R])}valueEncoding(e){return this[I].encoding(null!=e?e:this[O])}open(e,t){t=g(e,t),t=o(t,w),e={...this[A],...m(e)},e.createIfMissing=!1!==e.createIfMissing,e.errorIfExists=!!e.errorIfExists;const n=e=>{"closing"===this[T]||"opening"===this[T]?this.once(b,e?()=>n(e):n):"open"!==this[T]?t(new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN",cause:e})):t()};return e.passive?"opening"===this[T]?this.once(b,n):this.nextTick(n):"closed"===this[T]||this[k]?(this[k]=!1,this[T]="opening",this.emit("opening"),this._open(e,(e=>{if(e)return this[T]="closed",this[E]((()=>{this.emit(b),n(e)})),void this[S]();this[T]="open",this[S](),this.emit(b),"open"===this[T]&&this.emit("open"),"open"===this[T]&&this.emit("ready"),n()}))):"open"===this[T]?this.nextTick(n):this.once(b,(()=>this.open(e,t))),t[w]}_open(e,t){this.nextTick(t)}close(e){e=o(e,w);const t=n=>{"opening"===this[T]||"closing"===this[T]?this.once(b,n?t(n):t):"closed"!==this[T]?e(new a("Database is not closed",{code:"LEVEL_DATABASE_NOT_CLOSED",cause:n})):e()};if("open"===this[T]){this[T]="closing",this.emit("closing");const e=e=>{this[T]="open",this[S](),this.emit(b),t(e)};this[E]((()=>{this._close((n=>{if(n)return e(n);this[T]="closed",this[S](),this.emit(b),"closed"===this[T]&&this.emit("closed"),t()}))}))}else"closed"===this[T]?this.nextTick(t):this.once(b,(()=>this.close(e)));return e[w]}[E](e){if(0===this[v].size)return this.nextTick(e);let t=this[v].size,n=!0;const r=()=>{0===--t&&(n?this.nextTick(e):e())};for(const s of this[v])s.close(r);n=!1,this[v].clear()}_close(e){this.nextTick(e)}get(e,t,n){if(n=g(t,n),n=o(n,w),t=m(t,this[C].entry),"opening"===this[T])return this.defer((()=>this.get(e,t,n))),n[w];if(P(this,n))return n[w];const r=this._checkKey(e);if(r)return this.nextTick(n,r),n[w];const s=this.keyEncoding(t.keyEncoding),i=this.valueEncoding(t.valueEncoding),c=s.format,l=i.format;return t.keyEncoding===c&&t.valueEncoding===l||(t=Object.assign({},t,{keyEncoding:c,valueEncoding:l})),this._get(this.prefixKey(s.encode(e),c),t,((e,t)=>{if(e)return("LEVEL_NOT_FOUND"===e.code||e.notFound||/NotFound/i.test(e))&&(e.code||(e.code="LEVEL_NOT_FOUND"),e.notFound||(e.notFound=!0),e.status||(e.status=404)),n(e);try{t=i.decode(t)}catch(e){return n(new a("Could not decode value",{code:"LEVEL_DECODE_ERROR",cause:e}))}n(null,t)})),n[w]}_get(e,t,n){this.nextTick(n,new Error("NotFound"))}getMany(e,t,n){if(n=g(t,n),n=o(n,w),t=m(t,this[C].entry),"opening"===this[T])return this.defer((()=>this.getMany(e,t,n))),n[w];if(P(this,n))return n[w];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'keys' must be an array")),n[w];if(0===e.length)return this.nextTick(n,null,[]),n[w];const r=this.keyEncoding(t.keyEncoding),s=this.valueEncoding(t.valueEncoding),i=r.format,c=s.format;t.keyEncoding===i&&t.valueEncoding===c||(t=Object.assign({},t,{keyEncoding:i,valueEncoding:c}));const l=new Array(e.length);for(let o=0;o<e.length;o++){const t=e[o],s=this._checkKey(t);if(s)return this.nextTick(n,s),n[w];l[o]=this.prefixKey(r.encode(t),i)}return this._getMany(l,t,((e,t)=>{if(e)return n(e);try{for(let e=0;e<t.length;e++)void 0!==t[e]&&(t[e]=s.decode(t[e]))}catch(e){return n(new a(`Could not decode one or more of ${t.length} value(s)`,{code:"LEVEL_DECODE_ERROR",cause:e}))}n(null,t)})),n[w]}_getMany(e,t,n){this.nextTick(n,null,new Array(e.length).fill(void 0))}put(e,t,n,r){if(r=g(n,r),r=o(r,w),n=m(n,this[C].entry),"opening"===this[T])return this.defer((()=>this.put(e,t,n,r))),r[w];if(P(this,r))return r[w];const s=this._checkKey(e)||this._checkValue(t);if(s)return this.nextTick(r,s),r[w];const i=this.keyEncoding(n.keyEncoding),a=this.valueEncoding(n.valueEncoding),c=i.format,l=a.format;n.keyEncoding===c&&n.valueEncoding===l||(n=Object.assign({},n,{keyEncoding:c,valueEncoding:l}));const u=this.prefixKey(i.encode(e),c),h=a.encode(t);return this._put(u,h,n,(n=>{if(n)return r(n);this.emit("put",e,t),r()})),r[w]}_put(e,t,n,r){this.nextTick(r)}del(e,t,n){if(n=g(t,n),n=o(n,w),t=m(t,this[C].key),"opening"===this[T])return this.defer((()=>this.del(e,t,n))),n[w];if(P(this,n))return n[w];const r=this._checkKey(e);if(r)return this.nextTick(n,r),n[w];const s=this.keyEncoding(t.keyEncoding),i=s.format;return t.keyEncoding!==i&&(t=Object.assign({},t,{keyEncoding:i})),this._del(this.prefixKey(s.encode(e),i),t,(t=>{if(t)return n(t);this.emit("del",e),n()})),n[w]}_del(e,t,n){this.nextTick(n)}batch(e,t,n){if(!arguments.length){if("opening"===this[T])return new f(this);if("open"!==this[T])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._chainedBatch()}if(n="function"===typeof e?e:g(t,n),n=o(n,w),t=m(t,this[C].empty),"opening"===this[T])return this.defer((()=>this.batch(e,t,n))),n[w];if(P(this,n))return n[w];if(!Array.isArray(e))return this.nextTick(n,new TypeError("The first argument 'operations' must be an array")),n[w];if(0===e.length)return this.nextTick(n),n[w];const r=new Array(e.length),{keyEncoding:s,valueEncoding:i,...c}=t;for(let o=0;o<e.length;o++){if("object"!==typeof e[o]||null===e[o])return this.nextTick(n,new TypeError("A batch operation must be an object")),n[w];const t=Object.assign({},e[o]);if("put"!==t.type&&"del"!==t.type)return this.nextTick(n,new TypeError("A batch operation must have a type property that is 'put' or 'del'")),n[w];const a=this._checkKey(t.key);if(a)return this.nextTick(n,a),n[w];const c=null!=t.sublevel?t.sublevel:this,l=c.keyEncoding(t.keyEncoding||s),u=l.format;if(t.key=c.prefixKey(l.encode(t.key),u),t.keyEncoding=u,"put"===t.type){const e=this._checkValue(t.value);if(e)return this.nextTick(n,e),n[w];const r=c.valueEncoding(t.valueEncoding||i);t.value=r.encode(t.value),t.valueEncoding=r.format}c!==this&&(t.sublevel=null),r[o]=t}return this._batch(r,c,(t=>{if(t)return n(t);this.emit("batch",e),n()})),n[w]}_batch(e,t,n){this.nextTick(n)}sublevel(e,t){return this._sublevel(e,D.defaults(t))}_sublevel(e,t){return new D(this,e,t)}prefixKey(e,t){return e}clear(e,t){if(t=g(e,t),t=o(t,w),e=m(e,this[C].empty),"opening"===this[T])return this.defer((()=>this.clear(e,t))),t[w];if(P(this,t))return t[w];const n=e,r=this.keyEncoding(e.keyEncoding);return e=y(e,r),e.keyEncoding=r.format,0===e.limit?this.nextTick(t):this._clear(e,(e=>{if(e)return t(e);this.emit("clear",n),t()})),t[w]}_clear(e,t){this.nextTick(t)}iterator(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=y(e,t),e.keys=!1!==e.keys,e.values=!1!==e.values,e[c.keyEncoding]=t,e[c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[T])return new h(this,e);if("open"!==this[T])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._iterator(e)}_iterator(e){return new c(this,e)}keys(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=y(e,t),e[c.keyEncoding]=t,e[c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[T])return new d(this,e);if("open"!==this[T])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._keys(e)}_keys(e){return new l(this,e)}values(e){const t=this.keyEncoding(e&&e.keyEncoding),n=this.valueEncoding(e&&e.valueEncoding);if(e=y(e,t),e[c.keyEncoding]=t,e[c.valueEncoding]=n,e.keyEncoding=t.format,e.valueEncoding=n.format,"opening"===this[T])return new p(this,e);if("open"!==this[T])throw new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"});return this._values(e)}_values(e){return new u(this,e)}defer(e){if("function"!==typeof e)throw new TypeError("The first argument must be a function");this[_].push(e)}[S](){if(0===this[_].length)return;const e=this[_];this[_]=[];for(const t of e)t()}attachResource(e){if("object"!==typeof e||null===e||"function"!==typeof e.close)throw new TypeError("The first argument must be a resource object");this[v].add(e)}detachResource(e){this[v].delete(e)}_chainedBatch(){return new f(this)}_checkKey(e){if(null===e||void 0===e)return new a("Key cannot be null or undefined",{code:"LEVEL_INVALID_KEY"})}_checkValue(e){if(null===e||void 0===e)return new a("Value cannot be null or undefined",{code:"LEVEL_INVALID_VALUE"})}}N.prototype.nextTick=n(6187);const{AbstractSublevel:D}=n(3110)({AbstractLevel:N});t.AbstractLevel=N,t.AbstractSublevel=D;const P=function(e,t){return"open"!==e[T]&&(e.nextTick(t,new a("Database is not open",{code:"LEVEL_DATABASE_NOT_OPEN"})),!0)},L=function(e){return Object.keys(e.supports.encodings).filter((t=>!!e.supports.encodings[t]))}},7013:function(e,t,n){"use strict";t.AbstractLevel=n(639).AbstractLevel,t.AbstractSublevel=n(639).AbstractSublevel,t.AbstractIterator=n(873).AbstractIterator,t.AbstractKeyIterator=n(873).AbstractKeyIterator,t.AbstractValueIterator=n(873).AbstractValueIterator,t.AbstractChainedBatch=n(6551).AbstractChainedBatch},4872:function(e,t,n){"use strict";const{AbstractIterator:r,AbstractKeyIterator:s,AbstractValueIterator:i}=n(873),o=Symbol("unfix"),a=Symbol("iterator"),c=Symbol("handleOne"),l=Symbol("handleMany"),u=Symbol("callback");class h extends r{constructor(e,t,n,r){super(e,t),this[a]=n,this[o]=r,this[c]=this[c].bind(this),this[l]=this[l].bind(this),this[u]=null}[c](e,t,n){const r=this[u];if(e)return r(e);void 0!==t&&(t=this[o](t)),r(e,t,n)}[l](e,t){const n=this[u];if(e)return n(e);for(const r of t){const e=r[0];void 0!==e&&(r[0]=this[o](e))}n(e,t)}}class d extends s{constructor(e,t,n,r){super(e,t),this[a]=n,this[o]=r,this[c]=this[c].bind(this),this[l]=this[l].bind(this),this[u]=null}[c](e,t){const n=this[u];if(e)return n(e);void 0!==t&&(t=this[o](t)),n(e,t)}[l](e,t){const n=this[u];if(e)return n(e);for(let r=0;r<t.length;r++){const e=t[r];void 0!==e&&(t[r]=this[o](e))}n(e,t)}}class p extends i{constructor(e,t,n){super(e,t),this[a]=n}}for(const f of[h,d])f.prototype._next=function(e){this[u]=e,this[a].next(this[c])},f.prototype._nextv=function(e,t,n){this[u]=n,this[a].nextv(e,t,this[l])},f.prototype._all=function(e,t){this[u]=t,this[a].all(e,this[l])};for(const f of[p])f.prototype._next=function(e){this[a].next(e)},f.prototype._nextv=function(e,t,n){this[a].nextv(e,t,n)},f.prototype._all=function(e,t){this[a].all(e,t)};for(const f of[h,d,p])f.prototype._seek=function(e,t){this[a].seek(e,t)},f.prototype._close=function(e){this[a].close(e)};t.AbstractSublevelIterator=h,t.AbstractSublevelKeyIterator=d,t.AbstractSublevelValueIterator=p},3110:function(e,t,n){"use strict";n(3767),n(8585),n(8696);const r=n(7368),{Buffer:s}=n(911)||{},{AbstractSublevelIterator:i,AbstractSublevelKeyIterator:o,AbstractSublevelValueIterator:a}=n(4872),c=Symbol("prefix"),l=Symbol("upperBound"),u=Symbol("prefixRange"),h=Symbol("parent"),d=Symbol("unfix"),p=new TextEncoder,f={separator:"!"};e.exports=function({AbstractLevel:e}){class t extends e{static defaults(e){if("string"===typeof e)throw new r("The subleveldown string shorthand for { separator } has been removed",{code:"LEVEL_LEGACY"});if(e&&e.open)throw new r("The subleveldown open option has been removed",{code:"LEVEL_LEGACY"});return null==e?f:e.separator?e:{...e,separator:"!"}}constructor(e,n,s){const{separator:i,manifest:o,...a}=t.defaults(s);n=b(n,i);const u=i.charCodeAt(0)+1,f=e[h]||e;if(!p.encode(n).every((e=>e>u&&e<127)))throw new r(`Prefix must use bytes > ${u} < 127`,{code:"LEVEL_INVALID_PREFIX"});super(g(f,o),a);const m=(e.prefix||"")+i+n+i,v=m.slice(0,-1)+String.fromCharCode(u);this[h]=f,this[c]=new y(m),this[l]=new y(v),this[d]=new w,this.nextTick=f.nextTick}prefixKey(e,t){if("utf8"===t)return this[c].utf8+e;if(0===e.byteLength)return this[c][t];if("view"===t){const t=this[c].view,n=new Uint8Array(t.byteLength+e.byteLength);return n.set(t,0),n.set(e,t.byteLength),n}{const t=this[c].buffer;return s.concat([t,e],t.byteLength+e.byteLength)}}[u](e,t){void 0!==e.gte?e.gte=this.prefixKey(e.gte,t):void 0!==e.gt?e.gt=this.prefixKey(e.gt,t):e.gte=this[c][t],void 0!==e.lte?e.lte=this.prefixKey(e.lte,t):void 0!==e.lt?e.lt=this.prefixKey(e.lt,t):e.lte=this[l][t]}get prefix(){return this[c].utf8}get db(){return this[h]}_open(e,t){this[h].open({passive:!0},t)}_put(e,t,n,r){this[h].put(e,t,n,r)}_get(e,t,n){this[h].get(e,t,n)}_getMany(e,t,n){this[h].getMany(e,t,n)}_del(e,t,n){this[h].del(e,t,n)}_batch(e,t,n){this[h].batch(e,t,n)}_clear(e,t){this[u](e,e.keyEncoding),this[h].clear(e,t)}_iterator(e){this[u](e,e.keyEncoding);const t=this[h].iterator(e),n=this[d].get(this[c].utf8.length,e.keyEncoding);return new i(this,e,t,n)}_keys(e){this[u](e,e.keyEncoding);const t=this[h].keys(e),n=this[d].get(this[c].utf8.length,e.keyEncoding);return new o(this,e,t,n)}_values(e){this[u](e,e.keyEncoding);const t=this[h].values(e);return new a(this,e,t)}}return{AbstractSublevel:t}};const g=function(e,t){return{...e.supports,createIfMissing:!1,errorIfExists:!1,events:{},additionalMethods:{},...t,encodings:{utf8:m(e,"utf8"),buffer:m(e,"buffer"),view:m(e,"view")}}},m=function(e,t){return!!e.supports.encodings[t]&&e.keyEncoding(t).name===t};class y{constructor(e){this.utf8=e,this.view=p.encode(e),this.buffer=s?s.from(this.view.buffer,0,this.view.byteLength):{}}}class w{constructor(){this.cache=new Map}get(e,t){let n=this.cache.get(t);return void 0===n&&(n="view"===t?function(e,t){return t.subarray(e)}.bind(null,e):function(e,t){return t.slice(e)}.bind(null,e),this.cache.set(t,n)),n}}const b=function(e,t){let n=0,r=e.length;while(n<r&&e[n]===t)n++;while(r>n&&e[r-1]===t)r--;return e.slice(n,r)}},9293:function(e,t){"use strict";t.getCallback=function(e,t){return"function"===typeof e?e:t},t.getOptions=function(e,t){return"object"===typeof e&&null!==e?e:void 0!==t?t:{}}},8396:function(e,t,n){"use strict";n(7658);const{AbstractChainedBatch:r}=n(6551),s=n(7368),i=Symbol("encoded");class o extends r{constructor(e){super(e),this[i]=[]}_put(e,t,n){this[i].push({...n,type:"put",key:e,value:t})}_del(e,t){this[i].push({...t,type:"del",key:e})}_clear(){this[i]=[]}_write(e,t){"opening"===this.db.status?this.db.defer((()=>this._write(e,t))):"open"===this.db.status?0===this[i].length?this.nextTick(t):this.db._batch(this[i],e,t):this.nextTick(t,new s("Batch is not open: cannot call write() after write() or close()",{code:"LEVEL_BATCH_NOT_OPEN"}))}}t.DefaultChainedBatch=o},6094:function(e,t,n){"use strict";const{AbstractKeyIterator:r,AbstractValueIterator:s}=n(873),i=Symbol("iterator"),o=Symbol("callback"),a=Symbol("handleOne"),c=Symbol("handleMany");class l extends r{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!0,values:!1}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}class u extends s{constructor(e,t){super(e,t),this[i]=e.iterator({...t,keys:!1,values:!0}),this[a]=this[a].bind(this),this[c]=this[c].bind(this)}}for(const h of[l,u]){const e=h===l,t=e?e=>e[0]:e=>e[1];h.prototype._next=function(e){this[o]=e,this[i].next(this[a])},h.prototype[a]=function(t,n,r){const s=this[o];t?s(t):s(null,e?n:r)},h.prototype._nextv=function(e,t,n){this[o]=n,this[i].nextv(e,t,this[c])},h.prototype._all=function(e,t){this[o]=t,this[i].all(e,this[c])},h.prototype[c]=function(e,n){const r=this[o];e?r(e):r(null,n.map(t))},h.prototype._seek=function(e,t){this[i].seek(e,t)},h.prototype._close=function(e){this[i].close(e)}}t.DefaultKeyIterator=l,t.DefaultValueIterator=u},2879:function(e,t,n){"use strict";const{AbstractIterator:r,AbstractKeyIterator:s,AbstractValueIterator:i}=n(873),o=n(7368),a=Symbol("nut"),c=Symbol("undefer"),l=Symbol("factory");class u extends r{constructor(e,t){super(e,t),this[a]=null,this[l]=()=>e.iterator(t),this.db.defer((()=>this[c]()))}}class h extends s{constructor(e,t){super(e,t),this[a]=null,this[l]=()=>e.keys(t),this.db.defer((()=>this[c]()))}}class d extends i{constructor(e,t){super(e,t),this[a]=null,this[l]=()=>e.values(t),this.db.defer((()=>this[c]()))}}for(const p of[u,h,d])p.prototype[c]=function(){"open"===this.db.status&&(this[a]=this[l]())},p.prototype._next=function(e){null!==this[a]?this[a].next(e):"opening"===this.db.status?this.db.defer((()=>this._next(e))):this.nextTick(e,new o("Iterator is not open: cannot call next() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},p.prototype._nextv=function(e,t,n){null!==this[a]?this[a].nextv(e,t,n):"opening"===this.db.status?this.db.defer((()=>this._nextv(e,t,n))):this.nextTick(n,new o("Iterator is not open: cannot call nextv() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},p.prototype._all=function(e,t){null!==this[a]?this[a].all(t):"opening"===this.db.status?this.db.defer((()=>this._all(e,t))):this.nextTick(t,new o("Iterator is not open: cannot call all() after close()",{code:"LEVEL_ITERATOR_NOT_OPEN"}))},p.prototype._seek=function(e,t){null!==this[a]?this[a]._seek(e,t):"opening"===this.db.status&&this.db.defer((()=>this._seek(e,t)))},p.prototype._close=function(e){null!==this[a]?this[a].close(e):"opening"===this.db.status?this.db.defer((()=>this._close(e))):this.nextTick(e)};t.DeferredIterator=u,t.DeferredKeyIterator=h,t.DeferredValueIterator=d},6187:function(e,t,n){"use strict";const r=n(6486);e.exports=function(e,...t){0===t.length?r(e):r((()=>e(...t)))}},8418:function(e,t,n){"use strict";const r=n(7368),s=Object.prototype.hasOwnProperty,i=new Set(["lt","lte","gt","gte"]);e.exports=function(e,t){const n={};for(const o in e)if(s.call(e,o)&&"keyEncoding"!==o&&"valueEncoding"!==o){if("start"===o||"end"===o)throw new r(`The legacy range option '${o}' has been removed`,{code:"LEVEL_LEGACY"});if("encoding"===o)throw new r("The levelup-style 'encoding' alias has been removed, use 'valueEncoding' instead",{code:"LEVEL_LEGACY"});i.has(o)?n[o]=t.encode(e[o]):n[o]=e[o]}return n.reverse=!!n.reverse,n.limit=Number.isInteger(n.limit)&&n.limit>=0?n.limit:-1,n}},3162:function(e){function t(e){const t=new globalThis.AbortController;function n(){t.abort();for(const t of e)t&&t.removeEventListener&&t.removeEventListener("abort",n)}for(const r of e)if(r&&r.addEventListener){if(r.aborted){n();break}r.addEventListener("abort",n)}return t.signal}e.exports=t,e.exports.anySignal=t},8384:function(e,t,n){"use strict";n(3767),n(8585),n(8696),n(7658),t.byteLength=u,t.toByteArray=d,t.fromByteArray=g;for(var r=[],s=[],i="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=o.length;a<c;++a)r[a]=o[a],s[o.charCodeAt(a)]=a;function l(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}function u(e){var t=l(e),n=t[0],r=t[1];return 3*(n+r)/4-r}function h(e,t,n){return 3*(t+n)/4-n}function d(e){var t,n,r=l(e),o=r[0],a=r[1],c=new i(h(e,o,a)),u=0,d=a>0?o-4:o;for(n=0;n<d;n+=4)t=s[e.charCodeAt(n)]<<18|s[e.charCodeAt(n+1)]<<12|s[e.charCodeAt(n+2)]<<6|s[e.charCodeAt(n+3)],c[u++]=t>>16&255,c[u++]=t>>8&255,c[u++]=255&t;return 2===a&&(t=s[e.charCodeAt(n)]<<2|s[e.charCodeAt(n+1)]>>4,c[u++]=255&t),1===a&&(t=s[e.charCodeAt(n)]<<10|s[e.charCodeAt(n+1)]<<4|s[e.charCodeAt(n+2)]>>2,c[u++]=t>>8&255,c[u++]=255&t),c}function p(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function f(e,t,n){for(var r,s=[],i=t;i<n;i+=3)r=(e[i]<<16&16711680)+(e[i+1]<<8&65280)+(255&e[i+2]),s.push(p(r));return s.join("")}function g(e){for(var t,n=e.length,s=n%3,i=[],o=16383,a=0,c=n-s;a<c;a+=o)i.push(f(e,a,a+o>c?c:a+o));return 1===s?(t=e[n-1],i.push(r[t>>2]+r[t<<4&63]+"==")):2===s&&(t=(e[n-2]<<8)+e[n-1],i.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"=")),i.join("")}s["-".charCodeAt(0)]=62,s["_".charCodeAt(0)]=63},5101:function(e,t,n){"use strict";n(7658);const r=async e=>{const t=[];for await(const n of e)t.push(n);return t};e.exports=r},1555:function(e){"use strict";const t=async e=>{for await(const t of e);};e.exports=t},2386:function(e){"use strict";const t=async function*(e,t){for await(const n of e)await t(n)&&(yield n)};e.exports=t},4753:function(e){"use strict";const t=async function*(e,t){let n=0;if(!(t<1))for await(const r of e)if(yield r,n++,n===t)return};e.exports=t},2547:function(e,t,n){"use strict";const{AbstractLevel:r}=n(7013),s=n(7368),i=n(8250),{fromCallback:o}=n(63),{Iterator:a}=n(1092),c=n(852),l=n(4757),u=n(4934),h="level-js-",d=Symbol("idb"),p=Symbol("namePrefix"),f=Symbol("location"),g=Symbol("version"),m=Symbol("store"),y=Symbol("onComplete"),w=Symbol("promise");class b extends r{constructor(e,t,n){if("function"===typeof t||"function"===typeof n)throw new s("The levelup-style callback argument has been removed",{code:"LEVEL_LEGACY"});const{prefix:r,version:i,...o}=t||{};if(super({encodings:{view:!0},snapshots:!1,createIfMissing:!1,errorIfExists:!1,seek:!0},o),"string"!==typeof e)throw new Error("constructor requires a location string argument");this[f]=e,this[p]=null==r?h:r,this[g]=parseInt(i||1,10),this[d]=null}get location(){return this[f]}get namePrefix(){return this[p]}get version(){return this[g]}get db(){return this[d]}get type(){return"browser-level"}_open(e,t){const n=indexedDB.open(this[p]+this[f],this[g]);n.onerror=function(){t(n.error||new Error("unknown error"))},n.onsuccess=()=>{this[d]=n.result,t()},n.onupgradeneeded=e=>{const t=e.target.result;t.objectStoreNames.contains(this[f])||t.createObjectStore(this[f])}}[m](e){const t=this[d].transaction([this[f]],e);return t.objectStore(this[f])}[y](e,t){const n=e.transaction;n.onabort=function(){t(n.error||new Error("aborted by user"))},n.oncomplete=function(){t(null,e.result)}}_get(e,t,n){const r=this[m]("readonly");let i;try{i=r.get(e)}catch(o){return this.nextTick(n,o)}this[y](i,(function(e,t){return e?n(e):void 0===t?n(new s("Entry not found",{code:"LEVEL_NOT_FOUND"})):void n(null,c(t))}))}_getMany(e,t,n){const r=this[m]("readonly"),s=e.map((e=>t=>{let n;try{n=r.get(e)}catch(s){return t(s)}n.onsuccess=()=>{const e=n.result;t(null,void 0===e?e:c(e))},n.onerror=e=>{e.stopPropagation(),t(n.error)}}));i(s,16,n)}_del(e,t,n){const r=this[m]("readwrite");let s;try{s=r.delete(e)}catch(i){return this.nextTick(n,i)}this[y](s,n)}_put(e,t,n,r){const s=this[m]("readwrite");let i;try{i=s.put(t,e)}catch(o){return this.nextTick(r,o)}this[y](i,r)}_iterator(e){return new a(this,this[f],e)}_batch(e,t,n){const r=this[m]("readwrite"),s=r.transaction;let i,o=0;function a(){const t=e[o++],n=t.key;let c;try{c="del"===t.type?r.delete(n):r.put(t.value,n)}catch(l){return i=l,void s.abort()}o<e.length?c.onsuccess=a:"function"===typeof s.commit&&s.commit()}s.onabort=function(){n(i||s.error||new Error("aborted by user"))},s.oncomplete=function(){n()},a()}_clear(e,t){let n,r;try{n=u(e)}catch(s){return this.nextTick(t)}if(e.limit>=0)return l(this,this[f],n,e,t);try{const e=this[m]("readwrite");r=n?e.delete(n):e.clear()}catch(i){return this.nextTick(t,i)}this[y](r,t)}_close(e){this[d].close(),this.nextTick(e)}}b.destroy=function(e,t,n){"function"===typeof t&&(n=t,t=h),n=o(n,w);const r=indexedDB.deleteDatabase(t+e);return r.onsuccess=function(){n()},r.onerror=function(e){n(e)},n[w]},t.BrowserLevel=b},1092:function(e,t,n){"use strict";n(7658);const{AbstractIterator:r}=n(7013),s=n(4934),i=n(852),o=Symbol("cache"),a=Symbol("finished"),c=Symbol("options"),l=Symbol("currentOptions"),u=Symbol("position"),h=Symbol("location"),d=Symbol("first"),p={};class f extends r{constructor(e,t,n){super(e,n),this[o]=[],this[a]=0===this.limit,this[c]=n,this[l]={...n},this[u]=void 0,this[h]=t,this[d]=!0}_nextv(e,t,n){if(this[d]=!1,this[a])return this.nextTick(n,null,[]);if(this[o].length>0)return e=Math.min(e,this[o].length),this.nextTick(n,null,this[o].splice(0,e));let r;void 0!==this[u]&&(this[c].reverse?(this[l].lt=this[u],this[l].lte=void 0):(this[l].gt=this[u],this[l].gte=void 0));try{r=s(this[l])}catch(y){return this[a]=!0,this.nextTick(n,null,[])}const p=this.db.db.transaction([this[h]],"readonly"),f=p.objectStore(this[h]),m=[];if(this[c].reverse){const t=!this[c].values&&f.openKeyCursor?"openKeyCursor":"openCursor";f[t](r,"prev").onsuccess=t=>{const n=t.target.result;if(n){const{key:t,value:r}=n;this[u]=t,m.push([this[c].keys&&void 0!==t?i(t):void 0,this[c].values&&void 0!==r?i(r):void 0]),m.length<e?n.continue():g(p)}else this[a]=!0}}else{let t,n;const s=()=>{if(void 0===t||void 0===n)return;const r=Math.max(t.length,n.length);0===r||e===1/0?this[a]=!0:this[u]=t[r-1],m.length=r;for(let e=0;e<r;e++){const r=t[e],s=n[e];m[e]=[this[c].keys&&void 0!==r?i(r):void 0,this[c].values&&void 0!==s?i(s):void 0]}g(p)};this[c].keys||e<1/0?f.getAllKeys(r,e<1/0?e:void 0).onsuccess=e=>{t=e.target.result,s()}:(t=[],this.nextTick(s)),this[c].values?f.getAll(r,e<1/0?e:void 0).onsuccess=e=>{n=e.target.result,s()}:(n=[],this.nextTick(s))}p.onabort=()=>{n(p.error||new Error("aborted by user")),n=null},p.oncomplete=()=>{n(null,m),n=null}}_next(e){if(this[o].length>0){const[t,n]=this[o].shift();this.nextTick(e,null,t,n)}else if(this[a])this.nextTick(e);else{let t=Math.min(100,this.limit-this.count);this[d]&&(this[d]=!1,t=1),this._nextv(t,p,((t,n)=>{if(t)return e(t);this[o]=n,this._next(e)}))}}_all(e,t){this[d]=!1;const n=this[o].splice(0,this[o].length),r=this.limit-this.count-n.length;if(r<=0)return this.nextTick(t,null,n);this._nextv(r,p,((e,r)=>{if(e)return t(e);n.length>0&&(r=n.concat(r)),t(null,r)}))}_seek(e,t){let n;this[d]=!0,this[o]=[],this[a]=!1,this[u]=void 0,this[l]={...this[c]};try{n=s(this[c])}catch(r){return void(this[a]=!0)}null===n||n.includes(e)?this[c].reverse?this[l].lte=e:this[l].gte=e:this[a]=!0}}function g(e){"function"===typeof e.commit&&e.commit()}t.Iterator=f},4757:function(e){"use strict";e.exports=function(e,t,n,r,s){if(0===r.limit)return e.nextTick(s);const i=e.db.transaction([t],"readwrite"),o=i.objectStore(t);let a=0;i.oncomplete=function(){s()},i.onabort=function(){s(i.error||new Error("aborted by user"))};const c=o.openKeyCursor?"openKeyCursor":"openCursor",l=r.reverse?"prev":"next";o[c](n,l).onsuccess=function(e){const t=e.target.result;t&&(o.delete(t.key).onsuccess=function(){(r.limit<=0||++a<r.limit)&&t.continue()})}}},852:function(e,t,n){"use strict";n(3767),n(8585),n(8696);const r=new TextEncoder;e.exports=function(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):r.encode(e)}},4934:function(e){"use strict";e.exports=function(e){const t=void 0!==e.gte?e.gte:void 0!==e.gt?e.gt:void 0,n=void 0!==e.lte?e.lte:void 0!==e.lt?e.lt:void 0,r=void 0===e.gte,s=void 0===e.lte;return void 0!==t&&void 0!==n?IDBKeyRange.bound(t,n,r,s):void 0!==t?IDBKeyRange.lowerBound(t,r):void 0!==n?IDBKeyRange.upperBound(n,s):null}},911:function(e,t,n){"use strict";
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */n(3767),n(8585),n(8696),n(7658);const r=n(8384),s=n(4237),i="function"===typeof Symbol&&"function"===typeof Symbol["for"]?Symbol["for"]("nodejs.util.inspect.custom"):null;t.Buffer=l,t.SlowBuffer=v,t.INSPECT_MAX_BYTES=50;const o=2147483647;function a(){try{const e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(e){return!1}}function c(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');const t=new Uint8Array(e);return Object.setPrototypeOf(t,l.prototype),t}function l(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return p(e)}return u(e,t,n)}function u(e,t,n){if("string"===typeof e)return f(e,t);if(ArrayBuffer.isView(e))return m(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(oe(e,ArrayBuffer)||e&&oe(e.buffer,ArrayBuffer))return y(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(oe(e,SharedArrayBuffer)||e&&oe(e.buffer,SharedArrayBuffer)))return y(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');const r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return l.from(r,t,n);const s=w(e);if(s)return s;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return l.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function h(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function d(e,t,n){return h(e),e<=0?c(e):void 0!==t?"string"===typeof n?c(e).fill(t,n):c(e).fill(t):c(e)}function p(e){return h(e),c(e<0?0:0|b(e))}function f(e,t){if("string"===typeof t&&""!==t||(t="utf8"),!l.isEncoding(t))throw new TypeError("Unknown encoding: "+t);const n=0|E(e,t);let r=c(n);const s=r.write(e,t);return s!==n&&(r=r.slice(0,s)),r}function g(e){const t=e.length<0?0:0|b(e.length),n=c(t);for(let r=0;r<t;r+=1)n[r]=255&e[r];return n}function m(e){if(oe(e,Uint8Array)){const t=new Uint8Array(e);return y(t.buffer,t.byteOffset,t.byteLength)}return g(e)}function y(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');let r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,l.prototype),r}function w(e){if(l.isBuffer(e)){const t=0|b(e.length),n=c(t);return 0===n.length||e.copy(n,0,0,t),n}return void 0!==e.length?"number"!==typeof e.length||ae(e.length)?c(0):g(e):"Buffer"===e.type&&Array.isArray(e.data)?g(e.data):void 0}function b(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function v(e){return+e!=e&&(e=0),l.alloc(+e)}function E(e,t){if(l.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||oe(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);const n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;let s=!1;for(;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return te(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return se(e).length;default:if(s)return r?-1:te(e).length;t=(""+t).toLowerCase(),s=!0}}function _(e,t,n){let r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if(n>>>=0,t>>>=0,n<=t)return"";e||(e="utf8");while(1)switch(e){case"hex":return B(this,t,n);case"utf8":case"utf-8":return N(this,t,n);case"ascii":return L(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return x(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return U(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function S(e,t,n){const r=e[t];e[t]=e[n],e[n]=r}function k(e,t,n,r,s){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,ae(n)&&(n=s?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(s)return-1;n=e.length-1}else if(n<0){if(!s)return-1;n=0}if("string"===typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:A(e,t,n,r,s);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?s?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):A(e,[t],n,r,s);throw new TypeError("val must be string, number or Buffer")}function A(e,t,n,r,s){let i,o=1,a=e.length,c=t.length;if(void 0!==r&&(r=String(r).toLowerCase(),"ucs2"===r||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,a/=2,c/=2,n/=2}function l(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(s){let r=-1;for(i=n;i<a;i++)if(l(e,i)===l(t,-1===r?0:i-r)){if(-1===r&&(r=i),i-r+1===c)return r*o}else-1!==r&&(i-=i-r),r=-1}else for(n+c>a&&(n=a-c),i=n;i>=0;i--){let n=!0;for(let r=0;r<c;r++)if(l(e,i+r)!==l(t,r)){n=!1;break}if(n)return i}return-1}function T(e,t,n,r){n=Number(n)||0;const s=e.length-n;r?(r=Number(r),r>s&&(r=s)):r=s;const i=t.length;let o;for(r>i/2&&(r=i/2),o=0;o<r;++o){const r=parseInt(t.substr(2*o,2),16);if(ae(r))return o;e[n+o]=r}return o}function C(e,t,n,r){return ie(te(t,e.length-n),e,n,r)}function I(e,t,n,r){return ie(ne(t),e,n,r)}function R(e,t,n,r){return ie(se(t),e,n,r)}function O(e,t,n,r){return ie(re(t,e.length-n),e,n,r)}function x(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function N(e,t,n){n=Math.min(e.length,n);const r=[];let s=t;while(s<n){const t=e[s];let i=null,o=t>239?4:t>223?3:t>191?2:1;if(s+o<=n){let n,r,a,c;switch(o){case 1:t<128&&(i=t);break;case 2:n=e[s+1],128===(192&n)&&(c=(31&t)<<6|63&n,c>127&&(i=c));break;case 3:n=e[s+1],r=e[s+2],128===(192&n)&&128===(192&r)&&(c=(15&t)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:n=e[s+1],r=e[s+2],a=e[s+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&t)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),s+=o}return P(r)}t.kMaxLength=o,l.TYPED_ARRAY_SUPPORT=a(),l.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(l.prototype,"parent",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.buffer}}),Object.defineProperty(l.prototype,"offset",{enumerable:!0,get:function(){if(l.isBuffer(this))return this.byteOffset}}),l.poolSize=8192,l.from=function(e,t,n){return u(e,t,n)},Object.setPrototypeOf(l.prototype,Uint8Array.prototype),Object.setPrototypeOf(l,Uint8Array),l.alloc=function(e,t,n){return d(e,t,n)},l.allocUnsafe=function(e){return p(e)},l.allocUnsafeSlow=function(e){return p(e)},l.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==l.prototype},l.compare=function(e,t){if(oe(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),oe(t,Uint8Array)&&(t=l.from(t,t.offset,t.byteLength)),!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;let n=e.length,r=t.length;for(let s=0,i=Math.min(n,r);s<i;++s)if(e[s]!==t[s]){n=e[s],r=t[s];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);let n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;const r=l.allocUnsafe(t);let s=0;for(n=0;n<e.length;++n){let t=e[n];if(oe(t,Uint8Array))s+t.length>r.length?(l.isBuffer(t)||(t=l.from(t)),t.copy(r,s)):Uint8Array.prototype.set.call(r,t,s);else{if(!l.isBuffer(t))throw new TypeError('"list" argument must be an Array of Buffers');t.copy(r,s)}s+=t.length}return r},l.byteLength=E,l.prototype._isBuffer=!0,l.prototype.swap16=function(){const e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let t=0;t<e;t+=2)S(this,t,t+1);return this},l.prototype.swap32=function(){const e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let t=0;t<e;t+=4)S(this,t,t+3),S(this,t+1,t+2);return this},l.prototype.swap64=function(){const e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let t=0;t<e;t+=8)S(this,t,t+7),S(this,t+1,t+6),S(this,t+2,t+5),S(this,t+3,t+4);return this},l.prototype.toString=function(){const e=this.length;return 0===e?"":0===arguments.length?N(this,0,e):_.apply(this,arguments)},l.prototype.toLocaleString=l.prototype.toString,l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){let e="";const n=t.INSPECT_MAX_BYTES;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},i&&(l.prototype[i]=l.prototype.inspect),l.prototype.compare=function(e,t,n,r,s){if(oe(e,Uint8Array)&&(e=l.from(e,e.offset,e.byteLength)),!l.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===s&&(s=this.length),t<0||n>e.length||r<0||s>this.length)throw new RangeError("out of range index");if(r>=s&&t>=n)return 0;if(r>=s)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,r>>>=0,s>>>=0,this===e)return 0;let i=s-r,o=n-t;const a=Math.min(i,o),c=this.slice(r,s),u=e.slice(t,n);for(let l=0;l<a;++l)if(c[l]!==u[l]){i=c[l],o=u[l];break}return i<o?-1:o<i?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return k(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return k(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}const s=this.length-t;if((void 0===n||n>s)&&(n=s),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");let i=!1;for(;;)switch(r){case"hex":return T(this,e,t,n);case"utf8":case"utf-8":return C(this,e,t,n);case"ascii":case"latin1":case"binary":return I(this,e,t,n);case"base64":return R(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};const D=4096;function P(e){const t=e.length;if(t<=D)return String.fromCharCode.apply(String,e);let n="",r=0;while(r<t)n+=String.fromCharCode.apply(String,e.slice(r,r+=D));return n}function L(e,t,n){let r="";n=Math.min(e.length,n);for(let s=t;s<n;++s)r+=String.fromCharCode(127&e[s]);return r}function M(e,t,n){let r="";n=Math.min(e.length,n);for(let s=t;s<n;++s)r+=String.fromCharCode(e[s]);return r}function B(e,t,n){const r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);let s="";for(let i=t;i<n;++i)s+=ce[e[i]];return s}function U(e,t,n){const r=e.slice(t,n);let s="";for(let i=0;i<r.length-1;i+=2)s+=String.fromCharCode(r[i]+256*r[i+1]);return s}function V(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function F(e,t,n,r,s,i){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>s||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function j(e,t,n,r,s){J(t,r,s,e,n,7);let i=Number(t&BigInt(4294967295));e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i,i>>=8,e[n++]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,o>>=8,e[n++]=o,n}function z(e,t,n,r,s){J(t,r,s,e,n,7);let i=Number(t&BigInt(4294967295));e[n+7]=i,i>>=8,e[n+6]=i,i>>=8,e[n+5]=i,i>>=8,e[n+4]=i;let o=Number(t>>BigInt(32)&BigInt(4294967295));return e[n+3]=o,o>>=8,e[n+2]=o,o>>=8,e[n+1]=o,o>>=8,e[n]=o,n+8}function $(e,t,n,r,s,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function H(e,t,n,r,i){return t=+t,n>>>=0,i||$(e,t,n,4,34028234663852886e22,-34028234663852886e22),s.write(e,t,n,r,23,4),n+4}function K(e,t,n,r,i){return t=+t,n>>>=0,i||$(e,t,n,8,17976931348623157e292,-17976931348623157e292),s.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){const n=this.length;e=~~e,t=void 0===t?n:~~t,e<0?(e+=n,e<0&&(e=0)):e>n&&(e=n),t<0?(t+=n,t<0&&(t=0)):t>n&&(t=n),t<e&&(t=e);const r=this.subarray(e,t);return Object.setPrototypeOf(r,l.prototype),r},l.prototype.readUintLE=l.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||V(e,t,this.length);let r=this[e],s=1,i=0;while(++i<t&&(s*=256))r+=this[e+i]*s;return r},l.prototype.readUintBE=l.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||V(e,t,this.length);let r=this[e+--t],s=1;while(t>0&&(s*=256))r+=this[e+--t]*s;return r},l.prototype.readUint8=l.prototype.readUInt8=function(e,t){return e>>>=0,t||V(e,1,this.length),this[e]},l.prototype.readUint16LE=l.prototype.readUInt16LE=function(e,t){return e>>>=0,t||V(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUint16BE=l.prototype.readUInt16BE=function(e,t){return e>>>=0,t||V(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUint32LE=l.prototype.readUInt32LE=function(e,t){return e>>>=0,t||V(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUint32BE=l.prototype.readUInt32BE=function(e,t){return e>>>=0,t||V(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readBigUInt64LE=le((function(e){e>>>=0,Q(e,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||X(e,this.length-8);const r=t+256*this[++e]+65536*this[++e]+this[++e]*2**24,s=this[++e]+256*this[++e]+65536*this[++e]+n*2**24;return BigInt(r)+(BigInt(s)<<BigInt(32))})),l.prototype.readBigUInt64BE=le((function(e){e>>>=0,Q(e,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||X(e,this.length-8);const r=t*2**24+65536*this[++e]+256*this[++e]+this[++e],s=this[++e]*2**24+65536*this[++e]+256*this[++e]+n;return(BigInt(r)<<BigInt(32))+BigInt(s)})),l.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||V(e,t,this.length);let r=this[e],s=1,i=0;while(++i<t&&(s*=256))r+=this[e+i]*s;return s*=128,r>=s&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||V(e,t,this.length);let r=t,s=1,i=this[e+--r];while(r>0&&(s*=256))i+=this[e+--r]*s;return s*=128,i>=s&&(i-=Math.pow(2,8*t)),i},l.prototype.readInt8=function(e,t){return e>>>=0,t||V(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){e>>>=0,t||V(e,2,this.length);const n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){e>>>=0,t||V(e,2,this.length);const n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return e>>>=0,t||V(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return e>>>=0,t||V(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readBigInt64LE=le((function(e){e>>>=0,Q(e,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||X(e,this.length-8);const r=this[e+4]+256*this[e+5]+65536*this[e+6]+(n<<24);return(BigInt(r)<<BigInt(32))+BigInt(t+256*this[++e]+65536*this[++e]+this[++e]*2**24)})),l.prototype.readBigInt64BE=le((function(e){e>>>=0,Q(e,"offset");const t=this[e],n=this[e+7];void 0!==t&&void 0!==n||X(e,this.length-8);const r=(t<<24)+65536*this[++e]+256*this[++e]+this[++e];return(BigInt(r)<<BigInt(32))+BigInt(this[++e]*2**24+65536*this[++e]+256*this[++e]+n)})),l.prototype.readFloatLE=function(e,t){return e>>>=0,t||V(e,4,this.length),s.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return e>>>=0,t||V(e,4,this.length),s.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return e>>>=0,t||V(e,8,this.length),s.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return e>>>=0,t||V(e,8,this.length),s.read(this,e,!1,52,8)},l.prototype.writeUintLE=l.prototype.writeUIntLE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){const r=Math.pow(2,8*n)-1;F(this,e,t,n,r,0)}let s=1,i=0;this[t]=255&e;while(++i<n&&(s*=256))this[t+i]=e/s&255;return t+n},l.prototype.writeUintBE=l.prototype.writeUIntBE=function(e,t,n,r){if(e=+e,t>>>=0,n>>>=0,!r){const r=Math.pow(2,8*n)-1;F(this,e,t,n,r,0)}let s=n-1,i=1;this[t+s]=255&e;while(--s>=0&&(i*=256))this[t+s]=e/i&255;return t+n},l.prototype.writeUint8=l.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,1,255,0),this[t]=255&e,t+1},l.prototype.writeUint16LE=l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeUint16BE=l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeUint32LE=l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},l.prototype.writeUint32BE=l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigUInt64LE=le((function(e,t=0){return j(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeBigUInt64BE=le((function(e,t=0){return z(this,e,t,BigInt(0),BigInt("0xffffffffffffffff"))})),l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);F(this,e,t,n,r-1,-r)}let s=0,i=1,o=0;this[t]=255&e;while(++s<n&&(i*=256))e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){const r=Math.pow(2,8*n-1);F(this,e,t,n,r-1,-r)}let s=n-1,i=1,o=0;this[t+s]=255&e;while(--s>=0&&(i*=256))e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/i>>0)-o&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||F(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},l.prototype.writeBigInt64LE=le((function(e,t=0){return j(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeBigInt64BE=le((function(e,t=0){return z(this,e,t,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))})),l.prototype.writeFloatLE=function(e,t,n){return H(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return H(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return K(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return K(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(!l.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);const s=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),s},l.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){const t=e.charCodeAt(0);("utf8"===r&&t<128||"latin1"===r)&&(e=t)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;let s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(s=t;s<n;++s)this[s]=e;else{const i=l.isBuffer(e)?e:l.from(e,r),o=i.length;if(0===o)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(s=0;s<n-t;++s)this[s+t]=i[s%o]}return this};const q={};function G(e,t,n){q[e]=class extends n{constructor(){super(),Object.defineProperty(this,"message",{value:t.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${e}]`,this.stack,delete this.name}get code(){return e}set code(e){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:e,writable:!0})}toString(){return`${this.name} [${e}]: ${this.message}`}}}function W(e){let t="",n=e.length;const r="-"===e[0]?1:0;for(;n>=r+4;n-=3)t=`_${e.slice(n-3,n)}${t}`;return`${e.slice(0,n)}${t}`}function Y(e,t,n){Q(t,"offset"),void 0!==e[t]&&void 0!==e[t+n]||X(t,e.length-(n+1))}function J(e,t,n,r,s,i){if(e>n||e<t){const r="bigint"===typeof t?"n":"";let s;throw s=i>3?0===t||t===BigInt(0)?`>= 0${r} and < 2${r} ** ${8*(i+1)}${r}`:`>= -(2${r} ** ${8*(i+1)-1}${r}) and < 2 ** ${8*(i+1)-1}${r}`:`>= ${t}${r} and <= ${n}${r}`,new q.ERR_OUT_OF_RANGE("value",s,e)}Y(r,s,i)}function Q(e,t){if("number"!==typeof e)throw new q.ERR_INVALID_ARG_TYPE(t,"number",e)}function X(e,t,n){if(Math.floor(e)!==e)throw Q(e,n),new q.ERR_OUT_OF_RANGE(n||"offset","an integer",e);if(t<0)throw new q.ERR_BUFFER_OUT_OF_BOUNDS;throw new q.ERR_OUT_OF_RANGE(n||"offset",`>= ${n?1:0} and <= ${t}`,e)}G("ERR_BUFFER_OUT_OF_BOUNDS",(function(e){return e?`${e} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"}),RangeError),G("ERR_INVALID_ARG_TYPE",(function(e,t){return`The "${e}" argument must be of type number. Received type ${typeof t}`}),TypeError),G("ERR_OUT_OF_RANGE",(function(e,t,n){let r=`The value of "${e}" is out of range.`,s=n;return Number.isInteger(n)&&Math.abs(n)>2**32?s=W(String(n)):"bigint"===typeof n&&(s=String(n),(n>BigInt(2)**BigInt(32)||n<-(BigInt(2)**BigInt(32)))&&(s=W(s)),s+="n"),r+=` It must be ${t}. Received ${s}`,r}),RangeError);const Z=/[^+/0-9A-Za-z-_]/g;function ee(e){if(e=e.split("=")[0],e=e.trim().replace(Z,""),e.length<2)return"";while(e.length%4!==0)e+="=";return e}function te(e,t){let n;t=t||1/0;const r=e.length;let s=null;const i=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!s){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}s=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function ne(e){const t=[];for(let n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function re(e,t){let n,r,s;const i=[];for(let o=0;o<e.length;++o){if((t-=2)<0)break;n=e.charCodeAt(o),r=n>>8,s=n%256,i.push(s),i.push(r)}return i}function se(e){return r.toByteArray(ee(e))}function ie(e,t,n,r){let s;for(s=0;s<r;++s){if(s+n>=t.length||s>=e.length)break;t[s+n]=e[s]}return s}function oe(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function ae(e){return e!==e}const ce=function(){const e="0123456789abcdef",t=new Array(256);for(let n=0;n<16;++n){const r=16*n;for(let s=0;s<16;++s)t[r+s]=e[n]+e[s]}return t}();function le(e){return"undefined"===typeof BigInt?ue:e}function ue(){throw new Error("BigInt not supported")}},9149:function(e){"use strict";
/*!
 * bytes
 * Copyright(c) 2012-2014 TJ Holowaychuk
 * Copyright(c) 2015 Jed Watson
 * MIT Licensed
 */e.exports=i,e.exports.format=o,e.exports.parse=a;var t=/\B(?=(\d{3})+(?!\d))/g,n=/(?:\.0*|(\.[^0]+)0+)$/,r={b:1,kb:1024,mb:1<<20,gb:1<<30,tb:Math.pow(1024,4),pb:Math.pow(1024,5)},s=/^((-|\+)?(\d+(?:\.\d+)?)) *(kb|mb|gb|tb|pb)$/i;function i(e,t){return"string"===typeof e?a(e):"number"===typeof e?o(e,t):null}function o(e,s){if(!Number.isFinite(e))return null;var i=Math.abs(e),o=s&&s.thousandsSeparator||"",a=s&&s.unitSeparator||"",c=s&&void 0!==s.decimalPlaces?s.decimalPlaces:2,l=Boolean(s&&s.fixedDecimals),u=s&&s.unit||"";u&&r[u.toLowerCase()]||(u=i>=r.pb?"PB":i>=r.tb?"TB":i>=r.gb?"GB":i>=r.mb?"MB":i>=r.kb?"KB":"B");var h=e/r[u.toLowerCase()],d=h.toFixed(c);return l||(d=d.replace(n,"$1")),o&&(d=d.split(".").map((function(e,n){return 0===n?e.replace(t,o):e})).join(".")),d+a+u}function a(e){if("number"===typeof e&&!isNaN(e))return e;if("string"!==typeof e)return null;var t,n=s.exec(e),i="b";return n?(t=parseFloat(n[1]),i=n[4].toLowerCase()):(t=parseInt(e,10),i="b"),isNaN(t)?null:Math.floor(r[i]*t)}},63:function(e,t,n){"use strict";var r=n(7609);t.fromCallback=function(e,t){if(void 0===e){var n=new Promise((function(t,n){e=function(e,r){e?n(e):t(r)}}));e[void 0!==t?t:"promise"]=n}else if("function"!==typeof e)throw new TypeError("Callback must be a function");return e},t.fromPromise=function(e,t){if(void 0===t)return e;e.then((function(e){r((()=>t(null,e)))})).catch((function(e){r((()=>t(e)))}))}},7609:function(e){e.exports="function"===typeof queueMicrotask?queueMicrotask:e=>Promise.resolve().then(e)},2978:function(e,t,n){function r(){return!("undefined"===typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"===typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))}function s(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,s=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(s=r))})),t.splice(s,0,n)}function i(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(n){}}function o(){let e;try{e=t.storage.getItem("debug")}catch(n){}return!e&&"undefined"!==typeof process&&"env"in process&&(e={NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}.DEBUG),e}function a(){try{return localStorage}catch(e){}}t.formatArgs=s,t.save=i,t.load=o,t.useColors=r,t.storage=a(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(882)(t);const{formatters:c}=e.exports;c.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},882:function(e,t,n){function r(e){function t(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return r.colors[Math.abs(t)%r.colors.length]}function r(e){let t,n,i,o=null;function a(...e){if(!a.enabled)return;const n=a,s=Number(new Date),i=s-(t||s);n.diff=i,n.prev=t,n.curr=s,t=s,e[0]=r.coerce(e[0]),"string"!==typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((t,s)=>{if("%%"===t)return"%";o++;const i=r.formatters[s];if("function"===typeof i){const r=e[o];t=i.call(n,r),e.splice(o,1),o--}return t})),r.formatArgs.call(n,e);const c=n.log||r.log;c.apply(n,e)}return a.namespace=e,a.useColors=r.useColors(),a.color=r.selectColor(e),a.extend=s,a.destroy=r.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(n!==r.namespaces&&(n=r.namespaces,i=r.enabled(e)),i),set:e=>{o=e}}),"function"===typeof r.init&&r.init(a),a}function s(e,t){const n=r(this.namespace+("undefined"===typeof t?":":t)+e);return n.log=this.log,n}function i(e){let t;r.save(e),r.namespaces=e,r.names=[],r.skips=[];const n=("string"===typeof e?e:"").split(/[\s,]+/),s=n.length;for(t=0;t<s;t++)n[t]&&(e=n[t].replace(/\*/g,".*?"),"-"===e[0]?r.skips.push(new RegExp("^"+e.slice(1)+"$")):r.names.push(new RegExp("^"+e+"$")))}function o(){const e=[...r.names.map(c),...r.skips.map(c).map((e=>"-"+e))].join(",");return r.enable(""),e}function a(e){if("*"===e[e.length-1])return!0;let t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1}function c(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}function l(e){return e instanceof Error?e.stack||e.message:e}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return r.debug=r,r.default=r,r.coerce=l,r.disable=o,r.enable=i,r.enabled=a,r.humanize=n(8806),r.destroy=u,Object.keys(e).forEach((t=>{r[t]=e[t]})),r.names=[],r.skips=[],r.formatters={},r.selectColor=t,r.enable(r.load()),r}n(541),n(7658),e.exports=r},6190:function(e){"use strict";const t=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),n=()=>{const e=new Error("Delay aborted");return e.name="AbortError",e},r=({clearTimeout:e,setTimeout:t,willResolve:r})=>(s,{value:i,signal:o}={})=>{if(o&&o.aborted)return Promise.reject(n());let a,c,l;const u=e||clearTimeout,h=()=>{u(a),l(n())},d=()=>{o&&o.removeEventListener("abort",h)},p=new Promise(((e,n)=>{c=()=>{d(),r?e(i):n(i)},l=n,a=(t||setTimeout)(c,s)}));return o&&o.addEventListener("abort",h,{once:!0}),p.clear=()=>{u(a),a=null,c()},p},s=e=>{const n=r({...e,willResolve:!0});return n.reject=r({...e,willResolve:!1}),n.range=(e,r,s)=>n(t(e,r),s),n},i=s();i.createWithTimers=s,e.exports=i,e.exports["default"]=i},7051:function(e,t,n){"use strict";function r(e,t){t=t||{};this._head=0,this._tail=0,this._capacity=t.capacity,this._capacityMask=3,this._list=new Array(4),Array.isArray(e)&&this._fromArray(e)}n(541),n(7658),r.prototype.peekAt=function(e){var t=e;if(t===(0|t)){var n=this.size();if(!(t>=n||t<-n))return t<0&&(t+=n),t=this._head+t&this._capacityMask,this._list[t]}},r.prototype.get=function(e){return this.peekAt(e)},r.prototype.peek=function(){if(this._head!==this._tail)return this._list[this._head]},r.prototype.peekFront=function(){return this.peek()},r.prototype.peekBack=function(){return this.peekAt(-1)},Object.defineProperty(r.prototype,"length",{get:function(){return this.size()}}),r.prototype.size=function(){return this._head===this._tail?0:this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.unshift=function(e){if(void 0===e)return this.size();var t=this._list.length;return this._head=this._head-1+t&this._capacityMask,this._list[this._head]=e,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.pop(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.shift=function(){var e=this._head;if(e!==this._tail){var t=this._list[e];return this._list[e]=void 0,this._head=e+1&this._capacityMask,e<2&&this._tail>1e4&&this._tail<=this._list.length>>>2&&this._shrinkArray(),t}},r.prototype.push=function(e){if(void 0===e)return this.size();var t=this._tail;return this._list[t]=e,this._tail=t+1&this._capacityMask,this._tail===this._head&&this._growArray(),this._capacity&&this.size()>this._capacity&&this.shift(),this._head<this._tail?this._tail-this._head:this._capacityMask+1-(this._head-this._tail)},r.prototype.pop=function(){var e=this._tail;if(e!==this._head){var t=this._list.length;this._tail=e-1+t&this._capacityMask;var n=this._list[this._tail];return this._list[this._tail]=void 0,this._head<2&&e>1e4&&e<=t>>>2&&this._shrinkArray(),n}},r.prototype.removeOne=function(e){var t=e;if(t===(0|t)&&this._head!==this._tail){var n=this.size(),r=this._list.length;if(!(t>=n||t<-n)){t<0&&(t+=n),t=this._head+t&this._capacityMask;var s,i=this._list[t];if(e<n/2){for(s=e;s>0;s--)this._list[t]=this._list[t=t-1+r&this._capacityMask];this._list[t]=void 0,this._head=this._head+1+r&this._capacityMask}else{for(s=n-1-e;s>0;s--)this._list[t]=this._list[t=t+1+r&this._capacityMask];this._list[t]=void 0,this._tail=this._tail-1+r&this._capacityMask}return i}}},r.prototype.remove=function(e,t){var n,r=e,s=t;if(r===(0|r)&&this._head!==this._tail){var i=this.size(),o=this._list.length;if(!(r>=i||r<-i||t<1)){if(r<0&&(r+=i),1===t||!t)return n=new Array(1),n[0]=this.removeOne(r),n;if(0===r&&r+t>=i)return n=this.toArray(),this.clear(),n;var a;for(r+t>i&&(t=i-r),n=new Array(t),a=0;a<t;a++)n[a]=this._list[this._head+r+a&this._capacityMask];if(r=this._head+r&this._capacityMask,e+t===i){for(this._tail=this._tail-t+o&this._capacityMask,a=t;a>0;a--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(0===e){for(this._head=this._head+t+o&this._capacityMask,a=t-1;a>0;a--)this._list[r=r+1+o&this._capacityMask]=void 0;return n}if(r<i/2){for(this._head=this._head+e+t+o&this._capacityMask,a=e;a>0;a--)this.unshift(this._list[r=r-1+o&this._capacityMask]);r=this._head-1+o&this._capacityMask;while(s>0)this._list[r=r-1+o&this._capacityMask]=void 0,s--;e<0&&(this._tail=r)}else{for(this._tail=r,r=r+t+o&this._capacityMask,a=i-(t+e);a>0;a--)this.push(this._list[r++]);r=this._tail;while(s>0)this._list[r=r+1+o&this._capacityMask]=void 0,s--}return this._head<2&&this._tail>1e4&&this._tail<=o>>>2&&this._shrinkArray(),n}}},r.prototype.splice=function(e,t){var n=e;if(n===(0|n)){var r=this.size();if(n<0&&(n+=r),!(n>r)){if(arguments.length>2){var s,i,o,a=arguments.length,c=this._list.length,l=2;if(!r||n<r/2){for(i=new Array(n),s=0;s<n;s++)i[s]=this._list[this._head+s&this._capacityMask];0===t?(o=[],n>0&&(this._head=this._head+n+c&this._capacityMask)):(o=this.remove(n,t),this._head=this._head+n+c&this._capacityMask);while(a>l)this.unshift(arguments[--a]);for(s=n;s>0;s--)this.unshift(i[s-1])}else{i=new Array(r-(n+t));var u=i.length;for(s=0;s<u;s++)i[s]=this._list[this._head+n+t+s&this._capacityMask];0===t?(o=[],n!=r&&(this._tail=this._head+n+c&this._capacityMask)):(o=this.remove(n,t),this._tail=this._tail-u+c&this._capacityMask);while(l<a)this.push(arguments[l++]);for(s=0;s<u;s++)this.push(i[s])}return o}return this.remove(n,t)}}},r.prototype.clear=function(){this._head=0,this._tail=0},r.prototype.isEmpty=function(){return this._head===this._tail},r.prototype.toArray=function(){return this._copyArray(!1)},r.prototype._fromArray=function(e){for(var t=0;t<e.length;t++)this.push(e[t])},r.prototype._copyArray=function(e){var t,n=[],r=this._list,s=r.length;if(e||this._head>this._tail){for(t=this._head;t<s;t++)n.push(r[t]);for(t=0;t<this._tail;t++)n.push(r[t])}else for(t=this._head;t<this._tail;t++)n.push(r[t]);return n},r.prototype._growArray=function(){this._head&&(this._list=this._copyArray(!0),this._head=0),this._tail=this._list.length,this._list.length<<=1,this._capacityMask=this._capacityMask<<1|1},r.prototype._shrinkArray=function(){this._list.length>>>=1,this._capacityMask>>>=1},e.exports=r},6759:function(e){!function(t,n){e.exports=function(e,t,n,r,s){for(t=t.split?t.split("."):t,r=0;r<t.length;r++)e=e?e[t[r]]:s;return e===s?n:e}}()},1196:function(e){"use strict";function t(e,t){for(const n in t)Object.defineProperty(e,n,{value:t[n],enumerable:!0,configurable:!0});return e}function n(e,n,r){if(!e||"string"===typeof e)throw new TypeError("Please pass an Error to err-code");r||(r={}),"object"===typeof n&&(r=n,n=""),n&&(r.code=n);try{return t(e,r)}catch(s){r.message=e.message,r.stack=e.stack;const n=function(){};n.prototype=Object.create(Object.getPrototypeOf(e));const i=t(new n,r);return i}}e.exports=n},409:function(e,t,n){"use strict";n(7658);const r=n(9433);function s(e,t,n){return new r.EventIterator((({push:n})=>(this.addEventListener(e,n,t),()=>this.removeEventListener(e,n,t))),n)}t.zN=r.EventIterator,r.EventIterator},9433:function(e,t,n){"use strict";n(7658),Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(e){if(this.isStopped)return;const t={value:e,done:!1};if(this.pullQueue.length){const e=this.pullQueue.shift();e&&e.resolve(t)}else this.pushQueue.push(Promise.resolve(t)),void 0!==this.highWaterMark&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const e of this.pullQueue)e.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(e){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const t of this.pullQueue)t.reject(e);this.pullQueue.length=0}else{const t=Promise.reject(e);t.catch((()=>{})),this.pushQueue.push(t)}}remove(){Promise.resolve().then((()=>{this.removeCallback&&this.removeCallback()}))}[Symbol.asyncIterator](){return{next:e=>{const t=this.pushQueue.shift();return t?(void 0!==this.lowWaterMark&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),t):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise(((e,t)=>{this.pullQueue.push({resolve:e,reject:t})}))},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class s{constructor(e,{highWaterMark:t=100,lowWaterMark:n=1}={}){const s=new r;s.highWaterMark=t,s.lowWaterMark=n,s.removeCallback=e({push:e=>s.push(e),stop:()=>s.stop(),fail:e=>s.fail(e),on:(e,t)=>{s.eventHandlers[e]=t}})||(()=>{}),this[Symbol.asyncIterator]=()=>s[Symbol.asyncIterator](),Object.freeze(this)}}t.EventIterator=s,t["default"]=s},9835:function(e,t,n){"use strict";n(7658);var r=Object.prototype.hasOwnProperty,s="~";function i(){}function o(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function a(e,t,n,r,i){if("function"!==typeof n)throw new TypeError("The listener must be a function");var a=new o(n,r||e,i),c=s?s+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0===--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(s=!1)),l.prototype.eventNames=function(){var e,t,n=[];if(0===this._eventsCount)return n;for(t in e=this._events)r.call(e,t)&&n.push(s?t.slice(1):t);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},l.prototype.listeners=function(e){var t=s?s+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,i=n.length,o=new Array(i);r<i;r++)o[r]=n[r].fn;return o},l.prototype.listenerCount=function(e){var t=s?s+e:e,n=this._events[t];return n?n.fn?1:n.length:0},l.prototype.emit=function(e,t,n,r,i,o){var a=s?s+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],h=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),h){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,r),!0;case 5:return u.fn.call(u.context,t,n,r,i),!0;case 6:return u.fn.call(u.context,t,n,r,i,o),!0}for(l=1,c=new Array(h-1);l<h;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var d,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),h){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,n);break;case 4:u[l].fn.call(u[l].context,t,n,r);break;default:if(!c)for(d=1,c=new Array(h-1);d<h;d++)c[d-1]=arguments[d];u[l].fn.apply(u[l].context,c)}}return!0},l.prototype.on=function(e,t,n){return a(this,e,t,n,!1)},l.prototype.once=function(e,t,n){return a(this,e,t,n,!0)},l.prototype.removeListener=function(e,t,n,r){var i=s?s+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var o=this._events[i];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||c(this,i);else{for(var a=0,l=[],u=o.length;a<u;a++)(o[a].fn!==t||r&&!o[a].once||n&&o[a].context!==n)&&l.push(o[a]);l.length?this._events[i]=1===l.length?l[0]:l:c(this,i)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=s?s+e:e,this._events[t]&&c(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=s,l.EventEmitter=l,e.exports=l},1528:function(e,t,n){"use strict";n(7658),n(541);var r,s="object"===typeof Reflect?Reflect:null,i=s&&"function"===typeof s.apply?s.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};function o(e){console&&console.warn&&console.warn(e)}r=s&&"function"===typeof s.ownKeys?s.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!==e};function c(){c.init.call(this)}e.exports=c,e.exports.once=v,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._eventsCount=0,c.prototype._maxListeners=void 0;var l=10;function u(e){if("function"!==typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function h(e){return void 0===e._maxListeners?c.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var s,i,a;if(u(n),i=e._events,void 0===i?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"===typeof a?a=i[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),s=h(e),s>0&&a.length>s&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,o(c)}return e}function p(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},s=p.bind(r);return s.listener=n,r.wrapFn=s,s}function g(e,t,n){var r=e._events;if(void 0===r)return[];var s=r[t];return void 0===s?[]:"function"===typeof s?n?[s.listener||s]:[s]:n?b(s):y(s,s.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"===typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function w(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}function b(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}function v(e,t){return new Promise((function(n,r){function s(n){e.removeListener(t,i),r(n)}function i(){"function"===typeof e.removeListener&&e.removeListener("error",s),n([].slice.call(arguments))}_(e,t,i,{once:!0}),"error"!==t&&E(e,s,{once:!0})}))}function E(e,t,n){"function"===typeof e.on&&_(e,"error",t,n)}function _(e,t,n,r){if("function"===typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!==typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function s(i){r.once&&e.removeEventListener(t,s),n(i)}))}}Object.defineProperty(c,"defaultMaxListeners",{enumerable:!0,get:function(){return l},set:function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");l=e}}),c.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},c.prototype.setMaxListeners=function(e){if("number"!==typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},c.prototype.getMaxListeners=function(){return h(this)},c.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,s=this._events;if(void 0!==s)r=r&&void 0===s.error;else if(!r)return!1;if(r){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var a=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw a.context=o,a}var c=s[e];if(void 0===c)return!1;if("function"===typeof c)i(c,this,t);else{var l=c.length,u=y(c,l);for(n=0;n<l;++n)i(u[n],this,t)}return!0},c.prototype.addListener=function(e,t){return d(this,e,t,!1)},c.prototype.on=c.prototype.addListener,c.prototype.prependListener=function(e,t){return d(this,e,t,!0)},c.prototype.once=function(e,t){return u(t),this.on(e,f(this,e,t)),this},c.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,f(this,e,t)),this},c.prototype.removeListener=function(e,t){var n,r,s,i,o;if(u(t),r=this._events,void 0===r)return this;if(n=r[e],void 0===n)return this;if(n===t||n.listener===t)0===--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!==typeof n){for(s=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){o=n[i].listener,s=i;break}if(s<0)return this;0===s?n.shift():w(n,s),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,o||t)}return this},c.prototype.off=c.prototype.removeListener,c.prototype.removeAllListeners=function(e){var t,n,r;if(n=this._events,void 0===n)return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0===--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var s,i=Object.keys(n);for(r=0;r<i.length;++r)s=i[r],"removeListener"!==s&&this.removeAllListeners(s);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],"function"===typeof t)this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},c.prototype.listeners=function(e){return g(this,e,!0)},c.prototype.rawListeners=function(e){return g(this,e,!1)},c.listenerCount=function(e,t){return"function"===typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},c.prototype.listenerCount=m,c.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},4042:function(e){e.exports=class{constructor(e){if(!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}peek(){return this.buffer[this.btm]}isEmpty(){return void 0===this.buffer[this.btm]}}},2517:function(e,t,n){n(7658);const r=n(4042);e.exports=class{constructor(e){this.hwm=e||16,this.head=new r(this.hwm),this.tail=this.head}push(e){if(!this.head.push(e)){const t=this.head;this.head=t.next=new r(2*this.head.buffer.length),this.head.push(e)}}shift(){const e=this.tail.shift();if(void 0===e&&this.tail.next){const e=this.tail.next;return this.tail.next=null,this.tail=e,this.tail.shift()}return e}peek(){return this.tail.peek()}isEmpty(){return this.head.isEmpty()}}},336:function(e,t){"use strict";function n(e,t=n.BASE){const r=e.length;for(let n=0;n<r;n++)t^=e.charCodeAt(n),t+=(t<<1)+(t<<4)+(t<<7)+(t<<8)+(t<<24);return t>>>0}Object.defineProperty(t,"__esModule",{value:!0}),n.BASE=2166136261,t["default"]=n,e.exports=n},5470:function(e){e.exports=function(e){if(!e)throw Error("hashlru must have a max value, of type number, greater than 0");var t=0,n=Object.create(null),r=Object.create(null);function s(s,i){n[s]=i,t++,t>=e&&(t=0,r=n,n=Object.create(null))}return{has:function(e){return void 0!==n[e]||void 0!==r[e]},remove:function(e){void 0!==n[e]&&(n[e]=void 0),void 0!==r[e]&&(r[e]=void 0)},get:function(e){var t=n[e];return void 0!==t?t:void 0!==(t=r[e])?(s(e,t),t):void 0},set:function(e,t){void 0!==n[e]?n[e]=t:s(e,t)},clear:function(){n=Object.create(null),r=Object.create(null)}}}},4237:function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,s){var i,o,a=8*s-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?s-1:0,d=n?-1:1,p=e[t+h];for(h+=d,i=p&(1<<-u)-1,p>>=-u,u+=a;u>0;i=256*i+e[t+h],h+=d,u-=8);for(o=i&(1<<-u)-1,i>>=-u,u+=r;u>0;o=256*o+e[t+h],h+=d,u-=8);if(0===i)i=1-l;else{if(i===c)return o?NaN:1/0*(p?-1:1);o+=Math.pow(2,r),i-=l}return(p?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,s,i){var o,a,c,l=8*i-s-1,u=(1<<l)-1,h=u>>1,d=23===s?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:i-1,f=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,o=u):(o=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-o))<1&&(o--,c*=2),t+=o+h>=1?d/c:d*Math.pow(2,1-h),t*c>=2&&(o++,c/=2),o+h>=u?(a=0,o=u):o+h>=1?(a=(t*c-1)*Math.pow(2,s),o+=h):(a=t*Math.pow(2,h-1)*Math.pow(2,s),o=0));s>=8;e[n+p]=255&a,p+=f,a/=256,s-=8);for(o=o<<s|a,l+=s;l>0;e[n+p]=255&o,p+=f,o/=256,l-=8);e[n+p-f]|=128*g}},3246:function(e,t,n){n(7658),function(t){"use strict";const n="(0?\\d+|0x[a-f0-9]+)",r={fourOctet:new RegExp(`^${n}\\.${n}\\.${n}\\.${n}$`,"i"),threeOctet:new RegExp(`^${n}\\.${n}\\.${n}$`,"i"),twoOctet:new RegExp(`^${n}\\.${n}$`,"i"),longValue:new RegExp(`^${n}$`,"i")},s=new RegExp("^0[0-7]+$","i"),i=new RegExp("^0x[a-f0-9]+$","i"),o="%[0-9a-z]{1,}",a="(?:[0-9a-f]+::?)+",c={zoneIndex:new RegExp(o,"i"),native:new RegExp(`^(::)?(${a})?([0-9a-f]+)?(::)?(${o})?$`,"i"),deprecatedTransitional:new RegExp(`^(?:::)(${n}\\.${n}\\.${n}\\.${n}(${o})?)$`,"i"),transitional:new RegExp(`^((?:${a})|(?:::)(?:${a})?)${n}\\.${n}\\.${n}\\.${n}(${o})?$`,"i")};function l(e,t){if(e.indexOf("::")!==e.lastIndexOf("::"))return null;let n,r,s=0,i=-1,o=(e.match(c.zoneIndex)||[])[0];o&&(o=o.substring(1),e=e.replace(/%.+$/,""));while((i=e.indexOf(":",i+1))>=0)s++;if("::"===e.substr(0,2)&&s--,"::"===e.substr(-2,2)&&s--,s>t)return null;r=t-s,n=":";while(r--)n+="0:";return e=e.replace("::",n),":"===e[0]&&(e=e.slice(1)),":"===e[e.length-1]&&(e=e.slice(0,-1)),t=function(){const t=e.split(":"),n=[];for(let e=0;e<t.length;e++)n.push(parseInt(t[e],16));return n}(),{parts:t,zoneId:o}}function u(e,t,n,r){if(e.length!==t.length)throw new Error("ipaddr: cannot match CIDR for objects with different lengths");let s,i=0;while(r>0){if(s=n-r,s<0&&(s=0),e[i]>>s!==t[i]>>s)return!1;r-=n,i+=1}return!0}function h(e){if(i.test(e))return parseInt(e,16);if("0"===e[0]&&!isNaN(parseInt(e[1],10))){if(s.test(e))return parseInt(e,8);throw new Error(`ipaddr: cannot parse ${e} as octal`)}return parseInt(e,10)}function d(e,t){while(e.length<t)e=`0${e}`;return e}const p={};p.IPv4=function(){function e(e){if(4!==e.length)throw new Error("ipaddr: ipv4 octet count should be 4");let t,n;for(t=0;t<e.length;t++)if(n=e[t],!(0<=n&&n<=255))throw new Error("ipaddr: ipv4 octet should fit in 8 bits");this.octets=e}return e.prototype.SpecialRanges={unspecified:[[new e([0,0,0,0]),8]],broadcast:[[new e([255,255,255,255]),32]],multicast:[[new e([224,0,0,0]),4]],linkLocal:[[new e([169,254,0,0]),16]],loopback:[[new e([127,0,0,0]),8]],carrierGradeNat:[[new e([100,64,0,0]),10]],private:[[new e([10,0,0,0]),8],[new e([172,16,0,0]),12],[new e([192,168,0,0]),16]],reserved:[[new e([192,0,0,0]),24],[new e([192,0,2,0]),24],[new e([192,88,99,0]),24],[new e([198,51,100,0]),24],[new e([203,0,113,0]),24],[new e([240,0,0,0]),4]]},e.prototype.kind=function(){return"ipv4"},e.prototype.match=function(e,t){let n;if(void 0===t&&(n=e,e=n[0],t=n[1]),"ipv4"!==e.kind())throw new Error("ipaddr: cannot match ipv4 address with non-ipv4 one");return u(this.octets,e.octets,8,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const n={0:8,128:7,192:6,224:5,240:4,248:3,252:2,254:1,255:0};let r,s,i;for(r=3;r>=0;r-=1){if(s=this.octets[r],!(s in n))return null;if(i=n[s],t&&0!==i)return null;8!==i&&(t=!0),e+=i}return 32-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){return this.octets.slice(0)},e.prototype.toIPv4MappedAddress=function(){return p.IPv6.parse(`::ffff:${this.toString()}`)},e.prototype.toNormalizedString=function(){return this.toString()},e.prototype.toString=function(){return this.octets.join(".")},e}(),p.IPv4.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),n=t[0].toByteArray(),r=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[];let i=0;while(i<4)s.push(parseInt(n[i],10)|255^parseInt(r[i],10)),i++;return new this(s)}catch(t){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.isIPv4=function(e){return null!==this.parser(e)},p.IPv4.isValid=function(e){try{return new this(this.parser(e)),!0}catch(t){return!1}},p.IPv4.isValidFourPartDecimal=function(e){return!(!p.IPv4.isValid(e)||!e.match(/^(0|[1-9]\d*)(\.(0|[1-9]\d*)){3}$/))},p.IPv4.networkAddressFromCIDR=function(e){let t,n,r,s,i;try{t=this.parseCIDR(e),r=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[],n=0;while(n<4)s.push(parseInt(r[n],10)&parseInt(i[n],10)),n++;return new this(s)}catch(o){throw new Error("ipaddr: the address does not have IPv4 CIDR format")}},p.IPv4.parse=function(e){const t=this.parser(e);if(null===t)throw new Error("ipaddr: string is not formatted like an IPv4 Address");return new this(t)},p.IPv4.parseCIDR=function(e){let t;if(t=e.match(/^(.+)\/(\d+)$/)){const e=parseInt(t[2]);if(e>=0&&e<=32){const n=[this.parse(t[1]),e];return Object.defineProperty(n,"toString",{value:function(){return this.join("/")}}),n}}throw new Error("ipaddr: string is not formatted like an IPv4 CIDR range")},p.IPv4.parser=function(e){let t,n,s;if(t=e.match(r.fourOctet))return function(){const e=t.slice(1,6),r=[];for(let t=0;t<e.length;t++)n=e[t],r.push(h(n));return r}();if(t=e.match(r.longValue)){if(s=h(t[1]),s>4294967295||s<0)throw new Error("ipaddr: address outside defined range");return function(){const e=[];let t;for(t=0;t<=24;t+=8)e.push(s>>t&255);return e}().reverse()}return(t=e.match(r.twoOctet))?function(){const e=t.slice(1,4),n=[];if(s=h(e[1]),s>16777215||s<0)throw new Error("ipaddr: address outside defined range");return n.push(h(e[0])),n.push(s>>16&255),n.push(s>>8&255),n.push(255&s),n}():(t=e.match(r.threeOctet))?function(){const e=t.slice(1,5),n=[];if(s=h(e[2]),s>65535||s<0)throw new Error("ipaddr: address outside defined range");return n.push(h(e[0])),n.push(h(e[1])),n.push(s>>8&255),n.push(255&s),n}():null},p.IPv4.subnetMaskFromPrefixLength=function(e){if(e=parseInt(e),e<0||e>32)throw new Error("ipaddr: invalid IPv4 prefix length");const t=[0,0,0,0];let n=0;const r=Math.floor(e/8);while(n<r)t[n]=255,n++;return r<4&&(t[r]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.IPv6=function(){function e(e,t){let n,r;if(16===e.length)for(this.parts=[],n=0;n<=14;n+=2)this.parts.push(e[n]<<8|e[n+1]);else{if(8!==e.length)throw new Error("ipaddr: ipv6 part count should be 8 or 16");this.parts=e}for(n=0;n<this.parts.length;n++)if(r=this.parts[n],!(0<=r&&r<=65535))throw new Error("ipaddr: ipv6 part should fit in 16 bits");t&&(this.zoneId=t)}return e.prototype.SpecialRanges={unspecified:[new e([0,0,0,0,0,0,0,0]),128],linkLocal:[new e([65152,0,0,0,0,0,0,0]),10],multicast:[new e([65280,0,0,0,0,0,0,0]),8],loopback:[new e([0,0,0,0,0,0,0,1]),128],uniqueLocal:[new e([64512,0,0,0,0,0,0,0]),7],ipv4Mapped:[new e([0,0,0,0,0,65535,0,0]),96],rfc6145:[new e([0,0,0,0,65535,0,0,0]),96],rfc6052:[new e([100,65435,0,0,0,0,0,0]),96],"6to4":[new e([8194,0,0,0,0,0,0,0]),16],teredo:[new e([8193,0,0,0,0,0,0,0]),32],reserved:[[new e([8193,3512,0,0,0,0,0,0]),32]]},e.prototype.isIPv4MappedAddress=function(){return"ipv4Mapped"===this.range()},e.prototype.kind=function(){return"ipv6"},e.prototype.match=function(e,t){let n;if(void 0===t&&(n=e,e=n[0],t=n[1]),"ipv6"!==e.kind())throw new Error("ipaddr: cannot match ipv6 address with non-ipv6 one");return u(this.parts,e.parts,16,t)},e.prototype.prefixLengthFromSubnetMask=function(){let e=0,t=!1;const n={0:16,32768:15,49152:14,57344:13,61440:12,63488:11,64512:10,65024:9,65280:8,65408:7,65472:6,65504:5,65520:4,65528:3,65532:2,65534:1,65535:0};let r,s;for(let i=7;i>=0;i-=1){if(r=this.parts[i],!(r in n))return null;if(s=n[r],t&&0!==s)return null;16!==s&&(t=!0),e+=s}return 128-e},e.prototype.range=function(){return p.subnetMatch(this,this.SpecialRanges)},e.prototype.toByteArray=function(){let e;const t=[],n=this.parts;for(let r=0;r<n.length;r++)e=n[r],t.push(e>>8),t.push(255&e);return t},e.prototype.toFixedLengthString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(d(this.parts[t].toString(16),4));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toIPv4Address=function(){if(!this.isIPv4MappedAddress())throw new Error("ipaddr: trying to convert a generic ipv6 address to ipv4");const e=this.parts.slice(-2),t=e[0],n=e[1];return new p.IPv4([t>>8,255&t,n>>8,255&n])},e.prototype.toNormalizedString=function(){const e=function(){const e=[];for(let t=0;t<this.parts.length;t++)e.push(this.parts[t].toString(16));return e}.call(this).join(":");let t="";return this.zoneId&&(t=`%${this.zoneId}`),e+t},e.prototype.toRFC5952String=function(){const e=/((^|:)(0(:|$)){2,})/g,t=this.toNormalizedString();let n,r=0,s=-1;while(n=e.exec(t))n[0].length>s&&(r=n.index,s=n[0].length);return s<0?t:`${t.substring(0,r)}::${t.substring(r+s)}`},e.prototype.toString=function(){return this.toNormalizedString().replace(/((^|:)(0(:|$))+)/,"::")},e}(),p.IPv6.broadcastAddressFromCIDR=function(e){try{const t=this.parseCIDR(e),n=t[0].toByteArray(),r=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[];let i=0;while(i<16)s.push(parseInt(n[i],10)|255^parseInt(r[i],10)),i++;return new this(s)}catch(t){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${t})`)}},p.IPv6.isIPv6=function(e){return null!==this.parser(e)},p.IPv6.isValid=function(e){if("string"===typeof e&&-1===e.indexOf(":"))return!1;try{const t=this.parser(e);return new this(t.parts,t.zoneId),!0}catch(t){return!1}},p.IPv6.networkAddressFromCIDR=function(e){let t,n,r,s,i;try{t=this.parseCIDR(e),r=t[0].toByteArray(),i=this.subnetMaskFromPrefixLength(t[1]).toByteArray(),s=[],n=0;while(n<16)s.push(parseInt(r[n],10)&parseInt(i[n],10)),n++;return new this(s)}catch(o){throw new Error(`ipaddr: the address does not have IPv6 CIDR format (${o})`)}},p.IPv6.parse=function(e){const t=this.parser(e);if(null===t.parts)throw new Error("ipaddr: string is not formatted like an IPv6 Address");return new this(t.parts,t.zoneId)},p.IPv6.parseCIDR=function(e){let t,n,r;if((n=e.match(/^(.+)\/(\d+)$/))&&(t=parseInt(n[2]),t>=0&&t<=128))return r=[this.parse(n[1]),t],Object.defineProperty(r,"toString",{value:function(){return this.join("/")}}),r;throw new Error("ipaddr: string is not formatted like an IPv6 CIDR range")},p.IPv6.parser=function(e){let t,n,r,s,i,o;if(r=e.match(c.deprecatedTransitional))return this.parser(`::ffff:${r[1]}`);if(c.native.test(e))return l(e,8);if((r=e.match(c.transitional))&&(o=r[6]||"",t=l(r[1].slice(0,-1)+o,6),t.parts)){for(i=[parseInt(r[2]),parseInt(r[3]),parseInt(r[4]),parseInt(r[5])],n=0;n<i.length;n++)if(s=i[n],!(0<=s&&s<=255))return null;return t.parts.push(i[0]<<8|i[1]),t.parts.push(i[2]<<8|i[3]),{parts:t.parts,zoneId:t.zoneId}}return null},p.IPv6.subnetMaskFromPrefixLength=function(e){if(e=parseInt(e),e<0||e>128)throw new Error("ipaddr: invalid IPv6 prefix length");const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];let n=0;const r=Math.floor(e/8);while(n<r)t[n]=255,n++;return r<16&&(t[r]=Math.pow(2,e%8)-1<<8-e%8),new this(t)},p.fromByteArray=function(e){const t=e.length;if(4===t)return new p.IPv4(e);if(16===t)return new p.IPv6(e);throw new Error("ipaddr: the binary input is neither an IPv6 nor IPv4 address")},p.isValid=function(e){return p.IPv6.isValid(e)||p.IPv4.isValid(e)},p.parse=function(e){if(p.IPv6.isValid(e))return p.IPv6.parse(e);if(p.IPv4.isValid(e))return p.IPv4.parse(e);throw new Error("ipaddr: the address has neither IPv6 nor IPv4 format")},p.parseCIDR=function(e){try{return p.IPv6.parseCIDR(e)}catch(t){try{return p.IPv4.parseCIDR(e)}catch(n){throw new Error("ipaddr: the address has neither IPv6 nor IPv4 CIDR format")}}},p.process=function(e){const t=this.parse(e);return"ipv6"===t.kind()&&t.isIPv4MappedAddress()?t.toIPv4Address():t},p.subnetMatch=function(e,t,n){let r,s,i,o;for(s in void 0!==n&&null!==n||(n="unicast"),t)if(Object.prototype.hasOwnProperty.call(t,s))for(i=t[s],!i[0]||i[0]instanceof Array||(i=[i]),r=0;r<i.length;r++)if(o=i[r],e.kind()===o[0].kind()&&e.match.apply(e,o))return s;return n},e.exports?e.exports=p:t.ipaddr=p}(this)},5363:function(e,t,n){"use strict";globalThis.fetch&&globalThis.Headers&&globalThis.Request&&globalThis.Response?e.exports={default:globalThis.fetch,Headers:globalThis.Headers,Request:globalThis.Request,Response:globalThis.Response}:e.exports={default:n(5319)["default"],Headers:n(5319).Headers,Request:n(5319).Request,Response:n(5319).Response}},5319:function(e,t){"use strict";var n=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r)return r;throw new Error("unable to locate global object")},r=n();e.exports=t=r.fetch,r.fetch&&(t["default"]=r.fetch.bind(r)),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},6338:function(e,t,n){"use strict";const r=n(8346),s="object"===typeof window&&"object"===typeof document&&9===document.nodeType,i=r(),o=s&&!i,a=i&&!s,c=i&&s,l="undefined"!==typeof process&&"undefined"!==typeof process.release&&"node"===process.release.name&&!i,u="function"===typeof importScripts&&"undefined"!==typeof self&&"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,h="undefined"!==typeof process&&!1,d="undefined"!==typeof navigator&&"ReactNative"===navigator.product;e.exports={isTest:h,isElectron:i,isElectronMain:a,isElectronRenderer:c,isNode:l,isBrowser:o,isWebWorker:u,isEnvWithDom:s,isReactNative:d}},2656:function(e,t,n){"use strict";e.exports=n(5363)},1819:function(e,t,n){"use strict";const r=n(3785),s=(e,t)=>({path:decodeURIComponent(new URL(e).pathname.split("/").pop()||""),content:i(e,t)});async function*i(e,t){const n=new r,s=await n.get(e,t);yield*s.iterator()}e.exports=s},3785:function(e,t,n){"use strict";const{fetch:r,Request:s,Headers:i}=n(403),{TimeoutError:o,HTTPError:a}=n(1253),c=n(9610).bind({ignoreUndefined:!0}),{URL:l,URLSearchParams:u}=n(5248),h=n(3162),d=(e,t,n)=>{if(void 0===t)return e;const r=Date.now(),s=()=>{const e=Date.now()-r;return e>=t};return new Promise(((r,i)=>{const a=setTimeout((()=>{s()&&(i(new o),n.abort())}),t),c=e=>{const t=t=>{clearTimeout(a),s()?i(new o):e(t)};return t};e.then(c(r),c(i))}))},p={throwHttpErrors:!0,credentials:"same-origin"};class f{constructor(e={}){this.opts=c(p,e)}async fetch(e,t={}){const n=c(this.opts,t),o=new i(n.headers);if("string"!==typeof e&&!(e instanceof l||e instanceof s))throw new TypeError("`resource` must be a string, URL, or Request");const p=new l(e.toString(),n.base),{searchParams:f,transformSearchParams:y,json:w}=n;f&&(p.search="function"===typeof y?y(new u(n.searchParams)):new u(n.searchParams)),w&&(n.body=JSON.stringify(n.json),o.set("content-type","application/json"));const b=new AbortController,v=h([b.signal,n.signal]),E=await d(r(p.toString(),{...n,signal:v,timeout:void 0,headers:o}),n.timeout,b);if(!E.ok&&n.throwHttpErrors)throw n.handleError&&await n.handleError(E),new a(E);return E.iterator=async function*(){yield*m(E.body)},E.ndjson=async function*(){for await(const e of g(E.iterator()))t.transform?yield t.transform(e):yield e},E}post(e,t={}){return this.fetch(e,{...t,method:"POST"})}get(e,t={}){return this.fetch(e,{...t,method:"GET"})}put(e,t={}){return this.fetch(e,{...t,method:"PUT"})}delete(e,t={}){return this.fetch(e,{...t,method:"DELETE"})}options(e,t={}){return this.fetch(e,{...t,method:"OPTIONS"})}}const g=async function*(e){const t=new TextDecoder;let n="";for await(const r of e){n+=t.decode(r,{stream:!0});const e=n.split(/\r?\n/);for(let t=0;t<e.length-1;t++){const n=e[t].trim();n.length>0&&(yield JSON.parse(n))}n=e[e.length-1]}n+=t.decode(),n=n.trim(),0!==n.length&&(yield JSON.parse(n))},m=e=>{if(b(e)){const t=e[Symbol.asyncIterator]();return{[Symbol.asyncIterator](){return{next:t.next.bind(t),return(n){return e.destroy(),"function"===typeof t.return?t.return():Promise.resolve({done:!0,value:n})}}}}}if(w(e)){const t=e.getReader();return async function*(){try{while(1){const{done:e,value:n}=await t.read();if(e)return;n&&(yield n)}}finally{t.releaseLock()}}()}if(y(e))return e;throw new TypeError("Body can't be converted to AsyncIterable")},y=e=>"object"===typeof e&&null!==e&&"function"===typeof e[Symbol.asyncIterator],w=e=>e&&"function"===typeof e.getReader,b=e=>Object.prototype.hasOwnProperty.call(e,"readable")&&Object.prototype.hasOwnProperty.call(e,"writable");f.HTTPError=a,f.TimeoutError=o,f.streamToAsyncIterator=m,f.post=(e,t)=>new f(t).post(e,t),f.get=(e,t)=>new f(t).get(e,t),f.put=(e,t)=>new f(t).put(e,t),f.delete=(e,t)=>new f(t).delete(e,t),f.options=(e,t)=>new f(t).options(e,t),e.exports=f},1253:function(e,t){"use strict";class n extends Error{constructor(e="Request timed out"){super(e),this.name="TimeoutError"}}t.TimeoutError=n;class r extends Error{constructor(e="The operation was aborted."){super(e),this.name="AbortError"}}t.AbortError=r;class s extends Error{constructor(e){super(e.statusText),this.name="HTTPError",this.response=e}}t.HTTPError=s},403:function(e,t,n){"use strict";const{TimeoutError:r,AbortError:s}=n(1253),{Response:i,Request:o,Headers:a,default:c}=n(2656),l=(e,t={})=>{const n=new XMLHttpRequest;n.open(t.method||"GET",e.toString(),!0);const{timeout:o,headers:c}=t;if(o&&o>0&&o<1/0&&(n.timeout=o),null!=t.overrideMimeType&&n.overrideMimeType(t.overrideMimeType),c)for(const[r,s]of new a(c))n.setRequestHeader(r,s);return t.signal&&(t.signal.onabort=()=>n.abort()),t.onUploadProgress&&(n.upload.onprogress=t.onUploadProgress),n.responseType="arraybuffer",new Promise(((e,o)=>{const a=t=>{switch(t.type){case"error":e(i.error());break;case"load":e(new p(n.responseURL,n.response,{status:n.status,statusText:n.statusText,headers:d(n.getAllResponseHeaders())}));break;case"timeout":o(new r);break;case"abort":o(new s);break;default:break}};n.onerror=a,n.onload=a,n.ontimeout=a,n.onabort=a,n.send(t.body)}))},u=c,h=(e,t={})=>null!=t.onUploadProgress?l(e,t):u(e,t),d=e=>{const t=new a;for(const n of e.trim().split(/[\r\n]+/)){const e=n.indexOf(": ");e>0&&t.set(n.slice(0,e),n.slice(e+1))}return t};class p extends i{constructor(e,t,n){super(t,n),Object.defineProperty(this,"url",{value:e})}}e.exports={fetch:h,Request:o,Headers:a}},6209:function(e){"use strict";var t=/^(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9])?\.){0,126}(?:[a-z0-9](?:[a-z0-9\-]{0,61}[a-z0-9]))\.?$/i;e.exports=function(e,n){if(null==n&&(n=!1),e.length<2)return!1;if(e.length>255)return!1;var r=e[e.length-1];if(n){if("."!==r)return!1}else if("."===r)return!1;return t.test(e)}},8346:function(e){function t(){return"undefined"!==typeof window&&"object"===typeof window.process&&"renderer"===window.process.type||(!("undefined"===typeof process||"object"!==typeof process.versions||!process.versions.electron)||"object"===typeof navigator&&"string"===typeof navigator.userAgent&&navigator.userAgent.indexOf("Electron")>=0)}e.exports=t},7576:function(e){"use strict";e.exports=e=>{if("[object Object]"!==Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}},7870:function(e){"use strict";e.exports={RTLD_LAZY:1,RTLD_NOW:2,RTLD_GLOBAL:256,RTLD_LOCAL:0,RTLD_DEEPBIND:8,E2BIG:7,EACCES:13,EADDRINUSE:98,EADDRNOTAVAIL:99,EAFNOSUPPORT:97,EAGAIN:11,EALREADY:114,EBADF:9,EBADMSG:74,EBUSY:16,ECANCELED:125,ECHILD:10,ECONNABORTED:103,ECONNREFUSED:111,ECONNRESET:104,EDEADLK:35,EDESTADDRREQ:89,EDOM:33,EDQUOT:122,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:113,EIDRM:43,EILSEQ:84,EINPROGRESS:115,EINTR:4,EINVAL:22,EIO:5,EISCONN:106,EISDIR:21,ELOOP:40,EMFILE:24,EMLINK:31,EMSGSIZE:90,EMULTIHOP:72,ENAMETOOLONG:36,ENETDOWN:100,ENETRESET:102,ENETUNREACH:101,ENFILE:23,ENOBUFS:105,ENODATA:61,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:37,ENOLINK:67,ENOMEM:12,ENOMSG:42,ENOPROTOOPT:92,ENOSPC:28,ENOSR:63,ENOSTR:60,ENOSYS:38,ENOTCONN:107,ENOTDIR:20,ENOTEMPTY:39,ENOTSOCK:88,ENOTSUP:95,ENOTTY:25,ENXIO:6,EOPNOTSUPP:95,EOVERFLOW:75,EPERM:1,EPIPE:32,EPROTO:71,EPROTONOSUPPORT:93,EPROTOTYPE:91,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:116,ETIME:62,ETIMEDOUT:110,ETXTBSY:26,EWOULDBLOCK:11,EXDEV:18,PRIORITY_LOW:19,PRIORITY_BELOW_NORMAL:10,PRIORITY_NORMAL:0,PRIORITY_ABOVE_NORMAL:-7,PRIORITY_HIGH:-14,PRIORITY_HIGHEST:-20,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:7,SIGFPE:8,SIGKILL:9,SIGUSR1:10,SIGSEGV:11,SIGUSR2:12,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:17,SIGSTKFLT:16,SIGCONT:18,SIGSTOP:19,SIGTSTP:20,SIGTTIN:21,SIGTTOU:22,SIGURG:23,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:29,SIGPOLL:29,SIGPWR:30,SIGSYS:31,UV_FS_SYMLINK_DIR:1,UV_FS_SYMLINK_JUNCTION:2,O_RDONLY:0,O_WRONLY:1,O_RDWR:2,UV_DIRENT_UNKNOWN:0,UV_DIRENT_FILE:1,UV_DIRENT_DIR:2,UV_DIRENT_LINK:3,UV_DIRENT_FIFO:4,UV_DIRENT_SOCKET:5,UV_DIRENT_CHAR:6,UV_DIRENT_BLOCK:7,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:64,O_EXCL:128,UV_FS_O_FILEMAP:0,O_NOCTTY:256,O_TRUNC:512,O_APPEND:1024,O_DIRECTORY:65536,O_NOATIME:262144,O_NOFOLLOW:131072,O_SYNC:1052672,O_DSYNC:4096,O_DIRECT:16384,O_NONBLOCK:2048,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_FS_COPYFILE_EXCL:1,COPYFILE_EXCL:1,UV_FS_COPYFILE_FICLONE:2,COPYFILE_FICLONE:2,UV_FS_COPYFILE_FICLONE_FORCE:4,COPYFILE_FICLONE_FORCE:4,OPENSSL_VERSION_NUMBER:805306480,SSL_OP_ALL:2147485776,SSL_OP_ALLOW_NO_DHE_KEX:1024,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:0,SSL_OP_MICROSOFT_SESS_ID_BUG:0,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:0,SSL_OP_NETSCAPE_CHALLENGE_BUG:0,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:0,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:0,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_ENCRYPT_THEN_MAC:524288,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_RENEGOTIATION:1073741824,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:0,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_NO_TLSv1_3:536870912,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_PRIORITIZE_CHACHA:2097152,SSL_OP_SINGLE_DH_USE:0,SSL_OP_SINGLE_ECDH_USE:0,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:0,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:0,SSL_OP_TLS_D5_BUG:0,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_RSA:1,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_EC:2048,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,RSA_PSS_SALTLEN_DIGEST:-1,RSA_PSS_SALTLEN_MAX_SIGN:-2,RSA_PSS_SALTLEN_AUTO:-2,defaultCoreCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA",TLS1_VERSION:769,TLS1_1_VERSION:770,TLS1_2_VERSION:771,TLS1_3_VERSION:772,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,defaultCipherList:"TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256:TLS_AES_128_GCM_SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384:DHE-RSA-AES256-SHA384:ECDHE-RSA-AES256-SHA256:DHE-RSA-AES256-SHA256:HIGH:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!SRP:!CAMELLIA"}},5317:function(e,t,n){"use strict";n(3767),n(8585),n(8696);const r=65536;function s(e){const t=new Uint8Array(e);let n=0;if(e>0)if(e>r)while(n<e)n+r>e?(crypto.getRandomValues(t.subarray(n,n+(e-n))),n+=e-n):(crypto.getRandomValues(t.subarray(n,n+r)),n+=r);else crypto.getRandomValues(t);return t}e.exports=s},5248:function(e,t,n){"use strict";const{URLWithLegacySupport:r,format:s,URLSearchParams:i,defaultBase:o}=n(1124),a=n(5456);e.exports={URL:r,URLSearchParams:i,format:s,relative:a,defaultBase:o}},5456:function(e,t,n){"use strict";const{URLWithLegacySupport:r,format:s}=n(1124);e.exports=(e,t={},n={},i)=>{let o,a=t.protocol?t.protocol.replace(":",""):"http";a=(n[a]||i||a)+":";try{o=new r(e)}catch(l){o={}}const c=Object.assign({},t,{protocol:a||o.protocol,host:t.host||o.host});return new r(e,s(c)).toString()}},1124:function(e){"use strict";const t="undefined"!==typeof navigator&&"ReactNative"===navigator.product;function n(){return t?"http://localhost":self.location?self.location.protocol+"//"+self.location.host:""}const r=self.URL,s=n();class i{constructor(e="",t=s){this.super=new r(e,t),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(e){this.super.hash=e}set host(e){this.super.host=e}set hostname(e){this.super.hostname=e}set href(e){this.super.href=e}set password(e){this.super.password=e}set pathname(e){this.super.pathname=e}set port(e){this.super.port=e}set protocol(e){this.super.protocol=e}set search(e){this.super.search=e}set username(e){this.super.username=e}static createObjectURL(e){return r.createObjectURL(e)}static revokeObjectURL(e){r.revokeObjectURL(e)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}}function o(e){if("string"===typeof e){const t=new r(e);return t.toString()}if(!(e instanceof r)){const t=e.username&&e.password?`${e.username}:${e.password}@`:"",n=e.auth?e.auth+"@":"",r=e.port?":"+e.port:"",s=e.protocol?e.protocol+"//":"",i=e.host||"",o=e.hostname||"",a=e.search||(e.query?"?"+e.query:""),c=e.hash||"",l=e.pathname||"",u=e.path||l+a;return`${s}${t||n}${i||o+r}${u}${c}`}}e.exports={URLWithLegacySupport:i,URLSearchParams:self.URLSearchParams,defaultBase:s,format:o}},1918:function(e,t,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=n(8109),{EventEmitter:s}=n(1528);function i(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0,r=e.length;n<r;++n)if(e[n]!==t[n])return!1;return!0}function o(){return{contacts:[],dontSplit:!1,left:null,right:null}}function a(e,t){if(!(t instanceof Uint8Array))throw new TypeError(e+" is not a Uint8Array")}class c extends s{constructor(e={}){super(),this.localNodeId=e.localNodeId||r(20),this.numberOfNodesPerKBucket=e.numberOfNodesPerKBucket||20,this.numberOfNodesToPing=e.numberOfNodesToPing||3,this.distance=e.distance||c.distance,this.arbiter=e.arbiter||c.arbiter,this.metadata=Object.assign({},e.metadata),a("option.localNodeId as parameter 1",this.localNodeId),this.root=o()}static arbiter(e,t){return e.vectorClock>t.vectorClock?e:t}static distance(e,t){let n=0,r=0;const s=Math.min(e.length,t.length),i=Math.max(e.length,t.length);for(;r<s;++r)n=256*n+(e[r]^t[r]);for(;r<i;++r)n=256*n+255;return n}add(e){a("contact.id",(e||{}).id);let t=0,n=this.root;while(null===n.contacts)n=this._determineNode(n,e.id,t++);const r=this._indexOf(n,e.id);return r>=0?(this._update(n,r,e),this):n.contacts.length<this.numberOfNodesPerKBucket?(n.contacts.push(e),this.emit("added",e),this):n.dontSplit?(this.emit("ping",n.contacts.slice(0,this.numberOfNodesToPing),e),this):(this._split(n,t),this.add(e))}closest(e,t=1/0){if(a("id",e),!Number.isInteger(t)&&t!==1/0||t<=0)throw new TypeError("n is not positive number");let n=[];for(let r=[this.root],s=0;r.length>0&&n.length<t;){const t=r.pop();if(null===t.contacts){const n=this._determineNode(t,e,s++);r.push(t.left===n?t.right:t.left),r.push(n)}else n=n.concat(t.contacts)}return n.map((t=>[this.distance(t.id,e),t])).sort(((e,t)=>e[0]-t[0])).slice(0,t).map((e=>e[1]))}count(){let e=0;for(const t=[this.root];t.length>0;){const n=t.pop();null===n.contacts?t.push(n.right,n.left):e+=n.contacts.length}return e}_determineNode(e,t,n){const r=n>>3,s=n%8;if(t.length<=r&&0!==s)return e.left;const i=t[r];return i&1<<7-s?e.right:e.left}get(e){a("id",e);let t=0,n=this.root;while(null===n.contacts)n=this._determineNode(n,e,t++);const r=this._indexOf(n,e);return r>=0?n.contacts[r]:null}_indexOf(e,t){for(let n=0;n<e.contacts.length;++n)if(i(e.contacts[n].id,t))return n;return-1}remove(e){a("the id as parameter 1",e);let t=0,n=this.root;while(null===n.contacts)n=this._determineNode(n,e,t++);const r=this._indexOf(n,e);if(r>=0){const e=n.contacts.splice(r,1)[0];this.emit("removed",e)}return this}_split(e,t){e.left=o(),e.right=o();for(const s of e.contacts)this._determineNode(e,s.id,t).contacts.push(s);e.contacts=null;const n=this._determineNode(e,this.localNodeId,t),r=e.left===n?e.right:e.left;r.dontSplit=!0}toArray(){let e=[];for(const t=[this.root];t.length>0;){const n=t.pop();null===n.contacts?t.push(n.right,n.left):e=e.concat(n.contacts)}return e}*toIterable(){for(const e=[this.root];e.length>0;){const t=e.pop();null===t.contacts?e.push(t.right,t.left):yield*t.contacts}}_update(e,t,n){if(!i(e.contacts[t].id,n.id))throw new Error("wrong index for _update");const r=e.contacts[t],s=this.arbiter(r,n);s===r&&r!==n||(e.contacts.splice(t,1),e.contacts.push(s),this.emit("updated",r,s))}}e.exports=c},9078:function(e,t){"use strict";t.supports=function(...e){const t=e.reduce(((e,t)=>Object.assign(e,t)),{});return Object.assign(t,{snapshots:t.snapshots||!1,permanence:t.permanence||!1,seek:t.seek||!1,clear:t.clear||!1,getMany:t.getMany||!1,keyIterator:t.keyIterator||!1,valueIterator:t.valueIterator||!1,iteratorNextv:t.iteratorNextv||!1,iteratorAll:t.iteratorAll||!1,status:t.status||!1,createIfMissing:t.createIfMissing||!1,errorIfExists:t.errorIfExists||!1,deferredOpen:t.deferredOpen||!1,promises:t.promises||!1,streams:t.streams||!1,encodings:Object.assign({},t.encodings),events:Object.assign({},t.events),additionalMethods:Object.assign({},t.additionalMethods)})}},9871:function(e,t,n){"use strict";const r=n(7368),s=n(7924),{Encoding:i}=n(1267),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=n(1001),l=Symbol("formats"),u=Symbol("encodings"),h=new Set(["buffer","view","utf8"]);class d{constructor(e){if(!Array.isArray(e))throw new TypeError("The first argument 'formats' must be an array");if(!e.every((e=>h.has(e))))throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'");this[u]=new Map,this[l]=new Set(e);for(const n in s)try{this.encoding(n)}catch(t){if("LEVEL_ENCODING_NOT_SUPPORTED"!==t.code)throw t}}encodings(){return Array.from(new Set(this[u].values()))}encoding(e){let t=this[u].get(e);if(void 0===t){if("string"===typeof e&&""!==e){if(t=m[e],!t)throw new r(`Encoding '${e}' is not found`,{code:"LEVEL_ENCODING_NOT_FOUND"})}else{if("object"!==typeof e||null===e)throw new TypeError("First argument 'encoding' must be a string or object");t=p(e)}const{name:n,format:s}=t;if(!this[l].has(s))if(this[l].has("view"))t=t.createViewTranscoder();else if(this[l].has("buffer"))t=t.createBufferTranscoder();else{if(!this[l].has("utf8"))throw new r(`Encoding '${n}' cannot be transcoded`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"});t=t.createUTF8Transcoder()}for(const r of[e,n,t.name,t.commonName])this[u].set(r,t)}return t}}function p(e){if(e instanceof i)return e;const t="type"in e&&"string"===typeof e.type?e.type:void 0,n=e.name||t||"anonymous-"+y++;switch(f(e)){case"view":return new a({...e,name:n});case"utf8":return new c({...e,name:n});case"buffer":return new o({...e,name:n});default:throw new TypeError("Format must be one of 'buffer', 'view', 'utf8'")}}function f(e){return"format"in e&&void 0!==e.format?e.format:"buffer"in e&&"boolean"===typeof e.buffer?e.buffer?"buffer":"utf8":"code"in e&&Number.isInteger(e.code)?"view":"buffer"}t.Transcoder=d;const g={binary:s.buffer,"utf-8":s.utf8},m={...s,...g};let y=0},1267:function(e,t,n){"use strict";const r=n(7368),s=new Set(["buffer","view","utf8"]);class i{constructor(e){if(this.encode=e.encode||this.encode,this.decode=e.decode||this.decode,this.name=e.name||this.name,this.format=e.format||this.format,"function"!==typeof this.encode)throw new TypeError("The 'encode' property must be a function");if("function"!==typeof this.decode)throw new TypeError("The 'decode' property must be a function");if(this.encode=this.encode.bind(this),this.decode=this.decode.bind(this),"string"!==typeof this.name||""===this.name)throw new TypeError("The 'name' property must be a string");if("string"!==typeof this.format||!s.has(this.format))throw new TypeError("The 'format' property must be one of 'buffer', 'view', 'utf8'");e.createViewTranscoder&&(this.createViewTranscoder=e.createViewTranscoder),e.createBufferTranscoder&&(this.createBufferTranscoder=e.createBufferTranscoder),e.createUTF8Transcoder&&(this.createUTF8Transcoder=e.createUTF8Transcoder)}get commonName(){return this.name.split("+")[0]}createBufferTranscoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'buffer'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createViewTranscoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'view'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}createUTF8Transcoder(){throw new r(`Encoding '${this.name}' cannot be transcoded to 'utf8'`,{code:"LEVEL_ENCODING_NOT_SUPPORTED"})}}t.Encoding=i},7924:function(e,t,n){"use strict";const{Buffer:r}=n(911)||{Buffer:{isBuffer:()=>!1}},{textEncoder:s,textDecoder:i}=n(944)(),{BufferFormat:o,ViewFormat:a,UTF8Format:c}=n(1001),l=e=>e;t.utf8=new c({encode:function(e){return r.isBuffer(e)?e.toString("utf8"):ArrayBuffer.isView(e)?i.decode(e):String(e)},decode:l,name:"utf8",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:s.encode(e)},decode:function(e){return i.decode(e)},name:`${this.name}+view`})},createBufferTranscoder(){return new o({encode:function(e){return r.isBuffer(e)?e:ArrayBuffer.isView(e)?r.from(e.buffer,e.byteOffset,e.byteLength):r.from(String(e),"utf8")},decode:function(e){return e.toString("utf8")},name:`${this.name}+buffer`})}}),t.json=new c({encode:JSON.stringify,decode:JSON.parse,name:"json"}),t.buffer=new o({encode:function(e){return r.isBuffer(e)?e:ArrayBuffer.isView(e)?r.from(e.buffer,e.byteOffset,e.byteLength):r.from(String(e),"utf8")},decode:l,name:"buffer",createViewTranscoder(){return new a({encode:function(e){return ArrayBuffer.isView(e)?e:r.from(String(e),"utf8")},decode:function(e){return r.from(e.buffer,e.byteOffset,e.byteLength)},name:`${this.name}+view`})}}),t.view=new a({encode:function(e){return ArrayBuffer.isView(e)?e:s.encode(e)},decode:l,name:"view",createBufferTranscoder(){return new o({encode:function(e){return r.isBuffer(e)?e:ArrayBuffer.isView(e)?r.from(e.buffer,e.byteOffset,e.byteLength):r.from(String(e),"utf8")},decode:l,name:`${this.name}+buffer`})}}),t.hex=new o({encode:function(e){return r.isBuffer(e)?e:r.from(String(e),"hex")},decode:function(e){return e.toString("hex")},name:"hex"}),t.base64=new o({encode:function(e){return r.isBuffer(e)?e:r.from(String(e),"base64")},decode:function(e){return e.toString("base64")},name:"base64"})},1001:function(e,t,n){"use strict";const{Buffer:r}=n(911)||{},{Encoding:s}=n(1267),i=n(944);class o extends s{constructor(e){super({...e,format:"buffer"})}createViewTranscoder(){return new a({encode:this.encode,decode:e=>this.decode(r.from(e.buffer,e.byteOffset,e.byteLength)),name:`${this.name}+view`})}createBufferTranscoder(){return this}}class a extends s{constructor(e){super({...e,format:"view"})}createBufferTranscoder(){return new o({encode:e=>{const t=this.encode(e);return r.from(t.buffer,t.byteOffset,t.byteLength)},decode:this.decode,name:`${this.name}+buffer`})}createViewTranscoder(){return this}}class c extends s{constructor(e){super({...e,format:"utf8"})}createBufferTranscoder(){return new o({encode:e=>r.from(this.encode(e),"utf8"),decode:e=>this.decode(e.toString("utf8")),name:`${this.name}+buffer`})}createViewTranscoder(){const{textEncoder:e,textDecoder:t}=i();return new a({encode:t=>e.encode(this.encode(t)),decode:e=>this.decode(t.decode(e)),name:`${this.name}+view`})}createUTF8Transcoder(){return this}}t.BufferFormat=o,t.ViewFormat=a,t.UTF8Format=c},944:function(e){"use strict";let t=null;e.exports=function(){return null===t&&(t={textEncoder:new TextEncoder,textDecoder:new TextDecoder}),t}},7914:function(e,t,n){t.Level=n(2547).BrowserLevel},9610:function(e,t,n){"use strict";n(7658);const r=n(7576),{hasOwnProperty:s}=Object.prototype,{propertyIsEnumerable:i}=Object,o=(e,t,n)=>Object.defineProperty(e,t,{value:n,writable:!0,enumerable:!0,configurable:!0}),a=this,c={concatArrays:!1,ignoreUndefined:!1},l=e=>{const t=[];for(const n in e)s.call(e,n)&&t.push(n);if(Object.getOwnPropertySymbols){const n=Object.getOwnPropertySymbols(e);for(const r of n)i.call(e,r)&&t.push(r)}return t};function u(e){return Array.isArray(e)?h(e):r(e)?d(e):e}function h(e){const t=e.slice(0,0);return l(e).forEach((n=>{o(t,n,u(e[n]))})),t}function d(e){const t=null===Object.getPrototypeOf(e)?Object.create(null):{};return l(e).forEach((n=>{o(t,n,u(e[n]))})),t}const p=(e,t,n,r)=>(n.forEach((n=>{"undefined"===typeof t[n]&&r.ignoreUndefined||(n in e&&e[n]!==Object.getPrototypeOf(e)?o(e,n,g(e[n],t[n],r)):o(e,n,u(t[n])))})),e),f=(e,t,n)=>{let r=e.slice(0,0),i=0;return[e,t].forEach((t=>{const a=[];for(let n=0;n<t.length;n++)s.call(t,n)&&(a.push(String(n)),o(r,i++,t===e?t[n]:u(t[n])));r=p(r,t,l(t).filter((e=>!a.includes(e))),n)})),r};function g(e,t,n){return n.concatArrays&&Array.isArray(e)&&Array.isArray(t)?f(e,t,n):r(t)&&r(e)?p(e,t,l(t),n):u(t)}e.exports=function(...e){const t=g(u(c),this!==a&&this||{},c);let n={_:{}};for(const s of e)if(void 0!==s){if(!r(s))throw new TypeError("`"+s+"` is not an Option Object");n=g(n,{_:s},t)}return n._}},7368:function(e){"use strict";e.exports=class extends Error{constructor(e,t){super(e||""),"object"===typeof t&&null!==t&&(t.code&&(this.code=String(t.code)),t.expected&&(this.expected=!0),t.transient&&(this.transient=!0),t.cause&&(this.cause=t.cause)),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}}},8806:function(e){var t=1e3,n=60*t,r=60*n,s=24*r,i=7*s,o=365.25*s;function a(e){if(e=String(e),!(e.length>100)){var a=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(a){var c=parseFloat(a[1]),l=(a[2]||"ms").toLowerCase();switch(l){case"years":case"year":case"yrs":case"yr":case"y":return c*o;case"weeks":case"week":case"w":return c*i;case"days":case"day":case"d":return c*s;case"hours":case"hour":case"hrs":case"hr":case"h":return c*r;case"minutes":case"minute":case"mins":case"min":case"m":return c*n;case"seconds":case"second":case"secs":case"sec":case"s":return c*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}function c(e){var i=Math.abs(e);return i>=s?Math.round(e/s)+"d":i>=r?Math.round(e/r)+"h":i>=n?Math.round(e/n)+"m":i>=t?Math.round(e/t)+"s":e+"ms"}function l(e){var i=Math.abs(e);return i>=s?u(e,i,s,"day"):i>=r?u(e,i,r,"hour"):i>=n?u(e,i,n,"minute"):i>=t?u(e,i,t,"second"):e+" ms"}function u(e,t,n,r){var s=t>=1.5*n;return Math.round(e/n)+" "+r+(s?"s":"")}e.exports=function(e,t){t=t||{};var n=typeof e;if("string"===n&&e.length>0)return a(e);if("number"===n&&isFinite(e))return t.long?l(e):c(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},512:function(e,t,n){e.exports=n(2820)},2820:function(e,t){(function(n,r){"use strict";var s={version:"3.0.0",x86:{},x64:{},inputValidation:!0};function i(e){if(!Array.isArray(e)&&!ArrayBuffer.isView(e))return!1;for(var t=0;t<e.length;t++)if(!Number.isInteger(e[t])||e[t]<0||e[t]>255)return!1;return!0}function o(e,t){return(65535&e)*t+(((e>>>16)*t&65535)<<16)}function a(e,t){return e<<t|e>>>32-t}function c(e){return e^=e>>>16,e=o(e,2246822507),e^=e>>>13,e=o(e,3266489909),e^=e>>>16,e}function l(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]+t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]+t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]+t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]+t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function u(e,t){e=[e[0]>>>16,65535&e[0],e[1]>>>16,65535&e[1]],t=[t[0]>>>16,65535&t[0],t[1]>>>16,65535&t[1]];var n=[0,0,0,0];return n[3]+=e[3]*t[3],n[2]+=n[3]>>>16,n[3]&=65535,n[2]+=e[2]*t[3],n[1]+=n[2]>>>16,n[2]&=65535,n[2]+=e[3]*t[2],n[1]+=n[2]>>>16,n[2]&=65535,n[1]+=e[1]*t[3],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[2]*t[2],n[0]+=n[1]>>>16,n[1]&=65535,n[1]+=e[3]*t[1],n[0]+=n[1]>>>16,n[1]&=65535,n[0]+=e[0]*t[3]+e[1]*t[2]+e[2]*t[1]+e[3]*t[0],n[0]&=65535,[n[0]<<16|n[1],n[2]<<16|n[3]]}function h(e,t){return t%=64,32===t?[e[1],e[0]]:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t|e[0]>>>32-t]:(t-=32,[e[1]<<t|e[0]>>>32-t,e[0]<<t|e[1]>>>32-t])}function d(e,t){return t%=64,0===t?e:t<32?[e[0]<<t|e[1]>>>32-t,e[1]<<t]:[e[1]<<t-32,0]}function p(e,t){return[e[0]^t[0],e[1]^t[1]]}function f(e){return e=p(e,[0,e[0]>>>1]),e=u(e,[4283543511,3981806797]),e=p(e,[0,e[0]>>>1]),e=u(e,[3301882366,444984403]),e=p(e,[0,e[0]>>>1]),e}s.x86.hash32=function(e,t){if(s.inputValidation&&!i(e))return r;t=t||0;for(var n=e.length%4,l=e.length-n,u=t,h=0,d=3432918353,p=461845907,f=0;f<l;f+=4)h=e[f]|e[f+1]<<8|e[f+2]<<16|e[f+3]<<24,h=o(h,d),h=a(h,15),h=o(h,p),u^=h,u=a(u,13),u=o(u,5)+3864292196;switch(h=0,n){case 3:h^=e[f+2]<<16;case 2:h^=e[f+1]<<8;case 1:h^=e[f],h=o(h,d),h=a(h,15),h=o(h,p),u^=h}return u^=e.length,u=c(u),u>>>0},s.x86.hash128=function(e,t){if(s.inputValidation&&!i(e))return r;t=t||0;for(var n=e.length%16,l=e.length-n,u=t,h=t,d=t,p=t,f=0,g=0,m=0,y=0,w=597399067,b=2869860233,v=951274213,E=2716044179,_=0;_<l;_+=16)f=e[_]|e[_+1]<<8|e[_+2]<<16|e[_+3]<<24,g=e[_+4]|e[_+5]<<8|e[_+6]<<16|e[_+7]<<24,m=e[_+8]|e[_+9]<<8|e[_+10]<<16|e[_+11]<<24,y=e[_+12]|e[_+13]<<8|e[_+14]<<16|e[_+15]<<24,f=o(f,w),f=a(f,15),f=o(f,b),u^=f,u=a(u,19),u+=h,u=o(u,5)+1444728091,g=o(g,b),g=a(g,16),g=o(g,v),h^=g,h=a(h,17),h+=d,h=o(h,5)+197830471,m=o(m,v),m=a(m,17),m=o(m,E),d^=m,d=a(d,15),d+=p,d=o(d,5)+2530024501,y=o(y,E),y=a(y,18),y=o(y,w),p^=y,p=a(p,13),p+=u,p=o(p,5)+850148119;switch(f=0,g=0,m=0,y=0,n){case 15:y^=e[_+14]<<16;case 14:y^=e[_+13]<<8;case 13:y^=e[_+12],y=o(y,E),y=a(y,18),y=o(y,w),p^=y;case 12:m^=e[_+11]<<24;case 11:m^=e[_+10]<<16;case 10:m^=e[_+9]<<8;case 9:m^=e[_+8],m=o(m,v),m=a(m,17),m=o(m,E),d^=m;case 8:g^=e[_+7]<<24;case 7:g^=e[_+6]<<16;case 6:g^=e[_+5]<<8;case 5:g^=e[_+4],g=o(g,b),g=a(g,16),g=o(g,v),h^=g;case 4:f^=e[_+3]<<24;case 3:f^=e[_+2]<<16;case 2:f^=e[_+1]<<8;case 1:f^=e[_],f=o(f,w),f=a(f,15),f=o(f,b),u^=f}return u^=e.length,h^=e.length,d^=e.length,p^=e.length,u+=h,u+=d,u+=p,h+=u,d+=u,p+=u,u=c(u),h=c(h),d=c(d),p=c(p),u+=h,u+=d,u+=p,h+=u,d+=u,p+=u,("00000000"+(u>>>0).toString(16)).slice(-8)+("00000000"+(h>>>0).toString(16)).slice(-8)+("00000000"+(d>>>0).toString(16)).slice(-8)+("00000000"+(p>>>0).toString(16)).slice(-8)},s.x64.hash128=function(e,t){if(s.inputValidation&&!i(e))return r;t=t||0;for(var n=e.length%16,o=e.length-n,a=[0,t],c=[0,t],g=[0,0],m=[0,0],y=[2277735313,289559509],w=[1291169091,658871167],b=0;b<o;b+=16)g=[e[b+4]|e[b+5]<<8|e[b+6]<<16|e[b+7]<<24,e[b]|e[b+1]<<8|e[b+2]<<16|e[b+3]<<24],m=[e[b+12]|e[b+13]<<8|e[b+14]<<16|e[b+15]<<24,e[b+8]|e[b+9]<<8|e[b+10]<<16|e[b+11]<<24],g=u(g,y),g=h(g,31),g=u(g,w),a=p(a,g),a=h(a,27),a=l(a,c),a=l(u(a,[0,5]),[0,1390208809]),m=u(m,w),m=h(m,33),m=u(m,y),c=p(c,m),c=h(c,31),c=l(c,a),c=l(u(c,[0,5]),[0,944331445]);switch(g=[0,0],m=[0,0],n){case 15:m=p(m,d([0,e[b+14]],48));case 14:m=p(m,d([0,e[b+13]],40));case 13:m=p(m,d([0,e[b+12]],32));case 12:m=p(m,d([0,e[b+11]],24));case 11:m=p(m,d([0,e[b+10]],16));case 10:m=p(m,d([0,e[b+9]],8));case 9:m=p(m,[0,e[b+8]]),m=u(m,w),m=h(m,33),m=u(m,y),c=p(c,m);case 8:g=p(g,d([0,e[b+7]],56));case 7:g=p(g,d([0,e[b+6]],48));case 6:g=p(g,d([0,e[b+5]],40));case 5:g=p(g,d([0,e[b+4]],32));case 4:g=p(g,d([0,e[b+3]],24));case 3:g=p(g,d([0,e[b+2]],16));case 2:g=p(g,d([0,e[b+1]],8));case 1:g=p(g,[0,e[b]]),g=u(g,y),g=h(g,31),g=u(g,w),a=p(a,g)}return a=p(a,[0,e.length]),c=p(c,[0,e.length]),a=l(a,c),c=l(c,a),a=f(a),c=f(c),a=l(a,c),c=l(c,a),("00000000"+(a[0]>>>0).toString(16)).slice(-8)+("00000000"+(a[1]>>>0).toString(16)).slice(-8)+("00000000"+(c[0]>>>0).toString(16)).slice(-8)+("00000000"+(c[1]>>>0).toString(16)).slice(-8)},e.exports&&(t=e.exports=s),t.murmurHash3=s})()},2163:function(e){"use strict";function t(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}e.exports=function(e){var n=void 0,r=void 0;function s(e){if(!(e instanceof Object))throw new Error('Target "'+e+'" is not an object');r=e}function i(e){Object.keys(e).forEach((function(t){var n=e[t];if("function"!==typeof n)throw new Error('Trap "'+t+": "+n+'" is not a function');if(!Reflect[t])throw new Error('Trap "'+t+": "+n+'" is not a valid trap')})),n=e}s((function(){})),e&&s(e),i(Reflect);var o=new Proxy({},{get:function(e,s){return function(){for(var e=arguments.length,i=Array(e),o=0;o<e;o++)i[o]=arguments[o];return n[s].apply(null,[r].concat(t(i.slice(1))))}}});return{setTarget:s,setHandler:i,getTarget:function(){return r},getHandler:function(){return n},proxy:new Proxy(r,o)}}},2346:function(e,t,n){n(7658),function(){var e,n,r,s,i,o,a,c;c=function(e){var t,n,r,s;return t=(e&255<<24)>>>24,n=(e&255<<16)>>>16,r=(65280&e)>>>8,s=255&e,[t,n,r,s].join(".")},a=function(e){var t,r,s,i,o,a;for(t=[],s=i=0;i<=3;s=++i){if(0===e.length)break;if(s>0){if("."!==e[0])throw new Error("Invalid IP");e=e.substring(1)}a=n(e),o=a[0],r=a[1],e=e.substring(r),t.push(o)}if(0!==e.length)throw new Error("Invalid IP");switch(t.length){case 1:if(t[0]>4294967295)throw new Error("Invalid IP");return t[0]>>>0;case 2:if(t[0]>255||t[1]>16777215)throw new Error("Invalid IP");return(t[0]<<24|t[1])>>>0;case 3:if(t[0]>255||t[1]>255||t[2]>65535)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2])>>>0;case 4:if(t[0]>255||t[1]>255||t[2]>255||t[3]>255)throw new Error("Invalid IP");return(t[0]<<24|t[1]<<16|t[2]<<8|t[3])>>>0;default:throw new Error("Invalid IP")}},r=function(e){return e.charCodeAt(0)},s=r("0"),o=r("a"),i=r("A"),n=function(e){var t,n,a,c,l;c=0,t=10,n="9",a=0,e.length>1&&"0"===e[a]&&("x"===e[a+1]||"X"===e[a+1]?(a+=2,t=16):"0"<=e[a+1]&&e[a+1]<="9"&&(a++,t=8,n="7")),l=a;while(a<e.length){if("0"<=e[a]&&e[a]<=n)c=c*t+(r(e[a])-s)>>>0;else{if(16!==t)break;if("a"<=e[a]&&e[a]<="f")c=c*t+(10+r(e[a])-o)>>>0;else{if(!("A"<=e[a]&&e[a]<="F"))break;c=c*t+(10+r(e[a])-i)>>>0}}if(c>4294967295)throw new Error("too large");a++}if(a===l)throw new Error("empty octet");return[c,a]},e=function(){function e(e,t){var n,r,s;if("string"!==typeof e)throw new Error("Missing `net' parameter");if(t||(s=e.split("/",2),e=s[0],t=s[1]),t||(t=32),"string"===typeof t&&t.indexOf(".")>-1){try{this.maskLong=a(t)}catch(i){throw i,new Error("Invalid mask: "+t)}for(n=r=32;r>=0;n=--r)if(this.maskLong===4294967295<<32-n>>>0){this.bitmask=n;break}}else{if(!t&&0!==t)throw new Error("Invalid mask: empty");this.bitmask=parseInt(t,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0)}try{this.netLong=(a(e)&this.maskLong)>>>0}catch(i){throw i,new Error("Invalid net address: "+e)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+t);this.size=Math.pow(2,32-this.bitmask),this.base=c(this.netLong),this.mask=c(this.maskLong),this.hostmask=c(~this.maskLong),this.first=this.bitmask<=30?c(this.netLong+1):this.base,this.last=this.bitmask<=30?c(this.netLong+this.size-2):c(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?c(this.netLong+this.size-1):void 0}return e.prototype.contains=function(t){return"string"===typeof t&&(t.indexOf("/")>0||4!==t.split(".").length)&&(t=new e(t)),t instanceof e?this.contains(t.base)&&this.contains(t.broadcast||t.last):(a(t)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},e.prototype.next=function(t){return null==t&&(t=1),new e(c(this.netLong+this.size*t),this.mask)},e.prototype.forEach=function(e){var t,n,r;r=a(this.first),n=a(this.last),t=0;while(r<=n)e(c(r),r,t),t++,r++},e.prototype.toString=function(){return this.base+"/"+this.bitmask},e}(),t.ip2long=a,t.long2ip=c,t.Netmask=e}.call(this)},6509:function(e,t,n){n(7658);var r=n(6143);function s(e,t){var n=function(){return new r.aes.Algorithm(e,t)};r.cipher.registerAlgorithm(e,n)}n(4403),n(2377),n(8666),e.exports=r.aes=r.aes||{},r.aes.startEncrypting=function(e,t,n,r){var s=g({key:e,output:n,decrypt:!1,mode:r});return s.start(t),s},r.aes.createEncryptionCipher=function(e,t){return g({key:e,output:null,decrypt:!1,mode:t})},r.aes.startDecrypting=function(e,t,n,r){var s=g({key:e,output:n,decrypt:!0,mode:r});return s.start(t),s},r.aes.createDecryptionCipher=function(e,t){return g({key:e,output:null,decrypt:!0,mode:t})},r.aes.Algorithm=function(e,t){u||d();var n=this;n.name=e,n.mode=new t({blockSize:16,cipher:{encrypt:function(e,t){return f(n._w,e,t,!1)},decrypt:function(e,t){return f(n._w,e,t,!0)}}}),n._init=!1},r.aes.Algorithm.prototype.initialize=function(e){if(!this._init){var t,n=e.key;if("string"!==typeof n||16!==n.length&&24!==n.length&&32!==n.length){if(r.util.isArray(n)&&(16===n.length||24===n.length||32===n.length)){t=n,n=r.util.createBuffer();for(var s=0;s<t.length;++s)n.putByte(t[s])}}else n=r.util.createBuffer(n);if(!r.util.isArray(n)){t=n,n=[];var i=t.length();if(16===i||24===i||32===i){i>>>=2;for(s=0;s<i;++s)n.push(t.getInt32())}}if(!r.util.isArray(n)||4!==n.length&&6!==n.length&&8!==n.length)throw new Error("Invalid key parameter.");var o=this.mode.name,a=-1!==["CFB","OFB","CTR","GCM"].indexOf(o);this._w=p(n,e.decrypt&&!a),this._init=!0}},r.aes._expandKey=function(e,t){return u||d(),p(e,t)},r.aes._updateBlock=f,s("AES-ECB",r.cipher.modes.ecb),s("AES-CBC",r.cipher.modes.cbc),s("AES-CFB",r.cipher.modes.cfb),s("AES-OFB",r.cipher.modes.ofb),s("AES-CTR",r.cipher.modes.ctr),s("AES-GCM",r.cipher.modes.gcm);var i,o,a,c,l,u=!1,h=4;function d(){u=!0,a=[0,1,2,4,8,16,32,64,128,27,54];for(var e=new Array(256),t=0;t<128;++t)e[t]=t<<1,e[t+128]=t+128<<1^283;i=new Array(256),o=new Array(256),c=new Array(4),l=new Array(4);for(t=0;t<4;++t)c[t]=new Array(256),l[t]=new Array(256);var n,r,s,h,d,p,f,g=0,m=0;for(t=0;t<256;++t){h=m^m<<1^m<<2^m<<3^m<<4,h=h>>8^255&h^99,i[g]=h,o[h]=g,d=e[h],n=e[g],r=e[n],s=e[r],p=d<<24^h<<16^h<<8^h^d,f=(n^r^s)<<24^(g^s)<<16^(g^r^s)<<8^g^n^s;for(var y=0;y<4;++y)c[y][g]=p,l[y][h]=f,p=p<<24|p>>>8,f=f<<24|f>>>8;0===g?g=m=1:(g=n^e[e[e[n^s]]],m^=e[e[m]])}}function p(e,t){for(var n,r=e.slice(0),s=1,o=r.length,c=o+6+1,u=h*c,d=o;d<u;++d)n=r[d-1],d%o===0?(n=i[n>>>16&255]<<24^i[n>>>8&255]<<16^i[255&n]<<8^i[n>>>24]^a[s]<<24,s++):o>6&&d%o===4&&(n=i[n>>>24]<<24^i[n>>>16&255]<<16^i[n>>>8&255]<<8^i[255&n]),r[d]=r[d-o]^n;if(t){var p,f=l[0],g=l[1],m=l[2],y=l[3],w=r.slice(0);u=r.length;d=0;for(var b=u-h;d<u;d+=h,b-=h)if(0===d||d===u-h)w[d]=r[b],w[d+1]=r[b+3],w[d+2]=r[b+2],w[d+3]=r[b+1];else for(var v=0;v<h;++v)p=r[b+v],w[d+(3&-v)]=f[i[p>>>24]]^g[i[p>>>16&255]]^m[i[p>>>8&255]]^y[i[255&p]];r=w}return r}function f(e,t,n,r){var s,a,u,h,d,p,f,g,m,y,w,b,v=e.length/4-1;r?(s=l[0],a=l[1],u=l[2],h=l[3],d=o):(s=c[0],a=c[1],u=c[2],h=c[3],d=i),p=t[0]^e[0],f=t[r?3:1]^e[1],g=t[2]^e[2],m=t[r?1:3]^e[3];for(var E=3,_=1;_<v;++_)y=s[p>>>24]^a[f>>>16&255]^u[g>>>8&255]^h[255&m]^e[++E],w=s[f>>>24]^a[g>>>16&255]^u[m>>>8&255]^h[255&p]^e[++E],b=s[g>>>24]^a[m>>>16&255]^u[p>>>8&255]^h[255&f]^e[++E],m=s[m>>>24]^a[p>>>16&255]^u[f>>>8&255]^h[255&g]^e[++E],p=y,f=w,g=b;n[0]=d[p>>>24]<<24^d[f>>>16&255]<<16^d[g>>>8&255]<<8^d[255&m]^e[++E],n[r?3:1]=d[f>>>24]<<24^d[g>>>16&255]<<16^d[m>>>8&255]<<8^d[255&p]^e[++E],n[2]=d[g>>>24]<<24^d[m>>>16&255]<<16^d[p>>>8&255]<<8^d[255&f]^e[++E],n[r?1:3]=d[m>>>24]<<24^d[p>>>16&255]<<16^d[f>>>8&255]<<8^d[255&g]^e[++E]}function g(e){e=e||{};var t,n=(e.mode||"CBC").toUpperCase(),s="AES-"+n;t=e.decrypt?r.cipher.createDecipher(s,e.key):r.cipher.createCipher(s,e.key);var i=t.start;return t.start=function(e,n){var s=null;n instanceof r.util.ByteBuffer&&(s=n,n={}),n=n||{},n.output=s,n.iv=e,i.call(t,n)},t}},3655:function(e,t,n){n(7658);var r=n(6143);n(8666),n(5828);var s=e.exports=r.asn1=r.asn1||{};function i(e,t,n){if(n>t){var r=new Error("Too few bytes to parse DER.");throw r.available=e.length(),r.remaining=t,r.requested=n,r}}s.Class={UNIVERSAL:0,APPLICATION:64,CONTEXT_SPECIFIC:128,PRIVATE:192},s.Type={NONE:0,BOOLEAN:1,INTEGER:2,BITSTRING:3,OCTETSTRING:4,NULL:5,OID:6,ODESC:7,EXTERNAL:8,REAL:9,ENUMERATED:10,EMBEDDED:11,UTF8:12,ROID:13,SEQUENCE:16,SET:17,PRINTABLESTRING:19,IA5STRING:22,UTCTIME:23,GENERALIZEDTIME:24,BMPSTRING:30},s.create=function(e,t,n,i,o){if(r.util.isArray(i)){for(var a=[],c=0;c<i.length;++c)void 0!==i[c]&&a.push(i[c]);i=a}var l={tagClass:e,type:t,constructed:n,composed:n||r.util.isArray(i),value:i};return o&&"bitStringContents"in o&&(l.bitStringContents=o.bitStringContents,l.original=s.copy(l)),l},s.copy=function(e,t){var n;if(r.util.isArray(e)){n=[];for(var i=0;i<e.length;++i)n.push(s.copy(e[i],t));return n}return"string"===typeof e?e:(n={tagClass:e.tagClass,type:e.type,constructed:e.constructed,composed:e.composed,value:s.copy(e.value,t)},t&&!t.excludeBitStringContents&&(n.bitStringContents=e.bitStringContents),n)},s.equals=function(e,t,n){if(r.util.isArray(e)){if(!r.util.isArray(t))return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(!s.equals(e[i],t[i]))return!1;return!0}if(typeof e!==typeof t)return!1;if("string"===typeof e)return e===t;var o=e.tagClass===t.tagClass&&e.type===t.type&&e.constructed===t.constructed&&e.composed===t.composed&&s.equals(e.value,t.value);return n&&n.includeBitStringContents&&(o=o&&e.bitStringContents===t.bitStringContents),o},s.getBerValueLength=function(e){var t=e.getByte();if(128!==t){var n,r=128&t;return n=r?e.getInt((127&t)<<3):t,n}};var o=function(e,t){var n=e.getByte();if(t--,128!==n){var r,s=128&n;if(s){var o=127&n;i(e,t,o),r=e.getInt(o<<3)}else r=n;if(r<0)throw new Error("Negative length: "+r);return r}};function a(e,t,n,r){var c;i(e,t,2);var l=e.getByte();t--;var u=192&l,h=31&l;c=e.length();var d,p,f=o(e,t);if(t-=c-e.length(),void 0!==f&&f>t){if(r.strict){var g=new Error("Too few bytes to read ASN.1 value.");throw g.available=e.length(),g.remaining=t,g.requested=f,g}f=t}var m=32===(32&l);if(m)if(d=[],void 0===f)for(;;){if(i(e,t,2),e.bytes(2)===String.fromCharCode(0,0)){e.getBytes(2),t-=2;break}c=e.length(),d.push(a(e,t,n+1,r)),t-=c-e.length()}else while(f>0)c=e.length(),d.push(a(e,f,n+1,r)),t-=c-e.length(),f-=c-e.length();if(void 0===d&&u===s.Class.UNIVERSAL&&h===s.Type.BITSTRING&&(p=e.bytes(f)),void 0===d&&r.decodeBitStrings&&u===s.Class.UNIVERSAL&&h===s.Type.BITSTRING&&f>1){var y=e.read,w=t,b=0;if(h===s.Type.BITSTRING&&(i(e,t,1),b=e.getByte(),t--),0===b)try{c=e.length();var v={strict:!0,decodeBitStrings:!0},E=a(e,t,n+1,v),_=c-e.length();t-=_,h==s.Type.BITSTRING&&_++;var S=E.tagClass;_!==f||S!==s.Class.UNIVERSAL&&S!==s.Class.CONTEXT_SPECIFIC||(d=[E])}catch(A){}void 0===d&&(e.read=y,t=w)}if(void 0===d){if(void 0===f){if(r.strict)throw new Error("Non-constructed ASN.1 object of indefinite length.");f=t}if(h===s.Type.BMPSTRING)for(d="";f>0;f-=2)i(e,t,2),d+=String.fromCharCode(e.getInt16()),t-=2;else d=e.getBytes(f),t-=f}var k=void 0===p?null:{bitStringContents:p};return s.create(u,h,m,d,k)}s.fromDer=function(e,t){void 0===t&&(t={strict:!0,parseAllBytes:!0,decodeBitStrings:!0}),"boolean"===typeof t&&(t={strict:t,parseAllBytes:!0,decodeBitStrings:!0}),"strict"in t||(t.strict=!0),"parseAllBytes"in t||(t.parseAllBytes=!0),"decodeBitStrings"in t||(t.decodeBitStrings=!0),"string"===typeof e&&(e=r.util.createBuffer(e));var n=e.length(),s=a(e,e.length(),0,t);if(t.parseAllBytes&&0!==e.length()){var i=new Error("Unparsed DER bytes remain after ASN.1 parsing.");throw i.byteCount=n,i.remaining=e.length(),i}return s},s.toDer=function(e){var t=r.util.createBuffer(),n=e.tagClass|e.type,i=r.util.createBuffer(),o=!1;if("bitStringContents"in e&&(o=!0,e.original&&(o=s.equals(e,e.original))),o)i.putBytes(e.bitStringContents);else if(e.composed){e.constructed?n|=32:i.putByte(0);for(var a=0;a<e.value.length;++a)void 0!==e.value[a]&&i.putBuffer(s.toDer(e.value[a]))}else if(e.type===s.Type.BMPSTRING)for(a=0;a<e.value.length;++a)i.putInt16(e.value.charCodeAt(a));else e.type===s.Type.INTEGER&&e.value.length>1&&(0===e.value.charCodeAt(0)&&0===(128&e.value.charCodeAt(1))||255===e.value.charCodeAt(0)&&128===(128&e.value.charCodeAt(1)))?i.putBytes(e.value.substr(1)):i.putBytes(e.value);if(t.putByte(n),i.length()<=127)t.putByte(127&i.length());else{var c=i.length(),l="";do{l+=String.fromCharCode(255&c),c>>>=8}while(c>0);t.putByte(128|l.length);for(a=l.length-1;a>=0;--a)t.putByte(l.charCodeAt(a))}return t.putBuffer(i),t},s.oidToDer=function(e){var t,n,s,i,o=e.split("."),a=r.util.createBuffer();a.putByte(40*parseInt(o[0],10)+parseInt(o[1],10));for(var c=2;c<o.length;++c){t=!0,n=[],s=parseInt(o[c],10);do{i=127&s,s>>>=7,t||(i|=128),n.push(i),t=!1}while(s>0);for(var l=n.length-1;l>=0;--l)a.putByte(n[l])}return a},s.derToOid=function(e){var t;"string"===typeof e&&(e=r.util.createBuffer(e));var n=e.getByte();t=Math.floor(n/40)+"."+n%40;var s=0;while(e.length()>0)n=e.getByte(),s<<=7,128&n?s+=127&n:(t+="."+(s+n),s=0);return t},s.utcTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,2),10);n=n>=50?1900+n:2e3+n;var r=parseInt(e.substr(2,2),10)-1,s=parseInt(e.substr(4,2),10),i=parseInt(e.substr(6,2),10),o=parseInt(e.substr(8,2),10),a=0;if(e.length>11){var c=e.charAt(10),l=10;"+"!==c&&"-"!==c&&(a=parseInt(e.substr(10,2),10),l+=2)}if(t.setUTCFullYear(n,r,s),t.setUTCHours(i,o,a,0),l&&(c=e.charAt(l),"+"===c||"-"===c)){var u=parseInt(e.substr(l+1,2),10),h=parseInt(e.substr(l+4,2),10),d=60*u+h;d*=6e4,"+"===c?t.setTime(+t-d):t.setTime(+t+d)}return t},s.generalizedTimeToDate=function(e){var t=new Date,n=parseInt(e.substr(0,4),10),r=parseInt(e.substr(4,2),10)-1,s=parseInt(e.substr(6,2),10),i=parseInt(e.substr(8,2),10),o=parseInt(e.substr(10,2),10),a=parseInt(e.substr(12,2),10),c=0,l=0,u=!1;"Z"===e.charAt(e.length-1)&&(u=!0);var h=e.length-5,d=e.charAt(h);if("+"===d||"-"===d){var p=parseInt(e.substr(h+1,2),10),f=parseInt(e.substr(h+4,2),10);l=60*p+f,l*=6e4,"+"===d&&(l*=-1),u=!0}return"."===e.charAt(14)&&(c=1e3*parseFloat(e.substr(14),10)),u?(t.setUTCFullYear(n,r,s),t.setUTCHours(i,o,a,c),t.setTime(+t+l)):(t.setFullYear(n,r,s),t.setHours(i,o,a,c)),t},s.dateToUtcTime=function(e){if("string"===typeof e)return e;var t="",n=[];n.push((""+e.getUTCFullYear()).substr(2)),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(t+="0"),t+=n[r];return t+="Z",t},s.dateToGeneralizedTime=function(e){if("string"===typeof e)return e;var t="",n=[];n.push(""+e.getUTCFullYear()),n.push(""+(e.getUTCMonth()+1)),n.push(""+e.getUTCDate()),n.push(""+e.getUTCHours()),n.push(""+e.getUTCMinutes()),n.push(""+e.getUTCSeconds());for(var r=0;r<n.length;++r)n[r].length<2&&(t+="0"),t+=n[r];return t+="Z",t},s.integerToDer=function(e){var t=r.util.createBuffer();if(e>=-128&&e<128)return t.putSignedInt(e,8);if(e>=-32768&&e<32768)return t.putSignedInt(e,16);if(e>=-8388608&&e<8388608)return t.putSignedInt(e,24);if(e>=-2147483648&&e<2147483648)return t.putSignedInt(e,32);var n=new Error("Integer too large; max is 32-bits.");throw n.integer=e,n},s.derToInteger=function(e){"string"===typeof e&&(e=r.util.createBuffer(e));var t=8*e.length();if(t>32)throw new Error("Integer too large; max is 32-bits.");return e.getSignedInt(t)},s.validate=function(e,t,n,i){var o=!1;if(e.tagClass!==t.tagClass&&"undefined"!==typeof t.tagClass||e.type!==t.type&&"undefined"!==typeof t.type)i&&(e.tagClass!==t.tagClass&&i.push("["+t.name+'] Expected tag class "'+t.tagClass+'", got "'+e.tagClass+'"'),e.type!==t.type&&i.push("["+t.name+'] Expected type "'+t.type+'", got "'+e.type+'"'));else if(e.constructed===t.constructed||"undefined"===typeof t.constructed){if(o=!0,t.value&&r.util.isArray(t.value))for(var a=0,c=0;o&&c<t.value.length;++c)o=t.value[c].optional||!1,e.value[a]&&(o=s.validate(e.value[a],t.value[c],n,i),o?++a:t.value[c].optional&&(o=!0)),!o&&i&&i.push("["+t.name+'] Tag class "'+t.tagClass+'", type "'+t.type+'" expected value length "'+t.value.length+'", got "'+e.value.length+'"');if(o&&n)if(t.capture&&(n[t.capture]=e.value),t.captureAsn1&&(n[t.captureAsn1]=e),t.captureBitStringContents&&"bitStringContents"in e&&(n[t.captureBitStringContents]=e.bitStringContents),t.captureBitStringValue&&"bitStringContents"in e)if(e.bitStringContents.length<2)n[t.captureBitStringValue]="";else{var l=e.bitStringContents.charCodeAt(0);if(0!==l)throw new Error("captureBitStringValue only supported for zero unused bits");n[t.captureBitStringValue]=e.bitStringContents.slice(1)}}else i&&i.push("["+t.name+'] Expected constructed "'+t.constructed+'", got "'+e.constructed+'"');return o};var c=/[^\\u0000-\\u00ff]/;s.prettyPrint=function(e,t,n){var i="";t=t||0,n=n||2,t>0&&(i+="\n");for(var o="",a=0;a<t*n;++a)o+=" ";switch(i+=o+"Tag: ",e.tagClass){case s.Class.UNIVERSAL:i+="Universal:";break;case s.Class.APPLICATION:i+="Application:";break;case s.Class.CONTEXT_SPECIFIC:i+="Context-Specific:";break;case s.Class.PRIVATE:i+="Private:";break}if(e.tagClass===s.Class.UNIVERSAL)switch(i+=e.type,e.type){case s.Type.NONE:i+=" (None)";break;case s.Type.BOOLEAN:i+=" (Boolean)";break;case s.Type.INTEGER:i+=" (Integer)";break;case s.Type.BITSTRING:i+=" (Bit string)";break;case s.Type.OCTETSTRING:i+=" (Octet string)";break;case s.Type.NULL:i+=" (Null)";break;case s.Type.OID:i+=" (Object Identifier)";break;case s.Type.ODESC:i+=" (Object Descriptor)";break;case s.Type.EXTERNAL:i+=" (External or Instance of)";break;case s.Type.REAL:i+=" (Real)";break;case s.Type.ENUMERATED:i+=" (Enumerated)";break;case s.Type.EMBEDDED:i+=" (Embedded PDV)";break;case s.Type.UTF8:i+=" (UTF8)";break;case s.Type.ROID:i+=" (Relative Object Identifier)";break;case s.Type.SEQUENCE:i+=" (Sequence)";break;case s.Type.SET:i+=" (Set)";break;case s.Type.PRINTABLESTRING:i+=" (Printable String)";break;case s.Type.IA5String:i+=" (IA5String (ASCII))";break;case s.Type.UTCTIME:i+=" (UTC time)";break;case s.Type.GENERALIZEDTIME:i+=" (Generalized time)";break;case s.Type.BMPSTRING:i+=" (BMP String)";break}else i+=e.type;if(i+="\n",i+=o+"Constructed: "+e.constructed+"\n",e.composed){var l=0,u="";for(a=0;a<e.value.length;++a)void 0!==e.value[a]&&(l+=1,u+=s.prettyPrint(e.value[a],t+1,n),a+1<e.value.length&&(u+=","));i+=o+"Sub values: "+l+u}else{if(i+=o+"Value: ",e.type===s.Type.OID){var h=s.derToOid(e.value);i+=h,r.pki&&r.pki.oids&&h in r.pki.oids&&(i+=" ("+r.pki.oids[h]+") ")}if(e.type===s.Type.INTEGER)try{i+=s.derToInteger(e.value)}catch(p){i+="0x"+r.util.bytesToHex(e.value)}else if(e.type===s.Type.BITSTRING){if(e.value.length>1?i+="0x"+r.util.bytesToHex(e.value.slice(1)):i+="(none)",e.value.length>0){var d=e.value.charCodeAt(0);1==d?i+=" (1 unused bit shown)":d>1&&(i+=" ("+d+" unused bits shown)")}}else if(e.type===s.Type.OCTETSTRING)c.test(e.value)||(i+="("+e.value+") "),i+="0x"+r.util.bytesToHex(e.value);else if(e.type===s.Type.UTF8)try{i+=r.util.decodeUtf8(e.value)}catch(f){if("URI malformed"!==f.message)throw f;i+="0x"+r.util.bytesToHex(e.value)+" (malformed UTF8)"}else e.type===s.Type.PRINTABLESTRING||e.type===s.Type.IA5String?i+=e.value:c.test(e.value)?i+="0x"+r.util.bytesToHex(e.value):0===e.value.length?i+="[null]":i+=e.value}return i}},3441:function(e,t,n){n(3767),n(8585),n(8696),n(7658);var r={};e.exports=r;var s={};function i(e,t){var n=0,r=t.length,s=t.charAt(0),i=[0];for(n=0;n<e.length();++n){for(var o=0,a=e.at(n);o<i.length;++o)a+=i[o]<<8,i[o]=a%r,a=a/r|0;while(a>0)i.push(a%r),a=a/r|0}var c="";for(n=0;0===e.at(n)&&n<e.length()-1;++n)c+=s;for(n=i.length-1;n>=0;--n)c+=t[i[n]];return c}r.encode=function(e,t,n){if("string"!==typeof t)throw new TypeError('"alphabet" must be a string.');if(void 0!==n&&"number"!==typeof n)throw new TypeError('"maxline" must be a number.');var r="";if(e instanceof Uint8Array){var s=0,o=t.length,a=t.charAt(0),c=[0];for(s=0;s<e.length;++s){for(var l=0,u=e[s];l<c.length;++l)u+=c[l]<<8,c[l]=u%o,u=u/o|0;while(u>0)c.push(u%o),u=u/o|0}for(s=0;0===e[s]&&s<e.length-1;++s)r+=a;for(s=c.length-1;s>=0;--s)r+=t[c[s]]}else r=i(e,t);if(n){var h=new RegExp(".{1,"+n+"}","g");r=r.match(h).join("\r\n")}return r},r.decode=function(e,t){if("string"!==typeof e)throw new TypeError('"input" must be a string.');if("string"!==typeof t)throw new TypeError('"alphabet" must be a string.');var n=s[t];if(!n){n=s[t]=[];for(var r=0;r<t.length;++r)n[t.charCodeAt(r)]=r}e=e.replace(/\s/g,"");var i=t.length,o=t.charAt(0),a=[0];for(r=0;r<e.length;r++){var c=n[e.charCodeAt(r)];if(void 0===c)return;for(var l=0,u=c;l<a.length;++l)u+=a[l]*i,a[l]=255&u,u>>=8;while(u>0)a.push(255&u),u>>=8}for(var h=0;e[h]===o&&h<e.length-1;++h)a.push(0);return"undefined"!==typeof Buffer?Buffer.from(a.reverse()):new Uint8Array(a.reverse())}},4403:function(e,t,n){var r=n(6143);n(8666),e.exports=r.cipher=r.cipher||{},r.cipher.algorithms=r.cipher.algorithms||{},r.cipher.createCipher=function(e,t){var n=e;if("string"===typeof n&&(n=r.cipher.getAlgorithm(n),n&&(n=n())),!n)throw new Error("Unsupported algorithm: "+e);return new r.cipher.BlockCipher({algorithm:n,key:t,decrypt:!1})},r.cipher.createDecipher=function(e,t){var n=e;if("string"===typeof n&&(n=r.cipher.getAlgorithm(n),n&&(n=n())),!n)throw new Error("Unsupported algorithm: "+e);return new r.cipher.BlockCipher({algorithm:n,key:t,decrypt:!0})},r.cipher.registerAlgorithm=function(e,t){e=e.toUpperCase(),r.cipher.algorithms[e]=t},r.cipher.getAlgorithm=function(e){return e=e.toUpperCase(),e in r.cipher.algorithms?r.cipher.algorithms[e]:null};var s=r.cipher.BlockCipher=function(e){this.algorithm=e.algorithm,this.mode=this.algorithm.mode,this.blockSize=this.mode.blockSize,this._finish=!1,this._input=null,this.output=null,this._op=e.decrypt?this.mode.decrypt:this.mode.encrypt,this._decrypt=e.decrypt,this.algorithm.initialize(e)};s.prototype.start=function(e){e=e||{};var t={};for(var n in e)t[n]=e[n];t.decrypt=this._decrypt,this._finish=!1,this._input=r.util.createBuffer(),this.output=e.output||r.util.createBuffer(),this.mode.start(t)},s.prototype.update=function(e){e&&this._input.putBuffer(e);while(!this._op.call(this.mode,this._input,this.output,this._finish)&&!this._finish);this._input.compact()},s.prototype.finish=function(e){!e||"ECB"!==this.mode.name&&"CBC"!==this.mode.name||(this.mode.pad=function(t){return e(this.blockSize,t,!1)},this.mode.unpad=function(t){return e(this.blockSize,t,!0)});var t={};return t.decrypt=this._decrypt,t.overflow=this._input.length()%this.blockSize,!(!this._decrypt&&this.mode.pad&&!this.mode.pad(this._input,t))&&(this._finish=!0,this.update(),!(this._decrypt&&this.mode.unpad&&!this.mode.unpad(this.output,t))&&!(this.mode.afterFinish&&!this.mode.afterFinish(this.output,t)))}},2377:function(e,t,n){n(7658);var r=n(6143);n(8666),r.cipher=r.cipher||{};var s=e.exports=r.cipher.modes=r.cipher.modes||{};function i(e,t){if("string"===typeof e&&(e=r.util.createBuffer(e)),r.util.isArray(e)&&e.length>4){var n=e;e=r.util.createBuffer();for(var s=0;s<n.length;++s)e.putByte(n[s])}if(e.length()<t)throw new Error("Invalid IV length; got "+e.length()+" bytes and expected "+t+" bytes.");if(!r.util.isArray(e)){var i=[],o=t/4;for(s=0;s<o;++s)i.push(e.getInt32());e=i}return e}function o(e){e[e.length-1]=e[e.length-1]+1&4294967295}function a(e){return[e/4294967296|0,4294967295&e]}s.ecb=function(e){e=e||{},this.name="ECB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},s.ecb.prototype.start=function(e){},s.ecb.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._outBlock[r])},s.ecb.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._outBlock[r])},s.ecb.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},s.ecb.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return!(r>this.blockSize<<2)&&(e.truncate(r),!0)},s.cbc=function(e){e=e||{},this.name="CBC",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints)},s.cbc.prototype.start=function(e){if(null===e.iv){if(!this._prev)throw new Error("Invalid IV parameter.");this._iv=this._prev.slice(0)}else{if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._prev=this._iv.slice(0)}},s.cbc.prototype.encrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=this._prev[r]^e.getInt32();this.cipher.encrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._outBlock[r]);this._prev=this._outBlock},s.cbc.prototype.decrypt=function(e,t,n){if(e.length()<this.blockSize&&!(n&&e.length()>0))return!0;for(var r=0;r<this._ints;++r)this._inBlock[r]=e.getInt32();this.cipher.decrypt(this._inBlock,this._outBlock);for(r=0;r<this._ints;++r)t.putInt32(this._prev[r]^this._outBlock[r]);this._prev=this._inBlock.slice(0)},s.cbc.prototype.pad=function(e,t){var n=e.length()===this.blockSize?this.blockSize:this.blockSize-e.length();return e.fillWithByte(n,n),!0},s.cbc.prototype.unpad=function(e,t){if(t.overflow>0)return!1;var n=e.length(),r=e.at(n-1);return!(r>this.blockSize<<2)&&(e.truncate(r),!0)},s.cfb=function(e){e=e||{},this.name="CFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},s.cfb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.cfb.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var s=0;s<this._ints;++s)this._inBlock[s]=e.getInt32()^this._outBlock[s],t.putInt32(this._inBlock[s]);else{var i=(this.blockSize-r)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(s=0;s<this._ints;++s)this._partialBlock[s]=e.getInt32()^this._outBlock[s],this._partialOutput.putInt32(this._partialBlock[s]);if(i>0)e.read-=this.blockSize;else for(s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!n)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},s.cfb.prototype.decrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var s=0;s<this._ints;++s)this._inBlock[s]=e.getInt32(),t.putInt32(this._inBlock[s]^this._outBlock[s]);else{var i=(this.blockSize-r)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(s=0;s<this._ints;++s)this._partialBlock[s]=e.getInt32(),this._partialOutput.putInt32(this._partialBlock[s]^this._outBlock[s]);if(i>0)e.read-=this.blockSize;else for(s=0;s<this._ints;++s)this._inBlock[s]=this._partialBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!n)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},s.ofb=function(e){e=e||{},this.name="OFB",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},s.ofb.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.ofb.prototype.encrypt=function(e,t,n){var r=e.length();if(0===e.length())return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var s=0;s<this._ints;++s)t.putInt32(e.getInt32()^this._outBlock[s]),this._inBlock[s]=this._outBlock[s];else{var i=(this.blockSize-r)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(s=0;s<this._ints;++s)this._partialOutput.putInt32(e.getInt32()^this._outBlock[s]);if(i>0)e.read-=this.blockSize;else for(s=0;s<this._ints;++s)this._inBlock[s]=this._outBlock[s];if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!n)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}},s.ofb.prototype.decrypt=s.ofb.prototype.encrypt,s.ctr=function(e){e=e||{},this.name="CTR",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=null,this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0},s.ctr.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");this._iv=i(e.iv,this.blockSize),this._inBlock=this._iv.slice(0),this._partialBytes=0},s.ctr.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize)for(var s=0;s<this._ints;++s)t.putInt32(e.getInt32()^this._outBlock[s]);else{var i=(this.blockSize-r)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(s=0;s<this._ints;++s)this._partialOutput.putInt32(e.getInt32()^this._outBlock[s]);if(i>0&&(e.read-=this.blockSize),this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!n)return t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}o(this._inBlock)},s.ctr.prototype.decrypt=s.ctr.prototype.encrypt,s.gcm=function(e){e=e||{},this.name="GCM",this.cipher=e.cipher,this.blockSize=e.blockSize||16,this._ints=this.blockSize/4,this._inBlock=new Array(this._ints),this._outBlock=new Array(this._ints),this._partialOutput=r.util.createBuffer(),this._partialBytes=0,this._R=3774873600},s.gcm.prototype.start=function(e){if(!("iv"in e))throw new Error("Invalid IV parameter.");var t,n=r.util.createBuffer(e.iv);if(this._cipherLength=0,t="additionalData"in e?r.util.createBuffer(e.additionalData):r.util.createBuffer(),this._tagLength="tagLength"in e?e.tagLength:128,this._tag=null,e.decrypt&&(this._tag=r.util.createBuffer(e.tag).getBytes(),this._tag.length!==this._tagLength/8))throw new Error("Authentication tag does not match tag length.");this._hashBlock=new Array(this._ints),this.tag=null,this._hashSubkey=new Array(this._ints),this.cipher.encrypt([0,0,0,0],this._hashSubkey),this.componentBits=4,this._m=this.generateHashTable(this._hashSubkey,this.componentBits);var s=n.length();if(12===s)this._j0=[n.getInt32(),n.getInt32(),n.getInt32(),1];else{this._j0=[0,0,0,0];while(n.length()>0)this._j0=this.ghash(this._hashSubkey,this._j0,[n.getInt32(),n.getInt32(),n.getInt32(),n.getInt32()]);this._j0=this.ghash(this._hashSubkey,this._j0,[0,0].concat(a(8*s)))}this._inBlock=this._j0.slice(0),o(this._inBlock),this._partialBytes=0,t=r.util.createBuffer(t),this._aDataLength=a(8*t.length());var i=t.length()%this.blockSize;i&&t.fillWithByte(0,this.blockSize-i),this._s=[0,0,0,0];while(t.length()>0)this._s=this.ghash(this._hashSubkey,this._s,[t.getInt32(),t.getInt32(),t.getInt32(),t.getInt32()])},s.gcm.prototype.encrypt=function(e,t,n){var r=e.length();if(0===r)return!0;if(this.cipher.encrypt(this._inBlock,this._outBlock),0===this._partialBytes&&r>=this.blockSize){for(var s=0;s<this._ints;++s)t.putInt32(this._outBlock[s]^=e.getInt32());this._cipherLength+=this.blockSize}else{var i=(this.blockSize-r)%this.blockSize;i>0&&(i=this.blockSize-i),this._partialOutput.clear();for(s=0;s<this._ints;++s)this._partialOutput.putInt32(e.getInt32()^this._outBlock[s]);if(i<=0||n){if(n){var a=r%this.blockSize;this._cipherLength+=a,this._partialOutput.truncate(this.blockSize-a)}else this._cipherLength+=this.blockSize;for(s=0;s<this._ints;++s)this._outBlock[s]=this._partialOutput.getInt32();this._partialOutput.read-=this.blockSize}if(this._partialBytes>0&&this._partialOutput.getBytes(this._partialBytes),i>0&&!n)return e.read-=this.blockSize,t.putBytes(this._partialOutput.getBytes(i-this._partialBytes)),this._partialBytes=i,!0;t.putBytes(this._partialOutput.getBytes(r-this._partialBytes)),this._partialBytes=0}this._s=this.ghash(this._hashSubkey,this._s,this._outBlock),o(this._inBlock)},s.gcm.prototype.decrypt=function(e,t,n){var r=e.length();if(r<this.blockSize&&!(n&&r>0))return!0;this.cipher.encrypt(this._inBlock,this._outBlock),o(this._inBlock),this._hashBlock[0]=e.getInt32(),this._hashBlock[1]=e.getInt32(),this._hashBlock[2]=e.getInt32(),this._hashBlock[3]=e.getInt32(),this._s=this.ghash(this._hashSubkey,this._s,this._hashBlock);for(var s=0;s<this._ints;++s)t.putInt32(this._outBlock[s]^this._hashBlock[s]);r<this.blockSize?this._cipherLength+=r%this.blockSize:this._cipherLength+=this.blockSize},s.gcm.prototype.afterFinish=function(e,t){var n=!0;t.decrypt&&t.overflow&&e.truncate(this.blockSize-t.overflow),this.tag=r.util.createBuffer();var s=this._aDataLength.concat(a(8*this._cipherLength));this._s=this.ghash(this._hashSubkey,this._s,s);var i=[];this.cipher.encrypt(this._j0,i);for(var o=0;o<this._ints;++o)this.tag.putInt32(this._s[o]^i[o]);return this.tag.truncate(this.tag.length()%(this._tagLength/8)),t.decrypt&&this.tag.bytes()!==this._tag&&(n=!1),n},s.gcm.prototype.multiply=function(e,t){for(var n=[0,0,0,0],r=t.slice(0),s=0;s<128;++s){var i=e[s/32|0]&1<<31-s%32;i&&(n[0]^=r[0],n[1]^=r[1],n[2]^=r[2],n[3]^=r[3]),this.pow(r,r)}return n},s.gcm.prototype.pow=function(e,t){for(var n=1&e[3],r=3;r>0;--r)t[r]=e[r]>>>1|(1&e[r-1])<<31;t[0]=e[0]>>>1,n&&(t[0]^=this._R)},s.gcm.prototype.tableMultiply=function(e){for(var t=[0,0,0,0],n=0;n<32;++n){var r=n/8|0,s=e[r]>>>4*(7-n%8)&15,i=this._m[n][s];t[0]^=i[0],t[1]^=i[1],t[2]^=i[2],t[3]^=i[3]}return t},s.gcm.prototype.ghash=function(e,t,n){return t[0]^=n[0],t[1]^=n[1],t[2]^=n[2],t[3]^=n[3],this.tableMultiply(t)},s.gcm.prototype.generateHashTable=function(e,t){for(var n=8/t,r=4*n,s=16*n,i=new Array(s),o=0;o<s;++o){var a=[0,0,0,0],c=o/r|0,l=(r-1-o%r)*t;a[c]=1<<t-1<<l,i[o]=this.generateSubHashTable(this.multiply(a,e),t)}return i},s.gcm.prototype.generateSubHashTable=function(e,t){var n=1<<t,r=n>>>1,s=new Array(n);s[r]=e.slice(0);var i=r>>>1;while(i>0)this.pow(s[2*i],s[i]=[]),i>>=1;i=2;while(i<r){for(var o=1;o<i;++o){var a=s[i],c=s[o];s[i+o]=[a[0]^c[0],a[1]^c[1],a[2]^c[2],a[3]^c[3]]}i*=2}for(s[0]=[0,0,0,0],i=r+1;i<n;++i){var l=s[i^r];s[i]=[e[0]^l[0],e[1]^l[1],e[2]^l[2],e[3]^l[3]]}return s}},1202:function(e,t,n){var r=n(6143);function s(e,t){var n=function(){return new r.des.Algorithm(e,t)};r.cipher.registerAlgorithm(e,n)}n(4403),n(2377),n(8666),e.exports=r.des=r.des||{},r.des.startEncrypting=function(e,t,n,r){var s=g({key:e,output:n,decrypt:!1,mode:r||(null===t?"ECB":"CBC")});return s.start(t),s},r.des.createEncryptionCipher=function(e,t){return g({key:e,output:null,decrypt:!1,mode:t})},r.des.startDecrypting=function(e,t,n,r){var s=g({key:e,output:n,decrypt:!0,mode:r||(null===t?"ECB":"CBC")});return s.start(t),s},r.des.createDecryptionCipher=function(e,t){return g({key:e,output:null,decrypt:!0,mode:t})},r.des.Algorithm=function(e,t){var n=this;n.name=e,n.mode=new t({blockSize:8,cipher:{encrypt:function(e,t){return f(n._keys,e,t,!1)},decrypt:function(e,t){return f(n._keys,e,t,!0)}}}),n._init=!1},r.des.Algorithm.prototype.initialize=function(e){if(!this._init){var t=r.util.createBuffer(e.key);if(0===this.name.indexOf("3DES")&&24!==t.length())throw new Error("Invalid Triple-DES key size: "+8*t.length());this._keys=p(t),this._init=!0}},s("DES-ECB",r.cipher.modes.ecb),s("DES-CBC",r.cipher.modes.cbc),s("DES-CFB",r.cipher.modes.cfb),s("DES-OFB",r.cipher.modes.ofb),s("DES-CTR",r.cipher.modes.ctr),s("3DES-ECB",r.cipher.modes.ecb),s("3DES-CBC",r.cipher.modes.cbc),s("3DES-CFB",r.cipher.modes.cfb),s("3DES-OFB",r.cipher.modes.ofb),s("3DES-CTR",r.cipher.modes.ctr);var i=[16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756],o=[-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344],a=[520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584],c=[8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928],l=[256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080],u=[536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312],h=[2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154],d=[268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696];function p(e){for(var t,n=[0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964],r=[0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697],s=[0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272],i=[0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144],o=[0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256],a=[0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488],c=[0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746],l=[0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568],u=[0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578],h=[0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488],d=[0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800],p=[0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744],f=[0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128],g=[0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261],m=e.length()>8?3:1,y=[],w=[0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0],b=0,v=0;v<m;v++){var E=e.getInt32(),_=e.getInt32();t=252645135&(E>>>4^_),_^=t,E^=t<<4,t=65535&(_>>>-16^E),E^=t,_^=t<<-16,t=858993459&(E>>>2^_),_^=t,E^=t<<2,t=65535&(_>>>-16^E),E^=t,_^=t<<-16,t=1431655765&(E>>>1^_),_^=t,E^=t<<1,t=16711935&(_>>>8^E),E^=t,_^=t<<8,t=1431655765&(E>>>1^_),_^=t,E^=t<<1,t=E<<8|_>>>20&240,E=_<<24|_<<8&16711680|_>>>8&65280|_>>>24&240,_=t;for(var S=0;S<w.length;++S){w[S]?(E=E<<2|E>>>26,_=_<<2|_>>>26):(E=E<<1|E>>>27,_=_<<1|_>>>27),E&=-15,_&=-15;var k=n[E>>>28]|r[E>>>24&15]|s[E>>>20&15]|i[E>>>16&15]|o[E>>>12&15]|a[E>>>8&15]|c[E>>>4&15],A=l[_>>>28]|u[_>>>24&15]|h[_>>>20&15]|d[_>>>16&15]|p[_>>>12&15]|f[_>>>8&15]|g[_>>>4&15];t=65535&(A>>>16^k),y[b++]=k^t,y[b++]=A^t<<16}}return y}function f(e,t,n,r){var s,p,f=32===e.length?3:9;s=3===f?r?[30,-2,-2]:[0,32,2]:r?[94,62,-2,32,64,2,30,-2,-2]:[0,32,2,62,30,-2,64,96,2];var g=t[0],m=t[1];p=252645135&(g>>>4^m),m^=p,g^=p<<4,p=65535&(g>>>16^m),m^=p,g^=p<<16,p=858993459&(m>>>2^g),g^=p,m^=p<<2,p=16711935&(m>>>8^g),g^=p,m^=p<<8,p=1431655765&(g>>>1^m),m^=p,g^=p<<1,g=g<<1|g>>>31,m=m<<1|m>>>31;for(var y=0;y<f;y+=3){for(var w=s[y+1],b=s[y+2],v=s[y];v!=w;v+=b){var E=m^e[v],_=(m>>>4|m<<28)^e[v+1];p=g,g=m,m=p^(o[E>>>24&63]|c[E>>>16&63]|u[E>>>8&63]|d[63&E]|i[_>>>24&63]|a[_>>>16&63]|l[_>>>8&63]|h[63&_])}p=g,g=m,m=p}g=g>>>1|g<<31,m=m>>>1|m<<31,p=1431655765&(g>>>1^m),m^=p,g^=p<<1,p=16711935&(m>>>8^g),g^=p,m^=p<<8,p=858993459&(m>>>2^g),g^=p,m^=p<<2,p=65535&(g>>>16^m),m^=p,g^=p<<16,p=252645135&(g>>>4^m),m^=p,g^=p<<4,n[0]=g,n[1]=m}function g(e){e=e||{};var t,n=(e.mode||"CBC").toUpperCase(),s="DES-"+n;t=e.decrypt?r.cipher.createDecipher(s,e.key):r.cipher.createCipher(s,e.key);var i=t.start;return t.start=function(e,n){var s=null;n instanceof r.util.ByteBuffer&&(s=n,n={}),n=n||{},n.output=s,n.iv=e,i.call(t,n)},t}},6143:function(e){e.exports={options:{usePureJavaScript:!1}}},1818:function(e,t,n){var r=n(6143);n(2713),n(8666);var s=e.exports=r.hmac=r.hmac||{};s.create=function(){var e=null,t=null,n=null,s=null,i={start:function(i,o){if(null!==i)if("string"===typeof i){if(i=i.toLowerCase(),!(i in r.md.algorithms))throw new Error('Unknown hash algorithm "'+i+'"');t=r.md.algorithms[i].create()}else t=i;if(null===o)o=e;else{if("string"===typeof o)o=r.util.createBuffer(o);else if(r.util.isArray(o)){var a=o;o=r.util.createBuffer();for(var c=0;c<a.length;++c)o.putByte(a[c])}var l=o.length();l>t.blockLength&&(t.start(),t.update(o.bytes()),o=t.digest()),n=r.util.createBuffer(),s=r.util.createBuffer(),l=o.length();for(c=0;c<l;++c){a=o.at(c);n.putByte(54^a),s.putByte(92^a)}if(l<t.blockLength)for(a=t.blockLength-l,c=0;c<a;++c)n.putByte(54),s.putByte(92);e=o,n=n.bytes(),s=s.bytes()}t.start(),t.update(n)},update:function(e){t.update(e)},getMac:function(){var e=t.digest().bytes();return t.start(),t.update(s),t.update(e),t.digest()}};return i.digest=i.getMac,i}},3322:function(e,t,n){var r,s=n(6143);e.exports=s.jsbn=s.jsbn||{};var i=0xdeadbeefcafe,o=15715070==(16777215&i);function a(e,t,n){this.data=[],null!=e&&("number"==typeof e?this.fromNumber(e,t,n):null==t&&"string"!=typeof e?this.fromString(e,256):this.fromString(e,t))}function c(){return new a(null)}function l(e,t,n,r,s,i){while(--i>=0){var o=t*this.data[e++]+n.data[r]+s;s=Math.floor(o/67108864),n.data[r++]=67108863&o}return s}function u(e,t,n,r,s,i){var o=32767&t,a=t>>15;while(--i>=0){var c=32767&this.data[e],l=this.data[e++]>>15,u=a*c+l*o;c=o*c+((32767&u)<<15)+n.data[r]+(1073741823&s),s=(c>>>30)+(u>>>15)+a*l+(s>>>30),n.data[r++]=1073741823&c}return s}function h(e,t,n,r,s,i){var o=16383&t,a=t>>14;while(--i>=0){var c=16383&this.data[e],l=this.data[e++]>>14,u=a*c+l*o;c=o*c+((16383&u)<<14)+n.data[r]+s,s=(c>>28)+(u>>14)+a*l,n.data[r++]=268435455&c}return s}s.jsbn.BigInteger=a,"undefined"===typeof navigator?(a.prototype.am=h,r=28):o&&"Microsoft Internet Explorer"==navigator.appName?(a.prototype.am=u,r=30):o&&"Netscape"!=navigator.appName?(a.prototype.am=l,r=26):(a.prototype.am=h,r=28),a.prototype.DB=r,a.prototype.DM=(1<<r)-1,a.prototype.DV=1<<r;var d=52;a.prototype.FV=Math.pow(2,d),a.prototype.F1=d-r,a.prototype.F2=2*r-d;var p,f,g="0123456789abcdefghijklmnopqrstuvwxyz",m=new Array;for(p="0".charCodeAt(0),f=0;f<=9;++f)m[p++]=f;for(p="a".charCodeAt(0),f=10;f<36;++f)m[p++]=f;for(p="A".charCodeAt(0),f=10;f<36;++f)m[p++]=f;function y(e){return g.charAt(e)}function w(e,t){var n=m[e.charCodeAt(t)];return null==n?-1:n}function b(e){for(var t=this.t-1;t>=0;--t)e.data[t]=this.data[t];e.t=this.t,e.s=this.s}function v(e){this.t=1,this.s=e<0?-1:0,e>0?this.data[0]=e:e<-1?this.data[0]=e+this.DV:this.t=0}function E(e){var t=c();return t.fromInt(e),t}function _(e,t){var n;if(16==t)n=4;else if(8==t)n=3;else if(256==t)n=8;else if(2==t)n=1;else if(32==t)n=5;else{if(4!=t)return void this.fromRadix(e,t);n=2}this.t=0,this.s=0;var r=e.length,s=!1,i=0;while(--r>=0){var o=8==n?255&e[r]:w(e,r);o<0?"-"==e.charAt(r)&&(s=!0):(s=!1,0==i?this.data[this.t++]=o:i+n>this.DB?(this.data[this.t-1]|=(o&(1<<this.DB-i)-1)<<i,this.data[this.t++]=o>>this.DB-i):this.data[this.t-1]|=o<<i,i+=n,i>=this.DB&&(i-=this.DB))}8==n&&0!=(128&e[0])&&(this.s=-1,i>0&&(this.data[this.t-1]|=(1<<this.DB-i)-1<<i)),this.clamp(),s&&a.ZERO.subTo(this,this)}function S(){var e=this.s&this.DM;while(this.t>0&&this.data[this.t-1]==e)--this.t}function k(e){if(this.s<0)return"-"+this.negate().toString(e);var t;if(16==e)t=4;else if(8==e)t=3;else if(2==e)t=1;else if(32==e)t=5;else{if(4!=e)return this.toRadix(e);t=2}var n,r=(1<<t)-1,s=!1,i="",o=this.t,a=this.DB-o*this.DB%t;if(o-- >0){a<this.DB&&(n=this.data[o]>>a)>0&&(s=!0,i=y(n));while(o>=0)a<t?(n=(this.data[o]&(1<<a)-1)<<t-a,n|=this.data[--o]>>(a+=this.DB-t)):(n=this.data[o]>>(a-=t)&r,a<=0&&(a+=this.DB,--o)),n>0&&(s=!0),s&&(i+=y(n))}return s?i:"0"}function A(){var e=c();return a.ZERO.subTo(this,e),e}function T(){return this.s<0?this.negate():this}function C(e){var t=this.s-e.s;if(0!=t)return t;var n=this.t;if(t=n-e.t,0!=t)return this.s<0?-t:t;while(--n>=0)if(0!=(t=this.data[n]-e.data[n]))return t;return 0}function I(e){var t,n=1;return 0!=(t=e>>>16)&&(e=t,n+=16),0!=(t=e>>8)&&(e=t,n+=8),0!=(t=e>>4)&&(e=t,n+=4),0!=(t=e>>2)&&(e=t,n+=2),0!=(t=e>>1)&&(e=t,n+=1),n}function R(){return this.t<=0?0:this.DB*(this.t-1)+I(this.data[this.t-1]^this.s&this.DM)}function O(e,t){var n;for(n=this.t-1;n>=0;--n)t.data[n+e]=this.data[n];for(n=e-1;n>=0;--n)t.data[n]=0;t.t=this.t+e,t.s=this.s}function x(e,t){for(var n=e;n<this.t;++n)t.data[n-e]=this.data[n];t.t=Math.max(this.t-e,0),t.s=this.s}function N(e,t){var n,r=e%this.DB,s=this.DB-r,i=(1<<s)-1,o=Math.floor(e/this.DB),a=this.s<<r&this.DM;for(n=this.t-1;n>=0;--n)t.data[n+o+1]=this.data[n]>>s|a,a=(this.data[n]&i)<<r;for(n=o-1;n>=0;--n)t.data[n]=0;t.data[o]=a,t.t=this.t+o+1,t.s=this.s,t.clamp()}function D(e,t){t.s=this.s;var n=Math.floor(e/this.DB);if(n>=this.t)t.t=0;else{var r=e%this.DB,s=this.DB-r,i=(1<<r)-1;t.data[0]=this.data[n]>>r;for(var o=n+1;o<this.t;++o)t.data[o-n-1]|=(this.data[o]&i)<<s,t.data[o-n]=this.data[o]>>r;r>0&&(t.data[this.t-n-1]|=(this.s&i)<<s),t.t=this.t-n,t.clamp()}}function P(e,t){var n=0,r=0,s=Math.min(e.t,this.t);while(n<s)r+=this.data[n]-e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r-=e.s;while(n<this.t)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r-=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r-=e.s}t.s=r<0?-1:0,r<-1?t.data[n++]=this.DV+r:r>0&&(t.data[n++]=r),t.t=n,t.clamp()}function L(e,t){var n=this.abs(),r=e.abs(),s=n.t;t.t=s+r.t;while(--s>=0)t.data[s]=0;for(s=0;s<r.t;++s)t.data[s+n.t]=n.am(0,r.data[s],t,s,0,n.t);t.s=0,t.clamp(),this.s!=e.s&&a.ZERO.subTo(t,t)}function M(e){var t=this.abs(),n=e.t=2*t.t;while(--n>=0)e.data[n]=0;for(n=0;n<t.t-1;++n){var r=t.am(n,t.data[n],e,2*n,0,1);(e.data[n+t.t]+=t.am(n+1,2*t.data[n],e,2*n+1,r,t.t-n-1))>=t.DV&&(e.data[n+t.t]-=t.DV,e.data[n+t.t+1]=1)}e.t>0&&(e.data[e.t-1]+=t.am(n,t.data[n],e,2*n,0,1)),e.s=0,e.clamp()}function B(e,t,n){var r=e.abs();if(!(r.t<=0)){var s=this.abs();if(s.t<r.t)return null!=t&&t.fromInt(0),void(null!=n&&this.copyTo(n));null==n&&(n=c());var i=c(),o=this.s,l=e.s,u=this.DB-I(r.data[r.t-1]);u>0?(r.lShiftTo(u,i),s.lShiftTo(u,n)):(r.copyTo(i),s.copyTo(n));var h=i.t,d=i.data[h-1];if(0!=d){var p=d*(1<<this.F1)+(h>1?i.data[h-2]>>this.F2:0),f=this.FV/p,g=(1<<this.F1)/p,m=1<<this.F2,y=n.t,w=y-h,b=null==t?c():t;i.dlShiftTo(w,b),n.compareTo(b)>=0&&(n.data[n.t++]=1,n.subTo(b,n)),a.ONE.dlShiftTo(h,b),b.subTo(i,i);while(i.t<h)i.data[i.t++]=0;while(--w>=0){var v=n.data[--y]==d?this.DM:Math.floor(n.data[y]*f+(n.data[y-1]+m)*g);if((n.data[y]+=i.am(0,v,n,w,0,h))<v){i.dlShiftTo(w,b),n.subTo(b,n);while(n.data[y]<--v)n.subTo(b,n)}}null!=t&&(n.drShiftTo(h,t),o!=l&&a.ZERO.subTo(t,t)),n.t=h,n.clamp(),u>0&&n.rShiftTo(u,n),o<0&&a.ZERO.subTo(n,n)}}}function U(e){var t=c();return this.abs().divRemTo(e,null,t),this.s<0&&t.compareTo(a.ZERO)>0&&e.subTo(t,t),t}function V(e){this.m=e}function F(e){return e.s<0||e.compareTo(this.m)>=0?e.mod(this.m):e}function j(e){return e}function z(e){e.divRemTo(this.m,null,e)}function $(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function H(e,t){e.squareTo(t),this.reduce(t)}function K(){if(this.t<1)return 0;var e=this.data[0];if(0==(1&e))return 0;var t=3&e;return t=t*(2-(15&e)*t)&15,t=t*(2-(255&e)*t)&255,t=t*(2-((65535&e)*t&65535))&65535,t=t*(2-e*t%this.DV)%this.DV,t>0?this.DV-t:-t}function q(e){this.m=e,this.mp=e.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<e.DB-15)-1,this.mt2=2*e.t}function G(e){var t=c();return e.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),e.s<0&&t.compareTo(a.ZERO)>0&&this.m.subTo(t,t),t}function W(e){var t=c();return e.copyTo(t),this.reduce(t),t}function Y(e){while(e.t<=this.mt2)e.data[e.t++]=0;for(var t=0;t<this.m.t;++t){var n=32767&e.data[t],r=n*this.mpl+((n*this.mph+(e.data[t]>>15)*this.mpl&this.um)<<15)&e.DM;n=t+this.m.t,e.data[n]+=this.m.am(0,r,e,t,0,this.m.t);while(e.data[n]>=e.DV)e.data[n]-=e.DV,e.data[++n]++}e.clamp(),e.drShiftTo(this.m.t,e),e.compareTo(this.m)>=0&&e.subTo(this.m,e)}function J(e,t){e.squareTo(t),this.reduce(t)}function Q(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function X(){return 0==(this.t>0?1&this.data[0]:this.s)}function Z(e,t){if(e>4294967295||e<1)return a.ONE;var n=c(),r=c(),s=t.convert(this),i=I(e)-1;s.copyTo(n);while(--i>=0)if(t.sqrTo(n,r),(e&1<<i)>0)t.mulTo(r,s,n);else{var o=n;n=r,r=o}return t.revert(n)}function ee(e,t){var n;return n=e<256||t.isEven()?new V(t):new q(t),this.exp(e,n)}function te(){var e=c();return this.copyTo(e),e}function ne(){if(this.s<0){if(1==this.t)return this.data[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this.data[0];if(0==this.t)return 0}return(this.data[1]&(1<<32-this.DB)-1)<<this.DB|this.data[0]}function re(){return 0==this.t?this.s:this.data[0]<<24>>24}function se(){return 0==this.t?this.s:this.data[0]<<16>>16}function ie(e){return Math.floor(Math.LN2*this.DB/Math.log(e))}function oe(){return this.s<0?-1:this.t<=0||1==this.t&&this.data[0]<=0?0:1}function ae(e){if(null==e&&(e=10),0==this.signum()||e<2||e>36)return"0";var t=this.chunkSize(e),n=Math.pow(e,t),r=E(n),s=c(),i=c(),o="";this.divRemTo(r,s,i);while(s.signum()>0)o=(n+i.intValue()).toString(e).substr(1)+o,s.divRemTo(r,s,i);return i.intValue().toString(e)+o}function ce(e,t){this.fromInt(0),null==t&&(t=10);for(var n=this.chunkSize(t),r=Math.pow(t,n),s=!1,i=0,o=0,c=0;c<e.length;++c){var l=w(e,c);l<0?"-"==e.charAt(c)&&0==this.signum()&&(s=!0):(o=t*o+l,++i>=n&&(this.dMultiply(r),this.dAddOffset(o,0),i=0,o=0))}i>0&&(this.dMultiply(Math.pow(t,i)),this.dAddOffset(o,0)),s&&a.ZERO.subTo(this,this)}function le(e,t,n){if("number"==typeof t)if(e<2)this.fromInt(1);else{this.fromNumber(e,n),this.testBit(e-1)||this.bitwiseTo(a.ONE.shiftLeft(e-1),ye,this),this.isEven()&&this.dAddOffset(1,0);while(!this.isProbablePrime(t))this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(a.ONE.shiftLeft(e-1),this)}else{var r=new Array,s=7&e;r.length=1+(e>>3),t.nextBytes(r),s>0?r[0]&=(1<<s)-1:r[0]=0,this.fromString(r,256)}}function ue(){var e=this.t,t=new Array;t[0]=this.s;var n,r=this.DB-e*this.DB%8,s=0;if(e-- >0){r<this.DB&&(n=this.data[e]>>r)!=(this.s&this.DM)>>r&&(t[s++]=n|this.s<<this.DB-r);while(e>=0)r<8?(n=(this.data[e]&(1<<r)-1)<<8-r,n|=this.data[--e]>>(r+=this.DB-8)):(n=this.data[e]>>(r-=8)&255,r<=0&&(r+=this.DB,--e)),0!=(128&n)&&(n|=-256),0==s&&(128&this.s)!=(128&n)&&++s,(s>0||n!=this.s)&&(t[s++]=n)}return t}function he(e){return 0==this.compareTo(e)}function de(e){return this.compareTo(e)<0?this:e}function pe(e){return this.compareTo(e)>0?this:e}function fe(e,t,n){var r,s,i=Math.min(e.t,this.t);for(r=0;r<i;++r)n.data[r]=t(this.data[r],e.data[r]);if(e.t<this.t){for(s=e.s&this.DM,r=i;r<this.t;++r)n.data[r]=t(this.data[r],s);n.t=this.t}else{for(s=this.s&this.DM,r=i;r<e.t;++r)n.data[r]=t(s,e.data[r]);n.t=e.t}n.s=t(this.s,e.s),n.clamp()}function ge(e,t){return e&t}function me(e){var t=c();return this.bitwiseTo(e,ge,t),t}function ye(e,t){return e|t}function we(e){var t=c();return this.bitwiseTo(e,ye,t),t}function be(e,t){return e^t}function ve(e){var t=c();return this.bitwiseTo(e,be,t),t}function Ee(e,t){return e&~t}function _e(e){var t=c();return this.bitwiseTo(e,Ee,t),t}function Se(){for(var e=c(),t=0;t<this.t;++t)e.data[t]=this.DM&~this.data[t];return e.t=this.t,e.s=~this.s,e}function ke(e){var t=c();return e<0?this.rShiftTo(-e,t):this.lShiftTo(e,t),t}function Ae(e){var t=c();return e<0?this.lShiftTo(-e,t):this.rShiftTo(e,t),t}function Te(e){if(0==e)return-1;var t=0;return 0==(65535&e)&&(e>>=16,t+=16),0==(255&e)&&(e>>=8,t+=8),0==(15&e)&&(e>>=4,t+=4),0==(3&e)&&(e>>=2,t+=2),0==(1&e)&&++t,t}function Ce(){for(var e=0;e<this.t;++e)if(0!=this.data[e])return e*this.DB+Te(this.data[e]);return this.s<0?this.t*this.DB:-1}function Ie(e){var t=0;while(0!=e)e&=e-1,++t;return t}function Re(){for(var e=0,t=this.s&this.DM,n=0;n<this.t;++n)e+=Ie(this.data[n]^t);return e}function Oe(e){var t=Math.floor(e/this.DB);return t>=this.t?0!=this.s:0!=(this.data[t]&1<<e%this.DB)}function xe(e,t){var n=a.ONE.shiftLeft(e);return this.bitwiseTo(n,t,n),n}function Ne(e){return this.changeBit(e,ye)}function De(e){return this.changeBit(e,Ee)}function Pe(e){return this.changeBit(e,be)}function Le(e,t){var n=0,r=0,s=Math.min(e.t,this.t);while(n<s)r+=this.data[n]+e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;if(e.t<this.t){r+=e.s;while(n<this.t)r+=this.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=this.s}else{r+=this.s;while(n<e.t)r+=e.data[n],t.data[n++]=r&this.DM,r>>=this.DB;r+=e.s}t.s=r<0?-1:0,r>0?t.data[n++]=r:r<-1&&(t.data[n++]=this.DV+r),t.t=n,t.clamp()}function Me(e){var t=c();return this.addTo(e,t),t}function Be(e){var t=c();return this.subTo(e,t),t}function Ue(e){var t=c();return this.multiplyTo(e,t),t}function Ve(e){var t=c();return this.divRemTo(e,t,null),t}function Fe(e){var t=c();return this.divRemTo(e,null,t),t}function je(e){var t=c(),n=c();return this.divRemTo(e,t,n),new Array(t,n)}function ze(e){this.data[this.t]=this.am(0,e-1,this,0,0,this.t),++this.t,this.clamp()}function $e(e,t){if(0!=e){while(this.t<=t)this.data[this.t++]=0;this.data[t]+=e;while(this.data[t]>=this.DV)this.data[t]-=this.DV,++t>=this.t&&(this.data[this.t++]=0),++this.data[t]}}function He(){}function Ke(e){return e}function qe(e,t,n){e.multiplyTo(t,n)}function Ge(e,t){e.squareTo(t)}function We(e){return this.exp(e,new He)}function Ye(e,t,n){var r,s=Math.min(this.t+e.t,t);n.s=0,n.t=s;while(s>0)n.data[--s]=0;for(r=n.t-this.t;s<r;++s)n.data[s+this.t]=this.am(0,e.data[s],n,s,0,this.t);for(r=Math.min(e.t,t);s<r;++s)this.am(0,e.data[s],n,s,0,t-s);n.clamp()}function Je(e,t,n){--t;var r=n.t=this.t+e.t-t;n.s=0;while(--r>=0)n.data[r]=0;for(r=Math.max(t-this.t,0);r<e.t;++r)n.data[this.t+r-t]=this.am(t-r,e.data[r],n,0,0,this.t+r-t);n.clamp(),n.drShiftTo(1,n)}function Qe(e){this.r2=c(),this.q3=c(),a.ONE.dlShiftTo(2*e.t,this.r2),this.mu=this.r2.divide(e),this.m=e}function Xe(e){if(e.s<0||e.t>2*this.m.t)return e.mod(this.m);if(e.compareTo(this.m)<0)return e;var t=c();return e.copyTo(t),this.reduce(t),t}function Ze(e){return e}function et(e){e.drShiftTo(this.m.t-1,this.r2),e.t>this.m.t+1&&(e.t=this.m.t+1,e.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);while(e.compareTo(this.r2)<0)e.dAddOffset(1,this.m.t+1);e.subTo(this.r2,e);while(e.compareTo(this.m)>=0)e.subTo(this.m,e)}function tt(e,t){e.squareTo(t),this.reduce(t)}function nt(e,t,n){e.multiplyTo(t,n),this.reduce(n)}function rt(e,t){var n,r,s=e.bitLength(),i=E(1);if(s<=0)return i;n=s<18?1:s<48?3:s<144?4:s<768?5:6,r=s<8?new V(t):t.isEven()?new Qe(t):new q(t);var o=new Array,a=3,l=n-1,u=(1<<n)-1;if(o[1]=r.convert(this),n>1){var h=c();r.sqrTo(o[1],h);while(a<=u)o[a]=c(),r.mulTo(h,o[a-2],o[a]),a+=2}var d,p,f=e.t-1,g=!0,m=c();s=I(e.data[f])-1;while(f>=0){s>=l?d=e.data[f]>>s-l&u:(d=(e.data[f]&(1<<s+1)-1)<<l-s,f>0&&(d|=e.data[f-1]>>this.DB+s-l)),a=n;while(0==(1&d))d>>=1,--a;if((s-=a)<0&&(s+=this.DB,--f),g)o[d].copyTo(i),g=!1;else{while(a>1)r.sqrTo(i,m),r.sqrTo(m,i),a-=2;a>0?r.sqrTo(i,m):(p=i,i=m,m=p),r.mulTo(m,o[d],i)}while(f>=0&&0==(e.data[f]&1<<s))r.sqrTo(i,m),p=i,i=m,m=p,--s<0&&(s=this.DB-1,--f)}return r.revert(i)}function st(e){var t=this.s<0?this.negate():this.clone(),n=e.s<0?e.negate():e.clone();if(t.compareTo(n)<0){var r=t;t=n,n=r}var s=t.getLowestSetBit(),i=n.getLowestSetBit();if(i<0)return t;s<i&&(i=s),i>0&&(t.rShiftTo(i,t),n.rShiftTo(i,n));while(t.signum()>0)(s=t.getLowestSetBit())>0&&t.rShiftTo(s,t),(s=n.getLowestSetBit())>0&&n.rShiftTo(s,n),t.compareTo(n)>=0?(t.subTo(n,t),t.rShiftTo(1,t)):(n.subTo(t,n),n.rShiftTo(1,n));return i>0&&n.lShiftTo(i,n),n}function it(e){if(e<=0)return 0;var t=this.DV%e,n=this.s<0?e-1:0;if(this.t>0)if(0==t)n=this.data[0]%e;else for(var r=this.t-1;r>=0;--r)n=(t*n+this.data[r])%e;return n}function ot(e){var t=e.isEven();if(this.isEven()&&t||0==e.signum())return a.ZERO;var n=e.clone(),r=this.clone(),s=E(1),i=E(0),o=E(0),c=E(1);while(0!=n.signum()){while(n.isEven())n.rShiftTo(1,n),t?(s.isEven()&&i.isEven()||(s.addTo(this,s),i.subTo(e,i)),s.rShiftTo(1,s)):i.isEven()||i.subTo(e,i),i.rShiftTo(1,i);while(r.isEven())r.rShiftTo(1,r),t?(o.isEven()&&c.isEven()||(o.addTo(this,o),c.subTo(e,c)),o.rShiftTo(1,o)):c.isEven()||c.subTo(e,c),c.rShiftTo(1,c);n.compareTo(r)>=0?(n.subTo(r,n),t&&s.subTo(o,s),i.subTo(c,i)):(r.subTo(n,r),t&&o.subTo(s,o),c.subTo(i,c))}return 0!=r.compareTo(a.ONE)?a.ZERO:c.compareTo(e)>=0?c.subtract(e):c.signum()<0?(c.addTo(e,c),c.signum()<0?c.add(e):c):c}V.prototype.convert=F,V.prototype.revert=j,V.prototype.reduce=z,V.prototype.mulTo=$,V.prototype.sqrTo=H,q.prototype.convert=G,q.prototype.revert=W,q.prototype.reduce=Y,q.prototype.mulTo=Q,q.prototype.sqrTo=J,a.prototype.copyTo=b,a.prototype.fromInt=v,a.prototype.fromString=_,a.prototype.clamp=S,a.prototype.dlShiftTo=O,a.prototype.drShiftTo=x,a.prototype.lShiftTo=N,a.prototype.rShiftTo=D,a.prototype.subTo=P,a.prototype.multiplyTo=L,a.prototype.squareTo=M,a.prototype.divRemTo=B,a.prototype.invDigit=K,a.prototype.isEven=X,a.prototype.exp=Z,a.prototype.toString=k,a.prototype.negate=A,a.prototype.abs=T,a.prototype.compareTo=C,a.prototype.bitLength=R,a.prototype.mod=U,a.prototype.modPowInt=ee,a.ZERO=E(0),a.ONE=E(1),He.prototype.convert=Ke,He.prototype.revert=Ke,He.prototype.mulTo=qe,He.prototype.sqrTo=Ge,Qe.prototype.convert=Xe,Qe.prototype.revert=Ze,Qe.prototype.reduce=et,Qe.prototype.mulTo=nt,Qe.prototype.sqrTo=tt;var at=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509],ct=(1<<26)/at[at.length-1];function lt(e){var t,n=this.abs();if(1==n.t&&n.data[0]<=at[at.length-1]){for(t=0;t<at.length;++t)if(n.data[0]==at[t])return!0;return!1}if(n.isEven())return!1;t=1;while(t<at.length){var r=at[t],s=t+1;while(s<at.length&&r<ct)r*=at[s++];r=n.modInt(r);while(t<s)if(r%at[t++]==0)return!1}return n.millerRabin(e)}function ut(e){var t=this.subtract(a.ONE),n=t.getLowestSetBit();if(n<=0)return!1;for(var r,s=t.shiftRight(n),i=ht(),o=0;o<e;++o){do{r=new a(this.bitLength(),i)}while(r.compareTo(a.ONE)<=0||r.compareTo(t)>=0);var c=r.modPow(s,this);if(0!=c.compareTo(a.ONE)&&0!=c.compareTo(t)){var l=1;while(l++<n&&0!=c.compareTo(t))if(c=c.modPowInt(2,this),0==c.compareTo(a.ONE))return!1;if(0!=c.compareTo(t))return!1}}return!0}function ht(){return{nextBytes:function(e){for(var t=0;t<e.length;++t)e[t]=Math.floor(256*Math.random())}}}a.prototype.chunkSize=ie,a.prototype.toRadix=ae,a.prototype.fromRadix=ce,a.prototype.fromNumber=le,a.prototype.bitwiseTo=fe,a.prototype.changeBit=xe,a.prototype.addTo=Le,a.prototype.dMultiply=ze,a.prototype.dAddOffset=$e,a.prototype.multiplyLowerTo=Ye,a.prototype.multiplyUpperTo=Je,a.prototype.modInt=it,a.prototype.millerRabin=ut,a.prototype.clone=te,a.prototype.intValue=ne,a.prototype.byteValue=re,a.prototype.shortValue=se,a.prototype.signum=oe,a.prototype.toByteArray=ue,a.prototype.equals=he,a.prototype.min=de,a.prototype.max=pe,a.prototype.and=me,a.prototype.or=we,a.prototype.xor=ve,a.prototype.andNot=_e,a.prototype.not=Se,a.prototype.shiftLeft=ke,a.prototype.shiftRight=Ae,a.prototype.getLowestSetBit=Ce,a.prototype.bitCount=Re,a.prototype.testBit=Oe,a.prototype.setBit=Ne,a.prototype.clearBit=De,a.prototype.flipBit=Pe,a.prototype.add=Me,a.prototype.subtract=Be,a.prototype.multiply=Ue,a.prototype.divide=Ve,a.prototype.remainder=Fe,a.prototype.divideAndRemainder=je,a.prototype.modPow=rt,a.prototype.modInverse=ot,a.prototype.pow=We,a.prototype.gcd=st,a.prototype.isProbablePrime=lt},2713:function(e,t,n){var r=n(6143);e.exports=r.md=r.md||{},r.md.algorithms=r.md.algorithms||{}},3232:function(e,t,n){var r=n(6143);n(2128),e.exports=r.mgf=r.mgf||{},r.mgf.mgf1=r.mgf1},2128:function(e,t,n){var r=n(6143);n(8666),r.mgf=r.mgf||{};var s=e.exports=r.mgf.mgf1=r.mgf1=r.mgf1||{};s.create=function(e){var t={generate:function(t,n){for(var s=new r.util.ByteBuffer,i=Math.ceil(n/e.digestLength),o=0;o<i;o++){var a=new r.util.ByteBuffer;a.putInt32(o),e.start(),e.update(t+a.getBytes()),s.putBuffer(e.digest())}return s.truncate(s.length()-n),s.getBytes()}};return t}},5828:function(e,t,n){var r=n(6143);r.pki=r.pki||{};var s=e.exports=r.pki.oids=r.oids=r.oids||{};function i(e,t){s[e]=t,s[t]=e}function o(e,t){s[e]=t}i("1.2.840.113549.1.1.1","rsaEncryption"),i("1.2.840.113549.1.1.4","md5WithRSAEncryption"),i("1.2.840.113549.1.1.5","sha1WithRSAEncryption"),i("1.2.840.113549.1.1.7","RSAES-OAEP"),i("1.2.840.113549.1.1.8","mgf1"),i("1.2.840.113549.1.1.9","pSpecified"),i("1.2.840.113549.1.1.10","RSASSA-PSS"),i("1.2.840.113549.1.1.11","sha256WithRSAEncryption"),i("1.2.840.113549.1.1.12","sha384WithRSAEncryption"),i("1.2.840.113549.1.1.13","sha512WithRSAEncryption"),i("1.3.101.112","EdDSA25519"),i("1.2.840.10040.4.3","dsa-with-sha1"),i("1.3.14.3.2.7","desCBC"),i("1.3.14.3.2.26","sha1"),i("1.3.14.3.2.29","sha1WithRSASignature"),i("2.16.840.1.101.3.4.2.1","sha256"),i("2.16.840.1.101.3.4.2.2","sha384"),i("2.16.840.1.101.3.4.2.3","sha512"),i("2.16.840.1.101.3.4.2.4","sha224"),i("2.16.840.1.101.3.4.2.5","sha512-224"),i("2.16.840.1.101.3.4.2.6","sha512-256"),i("1.2.840.113549.2.2","md2"),i("1.2.840.113549.2.5","md5"),i("1.2.840.113549.1.7.1","data"),i("1.2.840.113549.1.7.2","signedData"),i("1.2.840.113549.1.7.3","envelopedData"),i("1.2.840.113549.1.7.4","signedAndEnvelopedData"),i("1.2.840.113549.1.7.5","digestedData"),i("1.2.840.113549.1.7.6","encryptedData"),i("1.2.840.113549.1.9.1","emailAddress"),i("1.2.840.113549.1.9.2","unstructuredName"),i("1.2.840.113549.1.9.3","contentType"),i("1.2.840.113549.1.9.4","messageDigest"),i("1.2.840.113549.1.9.5","signingTime"),i("1.2.840.113549.1.9.6","counterSignature"),i("1.2.840.113549.1.9.7","challengePassword"),i("1.2.840.113549.1.9.8","unstructuredAddress"),i("1.2.840.113549.1.9.14","extensionRequest"),i("1.2.840.113549.1.9.20","friendlyName"),i("1.2.840.113549.1.9.21","localKeyId"),i("1.2.840.113549.1.9.22.1","x509Certificate"),i("1.2.840.113549.1.12.10.1.1","keyBag"),i("1.2.840.113549.1.12.10.1.2","pkcs8ShroudedKeyBag"),i("1.2.840.113549.1.12.10.1.3","certBag"),i("1.2.840.113549.1.12.10.1.4","crlBag"),i("1.2.840.113549.1.12.10.1.5","secretBag"),i("1.2.840.113549.1.12.10.1.6","safeContentsBag"),i("1.2.840.113549.1.5.13","pkcs5PBES2"),i("1.2.840.113549.1.5.12","pkcs5PBKDF2"),i("1.2.840.113549.1.12.1.1","pbeWithSHAAnd128BitRC4"),i("1.2.840.113549.1.12.1.2","pbeWithSHAAnd40BitRC4"),i("1.2.840.113549.1.12.1.3","pbeWithSHAAnd3-KeyTripleDES-CBC"),i("1.2.840.113549.1.12.1.4","pbeWithSHAAnd2-KeyTripleDES-CBC"),i("1.2.840.113549.1.12.1.5","pbeWithSHAAnd128BitRC2-CBC"),i("1.2.840.113549.1.12.1.6","pbewithSHAAnd40BitRC2-CBC"),i("1.2.840.113549.2.7","hmacWithSHA1"),i("1.2.840.113549.2.8","hmacWithSHA224"),i("1.2.840.113549.2.9","hmacWithSHA256"),i("1.2.840.113549.2.10","hmacWithSHA384"),i("1.2.840.113549.2.11","hmacWithSHA512"),i("1.2.840.113549.3.7","des-EDE3-CBC"),i("2.16.840.1.101.3.4.1.2","aes128-CBC"),i("2.16.840.1.101.3.4.1.22","aes192-CBC"),i("2.16.840.1.101.3.4.1.42","aes256-CBC"),i("2.5.4.3","commonName"),i("2.5.4.4","surname"),i("2.5.4.5","serialNumber"),i("2.5.4.6","countryName"),i("2.5.4.7","localityName"),i("2.5.4.8","stateOrProvinceName"),i("2.5.4.9","streetAddress"),i("2.5.4.10","organizationName"),i("2.5.4.11","organizationalUnitName"),i("2.5.4.12","title"),i("2.5.4.13","description"),i("2.5.4.15","businessCategory"),i("2.5.4.17","postalCode"),i("2.5.4.42","givenName"),i("1.3.6.1.4.1.311.60.2.1.2","jurisdictionOfIncorporationStateOrProvinceName"),i("1.3.6.1.4.1.311.60.2.1.3","jurisdictionOfIncorporationCountryName"),i("2.16.840.1.113730.1.1","nsCertType"),i("2.16.840.1.113730.1.13","nsComment"),o("2.5.29.1","authorityKeyIdentifier"),o("2.5.29.2","keyAttributes"),o("2.5.29.3","certificatePolicies"),o("2.5.29.4","keyUsageRestriction"),o("2.5.29.5","policyMapping"),o("2.5.29.6","subtreesConstraint"),o("2.5.29.7","subjectAltName"),o("2.5.29.8","issuerAltName"),o("2.5.29.9","subjectDirectoryAttributes"),o("2.5.29.10","basicConstraints"),o("2.5.29.11","nameConstraints"),o("2.5.29.12","policyConstraints"),o("2.5.29.13","basicConstraints"),i("2.5.29.14","subjectKeyIdentifier"),i("2.5.29.15","keyUsage"),o("2.5.29.16","privateKeyUsagePeriod"),i("2.5.29.17","subjectAltName"),i("2.5.29.18","issuerAltName"),i("2.5.29.19","basicConstraints"),o("2.5.29.20","cRLNumber"),o("2.5.29.21","cRLReason"),o("2.5.29.22","expirationDate"),o("2.5.29.23","instructionCode"),o("2.5.29.24","invalidityDate"),o("2.5.29.25","cRLDistributionPoints"),o("2.5.29.26","issuingDistributionPoint"),o("2.5.29.27","deltaCRLIndicator"),o("2.5.29.28","issuingDistributionPoint"),o("2.5.29.29","certificateIssuer"),o("2.5.29.30","nameConstraints"),i("2.5.29.31","cRLDistributionPoints"),i("2.5.29.32","certificatePolicies"),o("2.5.29.33","policyMappings"),o("2.5.29.34","policyConstraints"),i("2.5.29.35","authorityKeyIdentifier"),o("2.5.29.36","policyConstraints"),i("2.5.29.37","extKeyUsage"),o("2.5.29.46","freshestCRL"),o("2.5.29.54","inhibitAnyPolicy"),i("1.3.6.1.4.1.11129.2.4.2","timestampList"),i("1.3.6.1.5.5.7.1.1","authorityInfoAccess"),i("1.3.6.1.5.5.7.3.1","serverAuth"),i("1.3.6.1.5.5.7.3.2","clientAuth"),i("1.3.6.1.5.5.7.3.3","codeSigning"),i("1.3.6.1.5.5.7.3.4","emailProtection"),i("1.3.6.1.5.5.7.3.8","timeStamping")},8774:function(e,t,n){n(7658);var r=n(6143);if(n(6509),n(3655),n(1202),n(2713),n(5828),n(3350),n(8277),n(8584),n(3398),n(536),n(8666),"undefined"===typeof s)var s=r.jsbn.BigInteger;var i=r.asn1,o=r.pki=r.pki||{};e.exports=o.pbe=r.pbe=r.pbe||{};var a=o.oids,c={name:"EncryptedPrivateKeyInfo",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedPrivateKeyInfo.encryptionAlgorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encryptionOid"},{name:"AlgorithmIdentifier.parameters",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,captureAsn1:"encryptionParams"}]},{name:"EncryptedPrivateKeyInfo.encryptedData",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encryptedData"}]},l={name:"PBES2Algorithms",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.keyDerivationFunc.oid",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"kdfOid"},{name:"PBES2Algorithms.params",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.params.salt",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"kdfSalt"},{name:"PBES2Algorithms.params.iterationCount",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"kdfIterationCount"},{name:"PBES2Algorithms.params.keyLength",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,optional:!0,capture:"keyLength"},{name:"PBES2Algorithms.params.prf",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,optional:!0,value:[{name:"PBES2Algorithms.params.prf.algorithm",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"prfOid"}]}]}]},{name:"PBES2Algorithms.encryptionScheme",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"PBES2Algorithms.encryptionScheme.oid",tagClass:i.Class.UNIVERSAL,type:i.Type.OID,constructed:!1,capture:"encOid"},{name:"PBES2Algorithms.encryptionScheme.iv",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"encIv"}]}]},u={name:"pkcs-12PbeParams",tagClass:i.Class.UNIVERSAL,type:i.Type.SEQUENCE,constructed:!0,value:[{name:"pkcs-12PbeParams.salt",tagClass:i.Class.UNIVERSAL,type:i.Type.OCTETSTRING,constructed:!1,capture:"salt"},{name:"pkcs-12PbeParams.iterations",tagClass:i.Class.UNIVERSAL,type:i.Type.INTEGER,constructed:!1,capture:"iterations"}]};function h(e,t){return e.start().update(t).digest().getBytes()}function d(e){var t;if(e){if(t=o.oids[i.derToOid(e)],!t){var n=new Error("Unsupported PRF OID.");throw n.oid=e,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}}else t="hmacWithSHA1";return p(t)}function p(e){var t=r.md;switch(e){case"hmacWithSHA224":t=r.md.sha512;case"hmacWithSHA1":case"hmacWithSHA256":case"hmacWithSHA384":case"hmacWithSHA512":e=e.substr(8).toLowerCase();break;default:var n=new Error("Unsupported PRF algorithm.");throw n.algorithm=e,n.supported=["hmacWithSHA1","hmacWithSHA224","hmacWithSHA256","hmacWithSHA384","hmacWithSHA512"],n}if(!t||!(e in t))throw new Error("Unknown hash algorithm: "+e);return t[e].create()}function f(e,t,n,s){var a=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,e),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,t.getBytes())]);return"hmacWithSHA1"!==s&&a.value.push(i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,r.util.hexToBytes(n.toString(16))),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(o.oids[s]).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.NULL,!1,"")])),a}o.encryptPrivateKeyInfo=function(e,t,n){n=n||{},n.saltSize=n.saltSize||8,n.count=n.count||2048,n.algorithm=n.algorithm||"aes128",n.prfAlgorithm=n.prfAlgorithm||"sha1";var s,c,l,u=r.random.getBytesSync(n.saltSize),h=n.count,d=i.integerToDer(h);if(0===n.algorithm.indexOf("aes")||"des"===n.algorithm){var g,m,y;switch(n.algorithm){case"aes128":s=16,g=16,m=a["aes128-CBC"],y=r.aes.createEncryptionCipher;break;case"aes192":s=24,g=16,m=a["aes192-CBC"],y=r.aes.createEncryptionCipher;break;case"aes256":s=32,g=16,m=a["aes256-CBC"],y=r.aes.createEncryptionCipher;break;case"des":s=8,g=8,m=a["desCBC"],y=r.des.createEncryptionCipher;break;default:var w=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw w.algorithm=n.algorithm,w}var b="hmacWith"+n.prfAlgorithm.toUpperCase(),v=p(b),E=r.pkcs5.pbkdf2(t,u,h,s,v),_=r.random.getBytesSync(g),S=y(E);S.start(_),S.update(i.toDer(e)),S.finish(),l=S.output.getBytes();var k=f(u,d,s,b);c=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(a["pkcs5PBES2"]).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(a["pkcs5PBKDF2"]).getBytes()),k]),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(m).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,_)])])])}else{if("3des"!==n.algorithm){w=new Error("Cannot encrypt private key. Unknown encryption algorithm.");throw w.algorithm=n.algorithm,w}s=24;var A=new r.util.ByteBuffer(u);E=o.pbe.generatePkcs12Key(t,A,1,h,s),_=o.pbe.generatePkcs12Key(t,A,2,h,s),S=r.des.createEncryptionCipher(E);S.start(_),S.update(i.toDer(e)),S.finish(),l=S.output.getBytes(),c=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OID,!1,i.oidToDer(a["pbeWithSHAAnd3-KeyTripleDES-CBC"]).getBytes()),i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,u),i.create(i.Class.UNIVERSAL,i.Type.INTEGER,!1,d.getBytes())])])}var T=i.create(i.Class.UNIVERSAL,i.Type.SEQUENCE,!0,[c,i.create(i.Class.UNIVERSAL,i.Type.OCTETSTRING,!1,l)]);return T},o.decryptPrivateKeyInfo=function(e,t){var n=null,s={},a=[];if(!i.validate(e,c,s,a)){var l=new Error("Cannot read encrypted private key. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw l.errors=a,l}var u=i.derToOid(s.encryptionOid),h=o.pbe.getCipher(u,s.encryptionParams,t),d=r.util.createBuffer(s.encryptedData);return h.update(d),h.finish()&&(n=i.fromDer(h.output)),n},o.encryptedPrivateKeyToPem=function(e,t){var n={type:"ENCRYPTED PRIVATE KEY",body:i.toDer(e).getBytes()};return r.pem.encode(n,{maxline:t})},o.encryptedPrivateKeyFromPem=function(e){var t=r.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==t.type){var n=new Error('Could not convert encrypted private key from PEM; PEM header type is "ENCRYPTED PRIVATE KEY".');throw n.headerType=t.type,n}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert encrypted private key from PEM; PEM is encrypted.");return i.fromDer(t.body)},o.encryptRsaPrivateKey=function(e,t,n){if(n=n||{},!n.legacy){var s=o.wrapRsaPrivateKey(o.privateKeyToAsn1(e));return s=o.encryptPrivateKeyInfo(s,t,n),o.encryptedPrivateKeyToPem(s)}var a,c,l,u;switch(n.algorithm){case"aes128":a="AES-128-CBC",l=16,c=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"aes192":a="AES-192-CBC",l=24,c=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"aes256":a="AES-256-CBC",l=32,c=r.random.getBytesSync(16),u=r.aes.createEncryptionCipher;break;case"3des":a="DES-EDE3-CBC",l=24,c=r.random.getBytesSync(8),u=r.des.createEncryptionCipher;break;case"des":a="DES-CBC",l=8,c=r.random.getBytesSync(8),u=r.des.createEncryptionCipher;break;default:var h=new Error('Could not encrypt RSA private key; unsupported encryption algorithm "'+n.algorithm+'".');throw h.algorithm=n.algorithm,h}var d=r.pbe.opensslDeriveBytes(t,c.substr(0,8),l),p=u(d);p.start(c),p.update(i.toDer(o.privateKeyToAsn1(e))),p.finish();var f={type:"RSA PRIVATE KEY",procType:{version:"4",type:"ENCRYPTED"},dekInfo:{algorithm:a,parameters:r.util.bytesToHex(c).toUpperCase()},body:p.output.getBytes()};return r.pem.encode(f)},o.decryptRsaPrivateKey=function(e,t){var n=null,s=r.pem.decode(e)[0];if("ENCRYPTED PRIVATE KEY"!==s.type&&"PRIVATE KEY"!==s.type&&"RSA PRIVATE KEY"!==s.type){var a=new Error('Could not convert private key from PEM; PEM header type is not "ENCRYPTED PRIVATE KEY", "PRIVATE KEY", or "RSA PRIVATE KEY".');throw a.headerType=a,a}if(s.procType&&"ENCRYPTED"===s.procType.type){var c,l;switch(s.dekInfo.algorithm){case"DES-CBC":c=8,l=r.des.createDecryptionCipher;break;case"DES-EDE3-CBC":c=24,l=r.des.createDecryptionCipher;break;case"AES-128-CBC":c=16,l=r.aes.createDecryptionCipher;break;case"AES-192-CBC":c=24,l=r.aes.createDecryptionCipher;break;case"AES-256-CBC":c=32,l=r.aes.createDecryptionCipher;break;case"RC2-40-CBC":c=5,l=function(e){return r.rc2.createDecryptionCipher(e,40)};break;case"RC2-64-CBC":c=8,l=function(e){return r.rc2.createDecryptionCipher(e,64)};break;case"RC2-128-CBC":c=16,l=function(e){return r.rc2.createDecryptionCipher(e,128)};break;default:a=new Error('Could not decrypt private key; unsupported encryption algorithm "'+s.dekInfo.algorithm+'".');throw a.algorithm=s.dekInfo.algorithm,a}var u=r.util.hexToBytes(s.dekInfo.parameters),h=r.pbe.opensslDeriveBytes(t,u.substr(0,8),c),d=l(h);if(d.start(u),d.update(r.util.createBuffer(s.body)),!d.finish())return n;n=d.output.getBytes()}else n=s.body;return n="ENCRYPTED PRIVATE KEY"===s.type?o.decryptPrivateKeyInfo(i.fromDer(n),t):i.fromDer(n),null!==n&&(n=o.privateKeyFromAsn1(n)),n},o.pbe.generatePkcs12Key=function(e,t,n,s,i,o){var a,c;if("undefined"===typeof o||null===o){if(!("sha1"in r.md))throw new Error('"sha1" hash algorithm unavailable.');o=r.md.sha1.create()}var l=o.digestLength,u=o.blockLength,h=new r.util.ByteBuffer,d=new r.util.ByteBuffer;if(null!==e&&void 0!==e){for(c=0;c<e.length;c++)d.putInt16(e.charCodeAt(c));d.putInt16(0)}var p=d.length(),f=t.length(),g=new r.util.ByteBuffer;g.fillWithByte(n,u);var m=u*Math.ceil(f/u),y=new r.util.ByteBuffer;for(c=0;c<m;c++)y.putByte(t.at(c%f));var w=u*Math.ceil(p/u),b=new r.util.ByteBuffer;for(c=0;c<w;c++)b.putByte(d.at(c%p));var v=y;v.putBuffer(b);for(var E=Math.ceil(i/l),_=1;_<=E;_++){var S=new r.util.ByteBuffer;S.putBytes(g.bytes()),S.putBytes(v.bytes());for(var k=0;k<s;k++)o.start(),o.update(S.getBytes()),S=o.digest();var A=new r.util.ByteBuffer;for(c=0;c<u;c++)A.putByte(S.at(c%l));var T=Math.ceil(f/u)+Math.ceil(p/u),C=new r.util.ByteBuffer;for(a=0;a<T;a++){var I=new r.util.ByteBuffer(v.getBytes(u)),R=511;for(c=A.length()-1;c>=0;c--)R>>=8,R+=A.at(c)+I.at(c),I.setAt(c,255&R);C.putBuffer(I)}v=C,h.putBuffer(S)}return h.truncate(h.length()-i),h},o.pbe.getCipher=function(e,t,n){switch(e){case o.oids["pkcs5PBES2"]:return o.pbe.getCipherForPBES2(e,t,n);case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:case o.oids["pbewithSHAAnd40BitRC2-CBC"]:return o.pbe.getCipherForPKCS12PBE(e,t,n);default:var r=new Error("Cannot read encrypted PBE data block. Unsupported OID.");throw r.oid=e,r.supportedOids=["pkcs5PBES2","pbeWithSHAAnd3-KeyTripleDES-CBC","pbewithSHAAnd40BitRC2-CBC"],r}},o.pbe.getCipherForPBES2=function(e,t,n){var s={},a=[];if(!i.validate(t,l,s,a)){var c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=a,c}if(e=i.derToOid(s.kdfOid),e!==o.oids["pkcs5PBKDF2"]){c=new Error("Cannot read encrypted private key. Unsupported key derivation function OID.");throw c.oid=e,c.supportedOids=["pkcs5PBKDF2"],c}if(e=i.derToOid(s.encOid),e!==o.oids["aes128-CBC"]&&e!==o.oids["aes192-CBC"]&&e!==o.oids["aes256-CBC"]&&e!==o.oids["des-EDE3-CBC"]&&e!==o.oids["desCBC"]){c=new Error("Cannot read encrypted private key. Unsupported encryption scheme OID.");throw c.oid=e,c.supportedOids=["aes128-CBC","aes192-CBC","aes256-CBC","des-EDE3-CBC","desCBC"],c}var u,h,p=s.kdfSalt,f=r.util.createBuffer(s.kdfIterationCount);switch(f=f.getInt(f.length()<<3),o.oids[e]){case"aes128-CBC":u=16,h=r.aes.createDecryptionCipher;break;case"aes192-CBC":u=24,h=r.aes.createDecryptionCipher;break;case"aes256-CBC":u=32,h=r.aes.createDecryptionCipher;break;case"des-EDE3-CBC":u=24,h=r.des.createDecryptionCipher;break;case"desCBC":u=8,h=r.des.createDecryptionCipher;break}var g=d(s.prfOid),m=r.pkcs5.pbkdf2(n,p,f,u,g),y=s.encIv,w=h(m);return w.start(y),w},o.pbe.getCipherForPKCS12PBE=function(e,t,n){var s={},a=[];if(!i.validate(t,u,s,a)){var c=new Error("Cannot read password-based-encryption algorithm parameters. ASN.1 object is not a supported EncryptedPrivateKeyInfo.");throw c.errors=a,c}var l,h,p,f=r.util.createBuffer(s.salt),g=r.util.createBuffer(s.iterations);switch(g=g.getInt(g.length()<<3),e){case o.oids["pbeWithSHAAnd3-KeyTripleDES-CBC"]:l=24,h=8,p=r.des.startDecrypting;break;case o.oids["pbewithSHAAnd40BitRC2-CBC"]:l=5,h=8,p=function(e,t){var n=r.rc2.createDecryptionCipher(e,40);return n.start(t,null),n};break;default:c=new Error("Cannot read PKCS #12 PBE data block. Unsupported OID.");throw c.oid=e,c}var m=d(s.prfOid),y=o.pbe.generatePkcs12Key(n,f,1,g,l,m);m.start();var w=o.pbe.generatePkcs12Key(n,f,2,g,h,m);return p(y,w)},o.pbe.opensslDeriveBytes=function(e,t,n,s){if("undefined"===typeof s||null===s){if(!("md5"in r.md))throw new Error('"md5" hash algorithm unavailable.');s=r.md.md5.create()}null===t&&(t="");for(var i=[h(s,e+t)],o=16,a=1;o<n;++a,o+=16)i.push(h(s,i[a-1]+e+t));return i.join("").substr(0,n)}},3350:function(e,t,n){var r=n(6143);n(1818),n(2713),n(8666);var s,i=r.pkcs5=r.pkcs5||{};r.util.isNodejs&&!r.options.usePureJavaScript&&(s=n(5745)),e.exports=r.pbkdf2=i.pbkdf2=function(e,t,n,i,o,a){if("function"===typeof o&&(a=o,o=null),r.util.isNodejs&&!r.options.usePureJavaScript&&s.pbkdf2&&(null===o||"object"!==typeof o)&&(s.pbkdf2Sync.length>4||!o||"sha1"===o))return"string"!==typeof o&&(o="sha1"),e=Buffer.from(e,"binary"),t=Buffer.from(t,"binary"),a?4===s.pbkdf2Sync.length?s.pbkdf2(e,t,n,i,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):s.pbkdf2(e,t,n,i,o,(function(e,t){if(e)return a(e);a(null,t.toString("binary"))})):4===s.pbkdf2Sync.length?s.pbkdf2Sync(e,t,n,i).toString("binary"):s.pbkdf2Sync(e,t,n,i,o).toString("binary");if("undefined"!==typeof o&&null!==o||(o="sha1"),"string"===typeof o){if(!(o in r.md.algorithms))throw new Error("Unknown hash algorithm: "+o);o=r.md[o].create()}var c=o.digestLength;if(i>4294967295*c){var l=new Error("Derived key is too long.");if(a)return a(l);throw l}var u=Math.ceil(i/c),h=i-(u-1)*c,d=r.hmac.create();d.start(o,e);var p,f,g,m="";if(!a){for(var y=1;y<=u;++y){d.start(null,null),d.update(t),d.update(r.util.int32ToBytes(y)),p=g=d.digest().getBytes();for(var w=2;w<=n;++w)d.start(null,null),d.update(g),f=d.digest().getBytes(),p=r.util.xorBytes(p,f,c),g=f;m+=y<u?p:p.substr(0,h)}return m}y=1;function b(){if(y>u)return a(null,m);d.start(null,null),d.update(t),d.update(r.util.int32ToBytes(y)),p=g=d.digest().getBytes(),w=2,v()}function v(){if(w<=n)return d.start(null,null),d.update(g),f=d.digest().getBytes(),p=r.util.xorBytes(p,f,c),g=f,++w,r.util.setImmediate(v);m+=y<u?p:p.substr(0,h),++y,b()}b()}},8277:function(e,t,n){n(7658);var r=n(6143);n(8666);var s=e.exports=r.pem=r.pem||{};function i(e){for(var t=e.name+": ",n=[],r=function(e,t){return" "+t},s=0;s<e.values.length;++s)n.push(e.values[s].replace(/^(\S+\r\n)/,r));t+=n.join(",")+"\r\n";var i=0,o=-1;for(s=0;s<t.length;++s,++i)if(i>65&&-1!==o){var a=t[o];","===a?(++o,t=t.substr(0,o)+"\r\n "+t.substr(o)):t=t.substr(0,o)+"\r\n"+a+t.substr(o+1),i=s-o-1,o=-1,++s}else" "!==t[s]&&"\t"!==t[s]&&","!==t[s]||(o=s);return t}function o(e){return e.replace(/^\s+/,"")}s.encode=function(e,t){t=t||{};var n,s="-----BEGIN "+e.type+"-----\r\n";if(e.procType&&(n={name:"Proc-Type",values:[String(e.procType.version),e.procType.type]},s+=i(n)),e.contentDomain&&(n={name:"Content-Domain",values:[e.contentDomain]},s+=i(n)),e.dekInfo&&(n={name:"DEK-Info",values:[e.dekInfo.algorithm]},e.dekInfo.parameters&&n.values.push(e.dekInfo.parameters),s+=i(n)),e.headers)for(var o=0;o<e.headers.length;++o)s+=i(e.headers[o]);return e.procType&&(s+="\r\n"),s+=r.util.encode64(e.body,t.maxline||64)+"\r\n",s+="-----END "+e.type+"-----\r\n",s},s.decode=function(e){var t,n=[],s=/\s*-----BEGIN ([A-Z0-9- ]+)-----\r?\n?([\x21-\x7e\s]+?(?:\r?\n\r?\n))?([:A-Za-z0-9+\/=\s]+?)-----END \1-----/g,i=/([\x21-\x7e]+):\s*([\x21-\x7e\s^:]+)/,a=/\r?\n/;while(1){if(t=s.exec(e),!t)break;var c=t[1];"NEW CERTIFICATE REQUEST"===c&&(c="CERTIFICATE REQUEST");var l={type:c,procType:null,contentDomain:null,dekInfo:null,headers:[],body:r.util.decode64(t[3])};if(n.push(l),t[2]){var u=t[2].split(a),h=0;while(t&&h<u.length){for(var d=u[h].replace(/\s+$/,""),p=h+1;p<u.length;++p){var f=u[p];if(!/\s/.test(f[0]))break;d+=f,h=p}if(t=d.match(i),t){for(var g={name:t[1],values:[]},m=t[2].split(","),y=0;y<m.length;++y)g.values.push(o(m[y]));if(l.procType)if(l.contentDomain||"Content-Domain"!==g.name)if(l.dekInfo||"DEK-Info"!==g.name)l.headers.push(g);else{if(0===g.values.length)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must have at least one subfield.');l.dekInfo={algorithm:m[0],parameters:m[1]||null}}else l.contentDomain=m[0]||"";else{if("Proc-Type"!==g.name)throw new Error('Invalid PEM formatted message. The first encapsulated header must be "Proc-Type".');if(2!==g.values.length)throw new Error('Invalid PEM formatted message. The "Proc-Type" header must have two subfields.');l.procType={version:m[0],type:m[1]}}}++h}if("ENCRYPTED"===l.procType&&!l.dekInfo)throw new Error('Invalid PEM formatted message. The "DEK-Info" header must be present if "Proc-Type" is "ENCRYPTED".')}}if(0===n.length)throw new Error("Invalid PEM formatted message.");return n}},8219:function(e,t,n){var r=n(6143);n(8666),n(8584),n(8927);var s=e.exports=r.pkcs1=r.pkcs1||{};function i(e,t,n){n||(n=r.md.sha1.create());for(var s="",i=Math.ceil(t/n.digestLength),o=0;o<i;++o){var a=String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,255&o);n.start(),n.update(e+a),s+=n.digest().getBytes()}return s.substring(0,t)}s.encode_rsa_oaep=function(e,t,n){var s,o,a,c;"string"===typeof n?(s=n,o=arguments[3]||void 0,a=arguments[4]||void 0):n&&(s=n.label||void 0,o=n.seed||void 0,a=n.md||void 0,n.mgf1&&n.mgf1.md&&(c=n.mgf1.md)),a?a.start():a=r.md.sha1.create(),c||(c=a);var l=Math.ceil(e.n.bitLength()/8),u=l-2*a.digestLength-2;if(t.length>u){var h=new Error("RSAES-OAEP input message length is too long.");throw h.length=t.length,h.maxLength=u,h}s||(s=""),a.update(s,"raw");for(var d=a.digest(),p="",f=u-t.length,g=0;g<f;g++)p+="\0";var m=d.getBytes()+p+""+t;if(o){if(o.length!==a.digestLength){h=new Error("Invalid RSAES-OAEP seed. The seed length must match the digest length.");throw h.seedLength=o.length,h.digestLength=a.digestLength,h}}else o=r.random.getBytes(a.digestLength);var y=i(o,l-a.digestLength-1,c),w=r.util.xorBytes(m,y,m.length),b=i(w,a.digestLength,c),v=r.util.xorBytes(o,b,o.length);return"\0"+v+w},s.decode_rsa_oaep=function(e,t,n){var s,o,a;"string"===typeof n?(s=n,o=arguments[3]||void 0):n&&(s=n.label||void 0,o=n.md||void 0,n.mgf1&&n.mgf1.md&&(a=n.mgf1.md));var c=Math.ceil(e.n.bitLength()/8);if(t.length!==c){var l=new Error("RSAES-OAEP encoded message length is invalid.");throw l.length=t.length,l.expectedLength=c,l}if(void 0===o?o=r.md.sha1.create():o.start(),a||(a=o),c<2*o.digestLength+2)throw new Error("RSAES-OAEP key is too short for the hash function.");s||(s=""),o.update(s,"raw");for(var u=o.digest().getBytes(),h=t.charAt(0),d=t.substring(1,o.digestLength+1),p=t.substring(1+o.digestLength),f=i(p,o.digestLength,a),g=r.util.xorBytes(d,f,d.length),m=i(g,c-o.digestLength-1,a),y=r.util.xorBytes(p,m,p.length),w=y.substring(0,o.digestLength),b=(l="\0"!==h,0);b<o.digestLength;++b)l|=u.charAt(b)!==w.charAt(b);for(var v=1,E=o.digestLength,_=o.digestLength;_<y.length;_++){var S=y.charCodeAt(_),k=1&S^1,A=v?65534:0;l|=S&A,v&=k,E+=v}if(l||1!==y.charCodeAt(E))throw new Error("Invalid RSAES-OAEP padding.");return y.substring(E+1)}},4669:function(e,t,n){n(7658);var r=n(6143);n(6509),n(3655),n(1202),n(5828),n(8277),n(7929),n(8584),n(8666),n(4760);var s=r.asn1,i=e.exports=r.pkcs7=r.pkcs7||{};function o(e){var t={},n=[];if(!s.validate(e,i.asn1.recipientInfoValidator,t,n)){var o=new Error("Cannot read PKCS#7 RecipientInfo. ASN.1 object is not an PKCS#7 RecipientInfo.");throw o.errors=n,o}return{version:t.version.charCodeAt(0),issuer:r.pki.RDNAttributesAsArray(t.issuer),serialNumber:r.util.createBuffer(t.serial).toHex(),encryptedContent:{algorithm:s.derToOid(t.encAlgorithm),parameter:t.encParameter?t.encParameter.value:void 0,content:t.encKey}}}function a(e){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[r.pki.distinguishedNameToAsn1({attributes:e.issuer}),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,r.util.hexToBytes(e.serialNumber))]),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.encryptedContent.algorithm).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]),s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.encryptedContent.content)])}function c(e){for(var t=[],n=0;n<e.length;++n)t.push(o(e[n]));return t}function l(e){for(var t=[],n=0;n<e.length;++n)t.push(a(e[n]));return t}function u(e){var t=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[r.pki.distinguishedNameToAsn1({attributes:e.issuer}),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,r.util.hexToBytes(e.serialNumber))]),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.digestAlgorithm).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])]);if(e.authenticatedAttributesAsn1&&t.value.push(e.authenticatedAttributesAsn1),t.value.push(s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.signatureAlgorithm).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])),t.value.push(s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.signature)),e.unauthenticatedAttributes.length>0){for(var n=s.create(s.Class.CONTEXT_SPECIFIC,1,!0,[]),i=0;i<e.unauthenticatedAttributes.length;++i){var o=e.unauthenticatedAttributes[i];n.values.push(d(o))}t.value.push(n)}return t}function h(e){for(var t=[],n=0;n<e.length;++n)t.push(u(e[n]));return t}function d(e){var t;if(e.type===r.pki.oids.contentType)t=s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.value).getBytes());else if(e.type===r.pki.oids.messageDigest)t=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.value.bytes());else if(e.type===r.pki.oids.signingTime){var n=new Date("1950-01-01T00:00:00Z"),i=new Date("2050-01-01T00:00:00Z"),o=e.value;if("string"===typeof o){var a=Date.parse(o);o=isNaN(a)?13===o.length?s.utcTimeToDate(o):s.generalizedTimeToDate(o):new Date(a)}t=o>=n&&o<i?s.create(s.Class.UNIVERSAL,s.Type.UTCTIME,!1,s.dateToUtcTime(o)):s.create(s.Class.UNIVERSAL,s.Type.GENERALIZEDTIME,!1,s.dateToGeneralizedTime(o))}return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.type).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[t])])}function p(e){return[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(r.pki.oids.data).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.algorithm).getBytes()),e.parameter?s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.parameter.getBytes()):void 0]),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,e.content.getBytes())])]}function f(e,t,n){var i={},o=[];if(!s.validate(t,n,i,o)){var a=new Error("Cannot read PKCS#7 message. ASN.1 object is not a supported PKCS#7 message.");throw a.errors=a,a}var c=s.derToOid(i.contentType);if(c!==r.pki.oids.data)throw new Error("Unsupported PKCS#7 message. Only wrapped ContentType Data supported.");if(i.encryptedContent){var l="";if(r.util.isArray(i.encryptedContent))for(var u=0;u<i.encryptedContent.length;++u){if(i.encryptedContent[u].type!==s.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting encrypted content constructed of only OCTET STRING objects.");l+=i.encryptedContent[u].value}else l=i.encryptedContent;e.encryptedContent={algorithm:s.derToOid(i.encAlgorithm),parameter:r.util.createBuffer(i.encParameter.value),content:r.util.createBuffer(l)}}if(i.content){l="";if(r.util.isArray(i.content))for(u=0;u<i.content.length;++u){if(i.content[u].type!==s.Type.OCTETSTRING)throw new Error("Malformed PKCS#7 message, expecting content constructed of only OCTET STRING objects.");l+=i.content[u].value}else l=i.content;e.content=r.util.createBuffer(l)}return e.version=i.version.charCodeAt(0),e.rawCapture=i,i}function g(e){if(void 0===e.encryptedContent.key)throw new Error("Symmetric key not available.");if(void 0===e.content){var t;switch(e.encryptedContent.algorithm){case r.pki.oids["aes128-CBC"]:case r.pki.oids["aes192-CBC"]:case r.pki.oids["aes256-CBC"]:t=r.aes.createDecryptionCipher(e.encryptedContent.key);break;case r.pki.oids["desCBC"]:case r.pki.oids["des-EDE3-CBC"]:t=r.des.createDecryptionCipher(e.encryptedContent.key);break;default:throw new Error("Unsupported symmetric cipher, OID "+e.encryptedContent.algorithm)}if(t.start(e.encryptedContent.parameter),t.update(e.encryptedContent.content),!t.finish())throw new Error("Symmetric decryption failed.");e.content=t.output}}i.messageFromPem=function(e){var t=r.pem.decode(e)[0];if("PKCS7"!==t.type){var n=new Error('Could not convert PKCS#7 message from PEM; PEM header type is not "PKCS#7".');throw n.headerType=t.type,n}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert PKCS#7 message from PEM; PEM is encrypted.");var o=s.fromDer(t.body);return i.messageFromAsn1(o)},i.messageToPem=function(e,t){var n={type:"PKCS7",body:s.toDer(e.toAsn1()).getBytes()};return r.pem.encode(n,{maxline:t})},i.messageFromAsn1=function(e){var t={},n=[];if(!s.validate(e,i.asn1.contentInfoValidator,t,n)){var o=new Error("Cannot read PKCS#7 message. ASN.1 object is not an PKCS#7 ContentInfo.");throw o.errors=n,o}var a,c=s.derToOid(t.contentType);switch(c){case r.pki.oids.envelopedData:a=i.createEnvelopedData();break;case r.pki.oids.encryptedData:a=i.createEncryptedData();break;case r.pki.oids.signedData:a=i.createSignedData();break;default:throw new Error("Cannot read PKCS#7 message. ContentType with OID "+c+" is not (yet) supported.")}return a.fromAsn1(t.content.value[0]),a},i.createSignedData=function(){var e=null;return e={type:r.pki.oids.signedData,version:1,certificates:[],crls:[],signers:[],digestAlgorithmIdentifiers:[],contentInfo:null,signerInfos:[],fromAsn1:function(t){if(f(e,t,i.asn1.signedDataValidator),e.certificates=[],e.crls=[],e.digestAlgorithmIdentifiers=[],e.contentInfo=null,e.signerInfos=[],e.rawCapture.certificates)for(var n=e.rawCapture.certificates.value,s=0;s<n.length;++s)e.certificates.push(r.pki.certificateFromAsn1(n[s]))},toAsn1:function(){e.contentInfo||e.sign();for(var t=[],n=0;n<e.certificates.length;++n)t.push(r.pki.certificateToAsn1(e.certificates[n]));var i=[],o=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,e.digestAlgorithmIdentifiers),e.contentInfo])]);return t.length>0&&o.value[0].value.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,t)),i.length>0&&o.value[0].value.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,i)),o.value[0].value.push(s.create(s.Class.UNIVERSAL,s.Type.SET,!0,e.signerInfos)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.type).getBytes()),o])},addSigner:function(t){var n=t.issuer,s=t.serialNumber;if(t.certificate){var i=t.certificate;"string"===typeof i&&(i=r.pki.certificateFromPem(i)),n=i.issuer.attributes,s=i.serialNumber}var o=t.key;if(!o)throw new Error("Could not add PKCS#7 signer; no private key specified.");"string"===typeof o&&(o=r.pki.privateKeyFromPem(o));var a=t.digestAlgorithm||r.pki.oids.sha1;switch(a){case r.pki.oids.sha1:case r.pki.oids.sha256:case r.pki.oids.sha384:case r.pki.oids.sha512:case r.pki.oids.md5:break;default:throw new Error("Could not add PKCS#7 signer; unknown message digest algorithm: "+a)}var c=t.authenticatedAttributes||[];if(c.length>0){for(var l=!1,u=!1,h=0;h<c.length;++h){var d=c[h];if(l||d.type!==r.pki.oids.contentType){if(u||d.type!==r.pki.oids.messageDigest);else if(u=!0,l)break}else if(l=!0,u)break}if(!l||!u)throw new Error("Invalid signer.authenticatedAttributes. If signer.authenticatedAttributes is specified, then it must contain at least two attributes, PKCS #9 content-type and PKCS #9 message-digest.")}e.signers.push({key:o,version:1,issuer:n,serialNumber:s,digestAlgorithm:a,signatureAlgorithm:r.pki.oids.rsaEncryption,signature:null,authenticatedAttributes:c,unauthenticatedAttributes:[]})},sign:function(i){var o;(i=i||{},"object"!==typeof e.content||null===e.contentInfo)&&(e.contentInfo=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(r.pki.oids.data).getBytes())]),"content"in e&&(e.content instanceof r.util.ByteBuffer?o=e.content.bytes():"string"===typeof e.content&&(o=r.util.encodeUtf8(e.content)),i.detached?e.detachedContent=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,o):e.contentInfo.value.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,o)]))));if(0!==e.signers.length){var a=t();n(a)}},verify:function(){throw new Error("PKCS#7 signature verification not yet implemented.")},addCertificate:function(t){"string"===typeof t&&(t=r.pki.certificateFromPem(t)),e.certificates.push(t)},addCertificateRevokationList:function(e){throw new Error("PKCS#7 CRL support not yet implemented.")}},e;function t(){for(var t={},n=0;n<e.signers.length;++n){var i=e.signers[n],o=i.digestAlgorithm;o in t||(t[o]=r.md[r.pki.oids[o]].create()),0===i.authenticatedAttributes.length?i.md=t[o]:i.md=r.md[r.pki.oids[o]].create()}for(var o in e.digestAlgorithmIdentifiers=[],t)e.digestAlgorithmIdentifiers.push(s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")]));return t}function n(t){var n;if(e.detachedContent?n=e.detachedContent:(n=e.contentInfo.value[1],n=n.value[0]),!n)throw new Error("Could not sign PKCS#7 message; there is no content to sign.");var i=s.derToOid(e.contentInfo.value[0].value),o=s.toDer(n);for(var a in o.getByte(),s.getBerValueLength(o),o=o.getBytes(),t)t[a].start().update(o);for(var c=new Date,l=0;l<e.signers.length;++l){var u=e.signers[l];if(0===u.authenticatedAttributes.length){if(i!==r.pki.oids.data)throw new Error("Invalid signer; authenticatedAttributes must be present when the ContentInfo content type is not PKCS#7 Data.")}else{u.authenticatedAttributesAsn1=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[]);for(var p=s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[]),f=0;f<u.authenticatedAttributes.length;++f){var g=u.authenticatedAttributes[f];g.type===r.pki.oids.messageDigest?g.value=t[u.digestAlgorithm].digest():g.type===r.pki.oids.signingTime&&(g.value||(g.value=c)),p.value.push(d(g)),u.authenticatedAttributesAsn1.value.push(d(g))}o=s.toDer(p).getBytes(),u.md.start().update(o)}u.signature=u.key.sign(u.md,"RSASSA-PKCS1-V1_5")}e.signerInfos=h(e.signers)}},i.createEncryptedData=function(){var e=null;return e={type:r.pki.oids.encryptedData,version:0,encryptedContent:{algorithm:r.pki.oids["aes256-CBC"]},fromAsn1:function(t){f(e,t,i.asn1.encryptedDataValidator)},decrypt:function(t){void 0!==t&&(e.encryptedContent.key=t),g(e)}},e},i.createEnvelopedData=function(){var e=null;return e={type:r.pki.oids.envelopedData,version:0,recipients:[],encryptedContent:{algorithm:r.pki.oids["aes256-CBC"]},fromAsn1:function(t){var n=f(e,t,i.asn1.envelopedDataValidator);e.recipients=c(n.recipientInfos.value)},toAsn1:function(){return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.type).getBytes()),s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,l(e.recipients)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,p(e.encryptedContent))])])])},findRecipient:function(t){for(var n=t.issuer.attributes,r=0;r<e.recipients.length;++r){var s=e.recipients[r],i=s.issuer;if(s.serialNumber===t.serialNumber&&i.length===n.length){for(var o=!0,a=0;a<n.length;++a)if(i[a].type!==n[a].type||i[a].value!==n[a].value){o=!1;break}if(o)return s}}return null},decrypt:function(t,n){if(void 0===e.encryptedContent.key&&void 0!==t&&void 0!==n)switch(t.encryptedContent.algorithm){case r.pki.oids.rsaEncryption:case r.pki.oids.desCBC:var s=n.decrypt(t.encryptedContent.content);e.encryptedContent.key=r.util.createBuffer(s);break;default:throw new Error("Unsupported asymmetric cipher, OID "+t.encryptedContent.algorithm)}g(e)},addRecipient:function(t){e.recipients.push({version:0,issuer:t.issuer.attributes,serialNumber:t.serialNumber,encryptedContent:{algorithm:r.pki.oids.rsaEncryption,key:t.publicKey}})},encrypt:function(t,n){if(void 0===e.encryptedContent.content){var s,i,o;switch(n=n||e.encryptedContent.algorithm,t=t||e.encryptedContent.key,n){case r.pki.oids["aes128-CBC"]:s=16,i=16,o=r.aes.createEncryptionCipher;break;case r.pki.oids["aes192-CBC"]:s=24,i=16,o=r.aes.createEncryptionCipher;break;case r.pki.oids["aes256-CBC"]:s=32,i=16,o=r.aes.createEncryptionCipher;break;case r.pki.oids["des-EDE3-CBC"]:s=24,i=8,o=r.des.createEncryptionCipher;break;default:throw new Error("Unsupported symmetric cipher, OID "+n)}if(void 0===t)t=r.util.createBuffer(r.random.getBytes(s));else if(t.length()!=s)throw new Error("Symmetric key has wrong length; got "+t.length()+" bytes, expected "+s+".");e.encryptedContent.algorithm=n,e.encryptedContent.key=t,e.encryptedContent.parameter=r.util.createBuffer(r.random.getBytes(i));var a=o(t);if(a.start(e.encryptedContent.parameter.copy()),a.update(e.content),!a.finish())throw new Error("Symmetric encryption failed.");e.encryptedContent.content=a.output}for(var c=0;c<e.recipients.length;++c){var l=e.recipients[c];if(void 0===l.encryptedContent.content)switch(l.encryptedContent.algorithm){case r.pki.oids.rsaEncryption:l.encryptedContent.content=l.encryptedContent.key.encrypt(e.encryptedContent.key.data);break;default:throw new Error("Unsupported asymmetric cipher, OID "+l.encryptedContent.algorithm)}}}},e}},7929:function(e,t,n){var r=n(6143);n(3655),n(8666);var s=r.asn1,i=e.exports=r.pkcs7asn1=r.pkcs7asn1||{};r.pkcs7=r.pkcs7||{},r.pkcs7.asn1=i;var o={name:"ContentInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"ContentInfo.ContentType",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"contentType"},{name:"ContentInfo.content",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,captureAsn1:"content"}]};i.contentInfoValidator=o;var a={name:"EncryptedContentInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentType",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"contentType"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedContentInfo.contentEncryptionAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"EncryptedContentInfo.contentEncryptionAlgorithm.parameter",tagClass:s.Class.UNIVERSAL,captureAsn1:"encParameter"}]},{name:"EncryptedContentInfo.encryptedContent",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,capture:"encryptedContent",captureAsn1:"encryptedContentAsn1"}]};i.envelopedDataValidator={name:"EnvelopedData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EnvelopedData.Version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},{name:"EnvelopedData.RecipientInfos",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0,captureAsn1:"recipientInfos"}].concat(a)},i.encryptedDataValidator={name:"EncryptedData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"EncryptedData.Version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"}].concat(a)};var c={name:"SignerInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1},{name:"SignerInfo.issuerAndSerialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.issuerAndSerialNumber.issuer",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"SignerInfo.issuerAndSerialNumber.serialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"SignerInfo.digestAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignerInfo.digestAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"digestAlgorithm"},{name:"SignerInfo.digestAlgorithm.parameter",tagClass:s.Class.UNIVERSAL,constructed:!1,captureAsn1:"digestParameter",optional:!0}]},{name:"SignerInfo.authenticatedAttributes",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"authenticatedAttributes"},{name:"SignerInfo.digestEncryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,capture:"signatureAlgorithm"},{name:"SignerInfo.encryptedDigest",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"signature"},{name:"SignerInfo.unauthenticatedAttributes",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,capture:"unauthenticatedAttributes"}]};i.signedDataValidator={name:"SignedData",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"SignedData.Version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},{name:"SignedData.DigestAlgorithms",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0,captureAsn1:"digestAlgorithms"},o,{name:"SignedData.Certificates",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,optional:!0,captureAsn1:"certificates"},{name:"SignedData.CertificateRevocationLists",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,optional:!0,captureAsn1:"crls"},{name:"SignedData.SignerInfos",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,capture:"signerInfos",optional:!0,value:[c]}]},i.recipientInfoValidator={name:"RecipientInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.version",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"version"},{name:"RecipientInfo.issuerAndSerial",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.issuerAndSerial.issuer",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"issuer"},{name:"RecipientInfo.issuerAndSerial.serialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"serial"}]},{name:"RecipientInfo.keyEncryptionAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"RecipientInfo.keyEncryptionAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"encAlgorithm"},{name:"RecipientInfo.keyEncryptionAlgorithm.parameter",tagClass:s.Class.UNIVERSAL,constructed:!1,captureAsn1:"encParameter",optional:!0}]},{name:"RecipientInfo.encryptedKey",tagClass:s.Class.UNIVERSAL,type:s.Type.OCTETSTRING,constructed:!1,capture:"encKey"}]}},4537:function(e,t,n){var r=n(6143);n(8666),n(3322),n(8584),function(){if(r.prime)e.exports=r.prime;else{var t=e.exports=r.prime=r.prime||{},n=r.jsbn.BigInteger,s=[6,4,2,4,2,4,6,2],i=new n(null);i.fromInt(30);var o=function(e,t){return e|t};t.generateProbablePrime=function(e,t,n){"function"===typeof t&&(n=t,t={}),t=t||{};var s=t.algorithm||"PRIMEINC";"string"===typeof s&&(s={name:s}),s.options=s.options||{};var i=t.prng||r.random,o={nextBytes:function(e){for(var t=i.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}};if("PRIMEINC"===s.name)return a(e,o,s.options,n);throw new Error("Invalid prime generation algorithm: "+s.name)}}function a(e,t,n,r){return"workers"in n?u(e,t,n,r):c(e,t,n,r)}function c(e,t,n,r){var s=h(e,t),i=0,o=d(s.bitLength());"millerRabinTests"in n&&(o=n.millerRabinTests);var a=10;"maxBlockTime"in n&&(a=n.maxBlockTime),l(s,e,t,i,o,a,r)}function l(e,t,n,i,o,a,c){var u=+new Date;do{if(e.bitLength()>t&&(e=h(t,n)),e.isProbablePrime(o))return c(null,e);e.dAddOffset(s[i++%8],0)}while(a<0||+new Date-u<a);r.util.setImmediate((function(){l(e,t,n,i,o,a,c)}))}function u(e,t,s,i){if("undefined"===typeof Worker)return c(e,t,s,i);var o=h(e,t),a=s.workers,l=s.workLoad||100,u=30*l/8,d=s.workerScript||"forge/prime.worker.js";if(-1===a)return r.util.estimateCores((function(e,t){e&&(t=2),a=t-1,p()}));function p(){a=Math.max(1,a);for(var r=[],s=0;s<a;++s)r[s]=new Worker(d);for(s=0;s<a;++s)r[s].addEventListener("message",p);var c=!1;function p(s){if(!c){0;var a=s.data;if(a.found){for(var d=0;d<r.length;++d)r[d].terminate();return c=!0,i(null,new n(a.prime,16))}o.bitLength()>e&&(o=h(e,t));var p=o.toString(16);s.target.postMessage({hex:p,workLoad:l}),o.dAddOffset(u,0)}}}p()}function h(e,t){var r=new n(e,t),s=e-1;return r.testBit(s)||r.bitwiseTo(n.ONE.shiftLeft(s),o,r),r.dAddOffset(31-r.mod(i).byteValue(),0),r}function d(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}}()},3772:function(e,t,n){n(3767),n(8585),n(8696);var r=n(6143);n(8666);var s=null;!r.util.isNodejs||r.options.usePureJavaScript||process.versions["node-webkit"]||(s=n(5745));var i=e.exports=r.prng=r.prng||{};i.create=function(e){for(var t={plugin:e,key:null,seed:null,time:null,reseeds:0,generated:0,keyBytes:""},n=e.md,i=new Array(32),o=0;o<32;++o)i[o]=n.create();function a(e){if(t.pools[0].messageLength>=32)return l(),e();var n=32-t.pools[0].messageLength<<5;t.seedFile(n,(function(n,r){if(n)return e(n);t.collect(r),l(),e()}))}function c(){if(t.pools[0].messageLength>=32)return l();var e=32-t.pools[0].messageLength<<5;t.collect(t.seedFileSync(e)),l()}function l(){t.reseeds=4294967295===t.reseeds?0:t.reseeds+1;var e=t.plugin.md.create();e.update(t.keyBytes);for(var n=1,r=0;r<32;++r)t.reseeds%n===0&&(e.update(t.pools[r].digest().getBytes()),t.pools[r].start()),n<<=1;t.keyBytes=e.digest().getBytes(),e.start(),e.update(t.keyBytes);var s=e.digest().getBytes();t.key=t.plugin.formatKey(t.keyBytes),t.seed=t.plugin.formatSeed(s),t.generated=0}function u(e){var t=null,n=r.util.globalScope,s=n.crypto||n.msCrypto;s&&s.getRandomValues&&(t=function(e){return s.getRandomValues(e)});var i=r.util.createBuffer();if(t)while(i.length()<e){var o=Math.max(1,Math.min(e-i.length(),65536)/4),a=new Uint32Array(Math.floor(o));try{t(a);for(var c=0;c<a.length;++c)i.putInt32(a[c])}catch(p){if(!("undefined"!==typeof QuotaExceededError&&p instanceof QuotaExceededError))throw p}}if(i.length()<e){var l,u,h,d=Math.floor(65536*Math.random());while(i.length()<e){u=16807*(65535&d),l=16807*(d>>16),u+=(32767&l)<<16,u+=l>>15,u=(2147483647&u)+(u>>31),d=4294967295&u;for(c=0;c<3;++c)h=d>>>(c<<3),h^=Math.floor(256*Math.random()),i.putByte(255&h)}}return i.getBytes(e)}return t.pools=i,t.pool=0,t.generate=function(e,n){if(!n)return t.generateSync(e);var s=t.plugin.cipher,i=t.plugin.increment,o=t.plugin.formatKey,c=t.plugin.formatSeed,l=r.util.createBuffer();function u(h){if(h)return n(h);if(l.length()>=e)return n(null,l.getBytes(e));if(t.generated>1048575&&(t.key=null),null===t.key)return r.util.nextTick((function(){a(u)}));var d=s(t.key,t.seed);t.generated+=d.length,l.putBytes(d),t.key=o(s(t.key,i(t.seed))),t.seed=c(s(t.key,t.seed)),r.util.setImmediate(u)}t.key=null,u()},t.generateSync=function(e){var n=t.plugin.cipher,s=t.plugin.increment,i=t.plugin.formatKey,o=t.plugin.formatSeed;t.key=null;var a=r.util.createBuffer();while(a.length()<e){t.generated>1048575&&(t.key=null),null===t.key&&c();var l=n(t.key,t.seed);t.generated+=l.length,a.putBytes(l),t.key=i(n(t.key,s(t.seed))),t.seed=o(n(t.key,t.seed))}return a.getBytes(e)},s?(t.seedFile=function(e,t){s.randomBytes(e,(function(e,n){if(e)return t(e);t(null,n.toString())}))},t.seedFileSync=function(e){return s.randomBytes(e).toString()}):(t.seedFile=function(e,t){try{t(null,u(e))}catch(n){t(n)}},t.seedFileSync=u),t.collect=function(e){for(var n=e.length,r=0;r<n;++r)t.pools[t.pool].update(e.substr(r,1)),t.pool=31===t.pool?0:t.pool+1},t.collectInt=function(e,n){for(var r="",s=0;s<n;s+=8)r+=String.fromCharCode(e>>s&255);t.collect(r)},t.registerWorker=function(e){if(e===self)t.seedFile=function(e,t){function n(e){var r=e.data;r.forge&&r.forge.prng&&(self.removeEventListener("message",n),t(r.forge.prng.err,r.forge.prng.bytes))}self.addEventListener("message",n),self.postMessage({forge:{prng:{needed:e}}})};else{var n=function(n){var r=n.data;r.forge&&r.forge.prng&&t.seedFile(r.forge.prng.needed,(function(t,n){e.postMessage({forge:{prng:{err:t,bytes:n}}})}))};e.addEventListener("message",n)}},t}},121:function(e,t,n){var r=n(6143);n(8584),n(8666);var s=e.exports=r.pss=r.pss||{};s.create=function(e){3===arguments.length&&(e={md:arguments[0],mgf:arguments[1],saltLength:arguments[2]});var t,n=e.md,s=e.mgf,i=n.digestLength,o=e.salt||null;if("string"===typeof o&&(o=r.util.createBuffer(o)),"saltLength"in e)t=e.saltLength;else{if(null===o)throw new Error("Salt length not specified or specific salt not given.");t=o.length()}if(null!==o&&o.length()!==t)throw new Error("Given salt length does not match length of given salt.");var a=e.prng||r.random,c={encode:function(e,c){var l,u,h=c-1,d=Math.ceil(h/8),p=e.digest().getBytes();if(d<i+t+2)throw new Error("Message is too long to encrypt.");u=null===o?a.getBytesSync(t):o.bytes();var f=new r.util.ByteBuffer;f.fillWithByte(0,8),f.putBytes(p),f.putBytes(u),n.start(),n.update(f.getBytes());var g=n.digest().getBytes(),m=new r.util.ByteBuffer;m.fillWithByte(0,d-t-i-2),m.putByte(1),m.putBytes(u);var y=m.getBytes(),w=d-i-1,b=s.generate(g,w),v="";for(l=0;l<w;l++)v+=String.fromCharCode(y.charCodeAt(l)^b.charCodeAt(l));var E=65280>>8*d-h&255;return v=String.fromCharCode(v.charCodeAt(0)&~E)+v.substr(1),v+g+String.fromCharCode(188)},verify:function(e,o,a){var c,l=a-1,u=Math.ceil(l/8);if(o=o.substr(-u),u<i+t+2)throw new Error("Inconsistent parameters to PSS signature verification.");if(188!==o.charCodeAt(u-1))throw new Error("Encoded message does not end in 0xBC.");var h=u-i-1,d=o.substr(0,h),p=o.substr(h,i),f=65280>>8*u-l&255;if(0!==(d.charCodeAt(0)&f))throw new Error("Bits beyond keysize not zero as expected.");var g=s.generate(p,h),m="";for(c=0;c<h;c++)m+=String.fromCharCode(d.charCodeAt(c)^g.charCodeAt(c));m=String.fromCharCode(m.charCodeAt(0)&~f)+m.substr(1);var y=u-i-t-2;for(c=0;c<y;c++)if(0!==m.charCodeAt(c))throw new Error("Leftmost octets not zero as expected");if(1!==m.charCodeAt(y))throw new Error("Inconsistent PSS signature, 0x01 marker not found");var w=m.substr(-t),b=new r.util.ByteBuffer;b.fillWithByte(0,8),b.putBytes(e),b.putBytes(w),n.start(),n.update(b.getBytes());var v=n.digest().getBytes();return p===v}};return c}},8584:function(e,t,n){var r=n(6143);n(6509),n(9650),n(3772),n(8666),function(){r.random&&r.random.getBytes?e.exports=r.random:function(t){var n={},s=new Array(4),i=r.util.createBuffer();function o(){var e=r.prng.create(n);return e.getBytes=function(t,n){return e.generate(t,n)},e.getBytesSync=function(t){return e.generate(t)},e}n.formatKey=function(e){var t=r.util.createBuffer(e);return e=new Array(4),e[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),r.aes._expandKey(e,!1)},n.formatSeed=function(e){var t=r.util.createBuffer(e);return e=new Array(4),e[0]=t.getInt32(),e[1]=t.getInt32(),e[2]=t.getInt32(),e[3]=t.getInt32(),e},n.cipher=function(e,t){return r.aes._updateBlock(e,t,s,!1),i.putInt32(s[0]),i.putInt32(s[1]),i.putInt32(s[2]),i.putInt32(s[3]),i.getBytes()},n.increment=function(e){return++e[3],e},n.md=r.md.sha256;var a=o(),c=null,l=r.util.globalScope,u=l.crypto||l.msCrypto;if(u&&u.getRandomValues&&(c=function(e){return u.getRandomValues(e)}),r.options.usePureJavaScript||!r.util.isNodejs&&!c){if("undefined"===typeof window||window.document,a.collectInt(+new Date,32),"undefined"!==typeof navigator){var h="";for(var d in navigator)try{"string"==typeof navigator[d]&&(h+=navigator[d])}catch(p){}a.collect(h),h=null}t&&(t().mousemove((function(e){a.collectInt(e.clientX,16),a.collectInt(e.clientY,16)})),t().keypress((function(e){a.collectInt(e.charCode,8)})))}if(r.random)for(var d in a)r.random[d]=a[d];else r.random=a;r.random.createInstance=o,e.exports=r.random}("undefined"!==typeof jQuery?jQuery:null)}()},3398:function(e,t,n){n(7658);var r=n(6143);n(8666);var s=[217,120,249,196,25,221,181,237,40,233,253,121,74,160,216,157,198,126,55,131,43,118,83,142,98,76,100,136,68,139,251,162,23,154,89,245,135,179,79,19,97,69,109,141,9,129,125,50,189,143,64,235,134,183,123,11,240,149,33,34,92,107,78,130,84,214,101,147,206,96,178,28,115,86,192,20,167,140,241,220,18,117,202,31,59,190,228,209,66,61,212,48,163,60,182,38,111,191,14,218,70,105,7,87,39,242,29,155,188,148,67,3,248,17,199,246,144,239,62,231,6,195,213,47,200,102,30,215,8,232,234,222,128,82,238,247,132,170,114,172,53,77,106,42,150,26,210,113,90,21,73,116,75,159,208,94,4,24,164,236,194,224,65,110,15,81,203,204,36,145,175,80,161,244,112,57,153,124,58,133,35,184,180,122,252,2,54,91,37,85,151,49,45,93,250,152,227,138,146,174,5,223,41,16,103,108,186,201,211,0,230,207,225,158,168,44,99,22,1,63,88,226,137,169,13,56,52,27,171,51,255,176,187,72,12,95,185,177,205,46,197,243,219,71,229,165,156,119,10,166,32,104,254,127,193,173],i=[1,2,3,5],o=function(e,t){return e<<t&65535|(65535&e)>>16-t},a=function(e,t){return(65535&e)>>t|e<<16-t&65535};e.exports=r.rc2=r.rc2||{},r.rc2.expandKey=function(e,t){"string"===typeof e&&(e=r.util.createBuffer(e)),t=t||128;var n,i=e,o=e.length(),a=t,c=Math.ceil(a/8),l=255>>(7&a);for(n=o;n<128;n++)i.putByte(s[i.at(n-1)+i.at(n-o)&255]);for(i.setAt(128-c,s[i.at(128-c)&l]),n=127-c;n>=0;n--)i.setAt(n,s[i.at(n+1)^i.at(n+c)]);return i};var c=function(e,t,n){var s,c,l,u,h=!1,d=null,p=null,f=null,g=[];for(e=r.rc2.expandKey(e,t),l=0;l<64;l++)g.push(e.getInt16Le());n?(s=function(e){for(l=0;l<4;l++)e[l]+=g[u]+(e[(l+3)%4]&e[(l+2)%4])+(~e[(l+3)%4]&e[(l+1)%4]),e[l]=o(e[l],i[l]),u++},c=function(e){for(l=0;l<4;l++)e[l]+=g[63&e[(l+3)%4]]}):(s=function(e){for(l=3;l>=0;l--)e[l]=a(e[l],i[l]),e[l]-=g[u]+(e[(l+3)%4]&e[(l+2)%4])+(~e[(l+3)%4]&e[(l+1)%4]),u--},c=function(e){for(l=3;l>=0;l--)e[l]-=g[63&e[(l+3)%4]]});var m=function(e){var t=[];for(l=0;l<4;l++){var r=d.getInt16Le();null!==f&&(n?r^=f.getInt16Le():f.putInt16Le(r)),t.push(65535&r)}u=n?0:63;for(var s=0;s<e.length;s++)for(var i=0;i<e[s][0];i++)e[s][1](t);for(l=0;l<4;l++)null!==f&&(n?f.putInt16Le(t[l]):t[l]^=f.getInt16Le()),p.putInt16Le(t[l])},y=null;return y={start:function(e,t){e&&"string"===typeof e&&(e=r.util.createBuffer(e)),h=!1,d=r.util.createBuffer(),p=t||new r.util.createBuffer,f=e,y.output=p},update:function(e){h||d.putBuffer(e);while(d.length()>=8)m([[5,s],[1,c],[6,s],[1,c],[5,s]])},finish:function(e){var t=!0;if(n)if(e)t=e(8,d,!n);else{var r=8===d.length()?8:8-d.length();d.fillWithByte(r,r)}if(t&&(h=!0,y.update()),!n&&(t=0===d.length(),t))if(e)t=e(8,p,!n);else{var s=p.length(),i=p.at(s-1);i>s?t=!1:p.truncate(i)}return t}},y};r.rc2.startEncrypting=function(e,t,n){var s=r.rc2.createEncryptionCipher(e,128);return s.start(t,n),s},r.rc2.createEncryptionCipher=function(e,t){return c(e,t,!0)},r.rc2.startDecrypting=function(e,t,n){var s=r.rc2.createDecryptionCipher(e,128);return s.start(t,n),s},r.rc2.createDecryptionCipher=function(e,t){return c(e,t,!1)}},536:function(e,t,n){n(7658),n(3767),n(8585),n(8696);var r=n(6143);if(n(3655),n(3322),n(5828),n(8219),n(4537),n(8584),n(8666),"undefined"===typeof s)var s=r.jsbn.BigInteger;var i=r.util.isNodejs?n(5745):null,o=r.asn1,a=r.util;r.pki=r.pki||{},e.exports=r.pki.rsa=r.rsa=r.rsa||{};var c=r.pki,l=[6,4,2,4,2,4,6,2],u={name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"PrivateKeyInfo.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"PrivateKeyInfo.privateKeyAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"privateKeyOid"}]},{name:"PrivateKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"privateKey"}]},h={name:"RSAPrivateKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPrivateKey.version",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyVersion"},{name:"RSAPrivateKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyModulus"},{name:"RSAPrivateKey.publicExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPublicExponent"},{name:"RSAPrivateKey.privateExponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrivateExponent"},{name:"RSAPrivateKey.prime1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime1"},{name:"RSAPrivateKey.prime2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyPrime2"},{name:"RSAPrivateKey.exponent1",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent1"},{name:"RSAPrivateKey.exponent2",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyExponent2"},{name:"RSAPrivateKey.coefficient",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"privateKeyCoefficient"}]},d={name:"RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"RSAPublicKey.modulus",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyModulus"},{name:"RSAPublicKey.exponent",tagClass:o.Class.UNIVERSAL,type:o.Type.INTEGER,constructed:!1,capture:"publicKeyExponent"}]},p=r.pki.rsa.publicKeyValidator={name:"SubjectPublicKeyInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,captureAsn1:"subjectPublicKeyInfo",value:[{name:"SubjectPublicKeyInfo.AlgorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"AlgorithmIdentifier.algorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"publicKeyOid"}]},{name:"SubjectPublicKeyInfo.subjectPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.BITSTRING,constructed:!1,value:[{name:"SubjectPublicKeyInfo.subjectPublicKey.RSAPublicKey",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,optional:!0,captureAsn1:"rsaPublicKey"}]}]},f={name:"DigestInfo",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm",tagClass:o.Class.UNIVERSAL,type:o.Type.SEQUENCE,constructed:!0,value:[{name:"DigestInfo.DigestAlgorithm.algorithmIdentifier",tagClass:o.Class.UNIVERSAL,type:o.Type.OID,constructed:!1,capture:"algorithmIdentifier"},{name:"DigestInfo.DigestAlgorithm.parameters",tagClass:o.Class.UNIVERSAL,type:o.Type.NULL,capture:"parameters",optional:!0,constructed:!1}]},{name:"DigestInfo.digest",tagClass:o.Class.UNIVERSAL,type:o.Type.OCTETSTRING,constructed:!1,capture:"digest"}]},g=function(e){var t;if(!(e.algorithm in c.oids)){var n=new Error("Unknown message digest algorithm.");throw n.algorithm=e.algorithm,n}t=c.oids[e.algorithm];var r=o.oidToDer(t).getBytes(),s=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]),i=o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[]);i.value.push(o.create(o.Class.UNIVERSAL,o.Type.OID,!1,r)),i.value.push(o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,""));var a=o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,e.digest().getBytes());return s.value.push(i),s.value.push(a),o.toDer(s).getBytes()},m=function(e,t,n){if(n)return e.modPow(t.e,t.n);if(!t.p||!t.q)return e.modPow(t.d,t.n);var i;t.dP||(t.dP=t.d.mod(t.p.subtract(s.ONE))),t.dQ||(t.dQ=t.d.mod(t.q.subtract(s.ONE))),t.qInv||(t.qInv=t.q.modInverse(t.p));do{i=new s(r.util.bytesToHex(r.random.getBytes(t.n.bitLength()/8)),16)}while(i.compareTo(t.n)>=0||!i.gcd(t.n).equals(s.ONE));e=e.multiply(i.modPow(t.e,t.n)).mod(t.n);var o=e.mod(t.p).modPow(t.dP,t.p),a=e.mod(t.q).modPow(t.dQ,t.q);while(o.compareTo(a)<0)o=o.add(t.p);var c=o.subtract(a).multiply(t.qInv).mod(t.p).multiply(t.q).add(a);return c=c.multiply(i.modInverse(t.n)).mod(t.n),c};function y(e,t,n){var s=r.util.createBuffer(),i=Math.ceil(t.n.bitLength()/8);if(e.length>i-11){var o=new Error("Message is too long for PKCS#1 v1.5 padding.");throw o.length=e.length,o.max=i-11,o}s.putByte(0),s.putByte(n);var a,c=i-3-e.length;if(0===n||1===n){a=0===n?0:255;for(var l=0;l<c;++l)s.putByte(a)}else while(c>0){var u=0,h=r.random.getBytes(c);for(l=0;l<c;++l)a=h.charCodeAt(l),0===a?++u:s.putByte(a);c=u}return s.putByte(0),s.putBytes(e),s}function w(e,t,n,s){var i=Math.ceil(t.n.bitLength()/8),o=r.util.createBuffer(e),a=o.getByte(),c=o.getByte();if(0!==a||n&&0!==c&&1!==c||!n&&2!=c||n&&0===c&&"undefined"===typeof s)throw new Error("Encryption block is invalid.");var l=0;if(0===c){l=i-3-s;for(var u=0;u<l;++u)if(0!==o.getByte())throw new Error("Encryption block is invalid.")}else if(1===c){l=0;while(o.length()>1){if(255!==o.getByte()){--o.read;break}++l}}else if(2===c){l=0;while(o.length()>1){if(0===o.getByte()){--o.read;break}++l}}var h=o.getByte();if(0!==h||l!==i-3-o.length())throw new Error("Encryption block is invalid.");return o.getBytes()}function b(e,t,n){"function"===typeof t&&(n=t,t={}),t=t||{};var i={algorithm:{name:t.algorithm||"PRIMEINC",options:{workers:t.workers||2,workLoad:t.workLoad||100,workerScript:t.workerScript}}};function o(){a(e.pBits,(function(t,r){return t?n(t):(e.p=r,null!==e.q?l(t,e.q):void a(e.qBits,l))}))}function a(e,t){r.prime.generateProbablePrime(e,i,t)}function l(t,r){if(t)return n(t);if(e.q=r,e.p.compareTo(e.q)<0){var i=e.p;e.p=e.q,e.q=i}if(0!==e.p.subtract(s.ONE).gcd(e.e).compareTo(s.ONE))return e.p=null,void o();if(0!==e.q.subtract(s.ONE).gcd(e.e).compareTo(s.ONE))return e.q=null,void a(e.qBits,l);if(e.p1=e.p.subtract(s.ONE),e.q1=e.q.subtract(s.ONE),e.phi=e.p1.multiply(e.q1),0!==e.phi.gcd(e.e).compareTo(s.ONE))return e.p=e.q=null,void o();if(e.n=e.p.multiply(e.q),e.n.bitLength()!==e.bits)return e.q=null,void a(e.qBits,l);var u=e.e.modInverse(e.phi);e.keys={privateKey:c.rsa.setPrivateKey(e.n,e.e,u,e.p,e.q,u.mod(e.p1),u.mod(e.q1),e.q.modInverse(e.p)),publicKey:c.rsa.setPublicKey(e.n,e.e)},n(null,e.keys)}"prng"in t&&(i.prng=t.prng),o()}function v(e){var t=e.toString(16);t[0]>="8"&&(t="00"+t);var n=r.util.hexToBytes(t);return n.length>1&&(0===n.charCodeAt(0)&&0===(128&n.charCodeAt(1))||255===n.charCodeAt(0)&&128===(128&n.charCodeAt(1)))?n.substr(1):n}function E(e){return e<=100?27:e<=150?18:e<=200?15:e<=250?12:e<=300?9:e<=350?8:e<=400?7:e<=500?6:e<=600?5:e<=800?4:e<=1250?3:2}function _(e){return r.util.isNodejs&&"function"===typeof i[e]}function S(e){return"undefined"!==typeof a.globalScope&&"object"===typeof a.globalScope.crypto&&"object"===typeof a.globalScope.crypto.subtle&&"function"===typeof a.globalScope.crypto.subtle[e]}function k(e){return"undefined"!==typeof a.globalScope&&"object"===typeof a.globalScope.msCrypto&&"object"===typeof a.globalScope.msCrypto.subtle&&"function"===typeof a.globalScope.msCrypto.subtle[e]}function A(e){for(var t=r.util.hexToBytes(e.toString(16)),n=new Uint8Array(t.length),s=0;s<t.length;++s)n[s]=t.charCodeAt(s);return n}c.rsa.encrypt=function(e,t,n){var i,o=n,a=Math.ceil(t.n.bitLength()/8);!1!==n&&!0!==n?(o=2===n,i=y(e,t,n)):(i=r.util.createBuffer(),i.putBytes(e));var c=new s(i.toHex(),16),l=m(c,t,o),u=l.toString(16),h=r.util.createBuffer(),d=a-Math.ceil(u.length/2);while(d>0)h.putByte(0),--d;return h.putBytes(r.util.hexToBytes(u)),h.getBytes()},c.rsa.decrypt=function(e,t,n,i){var o=Math.ceil(t.n.bitLength()/8);if(e.length!==o){var a=new Error("Encrypted message length is invalid.");throw a.length=e.length,a.expected=o,a}var c=new s(r.util.createBuffer(e).toHex(),16);if(c.compareTo(t.n)>=0)throw new Error("Encrypted message is invalid.");var l=m(c,t,n),u=l.toString(16),h=r.util.createBuffer(),d=o-Math.ceil(u.length/2);while(d>0)h.putByte(0),--d;return h.putBytes(r.util.hexToBytes(u)),!1!==i?w(h.getBytes(),t,n):h.getBytes()},c.rsa.createKeyPairGenerationState=function(e,t,n){"string"===typeof e&&(e=parseInt(e,10)),e=e||2048,n=n||{};var i,o=n.prng||r.random,a={nextBytes:function(e){for(var t=o.getBytesSync(e.length),n=0;n<e.length;++n)e[n]=t.charCodeAt(n)}},c=n.algorithm||"PRIMEINC";if("PRIMEINC"!==c)throw new Error("Invalid key generation algorithm: "+c);return i={algorithm:c,state:0,bits:e,rng:a,eInt:t||65537,e:new s(null),p:null,q:null,qBits:e>>1,pBits:e-(e>>1),pqState:0,num:null,keys:null},i.e.fromInt(i.eInt),i},c.rsa.stepKeyPairGenerationState=function(e,t){"algorithm"in e||(e.algorithm="PRIMEINC");var n=new s(null);n.fromInt(30);var r,i=0,o=function(e,t){return e|t},a=+new Date,u=0;while(null===e.keys&&(t<=0||u<t)){if(0===e.state){var h=null===e.p?e.pBits:e.qBits,d=h-1;0===e.pqState?(e.num=new s(h,e.rng),e.num.testBit(d)||e.num.bitwiseTo(s.ONE.shiftLeft(d),o,e.num),e.num.dAddOffset(31-e.num.mod(n).byteValue(),0),i=0,++e.pqState):1===e.pqState?e.num.bitLength()>h?e.pqState=0:e.num.isProbablePrime(E(e.num.bitLength()))?++e.pqState:e.num.dAddOffset(l[i++%8],0):2===e.pqState?e.pqState=0===e.num.subtract(s.ONE).gcd(e.e).compareTo(s.ONE)?3:0:3===e.pqState&&(e.pqState=0,null===e.p?e.p=e.num:e.q=e.num,null!==e.p&&null!==e.q&&++e.state,e.num=null)}else if(1===e.state)e.p.compareTo(e.q)<0&&(e.num=e.p,e.p=e.q,e.q=e.num),++e.state;else if(2===e.state)e.p1=e.p.subtract(s.ONE),e.q1=e.q.subtract(s.ONE),e.phi=e.p1.multiply(e.q1),++e.state;else if(3===e.state)0===e.phi.gcd(e.e).compareTo(s.ONE)?++e.state:(e.p=null,e.q=null,e.state=0);else if(4===e.state)e.n=e.p.multiply(e.q),e.n.bitLength()===e.bits?++e.state:(e.q=null,e.state=0);else if(5===e.state){var p=e.e.modInverse(e.phi);e.keys={privateKey:c.rsa.setPrivateKey(e.n,e.e,p,e.p,e.q,p.mod(e.p1),p.mod(e.q1),e.q.modInverse(e.p)),publicKey:c.rsa.setPublicKey(e.n,e.e)}}r=+new Date,u+=r-a,a=r}return null!==e.keys},c.rsa.generateKeyPair=function(e,t,n,s){if(1===arguments.length?"object"===typeof e?(n=e,e=void 0):"function"===typeof e&&(s=e,e=void 0):2===arguments.length?"number"===typeof e?"function"===typeof t?(s=t,t=void 0):"number"!==typeof t&&(n=t,t=void 0):(n=e,s=t,e=void 0,t=void 0):3===arguments.length&&("number"===typeof t?"function"===typeof n&&(s=n,n=void 0):(s=n,n=t,t=void 0)),n=n||{},void 0===e&&(e=n.bits||2048),void 0===t&&(t=n.e||65537),!r.options.usePureJavaScript&&!n.prng&&e>=256&&e<=16384&&(65537===t||3===t))if(s){if(_("generateKeyPair"))return i.generateKeyPair("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}},(function(e,t,n){if(e)return s(e);s(null,{privateKey:c.privateKeyFromPem(n),publicKey:c.publicKeyFromPem(t)})}));if(S("generateKey")&&S("exportKey"))return a.globalScope.crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:A(t),hash:{name:"SHA-256"}},!0,["sign","verify"]).then((function(e){return a.globalScope.crypto.subtle.exportKey("pkcs8",e.privateKey)})).then(void 0,(function(e){s(e)})).then((function(e){if(e){var t=c.privateKeyFromAsn1(o.fromDer(r.util.createBuffer(e)));s(null,{privateKey:t,publicKey:c.setRsaPublicKey(t.n,t.e)})}}));if(k("generateKey")&&k("exportKey")){var l=a.globalScope.msCrypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:A(t),hash:{name:"SHA-256"}},!0,["sign","verify"]);return l.oncomplete=function(e){var t=e.target.result,n=a.globalScope.msCrypto.subtle.exportKey("pkcs8",t.privateKey);n.oncomplete=function(e){var t=e.target.result,n=c.privateKeyFromAsn1(o.fromDer(r.util.createBuffer(t)));s(null,{privateKey:n,publicKey:c.setRsaPublicKey(n.n,n.e)})},n.onerror=function(e){s(e)}},void(l.onerror=function(e){s(e)})}}else if(_("generateKeyPairSync")){var u=i.generateKeyPairSync("rsa",{modulusLength:e,publicExponent:t,publicKeyEncoding:{type:"spki",format:"pem"},privateKeyEncoding:{type:"pkcs8",format:"pem"}});return{privateKey:c.privateKeyFromPem(u.privateKey),publicKey:c.publicKeyFromPem(u.publicKey)}}var h=c.rsa.createKeyPairGenerationState(e,t,n);if(!s)return c.rsa.stepKeyPairGenerationState(h,0),h.keys;b(h,n,s)},c.setRsaPublicKey=c.rsa.setPublicKey=function(e,t){var n={n:e,e:t,encrypt:function(e,t,s){if("string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5"),"RSAES-PKCS1-V1_5"===t)t={encode:function(e,t,n){return y(e,t,2).getBytes()}};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={encode:function(e,t){return r.pkcs1.encode_rsa_oaep(t,e,s)}};else if(-1!==["RAW","NONE","NULL",null].indexOf(t))t={encode:function(e){return e}};else if("string"===typeof t)throw new Error('Unsupported encryption scheme: "'+t+'".');var i=t.encode(e,n,!0);return c.rsa.encrypt(i,n,!0)},verify:function(e,t,s,i){"string"===typeof s?s=s.toUpperCase():void 0===s&&(s="RSASSA-PKCS1-V1_5"),void 0===i&&(i={_parseAllDigestBytes:!0}),"_parseAllDigestBytes"in i||(i._parseAllDigestBytes=!0),"RSASSA-PKCS1-V1_5"===s?s={verify:function(e,t){t=w(t,n,!0);var s=o.fromDer(t,{parseAllBytes:i._parseAllDigestBytes}),a={},c=[];if(!o.validate(s,f,a,c)){var l=new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value.");throw l.errors=c,l}var u=o.derToOid(a.algorithmIdentifier);if(u!==r.oids.md2&&u!==r.oids.md5&&u!==r.oids.sha1&&u!==r.oids.sha224&&u!==r.oids.sha256&&u!==r.oids.sha384&&u!==r.oids.sha512&&u!==r.oids["sha512-224"]&&u!==r.oids["sha512-256"]){l=new Error("Unknown RSASSA-PKCS1-v1_5 DigestAlgorithm identifier.");throw l.oid=u,l}if((u===r.oids.md2||u===r.oids.md5)&&!("parameters"in a))throw new Error("ASN.1 object does not contain a valid RSASSA-PKCS1-v1_5 DigestInfo value. Missing algorithm identifer NULL parameters.");return e===a.digest}}:"NONE"!==s&&"NULL"!==s&&null!==s||(s={verify:function(e,t){return t=w(t,n,!0),e===t}});var a=c.rsa.decrypt(t,n,!0,!1);return s.verify(e,a,n.n.bitLength())}};return n},c.setRsaPrivateKey=c.rsa.setPrivateKey=function(e,t,n,s,i,o,a,l){var u={n:e,e:t,d:n,p:s,q:i,dP:o,dQ:a,qInv:l,decrypt:function(e,t,n){"string"===typeof t?t=t.toUpperCase():void 0===t&&(t="RSAES-PKCS1-V1_5");var s=c.rsa.decrypt(e,u,!1,!1);if("RSAES-PKCS1-V1_5"===t)t={decode:w};else if("RSA-OAEP"===t||"RSAES-OAEP"===t)t={decode:function(e,t){return r.pkcs1.decode_rsa_oaep(t,e,n)}};else{if(-1===["RAW","NONE","NULL",null].indexOf(t))throw new Error('Unsupported encryption scheme: "'+t+'".');t={decode:function(e){return e}}}return t.decode(s,u,!1)},sign:function(e,t){var n=!1;"string"===typeof t&&(t=t.toUpperCase()),void 0===t||"RSASSA-PKCS1-V1_5"===t?(t={encode:g},n=1):"NONE"!==t&&"NULL"!==t&&null!==t||(t={encode:function(){return e}},n=1);var r=t.encode(e,u.n.bitLength());return c.rsa.encrypt(r,u,n)}};return u},c.wrapRsaPrivateKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.OCTETSTRING,!1,o.toDer(e).getBytes())])},c.privateKeyFromAsn1=function(e){var t,n,i,a,l,d,p,f,g={},m=[];if(o.validate(e,u,g,m)&&(e=o.fromDer(r.util.createBuffer(g.privateKey))),g={},m=[],!o.validate(e,h,g,m)){var y=new Error("Cannot read private key. ASN.1 object does not contain an RSAPrivateKey.");throw y.errors=m,y}return t=r.util.createBuffer(g.privateKeyModulus).toHex(),n=r.util.createBuffer(g.privateKeyPublicExponent).toHex(),i=r.util.createBuffer(g.privateKeyPrivateExponent).toHex(),a=r.util.createBuffer(g.privateKeyPrime1).toHex(),l=r.util.createBuffer(g.privateKeyPrime2).toHex(),d=r.util.createBuffer(g.privateKeyExponent1).toHex(),p=r.util.createBuffer(g.privateKeyExponent2).toHex(),f=r.util.createBuffer(g.privateKeyCoefficient).toHex(),c.setRsaPrivateKey(new s(t,16),new s(n,16),new s(i,16),new s(a,16),new s(l,16),new s(d,16),new s(p,16),new s(f,16))},c.privateKeyToAsn1=c.privateKeyToRSAPrivateKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,o.integerToDer(0).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.e)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.d)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.p)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.q)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.dP)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.dQ)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.qInv))])},c.publicKeyFromAsn1=function(e){var t={},n=[];if(o.validate(e,p,t,n)){var i=o.derToOid(t.publicKeyOid);if(i!==c.oids.rsaEncryption){var a=new Error("Cannot read public key. Unknown OID.");throw a.oid=i,a}e=t.rsaPublicKey}if(n=[],!o.validate(e,d,t,n)){a=new Error("Cannot read public key. ASN.1 object does not contain an RSAPublicKey.");throw a.errors=n,a}var l=r.util.createBuffer(t.publicKeyModulus).toHex(),u=r.util.createBuffer(t.publicKeyExponent).toHex();return c.setRsaPublicKey(new s(l,16),new s(u,16))},c.publicKeyToAsn1=c.publicKeyToSubjectPublicKeyInfo=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.OID,!1,o.oidToDer(c.oids.rsaEncryption).getBytes()),o.create(o.Class.UNIVERSAL,o.Type.NULL,!1,"")]),o.create(o.Class.UNIVERSAL,o.Type.BITSTRING,!1,[c.publicKeyToRSAPublicKey(e)])])},c.publicKeyToRSAPublicKey=function(e){return o.create(o.Class.UNIVERSAL,o.Type.SEQUENCE,!0,[o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.n)),o.create(o.Class.UNIVERSAL,o.Type.INTEGER,!1,v(e.e))])}},8927:function(e,t,n){n(7658);var r=n(6143);n(2713),n(8666);var s=e.exports=r.sha1=r.sha1||{};r.md.sha1=r.md.algorithms.sha1=s,s.create=function(){o||a();var e=null,t=r.util.createBuffer(),n=new Array(80),s={algorithm:"sha1",blockLength:64,digestLength:20,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){s.messageLength=0,s.fullMessageLength=s.messageLength64=[];for(var n=s.messageLengthSize/4,i=0;i<n;++i)s.fullMessageLength.push(0);return t=r.util.createBuffer(),e={h0:1732584193,h1:4023233417,h2:2562383102,h3:271733878,h4:3285377520},s}};return s.start(),s.update=function(i,o){"utf8"===o&&(i=r.util.encodeUtf8(i));var a=i.length;s.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var l=s.fullMessageLength.length-1;l>=0;--l)s.fullMessageLength[l]+=a[1],a[1]=a[0]+(s.fullMessageLength[l]/4294967296>>>0),s.fullMessageLength[l]=s.fullMessageLength[l]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(i),c(e,n,t),(t.read>2048||0===t.length())&&t.compact(),s},s.digest=function(){var o=r.util.createBuffer();o.putBytes(t.bytes());var a,l,u=s.fullMessageLength[s.fullMessageLength.length-1]+s.messageLengthSize,h=u&s.blockLength-1;o.putBytes(i.substr(0,s.blockLength-h));for(var d=8*s.fullMessageLength[0],p=0;p<s.fullMessageLength.length-1;++p)a=8*s.fullMessageLength[p+1],l=a/4294967296>>>0,d+=l,o.putInt32(d>>>0),d=a>>>0;o.putInt32(d);var f={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4};c(f,n,o);var g=r.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g},s};var i=null,o=!1;function a(){i=String.fromCharCode(128),i+=r.util.fillString(String.fromCharCode(0),64),o=!0}function c(e,t,n){var r,s,i,o,a,c,l,u,h=n.length();while(h>=64){for(s=e.h0,i=e.h1,o=e.h2,a=e.h3,c=e.h4,u=0;u<16;++u)r=n.getInt32(),t[u]=r,l=a^i&(o^a),r=(s<<5|s>>>27)+l+c+1518500249+r,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=r;for(;u<20;++u)r=t[u-3]^t[u-8]^t[u-14]^t[u-16],r=r<<1|r>>>31,t[u]=r,l=a^i&(o^a),r=(s<<5|s>>>27)+l+c+1518500249+r,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=r;for(;u<32;++u)r=t[u-3]^t[u-8]^t[u-14]^t[u-16],r=r<<1|r>>>31,t[u]=r,l=i^o^a,r=(s<<5|s>>>27)+l+c+1859775393+r,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=r;for(;u<40;++u)r=t[u-6]^t[u-16]^t[u-28]^t[u-32],r=r<<2|r>>>30,t[u]=r,l=i^o^a,r=(s<<5|s>>>27)+l+c+1859775393+r,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=r;for(;u<60;++u)r=t[u-6]^t[u-16]^t[u-28]^t[u-32],r=r<<2|r>>>30,t[u]=r,l=i&o|a&(i^o),r=(s<<5|s>>>27)+l+c+2400959708+r,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=r;for(;u<80;++u)r=t[u-6]^t[u-16]^t[u-28]^t[u-32],r=r<<2|r>>>30,t[u]=r,l=i^o^a,r=(s<<5|s>>>27)+l+c+3395469782+r,c=a,a=o,o=(i<<30|i>>>2)>>>0,i=s,s=r;e.h0=e.h0+s|0,e.h1=e.h1+i|0,e.h2=e.h2+o|0,e.h3=e.h3+a|0,e.h4=e.h4+c|0,h-=64}}},9650:function(e,t,n){n(7658);var r=n(6143);n(2713),n(8666);var s=e.exports=r.sha256=r.sha256||{};r.md.sha256=r.md.algorithms.sha256=s,s.create=function(){o||c();var e=null,t=r.util.createBuffer(),n=new Array(64),s={algorithm:"sha256",blockLength:64,digestLength:32,messageLength:0,fullMessageLength:null,messageLengthSize:8,start:function(){s.messageLength=0,s.fullMessageLength=s.messageLength64=[];for(var n=s.messageLengthSize/4,i=0;i<n;++i)s.fullMessageLength.push(0);return t=r.util.createBuffer(),e={h0:1779033703,h1:3144134277,h2:1013904242,h3:2773480762,h4:1359893119,h5:2600822924,h6:528734635,h7:1541459225},s}};return s.start(),s.update=function(i,o){"utf8"===o&&(i=r.util.encodeUtf8(i));var a=i.length;s.messageLength+=a,a=[a/4294967296>>>0,a>>>0];for(var c=s.fullMessageLength.length-1;c>=0;--c)s.fullMessageLength[c]+=a[1],a[1]=a[0]+(s.fullMessageLength[c]/4294967296>>>0),s.fullMessageLength[c]=s.fullMessageLength[c]>>>0,a[0]=a[1]/4294967296>>>0;return t.putBytes(i),l(e,n,t),(t.read>2048||0===t.length())&&t.compact(),s},s.digest=function(){var o=r.util.createBuffer();o.putBytes(t.bytes());var a,c,u=s.fullMessageLength[s.fullMessageLength.length-1]+s.messageLengthSize,h=u&s.blockLength-1;o.putBytes(i.substr(0,s.blockLength-h));for(var d=8*s.fullMessageLength[0],p=0;p<s.fullMessageLength.length-1;++p)a=8*s.fullMessageLength[p+1],c=a/4294967296>>>0,d+=c,o.putInt32(d>>>0),d=a>>>0;o.putInt32(d);var f={h0:e.h0,h1:e.h1,h2:e.h2,h3:e.h3,h4:e.h4,h5:e.h5,h6:e.h6,h7:e.h7};l(f,n,o);var g=r.util.createBuffer();return g.putInt32(f.h0),g.putInt32(f.h1),g.putInt32(f.h2),g.putInt32(f.h3),g.putInt32(f.h4),g.putInt32(f.h5),g.putInt32(f.h6),g.putInt32(f.h7),g},s};var i=null,o=!1,a=null;function c(){i=String.fromCharCode(128),i+=r.util.fillString(String.fromCharCode(0),64),a=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=!0}function l(e,t,n){var r,s,i,o,c,l,u,h,d,p,f,g,m,y,w,b=n.length();while(b>=64){for(u=0;u<16;++u)t[u]=n.getInt32();for(;u<64;++u)r=t[u-2],r=(r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10,s=t[u-15],s=(s>>>7|s<<25)^(s>>>18|s<<14)^s>>>3,t[u]=r+t[u-7]+s+t[u-16]|0;for(h=e.h0,d=e.h1,p=e.h2,f=e.h3,g=e.h4,m=e.h5,y=e.h6,w=e.h7,u=0;u<64;++u)o=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7),c=y^g&(m^y),i=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),l=h&d|p&(h^d),r=w+o+c+a[u]+t[u],s=i+l,w=y,y=m,m=g,g=f+r>>>0,f=p,p=d,d=h,h=r+s>>>0;e.h0=e.h0+h|0,e.h1=e.h1+d|0,e.h2=e.h2+p|0,e.h3=e.h3+f|0,e.h4=e.h4+g|0,e.h5=e.h5+m|0,e.h6=e.h6+y|0,e.h7=e.h7+w|0,b-=64}}},517:function(e,t,n){n(7658);var r=n(6143);n(2713),n(8666);var s=e.exports=r.sha512=r.sha512||{};r.md.sha512=r.md.algorithms.sha512=s;var i=r.sha384=r.sha512.sha384=r.sha512.sha384||{};i.create=function(){return s.create("SHA-384")},r.md.sha384=r.md.algorithms.sha384=i,r.sha512.sha256=r.sha512.sha256||{create:function(){return s.create("SHA-512/256")}},r.md["sha512/256"]=r.md.algorithms["sha512/256"]=r.sha512.sha256,r.sha512.sha224=r.sha512.sha224||{create:function(){return s.create("SHA-512/224")}},r.md["sha512/224"]=r.md.algorithms["sha512/224"]=r.sha512.sha224,s.create=function(e){if(a||u(),"undefined"===typeof e&&(e="SHA-512"),!(e in l))throw new Error("Invalid SHA-512 algorithm: "+e);for(var t=l[e],n=null,s=r.util.createBuffer(),i=new Array(80),c=0;c<80;++c)i[c]=new Array(2);var d=64;switch(e){case"SHA-384":d=48;break;case"SHA-512/256":d=32;break;case"SHA-512/224":d=28;break}var p={algorithm:e.replace("-","").toLowerCase(),blockLength:128,digestLength:d,messageLength:0,fullMessageLength:null,messageLengthSize:16,start:function(){p.messageLength=0,p.fullMessageLength=p.messageLength128=[];for(var e=p.messageLengthSize/4,i=0;i<e;++i)p.fullMessageLength.push(0);s=r.util.createBuffer(),n=new Array(t.length);for(i=0;i<t.length;++i)n[i]=t[i].slice(0);return p}};return p.start(),p.update=function(e,t){"utf8"===t&&(e=r.util.encodeUtf8(e));var o=e.length;p.messageLength+=o,o=[o/4294967296>>>0,o>>>0];for(var a=p.fullMessageLength.length-1;a>=0;--a)p.fullMessageLength[a]+=o[1],o[1]=o[0]+(p.fullMessageLength[a]/4294967296>>>0),p.fullMessageLength[a]=p.fullMessageLength[a]>>>0,o[0]=o[1]/4294967296>>>0;return s.putBytes(e),h(n,i,s),(s.read>2048||0===s.length())&&s.compact(),p},p.digest=function(){var t=r.util.createBuffer();t.putBytes(s.bytes());var a,c,l=p.fullMessageLength[p.fullMessageLength.length-1]+p.messageLengthSize,u=l&p.blockLength-1;t.putBytes(o.substr(0,p.blockLength-u));for(var d=8*p.fullMessageLength[0],f=0;f<p.fullMessageLength.length-1;++f)a=8*p.fullMessageLength[f+1],c=a/4294967296>>>0,d+=c,t.putInt32(d>>>0),d=a>>>0;t.putInt32(d);var g=new Array(n.length);for(f=0;f<n.length;++f)g[f]=n[f].slice(0);h(g,i,t);var m,y=r.util.createBuffer();m="SHA-512"===e?g.length:"SHA-384"===e?g.length-2:g.length-4;for(f=0;f<m;++f)y.putInt32(g[f][0]),f===m-1&&"SHA-512/224"===e||y.putInt32(g[f][1]);return y},p};var o=null,a=!1,c=null,l=null;function u(){o=String.fromCharCode(128),o+=r.util.fillString(String.fromCharCode(0),128),c=[[1116352408,3609767458],[1899447441,602891725],[3049323471,3964484399],[3921009573,2173295548],[961987163,4081628472],[1508970993,3053834265],[2453635748,2937671579],[2870763221,3664609560],[3624381080,2734883394],[310598401,1164996542],[607225278,1323610764],[1426881987,3590304994],[1925078388,4068182383],[2162078206,991336113],[2614888103,633803317],[3248222580,3479774868],[3835390401,2666613458],[4022224774,944711139],[264347078,2341262773],[604807628,2007800933],[770255983,1495990901],[1249150122,1856431235],[1555081692,3175218132],[1996064986,2198950837],[2554220882,3999719339],[2821834349,766784016],[2952996808,2566594879],[3210313671,3203337956],[3336571891,1034457026],[3584528711,2466948901],[113926993,3758326383],[338241895,168717936],[666307205,1188179964],[773529912,1546045734],[1294757372,1522805485],[1396182291,2643833823],[1695183700,2343527390],[1986661051,1014477480],[2177026350,1206759142],[2456956037,344077627],[2730485921,1290863460],[2820302411,3158454273],[3259730800,3505952657],[3345764771,106217008],[3516065817,3606008344],[3600352804,1432725776],[4094571909,1467031594],[275423344,851169720],[430227734,3100823752],[506948616,1363258195],[659060556,3750685593],[883997877,3785050280],[958139571,3318307427],[1322822218,3812723403],[1537002063,2003034995],[1747873779,3602036899],[1955562222,1575990012],[2024104815,1125592928],[2227730452,2716904306],[2361852424,442776044],[2428436474,593698344],[2756734187,3733110249],[3204031479,2999351573],[3329325298,3815920427],[3391569614,3928383900],[3515267271,566280711],[3940187606,3454069534],[4118630271,4000239992],[116418474,1914138554],[174292421,2731055270],[289380356,3203993006],[460393269,320620315],[685471733,587496836],[852142971,1086792851],[1017036298,365543100],[1126000580,2618297676],[1288033470,3409855158],[1501505948,4234509866],[1607167915,987167468],[1816402316,1246189591]],l={},l["SHA-512"]=[[1779033703,4089235720],[3144134277,2227873595],[1013904242,4271175723],[2773480762,1595750129],[1359893119,2917565137],[2600822924,725511199],[528734635,4215389547],[1541459225,327033209]],l["SHA-384"]=[[3418070365,3238371032],[1654270250,914150663],[2438529370,812702999],[355462360,4144912697],[1731405415,4290775857],[2394180231,1750603025],[3675008525,1694076839],[1203062813,3204075428]],l["SHA-512/256"]=[[573645204,4230739756],[2673172387,3360449730],[596883563,1867755857],[2520282905,1497426621],[2519219938,2827943907],[3193839141,1401305490],[721525244,746961066],[246885852,2177182882]],l["SHA-512/224"]=[[2352822216,424955298],[1944164710,2312950998],[502970286,855612546],[1738396948,1479516111],[258812777,2077511080],[2011393907,79989058],[1067287976,1780299464],[286451373,2446758561]],a=!0}function h(e,t,n){var r,s,i,o,a,l,u,h,d,p,f,g,m,y,w,b,v,E,_,S,k,A,T,C,I,R,O,x,N,D,P,L,M,B,U,V=n.length();while(V>=128){for(N=0;N<16;++N)t[N][0]=n.getInt32()>>>0,t[N][1]=n.getInt32()>>>0;for(;N<80;++N)L=t[N-2],D=L[0],P=L[1],r=((D>>>19|P<<13)^(P>>>29|D<<3)^D>>>6)>>>0,s=((D<<13|P>>>19)^(P<<3|D>>>29)^(D<<26|P>>>6))>>>0,B=t[N-15],D=B[0],P=B[1],i=((D>>>1|P<<31)^(D>>>8|P<<24)^D>>>7)>>>0,o=((D<<31|P>>>1)^(D<<24|P>>>8)^(D<<25|P>>>7))>>>0,M=t[N-7],U=t[N-16],P=s+M[1]+o+U[1],t[N][0]=r+M[0]+i+U[0]+(P/4294967296>>>0)>>>0,t[N][1]=P>>>0;for(m=e[0][0],y=e[0][1],w=e[1][0],b=e[1][1],v=e[2][0],E=e[2][1],_=e[3][0],S=e[3][1],k=e[4][0],A=e[4][1],T=e[5][0],C=e[5][1],I=e[6][0],R=e[6][1],O=e[7][0],x=e[7][1],N=0;N<80;++N)u=((k>>>14|A<<18)^(k>>>18|A<<14)^(A>>>9|k<<23))>>>0,h=((k<<18|A>>>14)^(k<<14|A>>>18)^(A<<23|k>>>9))>>>0,d=(I^k&(T^I))>>>0,p=(R^A&(C^R))>>>0,a=((m>>>28|y<<4)^(y>>>2|m<<30)^(y>>>7|m<<25))>>>0,l=((m<<4|y>>>28)^(y<<30|m>>>2)^(y<<25|m>>>7))>>>0,f=(m&w|v&(m^w))>>>0,g=(y&b|E&(y^b))>>>0,P=x+h+p+c[N][1]+t[N][1],r=O+u+d+c[N][0]+t[N][0]+(P/4294967296>>>0)>>>0,s=P>>>0,P=l+g,i=a+f+(P/4294967296>>>0)>>>0,o=P>>>0,O=I,x=R,I=T,R=C,T=k,C=A,P=S+s,k=_+r+(P/4294967296>>>0)>>>0,A=P>>>0,_=v,S=E,v=w,E=b,w=m,b=y,P=s+o,m=r+i+(P/4294967296>>>0)>>>0,y=P>>>0;P=e[0][1]+y,e[0][0]=e[0][0]+m+(P/4294967296>>>0)>>>0,e[0][1]=P>>>0,P=e[1][1]+b,e[1][0]=e[1][0]+w+(P/4294967296>>>0)>>>0,e[1][1]=P>>>0,P=e[2][1]+E,e[2][0]=e[2][0]+v+(P/4294967296>>>0)>>>0,e[2][1]=P>>>0,P=e[3][1]+S,e[3][0]=e[3][0]+_+(P/4294967296>>>0)>>>0,e[3][1]=P>>>0,P=e[4][1]+A,e[4][0]=e[4][0]+k+(P/4294967296>>>0)>>>0,e[4][1]=P>>>0,P=e[5][1]+C,e[5][0]=e[5][0]+T+(P/4294967296>>>0)>>>0,e[5][1]=P>>>0,P=e[6][1]+R,e[6][0]=e[6][0]+I+(P/4294967296>>>0)>>>0,e[6][1]=P>>>0,P=e[7][1]+x,e[7][0]=e[7][0]+O+(P/4294967296>>>0)>>>0,e[7][1]=P>>>0,V-=128}}},8666:function(e,t,n){n(4633),n(7658),n(3767),n(8585),n(8696),n(541);var r=n(6143),s=n(3441),i=e.exports=r.util=r.util||{};function o(e){if(8!==e&&16!==e&&24!==e&&32!==e)throw new Error("Only 8, 16, 24, or 32 bits supported: "+e)}function a(e){if(this.data="",this.read=0,"string"===typeof e)this.data=e;else if(i.isArrayBuffer(e)||i.isArrayBufferView(e))if("undefined"!==typeof Buffer&&e instanceof Buffer)this.data=e.toString("binary");else{var t=new Uint8Array(e);try{this.data=String.fromCharCode.apply(null,t)}catch(r){for(var n=0;n<t.length;++n)this.putByte(t[n])}}else(e instanceof a||"object"===typeof e&&"string"===typeof e.data&&"number"===typeof e.read)&&(this.data=e.data,this.read=e.read);this._constructedStringLength=0}(function(){if("undefined"!==typeof process&&process.nextTick&&!process.browser)return i.nextTick=process.nextTick,void("function"===typeof setImmediate?i.setImmediate=setImmediate:i.setImmediate=i.nextTick);if("function"===typeof setImmediate)return i.setImmediate=function(){return setImmediate.apply(void 0,arguments)},void(i.nextTick=function(e){return setImmediate(e)});if(i.setImmediate=function(e){setTimeout(e,0)},"undefined"!==typeof window&&"function"===typeof window.postMessage){var e="forge.setImmediate",t=[];function n(n){if(n.source===window&&n.data===e){n.stopPropagation();var r=t.slice();t.length=0,r.forEach((function(e){e()}))}}i.setImmediate=function(n){t.push(n),1===t.length&&window.postMessage(e,"*")},window.addEventListener("message",n,!0)}if("undefined"!==typeof MutationObserver){var r=Date.now(),s=!0,o=document.createElement("div");t=[];new MutationObserver((function(){var e=t.slice();t.length=0,e.forEach((function(e){e()}))})).observe(o,{attributes:!0});var a=i.setImmediate;i.setImmediate=function(e){Date.now()-r>15?(r=Date.now(),a(e)):(t.push(e),1===t.length&&o.setAttribute("a",s=!s))}}i.nextTick=i.setImmediate})(),i.isNodejs="undefined"!==typeof process&&process.versions&&process.versions.node,i.globalScope=function(){return i.isNodejs?n.g:"undefined"===typeof self?window:self}(),i.isArray=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},i.isArrayBuffer=function(e){return"undefined"!==typeof ArrayBuffer&&e instanceof ArrayBuffer},i.isArrayBufferView=function(e){return e&&i.isArrayBuffer(e.buffer)&&void 0!==e.byteLength},i.ByteBuffer=a,i.ByteStringBuffer=a;var c=4096;function l(e,t){t=t||{},this.read=t.readOffset||0,this.growSize=t.growSize||1024;var n=i.isArrayBuffer(e),r=i.isArrayBufferView(e);if(n||r)return this.data=n?new DataView(e):new DataView(e.buffer,e.byteOffset,e.byteLength),void(this.write="writeOffset"in t?t.writeOffset:this.data.byteLength);this.data=new DataView(new ArrayBuffer(0)),this.write=0,null!==e&&void 0!==e&&this.putBytes(e),"writeOffset"in t&&(this.write=t.writeOffset)}i.ByteStringBuffer.prototype._optimizeConstructedString=function(e){this._constructedStringLength+=e,this._constructedStringLength>c&&(this.data.substr(0,1),this._constructedStringLength=0)},i.ByteStringBuffer.prototype.length=function(){return this.data.length-this.read},i.ByteStringBuffer.prototype.isEmpty=function(){return this.length()<=0},i.ByteStringBuffer.prototype.putByte=function(e){return this.putBytes(String.fromCharCode(e))},i.ByteStringBuffer.prototype.fillWithByte=function(e,t){e=String.fromCharCode(e);var n=this.data;while(t>0)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return this.data=n,this._optimizeConstructedString(t),this},i.ByteStringBuffer.prototype.putBytes=function(e){return this.data+=e,this._optimizeConstructedString(e.length),this},i.ByteStringBuffer.prototype.putString=function(e){return this.putBytes(i.encodeUtf8(e))},i.ByteStringBuffer.prototype.putInt16=function(e){return this.putBytes(String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},i.ByteStringBuffer.prototype.putInt24=function(e){return this.putBytes(String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},i.ByteStringBuffer.prototype.putInt32=function(e){return this.putBytes(String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e))},i.ByteStringBuffer.prototype.putInt16Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255))},i.ByteStringBuffer.prototype.putInt24Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255))},i.ByteStringBuffer.prototype.putInt32Le=function(e){return this.putBytes(String.fromCharCode(255&e)+String.fromCharCode(e>>8&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>24&255))},i.ByteStringBuffer.prototype.putInt=function(e,t){o(t);var n="";do{t-=8,n+=String.fromCharCode(e>>t&255)}while(t>0);return this.putBytes(n)},i.ByteStringBuffer.prototype.putSignedInt=function(e,t){return e<0&&(e+=2<<t-1),this.putInt(e,t)},i.ByteStringBuffer.prototype.putBuffer=function(e){return this.putBytes(e.getBytes())},i.ByteStringBuffer.prototype.getByte=function(){return this.data.charCodeAt(this.read++)},i.ByteStringBuffer.prototype.getInt16=function(){var e=this.data.charCodeAt(this.read)<<8^this.data.charCodeAt(this.read+1);return this.read+=2,e},i.ByteStringBuffer.prototype.getInt24=function(){var e=this.data.charCodeAt(this.read)<<16^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2);return this.read+=3,e},i.ByteStringBuffer.prototype.getInt32=function(){var e=this.data.charCodeAt(this.read)<<24^this.data.charCodeAt(this.read+1)<<16^this.data.charCodeAt(this.read+2)<<8^this.data.charCodeAt(this.read+3);return this.read+=4,e},i.ByteStringBuffer.prototype.getInt16Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8;return this.read+=2,e},i.ByteStringBuffer.prototype.getInt24Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16;return this.read+=3,e},i.ByteStringBuffer.prototype.getInt32Le=function(){var e=this.data.charCodeAt(this.read)^this.data.charCodeAt(this.read+1)<<8^this.data.charCodeAt(this.read+2)<<16^this.data.charCodeAt(this.read+3)<<24;return this.read+=4,e},i.ByteStringBuffer.prototype.getInt=function(e){o(e);var t=0;do{t=(t<<8)+this.data.charCodeAt(this.read++),e-=8}while(e>0);return t},i.ByteStringBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},i.ByteStringBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},i.ByteStringBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},i.ByteStringBuffer.prototype.at=function(e){return this.data.charCodeAt(this.read+e)},i.ByteStringBuffer.prototype.setAt=function(e,t){return this.data=this.data.substr(0,this.read+e)+String.fromCharCode(t)+this.data.substr(this.read+e+1),this},i.ByteStringBuffer.prototype.last=function(){return this.data.charCodeAt(this.data.length-1)},i.ByteStringBuffer.prototype.copy=function(){var e=i.createBuffer(this.data);return e.read=this.read,e},i.ByteStringBuffer.prototype.compact=function(){return this.read>0&&(this.data=this.data.slice(this.read),this.read=0),this},i.ByteStringBuffer.prototype.clear=function(){return this.data="",this.read=0,this},i.ByteStringBuffer.prototype.truncate=function(e){var t=Math.max(0,this.length()-e);return this.data=this.data.substr(this.read,t),this.read=0,this},i.ByteStringBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.length;++t){var n=this.data.charCodeAt(t);n<16&&(e+="0"),e+=n.toString(16)}return e},i.ByteStringBuffer.prototype.toString=function(){return i.decodeUtf8(this.bytes())},i.DataBuffer=l,i.DataBuffer.prototype.length=function(){return this.write-this.read},i.DataBuffer.prototype.isEmpty=function(){return this.length()<=0},i.DataBuffer.prototype.accommodate=function(e,t){if(this.length()>=e)return this;t=Math.max(t||this.growSize,e);var n=new Uint8Array(this.data.buffer,this.data.byteOffset,this.data.byteLength),r=new Uint8Array(this.length()+t);return r.set(n),this.data=new DataView(r.buffer),this},i.DataBuffer.prototype.putByte=function(e){return this.accommodate(1),this.data.setUint8(this.write++,e),this},i.DataBuffer.prototype.fillWithByte=function(e,t){this.accommodate(t);for(var n=0;n<t;++n)this.data.setUint8(e);return this},i.DataBuffer.prototype.putBytes=function(e,t){if(i.isArrayBufferView(e)){var n=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),r=n.byteLength-n.byteOffset;this.accommodate(r);var s=new Uint8Array(this.data.buffer,this.write);return s.set(n),this.write+=r,this}if(i.isArrayBuffer(e)){n=new Uint8Array(e);this.accommodate(n.byteLength);s=new Uint8Array(this.data.buffer);return s.set(n,this.write),this.write+=n.byteLength,this}if(e instanceof i.DataBuffer||"object"===typeof e&&"number"===typeof e.read&&"number"===typeof e.write&&i.isArrayBufferView(e.data)){n=new Uint8Array(e.data.byteLength,e.read,e.length());this.accommodate(n.byteLength);s=new Uint8Array(e.data.byteLength,this.write);return s.set(n),this.write+=n.byteLength,this}if(e instanceof i.ByteStringBuffer&&(e=e.data,t="binary"),t=t||"binary","string"===typeof e){var o;if("hex"===t)return this.accommodate(Math.ceil(e.length/2)),o=new Uint8Array(this.data.buffer,this.write),this.write+=i.binary.hex.decode(e,o,this.write),this;if("base64"===t)return this.accommodate(3*Math.ceil(e.length/4)),o=new Uint8Array(this.data.buffer,this.write),this.write+=i.binary.base64.decode(e,o,this.write),this;if("utf8"===t&&(e=i.encodeUtf8(e),t="binary"),"binary"===t||"raw"===t)return this.accommodate(e.length),o=new Uint8Array(this.data.buffer,this.write),this.write+=i.binary.raw.decode(o),this;if("utf16"===t)return this.accommodate(2*e.length),o=new Uint16Array(this.data.buffer,this.write),this.write+=i.text.utf16.encode(o),this;throw new Error("Invalid encoding: "+t)}throw Error("Invalid parameter: "+e)},i.DataBuffer.prototype.putBuffer=function(e){return this.putBytes(e),e.clear(),this},i.DataBuffer.prototype.putString=function(e){return this.putBytes(e,"utf16")},i.DataBuffer.prototype.putInt16=function(e){return this.accommodate(2),this.data.setInt16(this.write,e),this.write+=2,this},i.DataBuffer.prototype.putInt24=function(e){return this.accommodate(3),this.data.setInt16(this.write,e>>8&65535),this.data.setInt8(this.write,e>>16&255),this.write+=3,this},i.DataBuffer.prototype.putInt32=function(e){return this.accommodate(4),this.data.setInt32(this.write,e),this.write+=4,this},i.DataBuffer.prototype.putInt16Le=function(e){return this.accommodate(2),this.data.setInt16(this.write,e,!0),this.write+=2,this},i.DataBuffer.prototype.putInt24Le=function(e){return this.accommodate(3),this.data.setInt8(this.write,e>>16&255),this.data.setInt16(this.write,e>>8&65535,!0),this.write+=3,this},i.DataBuffer.prototype.putInt32Le=function(e){return this.accommodate(4),this.data.setInt32(this.write,e,!0),this.write+=4,this},i.DataBuffer.prototype.putInt=function(e,t){o(t),this.accommodate(t/8);do{t-=8,this.data.setInt8(this.write++,e>>t&255)}while(t>0);return this},i.DataBuffer.prototype.putSignedInt=function(e,t){return o(t),this.accommodate(t/8),e<0&&(e+=2<<t-1),this.putInt(e,t)},i.DataBuffer.prototype.getByte=function(){return this.data.getInt8(this.read++)},i.DataBuffer.prototype.getInt16=function(){var e=this.data.getInt16(this.read);return this.read+=2,e},i.DataBuffer.prototype.getInt24=function(){var e=this.data.getInt16(this.read)<<8^this.data.getInt8(this.read+2);return this.read+=3,e},i.DataBuffer.prototype.getInt32=function(){var e=this.data.getInt32(this.read);return this.read+=4,e},i.DataBuffer.prototype.getInt16Le=function(){var e=this.data.getInt16(this.read,!0);return this.read+=2,e},i.DataBuffer.prototype.getInt24Le=function(){var e=this.data.getInt8(this.read)^this.data.getInt16(this.read+1,!0)<<8;return this.read+=3,e},i.DataBuffer.prototype.getInt32Le=function(){var e=this.data.getInt32(this.read,!0);return this.read+=4,e},i.DataBuffer.prototype.getInt=function(e){o(e);var t=0;do{t=(t<<8)+this.data.getInt8(this.read++),e-=8}while(e>0);return t},i.DataBuffer.prototype.getSignedInt=function(e){var t=this.getInt(e),n=2<<e-2;return t>=n&&(t-=n<<1),t},i.DataBuffer.prototype.getBytes=function(e){var t;return e?(e=Math.min(this.length(),e),t=this.data.slice(this.read,this.read+e),this.read+=e):0===e?t="":(t=0===this.read?this.data:this.data.slice(this.read),this.clear()),t},i.DataBuffer.prototype.bytes=function(e){return"undefined"===typeof e?this.data.slice(this.read):this.data.slice(this.read,this.read+e)},i.DataBuffer.prototype.at=function(e){return this.data.getUint8(this.read+e)},i.DataBuffer.prototype.setAt=function(e,t){return this.data.setUint8(e,t),this},i.DataBuffer.prototype.last=function(){return this.data.getUint8(this.write-1)},i.DataBuffer.prototype.copy=function(){return new i.DataBuffer(this)},i.DataBuffer.prototype.compact=function(){if(this.read>0){var e=new Uint8Array(this.data.buffer,this.read),t=new Uint8Array(e.byteLength);t.set(e),this.data=new DataView(t),this.write-=this.read,this.read=0}return this},i.DataBuffer.prototype.clear=function(){return this.data=new DataView(new ArrayBuffer(0)),this.read=this.write=0,this},i.DataBuffer.prototype.truncate=function(e){return this.write=Math.max(0,this.length()-e),this.read=Math.min(this.read,this.write),this},i.DataBuffer.prototype.toHex=function(){for(var e="",t=this.read;t<this.data.byteLength;++t){var n=this.data.getUint8(t);n<16&&(e+="0"),e+=n.toString(16)}return e},i.DataBuffer.prototype.toString=function(e){var t=new Uint8Array(this.data,this.read,this.length());if(e=e||"utf8","binary"===e||"raw"===e)return i.binary.raw.encode(t);if("hex"===e)return i.binary.hex.encode(t);if("base64"===e)return i.binary.base64.encode(t);if("utf8"===e)return i.text.utf8.decode(t);if("utf16"===e)return i.text.utf16.decode(t);throw new Error("Invalid encoding: "+e)},i.createBuffer=function(e,t){return t=t||"raw",void 0!==e&&"utf8"===t&&(e=i.encodeUtf8(e)),new i.ByteBuffer(e)},i.fillString=function(e,t){var n="";while(t>0)1&t&&(n+=e),t>>>=1,t>0&&(e+=e);return n},i.xorBytes=function(e,t,n){for(var r="",s="",i="",o=0,a=0;n>0;--n,++o)s=e.charCodeAt(o)^t.charCodeAt(o),a>=10&&(r+=i,i="",a=0),i+=String.fromCharCode(s),++a;return r+=i,r},i.hexToBytes=function(e){var t="",n=0;for(!0&e.length&&(n=1,t+=String.fromCharCode(parseInt(e[0],16)));n<e.length;n+=2)t+=String.fromCharCode(parseInt(e.substr(n,2),16));return t},i.bytesToHex=function(e){return i.createBuffer(e).toHex()},i.int32ToBytes=function(e){return String.fromCharCode(e>>24&255)+String.fromCharCode(e>>16&255)+String.fromCharCode(e>>8&255)+String.fromCharCode(255&e)};var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",h=[62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,64,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],d="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";i.encode64=function(e,t){var n,r,s,i="",o="",a=0;while(a<e.length)n=e.charCodeAt(a++),r=e.charCodeAt(a++),s=e.charCodeAt(a++),i+=u.charAt(n>>2),i+=u.charAt((3&n)<<4|r>>4),isNaN(r)?i+="==":(i+=u.charAt((15&r)<<2|s>>6),i+=isNaN(s)?"=":u.charAt(63&s)),t&&i.length>t&&(o+=i.substr(0,t)+"\r\n",i=i.substr(t));return o+=i,o},i.decode64=function(e){e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");var t,n,r,s,i="",o=0;while(o<e.length)t=h[e.charCodeAt(o++)-43],n=h[e.charCodeAt(o++)-43],r=h[e.charCodeAt(o++)-43],s=h[e.charCodeAt(o++)-43],i+=String.fromCharCode(t<<2|n>>4),64!==r&&(i+=String.fromCharCode((15&n)<<4|r>>2),64!==s&&(i+=String.fromCharCode((3&r)<<6|s)));return i},i.encodeUtf8=function(e){return unescape(encodeURIComponent(e))},i.decodeUtf8=function(e){return decodeURIComponent(escape(e))},i.binary={raw:{},hex:{},base64:{},base58:{},baseN:{encode:s.encode,decode:s.decode}},i.binary.raw.encode=function(e){return String.fromCharCode.apply(null,e)},i.binary.raw.decode=function(e,t,n){var r=t;r||(r=new Uint8Array(e.length)),n=n||0;for(var s=n,i=0;i<e.length;++i)r[s++]=e.charCodeAt(i);return t?s-n:r},i.binary.hex.encode=i.bytesToHex,i.binary.hex.decode=function(e,t,n){var r=t;r||(r=new Uint8Array(Math.ceil(e.length/2))),n=n||0;var s=0,i=n;for(1&e.length&&(s=1,r[i++]=parseInt(e[0],16));s<e.length;s+=2)r[i++]=parseInt(e.substr(s,2),16);return t?i-n:r},i.binary.base64.encode=function(e,t){var n,r,s,i="",o="",a=0;while(a<e.byteLength)n=e[a++],r=e[a++],s=e[a++],i+=u.charAt(n>>2),i+=u.charAt((3&n)<<4|r>>4),isNaN(r)?i+="==":(i+=u.charAt((15&r)<<2|s>>6),i+=isNaN(s)?"=":u.charAt(63&s)),t&&i.length>t&&(o+=i.substr(0,t)+"\r\n",i=i.substr(t));return o+=i,o},i.binary.base64.decode=function(e,t,n){var r,s,i,o,a=t;a||(a=new Uint8Array(3*Math.ceil(e.length/4))),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,""),n=n||0;var c=0,l=n;while(c<e.length)r=h[e.charCodeAt(c++)-43],s=h[e.charCodeAt(c++)-43],i=h[e.charCodeAt(c++)-43],o=h[e.charCodeAt(c++)-43],a[l++]=r<<2|s>>4,64!==i&&(a[l++]=(15&s)<<4|i>>2,64!==o&&(a[l++]=(3&i)<<6|o));return t?l-n:a.subarray(0,l)},i.binary.base58.encode=function(e,t){return i.binary.baseN.encode(e,d,t)},i.binary.base58.decode=function(e,t){return i.binary.baseN.decode(e,d,t)},i.text={utf8:{},utf16:{}},i.text.utf8.encode=function(e,t,n){e=i.encodeUtf8(e);var r=t;r||(r=new Uint8Array(e.length)),n=n||0;for(var s=n,o=0;o<e.length;++o)r[s++]=e.charCodeAt(o);return t?s-n:r},i.text.utf8.decode=function(e){return i.decodeUtf8(String.fromCharCode.apply(null,e))},i.text.utf16.encode=function(e,t,n){var r=t;r||(r=new Uint8Array(2*e.length));var s=new Uint16Array(r.buffer);n=n||0;for(var i=n,o=n,a=0;a<e.length;++a)s[o++]=e.charCodeAt(a),i+=2;return t?i-n:r},i.text.utf16.decode=function(e){return String.fromCharCode.apply(null,new Uint16Array(e.buffer))},i.deflate=function(e,t,n){if(t=i.decode64(e.deflate(i.encode64(t)).rval),n){var r=2,s=t.charCodeAt(1);32&s&&(r=6),t=t.substring(r,t.length-4)}return t},i.inflate=function(e,t,n){var r=e.inflate(i.encode64(t)).rval;return null===r?null:i.decode64(r)};var p=function(e,t,n){if(!e)throw new Error("WebStorage not available.");var r;if(null===n?r=e.removeItem(t):(n=i.encode64(JSON.stringify(n)),r=e.setItem(t,n)),"undefined"!==typeof r&&!0!==r.rval){var s=new Error(r.error.message);throw s.id=r.error.id,s.name=r.error.name,s}},f=function(e,t){if(!e)throw new Error("WebStorage not available.");var n=e.getItem(t);if(e.init)if(null===n.rval){if(n.error){var r=new Error(n.error.message);throw r.id=n.error.id,r.name=n.error.name,r}n=null}else n=n.rval;return null!==n&&(n=JSON.parse(i.decode64(n))),n},g=function(e,t,n,r){var s=f(e,t);null===s&&(s={}),s[n]=r,p(e,t,s)},m=function(e,t,n){var r=f(e,t);return null!==r&&(r=n in r?r[n]:null),r},y=function(e,t,n){var r=f(e,t);if(null!==r&&n in r){delete r[n];var s=!0;for(var i in r){s=!1;break}s&&(r=null),p(e,t,r)}},w=function(e,t){p(e,t,null)},b=function(e,t,n){var r,s=null;"undefined"===typeof n&&(n=["web","flash"]);var i=!1,o=null;for(var a in n){r=n[a];try{if("flash"===r||"both"===r){if(null===t[0])throw new Error("Flash local storage not available.");s=e.apply(this,t),i="flash"===r}"web"!==r&&"both"!==r||(t[0]=localStorage,s=e.apply(this,t),i=!0)}catch(c){o=c}if(i)break}if(!i)throw o;return s};i.setItem=function(e,t,n,r,s){b(g,arguments,s)},i.getItem=function(e,t,n,r){return b(m,arguments,r)},i.removeItem=function(e,t,n,r){b(y,arguments,r)},i.clearItems=function(e,t,n){b(w,arguments,n)},i.isEmpty=function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},i.format=function(e){var t,n,r=/%./g,s=0,i=[],o=0;while(t=r.exec(e)){n=e.substring(o,r.lastIndex-2),n.length>0&&i.push(n),o=r.lastIndex;var a=t[0][1];switch(a){case"s":case"o":s<arguments.length?i.push(arguments[1+s++]):i.push("<?>");break;case"%":i.push("%");break;default:i.push("<%"+a+"?>")}}return i.push(e.substring(o)),i.join("")},i.formatNumber=function(e,t,n,r){var s=e,i=isNaN(t=Math.abs(t))?2:t,o=void 0===n?",":n,a=void 0===r?".":r,c=s<0?"-":"",l=parseInt(s=Math.abs(+s||0).toFixed(i),10)+"",u=l.length>3?l.length%3:0;return c+(u?l.substr(0,u)+a:"")+l.substr(u).replace(/(\d{3})(?=\d)/g,"$1"+a)+(i?o+Math.abs(s-l).toFixed(i).slice(2):"")},i.formatSize=function(e){return e=e>=1073741824?i.formatNumber(e/1073741824,2,".","")+" GiB":e>=1048576?i.formatNumber(e/1048576,2,".","")+" MiB":e>=1024?i.formatNumber(e/1024,0)+" KiB":i.formatNumber(e,0)+" bytes",e},i.bytesFromIP=function(e){return-1!==e.indexOf(".")?i.bytesFromIPv4(e):-1!==e.indexOf(":")?i.bytesFromIPv6(e):null},i.bytesFromIPv4=function(e){if(e=e.split("."),4!==e.length)return null;for(var t=i.createBuffer(),n=0;n<e.length;++n){var r=parseInt(e[n],10);if(isNaN(r))return null;t.putByte(r)}return t.getBytes()},i.bytesFromIPv6=function(e){var t=0;e=e.split(":").filter((function(e){return 0===e.length&&++t,!0}));for(var n=2*(8-e.length+t),r=i.createBuffer(),s=0;s<8;++s)if(e[s]&&0!==e[s].length){var o=i.hexToBytes(e[s]);o.length<2&&r.putByte(0),r.putBytes(o)}else r.fillWithByte(0,n),n=0;return r.getBytes()},i.bytesToIP=function(e){return 4===e.length?i.bytesToIPv4(e):16===e.length?i.bytesToIPv6(e):null},i.bytesToIPv4=function(e){if(4!==e.length)return null;for(var t=[],n=0;n<e.length;++n)t.push(e.charCodeAt(n));return t.join(".")},i.bytesToIPv6=function(e){if(16!==e.length)return null;for(var t=[],n=[],r=0,s=0;s<e.length;s+=2){var o=i.bytesToHex(e[s]+e[s+1]);while("0"===o[0]&&"0"!==o)o=o.substr(1);if("0"===o){var a=n[n.length-1],c=t.length;a&&c===a.end+1?(a.end=c,a.end-a.start>n[r].end-n[r].start&&(r=n.length-1)):n.push({start:c,end:c})}t.push(o)}if(n.length>0){var l=n[r];l.end-l.start>0&&(t.splice(l.start,l.end-l.start+1,""),0===l.start&&t.unshift(""),7===l.end&&t.push(""))}return t.join(":")},i.estimateCores=function(e,t){if("function"===typeof e&&(t=e,e={}),e=e||{},"cores"in i&&!e.update)return t(null,i.cores);if("undefined"!==typeof navigator&&"hardwareConcurrency"in navigator&&navigator.hardwareConcurrency>0)return i.cores=navigator.hardwareConcurrency,t(null,i.cores);if("undefined"===typeof Worker)return i.cores=1,t(null,i.cores);if("undefined"===typeof Blob)return i.cores=2,t(null,i.cores);var n=URL.createObjectURL(new Blob(["(",function(){self.addEventListener("message",(function(e){var t=Date.now(),n=t+4;while(Date.now()<n);self.postMessage({st:t,et:n})}))}.toString(),")()"],{type:"application/javascript"}));function r(e,a,c){if(0===a){var l=Math.floor(e.reduce((function(e,t){return e+t}),0)/e.length);return i.cores=Math.max(1,l),URL.revokeObjectURL(n),t(null,i.cores)}s(c,(function(t,n){e.push(o(c,n)),r(e,a-1,c)}))}function s(e,t){for(var r=[],s=[],i=0;i<e;++i){var o=new Worker(n);o.addEventListener("message",(function(n){if(s.push(n.data),s.length===e){for(var i=0;i<e;++i)r[i].terminate();t(null,s)}})),r.push(o)}for(i=0;i<e;++i)r[i].postMessage(i)}function o(e,t){for(var n=[],r=0;r<e;++r)for(var s=t[r],i=n[r]=[],o=0;o<e;++o)if(r!==o){var a=t[o];(s.st>a.st&&s.st<a.et||a.st>s.st&&a.st<s.et)&&i.push(o)}return n.reduce((function(e,t){return Math.max(e,t.length)}),0)}r([],5,16)}},4760:function(e,t,n){n(7658);var r=n(6143);n(6509),n(3655),n(1202),n(2713),n(3232),n(5828),n(8277),n(121),n(536),n(8666);var s=r.asn1,i=e.exports=r.pki=r.pki||{},o=i.oids,a={};a["CN"]=o["commonName"],a["commonName"]="CN",a["C"]=o["countryName"],a["countryName"]="C",a["L"]=o["localityName"],a["localityName"]="L",a["ST"]=o["stateOrProvinceName"],a["stateOrProvinceName"]="ST",a["O"]=o["organizationName"],a["organizationName"]="O",a["OU"]=o["organizationalUnitName"],a["organizationalUnitName"]="OU",a["E"]=o["emailAddress"],a["emailAddress"]="E";var c=r.pki.rsa.publicKeyValidator,l={name:"Certificate",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"tbsCertificate",value:[{name:"Certificate.TBSCertificate.version",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.version.integer",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"certVersion"}]},{name:"Certificate.TBSCertificate.serialNumber",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"certSerialNumber"},{name:"Certificate.TBSCertificate.signature",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.signature.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"certinfoSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:s.Class.UNIVERSAL,optional:!0,captureAsn1:"certinfoSignatureParams"}]},{name:"Certificate.TBSCertificate.issuer",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certIssuer"},{name:"Certificate.TBSCertificate.validity",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.TBSCertificate.validity.notBefore (utc)",tagClass:s.Class.UNIVERSAL,type:s.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity1UTCTime"},{name:"Certificate.TBSCertificate.validity.notBefore (generalized)",tagClass:s.Class.UNIVERSAL,type:s.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity2GeneralizedTime"},{name:"Certificate.TBSCertificate.validity.notAfter (utc)",tagClass:s.Class.UNIVERSAL,type:s.Type.UTCTIME,constructed:!1,optional:!0,capture:"certValidity3UTCTime"},{name:"Certificate.TBSCertificate.validity.notAfter (generalized)",tagClass:s.Class.UNIVERSAL,type:s.Type.GENERALIZEDTIME,constructed:!1,optional:!0,capture:"certValidity4GeneralizedTime"}]},{name:"Certificate.TBSCertificate.subject",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certSubject"},c,{name:"Certificate.TBSCertificate.issuerUniqueID",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.issuerUniqueID.id",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"certIssuerUniqueId"}]},{name:"Certificate.TBSCertificate.subjectUniqueID",tagClass:s.Class.CONTEXT_SPECIFIC,type:2,constructed:!0,optional:!0,value:[{name:"Certificate.TBSCertificate.subjectUniqueID.id",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSubjectUniqueId"}]},{name:"Certificate.TBSCertificate.extensions",tagClass:s.Class.CONTEXT_SPECIFIC,type:3,constructed:!0,captureAsn1:"certExtensions",optional:!0}]},{name:"Certificate.signatureAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"Certificate.signatureAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"certSignatureOid"},{name:"Certificate.TBSCertificate.signature.parameters",tagClass:s.Class.UNIVERSAL,optional:!0,captureAsn1:"certSignatureParams"}]},{name:"Certificate.signatureValue",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"certSignature"}]},u={name:"rsapss",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.hashAlgorithm",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.hashAlgorithm.AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"hashOid"}]}]},{name:"rsapss.maskGenAlgorithm",tagClass:s.Class.CONTEXT_SPECIFIC,type:1,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier",tagClass:s.Class.UNIVERSAL,type:s.Class.SEQUENCE,constructed:!0,optional:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"maskGenOid"},{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"rsapss.maskGenAlgorithm.AlgorithmIdentifier.params.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"maskGenHashOid"}]}]}]},{name:"rsapss.saltLength",tagClass:s.Class.CONTEXT_SPECIFIC,type:2,optional:!0,value:[{name:"rsapss.saltLength.saltLength",tagClass:s.Class.UNIVERSAL,type:s.Class.INTEGER,constructed:!1,capture:"saltLength"}]},{name:"rsapss.trailerField",tagClass:s.Class.CONTEXT_SPECIFIC,type:3,optional:!0,value:[{name:"rsapss.trailer.trailer",tagClass:s.Class.UNIVERSAL,type:s.Class.INTEGER,constructed:!1,capture:"trailer"}]}]},h={name:"CertificationRequestInfo",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfo",value:[{name:"CertificationRequestInfo.integer",tagClass:s.Class.UNIVERSAL,type:s.Type.INTEGER,constructed:!1,capture:"certificationRequestInfoVersion"},{name:"CertificationRequestInfo.subject",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"certificationRequestInfoSubject"},c,{name:"CertificationRequestInfo.attributes",tagClass:s.Class.CONTEXT_SPECIFIC,type:0,constructed:!0,optional:!0,capture:"certificationRequestInfoAttributes",value:[{name:"CertificationRequestInfo.attributes",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequestInfo.attributes.type",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1},{name:"CertificationRequestInfo.attributes.value",tagClass:s.Class.UNIVERSAL,type:s.Type.SET,constructed:!0}]}]}]},d={name:"CertificationRequest",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,captureAsn1:"csr",value:[h,{name:"CertificationRequest.signatureAlgorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.SEQUENCE,constructed:!0,value:[{name:"CertificationRequest.signatureAlgorithm.algorithm",tagClass:s.Class.UNIVERSAL,type:s.Type.OID,constructed:!1,capture:"csrSignatureOid"},{name:"CertificationRequest.signatureAlgorithm.parameters",tagClass:s.Class.UNIVERSAL,optional:!0,captureAsn1:"csrSignatureParams"}]},{name:"CertificationRequest.signature",tagClass:s.Class.UNIVERSAL,type:s.Type.BITSTRING,constructed:!1,captureBitStringValue:"csrSignature"}]};function p(e,t){"string"===typeof t&&(t={shortName:t});for(var n,r=null,s=0;null===r&&s<e.attributes.length;++s)n=e.attributes[s],(t.type&&t.type===n.type||t.name&&t.name===n.name||t.shortName&&t.shortName===n.shortName)&&(r=n);return r}i.RDNAttributesAsArray=function(e,t){for(var n,r,i,c=[],l=0;l<e.value.length;++l){n=e.value[l];for(var u=0;u<n.value.length;++u)i={},r=n.value[u],i.type=s.derToOid(r.value[0].value),i.value=r.value[1].value,i.valueTagClass=r.value[1].type,i.type in o&&(i.name=o[i.type],i.name in a&&(i.shortName=a[i.name])),t&&(t.update(i.type),t.update(i.value)),c.push(i)}return c},i.CRIAttributesAsArray=function(e){for(var t=[],n=0;n<e.length;++n)for(var r=e[n],c=s.derToOid(r.value[0].value),l=r.value[1].value,u=0;u<l.length;++u){var h={};if(h.type=c,h.value=l[u].value,h.valueTagClass=l[u].type,h.type in o&&(h.name=o[h.type],h.name in a&&(h.shortName=a[h.name])),h.type===o.extensionRequest){h.extensions=[];for(var d=0;d<h.value.length;++d)h.extensions.push(i.certificateExtensionFromAsn1(h.value[d]))}t.push(h)}return t};var f=function(e,t,n){var r={};if(e!==o["RSASSA-PSS"])return r;n&&(r={hash:{algorithmOid:o["sha1"]},mgf:{algorithmOid:o["mgf1"],hash:{algorithmOid:o["sha1"]}},saltLength:20});var i={},a=[];if(!s.validate(t,u,i,a)){var c=new Error("Cannot read RSASSA-PSS parameter block.");throw c.errors=a,c}return void 0!==i.hashOid&&(r.hash=r.hash||{},r.hash.algorithmOid=s.derToOid(i.hashOid)),void 0!==i.maskGenOid&&(r.mgf=r.mgf||{},r.mgf.algorithmOid=s.derToOid(i.maskGenOid),r.mgf.hash=r.mgf.hash||{},r.mgf.hash.algorithmOid=s.derToOid(i.maskGenHashOid)),void 0!==i.saltLength&&(r.saltLength=i.saltLength.charCodeAt(0)),r},g=function(e){switch(o[e.signatureOid]){case"sha1WithRSAEncryption":case"sha1WithRSASignature":return r.md.sha1.create();case"md5WithRSAEncryption":return r.md.md5.create();case"sha256WithRSAEncryption":return r.md.sha256.create();case"sha384WithRSAEncryption":return r.md.sha384.create();case"sha512WithRSAEncryption":return r.md.sha512.create();case"RSASSA-PSS":return r.md.sha256.create();default:var t=new Error("Could not compute "+e.type+" digest. Unknown signature OID.");throw t.signatureOid=e.signatureOid,t}},m=function(e){var t,n=e.certificate;switch(n.signatureOid){case o.sha1WithRSAEncryption:case o.sha1WithRSASignature:break;case o["RSASSA-PSS"]:var s,i;if(s=o[n.signatureParameters.mgf.hash.algorithmOid],void 0===s||void 0===r.md[s]){var a=new Error("Unsupported MGF hash function.");throw a.oid=n.signatureParameters.mgf.hash.algorithmOid,a.name=s,a}if(i=o[n.signatureParameters.mgf.algorithmOid],void 0===i||void 0===r.mgf[i]){a=new Error("Unsupported MGF function.");throw a.oid=n.signatureParameters.mgf.algorithmOid,a.name=i,a}if(i=r.mgf[i].create(r.md[s].create()),s=o[n.signatureParameters.hash.algorithmOid],void 0===s||void 0===r.md[s]){a=new Error("Unsupported RSASSA-PSS hash function.");throw a.oid=n.signatureParameters.hash.algorithmOid,a.name=s,a}t=r.pss.create(r.md[s].create(),i,n.signatureParameters.saltLength);break}return n.publicKey.verify(e.md.digest().getBytes(),e.signature,t)};function y(e){for(var t,n,i=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),o=e.attributes,a=0;a<o.length;++a){t=o[a];var c=t.value,l=s.Type.PRINTABLESTRING;"valueTagClass"in t&&(l=t.valueTagClass,l===s.Type.UTF8&&(c=r.util.encodeUtf8(c))),n=s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.type).getBytes()),s.create(s.Class.UNIVERSAL,l,!1,c)])]),i.value.push(n)}return i}function w(e){for(var t,n=0;n<e.length;++n){if(t=e[n],"undefined"===typeof t.name&&(t.type&&t.type in i.oids?t.name=i.oids[t.type]:t.shortName&&t.shortName in a&&(t.name=i.oids[a[t.shortName]])),"undefined"===typeof t.type){if(!t.name||!(t.name in i.oids)){var r=new Error("Attribute type not specified.");throw r.attribute=t,r}t.type=i.oids[t.name]}if("undefined"===typeof t.shortName&&t.name&&t.name in a&&(t.shortName=a[t.name]),t.type===o.extensionRequest&&(t.valueConstructed=!0,t.valueTagClass=s.Type.SEQUENCE,!t.value&&t.extensions)){t.value=[];for(var c=0;c<t.extensions.length;++c)t.value.push(i.certificateExtensionToAsn1(b(t.extensions[c])))}if("undefined"===typeof t.value){r=new Error("Attribute value not specified.");throw r.attribute=t,r}}}function b(e,t){if(t=t||{},"undefined"===typeof e.name&&e.id&&e.id in i.oids&&(e.name=i.oids[e.id]),"undefined"===typeof e.id){if(!e.name||!(e.name in i.oids)){var n=new Error("Extension ID not specified.");throw n.extension=e,n}e.id=i.oids[e.name]}if("undefined"!==typeof e.value)return e;if("keyUsage"===e.name){var a=0,c=0,l=0;e.digitalSignature&&(c|=128,a=7),e.nonRepudiation&&(c|=64,a=6),e.keyEncipherment&&(c|=32,a=5),e.dataEncipherment&&(c|=16,a=4),e.keyAgreement&&(c|=8,a=3),e.keyCertSign&&(c|=4,a=2),e.cRLSign&&(c|=2,a=1),e.encipherOnly&&(c|=1,a=0),e.decipherOnly&&(l|=128,a=7);var u=String.fromCharCode(a);0!==l?u+=String.fromCharCode(c)+String.fromCharCode(l):0!==c&&(u+=String.fromCharCode(c)),e.value=s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,u)}else if("basicConstraints"===e.name)e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),e.cA&&e.value.value.push(s.create(s.Class.UNIVERSAL,s.Type.BOOLEAN,!1,String.fromCharCode(255))),"pathLenConstraint"in e&&e.value.value.push(s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.pathLenConstraint).getBytes()));else if("extKeyUsage"===e.name){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);var h=e.value.value;for(var d in e)!0===e[d]&&(d in o?h.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o[d]).getBytes())):-1!==d.indexOf(".")&&h.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(d).getBytes())))}else if("nsCertType"===e.name){a=0,c=0;e.client&&(c|=128,a=7),e.server&&(c|=64,a=6),e.email&&(c|=32,a=5),e.objsign&&(c|=16,a=4),e.reserved&&(c|=8,a=3),e.sslCA&&(c|=4,a=2),e.emailCA&&(c|=2,a=1),e.objCA&&(c|=1,a=0);u=String.fromCharCode(a);0!==c&&(u+=String.fromCharCode(c)),e.value=s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,u)}else if("subjectAltName"===e.name||"issuerAltName"===e.name){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);for(var p=0;p<e.altNames.length;++p){b=e.altNames[p];u=b.value;if(7===b.type&&b.ip){if(u=r.util.bytesFromIP(b.ip),null===u){n=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw n.extension=e,n}}else 8===b.type&&(u=b.oid?s.oidToDer(s.oidToDer(b.oid)):s.oidToDer(u));e.value.value.push(s.create(s.Class.CONTEXT_SPECIFIC,b.type,!1,u))}}else if("nsComment"===e.name&&t.cert){if(!/^[\x00-\x7F]*$/.test(e.comment)||e.comment.length<1||e.comment.length>128)throw new Error('Invalid "nsComment" content.');e.value=s.create(s.Class.UNIVERSAL,s.Type.IA5STRING,!1,e.comment)}else if("subjectKeyIdentifier"===e.name&&t.cert){var f=t.cert.generateSubjectKeyIdentifier();e.subjectKeyIdentifier=f.toHex(),e.value=s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,f.getBytes())}else if("authorityKeyIdentifier"===e.name&&t.cert){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);h=e.value.value;if(e.keyIdentifier){var g=!0===e.keyIdentifier?t.cert.generateSubjectKeyIdentifier().getBytes():e.keyIdentifier;h.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!1,g))}if(e.authorityCertIssuer){var m=[s.create(s.Class.CONTEXT_SPECIFIC,4,!0,[y(!0===e.authorityCertIssuer?t.cert.issuer:e.authorityCertIssuer)])];h.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,m))}if(e.serialNumber){var w=r.util.hexToBytes(!0===e.serialNumber?t.cert.serialNumber:e.serialNumber);h.push(s.create(s.Class.CONTEXT_SPECIFIC,2,!1,w))}}else if("cRLDistributionPoints"===e.name){e.value=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);h=e.value.value;var b,v=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]),E=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[]);for(p=0;p<e.altNames.length;++p){b=e.altNames[p];u=b.value;if(7===b.type&&b.ip){if(u=r.util.bytesFromIP(b.ip),null===u){n=new Error('Extension "ip" value is not a valid IPv4 or IPv6 address.');throw n.extension=e,n}}else 8===b.type&&(u=b.oid?s.oidToDer(s.oidToDer(b.oid)):s.oidToDer(u));E.value.push(s.create(s.Class.CONTEXT_SPECIFIC,b.type,!1,u))}v.value.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[E])),h.push(v)}if("undefined"===typeof e.value){n=new Error("Extension value not specified.");throw n.extension=e,n}return e}function v(e,t){switch(e){case o["RSASSA-PSS"]:var n=[];return void 0!==t.hash.algorithmOid&&n.push(s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.hash.algorithmOid).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])])),void 0!==t.mgf.algorithmOid&&n.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,[s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.mgf.algorithmOid).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(t.mgf.hash.algorithmOid).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")])])])),void 0!==t.saltLength&&n.push(s.create(s.Class.CONTEXT_SPECIFIC,2,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(t.saltLength).getBytes())])),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,n);default:return s.create(s.Class.UNIVERSAL,s.Type.NULL,!1,"")}}function E(e){var t=s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[]);if(0===e.attributes.length)return t;for(var n=e.attributes,i=0;i<n.length;++i){var o=n[i],a=o.value,c=s.Type.UTF8;"valueTagClass"in o&&(c=o.valueTagClass),c===s.Type.UTF8&&(a=r.util.encodeUtf8(a));var l=!1;"valueConstructed"in o&&(l=o.valueConstructed);var u=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(o.type).getBytes()),s.create(s.Class.UNIVERSAL,s.Type.SET,!0,[s.create(s.Class.UNIVERSAL,c,l,a)])]);t.value.push(u)}return t}i.certificateFromPem=function(e,t,n){var o=r.pem.decode(e)[0];if("CERTIFICATE"!==o.type&&"X509 CERTIFICATE"!==o.type&&"TRUSTED CERTIFICATE"!==o.type){var a=new Error('Could not convert certificate from PEM; PEM header type is not "CERTIFICATE", "X509 CERTIFICATE", or "TRUSTED CERTIFICATE".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certificate from PEM; PEM is encrypted.");var c=s.fromDer(o.body,n);return i.certificateFromAsn1(c,t)},i.certificateToPem=function(e,t){var n={type:"CERTIFICATE",body:s.toDer(i.certificateToAsn1(e)).getBytes()};return r.pem.encode(n,{maxline:t})},i.publicKeyFromPem=function(e){var t=r.pem.decode(e)[0];if("PUBLIC KEY"!==t.type&&"RSA PUBLIC KEY"!==t.type){var n=new Error('Could not convert public key from PEM; PEM header type is not "PUBLIC KEY" or "RSA PUBLIC KEY".');throw n.headerType=t.type,n}if(t.procType&&"ENCRYPTED"===t.procType.type)throw new Error("Could not convert public key from PEM; PEM is encrypted.");var o=s.fromDer(t.body);return i.publicKeyFromAsn1(o)},i.publicKeyToPem=function(e,t){var n={type:"PUBLIC KEY",body:s.toDer(i.publicKeyToAsn1(e)).getBytes()};return r.pem.encode(n,{maxline:t})},i.publicKeyToRSAPublicKeyPem=function(e,t){var n={type:"RSA PUBLIC KEY",body:s.toDer(i.publicKeyToRSAPublicKey(e)).getBytes()};return r.pem.encode(n,{maxline:t})},i.getPublicKeyFingerprint=function(e,t){t=t||{};var n,o=t.md||r.md.sha1.create(),a=t.type||"RSAPublicKey";switch(a){case"RSAPublicKey":n=s.toDer(i.publicKeyToRSAPublicKey(e)).getBytes();break;case"SubjectPublicKeyInfo":n=s.toDer(i.publicKeyToAsn1(e)).getBytes();break;default:throw new Error('Unknown fingerprint type "'+t.type+'".')}o.start(),o.update(n);var c=o.digest();if("hex"===t.encoding){var l=c.toHex();return t.delimiter?l.match(/.{2}/g).join(t.delimiter):l}if("binary"===t.encoding)return c.getBytes();if(t.encoding)throw new Error('Unknown encoding "'+t.encoding+'".');return c},i.certificationRequestFromPem=function(e,t,n){var o=r.pem.decode(e)[0];if("CERTIFICATE REQUEST"!==o.type){var a=new Error('Could not convert certification request from PEM; PEM header type is not "CERTIFICATE REQUEST".');throw a.headerType=o.type,a}if(o.procType&&"ENCRYPTED"===o.procType.type)throw new Error("Could not convert certification request from PEM; PEM is encrypted.");var c=s.fromDer(o.body,n);return i.certificationRequestFromAsn1(c,t)},i.certificationRequestToPem=function(e,t){var n={type:"CERTIFICATE REQUEST",body:s.toDer(i.certificationRequestToAsn1(e)).getBytes()};return r.pem.encode(n,{maxline:t})},i.createCertificate=function(){var e={version:2,serialNumber:"00",signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.validity={},e.validity.notBefore=new Date,e.validity.notAfter=new Date,e.issuer={},e.issuer.getField=function(t){return p(e.issuer,t)},e.issuer.addField=function(t){w([t]),e.issuer.attributes.push(t)},e.issuer.attributes=[],e.issuer.hash=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){w([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.extensions=[],e.publicKey=null,e.md=null,e.setSubject=function(t,n){w(t),e.subject.attributes=t,delete e.subject.uniqueId,n&&(e.subject.uniqueId=n),e.subject.hash=null},e.setIssuer=function(t,n){w(t),e.issuer.attributes=t,delete e.issuer.uniqueId,n&&(e.issuer.uniqueId=n),e.issuer.hash=null},e.setExtensions=function(t){for(var n=0;n<t.length;++n)b(t[n],{cert:e});e.extensions=t},e.getExtension=function(t){"string"===typeof t&&(t={name:t});for(var n,r=null,s=0;null===r&&s<e.extensions.length;++s)n=e.extensions[s],(t.id&&n.id===t.id||t.name&&n.name===t.name)&&(r=n);return r},e.sign=function(t,n){e.md=n||r.md.sha1.create();var a=o[e.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certificate digest. Unknown message digest algorithm OID.");throw c.algorithm=e.md.algorithm,c}e.signatureOid=e.siginfo.algorithmOid=a,e.tbsCertificate=i.getTBSCertificate(e);var l=s.toDer(e.tbsCertificate);e.md.update(l.getBytes()),e.signature=t.sign(e.md)},e.verify=function(t){var n=!1;if(!e.issued(t)){var r=t.issuer,o=e.subject,a=new Error("The parent certificate did not issue the given child certificate; the child certificate's issuer does not match the parent's subject.");throw a.expectedIssuer=o.attributes,a.actualIssuer=r.attributes,a}var c=t.md;if(null===c){c=g({signatureOid:t.signatureOid,type:"certificate"});var l=t.tbsCertificate||i.getTBSCertificate(t),u=s.toDer(l);c.update(u.getBytes())}return null!==c&&(n=m({certificate:e,md:c,signature:t.signature})),n},e.isIssuer=function(t){var n=!1,r=e.issuer,s=t.subject;if(r.hash&&s.hash)n=r.hash===s.hash;else if(r.attributes.length===s.attributes.length){var i,o;n=!0;for(var a=0;n&&a<r.attributes.length;++a)i=r.attributes[a],o=s.attributes[a],i.type===o.type&&i.value===o.value||(n=!1)}return n},e.issued=function(t){return t.isIssuer(e)},e.generateSubjectKeyIdentifier=function(){return i.getPublicKeyFingerprint(e.publicKey,{type:"RSAPublicKey"})},e.verifySubjectKeyIdentifier=function(){for(var t=o["subjectKeyIdentifier"],n=0;n<e.extensions.length;++n){var s=e.extensions[n];if(s.id===t){var i=e.generateSubjectKeyIdentifier().getBytes();return r.util.hexToBytes(s.subjectKeyIdentifier)===i}}return!1},e},i.certificateFromAsn1=function(e,t){var n={},o=[];if(!s.validate(e,l,n,o)){var a=new Error("Cannot read X.509 certificate. ASN.1 object is not an X509v3 Certificate.");throw a.errors=o,a}var c=s.derToOid(n.publicKeyOid);if(c!==i.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var u=i.createCertificate();u.version=n.certVersion?n.certVersion.charCodeAt(0):0;var h=r.util.createBuffer(n.certSerialNumber);u.serialNumber=h.toHex(),u.signatureOid=r.asn1.derToOid(n.certSignatureOid),u.signatureParameters=f(u.signatureOid,n.certSignatureParams,!0),u.siginfo.algorithmOid=r.asn1.derToOid(n.certinfoSignatureOid),u.siginfo.parameters=f(u.siginfo.algorithmOid,n.certinfoSignatureParams,!1),u.signature=n.certSignature;var d=[];if(void 0!==n.certValidity1UTCTime&&d.push(s.utcTimeToDate(n.certValidity1UTCTime)),void 0!==n.certValidity2GeneralizedTime&&d.push(s.generalizedTimeToDate(n.certValidity2GeneralizedTime)),void 0!==n.certValidity3UTCTime&&d.push(s.utcTimeToDate(n.certValidity3UTCTime)),void 0!==n.certValidity4GeneralizedTime&&d.push(s.generalizedTimeToDate(n.certValidity4GeneralizedTime)),d.length>2)throw new Error("Cannot read notBefore/notAfter validity times; more than two times were provided in the certificate.");if(d.length<2)throw new Error("Cannot read notBefore/notAfter validity times; they were not provided as either UTCTime or GeneralizedTime.");if(u.validity.notBefore=d[0],u.validity.notAfter=d[1],u.tbsCertificate=n.tbsCertificate,t){u.md=g({signatureOid:u.signatureOid,type:"certificate"});var m=s.toDer(u.tbsCertificate);u.md.update(m.getBytes())}var y=r.md.sha1.create(),b=s.toDer(n.certIssuer);y.update(b.getBytes()),u.issuer.getField=function(e){return p(u.issuer,e)},u.issuer.addField=function(e){w([e]),u.issuer.attributes.push(e)},u.issuer.attributes=i.RDNAttributesAsArray(n.certIssuer),n.certIssuerUniqueId&&(u.issuer.uniqueId=n.certIssuerUniqueId),u.issuer.hash=y.digest().toHex();var v=r.md.sha1.create(),E=s.toDer(n.certSubject);return v.update(E.getBytes()),u.subject.getField=function(e){return p(u.subject,e)},u.subject.addField=function(e){w([e]),u.subject.attributes.push(e)},u.subject.attributes=i.RDNAttributesAsArray(n.certSubject),n.certSubjectUniqueId&&(u.subject.uniqueId=n.certSubjectUniqueId),u.subject.hash=v.digest().toHex(),n.certExtensions?u.extensions=i.certificateExtensionsFromAsn1(n.certExtensions):u.extensions=[],u.publicKey=i.publicKeyFromAsn1(n.subjectPublicKeyInfo),u},i.certificateExtensionsFromAsn1=function(e){for(var t=[],n=0;n<e.value.length;++n)for(var r=e.value[n],s=0;s<r.value.length;++s)t.push(i.certificateExtensionFromAsn1(r.value[s]));return t},i.certificateExtensionFromAsn1=function(e){var t={};if(t.id=s.derToOid(e.value[0].value),t.critical=!1,e.value[1].type===s.Type.BOOLEAN?(t.critical=0!==e.value[1].value.charCodeAt(0),t.value=e.value[2].value):t.value=e.value[1].value,t.id in o)if(t.name=o[t.id],"keyUsage"===t.name){var n=s.fromDer(t.value),i=0,a=0;n.value.length>1&&(i=n.value.charCodeAt(1),a=n.value.length>2?n.value.charCodeAt(2):0),t.digitalSignature=128===(128&i),t.nonRepudiation=64===(64&i),t.keyEncipherment=32===(32&i),t.dataEncipherment=16===(16&i),t.keyAgreement=8===(8&i),t.keyCertSign=4===(4&i),t.cRLSign=2===(2&i),t.encipherOnly=1===(1&i),t.decipherOnly=128===(128&a)}else if("basicConstraints"===t.name){n=s.fromDer(t.value);n.value.length>0&&n.value[0].type===s.Type.BOOLEAN?t.cA=0!==n.value[0].value.charCodeAt(0):t.cA=!1;var c=null;n.value.length>0&&n.value[0].type===s.Type.INTEGER?c=n.value[0].value:n.value.length>1&&(c=n.value[1].value),null!==c&&(t.pathLenConstraint=s.derToInteger(c))}else if("extKeyUsage"===t.name){n=s.fromDer(t.value);for(var l=0;l<n.value.length;++l){var u=s.derToOid(n.value[l].value);u in o?t[o[u]]=!0:t[u]=!0}}else if("nsCertType"===t.name){n=s.fromDer(t.value),i=0;n.value.length>1&&(i=n.value.charCodeAt(1)),t.client=128===(128&i),t.server=64===(64&i),t.email=32===(32&i),t.objsign=16===(16&i),t.reserved=8===(8&i),t.sslCA=4===(4&i),t.emailCA=2===(2&i),t.objCA=1===(1&i)}else if("subjectAltName"===t.name||"issuerAltName"===t.name){var h;t.altNames=[];n=s.fromDer(t.value);for(var d=0;d<n.value.length;++d){h=n.value[d];var p={type:h.type,value:h.value};switch(t.altNames.push(p),h.type){case 1:case 2:case 6:break;case 7:p.ip=r.util.bytesToIP(h.value);break;case 8:p.oid=s.derToOid(h.value);break;default:}}}else if("subjectKeyIdentifier"===t.name){n=s.fromDer(t.value);t.subjectKeyIdentifier=r.util.bytesToHex(n.value)}return t},i.certificationRequestFromAsn1=function(e,t){var n={},o=[];if(!s.validate(e,d,n,o)){var a=new Error("Cannot read PKCS#10 certificate request. ASN.1 object is not a PKCS#10 CertificationRequest.");throw a.errors=o,a}var c=s.derToOid(n.publicKeyOid);if(c!==i.oids.rsaEncryption)throw new Error("Cannot read public key. OID is not RSA.");var l=i.createCertificationRequest();if(l.version=n.csrVersion?n.csrVersion.charCodeAt(0):0,l.signatureOid=r.asn1.derToOid(n.csrSignatureOid),l.signatureParameters=f(l.signatureOid,n.csrSignatureParams,!0),l.siginfo.algorithmOid=r.asn1.derToOid(n.csrSignatureOid),l.siginfo.parameters=f(l.siginfo.algorithmOid,n.csrSignatureParams,!1),l.signature=n.csrSignature,l.certificationRequestInfo=n.certificationRequestInfo,t){l.md=g({signatureOid:l.signatureOid,type:"certification request"});var u=s.toDer(l.certificationRequestInfo);l.md.update(u.getBytes())}var h=r.md.sha1.create();return l.subject.getField=function(e){return p(l.subject,e)},l.subject.addField=function(e){w([e]),l.subject.attributes.push(e)},l.subject.attributes=i.RDNAttributesAsArray(n.certificationRequestInfoSubject,h),l.subject.hash=h.digest().toHex(),l.publicKey=i.publicKeyFromAsn1(n.subjectPublicKeyInfo),l.getAttribute=function(e){return p(l,e)},l.addAttribute=function(e){w([e]),l.attributes.push(e)},l.attributes=i.CRIAttributesAsArray(n.certificationRequestInfoAttributes||[]),l},i.createCertificationRequest=function(){var e={version:0,signatureOid:null,signature:null,siginfo:{}};return e.siginfo.algorithmOid=null,e.subject={},e.subject.getField=function(t){return p(e.subject,t)},e.subject.addField=function(t){w([t]),e.subject.attributes.push(t)},e.subject.attributes=[],e.subject.hash=null,e.publicKey=null,e.attributes=[],e.getAttribute=function(t){return p(e,t)},e.addAttribute=function(t){w([t]),e.attributes.push(t)},e.md=null,e.setSubject=function(t){w(t),e.subject.attributes=t,e.subject.hash=null},e.setAttributes=function(t){w(t),e.attributes=t},e.sign=function(t,n){e.md=n||r.md.sha1.create();var a=o[e.md.algorithm+"WithRSAEncryption"];if(!a){var c=new Error("Could not compute certification request digest. Unknown message digest algorithm OID.");throw c.algorithm=e.md.algorithm,c}e.signatureOid=e.siginfo.algorithmOid=a,e.certificationRequestInfo=i.getCertificationRequestInfo(e);var l=s.toDer(e.certificationRequestInfo);e.md.update(l.getBytes()),e.signature=t.sign(e.md)},e.verify=function(){var t=!1,n=e.md;if(null===n){n=g({signatureOid:e.signatureOid,type:"certification request"});var r=e.certificationRequestInfo||i.getCertificationRequestInfo(e),o=s.toDer(r);n.update(o.getBytes())}return null!==n&&(t=m({certificate:e,md:n,signature:e.signature})),t},e};var _=new Date("1950-01-01T00:00:00Z"),S=new Date("2050-01-01T00:00:00Z");function k(e){return e>=_&&e<S?s.create(s.Class.UNIVERSAL,s.Type.UTCTIME,!1,s.dateToUtcTime(e)):s.create(s.Class.UNIVERSAL,s.Type.GENERALIZEDTIME,!1,s.dateToGeneralizedTime(e))}i.getTBSCertificate=function(e){var t=k(e.validity.notBefore),n=k(e.validity.notAfter),o=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.CONTEXT_SPECIFIC,0,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes())]),s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,r.util.hexToBytes(e.serialNumber)),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.siginfo.algorithmOid).getBytes()),v(e.siginfo.algorithmOid,e.siginfo.parameters)]),y(e.issuer),s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[t,n]),y(e.subject),i.publicKeyToAsn1(e.publicKey)]);return e.issuer.uniqueId&&o.value.push(s.create(s.Class.CONTEXT_SPECIFIC,1,!0,[s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.issuer.uniqueId)])),e.subject.uniqueId&&o.value.push(s.create(s.Class.CONTEXT_SPECIFIC,2,!0,[s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.subject.uniqueId)])),e.extensions.length>0&&o.value.push(i.certificateExtensionsToAsn1(e.extensions)),o},i.getCertificationRequestInfo=function(e){var t=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.INTEGER,!1,s.integerToDer(e.version).getBytes()),y(e.subject),i.publicKeyToAsn1(e.publicKey),E(e)]);return t},i.distinguishedNameToAsn1=function(e){return y(e)},i.certificateToAsn1=function(e){var t=e.tbsCertificate||i.getTBSCertificate(e);return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[t,s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.signatureOid).getBytes()),v(e.signatureOid,e.signatureParameters)]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},i.certificateExtensionsToAsn1=function(e){var t=s.create(s.Class.CONTEXT_SPECIFIC,3,!0,[]),n=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);t.value.push(n);for(var r=0;r<e.length;++r)n.value.push(i.certificateExtensionToAsn1(e[r]));return t},i.certificateExtensionToAsn1=function(e){var t=s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[]);t.value.push(s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.id).getBytes())),e.critical&&t.value.push(s.create(s.Class.UNIVERSAL,s.Type.BOOLEAN,!1,String.fromCharCode(255)));var n=e.value;return"string"!==typeof e.value&&(n=s.toDer(n).getBytes()),t.value.push(s.create(s.Class.UNIVERSAL,s.Type.OCTETSTRING,!1,n)),t},i.certificationRequestToAsn1=function(e){var t=e.certificationRequestInfo||i.getCertificationRequestInfo(e);return s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[t,s.create(s.Class.UNIVERSAL,s.Type.SEQUENCE,!0,[s.create(s.Class.UNIVERSAL,s.Type.OID,!1,s.oidToDer(e.signatureOid).getBytes()),v(e.signatureOid,e.signatureParameters)]),s.create(s.Class.UNIVERSAL,s.Type.BITSTRING,!1,String.fromCharCode(0)+e.signature)])},i.createCaStore=function(e){var t={certs:{}};function n(e){return o(e),t.certs[e.hash]||null}function o(e){if(!e.hash){var t=r.md.sha1.create();e.attributes=i.RDNAttributesAsArray(y(e),t),e.hash=t.digest().toHex()}}if(t.getIssuer=function(e){var t=n(e.issuer);return t},t.addCertificate=function(e){if("string"===typeof e&&(e=r.pki.certificateFromPem(e)),o(e.subject),!t.hasCertificate(e))if(e.subject.hash in t.certs){var n=t.certs[e.subject.hash];r.util.isArray(n)||(n=[n]),n.push(e),t.certs[e.subject.hash]=n}else t.certs[e.subject.hash]=e},t.hasCertificate=function(e){"string"===typeof e&&(e=r.pki.certificateFromPem(e));var t=n(e.subject);if(!t)return!1;r.util.isArray(t)||(t=[t]);for(var o=s.toDer(i.certificateToAsn1(e)).getBytes(),a=0;a<t.length;++a){var c=s.toDer(i.certificateToAsn1(t[a])).getBytes();if(o===c)return!0}return!1},t.listAllCertificates=function(){var e=[];for(var n in t.certs)if(t.certs.hasOwnProperty(n)){var s=t.certs[n];if(r.util.isArray(s))for(var i=0;i<s.length;++i)e.push(s[i]);else e.push(s)}return e},t.removeCertificate=function(e){var a;if("string"===typeof e&&(e=r.pki.certificateFromPem(e)),o(e.subject),!t.hasCertificate(e))return null;var c=n(e.subject);if(!r.util.isArray(c))return a=t.certs[e.subject.hash],delete t.certs[e.subject.hash],a;for(var l=s.toDer(i.certificateToAsn1(e)).getBytes(),u=0;u<c.length;++u){var h=s.toDer(i.certificateToAsn1(c[u])).getBytes();l===h&&(a=c[u],c.splice(u,1))}return 0===c.length&&delete t.certs[e.subject.hash],a},e)for(var a=0;a<e.length;++a){var c=e[a];t.addCertificate(c)}return t},i.certificateError={bad_certificate:"forge.pki.BadCertificate",unsupported_certificate:"forge.pki.UnsupportedCertificate",certificate_revoked:"forge.pki.CertificateRevoked",certificate_expired:"forge.pki.CertificateExpired",certificate_unknown:"forge.pki.CertificateUnknown",unknown_ca:"forge.pki.UnknownCertificateAuthority"},i.verifyCertificateChain=function(e,t,n){"function"===typeof n&&(n={verify:n}),n=n||{},t=t.slice(0);var s=t.slice(0),o=n.validityCheckDate;"undefined"===typeof o&&(o=new Date);var a=!0,c=null,l=0;do{var u=t.shift(),h=null,d=!1;if(o&&(o<u.validity.notBefore||o>u.validity.notAfter)&&(c={message:"Certificate is not valid yet or has expired.",error:i.certificateError.certificate_expired,notBefore:u.validity.notBefore,notAfter:u.validity.notAfter,now:o}),null===c){if(h=t[0]||e.getIssuer(u),null===h&&u.isIssuer(u)&&(d=!0,h=u),h){var p=h;r.util.isArray(p)||(p=[p]);var f=!1;while(!f&&p.length>0){h=p.shift();try{f=h.verify(u)}catch(S){}}f||(c={message:"Certificate signature is invalid.",error:i.certificateError.bad_certificate})}null!==c||h&&!d||e.hasCertificate(u)||(c={message:"Certificate is not trusted.",error:i.certificateError.unknown_ca})}if(null===c&&h&&!u.isIssuer(h)&&(c={message:"Certificate issuer is invalid.",error:i.certificateError.bad_certificate}),null===c)for(var g={keyUsage:!0,basicConstraints:!0},m=0;null===c&&m<u.extensions.length;++m){var y=u.extensions[m];y.critical&&!(y.name in g)&&(c={message:"Certificate has an unsupported critical extension.",error:i.certificateError.unsupported_certificate})}if(null===c&&(!a||0===t.length&&(!h||d))){var w=u.getExtension("basicConstraints"),b=u.getExtension("keyUsage");if(null!==b&&(b.keyCertSign&&null!==w||(c={message:"Certificate keyUsage or basicConstraints conflict or indicate that the certificate is not a CA. If the certificate is the only one in the chain or isn't the first then the certificate must be a valid CA.",error:i.certificateError.bad_certificate})),null!==c||null===w||w.cA||(c={message:"Certificate basicConstraints indicates the certificate is not a CA.",error:i.certificateError.bad_certificate}),null===c&&null!==b&&"pathLenConstraint"in w){var v=l-1;v>w.pathLenConstraint&&(c={message:"Certificate basicConstraints pathLenConstraint violated.",error:i.certificateError.bad_certificate})}}var E=null===c||c.error,_=n.verify?n.verify(E,l,s):E;if(!0!==_)throw!0===E&&(c={message:"The application rejected the certificate.",error:i.certificateError.bad_certificate}),(_||0===_)&&("object"!==typeof _||r.util.isArray(_)?"string"===typeof _&&(c.error=_):(_.message&&(c.message=_.message),_.error&&(c.error=_.error))),c;c=null,a=!1,++l}while(t.length>0);return!0}},2119:function(e,t,n){n(7658);const r=n(2517),s=n(2663);e.exports=class{constructor(){this._buffer=new r,this._waitingConsumers=new r}push(e){const{promise:t,resolve:n}=s();return this._buffer.push({chunk:e,resolve:n}),this._consume(),t}_consume(){while(!this._waitingConsumers.isEmpty()&&!this._buffer.isEmpty()){const e=this._waitingConsumers.shift(),t=this._buffer.shift();e.resolve(t.chunk),t.resolve()}}shift(){const{promise:e,resolve:t}=s();return this._waitingConsumers.push({resolve:t}),this._consume(),e}isEmpty(){return this._buffer.isEmpty()}}},2663:function(e){"use strict";const t=()=>{const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e};e.exports=t},7341:function(e,t,n){"use strict";e.exports=n(7017)["default"]},7017:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const s=n(2346),i=r(n(862)),o=r(n(7636)),a=n(3246),c=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],l=c.map((e=>new s.Netmask(e)));function u(e){for(let t of l)if(t.contains(e))return!0;return!1}function h(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}t["default"]=e=>{if((0,a.isValid)(e)){const t=(0,a.parse)(e);if("ipv4"===t.kind())return u(t.toNormalizedString());if("ipv6"===t.kind())return h(e)}else if((0,o.default)(e)&&i.default.v6().test(e))return h(e)}},862:function(e){"use strict";const t="[a-fA-F\\d:]",n=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${t})|(?<=${t})(?=\\s|$))`:"",r="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",i=`\n(?:\n(?:${s}:){7}(?:${s}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${s}:){6}(?:${r}|:${s}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${s}:){5}(?::${r}|(?::${s}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${s}:){4}(?:(?::${s}){0,1}:${r}|(?::${s}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${s}:){3}(?:(?::${s}){0,2}:${r}|(?::${s}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${s}:){2}(?:(?::${s}){0,3}:${r}|(?::${s}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${s}:){1}(?:(?::${s}){0,4}:${r}|(?::${s}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${s}){0,5}:${r}|(?::${s}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),o=new RegExp(`(?:^${r}$)|(?:^${i}$)`),a=new RegExp(`^${r}$`),c=new RegExp(`^${i}$`),l=e=>e&&e.exact?o:new RegExp(`(?:${n(e)}${r}${n(e)})|(?:${n(e)}${i}${n(e)})`,"g");l.v4=e=>e&&e.exact?a:new RegExp(`${n(e)}${r}${n(e)}`,"g"),l.v6=e=>e&&e.exact?c:new RegExp(`${n(e)}${i}${n(e)}`,"g"),e.exports=l},7636:function(e,t,n){"use strict";const r=n(862),s=e=>r({exact:!0}).test(e);s.v4=e=>r.v4({exact:!0}).test(e),s.v6=e=>r.v6({exact:!0}).test(e),s.version=e=>s(e)?s.v4(e)?4:6:void 0,e.exports=s},8947:function(e,t,n){"use strict";e.exports=n(9880)},9880:function(e,t,n){"use strict";var r=t;function s(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(1355),r.BufferWriter=n(3319),r.Reader=n(4609),r.BufferReader=n(3206),r.util=n(1539),r.rpc=n(1734),r.roots=n(3674),r.configure=s,s()},4609:function(e,t,n){"use strict";n(3767),n(8585),n(8696),e.exports=c;var r,s=n(1539),i=s.LongBits,o=s.utf8;function a(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function c(e){this.buf=e,this.pos=0,this.len=e.length}var l="undefined"!==typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new c(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new c(e);throw Error("illegal buffer")},u=function(){return s.Buffer?function(e){return(c.create=function(e){return s.Buffer.isBuffer(e)?new r(e):l(e)})(e)}:l};function h(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw a(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw a(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function d(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function p(){if(this.pos+8>this.len)throw a(this,8);return new i(d(this.buf,this.pos+=4),d(this.buf,this.pos+=4))}c.create=u(),c.prototype._slice=s.Array.prototype.subarray||s.Array.prototype.slice,c.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return e}}(),c.prototype.int32=function(){return 0|this.uint32()},c.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},c.prototype.bool=function(){return 0!==this.uint32()},c.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return d(this.buf,this.pos+=4)},c.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|d(this.buf,this.pos+=4)},c.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var e=s.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},c.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var e=s.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},c.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw a(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},c.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},c.prototype.skip=function(e){if("number"===typeof e){if(this.pos+e>this.len)throw a(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},c.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while(4!==(e=7&this.uint32()))this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},c._configure=function(e){r=e,c.create=u(),r._configure();var t=s.Long?"toLong":"toNumber";s.merge(c.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return p.call(this)[t](!0)},sfixed64:function(){return p.call(this)[t](!1)}})}},3206:function(e,t,n){"use strict";e.exports=i;var r=n(4609);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(1539);function i(e){r.call(this,e)}i._configure=function(){s.Buffer&&(i.prototype._slice=s.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},3674:function(e){"use strict";e.exports={}},1734:function(e,t,n){"use strict";var r=t;r.Service=n(4826)},4826:function(e,t,n){"use strict";e.exports=s;var r=n(1539);function s(e,t,n){if("function"!==typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(s.prototype=Object.create(r.EventEmitter.prototype)).constructor=s,s.prototype.rpcCall=function e(t,n,s,i,o){if(!i)throw TypeError("request must be specified");var a=this;if(!o)return r.asPromise(e,a,t,n,s,i);if(a.rpcImpl)try{return a.rpcImpl(t,n[a.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return a.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof s))try{n=s[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return a.emit("error",e,t),o(e)}return a.emit("data",n,t),o(null,n)}a.end(!0)}))}catch(c){return a.emit("error",c,t),void setTimeout((function(){o(c)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},s.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},8893:function(e,t,n){"use strict";e.exports=s;var r=n(1539);function s(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=s.zero=new s(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=s.zeroHash="\0\0\0\0\0\0\0\0";s.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new s(n,r)},s.from=function(e){if("number"===typeof e)return s.fromNumber(e);if(r.isString(e)){if(!r.Long)return s.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new s(e.low>>>0,e.high>>>0):i},s.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},s.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var a=String.prototype.charCodeAt;s.fromHash=function(e){return e===o?i:new s((a.call(e,0)|a.call(e,1)<<8|a.call(e,2)<<16|a.call(e,3)<<24)>>>0,(a.call(e,4)|a.call(e,5)<<8|a.call(e,6)<<16|a.call(e,7)<<24)>>>0)},s.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},s.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},s.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},s.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},1539:function(e,t,n){"use strict";n(3767),n(8585),n(8696);var r=t;function s(e,t,n){for(var r=Object.keys(t),s=0;s<r.length;++s)void 0!==e[r[s]]&&n||(e[r[s]]=t[r[s]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&s(this,n)}return t.prototype=Object.create(Error.prototype,{constructor:{value:t,writable:!0,enumerable:!1,configurable:!0},name:{get(){return e},set:void 0,enumerable:!1,configurable:!0},toString:{value(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),t}r.asPromise=n(3551),r.base64=n(8550),r.EventEmitter=n(8447),r.float=n(891),r.inquire=n(4842),r.utf8=n(479),r.pool=n(1387),r.LongBits=n(8893),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"===typeof e||e instanceof String},r.isObject=function(e){return e&&"object"===typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"===typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"===typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=s,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},1355:function(e,t,n){"use strict";e.exports=h;var r,s=n(1539),i=s.LongBits,o=s.base64,a=s.utf8;function c(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function l(){}function u(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new c(l,0,0),this.tail=this.head,this.states=null}var d=function(){return s.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function p(e,t,n){t[n]=255&e}function f(e,t,n){while(e>127)t[n++]=127&e|128,e>>>=7;t[n]=e}function g(e,t){this.len=e,this.next=void 0,this.val=t}function m(e,t,n){while(e.hi)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;while(e.lo>127)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function y(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=d(),h.alloc=function(e){return new s.Array(e)},s.Array!==Array&&(h.alloc=s.pool(h.alloc,s.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new c(e,t,n),this.len+=t,this},g.prototype=Object.create(c.prototype),g.prototype.fn=f,h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new g((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(m,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(m,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(m,t.length(),t)},h.prototype.bool=function(e){return this._push(p,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(y,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(y,4,t.lo)._push(y,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(s.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(s.float.writeDoubleLE,8,e)};var w=s.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(p,1,0);if(s.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(w,t,e)},h.prototype.string=function(e){var t=a.length(e);return t?this.uint32(t)._push(a.write,t,e):this._push(p,1,0)},h.prototype.fork=function(){return this.states=new u(this),this.head=this.tail=new c(l,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new c(l,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){var e=this.head.next,t=this.constructor.alloc(this.len),n=0;while(e)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=d(),r._configure()}},3319:function(e,t,n){"use strict";n(3767),n(8585),n(8696),e.exports=i;var r=n(1355);(i.prototype=Object.create(r.prototype)).constructor=i;var s=n(1539);function i(){r.call(this)}function o(e,t,n){e.length<40?s.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=s._Buffer_allocUnsafe,i.writeBytesBuffer=s.Buffer&&s.Buffer.prototype instanceof Uint8Array&&"set"===s.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){s.isString(e)&&(e=s._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=s.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},6486:function(e,t,n){
/*! queue-microtask. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
let r;e.exports="function"===typeof queueMicrotask?queueMicrotask.bind("undefined"!==typeof window?window:n.g):e=>(r||(r=Promise.resolve())).then(e).catch((e=>setTimeout((()=>{throw e}),0)))},5882:function(e,t,n){n(3767),n(8585),n(8696);const{instantiate:r}=n(7966);function s(e={}){if(!s.supported)return null;var t=new Uint8Array([0,97,115,109,1,0,0,0,1,78,14,96,2,127,126,0,96,1,127,1,126,96,2,127,127,0,96,1,127,1,127,96,1,127,0,96,2,127,127,1,127,96,3,127,127,127,1,127,96,0,0,96,3,127,127,127,0,96,0,1,127,96,4,127,127,127,127,0,96,5,127,127,127,127,127,1,127,96,1,126,1,127,96,2,126,126,1,126,2,13,1,3,101,110,118,5,97,98,111,114,116,0,10,3,54,53,2,2,8,9,3,5,2,8,6,5,3,4,2,6,9,12,13,2,5,11,3,2,3,2,3,2,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,6,7,7,4,4,5,3,1,0,1,6,47,9,127,1,65,0,11,127,1,65,0,11,127,0,65,3,11,127,0,65,4,11,127,1,65,0,11,127,1,65,0,11,127,1,65,0,11,127,0,65,240,2,11,127,0,65,6,11,7,240,5,41,6,109,101,109,111,114,121,2,0,7,95,95,97,108,108,111,99,0,10,8,95,95,114,101,116,97,105,110,0,11,9,95,95,114,101,108,101,97,115,101,0,12,9,95,95,99,111,108,108,101,99,116,0,51,11,95,95,114,116,116,105,95,98,97,115,101,3,7,13,73,110,116,51,50,65,114,114,97,121,95,73,68,3,2,13,85,105,110,116,56,65,114,114,97,121,95,73,68,3,3,6,100,101,103,114,101,101,0,16,3,109,111,100,0,17,5,82,97,98,105,110,3,8,16,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,0,21,16,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,0,22,21,82,97,98,105,110,35,103,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,23,21,82,97,98,105,110,35,115,101,116,58,119,105,110,100,111,119,95,115,105,122,101,0,24,14,82,97,98,105,110,35,103,101,116,58,119,112,111,115,0,25,14,82,97,98,105,110,35,115,101,116,58,119,112,111,115,0,26,15,82,97,98,105,110,35,103,101,116,58,99,111,117,110,116,0,27,15,82,97,98,105,110,35,115,101,116,58,99,111,117,110,116,0,28,13,82,97,98,105,110,35,103,101,116,58,112,111,115,0,29,13,82,97,98,105,110,35,115,101,116,58,112,111,115,0,30,15,82,97,98,105,110,35,103,101,116,58,115,116,97,114,116,0,31,15,82,97,98,105,110,35,115,101,116,58,115,116,97,114,116,0,32,16,82,97,98,105,110,35,103,101,116,58,100,105,103,101,115,116,0,33,16,82,97,98,105,110,35,115,101,116,58,100,105,103,101,115,116,0,34,21,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,35,21,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,115,116,97,114,116,0,36,22,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,37,22,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,108,101,110,103,116,104,0,38,31,82,97,98,105,110,35,103,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,39,31,82,97,98,105,110,35,115,101,116,58,99,104,117,110,107,95,99,117,116,95,102,105,110,103,101,114,112,114,105,110,116,0,40,20,82,97,98,105,110,35,103,101,116,58,112,111,108,121,110,111,109,105,97,108,0,41,20,82,97,98,105,110,35,115,101,116,58,112,111,108,121,110,111,109,105,97,108,0,42,17,82,97,98,105,110,35,103,101,116,58,109,105,110,115,105,122,101,0,43,17,82,97,98,105,110,35,115,101,116,58,109,105,110,115,105,122,101,0,44,17,82,97,98,105,110,35,103,101,116,58,109,97,120,115,105,122,101,0,45,17,82,97,98,105,110,35,115,101,116,58,109,97,120,115,105,122,101,0,46,14,82,97,98,105,110,35,103,101,116,58,109,97,115,107,0,47,14,82,97,98,105,110,35,115,101,116,58,109,97,115,107,0,48,17,82,97,98,105,110,35,99,111,110,115,116,114,117,99,116,111,114,0,20,17,82,97,98,105,110,35,102,105,110,103,101,114,112,114,105,110,116,0,49,8,1,50,10,165,31,53,199,1,1,4,127,32,1,40,2,0,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,3,65,4,107,118,65,16,115,33,4,32,3,65,7,107,11,33,3,32,1,40,2,20,33,2,32,1,40,2,16,34,5,4,64,32,5,32,2,54,2,20,11,32,2,4,64,32,2,32,5,54,2,16,11,32,1,32,0,32,4,32,3,65,4,116,106,65,2,116,106,40,2,96,70,4,64,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,2,54,2,96,32,2,69,4,64,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,65,127,115,113,34,1,54,2,4,32,1,69,4,64,32,0,32,0,40,2,0,65,1,32,3,116,65,127,115,113,54,2,0,11,11,11,11,226,2,1,6,127,32,1,40,2,0,33,3,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,34,5,65,1,113,4,64,32,3,65,124,113,65,16,106,32,5,65,124,113,106,34,2,65,240,255,255,255,3,73,4,64,32,0,32,4,16,1,32,1,32,2,32,3,65,3,113,114,34,3,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,34,4,40,2,0,33,5,11,11,32,3,65,2,113,4,64,32,1,65,4,107,40,2,0,34,2,40,2,0,34,6,65,124,113,65,16,106,32,3,65,124,113,106,34,7,65,240,255,255,255,3,73,4,64,32,0,32,2,16,1,32,2,32,7,32,6,65,3,113,114,34,3,54,2,0,32,2,33,1,11,11,32,4,32,5,65,2,114,54,2,0,32,4,65,4,107,32,1,54,2,0,32,0,32,3,65,124,113,34,2,65,128,2,73,4,127,32,2,65,4,118,33,4,65,0,5,32,2,65,31,32,2,103,107,34,2,65,4,107,118,65,16,115,33,4,32,2,65,7,107,11,34,3,65,4,116,32,4,106,65,2,116,106,40,2,96,33,2,32,1,65,0,54,2,16,32,1,32,2,54,2,20,32,2,4,64,32,2,32,1,54,2,16,11,32,0,32,4,32,3,65,4,116,106,65,2,116,106,32,1,54,2,96,32,0,32,0,40,2,0,65,1,32,3,116,114,54,2,0,32,0,32,3,65,2,116,106,32,0,32,3,65,2,116,106,40,2,4,65,1,32,4,116,114,54,2,4,11,119,1,1,127,32,2,2,127,32,0,40,2,160,12,34,2,4,64,32,2,32,1,65,16,107,70,4,64,32,2,40,2,0,33,3,32,1,65,16,107,33,1,11,11,32,1,11,107,34,2,65,48,73,4,64,15,11,32,1,32,3,65,2,113,32,2,65,32,107,65,1,114,114,54,2,0,32,1,65,0,54,2,16,32,1,65,0,54,2,20,32,1,32,2,106,65,16,107,34,2,65,2,54,2,0,32,0,32,2,54,2,160,12,32,0,32,1,16,2,11,155,1,1,3,127,35,0,34,0,69,4,64,65,1,63,0,34,0,74,4,127,65,1,32,0,107,64,0,65,0,72,5,65,0,11,4,64,0,11,65,176,3,34,0,65,0,54,2,0,65,208,15,65,0,54,2,0,3,64,32,1,65,23,73,4,64,32,1,65,2,116,65,176,3,106,65,0,54,2,4,65,0,33,2,3,64,32,2,65,16,73,4,64,32,1,65,4,116,32,2,106,65,2,116,65,176,3,106,65,0,54,2,96,32,2,65,1,106,33,2,12,1,11,11,32,1,65,1,106,33,1,12,1,11,11,65,176,3,65,224,15,63,0,65,16,116,16,3,65,176,3,36,0,11,32,0,11,45,0,32,0,65,240,255,255,255,3,79,4,64,65,32,65,224,0,65,201,3,65,29,16,0,0,11,32,0,65,15,106,65,112,113,34,0,65,16,32,0,65,16,75,27,11,169,1,1,1,127,32,0,32,1,65,128,2,73,4,127,32,1,65,4,118,33,1,65,0,5,32,1,65,248,255,255,255,1,73,4,64,32,1,65,1,65,27,32,1,103,107,116,106,65,1,107,33,1,11,32,1,65,31,32,1,103,107,34,2,65,4,107,118,65,16,115,33,1,32,2,65,7,107,11,34,2,65,2,116,106,40,2,4,65,127,32,1,116,113,34,1,4,127,32,0,32,1,104,32,2,65,4,116,106,65,2,116,106,40,2,96,5,32,0,40,2,0,65,127,32,2,65,1,106,116,113,34,1,4,127,32,0,32,0,32,1,104,34,0,65,2,116,106,40,2,4,104,32,0,65,4,116,106,65,2,116,106,40,2,96,5,65,0,11,11,11,111,1,1,127,63,0,34,2,32,1,65,248,255,255,255,1,73,4,127,32,1,65,1,65,27,32,1,103,107,116,65,1,107,106,5,32,1,11,65,16,32,0,40,2,160,12,32,2,65,16,116,65,16,107,71,116,106,65,255,255,3,106,65,128,128,124,113,65,16,118,34,1,32,2,32,1,74,27,64,0,65,0,72,4,64,32,1,64,0,65,0,72,4,64,0,11,11,32,0,32,2,65,16,116,63,0,65,16,116,16,3,11,113,1,2,127,32,1,40,2,0,34,3,65,124,113,32,2,107,34,4,65,32,79,4,64,32,1,32,2,32,3,65,2,113,114,54,2,0,32,2,32,1,65,16,106,106,34,1,32,4,65,16,107,65,1,114,54,2,0,32,0,32,1,16,2,5,32,1,32,3,65,126,113,54,2,0,32,1,65,16,106,32,1,40,2,0,65,124,113,106,32,1,65,16,106,32,1,40,2,0,65,124,113,106,40,2,0,65,125,113,54,2,0,11,11,91,1,2,127,32,0,32,1,16,5,34,4,16,6,34,3,69,4,64,65,1,36,1,65,0,36,1,32,0,32,4,16,6,34,3,69,4,64,32,0,32,4,16,7,32,0,32,4,16,6,33,3,11,11,32,3,65,0,54,2,4,32,3,32,2,54,2,8,32,3,32,1,54,2,12,32,0,32,3,16,1,32,0,32,3,32,4,16,8,32,3,11,13,0,16,4,32,0,32,1,16,9,65,16,106,11,33,1,1,127,32,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,18,0,32,0,65,172,3,75,4,64,32,0,65,16,107,16,52,11,11,140,3,1,1,127,2,64,32,1,69,13,0,32,0,65,0,58,0,0,32,0,32,1,106,65,1,107,65,0,58,0,0,32,1,65,2,77,13,0,32,0,65,1,106,65,0,58,0,0,32,0,65,2,106,65,0,58,0,0,32,0,32,1,106,34,2,65,2,107,65,0,58,0,0,32,2,65,3,107,65,0,58,0,0,32,1,65,6,77,13,0,32,0,65,3,106,65,0,58,0,0,32,0,32,1,106,65,4,107,65,0,58,0,0,32,1,65,8,77,13,0,32,1,65,0,32,0,107,65,3,113,34,1,107,33,2,32,0,32,1,106,34,0,65,0,54,2,0,32,0,32,2,65,124,113,34,1,106,65,4,107,65,0,54,2,0,32,1,65,8,77,13,0,32,0,65,4,106,65,0,54,2,0,32,0,65,8,106,65,0,54,2,0,32,0,32,1,106,34,2,65,12,107,65,0,54,2,0,32,2,65,8,107,65,0,54,2,0,32,1,65,24,77,13,0,32,0,65,12,106,65,0,54,2,0,32,0,65,16,106,65,0,54,2,0,32,0,65,20,106,65,0,54,2,0,32,0,65,24,106,65,0,54,2,0,32,0,32,1,106,34,2,65,28,107,65,0,54,2,0,32,2,65,24,107,65,0,54,2,0,32,2,65,20,107,65,0,54,2,0,32,2,65,16,107,65,0,54,2,0,32,0,32,0,65,4,113,65,24,106,34,2,106,33,0,32,1,32,2,107,33,1,3,64,32,1,65,32,79,4,64,32,0,66,0,55,3,0,32,0,65,8,106,66,0,55,3,0,32,0,65,16,106,66,0,55,3,0,32,0,65,24,106,66,0,55,3,0,32,1,65,32,107,33,1,32,0,65,32,106,33,0,12,1,11,11,11,11,178,1,1,3,127,32,1,65,240,255,255,255,3,32,2,118,75,4,64,65,144,1,65,192,1,65,23,65,56,16,0,0,11,32,1,32,2,116,34,3,65,0,16,10,34,2,32,3,16,13,32,0,69,4,64,65,12,65,2,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,2,34,1,32,0,40,2,0,34,4,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,32,4,16,12,11,32,0,32,1,54,2,0,32,0,32,2,54,2,4,32,0,32,3,54,2,8,32,0,11,46,1,2,127,65,12,65,5,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,65,128,2,65,3,16,14,11,9,0,65,63,32,0,121,167,107,11,49,1,2,127,65,63,32,1,121,167,107,33,2,3,64,65,63,32,0,121,167,107,32,2,107,34,3,65,0,78,4,64,32,0,32,1,32,3,172,134,133,33,0,12,1,11,11,32,0,11,40,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,163,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,65,0,58,0,0,11,38,0,32,1,32,0,40,2,8,79,4,64,65,128,2,65,192,2,65,152,1,65,44,16,0,0,11,32,1,32,0,40,2,4,106,45,0,0,11,254,5,2,1,127,4,126,32,0,69,4,64,65,232,0,65,6,16,10,34,0,65,172,3,75,4,64,32,0,65,16,107,34,5,32,5,40,2,4,65,1,106,54,2,4,11,11,32,0,65,0,54,2,0,32,0,65,0,54,2,4,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,24,32,0,66,0,55,3,32,32,0,66,0,55,3,40,32,0,66,0,55,3,48,32,0,66,0,55,3,56,32,0,66,0,55,3,64,32,0,66,0,55,3,72,32,0,66,0,55,3,80,32,0,66,0,55,3,88,32,0,66,0,55,3,96,32,0,32,2,173,55,3,80,32,0,32,3,173,55,3,88,65,12,65,4,16,10,34,2,65,172,3,75,4,64,32,2,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,32,4,65,0,16,14,33,2,32,0,40,2,0,16,12,32,0,32,2,54,2,0,32,0,32,4,54,2,4,32,0,66,1,32,1,173,134,66,1,125,55,3,96,32,0,66,243,130,183,218,216,230,232,30,55,3,72,35,4,69,4,64,65,0,33,2,3,64,32,2,65,128,2,72,4,64,32,2,65,255,1,113,173,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,65,0,33,4,3,64,32,4,32,0,40,2,4,65,1,107,72,4,64,32,6,66,8,134,33,6,32,0,41,3,72,34,7,33,8,65,63,32,7,121,167,107,33,1,3,64,65,63,32,6,121,167,107,32,1,107,34,3,65,0,78,4,64,32,6,32,8,32,3,172,134,133,33,6,12,1,11,11,32,4,65,1,106,33,4,12,1,11,11,35,6,40,2,4,32,2,65,3,116,106,32,6,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,63,32,0,41,3,72,121,167,107,172,33,7,65,0,33,2,3,64,32,2,65,128,2,72,4,64,35,5,33,1,32,2,172,32,7,134,34,8,33,6,65,63,32,0,41,3,72,34,9,121,167,107,33,3,3,64,65,63,32,6,121,167,107,32,3,107,34,4,65,0,78,4,64,32,6,32,9,32,4,172,134,133,33,6,12,1,11,11,32,1,40,2,4,32,2,65,3,116,106,32,6,32,8,132,55,3,0,32,2,65,1,106,33,2,12,1,11,11,65,1,36,4,11,32,0,66,0,55,3,24,32,0,66,0,55,3,32,65,0,33,2,3,64,32,2,32,0,40,2,4,72,4,64,32,0,40,2,0,32,2,16,18,32,2,65,1,106,33,2,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,6,66,45,136,167,65,3,116,106,41,3,0,32,6,66,8,134,66,1,132,133,55,3,40,32,0,11,38,1,1,127,32,0,40,2,0,34,0,65,172,3,75,4,64,32,0,65,16,107,34,1,32,1,40,2,4,65,1,106,54,2,4,11,32,0,11,55,1,2,127,32,1,32,0,40,2,0,34,2,71,4,64,32,1,65,172,3,75,4,64,32,1,65,16,107,34,3,32,3,40,2,4,65,1,106,54,2,4,11,32,2,16,12,11,32,0,32,1,54,2,0,11,7,0,32,0,40,2,4,11,9,0,32,0,32,1,54,2,4,11,7,0,32,0,40,2,8,11,9,0,32,0,32,1,54,2,8,11,7,0,32,0,41,3,16,11,9,0,32,0,32,1,55,3,16,11,7,0,32,0,41,3,24,11,9,0,32,0,32,1,55,3,24,11,7,0,32,0,41,3,32,11,9,0,32,0,32,1,55,3,32,11,7,0,32,0,41,3,40,11,9,0,32,0,32,1,55,3,40,11,7,0,32,0,41,3,48,11,9,0,32,0,32,1,55,3,48,11,7,0,32,0,41,3,56,11,9,0,32,0,32,1,55,3,56,11,7,0,32,0,41,3,64,11,9,0,32,0,32,1,55,3,64,11,7,0,32,0,41,3,72,11,9,0,32,0,32,1,55,3,72,11,7,0,32,0,41,3,80,11,9,0,32,0,32,1,55,3,80,11,7,0,32,0,41,3,88,11,9,0,32,0,32,1,55,3,88,11,7,0,32,0,41,3,96,11,9,0,32,0,32,1,55,3,96,11,172,4,2,5,127,1,126,32,2,65,172,3,75,4,64,32,2,65,16,107,34,4,32,4,40,2,4,65,1,106,54,2,4,11,32,2,33,4,65,0,33,2,32,1,40,2,8,33,5,32,1,40,2,4,33,6,3,64,2,127,65,0,33,3,3,64,32,3,32,5,72,4,64,32,3,32,6,106,45,0,0,33,1,32,0,40,2,0,32,0,40,2,8,16,19,33,7,32,0,40,2,8,32,0,40,2,0,40,2,4,106,32,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,7,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,1,173,32,8,66,8,134,132,133,55,3,40,32,0,32,0,41,3,16,66,1,124,55,3,16,32,0,32,0,41,3,24,66,1,124,55,3,24,32,0,41,3,16,32,0,41,3,80,90,4,127,32,0,41,3,40,32,0,41,3,96,131,80,5,65,0,11,4,127,65,1,5,32,0,41,3,16,32,0,41,3,88,90,11,4,64,32,0,32,0,41,3,32,55,3,48,32,0,32,0,41,3,16,55,3,56,32,0,32,0,41,3,40,55,3,64,65,0,33,1,3,64,32,1,32,0,40,2,4,72,4,64,32,0,40,2,0,32,1,16,18,32,1,65,1,106,33,1,12,1,11,11,32,0,66,0,55,3,40,32,0,65,0,54,2,8,32,0,66,0,55,3,16,32,0,66,0,55,3,40,32,0,40,2,0,32,0,40,2,8,16,19,33,1,32,0,40,2,8,32,0,40,2,0,40,2,4,106,65,1,58,0,0,32,0,32,0,41,3,40,35,6,40,2,4,32,1,65,3,116,106,41,3,0,133,55,3,40,32,0,32,0,40,2,8,65,1,106,32,0,40,2,4,111,54,2,8,32,0,35,5,40,2,4,32,0,41,3,40,34,8,66,45,136,167,65,3,116,106,41,3,0,32,8,66,8,134,66,1,132,133,55,3,40,32,3,65,1,106,12,3,11,32,3,65,1,106,33,3,12,1,11,11,65,127,11,34,1,65,0,78,4,64,32,5,32,1,107,33,5,32,1,32,6,106,33,6,32,2,34,1,65,1,106,33,2,32,4,40,2,4,32,1,65,2,116,106,32,0,41,3,56,62,2,0,12,1,11,11,32,4,11,10,0,16,15,36,5,16,15,36,6,11,3,0,1,11,73,1,2,127,32,0,40,2,4,34,1,65,255,255,255,255,0,113,34,2,65,1,70,4,64,32,0,65,16,106,16,53,32,0,32,0,40,2,0,65,1,114,54,2,0,35,0,32,0,16,2,5,32,0,32,2,65,1,107,32,1,65,128,128,128,128,127,113,114,54,2,4,11,11,58,0,2,64,2,64,2,64,32,0,65,8,107,40,2,0,14,7,0,0,1,1,1,1,1,2,11,15,11,32,0,40,2,0,34,0,4,64,32,0,65,172,3,79,4,64,32,0,65,16,107,16,52,11,11,15,11,0,11,11,137,3,7,0,65,16,11,55,40,0,0,0,1,0,0,0,1,0,0,0,40,0,0,0,97,0,108,0,108,0,111,0,99,0,97,0,116,0,105,0,111,0,110,0,32,0,116,0,111,0,111,0,32,0,108,0,97,0,114,0,103,0,101,0,65,208,0,11,45,30,0,0,0,1,0,0,0,1,0,0,0,30,0,0,0,126,0,108,0,105,0,98,0,47,0,114,0,116,0,47,0,116,0,108,0,115,0,102,0,46,0,116,0,115,0,65,128,1,11,43,28,0,0,0,1,0,0,0,1,0,0,0,28,0,0,0,73,0,110,0,118,0,97,0,108,0,105,0,100,0,32,0,108,0,101,0,110,0,103,0,116,0,104,0,65,176,1,11,53,38,0,0,0,1,0,0,0,1,0,0,0,38,0,0,0,126,0,108,0,105,0,98,0,47,0,97,0,114,0,114,0,97,0,121,0,98,0,117,0,102,0,102,0,101,0,114,0,46,0,116,0,115,0,65,240,1,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,73,0,110,0,100,0,101,0,120,0,32,0,111,0,117,0,116,0,32,0,111,0,102,0,32,0,114,0,97,0,110,0,103,0,101,0,65,176,2,11,51,36,0,0,0,1,0,0,0,1,0,0,0,36,0,0,0,126,0,108,0,105,0,98,0,47,0,116,0,121,0,112,0,101,0,100,0,97,0,114,0,114,0,97,0,121,0,46,0,116,0,115,0,65,240,2,11,53,7,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,16,0,0,0,0,0,0,0,145,4,0,0,2,0,0,0,49,0,0,0,2,0,0,0,17,1,0,0,2,0,0,0,16,0,34,16,115,111,117,114,99,101,77,97,112,112,105,110,103,85,82,76,16,46,47,114,97,98,105,110,46,119,97,115,109,46,109,97,112]);return r(new Response(new Blob([t],{type:"application/wasm"})),e)}s.supported="undefined"!==typeof WebAssembly,e.exports=s},9566:function(e,t,n){const r=n(6477),s=n(5882),i=async(e,t,n,i,o)=>{const a=await s();return new r(a,e,t,n,i,o)};e.exports={Rabin:r,create:i}},6477:function(e,t,n){n(3767),n(8585),n(8696);class r{constructor(e,t=12,n=8192,r=32768,s=64,i){this.bits=t,this.min=n,this.max=r,this.asModule=e,this.rabin=new e.Rabin(t,n,r,s,i),this.polynomial=i}fingerprint(e){const{__retain:t,__release:n,__allocArray:r,__getInt32Array:s,Int32Array_ID:i,Uint8Array_ID:o}=this.asModule,a=new Int32Array(Math.ceil(e.length/this.min)),c=t(r(i,a)),l=t(r(o,e)),u=this.rabin.fingerprint(l,c),h=s(u);n(l),n(c);const d=h.indexOf(0);return d>=0?h.subarray(0,d):h}}e.exports=r},8109:function(e,t,n){"use strict";var r=65536,s=4294967295;function i(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}var o=n(1989).Buffer,a=n.g.crypto||n.g.msCrypto;function c(e,t){if(e>s)throw new RangeError("requested too many random bytes");var n=o.allocUnsafe(e);if(e>0)if(e>r)for(var i=0;i<e;i+=r)a.getRandomValues(n.slice(i,i+r));else a.getRandomValues(n);return"function"===typeof t?process.nextTick((function(){t(null,n)})):n}a&&a.getRandomValues?e.exports=c:e.exports=i},8278:function(e,t,n){const r=n(6269),s=n(6886),i=n(2187),o=n(4240),{RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l}=n(5734),u=n(239),h=n(607),d=n(8913),p=n(3988),f=n(4420),g=n(548),m=n(3120);e.exports={RateLimiterRedis:r,RateLimiterMongo:s,RateLimiterMySQL:i,RateLimiterPostgres:o,RateLimiterMemory:u,RateLimiterMemcache:h,RateLimiterClusterMaster:a,RateLimiterClusterMasterPM2:c,RateLimiterCluster:l,RLWrapperBlackAndWhite:d,RateLimiterUnion:p,RateLimiterQueue:f,BurstyRateLimiter:g,RateLimiterRes:m}},548:function(e,t,n){const r=n(3120);e.exports=class{constructor(e,t){this._rateLimiter=e,this._burstLimiter=t}_combineRes(e,t){return new r(e.remainingPoints,Math.min(e.msBeforeNext,t.msBeforeNext),e.consumedPoints,e.isFirstInDuration)}consume(e,t=1,n={}){return this._rateLimiter.consume(e,t,n).catch((s=>s instanceof r?this._burstLimiter.consume(e,t,n).then((e=>Promise.resolve(this._combineRes(s,e)))).catch((e=>e instanceof r?Promise.reject(this._combineRes(s,e)):Promise.reject(e))):Promise.reject(s)))}get(e){return Promise.all([this._rateLimiter.get(e),this._burstLimiter.get(e)]).then((([e,t])=>this._combineRes(e,t)))}get points(){return this._rateLimiter.points}}},8913:function(e,t,n){const r=n(3120);e.exports=class{constructor(e={}){this.limiter=e.limiter,this.blackList=e.blackList,this.whiteList=e.whiteList,this.isBlackListed=e.isBlackListed,this.isWhiteListed=e.isWhiteListed,this.runActionAnyway=e.runActionAnyway}get limiter(){return this._limiter}set limiter(e){if("undefined"===typeof e)throw new Error("limiter is not set");this._limiter=e}get runActionAnyway(){return this._runActionAnyway}set runActionAnyway(e){this._runActionAnyway="undefined"!==typeof e&&e}get blackList(){return this._blackList}set blackList(e){this._blackList=Array.isArray(e)?e:[]}get isBlackListed(){return this._isBlackListed}set isBlackListed(e){if("undefined"===typeof e&&(e=()=>!1),"function"!==typeof e)throw new Error("isBlackListed must be function");this._isBlackListed=e}get whiteList(){return this._whiteList}set whiteList(e){this._whiteList=Array.isArray(e)?e:[]}get isWhiteListed(){return this._isWhiteListed}set isWhiteListed(e){if("undefined"===typeof e&&(e=()=>!1),"function"!==typeof e)throw new Error("isWhiteListed must be function");this._isWhiteListed=e}isBlackListedSomewhere(e){return this.blackList.indexOf(e)>=0||this.isBlackListed(e)}isWhiteListedSomewhere(e){return this.whiteList.indexOf(e)>=0||this.isWhiteListed(e)}getBlackRes(){return new r(0,Number.MAX_SAFE_INTEGER,0,!1)}getWhiteRes(){return new r(Number.MAX_SAFE_INTEGER,0,0,!1)}rejectBlack(){return Promise.reject(this.getBlackRes())}resolveBlack(){return Promise.resolve(this.getBlackRes())}resolveWhite(){return Promise.resolve(this.getWhiteRes())}consume(e,t=1){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.rejectBlack()),"undefined"===typeof n?this.limiter.consume(e,t):(this.runActionAnyway&&this.limiter.consume(e,t).catch((()=>{})),n)}block(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),"undefined"===typeof n?this.limiter.block(e,t):(this.runActionAnyway&&this.limiter.block(e,t).catch((()=>{})),n)}penalty(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),"undefined"===typeof n?this.limiter.penalty(e,t):(this.runActionAnyway&&this.limiter.penalty(e,t).catch((()=>{})),n)}reward(e,t){let n;return this.isWhiteListedSomewhere(e)?n=this.resolveWhite():this.isBlackListedSomewhere(e)&&(n=this.resolveBlack()),"undefined"===typeof n?this.limiter.reward(e,t):(this.runActionAnyway&&this.limiter.reward(e,t).catch((()=>{})),n)}get(e){let t;return this.isWhiteListedSomewhere(e)?t=this.resolveWhite():this.isBlackListedSomewhere(e)&&(t=this.resolveBlack()),"undefined"===typeof t||this.runActionAnyway?this.limiter.get(e):t}delete(e){return this.limiter.delete(e)}}},7083:function(e){e.exports=class{constructor(e={}){this.points=e.points,this.duration=e.duration,this.blockDuration=e.blockDuration,this.execEvenly=e.execEvenly,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs,this.keyPrefix=e.keyPrefix}get points(){return this._points}set points(e){this._points=e>=0?e:4}get duration(){return this._duration}set duration(e){this._duration="undefined"===typeof e?1:e}get msDuration(){return 1e3*this.duration}get blockDuration(){return this._blockDuration}set blockDuration(e){this._blockDuration="undefined"===typeof e?0:e}get msBlockDuration(){return 1e3*this.blockDuration}get execEvenly(){return this._execEvenly}set execEvenly(e){this._execEvenly="undefined"!==typeof e&&Boolean(e)}get execEvenlyMinDelayMs(){return this._execEvenlyMinDelayMs}set execEvenlyMinDelayMs(e){this._execEvenlyMinDelayMs="undefined"===typeof e?Math.ceil(this.msDuration/this.points):e}get keyPrefix(){return this._keyPrefix}set keyPrefix(e){if("undefined"===typeof e&&(e="rlflx"),"string"!==typeof e)throw new Error("keyPrefix must be string");this._keyPrefix=e}_getKeySecDuration(e={}){return e&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}consume(){throw new Error("You have to implement the method 'consume'!")}penalty(){throw new Error("You have to implement the method 'penalty'!")}reward(){throw new Error("You have to implement the method 'reward'!")}get(){throw new Error("You have to implement the method 'get'!")}set(){throw new Error("You have to implement the method 'set'!")}block(){throw new Error("You have to implement the method 'block'!")}delete(){throw new Error("You have to implement the method 'delete'!")}}},5734:function(e,t,n){const r=n(2500),s=n(3090),i=n(7083),o=n(239),a=n(3120),c="rate_limiter_flexible";let l=null;const u=function(e,t,n,r){let s;s=null===r||!0===r||!1===r?r:{remainingPoints:r.remainingPoints,msBeforeNext:r.msBeforeNext,consumedPoints:r.consumedPoints,isFirstInDuration:r.isFirstInDuration},e.send({channel:c,keyPrefix:t.keyPrefix,promiseId:t.promiseId,type:n,data:s})},h=function(e){setTimeout((()=>{this._initiated?process.send(e):"undefined"!==typeof this._promises[e.promiseId]&&h.call(this,e)}),30)},d=function(e,t,n,r,s){const i={channel:c,keyPrefix:this.keyPrefix,func:e,promiseId:t,data:{key:n,arg:r,opts:s}};this._initiated?process.send(i):h.call(this,i)},p=function(e,t){if(!t||t.channel!==c||"undefined"===typeof this._rateLimiters[t.keyPrefix])return!1;let n;switch(t.func){case"consume":n=this._rateLimiters[t.keyPrefix].consume(t.data.key,t.data.arg,t.data.opts);break;case"penalty":n=this._rateLimiters[t.keyPrefix].penalty(t.data.key,t.data.arg,t.data.opts);break;case"reward":n=this._rateLimiters[t.keyPrefix].reward(t.data.key,t.data.arg,t.data.opts);break;case"block":n=this._rateLimiters[t.keyPrefix].block(t.data.key,t.data.arg,t.data.opts);break;case"get":n=this._rateLimiters[t.keyPrefix].get(t.data.key,t.data.opts);break;case"delete":n=this._rateLimiters[t.keyPrefix].delete(t.data.key,t.data.opts);break;default:return!1}n&&n.then((n=>{u(e,t,"resolve",n)})).catch((n=>{u(e,t,"reject",n)}))},f=function(e){if(!e||e.channel!==c||e.keyPrefix!==this.keyPrefix)return!1;if(this._promises[e.promiseId]){let t;switch(clearTimeout(this._promises[e.promiseId].timeoutId),t=null===e.data||!0===e.data||!1===e.data?e.data:new a(e.data.remainingPoints,e.data.msBeforeNext,e.data.consumedPoints,e.data.isFirstInDuration),e.type){case"resolve":this._promises[e.promiseId].resolve(t);break;case"reject":this._promises[e.promiseId].reject(t);break;default:throw new Error(`RateLimiterCluster: no such message type '${e.type}'`)}delete this._promises[e.promiseId]}},g=function(){return{points:this.points,duration:this.duration,blockDuration:this.blockDuration,execEvenly:this.execEvenly,execEvenlyMinDelayMs:this.execEvenlyMinDelayMs,keyPrefix:this.keyPrefix}},m=function(e,t){const n=process.hrtime();let r=n[0].toString()+n[1].toString();return"undefined"!==typeof this._promises[r]&&(r+=s.randomBytes(12).toString("base64")),this._promises[r]={resolve:e,reject:t,timeoutId:setTimeout((()=>{delete this._promises[r],t(new Error("RateLimiterCluster timeout: no answer from master in time"))}),this.timeoutMs)},r};class y{constructor(){if(l)return l;this._rateLimiters={},r.setMaxListeners(0),r.on("message",((e,t)=>{t&&t.channel===c&&"init"===t.type?("undefined"===typeof this._rateLimiters[t.opts.keyPrefix]&&(this._rateLimiters[t.opts.keyPrefix]=new o(t.opts)),e.send({channel:c,type:"init",keyPrefix:t.opts.keyPrefix})):p.call(this,e,t)})),l=this}}class w{constructor(e){if(l)return l;this._rateLimiters={},e.launchBus(((t,n)=>{n.on("process:msg",(t=>{const n=t.raw;if(n&&n.channel===c&&"init"===n.type)"undefined"===typeof this._rateLimiters[n.opts.keyPrefix]&&(this._rateLimiters[n.opts.keyPrefix]=new o(n.opts)),e.sendDataToProcessId(t.process.pm_id,{data:{},topic:c,channel:c,type:"init",keyPrefix:n.opts.keyPrefix},((e,t)=>{e&&console.log(e,t)}));else{const r={send:n=>{const r=n;r.topic=c,"undefined"===typeof r.data&&(r.data={}),e.sendDataToProcessId(t.process.pm_id,r,((e,t)=>{e&&console.log(e,t)}))}};p.call(this,r,n)}}))})),l=this}}class b extends i{get timeoutMs(){return this._timeoutMs}set timeoutMs(e){this._timeoutMs="undefined"===typeof e?5e3:Math.abs(parseInt(e))}constructor(e={}){super(e),process.setMaxListeners(0),this.timeoutMs=e.timeoutMs,this._initiated=!1,process.on("message",(e=>{e&&e.channel===c&&"init"===e.type&&e.keyPrefix===this.keyPrefix?this._initiated=!0:f.call(this,e)})),process.send({channel:c,type:"init",opts:g.call(this)}),this._promises={}}consume(e,t=1,n={}){return new Promise(((r,s)=>{const i=m.call(this,r,s);d.call(this,"consume",i,e,t,n)}))}penalty(e,t=1,n={}){return new Promise(((r,s)=>{const i=m.call(this,r,s);d.call(this,"penalty",i,e,t,n)}))}reward(e,t=1,n={}){return new Promise(((r,s)=>{const i=m.call(this,r,s);d.call(this,"reward",i,e,t,n)}))}block(e,t,n={}){return new Promise(((r,s)=>{const i=m.call(this,r,s);d.call(this,"block",i,e,t,n)}))}get(e,t={}){return new Promise(((n,r)=>{const s=m.call(this,n,r);d.call(this,"get",s,e,t)}))}delete(e,t={}){return new Promise(((n,r)=>{const s=m.call(this,n,r);d.call(this,"delete",s,e,t)}))}}e.exports={RateLimiterClusterMaster:y,RateLimiterClusterMasterPM2:w,RateLimiterCluster:b}},607:function(e,t,n){const r=n(7591),s=n(3120);class i extends r{constructor(e){super(e),this.client=e.storeClient}_getRateLimiterRes(e,t,n){const r=new s;return r.consumedPoints=parseInt(n.consumedPoints),r.isFirstInDuration=n.consumedPoints===t,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=n.msBeforeNext,r}_upsert(e,t,n,r=!1,s={}){return new Promise(((i,o)=>{const a=Date.now(),c=Math.floor(n/1e3);r?this.client.set(e,t,c,(n=>{n?o(n):this.client.set(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{const e={consumedPoints:t,msBeforeNext:c>0?1e3*c:-1};i(e)}))})):this.client.incr(e,t,((l,u)=>{l||!1===u?this.client.add(e,t,c,((l,u)=>{if(l||!u)if("undefined"===typeof s.attemptNumber||s.attemptNumber<3){const a=Object.assign({},s);a.attemptNumber=a.attemptNumber?a.attemptNumber+1:1,this._upsert(e,t,n,r,a).then((e=>i(e))).catch((e=>o(e)))}else o(new Error("Can not add key"));else this.client.add(`${e}_expire`,c>0?a+1e3*c:-1,c,(()=>{const e={consumedPoints:t,msBeforeNext:c>0?1e3*c:-1};i(e)}))})):this.client.get(`${e}_expire`,((e,t)=>{if(e)o(e);else{const e=!1===t?0:t,n={consumedPoints:u,msBeforeNext:e>=0?Math.max(e-a,0):-1};i(n)}}))}))}))}_get(e){return new Promise(((t,n)=>{const r=Date.now();this.client.get(e,((s,i)=>{i?this.client.get(`${e}_expire`,((e,s)=>{if(e)n(e);else{const e=!1===s?0:s,n={consumedPoints:i,msBeforeNext:e>=0?Math.max(e-r,0):-1};t(n)}})):t(null)}))}))}_delete(e){return new Promise(((t,n)=>{this.client.del(e,((r,s)=>{r?n(r):!1===s?t(s):this.client.del(`${e}_expire`,(e=>{e?n(e):t(s)}))}))}))}}e.exports=i},239:function(e,t,n){const r=n(7083),s=n(6749),i=n(3120);class o extends r{constructor(e={}){super(e),this._memoryStorage=new s}consume(e,t=1,n={}){return new Promise(((r,s)=>{const i=this.getKey(e),o=this._getKeySecDuration(n);let a=this._memoryStorage.incrby(i,t,o);if(a.remainingPoints=Math.max(this.points-a.consumedPoints,0),a.consumedPoints>this.points)this.blockDuration>0&&a.consumedPoints<=this.points+t&&(a=this._memoryStorage.set(i,a.consumedPoints,this.blockDuration)),s(a);else if(this.execEvenly&&a.msBeforeNext>0&&!a.isFirstInDuration){let e=Math.ceil(a.msBeforeNext/(a.remainingPoints+2));e<this.execEvenlyMinDelayMs&&(e=a.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(r,e,a)}else r(a)}))}penalty(e,t=1,n={}){const r=this.getKey(e);return new Promise((e=>{const s=this._getKeySecDuration(n),i=this._memoryStorage.incrby(r,t,s);i.remainingPoints=Math.max(this.points-i.consumedPoints,0),e(i)}))}reward(e,t=1,n={}){const r=this.getKey(e);return new Promise((e=>{const s=this._getKeySecDuration(n),i=this._memoryStorage.incrby(r,-t,s);i.remainingPoints=Math.max(this.points-i.consumedPoints,0),e(i)}))}block(e,t){const n=1e3*t,r=this.points+1;return this._memoryStorage.set(this.getKey(e),r,t),Promise.resolve(new i(0,0===n?-1:n,r))}set(e,t,n){const r=1e3*(n>=0?n:this.duration);return this._memoryStorage.set(this.getKey(e),t,n),Promise.resolve(new i(0,0===r?-1:r,t))}get(e){const t=this._memoryStorage.get(this.getKey(e));return null!==t&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),Promise.resolve(t)}delete(e){return Promise.resolve(this._memoryStorage.delete(this.getKey(e)))}}e.exports=o},6886:function(e,t,n){const r=n(7591),s=n(3120);function i(e){try{const t=e.client?e.client:e,{version:n}=t.topology.s.options.metadata.driver,r=n.split(".").map((e=>parseInt(e)));return{major:r[0],feature:r[1],patch:r[2]}}catch(t){return{major:0,feature:0,patch:0}}}class o extends r{constructor(e){super(e),this.dbName=e.dbName,this.tableName=e.tableName,this.indexKeyPrefix=e.indexKeyPrefix,e.mongo?this.client=e.mongo:this.client=e.storeClient,"function"===typeof this.client.then?this.client.then((e=>{this.client=e,this._initCollection(),this._driverVersion=i(this.client)})):(this._initCollection(),this._driverVersion=i(this.client))}get dbName(){return this._dbName}set dbName(e){this._dbName="undefined"===typeof e?o.getDbName():e}static getDbName(){return"node-rate-limiter-flexible"}get tableName(){return this._tableName}set tableName(e){this._tableName="undefined"===typeof e?this.keyPrefix:e}get client(){return this._client}set client(e){if("undefined"===typeof e)throw new Error("mongo is not set");this._client=e}get indexKeyPrefix(){return this._indexKeyPrefix}set indexKeyPrefix(e){this._indexKeyPrefix=e||{}}_initCollection(){const e="function"===typeof this.client.db?this.client.db(this.dbName):this.client,t=e.collection(this.tableName);t.createIndex({expire:-1},{expireAfterSeconds:0}),t.createIndex(Object.assign({},this.indexKeyPrefix,{key:1}),{unique:!0}),this._collection=t}_getRateLimiterRes(e,t,n){const r=new s;let i;return i="undefined"===typeof n.value?n:n.value,r.isFirstInDuration=i.points===t,r.consumedPoints=i.points,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=null!==i.expire?Math.max(new Date(i.expire).getTime()-Date.now(),0):-1,r}_upsert(e,t,n,r=!1,s={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const i=s.attrs||{};let o,a;r?(o={key:e},o=Object.assign(o,i),a={$set:{key:e,points:t,expire:n>0?new Date(Date.now()+n):null}},a.$set=Object.assign(a.$set,i)):(o={$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}],key:e},o=Object.assign(o,i),a={$setOnInsert:{key:e,expire:n>0?new Date(Date.now()+n):null},$inc:{points:t}},a.$setOnInsert=Object.assign(a.$setOnInsert,i));const c={upsert:!0};return this._driverVersion.major>=4||3===this._driverVersion.major&&this._driverVersion.feature>=7||this._driverVersion.feature>=6&&this._driverVersion.patch>=7?c.returnDocument="after":c.returnOriginal=!1,new Promise(((s,l)=>{this._collection.findOneAndUpdate(o,a,c).then((e=>{s(e)})).catch((o=>{if(o&&11e3===o.code){const o=Object.assign({$or:[{expire:{$lte:new Date}},{expire:{$eq:null}}],key:e},i),a={$set:Object.assign({key:e,points:t,expire:n>0?new Date(Date.now()+n):null},i)};this._collection.findOneAndUpdate(o,a,c).then((e=>{s(e)})).catch((i=>{i&&11e3===i.code?this._upsert(e,t,n,r).then((e=>s(e))).catch((e=>l(e))):l(i)}))}else l(o)}))}))}_get(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const n=t.attrs||{},r=Object.assign({key:e,$or:[{expire:{$gt:new Date}},{expire:{$eq:null}}]},n);return this._collection.findOne(r)}_delete(e,t={}){if(!this._collection)return Promise.reject(Error("Mongo connection is not established"));const n=t.attrs||{},r=Object.assign({key:e},n);return this._collection.deleteOne(r).then((e=>e.deletedCount>0))}}e.exports=o},2187:function(e,t,n){const r=n(7591),s=n(3120);class i extends r{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.dbName=e.dbName,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?(this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"===typeof t&&t()):this._createDbAndTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"===typeof t&&t()})).catch((e=>{if("function"!==typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{this._getConnection().then((n=>{n.query("DELETE FROM ??.?? WHERE expire < ?",[this.dbName,this.tableName,e],(()=>{this._releaseConnection(n),t()}))})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return new Promise(((e,t)=>{this.client.getConnection(((n,r)=>{if(n)return t(n);e(r)}))}));case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return e.release();case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);default:return!0}}_createDbAndTable(){return new Promise(((e,t)=>{this._getConnection().then((n=>{n.query(`CREATE DATABASE IF NOT EXISTS \`${this.dbName}\`;`,(r=>{if(r)return this._releaseConnection(n),t(r);n.query(this._getCreateTableStmt(),(r=>{if(r)return this._releaseConnection(n),t(r);this._releaseConnection(n),e()}))}))})).catch((e=>{t(e)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS \`${this.dbName}\`.\`${this.tableName}\` (\`key\` VARCHAR(255) CHARACTER SET utf8 NOT NULL,\`points\` INT(9) NOT NULL default 0,\`expire\` BIGINT UNSIGNED,PRIMARY KEY (\`key\`)) ENGINE = INNODB;`}get clientType(){return this._clientType}set clientType(e){if("undefined"===typeof e)if("Connection"===this.client.constructor.name)e="connection";else if("Pool"===this.client.constructor.name)e="pool";else{if("Sequelize"!==this.client.constructor.name)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get dbName(){return this._dbName}set dbName(e){this._dbName="undefined"===typeof e?"rtlmtrflx":e}get tableName(){return this._tableName}set tableName(e){this._tableName="undefined"===typeof e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated="undefined"!==typeof e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout="undefined"===typeof e||Boolean(e)}_getRateLimiterRes(e,t,n){const r=new s,[i]=n;return r.isFirstInDuration=t===i.points,r.consumedPoints=r.isFirstInDuration?t:i.points,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,r}_upsertTransaction(e,t,n,r,s){return new Promise(((i,o)=>{e.query("BEGIN",(a=>{if(a)return e.rollback(),o(a);const c=Date.now(),l=r>0?c+r:null;let u,h;s?(u="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = ?, \n            expire = ?;",h=[this.dbName,this.tableName,t,n,l,n,l]):(u="INSERT INTO ??.?? VALUES (?, ?, ?)\n          ON DUPLICATE KEY UPDATE \n            points = IF(expire <= ?, ?, points + (?)), \n            expire = IF(expire <= ?, ?, expire);",h=[this.dbName,this.tableName,t,n,l,c,n,n,c,l]),e.query(u,h,(n=>{if(n)return e.rollback(),o(n);e.query("SELECT points, expire FROM ??.?? WHERE `key` = ?;",[this.dbName,this.tableName,t],((t,n)=>{if(t)return e.rollback(),o(t);e.query("COMMIT",(t=>{if(t)return e.rollback(),o(t);i(n)}))}))}))}))}))}_upsert(e,t,n,r=!1){return this.tableCreated?new Promise(((s,i)=>{this._getConnection().then((o=>{this._upsertTransaction(o,e,t,n,r).then((e=>{s(e),this._releaseConnection(o)})).catch((e=>{i(e),this._releaseConnection(o)}))})).catch((e=>{i(e)}))})):Promise.reject(Error("Table is not created yet"))}_get(e){return this.tableCreated?new Promise(((t,n)=>{this._getConnection().then((r=>{r.query("SELECT points, expire FROM ??.?? WHERE `key` = ? AND (`expire` > ? OR `expire` IS NULL)",[this.dbName,this.tableName,e,Date.now()],((e,s)=>{e?n(e):0===s.length?t(null):t(s),this._releaseConnection(r)}))})).catch((e=>{n(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?new Promise(((t,n)=>{this._getConnection().then((r=>{r.query("DELETE FROM ??.?? WHERE `key` = ?",[this.dbName,this.tableName,e],((e,s)=>{e?n(e):t(s.affectedRows>0),this._releaseConnection(r)}))})).catch((e=>{n(e)}))})):Promise.reject(Error("Table is not created yet"))}}e.exports=i},4240:function(e,t,n){const r=n(7591),s=n(3120);class i extends r{constructor(e,t=null){super(e),this.client=e.storeClient,this.clientType=e.storeType,this.tableName=e.tableName,this.clearExpiredByTimeout=e.clearExpiredByTimeout,this.tableCreated=e.tableCreated,this.tableCreated?"function"===typeof t&&t():this._createTable().then((()=>{this.tableCreated=!0,this.clearExpiredByTimeout&&this._clearExpiredHourAgo(),"function"===typeof t&&t()})).catch((e=>{if("function"!==typeof t)throw e;t(e)}))}clearExpired(e){return new Promise((t=>{const n={name:"rlflx-clear-expired",text:`DELETE FROM ${this.tableName} WHERE expire < $1`,values:[e]};this._query(n).then((()=>{t()})).catch((()=>{t()}))}))}_clearExpiredHourAgo(){this._clearExpiredTimeoutId&&clearTimeout(this._clearExpiredTimeoutId),this._clearExpiredTimeoutId=setTimeout((()=>{this.clearExpired(Date.now()-36e5).then((()=>{this._clearExpiredHourAgo()}))}),3e5),this._clearExpiredTimeoutId.unref()}_getConnection(){switch(this.clientType){case"pool":return Promise.resolve(this.client);case"sequelize":return this.client.connectionManager.getConnection();case"knex":return this.client.client.acquireConnection();case"typeorm":return Promise.resolve(this.client.driver.master);default:return Promise.resolve(this.client)}}_releaseConnection(e){switch(this.clientType){case"pool":return!0;case"sequelize":return this.client.connectionManager.releaseConnection(e);case"knex":return this.client.client.releaseConnection(e);case"typeorm":return!0;default:return!0}}_createTable(){return new Promise(((e,t)=>{this._query({text:this._getCreateTableStmt()}).then((()=>{e()})).catch((n=>{"23505"===n.code?e():t(n)}))}))}_getCreateTableStmt(){return`CREATE TABLE IF NOT EXISTS ${this.tableName} ( \n      key varchar(255) PRIMARY KEY,\n      points integer NOT NULL DEFAULT 0,\n      expire bigint\n    );`}get clientType(){return this._clientType}set clientType(e){const t=this.client.constructor.name;if("undefined"===typeof e)if("Client"===t)e="client";else if("Pool"===t||"BoundPool"===t)e="pool";else{if("Sequelize"!==t)throw new Error("storeType is not defined");e="sequelize"}this._clientType=e.toLowerCase()}get tableName(){return this._tableName}set tableName(e){this._tableName="undefined"===typeof e?this.keyPrefix:e}get tableCreated(){return this._tableCreated}set tableCreated(e){this._tableCreated="undefined"!==typeof e&&!!e}get clearExpiredByTimeout(){return this._clearExpiredByTimeout}set clearExpiredByTimeout(e){this._clearExpiredByTimeout="undefined"===typeof e||Boolean(e)}_getRateLimiterRes(e,t,n){const r=new s,i=n.rows[0];return r.isFirstInDuration=t===i.points,r.consumedPoints=r.isFirstInDuration?t:i.points,r.remainingPoints=Math.max(this.points-r.consumedPoints,0),r.msBeforeNext=i.expire?Math.max(i.expire-Date.now(),0):-1,r}_query(e){const t=this.tableName.toLowerCase(),n={name:`${t}:${e.name}`,text:e.text,values:e.values};return new Promise(((e,t)=>{this._getConnection().then((r=>{r.query(n).then((t=>{e(t),this._releaseConnection(r)})).catch((e=>{t(e),this._releaseConnection(r)}))})).catch((e=>{t(e)}))}))}_upsert(e,t,n,r=!1){if(!this.tableCreated)return Promise.reject(Error("Table is not created yet"));const s=n>0?Date.now()+n:null,i=r?" $3 ":` CASE\n             WHEN ${this.tableName}.expire <= $4 THEN $3\n             ELSE ${this.tableName}.expire\n            END `;return this._query({name:r?"rlflx-upsert-force":"rlflx-upsert",text:`\n            INSERT INTO ${this.tableName} VALUES ($1, $2, $3)\n              ON CONFLICT(key) DO UPDATE SET\n                points = CASE\n                          WHEN (${this.tableName}.expire <= $4 OR 1=${r?1:0}) THEN $2\n                          ELSE ${this.tableName}.points + ($2)\n                         END,\n                expire = ${i}\n            RETURNING points, expire;`,values:[e,t,s,Date.now()]})}_get(e){return this.tableCreated?new Promise(((t,n)=>{this._query({name:"rlflx-get",text:`\n            SELECT points, expire FROM ${this.tableName} WHERE key = $1 AND (expire > $2 OR expire IS NULL);`,values:[e,Date.now()]}).then((e=>{0===e.rowCount&&(e=null),t(e)})).catch((e=>{n(e)}))})):Promise.reject(Error("Table is not created yet"))}_delete(e){return this.tableCreated?this._query({name:"rlflx-delete",text:`DELETE FROM ${this.tableName} WHERE key = $1`,values:[e]}).then((e=>e.rowCount>0)):Promise.reject(Error("Table is not created yet"))}}e.exports=i},4420:function(e,t,n){n(7658),n(541);const r=n(9304),s=4294967295,i="limiter";e.exports=class{constructor(e,t={maxQueueSize:s}){this._queueLimiters={KEY_DEFAULT:new o(e,t)},this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(e=i){return this._queueLimiters[e]?this._queueLimiters[e].getTokensRemaining():Promise.resolve(this._limiterFlexible.points)}removeTokens(e,t=i){return this._queueLimiters[t]||(this._queueLimiters[t]=new o(this._limiterFlexible,{key:t,maxQueueSize:this._maxQueueSize})),this._queueLimiters[t].removeTokens(e)}};class o{constructor(e,t={maxQueueSize:s,key:i}){this._key=t.key,this._waitTimeout=null,this._queue=[],this._limiterFlexible=e,this._maxQueueSize=t.maxQueueSize}getTokensRemaining(){return this._limiterFlexible.get(this._key).then((e=>null!==e?e.remainingPoints:this._limiterFlexible.points))}removeTokens(e){const t=this;return new Promise(((n,s)=>{e>t._limiterFlexible.points?s(new r(`Requested tokens ${e} exceeds maximum ${t._limiterFlexible.points} tokens per interval`)):t._queue.length>0?t._queueRequest.call(t,n,s,e):t._limiterFlexible.consume(t._key,e).then((e=>{n(e.remainingPoints)})).catch((r=>{r instanceof Error?s(r):(t._queueRequest.call(t,n,s,e),null===t._waitTimeout&&(t._waitTimeout=setTimeout(t._processFIFO.bind(t),r.msBeforeNext)))}))}))}_queueRequest(e,t,n){const s=this;s._queue.length<s._maxQueueSize?s._queue.push({resolve:e,reject:t,tokens:n}):t(new r(`Number of requests reached it's maximum ${s._maxQueueSize}`))}_processFIFO(){const e=this;if(null!==e._waitTimeout&&(clearTimeout(e._waitTimeout),e._waitTimeout=null),0===e._queue.length)return;const t=e._queue.shift();e._limiterFlexible.consume(e._key,t.tokens).then((n=>{t.resolve(n.remainingPoints),e._processFIFO.call(e)})).catch((n=>{n instanceof Error?(t.reject(n),e._processFIFO.call(e)):(e._queue.unshift(t),null===e._waitTimeout&&(e._waitTimeout=setTimeout(e._processFIFO.bind(e),n.msBeforeNext)))}))}}},6269:function(e,t,n){const r=n(7591),s=n(3120),i="redis.call('set', KEYS[1], 0, 'EX', ARGV[2], 'NX') local consumed = redis.call('incrby', KEYS[1], ARGV[1]) local ttl = redis.call('pttl', KEYS[1]) if ttl == -1 then   redis.call('expire', KEYS[1], ARGV[2])   ttl = 1000 * ARGV[2] end return {consumed, ttl} ";class o extends r{constructor(e){super(e),e.redis?this.client=e.redis:this.client=e.storeClient,this._rejectIfRedisNotReady=!!e.rejectIfRedisNotReady,"function"===typeof this.client.defineCommand&&this.client.defineCommand("rlflxIncr",{numberOfKeys:1,lua:i})}_isRedisReady(){return!this._rejectIfRedisNotReady||(!this.client.status||"ready"===this.client.status)&&!("function"===typeof this.client.isReady&&!this.client.isReady())}_getRateLimiterRes(e,t,n){let[r,i]=n;Array.isArray(r)&&([,r]=r,[,i]=i);const o=new s;return o.consumedPoints=parseInt(r),o.isFirstInDuration=o.consumedPoints===t,o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.msBeforeNext=i,o}_upsert(e,t,n,r=!1){return new Promise(((s,o)=>{if(!this._isRedisReady())return o(new Error("Redis connection is not ready"));const a=Math.floor(n/1e3),c=this.client.multi();if(r)a>0?c.set(e,t,"EX",a):c.set(e,t),c.pttl(e).exec(((e,t)=>e?o(e):s(t)));else if(a>0){const n=function(e,t){return e?o(e):s(t)};"function"===typeof this.client.rlflxIncr?this.client.rlflxIncr(e,t,a,n):this.client.eval(i,1,e,t,a,n)}else c.incrby(e,t).pttl(e).exec(((e,t)=>e?o(e):s(t)))}))}_get(e){return new Promise(((t,n)=>{if(!this._isRedisReady())return n(new Error("Redis connection is not ready"));this.client.multi().get(e).pttl(e).exec(((e,r)=>{if(e)n(e);else{const[e]=r;if(null===e)return t(null);t(r)}}))}))}_delete(e){return new Promise(((t,n)=>{this.client.del(e,((e,r)=>{e?n(e):t(r>0)}))}))}}e.exports=o},3120:function(e){e.exports=class{constructor(e,t,n,r){this.remainingPoints="undefined"===typeof e?0:e,this.msBeforeNext="undefined"===typeof t?0:t,this.consumedPoints="undefined"===typeof n?0:n,this.isFirstInDuration="undefined"!==typeof r&&r}get msBeforeNext(){return this._msBeforeNext}set msBeforeNext(e){return this._msBeforeNext=e,this}get remainingPoints(){return this._remainingPoints}set remainingPoints(e){return this._remainingPoints=e,this}get consumedPoints(){return this._consumedPoints}set consumedPoints(e){return this._consumedPoints=e,this}get isFirstInDuration(){return this._isFirstInDuration}set isFirstInDuration(e){this._isFirstInDuration=Boolean(e)}_getDecoratedProperties(){return{remainingPoints:this.remainingPoints,msBeforeNext:this.msBeforeNext,consumedPoints:this.consumedPoints,isFirstInDuration:this.isFirstInDuration}}[Symbol.for("nodejs.util.inspect.custom")](){return this._getDecoratedProperties()}toString(){return JSON.stringify(this._getDecoratedProperties())}toJSON(){return this._getDecoratedProperties()}}},7591:function(e,t,n){const r=n(7083),s=n(462),i=n(3120);e.exports=class extends r{constructor(e={}){super(e),this.inMemoryBlockOnConsumed=e.inMemoryBlockOnConsumed||e.inmemoryBlockOnConsumed,this.inMemoryBlockDuration=e.inMemoryBlockDuration||e.inmemoryBlockDuration,this.insuranceLimiter=e.insuranceLimiter,this._inMemoryBlockedKeys=new s}get client(){return this._client}set client(e){if("undefined"===typeof e)throw new Error("storeClient is not set");this._client=e}_afterConsume(e,t,n,r,s,i={}){const o=this._getRateLimiterRes(n,r,s);if(this.inMemoryBlockOnConsumed>0&&!(this.inMemoryBlockDuration>0)&&o.consumedPoints>=this.inMemoryBlockOnConsumed)return this._inMemoryBlockedKeys.addMs(n,o.msBeforeNext),o.consumedPoints>this.points?t(o):e(o);if(o.consumedPoints>this.points){let e=Promise.resolve();this.blockDuration>0&&o.consumedPoints<=this.points+r&&(o.msBeforeNext=this.msBlockDuration,e=this._block(n,o.consumedPoints,this.msBlockDuration,i)),this.inMemoryBlockOnConsumed>0&&o.consumedPoints>=this.inMemoryBlockOnConsumed&&(this._inMemoryBlockedKeys.add(n,this.inMemoryBlockDuration),o.msBeforeNext=this.msInMemoryBlockDuration),e.then((()=>{t(o)})).catch((e=>{t(e)}))}else if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let t=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));t<this.execEvenlyMinDelayMs&&(t=o.consumedPoints*this.execEvenlyMinDelayMs),setTimeout(e,t,o)}else e(o)}_handleError(e,t,n,s,i,o=!1,a={}){this.insuranceLimiter instanceof r?this.insuranceLimiter[t](i,o,a).then((e=>{n(e)})).catch((e=>{s(e)})):s(e)}get _inmemoryBlockedKeys(){return this._inMemoryBlockedKeys}getInmemoryBlockMsBeforeExpire(e){return this.getInMemoryBlockMsBeforeExpire(e)}get inmemoryBlockOnConsumed(){return this.inMemoryBlockOnConsumed}set inmemoryBlockOnConsumed(e){this.inMemoryBlockOnConsumed=e}get inmemoryBlockDuration(){return this.inMemoryBlockDuration}set inmemoryBlockDuration(e){this.inMemoryBlockDuration=e}get msInmemoryBlockDuration(){return 1e3*this.inMemoryBlockDuration}getInMemoryBlockMsBeforeExpire(e){return this.inMemoryBlockOnConsumed>0?this._inMemoryBlockedKeys.msBeforeExpire(e):0}get inMemoryBlockOnConsumed(){return this._inMemoryBlockOnConsumed}set inMemoryBlockOnConsumed(e){if(this._inMemoryBlockOnConsumed=e?parseInt(e):0,this.inMemoryBlockOnConsumed>0&&this.points>this.inMemoryBlockOnConsumed)throw new Error('inMemoryBlockOnConsumed option must be greater or equal "points" option')}get inMemoryBlockDuration(){return this._inMemoryBlockDuration}set inMemoryBlockDuration(e){if(this._inMemoryBlockDuration=e?parseInt(e):0,this.inMemoryBlockDuration>0&&0===this.inMemoryBlockOnConsumed)throw new Error("inMemoryBlockOnConsumed option must be set up")}get msInMemoryBlockDuration(){return 1e3*this._inMemoryBlockDuration}get insuranceLimiter(){return this._insuranceLimiter}set insuranceLimiter(e){if("undefined"!==typeof e&&!(e instanceof r))throw new Error("insuranceLimiter must be instance of RateLimiterAbstract");this._insuranceLimiter=e,this._insuranceLimiter&&(this._insuranceLimiter.blockDuration=this.blockDuration,this._insuranceLimiter.execEvenly=this.execEvenly)}block(e,t,n={}){const r=1e3*t;return this._block(this.getKey(e),this.points+1,r,n)}set(e,t,n,r={}){const s=1e3*(n>=0?n:this.duration);return this._block(this.getKey(e),t,s,r)}consume(e,t=1,n={}){return new Promise(((r,s)=>{const o=this.getKey(e),a=this.getInMemoryBlockMsBeforeExpire(o);if(a>0)return s(new i(0,a));this._upsert(o,t,1e3*this._getKeySecDuration(n),!1,n).then((e=>{this._afterConsume(r,s,o,t,e)})).catch((i=>{this._handleError(i,"consume",r,s,e,t,n)}))}))}penalty(e,t=1,n={}){const r=this.getKey(e);return new Promise(((s,i)=>{this._upsert(r,t,1e3*this._getKeySecDuration(n),!1,n).then((e=>{s(this._getRateLimiterRes(r,t,e))})).catch((r=>{this._handleError(r,"penalty",s,i,e,t,n)}))}))}reward(e,t=1,n={}){const r=this.getKey(e);return new Promise(((s,i)=>{this._upsert(r,-t,1e3*this._getKeySecDuration(n),!1,n).then((e=>{s(this._getRateLimiterRes(r,-t,e))})).catch((r=>{this._handleError(r,"reward",s,i,e,t,n)}))}))}get(e,t={}){const n=this.getKey(e);return new Promise(((r,s)=>{this._get(n,t).then((e=>{r(null===e||"undefined"===typeof e?null:this._getRateLimiterRes(n,0,e))})).catch((n=>{this._handleError(n,"get",r,s,e,t)}))}))}delete(e,t={}){const n=this.getKey(e);return new Promise(((r,s)=>{this._delete(n,t).then((e=>{this._inMemoryBlockedKeys.delete(n),r(e)})).catch((n=>{this._handleError(n,"delete",r,s,e,t)}))}))}deleteInMemoryBlockedAll(){this._inMemoryBlockedKeys.delete()}_getRateLimiterRes(e,t,n){throw new Error("You have to implement the method '_getRateLimiterRes'!")}_block(e,t,n,r={}){return new Promise(((s,o)=>{this._upsert(e,t,n,!0,r).then((()=>{s(new i(0,n>0?n:-1,t))})).catch((t=>{this._handleError(t,"block",s,o,this.parseKey(e),n/1e3,r)}))}))}_get(e,t={}){throw new Error("You have to implement the method '_get'!")}_delete(e,t={}){throw new Error("You have to implement the method '_delete'!")}_upsert(e,t,n,r=!1,s={}){throw new Error("You have to implement the method '_upsert'!")}}},3988:function(e,t,n){n(7658);const r=n(7083);e.exports=class{constructor(...e){if(e.length<1)throw new Error("RateLimiterUnion: at least one limiter have to be passed");e.forEach((e=>{if(!(e instanceof r))throw new Error("RateLimiterUnion: all limiters have to be instance of RateLimiterAbstract")})),this._limiters=e}consume(e,t=1){return new Promise(((n,r)=>{const s=[];this._limiters.forEach((n=>{s.push(n.consume(e,t).catch((e=>({rejected:!0,rej:e}))))})),Promise.all(s).then((e=>{const t={};let s=!1;e.forEach((e=>{!0===e.rejected&&(s=!0)}));for(let n=0;n<e.length;n++)s&&!0===e[n].rejected?t[this._limiters[n].keyPrefix]=e[n].rej:s||(t[this._limiters[n].keyPrefix]=e[n]);s?r(t):n(t)}))}))}}},950:function(e){e.exports=class{constructor(){this._keys={},this._addedKeysAmount=0}collectExpired(){const e=Date.now();Object.keys(this._keys).forEach((t=>{this._keys[t]<=e&&delete this._keys[t]})),this._addedKeysAmount=Object.keys(this._keys).length}add(e,t){this.addMs(e,1e3*t)}addMs(e,t){this._keys[e]=Date.now()+t,this._addedKeysAmount++,this._addedKeysAmount>999&&this.collectExpired()}msBeforeExpire(e){const t=this._keys[e];if(t&&t>=Date.now()){this.collectExpired();const e=Date.now();return t>=e?t-e:0}return 0}delete(e){e?delete this._keys[e]:Object.keys(this._keys).forEach((e=>{delete this._keys[e]}))}}},462:function(e,t,n){const r=n(950);e.exports=r},6749:function(e,t,n){const r=n(772),s=n(3120);e.exports=class{constructor(){this._storage={}}incrby(e,t,n){if(this._storage[e]){const r=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return 0!==r?(this._storage[e].value=this._storage[e].value+t,new s(0,r,this._storage[e].value,!1)):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=1e3*n;return this._storage[e]&&this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),this._storage[e]=new r(t,i>0?new Date(Date.now()+i):null),i>0&&(this._storage[e].timeoutId=setTimeout((()=>{delete this._storage[e]}),i),this._storage[e].timeoutId.unref&&this._storage[e].timeoutId.unref()),new s(0,0===i?-1:i,this._storage[e].value,!0)}get(e){if(this._storage[e]){const t=this._storage[e].expiresAt?this._storage[e].expiresAt.getTime()-(new Date).getTime():-1;return new s(0,t,this._storage[e].value,!1)}return null}delete(e){return!!this._storage[e]&&(this._storage[e].timeoutId&&clearTimeout(this._storage[e].timeoutId),delete this._storage[e],!0)}}},772:function(e){e.exports=class{constructor(e,t,n=null){this.value=e,this.expiresAt=t,this.timeoutId=n}get value(){return this._value}set value(e){this._value=parseInt(e)}get expiresAt(){return this._expiresAt}set expiresAt(e){e instanceof Date||!Number.isInteger(e)||(e=new Date(e)),this._expiresAt=e}get timeoutId(){return this._timeoutId}set timeoutId(e){this._timeoutId=e}}},9304:function(e){e.exports=class extends Error{constructor(e,t){super(),Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.name="CustomError",this.message=e,t&&(this.extra=t)}}},3707:function(e,t,n){"use strict";n(7658),e.exports=a;var r=n(8806),s=a.prototype,i=new Date%1e9;function o(){return(1e9*Math.random()>>>0)+i++}function a(e){e=e||{},this.id=e.id||o(),this.max=e.max||1/0,this.items=e.items||[],this._lookup={},this.size=this.items.length,this.lastModified=new Date(e.lastModified||new Date);for(var t,n,r=this.items.length;r--;)t=this.items[r],n=new Date(t.expires)-new Date,this._lookup[t.key]=t,n>0?this.expire(t.key,n):n<=0&&this.delete(t.key)}s.has=function(e){return e in this._lookup},s.get=function(e){if(!this.has(e))return null;var t=this._lookup[e];return t.refresh&&this.expire(e,t.refresh),this.items.splice(this.items.indexOf(t),1),this.items.push(t),t.value},s.meta=function(e){if(!this.has(e))return null;var t=this._lookup[e];return"meta"in t?t.meta:null},s.set=function(e,t,n){var r=this._lookup[e],s=this._lookup[e]={key:e,value:t};return this.lastModified=new Date,r?(clearTimeout(r.timeout),this.items.splice(this.items.indexOf(r),1,s)):(this.size>=this.max&&this.delete(this.items[0].key),this.items.push(s),this.size++),n&&("ttl"in n&&this.expire(e,n.ttl),"meta"in n&&(s.meta=n.meta),n.refresh&&(s.refresh=n.ttl)),this},s.delete=function(e){var t=this._lookup[e];return!!t&&(this.lastModified=new Date,this.items.splice(this.items.indexOf(t),1),clearTimeout(t.timeout),delete this._lookup[e],this.size--,this)},s.expire=function(e,t){var n=t||0,s=this._lookup[e];if(!s)return this;if("string"===typeof n&&(n=r(t)),"number"!==typeof n)throw new TypeError("Expiration time must be a string or number.");return clearTimeout(s.timeout),s.timeout=setTimeout(this.delete.bind(this,s.key),n),s.expires=Number(new Date)+n,this},s.clear=function(){for(var e=this.items.length;e--;)this.delete(this.items[e].key);return this},s.toJSON=function(){for(var e,t=new Array(this.items.length),n=t.length;n--;)e=this.items[n],t[n]={key:e.key,meta:e.meta,value:e.value,expires:e.expires,refresh:e.refresh};return{id:this.id,max:isFinite(this.max)?this.max:void 0,lastModified:this.lastModified,items:t}}},5748:function(e,t,n){"use strict";const r=n(612);class s{constructor(e,t,n){const s=this;this._started=r(),this._rescheduled=0,this._scheduled=t,this._args=n,this._triggered=!1,this._timerWrapper=()=>{s._rescheduled>0?(s._scheduled=s._rescheduled-(r()-s._started),s._schedule(s._scheduled)):(s._triggered=!0,e.apply(null,s._args))},this._timer=setTimeout(this._timerWrapper,t)}reschedule(e){e||(e=this._scheduled);const t=r();t+e-(this._started+this._scheduled)<0?(clearTimeout(this._timer),this._schedule(e)):this._triggered?this._schedule(e):(this._started=t,this._rescheduled=e)}_schedule(e){this._triggered=!1,this._started=r(),this._rescheduled=0,this._scheduled=e,this._timer=setTimeout(this._timerWrapper,e)}clear(){clearTimeout(this._timer)}}function i(){if("function"!==typeof arguments[0])throw new Error("callback needed");if("number"!==typeof arguments[1])throw new Error("timeout needed");let e;if(arguments.length>0){e=new Array(arguments.length-2);for(var t=0;t<e.length;t++)e[t]=arguments[t+2]}return new s(arguments[0],arguments[1],e)}e.exports=i},612:function(e){"use strict";e.exports=function(){return Date.now()}},8250:function(e,t,n){
/*! run-parallel-limit. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.exports=s;const r=n(6486);function s(e,t,n){if("number"!==typeof t)throw new Error("second argument must be a Number");let s,i,o,a,c,l,u=!0;function h(e){function t(){n&&n(e,s),n=null}u?r(t):t()}function d(t,n,r){if(s[t]=r,n&&(c=!0),0===--o||n)h(n);else if(!c&&l<i){let t;a?(t=a[l],l+=1,e[t]((function(e,n){d(t,e,n)}))):(t=l,l+=1,e[t]((function(e,n){d(t,e,n)})))}}Array.isArray(e)?(s=[],o=i=e.length):(a=Object.keys(e),s={},o=i=a.length),l=t,o?a?a.some((function(n,r){return e[n]((function(e,t){d(n,e,t)})),r===t-1})):e.some((function(e,n){return e((function(e,t){d(n,e,t)})),n===t-1})):h(null),u=!1}},1989:function(e,t,n){
/*! safe-buffer. MIT License. Feross Aboukhadijeh <https://feross.org/opensource> */
var r=n(911),s=r.Buffer;function i(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return s(e,t,n)}s.from&&s.alloc&&s.allocUnsafe&&s.allocUnsafeSlow?e.exports=r:(i(r,t),t.Buffer=o),o.prototype=Object.create(s.prototype),i(s,o),o.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return s(e,t,n)},o.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var r=s(e);return void 0!==t?"string"===typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return s(e)},o.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},4203:function(e,t,n){"use strict";var r=n(4970),s=/[\/\?<>\\:\*\|"]/g,i=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,a=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,c=/[\. ]+$/;function l(e,t){if("string"!==typeof e)throw new Error("Input must be string");var n=e.replace(s,t).replace(i,t).replace(o,t).replace(a,t).replace(c,t);return r(n,255)}e.exports=function(e,t){var n=t&&t.replacement||"",r=l(e,n);return""===n?r:l(r,"")}},7550:function(e){"use strict";const t=new Map,n=()=>`${Date.now()}:${Math.floor(1e6*Math.random())}`;async function r(e,n,r){while(t.get(r)){try{await e()}catch(s){setTimeout((()=>{throw s}),1);break}if(!t.get(r))break;await new Promise((e=>{const s=setTimeout(e,n);t.set(r,s)}))}}function s(e,s,i){i=i||s;const o=n(),a=setTimeout((()=>{r(e,s,o)}),i);return t.set(o,a),o}function i(e){const n=t.get(e);n&&(clearTimeout(n),t.delete(e))}e.exports={setDelayedInterval:s,clearDelayedInterval:i}},9963:function(e,t,n){"use strict";n(7658),n(541);const r=7;function s(e,t){return e+i(t)}function i(e){let t=e;return t-=t>>1&1431655765,t=(858993459&t)+(t>>2&858993459),16843009*(t+(t>>4)&252645135)>>24}function o(e,t){return e[0]-t[0]}function a(e){return e[1]}e.exports=class{constructor(){this._bitArrays=[],this._data=[],this._length=0,this._changedLength=!1,this._changedData=!1}set(e,t){let n=this._internalPositionFor(e,!1);if(void 0===t)-1!==n&&(this._unsetInternalPos(n),this._unsetBit(e),this._changedLength=!0,this._changedData=!0);else{let r=!1;-1===n?(n=this._data.length,this._setBit(e),this._changedData=!0):r=!0,this._setInternalPos(n,e,t,r),this._changedLength=!0}}unset(e){this.set(e,void 0)}get(e){this._sortData();const t=this._internalPositionFor(e,!0);if(-1!==t)return this._data[t][1]}push(e){return this.set(this.length,e),this.length}get length(){if(this._sortData(),this._changedLength){const e=this._data[this._data.length-1];this._length=e?e[0]+1:0,this._changedLength=!1}return this._length}forEach(e){let t=0;while(t<this.length)e(this.get(t),t,this),t++}map(e){let t=0,n=new Array(this.length);while(t<this.length)n[t]=e(this.get(t),t,this),t++;return n}reduce(e,t){let n=0,r=t;while(n<this.length){const t=this.get(n);r=e(r,t,n),n++}return r}find(e){let t,n,r=0;while(r<this.length&&!t)n=this.get(r),t=e(n),r++;return t?n:void 0}_internalPositionFor(e,t){const n=this._bytePosFor(e,t);if(n>=this._bitArrays.length)return-1;const o=this._bitArrays[n],a=e-n*r,c=(o&1<<a)>0;if(!c)return-1;const l=this._bitArrays.slice(0,n).reduce(s,0),u=~(4294967295<<a+1),h=i(o&u),d=l+h-1;return d}_bytePosFor(e,t){const n=Math.floor(e/r),s=n+1;while(!t&&this._bitArrays.length<s)this._bitArrays.push(0);return n}_setBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]|=1<<e-t*r}_unsetBit(e){const t=this._bytePosFor(e,!1);this._bitArrays[t]&=~(1<<e-t*r)}_setInternalPos(e,t,n,r){const s=this._data,i=[t,n];if(r)this._sortData(),s[e]=i;else{if(s.length)if(s[s.length-1][0]>=t)s.push(i);else if(s[0][0]<=t)s.unshift(i);else{const e=Math.round(s.length/2);this._data=s.slice(0,e).concat(i).concat(s.slice(e))}else this._data.push(i);this._changedData=!0,this._changedLength=!0}}_unsetInternalPos(e){this._data.splice(e,1)}_sortData(){this._changedData&&this._data.sort(o),this._changedData=!1}bitField(){const e=[];let t,n=8,r=0,s=0;const i=this._bitArrays.slice();while(i.length||r){0===r&&(t=i.shift(),r=7);const o=Math.min(r,n),a=~(255<<o),c=t&a;s|=c<<8-n,t>>>=o,r-=o,n-=o,n&&(r||i.length)||(e.push(s),s=0,n=8)}for(var o=e.length-1;o>0;o--){const t=e[o];if(0!==t)break;e.pop()}return e}compactArray(){return this._sortData(),this._data.map(a)}}},1128:function(e){e.exports=e=>{if(e[Symbol.asyncIterator])return e;if(e.getReader)return async function*(){const t=e.getReader();try{while(1){const{done:e,value:n}=await t.read();if(e)return;yield n}}finally{t.releaseLock()}}();throw new Error("unknown stream")}},8957:function(e,t,n){"use strict";const{AbortController:r}=globalThis,s=n(5748);class i extends r{constructor(e){super(),this._ms=e,this._timer=s((()=>this.abort()),e),Object.setPrototypeOf(this,i.prototype)}abort(){return this._timer.clear(),super.abort()}clear(){this._timer.clear()}reset(){this._timer.clear(),this._timer=s((()=>this.abort()),this._ms)}}e.exports={TimeoutController:i}},4970:function(e,t,n){"use strict";var r=n(2636),s=n(6903);e.exports=r.bind(null,s)},2636:function(e){"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e,r,s){if("string"!==typeof r)throw new Error("Input must be string");for(var i,o,a=r.length,c=0,l=0;l<a;l+=1){if(i=r.charCodeAt(l),o=r[l],t(i)&&n(r.charCodeAt(l+1))&&(l+=1,o+=r[l]),c+=e(o),c===s)return r.slice(0,l+1);if(c>s)return r.slice(0,l-o.length+1)}return r}},6903:function(e){"use strict";function t(e){return e>=55296&&e<=56319}function n(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!==typeof e)throw new Error("Input must be string");for(var r=e.length,s=0,i=null,o=null,a=0;a<r;a++)i=e.charCodeAt(a),n(i)?null!=o&&t(o)?s+=1:s+=3:i<=127?s+=1:i>=128&&i<=2047?s+=2:i>=2048&&i<=65535&&(s+=3),o=i;return s}},5717:function(e){e.exports=r;var t=128,n=127;function r(e,s){var i,o=0,a=(s=s||0,0),c=s,l=e.length;do{if(c>=l)throw r.bytes=0,new RangeError("Could not decode varint");i=e[c++],o+=a<28?(i&n)<<a:(i&n)*Math.pow(2,a),a+=7}while(i>=t);return r.bytes=c-s,o}},2498:function(e){e.exports=i;var t=128,n=127,r=~n,s=Math.pow(2,31);function i(e,n,o){n=n||[],o=o||0;var a=o;while(e>=s)n[o++]=255&e|t,e/=128;while(e&r)n[o++]=255&e|t,e>>>=7;return n[o]=0|e,i.bytes=o-a+1,n}},8419:function(e,t,n){e.exports={encode:n(2498),decode:n(5717),encodingLength:n(3649)}},3649:function(e){var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<l?9:10}},1962:function(e,t,n){"use strict";n(3767),n(8585),n(8696),n(7658);const r=n(8419);e.exports=e=>{if(!(e instanceof Uint8Array))throw new Error("arg needs to be a Uint8Array");const t=[];while(e.length>0){const n=r.decode(e);t.push(n),e=e.slice(r.decode.bytes)}return t}},9738:function(e){e.exports=r;var t=128,n=127;function r(e,s){var i,o=0,a=(s=s||0,0),c=s,l=e.length;do{if(c>=l||a>49)throw r.bytes=0,new RangeError("Could not decode varint");i=e[c++],o+=a<28?(i&n)<<a:(i&n)*Math.pow(2,a),a+=7}while(i>=t);return r.bytes=c-s,o}},1736:function(e){e.exports=i;var t=128,n=127,r=~n,s=Math.pow(2,31);function i(e,n,o){if(Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw i.bytes=0,new RangeError("Could not encode varint");n=n||[],o=o||0;var a=o;while(e>=s)n[o++]=255&e|t,e/=128;while(e&r)n[o++]=255&e|t,e>>>=7;return n[o]=0|e,i.bytes=o-a+1,n}},1786:function(e,t,n){e.exports={encode:n(1736),decode:n(9738),encodingLength:n(948)}},948:function(e){var t=Math.pow(2,7),n=Math.pow(2,14),r=Math.pow(2,21),s=Math.pow(2,28),i=Math.pow(2,35),o=Math.pow(2,42),a=Math.pow(2,49),c=Math.pow(2,56),l=Math.pow(2,63);e.exports=function(e){return e<t?1:e<n?2:e<r?3:e<s?4:e<i?5:e<o?6:e<a?7:e<c?8:e<l?9:10}},4870:function(e,t,n){"use strict";n.d(t,{B:function(){return o},Bj:function(){return i},Fl:function(){return Ye},IU:function(){return xe},Jd:function(){return A},PG:function(){return Ce},SU:function(){return ze},Um:function(){return ke},WL:function(){return He},X$:function(){return R},X3:function(){return Oe},XI:function(){return Ve},Xl:function(){return Ne},ZM:function(){return qe},dq:function(){return Be},iH:function(){return Ue},j:function(){return C},lk:function(){return T},nZ:function(){return c},qj:function(){return Se},qq:function(){return E},yT:function(){return Re}});n(7658);var r=n(7139);let s;class i{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this.parent=s,!e&&s&&(this.index=(s.scopes||(s.scopes=[])).push(this)-1)}get active(){return this._active}run(e){if(this._active){const t=s;try{return s=this,e()}finally{s=t}}else 0}on(){s=this}off(){s=this.parent}stop(e){if(this._active){let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.scopes)for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);if(!this.detached&&this.parent&&!e){const e=this.parent.scopes.pop();e&&e!==this&&(this.parent.scopes[this.index]=e,e.index=this.index)}this.parent=void 0,this._active=!1}}}function o(e){return new i(e)}function a(e,t=s){t&&t.active&&t.effects.push(e)}function c(){return s}const l=e=>{const t=new Set(e);return t.w=0,t.n=0,t},u=e=>(e.w&m)>0,h=e=>(e.n&m)>0,d=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=m},p=e=>{const{deps:t}=e;if(t.length){let n=0;for(let r=0;r<t.length;r++){const s=t[r];u(s)&&!h(s)?s.delete(e):t[n++]=s,s.w&=~m,s.n&=~m}t.length=n}},f=new WeakMap;let g=0,m=1;const y=30;let w;const b=Symbol(""),v=Symbol("");class E{constructor(e,t=null,n){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,a(this,n)}run(){if(!this.active)return this.fn();let e=w,t=S;while(e){if(e===this)return;e=e.parent}try{return this.parent=w,w=this,S=!0,m=1<<++g,g<=y?d(this):_(this),this.fn()}finally{g<=y&&p(this),m=1<<--g,w=this.parent,S=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){w===this?this.deferStop=!0:this.active&&(_(this),this.onStop&&this.onStop(),this.active=!1)}}function _(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let S=!0;const k=[];function A(){k.push(S),S=!1}function T(){const e=k.pop();S=void 0===e||e}function C(e,t,n){if(S&&w){let t=f.get(e);t||f.set(e,t=new Map);let r=t.get(n);r||t.set(n,r=l());const s=void 0;I(r,s)}}function I(e,t){let n=!1;g<=y?h(e)||(e.n|=m,n=!u(e)):n=!e.has(w),n&&(e.add(w),w.deps.push(e))}function R(e,t,n,s,i,o){const a=f.get(e);if(!a)return;let c=[];if("clear"===t)c=[...a.values()];else if("length"===n&&(0,r.kJ)(e)){const e=Number(s);a.forEach(((t,n)=>{("length"===n||n>=e)&&c.push(t)}))}else switch(void 0!==n&&c.push(a.get(n)),t){case"add":(0,r.kJ)(e)?(0,r.S0)(n)&&c.push(a.get("length")):(c.push(a.get(b)),(0,r._N)(e)&&c.push(a.get(v)));break;case"delete":(0,r.kJ)(e)||(c.push(a.get(b)),(0,r._N)(e)&&c.push(a.get(v)));break;case"set":(0,r._N)(e)&&c.push(a.get(b));break}if(1===c.length)c[0]&&O(c[0]);else{const e=[];for(const t of c)t&&e.push(...t);O(l(e))}}function O(e,t){const n=(0,r.kJ)(e)?e:[...e];for(const r of n)r.computed&&x(r,t);for(const r of n)r.computed||x(r,t)}function x(e,t){(e!==w||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const N=(0,r.fY)("__proto__,__v_isRef,__isVue"),D=new Set(Object.getOwnPropertyNames(Symbol).filter((e=>"arguments"!==e&&"caller"!==e)).map((e=>Symbol[e])).filter(r.yk)),P=F(),L=F(!1,!0),M=F(!0),B=U();function U(){const e={};return["includes","indexOf","lastIndexOf"].forEach((t=>{e[t]=function(...e){const n=xe(this);for(let t=0,s=this.length;t<s;t++)C(n,"get",t+"");const r=n[t](...e);return-1===r||!1===r?n[t](...e.map(xe)):r}})),["push","pop","shift","unshift","splice"].forEach((t=>{e[t]=function(...e){A();const n=xe(this)[t].apply(this,e);return T(),n}})),e}function V(e){const t=xe(this);return C(t,"has",e),t.hasOwnProperty(e)}function F(e=!1,t=!1){return function(n,s,i){if("__v_isReactive"===s)return!e;if("__v_isReadonly"===s)return e;if("__v_isShallow"===s)return t;if("__v_raw"===s&&i===(e?t?ve:be:t?we:ye).get(n))return n;const o=(0,r.kJ)(n);if(!e){if(o&&(0,r.RI)(B,s))return Reflect.get(B,s,i);if("hasOwnProperty"===s)return V}const a=Reflect.get(n,s,i);return((0,r.yk)(s)?D.has(s):N(s))?a:(e||C(n,"get",s),t?a:Be(a)?o&&(0,r.S0)(s)?a:a.value:(0,r.Kn)(a)?e?Ae(a):Se(a):a)}}const j=$(),z=$(!0);function $(e=!1){return function(t,n,s,i){let o=t[n];if(Ie(o)&&Be(o)&&!Be(s))return!1;if(!e&&(Re(s)||Ie(s)||(o=xe(o),s=xe(s)),!(0,r.kJ)(t)&&Be(o)&&!Be(s)))return o.value=s,!0;const a=(0,r.kJ)(t)&&(0,r.S0)(n)?Number(n)<t.length:(0,r.RI)(t,n),c=Reflect.set(t,n,s,i);return t===xe(i)&&(a?(0,r.aU)(s,o)&&R(t,"set",n,s,o):R(t,"add",n,s)),c}}function H(e,t){const n=(0,r.RI)(e,t),s=e[t],i=Reflect.deleteProperty(e,t);return i&&n&&R(e,"delete",t,void 0,s),i}function K(e,t){const n=Reflect.has(e,t);return(0,r.yk)(t)&&D.has(t)||C(e,"has",t),n}function q(e){return C(e,"iterate",(0,r.kJ)(e)?"length":b),Reflect.ownKeys(e)}const G={get:P,set:j,deleteProperty:H,has:K,ownKeys:q},W={get:M,set(e,t){return!0},deleteProperty(e,t){return!0}},Y=(0,r.l7)({},G,{get:L,set:z}),J=e=>e,Q=e=>Reflect.getPrototypeOf(e);function X(e,t,n=!1,r=!1){e=e["__v_raw"];const s=xe(e),i=xe(t);n||(t!==i&&C(s,"get",t),C(s,"get",i));const{has:o}=Q(s),a=r?J:n?Pe:De;return o.call(s,t)?a(e.get(t)):o.call(s,i)?a(e.get(i)):void(e!==s&&e.get(t))}function Z(e,t=!1){const n=this["__v_raw"],r=xe(n),s=xe(e);return t||(e!==s&&C(r,"has",e),C(r,"has",s)),e===s?n.has(e):n.has(e)||n.has(s)}function ee(e,t=!1){return e=e["__v_raw"],!t&&C(xe(e),"iterate",b),Reflect.get(e,"size",e)}function te(e){e=xe(e);const t=xe(this),n=Q(t),r=n.has.call(t,e);return r||(t.add(e),R(t,"add",e,e)),this}function ne(e,t){t=xe(t);const n=xe(this),{has:s,get:i}=Q(n);let o=s.call(n,e);o||(e=xe(e),o=s.call(n,e));const a=i.call(n,e);return n.set(e,t),o?(0,r.aU)(t,a)&&R(n,"set",e,t,a):R(n,"add",e,t),this}function re(e){const t=xe(this),{has:n,get:r}=Q(t);let s=n.call(t,e);s||(e=xe(e),s=n.call(t,e));const i=r?r.call(t,e):void 0,o=t.delete(e);return s&&R(t,"delete",e,void 0,i),o}function se(){const e=xe(this),t=0!==e.size,n=void 0,r=e.clear();return t&&R(e,"clear",void 0,void 0,n),r}function ie(e,t){return function(n,r){const s=this,i=s["__v_raw"],o=xe(i),a=t?J:e?Pe:De;return!e&&C(o,"iterate",b),i.forEach(((e,t)=>n.call(r,a(e),a(t),s)))}}function oe(e,t,n){return function(...s){const i=this["__v_raw"],o=xe(i),a=(0,r._N)(o),c="entries"===e||e===Symbol.iterator&&a,l="keys"===e&&a,u=i[e](...s),h=n?J:t?Pe:De;return!t&&C(o,"iterate",l?v:b),{next(){const{value:e,done:t}=u.next();return t?{value:e,done:t}:{value:c?[h(e[0]),h(e[1])]:h(e),done:t}},[Symbol.iterator](){return this}}}}function ae(e){return function(...t){return"delete"!==e&&this}}function ce(){const e={get(e){return X(this,e)},get size(){return ee(this)},has:Z,add:te,set:ne,delete:re,clear:se,forEach:ie(!1,!1)},t={get(e){return X(this,e,!1,!0)},get size(){return ee(this)},has:Z,add:te,set:ne,delete:re,clear:se,forEach:ie(!1,!0)},n={get(e){return X(this,e,!0)},get size(){return ee(this,!0)},has(e){return Z.call(this,e,!0)},add:ae("add"),set:ae("set"),delete:ae("delete"),clear:ae("clear"),forEach:ie(!0,!1)},r={get(e){return X(this,e,!0,!0)},get size(){return ee(this,!0)},has(e){return Z.call(this,e,!0)},add:ae("add"),set:ae("set"),delete:ae("delete"),clear:ae("clear"),forEach:ie(!0,!0)},s=["keys","values","entries",Symbol.iterator];return s.forEach((s=>{e[s]=oe(s,!1,!1),n[s]=oe(s,!0,!1),t[s]=oe(s,!1,!0),r[s]=oe(s,!0,!0)})),[e,n,t,r]}const[le,ue,he,de]=ce();function pe(e,t){const n=t?e?de:he:e?ue:le;return(t,s,i)=>"__v_isReactive"===s?!e:"__v_isReadonly"===s?e:"__v_raw"===s?t:Reflect.get((0,r.RI)(n,s)&&s in t?n:t,s,i)}const fe={get:pe(!1,!1)},ge={get:pe(!1,!0)},me={get:pe(!0,!1)};const ye=new WeakMap,we=new WeakMap,be=new WeakMap,ve=new WeakMap;function Ee(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function _e(e){return e["__v_skip"]||!Object.isExtensible(e)?0:Ee((0,r.W7)(e))}function Se(e){return Ie(e)?e:Te(e,!1,G,fe,ye)}function ke(e){return Te(e,!1,Y,ge,we)}function Ae(e){return Te(e,!0,W,me,be)}function Te(e,t,n,s,i){if(!(0,r.Kn)(e))return e;if(e["__v_raw"]&&(!t||!e["__v_isReactive"]))return e;const o=i.get(e);if(o)return o;const a=_e(e);if(0===a)return e;const c=new Proxy(e,2===a?s:n);return i.set(e,c),c}function Ce(e){return Ie(e)?Ce(e["__v_raw"]):!(!e||!e["__v_isReactive"])}function Ie(e){return!(!e||!e["__v_isReadonly"])}function Re(e){return!(!e||!e["__v_isShallow"])}function Oe(e){return Ce(e)||Ie(e)}function xe(e){const t=e&&e["__v_raw"];return t?xe(t):e}function Ne(e){return(0,r.Nj)(e,"__v_skip",!0),e}const De=e=>(0,r.Kn)(e)?Se(e):e,Pe=e=>(0,r.Kn)(e)?Ae(e):e;function Le(e){S&&w&&(e=xe(e),I(e.dep||(e.dep=l())))}function Me(e,t){e=xe(e);const n=e.dep;n&&O(n)}function Be(e){return!(!e||!0!==e.__v_isRef)}function Ue(e){return Fe(e,!1)}function Ve(e){return Fe(e,!0)}function Fe(e,t){return Be(e)?e:new je(e,t)}class je{constructor(e,t){this.__v_isShallow=t,this.dep=void 0,this.__v_isRef=!0,this._rawValue=t?e:xe(e),this._value=t?e:De(e)}get value(){return Le(this),this._value}set value(e){const t=this.__v_isShallow||Re(e)||Ie(e);e=t?e:xe(e),(0,r.aU)(e,this._rawValue)&&(this._rawValue=e,this._value=t?e:De(e),Me(this,e))}}function ze(e){return Be(e)?e.value:e}const $e={get:(e,t,n)=>ze(Reflect.get(e,t,n)),set:(e,t,n,r)=>{const s=e[t];return Be(s)&&!Be(n)?(s.value=n,!0):Reflect.set(e,t,n,r)}};function He(e){return Ce(e)?e:new Proxy(e,$e)}class Ke{constructor(e){this.dep=void 0,this.__v_isRef=!0;const{get:t,set:n}=e((()=>Le(this)),(()=>Me(this)));this._get=t,this._set=n}get value(){return this._get()}set value(e){this._set(e)}}function qe(e){return new Ke(e)}var Ge;class We{constructor(e,t,n,r){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[Ge]=!1,this._dirty=!0,this.effect=new E(e,(()=>{this._dirty||(this._dirty=!0,Me(this))})),this.effect.computed=this,this.effect.active=this._cacheable=!r,this["__v_isReadonly"]=n}get value(){const e=xe(this);return Le(e),!e._dirty&&e._cacheable||(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function Ye(e,t,n=!1){let s,i;const o=(0,r.mf)(e);o?(s=e,i=r.dG):(s=e.get,i=e.set);const a=new We(s,i,o||!i,n);return a}Ge="__v_isReadonly"},3396:function(e,t,n){"use strict";n.d(t,{$d:function(){return o},FN:function(){return bn},Fl:function(){return Ln},HY:function(){return Ut},JJ:function(){return H},Jd:function(){return Ae},Ko:function(){return Be},P$:function(){return ne},Q6:function(){return ce},U2:function(){return se},Uk:function(){return cn},Us:function(){return kt},Wm:function(){return rn},Y3:function(){return w},Y8:function(){return Z},YP:function(){return W},_:function(){return nn},aZ:function(){return le},bv:function(){return _e},dG:function(){return pn},f3:function(){return K},h:function(){return Mn},iD:function(){return Yt},ic:function(){return ke},j4:function(){return Jt},kq:function(){return ln},lR:function(){return Mt},m0:function(){return q},nK:function(){return ae},up:function(){return De},w5:function(){return L},wg:function(){return Ht}});n(7658),n(541);var r=n(4870),s=n(7139);function i(e,t,n,r){let s;try{s=r?e(...r):e()}catch(i){a(i,t,n)}return s}function o(e,t,n,r){if((0,s.mf)(e)){const o=i(e,t,n,r);return o&&(0,s.tI)(o)&&o.catch((e=>{a(e,t,n)})),o}const c=[];for(let s=0;s<e.length;s++)c.push(o(e[s],t,n,r));return c}function a(e,t,n,r=!0){const s=t?t.vnode:null;if(t){let r=t.parent;const s=t.proxy,o=n;while(r){const t=r.ec;if(t)for(let n=0;n<t.length;n++)if(!1===t[n](e,s,o))return;r=r.parent}const a=t.appContext.config.errorHandler;if(a)return void i(a,null,10,[e,s,o])}c(e,n,s,r)}function c(e,t,n,r=!0){console.error(e)}let l=!1,u=!1;const h=[];let d=0;const p=[];let f=null,g=0;const m=Promise.resolve();let y=null;function w(e){const t=y||m;return e?t.then(this?e.bind(this):e):t}function b(e){let t=d+1,n=h.length;while(t<n){const r=t+n>>>1,s=T(h[r]);s<e?t=r+1:n=r}return t}function v(e){h.length&&h.includes(e,l&&e.allowRecurse?d+1:d)||(null==e.id?h.push(e):h.splice(b(e.id),0,e),E())}function E(){l||u||(u=!0,y=m.then(I))}function _(e){const t=h.indexOf(e);t>d&&h.splice(t,1)}function S(e){(0,s.kJ)(e)?p.push(...e):f&&f.includes(e,e.allowRecurse?g+1:g)||p.push(e),E()}function k(e,t=(l?d+1:0)){for(0;t<h.length;t++){const e=h[t];e&&e.pre&&(h.splice(t,1),t--,e())}}function A(e){if(p.length){const e=[...new Set(p)];if(p.length=0,f)return void f.push(...e);for(f=e,f.sort(((e,t)=>T(e)-T(t))),g=0;g<f.length;g++)f[g]();f=null,g=0}}const T=e=>null==e.id?1/0:e.id,C=(e,t)=>{const n=T(e)-T(t);if(0===n){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return n};function I(e){u=!1,l=!0,h.sort(C);s.dG;try{for(d=0;d<h.length;d++){const e=h[d];e&&!1!==e.active&&i(e,null,14)}}finally{d=0,h.length=0,A(e),l=!1,y=null,(h.length||p.length)&&I(e)}}new Set;new Map;function R(e,t,...n){if(e.isUnmounted)return;const r=e.vnode.props||s.kT;let i=n;const a=t.startsWith("update:"),c=a&&t.slice(7);if(c&&c in r){const e=`${"modelValue"===c?"model":c}Modifiers`,{number:t,trim:o}=r[e]||s.kT;o&&(i=n.map((e=>(0,s.HD)(e)?e.trim():e))),t&&(i=n.map(s.h5))}let l;let u=r[l=(0,s.hR)(t)]||r[l=(0,s.hR)((0,s._A)(t))];!u&&a&&(u=r[l=(0,s.hR)((0,s.rs)(t))]),u&&o(u,e,6,i);const h=r[l+"Once"];if(h){if(e.emitted){if(e.emitted[l])return}else e.emitted={};e.emitted[l]=!0,o(h,e,6,i)}}function O(e,t,n=!1){const r=t.emitsCache,i=r.get(e);if(void 0!==i)return i;const o=e.emits;let a={},c=!1;if(!(0,s.mf)(e)){const r=e=>{const n=O(e,t,!0);n&&(c=!0,(0,s.l7)(a,n))};!n&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}return o||c?((0,s.kJ)(o)?o.forEach((e=>a[e]=null)):(0,s.l7)(a,o),(0,s.Kn)(e)&&r.set(e,a),a):((0,s.Kn)(e)&&r.set(e,null),null)}function x(e,t){return!(!e||!(0,s.F7)(t))&&(t=t.slice(2).replace(/Once$/,""),(0,s.RI)(e,t[0].toLowerCase()+t.slice(1))||(0,s.RI)(e,(0,s.rs)(t))||(0,s.RI)(e,t))}let N=null,D=null;function P(e){const t=N;return N=e,D=e&&e.type.__scopeId||null,t}function L(e,t=N,n){if(!t)return e;if(e._n)return e;const r=(...n)=>{r._d&&Gt(-1);const s=P(t);let i;try{i=e(...n)}finally{P(s),r._d&&Gt(1)}return i};return r._n=!0,r._c=!0,r._d=!0,r}function M(e){const{type:t,vnode:n,proxy:r,withProxy:i,props:o,propsOptions:[c],slots:l,attrs:u,emit:h,render:d,renderCache:p,data:f,setupState:g,ctx:m,inheritAttrs:y}=e;let w,b;const v=P(e);try{if(4&n.shapeFlag){const e=i||r;w=un(d.call(e,e,p,o,g,f,m)),b=u}else{const e=t;0,w=un(e.length>1?e(o,{attrs:u,slots:l,emit:h}):e(o,null)),b=t.props?u:B(u)}}catch(_){zt.length=0,a(_,e,1),w=rn(Ft)}let E=w;if(b&&!1!==y){const e=Object.keys(b),{shapeFlag:t}=E;e.length&&7&t&&(c&&e.some(s.tR)&&(b=U(b,c)),E=an(E,b))}return n.dirs&&(E=an(E),E.dirs=E.dirs?E.dirs.concat(n.dirs):n.dirs),n.transition&&(E.transition=n.transition),w=E,P(v),w}const B=e=>{let t;for(const n in e)("class"===n||"style"===n||(0,s.F7)(n))&&((t||(t={}))[n]=e[n]);return t},U=(e,t)=>{const n={};for(const r in e)(0,s.tR)(r)&&r.slice(9)in t||(n[r]=e[r]);return n};function V(e,t,n){const{props:r,children:s,component:i}=e,{props:o,children:a,patchFlag:c}=t,l=i.emitsOptions;if(t.dirs||t.transition)return!0;if(!(n&&c>=0))return!(!s&&!a||a&&a.$stable)||r!==o&&(r?!o||F(r,o,l):!!o);if(1024&c)return!0;if(16&c)return r?F(r,o,l):!!o;if(8&c){const e=t.dynamicProps;for(let t=0;t<e.length;t++){const n=e[t];if(o[n]!==r[n]&&!x(l,n))return!0}}return!1}function F(e,t,n){const r=Object.keys(t);if(r.length!==Object.keys(e).length)return!0;for(let s=0;s<r.length;s++){const i=r[s];if(t[i]!==e[i]&&!x(n,i))return!0}return!1}function j({vnode:e,parent:t},n){while(t&&t.subTree===e)(e=t.vnode).el=n,t=t.parent}const z=e=>e.__isSuspense;function $(e,t){t&&t.pendingBranch?(0,s.kJ)(e)?t.effects.push(...e):t.effects.push(e):S(e)}function H(e,t){if(wn){let n=wn.provides;const r=wn.parent&&wn.parent.provides;r===n&&(n=wn.provides=Object.create(r)),n[e]=t}else 0}function K(e,t,n=!1){const r=wn||N;if(r){const i=null==r.parent?r.vnode.appContext&&r.vnode.appContext.provides:r.parent.provides;if(i&&e in i)return i[e];if(arguments.length>1)return n&&(0,s.mf)(t)?t.call(r.proxy):t}else 0}function q(e,t){return Y(e,null,t)}const G={};function W(e,t,n){return Y(e,t,n)}function Y(e,t,{immediate:n,deep:a,flush:c,onTrack:l,onTrigger:u}=s.kT){const h=(0,r.nZ)()===(null===wn||void 0===wn?void 0:wn.scope)?wn:null;let d,p,f=!1,g=!1;if((0,r.dq)(e)?(d=()=>e.value,f=(0,r.yT)(e)):(0,r.PG)(e)?(d=()=>e,a=!0):(0,s.kJ)(e)?(g=!0,f=e.some((e=>(0,r.PG)(e)||(0,r.yT)(e))),d=()=>e.map((e=>(0,r.dq)(e)?e.value:(0,r.PG)(e)?X(e):(0,s.mf)(e)?i(e,h,2):void 0))):d=(0,s.mf)(e)?t?()=>i(e,h,2):()=>{if(!h||!h.isUnmounted)return p&&p(),o(e,h,3,[y])}:s.dG,t&&a){const e=d;d=()=>X(e())}let m,y=e=>{p=_.onStop=()=>{i(e,h,4)}};if(An){if(y=s.dG,t?n&&o(t,h,3,[d(),g?[]:void 0,y]):d(),"sync"!==c)return s.dG;{const e=Un();m=e.__watcherHandles||(e.__watcherHandles=[])}}let w=g?new Array(e.length).fill(G):G;const b=()=>{if(_.active)if(t){const e=_.run();(a||f||(g?e.some(((e,t)=>(0,s.aU)(e,w[t]))):(0,s.aU)(e,w)))&&(p&&p(),o(t,h,3,[e,w===G?void 0:g&&w[0]===G?[]:w,y]),w=e)}else _.run()};let E;b.allowRecurse=!!t,"sync"===c?E=b:"post"===c?E=()=>St(b,h&&h.suspense):(b.pre=!0,h&&(b.id=h.uid),E=()=>v(b));const _=new r.qq(d,E);t?n?b():w=_.run():"post"===c?St(_.run.bind(_),h&&h.suspense):_.run();const S=()=>{_.stop(),h&&h.scope&&(0,s.Od)(h.scope.effects,_)};return m&&m.push(S),S}function J(e,t,n){const r=this.proxy,i=(0,s.HD)(e)?e.includes(".")?Q(r,e):()=>r[e]:e.bind(r,r);let o;(0,s.mf)(t)?o=t:(o=t.handler,n=t);const a=wn;vn(this);const c=Y(i,o.bind(r),n);return a?vn(a):En(),c}function Q(e,t){const n=t.split(".");return()=>{let t=e;for(let e=0;e<n.length&&t;e++)t=t[n[e]];return t}}function X(e,t){if(!(0,s.Kn)(e)||e["__v_skip"])return e;if(t=t||new Set,t.has(e))return e;if(t.add(e),(0,r.dq)(e))X(e.value,t);else if((0,s.kJ)(e))for(let n=0;n<e.length;n++)X(e[n],t);else if((0,s.DM)(e)||(0,s._N)(e))e.forEach((e=>{X(e,t)}));else if((0,s.PO)(e))for(const n in e)X(e[n],t);return e}function Z(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return _e((()=>{e.isMounted=!0})),Ae((()=>{e.isUnmounting=!0})),e}const ee=[Function,Array],te={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ee,onEnter:ee,onAfterEnter:ee,onEnterCancelled:ee,onBeforeLeave:ee,onLeave:ee,onAfterLeave:ee,onLeaveCancelled:ee,onBeforeAppear:ee,onAppear:ee,onAfterAppear:ee,onAppearCancelled:ee},setup(e,{slots:t}){const n=bn(),s=Z();let i;return()=>{const o=t.default&&ce(t.default(),!0);if(!o||!o.length)return;let a=o[0];if(o.length>1){let e=!1;for(const t of o)if(t.type!==Ft){0,a=t,e=!0;break}}const c=(0,r.IU)(e),{mode:l}=c;if(s.isLeaving)return ie(a);const u=oe(a);if(!u)return ie(a);const h=se(u,c,s,n);ae(u,h);const d=n.subTree,p=d&&oe(d);let f=!1;const{getTransitionKey:g}=u.type;if(g){const e=g();void 0===i?i=e:e!==i&&(i=e,f=!0)}if(p&&p.type!==Ft&&(!Xt(u,p)||f)){const e=se(p,c,s,n);if(ae(p,e),"out-in"===l)return s.isLeaving=!0,e.afterLeave=()=>{s.isLeaving=!1,!1!==n.update.active&&n.update()},ie(a);"in-out"===l&&u.type!==Ft&&(e.delayLeave=(e,t,n)=>{const r=re(s,p);r[String(p.key)]=p,e._leaveCb=()=>{t(),e._leaveCb=void 0,delete h.delayedLeave},h.delayedLeave=n})}return a}}},ne=te;function re(e,t){const{leavingVNodes:n}=e;let r=n.get(t.type);return r||(r=Object.create(null),n.set(t.type,r)),r}function se(e,t,n,r){const{appear:i,mode:a,persisted:c=!1,onBeforeEnter:l,onEnter:u,onAfterEnter:h,onEnterCancelled:d,onBeforeLeave:p,onLeave:f,onAfterLeave:g,onLeaveCancelled:m,onBeforeAppear:y,onAppear:w,onAfterAppear:b,onAppearCancelled:v}=t,E=String(e.key),_=re(n,e),S=(e,t)=>{e&&o(e,r,9,t)},k=(e,t)=>{const n=t[1];S(e,t),(0,s.kJ)(e)?e.every((e=>e.length<=1))&&n():e.length<=1&&n()},A={mode:a,persisted:c,beforeEnter(t){let r=l;if(!n.isMounted){if(!i)return;r=y||l}t._leaveCb&&t._leaveCb(!0);const s=_[E];s&&Xt(e,s)&&s.el._leaveCb&&s.el._leaveCb(),S(r,[t])},enter(e){let t=u,r=h,s=d;if(!n.isMounted){if(!i)return;t=w||u,r=b||h,s=v||d}let o=!1;const a=e._enterCb=t=>{o||(o=!0,S(t?s:r,[e]),A.delayedLeave&&A.delayedLeave(),e._enterCb=void 0)};t?k(t,[e,a]):a()},leave(t,r){const s=String(e.key);if(t._enterCb&&t._enterCb(!0),n.isUnmounting)return r();S(p,[t]);let i=!1;const o=t._leaveCb=n=>{i||(i=!0,r(),S(n?m:g,[t]),t._leaveCb=void 0,_[s]===e&&delete _[s])};_[s]=e,f?k(f,[t,o]):o()},clone(e){return se(e,t,n,r)}};return A}function ie(e){if(he(e))return e=an(e),e.children=null,e}function oe(e){return he(e)?e.children?e.children[0]:void 0:e}function ae(e,t){6&e.shapeFlag&&e.component?ae(e.component.subTree,t):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function ce(e,t=!1,n){let r=[],s=0;for(let i=0;i<e.length;i++){let o=e[i];const a=null==n?o.key:String(n)+String(null!=o.key?o.key:i);o.type===Ut?(128&o.patchFlag&&s++,r=r.concat(ce(o.children,t,a))):(t||o.type!==Ft)&&r.push(null!=a?an(o,{key:a}):o)}if(s>1)for(let i=0;i<r.length;i++)r[i].patchFlag=-2;return r}function le(e){return(0,s.mf)(e)?{setup:e,name:e.name}:e}const ue=e=>!!e.type.__asyncLoader;const he=e=>e.type.__isKeepAlive;RegExp,RegExp;function de(e,t){return(0,s.kJ)(e)?e.some((e=>de(e,t))):(0,s.HD)(e)?e.split(",").includes(t):!!(0,s.Kj)(e)&&e.test(t)}function pe(e,t){ge(e,"a",t)}function fe(e,t){ge(e,"da",t)}function ge(e,t,n=wn){const r=e.__wdc||(e.__wdc=()=>{let t=n;while(t){if(t.isDeactivated)return;t=t.parent}return e()});if(be(t,r,n),n){let e=n.parent;while(e&&e.parent)he(e.parent.vnode)&&me(r,t,n,e),e=e.parent}}function me(e,t,n,r){const i=be(t,e,r,!0);Te((()=>{(0,s.Od)(r[t],i)}),n)}function ye(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function we(e){return 128&e.shapeFlag?e.ssContent:e}function be(e,t,n=wn,s=!1){if(n){const i=n[e]||(n[e]=[]),a=t.__weh||(t.__weh=(...s)=>{if(n.isUnmounted)return;(0,r.Jd)(),vn(n);const i=o(t,n,e,s);return En(),(0,r.lk)(),i});return s?i.unshift(a):i.push(a),a}}const ve=e=>(t,n=wn)=>(!An||"sp"===e)&&be(e,((...e)=>t(...e)),n),Ee=ve("bm"),_e=ve("m"),Se=ve("bu"),ke=ve("u"),Ae=ve("bum"),Te=ve("um"),Ce=ve("sp"),Ie=ve("rtg"),Re=ve("rtc");function Oe(e,t=wn){be("ec",e,t)}function xe(e,t,n,s){const i=e.dirs,a=t&&t.dirs;for(let c=0;c<i.length;c++){const l=i[c];a&&(l.oldValue=a[c].value);let u=l.dir[s];u&&((0,r.Jd)(),o(u,n,8,[e.el,l,e,t]),(0,r.lk)())}}const Ne="components";function De(e,t){return Le(Ne,e,!0,t)||e}const Pe=Symbol();function Le(e,t,n=!0,r=!1){const i=N||wn;if(i){const n=i.type;if(e===Ne){const e=Dn(n,!1);if(e&&(e===t||e===(0,s._A)(t)||e===(0,s.kC)((0,s._A)(t))))return n}const o=Me(i[e]||n[e],t)||Me(i.appContext[e],t);return!o&&r?n:o}}function Me(e,t){return e&&(e[t]||e[(0,s._A)(t)]||e[(0,s.kC)((0,s._A)(t))])}function Be(e,t,n,r){let i;const o=n&&n[r];if((0,s.kJ)(e)||(0,s.HD)(e)){i=new Array(e.length);for(let n=0,r=e.length;n<r;n++)i[n]=t(e[n],n,void 0,o&&o[n])}else if("number"===typeof e){0,i=new Array(e);for(let n=0;n<e;n++)i[n]=t(n+1,n,void 0,o&&o[n])}else if((0,s.Kn)(e))if(e[Symbol.iterator])i=Array.from(e,((e,n)=>t(e,n,void 0,o&&o[n])));else{const n=Object.keys(e);i=new Array(n.length);for(let r=0,s=n.length;r<s;r++){const s=n[r];i[r]=t(e[s],s,r,o&&o[r])}}else i=[];return n&&(n[r]=i),i}const Ue=e=>e?_n(e)?Nn(e)||e.proxy:Ue(e.parent):null,Ve=(0,s.l7)(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Ue(e.parent),$root:e=>Ue(e.root),$emit:e=>e.emit,$options:e=>Ge(e),$forceUpdate:e=>e.f||(e.f=()=>v(e.update)),$nextTick:e=>e.n||(e.n=w.bind(e.proxy)),$watch:e=>J.bind(e)}),Fe=(e,t)=>e!==s.kT&&!e.__isScriptSetup&&(0,s.RI)(e,t),je={get({_:e},t){const{ctx:n,setupState:i,data:o,props:a,accessCache:c,type:l,appContext:u}=e;let h;if("$"!==t[0]){const r=c[t];if(void 0!==r)switch(r){case 1:return i[t];case 2:return o[t];case 4:return n[t];case 3:return a[t]}else{if(Fe(i,t))return c[t]=1,i[t];if(o!==s.kT&&(0,s.RI)(o,t))return c[t]=2,o[t];if((h=e.propsOptions[0])&&(0,s.RI)(h,t))return c[t]=3,a[t];if(n!==s.kT&&(0,s.RI)(n,t))return c[t]=4,n[t];ze&&(c[t]=0)}}const d=Ve[t];let p,f;return d?("$attrs"===t&&(0,r.j)(e,"get",t),d(e)):(p=l.__cssModules)&&(p=p[t])?p:n!==s.kT&&(0,s.RI)(n,t)?(c[t]=4,n[t]):(f=u.config.globalProperties,(0,s.RI)(f,t)?f[t]:void 0)},set({_:e},t,n){const{data:r,setupState:i,ctx:o}=e;return Fe(i,t)?(i[t]=n,!0):r!==s.kT&&(0,s.RI)(r,t)?(r[t]=n,!0):!(0,s.RI)(e.props,t)&&(("$"!==t[0]||!(t.slice(1)in e))&&(o[t]=n,!0))},has({_:{data:e,setupState:t,accessCache:n,ctx:r,appContext:i,propsOptions:o}},a){let c;return!!n[a]||e!==s.kT&&(0,s.RI)(e,a)||Fe(t,a)||(c=o[0])&&(0,s.RI)(c,a)||(0,s.RI)(r,a)||(0,s.RI)(Ve,a)||(0,s.RI)(i.config.globalProperties,a)},defineProperty(e,t,n){return null!=n.get?e._.accessCache[t]=0:(0,s.RI)(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};let ze=!0;function $e(e){const t=Ge(e),n=e.proxy,i=e.ctx;ze=!1,t.beforeCreate&&Ke(t.beforeCreate,e,"bc");const{data:o,computed:a,methods:c,watch:l,provide:u,inject:h,created:d,beforeMount:p,mounted:f,beforeUpdate:g,updated:m,activated:y,deactivated:w,beforeDestroy:b,beforeUnmount:v,destroyed:E,unmounted:_,render:S,renderTracked:k,renderTriggered:A,errorCaptured:T,serverPrefetch:C,expose:I,inheritAttrs:R,components:O,directives:x,filters:N}=t,D=null;if(h&&He(h,i,D,e.appContext.config.unwrapInjectedRef),c)for(const r in c){const e=c[r];(0,s.mf)(e)&&(i[r]=e.bind(n))}if(o){0;const t=o.call(n,n);0,(0,s.Kn)(t)&&(e.data=(0,r.qj)(t))}if(ze=!0,a)for(const r in a){const e=a[r],t=(0,s.mf)(e)?e.bind(n,n):(0,s.mf)(e.get)?e.get.bind(n,n):s.dG;0;const o=!(0,s.mf)(e)&&(0,s.mf)(e.set)?e.set.bind(n):s.dG,c=Ln({get:t,set:o});Object.defineProperty(i,r,{enumerable:!0,configurable:!0,get:()=>c.value,set:e=>c.value=e})}if(l)for(const r in l)qe(l[r],i,n,r);if(u){const e=(0,s.mf)(u)?u.call(n):u;Reflect.ownKeys(e).forEach((t=>{H(t,e[t])}))}function P(e,t){(0,s.kJ)(t)?t.forEach((t=>e(t.bind(n)))):t&&e(t.bind(n))}if(d&&Ke(d,e,"c"),P(Ee,p),P(_e,f),P(Se,g),P(ke,m),P(pe,y),P(fe,w),P(Oe,T),P(Re,k),P(Ie,A),P(Ae,v),P(Te,_),P(Ce,C),(0,s.kJ)(I))if(I.length){const t=e.exposed||(e.exposed={});I.forEach((e=>{Object.defineProperty(t,e,{get:()=>n[e],set:t=>n[e]=t})}))}else e.exposed||(e.exposed={});S&&e.render===s.dG&&(e.render=S),null!=R&&(e.inheritAttrs=R),O&&(e.components=O),x&&(e.directives=x)}function He(e,t,n=s.dG,i=!1){(0,s.kJ)(e)&&(e=Xe(e));for(const o in e){const n=e[o];let a;a=(0,s.Kn)(n)?"default"in n?K(n.from||o,n.default,!0):K(n.from||o):K(n),(0,r.dq)(a)&&i?Object.defineProperty(t,o,{enumerable:!0,configurable:!0,get:()=>a.value,set:e=>a.value=e}):t[o]=a}}function Ke(e,t,n){o((0,s.kJ)(e)?e.map((e=>e.bind(t.proxy))):e.bind(t.proxy),t,n)}function qe(e,t,n,r){const i=r.includes(".")?Q(n,r):()=>n[r];if((0,s.HD)(e)){const n=t[e];(0,s.mf)(n)&&W(i,n)}else if((0,s.mf)(e))W(i,e.bind(n));else if((0,s.Kn)(e))if((0,s.kJ)(e))e.forEach((e=>qe(e,t,n,r)));else{const r=(0,s.mf)(e.handler)?e.handler.bind(n):t[e.handler];(0,s.mf)(r)&&W(i,r,e)}else 0}function Ge(e){const t=e.type,{mixins:n,extends:r}=t,{mixins:i,optionsCache:o,config:{optionMergeStrategies:a}}=e.appContext,c=o.get(t);let l;return c?l=c:i.length||n||r?(l={},i.length&&i.forEach((e=>We(l,e,a,!0))),We(l,t,a)):l=t,(0,s.Kn)(t)&&o.set(t,l),l}function We(e,t,n,r=!1){const{mixins:s,extends:i}=t;i&&We(e,i,n,!0),s&&s.forEach((t=>We(e,t,n,!0)));for(const o in t)if(r&&"expose"===o);else{const r=Ye[o]||n&&n[o];e[o]=r?r(e[o],t[o]):t[o]}return e}const Ye={data:Je,props:et,emits:et,methods:et,computed:et,beforeCreate:Ze,created:Ze,beforeMount:Ze,mounted:Ze,beforeUpdate:Ze,updated:Ze,beforeDestroy:Ze,beforeUnmount:Ze,destroyed:Ze,unmounted:Ze,activated:Ze,deactivated:Ze,errorCaptured:Ze,serverPrefetch:Ze,components:et,directives:et,watch:tt,provide:Je,inject:Qe};function Je(e,t){return t?e?function(){return(0,s.l7)((0,s.mf)(e)?e.call(this,this):e,(0,s.mf)(t)?t.call(this,this):t)}:t:e}function Qe(e,t){return et(Xe(e),Xe(t))}function Xe(e){if((0,s.kJ)(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function Ze(e,t){return e?[...new Set([].concat(e,t))]:t}function et(e,t){return e?(0,s.l7)((0,s.l7)(Object.create(null),e),t):t}function tt(e,t){if(!e)return t;if(!t)return e;const n=(0,s.l7)(Object.create(null),e);for(const r in t)n[r]=Ze(e[r],t[r]);return n}function nt(e,t,n,i=!1){const o={},a={};(0,s.Nj)(a,Zt,1),e.propsDefaults=Object.create(null),st(e,t,o,a);for(const r in e.propsOptions[0])r in o||(o[r]=void 0);n?e.props=i?o:(0,r.Um)(o):e.type.props?e.props=o:e.props=a,e.attrs=a}function rt(e,t,n,i){const{props:o,attrs:a,vnode:{patchFlag:c}}=e,l=(0,r.IU)(o),[u]=e.propsOptions;let h=!1;if(!(i||c>0)||16&c){let r;st(e,t,o,a)&&(h=!0);for(const i in l)t&&((0,s.RI)(t,i)||(r=(0,s.rs)(i))!==i&&(0,s.RI)(t,r))||(u?!n||void 0===n[i]&&void 0===n[r]||(o[i]=it(u,l,i,void 0,e,!0)):delete o[i]);if(a!==l)for(const e in a)t&&(0,s.RI)(t,e)||(delete a[e],h=!0)}else if(8&c){const n=e.vnode.dynamicProps;for(let r=0;r<n.length;r++){let i=n[r];if(x(e.emitsOptions,i))continue;const c=t[i];if(u)if((0,s.RI)(a,i))c!==a[i]&&(a[i]=c,h=!0);else{const t=(0,s._A)(i);o[t]=it(u,l,t,c,e,!1)}else c!==a[i]&&(a[i]=c,h=!0)}}h&&(0,r.X$)(e,"set","$attrs")}function st(e,t,n,i){const[o,a]=e.propsOptions;let c,l=!1;if(t)for(let r in t){if((0,s.Gg)(r))continue;const u=t[r];let h;o&&(0,s.RI)(o,h=(0,s._A)(r))?a&&a.includes(h)?(c||(c={}))[h]=u:n[h]=u:x(e.emitsOptions,r)||r in i&&u===i[r]||(i[r]=u,l=!0)}if(a){const t=(0,r.IU)(n),i=c||s.kT;for(let r=0;r<a.length;r++){const c=a[r];n[c]=it(o,t,c,i[c],e,!(0,s.RI)(i,c))}}return l}function it(e,t,n,r,i,o){const a=e[n];if(null!=a){const e=(0,s.RI)(a,"default");if(e&&void 0===r){const e=a.default;if(a.type!==Function&&(0,s.mf)(e)){const{propsDefaults:s}=i;n in s?r=s[n]:(vn(i),r=s[n]=e.call(null,t),En())}else r=e}a[0]&&(o&&!e?r=!1:!a[1]||""!==r&&r!==(0,s.rs)(n)||(r=!0))}return r}function ot(e,t,n=!1){const r=t.propsCache,i=r.get(e);if(i)return i;const o=e.props,a={},c=[];let l=!1;if(!(0,s.mf)(e)){const r=e=>{l=!0;const[n,r]=ot(e,t,!0);(0,s.l7)(a,n),r&&c.push(...r)};!n&&t.mixins.length&&t.mixins.forEach(r),e.extends&&r(e.extends),e.mixins&&e.mixins.forEach(r)}if(!o&&!l)return(0,s.Kn)(e)&&r.set(e,s.Z6),s.Z6;if((0,s.kJ)(o))for(let h=0;h<o.length;h++){0;const e=(0,s._A)(o[h]);at(e)&&(a[e]=s.kT)}else if(o){0;for(const e in o){const t=(0,s._A)(e);if(at(t)){const n=o[e],r=a[t]=(0,s.kJ)(n)||(0,s.mf)(n)?{type:n}:Object.assign({},n);if(r){const e=ut(Boolean,r.type),n=ut(String,r.type);r[0]=e>-1,r[1]=n<0||e<n,(e>-1||(0,s.RI)(r,"default"))&&c.push(t)}}}}const u=[a,c];return(0,s.Kn)(e)&&r.set(e,u),u}function at(e){return"$"!==e[0]}function ct(e){const t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:null===e?"null":""}function lt(e,t){return ct(e)===ct(t)}function ut(e,t){return(0,s.kJ)(t)?t.findIndex((t=>lt(t,e))):(0,s.mf)(t)&&lt(t,e)?0:-1}const ht=e=>"_"===e[0]||"$stable"===e,dt=e=>(0,s.kJ)(e)?e.map(un):[un(e)],pt=(e,t,n)=>{if(t._n)return t;const r=L(((...e)=>dt(t(...e))),n);return r._c=!1,r},ft=(e,t,n)=>{const r=e._ctx;for(const i in e){if(ht(i))continue;const n=e[i];if((0,s.mf)(n))t[i]=pt(i,n,r);else if(null!=n){0;const e=dt(n);t[i]=()=>e}}},gt=(e,t)=>{const n=dt(t);e.slots.default=()=>n},mt=(e,t)=>{if(32&e.vnode.shapeFlag){const n=t._;n?(e.slots=(0,r.IU)(t),(0,s.Nj)(t,"_",n)):ft(t,e.slots={})}else e.slots={},t&&gt(e,t);(0,s.Nj)(e.slots,Zt,1)},yt=(e,t,n)=>{const{vnode:r,slots:i}=e;let o=!0,a=s.kT;if(32&r.shapeFlag){const e=t._;e?n&&1===e?o=!1:((0,s.l7)(i,t),n||1!==e||delete i._):(o=!t.$stable,ft(t,i)),a=t}else t&&(gt(e,t),a={default:1});if(o)for(const s in i)ht(s)||s in a||delete i[s]};function wt(){return{app:null,config:{isNativeTag:s.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let bt=0;function vt(e,t){return function(n,r=null){(0,s.mf)(n)||(n=Object.assign({},n)),null==r||(0,s.Kn)(r)||(r=null);const i=wt(),o=new Set;let a=!1;const c=i.app={_uid:bt++,_component:n,_props:r,_container:null,_context:i,_instance:null,version:Vn,get config(){return i.config},set config(e){0},use(e,...t){return o.has(e)||(e&&(0,s.mf)(e.install)?(o.add(e),e.install(c,...t)):(0,s.mf)(e)&&(o.add(e),e(c,...t))),c},mixin(e){return i.mixins.includes(e)||i.mixins.push(e),c},component(e,t){return t?(i.components[e]=t,c):i.components[e]},directive(e,t){return t?(i.directives[e]=t,c):i.directives[e]},mount(s,o,l){if(!a){0;const u=rn(n,r);return u.appContext=i,o&&t?t(u,s):e(u,s,l),a=!0,c._container=s,s.__vue_app__=c,Nn(u.component)||u.component.proxy}},unmount(){a&&(e(null,c._container),delete c._container.__vue_app__)},provide(e,t){return i.provides[e]=t,c}};return c}}function Et(e,t,n,o,a=!1){if((0,s.kJ)(e))return void e.forEach(((e,r)=>Et(e,t&&((0,s.kJ)(t)?t[r]:t),n,o,a)));if(ue(o)&&!a)return;const c=4&o.shapeFlag?Nn(o.component)||o.component.proxy:o.el,l=a?null:c,{i:u,r:h}=e;const d=t&&t.r,p=u.refs===s.kT?u.refs={}:u.refs,f=u.setupState;if(null!=d&&d!==h&&((0,s.HD)(d)?(p[d]=null,(0,s.RI)(f,d)&&(f[d]=null)):(0,r.dq)(d)&&(d.value=null)),(0,s.mf)(h))i(h,u,12,[l,p]);else{const t=(0,s.HD)(h),i=(0,r.dq)(h);if(t||i){const r=()=>{if(e.f){const n=t?(0,s.RI)(f,h)?f[h]:p[h]:h.value;a?(0,s.kJ)(n)&&(0,s.Od)(n,c):(0,s.kJ)(n)?n.includes(c)||n.push(c):t?(p[h]=[c],(0,s.RI)(f,h)&&(f[h]=p[h])):(h.value=[c],e.k&&(p[e.k]=h.value))}else t?(p[h]=l,(0,s.RI)(f,h)&&(f[h]=l)):i&&(h.value=l,e.k&&(p[e.k]=l))};l?(r.id=-1,St(r,n)):r()}else 0}}function _t(){}const St=$;function kt(e){return At(e)}function At(e,t){_t();const n=(0,s.E9)();n.__VUE__=!0;const{insert:i,remove:o,patchProp:a,createElement:c,createText:l,createComment:u,setText:h,setElementText:d,parentNode:p,nextSibling:f,setScopeId:g=s.dG,insertStaticContent:m}=e,y=(e,t,n,r=null,s=null,i=null,o=!1,a=null,c=!!t.dynamicChildren)=>{if(e===t)return;e&&!Xt(e,t)&&(r=X(e),G(e,s,i,!0),e=null),-2===t.patchFlag&&(c=!1,t.dynamicChildren=null);const{type:l,ref:u,shapeFlag:h}=t;switch(l){case Vt:w(e,t,n,r);break;case Ft:b(e,t,n,r);break;case jt:null==e&&E(t,n,r,o);break;case Ut:P(e,t,n,r,s,i,o,a,c);break;default:1&h?C(e,t,n,r,s,i,o,a,c):6&h?L(e,t,n,r,s,i,o,a,c):(64&h||128&h)&&l.process(e,t,n,r,s,i,o,a,c,ee)}null!=u&&s&&Et(u,e&&e.ref,i,t||e,!t)},w=(e,t,n,r)=>{if(null==e)i(t.el=l(t.children),n,r);else{const n=t.el=e.el;t.children!==e.children&&h(n,t.children)}},b=(e,t,n,r)=>{null==e?i(t.el=u(t.children||""),n,r):t.el=e.el},E=(e,t,n,r)=>{[e.el,e.anchor]=m(e.children,t,n,r,e.el,e.anchor)},S=({el:e,anchor:t},n,r)=>{let s;while(e&&e!==t)s=f(e),i(e,n,r),e=s;i(t,n,r)},T=({el:e,anchor:t})=>{let n;while(e&&e!==t)n=f(e),o(e),e=n;o(t)},C=(e,t,n,r,s,i,o,a,c)=>{o=o||"svg"===t.type,null==e?I(t,n,r,s,i,o,a,c):x(e,t,s,i,o,a,c)},I=(e,t,n,r,o,l,u,h)=>{let p,f;const{type:g,props:m,shapeFlag:y,transition:w,dirs:b}=e;if(p=e.el=c(e.type,l,m&&m.is,m),8&y?d(p,e.children):16&y&&O(e.children,p,null,r,o,l&&"foreignObject"!==g,u,h),b&&xe(e,null,r,"created"),R(p,e,e.scopeId,u,r),m){for(const t in m)"value"===t||(0,s.Gg)(t)||a(p,t,null,m[t],l,e.children,r,o,Q);"value"in m&&a(p,"value",null,m.value),(f=m.onVnodeBeforeMount)&&fn(f,r,e)}b&&xe(e,null,r,"beforeMount");const v=(!o||o&&!o.pendingBranch)&&w&&!w.persisted;v&&w.beforeEnter(p),i(p,t,n),((f=m&&m.onVnodeMounted)||v||b)&&St((()=>{f&&fn(f,r,e),v&&w.enter(p),b&&xe(e,null,r,"mounted")}),o)},R=(e,t,n,r,s)=>{if(n&&g(e,n),r)for(let i=0;i<r.length;i++)g(e,r[i]);if(s){let n=s.subTree;if(t===n){const t=s.vnode;R(e,t,t.scopeId,t.slotScopeIds,s.parent)}}},O=(e,t,n,r,s,i,o,a,c=0)=>{for(let l=c;l<e.length;l++){const c=e[l]=a?hn(e[l]):un(e[l]);y(null,c,t,n,r,s,i,o,a)}},x=(e,t,n,r,i,o,c)=>{const l=t.el=e.el;let{patchFlag:u,dynamicChildren:h,dirs:p}=t;u|=16&e.patchFlag;const f=e.props||s.kT,g=t.props||s.kT;let m;n&&Tt(n,!1),(m=g.onVnodeBeforeUpdate)&&fn(m,n,t,e),p&&xe(t,e,n,"beforeUpdate"),n&&Tt(n,!0);const y=i&&"foreignObject"!==t.type;if(h?N(e.dynamicChildren,h,l,n,r,y,o):c||$(e,t,l,null,n,r,y,o,!1),u>0){if(16&u)D(l,t,f,g,n,r,i);else if(2&u&&f.class!==g.class&&a(l,"class",null,g.class,i),4&u&&a(l,"style",f.style,g.style,i),8&u){const s=t.dynamicProps;for(let t=0;t<s.length;t++){const o=s[t],c=f[o],u=g[o];u===c&&"value"!==o||a(l,o,c,u,i,e.children,n,r,Q)}}1&u&&e.children!==t.children&&d(l,t.children)}else c||null!=h||D(l,t,f,g,n,r,i);((m=g.onVnodeUpdated)||p)&&St((()=>{m&&fn(m,n,t,e),p&&xe(t,e,n,"updated")}),r)},N=(e,t,n,r,s,i,o)=>{for(let a=0;a<t.length;a++){const c=e[a],l=t[a],u=c.el&&(c.type===Ut||!Xt(c,l)||70&c.shapeFlag)?p(c.el):n;y(c,l,u,null,r,s,i,o,!0)}},D=(e,t,n,r,i,o,c)=>{if(n!==r){if(n!==s.kT)for(const l in n)(0,s.Gg)(l)||l in r||a(e,l,n[l],null,c,t.children,i,o,Q);for(const l in r){if((0,s.Gg)(l))continue;const u=r[l],h=n[l];u!==h&&"value"!==l&&a(e,l,h,u,c,t.children,i,o,Q)}"value"in r&&a(e,"value",n.value,r.value)}},P=(e,t,n,r,s,o,a,c,u)=>{const h=t.el=e?e.el:l(""),d=t.anchor=e?e.anchor:l("");let{patchFlag:p,dynamicChildren:f,slotScopeIds:g}=t;g&&(c=c?c.concat(g):g),null==e?(i(h,n,r),i(d,n,r),O(t.children,n,d,s,o,a,c,u)):p>0&&64&p&&f&&e.dynamicChildren?(N(e.dynamicChildren,f,n,s,o,a,c),(null!=t.key||s&&t===s.subTree)&&Ct(e,t,!0)):$(e,t,n,d,s,o,a,c,u)},L=(e,t,n,r,s,i,o,a,c)=>{t.slotScopeIds=a,null==e?512&t.shapeFlag?s.ctx.activate(t,n,r,o,c):B(t,n,r,s,i,o,c):U(e,t,c)},B=(e,t,n,r,s,i,o)=>{const a=e.component=yn(e,r,s);if(he(e)&&(a.ctx.renderer=ee),Tn(a),a.asyncDep){if(s&&s.registerDep(a,F),!e.el){const e=a.subTree=rn(Ft);b(null,e,t,n)}}else F(a,e,t,n,s,i,o)},U=(e,t,n)=>{const r=t.component=e.component;if(V(e,t,n)){if(r.asyncDep&&!r.asyncResolved)return void z(r,t,n);r.next=t,_(r.update),r.update()}else t.el=e.el,r.vnode=t},F=(e,t,n,i,o,a,c)=>{const l=()=>{if(e.isMounted){let t,{next:n,bu:r,u:i,parent:l,vnode:u}=e,h=n;0,Tt(e,!1),n?(n.el=u.el,z(e,n,c)):n=u,r&&(0,s.ir)(r),(t=n.props&&n.props.onVnodeBeforeUpdate)&&fn(t,l,n,u),Tt(e,!0);const d=M(e);0;const f=e.subTree;e.subTree=d,y(f,d,p(f.el),X(f),e,o,a),n.el=d.el,null===h&&j(e,d.el),i&&St(i,o),(t=n.props&&n.props.onVnodeUpdated)&&St((()=>fn(t,l,n,u)),o)}else{let r;const{el:c,props:l}=t,{bm:u,m:h,parent:d}=e,p=ue(t);if(Tt(e,!1),u&&(0,s.ir)(u),!p&&(r=l&&l.onVnodeBeforeMount)&&fn(r,d,t),Tt(e,!0),c&&ne){const n=()=>{e.subTree=M(e),ne(c,e.subTree,e,o,null)};p?t.type.__asyncLoader().then((()=>!e.isUnmounted&&n())):n()}else{0;const r=e.subTree=M(e);0,y(null,r,n,i,e,o,a),t.el=r.el}if(h&&St(h,o),!p&&(r=l&&l.onVnodeMounted)){const e=t;St((()=>fn(r,d,e)),o)}(256&t.shapeFlag||d&&ue(d.vnode)&&256&d.vnode.shapeFlag)&&e.a&&St(e.a,o),e.isMounted=!0,t=n=i=null}},u=e.effect=new r.qq(l,(()=>v(h)),e.scope),h=e.update=()=>u.run();h.id=e.uid,Tt(e,!0),h()},z=(e,t,n)=>{t.component=e;const s=e.vnode.props;e.vnode=t,e.next=null,rt(e,t.props,s,n),yt(e,t.children,n),(0,r.Jd)(),k(),(0,r.lk)()},$=(e,t,n,r,s,i,o,a,c=!1)=>{const l=e&&e.children,u=e?e.shapeFlag:0,h=t.children,{patchFlag:p,shapeFlag:f}=t;if(p>0){if(128&p)return void K(l,h,n,r,s,i,o,a,c);if(256&p)return void H(l,h,n,r,s,i,o,a,c)}8&f?(16&u&&Q(l,s,i),h!==l&&d(n,h)):16&u?16&f?K(l,h,n,r,s,i,o,a,c):Q(l,s,i,!0):(8&u&&d(n,""),16&f&&O(h,n,r,s,i,o,a,c))},H=(e,t,n,r,i,o,a,c,l)=>{e=e||s.Z6,t=t||s.Z6;const u=e.length,h=t.length,d=Math.min(u,h);let p;for(p=0;p<d;p++){const r=t[p]=l?hn(t[p]):un(t[p]);y(e[p],r,n,null,i,o,a,c,l)}u>h?Q(e,i,o,!0,!1,d):O(t,n,r,i,o,a,c,l,d)},K=(e,t,n,r,i,o,a,c,l)=>{let u=0;const h=t.length;let d=e.length-1,p=h-1;while(u<=d&&u<=p){const r=e[u],s=t[u]=l?hn(t[u]):un(t[u]);if(!Xt(r,s))break;y(r,s,n,null,i,o,a,c,l),u++}while(u<=d&&u<=p){const r=e[d],s=t[p]=l?hn(t[p]):un(t[p]);if(!Xt(r,s))break;y(r,s,n,null,i,o,a,c,l),d--,p--}if(u>d){if(u<=p){const e=p+1,s=e<h?t[e].el:r;while(u<=p)y(null,t[u]=l?hn(t[u]):un(t[u]),n,s,i,o,a,c,l),u++}}else if(u>p)while(u<=d)G(e[u],i,o,!0),u++;else{const f=u,g=u,m=new Map;for(u=g;u<=p;u++){const e=t[u]=l?hn(t[u]):un(t[u]);null!=e.key&&m.set(e.key,u)}let w,b=0;const v=p-g+1;let E=!1,_=0;const S=new Array(v);for(u=0;u<v;u++)S[u]=0;for(u=f;u<=d;u++){const r=e[u];if(b>=v){G(r,i,o,!0);continue}let s;if(null!=r.key)s=m.get(r.key);else for(w=g;w<=p;w++)if(0===S[w-g]&&Xt(r,t[w])){s=w;break}void 0===s?G(r,i,o,!0):(S[s-g]=u+1,s>=_?_=s:E=!0,y(r,t[s],n,null,i,o,a,c,l),b++)}const k=E?It(S):s.Z6;for(w=k.length-1,u=v-1;u>=0;u--){const e=g+u,s=t[e],d=e+1<h?t[e+1].el:r;0===S[u]?y(null,s,n,d,i,o,a,c,l):E&&(w<0||u!==k[w]?q(s,n,d,2):w--)}}},q=(e,t,n,r,s=null)=>{const{el:o,type:a,transition:c,children:l,shapeFlag:u}=e;if(6&u)return void q(e.component.subTree,t,n,r);if(128&u)return void e.suspense.move(t,n,r);if(64&u)return void a.move(e,t,n,ee);if(a===Ut){i(o,t,n);for(let e=0;e<l.length;e++)q(l[e],t,n,r);return void i(e.anchor,t,n)}if(a===jt)return void S(e,t,n);const h=2!==r&&1&u&&c;if(h)if(0===r)c.beforeEnter(o),i(o,t,n),St((()=>c.enter(o)),s);else{const{leave:e,delayLeave:r,afterLeave:s}=c,a=()=>i(o,t,n),l=()=>{e(o,(()=>{a(),s&&s()}))};r?r(o,a,l):l()}else i(o,t,n)},G=(e,t,n,r=!1,s=!1)=>{const{type:i,props:o,ref:a,children:c,dynamicChildren:l,shapeFlag:u,patchFlag:h,dirs:d}=e;if(null!=a&&Et(a,null,n,e,!0),256&u)return void t.ctx.deactivate(e);const p=1&u&&d,f=!ue(e);let g;if(f&&(g=o&&o.onVnodeBeforeUnmount)&&fn(g,t,e),6&u)J(e.component,n,r);else{if(128&u)return void e.suspense.unmount(n,r);p&&xe(e,null,t,"beforeUnmount"),64&u?e.type.remove(e,t,n,s,ee,r):l&&(i!==Ut||h>0&&64&h)?Q(l,t,n,!1,!0):(i===Ut&&384&h||!s&&16&u)&&Q(c,t,n),r&&W(e)}(f&&(g=o&&o.onVnodeUnmounted)||p)&&St((()=>{g&&fn(g,t,e),p&&xe(e,null,t,"unmounted")}),n)},W=e=>{const{type:t,el:n,anchor:r,transition:s}=e;if(t===Ut)return void Y(n,r);if(t===jt)return void T(e);const i=()=>{o(n),s&&!s.persisted&&s.afterLeave&&s.afterLeave()};if(1&e.shapeFlag&&s&&!s.persisted){const{leave:t,delayLeave:r}=s,o=()=>t(n,i);r?r(e.el,i,o):o()}else i()},Y=(e,t)=>{let n;while(e!==t)n=f(e),o(e),e=n;o(t)},J=(e,t,n)=>{const{bum:r,scope:i,update:o,subTree:a,um:c}=e;r&&(0,s.ir)(r),i.stop(),o&&(o.active=!1,G(a,e,t,n)),c&&St(c,t),St((()=>{e.isUnmounted=!0}),t),t&&t.pendingBranch&&!t.isUnmounted&&e.asyncDep&&!e.asyncResolved&&e.suspenseId===t.pendingId&&(t.deps--,0===t.deps&&t.resolve())},Q=(e,t,n,r=!1,s=!1,i=0)=>{for(let o=i;o<e.length;o++)G(e[o],t,n,r,s)},X=e=>6&e.shapeFlag?X(e.component.subTree):128&e.shapeFlag?e.suspense.next():f(e.anchor||e.el),Z=(e,t,n)=>{null==e?t._vnode&&G(t._vnode,null,null,!0):y(t._vnode||null,e,t,null,null,null,n),k(),A(),t._vnode=e},ee={p:y,um:G,m:q,r:W,mt:B,mc:O,pc:$,pbc:N,n:X,o:e};let te,ne;return t&&([te,ne]=t(ee)),{render:Z,hydrate:te,createApp:vt(Z,te)}}function Tt({effect:e,update:t},n){e.allowRecurse=t.allowRecurse=n}function Ct(e,t,n=!1){const r=e.children,i=t.children;if((0,s.kJ)(r)&&(0,s.kJ)(i))for(let s=0;s<r.length;s++){const e=r[s];let t=i[s];1&t.shapeFlag&&!t.dynamicChildren&&((t.patchFlag<=0||32===t.patchFlag)&&(t=i[s]=hn(i[s]),t.el=e.el),n||Ct(e,t)),t.type===Vt&&(t.el=e.el)}}function It(e){const t=e.slice(),n=[0];let r,s,i,o,a;const c=e.length;for(r=0;r<c;r++){const c=e[r];if(0!==c){if(s=n[n.length-1],e[s]<c){t[r]=s,n.push(r);continue}i=0,o=n.length-1;while(i<o)a=i+o>>1,e[n[a]]<c?i=a+1:o=a;c<e[n[i]]&&(i>0&&(t[r]=n[i-1]),n[i]=r)}}i=n.length,o=n[i-1];while(i-- >0)n[i]=o,o=t[o];return n}const Rt=e=>e.__isTeleport,Ot=e=>e&&(e.disabled||""===e.disabled),xt=e=>"undefined"!==typeof SVGElement&&e instanceof SVGElement,Nt=(e,t)=>{const n=e&&e.to;if((0,s.HD)(n)){if(t){const e=t(n);return e}return null}return n},Dt={__isTeleport:!0,process(e,t,n,r,s,i,o,a,c,l){const{mc:u,pc:h,pbc:d,o:{insert:p,querySelector:f,createText:g,createComment:m}}=l,y=Ot(t.props);let{shapeFlag:w,children:b,dynamicChildren:v}=t;if(null==e){const e=t.el=g(""),l=t.anchor=g("");p(e,n,r),p(l,n,r);const h=t.target=Nt(t.props,f),d=t.targetAnchor=g("");h&&(p(d,h),o=o||xt(h));const m=(e,t)=>{16&w&&u(b,e,t,s,i,o,a,c)};y?m(n,l):h&&m(h,d)}else{t.el=e.el;const r=t.anchor=e.anchor,u=t.target=e.target,p=t.targetAnchor=e.targetAnchor,g=Ot(e.props),m=g?n:u,w=g?r:p;if(o=o||xt(u),v?(d(e.dynamicChildren,v,m,s,i,o,a),Ct(e,t,!0)):c||h(e,t,m,w,s,i,o,a,!1),y)g||Pt(t,n,r,l,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const e=t.target=Nt(t.props,f);e&&Pt(t,e,null,l,0)}else g&&Pt(t,u,p,l,1)}Bt(t)},remove(e,t,n,r,{um:s,o:{remove:i}},o){const{shapeFlag:a,children:c,anchor:l,targetAnchor:u,target:h,props:d}=e;if(h&&i(u),(o||!Ot(d))&&(i(l),16&a))for(let p=0;p<c.length;p++){const e=c[p];s(e,t,n,!0,!!e.dynamicChildren)}},move:Pt,hydrate:Lt};function Pt(e,t,n,{o:{insert:r},m:s},i=2){0===i&&r(e.targetAnchor,t,n);const{el:o,anchor:a,shapeFlag:c,children:l,props:u}=e,h=2===i;if(h&&r(o,t,n),(!h||Ot(u))&&16&c)for(let d=0;d<l.length;d++)s(l[d],t,n,2);h&&r(a,t,n)}function Lt(e,t,n,r,s,i,{o:{nextSibling:o,parentNode:a,querySelector:c}},l){const u=t.target=Nt(t.props,c);if(u){const c=u._lpa||u.firstChild;if(16&t.shapeFlag)if(Ot(t.props))t.anchor=l(o(e),t,a(e),n,r,s,i),t.targetAnchor=c;else{t.anchor=o(e);let a=c;while(a)if(a=o(a),a&&8===a.nodeType&&"teleport anchor"===a.data){t.targetAnchor=a,u._lpa=t.targetAnchor&&o(t.targetAnchor);break}l(c,t,u,n,r,s,i)}Bt(t)}return t.anchor&&o(t.anchor)}const Mt=Dt;function Bt(e){const t=e.ctx;if(t&&t.ut){let n=e.children[0].el;while(n!==e.targetAnchor)1===n.nodeType&&n.setAttribute("data-v-owner",t.uid),n=n.nextSibling;t.ut()}}const Ut=Symbol(void 0),Vt=Symbol(void 0),Ft=Symbol(void 0),jt=Symbol(void 0),zt=[];let $t=null;function Ht(e=!1){zt.push($t=e?null:[])}function Kt(){zt.pop(),$t=zt[zt.length-1]||null}let qt=1;function Gt(e){qt+=e}function Wt(e){return e.dynamicChildren=qt>0?$t||s.Z6:null,Kt(),qt>0&&$t&&$t.push(e),e}function Yt(e,t,n,r,s,i){return Wt(nn(e,t,n,r,s,i,!0))}function Jt(e,t,n,r,s){return Wt(rn(e,t,n,r,s,!0))}function Qt(e){return!!e&&!0===e.__v_isVNode}function Xt(e,t){return e.type===t.type&&e.key===t.key}const Zt="__vInternal",en=({key:e})=>null!=e?e:null,tn=({ref:e,ref_key:t,ref_for:n})=>null!=e?(0,s.HD)(e)||(0,r.dq)(e)||(0,s.mf)(e)?{i:N,r:e,k:t,f:!!n}:e:null;function nn(e,t=null,n=null,r=0,i=null,o=(e===Ut?0:1),a=!1,c=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&en(t),ref:t&&tn(t),scopeId:D,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:r,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:N};return c?(dn(l,n),128&o&&e.normalize(l)):n&&(l.shapeFlag|=(0,s.HD)(n)?8:16),qt>0&&!a&&$t&&(l.patchFlag>0||6&o)&&32!==l.patchFlag&&$t.push(l),l}const rn=sn;function sn(e,t=null,n=null,i=0,o=null,a=!1){if(e&&e!==Pe||(e=Ft),Qt(e)){const r=an(e,t,!0);return n&&dn(r,n),qt>0&&!a&&$t&&(6&r.shapeFlag?$t[$t.indexOf(e)]=r:$t.push(r)),r.patchFlag|=-2,r}if(Pn(e)&&(e=e.__vccOpts),t){t=on(t);let{class:e,style:n}=t;e&&!(0,s.HD)(e)&&(t.class=(0,s.C_)(e)),(0,s.Kn)(n)&&((0,r.X3)(n)&&!(0,s.kJ)(n)&&(n=(0,s.l7)({},n)),t.style=(0,s.j5)(n))}const c=(0,s.HD)(e)?1:z(e)?128:Rt(e)?64:(0,s.Kn)(e)?4:(0,s.mf)(e)?2:0;return nn(e,t,n,i,o,c,a,!0)}function on(e){return e?(0,r.X3)(e)||Zt in e?(0,s.l7)({},e):e:null}function an(e,t,n=!1){const{props:r,ref:i,patchFlag:o,children:a}=e,c=t?pn(r||{},t):r,l={__v_isVNode:!0,__v_skip:!0,type:e.type,props:c,key:c&&en(c),ref:t&&t.ref?n&&i?(0,s.kJ)(i)?i.concat(tn(t)):[i,tn(t)]:tn(t):i,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:a,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Ut?-1===o?16:16|o:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&an(e.ssContent),ssFallback:e.ssFallback&&an(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce};return l}function cn(e=" ",t=0){return rn(Vt,null,e,t)}function ln(e="",t=!1){return t?(Ht(),Jt(Ft,null,e)):rn(Ft,null,e)}function un(e){return null==e||"boolean"===typeof e?rn(Ft):(0,s.kJ)(e)?rn(Ut,null,e.slice()):"object"===typeof e?hn(e):rn(Vt,null,String(e))}function hn(e){return null===e.el&&-1!==e.patchFlag||e.memo?e:an(e)}function dn(e,t){let n=0;const{shapeFlag:r}=e;if(null==t)t=null;else if((0,s.kJ)(t))n=16;else if("object"===typeof t){if(65&r){const n=t.default;return void(n&&(n._c&&(n._d=!1),dn(e,n()),n._c&&(n._d=!0)))}{n=32;const r=t._;r||Zt in t?3===r&&N&&(1===N.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=N}}else(0,s.mf)(t)?(t={default:t,_ctx:N},n=32):(t=String(t),64&r?(n=16,t=[cn(t)]):n=8);e.children=t,e.shapeFlag|=n}function pn(...e){const t={};for(let n=0;n<e.length;n++){const r=e[n];for(const e in r)if("class"===e)t.class!==r.class&&(t.class=(0,s.C_)([t.class,r.class]));else if("style"===e)t.style=(0,s.j5)([t.style,r.style]);else if((0,s.F7)(e)){const n=t[e],i=r[e];!i||n===i||(0,s.kJ)(n)&&n.includes(i)||(t[e]=n?[].concat(n,i):i)}else""!==e&&(t[e]=r[e])}return t}function fn(e,t,n,r=null){o(e,t,7,[n,r])}const gn=wt();let mn=0;function yn(e,t,n){const i=e.type,o=(t?t.appContext:e.appContext)||gn,a={uid:mn++,vnode:e,type:i,parent:t,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,scope:new r.Bj(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(o.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ot(i,o),emitsOptions:O(i,o),emit:null,emitted:null,propsDefaults:s.kT,inheritAttrs:i.inheritAttrs,ctx:s.kT,data:s.kT,props:s.kT,attrs:s.kT,slots:s.kT,refs:s.kT,setupState:s.kT,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=t?t.root:a,a.emit=R.bind(null,a),e.ce&&e.ce(a),a}let wn=null;const bn=()=>wn||N,vn=e=>{wn=e,e.scope.on()},En=()=>{wn&&wn.scope.off(),wn=null};function _n(e){return 4&e.vnode.shapeFlag}let Sn,kn,An=!1;function Tn(e,t=!1){An=t;const{props:n,children:r}=e.vnode,s=_n(e);nt(e,n,s,t),mt(e,r);const i=s?Cn(e,t):void 0;return An=!1,i}function Cn(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=(0,r.Xl)(new Proxy(e.ctx,je));const{setup:o}=n;if(o){const n=e.setupContext=o.length>1?xn(e):null;vn(e),(0,r.Jd)();const c=i(o,e,0,[e.props,n]);if((0,r.lk)(),En(),(0,s.tI)(c)){if(c.then(En,En),t)return c.then((n=>{In(e,n,t)})).catch((t=>{a(t,e,0)}));e.asyncDep=c}else In(e,c,t)}else Rn(e,t)}function In(e,t,n){(0,s.mf)(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:(0,s.Kn)(t)&&(e.setupState=(0,r.WL)(t)),Rn(e,n)}function Rn(e,t,n){const i=e.type;if(!e.render){if(!t&&Sn&&!i.render){const t=i.template||Ge(e).template;if(t){0;const{isCustomElement:n,compilerOptions:r}=e.appContext.config,{delimiters:o,compilerOptions:a}=i,c=(0,s.l7)((0,s.l7)({isCustomElement:n,delimiters:o},r),a);i.render=Sn(t,c)}}e.render=i.render||s.dG,kn&&kn(e)}vn(e),(0,r.Jd)(),$e(e),(0,r.lk)(),En()}function On(e){return new Proxy(e.attrs,{get(t,n){return(0,r.j)(e,"get","$attrs"),t[n]}})}function xn(e){const t=t=>{e.exposed=t||{}};let n;return{get attrs(){return n||(n=On(e))},slots:e.slots,emit:e.emit,expose:t}}function Nn(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy((0,r.WL)((0,r.Xl)(e.exposed)),{get(t,n){return n in t?t[n]:n in Ve?Ve[n](e):void 0},has(e,t){return t in e||t in Ve}}))}function Dn(e,t=!0){return(0,s.mf)(e)?e.displayName||e.name:e.name||t&&e.__name}function Pn(e){return(0,s.mf)(e)&&"__vccOpts"in e}const Ln=(e,t)=>(0,r.Fl)(e,t,An);function Mn(e,t,n){const r=arguments.length;return 2===r?(0,s.Kn)(t)&&!(0,s.kJ)(t)?Qt(t)?rn(e,null,[t]):rn(e,t):rn(e,null,t):(r>3?n=Array.prototype.slice.call(arguments,2):3===r&&Qt(n)&&(n=[n]),rn(e,t,n))}const Bn=Symbol(""),Un=()=>{{const e=K(Bn);return e}};const Vn="3.2.47"},9242:function(e,t,n){"use strict";n.d(t,{ri:function(){return ce}});n(7658);var r=n(7139),s=n(3396),i=n(4870);const o="http://www.w3.org/2000/svg",a="undefined"!==typeof document?document:null,c=a&&a.createElement("template"),l={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,r)=>{const s=t?a.createElementNS(o,e):a.createElement(e,n?{is:n}:void 0);return"select"===e&&r&&null!=r.multiple&&s.setAttribute("multiple",r.multiple),s},createText:e=>a.createTextNode(e),createComment:e=>a.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>a.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,r,s,i){const o=n?n.previousSibling:t.lastChild;if(s&&(s===i||s.nextSibling)){while(1)if(t.insertBefore(s.cloneNode(!0),n),s===i||!(s=s.nextSibling))break}else{c.innerHTML=r?`<svg>${e}</svg>`:e;const s=c.content;if(r){const e=s.firstChild;while(e.firstChild)s.appendChild(e.firstChild);s.removeChild(e)}t.insertBefore(s,n)}return[o?o.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}};function u(e,t,n){const r=e._vtc;r&&(t=(t?[t,...r]:[...r]).join(" ")),null==t?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}function h(e,t,n){const s=e.style,i=(0,r.HD)(n);if(n&&!i){if(t&&!(0,r.HD)(t))for(const e in t)null==n[e]&&p(s,e,"");for(const e in n)p(s,e,n[e])}else{const r=s.display;i?t!==n&&(s.cssText=n):t&&e.removeAttribute("style"),"_vod"in e&&(s.display=r)}}const d=/\s*!important$/;function p(e,t,n){if((0,r.kJ)(n))n.forEach((n=>p(e,t,n)));else if(null==n&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const s=m(e,t);d.test(n)?e.setProperty((0,r.rs)(s),n.replace(d,""),"important"):e[s]=n}}const f=["Webkit","Moz","ms"],g={};function m(e,t){const n=g[t];if(n)return n;let s=(0,r._A)(t);if("filter"!==s&&s in e)return g[t]=s;s=(0,r.kC)(s);for(let r=0;r<f.length;r++){const n=f[r]+s;if(n in e)return g[t]=n}return t}const y="http://www.w3.org/1999/xlink";function w(e,t,n,s,i){if(s&&t.startsWith("xlink:"))null==n?e.removeAttributeNS(y,t.slice(6,t.length)):e.setAttributeNS(y,t,n);else{const s=(0,r.Pq)(t);null==n||s&&!(0,r.yA)(n)?e.removeAttribute(t):e.setAttribute(t,s?"":n)}}function b(e,t,n,s,i,o,a){if("innerHTML"===t||"textContent"===t)return s&&a(s,i,o),void(e[t]=null==n?"":n);if("value"===t&&"PROGRESS"!==e.tagName&&!e.tagName.includes("-")){e._value=n;const r=null==n?"":n;return e.value===r&&"OPTION"!==e.tagName||(e.value=r),void(null==n&&e.removeAttribute(t))}let c=!1;if(""===n||null==n){const s=typeof e[t];"boolean"===s?n=(0,r.yA)(n):null==n&&"string"===s?(n="",c=!0):"number"===s&&(n=0,c=!0)}try{e[t]=n}catch(l){0}c&&e.removeAttribute(t)}function v(e,t,n,r){e.addEventListener(t,n,r)}function E(e,t,n,r){e.removeEventListener(t,n,r)}function _(e,t,n,r,s=null){const i=e._vei||(e._vei={}),o=i[t];if(r&&o)o.value=r;else{const[n,a]=k(t);if(r){const o=i[t]=I(r,s);v(e,n,o,a)}else o&&(E(e,n,o,a),i[t]=void 0)}}const S=/(?:Once|Passive|Capture)$/;function k(e){let t;if(S.test(e)){let n;t={};while(n=e.match(S))e=e.slice(0,e.length-n[0].length),t[n[0].toLowerCase()]=!0}const n=":"===e[2]?e.slice(3):(0,r.rs)(e.slice(2));return[n,t]}let A=0;const T=Promise.resolve(),C=()=>A||(T.then((()=>A=0)),A=Date.now());function I(e,t){const n=e=>{if(e._vts){if(e._vts<=n.attached)return}else e._vts=Date.now();(0,s.$d)(R(e,n.value),t,5,[e])};return n.value=e,n.attached=C(),n}function R(e,t){if((0,r.kJ)(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map((e=>t=>!t._stopped&&e&&e(t)))}return t}const O=/^on[a-z]/,x=(e,t,n,s,i=!1,o,a,c,l)=>{"class"===t?u(e,s,i):"style"===t?h(e,n,s):(0,r.F7)(t)?(0,r.tR)(t)||_(e,t,n,s,a):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):N(e,t,s,i))?b(e,t,s,o,a,c,l):("true-value"===t?e._trueValue=s:"false-value"===t&&(e._falseValue=s),w(e,t,s,i))};function N(e,t,n,s){return s?"innerHTML"===t||"textContent"===t||!!(t in e&&O.test(t)&&(0,r.mf)(n)):"spellcheck"!==t&&"draggable"!==t&&"translate"!==t&&("form"!==t&&(("list"!==t||"INPUT"!==e.tagName)&&(("type"!==t||"TEXTAREA"!==e.tagName)&&((!O.test(t)||!(0,r.HD)(n))&&t in e))))}"undefined"!==typeof HTMLElement&&HTMLElement;const D="transition",P="animation",L=(e,{slots:t})=>(0,s.h)(s.P$,F(e),t);L.displayName="Transition";const M={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},B=L.props=(0,r.l7)({},s.P$.props,M),U=(e,t=[])=>{(0,r.kJ)(e)?e.forEach((e=>e(...t))):e&&e(...t)},V=e=>!!e&&((0,r.kJ)(e)?e.some((e=>e.length>1)):e.length>1);function F(e){const t={};for(const r in e)r in M||(t[r]=e[r]);if(!1===e.css)return t;const{name:n="v",type:s,duration:i,enterFromClass:o=`${n}-enter-from`,enterActiveClass:a=`${n}-enter-active`,enterToClass:c=`${n}-enter-to`,appearFromClass:l=o,appearActiveClass:u=a,appearToClass:h=c,leaveFromClass:d=`${n}-leave-from`,leaveActiveClass:p=`${n}-leave-active`,leaveToClass:f=`${n}-leave-to`}=e,g=j(i),m=g&&g[0],y=g&&g[1],{onBeforeEnter:w,onEnter:b,onEnterCancelled:v,onLeave:E,onLeaveCancelled:_,onBeforeAppear:S=w,onAppear:k=b,onAppearCancelled:A=v}=t,T=(e,t,n)=>{H(e,t?h:c),H(e,t?u:a),n&&n()},C=(e,t)=>{e._isLeaving=!1,H(e,d),H(e,f),H(e,p),t&&t()},I=e=>(t,n)=>{const r=e?k:b,i=()=>T(t,e,n);U(r,[t,i]),K((()=>{H(t,e?l:o),$(t,e?h:c),V(r)||G(t,s,m,i)}))};return(0,r.l7)(t,{onBeforeEnter(e){U(w,[e]),$(e,o),$(e,a)},onBeforeAppear(e){U(S,[e]),$(e,l),$(e,u)},onEnter:I(!1),onAppear:I(!0),onLeave(e,t){e._isLeaving=!0;const n=()=>C(e,t);$(e,d),Q(),$(e,p),K((()=>{e._isLeaving&&(H(e,d),$(e,f),V(E)||G(e,s,y,n))})),U(E,[e,n])},onEnterCancelled(e){T(e,!1),U(v,[e])},onAppearCancelled(e){T(e,!0),U(A,[e])},onLeaveCancelled(e){C(e),U(_,[e])}})}function j(e){if(null==e)return null;if((0,r.Kn)(e))return[z(e.enter),z(e.leave)];{const t=z(e);return[t,t]}}function z(e){const t=(0,r.He)(e);return t}function $(e,t){t.split(/\s+/).forEach((t=>t&&e.classList.add(t))),(e._vtc||(e._vtc=new Set)).add(t)}function H(e,t){t.split(/\s+/).forEach((t=>t&&e.classList.remove(t)));const{_vtc:n}=e;n&&(n.delete(t),n.size||(e._vtc=void 0))}function K(e){requestAnimationFrame((()=>{requestAnimationFrame(e)}))}let q=0;function G(e,t,n,r){const s=e._endId=++q,i=()=>{s===e._endId&&r()};if(n)return setTimeout(i,n);const{type:o,timeout:a,propCount:c}=W(e,t);if(!o)return r();const l=o+"end";let u=0;const h=()=>{e.removeEventListener(l,d),i()},d=t=>{t.target===e&&++u>=c&&h()};setTimeout((()=>{u<c&&h()}),a+1),e.addEventListener(l,d)}function W(e,t){const n=window.getComputedStyle(e),r=e=>(n[e]||"").split(", "),s=r(`${D}Delay`),i=r(`${D}Duration`),o=Y(s,i),a=r(`${P}Delay`),c=r(`${P}Duration`),l=Y(a,c);let u=null,h=0,d=0;t===D?o>0&&(u=D,h=o,d=i.length):t===P?l>0&&(u=P,h=l,d=c.length):(h=Math.max(o,l),u=h>0?o>l?D:P:null,d=u?u===D?i.length:c.length:0);const p=u===D&&/\b(transform|all)(,|$)/.test(r(`${D}Property`).toString());return{type:u,timeout:h,propCount:d,hasTransform:p}}function Y(e,t){while(e.length<t.length)e=e.concat(e);return Math.max(...t.map(((t,n)=>J(t)+J(e[n]))))}function J(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function Q(){return document.body.offsetHeight}const X=new WeakMap,Z=new WeakMap,ee={name:"TransitionGroup",props:(0,r.l7)({},B,{tag:String,moveClass:String}),setup(e,{slots:t}){const n=(0,s.FN)(),r=(0,s.Y8)();let o,a;return(0,s.ic)((()=>{if(!o.length)return;const t=e.moveClass||`${e.name||"v"}-move`;if(!se(o[0].el,n.vnode.el,t))return;o.forEach(te),o.forEach(ne);const r=o.filter(re);Q(),r.forEach((e=>{const n=e.el,r=n.style;$(n,t),r.transform=r.webkitTransform=r.transitionDuration="";const s=n._moveCb=e=>{e&&e.target!==n||e&&!/transform$/.test(e.propertyName)||(n.removeEventListener("transitionend",s),n._moveCb=null,H(n,t))};n.addEventListener("transitionend",s)}))})),()=>{const c=(0,i.IU)(e),l=F(c);let u=c.tag||s.HY;o=a,a=t.default?(0,s.Q6)(t.default()):[];for(let e=0;e<a.length;e++){const t=a[e];null!=t.key&&(0,s.nK)(t,(0,s.U2)(t,l,r,n))}if(o)for(let e=0;e<o.length;e++){const t=o[e];(0,s.nK)(t,(0,s.U2)(t,l,r,n)),X.set(t,t.el.getBoundingClientRect())}return(0,s.Wm)(u,null,a)}}};ee.props;function te(e){const t=e.el;t._moveCb&&t._moveCb(),t._enterCb&&t._enterCb()}function ne(e){Z.set(e,e.el.getBoundingClientRect())}function re(e){const t=X.get(e),n=Z.get(e),r=t.left-n.left,s=t.top-n.top;if(r||s){const t=e.el.style;return t.transform=t.webkitTransform=`translate(${r}px,${s}px)`,t.transitionDuration="0s",e}}function se(e,t,n){const r=e.cloneNode();e._vtc&&e._vtc.forEach((e=>{e.split(/\s+/).forEach((e=>e&&r.classList.remove(e)))})),n.split(/\s+/).forEach((e=>e&&r.classList.add(e))),r.style.display="none";const s=1===t.nodeType?t:t.parentNode;s.appendChild(r);const{hasTransform:i}=W(r);return s.removeChild(r),i}const ie=(0,r.l7)({patchProp:x},l);let oe;function ae(){return oe||(oe=(0,s.Us)(ie))}const ce=(...e)=>{const t=ae().createApp(...e);const{mount:n}=t;return t.mount=e=>{const s=le(e);if(!s)return;const i=t._component;(0,r.mf)(i)||i.render||i.template||(i.template=s.innerHTML),s.innerHTML="";const o=n(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},t};function le(e){if((0,r.HD)(e)){const t=document.querySelector(e);return t}return e}},7139:function(e,t,n){"use strict";n.d(t,{C_:function(){return h},DM:function(){return D},E9:function(){return oe},F7:function(){return A},Gg:function(){return q},HD:function(){return B},He:function(){return se},Kj:function(){return L},Kn:function(){return V},NO:function(){return S},Nj:function(){return ne},Od:function(){return I},PO:function(){return H},Pq:function(){return p},RI:function(){return O},S0:function(){return K},W7:function(){return $},WV:function(){return m},Z6:function(){return E},_A:function(){return Y},_N:function(){return N},aU:function(){return ee},dG:function(){return _},e1:function(){return i},fY:function(){return r},h5:function(){return re},hR:function(){return Z},hq:function(){return y},ir:function(){return te},j5:function(){return o},kC:function(){return X},kJ:function(){return x},kT:function(){return v},l7:function(){return C},mf:function(){return M},rs:function(){return Q},tI:function(){return F},tR:function(){return T},yA:function(){return f},yk:function(){return U},zw:function(){return w}});n(7658);function r(e,t){const n=Object.create(null),r=e.split(",");for(let s=0;s<r.length;s++)n[r[s]]=!0;return t?e=>!!n[e.toLowerCase()]:e=>!!n[e]}const s="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt",i=r(s);function o(e){if(x(e)){const t={};for(let n=0;n<e.length;n++){const r=e[n],s=B(r)?u(r):o(r);if(s)for(const e in s)t[e]=s[e]}return t}return B(e)||V(e)?e:void 0}const a=/;(?![^(]*\))/g,c=/:([^]+)/,l=/\/\*.*?\*\//gs;function u(e){const t={};return e.replace(l,"").split(a).forEach((e=>{if(e){const n=e.split(c);n.length>1&&(t[n[0].trim()]=n[1].trim())}})),t}function h(e){let t="";if(B(e))t=e;else if(x(e))for(let n=0;n<e.length;n++){const r=h(e[n]);r&&(t+=r+" ")}else if(V(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const d="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",p=r(d);function f(e){return!!e||""===e}function g(e,t){if(e.length!==t.length)return!1;let n=!0;for(let r=0;n&&r<e.length;r++)n=m(e[r],t[r]);return n}function m(e,t){if(e===t)return!0;let n=P(e),r=P(t);if(n||r)return!(!n||!r)&&e.getTime()===t.getTime();if(n=U(e),r=U(t),n||r)return e===t;if(n=x(e),r=x(t),n||r)return!(!n||!r)&&g(e,t);if(n=V(e),r=V(t),n||r){if(!n||!r)return!1;const s=Object.keys(e).length,i=Object.keys(t).length;if(s!==i)return!1;for(const n in e){const r=e.hasOwnProperty(n),s=t.hasOwnProperty(n);if(r&&!s||!r&&s||!m(e[n],t[n]))return!1}}return String(e)===String(t)}function y(e,t){return e.findIndex((e=>m(e,t)))}const w=e=>B(e)?e:null==e?"":x(e)||V(e)&&(e.toString===j||!M(e.toString))?JSON.stringify(e,b,2):String(e),b=(e,t)=>t&&t.__v_isRef?b(e,t.value):N(t)?{[`Map(${t.size})`]:[...t.entries()].reduce(((e,[t,n])=>(e[`${t} =>`]=n,e)),{})}:D(t)?{[`Set(${t.size})`]:[...t.values()]}:!V(t)||x(t)||H(t)?t:String(t),v={},E=[],_=()=>{},S=()=>!1,k=/^on[^a-z]/,A=e=>k.test(e),T=e=>e.startsWith("onUpdate:"),C=Object.assign,I=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},R=Object.prototype.hasOwnProperty,O=(e,t)=>R.call(e,t),x=Array.isArray,N=e=>"[object Map]"===z(e),D=e=>"[object Set]"===z(e),P=e=>"[object Date]"===z(e),L=e=>"[object RegExp]"===z(e),M=e=>"function"===typeof e,B=e=>"string"===typeof e,U=e=>"symbol"===typeof e,V=e=>null!==e&&"object"===typeof e,F=e=>V(e)&&M(e.then)&&M(e.catch),j=Object.prototype.toString,z=e=>j.call(e),$=e=>z(e).slice(8,-1),H=e=>"[object Object]"===z(e),K=e=>B(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,q=r(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),G=e=>{const t=Object.create(null);return n=>{const r=t[n];return r||(t[n]=e(n))}},W=/-(\w)/g,Y=G((e=>e.replace(W,((e,t)=>t?t.toUpperCase():"")))),J=/\B([A-Z])/g,Q=G((e=>e.replace(J,"-$1").toLowerCase())),X=G((e=>e.charAt(0).toUpperCase()+e.slice(1))),Z=G((e=>e?`on${X(e)}`:"")),ee=(e,t)=>!Object.is(e,t),te=(e,t)=>{for(let n=0;n<e.length;n++)e[n](t)},ne=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})},re=e=>{const t=parseFloat(e);return isNaN(t)?e:t},se=e=>{const t=B(e)?Number(e):NaN;return isNaN(t)?e:t};let ie;const oe=()=>ie||(ie="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{})},5431:function(e,t,n){"use strict";n.d(t,{z:function(){return i}});var r,s=function(){return Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/))};function i(e,t){void 0===t&&(t={});var n=t.registrationOptions;void 0===n&&(n={}),delete t.registrationOptions;var i=function(e){var n=[],r=arguments.length-1;while(r-- >0)n[r]=arguments[r+1];t&&t[e]&&t[e].apply(t,n)};"serviceWorker"in navigator&&r.then((function(){s()?(c(e,i,n),navigator.serviceWorker.ready.then((function(e){i("ready",e)})).catch((function(e){return o(i,e)}))):(a(e,i,n),navigator.serviceWorker.ready.then((function(e){i("ready",e)})).catch((function(e){return o(i,e)})))}))}function o(e,t){navigator.onLine||e("offline"),e("error",t)}function a(e,t,n){navigator.serviceWorker.register(e,n).then((function(e){t("registered",e),e.waiting?t("updated",e):e.onupdatefound=function(){t("updatefound",e);var n=e.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?t("updated",e):t("cached",e))}}})).catch((function(e){return o(t,e)}))}function c(e,t,n){fetch(e).then((function(r){404===r.status?(t("error",new Error("Service worker not found at "+e)),l()):-1===r.headers.get("content-type").indexOf("javascript")?(t("error",new Error("Expected "+e+" to have javascript content-type, but received "+r.headers.get("content-type"))),l()):a(e,t,n)})).catch((function(e){return o(t,e)}))}function l(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){return o(emit,e)}))}"undefined"!==typeof window&&(r="undefined"!==typeof Promise?new Promise((function(e){return window.addEventListener("load",e)})):{then:function(e){return window.addEventListener("load",e)}})},89:function(e,t){"use strict";t.Z=(e,t)=>{const n=e.__vccOpts||e;for(const[r,s]of t)n[r]=s;return n}},65:function(e,t,n){"use strict";n.d(t,{MT:function(){return ee}});n(7658),n(541);var r=n(3396),s=n(4870);function i(){return o().__VUE_DEVTOOLS_GLOBAL_HOOK__}function o(){return"undefined"!==typeof navigator&&"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{}}const a="function"===typeof Proxy,c="devtools-plugin:setup",l="plugin:settings:set";let u,h;function d(){var e;return void 0!==u||("undefined"!==typeof window&&window.performance?(u=!0,h=window.performance):"undefined"!==typeof n.g&&(null===(e=n.g.perf_hooks)||void 0===e?void 0:e.performance)?(u=!0,h=n.g.perf_hooks.performance):u=!1),u}function p(){return d()?h.now():Date.now()}class f{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;const n={};if(e.settings)for(const o in e.settings){const t=e.settings[o];n[o]=t.defaultValue}const r=`__vue-devtools-plugin-settings__${e.id}`;let s=Object.assign({},n);try{const e=localStorage.getItem(r),t=JSON.parse(e);Object.assign(s,t)}catch(i){}this.fallbacks={getSettings(){return s},setSettings(e){try{localStorage.setItem(r,JSON.stringify(e))}catch(i){}s=e},now(){return p()}},t&&t.on(l,((e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)})),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,t)=>this.target?this.target[t]:"on"===t?this.proxiedOn:Object.keys(this.fallbacks).includes(t)?(...e)=>(this.targetQueue.push({method:t,args:e,resolve:()=>{}}),this.fallbacks[t](...e)):(...e)=>new Promise((n=>{this.targetQueue.push({method:t,args:e,resolve:n})}))})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const t of this.targetQueue)t.resolve(await this.target[t.method](...t.args))}}function g(e,t){const n=e,r=o(),s=i(),l=a&&n.enableEarlyProxy;if(!s||!r.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&l){const e=l?new f(n,s):null,i=r.__VUE_DEVTOOLS_PLUGINS__=r.__VUE_DEVTOOLS_PLUGINS__||[];i.push({pluginDescriptor:n,setupFn:t,proxy:e}),e&&t(e.proxiedTarget)}else s.emit(c,e,t)}
/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */
var m="store";function y(e,t){Object.keys(e).forEach((function(n){return t(e[n],n)}))}function w(e){return null!==e&&"object"===typeof e}function b(e){return e&&"function"===typeof e.then}function v(e,t){return function(){return e(t)}}function E(e,t,n){return t.indexOf(e)<0&&(n&&n.prepend?t.unshift(e):t.push(e)),function(){var n=t.indexOf(e);n>-1&&t.splice(n,1)}}function _(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var n=e.state;k(e,n,[],e._modules.root,!0),S(e,n,t)}function S(e,t,n){var i=e._state,o=e._scope;e.getters={},e._makeLocalGettersCache=Object.create(null);var a=e._wrappedGetters,c={},l={},u=(0,s.B)(!0);u.run((function(){y(a,(function(t,n){c[n]=v(t,e),l[n]=(0,r.Fl)((function(){return c[n]()})),Object.defineProperty(e.getters,n,{get:function(){return l[n].value},enumerable:!0})}))})),e._state=(0,s.qj)({data:t}),e._scope=u,e.strict&&O(e),i&&n&&e._withCommit((function(){i.data=null})),o&&o.stop()}function k(e,t,n,r,s){var i=!n.length,o=e._modules.getNamespace(n);if(r.namespaced&&(e._modulesNamespaceMap[o],e._modulesNamespaceMap[o]=r),!i&&!s){var a=x(t,n.slice(0,-1)),c=n[n.length-1];e._withCommit((function(){a[c]=r.state}))}var l=r.context=A(e,o,n);r.forEachMutation((function(t,n){var r=o+n;C(e,r,t,l)})),r.forEachAction((function(t,n){var r=t.root?n:o+n,s=t.handler||t;I(e,r,s,l)})),r.forEachGetter((function(t,n){var r=o+n;R(e,r,t,l)})),r.forEachChild((function(r,i){k(e,t,n.concat(i),r,s)}))}function A(e,t,n){var r=""===t,s={dispatch:r?e.dispatch:function(n,r,s){var i=N(n,r,s),o=i.payload,a=i.options,c=i.type;return a&&a.root||(c=t+c),e.dispatch(c,o)},commit:r?e.commit:function(n,r,s){var i=N(n,r,s),o=i.payload,a=i.options,c=i.type;a&&a.root||(c=t+c),e.commit(c,o,a)}};return Object.defineProperties(s,{getters:{get:r?function(){return e.getters}:function(){return T(e,t)}},state:{get:function(){return x(e.state,n)}}}),s}function T(e,t){if(!e._makeLocalGettersCache[t]){var n={},r=t.length;Object.keys(e.getters).forEach((function(s){if(s.slice(0,r)===t){var i=s.slice(r);Object.defineProperty(n,i,{get:function(){return e.getters[s]},enumerable:!0})}})),e._makeLocalGettersCache[t]=n}return e._makeLocalGettersCache[t]}function C(e,t,n,r){var s=e._mutations[t]||(e._mutations[t]=[]);s.push((function(t){n.call(e,r.state,t)}))}function I(e,t,n,r){var s=e._actions[t]||(e._actions[t]=[]);s.push((function(t){var s=n.call(e,{dispatch:r.dispatch,commit:r.commit,getters:r.getters,state:r.state,rootGetters:e.getters,rootState:e.state},t);return b(s)||(s=Promise.resolve(s)),e._devtoolHook?s.catch((function(t){throw e._devtoolHook.emit("vuex:error",t),t})):s}))}function R(e,t,n,r){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(e){return n(r.state,r.getters,e.state,e.getters)})}function O(e){(0,r.YP)((function(){return e._state.data}),(function(){0}),{deep:!0,flush:"sync"})}function x(e,t){return t.reduce((function(e,t){return e[t]}),e)}function N(e,t,n){return w(e)&&e.type&&(n=t,t=e,e=e.type),{type:e,payload:t,options:n}}var D="vuex bindings",P="vuex:mutations",L="vuex:actions",M="vuex",B=0;function U(e,t){g({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[D]},(function(n){n.addTimelineLayer({id:P,label:"Vuex Mutations",color:V}),n.addTimelineLayer({id:L,label:"Vuex Actions",color:V}),n.addInspector({id:M,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree((function(n){if(n.app===e&&n.inspectorId===M)if(n.filter){var r=[];K(r,t._modules.root,n.filter,""),n.rootNodes=r}else n.rootNodes=[H(t._modules.root,"")]})),n.on.getInspectorState((function(n){if(n.app===e&&n.inspectorId===M){var r=n.nodeId;T(t,r),n.state=q(W(t._modules,r),"root"===r?t.getters:t._makeLocalGettersCache,r)}})),n.on.editInspectorState((function(n){if(n.app===e&&n.inspectorId===M){var r=n.nodeId,s=n.path;"root"!==r&&(s=r.split("/").filter(Boolean).concat(s)),t._withCommit((function(){n.set(t._state.data,s,n.state.value)}))}})),t.subscribe((function(e,t){var r={};e.payload&&(r.payload=e.payload),r.state=t,n.notifyComponentUpdate(),n.sendInspectorTree(M),n.sendInspectorState(M),n.addTimelineEvent({layerId:P,event:{time:Date.now(),title:e.type,data:r}})})),t.subscribeAction({before:function(e,t){var r={};e.payload&&(r.payload=e.payload),e._id=B++,e._time=Date.now(),r.state=t,n.addTimelineEvent({layerId:L,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:r}})},after:function(e,t){var r={},s=Date.now()-e._time;r.duration={_custom:{type:"duration",display:s+"ms",tooltip:"Action duration",value:s}},e.payload&&(r.payload=e.payload),r.state=t,n.addTimelineEvent({layerId:L,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:r}})}})}))}var V=8702998,F=6710886,j=16777215,z={label:"namespaced",textColor:j,backgroundColor:F};function $(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function H(e,t){return{id:t||"root",label:$(t),tags:e.namespaced?[z]:[],children:Object.keys(e._children).map((function(n){return H(e._children[n],t+n+"/")}))}}function K(e,t,n,r){r.includes(n)&&e.push({id:r||"root",label:r.endsWith("/")?r.slice(0,r.length-1):r||"Root",tags:t.namespaced?[z]:[]}),Object.keys(t._children).forEach((function(s){K(e,t._children[s],n,r+s+"/")}))}function q(e,t,n){t="root"===n?t:t[n];var r=Object.keys(t),s={state:Object.keys(e.state).map((function(t){return{key:t,editable:!0,value:e.state[t]}}))};if(r.length){var i=G(t);s.getters=Object.keys(i).map((function(e){return{key:e.endsWith("/")?$(e):e,editable:!1,value:Y((function(){return i[e]}))}}))}return s}function G(e){var t={};return Object.keys(e).forEach((function(n){var r=n.split("/");if(r.length>1){var s=t,i=r.pop();r.forEach((function(e){s[e]||(s[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),s=s[e]._custom.value})),s[i]=Y((function(){return e[n]}))}else t[n]=Y((function(){return e[n]}))})),t}function W(e,t){var n=t.split("/").filter((function(e){return e}));return n.reduce((function(e,r,s){var i=e[r];if(!i)throw new Error('Missing module "'+r+'" for path "'+t+'".');return s===n.length-1?i:i._children}),"root"===t?e:e.root._children)}function Y(e){try{return e()}catch(t){return t}}var J=function(e,t){this.runtime=t,this._children=Object.create(null),this._rawModule=e;var n=e.state;this.state=("function"===typeof n?n():n)||{}},Q={namespaced:{configurable:!0}};Q.namespaced.get=function(){return!!this._rawModule.namespaced},J.prototype.addChild=function(e,t){this._children[e]=t},J.prototype.removeChild=function(e){delete this._children[e]},J.prototype.getChild=function(e){return this._children[e]},J.prototype.hasChild=function(e){return e in this._children},J.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},J.prototype.forEachChild=function(e){y(this._children,e)},J.prototype.forEachGetter=function(e){this._rawModule.getters&&y(this._rawModule.getters,e)},J.prototype.forEachAction=function(e){this._rawModule.actions&&y(this._rawModule.actions,e)},J.prototype.forEachMutation=function(e){this._rawModule.mutations&&y(this._rawModule.mutations,e)},Object.defineProperties(J.prototype,Q);var X=function(e){this.register([],e,!1)};function Z(e,t,n){if(t.update(n),n.modules)for(var r in n.modules){if(!t.getChild(r))return void 0;Z(e.concat(r),t.getChild(r),n.modules[r])}}X.prototype.get=function(e){return e.reduce((function(e,t){return e.getChild(t)}),this.root)},X.prototype.getNamespace=function(e){var t=this.root;return e.reduce((function(e,n){return t=t.getChild(n),e+(t.namespaced?n+"/":"")}),"")},X.prototype.update=function(e){Z([],this.root,e)},X.prototype.register=function(e,t,n){var r=this;void 0===n&&(n=!0);var s=new J(t,n);if(0===e.length)this.root=s;else{var i=this.get(e.slice(0,-1));i.addChild(e[e.length-1],s)}t.modules&&y(t.modules,(function(t,s){r.register(e.concat(s),t,n)}))},X.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1],r=t.getChild(n);r&&r.runtime&&t.removeChild(n)},X.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),n=e[e.length-1];return!!t&&t.hasChild(n)};function ee(e){return new te(e)}var te=function(e){var t=this;void 0===e&&(e={});var n=e.plugins;void 0===n&&(n=[]);var r=e.strict;void 0===r&&(r=!1);var s=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new X(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=s;var i=this,o=this,a=o.dispatch,c=o.commit;this.dispatch=function(e,t){return a.call(i,e,t)},this.commit=function(e,t,n){return c.call(i,e,t,n)},this.strict=r;var l=this._modules.root.state;k(this,l,[],this._modules.root),S(this,l),n.forEach((function(e){return e(t)}))},ne={state:{configurable:!0}};te.prototype.install=function(e,t){e.provide(t||m,this),e.config.globalProperties.$store=this;var n=void 0!==this._devtools&&this._devtools;n&&U(e,this)},ne.state.get=function(){return this._state.data},ne.state.set=function(e){0},te.prototype.commit=function(e,t,n){var r=this,s=N(e,t,n),i=s.type,o=s.payload,a=(s.options,{type:i,payload:o}),c=this._mutations[i];c&&(this._withCommit((function(){c.forEach((function(e){e(o)}))})),this._subscribers.slice().forEach((function(e){return e(a,r.state)})))},te.prototype.dispatch=function(e,t){var n=this,r=N(e,t),s=r.type,i=r.payload,o={type:s,payload:i},a=this._actions[s];if(a){try{this._actionSubscribers.slice().filter((function(e){return e.before})).forEach((function(e){return e.before(o,n.state)}))}catch(l){0}var c=a.length>1?Promise.all(a.map((function(e){return e(i)}))):a[0](i);return new Promise((function(e,t){c.then((function(t){try{n._actionSubscribers.filter((function(e){return e.after})).forEach((function(e){return e.after(o,n.state)}))}catch(l){0}e(t)}),(function(e){try{n._actionSubscribers.filter((function(e){return e.error})).forEach((function(t){return t.error(o,n.state,e)}))}catch(l){0}t(e)}))}))}},te.prototype.subscribe=function(e,t){return E(e,this._subscribers,t)},te.prototype.subscribeAction=function(e,t){var n="function"===typeof e?{before:e}:e;return E(n,this._actionSubscribers,t)},te.prototype.watch=function(e,t,n){var s=this;return(0,r.YP)((function(){return e(s.state,s.getters)}),t,Object.assign({},n))},te.prototype.replaceState=function(e){var t=this;this._withCommit((function(){t._state.data=e}))},te.prototype.registerModule=function(e,t,n){void 0===n&&(n={}),"string"===typeof e&&(e=[e]),this._modules.register(e,t),k(this,this.state,e,this._modules.get(e),n.preserveState),S(this,this.state)},te.prototype.unregisterModule=function(e){var t=this;"string"===typeof e&&(e=[e]),this._modules.unregister(e),this._withCommit((function(){var n=x(t.state,e.slice(0,-1));delete n[e[e.length-1]]})),_(this)},te.prototype.hasModule=function(e){return"string"===typeof e&&(e=[e]),this._modules.isRegistered(e)},te.prototype.hotUpdate=function(e){this._modules.update(e),_(this,!0)},te.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(te.prototype,ne);ie((function(e,t){var n={};return re(t).forEach((function(t){var r=t.key,s=t.val;n[r]=function(){var t=this.$store.state,n=this.$store.getters;if(e){var r=oe(this.$store,"mapState",e);if(!r)return;t=r.context.state,n=r.context.getters}return"function"===typeof s?s.call(this,t,n):t[s]},n[r].vuex=!0})),n})),ie((function(e,t){var n={};return re(t).forEach((function(t){var r=t.key,s=t.val;n[r]=function(){var t=[],n=arguments.length;while(n--)t[n]=arguments[n];var r=this.$store.commit;if(e){var i=oe(this.$store,"mapMutations",e);if(!i)return;r=i.context.commit}return"function"===typeof s?s.apply(this,[r].concat(t)):r.apply(this.$store,[s].concat(t))}})),n})),ie((function(e,t){var n={};return re(t).forEach((function(t){var r=t.key,s=t.val;s=e+s,n[r]=function(){if(!e||oe(this.$store,"mapGetters",e))return this.$store.getters[s]},n[r].vuex=!0})),n})),ie((function(e,t){var n={};return re(t).forEach((function(t){var r=t.key,s=t.val;n[r]=function(){var t=[],n=arguments.length;while(n--)t[n]=arguments[n];var r=this.$store.dispatch;if(e){var i=oe(this.$store,"mapActions",e);if(!i)return;r=i.context.dispatch}return"function"===typeof s?s.apply(this,[r].concat(t)):r.apply(this.$store,[s].concat(t))}})),n}));function re(e){return se(e)?Array.isArray(e)?e.map((function(e){return{key:e,val:e}})):Object.keys(e).map((function(t){return{key:t,val:e[t]}})):[]}function se(e){return Array.isArray(e)||w(e)}function ie(e){return function(t,n){return"string"!==typeof t?(n=t,t=""):"/"!==t.charAt(t.length-1)&&(t+="/"),e(t,n)}}function oe(e,t,n){var r=e._modulesNamespaceMap[n];return r}},4727:function(e,t,n){"use strict";e.exports=n.p+"img/remixicon.symbol.230157b7.svg"},4581:function(e,t,n){"use strict";var r,s,i;(function(o,a){s=[n(9145)],r=a,i="function"===typeof r?r.apply(t,s):r,void 0===i||(e.exports=i)})(0,(function(e){var t=e.Reader,n=e.Writer,r=e.util,s=e.roots["default"]||(e.roots["default"]={});return s.RPC=function(){function i(e){if(this.subscriptions=[],this.messages=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.subscriptions=r.emptyArray,i.prototype.messages=r.emptyArray,i.prototype.control=null,Object.defineProperty(i.prototype,"_control",{get:r.oneOfGetter(o=["control"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=n.create()),null!=e.subscriptions&&e.subscriptions.length)for(var r=0;r<e.subscriptions.length;++r)s.RPC.SubOpts.encode(e.subscriptions[r],t.uint32(10).fork()).ldelim();if(null!=e.messages&&e.messages.length)for(r=0;r<e.messages.length;++r)s.RPC.Message.encode(e.messages[r],t.uint32(18).fork()).ldelim();return null!=e.control&&Object.hasOwnProperty.call(e,"control")&&s.RPC.ControlMessage.encode(e.control,t.uint32(26).fork()).ldelim(),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.subscriptions&&i.subscriptions.length||(i.subscriptions=[]),i.subscriptions.push(s.RPC.SubOpts.decode(e,e.uint32()));break;case 2:i.messages&&i.messages.length||(i.messages=[]),i.messages.push(s.RPC.Message.decode(e,e.uint32()));break;case 3:i.control=s.RPC.ControlMessage.decode(e,e.uint32());break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC)return e;var t=new s.RPC;if(e.subscriptions){if(!Array.isArray(e.subscriptions))throw TypeError(".RPC.subscriptions: array expected");t.subscriptions=[];for(var n=0;n<e.subscriptions.length;++n){if("object"!==typeof e.subscriptions[n])throw TypeError(".RPC.subscriptions: object expected");t.subscriptions[n]=s.RPC.SubOpts.fromObject(e.subscriptions[n])}}if(e.messages){if(!Array.isArray(e.messages))throw TypeError(".RPC.messages: array expected");t.messages=[];for(n=0;n<e.messages.length;++n){if("object"!==typeof e.messages[n])throw TypeError(".RPC.messages: object expected");t.messages[n]=s.RPC.Message.fromObject(e.messages[n])}}if(null!=e.control){if("object"!==typeof e.control)throw TypeError(".RPC.control: object expected");t.control=s.RPC.ControlMessage.fromObject(e.control)}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.subscriptions=[],n.messages=[]),e.subscriptions&&e.subscriptions.length){n.subscriptions=[];for(var r=0;r<e.subscriptions.length;++r)n.subscriptions[r]=s.RPC.SubOpts.toObject(e.subscriptions[r],t)}if(e.messages&&e.messages.length){n.messages=[];for(r=0;r<e.messages.length;++r)n.messages[r]=s.RPC.Message.toObject(e.messages[r],t)}return null!=e.control&&e.hasOwnProperty("control")&&(n.control=s.RPC.ControlMessage.toObject(e.control,t),t.oneofs&&(n._control="control")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i.SubOpts=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.subscribe=null,i.prototype.topic=null,Object.defineProperty(i.prototype,"_subscribe",{get:r.oneOfGetter(o=["subscribe"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_topic",{get:r.oneOfGetter(o=["topic"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.subscribe&&Object.hasOwnProperty.call(e,"subscribe")&&t.uint32(8).bool(e.subscribe),null!=e.topic&&Object.hasOwnProperty.call(e,"topic")&&t.uint32(18).string(e.topic),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.SubOpts;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.subscribe=e.bool();break;case 2:i.topic=e.string();break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.SubOpts)return e;var t=new s.RPC.SubOpts;return null!=e.subscribe&&(t.subscribe=Boolean(e.subscribe)),null!=e.topic&&(t.topic=String(e.topic)),t},i.toObject=function(e,t){t||(t={});var n={};return null!=e.subscribe&&e.hasOwnProperty("subscribe")&&(n.subscribe=e.subscribe,t.oneofs&&(n._subscribe="subscribe")),null!=e.topic&&e.hasOwnProperty("topic")&&(n.topic=e.topic,t.oneofs&&(n._topic="topic")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.Message=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.from=null,i.prototype.data=null,i.prototype.seqno=null,i.prototype.topic="",i.prototype.signature=null,i.prototype.key=null,Object.defineProperty(i.prototype,"_from",{get:r.oneOfGetter(o=["from"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_data",{get:r.oneOfGetter(o=["data"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_seqno",{get:r.oneOfGetter(o=["seqno"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signature",{get:r.oneOfGetter(o=["signature"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_key",{get:r.oneOfGetter(o=["key"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.from&&Object.hasOwnProperty.call(e,"from")&&t.uint32(10).bytes(e.from),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),null!=e.seqno&&Object.hasOwnProperty.call(e,"seqno")&&t.uint32(26).bytes(e.seqno),t.uint32(34).string(e.topic),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(50).bytes(e.key),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var i=void 0===n?e.len:e.pos+n,o=new s.RPC.Message;while(e.pos<i){var a=e.uint32();switch(a>>>3){case 1:o.from=e.bytes();break;case 2:o.data=e.bytes();break;case 3:o.seqno=e.bytes();break;case 4:o.topic=e.string();break;case 5:o.signature=e.bytes();break;case 6:o.key=e.bytes();break;default:e.skipType(7&a);break}}if(!o.hasOwnProperty("topic"))throw r.ProtocolError("missing required 'topic'",{instance:o});return o},i.fromObject=function(e){if(e instanceof s.RPC.Message)return e;var t=new s.RPC.Message;return null!=e.from&&("string"===typeof e.from?r.base64.decode(e.from,t.from=r.newBuffer(r.base64.length(e.from)),0):e.from.length&&(t.from=e.from)),null!=e.data&&("string"===typeof e.data?r.base64.decode(e.data,t.data=r.newBuffer(r.base64.length(e.data)),0):e.data.length&&(t.data=e.data)),null!=e.seqno&&("string"===typeof e.seqno?r.base64.decode(e.seqno,t.seqno=r.newBuffer(r.base64.length(e.seqno)),0):e.seqno.length&&(t.seqno=e.seqno)),null!=e.topic&&(t.topic=String(e.topic)),null!=e.signature&&("string"===typeof e.signature?r.base64.decode(e.signature,t.signature=r.newBuffer(r.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),null!=e.key&&("string"===typeof e.key?r.base64.decode(e.key,t.key=r.newBuffer(r.base64.length(e.key)),0):e.key.length&&(t.key=e.key)),t},i.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.topic=""),null!=e.from&&e.hasOwnProperty("from")&&(n.from=t.bytes===String?r.base64.encode(e.from,0,e.from.length):t.bytes===Array?Array.prototype.slice.call(e.from):e.from,t.oneofs&&(n._from="from")),null!=e.data&&e.hasOwnProperty("data")&&(n.data=t.bytes===String?r.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data,t.oneofs&&(n._data="data")),null!=e.seqno&&e.hasOwnProperty("seqno")&&(n.seqno=t.bytes===String?r.base64.encode(e.seqno,0,e.seqno.length):t.bytes===Array?Array.prototype.slice.call(e.seqno):e.seqno,t.oneofs&&(n._seqno="seqno")),null!=e.topic&&e.hasOwnProperty("topic")&&(n.topic=e.topic),null!=e.signature&&e.hasOwnProperty("signature")&&(n.signature=t.bytes===String?r.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature,t.oneofs&&(n._signature="signature")),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.bytes===String?r.base64.encode(e.key,0,e.key.length):t.bytes===Array?Array.prototype.slice.call(e.key):e.key,t.oneofs&&(n._key="key")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlMessage=function(){function i(e){if(this.ihave=[],this.iwant=[],this.graft=[],this.prune=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return i.prototype.ihave=r.emptyArray,i.prototype.iwant=r.emptyArray,i.prototype.graft=r.emptyArray,i.prototype.prune=r.emptyArray,i.encode=function(e,t){if(t||(t=n.create()),null!=e.ihave&&e.ihave.length)for(var r=0;r<e.ihave.length;++r)s.RPC.ControlIHave.encode(e.ihave[r],t.uint32(10).fork()).ldelim();if(null!=e.iwant&&e.iwant.length)for(r=0;r<e.iwant.length;++r)s.RPC.ControlIWant.encode(e.iwant[r],t.uint32(18).fork()).ldelim();if(null!=e.graft&&e.graft.length)for(r=0;r<e.graft.length;++r)s.RPC.ControlGraft.encode(e.graft[r],t.uint32(26).fork()).ldelim();if(null!=e.prune&&e.prune.length)for(r=0;r<e.prune.length;++r)s.RPC.ControlPrune.encode(e.prune[r],t.uint32(34).fork()).ldelim();return t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlMessage;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.ihave&&i.ihave.length||(i.ihave=[]),i.ihave.push(s.RPC.ControlIHave.decode(e,e.uint32()));break;case 2:i.iwant&&i.iwant.length||(i.iwant=[]),i.iwant.push(s.RPC.ControlIWant.decode(e,e.uint32()));break;case 3:i.graft&&i.graft.length||(i.graft=[]),i.graft.push(s.RPC.ControlGraft.decode(e,e.uint32()));break;case 4:i.prune&&i.prune.length||(i.prune=[]),i.prune.push(s.RPC.ControlPrune.decode(e,e.uint32()));break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlMessage)return e;var t=new s.RPC.ControlMessage;if(e.ihave){if(!Array.isArray(e.ihave))throw TypeError(".RPC.ControlMessage.ihave: array expected");t.ihave=[];for(var n=0;n<e.ihave.length;++n){if("object"!==typeof e.ihave[n])throw TypeError(".RPC.ControlMessage.ihave: object expected");t.ihave[n]=s.RPC.ControlIHave.fromObject(e.ihave[n])}}if(e.iwant){if(!Array.isArray(e.iwant))throw TypeError(".RPC.ControlMessage.iwant: array expected");t.iwant=[];for(n=0;n<e.iwant.length;++n){if("object"!==typeof e.iwant[n])throw TypeError(".RPC.ControlMessage.iwant: object expected");t.iwant[n]=s.RPC.ControlIWant.fromObject(e.iwant[n])}}if(e.graft){if(!Array.isArray(e.graft))throw TypeError(".RPC.ControlMessage.graft: array expected");t.graft=[];for(n=0;n<e.graft.length;++n){if("object"!==typeof e.graft[n])throw TypeError(".RPC.ControlMessage.graft: object expected");t.graft[n]=s.RPC.ControlGraft.fromObject(e.graft[n])}}if(e.prune){if(!Array.isArray(e.prune))throw TypeError(".RPC.ControlMessage.prune: array expected");t.prune=[];for(n=0;n<e.prune.length;++n){if("object"!==typeof e.prune[n])throw TypeError(".RPC.ControlMessage.prune: object expected");t.prune[n]=s.RPC.ControlPrune.fromObject(e.prune[n])}}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.ihave=[],n.iwant=[],n.graft=[],n.prune=[]),e.ihave&&e.ihave.length){n.ihave=[];for(var r=0;r<e.ihave.length;++r)n.ihave[r]=s.RPC.ControlIHave.toObject(e.ihave[r],t)}if(e.iwant&&e.iwant.length){n.iwant=[];for(r=0;r<e.iwant.length;++r)n.iwant[r]=s.RPC.ControlIWant.toObject(e.iwant[r],t)}if(e.graft&&e.graft.length){n.graft=[];for(r=0;r<e.graft.length;++r)n.graft[r]=s.RPC.ControlGraft.toObject(e.graft[r],t)}if(e.prune&&e.prune.length){n.prune=[];for(r=0;r<e.prune.length;++r)n.prune[r]=s.RPC.ControlPrune.toObject(e.prune[r],t)}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIHave=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.topicID=null,i.prototype.messageIDs=r.emptyArray,Object.defineProperty(i.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=n.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.messageIDs&&e.messageIDs.length)for(var r=0;r<e.messageIDs.length;++r)t.uint32(18).bytes(e.messageIDs[r]);return t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlIHave;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes());break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIHave)return e;var t=new s.RPC.ControlIHave;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIHave.messageIDs: array expected");t.messageIDs=[];for(var n=0;n<e.messageIDs.length;++n)"string"===typeof e.messageIDs[n]?r.base64.decode(e.messageIDs[n],t.messageIDs[n]=r.newBuffer(r.base64.length(e.messageIDs[n])),0):e.messageIDs[n].length&&(t.messageIDs[n]=e.messageIDs[n])}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.messageIDs=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(n.topicID=e.topicID,t.oneofs&&(n._topicID="topicID")),e.messageIDs&&e.messageIDs.length){n.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)n.messageIDs[s]=t.bytes===String?r.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlIWant=function(){function i(e){if(this.messageIDs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return i.prototype.messageIDs=r.emptyArray,i.encode=function(e,t){if(t||(t=n.create()),null!=e.messageIDs&&e.messageIDs.length)for(var r=0;r<e.messageIDs.length;++r)t.uint32(10).bytes(e.messageIDs[r]);return t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlIWant;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.messageIDs&&i.messageIDs.length||(i.messageIDs=[]),i.messageIDs.push(e.bytes());break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlIWant)return e;var t=new s.RPC.ControlIWant;if(e.messageIDs){if(!Array.isArray(e.messageIDs))throw TypeError(".RPC.ControlIWant.messageIDs: array expected");t.messageIDs=[];for(var n=0;n<e.messageIDs.length;++n)"string"===typeof e.messageIDs[n]?r.base64.decode(e.messageIDs[n],t.messageIDs[n]=r.newBuffer(r.base64.length(e.messageIDs[n])),0):e.messageIDs[n].length&&(t.messageIDs[n]=e.messageIDs[n])}return t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.messageIDs=[]),e.messageIDs&&e.messageIDs.length){n.messageIDs=[];for(var s=0;s<e.messageIDs.length;++s)n.messageIDs[s]=t.bytes===String?r.base64.encode(e.messageIDs[s],0,e.messageIDs[s].length):t.bytes===Array?Array.prototype.slice.call(e.messageIDs[s]):e.messageIDs[s]}return n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlGraft=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.topicID=null,Object.defineProperty(i.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlGraft;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlGraft)return e;var t=new s.RPC.ControlGraft;return null!=e.topicID&&(t.topicID=String(e.topicID)),t},i.toObject=function(e,t){t||(t={});var n={};return null!=e.topicID&&e.hasOwnProperty("topicID")&&(n.topicID=e.topicID,t.oneofs&&(n._topicID="topicID")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.ControlPrune=function(){function i(e){if(this.peers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.topicID=null,i.prototype.peers=r.emptyArray,i.prototype.backoff=null,Object.defineProperty(i.prototype,"_topicID",{get:r.oneOfGetter(o=["topicID"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_backoff",{get:r.oneOfGetter(o=["backoff"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){if(t||(t=n.create()),null!=e.topicID&&Object.hasOwnProperty.call(e,"topicID")&&t.uint32(10).string(e.topicID),null!=e.peers&&e.peers.length)for(var r=0;r<e.peers.length;++r)s.RPC.PeerInfo.encode(e.peers[r],t.uint32(18).fork()).ldelim();return null!=e.backoff&&Object.hasOwnProperty.call(e,"backoff")&&t.uint32(24).uint64(e.backoff),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.ControlPrune;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.topicID=e.string();break;case 2:i.peers&&i.peers.length||(i.peers=[]),i.peers.push(s.RPC.PeerInfo.decode(e,e.uint32()));break;case 3:i.backoff=e.uint64();break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.ControlPrune)return e;var t=new s.RPC.ControlPrune;if(null!=e.topicID&&(t.topicID=String(e.topicID)),e.peers){if(!Array.isArray(e.peers))throw TypeError(".RPC.ControlPrune.peers: array expected");t.peers=[];for(var n=0;n<e.peers.length;++n){if("object"!==typeof e.peers[n])throw TypeError(".RPC.ControlPrune.peers: object expected");t.peers[n]=s.RPC.PeerInfo.fromObject(e.peers[n])}}return null!=e.backoff&&(r.Long?(t.backoff=r.Long.fromValue(e.backoff)).unsigned=!0:"string"===typeof e.backoff?t.backoff=parseInt(e.backoff,10):"number"===typeof e.backoff?t.backoff=e.backoff:"object"===typeof e.backoff&&(t.backoff=new r.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0))),t},i.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.peers=[]),null!=e.topicID&&e.hasOwnProperty("topicID")&&(n.topicID=e.topicID,t.oneofs&&(n._topicID="topicID")),e.peers&&e.peers.length){n.peers=[];for(var i=0;i<e.peers.length;++i)n.peers[i]=s.RPC.PeerInfo.toObject(e.peers[i],t)}return null!=e.backoff&&e.hasOwnProperty("backoff")&&("number"===typeof e.backoff?n.backoff=t.longs===String?String(e.backoff):e.backoff:n.backoff=t.longs===String?r.Long.prototype.toString.call(e.backoff):t.longs===Number?new r.LongBits(e.backoff.low>>>0,e.backoff.high>>>0).toNumber(!0):e.backoff,t.oneofs&&(n._backoff="backoff")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i.PeerInfo=function(){function i(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var o;return i.prototype.peerID=null,i.prototype.signedPeerRecord=null,Object.defineProperty(i.prototype,"_peerID",{get:r.oneOfGetter(o=["peerID"]),set:r.oneOfSetter(o)}),Object.defineProperty(i.prototype,"_signedPeerRecord",{get:r.oneOfGetter(o=["signedPeerRecord"]),set:r.oneOfSetter(o)}),i.encode=function(e,t){return t||(t=n.create()),null!=e.peerID&&Object.hasOwnProperty.call(e,"peerID")&&t.uint32(10).bytes(e.peerID),null!=e.signedPeerRecord&&Object.hasOwnProperty.call(e,"signedPeerRecord")&&t.uint32(18).bytes(e.signedPeerRecord),t},i.decode=function(e,n){e instanceof t||(e=t.create(e));var r=void 0===n?e.len:e.pos+n,i=new s.RPC.PeerInfo;while(e.pos<r){var o=e.uint32();switch(o>>>3){case 1:i.peerID=e.bytes();break;case 2:i.signedPeerRecord=e.bytes();break;default:e.skipType(7&o);break}}return i},i.fromObject=function(e){if(e instanceof s.RPC.PeerInfo)return e;var t=new s.RPC.PeerInfo;return null!=e.peerID&&("string"===typeof e.peerID?r.base64.decode(e.peerID,t.peerID=r.newBuffer(r.base64.length(e.peerID)),0):e.peerID.length&&(t.peerID=e.peerID)),null!=e.signedPeerRecord&&("string"===typeof e.signedPeerRecord?r.base64.decode(e.signedPeerRecord,t.signedPeerRecord=r.newBuffer(r.base64.length(e.signedPeerRecord)),0):e.signedPeerRecord.length&&(t.signedPeerRecord=e.signedPeerRecord)),t},i.toObject=function(e,t){t||(t={});var n={};return null!=e.peerID&&e.hasOwnProperty("peerID")&&(n.peerID=t.bytes===String?r.base64.encode(e.peerID,0,e.peerID.length):t.bytes===Array?Array.prototype.slice.call(e.peerID):e.peerID,t.oneofs&&(n._peerID="peerID")),null!=e.signedPeerRecord&&e.hasOwnProperty("signedPeerRecord")&&(n.signedPeerRecord=t.bytes===String?r.base64.encode(e.signedPeerRecord,0,e.signedPeerRecord.length):t.bytes===Array?Array.prototype.slice.call(e.signedPeerRecord):e.signedPeerRecord,t.oneofs&&(n._signedPeerRecord="signedPeerRecord")),n},i.prototype.toJSON=function(){return this.constructor.toObject(this,e.util.toJSONOptions)},i}(),i}(),s}))},1901:function(e){(function(){e.exports=m;var t=86400,n=3200,r=146097*n/400,s=t*r,i=1e3*s,o=864e13,a=4294967296,c=1e6,l="000000000",u=Math.trunc||function(e){var t=e-e%1;return 0==t&&(e<0||0===e&&1/e!=1/0)?-0:t},h=m.prototype,d=(m.fromDate=function(e){return new m(+e)},m.fromInt64BE=E(0,1,2,3,0,4),m.fromInt64LE=E(3,2,1,0,4,0),m.fromString=function(e){var t,n=new m;e=(e+="").replace(/^\s*[+\-]?\d+/,(function(e){e=+e;var t=1970+(e-1970)%400;return n.year=e-t,t})).replace(/(?:Z|([+\-]\d{2}):?(\d{2}))$/,(function(e,n,r){return n<0&&(r*=-1),t=6e4*(60*+n+ +r),""})).replace(/\.\d+$/,(function(e){return n.nano=+(e+l).substr(1,9),""})).split(/\D+/);if(1<e.length?e[1]--:e[1]=0,n.time=t=Date.UTC.apply(Date,e)-(t||0),isNaN(t))throw new TypeError("Invalid Date");return y(n)},m.fromTimeT=function(e){return b(e,0)},h.year=0,h.time=0,h.nano=0,h.addNano=function(e){return this.nano+=+e||0,this},h.getNano=function(){var e=y(this);return(e.time%1e3*c+ +e.nano+1e9)%1e9},h.getTimeT=function(){var e=y(this),s=Math.floor(e.time/1e3);e=e.year;return e&&(s+=e*r*t/n),s},h.getYear=function(){return this.toDate().getUTCFullYear()+this.year},h.toDate=function(){return w(y(this).time)},h.toJSON=function(){return this.toString().replace(/0{1,6}Z$/,"Z")},h.toString=function(e){var t=this,n=t.toDate(),r={H:function(){return S(n.getUTCHours())},L:function(){return k(n.getUTCMilliseconds(),3)},M:function(){return S(n.getUTCMinutes())},N:function(){return k(t.getNano(),9)},S:function(){return S(n.getUTCSeconds())},Y:function(){var e=t.getYear();return 999999<e?"+"+e:9999<e?"+"+k(e,6):0<=e?k(e,4):-999999<=e?"-"+k(-e,6):e},a:function(){return f[n.getUTCDay()]},b:function(){return p[n.getUTCMonth()]},d:function(){return S(n.getUTCDate())},e:function(){return function(e){return(9<e?"":" ")+(0|e)}(n.getUTCDate())},m:function(){return S(n.getUTCMonth()+1)}};return function e(t){return t.replace(/%./g,(function(t){var n=t[1],s=g[n];n=r[n];return s?e(s):n?n():t}))}(e||d)},h.writeInt64BE=v(0,1,2,3,0,4),h.writeInt64LE=v(3,2,1,0,4,0),"%Y-%m-%dT%H:%M:%S.%NZ"),p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],f=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],g={"%":"%",F:"%Y-%m-%d",n:"\n",R:"%H:%M",T:"%H:%M:%S",t:"\t",X:"%T",Z:"GMT",z:"+0000"};return m;function m(e,t,n){var r=this;if(!(r instanceof m))return new m(e,t,n);r.time=+e||0,r.nano=+t||0,r.year=+n||0,y(r)}function y(e){var t,r,s,a=e.year,l=e.time,h=e.nano,d=((h<0||c<=h)&&(h-=(r=Math.floor(h/c))*c,l+=r,r=1),a%n);return(l<-o||o<l||d)&&((t=u(l/i))&&(a+=t*n,l-=t*i),(s=w(l)).setUTCFullYear(d+s.getUTCFullYear()),s=(l=+s)+(t=u((a-=d)/n))*i,t&&-o<=s&&s<=o&&(a-=t*n,l=s),r=1),r&&(e.year=a,e.time=l,e.nano=h),e}function w(e){var t=new Date(0);return t.setTime(e),t}function b(e,t){e=+e||0;var r=u((t=(0|t)*a)/s)+u(e/s);t=t%s+e%s,e=u(t/s);return e&&(r+=e,t-=e*s),new m(1e3*t,0,r*n)}function v(e,s,i,o,c,l){return function(e,s){var i=y(this);e=e||new Array(8),_(e,s|=0);var o=Math.floor(i.time/1e3),d=(i=i.year*(r*t/n),u(i/a)+u(o/a));i=i%a+o%a,o=Math.floor(i/a);return o&&(d+=o,i-=o*a),h(e,s+c,d),h(e,s+l,i),e};function h(t,n,r){t[n+e]=r>>24&255,t[n+s]=r>>16&255,t[n+i]=r>>8&255,t[n+o]=255&r}}function E(e,t,n,r,s,i){return function(e,t){_(e,t|=0);var n=o(e,t+s);return b(o(e,t+i),n)};function o(s,i){return 16777216*s[i+e]+(s[i+t]<<16|s[i+n]<<8|s[i+r])}}function _(e,t){if(e=e&&e.length,null==e)throw new TypeError("Invalid Buffer");if(e<t+8)throw new RangeError("Out of range")}function S(e){return(9<e?"":"0")+(0|e)}function k(e,t){return(l+(0|e)).substr(-t)}})()},2039:function(e,t,n){"use strict";n.d(t,{Ue:function(){return $6}});var r={};n.r(r),n.d(r,{base58btc:function(){return Ae},base58flickr:function(){return Te}});var s={};n.r(s),n.d(s,{base32:function(){return Ce},base32hex:function(){return xe},base32hexpad:function(){return De},base32hexpadupper:function(){return Pe},base32hexupper:function(){return Ne},base32pad:function(){return Re},base32padupper:function(){return Oe},base32upper:function(){return Ie},base32z:function(){return Le}});var i={};n.r(i),n.d(i,{base64:function(){return Me},base64pad:function(){return Be},base64url:function(){return Ue},base64urlpad:function(){return Ve}});var o={};n.r(o),n.d(o,{code:function(){return wn},createLink:function(){return mn},createNode:function(){return gn},decode:function(){return vn},encode:function(){return bn},name:function(){return yn},prepare:function(){return pn},validate:function(){return fn}});var a={};n.r(a),n.d(a,{code:function(){return Xs},decode:function(){return ei},encode:function(){return Zs},name:function(){return Qs}});var c={};n.r(c),n.d(c,{code:function(){return yi},decode:function(){return bi},encode:function(){return wi},format:function(){return vi},name:function(){return mi},parse:function(){return _i},stringify:function(){return vi}});var l={};n.r(l),n.d(l,{code:function(){return Bi},decode:function(){return Hi},encode:function(){return $i},name:function(){return Mi},toGeneral:function(){return zi}});var u={};n.r(u),n.d(u,{identity:function(){return Yi}});var h={};n.r(h),n.d(h,{identity:function(){return Ji}});var d={};n.r(d),n.d(d,{base2:function(){return Qi}});var p={};n.r(p),n.d(p,{base8:function(){return Xi}});var f={};n.r(f),n.d(f,{base10:function(){return Zi}});var g={};n.r(g),n.d(g,{base16:function(){return eo},base16upper:function(){return to}});var m={};n.r(m),n.d(m,{base36:function(){return no},base36upper:function(){return ro}});var y={};n.r(y),n.d(y,{base256emoji:function(){return lo}});var w={};n.r(w),n.d(w,{sha256:function(){return ho},sha512:function(){return po}});var b={};n.r(b),n.d(b,{code:function(){return go},decode:function(){return yo},encode:function(){return mo},name:function(){return fo}});var v={};n.r(v),n.d(v,{code:function(){return Eo},decode:function(){return So},encode:function(){return _o},name:function(){return vo}});var E={};n.r(E),n.d(E,{RsaPrivateKey:function(){return up},RsaPublicKey:function(){return lp},fromJwk:function(){return pp},generateKeyPair:function(){return fp},unmarshalRsaPrivateKey:function(){return hp},unmarshalRsaPublicKey:function(){return dp}});var _={};n.r(_),n.d(_,{Ed25519PrivateKey:function(){return Af},Ed25519PublicKey:function(){return kf},generateKeyPair:function(){return If},generateKeyPairFromSeed:function(){return Rf},unmarshalEd25519PrivateKey:function(){return Tf},unmarshalEd25519PublicKey:function(){return Cf}});var S={};n.r(S),n.d(S,{Secp256k1PrivateKey:function(){return Vf},Secp256k1PublicKey:function(){return Uf},generateKeyPair:function(){return zf},unmarshalSecp256k1PrivateKey:function(){return Ff},unmarshalSecp256k1PublicKey:function(){return jf}});var k={};n.r(k),n.d(k,{InvalidValueError:function(){return oD},MissingRepoOptionsError:function(){return aD},NonReversibleMigrationError:function(){return rD},NotInitializedRepoError:function(){return sD},RequiredParameterError:function(){return iD}});var A={};n.r(A),n.d(A,{identity:function(){return SM}});var T={};n.r(T),n.d(T,{base2:function(){return kM}});var C={};n.r(C),n.d(C,{base8:function(){return AM}});var I={};n.r(I),n.d(I,{base10:function(){return TM}});var R={};n.r(R),n.d(R,{base16:function(){return CM},base16upper:function(){return IM}});var O={};n.r(O),n.d(O,{base32:function(){return RM},base32hex:function(){return DM},base32hexpad:function(){return LM},base32hexpadupper:function(){return MM},base32hexupper:function(){return PM},base32pad:function(){return xM},base32padupper:function(){return NM},base32upper:function(){return OM},base32z:function(){return BM}});var x={};n.r(x),n.d(x,{base36:function(){return UM},base36upper:function(){return VM}});var N={};n.r(N),n.d(N,{base58btc:function(){return FM},base58flickr:function(){return jM}});var D={};n.r(D),n.d(D,{base64:function(){return zM},base64pad:function(){return $M},base64url:function(){return HM},base64urlpad:function(){return KM}});var P={};n.r(P),n.d(P,{base256emoji:function(){return QM}});var L={};n.r(L),n.d(L,{sha256:function(){return IB},sha512:function(){return RB}});var M={};n.r(M),n.d(M,{identity:function(){return PB}});var B={};n.r(B),n.d(B,{code:function(){return MB},decode:function(){return UB},encode:function(){return BB},name:function(){return LB}});var U={};n.r(U),n.d(U,{code:function(){return zB},decode:function(){return HB},encode:function(){return $B},name:function(){return jB}});var V={};n.r(V),n.d(V,{identity:function(){return hV}});var F={};n.r(F),n.d(F,{base2:function(){return dV}});var j={};n.r(j),n.d(j,{base8:function(){return pV}});var z={};n.r(z),n.d(z,{base10:function(){return fV}});var $={};n.r($),n.d($,{base16:function(){return gV},base16upper:function(){return mV}});var H={};n.r(H),n.d(H,{base32:function(){return yV},base32hex:function(){return EV},base32hexpad:function(){return SV},base32hexpadupper:function(){return kV},base32hexupper:function(){return _V},base32pad:function(){return bV},base32padupper:function(){return vV},base32upper:function(){return wV},base32z:function(){return AV}});var K={};n.r(K),n.d(K,{base36:function(){return TV},base36upper:function(){return CV}});var q={};n.r(q),n.d(q,{base58btc:function(){return IV},base58flickr:function(){return RV}});var G={};n.r(G),n.d(G,{base64:function(){return OV},base64pad:function(){return xV},base64url:function(){return NV},base64urlpad:function(){return DV}});var W={};n.r(W),n.d(W,{base256emoji:function(){return VV}});var Y={};n.r(Y),n.d(Y,{sha256:function(){return mF},sha512:function(){return yF}});var J={};n.r(J),n.d(J,{identity:function(){return _F}});var Q={};n.r(Q),n.d(Q,{code:function(){return kF},decode:function(){return TF},encode:function(){return AF},name:function(){return SF}});var X={};n.r(X),n.d(X,{code:function(){return OF},decode:function(){return NF},encode:function(){return xF},name:function(){return RF}});var Z={};n.r(Z),n.d(Z,{Decoder:function(){return Gq},Encoder:function(){return qq},PacketType:function(){return Kq},protocol:function(){return Hq}});var ee={};n.r(ee),n.d(ee,{abortedError:function(){return y6},notFoundError:function(){return m6}});n(7658);var te=n(9610),ne=te,re=n(6338),se=n(2978);n(3767),n(8585),n(8696);function ie(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==n[o])throw new TypeError(i+" is ambiguous");n[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";var n=0,r=0,s=0,i=t.length;while(s!==i&&0===t[s])s++,n++;var o=(i-s)*u+1>>>0,l=new Uint8Array(o);while(s!==i){for(var h=t[s],d=0,p=o-1;(0!==h||d<r)&&-1!==p;p--,d++)h+=256*l[p]>>>0,l[p]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,s++}var f=o-r;while(f!==o&&0===l[f])f++;for(var g=c.repeat(n);f<o;++f)g+=e.charAt(l[f]);return g}function d(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){var r=0,s=0;while(e[t]===c)r++,t++;var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);while(e[t]){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<s)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,t++}if(" "!==e[t]){var p=i-s;while(p!==i&&0===o[p])p++;var f=new Uint8Array(r+(i-p)),g=r;while(p!==i)f[g++]=o[p++];return f}}}function p(e){var n=d(e);if(n)return n;throw new Error(`Non-${t} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var oe=ie,ae=oe,ce=ae;const le=new Uint8Array(0),ue=e=>{const t=e.match(/../g);return t?new Uint8Array(t.map((e=>parseInt(e,16)))):le},he=(e,t)=>{if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0},de=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},pe=e=>(new TextEncoder).encode(e),fe=e=>(new TextDecoder).decode(e);class ge{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class me{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return we(this,e)}}class ye{constructor(e){this.decoders=e}or(e){return we(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const we=(e,t)=>new ye({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class be{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new ge(e,t,n),this.decoder=new me(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ve=({name:e,prefix:t,encode:n,decode:r})=>new be(e,t,n,r),Ee=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:s}=ce(n,t);return ve({prefix:e,name:t,encode:r,decode:e=>de(s(e))})},_e=(e,t,n,r)=>{const s={};for(let u=0;u<t.length;++u)s[t[u]]=u;let i=e.length;while("="===e[i-1])--i;const o=new Uint8Array(i*n/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const t=s[e[u]];if(void 0===t)throw new SyntaxError(`Non-${r} character`);c=c<<n|t,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Se=(e,t,n)=>{const r="="===t[t.length-1],s=(1<<n)-1;let i="",o=0,a=0;for(let c=0;c<e.length;++c){a=a<<8|e[c],o+=8;while(o>n)o-=n,i+=t[s&a>>o]}if(o&&(i+=t[s&a<<n-o]),r)while(i.length*n&7)i+="=";return i},ke=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>ve({prefix:t,name:e,encode(e){return Se(e,r,n)},decode(t){return _e(t,r,n,e)}}),Ae=Ee({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Te=Ee({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Ce=ke({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ie=ke({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Re=ke({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Oe=ke({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),xe=ke({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Ne=ke({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),De=ke({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Pe=ke({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Le=ke({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),Me=ke({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Be=ke({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ue=ke({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ve=ke({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});function Fe(e){return Object.assign(se(e),{error:se(`${e}:error`),trace:se(`${e}:trace`)})}se.formatters.b=e=>null==e?"undefined":Ae.baseEncode(e),se.formatters.t=e=>null==e?"undefined":Ce.baseEncode(e),se.formatters.m=e=>null==e?"undefined":Me.baseEncode(e),se.formatters.p=e=>null==e?"undefined":e.toString(),se.formatters.c=e=>null==e?"undefined":e.toString(),se.formatters.k=e=>null==e?"undefined":e.toString();var je=n(1196),ze=n(8947);const $e=ze.Reader,He=ze.Writer,Ke=ze.util,qe=ze.roots["ipfs-unixfs"]||(ze.roots["ipfs-unixfs"]={}),Ge=qe.Data=(()=>{function e(e){if(this.blocksizes=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Type=0,e.prototype.Data=Ke.newBuffer([]),e.prototype.filesize=Ke.Long?Ke.Long.fromBits(0,0,!0):0,e.prototype.blocksizes=Ke.emptyArray,e.prototype.hashType=Ke.Long?Ke.Long.fromBits(0,0,!0):0,e.prototype.fanout=Ke.Long?Ke.Long.fromBits(0,0,!0):0,e.prototype.mode=0,e.prototype.mtime=null,e.encode=function(e,t){if(t||(t=He.create()),t.uint32(8).int32(e.Type),null!=e.Data&&Object.hasOwnProperty.call(e,"Data")&&t.uint32(18).bytes(e.Data),null!=e.filesize&&Object.hasOwnProperty.call(e,"filesize")&&t.uint32(24).uint64(e.filesize),null!=e.blocksizes&&e.blocksizes.length)for(var n=0;n<e.blocksizes.length;++n)t.uint32(32).uint64(e.blocksizes[n]);return null!=e.hashType&&Object.hasOwnProperty.call(e,"hashType")&&t.uint32(40).uint64(e.hashType),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(48).uint64(e.fanout),null!=e.mode&&Object.hasOwnProperty.call(e,"mode")&&t.uint32(56).uint32(e.mode),null!=e.mtime&&Object.hasOwnProperty.call(e,"mtime")&&qe.UnixTime.encode(e.mtime,t.uint32(66).fork()).ldelim(),t},e.decode=function(e,t){e instanceof $e||(e=$e.create(e));var n=void 0===t?e.len:e.pos+t,r=new qe.Data;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.Type=e.int32();break;case 2:r.Data=e.bytes();break;case 3:r.filesize=e.uint64();break;case 4:if(r.blocksizes&&r.blocksizes.length||(r.blocksizes=[]),2===(7&s)){var i=e.uint32()+e.pos;while(e.pos<i)r.blocksizes.push(e.uint64())}else r.blocksizes.push(e.uint64());break;case 5:r.hashType=e.uint64();break;case 6:r.fanout=e.uint64();break;case 7:r.mode=e.uint32();break;case 8:r.mtime=qe.UnixTime.decode(e,e.uint32());break;default:e.skipType(7&s);break}}if(!r.hasOwnProperty("Type"))throw Ke.ProtocolError("missing required 'Type'",{instance:r});return r},e.fromObject=function(e){if(e instanceof qe.Data)return e;var t=new qe.Data;switch(e.Type){case"Raw":case 0:t.Type=0;break;case"Directory":case 1:t.Type=1;break;case"File":case 2:t.Type=2;break;case"Metadata":case 3:t.Type=3;break;case"Symlink":case 4:t.Type=4;break;case"HAMTShard":case 5:t.Type=5;break}if(null!=e.Data&&("string"===typeof e.Data?Ke.base64.decode(e.Data,t.Data=Ke.newBuffer(Ke.base64.length(e.Data)),0):e.Data.length&&(t.Data=e.Data)),null!=e.filesize&&(Ke.Long?(t.filesize=Ke.Long.fromValue(e.filesize)).unsigned=!0:"string"===typeof e.filesize?t.filesize=parseInt(e.filesize,10):"number"===typeof e.filesize?t.filesize=e.filesize:"object"===typeof e.filesize&&(t.filesize=new Ke.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0))),e.blocksizes){if(!Array.isArray(e.blocksizes))throw TypeError(".Data.blocksizes: array expected");t.blocksizes=[];for(var n=0;n<e.blocksizes.length;++n)Ke.Long?(t.blocksizes[n]=Ke.Long.fromValue(e.blocksizes[n])).unsigned=!0:"string"===typeof e.blocksizes[n]?t.blocksizes[n]=parseInt(e.blocksizes[n],10):"number"===typeof e.blocksizes[n]?t.blocksizes[n]=e.blocksizes[n]:"object"===typeof e.blocksizes[n]&&(t.blocksizes[n]=new Ke.LongBits(e.blocksizes[n].low>>>0,e.blocksizes[n].high>>>0).toNumber(!0))}if(null!=e.hashType&&(Ke.Long?(t.hashType=Ke.Long.fromValue(e.hashType)).unsigned=!0:"string"===typeof e.hashType?t.hashType=parseInt(e.hashType,10):"number"===typeof e.hashType?t.hashType=e.hashType:"object"===typeof e.hashType&&(t.hashType=new Ke.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0))),null!=e.fanout&&(Ke.Long?(t.fanout=Ke.Long.fromValue(e.fanout)).unsigned=!0:"string"===typeof e.fanout?t.fanout=parseInt(e.fanout,10):"number"===typeof e.fanout?t.fanout=e.fanout:"object"===typeof e.fanout&&(t.fanout=new Ke.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0))),null!=e.mode&&(t.mode=e.mode>>>0),null!=e.mtime){if("object"!==typeof e.mtime)throw TypeError(".Data.mtime: object expected");t.mtime=qe.UnixTime.fromObject(e.mtime)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocksizes=[]),t.defaults){if(n.Type=t.enums===String?"Raw":0,t.bytes===String?n.Data="":(n.Data=[],t.bytes!==Array&&(n.Data=Ke.newBuffer(n.Data))),Ke.Long){var r=new Ke.Long(0,0,!0);n.filesize=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.filesize=t.longs===String?"0":0;if(Ke.Long){r=new Ke.Long(0,0,!0);n.hashType=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.hashType=t.longs===String?"0":0;if(Ke.Long){r=new Ke.Long(0,0,!0);n.fanout=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.fanout=t.longs===String?"0":0;n.mode=0,n.mtime=null}if(null!=e.Type&&e.hasOwnProperty("Type")&&(n.Type=t.enums===String?qe.Data.DataType[e.Type]:e.Type),null!=e.Data&&e.hasOwnProperty("Data")&&(n.Data=t.bytes===String?Ke.base64.encode(e.Data,0,e.Data.length):t.bytes===Array?Array.prototype.slice.call(e.Data):e.Data),null!=e.filesize&&e.hasOwnProperty("filesize")&&("number"===typeof e.filesize?n.filesize=t.longs===String?String(e.filesize):e.filesize:n.filesize=t.longs===String?Ke.Long.prototype.toString.call(e.filesize):t.longs===Number?new Ke.LongBits(e.filesize.low>>>0,e.filesize.high>>>0).toNumber(!0):e.filesize),e.blocksizes&&e.blocksizes.length){n.blocksizes=[];for(var s=0;s<e.blocksizes.length;++s)"number"===typeof e.blocksizes[s]?n.blocksizes[s]=t.longs===String?String(e.blocksizes[s]):e.blocksizes[s]:n.blocksizes[s]=t.longs===String?Ke.Long.prototype.toString.call(e.blocksizes[s]):t.longs===Number?new Ke.LongBits(e.blocksizes[s].low>>>0,e.blocksizes[s].high>>>0).toNumber(!0):e.blocksizes[s]}return null!=e.hashType&&e.hasOwnProperty("hashType")&&("number"===typeof e.hashType?n.hashType=t.longs===String?String(e.hashType):e.hashType:n.hashType=t.longs===String?Ke.Long.prototype.toString.call(e.hashType):t.longs===Number?new Ke.LongBits(e.hashType.low>>>0,e.hashType.high>>>0).toNumber(!0):e.hashType),null!=e.fanout&&e.hasOwnProperty("fanout")&&("number"===typeof e.fanout?n.fanout=t.longs===String?String(e.fanout):e.fanout:n.fanout=t.longs===String?Ke.Long.prototype.toString.call(e.fanout):t.longs===Number?new Ke.LongBits(e.fanout.low>>>0,e.fanout.high>>>0).toNumber(!0):e.fanout),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=e.mode),null!=e.mtime&&e.hasOwnProperty("mtime")&&(n.mtime=qe.UnixTime.toObject(e.mtime,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.DataType=function(){const e={},t=Object.create(e);return t[e[0]="Raw"]=0,t[e[1]="Directory"]=1,t[e[2]="File"]=2,t[e[3]="Metadata"]=3,t[e[4]="Symlink"]=4,t[e[5]="HAMTShard"]=5,t}(),e})(),We=(qe.UnixTime=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.Seconds=Ke.Long?Ke.Long.fromBits(0,0,!1):0,e.prototype.FractionalNanoseconds=0,e.encode=function(e,t){return t||(t=He.create()),t.uint32(8).int64(e.Seconds),null!=e.FractionalNanoseconds&&Object.hasOwnProperty.call(e,"FractionalNanoseconds")&&t.uint32(21).fixed32(e.FractionalNanoseconds),t},e.decode=function(e,t){e instanceof $e||(e=$e.create(e));var n=void 0===t?e.len:e.pos+t,r=new qe.UnixTime;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.Seconds=e.int64();break;case 2:r.FractionalNanoseconds=e.fixed32();break;default:e.skipType(7&s);break}}if(!r.hasOwnProperty("Seconds"))throw Ke.ProtocolError("missing required 'Seconds'",{instance:r});return r},e.fromObject=function(e){if(e instanceof qe.UnixTime)return e;var t=new qe.UnixTime;return null!=e.Seconds&&(Ke.Long?(t.Seconds=Ke.Long.fromValue(e.Seconds)).unsigned=!1:"string"===typeof e.Seconds?t.Seconds=parseInt(e.Seconds,10):"number"===typeof e.Seconds?t.Seconds=e.Seconds:"object"===typeof e.Seconds&&(t.Seconds=new Ke.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber())),null!=e.FractionalNanoseconds&&(t.FractionalNanoseconds=e.FractionalNanoseconds>>>0),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(Ke.Long){var r=new Ke.Long(0,0,!1);n.Seconds=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.Seconds=t.longs===String?"0":0;n.FractionalNanoseconds=0}return null!=e.Seconds&&e.hasOwnProperty("Seconds")&&("number"===typeof e.Seconds?n.Seconds=t.longs===String?String(e.Seconds):e.Seconds:n.Seconds=t.longs===String?Ke.Long.prototype.toString.call(e.Seconds):t.longs===Number?new Ke.LongBits(e.Seconds.low>>>0,e.Seconds.high>>>0).toNumber():e.Seconds),null!=e.FractionalNanoseconds&&e.hasOwnProperty("FractionalNanoseconds")&&(n.FractionalNanoseconds=e.FractionalNanoseconds),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),qe.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.MimeType="",e.encode=function(e,t){return t||(t=He.create()),null!=e.MimeType&&Object.hasOwnProperty.call(e,"MimeType")&&t.uint32(10).string(e.MimeType),t},e.decode=function(e,t){e instanceof $e||(e=$e.create(e));var n=void 0===t?e.len:e.pos+t,r=new qe.Metadata;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.MimeType=e.string();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof qe.Metadata)return e;var t=new qe.Metadata;return null!=e.MimeType&&(t.MimeType=String(e.MimeType)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.MimeType=""),null!=e.MimeType&&e.hasOwnProperty("MimeType")&&(n.MimeType=e.MimeType),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),Ge),Ye=["raw","directory","file","metadata","symlink","hamt-sharded-directory"],Je=["directory","hamt-sharded-directory"],Qe=parseInt("0644",8),Xe=parseInt("0755",8);function Ze(e){if(null!=e)return"number"===typeof e?4095&e:(e=e.toString(),"0"===e.substring(0,1)?4095&parseInt(e,8):4095&parseInt(e,10))}function et(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw je(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}class tt{static unmarshal(e){const t=We.decode(e),n=We.toObject(t,{defaults:!1,arrays:!0,longs:Number,objects:!1}),r=new tt({type:Ye[n.Type],data:n.Data,blockSizes:n.blocksizes,mode:n.mode,mtime:n.mtime?{secs:n.mtime.Seconds,nsecs:n.mtime.FractionalNanoseconds}:void 0});return r._originalMode=n.mode||0,r}constructor(e={type:"file"}){const{type:t,data:n,blockSizes:r,hashType:s,fanout:i,mtime:o,mode:a}=e;if(t&&!Ye.includes(t))throw je(new Error("Type: "+t+" is not valid"),"ERR_INVALID_TYPE");this.type=t||"file",this.data=n,this.hashType=s,this.fanout=i,this.blockSizes=r||[],this._originalMode=0,this.mode=Ze(a),o&&(this.mtime=et(o),this.mtime&&!this.mtime.nsecs&&(this.mtime.nsecs=0))}set mode(e){this._mode=this.isDirectory()?Xe:Qe;const t=Ze(e);void 0!==t&&(this._mode=t)}get mode(){return this._mode}isDirectory(){return Boolean(this.type&&Je.includes(this.type))}addBlockSize(e){this.blockSizes.push(e)}removeBlockSize(e){this.blockSizes.splice(e,1)}fileSize(){if(this.isDirectory())return 0;let e=0;return this.blockSizes.forEach((t=>{e+=t})),this.data&&(e+=this.data.length),e}marshal(){let e;switch(this.type){case"raw":e=We.DataType.Raw;break;case"directory":e=We.DataType.Directory;break;case"file":e=We.DataType.File;break;case"metadata":e=We.DataType.Metadata;break;case"symlink":e=We.DataType.Symlink;break;case"hamt-sharded-directory":e=We.DataType.HAMTShard;break;default:throw je(new Error("Type: "+e+" is not valid"),"ERR_INVALID_TYPE")}let t,n,r=this.data;if(this.data&&this.data.length||(r=void 0),null!=this.mode&&(t=4294963200&this._originalMode|(Ze(this.mode)||0),t!==Qe||this.isDirectory()||(t=void 0),t===Xe&&this.isDirectory()&&(t=void 0)),null!=this.mtime){const e=et(this.mtime);e&&(n={Seconds:e.secs,FractionalNanoseconds:e.nsecs},0===n.FractionalNanoseconds&&delete n.FractionalNanoseconds)}const s={Type:e,Data:r,filesize:this.isDirectory()?void 0:this.fileSize(),blocksizes:this.blockSizes,hashType:this.hashType,fanout:this.fanout,mode:t,mtime:n};return We.encode(s).finish()}}var nt=at,rt=128,st=127,it=~st,ot=Math.pow(2,31);function at(e,t,n){t=t||[],n=n||0;var r=n;while(e>=ot)t[n++]=255&e|rt,e/=128;while(e&it)t[n++]=255&e|rt,e>>>=7;return t[n]=0|e,at.bytes=n-r+1,t}var ct=ht,lt=128,ut=127;function ht(e,t){var n,r=0,s=(t=t||0,0),i=t,o=e.length;do{if(i>=o)throw ht.bytes=0,new RangeError("Could not decode varint");n=e[i++],r+=s<28?(n&ut)<<s:(n&ut)*Math.pow(2,s),s+=7}while(n>=lt);return ht.bytes=i-t,r}var dt=Math.pow(2,7),pt=Math.pow(2,14),ft=Math.pow(2,21),gt=Math.pow(2,28),mt=Math.pow(2,35),yt=Math.pow(2,42),wt=Math.pow(2,49),bt=Math.pow(2,56),vt=Math.pow(2,63),Et=function(e){return e<dt?1:e<pt?2:e<ft?3:e<gt?4:e<mt?5:e<yt?6:e<wt?7:e<bt?8:e<vt?9:10},_t={encode:nt,decode:ct,encodingLength:Et},St=_t,kt=St;const At=(e,t=0)=>{const n=kt.decode(e,t);return[n,kt.decode.bytes]},Tt=(e,t,n=0)=>(kt.encode(e,t,n),t),Ct=e=>kt.encodingLength(e),It=(e,t)=>{const n=t.byteLength,r=Ct(e),s=r+Ct(n),i=new Uint8Array(s+n);return Tt(e,i,0),Tt(n,i,r),i.set(t,s),new xt(e,n,t,i)},Rt=e=>{const t=de(e),[n,r]=At(t),[s,i]=At(t.subarray(r)),o=t.subarray(r+i);if(o.byteLength!==s)throw new Error("Incorrect length");return new xt(n,s,o,t)},Ot=(e,t)=>{if(e===t)return!0;{const n=t;return e.code===n.code&&e.size===n.size&&n.bytes instanceof Uint8Array&&he(e.bytes,n.bytes)}};class xt{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const Nt=(e,t)=>{const{bytes:n,version:r}=e;switch(r){case 0:return Bt(n,Pt(e),t||Ae.encoder);default:return Ut(n,Pt(e),t||Ce.encoder)}},Dt=new WeakMap,Pt=e=>{const t=Dt.get(e);if(null==t){const t=new Map;return Dt.set(e,t),t}return t};class Lt{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this["/"]=r}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Vt)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==Ft)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return Lt.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=It(e,t);return Lt.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return Lt.equals(this,e)}static equals(e,t){const n=t;return n&&e.code===n.code&&e.version===n.version&&Ot(e.multihash,n.multihash)}toString(e){return Nt(this,e)}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}link(){return this}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return`CID(${this.toString()})`}static asCID(e){if(null==e)return null;const t=e;if(t instanceof Lt)return t;if(null!=t["/"]&&t["/"]===t.bytes||t.asCID===t){const{version:e,code:n,multihash:r,bytes:s}=t;return new Lt(e,n,r,s||jt(e,n,r.bytes))}if(!0===t[zt]){const{version:e,multihash:n,code:r}=t,s=Rt(n);return Lt.create(e,r,s)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:if(t!==Vt)throw new Error(`Version 0 CID must use dag-pb (code: ${Vt}) block encoding`);return new Lt(e,t,n,n.bytes);case 1:{const r=jt(e,t,n.bytes);return new Lt(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return Lt.create(0,Vt,e)}static createV1(e,t){return Lt.create(1,e,t)}static decode(e){const[t,n]=Lt.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=Lt.inspectBytes(e),n=t.size-t.multihashSize,r=de(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=r.subarray(t.multihashSize-t.digestSize),i=new xt(t.multihashCode,t.digestSize,s,r),o=0===t.version?Lt.createV0(i):Lt.createV1(t.codec,i);return[o,e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=At(e.subarray(t));return t+=r,n};let r=n(),s=Vt;if(18===r?(r=0,t=0):s=n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const i=t,o=n(),a=n(),c=t+a,l=c-i;return{version:r,codec:s,multihashCode:o,digestSize:a,multihashSize:l,size:c}}static parse(e,t){const[n,r]=Mt(e,t),s=Lt.decode(r);return Pt(s).set(n,e),s}}const Mt=(e,t)=>{switch(e[0]){case"Q":{const n=t||Ae;return[Ae.prefix,n.decode(`${Ae.prefix}${e}`)]}case Ae.prefix:{const n=t||Ae;return[Ae.prefix,n.decode(e)]}case Ce.prefix:{const n=t||Ce;return[Ce.prefix,n.decode(e)]}default:if(null==t)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[e[0],t.decode(e)]}},Bt=(e,t,n)=>{const{prefix:r}=n;if(r!==Ae.prefix)throw Error(`Cannot string encode V0 in ${n.name} encoding`);const s=t.get(r);if(null==s){const s=n.encode(e).slice(1);return t.set(r,s),s}return s},Ut=(e,t,n)=>{const{prefix:r}=n,s=t.get(r);if(null==s){const s=n.encode(e);return t.set(r,s),s}return s},Vt=112,Ft=18,jt=(e,t,n)=>{const r=Ct(e),s=r+Ct(t),i=new Uint8Array(s+n.byteLength);return Tt(e,i,0),Tt(t,i,r),i.set(n,s),i},zt=Symbol.for("@ipld/js-cid/CID"),$t=new TextDecoder;function Ht(e,t){let n=0;for(let r=0;;r+=7){if(r>=64)throw new Error("protobuf: varint overflow");if(t>=e.length)throw new Error("protobuf: unexpected end of data");const s=e[t++];if(n+=r<28?(127&s)<<r:(127&s)*2**r,s<128)break}return[n,t]}function Kt(e,t){let n;[n,t]=Ht(e,t);const r=t+n;if(n<0||r<0)throw new Error("protobuf: invalid length");if(r>e.length)throw new Error("protobuf: unexpected end of data");return[e.subarray(t,r),r]}function qt(e,t){let n;return[n,t]=Ht(e,t),[7&n,n>>3,t]}function Gt(e){const t={},n=e.length;let r=0;while(r<n){let n,s;if([n,s,r]=qt(e,r),1===s){if(t.Hash)throw new Error("protobuf: (PBLink) duplicate Hash section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Hash`);if(void 0!==t.Name)throw new Error("protobuf: (PBLink) invalid order, found Name before Hash");if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Hash");[t.Hash,r]=Kt(e,r)}else if(2===s){if(void 0!==t.Name)throw new Error("protobuf: (PBLink) duplicate Name section");if(2!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Name`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) invalid order, found Tsize before Name");let s;[s,r]=Kt(e,r),t.Name=$t.decode(s)}else{if(3!==s)throw new Error(`protobuf: (PBLink) invalid fieldNumber, expected 1, 2 or 3, got ${s}`);if(void 0!==t.Tsize)throw new Error("protobuf: (PBLink) duplicate Tsize section");if(0!==n)throw new Error(`protobuf: (PBLink) wrong wireType (${n}) for Tsize`);[t.Tsize,r]=Ht(e,r)}}if(r>n)throw new Error("protobuf: (PBLink) unexpected end of data");return t}function Wt(e){const t=e.length;let n,r,s=0,i=!1;while(s<t){let t,o;if([t,o,s]=qt(e,s),2!==t)throw new Error(`protobuf: (PBNode) invalid wireType, expected 2, got ${t}`);if(1===o){if(r)throw new Error("protobuf: (PBNode) duplicate Data section");[r,s]=Kt(e,s),n&&(i=!0)}else{if(2!==o)throw new Error(`protobuf: (PBNode) invalid fieldNumber, expected 1 or 2, got ${o}`);{if(i)throw new Error("protobuf: (PBNode) duplicate Links section");let t;n||(n=[]),[t,s]=Kt(e,s),n.push(Gt(t))}}}if(s>t)throw new Error("protobuf: (PBNode) unexpected end of data");const o={};return r&&(o.Data=r),o.Links=n||[],o}const Yt=new TextEncoder,Jt=2**32,Qt=2**31;function Xt(e,t){let n=t.length;if("number"===typeof e.Tsize){if(e.Tsize<0)throw new Error("Tsize cannot be negative");if(!Number.isSafeInteger(e.Tsize))throw new Error("Tsize too large for encoding");n=nn(t,n,e.Tsize)-1,t[n]=24}if("string"===typeof e.Name){const r=Yt.encode(e.Name);n-=r.length,t.set(r,n),n=nn(t,n,r.length)-1,t[n]=18}return e.Hash&&(n-=e.Hash.length,t.set(e.Hash,n),n=nn(t,n,e.Hash.length)-1,t[n]=10),t.length-n}function Zt(e){const t=tn(e),n=new Uint8Array(t);let r=t;if(e.Data&&(r-=e.Data.length,n.set(e.Data,r),r=nn(n,r,e.Data.length)-1,n[r]=10),e.Links)for(let s=e.Links.length-1;s>=0;s--){const t=Xt(e.Links[s],n.subarray(0,r));r-=t,r=nn(n,r,t)-1,n[r]=18}return n}function en(e){let t=0;if(e.Hash){const n=e.Hash.length;t+=1+n+rn(n)}if("string"===typeof e.Name){const n=Yt.encode(e.Name).length;t+=1+n+rn(n)}return"number"===typeof e.Tsize&&(t+=1+rn(e.Tsize)),t}function tn(e){let t=0;if(e.Data){const n=e.Data.length;t+=1+n+rn(n)}if(e.Links)for(const n of e.Links){const e=en(n);t+=1+e+rn(e)}return t}function nn(e,t,n){t-=rn(n);const r=t;while(n>=Qt)e[t++]=127&n|128,n/=128;while(n>=128)e[t++]=127&n|128,n>>>=7;return e[t]=n,r}function rn(e){return e%2===0&&e++,Math.floor((sn(e)+6)/7)}function sn(e){let t=0;return e>=Jt&&(e=Math.floor(e/Jt),t=32),e>=65536&&(e>>>=16,t+=16),e>=256&&(e>>>=8,t+=8),t+on[e]}const on=[0,1,2,2,3,3,3,3,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8],an=["Data","Links"],cn=["Hash","Name","Tsize"],ln=new TextEncoder;function un(e,t){if(e===t)return 0;const n=e.Name?ln.encode(e.Name):[],r=t.Name?ln.encode(t.Name):[];let s=n.length,i=r.length;for(let o=0,a=Math.min(s,i);o<a;++o)if(n[o]!==r[o]){s=n[o],i=r[o];break}return s<i?-1:i<s?1:0}function hn(e,t){return!Object.keys(e).some((e=>!t.includes(e)))}function dn(e){if("object"===typeof e.asCID){const t=Lt.asCID(e);if(!t)throw new TypeError("Invalid DAG-PB form");return{Hash:t}}if("object"!==typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(e.Hash){let r=Lt.asCID(e.Hash);try{r||("string"===typeof e.Hash?r=Lt.parse(e.Hash):e.Hash instanceof Uint8Array&&(r=Lt.decode(e.Hash)))}catch(n){throw new TypeError(`Invalid DAG-PB form: ${n.message}`)}r&&(t.Hash=r)}if(!t.Hash)throw new TypeError("Invalid DAG-PB form");return"string"===typeof e.Name&&(t.Name=e.Name),"number"===typeof e.Tsize&&(t.Tsize=e.Tsize),t}function pn(e){if((e instanceof Uint8Array||"string"===typeof e)&&(e={Data:e}),"object"!==typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");const t={};if(void 0!==e.Data)if("string"===typeof e.Data)t.Data=ln.encode(e.Data);else{if(!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form");t.Data=e.Data}if(void 0!==e.Links){if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form");t.Links=e.Links.map(dn),t.Links.sort(un)}else t.Links=[];return t}function fn(e){if(!e||"object"!==typeof e||Array.isArray(e))throw new TypeError("Invalid DAG-PB form");if(!hn(e,an))throw new TypeError("Invalid DAG-PB form (extraneous properties)");if(void 0!==e.Data&&!(e.Data instanceof Uint8Array))throw new TypeError("Invalid DAG-PB form (Data must be a Uint8Array)");if(!Array.isArray(e.Links))throw new TypeError("Invalid DAG-PB form (Links must be an array)");for(let t=0;t<e.Links.length;t++){const n=e.Links[t];if(!n||"object"!==typeof n||Array.isArray(n))throw new TypeError("Invalid DAG-PB form (bad link object)");if(!hn(n,cn))throw new TypeError("Invalid DAG-PB form (extraneous properties on link object)");if(!n.Hash)throw new TypeError("Invalid DAG-PB form (link must have a Hash)");if(n.Hash.asCID!==n.Hash)throw new TypeError("Invalid DAG-PB form (link Hash must be a CID)");if(void 0!==n.Name&&"string"!==typeof n.Name)throw new TypeError("Invalid DAG-PB form (link Name must be a string)");if(void 0!==n.Tsize&&("number"!==typeof n.Tsize||n.Tsize%1!==0))throw new TypeError("Invalid DAG-PB form (link Tsize must be an integer)");if(t>0&&-1===un(n,e.Links[t-1]))throw new TypeError("Invalid DAG-PB form (links must be sorted by Name bytes)")}}function gn(e,t=[]){return pn({Data:e,Links:t})}function mn(e,t,n){return dn({Hash:n,Name:e,Tsize:t})}const yn="dag-pb",wn=112;function bn(e){fn(e);const t={};return e.Links&&(t.Links=e.Links.map((e=>{const t={};return e.Hash&&(t.Hash=e.Hash.bytes),void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),e.Data&&(t.Data=e.Data),Zt(t)}function vn(e){const t=Wt(e),n={};return t.Data&&(n.Data=t.Data),t.Links&&(n.Links=t.Links.map((e=>{const t={};try{t.Hash=Lt.decode(e.Hash)}catch(n){}if(!t.Hash)throw new Error("Invalid Hash field found in link, expected CID");return void 0!==e.Name&&(t.Name=e.Name),void 0!==e.Tsize&&(t.Tsize=e.Tsize),t}))),n}const En=["string","number","bigint","symbol"],_n=["Function","Generator","AsyncGenerator","GeneratorFunction","AsyncGeneratorFunction","AsyncFunction","Observable","Array","Buffer","Object","RegExp","Date","Error","Map","Set","WeakMap","WeakSet","ArrayBuffer","SharedArrayBuffer","DataView","Promise","URL","HTMLElement","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"];function Sn(e){if(null===e)return"null";if(void 0===e)return"undefined";if(!0===e||!1===e)return"boolean";const t=typeof e;if(En.includes(t))return t;if("function"===t)return"Function";if(Array.isArray(e))return"Array";if(kn(e))return"Buffer";const n=An(e);return n||"Object"}function kn(e){return e&&e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer.call(null,e)}function An(e){const t=Object.prototype.toString.call(e).slice(8,-1);if(_n.includes(t))return t}class Tn{constructor(e,t,n){this.major=e,this.majorEncoded=e<<5,this.name=t,this.terminal=n}toString(){return`Type[${this.major}].${this.name}`}compare(e){return this.major<e.major?-1:this.major>e.major?1:0}}Tn.uint=new Tn(0,"uint",!0),Tn.negint=new Tn(1,"negint",!0),Tn.bytes=new Tn(2,"bytes",!0),Tn.string=new Tn(3,"string",!0),Tn.array=new Tn(4,"array",!1),Tn.map=new Tn(5,"map",!1),Tn.tag=new Tn(6,"tag",!1),Tn.float=new Tn(7,"float",!0),Tn.false=new Tn(7,"false",!0),Tn.true=new Tn(7,"true",!0),Tn.null=new Tn(7,"null",!0),Tn.undefined=new Tn(7,"undefined",!0),Tn.break=new Tn(7,"break",!0);class Cn{constructor(e,t,n){this.type=e,this.value=t,this.encodedLength=n,this.encodedBytes=void 0,this.byteValue=void 0}toString(){return`Token[${this.type}].${this.value}`}}const In=globalThis.process&&!globalThis.process.browser&&globalThis.Buffer&&"function"===typeof globalThis.Buffer.isBuffer,Rn=new TextDecoder,On=new TextEncoder;function xn(e){return In&&globalThis.Buffer.isBuffer(e)}function Nn(e){return e instanceof Uint8Array?xn(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e:Uint8Array.from(e)}const Dn=In?(e,t,n)=>n-t>64?globalThis.Buffer.from(e.subarray(t,n)).toString("utf8"):jn(e,t,n):(e,t,n)=>n-t>64?Rn.decode(e.subarray(t,n)):jn(e,t,n),Pn=In?e=>e.length>64?globalThis.Buffer.from(e):Fn(e):e=>e.length>64?On.encode(e):Fn(e),Ln=e=>Uint8Array.from(e),Mn=In?(e,t,n)=>xn(e)?new Uint8Array(e.subarray(t,n)):e.slice(t,n):(e,t,n)=>e.slice(t,n),Bn=In?(e,t)=>(e=e.map((e=>e instanceof Uint8Array?e:globalThis.Buffer.from(e))),Nn(globalThis.Buffer.concat(e,t))):(e,t)=>{const n=new Uint8Array(t);let r=0;for(let s of e)r+s.length>n.length&&(s=s.subarray(0,n.length-r)),n.set(s,r),r+=s.length;return n},Un=In?e=>globalThis.Buffer.allocUnsafe(e):e=>new Uint8Array(e);function Vn(e,t){if(xn(e)&&xn(t))return e.compare(t);for(let n=0;n<e.length;n++)if(e[n]!==t[n])return e[n]<t[n]?-1:1;return 0}function Fn(e,t=1/0){let n;const r=e.length;let s=null;const i=[];for(let o=0;o<r;++o){if(n=e.charCodeAt(o),n>55295&&n<57344){if(!s){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}s=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),s=n;continue}n=65536+(s-55296<<10|n-56320)}else s&&(t-=3)>-1&&i.push(239,191,189);if(s=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function jn(e,t,n){const r=[];while(t<n){const s=e[t];let i=null,o=s>239?4:s>223?3:s>191?2:1;if(t+o<=n){let n,r,a,c;switch(o){case 1:s<128&&(i=s);break;case 2:n=e[t+1],128===(192&n)&&(c=(31&s)<<6|63&n,c>127&&(i=c));break;case 3:n=e[t+1],r=e[t+2],128===(192&n)&&128===(192&r)&&(c=(15&s)<<12|(63&n)<<6|63&r,c>2047&&(c<55296||c>57343)&&(i=c));break;case 4:n=e[t+1],r=e[t+2],a=e[t+3],128===(192&n)&&128===(192&r)&&128===(192&a)&&(c=(15&s)<<18|(63&n)<<12|(63&r)<<6|63&a,c>65535&&c<1114112&&(i=c))}}null===i?(i=65533,o=1):i>65535&&(i-=65536,r.push(i>>>10&1023|55296),i=56320|1023&i),r.push(i),t+=o}return $n(r)}const zn=4096;function $n(e){const t=e.length;if(t<=zn)return String.fromCharCode.apply(String,e);let n="",r=0;while(r<t)n+=String.fromCharCode.apply(String,e.slice(r,r+=zn));return n}const Hn=256;class Kn{constructor(e=Hn){this.chunkSize=e,this.cursor=0,this.maxCursor=-1,this.chunks=[],this._initReuseChunk=null}reset(){this.cursor=0,this.maxCursor=-1,this.chunks.length&&(this.chunks=[]),null!==this._initReuseChunk&&(this.chunks.push(this._initReuseChunk),this.maxCursor=this._initReuseChunk.length-1)}push(e){let t=this.chunks[this.chunks.length-1];const n=this.cursor+e.length;if(n<=this.maxCursor+1){const n=t.length-(this.maxCursor-this.cursor)-1;t.set(e,n)}else{if(t){const e=t.length-(this.maxCursor-this.cursor)-1;e<t.length&&(this.chunks[this.chunks.length-1]=t.subarray(0,e),this.maxCursor=this.cursor-1)}e.length<64&&e.length<this.chunkSize?(t=Un(this.chunkSize),this.chunks.push(t),this.maxCursor+=t.length,null===this._initReuseChunk&&(this._initReuseChunk=t),t.set(e,0)):(this.chunks.push(e),this.maxCursor+=e.length)}this.cursor+=e.length}toBytes(e=!1){let t;if(1===this.chunks.length){const n=this.chunks[0];e&&this.cursor>n.length/2?(t=this.cursor===n.length?n:n.subarray(0,this.cursor),this._initReuseChunk=null,this.chunks=[]):t=Mn(n,0,this.cursor)}else t=Bn(this.chunks,this.cursor);return e&&this.reset(),t}}const qn="CBOR decode error:",Gn="CBOR encode error:",Wn=[];function Yn(e,t,n){if(e.length-t<n)throw new Error(`${qn} not enough data for type`)}Wn[23]=1,Wn[24]=2,Wn[25]=3,Wn[26]=5,Wn[27]=9;const Jn=[24,256,65536,4294967296,BigInt("18446744073709551616")];function Qn(e,t,n){Yn(e,t,1);const r=e[t];if(!0===n.strict&&r<Jn[0])throw new Error(`${qn} integer encoded in more bytes than necessary (strict decode)`);return r}function Xn(e,t,n){Yn(e,t,2);const r=e[t]<<8|e[t+1];if(!0===n.strict&&r<Jn[1])throw new Error(`${qn} integer encoded in more bytes than necessary (strict decode)`);return r}function Zn(e,t,n){Yn(e,t,4);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3];if(!0===n.strict&&r<Jn[2])throw new Error(`${qn} integer encoded in more bytes than necessary (strict decode)`);return r}function er(e,t,n){Yn(e,t,8);const r=16777216*e[t]+(e[t+1]<<16)+(e[t+2]<<8)+e[t+3],s=16777216*e[t+4]+(e[t+5]<<16)+(e[t+6]<<8)+e[t+7],i=(BigInt(r)<<BigInt(32))+BigInt(s);if(!0===n.strict&&i<Jn[3])throw new Error(`${qn} integer encoded in more bytes than necessary (strict decode)`);if(i<=Number.MAX_SAFE_INTEGER)return Number(i);if(!0===n.allowBigInt)return i;throw new Error(`${qn} integers outside of the safe integer range are not supported`)}function tr(e,t,n,r){return new Cn(Tn.uint,Qn(e,t+1,r),2)}function nr(e,t,n,r){return new Cn(Tn.uint,Xn(e,t+1,r),3)}function rr(e,t,n,r){return new Cn(Tn.uint,Zn(e,t+1,r),5)}function sr(e,t,n,r){return new Cn(Tn.uint,er(e,t+1,r),9)}function ir(e,t){return or(e,0,t.value)}function or(e,t,n){if(n<Jn[0]){const r=Number(n);e.push([t|r])}else if(n<Jn[1]){const r=Number(n);e.push([24|t,r])}else if(n<Jn[2]){const r=Number(n);e.push([25|t,r>>>8,255&r])}else if(n<Jn[3]){const r=Number(n);e.push([26|t,r>>>24&255,r>>>16&255,r>>>8&255,255&r])}else{const r=BigInt(n);if(!(r<Jn[4]))throw new Error(`${qn} encountered BigInt larger than allowable range`);{const n=[27|t,0,0,0,0,0,0,0];let s=Number(r&BigInt(4294967295)),i=Number(r>>BigInt(32)&BigInt(4294967295));n[8]=255&s,s>>=8,n[7]=255&s,s>>=8,n[6]=255&s,s>>=8,n[5]=255&s,n[4]=255&i,i>>=8,n[3]=255&i,i>>=8,n[2]=255&i,i>>=8,n[1]=255&i,e.push(n)}}}function ar(e,t,n,r){return new Cn(Tn.negint,-1-Qn(e,t+1,r),2)}function cr(e,t,n,r){return new Cn(Tn.negint,-1-Xn(e,t+1,r),3)}function lr(e,t,n,r){return new Cn(Tn.negint,-1-Zn(e,t+1,r),5)}ir.encodedSize=function(e){return or.encodedSize(e.value)},or.encodedSize=function(e){return e<Jn[0]?1:e<Jn[1]?2:e<Jn[2]?3:e<Jn[3]?5:9},ir.compareTokens=function(e,t){return e.value<t.value?-1:e.value>t.value?1:0};const ur=BigInt(-1),hr=BigInt(1);function dr(e,t,n,r){const s=er(e,t+1,r);if("bigint"!==typeof s){const e=-1-s;if(e>=Number.MIN_SAFE_INTEGER)return new Cn(Tn.negint,e,9)}if(!0!==r.allowBigInt)throw new Error(`${qn} integers outside of the safe integer range are not supported`);return new Cn(Tn.negint,ur-BigInt(s),9)}function pr(e,t){const n=t.value,r="bigint"===typeof n?n*ur-hr:-1*n-1;or(e,t.type.majorEncoded,r)}function fr(e,t,n,r){Yn(e,t,n+r);const s=Mn(e,t+n,t+n+r);return new Cn(Tn.bytes,s,n+r)}function gr(e,t,n,r){return fr(e,t,1,n)}function mr(e,t,n,r){return fr(e,t,2,Qn(e,t+1,r))}function yr(e,t,n,r){return fr(e,t,3,Xn(e,t+1,r))}function wr(e,t,n,r){return fr(e,t,5,Zn(e,t+1,r))}function br(e,t,n,r){const s=er(e,t+1,r);if("bigint"===typeof s)throw new Error(`${qn} 64-bit integer bytes lengths not supported`);return fr(e,t,9,s)}function vr(e){return void 0===e.encodedBytes&&(e.encodedBytes=e.type===Tn.string?Pn(e.value):e.value),e.encodedBytes}function Er(e,t){const n=vr(t);or(e,t.type.majorEncoded,n.length),e.push(n)}function _r(e,t){return e.length<t.length?-1:e.length>t.length?1:Vn(e,t)}function Sr(e,t,n,r,s){const i=n+r;Yn(e,t,i);const o=new Cn(Tn.string,Dn(e,t+n,t+i),i);return!0===s.retainStringBytes&&(o.byteValue=Mn(e,t+n,t+i)),o}function kr(e,t,n,r){return Sr(e,t,1,n,r)}function Ar(e,t,n,r){return Sr(e,t,2,Qn(e,t+1,r),r)}function Tr(e,t,n,r){return Sr(e,t,3,Xn(e,t+1,r),r)}function Cr(e,t,n,r){return Sr(e,t,5,Zn(e,t+1,r),r)}function Ir(e,t,n,r){const s=er(e,t+1,r);if("bigint"===typeof s)throw new Error(`${qn} 64-bit integer string lengths not supported`);return Sr(e,t,9,s,r)}pr.encodedSize=function(e){const t=e.value,n="bigint"===typeof t?t*ur-hr:-1*t-1;return n<Jn[0]?1:n<Jn[1]?2:n<Jn[2]?3:n<Jn[3]?5:9},pr.compareTokens=function(e,t){return e.value<t.value?1:e.value>t.value?-1:0},Er.encodedSize=function(e){const t=vr(e);return or.encodedSize(t.length)+t.length},Er.compareTokens=function(e,t){return _r(vr(e),vr(t))};const Rr=Er;function Or(e,t,n,r){return new Cn(Tn.array,r,n)}function xr(e,t,n,r){return Or(e,t,1,n)}function Nr(e,t,n,r){return Or(e,t,2,Qn(e,t+1,r))}function Dr(e,t,n,r){return Or(e,t,3,Xn(e,t+1,r))}function Pr(e,t,n,r){return Or(e,t,5,Zn(e,t+1,r))}function Lr(e,t,n,r){const s=er(e,t+1,r);if("bigint"===typeof s)throw new Error(`${qn} 64-bit integer array lengths not supported`);return Or(e,t,9,s)}function Mr(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${qn} indefinite length items not allowed`);return Or(e,t,1,1/0)}function Br(e,t){or(e,Tn.array.majorEncoded,t.value)}function Ur(e,t,n,r){return new Cn(Tn.map,r,n)}function Vr(e,t,n,r){return Ur(e,t,1,n)}function Fr(e,t,n,r){return Ur(e,t,2,Qn(e,t+1,r))}function jr(e,t,n,r){return Ur(e,t,3,Xn(e,t+1,r))}function zr(e,t,n,r){return Ur(e,t,5,Zn(e,t+1,r))}function $r(e,t,n,r){const s=er(e,t+1,r);if("bigint"===typeof s)throw new Error(`${qn} 64-bit integer map lengths not supported`);return Ur(e,t,9,s)}function Hr(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${qn} indefinite length items not allowed`);return Ur(e,t,1,1/0)}function Kr(e,t){or(e,Tn.map.majorEncoded,t.value)}function qr(e,t,n,r){return new Cn(Tn.tag,n,1)}function Gr(e,t,n,r){return new Cn(Tn.tag,Qn(e,t+1,r),2)}function Wr(e,t,n,r){return new Cn(Tn.tag,Xn(e,t+1,r),3)}function Yr(e,t,n,r){return new Cn(Tn.tag,Zn(e,t+1,r),5)}function Jr(e,t,n,r){return new Cn(Tn.tag,er(e,t+1,r),9)}function Qr(e,t){or(e,Tn.tag.majorEncoded,t.value)}Br.compareTokens=ir.compareTokens,Br.encodedSize=function(e){return or.encodedSize(e.value)},Kr.compareTokens=ir.compareTokens,Kr.encodedSize=function(e){return or.encodedSize(e.value)},Qr.compareTokens=ir.compareTokens,Qr.encodedSize=function(e){return or.encodedSize(e.value)};const Xr=20,Zr=21,es=22,ts=23;function ns(e,t,n,r){if(!1===r.allowUndefined)throw new Error(`${qn} undefined values are not supported`);return!0===r.coerceUndefinedToNull?new Cn(Tn["null"],null,1):new Cn(Tn.undefined,void 0,1)}function rs(e,t,n,r){if(!1===r.allowIndefinite)throw new Error(`${qn} indefinite length items not allowed`);return new Cn(Tn["break"],void 0,1)}function ss(e,t,n){if(n){if(!1===n.allowNaN&&Number.isNaN(e))throw new Error(`${qn} NaN values are not supported`);if(!1===n.allowInfinity&&(e===1/0||e===-1/0))throw new Error(`${qn} Infinity values are not supported`)}return new Cn(Tn.float,e,t)}function is(e,t,n,r){return ss(ps(e,t+1),3,r)}function os(e,t,n,r){return ss(gs(e,t+1),5,r)}function as(e,t,n,r){return ss(ys(e,t+1),9,r)}function cs(e,t,n){const r=t.value;if(!1===r)e.push([Tn.float.majorEncoded|Xr]);else if(!0===r)e.push([Tn.float.majorEncoded|Zr]);else if(null===r)e.push([Tn.float.majorEncoded|es]);else if(void 0===r)e.push([Tn.float.majorEncoded|ts]);else{let t,s=!1;n&&!0===n.float64||(ds(r),t=ps(hs,1),r===t||Number.isNaN(r)?(hs[0]=249,e.push(hs.slice(0,3)),s=!0):(fs(r),t=gs(hs,1),r===t&&(hs[0]=250,e.push(hs.slice(0,5)),s=!0))),s||(ms(r),t=ys(hs,1),hs[0]=251,e.push(hs.slice(0,9)))}}cs.encodedSize=function(e,t){const n=e.value;if(!1===n||!0===n||null===n||void 0===n)return 1;if(!t||!0!==t.float64){ds(n);let e=ps(hs,1);if(n===e||Number.isNaN(n))return 3;if(fs(n),e=gs(hs,1),n===e)return 5}return 9};const ls=new ArrayBuffer(9),us=new DataView(ls,1),hs=new Uint8Array(ls,0);function ds(e){if(e===1/0)us.setUint16(0,31744,!1);else if(e===-1/0)us.setUint16(0,64512,!1);else if(Number.isNaN(e))us.setUint16(0,32256,!1);else{us.setFloat32(0,e);const t=us.getUint32(0),n=(2139095040&t)>>23,r=8388607&t;if(255===n)us.setUint16(0,31744,!1);else if(0===n)us.setUint16(0,(2147483648&e)>>16|r>>13,!1);else{const e=n-127;e<-24?us.setUint16(0,0):e<-14?us.setUint16(0,(2147483648&t)>>16|1<<24+e,!1):us.setUint16(0,(2147483648&t)>>16|e+15<<10|r>>13,!1)}}}function ps(e,t){if(e.length-t<2)throw new Error(`${qn} not enough data for float16`);const n=(e[t]<<8)+e[t+1];if(31744===n)return 1/0;if(64512===n)return-1/0;if(32256===n)return NaN;const r=n>>10&31,s=1023&n;let i;return i=0===r?s*2**-24:31!==r?(s+1024)*2**(r-25):0===s?1/0:NaN,32768&n?-i:i}function fs(e){us.setFloat32(0,e,!1)}function gs(e,t){if(e.length-t<4)throw new Error(`${qn} not enough data for float32`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,4).getFloat32(0,!1)}function ms(e){us.setFloat64(0,e,!1)}function ys(e,t){if(e.length-t<8)throw new Error(`${qn} not enough data for float64`);const n=(e.byteOffset||0)+t;return new DataView(e.buffer,n,8).getFloat64(0,!1)}function ws(e,t,n){throw new Error(`${qn} encountered invalid minor (${n}) for major ${e[t]>>>5}`)}function bs(e){return()=>{throw new Error(`${qn} ${e}`)}}cs.compareTokens=ir.compareTokens;const vs=[];for(let K6=0;K6<=23;K6++)vs[K6]=ws;vs[24]=tr,vs[25]=nr,vs[26]=rr,vs[27]=sr,vs[28]=ws,vs[29]=ws,vs[30]=ws,vs[31]=ws;for(let K6=32;K6<=55;K6++)vs[K6]=ws;vs[56]=ar,vs[57]=cr,vs[58]=lr,vs[59]=dr,vs[60]=ws,vs[61]=ws,vs[62]=ws,vs[63]=ws;for(let K6=64;K6<=87;K6++)vs[K6]=gr;vs[88]=mr,vs[89]=yr,vs[90]=wr,vs[91]=br,vs[92]=ws,vs[93]=ws,vs[94]=ws,vs[95]=bs("indefinite length bytes/strings are not supported");for(let K6=96;K6<=119;K6++)vs[K6]=kr;vs[120]=Ar,vs[121]=Tr,vs[122]=Cr,vs[123]=Ir,vs[124]=ws,vs[125]=ws,vs[126]=ws,vs[127]=bs("indefinite length bytes/strings are not supported");for(let K6=128;K6<=151;K6++)vs[K6]=xr;vs[152]=Nr,vs[153]=Dr,vs[154]=Pr,vs[155]=Lr,vs[156]=ws,vs[157]=ws,vs[158]=ws,vs[159]=Mr;for(let K6=160;K6<=183;K6++)vs[K6]=Vr;vs[184]=Fr,vs[185]=jr,vs[186]=zr,vs[187]=$r,vs[188]=ws,vs[189]=ws,vs[190]=ws,vs[191]=Hr;for(let K6=192;K6<=215;K6++)vs[K6]=qr;vs[216]=Gr,vs[217]=Wr,vs[218]=Yr,vs[219]=Jr,vs[220]=ws,vs[221]=ws,vs[222]=ws,vs[223]=ws;for(let K6=224;K6<=243;K6++)vs[K6]=bs("simple values are not supported");vs[244]=ws,vs[245]=ws,vs[246]=ws,vs[247]=ns,vs[248]=bs("simple values are not supported"),vs[249]=is,vs[250]=os,vs[251]=as,vs[252]=ws,vs[253]=ws,vs[254]=ws,vs[255]=rs;const Es=[];for(let K6=0;K6<24;K6++)Es[K6]=new Cn(Tn.uint,K6,1);for(let K6=-1;K6>=-24;K6--)Es[31-K6]=new Cn(Tn.negint,K6,1);function _s(e){switch(e.type){case Tn["false"]:return Ln([244]);case Tn["true"]:return Ln([245]);case Tn["null"]:return Ln([246]);case Tn.bytes:return e.value.length?void 0:Ln([64]);case Tn.string:return""===e.value?Ln([96]):void 0;case Tn.array:return 0===e.value?Ln([128]):void 0;case Tn.map:return 0===e.value?Ln([160]):void 0;case Tn.uint:return e.value<24?Ln([Number(e.value)]):void 0;case Tn.negint:if(e.value>=-24)return Ln([31-Number(e.value)])}}Es[64]=new Cn(Tn.bytes,new Uint8Array(0),1),Es[96]=new Cn(Tn.string,"",1),Es[128]=new Cn(Tn.array,0,1),Es[160]=new Cn(Tn.map,0,1),Es[244]=new Cn(Tn["false"],!1,1),Es[245]=new Cn(Tn["true"],!0,1),Es[246]=new Cn(Tn["null"],null,1);const Ss={float64:!1,mapSorter:Ns,quickEncodeToken:_s};function ks(){const e=[];return e[Tn.uint.major]=ir,e[Tn.negint.major]=pr,e[Tn.bytes.major]=Er,e[Tn.string.major]=Rr,e[Tn.array.major]=Br,e[Tn.map.major]=Kr,e[Tn.tag.major]=Qr,e[Tn.float.major]=cs,e}const As=ks(),Ts=new Kn;class Cs{constructor(e,t){this.obj=e,this.parent=t}includes(e){let t=this;do{if(t.obj===e)return!0}while(t=t.parent);return!1}static createCheck(e,t){if(e&&e.includes(t))throw new Error(`${Gn} object contains circular references`);return new Cs(t,e)}}const Is={null:new Cn(Tn["null"],null),undefined:new Cn(Tn.undefined,void 0),true:new Cn(Tn["true"],!0),false:new Cn(Tn["false"],!1),emptyArray:new Cn(Tn.array,0),emptyMap:new Cn(Tn.map,0)},Rs={number(e,t,n,r){return Number.isInteger(e)&&Number.isSafeInteger(e)?new Cn(e>=0?Tn.uint:Tn.negint,e):new Cn(Tn.float,e)},bigint(e,t,n,r){return e>=BigInt(0)?new Cn(Tn.uint,e):new Cn(Tn.negint,e)},Uint8Array(e,t,n,r){return new Cn(Tn.bytes,e)},string(e,t,n,r){return new Cn(Tn.string,e)},boolean(e,t,n,r){return e?Is.true:Is.false},null(e,t,n,r){return Is.null},undefined(e,t,n,r){return Is.undefined},ArrayBuffer(e,t,n,r){return new Cn(Tn.bytes,new Uint8Array(e))},DataView(e,t,n,r){return new Cn(Tn.bytes,new Uint8Array(e.buffer,e.byteOffset,e.byteLength))},Array(e,t,n,r){if(!e.length)return!0===n.addBreakTokens?[Is.emptyArray,new Cn(Tn["break"])]:Is.emptyArray;r=Cs.createCheck(r,e);const s=[];let i=0;for(const o of e)s[i++]=Os(o,n,r);return n.addBreakTokens?[new Cn(Tn.array,e.length),s,new Cn(Tn["break"])]:[new Cn(Tn.array,e.length),s]},Object(e,t,n,r){const s="Object"!==t,i=s?e.keys():Object.keys(e),o=s?e.size:i.length;if(!o)return!0===n.addBreakTokens?[Is.emptyMap,new Cn(Tn["break"])]:Is.emptyMap;r=Cs.createCheck(r,e);const a=[];let c=0;for(const l of i)a[c++]=[Os(l,n,r),Os(s?e.get(l):e[l],n,r)];return xs(a,n),n.addBreakTokens?[new Cn(Tn.map,o),a,new Cn(Tn["break"])]:[new Cn(Tn.map,o),a]}};Rs.Map=Rs.Object,Rs.Buffer=Rs.Uint8Array;for(const K6 of"Uint8Clamped Uint16 Uint32 Int8 Int16 Int32 BigUint64 BigInt64 Float32 Float64".split(" "))Rs[`${K6}Array`]=Rs.DataView;function Os(e,t={},n){const r=Sn(e),s=t&&t.typeEncoders&&t.typeEncoders[r]||Rs[r];if("function"===typeof s){const i=s(e,r,t,n);if(null!=i)return i}const i=Rs[r];if(!i)throw new Error(`${Gn} unsupported type: ${r}`);return i(e,r,t,n)}function xs(e,t){t.mapSorter&&e.sort(t.mapSorter)}function Ns(e,t){const n=Array.isArray(e[0])?e[0][0]:e[0],r=Array.isArray(t[0])?t[0][0]:t[0];if(n.type!==r.type)return n.type.compare(r.type);const s=n.type.major,i=As[s].compareTokens(n,r);return 0===i&&console.warn("WARNING: complex key types used, CBOR key sorting guarantees are gone"),i}function Ds(e,t,n,r){if(Array.isArray(t))for(const s of t)Ds(e,s,n,r);else n[t.type.major](e,t,r)}function Ps(e,t,n){const r=Os(e,n);if(!Array.isArray(r)&&n.quickEncodeToken){const e=n.quickEncodeToken(r);if(e)return e;const s=t[r.type.major];if(s.encodedSize){const e=s.encodedSize(r,n),t=new Kn(e);if(s(t,r,n),1!==t.chunks.length)throw new Error(`Unexpected error: pre-calculated length for ${r} was wrong`);return Nn(t.chunks[0])}}return Ts.reset(),Ds(Ts,r,t,n),Ts.toBytes(!0)}function Ls(e,t){return t=Object.assign({},Ss,t),Ps(e,As,t)}const Ms={strict:!1,allowIndefinite:!0,allowUndefined:!0,allowBigInt:!0};class Bs{constructor(e,t={}){this.pos=0,this.data=e,this.options=t}done(){return this.pos>=this.data.length}next(){const e=this.data[this.pos];let t=Es[e];if(void 0===t){const n=vs[e];if(!n)throw new Error(`${qn} no decoder for major type ${e>>>5} (byte 0x${e.toString(16).padStart(2,"0")})`);const r=31&e;t=n(this.data,this.pos,r,this.options)}return this.pos+=t.encodedLength,t}}const Us=Symbol.for("DONE"),Vs=Symbol.for("BREAK");function Fs(e,t,n){const r=[];for(let s=0;s<e.value;s++){const i=zs(t,n);if(i===Vs){if(e.value===1/0)break;throw new Error(`${qn} got unexpected break to lengthed array`)}if(i===Us)throw new Error(`${qn} found array but not enough entries (got ${s}, expected ${e.value})`);r[s]=i}return r}function js(e,t,n){const r=!0===n.useMaps,s=r?void 0:{},i=r?new Map:void 0;for(let o=0;o<e.value;o++){const a=zs(t,n);if(a===Vs){if(e.value===1/0)break;throw new Error(`${qn} got unexpected break to lengthed map`)}if(a===Us)throw new Error(`${qn} found map but not enough entries (got ${o} [no key], expected ${e.value})`);if(!0!==r&&"string"!==typeof a)throw new Error(`${qn} non-string keys not supported (got ${typeof a})`);const c=zs(t,n);if(c===Us)throw new Error(`${qn} found map but not enough entries (got ${o} [no value], expected ${e.value})`);r?i.set(a,c):s[a]=c}return r?i:s}function zs(e,t){if(e.done())return Us;const n=e.next();if(n.type===Tn["break"])return Vs;if(n.type.terminal)return n.value;if(n.type===Tn.array)return Fs(n,e,t);if(n.type===Tn.map)return js(n,e,t);if(n.type===Tn.tag){if(t.tags&&"function"===typeof t.tags[n.value]){const r=zs(e,t);return t.tags[n.value](r)}throw new Error(`${qn} tag not supported (${n.value})`)}throw new Error("unsupported")}function $s(e,t){if(!(e instanceof Uint8Array))throw new Error(`${qn} data to decode must be a Uint8Array`);t=Object.assign({},Ms,t);const n=t.tokenizer||new Bs(e,t),r=zs(n,t);if(r===Us)throw new Error(`${qn} did not find any content to decode`);if(r===Vs)throw new Error(`${qn} got unexpected break`);if(!n.done())throw new Error(`${qn} too many terminals, data makes no sense`);return r}const Hs=42;function Ks(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=Lt.asCID(e);if(!t)return null;const n=new Uint8Array(t.bytes.byteLength+1);return n.set(t.bytes,1),[new Cn(Tn.tag,Hs),new Cn(Tn.bytes,n)]}function qs(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function Gs(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const Ws={float64:!0,typeEncoders:{Object:Ks,undefined:qs,number:Gs}};function Ys(e){if(0!==e[0])throw new Error("Invalid CID for CBOR tag 42; expected leading 0x00");return Lt.decode(e.subarray(1))}const Js={allowIndefinite:!1,coerceUndefinedToNull:!0,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};Js.tags[Hs]=Ys;const Qs="dag-cbor",Xs=113,Zs=e=>Ls(e,Ws),ei=e=>$s(e,Js),ti=({name:e,code:t,encode:n})=>new ni(e,t,n);class ni{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?It(this.code,t):t.then((e=>It(this.code,e)))}throw Error("Unknown type, must be binary type")}}class ri extends Array{constructor(){super(),this.inRecursive=[]}prefix(e){const t=this.inRecursive[this.inRecursive.length-1];t&&(t.type===Tn.array&&(t.elements++,1!==t.elements&&e.push([44])),t.type===Tn.map&&(t.elements++,1!==t.elements&&(t.elements%2===1?e.push([44]):e.push([58]))))}[Tn.uint.major](e,t){this.prefix(e);const n=String(t.value),r=[];for(let s=0;s<n.length;s++)r[s]=n.charCodeAt(s);e.push(r)}[Tn.negint.major](e,t){this[Tn.uint.major](e,t)}[Tn.bytes.major](e,t){throw new Error(`${Gn} unsupported type: Uint8Array`)}[Tn.string.major](e,t){this.prefix(e);const n=Pn(JSON.stringify(t.value));e.push(n.length>32?Nn(n):n)}[Tn.array.major](e,t){this.prefix(e),this.inRecursive.push({type:Tn.array,elements:0}),e.push([91])}[Tn.map.major](e,t){this.prefix(e),this.inRecursive.push({type:Tn.map,elements:0}),e.push([123])}[Tn.tag.major](e,t){}[Tn.float.major](e,t){if("break"===t.type.name){const t=this.inRecursive.pop();if(t){if(t.type===Tn.array)e.push([93]);else{if(t.type!==Tn.map)throw new Error("Unexpected recursive type; this should not happen!");e.push([125])}return}throw new Error("Unexpected break; this should not happen!")}if(void 0===t.value)throw new Error(`${Gn} unsupported type: undefined`);if(this.prefix(e),"true"===t.type.name)return void e.push([116,114,117,101]);if("false"===t.type.name)return void e.push([102,97,108,115,101]);if("null"===t.type.name)return void e.push([110,117,108,108]);const n=String(t.value),r=[];let s=!1;for(let i=0;i<n.length;i++)r[i]=n.charCodeAt(i),s||46!==r[i]&&101!==r[i]&&69!==r[i]||(s=!0);s||(r.push(46),r.push(48)),e.push(r)}}function si(e,t){if(Array.isArray(e[0])||Array.isArray(t[0]))throw new Error(`${Gn} complex map keys are not supported`);const n=e[0],r=t[0];if(n.type!==Tn.string||r.type!==Tn.string)throw new Error(`${Gn} non-string map keys are not supported`);if(n<r)return-1;if(n>r)return 1;throw new Error(`${Gn} unexpected duplicate map keys, this is not supported`)}const ii={addBreakTokens:!0,mapSorter:si};function oi(e,t){return t=Object.assign({},ii,t),Ps(e,new ri,t)}class ai{constructor(e,t={}){this.pos=0,this.data=e,this.options=t,this.modeStack=["value"],this.lastToken=""}done(){return this.pos>=this.data.length}ch(){return this.data[this.pos]}currentMode(){return this.modeStack[this.modeStack.length-1]}skipWhitespace(){let e=this.ch();while(32===e||9===e||13===e||10===e)e=this.data[++this.pos]}expect(e){if(this.data.length-this.pos<e.length)throw new Error(`${qn} unexpected end of input at position ${this.pos}`);for(let t=0;t<e.length;t++)if(this.data[this.pos++]!==e[t])throw new Error(`${qn} unexpected token at position ${this.pos}, expected to find '${String.fromCharCode(...e)}'`)}parseNumber(){const e=this.pos;let t=!1,n=!1;const r=e=>{while(!this.done()){const t=this.ch();if(!e.includes(t))break;this.pos++}};if(45===this.ch()&&(t=!0,this.pos++),48===this.ch()){if(this.pos++,46!==this.ch())return new Cn(Tn.uint,0,this.pos-e);this.pos++,n=!0}if(r([48,49,50,51,52,53,54,55,56,57]),t&&this.pos===e+1)throw new Error(`${qn} unexpected token at position ${this.pos}`);if(!this.done()&&46===this.ch()){if(n)throw new Error(`${qn} unexpected token at position ${this.pos}`);n=!0,this.pos++,r([48,49,50,51,52,53,54,55,56,57])}this.done()||101!==this.ch()&&69!==this.ch()||(n=!0,this.pos++,this.done()||43!==this.ch()&&45!==this.ch()||this.pos++,r([48,49,50,51,52,53,54,55,56,57]));const s=String.fromCharCode.apply(null,this.data.subarray(e,this.pos)),i=parseFloat(s);return n?new Cn(Tn.float,i,this.pos-e):!0!==this.options.allowBigInt||Number.isSafeInteger(i)?new Cn(i>=0?Tn.uint:Tn.negint,i,this.pos-e):new Cn(i>=0?Tn.uint:Tn.negint,BigInt(s),this.pos-e)}parseString(){if(34!==this.ch())throw new Error(`${qn} unexpected character at position ${this.pos}; this shouldn't happen`);this.pos++;for(let s=this.pos,i=0;s<this.data.length&&i<65536;s++,i++){const e=this.data[s];if(92===e||e<32||e>=128)break;if(34===e){const e=String.fromCharCode.apply(null,this.data.subarray(this.pos,s));return this.pos=s+1,new Cn(Tn.string,e,i)}}const e=this.pos,t=[],n=()=>{if(this.pos+4>=this.data.length)throw new Error(`${qn} unexpected end of unicode escape sequence at position ${this.pos}`);let e=0;for(let t=0;t<4;t++){let t=this.ch();if(t>=48&&t<=57)t-=48;else if(t>=97&&t<=102)t=t-97+10;else{if(!(t>=65&&t<=70))throw new Error(`${qn} unexpected unicode escape character at position ${this.pos}`);t=t-65+10}e=16*e+t,this.pos++}return e},r=()=>{const e=this.ch();let n,r,s,i,o=null,a=e>239?4:e>223?3:e>191?2:1;if(this.pos+a>this.data.length)throw new Error(`${qn} unexpected unicode sequence at position ${this.pos}`);switch(a){case 1:e<128&&(o=e);break;case 2:n=this.data[this.pos+1],128===(192&n)&&(i=(31&e)<<6|63&n,i>127&&(o=i));break;case 3:n=this.data[this.pos+1],r=this.data[this.pos+2],128===(192&n)&&128===(192&r)&&(i=(15&e)<<12|(63&n)<<6|63&r,i>2047&&(i<55296||i>57343)&&(o=i));break;case 4:n=this.data[this.pos+1],r=this.data[this.pos+2],s=this.data[this.pos+3],128===(192&n)&&128===(192&r)&&128===(192&s)&&(i=(15&e)<<18|(63&n)<<12|(63&r)<<6|63&s,i>65535&&i<1114112&&(o=i))}null===o?(o=65533,a=1):o>65535&&(o-=65536,t.push(o>>>10&1023|55296),o=56320|1023&o),t.push(o),this.pos+=a};while(!this.done()){const s=this.ch();let i;switch(s){case 92:if(this.pos++,this.done())throw new Error(`${qn} unexpected string termination at position ${this.pos}`);switch(i=this.ch(),this.pos++,i){case 34:case 39:case 92:case 47:t.push(i);break;case 98:t.push(8);break;case 116:t.push(9);break;case 110:t.push(10);break;case 102:t.push(12);break;case 114:t.push(13);break;case 117:t.push(n());break;default:throw new Error(`${qn} unexpected string escape character at position ${this.pos}`)}break;case 34:return this.pos++,new Cn(Tn.string,$n(t),this.pos-e);default:if(s<32)throw new Error(`${qn} invalid control character at position ${this.pos}`);s<128?(t.push(s),this.pos++):r()}}throw new Error(`${qn} unexpected end of string at position ${this.pos}`)}parseValue(){switch(this.ch()){case 123:return this.modeStack.push("obj-start"),this.pos++,new Cn(Tn.map,1/0,1);case 91:return this.modeStack.push("array-start"),this.pos++,new Cn(Tn.array,1/0,1);case 34:return this.parseString();case 110:return this.expect([110,117,108,108]),new Cn(Tn["null"],null,4);case 102:return this.expect([102,97,108,115,101]),new Cn(Tn["false"],!1,5);case 116:return this.expect([116,114,117,101]),new Cn(Tn["true"],!0,4);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.parseNumber();default:throw new Error(`${qn} unexpected character at position ${this.pos}`)}}next(){switch(this.skipWhitespace(),this.currentMode()){case"value":return this.modeStack.pop(),this.parseValue();case"array-value":if(this.modeStack.pop(),93===this.ch())return this.pos++,this.skipWhitespace(),new Cn(Tn["break"],void 0,1);if(44!==this.ch())throw new Error(`${qn} unexpected character at position ${this.pos}, was expecting array delimiter but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue();case"array-start":return this.modeStack.pop(),93===this.ch()?(this.pos++,this.skipWhitespace(),new Cn(Tn["break"],void 0,1)):(this.modeStack.push("array-value"),this.skipWhitespace(),this.parseValue());case"obj-key":if(125===this.ch())return this.modeStack.pop(),this.pos++,this.skipWhitespace(),new Cn(Tn["break"],void 0,1);if(44!==this.ch())throw new Error(`${qn} unexpected character at position ${this.pos}, was expecting object delimiter but found '${String.fromCharCode(this.ch())}'`);this.pos++,this.skipWhitespace();case"obj-start":{if(this.modeStack.pop(),125===this.ch())return this.pos++,this.skipWhitespace(),new Cn(Tn["break"],void 0,1);const e=this.parseString();if(this.skipWhitespace(),58!==this.ch())throw new Error(`${qn} unexpected character at position ${this.pos}, was expecting key/value delimiter ':' but found '${String.fromCharCode(this.ch())}'`);return this.pos++,this.modeStack.push("obj-value"),e}case"obj-value":return this.modeStack.pop(),this.modeStack.push("obj-key"),this.skipWhitespace(),this.parseValue();default:throw new Error(`${qn} unexpected parse state at position ${this.pos}; this shouldn't happen`)}}}function ci(e,t){return t=Object.assign({tokenizer:new ai(e,t)},t),$s(e,t)}function li(e){if(e.asCID!==e&&e["/"]!==e.bytes)return null;const t=Lt.asCID(e);if(!t)return null;const n=t.toString();return[new Cn(Tn.map,1/0,1),new Cn(Tn.string,"/",1),new Cn(Tn.string,n,n.length),new Cn(Tn["break"],void 0,1)]}function ui(e){const t=Me.encode(e).slice(1);return[new Cn(Tn.map,1/0,1),new Cn(Tn.string,"/",1),new Cn(Tn.map,1/0,1),new Cn(Tn.string,"bytes",5),new Cn(Tn.string,t,t.length),new Cn(Tn["break"],void 0,1),new Cn(Tn["break"],void 0,1)]}function hi(){throw new Error("`undefined` is not supported by the IPLD Data Model and cannot be encoded")}function di(e){if(Number.isNaN(e))throw new Error("`NaN` is not supported by the IPLD Data Model and cannot be encoded");if(e===1/0||e===-1/0)throw new Error("`Infinity` and `-Infinity` is not supported by the IPLD Data Model and cannot be encoded");return null}const pi={typeEncoders:{Object:li,Uint8Array:ui,Buffer:ui,undefined:hi,number:di}};class fi extends ai{constructor(e,t){super(e,t),this.tokenBuffer=[]}done(){return 0===this.tokenBuffer.length&&super.done()}_next(){return this.tokenBuffer.length>0?this.tokenBuffer.pop():super.next()}next(){const e=this._next();if(e.type===Tn.map){const e=this._next();if(e.type===Tn.string&&"/"===e.value){const e=this._next();if(e.type===Tn.string){const t=this._next();if(t.type!==Tn["break"])throw new Error("Invalid encoded CID form");return this.tokenBuffer.push(e),new Cn(Tn.tag,42,0)}if(e.type===Tn.map){const e=this._next();if(e.type===Tn.string&&"bytes"===e.value){const e=this._next();if(e.type===Tn.string){for(let e=0;e<2;e++){const e=this._next();if(e.type!==Tn["break"])throw new Error("Invalid encoded Bytes form")}const t=Me.decode(`m${e.value}`);return new Cn(Tn.bytes,t,e.value.length)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}this.tokenBuffer.push(e)}return e}}const gi={allowIndefinite:!1,allowUndefined:!1,allowNaN:!1,allowInfinity:!1,allowBigInt:!0,strict:!0,useMaps:!1,tags:[]};gi.tags[42]=Lt.parse;const mi="dag-json",yi=297,wi=e=>oi(e,pi),bi=e=>{const t=Object.assign(gi,{tokenizer:new fi(e,gi)});return ci(e,t)},vi=e=>Ei.decode(wi(e)),Ei=new TextDecoder,_i=e=>bi(Si.encode(e)),Si=new TextEncoder;function ki(e){return Ue.encode(e).slice(1)}function Ai(e){return Ue.decode(`u${e}`)}function Ti(e){const[t,n,r]=e;return{payload:n,signatures:[{protected:t,signature:r}],link:Lt.decode(Ai(n))}}function Ci(e){const t={signature:Ai(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=Ai(e.protected)),t}function Ii(e){const t=Ai(e.payload);try{Lt.decode(t)}catch(n){throw new Error("Not a valid DagJWS")}return{payload:t,signatures:e.signatures.map(Ci)}}function Ri(e){const t={signature:ki(e.signature)};return e.header&&(t.header=e.header),e.protected&&(t.protected=ki(e.protected)),t}function Oi(e){const t={payload:ki(e.payload),signatures:e.signatures.map(Ri)};return t.link=Lt.decode(new Uint8Array(e.payload)),t}function xi(e){const[t,n,r,s,i]=e,o={ciphertext:s,iv:r,protected:t,tag:i};return n&&(o.recipients=[{encrypted_key:n}]),o}function Ni(e){const t={};return e.encrypted_key&&(t.encrypted_key=Ai(e.encrypted_key)),e.header&&(t.header=e.header),t}function Di(e){const t={ciphertext:Ai(e.ciphertext),protected:Ai(e.protected),iv:Ai(e.iv),tag:Ai(e.tag)};return e.aad&&(t.aad=Ai(e.aad)),e.recipients&&(t.recipients=e.recipients.map(Ni)),e.unprotected&&(t.unprotected=e.unprotected),t}function Pi(e){const t={};return e.encrypted_key&&(t.encrypted_key=ki(e.encrypted_key)),e.header&&(t.header=e.header),t}function Li(e){const t={ciphertext:ki(e.ciphertext),protected:ki(e.protected),iv:ki(e.iv),tag:ki(e.tag)};return e.aad&&(t.aad=ki(e.aad)),e.recipients&&(t.recipients=e.recipients.map(Pi)),e.unprotected&&(t.unprotected=e.unprotected),t}const Mi="dag-jose",Bi=133;function Ui(e){return"payload"in e&&"string"===typeof e.payload&&"signatures"in e&&Array.isArray(e.signatures)}function Vi(e){return"payload"in e&&e.payload instanceof Uint8Array&&"signatures"in e&&Array.isArray(e.signatures)}function Fi(e){return"ciphertext"in e&&e.ciphertext instanceof Uint8Array&&"iv"in e&&e.iv instanceof Uint8Array&&"protected"in e&&e.protected instanceof Uint8Array&&"tag"in e&&e.tag instanceof Uint8Array}function ji(e){return"ciphertext"in e&&"string"===typeof e.ciphertext&&"iv"in e&&"string"===typeof e.iv&&"protected"in e&&"string"===typeof e.protected&&"tag"in e&&"string"===typeof e.tag}function zi(e){if("string"===typeof e){const t=e.split(".");if(3===t.length)return Ti(t);if(5===t.length)return xi(t);throw new Error("Not a valid JOSE string")}if(Ui(e)||ji(e))return e;throw new Error("Not a valid unencoded JOSE object")}function $i(e){let t;if("string"===typeof e&&(e=zi(e)),Ui(e))t=Ii(e);else{if(!ji(e))throw new Error("Not a valid JOSE object");t=Di(e)}return new Uint8Array(Zs(t))}function Hi(e){let t;try{t=ei(e)}catch(n){throw new Error("Not a valid DAG-JOSE object")}if(Vi(t))return Oi(t);if(Fi(t))return Li(t);throw new Error("Not a valid DAG-JOSE object")}const Ki=0,qi="identity",Gi=de,Wi=e=>It(Ki,Gi(e)),Yi={code:Ki,name:qi,encode:Gi,digest:Wi},Ji=ve({prefix:"\0",name:"identity",encode:e=>fe(e),decode:e=>pe(e)}),Qi=ke({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),Xi=ke({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),Zi=Ee({prefix:"9",name:"base10",alphabet:"0123456789"}),eo=ke({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),to=ke({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),no=Ee({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),ro=Ee({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),so=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),io=so.reduce(((e,t,n)=>(e[n]=t,e)),[]),oo=so.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);function ao(e){return e.reduce(((e,t)=>(e+=io[t],e)),"")}function co(e){const t=[];for(const n of e){const e=oo[n.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}const lo=ve({prefix:"🚀",name:"base256emoji",encode:ao,decode:co}),uo=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),ho=ti({name:"sha2-256",code:18,encode:uo("SHA-256")}),po=ti({name:"sha2-512",code:19,encode:uo("SHA-512")}),fo="raw",go=85,mo=e=>de(e),yo=e=>de(e),wo=new TextEncoder,bo=new TextDecoder,vo="json",Eo=512,_o=e=>wo.encode(JSON.stringify(e)),So=e=>JSON.parse(bo.decode(e)),ko={...h,...d,...p,...f,...g,...s,...m,...r,...i,...y},Ao={...w,...u},To={raw:b,json:v};function Co(){}class Io extends Error{constructor(e="not initialized"){super(e),this.name="NotInitializedError",this.code=Io.code}}Io.code="ERR_NOT_INITIALIZED";class Ro extends Error{constructor(e="cannot initialize an initializing node"){super(e),this.name="AlreadyInitializingError",this.code=Oo.code}}Ro.code="ERR_ALREADY_INITIALIZING";class Oo extends Error{constructor(e="cannot re-initialize an initialized node"){super(e),this.name="AlreadyInitializedError",this.code=Oo.code}}Oo.code="ERR_ALREADY_INITIALIZED";class xo extends Error{constructor(e="not started"){super(e),this.name="NotStartedError",this.code=xo.code}}xo.code="ERR_NOT_STARTED";class No extends Error{constructor(e="cannot start, already startin"){super(e),this.name="AlreadyStartingError",this.code=No.code}}No.code="ERR_ALREADY_STARTING";class Do extends Error{constructor(e="cannot start, already started"){super(e),this.name="AlreadyStartedError",this.code=Do.code}}Do.code="ERR_ALREADY_STARTED";class Po extends Error{constructor(e="not enabled"){super(e),this.name="NotEnabledError",this.code=Po.code}}function Lo(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function Mo(e=0){return null!=globalThis.Buffer?.alloc?Lo(globalThis.Buffer.alloc(e)):new Uint8Array(e)}function Bo(e=0){return null!=globalThis.Buffer?.allocUnsafe?Lo(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function Uo(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}Po.code="ERR_NOT_ENABLED";const Vo=Uo("utf8","u",(e=>{const t=new TextDecoder("utf8");return"u"+t.decode(e)}),(e=>{const t=new TextEncoder;return t.encode(e.substring(1))})),Fo=Uo("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{e=e.substring(1);const t=Bo(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),jo={utf8:Vo,"utf-8":Vo,hex:ko.base16,latin1:Fo,ascii:Fo,binary:Fo,...ko};var zo=jo;function $o(e,t="utf8"){const n=zo[t];if(null==n)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${e}`):Lo(globalThis.Buffer.from(e,"utf-8"))}var Ho=n(8957);n(541);function Ko(e){return Ko="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ko(e)}function qo(e,t){if("object"!==Ko(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Ko(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function Go(e){var t=qo(e,"string");return"symbol"===Ko(t)?t:String(t)}function Wo(e,t,n){return t=Go(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Yo{constructor(){Wo(this,"index",0),Wo(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return void 0===n&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically((()=>{const t=this.readChar();if(t===e)return t}))}readSeparator(e,t,n){return this.readAtomically((()=>{if(!(t>0&&void 0===this.readGivenChar(e)))return n()}))}readNumber(e,t,n,r){return this.readAtomically((()=>{let s=0,i=0;const o=this.peekChar();if(void 0===o)return;const a="0"===o,c=2**(8*r)-1;while(1){const n=this.readAtomically((()=>{const t=this.readChar();if(void 0===t)return;const n=Number.parseInt(t,e);return Number.isNaN(n)?void 0:n}));if(void 0===n)break;if(s*=e,s+=n,s>c)return;if(i+=1,void 0!==t&&i>t)return}return 0===i||!n&&a&&i>1?void 0:s}))}readIPv4Addr(){return this.readAtomically((()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,(()=>this.readNumber(10,3,!1,1)));if(void 0===n)return;e[t]=n}return e}))}readIPv6Addr(){const e=e=>{for(let t=0;t<e.length/2;t++){const n=2*t;if(t<e.length-3){const r=this.readSeparator(":",t,(()=>this.readIPv4Addr()));if(void 0!==r)return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],[n+4,!0]}const r=this.readSeparator(":",t,(()=>this.readNumber(16,4,!0,2)));if(void 0===r)return[n,!1];e[n]=r>>8,e[n+1]=255&r}return[e.length,!1]};return this.readAtomically((()=>{const t=new Uint8Array(16),[n,r]=e(t);if(16===n)return t;if(r)return;if(void 0===this.readGivenChar(":"))return;if(void 0===this.readGivenChar(":"))return;const s=new Uint8Array(14),i=16-(n+2),[o]=e(s.subarray(0,i));return t.set(s.subarray(0,o),16-o),t}))}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const Jo=45,Qo=15,Xo=new Yo;function Zo(e){if(!(e.length>Qo))return Xo.new(e).parseWith((()=>Xo.readIPv4Addr()))}function ea(e){if(!(e.length>Jo))return Xo.new(e).parseWith((()=>Xo.readIPv6Addr()))}function ta(e){if(!(e.length>Jo))return Xo.new(e).parseWith((()=>Xo.readIPAddr()))}function na(e){return Boolean(Zo(e))}function ra(e){return Boolean(ea(e))}function sa(e){return Boolean(ta(e))}function ia(e,t="utf8"){const n=zo[t];if(null==n)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}const oa=na,aa=ra,ca=function(e){let t=0;if(e=e.toString().trim(),oa(e)){const n=new Uint8Array(t+4);return e.split(/\./g).forEach((e=>{n[t++]=255&parseInt(e,10)})),n}if(aa(e)){const n=e.split(":",8);let r;for(r=0;r<n.length;r++){const e=oa(n[r]);let t;e&&(t=ca(n[r]),n[r]=ia(t.slice(0,2),"base16")),null!=t&&++r<8&&n.splice(r,0,ia(t.slice(2,4),"base16"))}if(""===n[0])while(n.length<8)n.unshift("0");else if(""===n[n.length-1])while(n.length<8)n.push("0");else if(n.length<8){for(r=0;r<n.length&&""!==n[r];r++);const e=[r,1];for(r=9-n.length;r>0;r--)e.push("0");n.splice.apply(n,e)}const s=new Uint8Array(t+16);for(r=0;r<n.length;r++){const e=parseInt(n[r],16);s[t++]=e>>8&255,s[t++]=255&e}return s}throw new Error("invalid ip address")},la=function(e,t=0,n){t=~~t,n=n??e.length-t;const r=new DataView(e.buffer);if(4===n){const r=[];for(let s=0;s<n;s++)r.push(e[t+s]);return r.join(".")}if(16===n){const e=[];for(let s=0;s<n;s+=2)e.push(r.getUint16(t+s).toString(16));return e.join(":").replace(/(^|:)0(:0)*:0(:|$)/,"$1::$3").replace(/:{3,4}/,"::")}return""},ua=-1,ha={},da={},pa=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,ua,"ip6zone"],[53,ua,"dns",!0],[54,ua,"dns4",!0],[55,ua,"dns6",!0],[56,ua,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,ua,"unix",!1,!0],[421,ua,"ipfs"],[421,ua,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,ua,"garlic64"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,ua,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[777,ua,"memory"]];function fa(e,t,n,r,s){return{code:e,size:t,name:n,resolvable:Boolean(r),path:Boolean(s)}}function ga(e){if("number"===typeof e){if(null!=da[e])return da[e];throw new Error(`no protocol with code: ${e}`)}if("string"===typeof e){if(null!=ha[e])return ha[e];throw new Error(`no protocol with name: ${e}`)}throw new Error("invalid protocol id type: "+typeof e)}pa.forEach((e=>{const t=fa(...e);da[t.code]=t,ha[t.name]=t}));var ma=n(1786);function ya(e,t){null==t&&(t=e.reduce(((e,t)=>e+t.length),0));const n=Bo(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return Lo(n)}function wa(e,t){const n=ga(e);switch(n.code){case 4:case 41:return Sa(t);case 6:case 273:case 33:case 132:return Aa(t).toString();case 53:case 54:case 55:case 56:case 400:case 777:return Ca(t);case 421:return xa(t);case 444:return Pa(t);case 445:return Pa(t);case 466:return Oa(t);default:return ia(t,"base16")}}function ba(e,t){const n=ga(e);switch(n.code){case 4:return _a(t);case 41:return _a(t);case 6:case 273:case 33:case 132:return ka(parseInt(t,10));case 53:case 54:case 55:case 56:case 400:case 777:return Ta(t);case 421:return Ia(t);case 444:return Na(t);case 445:return Da(t);case 466:return Ra(t);default:return $o(t,"base16")}}const va=Object.values(ko).map((e=>e.decoder)),Ea=function(){let e=va[0].or(va[1]);return va.slice(2).forEach((t=>e=e.or(t))),e}();function _a(e){if(!sa(e))throw new Error("invalid ip address");return ca(e)}function Sa(e){const t=la(e,0,e.length);if(null==t)throw new Error("ipBuff is required");if(!sa(t))throw new Error("invalid ip address");return t}function ka(e){const t=new ArrayBuffer(2),n=new DataView(t);return n.setUint16(0,e),new Uint8Array(t)}function Aa(e){const t=new DataView(e.buffer);return t.getUint16(e.byteOffset)}function Ta(e){const t=$o(e),n=Uint8Array.from(ma.encode(t.length));return ya([n,t],n.length+t.length)}function Ca(e){const t=ma.decode(e);if(e=e.slice(ma.decode.bytes),e.length!==t)throw new Error("inconsistent lengths");return ia(e)}function Ia(e){let t;t="Q"===e[0]||"1"===e[0]?Rt(Ae.decode(`z${e}`)).bytes:Lt.parse(e).multihash.bytes;const n=Uint8Array.from(ma.encode(t.length));return ya([n,t],n.length+t.length)}function Ra(e){const t=Ea.decode(e),n=Uint8Array.from(ma.encode(t.length));return ya([n,t],n.length+t.length)}function Oa(e){const t=ma.decode(e),n=e.slice(ma.decode.bytes);if(n.length!==t)throw new Error("inconsistent lengths");return"u"+ia(n,"base64url")}function xa(e){const t=ma.decode(e),n=e.slice(ma.decode.bytes);if(n.length!==t)throw new Error("inconsistent lengths");return ia(n,"base58btc")}function Na(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(16!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion address.`);const n=Ce.decode("b"+t[0]),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=ka(r);return ya([n,s],n.length+s.length)}function Da(e){const t=e.split(":");if(2!==t.length)throw new Error(`failed to parse onion addr: ["'${t.join('", "')}'"]' does not contain a port number`);if(56!==t[0].length)throw new Error(`failed to parse onion addr: ${t[0]} not a Tor onion3 address.`);const n=Ce.decode(`b${t[0]}`),r=parseInt(t[1],10);if(r<1||r>65536)throw new Error("Port number is not in range(1, 65536)");const s=ka(r);return ya([n,s],n.length+s.length)}function Pa(e){const t=e.slice(0,e.length-2),n=e.slice(e.length-2),r=ia(t,"base32"),s=Aa(n);return`${r}:${s}`}function La(e){const t=[],n=e.split("/").slice(1);if(1===n.length&&""===n[0])return[];for(let r=0;r<n.length;r++){const s=n[r],i=ga(s);if(0!==i.size){if(r++,r>=n.length)throw Wa("invalid address: "+e);if(!0===i.path){t.push([s,Ga(n.slice(r).join("/"))]);break}t.push([s,n[r]])}else t.push([s])}return t}function Ma(e){const t=[];return e.map((e=>{const n=Ya(e);return t.push(n.name),e.length>1&&null!=e[1]&&t.push(e[1]),null})),Ga(t.join("/"))}function Ba(e){return e.map((e=>{Array.isArray(e)||(e=[e]);const t=Ya(e);return e.length>1?[t.code,ba(t.code,e[1])]:[t.code]}))}function Ua(e){return e.map((e=>{const t=Ya(e);return null!=e[1]?[t.code,wa(t.code,e[1])]:[t.code]}))}function Va(e){return Ka(ya(e.map((e=>{const t=Ya(e);let n=Uint8Array.from(ma.encode(t.code));return e.length>1&&null!=e[1]&&(n=ya([n,e[1]])),n}))))}function Fa(e,t){if(e.size>0)return e.size/8;if(0===e.size)return 0;{const e=ma.decode(t);return e+(ma.decode.bytes??0)}}function ja(e){const t=[];let n=0;while(n<e.length){const r=ma.decode(e,n),s=ma.decode.bytes??0,i=ga(r),o=Fa(i,e.slice(n+s));if(0===o){t.push([r]),n+=s;continue}const a=e.slice(n+s,n+s+o);if(n+=o+s,n>e.length)throw Wa("Invalid address Uint8Array: "+ia(e,"base16"));t.push([r,a])}return t}function za(e){const t=ja(e),n=Ua(t);return Ma(n)}function $a(e){e=Ga(e);const t=La(e),n=Ba(t);return Va(n)}function Ha(e){return $a(e)}function Ka(e){const t=qa(e);if(null!=t)throw t;return Uint8Array.from(e)}function qa(e){try{ja(e)}catch(uS){return uS}}function Ga(e){return"/"+e.trim().split("/").filter((e=>e)).join("/")}function Wa(e){return new Error("Error parsing address: "+e)}function Ya(e){const t=ga(e[0]);return t}function Ja(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}var Qa,Xa,Za,ec,tc=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)},nc=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n};const rc=Symbol.for("nodejs.util.inspect.custom"),sc=[ga("dns").code,ga("dns4").code,ga("dns6").code,ga("dnsaddr").code],ic=[ga("p2p").code,ga("ipfs").code],oc=new Map,ac=Symbol.for("@multiformats/js-multiaddr/multiaddr");function cc(e,t){if(null==e)throw new Error("requires node address object");if(null==t)throw new Error("requires transport protocol");let n;switch(e.family){case 4:n="ip4";break;case 6:n="ip6";break;default:throw Error("Invalid addr family, should be 4 or 6.")}return new hc("/"+[n,e.address,t,e.port].join("/"))}function lc(e){return!!uc(e)&&e.protos().some((e=>e.resolvable))}function uc(e){return Boolean(e?.[ac])}class hc{constructor(e){if(Qa.set(this,void 0),Xa.set(this,void 0),Za.set(this,void 0),this[ec]=!0,null==e&&(e=""),e instanceof Uint8Array)this.bytes=Ka(e);else if("string"===typeof e){if(e.length>0&&"/"!==e.charAt(0))throw new Error(`multiaddr "${e}" must start with a "/"`);this.bytes=Ha(e)}else{if(!uc(e))throw new Error("addr must be a string, Buffer, or another Multiaddr");this.bytes=Ka(e.bytes)}}toString(){return null==tc(this,Qa,"f")&&nc(this,Qa,za(this.bytes),"f"),tc(this,Qa,"f")}toJSON(){return this.toString()}toOptions(){const e=this.protoCodes(),t=this.toString().split("/").slice(1);let n,r;if(t.length>2)sc.includes(e[0])&&ic.includes(e[1])?(n=ga("tcp").name,r=443):(n=ga(t[2]).name,r=parseInt(t[3]));else{if(!sc.includes(e[0]))throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');n=ga("tcp").name,r=443}const s={family:41===e[0]||55===e[0]?6:4,host:t[1],transport:n,port:r};return s}protos(){return this.protoCodes().map((e=>Object.assign({},ga(e))))}protoCodes(){const e=[],t=this.bytes;let n=0;while(n<t.length){const r=ma.decode(t,n),s=ma.decode.bytes??0,i=ga(r),o=Fa(i,t.slice(n+s));n+=o+s,e.push(r)}return e}protoNames(){return this.protos().map((e=>e.name))}tuples(){return null==tc(this,Xa,"f")&&nc(this,Xa,ja(this.bytes),"f"),tc(this,Xa,"f")}stringTuples(){return null==tc(this,Za,"f")&&nc(this,Za,Ua(this.tuples()),"f"),tc(this,Za,"f")}encapsulate(e){return e=new hc(e),new hc(this.toString()+e.toString())}decapsulate(e){const t=e.toString(),n=this.toString(),r=n.lastIndexOf(t);if(r<0)throw new Error(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new hc(n.slice(0,r))}decapsulateCode(e){const t=this.tuples();for(let n=t.length-1;n>=0;n--)if(t[n][0]===e)return new hc(Va(t.slice(0,n)));return this}getPeerId(){try{const e=this.stringTuples().filter((e=>e[0]===ha.ipfs.code)),t=e.pop();if(null!=t?.[1]){const e=t[1];return"Q"===e[0]||"1"===e[0]?ia(Ae.decode(`z${e}`),"base58btc"):ia(Lt.parse(e).multihash.bytes,"base58btc")}return null}catch(e){return null}}getPath(){let e=null;try{e=this.stringTuples().filter((e=>{const t=ga(e[0]);return!0===t.path}))[0][1],null==e&&(e=null)}catch{e=null}return e}equals(e){return Ja(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find((e=>e.resolvable));if(null==t)return[this];const n=oc.get(t.name);if(null==n)throw je(new Error(`no available resolver for ${t.name}`),"ERR_NO_AVAILABLE_RESOLVER");const r=await n(this,e);return r.map((e=>new hc(e)))}nodeAddress(){const e=this.toOptions();if("tcp"!==e.transport&&"udp"!==e.transport)throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(e){const t=(e??this).protos();return 2===t.length&&((4===t[0].code||41===t[0].code)&&(6===t[1].code||273===t[1].code))}[(Qa=new WeakMap,Xa=new WeakMap,Za=new WeakMap,ec=ac,rc)](){return`Multiaddr(${za(this.bytes)})`}}function dc(e){return new hc(e)}const pc=Uc("dns4"),fc=Uc("dns6"),gc=Uc("dnsaddr"),mc=Bc(Uc("dns"),gc,pc,fc),yc=Bc(Uc("ip4"),Uc("ip6")),wc=Bc(Mc(yc,Uc("tcp")),Mc(mc,Uc("tcp"))),bc=Mc(yc,Uc("udp")),vc=Mc(bc,Uc("utp")),Ec=Mc(bc,Uc("quic")),_c=Bc(Mc(wc,Uc("ws")),Mc(mc,Uc("ws"))),Sc=Bc(Mc(wc,Uc("wss")),Mc(mc,Uc("wss"))),kc=Bc(Mc(wc,Uc("http")),Mc(yc,Uc("http")),Mc(mc,Uc("http"))),Ac=Bc(Mc(wc,Uc("https")),Mc(yc,Uc("https")),Mc(mc,Uc("https"))),Tc=Bc(Mc(_c,Uc("p2p-webrtc-star"),Uc("p2p")),Mc(Sc,Uc("p2p-webrtc-star"),Uc("p2p")),Mc(_c,Uc("p2p-webrtc-star")),Mc(Sc,Uc("p2p-webrtc-star"))),Cc=(Bc(Mc(_c,Uc("p2p-websocket-star"),Uc("p2p")),Mc(Sc,Uc("p2p-websocket-star"),Uc("p2p")),Mc(_c,Uc("p2p-websocket-star")),Mc(Sc,Uc("p2p-websocket-star"))),Bc(Mc(kc,Uc("p2p-webrtc-direct"),Uc("p2p")),Mc(Ac,Uc("p2p-webrtc-direct"),Uc("p2p")),Mc(kc,Uc("p2p-webrtc-direct")),Mc(Ac,Uc("p2p-webrtc-direct")))),Ic=Bc(_c,Sc,kc,Ac,Tc,Cc,wc,vc,Ec,mc),Rc=(Bc(Mc(Ic,Uc("p2p-stardust"),Uc("p2p")),Mc(Ic,Uc("p2p-stardust"))),Bc(Mc(Ic,Uc("p2p")),Tc,Cc,Uc("p2p"))),Oc=Bc(Mc(Rc,Uc("p2p-circuit"),Rc),Mc(Rc,Uc("p2p-circuit")),Mc(Uc("p2p-circuit"),Rc),Mc(Ic,Uc("p2p-circuit")),Mc(Uc("p2p-circuit"),Ic),Uc("p2p-circuit")),xc=()=>Bc(Mc(Oc,xc),Oc),Nc=xc(),Dc=Bc(Mc(Nc,Rc,Nc),Mc(Rc,Nc),Mc(Nc,Rc),Nc,Rc),Pc=Dc;function Lc(e){function t(t){let n;try{n=dc(t)}catch(uS){return!1}const r=e(n.protoNames());return null!==r&&(!0===r||!1===r?r:0===r.length)}return t}function Mc(...e){function t(t){if(t.length<e.length)return null;let n=t;return e.some((e=>(n="function"===typeof e?e().partialMatch(t):e.partialMatch(t),Array.isArray(n)&&(t=n),null===n))),n}return{toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Lc(t),partialMatch:t}}function Bc(...e){function t(t){let n=null;return e.some((e=>{const r="function"===typeof e?e().partialMatch(t):e.partialMatch(t);return null!=r&&(n=r,!0)})),n}const n={toString:function(){return"{ "+e.join(" ")+" }"},input:e,matches:Lc(t),partialMatch:t};return n}function Uc(e){const t=e;function n(e){let n;try{n=dc(e)}catch(uS){return!1}const r=n.protoNames();return 1===r.length&&r[0]===t}function r(e){return 0===e.length?null:e[0]===t?e.slice(1):null}return{toString:function(){return t},matches:n,partialMatch:r}}var Vc=n(5248);const Fc=/^\/(ip[fn]s)\/([^/?#]+)/,jc=1,zc=2,$c=/^https?:\/\/([^/]+)\.(ip[fn]s)\.[^/?]+/,Hc=/^(([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])\.)+([a-z0-9]|[a-z0-9][a-z0-9-]*[a-z0-9])$/;function Kc(e){try{return Wc(e)?Boolean(Lt.parse(e)):e instanceof Uint8Array?Boolean(Lt.decode(e)):Boolean(Lt.asCID(e))}catch{return!1}}function qc(e,t,n=jc,r=zc){const s=Yc(e);if(!1===s)return!1;const i=s.match(t);if(null==i)return!1;if("ipfs"!==i[n])return!1;let o=i[r];return null!=o&&t===$c&&(o=o.toLowerCase()),Kc(o)}function Gc(e,t,n=jc,r=zc){const s=Yc(e);if(!1===s)return!1;const i=s.match(t);if(null==i)return!1;if("ipns"!==i[n])return!1;let o=i[r];if(null!=o&&t===$c){if(o=o.toLowerCase(),Kc(o))return!0;try{!o.includes(".")&&o.includes("-")&&(o=o.replace(/--/g,"@").replace(/-/g,".").replace(/@/g,"-"));const{hostname:e}=new Vc.URL(`http://${o}`);return Hc.test(e)}catch(a){return!1}}return!0}function Wc(e){return"string"===typeof e}function Yc(e){return e instanceof Uint8Array?ia(e,"base58btc"):!!Wc(e)&&e}const Jc=e=>qc(e,Fc)||Gc(e,Fc),Qc=e=>qc(e,Fc),Xc=e=>Gc(e,Fc);let Zc=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce(((e,t)=>(t&=63,e+=t<36?t.toString(36):t<62?(t-26).toString(36).toUpperCase():t>62?"-":"_",e)),"");const el="/",tl=(new TextEncoder).encode(el),nl=tl[0];class rl{constructor(e,t){if("string"===typeof e)this._buf=$o(e);else{if(!(e instanceof Uint8Array))throw new Error("Invalid key, should be String of Uint8Array");this._buf=e}if(null==t&&(t=!0),t&&this.clean(),0===this._buf.byteLength||this._buf[0]!==nl)throw new Error("Invalid key")}toString(e="utf8"){return ia(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new rl(e.join(el))}static random(){return new rl(Zc().replace(/-/g,""))}static asKey(e){return e instanceof Uint8Array||"string"===typeof e?new rl(e):"function"===typeof e.uint8Array?new rl(e.uint8Array()):null}clean(){if(null!=this._buf&&0!==this._buf.byteLength||(this._buf=tl),this._buf[0]!==nl){const e=new Uint8Array(this._buf.byteLength+1);e.fill(nl,0,1),e.set(this._buf,1),this._buf=e}while(this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===nl)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let r=0;r<t.length;r++){if(n.length<r+1)return!1;const e=t[r],s=n[r];if(e<s)return!0;if(e>s)return!1}return t.length<n.length}reverse(){return rl.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(el).slice(1)}type(){return sl(this.baseNamespace())}name(){return il(this.baseNamespace())}instance(e){return new rl(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(el)||(e+=el),e+=this.type(),new rl(e)}parent(){const e=this.list();return 1===e.length?new rl(el):new rl(e.slice(0,-1).join(el))}child(e){return this.toString()===el?e:e.toString()===el?this:new rl(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()!==this.toString()&&e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()!==this.toString()&&this.toString().startsWith(e.toString())}isTopLevel(){return 1===this.list().length}concat(...e){return rl.withNamespaces([...this.namespaces(),...ol(e.map((e=>e.namespaces())))])}}function sl(e){const t=e.split(":");return t.length<2?"":t.slice(0,-1).join(":")}function il(e){const t=e.split(":");return t[t.length-1]}function ol(e){return[].concat(...e)}var al=n(3162);let cl=/(-?(?:\d+\.?\d*|\d*\.?\d+)(?:e[-+]?\d+)?)\s*([\p{L}]*)/giu;function ll(e="",t="ms"){var n=null;return e=(e+"").replace(/(\d)[,_](\d)/g,"$1$2"),e.replace(cl,(function(e,t,r){r=ul(r),r&&(n=(n||0)+parseFloat(t,10)*r)})),n&&n/(ul(t)||1)}function ul(e){return ll[e]||ll[e.toLowerCase().replace(/s$/,"")]}ll.nanosecond=ll.ns=1e-6,ll["µs"]=ll["μs"]=ll.us=ll.microsecond=.001,ll.millisecond=ll.ms=ll[""]=1,ll.second=ll.sec=ll.s=1e3*ll.ms,ll.minute=ll.min=ll.m=60*ll.s,ll.hour=ll.hr=ll.h=60*ll.m,ll.day=ll.d=24*ll.h,ll.week=ll.wk=ll.w=7*ll.d,ll.month=ll.b=30.4375*ll.d,ll.year=ll.yr=ll.y=365.25*ll.d;var hl=ll;class dl extends Error{constructor(e="request timed out"){super(e),this.name="TimeoutError",this.code=dl.code}}function pl(e,t){return(...n)=>{const r=n[null==t?n.length-1:t];if(!r||!r.timeout)return e(...n);const s="string"===typeof r.timeout?hl(r.timeout):r.timeout,i=new Ho.TimeoutController(s);r.signal=(0,al.anySignal)([r.signal,i.signal]);const o=e(...n),a=new Promise(((e,t)=>{i.signal.addEventListener("abort",(()=>{t(new dl)}))})),c=Date.now(),l=()=>{if(i.signal.aborted)throw new dl;const e=Date.now()-c;if(e>s)throw i.abort(),new dl};return o[Symbol.asyncIterator]?async function*(){const e=o[Symbol.asyncIterator]();try{while(1){const{value:t,done:n}=await Promise.race([e.next(),a]);if(n)break;l(),yield t}}catch(uS){throw l(),uS}finally{i.clear(),e.return&&e.return()}}():(async()=>{try{const e=await Promise.race([o,a]);return l(),e}catch(uS){throw l(),uS}finally{i.clear()}})()}}dl.code="ERR_TIMEOUT";const fl="/ipfs/";function gl(e){if(e instanceof Uint8Array)try{e=Lt.decode(e)}catch(uS){throw je(uS,"ERR_INVALID_CID")}let t=Lt.asCID(e);if(t)return{cid:t,path:void 0};e=e.toString(),e.startsWith(fl)&&(e=e.substring(fl.length));const n=e.split("/");let r;try{t=Lt.parse(n.shift()||"")}catch(uS){throw je(uS,"ERR_INVALID_CID")}return n.length&&(r=`/${n.join("/")}`),{cid:t,path:r}}const ml="ERR_BAD_PATH",yl="This command must be run in online mode. Try running 'ipfs daemon' first.",wl=new rl("/local/filesroot"),bl=262144,vl=e=>{const t=Lt.asCID(e);if(t)return`/ipfs/${e}`;const n=e.toString();try{return`/ipfs/${Lt.parse(n)}`}catch{}if(Jc(n))return n;throw je(new Error(`invalid path: ${e}`),ml)},El=e=>e instanceof Uint8Array?Lt.decode(e).toString():(e=e.toString(),0===e.indexOf("/ipfs/")&&(e=e.substring("/ipfs/".length)),"/"===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e),_l=async function(e,t,n,r={}){const{cid:s,path:i}=gl(n);i&&(r.path=i);let o=s,a=r.path||"";if(a.startsWith("/")&&(a=a.substring(1)),r.path)try{for await(const{value:n,remainderPath:i}of Al(s,r.path,t,e,{signal:r.signal})){if(!Lt.asCID(n))break;a=i,o=n}}catch(uS){throw uS.message.startsWith("Object has no property")&&(uS.message=`no link named "${a.split("/")[0]}" under ${o}`,uS.code="ERR_NO_LINK"),uS}return{cid:o,remainderPath:a||""}},Sl=e=>{if("file"!==e.type&&"directory"!==e.type&&"raw"!==e.type)throw new Error(`Unknown node type '${e.type}'`);const t={cid:e.cid,path:e.path,name:e.name,size:e.size,type:"file"};return"directory"===e.type&&(t.type="dir"),"file"===e.type&&(t.size=e.unixfs.fileSize()),"file"!==e.type&&"directory"!==e.type||(t.mode=e.unixfs.mode,void 0!==e.unixfs.mtime&&(t.mtime=e.unixfs.mtime)),t},kl=pl((async(e,t)=>await e)),Al=async function*(e,t,n,r,s){const i=async e=>{const t=await n.getCodec(e.code),i=await r.blocks.get(e,s);return t.decode(i)},o=t.split("/").filter(Boolean);let a=await i(e),c=e;while(o.length){const n=o.shift();if(!n)throw je(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(e.code===wn&&Array.isArray(a.Links)){const e=a.Links.find((e=>e.Name===n));if(e){yield{value:e.Hash,remainderPath:o.join("/")},a=await i(e.Hash),c=e.Hash;continue}}if(!Object.prototype.hasOwnProperty.call(a,n))throw je(new Error(`no link named "${n}" under ${c}`),"ERR_NO_LINK");a=a[n],yield{value:a,remainderPath:o.join("/")},Lt.asCID(a)&&(c=a,a=await i(a))}yield{value:a,remainderPath:""}};class Tl{static create({start:e,stop:t}){return new Tl(e,t)}static async start(e,t){const{state:n,activate:r}=e;switch(n.status){case"stopped":try{const n=r(t);e.state={status:"starting",ready:n};const s=await n;return e.state={status:"started",value:s},s}catch(s){throw e.state={status:"stopped"},s}case"starting":throw new No;case"started":throw new Do;case"stopping":return await n.ready,await Tl.start(e,t);default:return Tl.panic(e)}}static async stop(e){const{state:t,deactivate:n}=e;switch(t.status){case"stopped":break;case"starting":try{await t.ready}catch(r){}return await Tl.stop(e);case"stopping":return await t.ready;case"started":n&&await n(t.value),e.state={status:"stopped"};break;default:Tl.panic(t)}}static try({state:e}){switch(e.status){case"started":return e.value;default:return null}}static async use({state:e},t){switch(e.status){case"started":return e.value;case"starting":return await kl(e.ready,t);default:throw new xo}}static panic({state:e}){const t=JSON.stringify({status:e.status});throw RangeError(`Service in invalid state ${t}, should never happen if you see this please report a bug`)}constructor(e,t){this.activate=e,this.deactivate=t,this.state={status:"stopped"}}async use(e){return await Tl.use(this,e)}try(){return Tl.try(this)}}function Cl({network:e,preload:t,peerId:n,keychain:r,repo:s,ipns:i,mfsPreload:o,print:a,hashers:c,options:l}){const u=async()=>{const{libp2p:u}=await Tl.start(e,{peerId:n,repo:s,print:a,hashers:c,options:l});await Promise.all([i.startOnline({keychain:r,libp2p:u,peerId:n,repo:s}),t.start(),o.start()])};return u}function Il({network:e,preload:t,ipns:n,repo:r,mfsPreload:s}){const i=async()=>{await Promise.all([t.stop(),n.stop(),s.stop()]),await Tl.stop(e),await r.close()};return i}var Rl=n(5470);class Ol{constructor(e){this.lru=Rl(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){const t=this.get(e);return!!t}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}var xl=n(9835);n(2801);class Nl extends Error{constructor(e){super(e),this.name="TimeoutError"}}class Dl extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const Pl=e=>void 0===globalThis.DOMException?new Dl(e):new DOMException(e),Ll=e=>{const t=void 0===e.reason?Pl("This operation was aborted."):e.reason;return t instanceof Error?t:Pl(t)};function Ml(e,t,n,r){let s;const i=new Promise(((i,o)=>{if("number"!==typeof t||1!==Math.sign(t))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t!==Number.POSITIVE_INFINITY){if(r={customTimers:{setTimeout:setTimeout,clearTimeout:clearTimeout},...r},r.signal){const{signal:e}=r;e.aborted&&o(Ll(e)),e.addEventListener("abort",(()=>{o(Ll(e))}))}s=r.customTimers.setTimeout.call(void 0,(()=>{if("function"===typeof n){try{i(n())}catch(a){o(a)}return}const r="string"===typeof n?n:`Promise timed out after ${t} milliseconds`,s=n instanceof Error?n:new Nl(r);"function"===typeof e.cancel&&e.cancel(),o(s)}),t),(async()=>{try{i(await e)}catch(t){o(t)}finally{r.customTimers.clearTimeout.call(void 0,s)}})()}else i(e)}));return i.clear=()=>{clearTimeout(s),s=void 0},i}function Bl(e,t,n){let r=0,s=e.length;while(s>0){const i=Math.trunc(s/2);let o=r+i;n(e[o],t)<=0?(r=++o,s-=i+1):s=i}return r}var Ul,Vl=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class Fl{constructor(){Ul.set(this,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,run:e};if(this.size&&Vl(this,Ul,"f")[this.size-1].priority>=t.priority)return void Vl(this,Ul,"f").push(n);const r=Bl(Vl(this,Ul,"f"),n,((e,t)=>t.priority-e.priority));Vl(this,Ul,"f").splice(r,0,n)}dequeue(){const e=Vl(this,Ul,"f").shift();return null===e||void 0===e?void 0:e.run}filter(e){return Vl(this,Ul,"f").filter((t=>t.priority===e.priority)).map((e=>e.run))}get size(){return Vl(this,Ul,"f").length}}Ul=new WeakMap;var jl,zl,$l,Hl,Kl,ql,Gl,Wl,Yl,Jl,Ql,Xl,Zl,eu,tu,nu,ru,su,iu,ou,au,cu,lu,uu,hu,du,pu=function(e,t,n,r,s){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"===typeof t?e!==t||!s:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?s.call(e,n):s?s.value=n:t.set(e,n),n},fu=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};const gu=new Nl;class mu extends Error{}class yu extends xl{constructor(e){var t,n,r,s;if(super(),jl.add(this),zl.set(this,void 0),$l.set(this,void 0),Hl.set(this,0),Kl.set(this,void 0),ql.set(this,void 0),Gl.set(this,0),Wl.set(this,void 0),Yl.set(this,void 0),Jl.set(this,void 0),Ql.set(this,void 0),Xl.set(this,0),Zl.set(this,void 0),eu.set(this,void 0),tu.set(this,void 0),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),e={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:Fl,...e},!("number"===typeof e.intervalCap&&e.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(n=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==n?n:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(s=null===(r=e.interval)||void 0===r?void 0:r.toString())&&void 0!==s?s:""}\` (${typeof e.interval})`);pu(this,zl,e.carryoverConcurrencyCount,"f"),pu(this,$l,e.intervalCap===Number.POSITIVE_INFINITY||0===e.interval,"f"),pu(this,Kl,e.intervalCap,"f"),pu(this,ql,e.interval,"f"),pu(this,Jl,new e.queueClass,"f"),pu(this,Ql,e.queueClass,"f"),this.concurrency=e.concurrency,this.timeout=e.timeout,pu(this,tu,!0===e.throwOnTimeout,"f"),pu(this,eu,!1===e.autoStart,"f")}get concurrency(){return fu(this,Zl,"f")}set concurrency(e){if(!("number"===typeof e&&e>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);pu(this,Zl,e,"f"),fu(this,jl,"m",hu).call(this)}async add(e,t={}){return new Promise(((n,r)=>{const s=async()=>{var s,i,o;pu(this,Xl,(i=fu(this,Xl,"f"),i++,i),"f"),pu(this,Hl,(o=fu(this,Hl,"f"),o++,o),"f");try{if(null===(s=t.signal)||void 0===s?void 0:s.aborted)return void r(new mu("The task was aborted."));const i=void 0===this.timeout&&void 0===t.timeout?e({signal:t.signal}):Ml(Promise.resolve(e({signal:t.signal})),void 0===t.timeout?this.timeout:t.timeout,(()=>{(void 0===t.throwOnTimeout?fu(this,tu,"f"):t.throwOnTimeout)&&r(gu)})),o=await i;n(o),this.emit("completed",o)}catch(a){r(a),this.emit("error",a)}fu(this,jl,"m",su).call(this)};fu(this,Jl,"f").enqueue(s,t),fu(this,jl,"m",cu).call(this),this.emit("add")}))}async addAll(e,t){return Promise.all(e.map((async e=>this.add(e,t))))}start(){return fu(this,eu,"f")?(pu(this,eu,!1,"f"),fu(this,jl,"m",hu).call(this),this):this}pause(){pu(this,eu,!0,"f")}clear(){pu(this,Jl,new(fu(this,Ql,"f")),"f")}async onEmpty(){0!==fu(this,Jl,"f").size&&await fu(this,jl,"m",du).call(this,"empty")}async onSizeLessThan(e){fu(this,Jl,"f").size<e||await fu(this,jl,"m",du).call(this,"next",(()=>fu(this,Jl,"f").size<e))}async onIdle(){0===fu(this,Xl,"f")&&0===fu(this,Jl,"f").size||await fu(this,jl,"m",du).call(this,"idle")}get size(){return fu(this,Jl,"f").size}sizeBy(e){return fu(this,Jl,"f").filter(e).length}get pending(){return fu(this,Xl,"f")}get isPaused(){return fu(this,eu,"f")}}zl=new WeakMap,$l=new WeakMap,Hl=new WeakMap,Kl=new WeakMap,ql=new WeakMap,Gl=new WeakMap,Wl=new WeakMap,Yl=new WeakMap,Jl=new WeakMap,Ql=new WeakMap,Xl=new WeakMap,Zl=new WeakMap,eu=new WeakMap,tu=new WeakMap,jl=new WeakSet,nu=function(){return fu(this,$l,"f")||fu(this,Hl,"f")<fu(this,Kl,"f")},ru=function(){return fu(this,Xl,"f")<fu(this,Zl,"f")},su=function(){var e;pu(this,Xl,(e=fu(this,Xl,"f"),e--,e),"f"),fu(this,jl,"m",cu).call(this),this.emit("next")},iu=function(){this.emit("empty"),0===fu(this,Xl,"f")&&this.emit("idle")},ou=function(){fu(this,jl,"m",uu).call(this),fu(this,jl,"m",lu).call(this),pu(this,Yl,void 0,"f")},au=function(){const e=Date.now();if(void 0===fu(this,Wl,"f")){const t=fu(this,Gl,"f")-e;if(!(t<0))return void 0===fu(this,Yl,"f")&&pu(this,Yl,setTimeout((()=>{fu(this,jl,"m",ou).call(this)}),t),"f"),!0;pu(this,Hl,fu(this,zl,"f")?fu(this,Xl,"f"):0,"f")}return!1},cu=function(){if(0===fu(this,Jl,"f").size)return fu(this,Wl,"f")&&clearInterval(fu(this,Wl,"f")),pu(this,Wl,void 0,"f"),fu(this,jl,"m",iu).call(this),!1;if(!fu(this,eu,"f")){const e=!fu(this,jl,"a",au);if(fu(this,jl,"a",nu)&&fu(this,jl,"a",ru)){const t=fu(this,Jl,"f").dequeue();return!!t&&(this.emit("active"),t(),e&&fu(this,jl,"m",lu).call(this),!0)}}return!1},lu=function(){fu(this,$l,"f")||void 0!==fu(this,Wl,"f")||(pu(this,Wl,setInterval((()=>{fu(this,jl,"m",uu).call(this)}),fu(this,ql,"f")),"f"),pu(this,Gl,Date.now()+fu(this,ql,"f"),"f"))},uu=function(){0===fu(this,Hl,"f")&&0===fu(this,Xl,"f")&&fu(this,Wl,"f")&&(clearInterval(fu(this,Wl,"f")),pu(this,Wl,void 0,"f")),pu(this,Hl,fu(this,zl,"f")?fu(this,Xl,"f"):0,"f"),fu(this,jl,"m",hu).call(this)},hu=function(){while(fu(this,jl,"m",cu).call(this));},du=async function(e,t){return new Promise((n=>{const r=()=>{t&&!t()||(this.off(e,r),n())};this.on(e,r)}))};var wu=n(3785);const bu=new Ol(1e3),vu=6e4,Eu=yu["default"]?yu["default"]:yu,_u=new Eu({concurrency:4}),Su=e=>{if(e.Path)return e.Path;throw new Error(e.Message)};async function ku(e,t){const n=async(e,t={})=>{const n=new URLSearchParams(t);n.set("arg",e);const r=n.toString();if(!t.nocache&&bu.has(r)){const e=bu.get(r);return Su(e)}const s=await _u.add((async()=>{const e=await wu.get("https://ipfs.io/api/v0/dns",{searchParams:n}),t=new URL(e.url).search.slice(1),r=await e.json();return bu.set(t,r,vu),r}));return Su(s)};return n(e,t)}function Au(e){return e.endsWith(".eth")&&(e=e.replace(/.eth$/,".eth.link")),e}function Tu(){const e=async(e,t={recursive:!0})=>{if("string"!==typeof e)throw new Error("Invalid arguments, domain must be a string");return e=Au(e),ku(e,t)};return pl(e)}function Cu({network:e}){return()=>{const t=e.try();return null!=t&&Boolean(t.libp2p.isStarted())}}const Iu=Symbol.for("@libp2p/peer-id");function Ru(e){return null!=e&&Boolean(e[Iu])}const Ou=Symbol.for("nodejs.util.inspect.custom"),xu=Object.values(ko).map((e=>e.decoder)).reduce(((e,t)=>e.or(t)),ko.identity.decoder),Nu=114,Du=36,Pu=37;class Lu{constructor(e){this.type=e.type,this.multihash=e.multihash,this.privateKey=e.privateKey,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}get[Iu](){return!0}toString(){return null==this.string&&(this.string=Ae.encode(this.multihash.bytes).slice(1)),this.string}toCID(){return Lt.createV1(Nu,this.multihash)}toBytes(){return this.multihash.bytes}toJSON(){return this.toString()}equals(e){if(e instanceof Uint8Array)return Ja(this.multihash.bytes,e);if("string"===typeof e)return Fu(e).equals(this);if(null!=e?.multihash?.bytes)return Ja(this.multihash.bytes,e.multihash.bytes);throw new Error("not valid Id")}[Ou](){return`PeerId(${this.toString()})`}}class Mu extends Lu{constructor(e){super({...e,type:"RSA"}),this.type="RSA",this.publicKey=e.publicKey}}class Bu extends Lu{constructor(e){super({...e,type:"Ed25519"}),this.type="Ed25519",this.publicKey=e.multihash.digest}}class Uu extends Lu{constructor(e){super({...e,type:"secp256k1"}),this.type="secp256k1",this.publicKey=e.multihash.digest}}function Vu(e){if("RSA"===e.type)return new Mu(e);if("Ed25519"===e.type)return new Bu(e);if("secp256k1"===e.type)return new Uu(e);throw je(new Error("Not a PeerId"),"ERR_INVALID_PARAMETERS")}function Fu(e,t){if(t=t??xu,"1"===e.charAt(0)||"Q"===e.charAt(0)){const t=Rt(Ae.decode(`z${e}`));return e.startsWith("12D")?new Bu({multihash:t}):e.startsWith("16U")?new Uu({multihash:t}):new Mu({multihash:t})}return ju(xu.decode(e))}function ju(e){try{const t=Rt(e);if(t.code===Yi.code){if(t.digest.length===Du)return new Bu({multihash:t});if(t.digest.length===Pu)return new Uu({multihash:t})}if(t.code===ho.code)return new Mu({multihash:t})}catch{return zu(Lt.decode(e))}throw new Error("Supplied PeerID CID is invalid")}function zu(e){if(null==e||null==e.multihash||null==e.version||1===e.version&&e.code!==Nu)throw new Error("Supplied PeerID CID is invalid");const t=e.multihash;if(t.code===ho.code)return new Mu({multihash:e.multihash});if(t.code===Yi.code){if(t.digest.length===Du)return new Bu({multihash:e.multihash});if(t.digest.length===Pu)return new Uu({multihash:e.multihash})}throw new Error("Supplied PeerID CID is invalid")}async function $u(e,t){return e.length===Du?new Bu({multihash:It(Yi.code,e),privateKey:t}):e.length===Pu?new Uu({multihash:It(Yi.code,e),privateKey:t}):new Mu({multihash:await ho.digest(e),publicKey:e,privateKey:t})}function Hu({repo:e,codecs:t,bases:n,name:r}){async function s(s,i={}){if(!Jc(s))throw new Error("invalid argument "+s);if(Xc(s))for await(const e of r.resolve(s,i))s=e;const[,o,a,...c]=s.split("/"),l=i.cidBase?await n.getBase(i.cidBase):void 0,u=Ku(a);if(0===c.length){const e=l?l.encoder.encode(u):a;return`/${o}/${e}`}const h=Lt.decode(u);s=c.join("/");const d=Al(h,s,t,e,i);let p=h,f=s;for await(const e of d)Lt.asCID(e.value)&&(p=e.value,f=e.remainderPath);return`/ipfs/${p.toString(l&&l.encoder)}${f?"/"+f:""}`}return pl(s)}function Ku(e){try{return Fu(e).toBytes()}catch{return Lt.parse(e).bytes}}async function qu(e){let t;for await(const n of e)t=n;return t}function Gu({addAll:e}){return(t,n={})=>{let r;const s=Lt.asCID(t);return r=e(s?[{cid:s,...n}]:[{path:t.toString(),...n}],n),qu(r)}}async function*Wu(e){if(null===e||void 0===e)throw je(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");const t=Lt.asCID(e);if(t)yield Yu({cid:t});else{if(!(e instanceof String||"string"===typeof e)){if(null!=e.cid||null!=e.path)return yield Yu(e);if(Symbol.iterator in e){const t=e[Symbol.iterator](),n=t.next();if(n.done)return t;if(Lt.asCID(n.value)||n.value instanceof String||"string"===typeof n.value){yield Yu({cid:n.value});for(const e of t)yield Yu({cid:e});return}if(null!=n.value.cid||null!=n.value.path){yield Yu(n.value);for(const e of t)yield Yu(e);return}throw je(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}if(Symbol.asyncIterator in e){const t=e[Symbol.asyncIterator](),n=await t.next();if(n.done)return t;if(Lt.asCID(n.value)||n.value instanceof String||"string"===typeof n.value){yield Yu({cid:n.value});for await(const e of t)yield Yu({cid:e});return}if(null!=n.value.cid||null!=n.value.path){yield Yu(n.value);for await(const e of t)yield Yu(e);return}throw je(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}throw je(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}yield Yu({path:e})}}function Yu(e){const t=e.cid||`${e.path}`;if(!t)throw je(new Error("Unexpected input: Please path either a CID or an IPFS path"),"ERR_UNEXPECTED_INPUT");const n={path:t,recursive:!1!==e.recursive};return null!=e.metadata&&(n.metadata=e.metadata),n}const Ju={direct:"direct",recursive:"recursive",indirect:"indirect",all:"all"};function Qu({repo:e,codecs:t}){async function*n(n,r={}){const s=async function*(){for await(const{path:r,recursive:s,metadata:i}of Wu(n)){const{cid:n}=await _l(e,t,r),{reason:o}=await e.pins.isPinnedWithType(n,[Ju.recursive,Ju.direct]);if("recursive"===o&&!s)throw new Error(`${n} already pinned recursively`);s?await e.pins.pinRecursively(n,{metadata:i}):await e.pins.pinDirectly(n,{metadata:i}),yield n}},i=Boolean(r.lock);if(!i)return void(yield*s());const o=await e.gcLock.readLock();try{yield*s()}finally{o()}}return pl(n)}function Xu(e,t,n){const r={type:e,cid:t};return n&&(r.metadata=n),r}function Zu({repo:e,codecs:t}){async function*n(n={}){let r=Ju.all;if(n.type&&(r=n.type,!Object.keys(Ju).includes(r)))throw je(new Error("Invalid pin type"),"ERR_INVALID_PIN_TYPE");if(n.paths){let s=!1;for await(const{path:i}of Wu(n.paths)){const{cid:n}=await _l(e,t,i),{reason:o,pinned:a,parent:c,metadata:l}=await e.pins.isPinnedWithType(n,r);if(!a)throw je(new Error(`path '${i}' is not pinned`),"ERR_NOT_PINNED");switch(o){case Ju.direct:case Ju.recursive:s=!0,yield Xu(o,n,l);break;default:s=!0,yield Xu(`${Ju.indirect} through ${c}`,n,l)}}if(!s)throw new Error("No match found")}else{if(r===Ju.recursive||r===Ju.all)for await(const{cid:t,metadata:n}of e.pins.recursiveKeys())yield Xu(Ju.recursive,t,n);if(r===Ju.indirect||r===Ju.all)for await(const t of e.pins.indirectKeys(n))yield Xu(Ju.indirect,t);if(r===Ju.direct||r===Ju.all)for await(const{cid:t,metadata:n}of e.pins.directKeys())yield Xu(Ju.direct,t,n)}}return pl(n)}function eh({rmAll:e}){async function t(t,n={}){const r=await qu(e([{path:t,...n}],n));if(!r)throw new Error("CID expected");return r}return t}function th({repo:e,codecs:t}){async function*n(n,r={}){const s=await e.gcLock.readLock();try{for await(const{path:r,recursive:s}of Wu(n)){const{cid:n}=await _l(e,t,r),{pinned:i,reason:o}=await e.pins.isPinnedWithType(n,Ju.all);if(!i)throw new Error(`${n} is not pinned`);switch(o){case Ju.recursive:if(!s)throw new Error(`${n} is pinned recursively`);await e.pins.unpin(n),yield n;break;case Ju.direct:await e.pins.unpin(n),yield n;break;default:throw new Error(`${n} is pinned indirectly under ${o}`)}}}finally{s()}}return pl(n)}class nh{constructor({codecs:e,repo:t}){const n=Qu({codecs:e,repo:t});this.addAll=n,this.add=Gu({addAll:n});const r=th({codecs:e,repo:t});this.rmAll=r,this.rm=eh({rmAll:r}),this.ls=Zu({codecs:e,repo:t}),this.remote={add:(e,t={})=>Promise.reject(new Error("Not implemented")),ls:async function*(e,t={}){return Promise.reject(new Error("Not implemented"))},rm:(e,t={})=>Promise.reject(new Error("Not implemented")),rmAll:(e,t={})=>Promise.reject(new Error("Not implemented")),service:{add:(e,t)=>Promise.reject(new Error("Not implemented")),rm:(e,t={})=>Promise.reject(new Error("Not implemented")),ls:(e={})=>Promise.reject(new Error("Not implemented"))}}}}function rh(e){return e=e||new Error("Cannot open database"),je(e,"ERR_DB_OPEN_FAILED")}function sh(e){return e=e||new Error("Delete failed"),je(e,"ERR_DB_DELETE_FAILED")}function ih(e){return e=e||new Error("Write failed"),je(e,"ERR_DB_WRITE_FAILED")}function oh(e){return e=e||new Error("Not Found"),je(e,"ERR_NOT_FOUND")}var ah=n(1901),ch=n(4609),lh=n(3206),uh=n(1355),hh=n(3319),dh=n(1539);function ph(){dh._configure(),ch._configure(lh),uh._configure(hh)}ph();const fh=["uint64","int64","sint64","fixed64","sfixed64"];function gh(e){for(const t of fh){if(null==e[t])continue;const n=e[t];e[t]=function(){return BigInt(n.call(this).toString())}}return e}function mh(e){return gh(new ch(e))}function yh(e){for(const t of fh){if(null==e[t])continue;const n=e[t];e[t]=function(e){return n.call(this,e.toString())}}return e}function wh(){return yh(uh.create())}function bh(e,t){const n=mh(e instanceof Uint8Array?e:e.subarray());return t.decode(n)}function vh(e,t){const n=wh();return t.encode(e,n,{lengthDelimited:!1}),n.finish()}var Eh,_h,Sh,kh,Ah;function Th(e,t,n,r){return{name:e,type:t,encode:n,decode:r}}function Ch(e){function t(t){if(null==e[t.toString()])throw new Error("Invalid enum value");return e[t]}const n=function(e,n){const r=t(e);n.int32(r)},r=function(e){const n=e.int32();return t(n)};return Th("enum",Eh.VARINT,n,r)}function Ih(e,t){return Th("message",Eh.LENGTH_DELIMITED,e,t)}(function(e){e[e["VARINT"]=0]="VARINT",e[e["BIT64"]=1]="BIT64",e[e["LENGTH_DELIMITED"]=2]="LENGTH_DELIMITED",e[e["START_GROUP"]=3]="START_GROUP",e[e["END_GROUP"]=4]="END_GROUP",e[e["BIT32"]=5]="BIT32"})(Eh||(Eh={})),function(e){e["RSA"]="RSA",e["Ed25519"]="Ed25519",e["Secp256k1"]="Secp256k1"}(_h||(_h={})),function(e){e[e["RSA"]=0]="RSA",e[e["Ed25519"]=1]="Ed25519",e[e["Secp256k1"]=2]="Secp256k1"}(Sh||(Sh={})),function(e){e.codec=()=>Ch(Sh)}(_h||(_h={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),_h.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.Type=_h.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(kh||(kh={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.Type&&(t.uint32(8),_h.codec().encode(e.Type,t)),null!=e.Data&&(t.uint32(18),t.bytes(e.Data)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.Type=_h.codec().decode(e);break;case 2:n.Data=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(Ah||(Ah={}));n(3655),n(8774);var Rh=n(6143),Oh={get(e=globalThis){const t=e.crypto;if(null==t||null==t.subtle)throw Object.assign(new Error("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p-crypto/blob/master/README.md#web-crypto-api"),{code:"ERR_MISSING_WEB_CRYPTO"});return t}};var xh=n(8666);n(3322);function Nh(e,t){let n=Uint8Array.from(e.abs().toByteArray());if(n=0===n[0]?n.subarray(1):n,null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=ya([new Uint8Array(t-n.length),n])}return ia(n,"base64url")}function Dh(e){const t=Ph(e);return new Rh.jsbn.BigInteger(ia(t,"base16"),16)}function Ph(e,t){let n=$o(e,"base64urlpad");if(null!=t){if(n.length>t)throw new Error("byte array longer than desired length");n=ya([new Uint8Array(t-n.length),n])}return n}const Lh={"P-256":256,"P-384":384,"P-521":521},Mh=Object.keys(Lh);Mh.join(" / ");function Bh(e){const t=e?.algorithm??"AES-GCM";let n=e?.keyLength??16;const r=e?.nonceLength??12,s=e?.digest??"SHA-256",i=e?.saltLength??16,o=e?.iterations??32767,a=Oh.get();async function c(e,c){const l=a.getRandomValues(new Uint8Array(i)),u=a.getRandomValues(new Uint8Array(r)),h={name:t,iv:u};"string"===typeof c&&(c=$o(c));const d={name:"PBKDF2",salt:l,iterations:o,hash:{name:s}},p=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),f=await a.subtle.deriveKey(d,p,{name:t,length:n},!0,["encrypt"]),g=await a.subtle.encrypt(h,f,e);return ya([l,h.iv,new Uint8Array(g)])}async function l(e,c){const l=e.subarray(0,i),u=e.subarray(i,i+r),h=e.subarray(i+r),d={name:t,iv:u};"string"===typeof c&&(c=$o(c));const p={name:"PBKDF2",salt:l,iterations:o,hash:{name:s}},f=await a.subtle.importKey("raw",c,{name:"PBKDF2"},!1,["deriveKey","deriveBits"]),g=await a.subtle.deriveKey(p,f,{name:t,length:n},!0,["decrypt"]),m=await a.subtle.decrypt(d,g,h);return new Uint8Array(m)}n*=8;const u={encrypt:c,decrypt:l};return u}async function Uh(e,t){const n=Me.decode(e),r=Bh();return await r.decrypt(n,t)}n(517);var Vh=n(6245),Fh=n.t(Vh,2);
/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
const jh=BigInt(0),zh=BigInt(1),$h=BigInt(2),Hh=BigInt(3),Kh=BigInt(8),qh=Object.freeze({a:jh,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:zh,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")});function Gh(e){const{a:t,b:n}=qh,r=gd(e*e),s=gd(r*e);return gd(s+t*e+n)}const Wh=qh.a===jh;class Yh extends Error{constructor(e){super(e)}}class Jh{constructor(e,t,n){this.x=e,this.y=t,this.z=n}static fromAffine(e){if(!(e instanceof Xh))throw new TypeError("JacobianPoint#fromAffine: expected Point");return new Jh(e.x,e.y,zh)}static toAffineBatch(e){const t=bd(e.map((e=>e.z)));return e.map(((e,n)=>e.toAffine(t[n])))}static normalizeZ(e){return Jh.toAffineBatch(e).map(Jh.fromAffine)}equals(e){if(!(e instanceof Jh))throw new TypeError("JacobianPoint expected");const{x:t,y:n,z:r}=this,{x:s,y:i,z:o}=e,a=gd(r*r),c=gd(o*o),l=gd(t*c),u=gd(s*a),h=gd(gd(n*o)*c),d=gd(gd(i*r)*a);return l===u&&h===d}negate(){return new Jh(this.x,gd(-this.y),this.z)}double(){const{x:e,y:t,z:n}=this,r=gd(e*e),s=gd(t*t),i=gd(s*s),o=e+s,a=gd($h*(gd(o*o)-r-i)),c=gd(Hh*r),l=gd(c*c),u=gd(l-$h*a),h=gd(c*(a-u)-Kh*i),d=gd($h*t*n);return new Jh(u,h,d)}add(e){if(!(e instanceof Jh))throw new TypeError("JacobianPoint expected");const{x:t,y:n,z:r}=this,{x:s,y:i,z:o}=e;if(s===jh||i===jh)return this;if(t===jh||n===jh)return e;const a=gd(r*r),c=gd(o*o),l=gd(t*c),u=gd(s*a),h=gd(gd(n*o)*c),d=gd(gd(i*r)*a),p=gd(u-l),f=gd(d-h);if(p===jh)return f===jh?this.double():Jh.ZERO;const g=gd(p*p),m=gd(p*g),y=gd(l*g),w=gd(f*f-m-$h*y),b=gd(f*(y-w)-h*m),v=gd(r*o*p);return new Jh(w,b,v)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){const t=Jh.ZERO;if("bigint"===typeof e&&e===jh)return t;let n=fd(e);if(n===zh)return this;if(!Wh){let e=t,r=this;while(n>jh)n&zh&&(e=e.add(r)),r=r.double(),n>>=zh;return e}let{k1neg:r,k1:s,k2neg:i,k2:o}=_d(n),a=t,c=t,l=this;while(s>jh||o>jh)s&zh&&(a=a.add(l)),o&zh&&(c=c.add(l)),l=l.double(),s>>=zh,o>>=zh;return r&&(a=a.negate()),i&&(c=c.negate()),c=new Jh(gd(c.x*qh.beta),c.y,c.z),a.add(c)}precomputeWindow(e){const t=Wh?128/e+1:256/e+1,n=[];let r=this,s=r;for(let i=0;i<t;i++){s=r,n.push(s);for(let t=1;t<2**(e-1);t++)s=s.add(r),n.push(s);r=s.double()}return n}wNAF(e,t){!t&&this.equals(Jh.BASE)&&(t=Xh.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=t&&Qh.get(t);r||(r=this.precomputeWindow(n),t&&1!==n&&(r=Jh.normalizeZ(r),Qh.set(t,r)));let s=Jh.ZERO,i=Jh.ZERO;const o=1+(Wh?128/n:256/n),a=2**(n-1),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){const t=h*a;let n=Number(e&c);if(e>>=u,n>a&&(n-=l,e+=zh),0===n){let e=r[t];h%2&&(e=e.negate()),i=i.add(e)}else{let e=r[t+Math.abs(n)-1];n<0&&(e=e.negate()),s=s.add(e)}}return{p:s,f:i}}multiply(e,t){let n,r,s=fd(e);if(Wh){const{k1neg:e,k1:i,k2neg:o,k2:a}=_d(s);let{p:c,f:l}=this.wNAF(i,t),{p:u,f:h}=this.wNAF(a,t);e&&(c=c.negate()),o&&(u=u.negate()),u=new Jh(gd(u.x*qh.beta),u.y,u.z),n=c.add(u),r=l.add(h)}else{const{p:e,f:i}=this.wNAF(s,t);n=e,r=i}return Jh.normalizeZ([n,r])[0]}toAffine(e=wd(this.z)){const{x:t,y:n,z:r}=this,s=e,i=gd(s*s),o=gd(i*s),a=gd(t*i),c=gd(n*o),l=gd(r*s);if(l!==zh)throw new Error("invZ was invalid");return new Xh(a,c)}}Jh.BASE=new Jh(qh.Gx,qh.Gy,zh),Jh.ZERO=new Jh(jh,zh,jh);const Qh=new WeakMap;class Xh{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,Qh.delete(this)}hasEvenY(){return this.y%$h===jh}static fromCompressedHex(e){const t=32===e.length,n=dd(t?e:e.subarray(1));if(!Id(n))throw new Error("Point is not on curve");const r=Gh(n);let s=yd(r);const i=(s&zh)===zh;if(t)i&&(s=gd(-s));else{const t=1===(1&e[0]);t!==i&&(s=gd(-s))}const o=new Xh(n,s);return o.assertValidity(),o}static fromUncompressedHex(e){const t=dd(e.subarray(1,33)),n=dd(e.subarray(33,65)),r=new Xh(t,n);return r.assertValidity(),r}static fromHex(e){const t=pd(e),n=t.length,r=t[0];if(32===n||33===n&&(2===r||3===r))return this.fromCompressedHex(t);if(65===n&&4===r)return this.fromUncompressedHex(t);throw new Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${n}`)}static fromPrivateKey(e){return Xh.BASE.multiply(Od(e))}static fromSignature(e,t,n){e=pd(e);const r=Sd(e),{r:s,s:i}=Nd(t);if(0!==n&&1!==n)throw new Error("Cannot recover signature: invalid recovery bit");const o=1&n?"03":"02",a=Xh.fromHex(o+ad(s)),{n:c}=qh,l=wd(s,c),u=gd(-r*l,c),h=gd(i*l,c),d=Xh.BASE.multiplyAndAddUnsafe(a,u,h);if(!d)throw new Error("Cannot recover signature: point at infinify");return d.assertValidity(),d}toRawBytes(e=!1){return hd(this.toHex(e))}toHex(e=!1){const t=ad(this.x);if(e){const e=this.hasEvenY()?"02":"03";return`${e}${t}`}return`04${t}${ad(this.y)}`}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){const e="Point is not on elliptic curve",{x:t,y:n}=this;if(!Id(t)||!Id(n))throw new Error(e);const r=gd(n*n),s=Gh(t);if(gd(r-s)!==jh)throw new Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Xh(this.x,gd(-this.y))}double(){return Jh.fromAffine(this).double().toAffine()}add(e){return Jh.fromAffine(this).add(Jh.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Jh.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,n){const r=Jh.fromAffine(this),s=t===jh||t===zh||this!==Xh.BASE?r.multiplyUnsafe(t):r.multiply(t),i=Jh.fromAffine(e).multiplyUnsafe(n),o=s.add(i);return o.equals(Jh.ZERO)?void 0:o.toAffine()}}function Zh(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}function ed(e){if(e.length<2||2!==e[0])throw new Error(`Invalid signature integer tag: ${id(e)}`);const t=e[1],n=e.subarray(2,t+2);if(!t||n.length!==t)throw new Error("Invalid signature integer: wrong length");if(0===n[0]&&n[1]<=127)throw new Error("Invalid signature integer: trailing length");return{data:dd(n),left:e.subarray(t+2)}}function td(e){if(e.length<2||48!=e[0])throw new Error(`Invalid signature tag: ${id(e)}`);if(e[1]!==e.length-2)throw new Error("Invalid signature: incorrect length");const{data:t,left:n}=ed(e.subarray(2)),{data:r,left:s}=ed(n);if(s.length)throw new Error(`Invalid signature: left bytes after parsing: ${id(s)}`);return{r:t,s:r}}Xh.BASE=new Xh(qh.Gx,qh.Gy),Xh.ZERO=new Xh(jh,jh);class nd{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){const t=e instanceof Uint8Array,n="Signature.fromCompact";if("string"!==typeof e&&!t)throw new TypeError(`${n}: Expected string or Uint8Array`);const r=t?id(e):e;if(128!==r.length)throw new Error(`${n}: Expected 64-byte hex`);return new nd(ud(r.slice(0,64)),ud(r.slice(64,128)))}static fromDER(e){const t=e instanceof Uint8Array;if("string"!==typeof e&&!t)throw new TypeError("Signature.fromDER: Expected string or Uint8Array");const{r:n,s:r}=td(t?e:hd(e));return new nd(n,r)}static fromHex(e){return this.fromDER(e)}assertValidity(){const{r:e,s:t}=this;if(!Cd(e))throw new Error("Invalid Signature: r must be 0 < r < n");if(!Cd(t))throw new Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){const e=qh.n>>zh;return this.s>e}normalizeS(){return this.hasHighS()?new nd(this.r,qh.n-this.s):this}toDERRawBytes(e=!1){return hd(this.toDERHex(e))}toDERHex(e=!1){const t=Zh(ld(this.s));if(e)return t;const n=Zh(ld(this.r)),r=ld(n.length/2),s=ld(t.length/2),i=ld(n.length/2+t.length/2+4);return`30${i}02${r}${n}02${s}${t}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return hd(this.toCompactHex())}toCompactHex(){return ad(this.r)+ad(this.s)}}function rd(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Uint8Array list expected");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const t=e[r];n.set(t,s),s+=t.length}return n}const sd=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function id(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");let t="";for(let n=0;n<e.length;n++)t+=sd[e[n]];return t}const od=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function ad(e){if("bigint"!==typeof e)throw new Error("Expected bigint");if(!(jh<=e&&e<od))throw new Error("Expected number < 2^256");return e.toString(16).padStart(64,"0")}function cd(e){const t=hd(ad(e));if(32!==t.length)throw new Error("Error: expected 32 bytes");return t}function ld(e){const t=e.toString(16);return 1&t.length?`0${t}`:t}function ud(e){if("string"!==typeof e)throw new TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function hd(e){if("string"!==typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex"+e.length);const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++){const r=2*n,s=e.slice(r,r+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");t[n]=i}return t}function dd(e){return ud(id(e))}function pd(e){return e instanceof Uint8Array?Uint8Array.from(e):hd(e)}function fd(e){if("number"===typeof e&&Number.isSafeInteger(e)&&e>0)return BigInt(e);if("bigint"===typeof e&&Cd(e))return e;throw new TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function gd(e,t=qh.P){const n=e%t;return n>=jh?n:t+n}function md(e,t){const{P:n}=qh;let r=e;while(t-- >jh)r*=r,r%=n;return r}function yd(e){const{P:t}=qh,n=BigInt(6),r=BigInt(11),s=BigInt(22),i=BigInt(23),o=BigInt(44),a=BigInt(88),c=e*e*e%t,l=c*c*e%t,u=md(l,Hh)*l%t,h=md(u,Hh)*l%t,d=md(h,$h)*c%t,p=md(d,r)*d%t,f=md(p,s)*p%t,g=md(f,o)*f%t,m=md(g,a)*g%t,y=md(m,o)*f%t,w=md(y,Hh)*l%t,b=md(w,i)*p%t,v=md(b,n)*c%t;return md(v,$h)}function wd(e,t=qh.P){if(e===jh||t<=jh)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=gd(e,t),r=t,s=jh,i=zh,o=zh,a=jh;while(n!==jh){const e=r/n,t=r%n,c=s-o*e,l=i-a*e;r=n,n=t,s=o,i=a,o=c,a=l}const c=r;if(c!==zh)throw new Error("invert: does not exist");return gd(s,t)}function bd(e,t=qh.P){const n=new Array(e.length),r=e.reduce(((e,r,s)=>r===jh?e:(n[s]=e,gd(e*r,t))),zh),s=wd(r,t);return e.reduceRight(((e,r,s)=>r===jh?e:(n[s]=gd(e*n[s],t),gd(e*r,t))),s),n}const vd=(e,t)=>(e+t/$h)/t,Ed={a1:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),b1:-zh*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),a2:BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),b2:BigInt("0x3086d221a7d46bcde86c90e49284eb15"),POW_2_128:BigInt("0x100000000000000000000000000000000")};function _d(e){const{n:t}=qh,{a1:n,b1:r,a2:s,b2:i,POW_2_128:o}=Ed,a=vd(i*e,t),c=vd(-r*e,t);let l=gd(e-a*n-c*s,t),u=gd(-a*r-c*i,t);const h=l>o,d=u>o;if(h&&(l=t-l),d&&(u=t-u),l>o||u>o)throw new Error("splitScalarEndo: Endomorphism failed, k="+e);return{k1neg:h,k1:l,k2neg:d,k2:u}}function Sd(e){const{n:t}=qh,n=e.length,r=8*n-256;let s=dd(e);return r>0&&(s>>=BigInt(r)),s>=t&&(s-=t),s}let kd,Ad;class Td{constructor(){this.v=new Uint8Array(32).fill(1),this.k=new Uint8Array(32).fill(0),this.counter=0}hmac(...e){return Hd.hmacSha256(this.k,...e)}hmacSync(...e){return Ad(this.k,...e)}checkSync(){if("function"!==typeof Ad)throw new Yh("hmacSha256Sync needs to be set")}incr(){if(this.counter>=1e3)throw new Error("Tried 1,000 k values for sign(), all were invalid");this.counter+=1}async reseed(e=new Uint8Array){this.k=await this.hmac(this.v,Uint8Array.from([0]),e),this.v=await this.hmac(this.v),0!==e.length&&(this.k=await this.hmac(this.v,Uint8Array.from([1]),e),this.v=await this.hmac(this.v))}reseedSync(e=new Uint8Array){this.checkSync(),this.k=this.hmacSync(this.v,Uint8Array.from([0]),e),this.v=this.hmacSync(this.v),0!==e.length&&(this.k=this.hmacSync(this.v,Uint8Array.from([1]),e),this.v=this.hmacSync(this.v))}async generate(){return this.incr(),this.v=await this.hmac(this.v),this.v}generateSync(){return this.checkSync(),this.incr(),this.v=this.hmacSync(this.v),this.v}}function Cd(e){return jh<e&&e<qh.n}function Id(e){return jh<e&&e<qh.P}function Rd(e,t,n){const r=dd(e);if(!Cd(r))return;const{n:s}=qh,i=Xh.BASE.multiply(r),o=gd(i.x,s);if(o===jh)return;const a=gd(wd(r,s)*gd(t+n*o,s),s);if(a===jh)return;const c=new nd(o,a),l=(i.x===c.r?0:2)|Number(i.y&zh);return{sig:c,recovery:l}}function Od(e){let t;if("bigint"===typeof e)t=e;else if("number"===typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"===typeof e){if(64!==e.length)throw new Error("Expected 32 bytes of private key");t=ud(e)}else{if(!(e instanceof Uint8Array))throw new TypeError("Expected valid private key");if(32!==e.length)throw new Error("Expected 32 bytes of private key");t=dd(e)}if(!Cd(t))throw new Error("Expected private key: 0 < key < n");return t}function xd(e){return e instanceof Xh?(e.assertValidity(),e):Xh.fromHex(e)}function Nd(e){if(e instanceof nd)return e.assertValidity(),e;try{return nd.fromDER(e)}catch(t){return nd.fromCompact(e)}}function Dd(e,t=!1){return Xh.fromPrivateKey(e).toRawBytes(t)}function Pd(e){const t=e.length>32?e.slice(0,32):e;return dd(t)}function Ld(e){const t=Pd(e),n=gd(t,qh.n);return Md(n<jh?t:n)}function Md(e){return cd(e)}function Bd(e,t,n){if(null==e)throw new Error(`sign: expected valid message hash, not "${e}"`);const r=pd(e),s=Od(t),i=[Md(s),Ld(r)];if(null!=n){!0===n&&(n=Hd.randomBytes(32));const e=pd(n);if(32!==e.length)throw new Error("sign: Expected 32 bytes of extra data");i.push(e)}const o=rd(...i),a=Pd(r);return{seed:o,m:a,d:s}}function Ud(e,t){let{sig:n,recovery:r}=e;const{canonical:s,der:i,recovered:o}=Object.assign({canonical:!0,der:!0},t);s&&n.hasHighS()&&(n=n.normalizeS(),r^=1);const a=i?n.toDERRawBytes():n.toCompactRawBytes();return o?[a,r]:a}async function Vd(e,t,n={}){const{seed:r,m:s,d:i}=Bd(e,t,n.extraEntropy);let o;const a=new Td;await a.reseed(r);while(!(o=Rd(await a.generate(),s,i)))await a.reseed();return Ud(o,n)}const Fd={strict:!0};function jd(e,t,n,r=Fd){let s;try{s=Nd(e),t=pd(t)}catch(g){return!1}const{r:i,s:o}=s;if(r.strict&&s.hasHighS())return!1;const a=Sd(t);let c;try{c=xd(n)}catch(g){return!1}const{n:l}=qh,u=wd(o,l),h=gd(a*u,l),d=gd(i*u,l),p=Xh.BASE.multiplyAndAddUnsafe(c,h,d);if(!p)return!1;const f=gd(p.x,l);return f===i}Xh.BASE._setWindowSize(8);const zd={node:Fh,web:"object"===typeof self&&"crypto"in self?self.crypto:void 0},$d={},Hd={bytesToHex:id,hexToBytes:hd,concatBytes:rd,mod:gd,invert:wd,isValidPrivateKey(e){try{return Od(e),!0}catch(t){return!1}},_bigintTo32Bytes:cd,_normalizePrivateKey:Od,hashToPrivateKey:e=>{if(e=pd(e),e.length<40||e.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");const t=gd(dd(e),qh.n-zh)+zh;return cd(t)},randomBytes:(e=32)=>{if(zd.web)return zd.web.getRandomValues(new Uint8Array(e));if(zd.node){const{randomBytes:t}=zd.node;return Uint8Array.from(t(e))}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>Hd.hashToPrivateKey(Hd.randomBytes(40)),sha256:async(...e)=>{if(zd.web){const t=await zd.web.subtle.digest("SHA-256",rd(...e));return new Uint8Array(t)}if(zd.node){const{createHash:t}=zd.node,n=t("sha256");return e.forEach((e=>n.update(e))),Uint8Array.from(n.digest())}throw new Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(zd.web){const n=await zd.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),r=rd(...t),s=await zd.web.subtle.sign("HMAC",n,r);return new Uint8Array(s)}if(zd.node){const{createHmac:n}=zd.node,r=n("sha256",e);return t.forEach((e=>r.update(e))),Uint8Array.from(r.digest())}throw new Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(e,...t)=>{let n=$d[e];if(void 0===n){const t=await Hd.sha256(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=rd(t,t),$d[e]=n}return Hd.sha256(n,...t)},taggedHashSync:(e,...t)=>{if("function"!==typeof kd)throw new Yh("sha256Sync is undefined, you need to set it");let n=$d[e];if(void 0===n){const t=kd(Uint8Array.from(e,(e=>e.charCodeAt(0))));n=rd(t,t),$d[e]=n}return kd(n,...t)},precompute(e=8,t=Xh.BASE){const n=t===Xh.BASE?t:new Xh(t.x,t.y);return n._setWindowSize(e),n.multiply(Hh),n}};function Kd(e){if(isNaN(e)||e<=0)throw je(new Error("random bytes length must be a Number bigger than 0"),"ERR_INVALID_LENGTH");return Hd.randomBytes(e)}Object.defineProperties(Hd,{sha256Sync:{configurable:!1,get(){return kd},set(e){kd||(kd=e)}},hmacSha256Sync:{configurable:!1,get(){return Ad},set(e){Ad||(Ad=e)}}});n(536);function qd(e){const t=Rh.asn1.fromDer(ia(e,"ascii")),n=Rh.pki.privateKeyFromAsn1(t);return{kty:"RSA",n:Nh(n.n),e:Nh(n.e),d:Nh(n.d),p:Nh(n.p),q:Nh(n.q),dp:Nh(n.dP),dq:Nh(n.dQ),qi:Nh(n.qInv),alg:"RS256"}}function Gd(e){if(null==e.n||null==e.e||null==e.d||null==e.p||null==e.q||null==e.dp||null==e.dq||null==e.qi)throw je(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");const t=Rh.pki.privateKeyToAsn1({n:Dh(e.n),e:Dh(e.e),d:Dh(e.d),p:Dh(e.p),q:Dh(e.q),dP:Dh(e.dp),dQ:Dh(e.dq),qInv:Dh(e.qi)});return $o(Rh.asn1.toDer(t).getBytes(),"ascii")}function Wd(e){const t=Rh.asn1.fromDer(ia(e,"ascii")),n=Rh.pki.publicKeyFromAsn1(t);return{kty:"RSA",n:Nh(n.n),e:Nh(n.e)}}function Yd(e){if(null==e.n||null==e.e)throw je(new Error("JWK was missing components"),"ERR_INVALID_PARAMETERS");const t=Rh.pki.publicKeyToAsn1({n:Dh(e.n),e:Dh(e.e)});return $o(Rh.asn1.toDer(t).getBytes(),"ascii")}function Jd(e,t){return t.map((t=>Dh(e[t])))}function Qd(e){return Rh.pki.setRsaPrivateKey(...Jd(e,["n","e","d","p","q","dp","dq","qi"]))}function Xd(e){return Rh.pki.setRsaPublicKey(...Jd(e,["n","e"]))}async function Zd(e){const t=await Oh.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:e,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await rp(t);return{privateKey:n[0],publicKey:n[1]}}async function ep(e){const t=await Oh.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),n=[t,await sp(e)],r=await rp({privateKey:n[0],publicKey:n[1]});return{privateKey:r[0],publicKey:r[1]}}async function tp(e,t){const n=await Oh.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]),r=await Oh.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,Uint8Array.from(t));return new Uint8Array(r,0,r.byteLength)}async function np(e,t,n){const r=await Oh.get().subtle.importKey("jwk",e,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);return await Oh.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},r,t,n)}async function rp(e){if(null==e.privateKey||null==e.publicKey)throw je(new Error("Private and public key are required"),"ERR_INVALID_PARAMETERS");return await Promise.all([Oh.get().subtle.exportKey("jwk",e.privateKey),Oh.get().subtle.exportKey("jwk",e.publicKey)])}async function sp(e){return await Oh.get().subtle.importKey("jwk",{kty:e.kty,n:e.n,e:e.e},{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])}function ip(e,t,n,r){const s=t?Xd(e):Qd(e),i=ia(Uint8Array.from(n),"ascii"),o=r(i,s);return $o(o,"ascii")}function op(e,t){return ip(e,!0,t,((e,t)=>t.encrypt(e)))}function ap(e,t){return ip(e,!1,t,((e,t)=>t.decrypt(e)))}async function cp(e,t){const n=Bh(),r=await n.encrypt(e,t);return Me.encode(r)}class lp{constructor(e){this._key=e}async verify(e,t){return await np(this._key,t,e)}marshal(){return Yd(this._key)}get bytes(){return kh.encode({Type:_h.RSA,Data:this.marshal()}).subarray()}encrypt(e){return op(this._key,e)}equals(e){return Ja(this.bytes,e.bytes)}async hash(){const{bytes:e}=await ho.digest(this.bytes);return e}}class up{constructor(e,t){this._key=e,this._publicKey=t}genSecret(){return Kd(16)}async sign(e){return await tp(this._key,e)}get public(){if(null==this._publicKey)throw je(new Error("public key not provided"),"ERR_PUBKEY_NOT_PROVIDED");return new lp(this._publicKey)}decrypt(e){return ap(this._key,e)}marshal(){return Gd(this._key)}get bytes(){return Ah.encode({Type:_h.RSA,Data:this.marshal()}).subarray()}equals(e){return Ja(this.bytes,e.bytes)}async hash(){const{bytes:e}=await ho.digest(this.bytes);return e}async id(){const e=await this.public.hash();return ia(e,"base58btc")}async export(e,t="pkcs-8"){if("pkcs-8"===t){const t=new Rh.util.ByteBuffer(this.marshal()),n=Rh.asn1.fromDer(t),r=Rh.pki.privateKeyFromAsn1(n),s={algorithm:"aes256",count:1e4,saltSize:16,prfAlgorithm:"sha512"};return Rh.pki.encryptRsaPrivateKey(r,e,s)}if("libp2p-key"===t)return await cp(this.bytes,e);throw je(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}async function hp(e){const t=qd(e),n=await ep(t);return new up(n.privateKey,n.publicKey)}function dp(e){const t=Wd(e);return new lp(t)}async function pp(e){const t=await ep(e);return new up(t.privateKey,t.publicKey)}async function fp(e){const t=await Zd(e);return new up(t.privateKey,t.publicKey)}var gp=n(2049),mp=n.t(gp,2);
/*! noble-ed25519 - MIT License (c) 2019 Paul Miller (paulmillr.com) */
const yp=BigInt(0),wp=BigInt(1),bp=BigInt(2),vp=BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),Ep=Object.freeze({a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),P:BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),l:vp,n:vp,h:BigInt(8),Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960")}),_p=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000"),Sp=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752"),kp=(BigInt("6853475219497561581579357271197624642482790079785650197046958215289687604742"),BigInt("25063068953384623474111414158702152701244531502492656460079210482610430750235")),Ap=BigInt("54469307008909316920995813868745141605393597292927456921205312896311721017578"),Tp=BigInt("1159843021668779879193775521855586647937357759715417654439879720876111806838"),Cp=BigInt("40440834346308536858101042469323190826248399146238708352240133220865137265952");class Ip{constructor(e,t,n,r){this.x=e,this.y=t,this.z=n,this.t=r}static fromAffine(e){if(!(e instanceof Pp))throw new TypeError("ExtendedPoint#fromAffine: expected Point");return e.equals(Pp.ZERO)?Ip.ZERO:new Ip(e.x,e.y,wp,qp(e.x*e.y))}static toAffineBatch(e){const t=Wp(e.map((e=>e.z)));return e.map(((e,n)=>e.toAffine(t[n])))}static normalizeZ(e){return this.toAffineBatch(e).map(this.fromAffine)}equals(e){Rp(e);const{x:t,y:n,z:r}=this,{x:s,y:i,z:o}=e,a=qp(t*o),c=qp(s*r),l=qp(n*o),u=qp(i*r);return a===c&&l===u}negate(){return new Ip(qp(-this.x),this.y,this.z,qp(-this.t))}double(){const{x:e,y:t,z:n}=this,{a:r}=Ep,s=qp(e*e),i=qp(t*t),o=qp(bp*qp(n*n)),a=qp(r*s),c=e+t,l=qp(qp(c*c)-s-i),u=a+i,h=u-o,d=a-i,p=qp(l*h),f=qp(u*d),g=qp(l*d),m=qp(h*u);return new Ip(p,f,m,g)}add(e){Rp(e);const{x:t,y:n,z:r,t:s}=this,{x:i,y:o,z:a,t:c}=e,l=qp((n-t)*(o+i)),u=qp((n+t)*(o-i)),h=qp(u-l);if(h===yp)return this.double();const d=qp(r*bp*c),p=qp(s*bp*a),f=p+d,g=u+l,m=p-d,y=qp(f*h),w=qp(g*m),b=qp(f*m),v=qp(h*g);return new Ip(y,w,v,b)}subtract(e){return this.add(e.negate())}precomputeWindow(e){const t=1+256/e,n=[];let r=this,s=r;for(let i=0;i<t;i++){s=r,n.push(s);for(let t=1;t<2**(e-1);t++)s=s.add(r),n.push(s);r=s.double()}return n}wNAF(e,t){!t&&this.equals(Ip.BASE)&&(t=Pp.BASE);const n=t&&t._WINDOW_SIZE||1;if(256%n)throw new Error("Point#wNAF: Invalid precomputation window, must be power of 2");let r=t&&Dp.get(t);r||(r=this.precomputeWindow(n),t&&1!==n&&(r=Ip.normalizeZ(r),Dp.set(t,r)));let s=Ip.ZERO,i=Ip.ZERO;const o=1+256/n,a=2**(n-1),c=BigInt(2**n-1),l=2**n,u=BigInt(n);for(let h=0;h<o;h++){const t=h*a;let n=Number(e&c);if(e>>=u,n>a&&(n-=l,e+=wp),0===n){let e=r[t];h%2&&(e=e.negate()),i=i.add(e)}else{let e=r[t+Math.abs(n)-1];n<0&&(e=e.negate()),s=s.add(e)}}return Ip.normalizeZ([s,i])[0]}multiply(e,t){return this.wNAF(nf(e,Ep.l),t)}multiplyUnsafe(e){let t=nf(e,Ep.l,!1);const n=Ip.BASE,r=Ip.ZERO;if(t===yp)return r;if(this.equals(r)||t===wp)return this;if(this.equals(n))return this.wNAF(t);let s=r,i=this;while(t>yp)t&wp&&(s=s.add(i)),i=i.double(),t>>=wp;return s}isSmallOrder(){return this.multiplyUnsafe(Ep.h).equals(Ip.ZERO)}isTorsionFree(){return this.multiplyUnsafe(Ep.l).equals(Ip.ZERO)}toAffine(e=Gp(this.z)){const{x:t,y:n,z:r}=this,s=qp(t*e),i=qp(n*e),o=qp(r*e);if(o!==wp)throw new Error("invZ was invalid");return new Pp(s,i)}fromRistrettoBytes(){xp()}toRistrettoBytes(){xp()}fromRistrettoHash(){xp()}}function Rp(e){if(!(e instanceof Ip))throw new TypeError("ExtendedPoint expected")}function Op(e){if(!(e instanceof Np))throw new TypeError("RistrettoPoint expected")}function xp(){throw new Error("Legacy method: switch to RistrettoPoint")}Ip.BASE=new Ip(Ep.Gx,Ep.Gy,wp,qp(Ep.Gx*Ep.Gy)),Ip.ZERO=new Ip(yp,wp,wp,yp);class Np{constructor(e){this.ep=e}static calcElligatorRistrettoMap(e){const{d:t}=Ep,n=qp(Sp*e*e),r=qp((n+wp)*Tp);let s=BigInt(-1);const i=qp((s-t*n)*qp(n+t));let{isValid:o,value:a}=Qp(r,i),c=qp(a*e);zp(c)||(c=qp(-c)),o||(a=c),o||(s=n);const l=qp(s*(n-wp)*Cp-i),u=a*a,h=qp((a+a)*i),d=qp(l*kp),p=qp(wp-u),f=qp(wp+u);return new Ip(qp(h*f),qp(p*d),qp(d*f),qp(h*p))}static hashToCurve(e){e=tf(e,64);const t=Kp(e.slice(0,32)),n=this.calcElligatorRistrettoMap(t),r=Kp(e.slice(32,64)),s=this.calcElligatorRistrettoMap(r);return new Np(n.add(s))}static fromHex(e){e=tf(e,32);const{a:t,d:n}=Ep,r="RistrettoPoint.fromHex: the hex is not valid encoding of RistrettoPoint",s=Kp(e);if(!ef(jp(s),e)||zp(s))throw new Error(r);const i=qp(s*s),o=qp(wp+t*i),a=qp(wp-t*i),c=qp(o*o),l=qp(a*a),u=qp(t*n*c-l),{isValid:h,value:d}=Xp(qp(u*l)),p=qp(d*a),f=qp(d*p*u);let g=qp((s+s)*p);zp(g)&&(g=qp(-g));const m=qp(o*f),y=qp(g*m);if(!h||zp(y)||m===yp)throw new Error(r);return new Np(new Ip(g,m,wp,y))}toRawBytes(){let{x:e,y:t,z:n,t:r}=this.ep;const s=qp(qp(n+t)*qp(n-t)),i=qp(e*t),o=qp(i*i),{value:a}=Xp(qp(s*o)),c=qp(a*s),l=qp(a*i),u=qp(c*l*r);let h;if(zp(r*u)){let n=qp(t*Sp),r=qp(e*Sp);e=n,t=r,h=qp(c*Ap)}else h=l;zp(e*u)&&(t=qp(-t));let d=qp((n-t)*h);return zp(d)&&(d=qp(-d)),jp(d)}toHex(){return Up(this.toRawBytes())}toString(){return this.toHex()}equals(e){Op(e);const t=this.ep,n=e.ep,r=qp(t.x*n.y)===qp(t.y*n.x),s=qp(t.y*n.y)===qp(t.x*n.x);return r||s}add(e){return Op(e),new Np(this.ep.add(e.ep))}subtract(e){return Op(e),new Np(this.ep.subtract(e.ep))}multiply(e){return new Np(this.ep.multiply(e))}multiplyUnsafe(e){return new Np(this.ep.multiplyUnsafe(e))}}Np.BASE=new Np(Ip.BASE),Np.ZERO=new Np(Ip.ZERO);const Dp=new WeakMap;class Pp{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,Dp.delete(this)}static fromHex(e,t=!0){const{d:n,P:r}=Ep;e=tf(e,32);const s=e.slice();s[31]=-129&e[31];const i=$p(s);if(t&&i>=r)throw new Error("Expected 0 < hex < P");if(!t&&i>=_p)throw new Error("Expected 0 < hex < 2**256");const o=qp(i*i),a=qp(o-wp),c=qp(n*o+wp);let{isValid:l,value:u}=Qp(a,c);if(!l)throw new Error("Point.fromHex: invalid y coordinate");const h=(u&wp)===wp,d=0!==(128&e[31]);return d!==h&&(u=qp(-u)),new Pp(u,i)}static async fromPrivateKey(e){return(await cf(e)).point}toRawBytes(){const e=jp(this.y);return e[31]|=this.x&wp?128:0,e}toHex(){return Up(this.toRawBytes())}toX25519(){const{y:e}=this,t=qp((wp+e)*Gp(wp-e));return jp(t)}isTorsionFree(){return Ip.fromAffine(this).isTorsionFree()}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new Pp(qp(-this.x),this.y)}add(e){return Ip.fromAffine(this).add(Ip.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return Ip.fromAffine(this).multiply(e,this).toAffine()}}Pp.BASE=new Pp(Ep.Gx,Ep.Gy),Pp.ZERO=new Pp(yp,wp);class Lp{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){const t=tf(e,64),n=Pp.fromHex(t.slice(0,32),!1),r=$p(t.slice(32,64));return new Lp(n,r)}assertValidity(){const{r:e,s:t}=this;if(!(e instanceof Pp))throw new Error("Expected Point instance");return nf(t,Ep.l,!1),this}toRawBytes(){const e=new Uint8Array(64);return e.set(this.r.toRawBytes()),e.set(jp(this.s),32),e}toHex(){return Up(this.toRawBytes())}}function Mp(...e){if(!e.every((e=>e instanceof Uint8Array)))throw new Error("Expected Uint8Array list");if(1===e.length)return e[0];const t=e.reduce(((e,t)=>e+t.length),0),n=new Uint8Array(t);for(let r=0,s=0;r<e.length;r++){const t=e[r];n.set(t,s),s+=t.length}return n}const Bp=Array.from({length:256},((e,t)=>t.toString(16).padStart(2,"0")));function Up(e){if(!(e instanceof Uint8Array))throw new Error("Uint8Array expected");let t="";for(let n=0;n<e.length;n++)t+=Bp[e[n]];return t}function Vp(e){if("string"!==typeof e)throw new TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw new Error("hexToBytes: received invalid unpadded hex");const t=new Uint8Array(e.length/2);for(let n=0;n<t.length;n++){const r=2*n,s=e.slice(r,r+2),i=Number.parseInt(s,16);if(Number.isNaN(i)||i<0)throw new Error("Invalid byte sequence");t[n]=i}return t}function Fp(e){const t=32,n=e.toString(16).padStart(2*t,"0");return Vp(n)}function jp(e){return Fp(e).reverse()}function zp(e){return(qp(e)&wp)===wp}function $p(e){if(!(e instanceof Uint8Array))throw new Error("Expected Uint8Array");return BigInt("0x"+Up(Uint8Array.from(e).reverse()))}const Hp=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function Kp(e){return qp($p(e)&Hp)}function qp(e,t=Ep.P){const n=e%t;return n>=yp?n:t+n}function Gp(e,t=Ep.P){if(e===yp||t<=yp)throw new Error(`invert: expected positive integers, got n=${e} mod=${t}`);let n=qp(e,t),r=t,s=yp,i=wp,o=wp,a=yp;while(n!==yp){const e=r/n,t=r%n,c=s-o*e,l=i-a*e;r=n,n=t,s=o,i=a,o=c,a=l}const c=r;if(c!==wp)throw new Error("invert: does not exist");return qp(s,t)}function Wp(e,t=Ep.P){const n=new Array(e.length),r=e.reduce(((e,r,s)=>r===yp?e:(n[s]=e,qp(e*r,t))),wp),s=Gp(r,t);return e.reduceRight(((e,r,s)=>r===yp?e:(n[s]=qp(e*n[s],t),qp(e*r,t))),s),n}function Yp(e,t){const{P:n}=Ep;let r=e;while(t-- >yp)r*=r,r%=n;return r}function Jp(e){const{P:t}=Ep,n=BigInt(5),r=BigInt(10),s=BigInt(20),i=BigInt(40),o=BigInt(80),a=e*e%t,c=a*e%t,l=Yp(c,bp)*c%t,u=Yp(l,wp)*e%t,h=Yp(u,n)*u%t,d=Yp(h,r)*h%t,p=Yp(d,s)*d%t,f=Yp(p,i)*p%t,g=Yp(f,o)*f%t,m=Yp(g,o)*f%t,y=Yp(m,r)*h%t,w=Yp(y,bp)*e%t;return{pow_p_5_8:w,b2:c}}function Qp(e,t){const n=qp(t*t*t),r=qp(n*n*t),s=Jp(e*r).pow_p_5_8;let i=qp(e*n*s);const o=qp(t*i*i),a=i,c=qp(i*Sp),l=o===e,u=o===qp(-e),h=o===qp(-e*Sp);return l&&(i=a),(u||h)&&(i=c),zp(i)&&(i=qp(-i)),{isValid:l||u,value:i}}function Xp(e){return Qp(wp,e)}function Zp(e){return qp($p(e),Ep.l)}function ef(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function tf(e,t){const n=e instanceof Uint8Array?Uint8Array.from(e):Vp(e);if("number"===typeof t&&n.length!==t)throw new Error(`Expected ${t} bytes`);return n}function nf(e,t,n=!0){if(!t)throw new TypeError("Specify max value");if("number"===typeof e&&Number.isSafeInteger(e)&&(e=BigInt(e)),"bigint"===typeof e&&e<t)if(n){if(yp<e)return e}else if(yp<=e)return e;throw new TypeError("Expected valid scalar: 0 < scalar < max")}function rf(e){return e[0]&=248,e[31]&=127,e[31]|=64,e}function sf(e){if(e="bigint"===typeof e||"number"===typeof e?Fp(nf(e,_p)):tf(e),32!==e.length)throw new Error("Expected 32 bytes");return e}function of(e){const t=rf(e.slice(0,32)),n=e.slice(32,64),r=Zp(t),s=Pp.BASE.multiply(r),i=s.toRawBytes();return{head:t,prefix:n,scalar:r,point:s,pointBytes:i}}let af;async function cf(e){return of(await gf.sha512(sf(e)))}async function lf(e){return(await cf(e)).pointBytes}async function uf(e,t){e=tf(e);const{prefix:n,scalar:r,pointBytes:s}=await cf(t),i=Zp(await gf.sha512(n,e)),o=Pp.BASE.multiply(i),a=Zp(await gf.sha512(o.toRawBytes(),s,e)),c=qp(i+a*r,Ep.l);return new Lp(o,c).toRawBytes()}function hf(e,t,n){t=tf(t),n instanceof Pp||(n=Pp.fromHex(n,!1));const{r:r,s:s}=e instanceof Lp?e.assertValidity():Lp.fromHex(e),i=Ip.BASE.multiplyUnsafe(s);return{r:r,s:s,SB:i,pub:n,msg:t}}function df(e,t,n,r){const s=Zp(r),i=Ip.fromAffine(e).multiplyUnsafe(s),o=Ip.fromAffine(t).add(i);return o.subtract(n).multiplyUnsafe(Ep.h).equals(Ip.ZERO)}async function pf(e,t,n){const{r:r,SB:s,msg:i,pub:o}=hf(e,t,n),a=await gf.sha512(r.toRawBytes(),o.toRawBytes(),i);return df(o,r,s,a)}Pp.BASE._setWindowSize(8);const ff={node:mp,web:"object"===typeof self&&"crypto"in self?self.crypto:void 0},gf={bytesToHex:Up,hexToBytes:Vp,concatBytes:Mp,getExtendedPublicKey:cf,mod:qp,invert:Gp,TORSION_SUBGROUP:["0100000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac037a","0000000000000000000000000000000000000000000000000000000000000080","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc05","ecffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff7f","26e8958fc2b227b045c3f489f2ef98f0d5dfac05d3c63339b13802886d53fc85","0000000000000000000000000000000000000000000000000000000000000000","c7176a703d4dd84fba3c0b760d10670f2a2053fa2c39ccc64ec7fd7792ac03fa"],hashToPrivateScalar:e=>{if(e=tf(e),e.length<40||e.length>1024)throw new Error("Expected 40-1024 bytes of private key as per FIPS 186");return qp($p(e),Ep.l-wp)+wp},randomBytes:(e=32)=>{if(ff.web)return ff.web.getRandomValues(new Uint8Array(e));if(ff.node){const{randomBytes:t}=ff.node;return new Uint8Array(t(e).buffer)}throw new Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>gf.randomBytes(32),sha512:async(...e)=>{const t=Mp(...e);if(ff.web){const e=await ff.web.subtle.digest("SHA-512",t.buffer);return new Uint8Array(e)}if(ff.node)return Uint8Array.from(ff.node.createHash("sha512").update(t).digest());throw new Error("The environment doesn't have sha512 function")},precompute(e=8,t=Pp.BASE){const n=t.equals(Pp.BASE)?t:new Pp(t.x,t.y);return n._setWindowSize(e),n.multiply(bp),n},sha512Sync:void 0};Object.defineProperties(gf,{sha512Sync:{configurable:!1,get(){return af},set(e){af||(af=e)}}});const mf=32,yf=64,wf=32;async function bf(){const e=gf.randomPrivateKey(),t=await lf(e),n=Sf(e,t);return{privateKey:n,publicKey:t}}async function vf(e){if(e.length!==wf)throw new TypeError('"seed" must be 32 bytes in length.');if(!(e instanceof Uint8Array))throw new TypeError('"seed" must be a node.js Buffer, or Uint8Array.');const t=e,n=await lf(t),r=Sf(t,n);return{privateKey:r,publicKey:n}}async function Ef(e,t){const n=e.subarray(0,wf);return await uf(t,n)}async function _f(e,t,n){return await pf(t,n,e)}function Sf(e,t){const n=new Uint8Array(yf);for(let r=0;r<wf;r++)n[r]=e[r],n[wf+r]=t[r];return n}class kf{constructor(e){this._key=Of(e,mf)}async verify(e,t){return await _f(this._key,t,e)}marshal(){return this._key}get bytes(){return kh.encode({Type:_h.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ja(this.bytes,e.bytes)}async hash(){const{bytes:e}=await ho.digest(this.bytes);return e}}class Af{constructor(e,t){this._key=Of(e,yf),this._publicKey=Of(t,mf)}async sign(e){return await Ef(this._key,e)}get public(){return new kf(this._publicKey)}marshal(){return this._key}get bytes(){return Ah.encode({Type:_h.Ed25519,Data:this.marshal()}).subarray()}equals(e){return Ja(this.bytes,e.bytes)}async hash(){const{bytes:e}=await ho.digest(this.bytes);return e}async id(){const e=await Yi.digest(this.public.bytes);return Ae.encode(e.bytes).substring(1)}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await cp(this.bytes,e);throw je(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function Tf(e){if(e.length>yf){e=Of(e,yf+mf);const t=e.subarray(0,yf),n=e.subarray(yf,e.length);return new Af(t,n)}e=Of(e,yf);const t=e.subarray(0,yf),n=e.subarray(mf);return new Af(t,n)}function Cf(e){return e=Of(e,mf),new kf(e)}async function If(){const{privateKey:e,publicKey:t}=await bf();return new Af(e,t)}async function Rf(e){const{privateKey:t,publicKey:n}=await vf(e);return new Af(t,n)}function Of(e,t){if(e=Uint8Array.from(e??[]),e.length!==t)throw je(new Error(`Key must be a Uint8Array of length ${t}, got ${e.length}`),"ERR_INVALID_KEY_TYPE");return e}function xf(){return Hd.randomPrivateKey()}async function Nf(e,t){const{digest:n}=await ho.digest(t);try{return await Vd(n,e)}catch(uS){throw je(uS,"ERR_INVALID_INPUT")}}async function Df(e,t,n){try{const{digest:r}=await ho.digest(n);return jd(t,r,e)}catch(uS){throw je(uS,"ERR_INVALID_INPUT")}}function Pf(e){const t=Xh.fromHex(e).toRawBytes(!0);return t}function Lf(e){try{Dd(e,!0)}catch(uS){throw je(uS,"ERR_INVALID_PRIVATE_KEY")}}function Mf(e){try{Xh.fromHex(e)}catch(uS){throw je(uS,"ERR_INVALID_PUBLIC_KEY")}}function Bf(e){try{return Dd(e,!0)}catch(uS){throw je(uS,"ERR_INVALID_PRIVATE_KEY")}}class Uf{constructor(e){Mf(e),this._key=e}async verify(e,t){return await Df(this._key,t,e)}marshal(){return Pf(this._key)}get bytes(){return kh.encode({Type:_h.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ja(this.bytes,e.bytes)}async hash(){const{bytes:e}=await ho.digest(this.bytes);return e}}class Vf{constructor(e,t){this._key=e,this._publicKey=t??Bf(e),Lf(this._key),Mf(this._publicKey)}async sign(e){return await Nf(this._key,e)}get public(){return new Uf(this._publicKey)}marshal(){return this._key}get bytes(){return Ah.encode({Type:_h.Secp256k1,Data:this.marshal()}).subarray()}equals(e){return Ja(this.bytes,e.bytes)}async hash(){const{bytes:e}=await ho.digest(this.bytes);return e}async id(){const e=await this.public.hash();return ia(e,"base58btc")}async export(e,t="libp2p-key"){if("libp2p-key"===t)return await cp(this.bytes,e);throw je(new Error(`export format '${t}' is not supported`),"ERR_INVALID_EXPORT_FORMAT")}}function Ff(e){return new Vf(e)}function jf(e){return new Uf(e)}async function zf(){const e=await xf();return new Vf(e)}const $f={rsa:E,ed25519:_,secp256k1:S};function Hf(e){const t=Object.keys($f).join(" / ");return je(new Error(`invalid or unsupported key type ${e}. Must be ${t}`),"ERR_UNSUPPORTED_KEY_TYPE")}function Kf(e){if(e=e.toLowerCase(),"rsa"===e||"ed25519"===e||"secp256k1"===e)return $f[e];throw Hf(e)}async function qf(e,t){return await Kf(e).generateKeyPair(t??2048)}function Gf(e){const t=kh.decode(e),n=t.Data??new Uint8Array;switch(t.Type){case _h.RSA:return $f.rsa.unmarshalRsaPublicKey(n);case _h.Ed25519:return $f.ed25519.unmarshalEd25519PublicKey(n);case _h.Secp256k1:return $f.secp256k1.unmarshalSecp256k1PublicKey(n);default:throw Hf(t.Type??"RSA")}}function Wf(e,t){return t=(t??"rsa").toLowerCase(),Kf(t),e.bytes}async function Yf(e){const t=Ah.decode(e),n=t.Data??new Uint8Array;switch(t.Type){case _h.RSA:return await $f.rsa.unmarshalRsaPrivateKey(n);case _h.Ed25519:return $f.ed25519.unmarshalEd25519PrivateKey(n);case _h.Secp256k1:return $f.secp256k1.unmarshalSecp256k1PrivateKey(n);default:throw Hf(t.Type??"RSA")}}function Jf(e,t){return t=(t??"rsa").toLowerCase(),Kf(t),e.bytes}async function Qf(e,t){try{const n=await Uh(e,t);return await Yf(n)}catch(s){}const n=Rh.pki.decryptRsaPrivateKey(e,t);if(null===n)throw je(new Error("Cannot read the key, most likely the password is wrong or not a RSA key"),"ERR_CANNOT_DECRYPT_PEM");let r=Rh.asn1.toDer(Rh.pki.privateKeyToAsn1(n));return r=$o(r.getBytes(),"ascii"),await $f.rsa.unmarshalRsaPrivateKey(r)}const Xf="ERR_IPNS_EXPIRED_RECORD",Zf="ERR_UNRECOGNIZED_VALIDITY",eg="ERR_SIGNATURE_CREATION",tg="ERR_SIGNATURE_VERIFICATION",ng="ERR_UNRECOGNIZED_FORMAT",rg="ERR_UNDEFINED_PARAMETER",sg="ERR_INVALID_RECORD_DATA",ig="ERR_INVALID_EMBEDDED_KEY",og="ERR_MISSING_PRIVATE_KEY";var ag;(function(e){let t,n,r;(function(e){e["EOL"]="EOL"})(t=e.ValidityType||(e.ValidityType={})),function(e){e[e["EOL"]=0]="EOL"}(n||(n={})),function(e){e.codec=()=>Ch(n)}(t=e.ValidityType||(e.ValidityType={})),e.codec=()=>(null==r&&(r=Ih(((t,n,r={})=>{!1!==r.lengthDelimited&&n.fork(),null!=t.value&&(n.uint32(10),n.bytes(t.value)),null!=t.signature&&(n.uint32(18),n.bytes(t.signature)),null!=t.validityType&&(n.uint32(24),e.ValidityType.codec().encode(t.validityType,n)),null!=t.validity&&(n.uint32(34),n.bytes(t.validity)),null!=t.sequence&&(n.uint32(40),n.uint64(t.sequence)),null!=t.ttl&&(n.uint32(48),n.uint64(t.ttl)),null!=t.pubKey&&(n.uint32(58),n.bytes(t.pubKey)),null!=t.signatureV2&&(n.uint32(66),n.bytes(t.signatureV2)),null!=t.data&&(n.uint32(74),n.bytes(t.data)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},s=null==n?t.len:t.pos+n;while(t.pos<s){const n=t.uint32();switch(n>>>3){case 1:r.value=t.bytes();break;case 2:r.signature=t.bytes();break;case 3:r.validityType=e.ValidityType.codec().decode(t);break;case 4:r.validity=t.bytes();break;case 5:r.sequence=t.uint64();break;case 6:r.ttl=t.uint64();break;case 7:r.pubKey=t.bytes();break;case 8:r.signatureV2=t.bytes();break;case 9:r.data=t.bytes();break;default:t.skipType(7&n);break}}return r}))),r),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(ag||(ag={}));const cg=Fe("ipns:utils"),lg=$o("/ipns/");function ug(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(e).trim().match(t);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),s=parseInt(n[2],10)-1,i=parseInt(n[3],10),o=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),l=parseInt(n[7].slice(0,-6),10);return new Date(Date.UTC(r,s,i,o,a,c,l))}const hg=async(e,t)=>{if(null==t||null==e){const e=new Error("one or more of the provided parameters are not defined");throw cg.error(e),je(e,rg)}let n;if(null!=t.pubKey){try{n=Gf(t.pubKey)}catch(uS){throw cg.error(uS),uS}const r=await $u(t.pubKey);if(!r.equals(e))throw je(new Error("Embedded public key did not match PeerID"),ig)}else null!=e.publicKey&&(n=Gf(e.publicKey));if(null!=n)return n;throw je(new Error("no public key is available"),rg)},dg=(e,t,n)=>{const r=$o(t);return ya([e,n,r])},pg=e=>{const t=$o("ipns-signature:");return ya([t,e])},fg=e=>ag.encode(e),gg=e=>{const t=ag.decode(e);return null!=t.sequence&&(t.sequence=BigInt(t.sequence)),null!=t.ttl&&(t.ttl=BigInt(t.ttl)),{value:t.value??new Uint8Array(0),signature:t.signature??new Uint8Array(0),validityType:t.validityType??ag.ValidityType.EOL,validity:t.validity??new Uint8Array(0),sequence:t.sequence??0n,pubKey:t.pubKey,ttl:t.ttl??void 0,signatureV2:t.signatureV2,data:t.data}},mg=e=>ya([lg,e.toBytes()]),yg=e=>ju(e.slice(lg.length)),wg=(e,t,n,r,s)=>{let i;if(n!==ag.ValidityType.EOL)throw je(new Error("Unknown validity type"),Zf);i=0;const o={Value:e,Validity:t,ValidityType:i,Sequence:r,TTL:s};return Ls(o)},bg=e=>{const t=$s(e);if(0!==t.ValidityType)throw je(new Error("Unknown validity type"),Zf);return t.ValidityType=ag.ValidityType.EOL,Number.isInteger(t.Sequence)&&(t.Sequence=BigInt(t.Sequence)),Number.isInteger(t.TTL)&&(t.TTL=BigInt(t.TTL)),t},vg=Fe("ipns"),Eg=Yi.code,_g="/ipns/",Sg=_g.length,kg=async(e,t,n,r)=>{const s=new ah(Date.now()+Number(r)),i=ag.ValidityType.EOL,[o,a]=r.toString().split("."),c=BigInt(o)*BigInt(1e5)+BigInt(a??"0");return await Ag(e,t,n,i,s,c)},Ag=async(e,t,n,r,s,i)=>{n=BigInt(n);const o=$o(s.toString());if(null==e.privateKey)throw je(new Error("Missing private key"),og);const a=await Yf(e.privateKey),c=await Ig(a,t,r,o),l=wg(t,o,r,n,i),u=pg(l),h=await a.sign(u),d={value:t,signature:c,validityType:r,validity:o,sequence:n,ttl:i,signatureV2:h,data:l};if(null!=e.publicKey){const t=Rt(e.toBytes());t.code===Eg&&Ja(e.publicKey,t.digest)||(d.pubKey=e.publicKey)}return vg("ipns entry for %b created",t),d},Tg=e=>Ie.encode(e).slice(1),Cg=e=>new rl(`/ipns/${Tg(e)}`),Ig=async(e,t,n,r)=>{try{const s=dg(t,n,r);return await e.sign(s)}catch(s){throw vg.error("record signature creation failed",s),je(new Error("record signature creation failed"),eg)}},Rg=Fe("ipfs:ipns:publisher"),Og=oh().code,xg=36e5;class Ng{constructor(e,t){this._routing=e,this._datastore=t}async publishWithEOL(e,t,n,r){const s=await this._updateOrCreateRecord(e,t,n,r);return this._putRecordToRouting(s,e,r)}publish(e,t,n){return this.publishWithEOL(e,t,xg,n)}async _putRecordToRouting(e,t,n){if(!Ru(t)){const e="peerId received is not valid";throw Rg.error(e),je(new Error(e),"ERR_INVALID_PEER_ID")}if(null==t.publicKey)throw je(new Error("Public key was missing"),"ERR_MISSING_PUBLIC_KEY");const r=mg(t);return await this._publishEntry(r,e,n),e}async _publishEntry(e,t,n){try{const r=await this._routing.put(e,t,n);return Rg(`ipns record for ${ia(e,"base32")} was stored in the routing`),r}catch(uS){const n=`ipns record for ${ia(e,"base32")} could not be stored in the routing - ${uS.stack}`;throw Rg.error(n),Rg.error(uS),je(new Error(n),"ERR_PUTTING_TO_ROUTING")}}async _getPublished(e,t={}){if(!Ru(e)){const e="peerId received is not valid";throw Rg.error(e),je(new Error(e),"ERR_INVALID_PEER_ID")}const n=!1!==t.checkRouting;try{const t=await this._datastore.get(Cg(e.toBytes()));return this._unmarshalData(t)}catch(uS){if(uS.code!==Og){const t=`unexpected error getting the ipns record ${e.toString()} from datastore`;throw Rg.error(t),je(new Error(t),"ERR_UNEXPECTED_DATASTORE_RESPONSE")}if(!n)throw je(uS,"ERR_NOT_FOUND_AND_CHECK_ROUTING_NOT_ENABLED");try{const t=mg(e),n=await this._routing.get(t);return this._unmarshalData(n)}catch(uS){throw Rg.error(uS),uS}}}_unmarshalData(e){try{return gg(e)}catch(uS){throw je(uS,"ERR_INVALID_RECORD_DATA")}}async _updateOrCreateRecord(e,t,n,r){if(!Ru(e)){const e="peerId received is not valid";throw Rg.error(e),je(new Error(e),"ERR_INVALID_PEER_ID")}const s={checkRouting:!0};let i;try{i=await this._getPublished(e,s)}catch(uS){if(uS.code!==Og){const n=`unexpected error when determining the last published IPNS record for ${e.toString()} ${uS.stack}`;throw Rg.error(n),je(new Error(n),"ERR_DETERMINING_PUBLISHED_RECORD")}}let o,a=0n;i&&void 0!==i.sequence&&(a=Ja(i.value,t)?i.sequence:i.sequence+BigInt(1));try{o=await kg(e,t,a,n)}catch(uS){const n=`ipns record for ${t} could not be created`;throw Rg.error(uS),je(new Error(n),"ERR_CREATING_IPNS_RECORD")}try{const n=fg(o);return await this._datastore.put(Cg(e.toBytes()),n,r),Rg(`ipns record for ${ia(t,"base32")} was stored in the datastore`),n}catch(uS){const n=`ipns record for ${t} could not be stored in the datastore`;throw Rg.error(n),je(new Error(n),"ERR_STORING_IN_DATASTORE")}}}Ng.defaultRecordLifetime=xg;const Dg=Fe("ipfs:ipns:republisher"),Pg=6e4,Lg=60*Pg,Mg=4*Lg,Bg=24*Lg;class Ug{constructor(e,t,n,r,s={pass:""}){this._publisher=e,this._datastore=t,this._peerId=n,this._keychain=r,this._options=s,this._republishHandle=null}async start(){if(this._republishHandle)throw je(new Error("republisher is already running"),"ERR_REPUBLISH_ALREADY_RUNNING");const e={_task:null,_inflightTask:null,_timeoutId:null,runPeriodically:t=>{e._timeoutId=setTimeout((async()=>{e._timeoutId=null;try{e._inflightTask=e._task(),await e._inflightTask,e._task&&e.runPeriodically(t)}catch(uS){Dg.error(uS)}}),t())},cancel:async()=>{null!=e._timeoutId&&clearTimeout(e._timeoutId),e._task=null,await e._inflightTask}},{pass:t}=this._options;let n=!0;e._task=async()=>{const e=new Ho.TimeoutController(3e4);try{await this._republishEntries(this._peerId,t,{signal:e.signal})}finally{e.clear()}},e.runPeriodically((()=>n?(n=!1,this._options.initialBroadcastInterval||Pg):this._options.broadcastInterval||Mg)),this._republishHandle=e}async stop(){const e=this._republishHandle;if(!e)throw je(new Error("republisher is not running"),"ERR_REPUBLISH_NOT_RUNNING");this._republishHandle=null,await e.cancel()}async _republishEntries(e,t,n){try{await this._republishEntry(e,n)}catch(uS){const t="cannot republish entry for the node's private key";return void Dg.error(t)}if(t)try{const e=await this._keychain.listKeys();for(const r of e){if("self"===r.name)continue;const e=await this._keychain.exportKey(r.name,t),s=await Qf(e,t),i=await $u(s.public.bytes,s.bytes);await this._republishEntry(i,n)}}catch(uS){Dg.error(uS)}}async _republishEntry(e,t){try{const n=await this._getPreviousValue(e);await this._publisher.publishWithEOL(e,n,Bg,t)}catch(uS){if("ERR_NO_ENTRY_FOUND"===uS.code)return;throw uS}}async _getPreviousValue(e){if(!Ru(e))throw je(new Error("invalid peer ID"),"ERR_INVALID_PEER_ID");try{const t=await this._datastore.get(Cg(e.toBytes()));if(!(t instanceof Uint8Array))throw je(new Error("found ipns record that we couldn't process"),"ERR_INVALID_IPNS_RECORD");try{const e=gg(t);return e.value}catch(uS){throw Dg.error(uS),je(new Error("found ipns record that we couldn't convert to a value"),"ERR_INVALID_IPNS_RECORD")}}catch(uS){if(uS&&uS.notFound)throw je(new Error(`no previous entry for record with id: ${e.toString()}`),"ERR_NO_ENTRY_FOUND");throw uS}}}const Vg=Fe("ipns:validator"),Fg=async(e,t)=>{const{value:n,validityType:r,validity:s}=t;let i,o,a;if(null==t.signatureV2||null==t.data)throw je(new Error("missing data or signatureV2"),tg);o=t.signatureV2,i=pg(t.data),jg(t);try{a=await e.verify(i,o)}catch(uS){a=!1}if(!a)throw Vg.error("record signature verification failed"),je(new Error("record signature verification failed"),tg);if(null!=s&&r===ag.ValidityType.EOL){let e;try{e=ug(ia(s))}catch(c){throw Vg.error("unrecognized validity format (not an rfc3339 format)"),je(new Error("unrecognized validity format (not an rfc3339 format)"),ng)}if(e.getTime()<Date.now())throw Vg.error("record has expired"),je(new Error("record has expired"),Xf)}else if(null!=r)throw Vg.error("unrecognized validity type"),je(new Error("unrecognized validity type"),Zf);Vg("ipns entry for %b is valid",n)},jg=e=>{if(null==e.data)throw je(new Error("Record data is missing"),sg);const t=bg(e.data);if(!Ja(t.Value,e.value))throw je(new Error('Field "value" did not match between protobuf and CBOR'),tg);if(!Ja(t.Validity,e.validity))throw je(new Error('Field "validity" did not match between protobuf and CBOR'),tg);if(t.ValidityType!==e.validityType)throw je(new Error('Field "validityType" did not match between protobuf and CBOR'),tg);if(t.Sequence!==e.sequence)throw je(new Error('Field "sequence" did not match between protobuf and CBOR'),tg);if(t.TTL!==e.ttl)throw je(new Error('Field "ttl" did not match between protobuf and CBOR'),tg)},zg=async(e,t)=>{const n=yg(e),r=gg(t),s=await hg(n,r);await Fg(s,r)},$g=Fe("ipfs:ipns:resolver"),Hg=oh().code,Kg=32;class qg{constructor(e){this._routing=e}async resolve(e,t={}){if("string"!==typeof e)throw je(new Error("invalid name"),"ERR_INVALID_NAME");const n=t.recursive&&"true"===t.recursive.toString(),r=e.split("/");if(3!==r.length||""!==r[0])throw je(new Error("invalid name"),"ERR_INVALID_NAME");const s=r[2];let i=1/0;n&&(i=Kg);const o=await this.resolver(s,i,t);return $g(`${e} was locally resolved correctly`),o}async resolver(e,t,n){if(0===t){const e=`could not resolve name (recursion limit of ${Kg} exceeded)`;throw $g.error(e),je(new Error(e),"ERR_RESOLVE_RECURSION_LIMIT")}const r=await this._resolveName(e,n),s=r.split("/");return"ipfs"!==s[1]&&t?this.resolver(s[2],t-1,n):r}async _resolveName(e,t){const n=Fu(e),r=mg(n);let s;try{s=await this._routing.get(r,t)}catch(uS){if($g.error("could not get record from routing",uS),uS.code===Hg)throw je(new Error(`record requested for ${e} was not found in the network`),"ERR_NO_RECORD_FOUND");throw je(new Error(`unexpected error getting the ipns record ${n.toString()}`),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}return this._validateRecord(n,s)}async _validateRecord(e,t){await zg(ya([$o("/ipns/"),e.toBytes()]),t);const n=gg(t);return ia(n.value)}}class Gg{constructor(e){this.lru=Rl(e)}get(e){const t=this.lru.get(e);if(t)return t.expire&&t.expire<Date.now()?void this.lru.remove(e):t.value}set(e,t,n){this.lru.set(e,{value:t,expire:Date.now()+n})}has(e){const t=this.get(e);return!!t}remove(e){this.lru.remove(e)}clear(){this.lru.clear()}}const Wg=Fe("ipfs:ipns"),Yg=6e4;class Jg{constructor(e,t,n,r,s){this.publisher=new Ng(e,t),this.republisher=new Ug(this.publisher,t,n,r,s),this.resolver=new qg(e),this.cache=new Gg(1e3),this.routing=e}async publish(e,t,n=Ng.defaultRecordLifetime,r){try{await this.publisher.publishWithEOL(e,t,n,r),Wg(`IPNS value ${ia(t,"base32")} was published correctly`);const s=e.toString(),i=parseFloat(n),o=i<Yg?i:Yg;return this.cache.set(s,t,o),Wg(`IPNS value ${ia(t,"base32")} was cached correctly`),{name:s,value:t}}catch(uS){throw Wg.error(uS),uS}}async resolve(e,t={}){if("string"!==typeof e)throw je(new Error("name received is not valid"),"ERR_INVALID_NAME");if(!t.nocache&&!t.recursive){const t=e.split("/")[2],n=this.cache.get(t);if(n)return n}try{const n=await this.resolver.resolve(e,t);return Wg(`IPNS record from ${e} was resolved correctly`),n}catch(uS){throw Wg.error(uS),uS}}async initializeKeyspace(e,t,n){return this.publish(e,t,Ng.defaultRecordLifetime,n)}}async function Qg(e){const t=[];for await(const n of e)t.push(n);return t}const Xg=(e,t)=>async function*(){const n=await Qg(e);yield*n.sort(t)}();async function Zg(e){for await(const t of e);}async function*em(e,t){for await(const n of e)await t(n)&&(yield n)}async function*tm(e,t){let n=0;if(!(t<1))for await(const r of e)if(yield r,n++,n===t)return}class nm{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:r}of e)await this.put(n,r,t),yield{key:n,value:r}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(t,n){e.push({key:t,value:n})},delete(e){t.push(e)},commit:async n=>{await Zg(this.putMany(e,n)),e=[],await Zg(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(null!=e.prefix&&(n=em(n,(t=>t.key.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>em(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>Xg(e,t)),n)),null!=e.offset){let t=0;n=em(n,(()=>t++>=e.offset))}return null!=e.limit&&(n=tm(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(null!=e.prefix&&(n=em(n,(t=>t.toString().startsWith(e.prefix)))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>em(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>Xg(e,t)),n)),null!=e.offset){let t=0;n=em(n,(()=>t++>=e.offset))}return null!=e.limit&&(n=tm(n,e.limit)),n}}class rm{constructor(e){if(!(e>0)||0!==(e-1&e))throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return void 0===this.buffer[this.top]&&(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(void 0!==e)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return void 0===this.buffer[this.btm]}}class sm{constructor(e={}){this.hwm=e.splitLimit??16,this.head=new rm(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return null!=e?.byteLength?e.byteLength:1}push(e){if(null!=e?.value&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new rm(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(void 0===e&&null!=this.tail.next){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return null!=e?.value&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}function im(e={}){const t=e=>{const t=e.shift();if(null==t)return{done:!0};if(null!=t.error)throw t.error;return{done:!0===t.done,value:t.value}};return am(t,e)}function om(e={}){const t=e=>{let t;const n=[];while(!e.isEmpty()){if(t=e.shift(),null==t)break;if(null!=t.error)throw t.error;!1===t.done&&n.push(t.value)}return null==t?{done:!0}:{done:!0===t.done,value:n}};return am(t,e)}function am(e,t){t=t??{};let n,r,s,i=t.onEnd,o=new sm;const a=async()=>o.isEmpty()?s?{done:!0}:await new Promise(((t,s)=>{r=i=>{r=null,o.push(i);try{t(e(o))}catch(uS){s(uS)}return n}})):e(o),c=e=>null!=r?r(e):(o.push(e),n),l=e=>(o=new sm,null!=r?r({error:e}):(o.push({error:e}),n)),u=e=>{if(s)return n;if(!0!==t?.objectMode&&null==e?.byteLength)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return c({done:!1,value:e})},h=e=>s?n:(s=!0,null!=e?l(e):c({done:!0})),d=()=>(o=new sm,h(),{done:!0}),p=e=>(h(e),{done:!0});if(n={[Symbol.asyncIterator](){return this},next:a,return:d,throw:p,push:u,end:h,get readableLength(){return o.size}},null==i)return n;const f=n;return n={[Symbol.asyncIterator](){return this},next(){return f.next()},throw(e){return f.throw(e),null!=i&&(i(e),i=void 0),{done:!0}},return(){return f.return(),null!=i&&(i(),i=void 0),{done:!0}},push:u,end(e){return f.end(e),null!=i&&(i(e),i=void 0),n},get readableLength(){return f.readableLength}},n}const cm=Fe("datastore:core:tiered");class lm extends nm{constructor(e){super(),this.stores=e.slice()}async open(){try{await Promise.all(this.stores.map((e=>e.open())))}catch(uS){throw rh()}}async put(e,t,n){try{await Promise.all(this.stores.map((r=>r.put(e,t,n))))}catch(uS){throw ih()}}async get(e,t){for(const n of this.stores)try{const r=await n.get(e,t);if(r)return r}catch(uS){cm.error(uS)}throw oh()}async has(e,t){for(const n of this.stores)if(await n.has(e,t))return!0;return!1}async delete(e,t){try{await Promise.all(this.stores.map((n=>n.delete(e,t))))}catch(uS){throw sh()}}async*putMany(e,t={}){let n;const r=this.stores.map((e=>{const r=im({objectMode:!0});return Zg(e.putMany(r,t)).catch((e=>{n=e})),r}));try{for await(const t of e){if(n)throw n;r.forEach((e=>e.push(t))),yield t}}finally{r.forEach((e=>e.end()))}}async*deleteMany(e,t={}){let n;const r=this.stores.map((e=>{const r=im({objectMode:!0});return Zg(e.deleteMany(r,t)).catch((e=>{n=e})),r}));try{for await(const t of e){if(n)throw n;r.forEach((e=>e.push(t))),yield t}}finally{r.forEach((e=>e.end()))}}async close(){await Promise.all(this.stores.map((e=>e.close())))}batch(){const e=this.stores.map((e=>e.batch()));return{put:(t,n)=>{e.forEach((e=>e.put(t,n)))},delete:t=>{e.forEach((e=>e.delete(t)))},commit:async t=>{for(const n of e)await n.commit(t)}}}query(e,t){return this.stores[this.stores.length-1].query(e,t)}queryKeys(e,t){return this.stores[this.stores.length-1].queryKeys(e,t)}}var um=n(6759);const hm=(e,t)=>{const n=t.map(((e,t)=>({entry:ag.decode(e),index:t})));return n.sort(((e,t)=>{if(null!=e.entry.signatureV2&&null==t.entry.signatureV2)return-1;if(null==e.entry.signatureV2&&null!=t.entry.signatureV2)return 1;const n=e.entry.sequence??0n,r=t.entry.sequence??0n;if(n>r)return-1;if(n<r)return 1;const s=e.entry.validity??new Uint8Array(0),i=t.entry.validity??new Uint8Array(0),o=ug(ia(s)),a=ug(ia(i));return o.getTime()>a.getTime()?-1:o.getTime()<a.getTime()?1:0})),n[0].index},dm="SHARDING",pm="_README";class fm extends nm{constructor(){super(),this.data={}}open(){return Promise.resolve()}close(){return Promise.resolve()}async put(e,t){this.data[e.toString()]=t}async get(e){const t=await this.has(e);if(!t)throw oh();return this.data[e.toString()]}async has(e){return void 0!==this.data[e.toString()]}async delete(e){delete this.data[e.toString()]}async*_all(){yield*Object.entries(this.data).map((([e,t])=>({key:new rl(e),value:t})))}async*_allKeys(){yield*Object.entries(this.data).map((([e])=>new rl(e)))}}async function*gm(...e){const t=im({objectMode:!0});Promise.resolve().then((async()=>{try{await Promise.all(e.map((async e=>{for await(const n of e)t.push(n)}))),t.end()}catch(uS){t.end(uS)}})),yield*t}const mm=(...e)=>{let t;while(e.length>0)t=e.shift()(t);return t},ym=e=>null!=e&&("function"===typeof e[Symbol.asyncIterator]||"function"===typeof e[Symbol.iterator]||"function"===typeof e.next),wm=e=>null!=e&&"function"===typeof e.sink&&ym(e.source),bm=e=>t=>{const n=e.sink(t);if(null!=n.then){const t=im({objectMode:!0});n.then((()=>{t.end()}),(e=>{t.end(e)}));const r=async function*(){yield*e.source,t.end()};return gm(t,r())}return e.source};function vm(e,...t){if(wm(e)){const t=e;e=()=>t.source}else if(ym(e)){const t=e;e=()=>t}const n=[e,...t];if(n.length>1&&wm(n[n.length-1])&&(n[n.length-1]=n[n.length-1].sink),n.length>2)for(let r=1;r<n.length-1;r++)wm(n[r])&&(n[r]=bm(n[r]));return mm(...n)}new rl(dm),new rl(pm);const Em="/record/";function _m(e){return ia(e,"base32")}function Sm(e){("string"===typeof e||e instanceof String)&&(e=$o(e.toString()));const t=ia(e,"base64url");return`${Em}${t}`}function km(e){if(e.substring(0,Em.length)!==Em)throw je(new Error("topic received is not from a record"),"ERR_TOPIC_IS_NOT_FROM_RECORD_NAMESPACE");const t=e.substring(Em.length);return $o(t,"base64url")}const Am=Fe("datastore-pubsub:publisher");class Tm extends nm{constructor(e,t,n,r,s,i){if(super(),!r)throw je(new TypeError("missing validator"),"ERR_INVALID_PARAMETERS");if("function"!==typeof r)throw je(new TypeError("missing validate function"),"ERR_INVALID_PARAMETERS");if("function"!==typeof s)throw je(new TypeError("missing select function"),"ERR_INVALID_PARAMETERS");if(i&&"function"!==typeof i)throw je(new TypeError("invalid subscriptionKeyFn received"),"ERR_INVALID_PARAMETERS");this._pubsub=e,this._datastore=t,this._peerId=n,this._validator=r,this._selector=s,this._handleSubscriptionKeyFn=i,this._onMessage=this._onMessage.bind(this),this._pubsub.addEventListener("message",this._onMessage)}async put(e,t,n){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw Am.error(e),je(new Error(e),"ERR_INVALID_DATASTORE_KEY")}if(!(t instanceof Uint8Array)){const e="received value is not a Uint8Array";throw Am.error(e),je(new Error(e),"ERR_INVALID_VALUE_RECEIVED")}const r=Sm(e);Am(`publish value for topic ${r}`),await this._pubsub.publish(r,t)}async get(e,t){if(!(e instanceof Uint8Array)){const e="datastore key does not have a valid format";throw Am.error(e),je(new Error(e),"ERR_INVALID_DATASTORE_KEY")}const n=Sm(e),r=await this._pubsub.getTopics();if(r&&Array.isArray(r)&&r.indexOf(n)>-1)return this._getLocal(e,t);try{await this._pubsub.subscribe(n)}catch(uS){const t=`cannot subscribe topic ${n}`;throw Am.error(t),je(new Error(t),"ERR_SUBSCRIBING_TOPIC")}return Am(`subscribed values for key ${n}`),this._getLocal(e)}unsubscribe(e){const t=Sm(e);return this._pubsub.unsubscribe(t)}async _getLocal(e,t){const n=new rl("/"+_m(e),!1);let r;try{r=await this._datastore.get(n,t)}catch(uS){if("ERR_NOT_FOUND"!==uS.code){const e=`unexpected error getting the ipns record for ${n.toString()}`;throw Am.error(e),je(new Error(e),"ERR_UNEXPECTED_ERROR_GETTING_RECORD")}const t=`local record requested was not found for ${n.toString()}`;throw Am.error(t),je(new Error(t),"ERR_NOT_FOUND")}if(!(r instanceof Uint8Array)){const e="found record that we couldn't convert to a value";throw Am.error(e),je(new Error(e),"ERR_INVALID_RECORD_RECEIVED")}return r}async _onMessage(e){const t=e.detail;if("signed"!==t.type)return void Am.error("unsigned message received, this module can only work with signed messages");const{data:n,from:r,topic:s}=t;let i;try{i=km(s)}catch(uS){return void Am.error(uS)}if(Am(`message received for topic ${s}`),this._peerId.equals(r))Am("message discarded as it is from the same peer");else{if(this._handleSubscriptionKeyFn){let e;try{e=await this._handleSubscriptionKeyFn(i)}catch(uS){return void Am.error("message discarded by the subscriptionKeyFn")}i=e}try{await this._storeIfSubscriptionIsBetter(i,n)}catch(uS){Am.error(uS)}}}async _storeIfSubscriptionIsBetter(e,t,n){let r=!1;try{r=await this._isBetter(e,t)}catch(uS){if("ERR_NOT_VALID_RECORD"!==uS.code)throw uS}r&&await this._storeRecord(e,t,n)}async _validateRecord(e,t){return this._validator(e,t)}async _selectRecord(e,t){const n=await this._selector(e,t);return 0===n}async _isBetter(e,t){try{await this._validateRecord(e,t)}catch(uS){const t="record received through pubsub is not valid";throw Am.error(t),je(new Error(t),"ERR_NOT_VALID_RECORD")}const n=new rl(e);let r;try{r=await this._getLocal(n.uint8Array())}catch(uS){return!0}return!Ja(r,t)&&this._selectRecord(e,[r,t])}async _storeRecord(e,t,n){const r=new rl("/"+_m(e),!1);await this._datastore.put(r,t,n),Am(`record for ${Sm(e)} was stored in the datastore`)}}const Cm=Fe("ipfs:ipns:pubsub");class Im{constructor(e,t,n){this._subscriptions={},this._handleSubscriptionKey=this._handleSubscriptionKey.bind(this),this._pubsubDs=new Tm(e,t,n,zg,hm,this._handleSubscriptionKey)}async put(e,t,n){try{await this._pubsubDs.put(e,t,n)}catch(uS){throw Cm.error(uS),uS}}async get(e,t){let n,r;try{n=await this._pubsubDs.get(e,t)}catch(i){r=i}const s=e.slice(0,Sg);if(ia(s)===_g){const t=Ae.encode(e).substring(1),n=Ae.encode(e.slice(Sg)).substring(1);this._subscriptions[t]=n,Cm(`subscribed to pubsub topic ${t}, id ${n}`)}if(r)throw r;return n}_handleSubscriptionKey(e){e instanceof Uint8Array&&(e=ia(e,"base58btc"));const t=this._subscriptions[e];if(!t)throw je(new Error(`key ${e} does not correspond to a subscription`),"ERR_INVALID_KEY");try{const e=mg(Fu(t));return e}catch(uS){throw Cm.error(uS),uS}}getSubscriptions(){const e=Object.values(this._subscriptions).filter(Boolean);return e.map((e=>`${_g}${e}`))}async cancel(e){if("string"!==typeof e)throw je(new Error("invalid subscription name"),"ERR_INVALID_SUBSCRIPTION_NAME");e.startsWith(_g)&&(e=e.substring(Sg));const t=Object.keys(this._subscriptions).find((t=>this._subscriptions[t]===e));if(!t)return{canceled:!1};const n=$o(t);return this._pubsubDs.unsubscribe(n),delete this._subscriptions[t],Cm(`unsubscribed pubsub ${t}: ${e}`),{canceled:!0}}}var Rm;function Om(e){const t=e.getUTCFullYear(),n=String(e.getUTCMonth()+1).padStart(2,"0"),r=String(e.getUTCDate()).padStart(2,"0"),s=String(e.getUTCHours()).padStart(2,"0"),i=String(e.getUTCMinutes()).padStart(2,"0"),o=String(e.getUTCSeconds()).padStart(2,"0"),a=e.getUTCMilliseconds(),c=String(1e3*a*1e3).padStart(9,"0");return`${t}-${n}-${r}T${s}:${i}:${o}.${c}Z`}function xm(e){const t=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),n=String(e).trim().match(t);if(null==n)throw new Error("Invalid format");const r=parseInt(n[1],10),s=parseInt(n[2],10)-1,i=parseInt(n[3],10),o=parseInt(n[4],10),a=parseInt(n[5],10),c=parseInt(n[6],10),l=parseInt(n[7].slice(0,-6),10);return new Date(Date.UTC(r,s,i,o,a,c,l))}(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.key&&e.key.byteLength>0)&&(t.uint32(10),t.bytes(e.key)),(!0===n.writeDefaults||null!=e.value&&e.value.byteLength>0)&&(t.uint32(18),t.bytes(e.value)),!0!==n.writeDefaults&&""===e.timeReceived||(t.uint32(42),t.string(e.timeReceived)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={key:new Uint8Array(0),value:new Uint8Array(0),timeReceived:""},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(Rm||(Rm={}));class Nm{constructor(e,t,n){if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return Rm.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:Om(this.timeReceived)}}static deserialize(e){const t=Rm.decode(e);return new Nm(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=xm(e.timeReceived);if(null==e.key)throw new Error("key missing from deserialized object");if(null==e.value)throw new Error("value missing from deserialized object");const n=new Nm(e.key,e.value,t);return n}}const Dm=Fe("ipfs:ipns:offline-datastore");class Pm{constructor(e){this._datastore=e,this.stores=[]}async put(e,t,n){if(!(e instanceof Uint8Array))throw je(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");if(!(t instanceof Uint8Array))throw je(new Error("Offline datastore value must be a Uint8Array"),"ERR_INVALID_VALUE");let r;try{r=this._routingKey(e)}catch(uS){throw Dm.error(uS),je(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const s=new Nm(e,t,new Date);await this._datastore.put(r,s.serialize(),n)}async get(e,t){if(!(e instanceof Uint8Array))throw je(new Error("Offline datastore key must be a Uint8Array"),"ERR_INVALID_KEY");let n;try{n=this._routingKey(e)}catch(uS){throw Dm.error(uS),je(new Error("Not possible to generate the routing key"),"ERR_GENERATING_ROUTING_KEY")}const r=await this._datastore.get(n,t);let s;try{s=Nm.deserialize(r)}catch(uS){throw Dm.error(uS),uS}return s.value}_routingKey(e){return new rl("/dht/record/"+ia(e,"base32"),!1)}}const Lm=Fe("ipfs:ipns:dht-datastore");class Mm{constructor(e){this._dht=e}async put(e,t,n){try{await Zg(this._dht.put(e,t,n))}catch(uS){throw Lm.error(uS),uS}}async get(e,t){for await(const n of this._dht.get(e,t))if("VALUE"===n.name)return n.value;throw oh()}}function Bm({libp2p:e,repo:t,peerId:n,options:r}){const s=[];let i;if(um(r,"EXPERIMENTAL.ipnsPubsub",!1)&&(i=new Im(e.pubsub,t.datastore,n),s.push(i)),!0!==um(r,"offline",!1)&&["dht","dhtclient","dhtserver"].includes(um(r,"config.Routing.Type","none"))&&s.push(new Mm(e.dht)),um(r,"offline",!1)||0===s.length){const e=new Pm(t.datastore);s.push(e)}return new lm(s)}const Um=Fe("ipfs:components:ipns");class Vm{constructor(e={pass:""}){this.options=e,this.offline=null,this.online=null}getIPNS(){const e=this.online||this.offline;if(e)return e;throw new Io}get routing(){return this.getIPNS().routing}startOffline({repo:e,peerId:t,keychain:n}){if(null!=this.offline)throw new Oo;Um("initializing IPNS keyspace (offline)");const r=new Pm(e.datastore),s=new Jg(r,e.datastore,t,n,this.options);this.offline=s}async startOnline({libp2p:e,repo:t,peerId:n,keychain:r}){if(null!=this.online)throw new Oo;const s=Bm({libp2p:e,repo:t,peerId:n,options:this.options}),i=new Jg(s,t.datastore,n,r,this.options);await i.republisher.start(),this.online=i}async stop(){const e=this.online;e&&(await e.republisher.stop(),this.online=null)}publish(e,t,n,r){return this.getIPNS().publish(e,t,n,r)}resolve(e,t){return this.getIPNS().resolve(e,t)}initializeKeyspace(e,t,n){return this.getIPNS().initializeKeyspace(e,t,n)}}async function Fm({ipns:e,repo:t,codecs:n},r,s){if(Xc(r))return e.resolve(r);const{cid:i,path:o}=gl(r);await Zg(Al(i,o||"",n,t,s))}const jm=Fe("ipfs:name:publish");function zm({ipns:e,repo:t,codecs:n,peerId:r,isOnline:s,keychain:i}){const o=async e=>{let t;if("self"===e&&null!=r.privateKey)t=await Yf(r.privateKey);else try{const n=await i.exportKey(e,"temp");t=await Qf(n,"temp")}catch(uS){throw jm.error(uS),je(uS,"ERR_CANNOT_GET_KEY")}return $u(t.public.bytes,t.bytes)};async function a(r,i={}){const a=!(!1===i.resolve),c=i.lifetime||"24h",l=i.key||"self";if(!s())throw je(new Error(yl),"OFFLINE_ERROR");try{r=vl(r)}catch(uS){throw jm.error(uS),uS}let u=0;try{u=hl(c)||0,u=parseFloat(u.toFixed(6))}catch(uS){throw jm.error(uS),uS}const h=await Promise.all([o(l),a?Fm({ipns:e,repo:t,codecs:n},r):Promise.resolve()]),d=$o(r),p=await e.publish(h[0],d,u,i);return{name:p.name,value:ia(p.value)}}return pl(a)}var $m=n(6209);const Hm=ne.bind({ignoreUndefined:!0}),Km=Fe("ipfs:name:resolve"),qm=(e,t)=>t.length>0?e+"/"+t.join("/"):e;function Gm({dns:e,ipns:t,isOnline:n,options:{offline:r}}){async function*s(s,i={}){if(i=Hm({nocache:!1,recursive:!0},i),r&&i&&i.nocache)throw je(new Error("cannot specify both offline and nocache"),"ERR_NOCACHE_AND_OFFLINE");if(!n()&&!r)throw je(new Error(yl),"OFFLINE_ERROR");let o=s.toString();o.startsWith("/ipns/")||(o=`/ipns/${o}`);let[a,c,...l]=o.slice(1).split("/");try{if("1"===c.substring(0,1)){const e=Fu(c),t=Rt(e.toBytes()),n=Lt.createV1(114,t);c=n.toString(no)}else{const e=Lt.parse(c);1===e.version&&(c=e.toString(no))}}catch(uS){if($m(c))return void(yield qm(await e(c,i),l));throw Km.error(uS),je(new Error("Invalid IPNS name"),"ERR_IPNS_INVALID_NAME")}const u=await t.resolve(`/${a}/${c}`,i);yield qm(u instanceof Uint8Array?ia(u):u,l)}return pl(s)}function Wm(e,t){if(!e||!t||!t.ipnsPubsub)throw je(new Error("IPNS pubsub subsystem is not enabled"),"ERR_IPNS_PUBSUB_NOT_ENABLED");if(e.routing instanceof Im)return e.routing;const n=(e.routing.stores||[]).find((e=>e instanceof Im));if(!n)throw je(new Error("IPNS pubsub datastore not found"),"ERR_PUBSUB_DATASTORE_NOT_FOUND");return n}function Ym({ipns:e,options:t}){const n=t.EXPERIMENTAL;async function r(t,r={}){const s=Wm(e,n);return s.cancel(t,r)}return pl(r)}function Jm({ipns:e,options:t}){const n=t.EXPERIMENTAL;async function r(t={}){try{return{enabled:Boolean(Wm(e,n))}}catch(uS){return{enabled:!1}}}return pl(r)}function Qm({ipns:e,options:t}){const n=t.EXPERIMENTAL;async function r(t={}){const r=Wm(e,n);return r.getSubscriptions(t)}return pl(r)}class Xm{constructor({ipns:e,options:t}){this.cancel=Ym({ipns:e,options:t}),this.state=Jm({ipns:e,options:t}),this.subs=Qm({ipns:e,options:t})}}class Zm{constructor({dns:e,ipns:t,repo:n,codecs:r,peerId:s,isOnline:i,keychain:o,options:a}){this.publish=zm({ipns:t,repo:n,codecs:r,peerId:s,isOnline:i,keychain:o}),this.resolve=Gm({dns:e,ipns:t,isOnline:i,options:a}),this.pubsub=new Xm({ipns:t,options:a})}}const ey=oh().code,ty={default:"<dst>",edges:"<src> -> <dst>"};function ny({repo:e,codecs:t,resolve:n,preload:r}){async function*s(s,i={}){if(0===i.maxDepth)return;if(i.edges&&i.format&&i.format!==ty.default)throw new Error("Cannot set edges to true and also specify format");if(i.format=i.edges?ty.edges:i.format,"number"!==typeof i.maxDepth&&(i.maxDepth=i.recursive?1/0:1),i.timeout){const e=new Ho.TimeoutController(i.timeout),t=[e.signal];i.signal&&t.push(i.signal),i.signal=(0,al.anySignal)(t)}const o=Array.isArray(s)?s:[s],a=o.map((e=>ry(r,e,i)));for(const r of a)try{yield*sy(n,e,t,r,i)}catch(uS){yield{ref:"",err:uS.message}}}return s}function ry(e,t,n){const{cid:r,path:s}=gl(t);return!1!==n.preload&&e(r),`/ipfs/${r}${s||""}`}async function*sy(e,t,n,r,s){const i=await e(r,s),{cid:o}=gl(i),a=null!=s.maxDepth?s.maxDepth:1/0,c=s.unique||!1;for await(const l of oy(t,n,o,a,c,s))l.parent&&(l.isDuplicate||(yield{ref:iy(l.parent.cid,l.node.cid,l.node.name,s.format)}))}function iy(e,t,n="",r=ty.default){let s=r.replace(/<src>/g,e.toString());return s=s.replace(/<dst>/g,t.toString()),s=s.replace(/<linkname>/g,n),s}async function*oy(e,t,n,r,s,i){const o=new Set;async function*a(n,c){const l=c+1;if(!(l>r))try{for await(const r of ay(e,t,n.cid,i))yield{parent:n,node:r,isDuplicate:s&&o.has(r.cid.toString())},s&&o.add(r.cid.toString()),yield*a(r,l)}catch(uS){throw uS.code===ey&&(uS.message=`Could not find object with CID: ${n.cid}`),uS}}yield*a({cid:n},0)}async function*ay(e,t,n,r){const s=await e.blocks.get(n,r),i=await t.getCodec(n.code),o=i.decode(s),a=n.code===wn,c=[];for(const[l,u]of cy(o,c)){if(a){const e=l.match(/^Links\/(\d+)\/Hash$/);if(e){const t=Number(e[1]);if(t<o.Links.length){yield{name:o.Links[t].Name,cid:u};continue}}}yield{name:l,cid:u}}}const cy=function*(e,t){if(null!=e&&!(e instanceof Uint8Array)){for(const[n,r]of Object.entries(e)){const e=[...t,n];if(null!=r&&"object"===typeof r)if(Array.isArray(r))for(const[t,n]of r.entries()){const r=[...e,t],s=Lt.asCID(n);s?yield[r.join("/"),s]:"object"===typeof n&&(yield*cy(n,r))}else{const t=Lt.asCID(r);t?yield[e.join("/"),t]:yield*cy(r,e)}}return[]}};function ly({repo:e}){async function*t(t={}){for await(const n of e.blocks.queryKeys({},{signal:t.signal}))yield{ref:n.toString()}}return pl(t)}function uy({network:e}){async function t(t={}){const{bitswap:n}=await e.use(t),r=n.getWantlist();return Array.from(r).map((e=>e[1].cid))}return pl(t)}function hy({network:e}){async function t(t,n={}){const{bitswap:r}=await e.use(n),s=r.wantlistForPeer(t);return Array.from(s).map((e=>e[1].cid))}return pl(t)}function dy({network:e}){async function t(t,n={}){const{bitswap:r}=await e.use(n);return Array.isArray(t)||(t=[t]),r.unwant(t)}return pl(t)}function py({network:e}){async function t(t={}){const n=(await e.use(t)).bitswap,r=n.stat().snapshot;return{provideBufLen:parseInt(r.providesBufferLength.toString()),blocksReceived:BigInt(r.blocksReceived.toString()),wantlist:Array.from(n.getWantlist()).map((e=>e[1].cid)),peers:n.peers(),dupBlksReceived:BigInt(r.dupBlksReceived.toString()),dupDataReceived:BigInt(r.dupDataReceived.toString()),dataReceived:BigInt(r.dataReceived.toString()),blocksSent:BigInt(r.blocksSent.toString()),dataSent:BigInt(r.dataSent.toString())}}return pl(t)}class fy{constructor({network:e}){this.wantlist=uy({network:e}),this.wantlistForPeer=hy({network:e}),this.unwant=dy({network:e}),this.stat=py({network:e})}}function gy(e){try{return Pc.matches(e)}catch(uS){return!1}}function my({repo:e}){async function t(t,n={}){if(!gy(t))throw new Error(`${t} is not a valid Multiaddr`);const r=await e.config.getAll(n),s=r.Bootstrap||[];return s.push(t.toString()),r.Bootstrap=Array.from(new Set(s)).sort(((e,t)=>e.localeCompare(t))),await e.config.replace(r),{Peers:[t]}}return pl(t)}function yy({repo:e}){async function t(t={}){const n=await e.config.getAll(t),r=n.Bootstrap||[];return n.Bootstrap=[],await e.config.replace(n),{Peers:r.map((e=>dc(e)))}}return pl(t)}function wy({repo:e}){async function t(t={}){const n=await e.config.get("Bootstrap",t);return{Peers:(n||[]).map((e=>dc(e)))}}return pl(t)}var by=()=>({Addresses:{Swarm:[],Announce:[],NoAnnounce:[],API:"",Gateway:"",RPC:"",Delegates:["/dns4/node0.delegate.ipfs.io/tcp/443/https","/dns4/node1.delegate.ipfs.io/tcp/443/https","/dns4/node2.delegate.ipfs.io/tcp/443/https","/dns4/node3.delegate.ipfs.io/tcp/443/https"]},Discovery:{MDNS:{Enabled:!1,Interval:10},webRTCStar:{Enabled:!0}},Bootstrap:["/dnsaddr/bootstrap.libp2p.io/p2p/QmNnooDu7bfjPFoTZYxMNLWUQJyrVwtbZg5gBMjTezGAJN","/dnsaddr/bootstrap.libp2p.io/p2p/QmbLHAnMoJPWSCR5Zhtx6BHJX9KiKNN6tpvbUcqanj75Nb","/dnsaddr/bootstrap.libp2p.io/p2p/QmZa1sAxajnQjVM8WjWXoMbmPd7NsWhfKsPkErzpm9wGkp","/dnsaddr/bootstrap.libp2p.io/p2p/QmQCU2EcMqAqQPR2i9bChDtGNJchTbq5TbXJJ16u19uLTa","/dnsaddr/bootstrap.libp2p.io/p2p/QmcZf59bWwK5XFi76CZX8cbJ4BhTzzA3gU1ZjYZcYW3dwt","/dns4/node0.preload.ipfs.io/tcp/443/wss/p2p/QmZMxNdpMkewiVZLMRxaNxUeZpDUb34pWjZ1kZvsd16Zic","/dns4/node1.preload.ipfs.io/tcp/443/wss/p2p/Qmbut9Ywz9YEDrz8ySBSgWyJk41Uvm2QJPhwDJzJyGFsD6","/dns4/node2.preload.ipfs.io/tcp/443/wss/p2p/QmV7gnbW5VTcJ3oyM2Xk1rdFBJ3kTkvxc87UFGsun29STS","/dns4/node3.preload.ipfs.io/tcp/443/wss/p2p/QmY7JB6MQXhxHvq7dBDh4HpbH29v4yE9JRadAVpndvzySN"],Pubsub:{Enabled:!0},Swarm:{ConnMgr:{LowWater:5,HighWater:20},DisableNatPortMap:!0},Routing:{Type:"dhtclient"}});function vy({repo:e}){async function t(t={}){const n=await e.config.getAll(t);return n.Bootstrap=by().Bootstrap,await e.config.replace(n),{Peers:by().Bootstrap.map((e=>dc(e)))}}return pl(t)}function Ey({repo:e}){async function t(t,n={}){if(!gy(t))throw new Error(`${t} is not a valid Multiaddr`);const r=await e.config.getAll(n);return r.Bootstrap=(r.Bootstrap||[]).filter((e=>e.toString()!==t.toString())),await e.config.replace(r),{Peers:[t]}}return pl(t)}class _y{constructor({repo:e}){this.add=my({repo:e}),this.list=wy({repo:e}),this.rm=Ey({repo:e}),this.clear=yy({repo:e}),this.reset=vy({repo:e})}}function Sy({preload:e,repo:t}){async function n(n,r={}){return!1!==r.preload&&e(n),t.blocks.get(n,r)}return pl(n)}function ky({codecs:e,hashers:t,repo:n,preload:r}){async function s(s,i={}){const o=i.pin?await n.gcLock.readLock():null;try{const o=null!=i.version?i.version:0,a=i.format||(0===o?"dag-pb":"raw"),c=await t.getHasher(i.mhtype||"sha2-256"),l=await c.digest(s),u=await e.getCodec(a),h=Lt.create(o,u.code,l);return await n.blocks.put(h,s,{signal:i.signal}),!1!==i.preload&&r(h),!0===i.pin&&await n.pins.pinRecursively(h,{signal:i.signal}),h}finally{o&&o()}}return pl(s)}function Ay(){const e={};return e.promise=new Promise(((t,n)=>{e.resolve=t,e.reject=n})),e}const Ty=globalThis.CustomEvent??Event;async function*Cy(e,t={}){let n=t.concurrency??1/0;n<1&&(n=1/0);const r=null!=t.ordered&&t.ordered,s=new EventTarget,i=[];let o,a=Ay(),c=Ay(),l=!1,u=!1;function h(){return r?i[0]?.done:Boolean(i.find((e=>e.done)))}function*d(){while(i.length>0&&i[0].done){const e=i[0];if(i.shift(),!e.ok)throw u=!0,a.resolve(),e.err;yield e.value,a.resolve()}}function*p(){while(h())for(let e=0;e<i.length;e++)if(i[e].done){const t=i[e];if(i.splice(e,1),e--,!t.ok)throw u=!0,a.resolve(),t.err;yield t.value,a.resolve()}}s.addEventListener("task-complete",(()=>{c.resolve()})),Promise.resolve().then((async()=>{try{for await(const t of e){if(i.length===n&&(a=Ay(),await a.promise),u)break;const e={done:!1};i.push(e),t().then((t=>{e.done=!0,e.ok=!0,e.value=t,s.dispatchEvent(new Ty("task-complete"))}),(t=>{e.done=!0,e.err=t,s.dispatchEvent(new Ty("task-complete"))}))}l=!0,s.dispatchEvent(new Ty("task-complete"))}catch(uS){o=uS,s.dispatchEvent(new Ty("task-complete"))}}));while(1){if(h()||(c=Ay(),await c.promise),null!=o)throw o;if(r?yield*d():yield*p(),l&&0===i.length)break}}async function*Iy(e,t){for await(const n of e)yield t(n)}function Ry(e){return e instanceof Uint8Array?Lt.decode(e):Lt.parse(e.toString())}const Oy=8;function xy({repo:e}){async function*t(t,n={}){Array.isArray(t)||(t=[t]);const r=await e.gcLock.writeLock();try{yield*vm(t,(t=>Iy(t,(t=>async()=>{t=Ry(t);const r={cid:t};try{const n=await e.blocks.has(t);if(!n)throw je(new Error("block not found"),"ERR_BLOCK_NOT_FOUND");await e.blocks.delete(t)}catch(uS){n.force||(uS.message=`cannot remove ${t}: ${uS.message}`,r.error=uS)}return r}))),(e=>Cy(e,{concurrency:Oy})),(e=>em(e,(()=>!n.quiet))))}finally{r()}}return pl(t)}function Ny({repo:e,preload:t}){async function n(n,r={}){n=Ry(n),!1!==r.preload&&t(n);const s=await e.blocks.get(n);return{cid:n,size:s.length}}return pl(n)}class Dy{constructor({codecs:e,hashers:t,preload:n,repo:r}){this.get=Sy({preload:n,repo:r}),this.put=ky({codecs:e,hashers:t,preload:n,repo:r}),this.rm=xy({repo:r}),this.stat=Ny({preload:n,repo:r})}}async function*Py(e,t={}){const n=e.getReader();try{while(1){const e=await n.read();if(e.done)return;yield e.value}}finally{!0!==t.preventCancel&&await n.cancel(),n.releaseLock()}}function Ly(e){return"function"===typeof e.stream?Py(e.stream()):Py(new Response(e).body)}function My(e){const[t,n]=null!=e[Symbol.asyncIterator]?[e[Symbol.asyncIterator](),Symbol.asyncIterator]:[e[Symbol.iterator](),Symbol.iterator],r=[];return{peek:()=>t.next(),push:e=>{r.push(e)},next:()=>r.length>0?{done:!1,value:r.shift()}:t.next(),[n](){return this}}}function By(e){return ArrayBuffer.isView(e)||e instanceof ArrayBuffer}function Uy(e){return e.constructor&&("Blob"===e.constructor.name||"File"===e.constructor.name)&&"function"===typeof e.stream}function Vy(e){return"object"===typeof e&&(e.path||e.content)}const Fy=e=>e&&"function"===typeof e.getReader;async function*jy(e){yield e}async function zy(e){if(By(e))return jy($y(e));if("string"===typeof e||e instanceof String)return jy($y(e.toString()));if(Uy(e))return Ly(e);if(Fy(e)&&(e=Py(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=My(e),{value:n,done:r}=await t.peek();if(r)return jy(new Uint8Array(0));if(t.push(n),Number.isInteger(n))return jy(Uint8Array.from(await Qg(t)));if(By(n)||"string"===typeof n||n instanceof String)return Iy(t,$y)}throw je(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}function $y(e){return e instanceof Uint8Array?e:ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer?new Uint8Array(e):Array.isArray(e)?Uint8Array.from(e):$o(e.toString())}async function*Hy(e,t){if(null===e||void 0===e)throw je(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT");if("string"===typeof e||e instanceof String)yield Ky(e.toString(),t);else if(By(e)||Uy(e))yield Ky(e,t);else{if(Fy(e)&&(e=Py(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const n=My(e),{value:r,done:s}=await n.peek();if(s)return void(yield{content:[]});if(n.push(r),Number.isInteger(r)||By(r)||"string"===typeof r||r instanceof String)return void(yield Ky(n,t));throw je(new Error("Unexpected input: multiple items passed - if you are using ipfs.add, please use ipfs.addAll instead"),"ERR_UNEXPECTED_INPUT")}if(!Vy(e))throw je(new Error('Unexpected input: cannot convert "'+typeof e+'" into ImportCandidate'),"ERR_UNEXPECTED_INPUT");yield Ky(e,t)}}async function Ky(e,t){const{path:n,mode:r,mtime:s,content:i}=e,o={path:n||"",mode:Ze(r),mtime:et(s)};return i?o.content=await t(i):n||(o.content=await t(e)),o}function qy(e){return Hy(e,zy)}function Gy({addAll:e}){async function t(t,n={}){const r=await qu(e(qy(t),n));if(null==r)throw Error("Failed to add a file, if you see this please report a bug");return r}return t}async function*Wy(e,t=1){let n=[];t<1&&(t=1);for await(const r of e){n.push(r);while(n.length>=t)yield n.slice(0,t),n=n.slice(t)}while(n.length>0)yield n.slice(0,t),n=n.slice(t)}async function*Yy(e,t=1){for await(const n of Wy(e,t)){const e=n.map((async e=>await e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const n=await e[t];if(!n.ok)throw n.err;yield n.value}}}var Jy=n(512);function Qy(e){const t=new Array(4);for(let n=0;n<4;n++)t[n]=255&e,e>>=8;return new Uint8Array(t)}ti({name:"murmur3-32",code:35,encode:e=>Qy(Jy.x86.hash32(e))});const Xy=ti({name:"murmur3-128",code:34,encode:e=>ue(Jy.x64.hash128(e))});ti({name:"murmur3-x64-64",code:34,encode:e=>ue(Jy.x64.hash128(e)).subarray(0,8)});async function Zy(e){return(await Xy.encode(e)).slice(0,8).reverse()}const ew={chunker:"fixed",strategy:"balanced",rawLeaves:!1,onlyHash:!1,reduceSingleLeafToSelf:!0,hasher:ho,leafType:"file",cidVersion:0,progress:()=>()=>{},shardSplitThreshold:1e3,fileImportConcurrency:50,blockWriteConcurrency:10,minChunkSize:262144,maxChunkSize:262144,avgChunkSize:262144,window:16,polynomial:0x3df305dfb2a804,maxChildrenPerNode:174,layerRepeat:4,wrapWithDirectory:!1,recursive:!1,hidden:!1,timeout:void 0,hamtHashFn:Zy,hamtHashCode:34,hamtBucketBits:8};var tw=(e={})=>{const t=ne.bind({ignoreUndefined:!0});return t(ew,e)};const nw=async(e,t,n)=>{n.codec||(n.codec=o),n.hasher||(n.hasher=ho),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===o&&n.hasher!==ho&&(n.cidVersion=1);const r=await n.hasher.digest(e),s=Lt.create(n.cidVersion,n.codec.code,r);return n.onlyHash||await t.put(s,e,{signal:n.signal}),s};var rw=nw;const sw=async(e,t,n)=>{const r=new tt({type:"directory",mtime:e.mtime,mode:e.mode}),s=bn(pn({Data:r.marshal()})),i=await rw(s,t,n),o=e.path;return{cid:i,path:o,unixfs:r,size:s.length}};var iw=sw;async function ow(e,t){return t(await Qg(e))}var aw=ow;function cw(e,t,n){return lw(e,t,n)}async function lw(e,t,n){const r=[];for await(const s of Wy(e,n.maxChildrenPerNode))r.push(await t(s));return r.length>1?lw(r,t,n):r[0]}var uw=cw;async function hw(e,t,n){const r=new fw(n.layerRepeat);let s=0,i=1,o=r;for await(const a of Wy(e,n.maxChildrenPerNode))o.isFull()&&(o!==r&&r.addChild(await o.reduce(t)),s&&s%n.layerRepeat===0&&i++,o=new pw(i,n.layerRepeat,s),s++),o.append(a);return o&&o!==r&&r.addChild(await o.reduce(t)),r.reduce(t)}var dw=hw;class pw{constructor(e,t,n=0){this.maxDepth=e,this.layerRepeat=t,this.currentDepth=1,this.iteration=n,this.root=this.node=this.parent={children:[],depth:this.currentDepth,maxDepth:e,maxChildren:(this.maxDepth-this.currentDepth)*this.layerRepeat}}isFull(){if(!this.root.data)return!1;if(this.currentDepth<this.maxDepth&&this.node.maxChildren)return this._addNextNodeToParent(this.node),!1;const e=this._findParent(this.node,this.currentDepth);return!e||(this._addNextNodeToParent(e),!1)}_addNextNodeToParent(e){this.parent=e;const t={children:[],depth:e.depth+1,parent:e,maxDepth:this.maxDepth,maxChildren:Math.floor(e.children.length/this.layerRepeat)*this.layerRepeat};e.children.push(t),this.currentDepth=t.depth,this.node=t}append(e){this.node.data=e}reduce(e){return this._reduce(this.root,e)}async _reduce(e,t){let n=[];return e.children.length&&(n=await Promise.all(e.children.filter((e=>e.data)).map((e=>this._reduce(e,t))))),t((e.data||[]).concat(n))}_findParent(e,t){const n=e.parent;if(n&&0!==n.depth)return n.children.length!==n.maxChildren&&n.maxChildren?n:this._findParent(n,t)}}class fw extends pw{constructor(e){super(0,e),this.root.depth=0,this.currentDepth=1}addChild(e){this.root.children.push(e)}reduce(e){return e((this.root.data||[]).concat(this.root.children))}}async function*gw(e,t,n){for await(let r of e.content)yield async()=>{let s;n.progress(r.length,e.path);const i={codec:o,cidVersion:n.cidVersion,hasher:n.hasher,onlyHash:n.onlyHash};return n.rawLeaves?(i.codec=b,i.cidVersion=1):(s=new tt({type:n.leafType,data:r}),r=bn({Data:s.marshal(),Links:[]})),{cid:await rw(r,t,i),unixfs:s,size:r.length}}}var mw=gw;const yw={flat:aw,balanced:uw,trickle:dw};async function*ww(e,t,n){let r,s,i=-1;s="function"===typeof n.bufferImporter?n.bufferImporter:mw;for await(const o of Yy(s(e,t,n),n.blockWriteConcurrency))i++,0!==i?(1===i&&r&&(yield r,r=null),yield o):r=o;r&&(r.single=!0,yield r)}const bw=(e,t,n)=>{async function r(r){if(1===r.length&&r[0].single&&n.reduceSingleLeafToSelf){const s=r[0];if(void 0!==e.mtime||void 0!==e.mode){let r=await t.get(s.cid);s.unixfs=new tt({type:"file",mtime:e.mtime,mode:e.mode,data:r}),r=bn(pn({Data:s.unixfs.marshal()})),s.cid=await rw(r,t,{...n,codec:o,hasher:n.hasher,cidVersion:n.cidVersion}),s.size=r.length}return{cid:s.cid,path:e.path,unixfs:s.unixfs,size:s.size}}const s=new tt({type:"file",mtime:e.mtime,mode:e.mode}),i=r.filter((e=>!(e.cid.code!==go||!e.size)||(!(!e.unixfs||e.unixfs.data||!e.unixfs.fileSize())||Boolean(e.unixfs&&e.unixfs.data&&e.unixfs.data.length)))).map((e=>e.cid.code===go?(s.addBlockSize(e.size),{Name:"",Tsize:e.size,Hash:e.cid}):(e.unixfs&&e.unixfs.data?s.addBlockSize(e.unixfs.data.length):s.addBlockSize(e.unixfs&&e.unixfs.fileSize()||0),{Name:"",Tsize:e.size,Hash:e.cid}))),a={Data:s.marshal(),Links:i},c=bn(pn(a)),l=await rw(c,t,n);return{cid:l,path:e.path,unixfs:s,size:c.length+a.Links.reduce(((e,t)=>e+t.Tsize),0)}}return r};function vw(e,t,n){const r=yw[n.strategy];if(!r)throw je(new Error(`Unknown importer build strategy name: ${n.strategy}`),"ERR_BAD_STRATEGY");return r(ww(e,t,n),bw(e,t,n),n)}var Ew=vw;const _w=Symbol.for("@achingbrain/uint8arraylist");function Sw(e,t){if(null==t||t<0)throw new RangeError("index is out of bounds");let n=0;for(const r of e){const e=n+r.byteLength;if(t<e)return{buf:r,index:t-n};n=e}throw new RangeError("index is out of bounds")}function kw(e){return Boolean(e?.[_w])}class Aw{constructor(...e){Object.defineProperty(this,_w,{value:!0}),this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[Symbol.iterator](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else{if(!kw(n))throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.push(...n.bufs)}this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else{if(!kw(n))throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");t+=n.byteLength,this.bufs.unshift(...n.bufs)}this.length+=t}get(e){const t=Sw(this.bufs,e);return t.buf[t.index]}set(e,t){const n=Sw(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else{if(!kw(e))throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList");for(let n=0;n<e.length;n++)this.set(t+n,e.get(n))}}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength)return this.bufs=[],void(this.length=0);while(this.bufs.length>0){if(!(e>=this.bufs[0].byteLength)){this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift()}}}slice(e,t){const{bufs:n,length:r}=this._subList(e,t);return ya(n,r)}subarray(e,t){const{bufs:n,length:r}=this._subList(e,t);return 1===n.length?n[0]:ya(n,r)}sublist(e,t){const{bufs:n,length:r}=this._subList(e,t),s=new Aw;return s.length=r,s.bufs=n,s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(0===e&&t===this.length)return{bufs:[...this.bufs],length:this.length};const n=[];let r=0;for(let s=0;s<this.bufs.length;s++){const i=this.bufs[s],o=r,a=o+i.byteLength;if(r=a,e>=a)continue;const c=e>=o&&e<a,l=t>o&&t<=a;if(c&&l){if(e===o&&t===a){n.push(i);break}const r=e-o;n.push(i.subarray(r,r+(t-e)));break}if(c){if(0===e){n.push(i);continue}n.push(i.subarray(e-o))}else{if(l){if(t===a){n.push(i);break}n.push(i.subarray(0,t-o));break}n.push(i)}}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!kw(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),0===e.length)return t>this.length?this.length:t;const r=n.byteLength;if(0===r)throw new TypeError("search must be at least 1 byte long");const s=256,i=new Int32Array(s);for(let u=0;u<s;u++)i[u]=-1;for(let u=0;u<r;u++)i[n[u]]=u;const o=i,a=this.byteLength-n.byteLength,c=n.byteLength-1;let l;for(let u=t;u<=a;u+=l){l=0;for(let e=c;e>=0;e--){const t=this.get(u+e);if(n[e]!==t){l=Math.max(1,e-o[t]);break}}if(0===l)return u}return-1}getInt8(e){const t=this.subarray(e,e+1),n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getInt8(0)}setInt8(e,t){const n=Bo(1),r=new DataView(n.buffer,n.byteOffset,n.byteLength);r.setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getInt16(0,t)}setInt16(e,t,n){const r=Mo(2),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setInt16(0,t,n),this.write(r,e)}getInt32(e,t){const n=this.subarray(e,e+4),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getInt32(0,t)}setInt32(e,t,n){const r=Mo(4),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setInt32(0,t,n),this.write(r,e)}getBigInt64(e,t){const n=this.subarray(e,e+8),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getBigInt64(0,t)}setBigInt64(e,t,n){const r=Mo(8),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setBigInt64(0,t,n),this.write(r,e)}getUint8(e){const t=this.subarray(e,e+1),n=new DataView(t.buffer,t.byteOffset,t.byteLength);return n.getUint8(0)}setUint8(e,t){const n=Bo(1),r=new DataView(n.buffer,n.byteOffset,n.byteLength);r.setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getUint16(0,t)}setUint16(e,t,n){const r=Mo(2),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setUint16(0,t,n),this.write(r,e)}getUint32(e,t){const n=this.subarray(e,e+4),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getUint32(0,t)}setUint32(e,t,n){const r=Mo(4),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setUint32(0,t,n),this.write(r,e)}getBigUint64(e,t){const n=this.subarray(e,e+8),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getBigUint64(0,t)}setBigUint64(e,t,n){const r=Mo(8),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setBigUint64(0,t,n),this.write(r,e)}getFloat32(e,t){const n=this.subarray(e,e+4),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat32(0,t)}setFloat32(e,t,n){const r=Mo(4),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setFloat32(0,t,n),this.write(r,e)}getFloat64(e,t){const n=this.subarray(e,e+8),r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat64(0,t)}setFloat64(e,t,n){const r=Mo(8),s=new DataView(r.buffer,r.byteOffset,r.byteLength);s.setFloat64(0,t,n),this.write(r,e)}equals(e){if(null==e)return!1;if(!(e instanceof Aw))return!1;if(e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!Ja(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new Aw;return n.bufs=e,null==t&&(t=e.reduce(((e,t)=>e+t.byteLength),0)),n.length=t,n}}var Tw=n(9566);async function*Cw(e,t){let n,r,s;if(t.minChunkSize&&t.maxChunkSize&&t.avgChunkSize)s=t.avgChunkSize,n=t.minChunkSize,r=t.maxChunkSize;else{if(!t.avgChunkSize)throw je(new Error("please specify an average chunk size"),"ERR_INVALID_AVG_CHUNK_SIZE");s=t.avgChunkSize,n=s/3,r=s+s/2}if(n<16)throw je(new Error("rabin min must be greater than 16"),"ERR_INVALID_MIN_CHUNK_SIZE");r<n&&(r=n),s<n&&(s=n);const i=Math.floor(Math.log2(s));for await(const o of Rw(e,{min:n,max:r,bits:i,window:t.window,polynomial:t.polynomial}))yield o}var Iw=Cw;async function*Rw(e,t){const n=await(0,Tw.create)(t.bits,t.min,t.max,t.window),r=new Aw;for await(const s of e){r.append(s);const e=n.fingerprint(s);for(let t=0;t<e.length;t++){const n=e[t],s=r.slice(0,n);r.consume(n),yield s}}r.length&&(yield r.subarray(0))}async function*Ow(e,t){let n=new Aw,r=0,s=!1;const i=t.maxChunkSize;for await(const o of e){n.append(o),r+=o.length;while(r>=i)if(yield n.slice(0,i),s=!0,i===n.length)n=new Aw,r=0;else{const e=new Aw;e.append(n.sublist(i)),n=e,r-=i}}s&&!r||(yield n.subarray(0,r))}var xw=Ow;async function*Nw(e){for await(const t of e){if(void 0===t.length)throw je(new Error("Content was invalid"),"ERR_INVALID_CONTENT");if("string"===typeof t||t instanceof String)yield $o(t.toString());else if(Array.isArray(t))yield Uint8Array.from(t);else{if(!(t instanceof Uint8Array))throw je(new Error("Content was invalid"),"ERR_INVALID_CONTENT");yield t}}}var Dw=Nw;function Pw(e){return Symbol.iterator in e}function Lw(e){return Symbol.asyncIterator in e}function Mw(e){try{if(e instanceof Uint8Array)return async function*(){yield e}();if(Pw(e))return async function*(){yield*e}();if(Lw(e))return e}catch{throw je(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}throw je(new Error("Content was invalid"),"ERR_INVALID_CONTENT")}async function*Bw(e,t,n){for await(const r of e)if(r.path&&("./"===r.path.substring(0,2)&&(n.wrapWithDirectory=!0),r.path=r.path.split("/").filter((e=>e&&"."!==e)).join("/")),r.content){let e,s;e="function"===typeof n.chunker?n.chunker:"rabin"===n.chunker?Iw:xw,s="function"===typeof n.chunkValidator?n.chunkValidator:Dw;const i={path:r.path,mtime:r.mtime,mode:r.mode,content:e(s(Mw(r.content),n),n)};yield()=>Ew(i,t,n)}else{if(!r.path)throw new Error("Import candidate must have content or path or both");{const e={path:r.path,mtime:r.mtime,mode:r.mode};yield()=>iw(e,t,n)}}}var Uw=Bw;class Vw{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}}var Fw=Vw;class jw extends Fw{constructor(e,t){super(e,t),this._children={}}async put(e,t){this.cid=void 0,this.size=void 0,this._children[e]=t}get(e){return Promise.resolve(this._children[e])}childCount(){return Object.keys(this._children).length}directChildrenCount(){return this.childCount()}onlyChild(){return this._children[Object.keys(this._children)[0]]}async*eachChildSeries(){const e=Object.keys(this._children);for(let t=0;t<e.length;t++){const n=e[t];yield{key:n,child:this._children[n]}}}async*flush(e){const t=Object.keys(this._children),n=[];for(let c=0;c<t.length;c++){let r=this._children[t[c]];if(r instanceof Fw)for await(const t of r.flush(e))r=t,yield r;null!=r.size&&r.cid&&n.push({Name:t[c],Tsize:r.size,Hash:r.cid})}const r=new tt({type:"directory",mtime:this.mtime,mode:this.mode}),s={Data:r.marshal(),Links:n},i=bn(pn(s)),o=await rw(i,e,this.options),a=i.length+s.Links.reduce(((e,t)=>e+(null==t.Tsize?0:t.Tsize)),0);this.cid=o,this.size=a,yield{cid:o,unixfs:r,path:this.path,size:a}}}var zw=jw,$w=n(9963);class Hw{constructor(e,t,n=0){this._options=e,this._popCount=0,this._parent=t,this._posAtParent=n,this._children=new $w,this.key=null}async put(e,t){const n=await this._findNewBucketAndPos(e);await n.bucket._putAt(n,e,t)}async get(e){const t=await this._findChild(e);if(null!=t)return t.value}async del(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);null!=n&&n.key===e&&t.bucket._delAt(t.pos)}leafCount(){const e=this._children.compactArray();return e.reduce(((e,t)=>t instanceof Hw?e+t.leafCount():e+1),0)}childrenCount(){return this._children.length}onlyChild(){return this._children.get(0)}*eachLeafSeries(){const e=this._children.compactArray();for(const t of e)t instanceof Hw?yield*t.eachLeafSeries():yield t}serialize(e,t){const n=[];return t(this._children.reduce(((n,r,s)=>(null!=r&&(r instanceof Hw?n.push(r.serialize(e,t)):n.push(e(r,s))),n)),n))}async asyncTransform(e,t){return await Ww(this,e,t)}toJSON(){return this.serialize(qw,Gw)}prettyPrint(){return JSON.stringify(this.toJSON(),null,"  ")}tableSize(){return Math.pow(2,this._options.bits)}async _findChild(e){const t=await this._findPlace(e),n=t.bucket._at(t.pos);if(!(n instanceof Hw))return null!=n&&n.key===e?n:void 0}async _findPlace(e){const t=this._options.hash("string"===typeof e?$o(e):e),n=await t.take(this._options.bits),r=this._children.get(n);return r instanceof Hw?await r._findPlace(t):{bucket:this,pos:n,hash:t,existingChild:r}}async _findNewBucketAndPos(e){const t=await this._findPlace(e);if(null!=t.existingChild&&t.existingChild.key!==e){const e=new Hw(this._options,t.bucket,t.pos);t.bucket._putObjectAt(t.pos,e);const n=await e._findPlace(t.existingChild.hash);return n.bucket._putAt(n,t.existingChild.key,t.existingChild.value),await e._findNewBucketAndPos(t.hash)}return t}_putAt(e,t,n){this._putObjectAt(e.pos,{key:t,value:n,hash:e.hash})}_putObjectAt(e,t){null==this._children.get(e)&&this._popCount++,this._children.set(e,t)}_delAt(e){if(-1===e)throw new Error("Invalid position");null!=this._children.get(e)&&this._popCount--,this._children.unset(e),this._level()}_level(){if(null!=this._parent&&this._popCount<=1)if(1===this._popCount){const e=this._children.find(Kw);if(null!=e&&!(e instanceof Hw)){const t=e.hash;t.untake(this._options.bits);const n={pos:this._posAtParent,hash:t,bucket:this._parent};this._parent._putAt(n,e.key,e.value)}}else this._parent._delAt(this._posAtParent)}_at(e){return this._children.get(e)}}function Kw(e){return Boolean(e)}function qw(e,t){return e.key}function Gw(e){return e}async function Ww(e,t,n){const r=[];for(const s of e._children.compactArray())if(s instanceof Hw)await Ww(s,t,n);else{const n=await t(s);r.push({bitField:e._children.bitField(),children:n})}return await n(r)}const Yw=[255,254,252,248,240,224,192,128],Jw=[1,3,7,15,31,63,127,255];class Qw{constructor(e){this._value=e,this._currentBytePos=e.length-1,this._currentBitPos=7}availableBits(){return this._currentBitPos+1+8*this._currentBytePos}totalBits(){return 8*this._value.length}take(e){let t=e,n=0;while(t>0&&this._haveBits()){const e=this._value[this._currentBytePos],r=this._currentBitPos+1,s=Math.min(r,t),i=Xw(e,r-s,s);n=(n<<s)+i,t-=s,this._currentBitPos-=s,this._currentBitPos<0&&(this._currentBitPos=7,this._currentBytePos--)}return n}untake(e){this._currentBitPos+=e;while(this._currentBitPos>7)this._currentBitPos-=8,this._currentBytePos+=1}_haveBits(){return this._currentBytePos>=0}}function Xw(e,t,n){const r=Zw(t,n);return(e&r)>>>t}function Zw(e,t){return Yw[e]&Jw[Math.min(t+e-1,7)]}function eb(e){function t(t){return t instanceof tb?t:new tb(t,e)}return t}class tb{constructor(e,t){if(!(e instanceof Uint8Array))throw new Error("can only hash Uint8Arrays");this._value=e,this._hashFn=t,this._depth=-1,this._availableBits=0,this._currentBufferIndex=0,this._buffers=[]}async take(e){let t=e;while(this._availableBits<t)await this._produceMoreBits();let n=0;while(t>0){const e=this._buffers[this._currentBufferIndex],r=Math.min(e.availableBits(),t),s=e.take(r);n=(n<<r)+s,t-=r,this._availableBits-=r,0===e.availableBits()&&this._currentBufferIndex++}return n}untake(e){let t=e;while(t>0){const e=this._buffers[this._currentBufferIndex],n=Math.min(e.totalBits()-e.availableBits(),t);e.untake(n),t-=n,this._availableBits+=n,this._currentBufferIndex>0&&e.totalBits()===e.availableBits()&&(this._depth--,this._currentBufferIndex--)}}async _produceMoreBits(){this._depth++;const e=this._depth>0?ya([this._value,Uint8Array.from([this._depth])]):this._value,t=await this._hashFn(e),n=new Qw(t);this._buffers.push(n),this._availableBits+=n.availableBits()}}function nb(e){if(null==e||null==e.hashFn)throw new Error("please define an options.hashFn");const t={bits:e.bits??8,hash:eb(e.hashFn)};return new Hw(t)}class rb extends Fw{constructor(e,t){super(e,t),this._bucket=nb({hashFn:t.hamtHashFn,bits:t.hamtBucketBits})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){for await(const t of ib(this._bucket,e,this,this.options))yield{...t,path:this.path}}}var sb=rb;async function*ib(e,t,n,r){const s=e._children,i=[];let o=0;for(let p=0;p<s.length;p++){const e=s.get(p);if(!e)continue;const n=p.toString(16).toUpperCase().padStart(2,"0");if(e instanceof Hw){let s;for await(const n of await ib(e,t,null,r))s=n;if(!s)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:n,Tsize:s.size,Hash:s.cid}),o+=s.size}else if("function"===typeof e.value.flush){const r=e.value;let s;for await(const e of r.flush(t))s=e,yield s;const a=n+e.key;i.push({Name:a,Tsize:s.size,Hash:s.cid}),o+=s.size}else{const t=e.value;if(!t.cid)continue;const r=n+e.key,s=t.size;i.push({Name:r,Tsize:s,Hash:t.cid}),o+=s}}const a=Uint8Array.from(s.bitField().reverse()),c=new tt({type:"hamt-sharded-directory",data:a,fanout:e.tableSize(),hashType:r.hamtHashCode,mtime:n&&n.mtime,mode:n&&n.mode}),l={Data:c.marshal(),Links:i},u=bn(pn(l)),h=await rw(u,t,r),d=u.length+o;yield{cid:h,unixfs:c,size:d}}async function ob(e,t,n,r){let s=t;t instanceof zw&&t.directChildrenCount()>=n&&(s=await ab(t,r));const i=s.parent;if(i){if(s!==t){if(e&&(e.parent=s),!s.parentKey)throw new Error("No parent key found");await i.put(s.parentKey,s)}return ob(s,i,n,r)}return s}async function ab(e,t){const n=new sb({root:e.root,dir:!0,parent:e.parent,parentKey:e.parentKey,path:e.path,dirty:e.dirty,flat:!1,mtime:e.mtime,mode:e.mode},t);for await(const{key:r,child:s}of e.eachChildSeries())await n.put(r,s);return n}var cb=ob;const lb=(e="")=>(e.trim().match(/([^\\/]|\\\/)+/g)||[]).filter(Boolean);var ub=lb;async function hb(e,t,n){const r=ub(e.path||""),s=r.length-1;let i=t,o="";for(let a=0;a<r.length;a++){const c=r[a];o+=`${o?"/":""}${c}`;const l=a===s;if(i.dirty=!0,i.cid=void 0,i.size=void 0,l)await i.put(c,e),t=await cb(null,i,n.shardSplitThreshold,n);else{let e=await i.get(c);e&&e instanceof Fw||(e=new zw({root:!1,dir:!0,parent:i,parentKey:c,path:o,dirty:!0,flat:!0,mtime:e&&e.unixfs&&e.unixfs.mtime,mode:e&&e.unixfs&&e.unixfs.mode},n)),await i.put(c,e),i=e}}return t}async function*db(e,t){e instanceof Fw?yield*e.flush(t):e&&e.unixfs&&e.unixfs.isDirectory()&&(yield e)}async function*pb(e,t,n){let r=new zw({root:!0,dir:!0,path:"",dirty:!0,flat:!0},n);for await(const s of e)s&&(r=await hb(s,r,n),s.unixfs&&s.unixfs.isDirectory()||(yield s));if(n.wrapWithDirectory)yield*db(r,t);else for await(const s of r.eachChildSeries())s&&(yield*db(s.child,t))}var fb=pb;async function*gb(e,t,n={}){const r=tw(n);let s,i,o;s="function"===typeof n.dagBuilder?n.dagBuilder:Uw,i="function"===typeof n.treeBuilder?n.treeBuilder:fb,o=Symbol.asyncIterator in e||Symbol.iterator in e?e:[e];for await(const a of i(Yy(s(o,t,r),r.fileImportConcurrency),t,r))yield{cid:a.cid,path:a.path,unixfs:a.unixfs,size:a.size}}async function*mb(e,t){if("string"===typeof e||e instanceof String||By(e)||Uy(e)||e._readableState)throw je(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(Fy(e)&&(e=Py(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const n=My(e),{value:r,done:s}=await n.peek();if(s)return void(yield*[]);if(n.push(r),Number.isInteger(r))throw je(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");if(r._readableState)return void(yield*Iy(n,(e=>yb({content:e},t))));if(By(r))return void(yield yb({content:n},t));if(Vy(r)||r[Symbol.iterator]||r[Symbol.asyncIterator]||Fy(r)||Uy(r))return void(yield*Iy(n,(e=>yb(e,t))))}if(Vy(e))throw je(new Error("Unexpected input: single item passed - if you are using ipfs.addAll, please use ipfs.add instead"),"ERR_UNEXPECTED_INPUT");throw je(new Error("Unexpected input: "+typeof e),"ERR_UNEXPECTED_INPUT")}async function yb(e,t){const{path:n,mode:r,mtime:s,content:i}=e,o={path:n||"",mode:Ze(r),mtime:et(s)};return i?o.content=await t(i):n||(o.content=await t(e)),o}function wb(e){return mb(e,zy)}const bb=e=>{if(e){if(e.startsWith("size-")){const t=e.split("-")[1],n=parseInt(t);if(isNaN(n))throw new Error("Chunker parameter size must be an integer");return{chunker:"fixed",maxChunkSize:n}}if(e.startsWith("rabin"))return{chunker:"rabin",...vb(e)};throw new Error(`Unrecognized chunker option: ${e}`)}return{chunker:"fixed"}},vb=e=>{const t={},n=e.split("-");switch(n.length){case 1:t.avgChunkSize=262144;break;case 2:t.avgChunkSize=Eb(n[1],"avg");break;case 4:t.minChunkSize=Eb(n[1],"min"),t.avgChunkSize=Eb(n[2],"avg"),t.maxChunkSize=Eb(n[3],"max");break;default:throw new Error('Incorrect chunker format (expected "rabin" "rabin-[avg]" or "rabin-[min]-[avg]-[max]"')}return t},Eb=(e,t)=>{const n=parseInt(e);if(isNaN(n))throw new Error(`Chunker parameter ${t} must be an integer`);return n},_b=ne.bind({ignoreUndefined:!0});function Sb({repo:e,preload:t,hashers:n,options:r}){const s=r&&r.sharding;async function*i(r,i={}){const o=_b({shardSplitThreshold:s?1e3:1/0,strategy:"balanced"},i,{...bb(i.chunker)});o.hashAlg&&"sha2-256"!==o.hashAlg&&1!==o.cidVersion&&(o.cidVersion=1),o.trickle&&(o.strategy="trickle"),"trickle"===o.strategy&&(o.leafType="raw",o.reduceSingleLeafToSelf=!1),o.cidVersion>0&&void 0===o.rawLeaves&&(o.rawLeaves=!0),void 0!==o.hashAlg&&void 0===o.rawLeaves&&(o.rawLeaves=!0),delete o.trickle;const a={};if(o.progress){const e=o.progress;o.progress=(t,n)=>{a[n]||(a[n]=0),a[n]+=t,e(a[n],n)}}let c;null!=o.hashAlg&&(c=await n.getHasher(o.hashAlg));const l=vm(wb(r),(t=>gb(t,e.blocks,{...o,hasher:c,pin:!1})),kb(o),Ab(t,o),Tb(e,o)),u=await e.gcLock.readLock();try{for await(const e of l){const t=e.path??e.cid.toString();delete a[t],yield{...e,path:t}}}finally{u()}}return pl(i)}function kb(e){async function*t(t){for await(const n of t){let t=n.cid;1===e.cidVersion&&(t=t.toV1());let r=n.path?n.path:t.toString();e.wrapWithDirectory&&!n.path&&(r=""),yield{path:r,cid:t,size:n.size,mode:n.unixfs&&n.unixfs.mode,mtime:n.unixfs&&n.unixfs.mtime}}}return t}function Ab(e,t){async function*n(n){for await(const r of n){const n=!r.path||t.wrapWithDirectory?""===r.path:!r.path.includes("/"),s=n&&!t.onlyHash&&!1!==t.preload;s&&e(r.cid),yield r}}return n}function Tb(e,t){async function*n(n){for await(const r of n){const n=!(r.path&&r.path.includes("/")),s=(null==t.pin||t.pin)&&n&&!t.onlyHash;s&&await e.pins.pinRecursively(r.cid),yield r}}return n}const Cb=async function(e){return(await Xy.encode(e)).slice(0,8).reverse()},Ib=(e,t,n)=>Promise.all(e.map((e=>{if(null==e.Name)throw new Error("Unexpected Link without a Name");if(2===e.Name.length){const r=parseInt(e.Name,16);return t._putObjectAt(r,new Hw({hash:n._options.hash,bits:n._options.bits},t,r))}return n.put(e.Name.substring(2),!0)}))),Rb=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),Ob=e=>{let t=e.bucket;const n=[];while(t._parent)n.push(t),t=t._parent;return n.push(t),n.reverse()},xb=async(e,t,n,r,s)=>{if(!r){const e=nb({hashFn:Cb});r={rootBucket:e,hamtDepth:1,lastBucket:e}}await Ib(e.Links,r.lastBucket,r.rootBucket);const i=await r.rootBucket._findNewBucketAndPos(t);let o=Rb(i.pos);const a=Ob(i);a.length>r.hamtDepth&&(r.lastBucket=a[r.hamtDepth],o=Rb(r.lastBucket._posAtParent));const c=e.Links.find((e=>{if(null==e.Name)return!1;const n=e.Name.substring(0,2),r=e.Name.substring(2);return n===o&&(!r||r===t)}));if(!c)return null;if(null!=c.Name&&c.Name.substring(2)===t)return c.Hash;r.hamtDepth++;const l=await n.get(c.Hash,s);return e=vn(l),xb(e,t,n,r,s)};var Nb=xb;function Db(e,t,n,r){const s=e.length,i=t+s;return n>=i||r<t?new Uint8Array(0):(r>=t&&r<i&&(e=e.subarray(0,r-t)),n>=t&&n<i&&(e=e.subarray(n-t)),e)}var Pb=Db;const Lb=(e,t,n)=>{if(t||(t=0),t<0)throw je(new Error("Offset must be greater than or equal to 0"),"ERR_INVALID_PARAMS");if(t>e)throw je(new Error("Offset must be less than the file size"),"ERR_INVALID_PARAMS");if(n||0===n||(n=e-t),n<0)throw je(new Error("Length must be greater than or equal to 0"),"ERR_INVALID_PARAMS");return t+n>e&&(n=e-t),{offset:t,length:n}};var Mb=Lb;async function Bb(e,t,n,r,s,i,o,a){if(t instanceof Uint8Array)return void n.push(Pb(t,r,s,i));if(null==t.Data)throw je(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");let c;try{c=tt.unmarshal(t.Data)}catch(uS){throw je(uS,"ERR_NOT_UNIXFS")}if(null!=c.data){const e=c.data,t=Pb(e,r,s,i);n.push(t),r+=t.byteLength}const l=[];for(let u=0;u<t.Links.length;u++){const e=t.Links[u],n=r,o=n+c.blockSizes[u];if((s>=n&&s<o||i>=n&&i<=o||s<n&&i>o)&&l.push({link:e,blockStart:r}),r=o,r>i)break}await vm(l,(t=>Iy(t,(t=>async()=>{const n=await e.get(t.link.Hash,{signal:a.signal});return{...t,block:n}}))),(e=>Cy(e,{ordered:!0})),(async t=>{for await(const{link:r,block:c,blockStart:l}of t){let t;switch(r.Hash.code){case wn:t=vn(c);break;case go:t=c;break;default:return void n.end(je(new Error(`Unsupported codec: ${r.Hash.code}`),"ERR_NOT_UNIXFS"))}o.add((async()=>{await Bb(e,t,n,l,s,i,o,a)}))}}))}const Ub=(e,t,n,r,s,i,o)=>{async function*a(e={}){const r=n.fileSize();if(void 0===r)throw new Error("File was a directory");const{offset:s,length:i}=Mb(r,e.offset,e.length);if(0===i)return;const a=new yu({concurrency:1}),c=im();a.add((async()=>{await Bb(o,t,c,0,s,s+i,a,e)})),a.on("error",(e=>{c.end(e)}));let l=0;for await(const t of c)null!=t&&(l+=t.byteLength,l===i&&c.end(),yield t)}return a};var Vb=Ub;const Fb=(e,t,n,r,s,i,o)=>{async function*a(e={}){const n=e.offset||0,a=e.length||t.Links.length,c=t.Links.slice(n,a);for(const t of c){const n=await s(t.Hash,t.Name||"",`${r}/${t.Name||""}`,[],i+1,o,e);n.entry&&(yield n.entry)}}return a};var jb=Fb;const zb=(e,t,n,r,s,i,o)=>{function a(e={}){return $b(t,r,s,i,o,e)}return a};async function*$b(e,t,n,r,s,i){const o=e.Links;for(const a of o){const o=null!=a.Name?a.Name.substring(2):null;if(o){const e=await n(a.Hash,o,`${t}/${o}`,[],r+1,s,i);yield e.entry}else{const o=await s.get(a.Hash);e=vn(o);for await(const a of $b(e,t,n,r,s,i))yield a}}}var Hb=zb;const Kb=(e,t)=>{const n=e.Links.find((e=>e.Name===t));return n&&n.Hash},qb={raw:Vb,file:Vb,directory:jb,"hamt-sharded-directory":Hb,metadata:(e,t,n,r,s,i,o)=>()=>[],symlink:(e,t,n,r,s,i,o)=>()=>[]},Gb=async(e,t,n,r,s,i,o,a)=>{const c=await o.get(e,a),l=vn(c);let u,h;if(t||(t=e.toString()),null==l.Data)throw je(new Error("no data in PBNode"),"ERR_NOT_UNIXFS");try{u=tt.unmarshal(l.Data)}catch(uS){throw je(uS,"ERR_NOT_UNIXFS")}if(n||(n=t),r.length){let e;if(e=u&&"hamt-sharded-directory"===u.type?await Nb(l,r[0],o):Kb(l,r[0]),!e)throw je(new Error("file does not exist"),"ERR_NOT_FOUND");const t=r.shift(),s=`${n}/${t}`;h={cid:e,toResolve:r,name:t||"",path:s}}return{entry:{type:u.isDirectory()?"directory":"file",name:t,path:n,cid:e,content:qb[u.type](e,l,u,n,s,i,o),unixfs:u,depth:i,node:l,size:u.fileSize()},next:h}};var Wb=Gb;const Yb=e=>{async function*t(t={}){const{offset:n,length:r}=Mb(e.length,t.offset,t.length);yield Pb(e,0,n,n+r)}return t},Jb=async(e,t,n,r,s,i,o,a)=>{if(r.length)throw je(new Error(`No link named ${n} found in raw node ${e}`),"ERR_NOT_FOUND");const c=await o.get(e,a);return{entry:{type:"raw",name:t,path:n,cid:e,content:Yb(c),depth:i,size:c.length,node:c}}};var Qb=Jb;const Xb=async(e,t,n,r,s,i,o,a)=>{const c=await o.get(e),l=ei(c);let u=l,h=n;while(r.length){const s=r[0];if(!(s in u))throw je(new Error(`No property named ${s} found in cbor node ${e}`),"ERR_NO_PROP");{r.shift(),h=`${h}/${s}`;const o=Lt.asCID(u[s]);if(o)return{entry:{type:"object",name:t,path:n,cid:e,node:c,depth:i,size:c.length,content:async function*(){yield l}},next:{cid:o,name:s,path:h,toResolve:r}};u=u[s]}}return{entry:{type:"object",name:t,path:n,cid:e,node:c,depth:i,size:c.length,content:async function*(){yield l}}}};var Zb=Xb;const ev=e=>{async function*t(t={}){const{offset:n,length:r}=Mb(e.length,t.offset,t.length);yield Pb(e,0,n,n+r)}return t},tv=async(e,t,n,r,s,i,o,a)=>{if(r.length)throw je(new Error(`No link named ${n} found in raw node ${e}`),"ERR_NOT_FOUND");const c=await Rt(e.multihash.bytes);return{entry:{type:"identity",name:t,path:n,cid:e,content:ev(c.digest),depth:i,size:c.digest.length,node:c.digest}}};var nv=tv;const rv={[wn]:Wb,[go]:Qb,[Xs]:Zb,[Yi.code]:nv};function sv(e,t,n,r,s,i,o){const a=rv[e.code];if(!a)throw je(new Error(`No resolver for code ${e.code}`),"ERR_NO_RESOLVER");return a(e,t,n,r,sv,s,i,o)}var iv=sv;const ov=(e="")=>(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean),av=e=>{if(e instanceof Uint8Array)return{cid:Lt.decode(e),toResolve:[]};const t=Lt.asCID(e);if(t)return{cid:t,toResolve:[]};if("string"===typeof e){0===e.indexOf("/ipfs/")&&(e=e.substring(6));const t=ov(e);return{cid:Lt.parse(t[0]),toResolve:t.slice(1)}}throw je(new Error(`Unknown path type ${e}`),"ERR_BAD_PATH")};async function*cv(e,t,n={}){let{cid:r,toResolve:s}=av(e),i=r.toString(),o=i;const a=s.length;while(1){const c=await iv(r,i,o,s,a,t,n);if(!c.entry&&!c.next)throw je(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");if(c.entry&&(yield c.entry),!c.next)return;s=c.next.toResolve,r=c.next.cid,i=c.next.name,o=c.next.path}}async function lv(e,t,n={}){const r=await qu(cv(e,t,n));if(!r)throw je(new Error(`Could not resolve ${e}`),"ERR_NOT_FOUND");return r}async function*uv(e,t,n={}){const r=await lv(e,t,n);if(r&&(yield r,"directory"===r.type))for await(const i of s(r,n))yield i;async function*s(e,t){for await(const n of e.content(t))yield n,n instanceof Uint8Array||"directory"===n.type&&(yield*s(n,t))}}function hv({repo:e,preload:t}){async function*n(n,r={}){if(n=El(n),!1!==r.preload){const e=n.split("/");t(Lt.parse(e[0]))}const s=await lv(n,e.blocks,r);if("directory"===s.type)throw new Error("this dag node is a directory");if(!s.content)throw new Error("this dag node has no content");yield*s.content(r)}return pl(n)}"0".charCodeAt(0),$o("ustar\0","binary"),$o("ustar ","binary"),$o(" \0","binary");function dv(e){const t=async function*(){let t=yield,n=new Aw;for await(const r of e)if(null!=t){n.append(r);while(n.length>=t){const e=n.sublist(0,t);if(n.consume(t),t=yield e,null==t){n.length>0&&(t=yield n,n=new Aw);break}}}else n.append(r),t=yield n,n=new Aw;if(null!=t)throw Object.assign(new Error(`stream ended before ${t} bytes became available`),{code:"ERR_UNDER_READ",buffer:n})}();return t.next(),t}var pv=n(7870);async function fv(e){let t=new Uint8Array(0);for await(const n of e)t=ya([t,n],t.length+n.length);return t}const gv="0000000000000000000",mv="7777777777777777777",yv="0".charCodeAt(0),wv=$o("ustar\0","binary"),bv=$o("00","binary"),vv=parseInt("7777",8),Ev=257,_v=263,Sv=function(e){switch(e){case"file":return 0;case"link":return 1;case"symlink":return 2;case"character-device":return 3;case"block-device":return 4;case"directory":return 5;case"fifo":return 6;case"contiguous-file":return 7;case"pax-header":return 72;default:return 0}},kv=function(e){let t=256;for(let n=0;n<148;n++)t+=e[n];for(let n=156;n<512;n++)t+=e[n];return t},Av=function(e,t){const n=e.toString(8);return n.length>t?$o(mv.slice(0,t)+" "):$o(gv.slice(0,t-n.length)+n+" ")},Tv=function(e){const t=$o(e).byteLength;let n=Math.floor(Math.log(t)/Math.log(10))+1;return t+n>=Math.pow(10,n)&&n++,`${t+n}${e}`};function Cv(e){let t="";null!=e.name&&(t+=Tv(" path="+e.name+"\n")),null!=e.linkname&&(t+=Tv(" linkpath="+e.linkname+"\n"));const n=e.pax;if(null!=n)for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t+=Tv(" "+r+"="+n[r]+"\n"));return $o(t)}function Iv(e){const t=new Uint8Array(512);let n=e.name,r="";if(5===e.typeflag&&"/"!==n[n.length-1]&&(n+="/"),$o(n).byteLength!==n.length)return null;while($o(n).byteLength>100){const e=n.indexOf("/");if(-1===e)return null;r+=""!==r?"/"+n.slice(0,e):n.slice(0,e),n=n.slice(e+1)}return $o(n).byteLength>100||$o(r).byteLength>155||null!=e.linkname&&$o(e.linkname).byteLength>100?null:(t.set($o(n),0),t.set(Av(e.mode&vv,6),100),t.set(Av(e.uid,6),108),t.set(Av(e.gid,6),116),t.set(Av(e.size,11),124),t.set(Av(e.mtime.getTime()/1e3|0,11),136),t[156]=yv+Sv(e.type),null!=e.linkname&&t.set($o(e.linkname),157),t.set(wv,Ev),t.set(bv,_v),null!=e.uname&&t.set($o(e.uname),265),null!=e.gname&&t.set($o(e.gname),297),t.set(Av(e.devmajor??0,6),329),t.set(Av(e.devminor??0,6),337),null!=r&&t.set($o(r),345),t.set(Av(kv(t),6),148),t)}const{S_IFMT:Rv,S_IFBLK:Ov,S_IFCHR:xv,S_IFDIR:Nv,S_IFIFO:Dv,S_IFLNK:Pv}=pv,Lv=parseInt("755",8),Mv=parseInt("644",8),Bv=new Uint8Array(1024);function Uv(e=0){switch(e&Rv){case Ov:return"block-device";case xv:return"character-device";case Nv:return"directory";case Dv:return"fifo";case Pv:return"symlink";default:return"file"}}function Vv(e){return e&=511,0!==e?Bv.subarray(0,512-e):new Uint8Array(0)}function Fv(e){if(null==e.pax){const t=Iv(e);if(null!=t)return t}return jv(e)}function jv(e){const t=Cv(e),n={name:"PaxHeader",mode:e.mode,uid:e.uid,gid:e.gid,size:t.length,mtime:e.mtime,type:"pax-header",linkname:e.linkname,uname:e.uname,gname:e.gname,devmajor:e.devmajor,devminor:e.devminor};return new Aw(Iv(n)??new Uint8Array(0),t,Vv(t.length),Iv({...n,size:e.size,type:e.type})??new Uint8Array(0)).subarray()}function zv(){return async function*(e){for await(let{header:t,body:n}of e){const e={...t,size:"symlink"===t.type?0:t.size??0,type:t.type??Uv(t.mode),mode:t.mode??("directory"===t.type?Lv:Mv),uid:t.uid??0,gid:t.gid??0,mtime:t.mtime??new Date};if("string"===typeof n&&(n=$o(n)),n instanceof Uint8Array||kw(n)){e.size=n.length,yield Fv(e),yield kw(n)?n.subarray():n,yield Vv(e.size);continue}if("symlink"===e.type&&null==e.linkname){if(null==n)throw new Error("type was symlink but no linkname or body specified");e.linkname=ia(await fv(n)),yield Fv(e);continue}if(yield Fv(e),"file"!==e.type&&"contiguous-file"!==e.type)continue;let r=0;for await(const t of n??[])r+=t.length,yield kw(t)?t.subarray():t;if(r!==e.size)throw new Error(`size mismatch, wrote ${r} of ${e.size} bytes`);yield Vv(e.size)}yield Bv}}n(2087);
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */
const $v=4,Hv=0,Kv=1,qv=2;function Gv(e){let t=e.length;while(--t>=0)e[t]=0}const Wv=0,Yv=1,Jv=2,Qv=3,Xv=258,Zv=29,eE=256,tE=eE+1+Zv,nE=30,rE=19,sE=2*tE+1,iE=15,oE=16,aE=7,cE=256,lE=16,uE=17,hE=18,dE=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),pE=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),fE=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),gE=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),mE=512,yE=new Array(2*(tE+2));Gv(yE);const wE=new Array(2*nE);Gv(wE);const bE=new Array(mE);Gv(bE);const vE=new Array(Xv-Qv+1);Gv(vE);const EE=new Array(Zv);Gv(EE);const _E=new Array(nE);function SE(e,t,n,r,s){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=r,this.max_length=s,this.has_stree=e&&e.length}let kE,AE,TE;function CE(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Gv(_E);const IE=e=>e<256?bE[e]:bE[256+(e>>>7)],RE=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},OE=(e,t,n)=>{e.bi_valid>oE-n?(e.bi_buf|=t<<e.bi_valid&65535,RE(e,e.bi_buf),e.bi_buf=t>>oE-e.bi_valid,e.bi_valid+=n-oE):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)},xE=(e,t,n)=>{OE(e,n[2*t],n[2*t+1])},NE=(e,t)=>{let n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1},DE=e=>{16===e.bi_valid?(RE(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)},PE=(e,t)=>{const n=t.dyn_tree,r=t.max_code,s=t.stat_desc.static_tree,i=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,a=t.stat_desc.extra_base,c=t.stat_desc.max_length;let l,u,h,d,p,f,g=0;for(d=0;d<=iE;d++)e.bl_count[d]=0;for(n[2*e.heap[e.heap_max]+1]=0,l=e.heap_max+1;l<sE;l++)u=e.heap[l],d=n[2*n[2*u+1]+1]+1,d>c&&(d=c,g++),n[2*u+1]=d,u>r||(e.bl_count[d]++,p=0,u>=a&&(p=o[u-a]),f=n[2*u],e.opt_len+=f*(d+p),i&&(e.static_len+=f*(s[2*u+1]+p)));if(0!==g){do{d=c-1;while(0===e.bl_count[d])d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[c]--,g-=2}while(g>0);for(d=c;0!==d;d--){u=e.bl_count[d];while(0!==u)h=e.heap[--l],h>r||(n[2*h+1]!==d&&(e.opt_len+=(d-n[2*h+1])*n[2*h],n[2*h+1]=d),u--)}}},LE=(e,t,n)=>{const r=new Array(iE+1);let s,i,o=0;for(s=1;s<=iE;s++)o=o+n[s-1]<<1,r[s]=o;for(i=0;i<=t;i++){let t=e[2*i+1];0!==t&&(e[2*i]=NE(r[t]++,t))}},ME=()=>{let e,t,n,r,s;const i=new Array(iE+1);for(n=0,r=0;r<Zv-1;r++)for(EE[r]=n,e=0;e<1<<dE[r];e++)vE[n++]=r;for(vE[n-1]=r,s=0,r=0;r<16;r++)for(_E[r]=s,e=0;e<1<<pE[r];e++)bE[s++]=r;for(s>>=7;r<nE;r++)for(_E[r]=s<<7,e=0;e<1<<pE[r]-7;e++)bE[256+s++]=r;for(t=0;t<=iE;t++)i[t]=0;e=0;while(e<=143)yE[2*e+1]=8,e++,i[8]++;while(e<=255)yE[2*e+1]=9,e++,i[9]++;while(e<=279)yE[2*e+1]=7,e++,i[7]++;while(e<=287)yE[2*e+1]=8,e++,i[8]++;for(LE(yE,tE+1,i),e=0;e<nE;e++)wE[2*e+1]=5,wE[2*e]=NE(e,5);kE=new SE(yE,dE,eE+1,tE,iE),AE=new SE(wE,pE,0,nE,iE),TE=new SE(new Array(0),fE,0,rE,aE)},BE=e=>{let t;for(t=0;t<tE;t++)e.dyn_ltree[2*t]=0;for(t=0;t<nE;t++)e.dyn_dtree[2*t]=0;for(t=0;t<rE;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*cE]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},UE=e=>{e.bi_valid>8?RE(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},VE=(e,t,n,r)=>{const s=2*t,i=2*n;return e[s]<e[i]||e[s]===e[i]&&r[t]<=r[n]},FE=(e,t,n)=>{const r=e.heap[n];let s=n<<1;while(s<=e.heap_len){if(s<e.heap_len&&VE(t,e.heap[s+1],e.heap[s],e.depth)&&s++,VE(t,r,e.heap[s],e.depth))break;e.heap[n]=e.heap[s],n=s,s<<=1}e.heap[n]=r},jE=(e,t,n)=>{let r,s,i,o,a=0;if(0!==e.sym_next)do{r=255&e.pending_buf[e.sym_buf+a++],r+=(255&e.pending_buf[e.sym_buf+a++])<<8,s=e.pending_buf[e.sym_buf+a++],0===r?xE(e,s,t):(i=vE[s],xE(e,i+eE+1,t),o=dE[i],0!==o&&(s-=EE[i],OE(e,s,o)),r--,i=IE(r),xE(e,i,n),o=pE[i],0!==o&&(r-=_E[i],OE(e,r,o)))}while(a<e.sym_next);xE(e,cE,t)},zE=(e,t)=>{const n=t.dyn_tree,r=t.stat_desc.static_tree,s=t.stat_desc.has_stree,i=t.stat_desc.elems;let o,a,c,l=-1;for(e.heap_len=0,e.heap_max=sE,o=0;o<i;o++)0!==n[2*o]?(e.heap[++e.heap_len]=l=o,e.depth[o]=0):n[2*o+1]=0;while(e.heap_len<2)c=e.heap[++e.heap_len]=l<2?++l:0,n[2*c]=1,e.depth[c]=0,e.opt_len--,s&&(e.static_len-=r[2*c+1]);for(t.max_code=l,o=e.heap_len>>1;o>=1;o--)FE(e,n,o);c=i;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],FE(e,n,1),a=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=a,n[2*c]=n[2*o]+n[2*a],e.depth[c]=(e.depth[o]>=e.depth[a]?e.depth[o]:e.depth[a])+1,n[2*o+1]=n[2*a+1]=c,e.heap[1]=c++,FE(e,n,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],PE(e,t),LE(n,l,e.bl_count)},$E=(e,t,n)=>{let r,s,i=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),t[2*(n+1)+1]=65535,r=0;r<=n;r++)s=o,o=t[2*(r+1)+1],++a<c&&s===o||(a<l?e.bl_tree[2*s]+=a:0!==s?(s!==i&&e.bl_tree[2*s]++,e.bl_tree[2*lE]++):a<=10?e.bl_tree[2*uE]++:e.bl_tree[2*hE]++,a=0,i=s,0===o?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4))},HE=(e,t,n)=>{let r,s,i=-1,o=t[1],a=0,c=7,l=4;for(0===o&&(c=138,l=3),r=0;r<=n;r++)if(s=o,o=t[2*(r+1)+1],!(++a<c&&s===o)){if(a<l)do{xE(e,s,e.bl_tree)}while(0!==--a);else 0!==s?(s!==i&&(xE(e,s,e.bl_tree),a--),xE(e,lE,e.bl_tree),OE(e,a-3,2)):a<=10?(xE(e,uE,e.bl_tree),OE(e,a-3,3)):(xE(e,hE,e.bl_tree),OE(e,a-11,7));a=0,i=s,0===o?(c=138,l=3):s===o?(c=6,l=3):(c=7,l=4)}},KE=e=>{let t;for($E(e,e.dyn_ltree,e.l_desc.max_code),$E(e,e.dyn_dtree,e.d_desc.max_code),zE(e,e.bl_desc),t=rE-1;t>=3;t--)if(0!==e.bl_tree[2*gE[t]+1])break;return e.opt_len+=3*(t+1)+5+5+4,t},qE=(e,t,n,r)=>{let s;for(OE(e,t-257,5),OE(e,n-1,5),OE(e,r-4,4),s=0;s<r;s++)OE(e,e.bl_tree[2*gE[s]+1],3);HE(e,e.dyn_ltree,t-1),HE(e,e.dyn_dtree,n-1)},GE=e=>{let t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return Hv;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return Kv;for(t=32;t<eE;t++)if(0!==e.dyn_ltree[2*t])return Kv;return Hv};let WE=!1;const YE=e=>{WE||(ME(),WE=!0),e.l_desc=new CE(e.dyn_ltree,kE),e.d_desc=new CE(e.dyn_dtree,AE),e.bl_desc=new CE(e.bl_tree,TE),e.bi_buf=0,e.bi_valid=0,BE(e)},JE=(e,t,n,r)=>{OE(e,(Wv<<1)+(r?1:0),3),UE(e),RE(e,n),RE(e,~n),n&&e.pending_buf.set(e.window.subarray(t,t+n),e.pending),e.pending+=n},QE=e=>{OE(e,Yv<<1,3),xE(e,cE,yE),DE(e)},XE=(e,t,n,r)=>{let s,i,o=0;e.level>0?(e.strm.data_type===qv&&(e.strm.data_type=GE(e)),zE(e,e.l_desc),zE(e,e.d_desc),o=KE(e),s=e.opt_len+3+7>>>3,i=e.static_len+3+7>>>3,i<=s&&(s=i)):s=i=n+5,n+4<=s&&-1!==t?JE(e,t,n,r):e.strategy===$v||i===s?(OE(e,(Yv<<1)+(r?1:0),3),jE(e,yE,wE)):(OE(e,(Jv<<1)+(r?1:0),3),qE(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),jE(e,e.dyn_ltree,e.dyn_dtree)),BE(e),r&&UE(e)},ZE=(e,t,n)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=n,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(vE[n]+eE+1)]++,e.dyn_dtree[2*IE(t)]++),e.sym_next===e.sym_end);var e_=YE,t_=JE,n_=XE,r_=ZE,s_=QE,i_={_tr_init:e_,_tr_stored_block:t_,_tr_flush_block:n_,_tr_tally:r_,_tr_align:s_};const o_=(e,t,n,r)=>{let s=65535&e|0,i=e>>>16&65535|0,o=0;while(0!==n){o=n>2e3?2e3:n,n-=o;do{s=s+t[r++]|0,i=i+s|0}while(--o);s%=65521,i%=65521}return s|i<<16|0};var a_=o_;const c_=()=>{let e,t=[];for(var n=0;n<256;n++){e=n;for(var r=0;r<8;r++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t},l_=new Uint32Array(c_()),u_=(e,t,n,r)=>{const s=l_,i=r+n;e^=-1;for(let o=r;o<i;o++)e=e>>>8^s[255&(e^t[o])];return-1^e};var h_=u_,d_={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},p_={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:f_,_tr_stored_block:g_,_tr_flush_block:m_,_tr_tally:y_,_tr_align:w_}=i_,{Z_NO_FLUSH:b_,Z_PARTIAL_FLUSH:v_,Z_FULL_FLUSH:E_,Z_FINISH:__,Z_BLOCK:S_,Z_OK:k_,Z_STREAM_END:A_,Z_STREAM_ERROR:T_,Z_DATA_ERROR:C_,Z_BUF_ERROR:I_,Z_DEFAULT_COMPRESSION:R_,Z_FILTERED:O_,Z_HUFFMAN_ONLY:x_,Z_RLE:N_,Z_FIXED:D_,Z_DEFAULT_STRATEGY:P_,Z_UNKNOWN:L_,Z_DEFLATED:M_}=p_,B_=9,U_=15,V_=8,F_=29,j_=256,z_=j_+1+F_,$_=30,H_=19,K_=2*z_+1,q_=15,G_=3,W_=258,Y_=W_+G_+1,J_=32,Q_=42,X_=57,Z_=69,eS=73,tS=91,nS=103,rS=113,sS=666,iS=1,oS=2,aS=3,cS=4,lS=3,uS=(e,t)=>(e.msg=d_[t],t),hS=e=>2*e-(e>4?9:0),dS=e=>{let t=e.length;while(--t>=0)e[t]=0},pS=e=>{let t,n,r,s=e.w_size;t=e.hash_size,r=t;do{n=e.head[--r],e.head[r]=n>=s?n-s:0}while(--t);t=s,r=t;do{n=e.prev[--r],e.prev[r]=n>=s?n-s:0}while(--t)};let fS=(e,t,n)=>(t<<e.hash_shift^n)&e.hash_mask,gS=fS;const mS=e=>{const t=e.state;let n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+n),e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))},yS=(e,t)=>{m_(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,mS(e.strm)},wS=(e,t)=>{e.pending_buf[e.pending++]=t},bS=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},vS=(e,t,n,r)=>{let s=e.avail_in;return s>r&&(s=r),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),n),1===e.state.wrap?e.adler=a_(e.adler,t,s,n):2===e.state.wrap&&(e.adler=h_(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)},ES=(e,t)=>{let n,r,s=e.max_chain_length,i=e.strstart,o=e.prev_length,a=e.nice_match;const c=e.strstart>e.w_size-Y_?e.strstart-(e.w_size-Y_):0,l=e.window,u=e.w_mask,h=e.prev,d=e.strstart+W_;let p=l[i+o-1],f=l[i+o];e.prev_length>=e.good_match&&(s>>=2),a>e.lookahead&&(a=e.lookahead);do{if(n=t,l[n+o]===f&&l[n+o-1]===p&&l[n]===l[i]&&l[++n]===l[i+1]){i+=2,n++;do{}while(l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&l[++i]===l[++n]&&i<d);if(r=W_-(d-i),i=d-W_,r>o){if(e.match_start=t,o=r,r>=a)break;p=l[i+o-1],f=l[i+o]}}}while((t=h[t&u])>c&&0!==--s);return o<=e.lookahead?o:e.lookahead},_S=e=>{const t=e.w_size;let n,r,s;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Y_)&&(e.window.set(e.window.subarray(t,t+t-r),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),pS(e),r+=t),0===e.strm.avail_in)break;if(n=vS(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=n,e.lookahead+e.insert>=G_){s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=gS(e,e.ins_h,e.window[s+1]);while(e.insert)if(e.ins_h=gS(e,e.ins_h,e.window[s+G_-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,e.lookahead+e.insert<G_)break}}while(e.lookahead<Y_&&0!==e.strm.avail_in)},SS=(e,t)=>{let n,r,s,i=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,a=e.strm.avail_in;do{if(n=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,r=e.strstart-e.block_start,n>r+e.strm.avail_in&&(n=r+e.strm.avail_in),n>s&&(n=s),n<i&&(0===n&&t!==__||t===b_||n!==r+e.strm.avail_in))break;o=t===__&&n===r+e.strm.avail_in?1:0,g_(e,0,0,o),e.pending_buf[e.pending-4]=n,e.pending_buf[e.pending-3]=n>>8,e.pending_buf[e.pending-2]=~n,e.pending_buf[e.pending-1]=~n>>8,mS(e.strm),r&&(r>n&&(r=n),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+r),e.strm.next_out),e.strm.next_out+=r,e.strm.avail_out-=r,e.strm.total_out+=r,e.block_start+=r,n-=r),n&&(vS(e.strm,e.strm.output,e.strm.next_out,n),e.strm.next_out+=n,e.strm.avail_out-=n,e.strm.total_out+=n)}while(0===o);return a-=e.strm.avail_in,a&&(a>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=a&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-a,e.strm.next_in),e.strstart),e.strstart+=a,e.insert+=a>e.w_size-e.insert?e.w_size-e.insert:a),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?cS:t!==b_&&t!==__&&0===e.strm.avail_in&&e.strstart===e.block_start?oS:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(vS(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,i=s>e.w_size?e.w_size:s,r=e.strstart-e.block_start,(r>=i||(r||t===__)&&t!==b_&&0===e.strm.avail_in&&r<=s)&&(n=r>s?s:r,o=t===__&&0===e.strm.avail_in&&n===r?1:0,g_(e,e.block_start,n,o),e.block_start+=n,mS(e.strm)),o?aS:iS)},kS=(e,t)=>{let n,r;for(;;){if(e.lookahead<Y_){if(_S(e),e.lookahead<Y_&&t===b_)return iS;if(0===e.lookahead)break}if(n=0,e.lookahead>=G_&&(e.ins_h=gS(e,e.ins_h,e.window[e.strstart+G_-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-Y_&&(e.match_length=ES(e,n)),e.match_length>=G_)if(r=y_(e,e.strstart-e.match_start,e.match_length-G_),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=G_){e.match_length--;do{e.strstart++,e.ins_h=gS(e,e.ins_h,e.window[e.strstart+G_-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=gS(e,e.ins_h,e.window[e.strstart+1]);else r=y_(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(r&&(yS(e,!1),0===e.strm.avail_out))return iS}return e.insert=e.strstart<G_-1?e.strstart:G_-1,t===__?(yS(e,!0),0===e.strm.avail_out?aS:cS):e.sym_next&&(yS(e,!1),0===e.strm.avail_out)?iS:oS},AS=(e,t)=>{let n,r,s;for(;;){if(e.lookahead<Y_){if(_S(e),e.lookahead<Y_&&t===b_)return iS;if(0===e.lookahead)break}if(n=0,e.lookahead>=G_&&(e.ins_h=gS(e,e.ins_h,e.window[e.strstart+G_-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=G_-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-Y_&&(e.match_length=ES(e,n),e.match_length<=5&&(e.strategy===O_||e.match_length===G_&&e.strstart-e.match_start>4096)&&(e.match_length=G_-1)),e.prev_length>=G_&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-G_,r=y_(e,e.strstart-1-e.prev_match,e.prev_length-G_),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=gS(e,e.ins_h,e.window[e.strstart+G_-1]),n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=G_-1,e.strstart++,r&&(yS(e,!1),0===e.strm.avail_out))return iS}else if(e.match_available){if(r=y_(e,0,e.window[e.strstart-1]),r&&yS(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return iS}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(r=y_(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<G_-1?e.strstart:G_-1,t===__?(yS(e,!0),0===e.strm.avail_out?aS:cS):e.sym_next&&(yS(e,!1),0===e.strm.avail_out)?iS:oS},TS=(e,t)=>{let n,r,s,i;const o=e.window;for(;;){if(e.lookahead<=W_){if(_S(e),e.lookahead<=W_&&t===b_)return iS;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=G_&&e.strstart>0&&(s=e.strstart-1,r=o[s],r===o[++s]&&r===o[++s]&&r===o[++s])){i=e.strstart+W_;do{}while(r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&r===o[++s]&&s<i);e.match_length=W_-(i-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=G_?(n=y_(e,1,e.match_length-G_),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=y_(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(yS(e,!1),0===e.strm.avail_out))return iS}return e.insert=0,t===__?(yS(e,!0),0===e.strm.avail_out?aS:cS):e.sym_next&&(yS(e,!1),0===e.strm.avail_out)?iS:oS},CS=(e,t)=>{let n;for(;;){if(0===e.lookahead&&(_S(e),0===e.lookahead)){if(t===b_)return iS;break}if(e.match_length=0,n=y_(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(yS(e,!1),0===e.strm.avail_out))return iS}return e.insert=0,t===__?(yS(e,!0),0===e.strm.avail_out?aS:cS):e.sym_next&&(yS(e,!1),0===e.strm.avail_out)?iS:oS};function IS(e,t,n,r,s){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=r,this.func=s}const RS=[new IS(0,0,0,0,SS),new IS(4,4,8,4,kS),new IS(4,5,16,8,kS),new IS(4,6,32,32,kS),new IS(4,4,16,16,AS),new IS(8,16,32,32,AS),new IS(8,16,128,128,AS),new IS(8,32,128,256,AS),new IS(32,128,258,1024,AS),new IS(32,258,258,4096,AS)],OS=e=>{e.window_size=2*e.w_size,dS(e.head),e.max_lazy_match=RS[e.level].max_lazy,e.good_match=RS[e.level].good_length,e.nice_match=RS[e.level].nice_length,e.max_chain_length=RS[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=G_-1,e.match_available=0,e.ins_h=0};function xS(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=M_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*K_),this.dyn_dtree=new Uint16Array(2*(2*$_+1)),this.bl_tree=new Uint16Array(2*(2*H_+1)),dS(this.dyn_ltree),dS(this.dyn_dtree),dS(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(q_+1),this.heap=new Uint16Array(2*z_+1),dS(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*z_+1),dS(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const NS=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Q_&&t.status!==X_&&t.status!==Z_&&t.status!==eS&&t.status!==tS&&t.status!==nS&&t.status!==rS&&t.status!==sS?1:0},DS=e=>{if(NS(e))return uS(e,T_);e.total_in=e.total_out=0,e.data_type=L_;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?X_:t.wrap?Q_:rS,e.adler=2===t.wrap?0:1,t.last_flush=-2,f_(t),k_},PS=e=>{const t=DS(e);return t===k_&&OS(e.state),t},LS=(e,t)=>NS(e)||2!==e.state.wrap?T_:(e.state.gzhead=t,k_),MS=(e,t,n,r,s,i)=>{if(!e)return T_;let o=1;if(t===R_&&(t=6),r<0?(o=0,r=-r):r>15&&(o=2,r-=16),s<1||s>B_||n!==M_||r<8||r>15||t<0||t>9||i<0||i>D_||8===r&&1!==o)return uS(e,T_);8===r&&(r=9);const a=new xS;return e.state=a,a.strm=e,a.status=Q_,a.wrap=o,a.gzhead=null,a.w_bits=r,a.w_size=1<<a.w_bits,a.w_mask=a.w_size-1,a.hash_bits=s+7,a.hash_size=1<<a.hash_bits,a.hash_mask=a.hash_size-1,a.hash_shift=~~((a.hash_bits+G_-1)/G_),a.window=new Uint8Array(2*a.w_size),a.head=new Uint16Array(a.hash_size),a.prev=new Uint16Array(a.w_size),a.lit_bufsize=1<<s+6,a.pending_buf_size=4*a.lit_bufsize,a.pending_buf=new Uint8Array(a.pending_buf_size),a.sym_buf=a.lit_bufsize,a.sym_end=3*(a.lit_bufsize-1),a.level=t,a.strategy=i,a.method=n,PS(e)},BS=(e,t)=>MS(e,t,M_,U_,V_,P_),US=(e,t)=>{if(NS(e)||t>S_||t<0)return e?uS(e,T_):T_;const n=e.state;if(!e.output||0!==e.avail_in&&!e.input||n.status===sS&&t!==__)return uS(e,0===e.avail_out?I_:T_);const r=n.last_flush;if(n.last_flush=t,0!==n.pending){if(mS(e),0===e.avail_out)return n.last_flush=-1,k_}else if(0===e.avail_in&&hS(t)<=hS(r)&&t!==__)return uS(e,I_);if(n.status===sS&&0!==e.avail_in)return uS(e,I_);if(n.status===Q_&&0===n.wrap&&(n.status=rS),n.status===Q_){let t=M_+(n.w_bits-8<<4)<<8,r=-1;if(r=n.strategy>=x_||n.level<2?0:n.level<6?1:6===n.level?2:3,t|=r<<6,0!==n.strstart&&(t|=J_),t+=31-t%31,bS(n,t),0!==n.strstart&&(bS(n,e.adler>>>16),bS(n,65535&e.adler)),e.adler=1,n.status=rS,mS(e),0!==n.pending)return n.last_flush=-1,k_}if(n.status===X_)if(e.adler=0,wS(n,31),wS(n,139),wS(n,8),n.gzhead)wS(n,(n.gzhead.text?1:0)+(n.gzhead.hcrc?2:0)+(n.gzhead.extra?4:0)+(n.gzhead.name?8:0)+(n.gzhead.comment?16:0)),wS(n,255&n.gzhead.time),wS(n,n.gzhead.time>>8&255),wS(n,n.gzhead.time>>16&255),wS(n,n.gzhead.time>>24&255),wS(n,9===n.level?2:n.strategy>=x_||n.level<2?4:0),wS(n,255&n.gzhead.os),n.gzhead.extra&&n.gzhead.extra.length&&(wS(n,255&n.gzhead.extra.length),wS(n,n.gzhead.extra.length>>8&255)),n.gzhead.hcrc&&(e.adler=h_(e.adler,n.pending_buf,n.pending,0)),n.gzindex=0,n.status=Z_;else if(wS(n,0),wS(n,0),wS(n,0),wS(n,0),wS(n,0),wS(n,9===n.level?2:n.strategy>=x_||n.level<2?4:0),wS(n,lS),n.status=rS,mS(e),0!==n.pending)return n.last_flush=-1,k_;if(n.status===Z_){if(n.gzhead.extra){let t=n.pending,r=(65535&n.gzhead.extra.length)-n.gzindex;while(n.pending+r>n.pending_buf_size){let s=n.pending_buf_size-n.pending;if(n.pending_buf.set(n.gzhead.extra.subarray(n.gzindex,n.gzindex+s),n.pending),n.pending=n.pending_buf_size,n.gzhead.hcrc&&n.pending>t&&(e.adler=h_(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex+=s,mS(e),0!==n.pending)return n.last_flush=-1,k_;t=0,r-=s}let s=new Uint8Array(n.gzhead.extra);n.pending_buf.set(s.subarray(n.gzindex,n.gzindex+r),n.pending),n.pending+=r,n.gzhead.hcrc&&n.pending>t&&(e.adler=h_(e.adler,n.pending_buf,n.pending-t,t)),n.gzindex=0}n.status=eS}if(n.status===eS){if(n.gzhead.name){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=h_(e.adler,n.pending_buf,n.pending-r,r)),mS(e),0!==n.pending)return n.last_flush=-1,k_;r=0}t=n.gzindex<n.gzhead.name.length?255&n.gzhead.name.charCodeAt(n.gzindex++):0,wS(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=h_(e.adler,n.pending_buf,n.pending-r,r)),n.gzindex=0}n.status=tS}if(n.status===tS){if(n.gzhead.comment){let t,r=n.pending;do{if(n.pending===n.pending_buf_size){if(n.gzhead.hcrc&&n.pending>r&&(e.adler=h_(e.adler,n.pending_buf,n.pending-r,r)),mS(e),0!==n.pending)return n.last_flush=-1,k_;r=0}t=n.gzindex<n.gzhead.comment.length?255&n.gzhead.comment.charCodeAt(n.gzindex++):0,wS(n,t)}while(0!==t);n.gzhead.hcrc&&n.pending>r&&(e.adler=h_(e.adler,n.pending_buf,n.pending-r,r))}n.status=nS}if(n.status===nS){if(n.gzhead.hcrc){if(n.pending+2>n.pending_buf_size&&(mS(e),0!==n.pending))return n.last_flush=-1,k_;wS(n,255&e.adler),wS(n,e.adler>>8&255),e.adler=0}if(n.status=rS,mS(e),0!==n.pending)return n.last_flush=-1,k_}if(0!==e.avail_in||0!==n.lookahead||t!==b_&&n.status!==sS){let r=0===n.level?SS(n,t):n.strategy===x_?CS(n,t):n.strategy===N_?TS(n,t):RS[n.level].func(n,t);if(r!==aS&&r!==cS||(n.status=sS),r===iS||r===aS)return 0===e.avail_out&&(n.last_flush=-1),k_;if(r===oS&&(t===v_?w_(n):t!==S_&&(g_(n,0,0,!1),t===E_&&(dS(n.head),0===n.lookahead&&(n.strstart=0,n.block_start=0,n.insert=0))),mS(e),0===e.avail_out))return n.last_flush=-1,k_}return t!==__?k_:n.wrap<=0?A_:(2===n.wrap?(wS(n,255&e.adler),wS(n,e.adler>>8&255),wS(n,e.adler>>16&255),wS(n,e.adler>>24&255),wS(n,255&e.total_in),wS(n,e.total_in>>8&255),wS(n,e.total_in>>16&255),wS(n,e.total_in>>24&255)):(bS(n,e.adler>>>16),bS(n,65535&e.adler)),mS(e),n.wrap>0&&(n.wrap=-n.wrap),0!==n.pending?k_:A_)},VS=e=>{if(NS(e))return T_;const t=e.state.status;return e.state=null,t===rS?uS(e,C_):k_},FS=(e,t)=>{let n=t.length;if(NS(e))return T_;const r=e.state,s=r.wrap;if(2===s||1===s&&r.status!==Q_||r.lookahead)return T_;if(1===s&&(e.adler=a_(e.adler,t,n,0)),r.wrap=0,n>=r.w_size){0===s&&(dS(r.head),r.strstart=0,r.block_start=0,r.insert=0);let e=new Uint8Array(r.w_size);e.set(t.subarray(n-r.w_size,n),0),t=e,n=r.w_size}const i=e.avail_in,o=e.next_in,a=e.input;e.avail_in=n,e.next_in=0,e.input=t,_S(r);while(r.lookahead>=G_){let e=r.strstart,t=r.lookahead-(G_-1);do{r.ins_h=gS(r,r.ins_h,r.window[e+G_-1]),r.prev[e&r.w_mask]=r.head[r.ins_h],r.head[r.ins_h]=e,e++}while(--t);r.strstart=e,r.lookahead=G_-1,_S(r)}return r.strstart+=r.lookahead,r.block_start=r.strstart,r.insert=r.lookahead,r.lookahead=0,r.match_length=r.prev_length=G_-1,r.match_available=0,e.next_in=o,e.input=a,e.avail_in=i,r.wrap=s,k_};var jS=BS,zS=MS,$S=PS,HS=DS,KS=LS,qS=US,GS=VS,WS=FS,YS="pako deflate (from Nodeca project)",JS={deflateInit:jS,deflateInit2:zS,deflateReset:$S,deflateResetKeep:HS,deflateSetHeader:KS,deflate:qS,deflateEnd:GS,deflateSetDictionary:WS,deflateInfo:YS};const QS=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var XS=function(e){const t=Array.prototype.slice.call(arguments,1);while(t.length){const n=t.shift();if(n){if("object"!==typeof n)throw new TypeError(n+"must be non-object");for(const t in n)QS(n,t)&&(e[t]=n[t])}}return e},ZS=e=>{let t=0;for(let r=0,s=e.length;r<s;r++)t+=e[r].length;const n=new Uint8Array(t);for(let r=0,s=0,i=e.length;r<i;r++){let t=e[r];n.set(t,s),s+=t.length}return n},ek={assign:XS,flattenChunks:ZS};let tk=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(H6){tk=!1}const nk=new Uint8Array(256);for(let K6=0;K6<256;K6++)nk[K6]=K6>=252?6:K6>=248?5:K6>=240?4:K6>=224?3:K6>=192?2:1;nk[254]=nk[254]=1;var rk=e=>{if("function"===typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,n,r,s,i,o=e.length,a=0;for(s=0;s<o;s++)n=e.charCodeAt(s),55296===(64512&n)&&s+1<o&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Uint8Array(a),i=0,s=0;i<a;s++)n=e.charCodeAt(s),55296===(64512&n)&&s+1<o&&(r=e.charCodeAt(s+1),56320===(64512&r)&&(n=65536+(n-55296<<10)+(r-56320),s++)),n<128?t[i++]=n:n<2048?(t[i++]=192|n>>>6,t[i++]=128|63&n):n<65536?(t[i++]=224|n>>>12,t[i++]=128|n>>>6&63,t[i++]=128|63&n):(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63,t[i++]=128|n>>>6&63,t[i++]=128|63&n);return t};const sk=(e,t)=>{if(t<65534&&e.subarray&&tk)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let n="";for(let r=0;r<t;r++)n+=String.fromCharCode(e[r]);return n};var ik=(e,t)=>{const n=t||e.length;if("function"===typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let r,s;const i=new Array(2*n);for(s=0,r=0;r<n;){let t=e[r++];if(t<128){i[s++]=t;continue}let o=nk[t];if(o>4)i[s++]=65533,r+=o-1;else{t&=2===o?31:3===o?15:7;while(o>1&&r<n)t=t<<6|63&e[r++],o--;o>1?i[s++]=65533:t<65536?i[s++]=t:(t-=65536,i[s++]=55296|t>>10&1023,i[s++]=56320|1023&t)}}return sk(i,s)},ok=(e,t)=>{t=t||e.length,t>e.length&&(t=e.length);let n=t-1;while(n>=0&&128===(192&e[n]))n--;return n<0||0===n?t:n+nk[e[n]]>t?n:t},ak={string2buf:rk,buf2string:ik,utf8border:ok};function ck(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}var lk=ck;const uk=Object.prototype.toString,{Z_NO_FLUSH:hk,Z_SYNC_FLUSH:dk,Z_FULL_FLUSH:pk,Z_FINISH:fk,Z_OK:gk,Z_STREAM_END:mk,Z_DEFAULT_COMPRESSION:yk,Z_DEFAULT_STRATEGY:wk,Z_DEFLATED:bk}=p_;function vk(e){this.options=ek.assign({level:yk,method:bk,chunkSize:16384,windowBits:15,memLevel:8,strategy:wk},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lk,this.strm.avail_out=0;let n=JS.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==gk)throw new Error(d_[n]);if(t.header&&JS.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"===typeof t.dictionary?ak.string2buf(t.dictionary):"[object ArrayBuffer]"===uk.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,n=JS.deflateSetDictionary(this.strm,e),n!==gk)throw new Error(d_[n]);this._dict_set=!0}}function Ek(e,t){const n=new vk(t);if(n.push(e,!0),n.err)throw n.msg||d_[n.err];return n.result}function _k(e,t){return t=t||{},t.raw=!0,Ek(e,t)}function Sk(e,t){return t=t||{},t.gzip=!0,Ek(e,t)}vk.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize;let s,i;if(this.ended)return!1;for(i=t===~~t?t:!0===t?fk:hk,"string"===typeof e?n.input=ak.string2buf(e):"[object ArrayBuffer]"===uk.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;)if(0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),(i===dk||i===pk)&&n.avail_out<=6)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else{if(s=JS.deflate(n,i),s===mk)return n.next_out>0&&this.onData(n.output.subarray(0,n.next_out)),s=JS.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===gk;if(0!==n.avail_out){if(i>0&&n.next_out>0)this.onData(n.output.subarray(0,n.next_out)),n.avail_out=0;else if(0===n.avail_in)break}else this.onData(n.output)}return!0},vk.prototype.onData=function(e){this.chunks.push(e)},vk.prototype.onEnd=function(e){e===gk&&(this.result=ek.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var kk=vk,Ak=Ek,Tk=_k,Ck=Sk,Ik=p_,Rk={Deflate:kk,deflate:Ak,deflateRaw:Tk,gzip:Ck,constants:Ik};const Ok=16209,xk=16191;var Nk=function(e,t){let n,r,s,i,o,a,c,l,u,h,d,p,f,g,m,y,w,b,v,E,_,S,k,A;const T=e.state;n=e.next_in,k=e.input,r=n+(e.avail_in-5),s=e.next_out,A=e.output,i=s-(t-e.avail_out),o=s+(e.avail_out-257),a=T.dmax,c=T.wsize,l=T.whave,u=T.wnext,h=T.window,d=T.hold,p=T.bits,f=T.lencode,g=T.distcode,m=(1<<T.lenbits)-1,y=(1<<T.distbits)-1;e:do{p<15&&(d+=k[n++]<<p,p+=8,d+=k[n++]<<p,p+=8),w=f[d&m];t:for(;;){if(b=w>>>24,d>>>=b,p-=b,b=w>>>16&255,0===b)A[s++]=65535&w;else{if(!(16&b)){if(0===(64&b)){w=f[(65535&w)+(d&(1<<b)-1)];continue t}if(32&b){T.mode=xk;break e}e.msg="invalid literal/length code",T.mode=Ok;break e}v=65535&w,b&=15,b&&(p<b&&(d+=k[n++]<<p,p+=8),v+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=k[n++]<<p,p+=8,d+=k[n++]<<p,p+=8),w=g[d&y];n:for(;;){if(b=w>>>24,d>>>=b,p-=b,b=w>>>16&255,!(16&b)){if(0===(64&b)){w=g[(65535&w)+(d&(1<<b)-1)];continue n}e.msg="invalid distance code",T.mode=Ok;break e}if(E=65535&w,b&=15,p<b&&(d+=k[n++]<<p,p+=8,p<b&&(d+=k[n++]<<p,p+=8)),E+=d&(1<<b)-1,E>a){e.msg="invalid distance too far back",T.mode=Ok;break e}if(d>>>=b,p-=b,b=s-i,E>b){if(b=E-b,b>l&&T.sane){e.msg="invalid distance too far back",T.mode=Ok;break e}if(_=0,S=h,0===u){if(_+=c-b,b<v){v-=b;do{A[s++]=h[_++]}while(--b);_=s-E,S=A}}else if(u<b){if(_+=c+u-b,b-=u,b<v){v-=b;do{A[s++]=h[_++]}while(--b);if(_=0,u<v){b=u,v-=b;do{A[s++]=h[_++]}while(--b);_=s-E,S=A}}}else if(_+=u-b,b<v){v-=b;do{A[s++]=h[_++]}while(--b);_=s-E,S=A}while(v>2)A[s++]=S[_++],A[s++]=S[_++],A[s++]=S[_++],v-=3;v&&(A[s++]=S[_++],v>1&&(A[s++]=S[_++]))}else{_=s-E;do{A[s++]=A[_++],A[s++]=A[_++],A[s++]=A[_++],v-=3}while(v>2);v&&(A[s++]=A[_++],v>1&&(A[s++]=A[_++]))}break}}break}}while(n<r&&s<o);v=p>>3,n-=v,p-=v<<3,d&=(1<<p)-1,e.next_in=n,e.next_out=s,e.avail_in=n<r?r-n+5:5-(n-r),e.avail_out=s<o?o-s+257:257-(s-o),T.hold=d,T.bits=p};const Dk=15,Pk=852,Lk=592,Mk=0,Bk=1,Uk=2,Vk=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Fk=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),jk=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),zk=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),$k=(e,t,n,r,s,i,o,a)=>{const c=a.bits;let l,u,h,d,p,f,g=0,m=0,y=0,w=0,b=0,v=0,E=0,_=0,S=0,k=0,A=null;const T=new Uint16Array(Dk+1),C=new Uint16Array(Dk+1);let I,R,O,x=null;for(g=0;g<=Dk;g++)T[g]=0;for(m=0;m<r;m++)T[t[n+m]]++;for(b=c,w=Dk;w>=1;w--)if(0!==T[w])break;if(b>w&&(b=w),0===w)return s[i++]=20971520,s[i++]=20971520,a.bits=1,0;for(y=1;y<w;y++)if(0!==T[y])break;for(b<y&&(b=y),_=1,g=1;g<=Dk;g++)if(_<<=1,_-=T[g],_<0)return-1;if(_>0&&(e===Mk||1!==w))return-1;for(C[1]=0,g=1;g<Dk;g++)C[g+1]=C[g]+T[g];for(m=0;m<r;m++)0!==t[n+m]&&(o[C[t[n+m]]++]=m);if(e===Mk?(A=x=o,f=20):e===Bk?(A=Vk,x=Fk,f=257):(A=jk,x=zk,f=0),k=0,m=0,g=y,p=i,v=b,E=0,h=-1,S=1<<b,d=S-1,e===Bk&&S>Pk||e===Uk&&S>Lk)return 1;for(;;){I=g-E,o[m]+1<f?(R=0,O=o[m]):o[m]>=f?(R=x[o[m]-f],O=A[o[m]-f]):(R=96,O=0),l=1<<g-E,u=1<<v,y=u;do{u-=l,s[p+(k>>E)+u]=I<<24|R<<16|O|0}while(0!==u);l=1<<g-1;while(k&l)l>>=1;if(0!==l?(k&=l-1,k+=l):k=0,m++,0===--T[g]){if(g===w)break;g=t[n+o[m]]}if(g>b&&(k&d)!==h){0===E&&(E=b),p+=y,v=g-E,_=1<<v;while(v+E<w){if(_-=T[v+E],_<=0)break;v++,_<<=1}if(S+=1<<v,e===Bk&&S>Pk||e===Uk&&S>Lk)return 1;h=k&d,s[h]=b<<24|v<<16|p-i|0}}return 0!==k&&(s[p+k]=g-E<<24|64<<16|0),a.bits=b,0};var Hk=$k;const Kk=0,qk=1,Gk=2,{Z_FINISH:Wk,Z_BLOCK:Yk,Z_TREES:Jk,Z_OK:Qk,Z_STREAM_END:Xk,Z_NEED_DICT:Zk,Z_STREAM_ERROR:eA,Z_DATA_ERROR:tA,Z_MEM_ERROR:nA,Z_BUF_ERROR:rA,Z_DEFLATED:sA}=p_,iA=16180,oA=16181,aA=16182,cA=16183,lA=16184,uA=16185,hA=16186,dA=16187,pA=16188,fA=16189,gA=16190,mA=16191,yA=16192,wA=16193,bA=16194,vA=16195,EA=16196,_A=16197,SA=16198,kA=16199,AA=16200,TA=16201,CA=16202,IA=16203,RA=16204,OA=16205,xA=16206,NA=16207,DA=16208,PA=16209,LA=16210,MA=16211,BA=852,UA=592,VA=15,FA=VA,jA=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function zA(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const $A=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<iA||t.mode>MA?1:0},HA=e=>{if($A(e))return eA;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=iA,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(BA),t.distcode=t.distdyn=new Int32Array(UA),t.sane=1,t.back=-1,Qk},KA=e=>{if($A(e))return eA;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,HA(e)},qA=(e,t)=>{let n;if($A(e))return eA;const r=e.state;return t<0?(n=0,t=-t):(n=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?eA:(null!==r.window&&r.wbits!==t&&(r.window=null),r.wrap=n,r.wbits=t,KA(e))},GA=(e,t)=>{if(!e)return eA;const n=new zA;e.state=n,n.strm=e,n.window=null,n.mode=iA;const r=qA(e,t);return r!==Qk&&(e.state=null),r},WA=e=>GA(e,FA);let YA,JA,QA=!0;const XA=e=>{if(QA){YA=new Int32Array(512),JA=new Int32Array(32);let t=0;while(t<144)e.lens[t++]=8;while(t<256)e.lens[t++]=9;while(t<280)e.lens[t++]=7;while(t<288)e.lens[t++]=8;Hk(qk,e.lens,0,288,YA,0,e.work,{bits:9}),t=0;while(t<32)e.lens[t++]=5;Hk(Gk,e.lens,0,32,JA,0,e.work,{bits:5}),QA=!1}e.lencode=YA,e.lenbits=9,e.distcode=JA,e.distbits=5},ZA=(e,t,n,r)=>{let s;const i=e.state;return null===i.window&&(i.wsize=1<<i.wbits,i.wnext=0,i.whave=0,i.window=new Uint8Array(i.wsize)),r>=i.wsize?(i.window.set(t.subarray(n-i.wsize,n),0),i.wnext=0,i.whave=i.wsize):(s=i.wsize-i.wnext,s>r&&(s=r),i.window.set(t.subarray(n-r,n-r+s),i.wnext),r-=s,r?(i.window.set(t.subarray(n-r,n),0),i.wnext=r,i.whave=i.wsize):(i.wnext+=s,i.wnext===i.wsize&&(i.wnext=0),i.whave<i.wsize&&(i.whave+=s))),0},eT=(e,t)=>{let n,r,s,i,o,a,c,l,u,h,d,p,f,g,m,y,w,b,v,E,_,S,k=0;const A=new Uint8Array(4);let T,C;const I=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if($A(e)||!e.output||!e.input&&0!==e.avail_in)return eA;n=e.state,n.mode===mA&&(n.mode=yA),o=e.next_out,s=e.output,c=e.avail_out,i=e.next_in,r=e.input,a=e.avail_in,l=n.hold,u=n.bits,h=a,d=c,S=Qk;e:for(;;)switch(n.mode){case iA:if(0===n.wrap){n.mode=yA;break}while(u<16){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(2&n.wrap&&35615===l){0===n.wbits&&(n.wbits=15),n.check=0,A[0]=255&l,A[1]=l>>>8&255,n.check=h_(n.check,A,2,0),l=0,u=0,n.mode=oA;break}if(n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&l)<<8)+(l>>8))%31){e.msg="incorrect header check",n.mode=PA;break}if((15&l)!==sA){e.msg="unknown compression method",n.mode=PA;break}if(l>>>=4,u-=4,_=8+(15&l),0===n.wbits&&(n.wbits=_),_>15||_>n.wbits){e.msg="invalid window size",n.mode=PA;break}n.dmax=1<<n.wbits,n.flags=0,e.adler=n.check=1,n.mode=512&l?fA:mA,l=0,u=0;break;case oA:while(u<16){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(n.flags=l,(255&n.flags)!==sA){e.msg="unknown compression method",n.mode=PA;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=PA;break}n.head&&(n.head.text=l>>8&1),512&n.flags&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,n.check=h_(n.check,A,2,0)),l=0,u=0,n.mode=aA;case aA:while(u<32){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}n.head&&(n.head.time=l),512&n.flags&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,A[2]=l>>>16&255,A[3]=l>>>24&255,n.check=h_(n.check,A,4,0)),l=0,u=0,n.mode=cA;case cA:while(u<16){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}n.head&&(n.head.xflags=255&l,n.head.os=l>>8),512&n.flags&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,n.check=h_(n.check,A,2,0)),l=0,u=0,n.mode=lA;case lA:if(1024&n.flags){while(u<16){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}n.length=l,n.head&&(n.head.extra_len=l),512&n.flags&&4&n.wrap&&(A[0]=255&l,A[1]=l>>>8&255,n.check=h_(n.check,A,2,0)),l=0,u=0}else n.head&&(n.head.extra=null);n.mode=uA;case uA:if(1024&n.flags&&(p=n.length,p>a&&(p=a),p&&(n.head&&(_=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Uint8Array(n.head.extra_len)),n.head.extra.set(r.subarray(i,i+p),_)),512&n.flags&&4&n.wrap&&(n.check=h_(n.check,r,p,i)),a-=p,i+=p,n.length-=p),n.length))break e;n.length=0,n.mode=hA;case hA:if(2048&n.flags){if(0===a)break e;p=0;do{_=r[i+p++],n.head&&_&&n.length<65536&&(n.head.name+=String.fromCharCode(_))}while(_&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=h_(n.check,r,p,i)),a-=p,i+=p,_)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=dA;case dA:if(4096&n.flags){if(0===a)break e;p=0;do{_=r[i+p++],n.head&&_&&n.length<65536&&(n.head.comment+=String.fromCharCode(_))}while(_&&p<a);if(512&n.flags&&4&n.wrap&&(n.check=h_(n.check,r,p,i)),a-=p,i+=p,_)break e}else n.head&&(n.head.comment=null);n.mode=pA;case pA:if(512&n.flags){while(u<16){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(4&n.wrap&&l!==(65535&n.check)){e.msg="header crc mismatch",n.mode=PA;break}l=0,u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=mA;break;case fA:while(u<32){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}e.adler=n.check=jA(l),l=0,u=0,n.mode=gA;case gA:if(0===n.havedict)return e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=a,n.hold=l,n.bits=u,Zk;e.adler=n.check=1,n.mode=mA;case mA:if(t===Yk||t===Jk)break e;case yA:if(n.last){l>>>=7&u,u-=7&u,n.mode=xA;break}while(u<3){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}switch(n.last=1&l,l>>>=1,u-=1,3&l){case 0:n.mode=wA;break;case 1:if(XA(n),n.mode=kA,t===Jk){l>>>=2,u-=2;break e}break;case 2:n.mode=EA;break;case 3:e.msg="invalid block type",n.mode=PA}l>>>=2,u-=2;break;case wA:l>>>=7&u,u-=7&u;while(u<32){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if((65535&l)!==(l>>>16^65535)){e.msg="invalid stored block lengths",n.mode=PA;break}if(n.length=65535&l,l=0,u=0,n.mode=bA,t===Jk)break e;case bA:n.mode=vA;case vA:if(p=n.length,p){if(p>a&&(p=a),p>c&&(p=c),0===p)break e;s.set(r.subarray(i,i+p),o),a-=p,i+=p,c-=p,o+=p,n.length-=p;break}n.mode=mA;break;case EA:while(u<14){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(n.nlen=257+(31&l),l>>>=5,u-=5,n.ndist=1+(31&l),l>>>=5,u-=5,n.ncode=4+(15&l),l>>>=4,u-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=PA;break}n.have=0,n.mode=_A;case _A:while(n.have<n.ncode){while(u<3){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}n.lens[I[n.have++]]=7&l,l>>>=3,u-=3}while(n.have<19)n.lens[I[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,T={bits:n.lenbits},S=Hk(Kk,n.lens,0,19,n.lencode,0,n.work,T),n.lenbits=T.bits,S){e.msg="invalid code lengths set",n.mode=PA;break}n.have=0,n.mode=SA;case SA:while(n.have<n.nlen+n.ndist){for(;;){if(k=n.lencode[l&(1<<n.lenbits)-1],m=k>>>24,y=k>>>16&255,w=65535&k,m<=u)break;if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(w<16)l>>>=m,u-=m,n.lens[n.have++]=w;else{if(16===w){C=m+2;while(u<C){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(l>>>=m,u-=m,0===n.have){e.msg="invalid bit length repeat",n.mode=PA;break}_=n.lens[n.have-1],p=3+(3&l),l>>>=2,u-=2}else if(17===w){C=m+3;while(u<C){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}l>>>=m,u-=m,_=0,p=3+(7&l),l>>>=3,u-=3}else{C=m+7;while(u<C){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}l>>>=m,u-=m,_=0,p=11+(127&l),l>>>=7,u-=7}if(n.have+p>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=PA;break}while(p--)n.lens[n.have++]=_}}if(n.mode===PA)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=PA;break}if(n.lenbits=9,T={bits:n.lenbits},S=Hk(qk,n.lens,0,n.nlen,n.lencode,0,n.work,T),n.lenbits=T.bits,S){e.msg="invalid literal/lengths set",n.mode=PA;break}if(n.distbits=6,n.distcode=n.distdyn,T={bits:n.distbits},S=Hk(Gk,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,T),n.distbits=T.bits,S){e.msg="invalid distances set",n.mode=PA;break}if(n.mode=kA,t===Jk)break e;case kA:n.mode=AA;case AA:if(a>=6&&c>=258){e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=a,n.hold=l,n.bits=u,Nk(e,d),o=e.next_out,s=e.output,c=e.avail_out,i=e.next_in,r=e.input,a=e.avail_in,l=n.hold,u=n.bits,n.mode===mA&&(n.back=-1);break}for(n.back=0;;){if(k=n.lencode[l&(1<<n.lenbits)-1],m=k>>>24,y=k>>>16&255,w=65535&k,m<=u)break;if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(y&&0===(240&y)){for(b=m,v=y,E=w;;){if(k=n.lencode[E+((l&(1<<b+v)-1)>>b)],m=k>>>24,y=k>>>16&255,w=65535&k,b+m<=u)break;if(0===a)break e;a--,l+=r[i++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=m,u-=m,n.back+=m,n.length=w,0===y){n.mode=OA;break}if(32&y){n.back=-1,n.mode=mA;break}if(64&y){e.msg="invalid literal/length code",n.mode=PA;break}n.extra=15&y,n.mode=TA;case TA:if(n.extra){C=n.extra;while(u<C){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}n.length+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=CA;case CA:for(;;){if(k=n.distcode[l&(1<<n.distbits)-1],m=k>>>24,y=k>>>16&255,w=65535&k,m<=u)break;if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(0===(240&y)){for(b=m,v=y,E=w;;){if(k=n.distcode[E+((l&(1<<b+v)-1)>>b)],m=k>>>24,y=k>>>16&255,w=65535&k,b+m<=u)break;if(0===a)break e;a--,l+=r[i++]<<u,u+=8}l>>>=b,u-=b,n.back+=b}if(l>>>=m,u-=m,n.back+=m,64&y){e.msg="invalid distance code",n.mode=PA;break}n.offset=w,n.extra=15&y,n.mode=IA;case IA:if(n.extra){C=n.extra;while(u<C){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}n.offset+=l&(1<<n.extra)-1,l>>>=n.extra,u-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=PA;break}n.mode=RA;case RA:if(0===c)break e;if(p=d-c,n.offset>p){if(p=n.offset-p,p>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=PA;break}p>n.wnext?(p-=n.wnext,f=n.wsize-p):f=n.wnext-p,p>n.length&&(p=n.length),g=n.window}else g=s,f=o-n.offset,p=n.length;p>c&&(p=c),c-=p,n.length-=p;do{s[o++]=g[f++]}while(--p);0===n.length&&(n.mode=AA);break;case OA:if(0===c)break e;s[o++]=n.length,c--,n.mode=AA;break;case xA:if(n.wrap){while(u<32){if(0===a)break e;a--,l|=r[i++]<<u,u+=8}if(d-=c,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?h_(n.check,s,d,o-d):a_(n.check,s,d,o-d)),d=c,4&n.wrap&&(n.flags?l:jA(l))!==n.check){e.msg="incorrect data check",n.mode=PA;break}l=0,u=0}n.mode=NA;case NA:if(n.wrap&&n.flags){while(u<32){if(0===a)break e;a--,l+=r[i++]<<u,u+=8}if(4&n.wrap&&l!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=PA;break}l=0,u=0}n.mode=DA;case DA:S=Xk;break e;case PA:S=tA;break e;case LA:return nA;case MA:default:return eA}return e.next_out=o,e.avail_out=c,e.next_in=i,e.avail_in=a,n.hold=l,n.bits=u,(n.wsize||d!==e.avail_out&&n.mode<PA&&(n.mode<xA||t!==Wk))&&ZA(e,e.output,e.next_out,d-e.avail_out),h-=e.avail_in,d-=e.avail_out,e.total_in+=h,e.total_out+=d,n.total+=d,4&n.wrap&&d&&(e.adler=n.check=n.flags?h_(n.check,s,d,e.next_out-d):a_(n.check,s,d,e.next_out-d)),e.data_type=n.bits+(n.last?64:0)+(n.mode===mA?128:0)+(n.mode===kA||n.mode===bA?256:0),(0===h&&0===d||t===Wk)&&S===Qk&&(S=rA),S},tT=e=>{if($A(e))return eA;let t=e.state;return t.window&&(t.window=null),e.state=null,Qk},nT=(e,t)=>{if($A(e))return eA;const n=e.state;return 0===(2&n.wrap)?eA:(n.head=t,t.done=!1,Qk)},rT=(e,t)=>{const n=t.length;let r,s,i;return $A(e)?eA:(r=e.state,0!==r.wrap&&r.mode!==gA?eA:r.mode===gA&&(s=1,s=a_(s,t,n,0),s!==r.check)?tA:(i=ZA(e,t,n,n),i?(r.mode=LA,nA):(r.havedict=1,Qk)))};var sT=KA,iT=qA,oT=HA,aT=WA,cT=GA,lT=eT,uT=tT,hT=nT,dT=rT,pT="pako inflate (from Nodeca project)",fT={inflateReset:sT,inflateReset2:iT,inflateResetKeep:oT,inflateInit:aT,inflateInit2:cT,inflate:lT,inflateEnd:uT,inflateGetHeader:hT,inflateSetDictionary:dT,inflateInfo:pT};function gT(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var mT=gT;const yT=Object.prototype.toString,{Z_NO_FLUSH:wT,Z_FINISH:bT,Z_OK:vT,Z_STREAM_END:ET,Z_NEED_DICT:_T,Z_STREAM_ERROR:ST,Z_DATA_ERROR:kT,Z_MEM_ERROR:AT}=p_;function TT(e){this.options=ek.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0===(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lk,this.strm.avail_out=0;let n=fT.inflateInit2(this.strm,t.windowBits);if(n!==vT)throw new Error(d_[n]);if(this.header=new mT,fT.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"===typeof t.dictionary?t.dictionary=ak.string2buf(t.dictionary):"[object ArrayBuffer]"===yT.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(n=fT.inflateSetDictionary(this.strm,t.dictionary),n!==vT)))throw new Error(d_[n])}function CT(e,t){const n=new TT(t);if(n.push(e),n.err)throw n.msg||d_[n.err];return n.result}function IT(e,t){return t=t||{},t.raw=!0,CT(e,t)}TT.prototype.push=function(e,t){const n=this.strm,r=this.options.chunkSize,s=this.options.dictionary;let i,o,a;if(this.ended)return!1;for(o=t===~~t?t:!0===t?bT:wT,"[object ArrayBuffer]"===yT.call(e)?n.input=new Uint8Array(e):n.input=e,n.next_in=0,n.avail_in=n.input.length;;){0===n.avail_out&&(n.output=new Uint8Array(r),n.next_out=0,n.avail_out=r),i=fT.inflate(n,o),i===_T&&s&&(i=fT.inflateSetDictionary(n,s),i===vT?i=fT.inflate(n,o):i===kT&&(i=_T));while(n.avail_in>0&&i===ET&&n.state.wrap>0&&0!==e[n.next_in])fT.inflateReset(n),i=fT.inflate(n,o);switch(i){case ST:case kT:case _T:case AT:return this.onEnd(i),this.ended=!0,!1}if(a=n.avail_out,n.next_out&&(0===n.avail_out||i===ET))if("string"===this.options.to){let e=ak.utf8border(n.output,n.next_out),t=n.next_out-e,s=ak.buf2string(n.output,e);n.next_out=t,n.avail_out=r-t,t&&n.output.set(n.output.subarray(e,e+t),0),this.onData(s)}else this.onData(n.output.length===n.next_out?n.output:n.output.subarray(0,n.next_out));if(i!==vT||0!==a){if(i===ET)return i=fT.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,!0;if(0===n.avail_in)break}}return!0},TT.prototype.onData=function(e){this.chunks.push(e)},TT.prototype.onEnd=function(e){e===vT&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=ek.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var RT=TT,OT=CT,xT=IT,NT=CT,DT=p_,PT={Inflate:RT,inflate:OT,inflateRaw:xT,ungzip:NT,constants:DT};const{Deflate:LT,deflate:MT,deflateRaw:BT,gzip:UT}=Rk,{Inflate:VT,inflate:FT,inflateRaw:jT,ungzip:zT}=PT;var $T=LT,HT=MT,KT=BT,qT=UT,GT=VT,WT=FT,YT=jT,JT=zT,QT=p_,XT={Deflate:$T,deflate:HT,deflateRaw:KT,gzip:qT,Inflate:GT,inflate:WT,inflateRaw:YT,ungzip:JT,constants:QT};const ZT=6;function eC({repo:e,preload:t}){async function*n(n,r={}){if(null!=r.compressionLevel&&(r.compressionLevel<-1||r.compressionLevel>9))throw je(new Error("Compression level must be between -1 and 9"),"ERR_INVALID_PARAMS");if(!1!==r.preload){let e;try{e=El(n).split("/")}catch(uS){throw je(uS,"ERR_INVALID_PATH")}t(Lt.parse(e[0]))}const s=Lt.asCID(n)||n,i=await lv(s,e.blocks,r);if("file"===i.type||"raw"===i.type){const e=[];return r.compress&&!0!==r.archive?e.push(i.content):e.push([{header:{name:i.path,mode:"file"===i.type&&i.unixfs.mode,mtime:"file"===i.type&&i.unixfs.mtime?new Date(1e3*i.unixfs.mtime.secs):void 0,size:i.size,type:"file"},body:i.content()}],zv()),r.compress&&e.push((async function*(e){const t=await fv(e);yield XT.gzip(t,{level:r.compressionLevel||ZT})})),void(yield*vm(...e))}if("directory"!==i.type)throw je(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");{const t=[uv(s,e.blocks,r),async function*(e){for await(const t of e){const e={header:{name:t.path,size:t.size}};if("file"===t.type)e.header.type="file",e.header.mode=null!=t.unixfs.mode?t.unixfs.mode:void 0,e.header.mtime=t.unixfs.mtime?new Date(1e3*t.unixfs.mtime.secs):void 0,e.body=t.content();else if("raw"===t.type)e.header.type="file",e.body=t.content();else{if("directory"!==t.type)throw je(new Error("Not a UnixFS node"),"ERR_NOT_UNIXFS");e.header.type="directory",e.header.mode=null!=t.unixfs.mode?t.unixfs.mode:void 0,e.header.mtime=t.unixfs.mtime?new Date(1e3*t.unixfs.mtime.secs):void 0}yield e}},zv()];if(r.compress){if(!r.archive)throw je(new Error("file is not regular"),"ERR_INVALID_PATH");r.compress&&t.push((async function*(e){const t=await fv(e);yield XT.gzip(t,{level:r.compressionLevel||ZT})}))}yield*vm(...t)}}return pl(n)}function tC({repo:e,preload:t}){async function*n(n,r={}){const s=El(n),i=s.split("/");!1!==r.preload&&t(Lt.parse(i[0]));const o=Lt.asCID(s)||s,a=await lv(o,e.blocks,r);if("file"!==a.type){if("directory"!==a.type)throw je(new Error(`Unknown UnixFS type ${a.type}`),"ERR_UNKNOWN_UNIXFS_TYPE");for await(const e of a.content())yield Sl(e)}else yield Sl(a)}return pl(n)}class nC{constructor({preload:e,repo:t,hashers:n,options:r}){const s=Sb({preload:e,repo:t,options:r,hashers:n});this.addAll=s,this.add=Gy({addAll:s}),this.cat=hv({repo:t,preload:e}),this.get=eC({repo:t,preload:e}),this.ls=tC({repo:t,preload:e})}}const rC="0.17.0",sC="e8b7b66bfa98c2a1c0d0bfc19f698d7d00b6c888",iC="^0.157.0";function oC({repo:e}){async function t(t={}){const n=await e.version.get();return{version:rC,commit:sC,repo:`${n}`,"ipfs-core":rC,"interface-ipfs-core":iC}}return pl(t)}const aC=Fe("ipfs:components:id");function cC({peerId:e,network:t}){async function n(n={}){const r=t.try();if(!r){if(n.peerId)throw new xo;if(null==e.publicKey)throw je(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");return{id:e,publicKey:ia(e.publicKey,"base64pad"),addresses:[],agentVersion:`js-ipfs/${rC}`,protocolVersion:"9000",protocols:[]}}const{libp2p:s}=r,i=n.peerId?n.peerId:e,o=await lC(i,s,n),a=ia(o.metadata.get("AgentVersion")||new Uint8Array),c=ia(o.metadata.get("ProtocolVersion")||new Uint8Array),l=o.id.toString(),u=o.publicKey?ia(o.publicKey,"base64pad"):"";return{id:i,publicKey:u,addresses:(o.addresses||[]).map((e=>{const t=e.toString();return t.endsWith(`/p2p/${l}`)?t:`${t}/p2p/${l}`})).sort().map((e=>dc(e))),agentVersion:a,protocolVersion:c,protocols:(o.protocols||[]).sort()}}return pl(n)}async function lC(e,t,n){let r=await t.peerStore.get(e);r||(r=await uC(e,t,n));let s=e.publicKey?e.publicKey:await t.peerStore.keyBook.get(e);if(null==s)try{s=await t.getPublicKey(e,n)}catch(uS){aC.error("Could not load public key for",e.toString(),uS)}return{...r,publicKey:s,metadata:r.metadata||new Map,addresses:r.addresses.map((e=>e.multiaddr))}}async function uC(e,t,n){if(null==t.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");for await(const s of t.dht.findPeer(e,n))if("FINAL_PEER"===s.name)break;const r=await t.peerStore.get(e);if(!r)throw je(new Error("Could not find peer"),"ERR_NOT_FOUND");return r}var hC=dC;function dC(e,t,n){var r,s,i;if(Array.isArray(t)&&(r=t.slice(0)),"string"==typeof t&&(r=t.split(".")),"symbol"==typeof t&&(r=[t]),!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");if(s=r.pop(),!s)return!1;pC(s);while(i=r.shift())if(pC(i),"undefined"==typeof e[i]&&(e[i]={}),e=e[i],!e||"object"!=typeof e)return!1;return e[s]=n,!0}function pC(e){if("__proto__"==e||"constructor"==e||"prototype"==e)throw new Error("setting of prototype values not supported")}const fC={server:{description:"Recommended for nodes with public IPv4 address (servers, VPSes, etc.), disables host and content discovery and UPnP in local networks.",transform:e=>(hC(e,"Discovery.MDNS.Enabled",!1),hC(e,"Discovery.webRTCStar.Enabled",!1),e.Swarm={...e.Swarm||{},DisableNatPortMap:!0},e)},"local-discovery":{description:"Sets default values to fields affected by `server` profile, enables discovery and UPnP in local networks.",transform:e=>(hC(e,"Discovery.MDNS.Enabled",!0),hC(e,"Discovery.webRTCStar.Enabled",!0),hC(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!1}),e)},test:{description:"Reduces external interference, useful for running ipfs in test environments. Note that with these settings node won't be able to talk to the rest of the network without manual bootstrap.",transform:e=>{const t=by();return hC(e,"Addresses.API",t.Addresses.API?"/ip4/127.0.0.1/tcp/0":""),hC(e,"Addresses.Gateway",t.Addresses.Gateway?"/ip4/127.0.0.1/tcp/0":""),hC(e,"Addresses.Swarm",t.Addresses.Swarm.length?["/ip4/127.0.0.1/tcp/0"]:[]),hC(e,"Addresses.Delegates",[]),hC(e,"Bootstrap",[]),hC(e,"Discovery.MDNS.Enabled",!1),hC(e,"Discovery.webRTCStar.Enabled",!1),hC(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!0}),e}},"default-networking":{description:"Restores default network settings. Inverse profile of the `test` profile.",transform:e=>{const t=by();return hC(e,"Addresses.API",t.Addresses.API),hC(e,"Addresses.Gateway",t.Addresses.Gateway),hC(e,"Addresses.Swarm",t.Addresses.Swarm),hC(e,"Addresses.Delegates",t.Addresses.Delegates),hC(e,"Bootstrap",t.Bootstrap),hC(e,"Discovery.MDNS.Enabled",t.Discovery.MDNS.Enabled),hC(e,"Discovery.webRTCStar.Enabled",t.Discovery.webRTCStar.Enabled),hC(e,"Swarm",{...e.Swarm||{},DisableNatPortMap:!1}),e}},lowpower:{description:"Reduces daemon overhead on the system. May affect node functionality,performance of content discovery and data fetching may be degraded. Recommended for low power systems.",transform:e=>{const t=e.Swarm||{},n=t.ConnMgr||{};return n.LowWater=20,n.HighWater=40,t.ConnMgr=n,e.Swarm=t,e}},"default-power":{description:'Inverse of "lowpower" profile.',transform:e=>{const t=by();return e.Swarm=t.Swarm,e}}},gC=Fe("ipfs:core:config");function mC({repo:e}){return{getAll:pl(t),get:pl(n),set:pl(r),replace:pl(s),profiles:{apply:pl(i),list:pl(yC)}};async function t(t={}){return e.config.getAll(t)}async function n(t,n){return t?e.config.get(t,n):Promise.reject(new Error("key argument is required"))}async function r(t,n,r){return e.config.set(t,n,r)}async function s(t,n){return e.config.replace(t,n)}async function i(t,n={dryRun:!1}){const{dryRun:r}=n,s=fC[t];if(!s)throw new Error(`No profile with name '${t}' exists`);try{const t=await e.config.getAll(n);let i=JSON.parse(JSON.stringify(t));return i=s.transform(i),r||await e.config.replace(i,n),delete t.Identity.PrivKey,delete i.Identity.PrivKey,{original:t,updated:i}}catch(uS){throw gC(uS),new Error(`Could not apply profile '${t}' to config: ${uS.message}`)}}}async function yC(e){return Object.keys(fC).map((e=>({name:e,description:fC[e].description})))}function wC({enumerable:e=!0,configurable:t=!1}={}){return{enumerable:e,configurable:t,writable:!1}}function*bC(e,t){if(null!=t&&"object"===typeof t)if(Array.isArray(t))for(const[n,r]of t.entries()){const t=[...e,n],s=Lt.asCID(r);s?yield[t.join("/"),s]:"object"===typeof r&&(yield*vC(r,t))}else{const n=Lt.asCID(t);n?yield[e.join("/"),n]:yield*vC(t,e)}}function*vC(e,t){if(!(null==e||e instanceof Uint8Array))for(const[n,r]of Object.entries(e)){const e=[...t,n];yield*bC(e,r)}}function*EC(e,t){if(Array.isArray(t))for(const[n,r]of t.entries()){const t=[...e,n];yield t.join("/"),"object"!==typeof r||Lt.asCID(r)||(yield*_C(r,t))}else yield*_C(t,e)}function*_C(e,t){if(null!=e&&"object"===typeof e)for(const[n,r]of Object.entries(e)){const e=[...t,n];yield e.join("/"),null==r||r instanceof Uint8Array||"object"!==typeof r||Lt.asCID(r)||(yield*EC(e,r))}}function SC(e,t){let n=e;for(const[r,s]of t.entries()){if(n=n[s],null==n)throw new Error(`Object has no property at ${t.slice(0,r+1).map((e=>`[${JSON.stringify(e)}]`)).join("")}`);const e=Lt.asCID(n);if(e)return{value:e,remaining:t.slice(r+1).join("/")}}return{value:n}}class kC{constructor({cid:e,bytes:t,value:n}){if(!e||!t||"undefined"===typeof n)throw new Error("Missing required argument");this.cid=e,this.bytes=t,this.value=n,this.asBlock=this,Object.defineProperties(this,{cid:wC(),bytes:wC(),value:wC(),asBlock:wC()})}links(){return vC(this.value,[])}tree(){return _C(this.value,[])}get(e="/"){return SC(this.value,e.split("/").filter(Boolean))}}function AC({bytes:e,cid:t,value:n,codec:r}){const s=void 0!==n?n:r&&r.decode(e);if(void 0===s)throw new Error('Missing required argument, must either provide "value" or "codec"');return new kC({cid:t,bytes:e,value:s})}function TC(e){const t=Zs({version:1,roots:e}),n=ma.encode(t.length),r=new Uint8Array(n.length+t.length);return r.set(n,0),r.set(t,n.length),r}function CC(e){return{async setRoots(t){const n=TC(t);await e.write(n)},async writeBlock(t){const{cid:n,bytes:r}=t;await e.write(new Uint8Array(ma.encode(n.bytes.length+r.length))),await e.write(n.bytes),r.length&&await e.write(r)},async close(){await e.end()}}}function IC(){}function RC(){const e=[];let t=null,n=IC,r=!1,s=null,i=IC;const o=()=>(t||(t=new Promise((e=>{n=()=>{t=null,n=IC,e()}}))),t),a={write(t){e.push(t);const n=o();return i(),n},async end(){r=!0;const e=o();i(),await e}},c={async next(){const t=e.shift();return t?(0===e.length&&n(),{done:!1,value:t}):r?(n(),{done:!0,value:void 0}):(s||(s=new Promise((e=>{i=()=>(s=null,i=IC,e(c.next()))}))),s)}};return{writer:a,iterator:c}}const OC={Null:e=>null===e,Int:e=>Number.isInteger(e),Float:e=>"number"===typeof e&&Number.isFinite(e),String:e=>"string"===typeof e,Bool:e=>"boolean"===typeof e,Bytes:e=>e instanceof Uint8Array,Link:e=>!OC.Null(e)&&"object"===typeof e&&e.asCID===e,List:e=>Array.isArray(e),Map:e=>!OC.Null(e)&&"object"===typeof e&&e.asCID!==e&&!OC.List(e)&&!OC.Bytes(e)},xC={Int:OC.Int,"CarHeader > version":e=>xC.Int(e),"CarHeader > roots (anon) > valueType (anon)":OC.Link,"CarHeader > roots (anon)":e=>OC.List(e)&&Array.prototype.every.call(e,xC["CarHeader > roots (anon) > valueType (anon)"]),"CarHeader > roots":e=>xC["CarHeader > roots (anon)"](e),CarHeader:e=>{const t=e&&Object.keys(e);return OC.Map(e)&&["version"].every((e=>t.includes(e)))&&Object.entries(e).every((([e,t])=>xC["CarHeader > "+e]&&xC["CarHeader > "+e](t)))}},NC=xC.CarHeader,DC={SHA2_256:18,LENGTH:32,DAG_PB:112},PC=40;async function LC(e){const t=await e.upTo(8);if(!t.length)throw new Error("Unexpected end of data");const n=ma.decode(t);return e.seek(ma.decode.bytes),n}async function MC(e){const t=await e.exactly(PC),n=new DataView(t.buffer,t.byteOffset,t.byteLength);let r=0;const s={version:2,characteristics:[n.getBigUint64(r,!0),n.getBigUint64(r+=8,!0)],dataOffset:Number(n.getBigUint64(r+=8,!0)),dataSize:Number(n.getBigUint64(r+=8,!0)),indexOffset:Number(n.getBigUint64(r+=8,!0))};return e.seek(PC),s}async function BC(e,t){const n=await LC(e);if(0===n)throw new Error("Invalid CAR header (zero length)");const r=await e.exactly(n);e.seek(n);const s=ei(r);if(!NC(s))throw new Error("Invalid CAR header format");if(1!==s.version&&2!==s.version||void 0!==t&&s.version!==t)throw new Error(`Invalid CAR version: ${s.version}${void 0!==t?` (expected ${t})`:""}`);const i=Array.isArray(s.roots);if(1===s.version&&!i||2===s.version&&i)throw new Error("Invalid CAR header format");if(1===s.version)return s;const o=await MC(e);e.seek(o.dataOffset-e.pos);const a=await BC(e,1);return Object.assign(a,o)}async function UC(e){const t=await e.upTo(8);ma.decode(t);const n=ma.decode.bytes,r=ma.decode(t.subarray(ma.decode.bytes)),s=ma.decode.bytes,i=n+s+r,o=await e.exactly(i);return e.seek(i),o}async function VC(e){const t=await e.exactly(2);if(t[0]===DC.SHA2_256&&t[1]===DC.LENGTH){const t=await e.exactly(34);e.seek(34);const n=Rt(t);return Lt.create(0,DC.DAG_PB,n)}const n=await LC(e);if(1!==n)throw new Error(`Unexpected CID version (${n})`);const r=await LC(e),s=await UC(e),i=Rt(s);return Lt.create(n,r,i)}async function FC(e){const t=e.pos;let n=await LC(e);if(0===n)throw new Error("Invalid CAR section (zero length)");n+=e.pos-t;const r=await VC(e),s=n-Number(e.pos-t);return{cid:r,length:n,blockLength:s}}async function jC(e){const{cid:t,blockLength:n}=await FC(e),r=await e.exactly(n);return e.seek(n),{bytes:r,cid:t}}async function zC(e){const t=e.pos,{cid:n,length:r,blockLength:s}=await FC(e),i={cid:n,length:r,blockLength:s,offset:t,blockOffset:e.pos};return e.seek(i.blockLength),i}function $C(e){const t=(async()=>{const t=await BC(e);if(2===t.version){const n=e.pos-t.dataOffset;e=GC(e,t.dataSize-n)}return t})();return{header:()=>t,async*blocks(){await t;while((await e.upTo(8)).length>0)yield await jC(e)},async*blocksIndex(){await t;while((await e.upTo(8)).length>0)yield await zC(e)}}}function HC(e){let t=0;return{async upTo(n){return e.subarray(t,t+Math.min(n,e.length-t))},async exactly(n){if(n>e.length-t)throw new Error("Unexpected end of data");return e.subarray(t,t+n)},seek(e){t+=e},get pos(){return t}}}function KC(e){let t=0,n=0,r=0,s=new Uint8Array(0);const i=async t=>{n=s.length-r;const i=[s.subarray(r)];while(n<t){const t=await e();if(null==t)break;n<0?t.length>n&&i.push(t.subarray(-n)):i.push(t),n+=t.length}s=new Uint8Array(i.reduce(((e,t)=>e+t.length),0));let o=0;for(const e of i)s.set(e,o),o+=e.length;r=0};return{async upTo(e){return s.length-r<e&&await i(e),s.subarray(r,r+Math.min(s.length-r,e))},async exactly(e){if(s.length-r<e&&await i(e),s.length-r<e)throw new Error("Unexpected end of data");return s.subarray(r,r+e)},seek(e){t+=e,r+=e},get pos(){return t}}}function qC(e){const t=e[Symbol.asyncIterator]();async function n(){const e=await t.next();return e.done?null:e.value}return KC(n)}function GC(e,t){let n=0;return{async upTo(r){let s=await e.upTo(r);return s.length+n>t&&(s=s.subarray(0,t-n)),s},async exactly(r){const s=await e.exactly(r);if(s.length+n>t)throw new Error("Unexpected end of data");return s},seek(t){n+=t,e.seek(t)},get pos(){return e.pos}}}class WC{constructor(e,t){this._encoder=t,this._mutex=t.setRoots(e),this._ended=!1}async put(e){if(!(e.bytes instanceof Uint8Array)||!e.cid)throw new TypeError("Can only write {cid, bytes} objects");if(this._ended)throw new Error("Already closed");const t=Lt.asCID(e.cid);if(!t)throw new TypeError("Can only write {cid, bytes} objects");return this._mutex=this._mutex.then((()=>this._encoder.writeBlock({cid:t,bytes:e.bytes}))),this._mutex}async close(){if(this._ended)throw new Error("Already closed");return await this._mutex,this._ended=!0,this._encoder.close()}static create(e){e=QC(e);const{encoder:t,iterator:n}=JC(),r=new WC(e,t),s=new YC(n);return{writer:r,out:s}}static createAppender(){const{encoder:e,iterator:t}=JC();e.setRoots=()=>Promise.resolve();const n=new WC([],e),r=new YC(t);return{writer:n,out:r}}static async updateRootsInBytes(e,t){const n=HC(e);await BC(n);const r=TC(t);if(Number(n.pos)!==r.length)throw new Error(`updateRoots() can only overwrite a header of the same length (old header is ${n.pos} bytes, new header is ${r.length} bytes)`);return e.set(r,0),e}}class YC{constructor(e){this._iterator=e}[Symbol.asyncIterator](){if(this._iterating)throw new Error("Multiple iterator not supported");return this._iterating=!0,this._iterator}}function JC(){const e=RC(),{writer:t,iterator:n}=e,r=CC(t);return{encoder:r,iterator:n}}function QC(e){if(void 0===e)return[];if(!Array.isArray(e)){const t=Lt.asCID(e);if(!t)throw new TypeError("roots must be a single CID or an array of CIDs");return[t]}const t=[];for(const n of e){const e=Lt.asCID(n);if(!e)throw new TypeError("roots must be a single CID or an array of CIDs");t.push(e)}return t}const XC=async({cid:e,load:t,seen:n})=>{n=n||new Set;const r=e.toString(Ae);if(n.has(r))return;const s=await t(e);if(n.add(r),null!==s)for(const[,i]of s.links())await XC({cid:i,load:t,seen:n})},ZC=Fe("ipfs:components:dag:import"),eI=[go,Eo];function tI({repo:e,preload:t,codecs:n}){async function*r(r,s={}){!1!==s.preload&&t(r);const i=Lt.asCID(r);if(!i)throw new Error(`Unexpected error converting CID type: ${r}`);ZC(`Exporting ${i} as car`);const{writer:o,out:a}=await WC.create([i]);let c=null;(async()=>{try{const t=nI(e,o,{signal:s.signal,timeout:s.timeout},n);await XC({cid:i,load:t})}catch(t){c=t}finally{o.close()}})();for await(const e of a){if(c)break;yield e}if(c)throw c}return pl(r)}function nI(e,t,n,r){return async s=>{const i=await r.getCodec(s.code);if(!i)throw new Error(`Can't decode links in block with codec 0x${s.code.toString(16)} to form complete DAG`);const o=await e.blocks.get(s,n);return ZC(`Adding block ${s} to car`),await t.put({cid:s,bytes:o}),eI.includes(s.code)?null:AC({bytes:o,cid:s,codec:i})}}async function rI(e){for await(const t of e)return t}function sI({codecs:e,repo:t,preload:n}){const r=async function(r,s={}){if(!1!==s.preload&&n(r),s.path){const n=s.localResolve?await rI(Al(r,s.path,e,t,s)):await qu(Al(r,s.path,e,t,s)),i=n;if(!i)throw je(new Error("Not found"),"ERR_NOT_FOUND");return i}const i=await e.getCodec(r.code),o=await t.blocks.get(r,s),a=i.decode(o);return{value:a,remainderPath:""}};return pl(r)}class iI{constructor(e,t,n){this._version=e,this._roots=t,this._iterable=n,this._decoded=!1}get version(){return this._version}async getRoots(){return this._roots}}class oI extends iI{[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");return this._decoded=!0,this._iterable[Symbol.asyncIterator]()}static async fromBytes(e){const{version:t,roots:n,iterator:r}=await cI(e);return new oI(t,n,r)}static async fromIterable(e){const{version:t,roots:n,iterator:r}=await lI(e);return new oI(t,n,r)}}class aI extends(null){[Symbol.asyncIterator](){if(this._decoded)throw new Error("Cannot decode more than once");if(!this._iterable)throw new Error("Block iterable not found");this._decoded=!0;const e=this._iterable[Symbol.asyncIterator]();return{async next(){const t=await e.next();return t.done?t:{done:!1,value:t.value.cid}}}}static async fromBytes(e){const{version:t,roots:n,iterator:r}=await cI(e);return new aI(t,n,r)}static async fromIterable(e){const{version:t,roots:n,iterator:r}=await lI(e);return new aI(t,n,r)}}async function cI(e){if(!(e instanceof Uint8Array))throw new TypeError("fromBytes() requires a Uint8Array");return uI(HC(e))}async function lI(e){if(!e||"function"!==typeof e[Symbol.asyncIterator])throw new TypeError("fromIterable() requires an async iterable");return uI(qC(e))}async function uI(e){const t=$C(e),{version:n,roots:r}=await t.header();return{version:n,roots:r,iterator:t.blocks()}}const hI=Fe("ipfs:components:dag:import");function dI({repo:e}){async function*t(t,n={}){const r=await e.gcLock.readLock();try{const r={signal:n.signal,timeout:n.timeout},s=My(t),{value:i,done:o}=await s.peek();if(o)return;let a;i&&s.push(i),a=i instanceof Uint8Array?[s]:s;for await(const t of a){const s=await pI(e,r,t);if(!1!==n.pinRoots)for(const t of s){let n="";try{await e.blocks.has(t)?(hI(`Pinning root ${t}`),await e.pins.pinRecursively(t)):n="blockstore: block not found"}catch(uS){n=uS.message}yield{root:{cid:t,pinErrorMsg:n}}}}}finally{r()}}return pl(t)}async function pI(e,t,n){const r=await oI.fromIterable(n),s=await r.getRoots();return await Zg(e.blocks.putMany(Iy(r,(({cid:e,bytes:t})=>(hI(`Import block ${e}`),{key:e,value:t}))),{signal:t.signal})),s}function fI({repo:e,codecs:t,hashers:n,preload:r}){async function s(s,i={}){const o=i.pin?await e.gcLock.readLock():null;try{const o=await t.getCodec(i.storeCodec||"dag-cbor");if(!o)throw new Error(`Unknown storeCodec ${i.storeCodec}, please configure additional BlockCodecs for this IPFS instance`);if(i.inputCodec){if(!(s instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");const e=await t.getCodec(i.inputCodec);if(!e)throw new Error(`Unknown inputCodec ${i.inputCodec}, please configure additional BlockCodecs for this IPFS instance`);s=e.decode(s)}const a=null!=i.version?i.version:1,c=await n.getHasher(i.hashAlg||"sha2-256");if(!c)throw new Error(`Unknown hash algorithm ${i.hashAlg}, please configure additional MultihashHashers for this IPFS instance`);const l=o.encode(s),u=await c.digest(l),h=Lt.create(a,o.code,u);return await e.blocks.put(h,l,{signal:i.signal}),i.pin&&await e.pins.pinRecursively(h),!1!==i.preload&&r(h),h}finally{o&&o()}}return pl(s)}function gI({repo:e,codecs:t,preload:n}){async function r(r,s={}){const{cid:i}=gl(r);return!1!==s.preload&&n(i),_l(e,t,r,s)}return pl(r)}class mI{constructor({repo:e,codecs:t,hashers:n,preload:r}){this.export=tI({repo:e,preload:r,codecs:t}),this.get=sI({codecs:t,repo:e,preload:r}),this.import=dI({repo:e}),this.resolve=gI({repo:e,codecs:t,preload:r}),this.put=fI({repo:e,codecs:t,hashers:n,preload:r})}}const yI=(e,t)=>t,wI=(e,t,n,r)=>{if(null!=r&&!1===r.assumeHttp)return`tcp://${e}:${t}`;let s="tcp",i=`:${t}`;const o=n[n.length-1];return"tcp"===o.protocol&&(s="443"===t?"https":"http",i="443"===t||"80"===t?"":i),`${s}://${e}${i}`},bI={ip4:yI,ip6:(e,t,n,r)=>1===r.length&&"ip6"===r[0].protocol?t:`[${t}]`,tcp:(e,t,n,r,s)=>r.some((e=>["http","https","ws","wss"].includes(e.protocol)))?`${e}:${t}`:wI(e,t,r,s),udp:(e,t)=>`udp://${e}:${t}`,dnsaddr:yI,dns4:yI,dns6:yI,ipfs:(e,t)=>`${e}/ipfs/${t}`,p2p:(e,t)=>`${e}/p2p/${t}`,http:e=>`http://${e}`,https:e=>`https://${e}`,ws:e=>`ws://${e}`,wss:e=>`wss://${e}`,"p2p-websocket-star":e=>`${e}/p2p-websocket-star`,"p2p-webrtc-star":e=>`${e}/p2p-webrtc-star`,"p2p-webrtc-direct":e=>`${e}/p2p-webrtc-direct`};function vI(e,t){const n=dc(e),r=n.toString().split("/").slice(1);return n.tuples().map((e=>({protocol:r.shift()??"",content:null!=e[1]?r.shift()??"":""}))).reduce(((e,n,r,s)=>{const i=bI[n.protocol];if(null==i)throw new Error(`Unsupported protocol ${n.protocol}`);return i(e,n.content,r,s,t)}),"")}function EI(e){if(!Array.isArray(e))throw new TypeError("Expected an array, got "+typeof e);e=[...e];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*(t+1));[e[t],e[n]]=[e[n],e[t]]}return e}const _I=Fe("ipfs:preload"),SI=yu["default"]?yu["default"]:yu,kI=new SI({concurrency:4});function AI(e,t={}){return _I(e),kI.add((async()=>{const n=await wu.post(e,{signal:t.signal}),r=n.body.getReader();try{while(1){const{done:e}=await r.read();if(e)return}}finally{r.releaseLock()}}))}const TI=Fe("ipfs:preload");function CI(e={}){if(e.enabled=Boolean(e.enabled),e.addresses=e.addresses||[],e.cache=e.cache||1e3,!e.enabled||!e.addresses.length){TI("preload disabled");const e=()=>{};return Object.assign(e,{start:()=>{},stop:()=>{}})}let t=!0,n=[];const r=e.addresses.map((e=>vI(e))),s=Rl(e.cache),i=async e=>{try{if(t)throw new Error(`preload ${e} but preloader is not started`);const i=e.toString();if(s.has(i))return;s.set(i,!0);const o=EI(r);let a=!1;const c=Date.now();for(const e of o){if(t)throw new Error(`preload aborted for ${i}`);let r;try{r=new AbortController,n=n.concat(r),await AI(`${e}/api/v0/refs?r=true&arg=${encodeURIComponent(i)}`,{signal:r.signal}),a=!0}catch(uS){"aborted"!==uS.type&&TI.error(uS)}finally{n=n.filter((e=>e!==r))}if(a)break}TI(`${a?"":"un"}successfully preloaded ${i} in ${Date.now()-c}ms`)}catch(uS){TI.error(uS)}};return i.start=()=>{t=!1},i.stop=()=>{t=!0,TI(`aborting ${n.length} pending preload request(s)`),n.forEach((e=>e.abort())),n=[]},i}const II=Fe("ipfs:mfs-preload");function RI({preload:e,files:t,options:n={}}){if(n.interval=n.interval||3e4,!n.enabled){II("MFS preload disabled");const e=async()=>{};return{start:e,stop:e}}let r,s="";const i=async()=>{try{const n=await t.stat("/"),r=n.cid.toString();s!==r&&(II(`preloading updated MFS root ${s} -> ${n.cid}`),await e(n.cid),s=r)}catch(uS){II.error("failed to preload MFS root",uS)}finally{r=setTimeout(i,n.interval)}};return{async start(){const e=await t.stat("/");s=e.cid.toString(),II(`monitoring MFS root ${e.cid}`),r=setTimeout(i,n.interval)},stop(){clearTimeout(r)}}}class OI extends Error{constructor(e){super(e),this.name="TimeoutError"}}class xI extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const NI=e=>void 0===globalThis.DOMException?new xI(e):new DOMException(e),DI=e=>{const t=void 0===e.reason?NI("This operation was aborted."):e.reason;return t instanceof Error?t:NI(t)};function PI(e,t){const{milliseconds:n,fallback:r,message:s,customTimers:i={setTimeout:setTimeout,clearTimeout:clearTimeout}}=t;let o;const a=new Promise(((a,c)=>{if("number"!==typeof n||1!==Math.sign(n))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${n}\``);if(n!==Number.POSITIVE_INFINITY){if(t.signal){const{signal:e}=t;e.aborted&&c(DI(e)),e.addEventListener("abort",(()=>{c(DI(e))}))}o=i.setTimeout.call(void 0,(()=>{if(r){try{a(r())}catch(o){c(o)}return}const t="string"===typeof s?s:`Promise timed out after ${n} milliseconds`,i=s instanceof Error?s:new OI(t);"function"===typeof e.cancel&&e.cancel(),c(i)}),n),(async()=>{try{a(await e)}catch(t){c(t)}finally{i.clearTimeout.call(void 0,o)}})()}else a(e)}));return a.clear=()=>{i.clearTimeout.call(void 0,o),o=void 0},a}const LI="lock:worker:request-read",MI="lock:worker:release-read",BI="lock:master:grant-read",UI="lock:worker:request-write",VI="lock:worker:release-write",FI="lock:master:grant-write",jI={},zI=e=>{e.addEventListener("message",(t=>{zI.dispatchEvent("message",e,t)})),null!=e.port&&e.port.addEventListener("message",(t=>{zI.dispatchEvent("message",e,t)}))};zI.addEventListener=(e,t)=>{null==jI[e]&&(jI[e]=[]),jI[e].push(t)},zI.removeEventListener=(e,t)=>{null!=jI[e]&&(jI[e]=jI[e].filter((e=>e===t)))},zI.dispatchEvent=function(e,t,n){null!=jI[e]&&jI[e].forEach((e=>e(t,n)))};var $I=zI;const HI=(e,t,n,r,s)=>(i,o)=>{if(o.data.type!==n)return;const a={type:o.data.type,name:o.data.name,identifier:o.data.identifier};e.dispatchEvent(new MessageEvent(t,{data:{name:a.name,handler:async()=>(i.postMessage({type:s,name:a.name,identifier:a.identifier}),await new Promise((e=>{const t=n=>{if(null==n||null==n.data)return;const s={type:n.data.type,name:n.data.name,identifier:n.data.identifier};s.type===r&&s.identifier===a.identifier&&(i.removeEventListener("message",t),e())};i.addEventListener("message",t)})))}}))},KI=(e,t,n,r)=>async()=>{const s=Zc();return globalThis.postMessage({type:t,identifier:s,name:e}),await new Promise((t=>{const i=o=>{if(null==o||null==o.data)return;const a={type:o.data.type,identifier:o.data.identifier};a.type===n&&a.identifier===s&&(globalThis.removeEventListener("message",i),t((()=>{globalThis.postMessage({type:r,identifier:s,name:e})})))};globalThis.addEventListener("message",i)}))},qI={singleProcess:!1};var GI=e=>{e=Object.assign({},qI,e);const t=Boolean(globalThis.document)||e.singleProcess;if(t){const e=new EventTarget;return $I.addEventListener("message",HI(e,"requestReadLock",LI,MI,BI)),$I.addEventListener("message",HI(e,"requestWriteLock",UI,VI,FI)),e}return{isWorker:!0,readLock:e=>KI(e,LI,BI,MI),writeLock:e=>KI(e,UI,FI,VI)}};const WI={};let YI;async function JI(e,t){let n;const r=new Promise((e=>{n=e}));return e.add((async()=>await PI((async()=>await new Promise((e=>{n((()=>{e()}))})))(),{milliseconds:t.timeout}))),await r}const QI=(e,t)=>{if(!0===YI.isWorker)return{readLock:YI.readLock(e,t),writeLock:YI.writeLock(e,t)};const n=new yu({concurrency:1});let r;return{async readLock(){if(null!=r)return await JI(r,t);r=new yu({concurrency:t.concurrency,autoStart:!1});const e=r,s=JI(r,t);return n.add((async()=>(e.start(),await e.onIdle().then((()=>{r===e&&(r=null)}))))),await s},async writeLock(){return r=null,await JI(n,t)}}},XI={name:"lock",concurrency:1/0,timeout:846e5,singleProcess:!1};function ZI(e){const t=Object.assign({},XI,e);return null==YI&&(YI=GI(t),!0!==YI.isWorker&&(YI.addEventListener("requestReadLock",(e=>{null!=WI[e.data.name]&&WI[e.data.name].readLock().then((async t=>await e.data.handler().finally((()=>t()))))})),YI.addEventListener("requestWriteLock",(async e=>{null!=WI[e.data.name]&&WI[e.data.name].writeLock().then((async t=>await e.data.handler().finally((()=>t()))))})))),null==WI[t.name]&&(WI[t.name]=QI(t.name,t)),WI[t.name]}let eR;function tR(e=!1){if(eR)return eR;const t=ZI({singleProcess:e});return eR={readLock:e=>async(...n)=>{const r=await t.readLock();try{return await e.apply(null,n)}finally{r()}},writeLock:e=>async(...n)=>{const r=await t.writeLock();try{return await e.apply(null,n)}finally{r()}}},eR}const nR=Fe("ipfs:mfs:utils:with-mfs-root");async function rR(e,t){if(t&&t.signal&&t.signal.aborted)throw je(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});let n;await e.repo.datastore.open();try{const t=await e.repo.datastore.get(wl);n=Lt.decode(t)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;nR("Creating new MFS root");const s=bn({Data:new tt({type:"directory"}).marshal(),Links:[]}),i=await ho.digest(s);if(n=Lt.createV0(i),await e.repo.blocks.put(n,s),t&&t.signal&&t.signal.aborted)throw je(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});await e.repo.datastore.put(wl,n.bytes)}return nR(`Loaded MFS root /ipfs/${n}`),n}function sR(e=""){return(e.trim().match(/([^\\^/]|\\\/)+/g)||[]).filter(Boolean)}const iR="ipfs",oR=async(e,t,n)=>{const r=await rR(e,n);let s={entryType:"file"},i="";if(i=Lt.asCID(t)?`/ipfs/${t}`:t.toString(),i=i.trim(),i=i.replace(/(\/\/+)/g,"/"),i.endsWith("/")&&i.length>1&&(i=i.substring(0,i.length-1)),!i)throw je(new Error("paths must not be empty"),"ERR_NO_PATH");if("/"!==i.substring(0,1))throw je(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");"/"===i.substring(i.length-1)&&(i=i.substring(0,i.length-1));const o=sR(i);if(o[0]===iR){let e;e=2===o.length?`/${o.join("/")}`:`/${o.slice(0,o.length-1).join("/")}`,s={type:"ipfs",depth:o.length-2,entryType:"file",mfsPath:`/${o.join("/")}`,mfsDirectory:e,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}else{const e=`/${iR}/${r}${o.length?"/"+o.join("/"):""}`,t=`/${iR}/${r}/${o.slice(0,o.length-1).join("/")}`;s={type:"mfs",depth:o.length,entryType:"file",mfsDirectory:t,mfsPath:e,parts:o,path:`/${o.join("/")}`,name:o[o.length-1]}}const a="mfs"===s.type?s.mfsPath:s.path;try{const t=await lv(a,e.repo.blocks,n);s.cid=t.cid,s.mfsPath=`/ipfs/${t.path}`,s.entryType=t.type,s.content=t.content,"file"!==s.entryType&&"directory"!==s.entryType||"file"!==t.type&&"directory"!==t.type||(s.unixfs=t.unixfs)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}return s.exists=Boolean(s.cid),s},aR=ne.bind({ignoreUndefined:!0}),cR=Fe("ipfs:mfs:stat"),lR={withLocal:!1};function uR(e){async function t(t,n={}){n=aR(lR,n),cR(`Fetching stats for ${t}`);const{type:r,cid:s,mfsPath:i}=await oR(e,t,n),o="ipfs"===r&&s?s:i;let a;try{a=await lv(o,e.repo.blocks)}catch(uS){if("ERR_NOT_FOUND"===uS.code)throw je(new Error(`${t} does not exist`),"ERR_NOT_FOUND");throw uS}if(!hR[a.type])throw new Error(`Cannot stat codec ${a.cid.code}`);return hR[a.type](a)}return pl(t)}const hR={raw:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1}),file:e=>{const t={cid:e.cid,type:"file",size:e.unixfs.fileSize(),cumulativeSize:bn(e.node).length+(e.node.Links||[]).reduce(((e,t)=>e+(t.Tsize||0)),0),blocks:e.unixfs.blockSizes.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:e.unixfs.mode};return e.unixfs.mtime&&(t.mtime=e.unixfs.mtime),t},directory:e=>{const t={cid:e.cid,type:"directory",size:0,cumulativeSize:bn(e.node).length+(e.node.Links||[]).reduce(((e,t)=>e+(t.Tsize||0)),0),blocks:e.node.Links.length,local:void 0,sizeLocal:void 0,withLocality:!1,mode:e.unixfs.mode};return e.unixfs.mtime&&(t.mtime=e.unixfs.mtime),t},object:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,type:"file",blocks:0,local:void 0,sizeLocal:void 0,withLocality:!1}),identity:e=>({cid:e.cid,size:e.node.length,cumulativeSize:e.node.length,blocks:0,type:"file",local:void 0,sizeLocal:void 0,withLocality:!1})},dR=Fe("ipfs:mfs:utils:to-trail");async function pR(e,t){dR(`Creating trail for path ${t}`);const n=[];for await(const r of cv(t,e.repo.blocks))n.push({name:r.name,cid:r.cid,size:r.size,type:r.type});return n}const fR=async(e,t,n)=>{n.codec||(n.codec=o),n.hasher||(n.hasher=ho),void 0===n.cidVersion&&(n.cidVersion=1),n.codec===o&&n.hasher!==ho&&(n.cidVersion=1);const r=await n.hasher.digest(e),s=Lt.create(n.cidVersion,n.codec.code,r);return n.onlyHash||await t.put(s,e,{signal:n.signal}),s},gR=Xy.code,mR=8;async function yR(e){return(await Xy.encode(e)).subarray(0,8).reverse()}class wR{constructor(e,t){this.options=t||{},this.root=e.root,this.dir=e.dir,this.path=e.path,this.dirty=e.dirty,this.flat=e.flat,this.parent=e.parent,this.parentKey=e.parentKey,this.unixfs=e.unixfs,this.mode=e.mode,this.mtime=e.mtime,this.cid=void 0,this.size=void 0}async put(e,t){}get(e){return Promise.resolve(this)}async*eachChildSeries(){}async*flush(e){}}class bR extends wR{constructor(e,t){super(e,t),this._bucket=nb({hashFn:yR,bits:mR})}async put(e,t){await this._bucket.put(e,t)}get(e){return this._bucket.get(e)}childCount(){return this._bucket.leafCount()}directChildrenCount(){return this._bucket.childrenCount()}onlyChild(){return this._bucket.onlyChild()}async*eachChildSeries(){for await(const{key:e,value:t}of this._bucket.eachLeafSeries())yield{key:e,child:t}}async*flush(e){yield*vR(this._bucket,e,this,this.options)}}async function*vR(e,t,n,r){const s=e._children,i=[];let o=0;for(let p=0;p<s.length;p++){const e=s.get(p);if(!e)continue;const n=p.toString(16).toUpperCase().padStart(2,"0");if(e instanceof Hw){let s;for await(const n of await vR(e,t,null,r))s=n;if(!s)throw new Error("Could not flush sharded directory, no subshard found");i.push({Name:n,Tsize:s.size,Hash:s.cid}),o+=s.size}else if("function"===typeof e.value.flush){const r=e.value;let s;for await(const e of r.flush(t))s=e,yield s;const a=n+e.key;i.push({Name:a,Tsize:s.size,Hash:s.cid}),o+=s.size}else{const t=e.value;if(!t.cid)continue;const r=n+e.key,s=t.size;i.push({Name:r,Tsize:s,Hash:t.cid}),o+=s}}const a=Uint8Array.from(s.bitField().reverse()),c=new tt({type:"hamt-sharded-directory",data:a,fanout:e.tableSize(),hashType:gR,mtime:n&&n.mtime,mode:n&&n.mode}),l={Data:c.marshal(),Links:i},u=bn(pn(l)),h=await fR(u,t,r),d=u.length+o;yield{cid:h,node:l,size:d}}const ER=Fe("ipfs:mfs:core:utils:hamt-utils"),_R=async(e,t,n,r)=>{if(!r.parent.Data)throw new Error("Could not update HAMT directory because parent had no data");const s=Uint8Array.from(n._children.bitField().reverse()),i=tt.unmarshal(r.parent.Data),o=new tt({type:"hamt-sharded-directory",data:s,fanout:n.tableSize(),hashType:gR,mode:i.mode,mtime:i.mtime}),a=await e.hashers.getHasher(r.hashAlg),c={Data:o.marshal(),Links:t.sort(((e,t)=>(e.Name||"").localeCompare(t.Name||"")))},l=bn(c),u=await a.digest(l),h=Lt.create(r.cidVersion,wn,u);return r.flush&&await e.repo.blocks.put(h,l),{node:c,cid:h,size:t.reduce(((e,t)=>e+(t.Tsize||0)),l.length)}},SR=async(e,t,n,r,s)=>{const i=new Hw({hash:n._options.hash,bits:n._options.bits},r,s);return r._putObjectAt(s,i),await AR(e,t,i,n),i},kR=async e=>{const t=nb({hashFn:yR,bits:mR});return await Promise.all(e.map((async e=>{const n=e.Name||"";if(2===n.length){const e=parseInt(n,16),r=new Hw({hash:t._options.hash,bits:t._options.bits},t,e);return t._putObjectAt(e,r),Promise.resolve()}return t.put(n.substring(2),{size:e.Tsize,cid:e.Hash})}))),t},AR=async(e,t,n,r)=>{await Promise.all(t.map((async t=>{const s=t.Name||"";if(2===s.length){ER("Populating sub bucket",s);const i=parseInt(s,16),o=await e.repo.blocks.get(t.Hash),a=vn(o),c=new Hw({hash:r._options.hash,bits:r._options.bits},n,i);return n._putObjectAt(i,c),await AR(e,a.Links,c,r),Promise.resolve()}return r.put(s.substring(2),{size:t.Tsize,cid:t.Hash})})))},TR=e=>e.toString(16).toUpperCase().padStart(2,"0").substring(0,2),CR=async(e,t,n)=>{const r=await kR(n.Links),s=await r._findNewBucketAndPos(t),i=[{bucket:s.bucket,prefix:TR(s.pos)}];let o=s.bucket;while(o!==r)i.push({bucket:o,prefix:TR(o._posAtParent)}),o=o._parent;i.reverse(),i[0].node=n;for(let a=0;a<i.length;a++){const n=i[a];if(!n.node)throw new Error("Could not generate HAMT path");const s=n.node.Links.filter((e=>(e.Name||"").substring(0,2)===n.prefix)).pop();if(!s){ER(`Link ${n.prefix}${t} will be added`);continue}if(s.Name===`${n.prefix}${t}`){ER(`Link ${n.prefix}${t} will be replaced`);continue}ER(`Found subshard ${n.prefix}`);const o=await e.repo.blocks.get(s.Hash),c=vn(o);if(!i[a+1]){ER(`Loaded new subshard ${n.prefix}`),await SR(e,c.Links,r,n.bucket,parseInt(n.prefix,16));const s=await r._findNewBucketAndPos(t);i.push({bucket:s.bucket,prefix:TR(s.pos),node:c});continue}const l=i[a+1];await AR(e,c.Links,l.bucket,r),l.node=c}return await r.put(t,!0),i.reverse(),{rootBucket:r,path:i}},IR=async(e,t,n={})=>{const r=new bR({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mtime:n.mtime,mode:n.mode},n);for(let i=0;i<t.length;i++)await r._bucket.put(t[i].name,{size:t[i].size,cid:t[i].cid});const s=await qu(r.flush(e.repo.blocks));if(!s)throw new Error("Flushing shard yielded no result");return s},RR=Fe("ipfs:mfs:core:utils:add-link");async function OR(e,t){let n=t.parent;if(t.parentCid){const r=Lt.asCID(t.parentCid);if(null===r)throw je(new Error("Invalid CID passed to addLink"),"EINVALIDPARENTCID");if(r.code!==wn)throw je(new Error("Unsupported codec. Only DAG-PB is supported"),"EINVALIDPARENTCID");RR(`Loading parent node ${r}`);const s=await e.repo.blocks.get(r);n=vn(s)}if(!n)throw je(new Error("No parent node or CID passed to addLink"),"EINVALIDPARENT");if(!t.cid)throw je(new Error("No child cid passed to addLink"),"EINVALIDCHILDCID");if(!t.name)throw je(new Error("No child name passed to addLink"),"EINVALIDCHILDNAME");if(!t.size&&0!==t.size)throw je(new Error("No child size passed to addLink"),"EINVALIDCHILDSIZE");if(!n.Data)throw je(new Error("Parent node with no data passed to addLink"),"ERR_INVALID_PARENT");const r=tt.unmarshal(n.Data);return"hamt-sharded-directory"===r.type?(RR("Adding link to sharded directory"),DR(e,{...t,parent:n})):n.Links.length>=t.shardSplitThreshold?(RR("Converting directory to sharded directory"),xR(e,{...t,parent:n,mtime:r.mtime,mode:r.mode})):(RR(`Adding ${t.name} (${t.cid}) to regular directory`),NR(e,{...t,parent:n}))}const xR=async(e,t)=>{const n=await IR(e,t.parent.Links.map((e=>({name:e.Name||"",size:e.Tsize||0,cid:e.Hash}))).concat({name:t.name,size:t.size,cid:t.cid}),t);return RR(`Converted directory to sharded directory ${n.cid}`),n},NR=async(e,t)=>{const n=t.parent.Links.filter((e=>e.Name!==t.name));if(n.push({Name:t.name,Tsize:t.size,Hash:t.cid}),!t.parent.Data)throw je(new Error("Parent node with no data passed to addToDirectory"),"ERR_INVALID_PARENT");const r=tt.unmarshal(t.parent.Data);let s;if(r.mtime){const e=Date.now(),t=Math.floor(e/1e3);r.mtime={secs:t,nsecs:1e3*(e-1e3*t)},s=r.marshal()}else s=t.parent.Data;t.parent=pn({Data:s,Links:n});const i=await e.hashers.getHasher(t.hashAlg),o=bn(t.parent),a=await i.digest(o),c=Lt.create(t.cidVersion,wn,a);return t.flush&&await e.repo.blocks.put(c,o),{node:t.parent,cid:c,size:o.length}},DR=async(e,t)=>{const{shard:n,path:r}=await PR(e,t),s=await qu(n.flush(e.repo.blocks));if(!s)throw new Error("No result from flushing shard");const i=await e.repo.blocks.get(s.cid),o=vn(i),a=t.parent.Links.filter((e=>(e.Name||"").substring(0,2)!==r[0].prefix)),c=o.Links.find((e=>(e.Name||"").substring(0,2)===r[0].prefix));if(!c)throw new Error(`No link found with prefix ${r[0].prefix}`);return a.push(c),_R(e,a,r[0].bucket,t)},PR=async(e,t)=>{const n={name:t.name,cid:t.cid,size:t.size};if(!t.parent.Data)throw je(new Error("Parent node with no data passed to addFileToShardedDirectory"),"ERR_INVALID_PARENT");const r=await kR(t.parent.Links),s=tt.unmarshal(t.parent.Data),i=new bR({root:!0,dir:!0,parent:void 0,parentKey:void 0,path:"",dirty:!0,flat:!1,mode:s.mode},t);i._bucket=r,s.mtime&&(i.mtime={secs:Math.round(Date.now()/1e3)});const o=await r._findNewBucketAndPos(n.name),a=LR(o);a[0].node=t.parent;let c=0;while(c<a.length){const t=a[c];c++;const s=t.node;if(!s)throw new Error("Segment had no node");const i=s.Links.find((e=>(e.Name||"").substring(0,2)===t.prefix));if(!i){RR(`Link ${t.prefix}${n.name} will be added`),c=a.length;break}if(i.Name===`${t.prefix}${n.name}`){RR(`Link ${t.prefix}${n.name} will be replaced`),c=a.length;break}if((i.Name||"").length>2){RR(`Link ${i.Name} ${i.Hash} will be replaced with a subshard`),c=a.length;break}RR(`Found subshard ${t.prefix}`);const o=await e.repo.blocks.get(i.Hash),l=vn(o);if(!a[c]){RR(`Loaded new subshard ${t.prefix}`),await SR(e,l.Links,r,t.bucket,parseInt(t.prefix,16));const s=await r._findNewBucketAndPos(n.name);a.push({bucket:s.bucket,prefix:TR(s.pos),node:l});break}const u=a[c];await AR(e,l.Links,u.bucket,r),u.node=l}return await i._bucket.put(n.name,{size:n.size,cid:n.cid}),{shard:i,path:a}},LR=e=>{const t=[{bucket:e.bucket,prefix:TR(e.pos)}];let n=e.bucket._parent,r=e.bucket._posAtParent;while(n)t.push({bucket:n,prefix:TR(r)}),r=n._posAtParent,n=n._parent;return t.reverse(),t},MR=Fe("ipfs:mfs:utils:update-tree"),BR={shardSplitThreshold:1e3};async function UR(e,t,n){n=Object.assign({},BR,n),MR("Trail",t),t=t.slice().reverse();let r,s=0;for await(const o of e.repo.blocks.getMany(t.map((e=>e.cid)))){const i=vn(o),a=t[s].cid,c=t[s].name;if(s++,!r){r={cid:a,name:c,size:o.length};continue}const l=await OR(e,{parent:i,name:r.name,cid:r.cid,size:r.size,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold,hashAlg:n.hashAlg,cidVersion:n.cidVersion});r={cid:l.cid,name:c,size:l.size}}const{cid:i}=r;return MR(`Final CID ${i}`),i}const VR=Fe("ipfs:mfs:utils:update-mfs-root");async function FR(e,t,n){if(n&&n.signal&&n.signal.aborted)throw je(new Error("Request aborted"),"ERR_ABORTED",{name:"Aborted"});return VR(`New MFS root will be ${t}`),await e.repo.datastore.put(wl,t.bytes),t}async function jR(e,t,n){const r=new tt({type:t,mode:n.mode,mtime:n.mtime}),s=await e.hashers.getHasher(n.hashAlg),i={Data:r.marshal(),Links:[]},o=bn(i),a=await s.digest(o),c=Lt.create(n.cidVersion,wn,a);return n.flush&&await e.repo.blocks.put(c,o),{cid:c,node:i}}const zR=ne.bind({ignoreUndefined:!0}),$R=Fe("ipfs:mfs:mkdir"),HR={parents:!1,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3,flush:!0};function KR(e){async function t(t,n={}){const r=zR(HR,n);if(!t)throw new Error("no path given to Mkdir");if(t=t.trim(),"/"===t){if(r.parents)return;throw je(new Error("cannot create directory '/': Already exists"),"ERR_INVALID_PATH")}if("/"!==t.substring(0,1))throw je(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");$R(`Creating ${t}`);const s=sR(t);if("ipfs"===s[0])throw je(new Error("path cannot have the prefix 'ipfs'"),"ERR_INVALID_PATH");const i=await rR(e,r);let o;const a=[],c=await jR(e,"directory",r);for(let u=0;u<=s.length;u++){const n=s.slice(0,u),l=`/ipfs/${i}/${n.join("/")}`;try{if(o=await lv(l,e.repo.blocks),"file"!==o.type&&"directory"!==o.type)throw je(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(u===s.length){if(r.parents)return;throw je(new Error("file already exists"),"ERR_ALREADY_EXISTS")}a.push({name:o.name,cid:o.cid})}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;if(u<s.length&&!r.parents)throw je(new Error(`Intermediate directory path ${l} does not exist, use the -p flag to create it`),"ERR_NOT_FOUND");await qR(e,n[n.length-1],c,a[a.length-1],a,r)}}const l=await UR(e,a,r);await FR(e,l,r)}return pl(t)}const qR=async(e,t,n,r,s,i)=>{$R(`Adding empty dir called ${t} to ${r.cid}`);const o=await OR(e,{parent:r.node,parentCid:r.cid,size:0,cid:n.cid,name:t,hashAlg:i.hashAlg,cidVersion:i.cidVersion,flush:i.flush,shardSplitThreshold:i.shardSplitThreshold});s[s.length-1].cid=o.cid,s.push({name:t,cid:n.cid})},GR=ne.bind({ignoreUndefined:!0}),WR=Fe("ipfs:mfs:cp"),YR={parents:!1,flush:!0,hashAlg:"sha2-256",cidVersion:0,shardSplitThreshold:1e3};function JR(e){async function t(t,n,r={}){const s=GR(YR,r);Array.isArray(t)||(t=[t]);const i=await Promise.all(t.map((t=>oR(e,t,s))));let o=await oR(e,n,s);if(!i.length||!o)throw je(new Error("Please supply at least one source"),"ERR_INVALID_PARAMS");const a=i.find((e=>!e.exists));if(a)throw je(new Error(`${a.path} does not exist`),"ERR_INVALID_PARAMS");const c=QR(o);if(o.exists){if(WR("Destination exists"),1===i.length&&!c)throw je(new Error("directory already has entry by that name"),"ERR_ALREADY_EXISTS")}else if(WR("Destination does not exist"),i.length>1){if(!s.parents)throw je(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await KR(e)(o.path,s),o=await oR(e,o.path,s)}else if(o.parts.length>1){const t=`/${o.parts.slice(0,-1).join("/")}`;try{await uR(e)(t,s)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;if(!s.parents)throw je(new Error("destination did not exist, pass -p to create intermediate directories"),"ERR_INVALID_PARAMS");await KR(e)(t,s),o=await oR(e,o.path,s)}}const l=QR(o)?o.mfsPath:o.mfsDirectory,u=await pR(e,l);if(1===i.length){const t=i.pop();if(!t)throw je(new Error("could not find source"),"ERR_INVALID_PARAMS");const n=c?t.name:o.name;return WR(`Only one source, copying to destination ${c?"directory":"file"} ${n}`),XR(e,t,n,u,s)}return WR("Multiple sources, wrapping in a directory"),ZR(e,i,o,u,s)}return pl(t)}const QR=e=>e.unixfs&&e.unixfs.type&&e.unixfs.type.includes("directory"),XR=async(e,t,n,r,s)=>{let i=r.pop();if(!i)throw je(new Error("destination had no parent"),"ERR_INVALID_PARAMS");i=await eO(e,t,n,i,s),r.push(i);const o=await UR(e,r,s);await FR(e,o,s)},ZR=async(e,t,n,r,s)=>{for(let o=0;o<t.length;o++){const r=t[o];n=await eO(e,r,r.name,n,s)}r[r.length-1]=n;const i=await UR(e,r,s);await FR(e,i,s)},eO=async(e,t,n,r,s)=>{const i=await e.repo.blocks.get(t.cid),{node:o,cid:a,size:c}=await OR(e,{parentCid:r.cid,size:i.length,cid:t.cid,name:n,hashAlg:s.hashAlg,cidVersion:s.cidVersion,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold});return r.node=o,r.cid=a,r.size=c,r},tO=Fe("ipfs:mfs:core:utils:remove-link");async function nO(e,t){let n=t.parent;if(t.parentCid){const r=Lt.asCID(t.parentCid);if(null===r)throw je(new Error("Invalid CID passed to removeLink"),"EINVALIDPARENTCID");tO(`Loading parent node ${r}`);const s=await e.repo.blocks.get(r);n=vn(s)}if(!n)throw je(new Error("No parent node or CID passed to removeLink"),"EINVALIDPARENT");if(!t.name)throw je(new Error("No child name passed to removeLink"),"EINVALIDCHILDNAME");if(!n.Data)throw je(new Error("Parent node had no data"),"ERR_INVALID_NODE");const r=tt.unmarshal(n.Data);return"hamt-sharded-directory"===r.type?(tO(`Removing ${t.name} from sharded directory`),sO(e,{...t,parent:n})):(tO(`Removing link ${t.name} regular directory`),rO(e,{...t,parent:n}))}const rO=async(e,t)=>{t.parent.Links=t.parent.Links.filter((e=>e.Name!==t.name));const n=await bn(t.parent),r=await e.hashers.getHasher(t.hashAlg),s=await r.digest(n),i=Lt.create(t.cidVersion,wn,s);return await e.repo.blocks.put(i,n),tO(`Updated regular directory ${i}`),{node:t.parent,cid:i}},sO=async(e,t)=>{const{rootBucket:n,path:r}=await CR(e,t.name,t.parent);await n.del(t.name);const{node:s}=await iO(e,r,t.name,t);return _R(e,s.Links,n,t)},iO=async(e,t,n,r)=>{const s=t.pop();if(!s)throw je(new Error("Could not find parent"),"EINVALIDPARENT");const{bucket:i,prefix:o,node:a}=s;if(!a)throw je(new Error("Could not find parent"),"EINVALIDPARENT");const c=a.Links.find((e=>(e.Name||"").substring(0,2)===o));if(!c)throw je(new Error(`No link found with prefix ${o} for file ${n}`),"ERR_NOT_FOUND");if(c.Name===`${o}${n}`){tO(`Removing existing link ${c.Name}`);const t=a.Links.filter((e=>e.Name!==c.Name));return await i.del(n),_R(e,t,i,r)}tO(`Descending into sub-shard ${c.Name} for ${o}${n}`);const l=await iO(e,t,n,r);let u=l.cid,h=l.size,d=o;if(1===l.node.Links.length){tO(`Removing subshard for ${o}`);const e=l.node.Links[0];d=`${o}${(e.Name||"").substring(2)}`,u=e.Hash,h=e.Tsize||0}return tO(`Updating shard ${o} with name ${d}`),oO(e,i,a,o,d,h,u,r)},oO=(e,t,n,r,s,i,o,a)=>{const c=n.Links.filter((e=>e.Name!==r));return c.push({Name:s,Tsize:i,Hash:o}),_R(e,c,t,a)},aO=ne.bind({ignoreUndefined:!0}),cO={recursive:!1,cidVersion:0,hashAlg:"sha2-256",flush:!0,shardSplitThreshold:1e3};function lO(e){async function t(t,n={}){const r=aO(cO,n);Array.isArray(t)||(t=[t]);const s=await Promise.all(t.map((t=>oR(e,t,r))));if(!s.length)throw je(new Error("Please supply at least one path to remove"),"ERR_INVALID_PARAMS");s.forEach((e=>{if("/"===e.path)throw je(new Error("Cannot delete root"),"ERR_INVALID_PARAMS")}));for(const i of s)await uO(e,i.path,r)}return pl(t)}const uO=async(e,t,n)=>{const r=await oR(e,t,n),s=await pR(e,r.mfsPath),i=s[s.length-1];s.pop();const o=s[s.length-1];if(!o)throw je(new Error(`${t} does not exist`),"ERR_NOT_FOUND");if("directory"===i.type&&!n.recursive)throw je(new Error(`${t} is a directory, use -r to remove directories`),"ERR_WAS_DIR");const{cid:a}=await nO(e,{parentCid:o.cid,name:i.name,hashAlg:n.hashAlg,cidVersion:n.cidVersion,flush:n.flush,shardSplitThreshold:n.shardSplitThreshold});o.cid=a;const c=await UR(e,s,n);await FR(e,c,n)},hO=ne.bind({ignoreUndefined:!0}),dO=Fe("ipfs:mfs:touch"),pO={flush:!0,shardSplitThreshold:1e3,hashAlg:"sha2-256",cidVersion:0,recursive:!1};function fO(e,t,n){let r=0;return(e.includes("x")||e.includes("X")&&(n||1&t||8&t||64&t))&&(r+=1),e.includes("w")&&(r+=2),e.includes("r")&&(r+=4),r}function gO(e,t){let n=0;return e.includes("u")&&(n+=t<<6),e.includes("g")&&(n+=t<<3),e.includes("o")&&(n+=t),n}function mO(e,t,n){return t.includes("t")&&(n+=parseInt("1000",8)),t.includes("s")&&(e.includes("u")&&(n+=parseInt("4000",8)),e.includes("g")&&(n+=parseInt("2000",8))),n}function yO(e,t,n){t||(t=0);const r=e.match(/^(u?g?o?a?)(-?\+?=?)?(r?w?x?X?s?t?)$/);if(!r)throw new Error(`Invalid file mode: ${e}`);let[,s,i,o]=r;"a"!==s&&s||(s="ugo");let a=fO(o,t,n);return a=gO(s,a),a=mO(s,o,a),"="===i?(s.includes("u")&&(t&=parseInt("7077",8),t|=a),s.includes("g")&&(t&=parseInt("7707",8),t|=a),s.includes("o")&&(t&=parseInt("7770",8),t|=a),t):"+"===i?a|t:"-"===i?a^t:t}function wO(e,t){if(e instanceof String||"string"===typeof e){const n=`${e}`;e=n.match(/^\d+$/g)?parseInt(n,8):0+n.split(",").reduce(((e,n)=>yO(n,e,t.isDirectory())),t.mode||0)}return e}function bO(e){async function t(t,n,r={}){const s=hO(pO,r);dO(`Fetching stats for ${t}`);const{cid:i,mfsDirectory:o,name:a}=await oR(e,t,s);if(i.code!==wn)throw je(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");if(s.recursive){const r=await vm((async function*(){for await(const r of uv(i,e.repo.blocks)){if("file"!==r.type&&"directory"!==r.type)throw je(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");r.unixfs.mode=wO(n,r.unixfs);const e=pn({Data:r.unixfs.marshal(),Links:r.node.Links});yield{path:r.path,content:e}}}),(t=>gb(t,e.repo.blocks,{...s,pin:!1,dagBuilder:async function*(e,t,n){for await(const r of e)yield async function(){const e=r.content,s=bn(e),i=await fR(s,t,n);if(!e.Data)throw je(new Error(`${i} had no data`),"ERR_INVALID_NODE");const o=tt.unmarshal(e.Data);return{cid:i,size:s.length,path:r.path,unixfs:o}}}})),(e=>qu(e)));if(!r)throw je(new Error(`Could not chmod ${t}`),"ERR_COULD_NOT_CHMOD");return await lO(e)(t,s),void await JR(e)(`/ipfs/${r.cid}`,t,s)}const c=await e.repo.blocks.get(i),l=vn(c);if(!l.Data)throw je(new Error(`${i} had no data`),"ERR_INVALID_NODE");const u=tt.unmarshal(l.Data);u.mode=wO(n,u);const h=bn({Data:u.marshal(),Links:l.Links}),d=s.hashAlg||pO.hashAlg,p=await e.hashers.getHasher(d),f=await p.digest(h),g=Lt.create(s.cidVersion,wn,f);s.flush&&await e.repo.blocks.put(g,h);const m=await pR(e,o),y=m[m.length-1],w=Lt.decode(y.cid.bytes),b=await e.repo.blocks.get(w),v=vn(b),E=await OR(e,{parent:v,name:a,cid:g,size:h.length,flush:s.flush,hashAlg:d,cidVersion:i.version,shardSplitThreshold:1/0});y.cid=E.cid;const _=await UR(e,m,s);await FR(e,_,s)}return pl(t)}const vO=ne.bind({ignoreUndefined:!0}),EO={};function _O(e){async function t(t,n={}){n=vO(EO,n);const{cid:r}=await uR(e)(t,n);return r}return pl(t)}const SO=ne.bind({ignoreUndefined:!0}),kO={parents:!1,flush:!0,cidVersion:0,hashAlg:"sha2-256",shardSplitThreshold:1e3};function AO(e){async function t(t,n,r={}){const s=SO(kO,r);await JR(e)(t,n,s),await lO(e)(t,{...s,recursive:!0})}return pl(t)}const TO=ne.bind({ignoreUndefined:!0}),CO=Fe("ipfs:mfs:touch"),IO={flush:!0,shardSplitThreshold:1e3,cidVersion:0,hashAlg:"sha2-256"};function RO(e){async function t(t,n={}){const r=TO(IO,n);r.mtime=r.mtime||new Date,CO(`Touching ${t} mtime: ${r.mtime}`);const{cid:s,mfsDirectory:i,name:o,exists:a}=await oR(e,t,r),c=n.hashAlg||IO.hashAlg,l=await e.hashers.getHasher(c);let u,h,d=r.cidVersion;if(a){if(s.code!==wn)throw je(new Error(`${t} was not a UnixFS node`),"ERR_NOT_UNIXFS");d=s.version;const n=await e.repo.blocks.get(s),i=vn(n);if(!i.Data)throw je(new Error(`${t} had no data`),"ERR_INVALID_NODE");const o=tt.unmarshal(i.Data);o.mtime=r.mtime,u=bn({Data:o.marshal(),Links:i.Links});const a=await l.digest(u);h=Lt.create(r.cidVersion,wn,a),r.flush&&await e.repo.blocks.put(h,u)}else{const t=new tt({type:"file",mtime:r.mtime});u=bn({Data:t.marshal(),Links:[]});const n=await l.digest(u);h=Lt.create(r.cidVersion,wn,n),r.flush&&await e.repo.blocks.put(h,u)}const p=await pR(e,i),f=p[p.length-1],g=f.cid,m=await e.repo.blocks.get(g),y=vn(m),w=await OR(e,{parent:y,name:o,cid:h,size:u.length,flush:r.flush,shardSplitThreshold:r.shardSplitThreshold,hashAlg:r.hashAlg,cidVersion:d});f.cid=w.cid;const b=await UR(e,p,r);await FR(e,b,r)}return pl(t)}const OO=ne.bind({ignoreUndefined:!0}),xO={offset:0,length:1/0};function NO(e){function t(t,n={}){return n=OO(xO,n),{[Symbol.asyncIterator]:async function*(){const r=await oR(e,t,n),s=await lv(r.mfsPath,e.repo.blocks);if("file"!==s.type)throw je(new Error(`${t} was not a file`),"ERR_NOT_FILE");if(!s.content)throw je(new Error(`Could not load content stream from ${t}`),"ERR_NO_CONTENT");for await(const e of s.content({offset:n.offset,length:n.length}))yield e}}}return pl(t)}const DO=Fe("ipfs:mfs:utils:to-async-iterator");function PO(e){if(!e)throw je(new Error("paths must start with a leading slash"),"ERR_INVALID_PATH");if(("string"===typeof e||e instanceof String)&&(DO("Content was a string"),e=$o(e.toString())),e.length)return DO("Content was array-like"),{[Symbol.asyncIterator]:function*(){yield e}};if(e[Symbol.asyncIterator])return DO("Content was an async iterator"),e;if(e[Symbol.iterator])return DO("Content was an iterator"),e;if(global.Blob&&e instanceof global.Blob){DO("Content was an HTML5 Blob");let t=0;const n={next:()=>t>e.size?{done:!0}:new Promise(((n,r)=>{const s=e.slice(t,bl);t+=bl;const i=new global.FileReader,o=e=>{if(i.removeEventListener("loadend",o,!1),e.error)return r(e.error);n({done:!1,value:new Uint8Array(i.result)})};i.addEventListener("loadend",o),i.readAsArrayBuffer(s)}))};return{[Symbol.asyncIterator]:()=>n}}throw je(new Error(`Don't know how to convert ${e} into an async iterator`),"ERR_INVALID_PARAMS")}const LO=ne.bind({ignoreUndefined:!0}),MO=Fe("ipfs:mfs:write"),BO={offset:0,length:1/0,create:!1,truncate:!1,rawLeaves:!1,reduceSingleLeafToSelf:!1,cidVersion:0,hashAlg:"sha2-256",parents:!1,progress:(e,t)=>{},strategy:"trickle",flush:!0,leafType:"raw",shardSplitThreshold:1e3};function UO(e){async function t(t,n,r={}){const s=LO(BO,r);let i,o,a;if(MO("Reading source, destination and parent"),await tR().readLock((async()=>{i=await PO(n),o=await oR(e,t,s),a=await oR(e,o.mfsDirectory,s)}))(),MO("Read source, destination and parent"),!s.parents&&!a.exists)throw je(new Error("directory does not exist"),"ERR_NO_EXIST");if(null==i)throw je(new Error("could not create source"),"ERR_NO_SOURCE");if(null==o)throw je(new Error("could not create destination"),"ERR_NO_DESTINATION");if(!s.create&&!o.exists)throw je(new Error("file does not exist"),"ERR_NO_EXIST");if("file"!==o.entryType)throw je(new Error("not a file"),"ERR_NOT_A_FILE");return VO(e,t,i,o,s)}return pl(t)}const VO=async(e,t,n,r,s)=>{const i=await FO(e,n,r,s);await tR().writeLock((async()=>{const n=sR(t),r=n.pop();if(null==r)throw je(new Error("source does not exist"),"ERR_NO_EXIST");let o=!1;try{await uR(e)(`/${n.join("/")}`,s),o=!0}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}o||await KR(e)(`/${n.join("/")}`,s);const a=await oR(e,t,s),c=await pR(e,a.mfsDirectory),l=c[c.length-1];if(!l)throw je(new Error("directory does not exist"),"ERR_NO_EXIST");if(!l.type||!l.type.includes("directory"))throw je(new Error(`cannot write to ${l.name}: Not a directory`),"ERR_NOT_A_DIRECTORY");const u=await e.repo.blocks.get(l.cid),h=vn(u),d=await OR(e,{parent:h,name:r,cid:i.cid,size:i.size,flush:s.flush,shardSplitThreshold:s.shardSplitThreshold,hashAlg:s.hashAlg,cidVersion:s.cidVersion});l.cid=d.cid;const p=await UR(e,c,s);await FR(e,p,s)}))()},FO=async(e,t,n,r)=>{n.exists?MO(`Overwriting file ${n.cid} offset ${r.offset} length ${r.length}`):MO(`Writing file offset ${r.offset} length ${r.length}`);const s=[];if(r.offset>0)if(n.unixfs){if(MO(`Writing first ${r.offset} bytes of original file`),s.push((()=>n.content({offset:0,length:r.offset}))),n.unixfs.fileSize()<r.offset){const e=r.offset-n.unixfs.fileSize();MO(`Writing zeros for extra ${e} bytes`),s.push(zO(e))}}else MO(`Writing zeros for first ${r.offset} bytes`),s.push(zO(r.offset));s.push(jO(t,r.length));const i=HO($O(s),(e=>{if(n.unixfs&&!r.truncate){const t=n.unixfs.fileSize();if(t>e)return MO(`Writing last ${t-e} of ${t} bytes from original file starting at offset ${e}`),n.content({offset:e});MO("Not writing last bytes from original file")}return{[Symbol.asyncIterator]:async function*(){}}}));let o,a;void 0!==r.mode&&null!==r.mode?o=Ze(r.mode):n&&n.unixfs&&(o=n.unixfs.mode),null!=r.mtime?a=et(r.mtime):n&&n.unixfs&&(a=n.unixfs.mtime);const c=await e.hashers.getHasher(r.hashAlg),l=await qu(gb([{content:i,mode:o,mtime:a}],e.repo.blocks,{progress:r.progress,hasher:c,cidVersion:r.cidVersion,strategy:r.strategy,rawLeaves:r.rawLeaves,reduceSingleLeafToSelf:r.reduceSingleLeafToSelf,leafType:r.leafType}));if(!l)throw je(new Error(`cannot write to ${parent.name}`),"ERR_COULD_NOT_WRITE");return MO(`Wrote ${l.cid}`),{cid:l.cid,size:l.size}},jO=(e,t)=>async function*(){let n=0;for await(const r of e){if(n+=r.length,n>t)return void(yield r.subarray(0,t-n));yield r}},zO=(e,t=bl)=>{const n=new Uint8Array(t);async function*r(){while(1)yield n}return jO(r(),e)},$O=async function*(e){for(let t=0;t<e.length;t++)yield*e[t]()},HO=async function*(e,t){let n=0;for await(const r of e)n+=r.length,yield r;for await(const r of t(n))n+=r.length,yield r},KO=e=>{const t={cid:e.cid,name:e.name,type:"directory"===e.type?"directory":"file",size:e.size};return"file"!==e.type&&"directory"!==e.type||(t.mode=e.unixfs.mode,t.mtime=e.unixfs.mtime),t};function qO(e){async function*t(t,n={}){const r=await oR(e,t,n),s=await lv(r.mfsPath,e.repo.blocks);"directory"!==s.type?yield KO(s):yield*Iy(s.content(n),KO)}return pl(t)}const GO={stat:uR},WO={chmod:bO,cp:JR,flush:_O,mkdir:KR,mv:AO,rm:lO,touch:RO},YO={write:UO,read:NO,ls:qO},JO=({options:e,mfs:t,operations:n,lock:r})=>{Object.keys(n).forEach((s=>{t[s]=r(n[s](e))}))},QO={repoOwner:!0,repo:null};function XO(e){const{repoOwner:t}=Object.assign({},QO||{},e),n=tR(t),r=e=>n.readLock(e),s=e=>n.writeLock(e),i={};return JO({options:e,mfs:i,operations:GO,lock:r}),JO({options:e,mfs:i,operations:WO,lock:s}),Object.keys(YO).forEach((t=>{i[t]=YO[t](e)})),i}function ZO({repo:e,preload:t,hashers:n,options:r}){const s=XO({repo:e,repoOwner:!1!==r.repoOwner,hashers:n}),i=e=>{const n=(...n)=>{const r=n.filter((e=>Qc(e)||Kc(e)));if(r.length){const e=n[n.length-1];e&&!1!==e.preload&&r.forEach((e=>t(e)))}return e(...n)};return n};return{...s,chmod:s.chmod,cp:i(s.cp),mkdir:s.mkdir,stat:i(s.stat),rm:s.rm,read:i(s.read),touch:s.touch,write:s.write,mv:i(s.mv),flush:s.flush,ls:i((async function*(...e){for await(const t of s.ls(...e))yield{...t,size:t.size||0}}))}}function ex({keychain:e}){const t=(t,n)=>e.exportKey(t,n);return pl(t)}const tx="Ed25519",nx=2048;function rx({keychain:e}){const t=(t,n={type:tx,size:nx})=>e.createKey(t,n.type||tx,n.size||nx);return pl(t)}function sx({keychain:e}){const t=(t,n,r)=>e.importKey(t,n,r);return pl(t)}function ix({keychain:e}){const t=t=>e.findKeyByName(t);return pl(t)}function ox({keychain:e}){const t=()=>e.listKeys();return pl(t)}function ax({keychain:e}){const t=async(t,n)=>{const r=await e.renameKey(t,n);return{was:t,now:r.name,id:r.id,overwrite:!1}};return pl(t)}function cx({keychain:e}){const t=t=>e.removeKey(t);return pl(t)}class lx{constructor({keychain:e}){this.gen=rx({keychain:e}),this.list=ox({keychain:e}),this.rm=cx({keychain:e}),this.rename=ax({keychain:e}),this.export=ex({keychain:e}),this.import=sx({keychain:e}),this.info=ix({keychain:e})}}function ux({repo:e,preload:t}){async function n(n,r={}){!1!==r.preload&&t(n);const s=await e.blocks.get(n,r);return vn(s)}return pl(n)}function hx({repo:e,preload:t}){const n=ux({repo:e,preload:t});async function r(e,t={}){const r=await n(e,t);return r.Data||new Uint8Array(0)}return pl(r)}function dx(e,t=[]){for(const r in e){const s=e[r];if("/"===r&&1===Object.keys(e).length)try{t.push({Name:"",Tsize:0,Hash:Lt.parse(s)});continue}catch(n){}const i=Lt.asCID(s);i?t.push({Name:"",Tsize:0,Hash:i}):(Array.isArray(s)&&dx(s,t),s&&"object"===typeof s&&dx(s,t))}return t}function px({repo:e,codecs:t}){async function n(n,r={}){const s=await t.getCodec(n.code),i=await e.blocks.get(n,r),o=s.decode(i);switch(n.code){case go:return[];case wn:return o.Links;case Xs:case yi:return dx(o);default:throw new Error(`Cannot resolve links from codec ${n.code}`)}}return pl(n)}function fx({repo:e,preload:t}){async function n(n={}){let r;if(n.template){if("unixfs-dir"!==n.template)throw new Error("unknown template");r=new tt({type:"directory"}).marshal()}const s=bn({Data:r,Links:[]}),i=await ho.digest(s),o=Lt.createV0(i);return await e.blocks.put(o,s,{signal:n.signal}),!1!==n.preload&&t(o),o}return pl(n)}function gx({repo:e,preload:t}){async function n(n,r={}){const s=await e.gcLock.readLock();try{const s=bn(n),i=await ho.digest(s),o=Lt.createV1(wn,i);return await e.blocks.put(o,s,{signal:r.signal}),!1!==r.preload&&t(o),r.pin&&await e.pins.pinRecursively(o,{signal:r.signal}),o}finally{s()}}return pl(n)}function mx({repo:e,preload:t}){const n=ux({repo:e,preload:t});async function r(e,t={}){const r=await n(e,t),s=bn(r),i=s.length,o=r.Links.reduce(((e,t)=>e+(t.Tsize||0)),0);return{Hash:e,NumLinks:r.Links.length,BlockSize:i,LinksSize:i-(r.Data||[]).length,DataSize:(r.Data||[]).length,CumulativeSize:i+o}}return pl(r)}function yx({repo:e,preload:t}){const n=ux({repo:e,preload:t}),r=gx({repo:e,preload:t});async function s(e,t,s={}){const i=await n(e,s);return r({...i,Links:i.Links.concat([t])},s)}return pl(s)}function wx({repo:e,preload:t}){const n=ux({repo:e,preload:t}),r=gx({repo:e,preload:t});async function s(e,t,s={}){const i=await n(e,s),o=ya([i.Data||[],t]);return r({...i,Data:o},s)}return pl(s)}function bx({repo:e,preload:t}){const n=ux({repo:e,preload:t}),r=gx({repo:e,preload:t});async function s(e,t,s={}){const i=await n(e,s),o=("string"===typeof t?t:t.Name)||"";return i.Links=i.Links.filter((e=>e.Name!==o)),r(i,s)}return pl(s)}function vx({repo:e,preload:t}){const n=ux({repo:e,preload:t}),r=gx({repo:e,preload:t});async function s(e,t,s={}){const i=await n(e,s);return r({...i,Data:t},s)}return pl(s)}class Ex{constructor({repo:e,preload:t}){this.addLink=yx({repo:e,preload:t}),this.appendData=wx({repo:e,preload:t}),this.rmLink=bx({repo:e,preload:t}),this.setData=vx({repo:e,preload:t})}}class _x{constructor({repo:e,codecs:t,preload:n}){this.data=hx({repo:e,preload:n}),this.get=ux({repo:e,preload:n}),this.links=px({repo:e,codecs:t}),this.new=fx({repo:e,preload:n}),this.put=gx({repo:e,preload:n}),this.stat=mx({repo:e,preload:n}),this.patch=new Ex({repo:e,preload:n})}}const Sx=Fe("ipfs:repo:gc");function kx({repo:e,hashers:t}){async function*n(n={}){const r=Date.now();let s;try{s=await rR({repo:e,hashers:t},n),await e.pins.pinRecursively(s),yield*e.gc()}finally{s&&await e.pins.unpin(s)}Sx(`Complete (${Date.now()-r}ms)`)}return pl(n)}function Ax({repo:e}){async function t(t={}){const n=await e.stat();return{numObjects:BigInt(n.numObjects.toString()),repoSize:BigInt(n.repoSize.toString()),repoPath:n.repoPath,version:`${n.version}`,storageMax:BigInt(n.storageMax.toString())}}return pl(t)}const Tx=12;function Cx({repo:e}){async function t(t={}){try{await e._checkInitialized(t)}catch(uS){const t=[/Key not found in database \[\/version\]/,/ENOENT/,/repo is not initialized yet/].some((t=>t.test(uS.message)));if(t)return Tx;throw uS}return e.version.get()}return pl(t)}class Ix{constructor({repo:e,hashers:t}){this.gc=kx({repo:e,hashers:t}),this.stat=Ax({repo:e}),this.version=Cx({repo:e}),this.setApiAddr=t=>e.apiAddr.set(t)}}function Rx(e,t){let n;if(n=e.metrics?t.peer?e.metrics.forPeer(t.peer):t.proto?e.metrics.forProtocol(t.proto):e.metrics.getGlobal():void 0,!n)return{totalIn:BigInt(0),totalOut:BigInt(0),rateIn:0,rateOut:0};const r=n.getMovingAverages(),s=n.getSnapshot();return{totalIn:s.dataReceived,totalOut:s.dataSent,rateIn:r.dataReceived[6e4].movingAverage/60,rateOut:r.dataSent[6e4].movingAverage/60}}function Ox({network:e}){const t=async function*(t={}){const{libp2p:n}=await e.use(t);if(!t.poll)return void(yield Rx(n,t));const r=t.interval||1e3;let s,i=-1;try{if(i="string"===typeof r?hl(r)||-1:r,!i||i<0)throw new Error("invalid duration")}catch(uS){throw je(uS,"ERR_INVALID_POLL_INTERVAL")}try{while(1)yield Rx(n,t),await new Promise((e=>{s=setTimeout(e,i)}))}finally{clearTimeout(s)}};return pl(t)}class xx{constructor({repo:e,network:t}){this.repo=Ax({repo:e}),this.bw=Ox({network:t}),this.bitswap=py({network:t})}}var Nx=Dx;function Dx(e,t,n){if(!e)return n;var r,s;if(Array.isArray(t)&&(r=t.slice(0)),"string"==typeof t&&(r=t.split(".")),"symbol"==typeof t&&(r=[t]),!Array.isArray(r))throw new Error("props arg must be an array, a string or a symbol");while(r.length){if(s=r.shift(),!e)return n;if(e=e[s],void 0===e)return n}return e}async function Px(e){let t=0;for await(const n of e)t++;return t}const Lx=se("ipfs:repo:migrator:migration-8");function Mx(e){return e.child?Mx(e.child):e}function Bx(e){try{const t=Ce.decode(`b${e.toString().toLowerCase().slice(1)}`),n=Lt.decode(t).multihash.bytes,r=Ce.encode(n).slice(1).toUpperCase();return new rl(`/${r}`,!1)}catch(uS){return e}}function Ux(e){try{const t=Ce.decode(`b${e.toString().toLowerCase().slice(1)}`),n=Rt(t),r=Ce.encode(Lt.createV1(go,n).bytes).slice(1);return new rl(`/${r.toUpperCase()}`,!1)}catch{return e}}async function Vx(e,t,n){const r=e.blocks;await r.open();const s=Mx(r),i=await Px(s.queryKeys({filters:[e=>{const t=n(e);return t.toString()!==e.toString()}]}));try{let e=0;for await(const r of s.query({})){const o=n(r.key);o.toString()!==r.key.toString()&&(e+=1,Lx(`Migrating Block from ${r.key} to ${o}`,await s.has(r.key)),await s.delete(r.key),await s.put(o,r.value),t(e/i*100,`Migrated Block from ${r.key} to ${o}`))}}finally{await r.close()}}const Fx={version:8,description:"Transforms key names into base32 encoding and converts Block store to use bare multihashes encoded as base32",migrate:(e,t=(()=>{}))=>Vx(e,t,Bx),revert:(e,t=(()=>{}))=>Vx(e,t,Ux)},jx=ze.Reader,zx=ze.Writer,$x=(ze.util,ze.roots["default"]||(ze.roots["default"]={})),Hx=$x.ipfs=(()=>{const e={};return e.pin=function(){const e={};return e.Set=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.version=0,e.prototype.fanout=0,e.prototype.seed=0,e.encode=function(e,t){return t||(t=zx.create()),null!=e.version&&Object.hasOwnProperty.call(e,"version")&&t.uint32(8).uint32(e.version),null!=e.fanout&&Object.hasOwnProperty.call(e,"fanout")&&t.uint32(16).uint32(e.fanout),null!=e.seed&&Object.hasOwnProperty.call(e,"seed")&&t.uint32(29).fixed32(e.seed),t},e.decode=function(e,t){e instanceof jx||(e=jx.create(e));var n=void 0===t?e.len:e.pos+t,r=new $x.ipfs.pin.Set;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.version=e.uint32();break;case 2:r.fanout=e.uint32();break;case 3:r.seed=e.fixed32();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof $x.ipfs.pin.Set)return e;var t=new $x.ipfs.pin.Set;return null!=e.version&&(t.version=e.version>>>0),null!=e.fanout&&(t.fanout=e.fanout>>>0),null!=e.seed&&(t.seed=e.seed>>>0),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.version=0,n.fanout=0,n.seed=0),null!=e.version&&e.hasOwnProperty("version")&&(n.version=e.version),null!=e.fanout&&e.hasOwnProperty("fanout")&&(n.fanout=e.fanout),null!=e.seed&&e.hasOwnProperty("seed")&&(n.seed=e.seed),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e}(),e}(),e})();var Kx=n(336);const qx=new rl("/local/pins"),Gx=256,Wx=8192,Yx=Lt.parse("QmdfTbBqBPQ7VNxZEYEj14VmRuZBkqFbiwReogJgS1zR1n"),Jx={direct:"direct",recursive:"recursive"};function Qx(e){return new rl(`/${Ce.encode(e.multihash.bytes).toUpperCase().substring(1)}`)}function Xx(e,t){for(let n=0;n<e.byteLength;n++){if(e[n]<t[n])return-1;if(e[n]>t[n])return 1}return e.byteLength>t.byteLength?1:e.byteLength<t.byteLength?-1:0}const Zx=Hx.pin.Set;function eN(e){const t=e.Data;if(!t)throw new Error("No data present");const n=ma.decode(t),r=ma.decode.bytes;if(r<=0)throw new Error("Invalid Set header length");if(r+n>t.length)throw new Error("Impossibly large set header length");const s=t.slice(r,n+r),i=Zx.toObject(Zx.decode(s),{defaults:!1,arrays:!0,longs:Number,objects:!1});if(1!==i.version)throw new Error(`Unsupported Set version: ${i.version}`);if(i.fanout>e.Links.length)throw new Error("Impossibly large fanout");return{header:i,data:t.slice(n+r)}}function tN(e,t){const n=new Uint8Array(4),r=new DataView(n.buffer);r.setUint32(0,e,!0);const s=$o(t.toString()),i=ya([n,s],n.byteLength+s.byteLength);return Kx(ia(i))}async function*nN(e,t){const n=eN(t);let r=0;for(const s of t.Links){if(r<n.header.fanout){const t=s.Hash;if(!Yx.equals(t)){const n=await e.get(t),r=vn(n);yield*nN(e,r)}}else yield s.Hash;r++}}async function*rN(e,t,n){const r=t.Links.find((e=>e.Name===n));if(!r)throw new Error("No link found with name "+n);const s=await e.get(r.Hash),i=vn(s);yield*nN(e,i)}function sN(e,t){return n(t,0);async function n(t,r){const s=Zx.encode({version:1,fanout:Gx,seed:r}).finish(),i=ma.encode(s.length),o=ya([i,s]),a=[];for(let e=0;e<Gx;e++)a.push({Name:"",Tsize:1,Hash:Yx});if(t.length<=Wx){const e=t.map((e=>({link:{Name:"",Tsize:1,Hash:e.key},data:e.data||new Uint8Array}))).sort(((e,t)=>Xx(e.link.Hash.bytes,t.link.Hash.bytes))),n=a.concat(e.map((e=>e.link))),r=ya([o,...e.map((e=>e.data))]);return{Data:r,Links:n}}{const e=t.reduce(((e,t)=>{const n=tN(r,t.key)%Gx;return e[n]=n in e?e[n].concat([t]):[t],e}),[]);let s=0;for(const t of e){const e=await n(t,r+1);await c(e,s),s++}return{Data:o,Links:a}}async function c(t,n){const r=bn(t),s=await ho.digest(r),i=Lt.createV0(s);await e.put(i,r);const o=t.Links.reduce(((e,t)=>e+(t.Tsize||0)),0)+r.length;a[n]={Name:"",Tsize:o,Hash:i}}}}async function iN(e,t,n){const r=await sN(e,n.map((e=>({key:e})))),s=bn(r),i=await ho.digest(s),o=Lt.createV0(i);await e.put(o,s);const a=r.Links.reduce(((e,t)=>e+t.Tsize),0)+s.length;return{Name:t,Tsize:a,Hash:o}}async function oN(e,t,n,r){if(!await t.has(qx))return;const s=await t.get(qx),i=Lt.decode(s),o=await e.get(i),a=vn(o);let c=0;const l=await Px(rN(e,a,Jx.recursive))+await Px(rN(e,a,Jx.direct));for await(const u of rN(e,a,Jx.recursive)){c++;const e={depth:1/0};0!==u.version&&(e.version=u.version),u.code!==wn&&(e.codec=u.code),await n.put(Qx(u),Ls(e)),r(c/l*100,`Migrated recursive pin ${u}`)}for await(const u of rN(e,a,Jx.direct)){c++;const e={depth:0};0!==u.version&&(e.version=u.version),u.code!==wn&&(e.codec=u.code),await n.put(Qx(u),Ls(e)),r(c/l*100,`Migrated direct pin ${u}`)}await e.delete(i),await t.delete(qx)}async function aN(e,t,n,r){const s=[],i=[];let o=0;const a=await Px(n.queryKeys({}));for await(const{key:d,value:p}of n.query({})){o++;const e=$s(p),t=Lt.create(e.version||0,e.codec||wn,Rt(Ce.decode("b"+d.toString().toLowerCase().split("/").pop())));0===e.depth?(r(o/a*100,`Reverted direct pin ${t}`),i.push(t)):(r(o/a*100,`Reverted recursive pin ${t}`),s.push(t))}r(100,"Updating pin root");const c={Links:[await iN(e,Jx.direct,i),await iN(e,Jx.recursive,s)]},l=bn(c),u=await ho.digest(l),h=Lt.createV0(u);await e.put(h,l),await t.put(qx,h.bytes)}async function cN(e,t,n){const r=e.blocks,s=e.datastore,i=e.pins;await r.open(),await s.open(),await i.open();try{await n(r,s,i,t)}finally{await i.close(),await s.close(),await r.close()}}const lN={version:9,description:"Migrates pins to datastore",migrate:(e,t=(()=>{}))=>cN(e,t,oN),revert:(e,t=(()=>{}))=>cN(e,t,aN)},uN=new rl("/config"),hN=new rl("/version");function dN(e){let t=e;while(t.db||t.child)if(t=t.db||t.child,"level-js"===t.type||"Level"===t.constructor.name)return t}async function pN(e,t,n){const r=await t(e);if(r)return r;const s=dN(n);return!!s&&new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{t(Boolean(r.result))}}))}async function fN(e,t,n,r){if(await n(e))return t(e);const s=dN(r);if(!s)throw oh();return new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{if(r.result)return t(r.result);n(oh())}}))}function gN(e){const t=e.get.bind(e),n=e.has.bind(e);return e.get=r=>fN(r,t,n,e),e.has=t=>pN(t,n,e),e}function mN(e){return{...e,root:gN(e.root),datastore:gN(e.datastore),pins:gN(e.pins),keys:gN(e.keys)}}async function yN(e,t,n=(()=>{})){const r=dN(t);if(!r)return void n(`${e} did not need an upgrade`);n(`Upgrading ${e}`);const s=(e,t)=>[{type:"del",key:e},{type:"put",key:$o(e),value:t}];await _N(r,s)}async function wN(e,t,n=(()=>{})){const r=dN(t);if(!r)return void n(`${e} did not need a downgrade`);n(`Downgrading ${e}`);const s=(e,t)=>[{type:"del",key:e},{type:"put",key:ia(e),value:t}];await _N(r,s)}function bN(e){return e.child?bN(e.child):e}async function vN(e,t,n){const r=Object.entries(e).map((([e,t])=>({key:e,backend:bN(t)}))).filter((({key:e,backend:t})=>"LevelDatastore"===t.constructor.name)).map((({key:e,backend:t})=>({name:e,store:t})));t(0,`Migrating ${r.length} dbs`);let s=0;const i=e=>{t(Math.round(s/r.length*100),e)};for(const{name:o,store:a}of r){await a.open();try{await n(o,a,i)}finally{s++,await a.close()}}t(100,`Migrated ${r.length} dbs`)}const EN={version:10,description:"Migrates datastore-level keys to binary",migrate:(e,t=(()=>{}))=>vN(e,t,yN),revert:(e,t=(()=>{}))=>vN(e,t,wN)};function _N(e,t){function n(t,n){const r=e.store("readwrite"),s=r.transaction;let i,o=0;function a(){const e=t[o++],n=e.key;let c;try{c="del"===e.type?r.delete(n):r.put(e.value,n)}catch(uS){return i=uS,void s.abort()}o<t.length&&(c.onsuccess=a)}s.onabort=()=>n(i||s.error||new Error("aborted by user")),s.oncomplete=()=>n(),a()}return new Promise(((r,s)=>{const i=e.iterator(),o=e=>e;function a(){const e=(e,o,c)=>{if(e||void 0===o){const e=e=>{e?s(e):r()};i.end(e)}else n(t(o,c),a)};i.next(e)}i._deserializeKey=i._deserializeValue=o,a()}))}const SN=new rl("/local/filesroot");async function kN(e,t=(()=>{})){if(t(100,"Migrating MFS root to repo datastore"),await e.root.open(),await e.datastore.open(),await e.root.has(SN)){const t=await e.root.get(SN);await e.datastore.put(SN,t),await e.root.delete(SN)}await e.datastore.close(),await e.root.close(),t(100,"Stored MFS root in repo datastore")}async function AN(e,t=(()=>{})){if(t(100,"Migrating MFS root to repo root datastore"),await e.root.open(),await e.datastore.open(),await e.datastore.has(SN)){const t=await e.datastore.get(SN);await e.root.put(SN,t),await e.datastore.delete(SN)}await e.datastore.close(),await e.root.close(),t(100,"Stored MFS root in repo root datastore")}const TN={version:11,description:"Store mfs root in the datastore",migrate:kN,revert:AN},CN=ze.Reader,IN=ze.Writer,RN=ze.util,ON=ze.roots["default"]||(ze.roots["default"]={}),xN=ON.Protocols=(()=>{function e(e){if(this.protocols=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.protocols=RN.emptyArray,e.encode=function(e,t){if(t||(t=IN.create()),null!=e.protocols&&e.protocols.length)for(var n=0;n<e.protocols.length;++n)t.uint32(10).string(e.protocols[n]);return t},e.decode=function(e,t){e instanceof CN||(e=CN.create(e));var n=void 0===t?e.len:e.pos+t,r=new ON.Protocols;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.protocols&&r.protocols.length||(r.protocols=[]),r.protocols.push(e.string());break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof ON.Protocols)return e;var t=new ON.Protocols;if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Protocols.protocols: array expected");t.protocols=[];for(var n=0;n<e.protocols.length;++n)t.protocols[n]=String(e.protocols[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.protocols=[]),e.protocols&&e.protocols.length){n.protocols=[];for(var r=0;r<e.protocols.length;++r)n.protocols[r]=e.protocols[r]}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),NN=ze.Reader,DN=ze.Writer,PN=ze.util,LN=ze.roots["default"]||(ze.roots["default"]={}),MN=LN.Addresses=(()=>{function e(e){if(this.addrs=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.addrs=PN.emptyArray,e.prototype.certifiedRecord=null,e.encode=function(e,t){if(t||(t=DN.create()),null!=e.addrs&&e.addrs.length)for(var n=0;n<e.addrs.length;++n)LN.Addresses.Address.encode(e.addrs[n],t.uint32(10).fork()).ldelim();return null!=e.certifiedRecord&&Object.hasOwnProperty.call(e,"certifiedRecord")&&LN.Addresses.CertifiedRecord.encode(e.certifiedRecord,t.uint32(18).fork()).ldelim(),t},e.decode=function(e,t){e instanceof NN||(e=NN.create(e));var n=void 0===t?e.len:e.pos+t,r=new LN.Addresses;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.addrs&&r.addrs.length||(r.addrs=[]),r.addrs.push(LN.Addresses.Address.decode(e,e.uint32()));break;case 2:r.certifiedRecord=LN.Addresses.CertifiedRecord.decode(e,e.uint32());break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof LN.Addresses)return e;var t=new LN.Addresses;if(e.addrs){if(!Array.isArray(e.addrs))throw TypeError(".Addresses.addrs: array expected");t.addrs=[];for(var n=0;n<e.addrs.length;++n){if("object"!==typeof e.addrs[n])throw TypeError(".Addresses.addrs: object expected");t.addrs[n]=LN.Addresses.Address.fromObject(e.addrs[n])}}if(null!=e.certifiedRecord){if("object"!==typeof e.certifiedRecord)throw TypeError(".Addresses.certifiedRecord: object expected");t.certifiedRecord=LN.Addresses.CertifiedRecord.fromObject(e.certifiedRecord)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.addrs=[]),t.defaults&&(n.certifiedRecord=null),e.addrs&&e.addrs.length){n.addrs=[];for(var r=0;r<e.addrs.length;++r)n.addrs[r]=LN.Addresses.Address.toObject(e.addrs[r],t)}return null!=e.certifiedRecord&&e.hasOwnProperty("certifiedRecord")&&(n.certifiedRecord=LN.Addresses.CertifiedRecord.toObject(e.certifiedRecord,t)),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.Address=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.multiaddr=PN.newBuffer([]),e.prototype.isCertified=null,Object.defineProperty(e.prototype,"_isCertified",{get:PN.oneOfGetter(t=["isCertified"]),set:PN.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=DN.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof NN||(e=NN.create(e));var n=void 0===t?e.len:e.pos+t,r=new LN.Addresses.Address;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof LN.Addresses.Address)return e;var t=new LN.Addresses.Address;return null!=e.multiaddr&&("string"===typeof e.multiaddr?PN.base64.decode(e.multiaddr,t.multiaddr=PN.newBuffer(PN.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.multiaddr="":(n.multiaddr=[],t.bytes!==Array&&(n.multiaddr=PN.newBuffer(n.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(n.multiaddr=t.bytes===String?PN.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(n.isCertified=e.isCertified,t.oneofs&&(n._isCertified="isCertified")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e}(),e.CertifiedRecord=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.seq=PN.Long?PN.Long.fromBits(0,0,!0):0,e.prototype.raw=PN.newBuffer([]),e.encode=function(e,t){return t||(t=DN.create()),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(8).uint64(e.seq),null!=e.raw&&Object.hasOwnProperty.call(e,"raw")&&t.uint32(18).bytes(e.raw),t},e.decode=function(e,t){e instanceof NN||(e=NN.create(e));var n=void 0===t?e.len:e.pos+t,r=new LN.Addresses.CertifiedRecord;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.seq=e.uint64();break;case 2:r.raw=e.bytes();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof LN.Addresses.CertifiedRecord)return e;var t=new LN.Addresses.CertifiedRecord;return null!=e.seq&&(PN.Long?(t.seq=PN.Long.fromValue(e.seq)).unsigned=!0:"string"===typeof e.seq?t.seq=parseInt(e.seq,10):"number"===typeof e.seq?t.seq=e.seq:"object"===typeof e.seq&&(t.seq=new PN.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),null!=e.raw&&("string"===typeof e.raw?PN.base64.decode(e.raw,t.raw=PN.newBuffer(PN.base64.length(e.raw)),0):e.raw.length&&(t.raw=e.raw)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(PN.Long){var r=new PN.Long(0,0,!0);n.seq=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.seq=t.longs===String?"0":0;t.bytes===String?n.raw="":(n.raw=[],t.bytes!==Array&&(n.raw=PN.newBuffer(n.raw)))}return null!=e.seq&&e.hasOwnProperty("seq")&&("number"===typeof e.seq?n.seq=t.longs===String?String(e.seq):e.seq:n.seq=t.longs===String?PN.Long.prototype.toString.call(e.seq):t.longs===Number?new PN.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),null!=e.raw&&e.hasOwnProperty("raw")&&(n.raw=t.bytes===String?PN.base64.encode(e.raw,0,e.raw.length):t.bytes===Array?Array.prototype.slice.call(e.raw):e.raw),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e}(),e})(),BN=ze.Reader,UN=ze.Writer,VN=ze.util,FN=ze.roots["default"]||(ze.roots["default"]={}),jN=FN.Peer=(()=>{function e(e){if(this.addresses=[],this.protocols=[],this.metadata=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.addresses=VN.emptyArray,e.prototype.protocols=VN.emptyArray,e.prototype.metadata=VN.emptyArray,e.prototype.pubKey=null,e.prototype.peerRecordEnvelope=null,Object.defineProperty(e.prototype,"_pubKey",{get:VN.oneOfGetter(t=["pubKey"]),set:VN.oneOfSetter(t)}),Object.defineProperty(e.prototype,"_peerRecordEnvelope",{get:VN.oneOfGetter(t=["peerRecordEnvelope"]),set:VN.oneOfSetter(t)}),e.encode=function(e,t){if(t||(t=UN.create()),null!=e.addresses&&e.addresses.length)for(var n=0;n<e.addresses.length;++n)FN.Address.encode(e.addresses[n],t.uint32(10).fork()).ldelim();if(null!=e.protocols&&e.protocols.length)for(n=0;n<e.protocols.length;++n)t.uint32(18).string(e.protocols[n]);if(null!=e.metadata&&e.metadata.length)for(n=0;n<e.metadata.length;++n)FN.Metadata.encode(e.metadata[n],t.uint32(26).fork()).ldelim();return null!=e.pubKey&&Object.hasOwnProperty.call(e,"pubKey")&&t.uint32(34).bytes(e.pubKey),null!=e.peerRecordEnvelope&&Object.hasOwnProperty.call(e,"peerRecordEnvelope")&&t.uint32(42).bytes(e.peerRecordEnvelope),t},e.decode=function(e,t){e instanceof BN||(e=BN.create(e));var n=void 0===t?e.len:e.pos+t,r=new FN.Peer;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.addresses&&r.addresses.length||(r.addresses=[]),r.addresses.push(FN.Address.decode(e,e.uint32()));break;case 2:r.protocols&&r.protocols.length||(r.protocols=[]),r.protocols.push(e.string());break;case 3:r.metadata&&r.metadata.length||(r.metadata=[]),r.metadata.push(FN.Metadata.decode(e,e.uint32()));break;case 4:r.pubKey=e.bytes();break;case 5:r.peerRecordEnvelope=e.bytes();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof FN.Peer)return e;var t=new FN.Peer;if(e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".Peer.addresses: array expected");t.addresses=[];for(var n=0;n<e.addresses.length;++n){if("object"!==typeof e.addresses[n])throw TypeError(".Peer.addresses: object expected");t.addresses[n]=FN.Address.fromObject(e.addresses[n])}}if(e.protocols){if(!Array.isArray(e.protocols))throw TypeError(".Peer.protocols: array expected");t.protocols=[];for(n=0;n<e.protocols.length;++n)t.protocols[n]=String(e.protocols[n])}if(e.metadata){if(!Array.isArray(e.metadata))throw TypeError(".Peer.metadata: array expected");t.metadata=[];for(n=0;n<e.metadata.length;++n){if("object"!==typeof e.metadata[n])throw TypeError(".Peer.metadata: object expected");t.metadata[n]=FN.Metadata.fromObject(e.metadata[n])}}return null!=e.pubKey&&("string"===typeof e.pubKey?VN.base64.decode(e.pubKey,t.pubKey=VN.newBuffer(VN.base64.length(e.pubKey)),0):e.pubKey.length&&(t.pubKey=e.pubKey)),null!=e.peerRecordEnvelope&&("string"===typeof e.peerRecordEnvelope?VN.base64.decode(e.peerRecordEnvelope,t.peerRecordEnvelope=VN.newBuffer(VN.base64.length(e.peerRecordEnvelope)),0):e.peerRecordEnvelope.length&&(t.peerRecordEnvelope=e.peerRecordEnvelope)),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.addresses=[],n.protocols=[],n.metadata=[]),e.addresses&&e.addresses.length){n.addresses=[];for(var r=0;r<e.addresses.length;++r)n.addresses[r]=FN.Address.toObject(e.addresses[r],t)}if(e.protocols&&e.protocols.length){n.protocols=[];for(r=0;r<e.protocols.length;++r)n.protocols[r]=e.protocols[r]}if(e.metadata&&e.metadata.length){n.metadata=[];for(r=0;r<e.metadata.length;++r)n.metadata[r]=FN.Metadata.toObject(e.metadata[r],t)}return null!=e.pubKey&&e.hasOwnProperty("pubKey")&&(n.pubKey=t.bytes===String?VN.base64.encode(e.pubKey,0,e.pubKey.length):t.bytes===Array?Array.prototype.slice.call(e.pubKey):e.pubKey,t.oneofs&&(n._pubKey="pubKey")),null!=e.peerRecordEnvelope&&e.hasOwnProperty("peerRecordEnvelope")&&(n.peerRecordEnvelope=t.bytes===String?VN.base64.encode(e.peerRecordEnvelope,0,e.peerRecordEnvelope.length):t.bytes===Array?Array.prototype.slice.call(e.peerRecordEnvelope):e.peerRecordEnvelope,t.oneofs&&(n._peerRecordEnvelope="peerRecordEnvelope")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),zN=(FN.Address=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}let t;return e.prototype.multiaddr=VN.newBuffer([]),e.prototype.isCertified=null,Object.defineProperty(e.prototype,"_isCertified",{get:VN.oneOfGetter(t=["isCertified"]),set:VN.oneOfSetter(t)}),e.encode=function(e,t){return t||(t=UN.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),null!=e.isCertified&&Object.hasOwnProperty.call(e,"isCertified")&&t.uint32(16).bool(e.isCertified),t},e.decode=function(e,t){e instanceof BN||(e=BN.create(e));var n=void 0===t?e.len:e.pos+t,r=new FN.Address;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.multiaddr=e.bytes();break;case 2:r.isCertified=e.bool();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof FN.Address)return e;var t=new FN.Address;return null!=e.multiaddr&&("string"===typeof e.multiaddr?VN.base64.decode(e.multiaddr,t.multiaddr=VN.newBuffer(VN.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),null!=e.isCertified&&(t.isCertified=Boolean(e.isCertified)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.multiaddr="":(n.multiaddr=[],t.bytes!==Array&&(n.multiaddr=VN.newBuffer(n.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(n.multiaddr=t.bytes===String?VN.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),null!=e.isCertified&&e.hasOwnProperty("isCertified")&&(n.isCertified=e.isCertified,t.oneofs&&(n._isCertified="isCertified")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),FN.Metadata=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.key="",e.prototype.value=VN.newBuffer([]),e.encode=function(e,t){return t||(t=UN.create()),null!=e.key&&Object.hasOwnProperty.call(e,"key")&&t.uint32(10).string(e.key),null!=e.value&&Object.hasOwnProperty.call(e,"value")&&t.uint32(18).bytes(e.value),t},e.decode=function(e,t){e instanceof BN||(e=BN.create(e));var n=void 0===t?e.len:e.pos+t,r=new FN.Metadata;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.key=e.string();break;case 2:r.value=e.bytes();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof FN.Metadata)return e;var t=new FN.Metadata;return null!=e.key&&(t.key=String(e.key)),null!=e.value&&("string"===typeof e.value?VN.base64.decode(e.value,t.value=VN.newBuffer(VN.base64.length(e.value)),0):e.value.length&&(t.value=e.value)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.key="",t.bytes===String?n.value="":(n.value=[],t.bytes!==Array&&(n.value=VN.newBuffer(n.value)))),null!=e.key&&e.hasOwnProperty("key")&&(n.key=e.key),null!=e.value&&e.hasOwnProperty("value")&&(n.value=t.bytes===String?VN.base64.encode(e.value,0,e.value.length):t.bytes===Array?Array.prototype.slice.call(e.value):e.value),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),ze.Reader),$N=ze.Writer,HN=ze.util,KN=ze.roots["default"]||(ze.roots["default"]={}),qN=KN.Envelope=(()=>{function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.publicKey=HN.newBuffer([]),e.prototype.payloadType=HN.newBuffer([]),e.prototype.payload=HN.newBuffer([]),e.prototype.signature=HN.newBuffer([]),e.encode=function(e,t){return t||(t=$N.create()),null!=e.publicKey&&Object.hasOwnProperty.call(e,"publicKey")&&t.uint32(10).bytes(e.publicKey),null!=e.payloadType&&Object.hasOwnProperty.call(e,"payloadType")&&t.uint32(18).bytes(e.payloadType),null!=e.payload&&Object.hasOwnProperty.call(e,"payload")&&t.uint32(26).bytes(e.payload),null!=e.signature&&Object.hasOwnProperty.call(e,"signature")&&t.uint32(42).bytes(e.signature),t},e.decode=function(e,t){e instanceof zN||(e=zN.create(e));var n=void 0===t?e.len:e.pos+t,r=new KN.Envelope;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.publicKey=e.bytes();break;case 2:r.payloadType=e.bytes();break;case 3:r.payload=e.bytes();break;case 5:r.signature=e.bytes();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof KN.Envelope)return e;var t=new KN.Envelope;return null!=e.publicKey&&("string"===typeof e.publicKey?HN.base64.decode(e.publicKey,t.publicKey=HN.newBuffer(HN.base64.length(e.publicKey)),0):e.publicKey.length&&(t.publicKey=e.publicKey)),null!=e.payloadType&&("string"===typeof e.payloadType?HN.base64.decode(e.payloadType,t.payloadType=HN.newBuffer(HN.base64.length(e.payloadType)),0):e.payloadType.length&&(t.payloadType=e.payloadType)),null!=e.payload&&("string"===typeof e.payload?HN.base64.decode(e.payload,t.payload=HN.newBuffer(HN.base64.length(e.payload)),0):e.payload.length&&(t.payload=e.payload)),null!=e.signature&&("string"===typeof e.signature?HN.base64.decode(e.signature,t.signature=HN.newBuffer(HN.base64.length(e.signature)),0):e.signature.length&&(t.signature=e.signature)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.publicKey="":(n.publicKey=[],t.bytes!==Array&&(n.publicKey=HN.newBuffer(n.publicKey))),t.bytes===String?n.payloadType="":(n.payloadType=[],t.bytes!==Array&&(n.payloadType=HN.newBuffer(n.payloadType))),t.bytes===String?n.payload="":(n.payload=[],t.bytes!==Array&&(n.payload=HN.newBuffer(n.payload))),t.bytes===String?n.signature="":(n.signature=[],t.bytes!==Array&&(n.signature=HN.newBuffer(n.signature)))),null!=e.publicKey&&e.hasOwnProperty("publicKey")&&(n.publicKey=t.bytes===String?HN.base64.encode(e.publicKey,0,e.publicKey.length):t.bytes===Array?Array.prototype.slice.call(e.publicKey):e.publicKey),null!=e.payloadType&&e.hasOwnProperty("payloadType")&&(n.payloadType=t.bytes===String?HN.base64.encode(e.payloadType,0,e.payloadType.length):t.bytes===Array?Array.prototype.slice.call(e.payloadType):e.payloadType),null!=e.payload&&e.hasOwnProperty("payload")&&(n.payload=t.bytes===String?HN.base64.encode(e.payload,0,e.payload.length):t.bytes===Array?Array.prototype.slice.call(e.payload):e.payload),null!=e.signature&&e.hasOwnProperty("signature")&&(n.signature=t.bytes===String?HN.base64.encode(e.signature,0,e.signature.length):t.bytes===Array?Array.prototype.slice.call(e.signature):e.signature),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e})(),GN=ze.Reader,WN=ze.Writer,YN=ze.util,JN=ze.roots["default"]||(ze.roots["default"]={}),QN=JN.PeerRecord=(()=>{function e(e){if(this.addresses=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.peerId=YN.newBuffer([]),e.prototype.seq=YN.Long?YN.Long.fromBits(0,0,!0):0,e.prototype.addresses=YN.emptyArray,e.encode=function(e,t){if(t||(t=WN.create()),null!=e.peerId&&Object.hasOwnProperty.call(e,"peerId")&&t.uint32(10).bytes(e.peerId),null!=e.seq&&Object.hasOwnProperty.call(e,"seq")&&t.uint32(16).uint64(e.seq),null!=e.addresses&&e.addresses.length)for(var n=0;n<e.addresses.length;++n)JN.PeerRecord.AddressInfo.encode(e.addresses[n],t.uint32(26).fork()).ldelim();return t},e.decode=function(e,t){e instanceof GN||(e=GN.create(e));var n=void 0===t?e.len:e.pos+t,r=new JN.PeerRecord;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.peerId=e.bytes();break;case 2:r.seq=e.uint64();break;case 3:r.addresses&&r.addresses.length||(r.addresses=[]),r.addresses.push(JN.PeerRecord.AddressInfo.decode(e,e.uint32()));break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof JN.PeerRecord)return e;var t=new JN.PeerRecord;if(null!=e.peerId&&("string"===typeof e.peerId?YN.base64.decode(e.peerId,t.peerId=YN.newBuffer(YN.base64.length(e.peerId)),0):e.peerId.length&&(t.peerId=e.peerId)),null!=e.seq&&(YN.Long?(t.seq=YN.Long.fromValue(e.seq)).unsigned=!0:"string"===typeof e.seq?t.seq=parseInt(e.seq,10):"number"===typeof e.seq?t.seq=e.seq:"object"===typeof e.seq&&(t.seq=new YN.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0))),e.addresses){if(!Array.isArray(e.addresses))throw TypeError(".PeerRecord.addresses: array expected");t.addresses=[];for(var n=0;n<e.addresses.length;++n){if("object"!==typeof e.addresses[n])throw TypeError(".PeerRecord.addresses: object expected");t.addresses[n]=JN.PeerRecord.AddressInfo.fromObject(e.addresses[n])}}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.addresses=[]),t.defaults)if(t.bytes===String?n.peerId="":(n.peerId=[],t.bytes!==Array&&(n.peerId=YN.newBuffer(n.peerId))),YN.Long){var r=new YN.Long(0,0,!0);n.seq=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.seq=t.longs===String?"0":0;if(null!=e.peerId&&e.hasOwnProperty("peerId")&&(n.peerId=t.bytes===String?YN.base64.encode(e.peerId,0,e.peerId.length):t.bytes===Array?Array.prototype.slice.call(e.peerId):e.peerId),null!=e.seq&&e.hasOwnProperty("seq")&&("number"===typeof e.seq?n.seq=t.longs===String?String(e.seq):e.seq:n.seq=t.longs===String?YN.Long.prototype.toString.call(e.seq):t.longs===Number?new YN.LongBits(e.seq.low>>>0,e.seq.high>>>0).toNumber(!0):e.seq),e.addresses&&e.addresses.length){n.addresses=[];for(var s=0;s<e.addresses.length;++s)n.addresses[s]=JN.PeerRecord.AddressInfo.toObject(e.addresses[s],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.AddressInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.multiaddr=YN.newBuffer([]),e.encode=function(e,t){return t||(t=WN.create()),null!=e.multiaddr&&Object.hasOwnProperty.call(e,"multiaddr")&&t.uint32(10).bytes(e.multiaddr),t},e.decode=function(e,t){e instanceof GN||(e=GN.create(e));var n=void 0===t?e.len:e.pos+t,r=new JN.PeerRecord.AddressInfo;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.multiaddr=e.bytes();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof JN.PeerRecord.AddressInfo)return e;var t=new JN.PeerRecord.AddressInfo;return null!=e.multiaddr&&("string"===typeof e.multiaddr?YN.base64.decode(e.multiaddr,t.multiaddr=YN.newBuffer(YN.base64.length(e.multiaddr)),0):e.multiaddr.length&&(t.multiaddr=e.multiaddr)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.multiaddr="":(n.multiaddr=[],t.bytes!==Array&&(n.multiaddr=YN.newBuffer(n.multiaddr)))),null!=e.multiaddr&&e.hasOwnProperty("multiaddr")&&(n.multiaddr=t.bytes===String?YN.base64.encode(e.multiaddr,0,e.multiaddr.length):t.bytes===Array?Array.prototype.slice.call(e.multiaddr):e.multiaddr),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e}(),e})();async function XN(e,t=(()=>{})){t(0,"Storing each peerstore key under a single datastore key"),await e.datastore.open();const n={},r=[];for await(const{key:s,value:i}of e.datastore.query({prefix:"/peers"})){r.push(s);const e=s.toString(),[,t,o,a,c]=e.split("/");if("peers"===t&&(["protos","addrs","metadata","keys"].includes(o)&&a))if(n[a]=n[a]||{addresses:[],protocols:[],metadata:[]},"protos"===o){const e=xN.decode(i);n[a].protocols=e.protocols.sort()}else if("addrs"===o){const e=MN.decode(i);n[a].addresses=e.addrs.sort(((e,t)=>dc(e.multiaddr).toString().localeCompare(dc(t.multiaddr).toString()))),e.certifiedRecord&&e.certifiedRecord.raw&&(n[a].peerRecordEnvelope=e.certifiedRecord.raw)}else"metadata"===o?n[a].metadata.push({key:c,value:i}):"keys"===o&&(n[a].pubKey=i)}t(33,"Read peer data from store");for(const s of r)await e.datastore.delete(s);t(66,"Removed existing peer data from store");for(const s of Object.keys(n)){const t=n[s];t.metadata=t.metadata.sort(((e,t)=>e.key.localeCompare(t.key)));const r=jN.encode(t).finish();await e.datastore.put(new rl(`/peers/${s}`),r)}await e.datastore.close(),t(100,"Stored each peerstore key under a single datastore key")}async function ZN(e,t=(()=>{})){t(0,"Storing each peerstore key under a multiple datastore keys"),await e.datastore.open();const n={},r=[];for await(const{key:s,value:i}of e.datastore.query({prefix:"/peers"})){r.push(s);const e=s.toString(),[,,t]=e.split("/");n[t]=jN.decode(i)}t(33,"Read peer data from store");for(const s of r)await e.datastore.delete(s);t(66,"Removed existing peer data from store");for(const[s,i]of Object.entries(n)){if(i.protocols&&i.protocols.length>0&&await e.datastore.put(new rl(`/peers/protos/${s}`),xN.encode({protocols:i.protocols}).finish()),i.addresses&&i.addresses.length>0){const t=i.peerRecordEnvelope;let n;if(t){const e=qN.decode(t),r=QN.decode(e.payload);n={raw:t,seq:r.seq}}await e.datastore.put(new rl(`/peers/addrs/${s}`),MN.encode({addrs:i.addresses,certifiedRecord:n}).finish())}if(i.metadata&&i.metadata.length>0)for(const{key:t,value:n}of i.metadata)await e.datastore.put(new rl(`/peers/metadata/${s}/${t}`),n);i.pubKey&&await e.datastore.put(new rl(`/peers/keys/${s}`),i.pubKey)}await e.datastore.close(),t(100,"Stored each peerstore key under multiple datastore keys")}ze.util.Long=void 0,ze.configure();const eD={version:12,description:"Store each peerstore peer under a single datastore key",migrate:XN,revert:ZN},tD={description:"Empty migration.",migrate:()=>{},revert:()=>{},empty:!0};var nD=[Object.assign({version:1},tD),Object.assign({version:2},tD),Object.assign({version:3},tD),Object.assign({version:4},tD),Object.assign({version:5},tD),Object.assign({version:6},tD),Object.assign({version:7},tD),Fx,lN,EN,TN,eD];class rD extends Error{constructor(e){super(e),this.name="NonReversibleMigrationError",this.code=rD.code,this.message=e}}rD.code="ERR_NON_REVERSIBLE_MIGRATION";class sD extends Error{constructor(e){super(e),this.name="NotInitializedRepoError",this.code=sD.code,this.message=e}}sD.code="ERR_NOT_INITIALIZED_REPO";class iD extends Error{constructor(e){super(e),this.name="RequiredParameterError",this.code=iD.code,this.message=e}}iD.code="ERR_REQUIRED_PARAMETER";class oD extends Error{constructor(e){super(e),this.name="InvalidValueError",this.code=oD.code,this.message=e}}oD.code="ERR_INVALID_VALUE";class aD extends Error{constructor(e){super(e),this.name="MissingRepoOptionsError",this.code=aD.code,this.message=e}}aD.code="ERR_MISSING_REPO_OPTIONS";const cD=se("ipfs:repo:migrator:repo:init");async function lD(e){if(!e)throw new aD("Please pass repo options when trying to open a repo");const t=e.root;try{await t.open();const e=await t.has(hN),n=await t.has(uN);return!(!e||!n)||(cD(`Version entry present: ${e}`),cD(`Config entry present: ${n}`),!1)}catch(n){return cD("While checking if repo is initialized error was thrown: "+n.message),!1}finally{if(void 0!==t)try{await t.close()}catch{}}}async function uD(e){if(!await lD(e))throw new sD("Repo is not initialized!");const t=e.root;await t.open();try{return parseInt(ia(await t.get(hN)))}finally{await t.close()}}async function hD(e,t){if(!t)throw new aD("Please pass repo options when trying to open a repo");const n=t.root;await n.open(),await n.put(hN,$o(String(e))),await n.close()}const dD=se("ipfs:repo:migrator");function pD(e){return e=e||nD,Array.isArray(e)&&0!==e.length?e[e.length-1].version:0}async function fD(e,t,n,r,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??nD;if(!e)throw new yD.RequiredParameterError("Path argument is required!");if(!n)throw new yD.RequiredParameterError("repoOptions argument is required!");if(!r)throw new yD.RequiredParameterError("toVersion argument is required!");if(!Number.isInteger(r)||r<=0)throw new yD.InvalidValueError("Version has to be positive integer!");t=mN(t);const l=await uD(t);if(l===r)return void dD("Nothing to migrate.");if(l>r)throw new yD.InvalidValueError(`Current repo's version (${l}) is higher then toVersion (${r}), you probably wanted to revert it?`);let u;mD(c,l,r),a||i||(u=await n.repoLock.lock(e));try{for(const e of c){if(void 0!==r&&e.version>r)break;if(!(e.version<=l)){dD(`Migrating version ${e.version}`);try{if(!a){let n=()=>{};o&&(n=(t,n)=>o(e.version,t.toFixed(2),n)),await e.migrate(t,n)}}catch(h){const n=e.version-1;throw dD(`An exception was raised during execution of migration. Setting the repo's version to last successfully migrated version: ${n}`),await hD(n,t),new Error(`During migration to version ${e.version} exception was raised: ${h.stack||h.message||h}`)}dD(`Migrating to version ${e.version} finished`)}}a||await hD(r||pD(c),t),dD("Repo successfully migrated",void 0!==r?`to version ${r}!`:"to latest version!")}finally{a||i||!u||await u.close()}}async function gD(e,t,n,r,s={}){const i=s.ignoreLock??!1,o=s.onProgress,a=s.isDryRun??!1,c=s.migrations??nD;if(!e)throw new yD.RequiredParameterError("Path argument is required!");if(!n)throw new yD.RequiredParameterError("repoOptions argument is required!");if(!r)throw new yD.RequiredParameterError("When reverting migrations, you have to specify to which version to revert!");if(!Number.isInteger(r)||r<=0)throw new yD.InvalidValueError("Version has to be positive integer!");t=mN(t);const l=await uD(t);if(l===r)return void dD("Nothing to revert.");if(l<r)throw new yD.InvalidValueError(`Current repo's version (${l}) is lower then toVersion (${r}), you probably wanted to migrate it?`);let u;mD(c,r,l,!0),a||i||(u=await n.repoLock.lock(e)),dD(`Reverting from version ${l} to ${r}`);try{const e=c.slice().reverse();for(const n of e){if(n.version<=r)break;if(!(n.version>l)){dD(`Reverting migration version ${n.version}`);try{if(!a){let e=()=>{};o&&(e=(e,t)=>o(n.version,e.toFixed(2),t)),await n.revert(t,e)}}catch(h){const e=n.version;throw dD(`An exception was raised during execution of migration. Setting the repo's version to last successfully reverted version: ${e}`),await hD(e,t),h.message=`During reversion to version ${n.version} exception was raised: ${h.message}`,h}dD(`Reverting to version ${n.version} finished`)}}a||await hD(r,t),dD(`All migrations successfully reverted to version ${r}!`)}finally{a||i||!u||await u.close()}}function mD(e,t,n,r=!1){let s=0;for(const i of e){if(i.version>n)break;if(i.version>t){if(r&&!i.revert)throw new yD.NonReversibleMigrationError(`It is not possible to revert to version ${t} because migration version ${i.version} is not reversible. Cancelling reversion.`);s++}}if(s!==n-t)throw new yD.InvalidValueError(`The ipfs-repo-migrations package does not have all migration to migrate from version ${t} to ${n}`)}const yD=k;var wD=n(9149);class bD extends Error{constructor(e){super(e),this.name="LockExistsError",this.code=bD.code}}bD.code="ERR_LOCK_EXISTS";class vD extends Error{constructor(e){super(e),this.name="NotFoundError",this.code=vD.code}}vD.code="ERR_NOT_FOUND";class ED extends Error{constructor(e){super(e),this.name="InvalidRepoVersionError",this.code=ED.code}}ED.code="ERR_INVALID_REPO_VERSION";const _D="ERR_REPO_NOT_INITIALIZED",SD="ERR_REPO_ALREADY_OPEN",kD="ERR_REPO_ALREADY_CLOSED";async function AD(e,t,n){const r=await t(e);if(r)return r;const s=CD(n);return!!s&&new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{t(Boolean(r.result))}}))}async function TD(e,t,n,r){if(await n(e))return t(e);const s=CD(r);if(!s)throw new vD;return new Promise(((t,n)=>{const r=s.store("readonly").get(e.toString());r.transaction.onabort=()=>{n(r.transaction.error)},r.transaction.oncomplete=()=>{if(r.result)return t(r.result);n(new vD)}}))}function CD(e){let t=e;while(t.db||t.child)if(t=t.db||t.child,"level-js"===t.type||"Level"===t.constructor.name)return t}const ID=se("ipfs:repo:version"),RD=new rl("version");function OD(e){return{async exists(){return AD(RD,e.has.bind(e),e)},async get(){const t=await TD(RD,e.get.bind(e),e.has.bind(e),e);return parseInt(ia(t),10)},set(t){return e.put(RD,$o(String(t)))},async check(e){const t=await this.get();ID("comparing version: %s and %s",t,e);const n=6===t&&7===e||6===e&&7===t;return t===e||n}}}const xD=yu["default"]?yu["default"]:yu,ND=new rl("config");function DD(e){const t=new xD({concurrency:1}),n={async getAll(t={}){const n=await TD(ND,e.get.bind(e),e.has.bind(e),e);return JSON.parse(ia(n))},async get(e,t={}){if(null==e)throw new vD(`Key ${e} does not exist in config`);const n=await this.getAll(t),r=Nx(n,e);if(void 0===r)throw new vD(`Key ${e} does not exist in config`);return r},set(e,n,s={}){if("string"!==typeof e&&!(e instanceof String))throw je(new Error("Invalid key type: "+typeof e),"ERR_INVALID_KEY");if(void 0===n||n instanceof Uint8Array)throw je(new Error("Invalid value type: "+typeof n),"ERR_INVALID_VALUE");return t.add((()=>r({key:e,value:n},s.signal)))},replace(e,n={}){if(!e||e instanceof Uint8Array)throw je(new Error("Invalid value type: "+typeof e),"ERR_INVALID_VALUE");return t.add((()=>r({key:void 0,value:e},n.signal)))},async exists(){return AD(ND,e.has.bind(e),e)}};return n;async function r(e,t){if(t&&t.aborted)return;const r=e.key,i=e.value;if(r){const e=await n.getAll();return"object"===typeof e&&null!==e&&hC(e,r,i),s(e)}return s(i)}function s(t){const n=$o(JSON.stringify(t,null,2));return e.put(ND,n)}}function PD(e){if("object"!==typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(Symbol.toStringTag in e)&&!(Symbol.iterator in e)}function LD(e,t={}){if(!PD(e)&&!Array.isArray(e))throw new TypeError("Expected a plain object or array");const{deep:n,compare:r}=t,s=[],i=[],o=e=>{const t=s.indexOf(e);if(-1!==t)return i[t];const n=[];return s.push(e),i.push(n),n.push(...e.map((e=>Array.isArray(e)?o(e):PD(e)?a(e):e))),n},a=e=>{const t=s.indexOf(e);if(-1!==t)return i[t];const c={},l=Object.keys(e).sort(r);s.push(e),i.push(c);for(const r of l){const t=e[r];let s;s=n&&Array.isArray(t)?o(t):n&&PD(t)?a(t):t,Object.defineProperty(c,r,{...Object.getOwnPropertyDescriptor(e,r),value:s})}return c};return Array.isArray(e)?n?o(e):e.slice():a(e)}const MD=new rl("datastore_spec");function BD(e){return{exists(){return e.has(MD)},async get(){const t=await e.get(MD);return JSON.parse(ia(t))},async set(t){return e.put(MD,$o(JSON.stringify(LD(t,{deep:!0}))))}}}const UD=new rl("api");function VD(e){return{async get(){const t=await e.get(UD);return t&&t.toString()},set(t){return e.put(UD,$o(t.toString()))},delete(){return e.delete(UD)}}}n(4633);function FD(e){return{open(){return e.open()},close(){return e.close()},query(t,n){return e.query(t,n)},queryKeys(t,n){return e.queryKeys(t,n)},async get(t,n){const r=jD(t);return r.isIdentity?Promise.resolve(r.digest):e.get(t,n)},async*getMany(e,t){for await(const n of e)yield this.get(n,t)},async put(t,n,r){const{isIdentity:s}=jD(t);s||await e.put(t,n,r)},async*putMany(t,n){const r=im({objectMode:!0}),s=globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout;s((async()=>{try{await Zg(e.putMany(async function*(){for await(const{key:e,value:n}of t)jD(e).isIdentity||(yield{key:e,value:n}),r.push({key:e,value:n})}())),r.end()}catch(uS){r.end(uS)}})),yield*r},has(t,n){const{isIdentity:r}=jD(t);return r?Promise.resolve(!0):e.has(t,n)},delete(t,n){const{isIdentity:r}=jD(t);return r?Promise.resolve():e.delete(t,n)},deleteMany(t,n){return e.deleteMany(em(t,(e=>!jD(e).isIdentity)),n)},batch(){const t=e.batch();return{put(e,n){const{isIdentity:r}=jD(e);r||t.put(e,n)},delete(e){const{isIdentity:n}=jD(e);n||t.delete(e)},commit:e=>t.commit(e)}}}}function jD(e){const t=Lt.asCID(e);if(null==t)throw je(new Error("Not a valid cid"),"ERR_INVALID_CID");return t.multihash.code!==Yi.code?{isIdentity:!1}:{isIdentity:!0,digest:t.multihash.digest}}const zD=se("ipfs:repo:lock:memory"),$D="repo.lock",HD={};async function KD(e){const t=e+"/"+$D;if(zD("locking %s",t),!0===HD[t])throw new bD(`Lock already being held for file: ${t}`);HD[t]=!0;const n={async close(){HD[t]&&delete HD[t]}};return n}async function qD(e){const t=e+"/"+$D;return zD(`checking lock: ${t}`),Boolean(HD[t])}const GD={lock:KD,locked:qD};var WD={autoMigrate:!0,onMigrationProgress:()=>{},repoOwner:!0,repoLock:GD},YD={Spec:{type:"mount",mounts:[{mountpoint:"/blocks",type:"measure",prefix:"flatfs.datastore",child:{type:"flatfs",path:"blocks",sync:!0,shardFunc:"/repo/flatfs/shard/v1/next-to-last/2"}},{mountpoint:"/",type:"measure",prefix:"leveldb.datastore",child:{type:"levelds",path:"datastore",compression:"none"}}]}};function JD(e){const t=Lt.asCID(e);if(null==t)throw je(new Error("Not a valid cid"),"ERR_INVALID_CID");const n=Ce.encode(t.multihash.bytes);return new rl("/"+n.slice(1).toUpperCase(),!1)}function QD(e){return Rt(Ce.decode(`b${e.toString().toLowerCase().substring(1)}`))}const XD=se("ipfs:repo:utils:walk-dag");async function*ZD(e,t,n,r){try{const s=await t.get(e,r),i=await n(e.code),o=AC({bytes:s,cid:e,codec:i});for(const[,e]of o.links())yield e,yield*ZD(e,t,n,r)}catch(uS){throw XD("Could not walk DAG for CID",e.toString(),uS),uS}}class eP extends Map{constructor(e={}){if(super(),!(e.maxSize&&e.maxSize>0))throw new TypeError("`maxSize` must be a number greater than 0");if("number"===typeof e.maxAge&&0===e.maxAge)throw new TypeError("`maxAge` must be a number greater than 0");this.maxSize=e.maxSize,this.maxAge=e.maxAge||Number.POSITIVE_INFINITY,this.onEviction=e.onEviction,this.cache=new Map,this.oldCache=new Map,this._size=0}_emitEvictions(e){if("function"===typeof this.onEviction)for(const[t,n]of e)this.onEviction(t,n.value)}_deleteIfExpired(e,t){return"number"===typeof t.expiry&&t.expiry<=Date.now()&&("function"===typeof this.onEviction&&this.onEviction(e,t.value),this.delete(e))}_getOrDeleteIfExpired(e,t){const n=this._deleteIfExpired(e,t);if(!1===n)return t.value}_getItemValue(e,t){return t.expiry?this._getOrDeleteIfExpired(e,t):t.value}_peek(e,t){const n=t.get(e);return this._getItemValue(e,n)}_set(e,t){this.cache.set(e,t),this._size++,this._size>=this.maxSize&&(this._size=0,this._emitEvictions(this.oldCache),this.oldCache=this.cache,this.cache=new Map)}_moveToRecent(e,t){this.oldCache.delete(e),this._set(e,t)}*_entriesAscending(){for(const e of this.oldCache){const[t,n]=e;if(!this.cache.has(t)){const r=this._deleteIfExpired(t,n);!1===r&&(yield e)}}for(const e of this.cache){const[t,n]=e,r=this._deleteIfExpired(t,n);!1===r&&(yield e)}}get(e){if(this.cache.has(e)){const t=this.cache.get(e);return this._getItemValue(e,t)}if(this.oldCache.has(e)){const t=this.oldCache.get(e);if(!1===this._deleteIfExpired(e,t))return this._moveToRecent(e,t),t.value}}set(e,t,{maxAge:n=this.maxAge}={}){const r="number"===typeof n&&n!==Number.POSITIVE_INFINITY?Date.now()+n:void 0;this.cache.has(e)?this.cache.set(e,{value:t,expiry:r}):this._set(e,{value:t,expiry:r})}has(e){return this.cache.has(e)?!this._deleteIfExpired(e,this.cache.get(e)):!!this.oldCache.has(e)&&!this._deleteIfExpired(e,this.oldCache.get(e))}peek(e){return this.cache.has(e)?this._peek(e,this.cache):this.oldCache.has(e)?this._peek(e,this.oldCache):void 0}delete(e){const t=this.cache.delete(e);return t&&this._size--,this.oldCache.delete(e)||t}clear(){this.cache.clear(),this.oldCache.clear(),this._size=0}resize(e){if(!(e&&e>0))throw new TypeError("`maxSize` must be a number greater than 0");const t=[...this._entriesAscending()],n=t.length-e;n<0?(this.cache=new Map(t),this.oldCache=new Map,this._size=t.length):(n>0&&this._emitEvictions(t.slice(0,n)),this.oldCache=new Map(t.slice(n)),this.cache=new Map,this._size=0),this.maxSize=e}*keys(){for(const[e]of this)yield e}*values(){for(const[,e]of this)yield e}*[Symbol.iterator](){for(const e of this.cache){const[t,n]=e,r=this._deleteIfExpired(t,n);!1===r&&(yield[t,n.value])}for(const e of this.oldCache){const[t,n]=e;if(!this.cache.has(t)){const e=this._deleteIfExpired(t,n);!1===e&&(yield[t,n.value])}}}*entriesDescending(){let e=[...this.cache];for(let t=e.length-1;t>=0;--t){const n=e[t],[r,s]=n,i=this._deleteIfExpired(r,s);!1===i&&(yield[r,s.value])}e=[...this.oldCache];for(let t=e.length-1;t>=0;--t){const n=e[t],[r,s]=n;if(!this.cache.has(r)){const e=this._deleteIfExpired(r,s);!1===e&&(yield[r,s.value])}}}*entriesAscending(){for(const[e,t]of this._entriesAscending())yield[e,t.value]}get size(){if(!this._size)return this.oldCache.size;let e=0;for(const t of this.oldCache.keys())this.cache.has(t)||e++;return Math.min(this._size+e,this.maxSize)}entries(){return this.entriesAscending()}forEach(e,t=this){for(const[n,r]of this.entriesAscending())e.call(t,r,n,this)}get[Symbol.toStringTag](){return JSON.stringify([...this.entriesAscending()])}}const tP=2048;function nP(e){const t=`Invalid type '${e}', must be one of {direct, indirect, recursive, all}`;return je(new Error(t),"ERR_INVALID_PIN_TYPE")}class rP{constructor({pinstore:e,blockstore:t,loadCodec:n}){this.pinstore=e,this.blockstore=t,this.loadCodec=n,this.log=se("ipfs:repo:pin"),this.directPins=new Set,this.recursivePins=new Set}async pinDirectly(e,t={}){await this.blockstore.get(e,t);const n={depth:0};return 0!==e.version&&(n.version=e.version),e.code!==wn&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),this.pinstore.put(JD(e),Ls(n))}unpin(e,t){return this.pinstore.delete(JD(e),t)}async pinRecursively(e,t={}){await this.fetchCompleteDag(e,t);const n={depth:1/0};0!==e.version&&(n.version=e.version),e.code!==wn&&(n.codec=e.code),t.metadata&&(n.metadata=t.metadata),await this.pinstore.put(JD(e),Ls(n))}async*directKeys(e){for await(const t of this.pinstore.query({filters:[e=>{const t=$s(e.value);return 0===t.depth}]})){const e=$s(t.value),n=e.version||0,r=null!=e.codec?e.codec:wn,s=QD(t.key);yield{cid:Lt.create(n,r,s),metadata:e.metadata}}}async*recursiveKeys(e){for await(const t of this.pinstore.query({filters:[e=>{const t=$s(e.value);return t.depth===1/0}]})){const e=$s(t.value),n=e.version||0,r=null!=e.codec?e.codec:wn,s=QD(t.key);yield{cid:Lt.create(n,r,s),metadata:e.metadata}}}async*indirectKeys(e){for await(const{cid:t}of this.recursiveKeys())for await(const n of ZD(t,this.blockstore,this.loadCodec,e)){const e=[Ju.recursive],t=await this.isPinnedWithType(n,e);t.pinned||(yield n)}}async isPinnedWithType(e,t,n){Array.isArray(t)||(t=[t]);const r=t.includes(Ju.all),s=t.includes(Ju.direct),i=t.includes(Ju.recursive),o=t.includes(Ju.indirect);if(i||s||r){const n=await rI(this.pinstore.query({prefix:JD(e).toString(),filters:[e=>{if(r)return!0;const n=$s(e.value);return t.includes(0===n.depth?Ju.direct:Ju.recursive)}],limit:1}));if(n){const t=$s(n.value);return{cid:e,pinned:!0,reason:0===t.depth?Ju.direct:Ju.recursive,metadata:t.metadata}}}const a=this;async function*c(e,t){for await(const{cid:n}of t)for await(const t of ZD(n,a.blockstore,a.loadCodec))if(t.equals(e))return void(yield n)}if(r||o){const t=await rI(c(e,this.recursiveKeys()));if(t)return{cid:e,pinned:!0,reason:Ju.indirect,parent:t}}return{cid:e,pinned:!1}}async fetchCompleteDag(e,t={}){const n=new eP({maxSize:t.cidCacheMaxSize??tP}),r=async(e,t)=>{if(n.has(e.toString()))return;n.set(e.toString(),!0);const s=await this.blockstore.get(e,t),i=await this.loadCodec(e.code),o=AC({bytes:s,cid:e,codec:i});await Promise.all([...o.links()].map((([,e])=>r(e,t))))};await r(e,t)}static checkPinType(e){if("string"!==typeof e||!Object.keys(Ju).includes(e))throw nP(e);return!0}}function sP(e,t){return{open(){return t.open()},close(){return t.close()},query(e,n){return t.query(e,n)},queryKeys(e,n){return t.queryKeys(e,n)},async get(e,n){return t.get(e,n)},async*getMany(e,n){yield*t.getMany(e,n)},async put(e,n,r){await t.put(e,n,r)},async*putMany(e,n){yield*t.putMany(e,n)},has(e,n){return t.has(e,n)},async delete(n,r){return await iP(n,e),t.delete(n,r)},deleteMany(n,r){return t.deleteMany(Iy(n,(async t=>(await iP(t,e),t))),r)},batch(){return t.batch()}}}async function iP(e,t){const{pinned:n,reason:r}=await t.isPinnedWithType(e,Ju.all);if(n)throw je(new Error(`pinned: ${r}`),"ERR_BLOCK_PINNED")}async function*oP(e,t=1){for await(const n of Wy(e,t)){const e=n.map((async e=>await e().then((e=>({ok:!0,value:e})),(e=>({ok:!1,err:e})))));for(let t=0;t<e.length;t++){const n=await e[t];if(!n.ok)throw n.err;yield n.value}}}const aP=se("ipfs:repo:gc"),cP=oh().code,lP=256,uP=new rl("/local/filesroot");function hP({gcLock:e,pins:t,blockstore:n,root:r,loadCodec:s}){async function*i(){const i=Date.now();aP("Creating set of marked blocks");const o=await e.writeLock();try{const e=await dP({pins:t,blockstore:n,root:r,loadCodec:s}),o=n.queryKeys({});yield*pP({blockstore:n},e,o),aP(`Complete (${Date.now()-i}ms)`)}finally{o()}}return i}async function dP({pins:e,blockstore:t,loadCodec:n,root:r}){const s=async function*(){let e;try{e=await r.get(uP)}catch(uS){if(uS.code===cP)return void aP("No blocks in MFS");throw uS}const s=Lt.decode(e);yield s,yield*ZD(s,t,n)}(),i=gm(Iy(e.recursiveKeys(),(({cid:e})=>e)),e.indirectKeys(),Iy(e.directKeys(),(({cid:e})=>e)),s),o=new Set;for await(const a of gm(i,s))o.add(Ce.encode(a.multihash.bytes));return o}async function*pP({blockstore:e},t,n){let r=0,s=0;const i=async n=>async function(){r++;try{const r=Ce.encode(n.multihash.bytes);if(t.has(r))return null;try{await e.delete(n),s++}catch(uS){return{err:new Error(`Could not delete block with CID ${n}: ${uS.message}`)}}return{cid:n}}catch(uS){const t=`Could delete block with CID ${n}`;return aP(t,uS),{err:new Error(t+`: ${uS.message}`)}}};yield*vm(oP(Iy(n,i),lP),(e=>em(e,Boolean))),aP(`Marked set has ${t.size} unique blocks. Blockstore has ${r} blocks. Deleted ${s} blocks.`)}const fP=se("ipfs:repo"),gP=Number.MAX_SAFE_INTEGER,mP="repoAutoMigrate";class yP{constructor(e,t,n,r){if("string"!==typeof e)throw new Error("missing repo path");if("function"!==typeof t)throw new Error("missing codec loader");this.options=ne(WD,r),this.closed=!0,this.path=e,this.root=n.root,this.datastore=n.datastore,this.keys=n.keys;const s=n.blocks,i=n.pins;this.pins=new rP({pinstore:i,blockstore:s,loadCodec:t});const o=sP(this.pins,s);this.blocks=FD(o),this.version=OD(this.root),this.config=DD(this.root),this.spec=BD(this.root),this.apiAddr=VD(this.root),this.gcLock=ZI({name:e,singleProcess:!1!==this.options.repoOwner}),this.gc=hP({gcLock:this.gcLock,pins:this.pins,blockstore:this.blocks,root:this.root,loadCodec:t})}async init(e){fP("initializing at: %s",this.path),await this._openRoot(),await this.config.replace(vP(e)),await this.spec.set(EP(e)),await this.version.set(Tx)}async isInitialized(){if(!this.closed)return!0;try{return await this._openRoot(),await this._checkInitialized(),await this.root.close(),!0}catch(uS){return!1}}async open(){if(!this.closed)throw je(new Error("repo is already open"),SD);fP("opening at: %s",this.path);try{await this._openRoot(),await this._checkInitialized(),this._lockfile=await this._openLock(),fP("acquired repo.lock");const e=await this.version.check(Tx);if(!e){if(!await this._isAutoMigrationEnabled())throw new ED("Incompatible repo versions. Automatic migrations disabled. Please migrate the repo manually.");await this._migrate(Tx,{root:this.root,datastore:this.datastore,pins:this.pins.pinstore,blocks:this.pins.blockstore,keys:this.keys})}fP("creating datastore"),await this.datastore.open(),fP("creating blocks"),await this.blocks.open(),fP("creating keystore"),await this.keys.open(),fP("creating pins"),await this.pins.pinstore.open(),this.closed=!1,fP("all opened")}catch(uS){if(this._lockfile)try{await this._closeLock(),this._lockfile=null}catch(e){fP("error removing lock",e)}throw uS}}async _openRoot(){try{await this.root.open()}catch(uS){if("Already open"!==uS.message)throw uS}}async _openLock(){const e=await this.options.repoLock.lock(this.path);if("function"!==typeof e.close)throw je(new Error("Locks must have a close method"),"ERR_NO_CLOSE_FUNCTION");return e}_closeLock(){return this._lockfile&&this._lockfile.close()}async _checkInitialized(){let e;fP("init check");try{[e]=await Promise.all([this.config.exists(),this.spec.exists(),this.version.exists()])}catch(uS){if("ERR_NOT_FOUND"===uS.code)throw je(new Error("repo is not initialized yet"),_D,{path:this.path});throw uS}if(!e)throw je(new Error("repo is not initialized yet"),_D,{path:this.path})}async close(){if(this.closed)throw je(new Error("repo is already closed"),kD);fP("closing at: %s",this.path);try{await this.apiAddr.delete()}catch(uS){if(uS.code!==_D&&!uS.message.startsWith("ENOENT"))throw uS}await Promise.all([this.root,this.blocks,this.keys,this.datastore,this.pins.pinstore].map((e=>e&&e.close()))),fP("unlocking"),this.closed=!0,await this._closeLock()}exists(){return this.version.exists()}async stat(){if(this.datastore&&this.keys){const[e,t,n,r,s]=await Promise.all([this._storageMaxStat(),this._blockStat(),this.version.get(),wP(this.datastore),wP(this.keys)]),i=t.size+r+s;return{repoPath:this.path,storageMax:e,version:n,numObjects:t.count,repoSize:i}}throw je(new Error("repo is not initialized yet"),_D,{path:this.path})}async _isAutoMigrationEnabled(){if(void 0!==this.options.autoMigrate)return this.options.autoMigrate;let e;try{e=await this.config.get(mP)}catch(t){if(t.code!==vD.code)throw t;e=!0}return e}async _migrate(e,t){const n=await this.version.get();return n>e?(fP(`reverting to version ${e}`),gD(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress})):(fP(`migrating to version ${e}`),fD(this.path,t,this.options,e,{ignoreLock:!0,onProgress:this.options.onMigrationProgress}))}async _storageMaxStat(){try{const e=await this.config.get("Datastore.StorageMax");return BigInt(wD(e))}catch(uS){return BigInt(gP)}}async _blockStat(){let e=BigInt(0),t=BigInt(0);if(this.blocks)for await(const{key:n,value:r}of this.blocks.query({}))e+=BigInt(1),t+=BigInt(r.byteLength),t+=BigInt(n.bytes.byteLength);return{count:e,size:t}}}async function wP(e){let t=BigInt(0);for await(const n of e.query({}))t+=BigInt(n.value.byteLength),t+=BigInt(n.key.uint8Array().byteLength);return t}function bP(e,t,n,r){return new yP(e,t,n,r)}function vP(e){return e.Datastore=Object.assign({},YD,Nx(e,"datastore")),e}function EP(e){const t={...YD.Spec,...Nx(e,"Datastore.Spec")};return{type:t.type,mounts:t.mounts.map((e=>({mountpoint:e.mountpoint,type:e.child.type,path:e.child.path,shardFunc:e.child.shardFunc})))}}async function*_P(e,t){const n=await Qg(e);yield*n.sort(t)}var SP=n(7914);class kP extends nm{constructor(e,t={}){super(),this.db="string"===typeof e?new SP.Level(e,{...t,keyEncoding:"utf8",valueEncoding:"view"}):e,this.opts={createIfMissing:!0,compression:!1,...t}}async open(){try{await this.db.open(this.opts)}catch(uS){throw rh(uS)}}async put(e,t){try{await this.db.put(e.toString(),t)}catch(uS){throw ih(uS)}}async get(e){let t;try{t=await this.db.get(e.toString())}catch(uS){if(uS.notFound)throw oh(uS);throw ih(uS)}return t}async has(e){try{await this.db.get(e.toString())}catch(uS){if(uS.notFound)return!1;throw uS}return!0}async delete(e){try{await this.db.del(e.toString())}catch(uS){throw sh(uS)}}close(){return this.db&&this.db.close()}batch(){const e=[];return{put:(t,n)=>{e.push({type:"put",key:t.toString(),value:n})},delete:t=>{e.push({type:"del",key:t.toString()})},commit:()=>this.db.batch(e)}}query(e){let t=this._query({values:!0,prefix:e.prefix});Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>em(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>_P(e,t)),t));const{offset:n,limit:r}=e;if(n){let e=0;t=em(t,(()=>e++>=n))}return r&&(t=tm(t,r)),t}queryKeys(e){let t=Iy(this._query({values:!1,prefix:e.prefix}),(({key:e})=>e));Array.isArray(e.filters)&&(t=e.filters.reduce(((e,t)=>em(e,t)),t)),Array.isArray(e.orders)&&(t=e.orders.reduce(((e,t)=>_P(e,t)),t));const{offset:n,limit:r}=e;if(n){let e=0;t=em(t,(()=>e++>=n))}return r&&(t=tm(t,r)),t}_query(e){const t={keys:!0,keyEncoding:"buffer",values:e.values};if(null!=e.prefix){const n=e.prefix.toString();t.gte=n,t.lt=n+"ÿ"}const n=this.db.iterator(t);if(n[Symbol.asyncIterator])return AP(n);if(null!=n.next&&null!=n.end)return TP(n);throw new Error("Level returned incompatible iterator")}}async function*AP(e){for await(const[t,n]of e)yield{key:new rl(t,!1),value:n};await e.close()}function TP(e){return{[Symbol.asyncIterator](){return{next:()=>new Promise(((t,n)=>{e.next(((r,s,i)=>r?n(r):null==s?e.end((e=>{if(e)return n(e);t({done:!0,value:void 0})})):void t({done:!1,value:{key:new rl(s,!1),value:i}})))})),return:()=>new Promise(((t,n)=>{e.end((e=>{if(e)return n(e);t({done:!0,value:void 0})}))}))}}}}var CP=n(1555),IP=n(2386),RP=n(4753),OP=n(5101);const xP=(e,t)=>async function*(){const n=await OP(e);yield*n.sort(t)}();class NP{open(){return Promise.reject(new Error(".open is not implemented"))}close(){return Promise.reject(new Error(".close is not implemented"))}put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:r}of e)await this.put(n,r,t),yield{key:n,value:r}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(t,n){e.push({key:t,value:n})},delete(e){t.push(e)},commit:async n=>{await CP(this.putMany(e,n)),e=[],await CP(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(null!=e.prefix&&(n=IP(n,(t=>t.key.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>IP(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>xP(e,t)),n)),null!=e.offset){let t=0;n=IP(n,(()=>t++>=(e.offset||0)))}return null!=e.limit&&(n=RP(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(null!=e.prefix&&(n=IP(n,(t=>t.toString().startsWith(e.prefix||"")))),Array.isArray(e.filters)&&(n=e.filters.reduce(((e,t)=>IP(e,t)),n)),Array.isArray(e.orders)&&(n=e.orders.reduce(((e,t)=>xP(e,t)),n)),null!=e.offset){let t=0;n=IP(n,(()=>t++>=e.offset))}return null!=e.limit&&(n=RP(n,e.limit)),n}}function DP(e){const t=Lt.asCID(e);if(!t)throw je(new Error("Not a valid cid"),"ERR_INVALID_CID");return new rl("/"+Ce.encode(t.multihash.bytes).slice(1).toUpperCase(),!1)}function PP(e){return Lt.createV1(go,Rt(Ce.decode("b"+e.toString().slice(1).toLowerCase())))}function LP(e){const t=e.substring(0,1);if("/"===t)return LP(e.substring(1));let n,r;n="b"===t.toLowerCase()?e=>Ce.decode(e.toLowerCase()).subarray(2):"c"===t.toLowerCase()?e=>Re.decode(e.toLowerCase()).subarray(2):"z"===t?e=>Ae.decode(e).subarray(2):"Q"===t?e=>Ae.decode("z"+e):e=>Ce.decode("b"+e.toLowerCase()).subarray(2);for(let i=1;i<e.length;i++)try{r=n(e.substring(0,i))}catch(uS){if("Unexpected end of data"!==uS.message)throw uS}let s="/C";return r&&(s=`/${Ce.encode(r).slice(1,-1).toUpperCase()||"C"}`),s}function MP(e){return{...e,prefix:e.prefix?LP(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e({key:PP(t.key),value:t.value}))):void 0,orders:e.orders?e.orders.map((e=>(t,n)=>e({key:PP(t.key),value:t.value},{key:PP(n.key),value:n.value}))):void 0}}function BP(e){return{...e,prefix:e.prefix?LP(e.prefix):void 0,filters:e.filters?e.filters.map((e=>t=>e(PP(t)))):void 0,orders:e.orders?e.orders.map((e=>(t,n)=>e(PP(t),PP(n)))):void 0}}class UP extends NP{constructor(e){super(),this.child=e}open(){return this.child.open()}close(){return this.child.close()}async*query(e,t){for await(const{key:n,value:r}of this.child.query(MP(e),t))yield{key:PP(n),value:r}}async*queryKeys(e,t){for await(const n of this.child.queryKeys(BP(e),t))yield PP(n)}async get(e,t){return this.child.get(DP(e),t)}async*getMany(e,t){for await(const n of e)yield this.get(n,t)}async put(e,t,n){await this.child.put(DP(e),t,n)}async*putMany(e,t){const n=im({objectMode:!0}),r=globalThis.process&&globalThis.process.nextTick?globalThis.process.nextTick:globalThis.setImmediate||globalThis.setTimeout;r((async()=>{try{const r=this.child;await Zg(this.child.putMany(async function*(){for await(const s of e){const e=DP(s.key),i=await r.has(e,t);i||(yield{key:e,value:s.value}),n.push(s)}}())),n.end()}catch(uS){n.end(uS)}})),yield*n}has(e,t){return this.child.has(DP(e),t)}delete(e,t){return this.child.delete(DP(e),t)}deleteMany(e,t){const n=im({objectMode:!0});return Zg(this.child.deleteMany(async function*(){for await(const t of e)yield DP(t),n.push(t);n.end()}(),t)).catch((e=>{n.end(e)})),n}}function VP(e,t,n){const r=n.path||"ipfs";return bP(r,(e=>t.getCodec(e)),{root:new kP(r,{prefix:"",version:2}),blocks:new UP(new kP(`${r}/blocks`,{prefix:"",version:2})),datastore:new kP(`${r}/datastore`,{prefix:"",version:2}),keys:new kP(`${r}/keys`,{prefix:"",version:2}),pins:new kP(`${r}/pins`,{prefix:"",version:2})},{autoMigrate:n.autoMigrate,onMigrationProgress:n.onMigrationProgress||e,repoLock:GD})}const FP={ERR_SIGNATURE_NOT_VALID:"ERR_SIGNATURE_NOT_VALID"};var jP;function zP(e){return e instanceof Uint8Array?{get(t){return e[t]},set(t,n){e[t]=n}}:{get(t){return e.get(t)},set(t,n){e.set(t,n)}}}(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.publicKey&&e.publicKey.byteLength>0)&&(t.uint32(10),t.bytes(e.publicKey)),(!0===n.writeDefaults||null!=e.payloadType&&e.payloadType.byteLength>0)&&(t.uint32(18),t.bytes(e.payloadType)),(!0===n.writeDefaults||null!=e.payload&&e.payload.byteLength>0)&&(t.uint32(26),t.bytes(e.payload)),(!0===n.writeDefaults||null!=e.signature&&e.signature.byteLength>0)&&(t.uint32(42),t.bytes(e.signature)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={publicKey:new Uint8Array(0),payloadType:new Uint8Array(0),payload:new Uint8Array(0),signature:new Uint8Array(0)},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.publicKey=e.bytes();break;case 2:n.payloadType=e.bytes();break;case 3:n.payload=e.bytes();break;case 5:n.signature=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(jP||(jP={}));const $P=4294967296;class HP{constructor(e=0,t=0){this.hi=e,this.lo=t}toBigInt(e){if(!0===e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31!==0){const e=1+~this.lo>>>0;let t=~this.hi>>>0;return 0===e&&(t=t+1>>>0),-(BigInt(e)+(BigInt(t)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toNumber(e){return Number(this.toBigInt(e))}zzDecode(){const e=-(1&this.lo),t=((this.lo>>>1|this.hi<<31)^e)>>>0,n=(this.hi>>>1^e)>>>0;return new HP(n,t)}zzEncode(){const e=this.hi>>31,t=((this.hi<<1|this.lo>>>31)^e)>>>0,n=(this.lo<<1^e)>>>0;return new HP(t,n)}toBytes(e,t=0){const n=zP(e);while(this.hi>0)n.set(t++,127&this.lo|128),this.lo=(this.lo>>>7|this.hi<<25)>>>0,this.hi>>>=7;while(this.lo>127)n.set(t++,127&this.lo|128),this.lo=this.lo>>>7;n.set(t++,this.lo)}static fromBigInt(e){if(0n===e)return new HP;const t=e<0;t&&(e=-e);let n=0|Number(e>>32n),r=0|Number(e-(BigInt(n)<<32n));return t&&(n=~n>>>0,r=~r>>>0,++r>$P&&(r=0,++n>$P&&(n=0))),new HP(n,r)}static fromNumber(e){if(0===e)return new HP;const t=e<0;t&&(e=-e);let n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new HP(r,n)}static fromBytes(e,t=0){const n=zP(e),r=new HP;let s=0;if(e.length-t>4){for(;s<4;++s)if(r.lo=(r.lo|(127&n.get(t))<<7*s)>>>0,n.get(t++)<128)return r;if(r.lo=(r.lo|(127&n.get(t))<<28)>>>0,r.hi=(r.hi|(127&n.get(t))>>4)>>>0,n.get(t++)<128)return r;s=0}else for(;s<4;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(r.lo=(r.lo|(127&n.get(t))<<7*s)>>>0,n.get(t++)<128)return r}if(e.length-t>4){for(;s<5;++s)if(r.hi=(r.hi|(127&n.get(t))<<7*s+3)>>>0,n.get(t++)<128)return r}else if(t<e.byteLength)for(;s<5;++s){if(t>=e.length)throw RangeError(`index out of range: ${t} > ${e.length}`);if(r.hi=(r.hi|(127&n.get(t))<<7*s+3)>>>0,n.get(t++)<128)return r}throw RangeError("invalid varint encoding")}}const KP=Math.pow(2,7),qP=Math.pow(2,14),GP=Math.pow(2,21),WP=Math.pow(2,28),YP=Math.pow(2,35),JP=Math.pow(2,42),QP=Math.pow(2,49),XP=Math.pow(2,56),ZP=Math.pow(2,63),eL={encodingLength(e){return e<KP?1:e<qP?2:e<GP?3:e<WP?4:e<YP?5:e<JP?6:e<QP?7:e<XP?8:e<ZP?9:10},encode(e,t,n=0){if(null!=Number.MAX_SAFE_INTEGER&&e>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return null==t&&(t=Bo(eL.encodingLength(e))),HP.fromNumber(e).toBytes(t,n),t},decode(e,t=0){return HP.fromBytes(e,t).toNumber(!0)}};class tL{constructor(e){const{peerId:t,payloadType:n,payload:r,signature:s}=e;this.peerId=t,this.payloadType=n,this.payload=r,this.signature=s}marshal(){if(null==this.peerId.publicKey)throw new Error("Missing public key");return null==this.marshaled&&(this.marshaled=jP.encode({publicKey:this.peerId.publicKey,payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return Ja(this.marshal(),e.marshal())}async validate(e){const t=nL(e,this.payloadType,this.payload);if(null==this.peerId.publicKey)throw new Error("Missing public key");const n=Gf(this.peerId.publicKey);return await n.verify(t.subarray(),this.signature)}}tL.createFromProtobuf=async e=>{const t=jP.decode(e),n=await $u(t.publicKey);return new tL({peerId:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})},tL.seal=async(e,t)=>{if(null==t.privateKey)throw new Error("Missing private key");const n=e.domain,r=e.codec,s=e.marshal(),i=nL(n,r,s),o=await Yf(t.privateKey),a=await o.sign(i.subarray());return new tL({peerId:t,payloadType:r,payload:s,signature:a})},tL.openAndCertify=async(e,t)=>{const n=await tL.createFromProtobuf(e),r=await n.validate(t);if(!r)throw je(new Error("envelope signature is not valid for the given domain"),FP.ERR_SIGNATURE_NOT_VALID);return n};const nL=(e,t,n)=>{const r=$o(e),s=eL.encode(r.byteLength),i=eL.encode(t.length),o=eL.encode(n.length);return new Aw(s,r,i,t,o,n)};function rL(e,t){const n=(e,t)=>e.toString().localeCompare(t.toString());return e.length===t.length&&(t.sort(n),e.sort(n).every(((e,n)=>t[n].equals(e))))}var sL;(function(e){let t,n;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.multiaddr&&e.multiaddr.byteLength>0)&&(t.uint32(10),t.bytes(e.multiaddr)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={multiaddr:new Uint8Array(0)},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.multiaddr=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(t=e.AddressInfo||(e.AddressInfo={})),e.codec=()=>(null==n&&(n=Ih(((t,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),(!0===r.writeDefaults||null!=t.peerId&&t.peerId.byteLength>0)&&(n.uint32(10),n.bytes(t.peerId)),!0!==r.writeDefaults&&0n===t.seq||(n.uint32(16),n.uint64(t.seq)),null!=t.addresses)for(const s of t.addresses)n.uint32(26),e.AddressInfo.codec().encode(s,n,{writeDefaults:!0});!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={peerId:new Uint8Array(0),seq:0n,addresses:[]},s=null==n?t.len:t.pos+n;while(t.pos<s){const n=t.uint32();switch(n>>>3){case 1:r.peerId=t.bytes();break;case 2:r.seq=t.uint64();break;case 3:r.addresses.push(e.AddressInfo.codec().decode(t,t.uint32()));break;default:t.skipType(7&n);break}}return r}))),n),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(sL||(sL={}));const iL="libp2p-peer-record",oL=Uint8Array.from([3,1]);class aL{constructor(e){this.domain=aL.DOMAIN,this.codec=aL.CODEC;const{peerId:t,multiaddrs:n,seqNumber:r}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=r??BigInt(Date.now())}marshal(){return null==this.marshaled&&(this.marshaled=sL.encode({peerId:this.peerId.toBytes(),seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map((e=>({multiaddr:e.bytes})))})),this.marshaled}equals(e){return e instanceof aL&&(!!this.peerId.equals(e.peerId)&&(this.seqNumber===e.seqNumber&&!!rL(this.multiaddrs,e.multiaddrs)))}}aL.createFromProtobuf=e=>{const t=sL.decode(e),n=ju(t.peerId),r=(t.addresses??[]).map((e=>dc(e.multiaddr))),s=t.seq;return new aL({peerId:n,multiaddrs:r,seqNumber:s})},aL.DOMAIN=iL,aL.CODEC=oL;const cL=Symbol.for("@libp2p/topology");function lL(e){return null!=e&&Boolean(e[cL])}const uL=()=>{};class hL{constructor(e){this.min=e.min??0,this.max=e.max??1/0,this.peers=new Set,this.onConnect=e.onConnect??uL,this.onDisconnect=e.onDisconnect??uL}get[Symbol.toStringTag](){return cL.toString()}get[cL](){return!0}async setRegistrar(e){this.registrar=e}disconnect(e){this.onDisconnect(e)}}function dL(e){return new hL(e)}var pL,fL=function(e,t,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"===typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(e):r?r.value:t.get(e)};class gL extends EventTarget{constructor(){super(...arguments),pL.set(this,new Map)}listenerCount(e){const t=fL(this,pL,"f").get(e);return null==t?0:t.length}addEventListener(e,t,n){super.addEventListener(e,t,n);let r=fL(this,pL,"f").get(e);null==r&&(r=[],fL(this,pL,"f").set(e,r)),r.push({callback:t,once:(!0!==n&&!1!==n&&n?.once)??!1})}removeEventListener(e,t,n){super.removeEventListener(e.toString(),t??null,n);let r=fL(this,pL,"f").get(e);null!=r&&(r=r.filter((({callback:e})=>e!==t)),fL(this,pL,"f").set(e,r))}dispatchEvent(e){const t=super.dispatchEvent(e);let n=fL(this,pL,"f").get(e.type);return null==n||(n=n.filter((({once:e})=>!e)),fL(this,pL,"f").set(e.type,n)),t}}pL=new WeakMap;class mL extends Event{constructor(e,t){super(e,t),this.detail=t?.detail}}const yL=globalThis.CustomEvent??mL;class wL{constructor(e,t,n){this.gossip=e,this.msgs=new Map,this.history=[],this.msgIdToStrFn=n;for(let r=0;r<t;r++)this.history[r]=[]}get size(){return this.msgs.size}put(e,t,n=!1){const{msgIdStr:r}=e;return!this.msgs.has(r)&&(this.msgs.set(r,{message:t,validated:n,originatingPeers:new Set,iwantCounts:new Map}),this.history[0].push({...e,topic:t.topic}),!0)}observeDuplicate(e,t){const n=this.msgs.get(e);n&&!n.validated&&n.originatingPeers.add(t)}get(e){return this.msgs.get(this.msgIdToStrFn(e))?.message}getWithIWantCount(e,t){const n=this.msgs.get(e);if(!n)return null;const r=(n.iwantCounts.get(t)??0)+1;return n.iwantCounts.set(t,r),{msg:n.message,count:r}}getGossipIDs(e){const t=new Map;for(let n=0;n<this.gossip;n++)this.history[n].forEach((n=>{const r=this.msgs.get(n.msgIdStr);if(r&&r.validated&&e.has(n.topic)){let e=t.get(n.topic);e||(e=[],t.set(n.topic,e)),e.push(n.msgId)}}));return t}validate(e){const t=this.msgs.get(e);if(!t)return null;const{message:n,originatingPeers:r}=t;return t.validated=!0,t.originatingPeers=new Set,{message:n,originatingPeers:r}}shift(){const e=this.history[this.history.length-1];e.forEach((e=>{this.msgs.delete(e.msgIdStr)})),this.history.pop(),this.history.unshift([])}remove(e){const t=this.msgs.get(e);return t?(this.msgs.delete(e),t):null}}var bL=n(4581);const{RPC:vL}=bL,EL=1e3,_L=60*EL,SL="/floodsub/1.0.0",kL="/meshsub/1.0.0",AL="/meshsub/1.1.0",TL=6,CL=4,IL=12,RL=4,OL=2,xL=5,NL=3,DL=6,PL=.25,LL=3,ML=100,BL=EL,UL=_L,VL=16,FL=_L,jL=15,zL=300,$L=EL,HL=60,KL=2,qL=10*EL,GL=5e3,WL=10,YL=3*EL,JL=2*_L,QL=12e4,XL="ERR_TOPIC_VALIDATOR_REJECT",ZL="ERR_TOPIC_VALIDATOR_IGNORE",eM=0,tM=128,nM=1e3,rM=1e3;function sM(e=[],t){return{subscriptions:[],messages:e,control:t?{graft:t.graft||[],prune:t.prune||[],ihave:t.ihave||[],iwant:t.iwant||[]}:void 0}}function iM(e){if(e.length<=1)return e;const t=()=>Math.floor(Math.random()*Math.floor(e.length));for(let n=0;n<e.length;n++){const r=t(),s=e[n];e[n]=e[r],e[r]=s}return e}function oM(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==n[o])throw new TypeError(i+" is ambiguous");n[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";var n=0,r=0,s=0,i=t.length;while(s!==i&&0===t[s])s++,n++;var o=(i-s)*u+1>>>0,l=new Uint8Array(o);while(s!==i){for(var h=t[s],d=0,p=o-1;(0!==h||d<r)&&-1!==p;p--,d++)h+=256*l[p]>>>0,l[p]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,s++}var f=o-r;while(f!==o&&0===l[f])f++;for(var g=c.repeat(n);f<o;++f)g+=e.charAt(l[f]);return g}function d(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){var r=0,s=0;while(e[t]===c)r++,t++;var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);while(e[t]){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<s)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,t++}if(" "!==e[t]){var p=i-s;while(p!==i&&0===o[p])p++;var f=new Uint8Array(r+(i-p)),g=r;while(p!==i)f[g++]=o[p++];return f}}}function p(e){var n=d(e);if(n)return n;throw new Error(`Non-${t} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var aM=oM,cM=aM,lM=cM;new Uint8Array(0);const uM=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},hM=e=>(new TextEncoder).encode(e),dM=e=>(new TextDecoder).decode(e);class pM{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class fM{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return mM(this,e)}}class gM{constructor(e){this.decoders=e}or(e){return mM(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const mM=(e,t)=>new gM({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class yM{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new pM(e,t,n),this.decoder=new fM(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const wM=({name:e,prefix:t,encode:n,decode:r})=>new yM(e,t,n,r),bM=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:s}=lM(n,t);return wM({prefix:e,name:t,encode:r,decode:e=>uM(s(e))})},vM=(e,t,n,r)=>{const s={};for(let u=0;u<t.length;++u)s[t[u]]=u;let i=e.length;while("="===e[i-1])--i;const o=new Uint8Array(i*n/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const t=s[e[u]];if(void 0===t)throw new SyntaxError(`Non-${r} character`);c=c<<n|t,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},EM=(e,t,n)=>{const r="="===t[t.length-1],s=(1<<n)-1;let i="",o=0,a=0;for(let c=0;c<e.length;++c){a=a<<8|e[c],o+=8;while(o>n)o-=n,i+=t[s&a>>o]}if(o&&(i+=t[s&a<<n-o]),r)while(i.length*n&7)i+="=";return i},_M=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>wM({prefix:t,name:e,encode(e){return EM(e,r,n)},decode(t){return vM(t,r,n,e)}}),SM=wM({prefix:"\0",name:"identity",encode:e=>dM(e),decode:e=>hM(e)}),kM=_M({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),AM=_M({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),TM=bM({prefix:"9",name:"base10",alphabet:"0123456789"}),CM=_M({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),IM=_M({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),RM=_M({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),OM=_M({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),xM=_M({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),NM=_M({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),DM=_M({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),PM=_M({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),LM=_M({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),MM=_M({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),BM=_M({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),UM=bM({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),VM=bM({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),FM=bM({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),jM=bM({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),zM=_M({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),$M=_M({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),HM=_M({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),KM=_M({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),qM=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),GM=qM.reduce(((e,t,n)=>(e[n]=t,e)),[]),WM=qM.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);function YM(e){return e.reduce(((e,t)=>(e+=GM[t],e)),"")}function JM(e){const t=[];for(const n of e){const e=WM[n.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}const QM=wM({prefix:"🚀",name:"base256emoji",encode:YM,decode:JM});var XM=rB,ZM=128,eB=127,tB=~eB,nB=Math.pow(2,31);function rB(e,t,n){t=t||[],n=n||0;var r=n;while(e>=nB)t[n++]=255&e|ZM,e/=128;while(e&tB)t[n++]=255&e|ZM,e>>>=7;return t[n]=0|e,rB.bytes=n-r+1,t}var sB=aB,iB=128,oB=127;function aB(e,t){var n,r=0,s=(t=t||0,0),i=t,o=e.length;do{if(i>=o)throw aB.bytes=0,new RangeError("Could not decode varint");n=e[i++],r+=s<28?(n&oB)<<s:(n&oB)*Math.pow(2,s),s+=7}while(n>=iB);return aB.bytes=i-t,r}var cB=Math.pow(2,7),lB=Math.pow(2,14),uB=Math.pow(2,21),hB=Math.pow(2,28),dB=Math.pow(2,35),pB=Math.pow(2,42),fB=Math.pow(2,49),gB=Math.pow(2,56),mB=Math.pow(2,63),yB=function(e){return e<cB?1:e<lB?2:e<uB?3:e<hB?4:e<dB?5:e<pB?6:e<fB?7:e<gB?8:e<mB?9:10},wB={encode:XM,decode:sB,encodingLength:yB},bB=wB,vB=bB;const EB=(e,t,n=0)=>(vB.encode(e,t,n),t),_B=e=>vB.encodingLength(e),SB=(e,t)=>{const n=t.byteLength,r=_B(e),s=r+_B(n),i=new Uint8Array(s+n);return EB(e,i,0),EB(n,i,r),i.set(t,s),new kB(e,n,t,i)};class kB{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const AB=({name:e,code:t,encode:n})=>new TB(e,t,n);class TB{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?SB(this.code,t):t.then((e=>SB(this.code,e)))}throw Error("Unknown type, must be binary type")}}const CB=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),IB=AB({name:"sha2-256",code:18,encode:CB("SHA-256")}),RB=AB({name:"sha2-512",code:19,encode:CB("SHA-512")}),OB=0,xB="identity",NB=uM,DB=e=>SB(OB,NB(e)),PB={code:OB,name:xB,encode:NB,digest:DB},LB="raw",MB=85,BB=e=>uM(e),UB=e=>uM(e),VB=new TextEncoder,FB=new TextDecoder,jB="json",zB=512,$B=e=>VB.encode(JSON.stringify(e)),HB=e=>JSON.parse(FB.decode(e));class KB{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:cid_hidden,byteLength:cid_hidden,code:cid_readonly,version:cid_readonly,multihash:cid_readonly,bytes:cid_readonly,_baseCache:cid_hidden,asCID:cid_hidden})}toV0(){switch(this.version){case 0:return this;default:{const{code:e,multihash:t}=this;if(e!==cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return KB.createV0(t)}}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Digest.create(e,t);return KB.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Digest.equals(this.multihash,e.multihash)}toString(e){const{bytes:t,version:n,_baseCache:r}=this;switch(n){case 0:return cid_toStringV0(t,r,e||base58btc.encoder);default:return cid_toStringV1(t,r,e||base32.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return deprecate(/^0\.0/,IS_CID_DEPRECATION),!(!e||!e[cid_cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof KB)return e;if(null!=e&&e.asCID===e){const{version:t,code:n,multihash:r,bytes:s}=e;return new KB(t,n,r,s||cid_encodeCID(t,n,r.bytes))}if(null!=e&&!0===e[cid_cidSymbol]){const{version:t,multihash:n,code:r}=e,s=Digest.decode(n);return KB.create(t,r,s)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${cid_DAG_PB_CODE}) block encoding`);return new KB(e,t,n,n.bytes);case 1:{const r=cid_encodeCID(e,t,n.bytes);return new KB(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return KB.create(0,cid_DAG_PB_CODE,e)}static createV1(e,t){return KB.create(1,e,t)}static decode(e){const[t,n]=KB.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=KB.inspectBytes(e),n=t.size-t.multihashSize,r=coerce(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=r.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,r),o=0===t.version?KB.createV0(i):KB.createV1(t.codec,i);return[o,e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=varint.decode(e.subarray(t));return r,n};let r=n(),s=cid_DAG_PB_CODE;if(18===r?(0,0):1===r&&n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const i=t,o=n(),a=n(),c=t+a,l=c-i;return{version:r,codec:s,multihashCode:o,digestSize:a,multihashSize:l,size:c}}static parse(e,t){const[n,r]=cid_parseCIDtoBytes(e,t),s=KB.decode(r);return s._baseCache.set(n,e),s}}Symbol.for("@ipld/js-cid/CID");const qB={...A,...T,...C,...I,...R,...O,...x,...N,...D,...P};function GB(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function WB(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?GB(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function YB(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const JB=YB("utf8","u",(e=>{const t=new TextDecoder("utf8");return"u"+t.decode(e)}),(e=>{const t=new TextEncoder;return t.encode(e.substring(1))})),QB=YB("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{e=e.substring(1);const t=WB(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),XB={utf8:JB,"utf-8":JB,hex:qB.base16,latin1:QB,ascii:QB,binary:QB,...qB};var ZB=XB;function eU(e,t="utf8"){const n=ZB[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.encoder.encode(e).substring(1):globalThis.Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("utf8")}function tU(e){return eU(e,"base64")}const nU="StrictSign",rU="StrictNoSign";var sU,iU,oU,aU,cU,lU;function uU(e){switch(e){case oU.Ignore:return aU.Ignore;case oU.Reject:return aU.Reject}}async function hU(e,t){switch(e){case nU:{if(!t)throw Error("Must provide PeerId");if(null==t.privateKey)throw Error("Cannot sign message, no private key present");if(null==t.publicKey)throw Error("Cannot sign message, no public key present");const e=await Yf(t.privateKey);return{type:iU.Signing,author:t,key:t.publicKey,privateKey:e}}case rU:return{type:iU.Anonymous};default:throw new Error(`Unknown signature policy "${e}"`)}}(function(e){e["StrictSign"]="StrictSign",e["StrictNoSign"]="StrictNoSign"})(sU||(sU={})),function(e){e[e["Signing"]=0]="Signing",e[e["Anonymous"]=1]="Anonymous"}(iU||(iU={})),function(e){e["Accept"]="accept",e["Ignore"]="ignore",e["Reject"]="reject"}(oU||(oU={})),function(e){e["Error"]="error",e["Ignore"]="ignore",e["Reject"]="reject",e["Blacklisted"]="blacklisted"}(aU||(aU={})),function(e){e["InvalidSignature"]="invalid_signature",e["InvalidSeqno"]="invalid_seqno",e["InvalidPeerId"]="invalid_peerid",e["SignaturePresent"]="signature_present",e["SeqnoPresent"]="seqno_present",e["FromPresent"]="from_present",e["TransformFailed"]="transform_failed"}(cU||(cU={})),function(e){e["duplicate"]="duplicate",e["invalid"]="invalid",e["valid"]="valid"}(lU||(lU={}));const dU="ERR_INVALID_PEER_SCORE_PARAMS",pU={topics:{},topicScoreCap:10,appSpecificScore:()=>0,appSpecificWeight:10,IPColocationFactorWeight:-5,IPColocationFactorThreshold:10,IPColocationFactorWhitelist:new Set,behaviourPenaltyWeight:-10,behaviourPenaltyThreshold:0,behaviourPenaltyDecay:.2,decayInterval:1e3,decayToZero:.1,retainScore:36e5},fU={topicWeight:.5,timeInMeshWeight:1,timeInMeshQuantum:1,timeInMeshCap:3600,firstMessageDeliveriesWeight:1,firstMessageDeliveriesDecay:.5,firstMessageDeliveriesCap:2e3,meshMessageDeliveriesWeight:-1,meshMessageDeliveriesDecay:.5,meshMessageDeliveriesCap:100,meshMessageDeliveriesThreshold:20,meshMessageDeliveriesWindow:10,meshMessageDeliveriesActivation:5e3,meshFailurePenaltyWeight:-1,meshFailurePenaltyDecay:.5,invalidMessageDeliveriesWeight:-1,invalidMessageDeliveriesDecay:.3};function gU(e={}){return{...pU,...e,topics:e.topics?Object.entries(e.topics).reduce(((e,[t,n])=>(e[t]=mU(n),e)),{}):{}}}function mU(e={}){return{...fU,...e}}function yU(e){for(const[n,r]of Object.entries(e.topics))try{wU(r)}catch(t){throw je(new Error(`invalid score parameters for topic ${n}: ${t.message}`),dU)}if(e.topicScoreCap<0)throw je(new Error("invalid topic score cap; must be positive (or 0 for no cap)"),dU);if(null===e.appSpecificScore||void 0===e.appSpecificScore)throw je(new Error("missing application specific score function"),dU);if(e.IPColocationFactorWeight>0)throw je(new Error("invalid IPColocationFactorWeight; must be negative (or 0 to disable)"),dU);if(0!==e.IPColocationFactorWeight&&e.IPColocationFactorThreshold<1)throw je(new Error("invalid IPColocationFactorThreshold; must be at least 1"),dU);if(e.behaviourPenaltyWeight>0)throw je(new Error("invalid BehaviourPenaltyWeight; must be negative (or 0 to disable)"),dU);if(0!==e.behaviourPenaltyWeight&&(e.behaviourPenaltyDecay<=0||e.behaviourPenaltyDecay>=1))throw je(new Error("invalid BehaviourPenaltyDecay; must be between 0 and 1"),dU);if(e.decayInterval<1e3)throw je(new Error("invalid DecayInterval; must be at least 1s"),dU);if(e.decayToZero<=0||e.decayToZero>=1)throw je(new Error("invalid DecayToZero; must be between 0 and 1"),dU)}function wU(e){if(e.topicWeight<0)throw je(new Error("invalid topic weight; must be >= 0"),dU);if(0===e.timeInMeshQuantum)throw je(new Error("invalid TimeInMeshQuantum; must be non zero"),dU);if(e.timeInMeshWeight<0)throw je(new Error("invalid TimeInMeshWeight; must be positive (or 0 to disable)"),dU);if(0!==e.timeInMeshWeight&&e.timeInMeshQuantum<=0)throw je(new Error("invalid TimeInMeshQuantum; must be positive"),dU);if(0!==e.timeInMeshWeight&&e.timeInMeshCap<=0)throw je(new Error("invalid TimeInMeshCap; must be positive"),dU);if(e.firstMessageDeliveriesWeight<0)throw je(new Error("invallid FirstMessageDeliveriesWeight; must be positive (or 0 to disable)"),dU);if(0!==e.firstMessageDeliveriesWeight&&(e.firstMessageDeliveriesDecay<=0||e.firstMessageDeliveriesDecay>=1))throw je(new Error("invalid FirstMessageDeliveriesDecay; must be between 0 and 1"),dU);if(0!==e.firstMessageDeliveriesWeight&&e.firstMessageDeliveriesCap<=0)throw je(new Error("invalid FirstMessageDeliveriesCap; must be positive"),dU);if(e.meshMessageDeliveriesWeight>0)throw je(new Error("invalid MeshMessageDeliveriesWeight; must be negative (or 0 to disable)"),dU);if(0!==e.meshMessageDeliveriesWeight&&(e.meshMessageDeliveriesDecay<=0||e.meshMessageDeliveriesDecay>=1))throw je(new Error("invalid MeshMessageDeliveriesDecay; must be between 0 and 1"),dU);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesCap<=0)throw je(new Error("invalid MeshMessageDeliveriesCap; must be positive"),dU);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesThreshold<=0)throw je(new Error("invalid MeshMessageDeliveriesThreshold; must be positive"),dU);if(e.meshMessageDeliveriesWindow<0)throw je(new Error("invalid MeshMessageDeliveriesWindow; must be non-negative"),dU);if(0!==e.meshMessageDeliveriesWeight&&e.meshMessageDeliveriesActivation<1e3)throw je(new Error("invalid MeshMessageDeliveriesActivation; must be at least 1s"),dU);if(e.meshFailurePenaltyWeight>0)throw je(new Error("invalid MeshFailurePenaltyWeight; must be negative (or 0 to disable)"),dU);if(0!==e.meshFailurePenaltyWeight&&(e.meshFailurePenaltyDecay<=0||e.meshFailurePenaltyDecay>=1))throw je(new Error("invalid MeshFailurePenaltyDecay; must be between 0 and 1"),dU);if(e.invalidMessageDeliveriesWeight>0)throw je(new Error("invalid InvalidMessageDeliveriesWeight; must be negative (or 0 to disable)"),dU);if(e.invalidMessageDeliveriesDecay<=0||e.invalidMessageDeliveriesDecay>=1)throw je(new Error("invalid InvalidMessageDeliveriesDecay; must be between 0 and 1"),dU)}const bU={gossipThreshold:-10,publishThreshold:-50,graylistThreshold:-80,acceptPXThreshold:10,opportunisticGraftThreshold:20};function vU(e={}){return{...bU,...e}}function EU(e,t,n,r){let s=0;Object.entries(t.topics).forEach((([e,t])=>{const r=n.topics[e];if(void 0===r)return;let i=0;if(t.inMesh){let e=t.meshTime/r.timeInMeshQuantum;e>r.timeInMeshCap&&(e=r.timeInMeshCap),i+=e*r.timeInMeshWeight}let o=t.firstMessageDeliveries;if(o>r.firstMessageDeliveriesCap&&(o=r.firstMessageDeliveriesCap),i+=o*r.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<r.meshMessageDeliveriesThreshold){const e=r.meshMessageDeliveriesThreshold-t.meshMessageDeliveries,n=e*e;i+=n*r.meshMessageDeliveriesWeight}const a=t.meshFailurePenalty;i+=a*r.meshFailurePenaltyWeight;const c=t.invalidMessageDeliveries*t.invalidMessageDeliveries;i+=c*r.invalidMessageDeliveriesWeight,s+=i*r.topicWeight})),n.topicScoreCap>0&&s>n.topicScoreCap&&(s=n.topicScoreCap);const i=n.appSpecificScore(e);if(s+=i*n.appSpecificWeight,t.ips.forEach((e=>{if(n.IPColocationFactorWhitelist.has(e))return;const t=r.get(e),i=t?t.size:0;if(i>n.IPColocationFactorThreshold){const e=i-n.IPColocationFactorThreshold,t=e*e;s+=t*n.IPColocationFactorWeight}})),t.behaviourPenalty>n.behaviourPenaltyThreshold){const e=t.behaviourPenalty-n.behaviourPenaltyThreshold,r=e*e;s+=r*n.behaviourPenaltyWeight}return s}var _U,SU=n(7051);(function(e){e[e["unknown"]=0]="unknown",e[e["valid"]=1]="valid",e[e["invalid"]=2]="invalid",e[e["ignored"]=3]="ignored"})(_U||(_U={}));class kU{constructor(){this.records=new Map,this.queue=new SU}ensureRecord(e){let t=this.records.get(e);if(t)return t;t={status:_U.unknown,firstSeen:Date.now(),validated:0,peers:new Set},this.records.set(e,t);const n={msgId:e,expire:Date.now()+QL};return this.queue.push(n),t}gc(){const e=Date.now();let t=this.queue.peekFront();while(t&&t.expire<e)this.records.delete(t.msgId),this.queue.shift(),t=this.queue.peekFront()}clear(){this.records.clear(),this.queue.clear()}}function AU(e){return null!=e&&"function"===typeof e.start&&"function"===typeof e.stop}function TU(e){return null!=e&&"function"===typeof e.init}class CU{constructor(e={}){this.started=!1,null!=e.peerId&&this.setPeerId(e.peerId),null!=e.addressManager&&this.setAddressManager(e.addressManager),null!=e.peerStore&&this.setPeerStore(e.peerStore),null!=e.upgrader&&this.setUpgrader(e.upgrader),null!=e.metrics&&this.setMetrics(e.metrics),null!=e.registrar&&this.setRegistrar(e.registrar),null!=e.connectionManager&&this.setConnectionManager(e.connectionManager),null!=e.transportManager&&this.setTransportManager(e.transportManager),null!=e.connectionGater&&this.setConnectionGater(e.connectionGater),null!=e.contentRouting&&this.setContentRouting(e.contentRouting),null!=e.peerRouting&&this.setPeerRouting(e.peerRouting),null!=e.datastore&&this.setDatastore(e.datastore),null!=e.connectionProtector&&this.setConnectionProtector(e.connectionProtector),null!=e.dht&&this.setDHT(e.dht),null!=e.pubsub&&this.setPubSub(e.pubsub),null!=e.dialer&&this.setDialer(e.dialer)}isStarted(){return this.started}async beforeStart(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.beforeStart&&await e.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{await e.start()}))),this.started=!0}async afterStart(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.beforeStop&&await e.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{await e.stop()}))),this.started=!1}async afterStop(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.afterStop&&await e.afterStop()})))}setPeerId(e){return this.peerId=e,e}getPeerId(){if(null==this.peerId)throw je(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this.peerId}setMetrics(e){return this.metrics=e,TU(e)&&e.init(this),e}getMetrics(){return this.metrics}setAddressManager(e){return this.addressManager=e,TU(e)&&e.init(this),e}getAddressManager(){if(null==this.addressManager)throw je(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this.addressManager}setPeerStore(e){return this.peerStore=e,TU(e)&&e.init(this),e}getPeerStore(){if(null==this.peerStore)throw je(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this.peerStore}setUpgrader(e){return this.upgrader=e,TU(e)&&e.init(this),e}getUpgrader(){if(null==this.upgrader)throw je(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this.upgrader}setRegistrar(e){return this.registrar=e,TU(e)&&e.init(this),e}getRegistrar(){if(null==this.registrar)throw je(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this.registrar}setConnectionManager(e){return this.connectionManager=e,TU(e)&&e.init(this),e}getConnectionManager(){if(null==this.connectionManager)throw je(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this.connectionManager}setTransportManager(e){return this.transportManager=e,TU(e)&&e.init(this),e}getTransportManager(){if(null==this.transportManager)throw je(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this.transportManager}setConnectionGater(e){return this.connectionGater=e,TU(e)&&e.init(this),e}getConnectionGater(){if(null==this.connectionGater)throw je(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this.connectionGater}setContentRouting(e){return this.contentRouting=e,TU(e)&&e.init(this),e}getContentRouting(){if(null==this.contentRouting)throw je(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this.contentRouting}setPeerRouting(e){return this.peerRouting=e,TU(e)&&e.init(this),e}getPeerRouting(){if(null==this.peerRouting)throw je(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this.peerRouting}setDatastore(e){return this.datastore=e,TU(e)&&e.init(this),e}getDatastore(){if(null==this.datastore)throw je(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this.datastore}setConnectionProtector(e){return this.connectionProtector=e,TU(e)&&e.init(this),e}getConnectionProtector(){return this.connectionProtector}setDHT(e){return this.dht=e,TU(e)&&e.init(this),e}getDHT(){if(null==this.dht)throw je(new Error("dht not set"),"ERR_SERVICE_MISSING");return this.dht}setPubSub(e){return this.pubsub=e,TU(e)&&e.init(this),e}getPubSub(){if(null==this.pubsub)throw je(new Error("pubsub not set"),"ERR_SERVICE_MISSING");return this.pubsub}setDialer(e){return this.dialer=e,TU(e)&&e.init(this),e}getDialer(){if(null==this.dialer)throw je(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this.dialer}}const IU=Fe("libp2p:gossipsub:score");class RU{constructor(e,t,n){this.params=e,this.metrics=t,this.peerStats=new Map,this.peerIPs=new Map,this.scoreCache=new Map,this.deliveryRecords=new kU,this.components=new CU,yU(e),this.scoreCacheValidityMs=n.scoreCacheValidityMs,this.computeScore=n.computeScore??EU}init(e){this.components=e}get size(){return this.peerStats.size}start(){this._backgroundInterval?IU("Peer score already running"):(this._backgroundInterval=setInterval((()=>this.background()),this.params.decayInterval),IU("started"))}stop(){this._backgroundInterval?(clearInterval(this._backgroundInterval),delete this._backgroundInterval,this.peerIPs.clear(),this.peerStats.clear(),this.deliveryRecords.clear(),IU("stopped")):IU("Peer score already stopped")}background(){this.refreshScores(),this.updateIPs(),this.deliveryRecords.gc()}dumpPeerScoreStats(){return Object.fromEntries(Array.from(this.peerStats.entries()).map((([e,t])=>[e,t])))}refreshScores(){const e=Date.now(),t=this.params.decayToZero;this.peerStats.forEach(((n,r)=>{n.connected?(Object.entries(n.topics).forEach((([n,r])=>{const s=this.params.topics[n];void 0!==s&&(r.firstMessageDeliveries*=s.firstMessageDeliveriesDecay,r.firstMessageDeliveries<t&&(r.firstMessageDeliveries=0),r.meshMessageDeliveries*=s.meshMessageDeliveriesDecay,r.meshMessageDeliveries<t&&(r.meshMessageDeliveries=0),r.meshFailurePenalty*=s.meshFailurePenaltyDecay,r.meshFailurePenalty<t&&(r.meshFailurePenalty=0),r.invalidMessageDeliveries*=s.invalidMessageDeliveriesDecay,r.invalidMessageDeliveries<t&&(r.invalidMessageDeliveries=0),r.inMesh&&(r.meshTime=e-r.graftTime,r.meshTime>s.meshMessageDeliveriesActivation&&(r.meshMessageDeliveriesActive=!0)))})),n.behaviourPenalty*=this.params.behaviourPenaltyDecay,n.behaviourPenalty<t&&(n.behaviourPenalty=0)):e>n.expire&&(this.removeIPs(r,n.ips),this.peerStats.delete(r),this.scoreCache.delete(r))}))}score(e){this.metrics?.scoreFnCalls.inc();const t=this.peerStats.get(e);if(!t)return 0;const n=Date.now(),r=this.scoreCache.get(e);if(r&&r.cacheUntil>n)return r.score;this.metrics?.scoreFnRuns.inc();const s=this.computeScore(e,t,this.params,this.peerIPs),i=n+this.scoreCacheValidityMs;return r?(this.metrics?.scoreCachedDelta.observe(Math.abs(s-r.score)),r.score=s,r.cacheUntil=i):this.scoreCache.set(e,{score:s,cacheUntil:i}),s}addPenalty(e,t,n){const r=this.peerStats.get(e);r&&(r.behaviourPenalty+=t,this.metrics?.onScorePenalty(n))}addPeer(e){const t={connected:!0,expire:0,topics:{},ips:[],behaviourPenalty:0};this.peerStats.set(e,t);const n=this.getIPs(e);this.setIPs(e,n,t.ips),t.ips=n}removePeer(e){const t=this.peerStats.get(e);if(t){if(this.score(e)>0)return this.removeIPs(e,t.ips),void this.peerStats.delete(e);Object.entries(t.topics).forEach((([e,t])=>{t.firstMessageDeliveries=0;const n=this.params.topics[e].meshMessageDeliveriesThreshold;if(t.inMesh&&t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<n){const e=n-t.meshMessageDeliveries;t.meshFailurePenalty+=e*e}t.inMesh=!1,t.meshMessageDeliveriesActive=!1})),t.connected=!1,t.expire=Date.now()+this.params.retainScore}}graft(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);e&&(e.inMesh=!0,e.graftTime=Date.now(),e.meshTime=0,e.meshMessageDeliveriesActive=!1)}}prune(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);if(e){const n=this.params.topics[t].meshMessageDeliveriesThreshold;if(e.meshMessageDeliveriesActive&&e.meshMessageDeliveries<n){const t=n-e.meshMessageDeliveries;e.meshFailurePenalty+=t*t}e.meshMessageDeliveriesActive=!1,e.inMesh=!1}}}validateMessage(e){this.deliveryRecords.ensureRecord(e)}deliverMessage(e,t,n){this.markFirstMessageDelivery(e,n);const r=this.deliveryRecords.ensureRecord(t),s=Date.now();r.status===_U.unknown?(r.status=_U.valid,r.validated=s,r.peers.forEach((t=>{t!==e.toString()&&this.markDuplicateMessageDelivery(t,n)}))):IU("unexpected delivery: message from %s was first seen %s ago and has delivery status %s",e,s-r.firstSeen,_U[r.status])}rejectInvalidMessage(e,t){this.markInvalidMessageDelivery(e,t)}rejectMessage(e,t,n,r){switch(r){case aU.Error:return void this.markInvalidMessageDelivery(e,n);case aU.Blacklisted:return}const s=this.deliveryRecords.ensureRecord(t);if(s.status===_U.unknown){if(r===aU.Ignore)return s.status=_U.ignored,void s.peers.clear();s.status=_U.invalid,this.markInvalidMessageDelivery(e,n),s.peers.forEach((e=>{this.markInvalidMessageDelivery(e,n)})),s.peers.clear()}else IU("unexpected rejection: message from %s was first seen %s ago and has delivery status %d",e,Date.now()-s.firstSeen,_U[s.status])}duplicateMessage(e,t,n){const r=this.deliveryRecords.ensureRecord(t);if(!r.peers.has(e))switch(r.status){case _U.unknown:r.peers.add(e);break;case _U.valid:r.peers.add(e),this.markDuplicateMessageDelivery(e,n,r.validated);break;case _U.invalid:this.markInvalidMessageDelivery(e,n);break;case _U.ignored:break}}markInvalidMessageDelivery(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);e&&(e.invalidMessageDeliveries+=1)}}markFirstMessageDelivery(e,t){const n=this.peerStats.get(e);if(n){const e=this.getPtopicStats(n,t);if(e){let n=this.params.topics[t].firstMessageDeliveriesCap;e.firstMessageDeliveries=Math.min(n,e.firstMessageDeliveries+1),e.inMesh&&(n=this.params.topics[t].meshMessageDeliveriesCap,e.meshMessageDeliveries=Math.min(n,e.meshMessageDeliveries+1))}}}markDuplicateMessageDelivery(e,t,n){const r=this.peerStats.get(e);if(r){const e=void 0!==n?Date.now():0,s=this.getPtopicStats(r,t);if(s&&s.inMesh){const r=this.params.topics[t];if(void 0!==n){const s=e-n,i=s>r.meshMessageDeliveriesWindow;if(this.metrics?.onDuplicateMsgDelivery(t,s,i),i)return}const i=r.meshMessageDeliveriesCap;s.meshMessageDeliveries=Math.min(i,s.meshMessageDeliveries+1)}}}getIPs(e){return this.components.getConnectionManager().getConnections(Fu(e)).map((e=>e.remoteAddr.toOptions().host))}setIPs(e,t,n){e:for(const r of t){for(const e of n)if(r===e)continue e;let t=this.peerIPs.get(r);t||(t=new Set,this.peerIPs.set(r,t)),t.add(e)}e:for(const r of n){for(const e of t)if(r===e)continue e;const n=this.peerIPs.get(r);n&&(n.delete(e),n.size||this.peerIPs.delete(r))}}removeIPs(e,t){t.forEach((t=>{const n=this.peerIPs.get(t);n&&(n.delete(e),n.size||this.peerIPs.delete(t))}))}updateIPs(){this.peerStats.forEach(((e,t)=>{const n=this.getIPs(t);this.setIPs(t,n,e.ips),e.ips=n}))}getPtopicStats(e,t){let n=e.topics[t];return void 0!==n?n:void 0!==this.params.topics[t]?(n={inMesh:!1,graftTime:0,meshTime:0,firstMessageDeliveries:0,meshMessageDeliveries:0,meshMessageDeliveriesActive:!1,meshFailurePenalty:0,invalidMessageDeliveries:0},e.topics[t]=n,n):null}}class OU{constructor(e,t,n){this.gossipsubIWantFollowupMs=e,this.msgIdToStrFn=t,this.metrics=n,this.promises=new Map,this.requestMsByMsg=new Map,this.requestMsByMsgExpire=10*e}get size(){return this.promises.size}get requestMsByMsgSize(){return this.requestMsByMsg.size}addPromise(e,t){const n=Math.floor(Math.random()*t.length),r=t[n],s=this.msgIdToStrFn(r);let i=this.promises.get(s);i||(i=new Map,this.promises.set(s,i));const o=Date.now();i.has(e)||(i.set(e,o+this.gossipsubIWantFollowupMs),this.metrics&&(this.metrics.iwantPromiseStarted.inc(1),this.requestMsByMsg.has(s)||this.requestMsByMsg.set(s,o)))}getBrokenPromises(){const e=Date.now(),t=new Map;let n=0;return this.promises.forEach(((r,s)=>{r.forEach(((s,i)=>{s<e&&(t.set(i,(t.get(i)??0)+1),r.delete(i),n++)})),r.size||this.promises.delete(s)})),this.metrics?.iwantPromiseBroken.inc(n),t}deliverMessage(e){this.trackMessage(e);const t=this.promises.get(e);t&&(this.promises.delete(e),this.metrics&&(this.metrics.iwantPromiseResolved.inc(1),this.metrics.iwantPromiseResolvedPeers.inc(t.size)))}rejectMessage(e,t){switch(this.trackMessage(e),t){case aU.Error:return}this.promises.delete(e)}clear(){this.promises.clear()}prune(){const e=Date.now()-this.requestMsByMsgExpire;for(const[t,n]of this.requestMsByMsg.entries()){if(!(n<e))break;this.requestMsByMsg.delete(t)}}trackMessage(e){if(this.metrics){const t=this.requestMsByMsg.get(e);void 0!==t&&(this.metrics.iwantPromiseDeliveryTime.observe((Date.now()-t)/1e3),this.requestMsByMsg.delete(e))}}}class xU{constructor(e){this.entries=new Map,this.validityMs=e.validityMs}get size(){return this.entries.size}put(e,t){this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs})}prune(){const e=Date.now();for(const[t,n]of this.entries.entries()){if(!(n.validUntilMs<e))break;this.entries.delete(t)}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries.clear()}}var NU,DU,PU,LU,MU,BU;function UU(e,t,n){return{protocolsEnabled:e.gauge({name:"gossipsub_protocol",help:"Status of enabled protocols",labelNames:["protocol"]}),topicSubscriptionStatus:e.gauge({name:"gossipsub_topic_subscription_status",help:"Status of our subscription to this topic",labelNames:["topicStr"]}),topicPeersCount:e.gauge({name:"gossipsub_topic_peer_count",help:"Number of peers subscribed to each topic",labelNames:["topicStr"]}),meshPeerCounts:e.gauge({name:"gossipsub_mesh_peer_count",help:"Number of peers in our mesh",labelNames:["topicStr"]}),meshPeerInclusionEvents:e.gauge({name:"gossipsub_mesh_peer_inclusion_events_total",help:"Number of times we include peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),meshPeerChurnEvents:e.gauge({name:"gossipsub_peer_churn_events_total",help:"Number of times we remove peers in a topic mesh for different reasons",labelNames:["topic","reason"]}),peersPerProtocol:e.gauge({name:"gossipsub_peers_per_protocol_count",help:"Peers connected for each topic",labelNames:["protocol"]}),heartbeatDuration:e.histogram({name:"gossipsub_heartbeat_duration_seconds",help:"The time it takes to complete one iteration of the heartbeat",buckets:[.01,.1,1]}),heartbeatSkipped:e.gauge({name:"gossipsub_heartbeat_skipped",help:"Heartbeat run took longer than heartbeat interval so next is skipped"}),asyncValidationResult:e.gauge({name:"gossipsub_async_validation_result_total",help:"Message validation result for each topic",labelNames:["topic","acceptance"]}),asyncValidationMcacheHit:e.gauge({name:"gossipsub_async_validation_mcache_hit_total",help:"Async validation result reported by the user layer",labelNames:["hit"]}),rpcRecvBytes:e.gauge({name:"gossipsub_rpc_recv_bytes_total",help:"RPC recv"}),rpcRecvCount:e.gauge({name:"gossipsub_rpc_recv_count_total",help:"RPC recv"}),rpcRecvSubscription:e.gauge({name:"gossipsub_rpc_recv_subscription_total",help:"RPC recv"}),rpcRecvMessage:e.gauge({name:"gossipsub_rpc_recv_message_total",help:"RPC recv"}),rpcRecvControl:e.gauge({name:"gossipsub_rpc_recv_control_total",help:"RPC recv"}),rpcRecvIHave:e.gauge({name:"gossipsub_rpc_recv_ihave_total",help:"RPC recv"}),rpcRecvIWant:e.gauge({name:"gossipsub_rpc_recv_iwant_total",help:"RPC recv"}),rpcRecvGraft:e.gauge({name:"gossipsub_rpc_recv_graft_total",help:"RPC recv"}),rpcRecvPrune:e.gauge({name:"gossipsub_rpc_recv_prune_total",help:"RPC recv"}),rpcRecvNotAccepted:e.gauge({name:"gossipsub_rpc_rcv_not_accepted_total",help:"Total count of RPC dropped because acceptFrom() == false"}),rpcSentBytes:e.gauge({name:"gossipsub_rpc_sent_bytes_total",help:"RPC sent"}),rpcSentCount:e.gauge({name:"gossipsub_rpc_sent_count_total",help:"RPC sent"}),rpcSentSubscription:e.gauge({name:"gossipsub_rpc_sent_subscription_total",help:"RPC sent"}),rpcSentMessage:e.gauge({name:"gossipsub_rpc_sent_message_total",help:"RPC sent"}),rpcSentControl:e.gauge({name:"gossipsub_rpc_sent_control_total",help:"RPC sent"}),rpcSentIHave:e.gauge({name:"gossipsub_rpc_sent_ihave_total",help:"RPC sent"}),rpcSentIWant:e.gauge({name:"gossipsub_rpc_sent_iwant_total",help:"RPC sent"}),rpcSentGraft:e.gauge({name:"gossipsub_rpc_sent_graft_total",help:"RPC sent"}),rpcSentPrune:e.gauge({name:"gossipsub_rpc_sent_prune_total",help:"RPC sent"}),msgPublishCount:e.gauge({name:"gossipsub_msg_publish_count_total",help:"Total count of msg published by topic",labelNames:["topic"]}),msgPublishPeers:e.gauge({name:"gossipsub_msg_publish_peers_total",help:"Total count of peers that we publish a msg to",labelNames:["topic"]}),msgPublishPeersByGroup:e.gauge({name:"gossipsub_msg_publish_peers_by_group",help:"Total count of peers (by group) that we publish a msg to",labelNames:["topic","peerGroup"]}),msgPublishBytes:e.gauge({name:"gossipsub_msg_publish_bytes_total",help:"Total count of msg publish data.length bytes",labelNames:["topic"]}),msgForwardCount:e.gauge({name:"gossipsub_msg_forward_count_total",help:"Total count of msg forwarded by topic",labelNames:["topic"]}),msgForwardPeers:e.gauge({name:"gossipsub_msg_forward_peers_total",help:"Total count of peers that we forward a msg to",labelNames:["topic"]}),msgReceivedPreValidation:e.gauge({name:"gossipsub_msg_received_prevalidation_total",help:"Total count of recv msgs before any validation",labelNames:["topic"]}),msgReceivedStatus:e.gauge({name:"gossipsub_msg_received_status_total",help:"Tracks distribution of recv msgs by duplicate, invalid, valid",labelNames:["topic","status"]}),msgReceivedInvalid:e.gauge({name:"gossipsub_msg_received_invalid_total",help:"Tracks specific reason of invalid",labelNames:["topic","error"]}),duplicateMsgDeliveryDelay:e.histogram({name:"gossisub_duplicate_msg_delivery_delay_seconds",help:"Time since the 1st duplicated message validated",labelNames:["topic"],buckets:[.25*n.maxMeshMessageDeliveriesWindowSec,.5*n.maxMeshMessageDeliveriesWindowSec,1*n.maxMeshMessageDeliveriesWindowSec,2*n.maxMeshMessageDeliveriesWindowSec,4*n.maxMeshMessageDeliveriesWindowSec]}),duplicateMsgLateDelivery:e.gauge({name:"gossisub_duplicate_msg_late_delivery_total",help:"Total count of late duplicate message delivery by topic, which triggers P3 penalty",labelNames:["topic"]}),scoreFnCalls:e.gauge({name:"gossipsub_score_fn_calls_total",help:"Total times score() is called"}),scoreFnRuns:e.gauge({name:"gossipsub_score_fn_runs_total",help:"Total times score() call actually computed computeScore(), no cache"}),scoreCachedDelta:e.histogram({name:"gossipsub_score_cache_delta",help:"Delta of score between cached values that expired",buckets:[10,100,1e3]}),peersByScoreThreshold:e.gauge({name:"gossipsub_peers_by_score_threshold_count",help:"Current count of peers by score threshold",labelNames:["threshold"]}),score:e.avgMinMax({name:"gossipsub_score",help:"Avg min max of gossip scores",labelNames:["topic","p"]}),scoreWeights:e.avgMinMax({name:"gossipsub_score_weights",help:"Separate score weights",labelNames:["topic","p"]}),scorePerMesh:e.avgMinMax({name:"gossipsub_score_per_mesh",help:"Histogram of the scores for each mesh topic",labelNames:["topic"]}),scoringPenalties:e.gauge({name:"gossipsub_scoring_penalties_total",help:"A counter of the kind of penalties being applied to peers",labelNames:["penalty"]}),behaviourPenalty:e.histogram({name:"gossipsub_peer_stat_behaviour_penalty",help:"Current peer stat behaviour_penalty at each scrape",buckets:[.25*n.behaviourPenaltyThreshold,.5*n.behaviourPenaltyThreshold,1*n.behaviourPenaltyThreshold,2*n.behaviourPenaltyThreshold,4*n.behaviourPenaltyThreshold]}),ihaveRcvIgnored:e.gauge({name:"gossipsub_ihave_rcv_ignored_total",help:"Total received IHAVE messages that we ignore for some reason",labelNames:["reason"]}),ihaveRcvMsgids:e.gauge({name:"gossipsub_ihave_rcv_msgids_total",help:"Total received IHAVE messages by topic",labelNames:["topic"]}),ihaveRcvNotSeenMsgids:e.gauge({name:"gossipsub_ihave_rcv_not_seen_msgids_total",help:"Total messages per topic we do not have, not actual requests",labelNames:["topic"]}),iwantRcvMsgids:e.gauge({name:"gossipsub_iwant_rcv_msgids_total",help:"Total received IWANT messages by topic",labelNames:["topic"]}),iwantRcvDonthaveMsgids:e.gauge({name:"gossipsub_iwant_rcv_dont_have_msgids_total",help:"Total requested messageIDs that we do not have"}),iwantPromiseStarted:e.gauge({name:"gossipsub_iwant_promise_sent_total",help:"Total count of started IWANT promises"}),iwantPromiseResolved:e.gauge({name:"gossipsub_iwant_promise_resolved_total",help:"Total count of resolved IWANT promises"}),iwantPromiseResolvedPeers:e.gauge({name:"gossipsub_iwant_promise_resolved_peers",help:"Total count of peers we have asked IWANT promises that are resolved"}),iwantPromiseBroken:e.gauge({name:"gossipsub_iwant_promise_broken",help:"Total count of broken IWANT promises"}),iwantPromiseDeliveryTime:e.histogram({name:"gossipsub_iwant_promise_delivery_seconds",help:"Histogram of delivery time of resolved IWANT promises",buckets:[.5*n.gossipPromiseExpireSec,1*n.gossipPromiseExpireSec,2*n.gossipPromiseExpireSec,4*n.gossipPromiseExpireSec]}),cacheSize:e.gauge({name:"gossipsub_cache_size",help:"Unbounded cache sizes",labelNames:["cache"]}),mcacheSize:e.gauge({name:"gossipsub_mcache_size",help:"Current mcache msg count"}),topicStrToLabel:t,toTopic(e){return this.topicStrToLabel.get(e)??e},onJoin(e){this.topicSubscriptionStatus.set({topicStr:e},1),this.meshPeerCounts.set({topicStr:e},0)},onLeave(e){this.topicSubscriptionStatus.set({topicStr:e},0),this.meshPeerCounts.set({topicStr:e},0)},onAddToMesh(e,t,n){const r=this.toTopic(e);this.meshPeerInclusionEvents.inc({topic:r,reason:t},n)},onRemoveFromMesh(e,t,n){const r=this.toTopic(e);this.meshPeerChurnEvents.inc({topic:r,reason:t},n)},onReportValidationMcacheHit(e){this.asyncValidationMcacheHit.inc({hit:e?"hit":"miss"})},onReportValidation(e,t){const n=this.toTopic(e);this.asyncValidationResult.inc({topic:n,acceptance:t})},onScorePenalty(e){this.scoringPenalties.inc({penalty:e},1)},onIhaveRcv(e,t,n){const r=this.toTopic(e);this.ihaveRcvMsgids.inc({topic:r},t),this.ihaveRcvNotSeenMsgids.inc({topic:r},n)},onIwantRcv(e,t){for(const[n,r]of e){const e=this.toTopic(n);this.iwantRcvMsgids.inc({topic:e},r)}this.iwantRcvDonthaveMsgids.inc(t)},onForwardMsg(e,t){const n=this.toTopic(e);this.msgForwardCount.inc({topic:n},1),this.msgForwardPeers.inc({topic:n},t)},onPublishMsg(e,t,n,r){const s=this.toTopic(e);this.msgPublishCount.inc({topic:s},1),this.msgPublishBytes.inc({topic:s},n*r),this.msgPublishPeers.inc({topic:s},n),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"direct"},t.direct),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"floodsub"},t.floodsub),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"mesh"},t.mesh),this.msgPublishPeersByGroup.inc({topic:s,peerGroup:"fanout"},t.fanout)},onMsgRecvPreValidation(e){const t=this.toTopic(e);this.msgReceivedPreValidation.inc({topic:t},1)},onMsgRecvResult(e,t){const n=this.toTopic(e);this.msgReceivedStatus.inc({topic:n,status:t})},onMsgRecvInvalid(e,t){const n=this.toTopic(e),r=t.reason===aU.Error?t.error:t.reason;this.msgReceivedInvalid.inc({topic:n,error:r},1)},onDuplicateMsgDelivery(e,t,n){if(this.duplicateMsgDeliveryDelay.observe(t/1e3),n){const t=this.toTopic(e);this.duplicateMsgLateDelivery.inc({topic:t},1)}},onRpcRecv(e,t){this.rpcRecvBytes.inc(t),this.rpcRecvCount.inc(1),e.subscriptions&&this.rpcRecvSubscription.inc(e.subscriptions.length),e.messages&&this.rpcRecvMessage.inc(e.messages.length),e.control&&(this.rpcRecvControl.inc(1),e.control.ihave&&this.rpcRecvIHave.inc(e.control.ihave.length),e.control.iwant&&this.rpcRecvIWant.inc(e.control.iwant.length),e.control.graft&&this.rpcRecvGraft.inc(e.control.graft.length),e.control.prune&&this.rpcRecvPrune.inc(e.control.prune.length))},onRpcSent(e,t){if(this.rpcSentBytes.inc(t),this.rpcSentCount.inc(1),e.subscriptions&&this.rpcSentSubscription.inc(e.subscriptions.length),e.messages&&this.rpcSentMessage.inc(e.messages.length),e.control){const t=e.control.ihave?.length??0,n=e.control.iwant?.length??0,r=e.control.graft?.length??0,s=e.control.prune?.length??0;t>0&&this.rpcSentIHave.inc(t),n>0&&this.rpcSentIWant.inc(n),r>0&&this.rpcSentGraft.inc(r),s>0&&this.rpcSentPrune.inc(s),(t>0||n>0||r>0||s>0)&&this.rpcSentControl.inc(1)}},registerScores(e,t){let n=0,r=0,s=0,i=0;for(const o of e)o>=t.graylistThreshold&&n++,o>=t.publishThreshold&&r++,o>=t.gossipThreshold&&s++,o>=0&&i++;this.peersByScoreThreshold.set({threshold:BU.graylist},n),this.peersByScoreThreshold.set({threshold:BU.publish},r),this.peersByScoreThreshold.set({threshold:BU.gossip},s),this.peersByScoreThreshold.set({threshold:BU.mesh},i),this.score.set(e)},registerScoreWeights(e){for(const[t,n]of e.byTopic)this.scoreWeights.set({topic:t,p:"p1"},n.p1w),this.scoreWeights.set({topic:t,p:"p2"},n.p2w),this.scoreWeights.set({topic:t,p:"p3"},n.p3w),this.scoreWeights.set({topic:t,p:"p3b"},n.p3bw),this.scoreWeights.set({topic:t,p:"p4"},n.p4w);this.scoreWeights.set({p:"p5"},e.p5w),this.scoreWeights.set({p:"p6"},e.p6w),this.scoreWeights.set({p:"p7"},e.p7w)},registerScorePerMesh(e,t){const n=new Map;e.forEach(((e,t)=>{const r=this.topicStrToLabel.get(t)??"unknown";let s=n.get(r);s||(s=new Set,n.set(r,s)),e.forEach((e=>s?.add(e)))}));for(const[r,s]of n){const e=[];s.forEach((n=>{e.push(t.get(n)??0)})),this.scorePerMesh.set({topic:r},e)}}}}function VU(e,t){t||(t=e.reduce(((e,t)=>e+t.length),0));const n=WB(t);let r=0;for(const s of e)n.set(s,r),r+=s.length;return GB(n)}function FU(e,t="utf8"){const n=ZB[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${e}`):GB(globalThis.Buffer.from(e,"utf-8"))}(function(e){e["forward"]="forward",e["publish"]="publish"})(NU||(NU={})),function(e){e["Fanout"]="fanout",e["Random"]="random",e["Subscribed"]="subscribed",e["Outbound"]="outbound",e["NotEnough"]="not_enough",e["Opportunistic"]="opportunistic"}(DU||(DU={})),function(e){e["Dc"]="disconnected",e["BadScore"]="bad_score",e["Prune"]="prune",e["Unsub"]="unsubscribed",e["Excess"]="excess"}(PU||(PU={})),function(e){e["GraftBackoff"]="graft_backoff",e["BrokenPromise"]="broken_promise",e["MessageDeficit"]="message_deficit",e["IPColocation"]="IP_colocation"}(LU||(LU={})),function(e){e["LowScore"]="low_score",e["MaxIhave"]="max_ihave",e["MaxIasked"]="max_iasked"}(MU||(MU={})),function(e){e["graylist"]="graylist",e["publish"]="publish",e["gossip"]="gossip",e["mesh"]="mesh"}(BU||(BU={}));n(6509);var jU=n(3350);const zU={sha1:"sha1","sha2-256":"sha256","sha2-512":"sha512"};function $U(e,t,n,r,s){if("sha1"!==s&&"sha2-256"!==s&&"sha2-512"!==s){const e=Object.keys(zU).join(" / ");throw je(new Error(`Hash '${s}' is unknown or not supported. Must be ${e}`),"ERR_UNSUPPORTED_HASH_TYPE")}const i=zU[s],o=jU(e,t,n,r,i);return xh.encode64(o,null)}function HU(e,t){if(e===t)return!0;if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.byteLength;n++)if(e[n]!==t[n])return!1;return!0}const KU=FU("libp2p-pubsub:");async function qU(e,t,n,r){switch(e.type){case iU.Signing:{const s={from:e.author.toBytes(),data:r,seqno:Kd(8),topic:t,signature:void 0,key:void 0},i=VU([KU,vL.Message.encode(s).finish()]);s.signature=await e.privateKey.sign(i),s.key=e.key;const o={type:"signed",from:e.author,data:n,sequenceNumber:BigInt(`0x${eU(s.seqno,"base16")}`),topic:t,signature:s.signature,key:s.key};return{raw:s,msg:o}}case iU.Anonymous:return{raw:{from:void 0,data:r,seqno:void 0,topic:t,signature:void 0,key:void 0},msg:{type:"unsigned",data:n,topic:t}}}}async function GU(e,t){switch(e){case rU:return null!=t.signature?{valid:!1,error:cU.SignaturePresent}:null!=t.seqno?{valid:!1,error:cU.SeqnoPresent}:null!=t.key?{valid:!1,error:cU.FromPresent}:{valid:!0,message:{type:"unsigned",topic:t.topic,data:t.data??new Uint8Array(0)}};case nU:{if(null==t.seqno)return{valid:!1,error:cU.InvalidSeqno};if(8!==t.seqno.length)return{valid:!1,error:cU.InvalidSeqno};if(null==t.signature)return{valid:!1,error:cU.InvalidSignature};if(null==t.from)return{valid:!1,error:cU.InvalidPeerId};let e,r;try{e=ju(t.from)}catch(n){return{valid:!1,error:cU.InvalidPeerId}}if(t.key){if(r=Gf(t.key),void 0!==e.publicKey&&!HU(r.bytes,e.publicKey))return{valid:!1,error:cU.InvalidPeerId}}else{if(null==e.publicKey)return{valid:!1,error:cU.InvalidPeerId};r=Gf(e.publicKey)}const s={from:t.from,data:t.data,seqno:t.seqno,topic:t.topic,signature:void 0,key:void 0},i=VU([KU,vL.Message.encode(s).finish()]);return await r.verify(i,t.signature)?{valid:!0,message:{type:"signed",from:e,data:t.data??new Uint8Array(0),sequenceNumber:BigInt(`0x${eU(t.seqno,"base16")}`),topic:t.topic,signature:t.signature,key:t.key??Wf(r)}}:{valid:!1,error:cU.InvalidSignature}}}}function WU(e,t){if(e.length>=255)throw new TypeError("Alphabet too long");for(var n=new Uint8Array(256),r=0;r<n.length;r++)n[r]=255;for(var s=0;s<e.length;s++){var i=e.charAt(s),o=i.charCodeAt(0);if(255!==n[o])throw new TypeError(i+" is ambiguous");n[o]=s}var a=e.length,c=e.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(0===t.length)return"";var n=0,r=0,s=0,i=t.length;while(s!==i&&0===t[s])s++,n++;var o=(i-s)*u+1>>>0,l=new Uint8Array(o);while(s!==i){for(var h=t[s],d=0,p=o-1;(0!==h||d<r)&&-1!==p;p--,d++)h+=256*l[p]>>>0,l[p]=h%a>>>0,h=h/a>>>0;if(0!==h)throw new Error("Non-zero carry");r=d,s++}var f=o-r;while(f!==o&&0===l[f])f++;for(var g=c.repeat(n);f<o;++f)g+=e.charAt(l[f]);return g}function d(e){if("string"!==typeof e)throw new TypeError("Expected String");if(0===e.length)return new Uint8Array;var t=0;if(" "!==e[t]){var r=0,s=0;while(e[t]===c)r++,t++;var i=(e.length-t)*l+1>>>0,o=new Uint8Array(i);while(e[t]){var u=n[e.charCodeAt(t)];if(255===u)return;for(var h=0,d=i-1;(0!==u||h<s)&&-1!==d;d--,h++)u+=a*o[d]>>>0,o[d]=u%256>>>0,u=u/256>>>0;if(0!==u)throw new Error("Non-zero carry");s=h,t++}if(" "!==e[t]){var p=i-s;while(p!==i&&0===o[p])p++;var f=new Uint8Array(r+(i-p)),g=r;while(p!==i)f[g++]=o[p++];return f}}}function p(e){var n=d(e);if(n)return n;throw new Error(`Non-${t} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var YU=WU,JU=YU,QU=JU;new Uint8Array(0);const XU=e=>{if(e instanceof Uint8Array&&"Uint8Array"===e.constructor.name)return e;if(e instanceof ArrayBuffer)return new Uint8Array(e);if(ArrayBuffer.isView(e))return new Uint8Array(e.buffer,e.byteOffset,e.byteLength);throw new Error("Unknown type, must be binary type")},ZU=e=>(new TextEncoder).encode(e),eV=e=>(new TextDecoder).decode(e);class tV{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class nV{constructor(e,t,n){if(this.name=e,this.prefix=t,void 0===t.codePointAt(0))throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if("string"===typeof e){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}throw Error("Can only multibase decode strings")}or(e){return sV(this,e)}}class rV{constructor(e){this.decoders=e}or(e){return sV(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const sV=(e,t)=>new rV({...e.decoders||{[e.prefix]:e},...t.decoders||{[t.prefix]:t}});class iV{constructor(e,t,n,r){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=r,this.encoder=new tV(e,t,n),this.decoder=new nV(e,t,r)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const oV=({name:e,prefix:t,encode:n,decode:r})=>new iV(e,t,n,r),aV=({prefix:e,name:t,alphabet:n})=>{const{encode:r,decode:s}=QU(n,t);return oV({prefix:e,name:t,encode:r,decode:e=>XU(s(e))})},cV=(e,t,n,r)=>{const s={};for(let u=0;u<t.length;++u)s[t[u]]=u;let i=e.length;while("="===e[i-1])--i;const o=new Uint8Array(i*n/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const t=s[e[u]];if(void 0===t)throw new SyntaxError(`Non-${r} character`);c=c<<n|t,a+=n,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=n||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},lV=(e,t,n)=>{const r="="===t[t.length-1],s=(1<<n)-1;let i="",o=0,a=0;for(let c=0;c<e.length;++c){a=a<<8|e[c],o+=8;while(o>n)o-=n,i+=t[s&a>>o]}if(o&&(i+=t[s&a<<n-o]),r)while(i.length*n&7)i+="=";return i},uV=({name:e,prefix:t,bitsPerChar:n,alphabet:r})=>oV({prefix:t,name:e,encode(e){return lV(e,r,n)},decode(t){return cV(t,r,n,e)}}),hV=oV({prefix:"\0",name:"identity",encode:e=>eV(e),decode:e=>ZU(e)}),dV=uV({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),pV=uV({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),fV=aV({prefix:"9",name:"base10",alphabet:"0123456789"}),gV=uV({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),mV=uV({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),yV=uV({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),wV=uV({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),bV=uV({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),vV=uV({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),EV=uV({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_V=uV({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),SV=uV({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),kV=uV({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),AV=uV({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),TV=aV({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),CV=aV({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),IV=aV({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),RV=aV({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),OV=uV({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xV=uV({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),NV=uV({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),DV=uV({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),PV=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),LV=PV.reduce(((e,t,n)=>(e[n]=t,e)),[]),MV=PV.reduce(((e,t,n)=>(e[t.codePointAt(0)]=n,e)),[]);function BV(e){return e.reduce(((e,t)=>(e+=LV[t],e)),"")}function UV(e){const t=[];for(const n of e){const e=MV[n.codePointAt(0)];if(void 0===e)throw new Error(`Non-base256emoji character: ${n}`);t.push(e)}return new Uint8Array(t)}const VV=oV({prefix:"🚀",name:"base256emoji",encode:BV,decode:UV});var FV=KV,jV=128,zV=127,$V=~zV,HV=Math.pow(2,31);function KV(e,t,n){t=t||[],n=n||0;var r=n;while(e>=HV)t[n++]=255&e|jV,e/=128;while(e&$V)t[n++]=255&e|jV,e>>>=7;return t[n]=0|e,KV.bytes=n-r+1,t}var qV=YV,GV=128,WV=127;function YV(e,t){var n,r=0,s=(t=t||0,0),i=t,o=e.length;do{if(i>=o)throw YV.bytes=0,new RangeError("Could not decode varint");n=e[i++],r+=s<28?(n&WV)<<s:(n&WV)*Math.pow(2,s),s+=7}while(n>=GV);return YV.bytes=i-t,r}var JV=Math.pow(2,7),QV=Math.pow(2,14),XV=Math.pow(2,21),ZV=Math.pow(2,28),eF=Math.pow(2,35),tF=Math.pow(2,42),nF=Math.pow(2,49),rF=Math.pow(2,56),sF=Math.pow(2,63),iF=function(e){return e<JV?1:e<QV?2:e<XV?3:e<ZV?4:e<eF?5:e<tF?6:e<nF?7:e<rF?8:e<sF?9:10},oF={encode:FV,decode:qV,encodingLength:iF},aF=oF,cF=aF;const lF=(e,t,n=0)=>(cF.encode(e,t,n),t),uF=e=>cF.encodingLength(e),hF=(e,t)=>{const n=t.byteLength,r=uF(e),s=r+uF(n),i=new Uint8Array(s+n);return lF(e,i,0),lF(n,i,r),i.set(t,s),new dF(e,n,t,i)};class dF{constructor(e,t,n,r){this.code=e,this.size=t,this.digest=n,this.bytes=r}}const pF=({name:e,code:t,encode:n})=>new fF(e,t,n);class fF{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?hF(this.code,t):t.then((e=>hF(this.code,e)))}throw Error("Unknown type, must be binary type")}}const gF=e=>async t=>new Uint8Array(await crypto.subtle.digest(e,t)),mF=pF({name:"sha2-256",code:18,encode:gF("SHA-256")}),yF=pF({name:"sha2-512",code:19,encode:gF("SHA-512")}),wF=0,bF="identity",vF=XU,EF=e=>hF(wF,vF(e)),_F={code:wF,name:bF,encode:vF,digest:EF},SF="raw",kF=85,AF=e=>XU(e),TF=e=>XU(e),CF=new TextEncoder,IF=new TextDecoder,RF="json",OF=512,xF=e=>CF.encode(JSON.stringify(e)),NF=e=>JSON.parse(IF.decode(e));class DF{constructor(e,t,n,r){this.code=t,this.version=e,this.multihash=n,this.bytes=r,this.byteOffset=r.byteOffset,this.byteLength=r.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:src_cid_hidden,byteLength:src_cid_hidden,code:src_cid_readonly,version:src_cid_readonly,multihash:src_cid_readonly,bytes:src_cid_readonly,_baseCache:src_cid_hidden,asCID:src_cid_hidden})}toV0(){switch(this.version){case 0:return this;default:{const{code:e,multihash:t}=this;if(e!==src_cid_DAG_PB_CODE)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==src_cid_SHA_256_CODE)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return DF.createV0(t)}}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=Digest.create(e,t);return DF.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Digest.equals(this.multihash,e.multihash)}toString(e){const{bytes:t,version:n,_baseCache:r}=this;switch(n){case 0:return src_cid_toStringV0(t,r,e||base58btc.encoder);default:return src_cid_toStringV1(t,r,e||base32.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return cid_deprecate(/^0\.0/,cid_IS_CID_DEPRECATION),!(!e||!e[src_cid_cidSymbol]&&e.asCID!==e)}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof DF)return e;if(null!=e&&e.asCID===e){const{version:t,code:n,multihash:r,bytes:s}=e;return new DF(t,n,r,s||src_cid_encodeCID(t,n,r.bytes))}if(null!=e&&!0===e[src_cid_cidSymbol]){const{version:t,multihash:n,code:r}=e,s=Digest.decode(n);return DF.create(t,r,s)}return null}static create(e,t,n){if("number"!==typeof t)throw new Error("String codecs are no longer supported");switch(e){case 0:if(t!==src_cid_DAG_PB_CODE)throw new Error(`Version 0 CID must use dag-pb (code: ${src_cid_DAG_PB_CODE}) block encoding`);return new DF(e,t,n,n.bytes);case 1:{const r=src_cid_encodeCID(e,t,n.bytes);return new DF(e,t,n,r)}default:throw new Error("Invalid version")}}static createV0(e){return DF.create(0,src_cid_DAG_PB_CODE,e)}static createV1(e,t){return DF.create(1,e,t)}static decode(e){const[t,n]=DF.decodeFirst(e);if(n.length)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=DF.inspectBytes(e),n=t.size-t.multihashSize,r=coerce(e.subarray(n,n+t.multihashSize));if(r.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=r.subarray(t.multihashSize-t.digestSize),i=new Digest.Digest(t.multihashCode,t.digestSize,s,r),o=0===t.version?DF.createV0(i):DF.createV1(t.codec,i);return[o,e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[n,r]=varint.decode(e.subarray(t));return r,n};let r=n(),s=src_cid_DAG_PB_CODE;if(18===r?(0,0):1===r&&n(),0!==r&&1!==r)throw new RangeError(`Invalid CID version ${r}`);const i=t,o=n(),a=n(),c=t+a,l=c-i;return{version:r,codec:s,multihashCode:o,digestSize:a,multihashSize:l,size:c}}static parse(e,t){const[n,r]=src_cid_parseCIDtoBytes(e,t),s=DF.decode(r);return s._baseCache.set(n,e),s}}Symbol.for("@ipld/js-cid/CID");const PF={...V,...F,...j,...z,...$,...H,...K,...q,...G,...W};function LF(e){return null!=globalThis.Buffer?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e}function MF(e=0){return null!=globalThis.Buffer&&null!=globalThis.Buffer.allocUnsafe?LF(globalThis.Buffer.allocUnsafe(e)):new Uint8Array(e)}function BF(e,t,n,r){return{name:e,prefix:t,encoder:{name:e,prefix:t,encode:n},decoder:{decode:r}}}const UF=BF("utf8","u",(e=>{const t=new TextDecoder("utf8");return"u"+t.decode(e)}),(e=>{const t=new TextEncoder;return t.encode(e.substring(1))})),VF=BF("ascii","a",(e=>{let t="a";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return t}),(e=>{e=e.substring(1);const t=MF(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t})),FF={utf8:UF,"utf-8":UF,hex:PF.base16,latin1:VF,ascii:VF,binary:VF,...PF};var jF=FF;function zF(e,t="utf8"){const n=jF[t];if(!n)throw new Error(`Unsupported encoding "${t}"`);return"utf8"!==t&&"utf-8"!==t||null==globalThis.Buffer||null==globalThis.Buffer.from?n.decoder.decode(`${n.prefix}${e}`):LF(globalThis.Buffer.from(e,"utf-8"))}const $F=(e,t)=>{const n=zF(t.toString(16).padStart(16,"0"),"base16"),r=new Uint8Array(e.length+n.length);return r.set(e,0),r.set(n,e.length),r};function HF(e){if("signed"!==e.type)throw new Error("expected signed message type");if(null==e.sequenceNumber)throw Error("missing seqno field");return $F(e.from.toBytes(),e.sequenceNumber)}async function KF(e){return await IB.encode(e.data)}function qF(e,t,n,r,s){let i=0;const o=new Map;if(Object.entries(t.topics).forEach((([e,t])=>{const r=s.get(e)??"unknown",a=n.topics[e];if(void 0===a)return;let c=o.get(r);c||(c={p1w:0,p2w:0,p3w:0,p3bw:0,p4w:0},o.set(r,c));let l=0,u=0,h=0,d=0,p=0;if(t.inMesh){const e=Math.max(t.meshTime/a.timeInMeshQuantum,a.timeInMeshCap);l+=e*a.timeInMeshWeight}let f=t.firstMessageDeliveries;if(f>a.firstMessageDeliveriesCap&&(f=a.firstMessageDeliveriesCap),u+=f*a.firstMessageDeliveriesWeight,t.meshMessageDeliveriesActive&&t.meshMessageDeliveries<a.meshMessageDeliveriesThreshold){const e=a.meshMessageDeliveriesThreshold-t.meshMessageDeliveries,n=e*e;h+=n*a.meshMessageDeliveriesWeight}const g=t.meshFailurePenalty;d+=g*a.meshFailurePenaltyWeight;const m=t.invalidMessageDeliveries*t.invalidMessageDeliveries;p+=m*a.invalidMessageDeliveriesWeight,i+=(l+u+h+d+p)*a.topicWeight,c.p1w+=l,c.p2w+=u,c.p3w+=h,c.p3bw+=d,c.p4w+=p})),n.topicScoreCap>0&&i>n.topicScoreCap){i=n.topicScoreCap;const e=n.topicScoreCap/i;for(const t of o.values())t.p1w*=e,t.p2w*=e,t.p3w*=e,t.p3bw*=e,t.p4w*=e}let a=0,c=0,l=0;const u=n.appSpecificScore(e);a+=u*n.appSpecificWeight,t.ips.forEach((e=>{if(n.IPColocationFactorWhitelist.has(e))return;const t=r.get(e),s=t?t.size:0;if(s>n.IPColocationFactorThreshold){const e=s-n.IPColocationFactorThreshold,t=e*e;c+=t*n.IPColocationFactorWeight}}));const h=t.behaviourPenalty*t.behaviourPenalty;return l+=h*n.behaviourPenaltyWeight,i+=a+c+l,{byTopic:o,p5w:a,p6w:c,p7w:l,score:i}}function GF(e,t,n,r,s){const i={byTopic:new Map,p5w:[],p6w:[],p7w:[],score:[]};for(const o of e){const e=t.get(o);if(e){const t=qF(o,e,n,r,s);for(const[e,n]of t.byTopic){let t=i.byTopic.get(e);t||(t={p1w:[],p2w:[],p3w:[],p3bw:[],p4w:[]},i.byTopic.set(e,t)),t.p1w.push(n.p1w),t.p2w.push(n.p2w),t.p3w.push(n.p3w),t.p3bw.push(n.p3bw),t.p4w.push(n.p4w)}i.p5w.push(t.p5w),i.p6w.push(t.p6w),i.p7w.push(t.p7w),i.score.push(t.score)}else i.p5w.push(0),i.p6w.push(0),i.p7w.push(0),i.score.push(0)}return i}function WF(e,t,n=(()=>!0)){const r=new Set;if(t<=0)return r;for(const s of e){if(r.size>=t)break;n(s)&&(r.add(s),e.delete(s))}return r}function YF(e,t){return WF(e,t,(()=>!0))}class JF extends Error{constructor(e,t){super(e??"The operation was aborted"),this.type="aborted",this.code=t??"ABORT_ERR"}}function QF(e){if(null!=e){if("function"===typeof e[Symbol.iterator])return e[Symbol.iterator]();if("function"===typeof e[Symbol.asyncIterator])return e[Symbol.asyncIterator]();if("function"===typeof e.next)return e}throw new Error("argument is not an iterator or iterable")}function XF(e,t,n){const r=n??{},s=QF(e);async function*i(){let n;const i=()=>{null!=n&&n()};t.addEventListener("abort",i);while(1){let o;try{if(t.aborted){const{abortMessage:e,abortCode:t}=r;throw new JF(e,t)}const e=new Promise(((e,t)=>{n=()=>{const{abortMessage:e,abortCode:n}=r;t(new JF(e,n))}}));o=await Promise.race([e,s.next()]),n=null}catch(uS){t.removeEventListener("abort",i);const o="aborted"===uS.type&&t.aborted;if(o&&null!=r.onAbort&&await r.onAbort(e),"function"===typeof s.return)try{const e=s.return();e instanceof Promise&&e.catch((e=>{null!=r.onReturnError&&r.onReturnError(e)}))}catch(uS){null!=r.onReturnError&&r.onReturnError(uS)}if(o&&!0===r.returnOnAbort)return;throw uS}if(!0===o.done)break;yield o.value}t.removeEventListener("abort",i)}return i()}function ZF(e,t,n){return r=>e(XF(r,t,n))}function ej(e,t,n){return{sink:ZF(e.sink,t,{...n,onAbort:void 0}),source:XF(e.source,t,n)}}function tj(e){return null!=globalThis?.Buffer?.allocUnsafe?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e)}const nj=e=>{const t=eL.encodingLength(e),n=tj(t);return eL.encode(e,n),nj.bytes=t,n};function rj(e){e=e??{};const t=e.lengthEncoder??nj,n=async function*(e){for await(const n of e){const e=t(n.byteLength);e instanceof Uint8Array?yield e:yield*e,n instanceof Uint8Array?yield n:yield*n}};return n}nj.bytes=0,rj.single=(e,t)=>{t=t??{};const n=t.lengthEncoder??nj;return new Aw(n(e.byteLength),e)};const sj=8,ij=4194304;var oj;(function(e){e[e["LENGTH"]=0]="LENGTH",e[e["DATA"]=1]="DATA"})(oj||(oj={}));const aj=e=>{const t=eL.decode(e);return aj.bytes=eL.encodingLength(t),t};function cj(e){const t=async function*(t){const n=new Aw;let r=oj.LENGTH,s=-1;const i=e?.lengthDecoder??aj,o=e?.maxLengthLength??sj,a=e?.maxDataLength??ij;for await(const c of t){n.append(c);while(n.byteLength>0){if(r===oj.LENGTH)try{if(s=i(n),s<0)throw je(new Error("invalid message length"),"ERR_INVALID_MSG_LENGTH");if(s>a)throw je(new Error("message length too long"),"ERR_MSG_DATA_TOO_LONG");const t=i.bytes;n.consume(t),null!=e?.onLength&&e.onLength(s),r=oj.DATA}catch(uS){if(uS instanceof RangeError){if(n.byteLength>o)throw je(new Error("message length length too long"),"ERR_MSG_LENGTH_TOO_LONG");break}throw uS}if(r===oj.DATA){if(n.byteLength<s)break;const t=n.sublist(0,s);n.consume(s),null!=e?.onData&&e.onData(t),yield t,r=oj.LENGTH}}}if(n.byteLength>0)throw je(new Error("unexpected end of input"),"ERR_UNEXPECTED_EOF")};return t}aj.bytes=0,cj.fromReader=(e,t)=>{let n=1;const r=async function*(){while(1)try{const{done:t,value:r}=await e.next(n);if(!0===t)return;null!=r&&(yield r)}catch(uS){if("ERR_UNDER_READ"===uS.code)return{done:!0,value:null};throw uS}finally{n=1}}(),s=e=>{n=e};return cj({...t??{},onLength:s})(r)};class lj{constructor(e,t,n){this.rawStream=e,this.pushable=im({objectMode:!1}),this.closeController=new AbortController,this.maxBufferSize=n.maxBufferSize??1/0,vm(XF(this.pushable,this.closeController.signal,{returnOnAbort:!0}),rj(),this.rawStream).catch(t)}get protocol(){return this.rawStream.stat.protocol}push(e){if(this.pushable.readableLength>this.maxBufferSize)throw Error(`OutboundStream buffer full, size > ${this.maxBufferSize}`);this.pushable.push(e)}close(){this.closeController.abort(),this.pushable.return(),this.rawStream.close()}}class uj{constructor(e){this.rawStream=e,this.closeController=new AbortController,this.source=XF(vm(this.rawStream,cj()),this.closeController.signal,{returnOnAbort:!0})}close(){this.closeController.abort(),this.rawStream.close()}}var hj;(function(e){e[e["started"]=0]="started",e[e["stopped"]=1]="stopped"})(hj||(hj={}));class dj extends gL{constructor(e={}){super(),this.multicodecs=[AL,kL],this.peers=new Set,this.streamsInbound=new Map,this.streamsOutbound=new Map,this.outboundInflightQueue=im({objectMode:!0}),this.direct=new Set,this.floodsubPeers=new Set,this.acceptFromWhitelist=new Map,this.topics=new Map,this.subscriptions=new Set,this.mesh=new Map,this.fanout=new Map,this.fanoutLastpub=new Map,this.gossip=new Map,this.control=new Map,this.peerhave=new Map,this.iasked=new Map,this.backoff=new Map,this.outbound=new Map,this.topicValidators=new Map,this.heartbeatTicks=0,this.components=new CU,this.directPeerInitial=null,this.status={code:hj.stopped},this.heartbeatTimer=null,this.runHeartbeat=()=>{const e=this.metrics?.heartbeatDuration.startTimer();this.heartbeat().catch((e=>{this.log("Error running heartbeat",e)})).finally((()=>{if(null!=e&&e(),this.status.code===hj.started){clearTimeout(this.status.heartbeatTimeout);let e=this.opts.heartbeatInterval-(Date.now()-this.status.hearbeatStartMs)%this.opts.heartbeatInterval;e<.25*this.opts.heartbeatInterval&&(e+=this.opts.heartbeatInterval,this.metrics?.heartbeatSkipped.inc()),this.status.heartbeatTimeout=setTimeout(this.runHeartbeat,e)}}))};const t={fallbackToFloodsub:!0,floodPublish:!0,doPX:!1,directPeers:[],D:TL,Dlo:CL,Dhi:IL,Dscore:RL,Dout:OL,Dlazy:DL,heartbeatInterval:BL,fanoutTTL:UL,mcacheLength:xL,mcacheGossip:NL,seenTTL:JL,gossipsubIWantFollowupMs:YL,prunePeers:VL,pruneBackoff:FL,graftFloodThreshold:qL,opportunisticGraftPeers:KL,opportunisticGraftTicks:HL,directConnectTicks:zL,...e,scoreParams:gU(e.scoreParams),scoreThresholds:vU(e.scoreThresholds)};if(this.globalSignaturePolicy=t.globalSignaturePolicy??nU,t.fallbackToFloodsub&&this.multicodecs.push(SL),this.log=Fe(t.debugName??"libp2p:gossipsub"),this.opts=t,this.direct=new Set(t.directPeers.map((e=>e.id.toString()))),this.seenCache=new xU({validityMs:t.seenTTL}),this.publishedMessageIds=new xU({validityMs:t.seenTTL}),e.msgIdFn)this.msgIdFn=e.msgIdFn;else switch(this.globalSignaturePolicy){case nU:this.msgIdFn=HF;break;case rU:this.msgIdFn=KF;break}if(e.fastMsgIdFn&&(this.fastMsgIdFn=e.fastMsgIdFn,this.fastMsgIdCache=new xU({validityMs:t.seenTTL})),this.msgIdToStrFn=e.msgIdToStrFn??tU,this.mcache=e.messageCache||new wL(t.mcacheGossip,t.mcacheLength,this.msgIdToStrFn),e.dataTransform&&(this.dataTransform=e.dataTransform),e.metricsRegister){if(!e.metricsTopicStrToLabel)throw Error("Must set metricsTopicStrToLabel with metrics");const n=Math.max(...Object.values(t.scoreParams.topics).map((e=>e.meshMessageDeliveriesWindow)),rM),r=UU(e.metricsRegister,e.metricsTopicStrToLabel,{gossipPromiseExpireSec:this.opts.gossipsubIWantFollowupMs/1e3,behaviourPenaltyThreshold:t.scoreParams.behaviourPenaltyThreshold,maxMeshMessageDeliveriesWindowSec:n/1e3});r.mcacheSize.addCollect((()=>this.onScrapeMetrics(r)));for(const e of this.multicodecs)r.protocolsEnabled.set({protocol:e},1);this.metrics=r}else this.metrics=null;this.gossipTracer=new OU(this.opts.gossipsubIWantFollowupMs,this.msgIdToStrFn,this.metrics),this.score=new RU(this.opts.scoreParams,this.metrics,{scoreCacheValidityMs:t.heartbeatInterval}),this.maxInboundStreams=e.maxInboundStreams,this.maxOutboundStreams=e.maxOutboundStreams}getPeers(){return[...this.peers.keys()].map((e=>Fu(e)))}isStarted(){return this.status.code===hj.started}async init(e){this.components=e,this.score.init(e)}async start(){if(this.isStarted())return;this.log("starting"),this.publishConfig=await hU(this.globalSignaturePolicy,this.components.getPeerId()),this.outboundInflightQueue=im({objectMode:!0}),vm(this.outboundInflightQueue,(async e=>{for await(const{peerId:t,connection:n}of e)await this.createOutboundStream(t,n)})).catch((e=>this.log.error("outbound inflight queue error",e))),await Promise.all(this.opts.directPeers.map((async e=>{await this.components.getPeerStore().addressBook.add(e.id,e.addrs)})));const e=this.components.getRegistrar();await Promise.all(this.multicodecs.map((t=>e.handle(t,this.onIncomingStream.bind(this),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))));const t=dL({onConnect:this.onPeerConnected.bind(this),onDisconnect:this.onPeerDisconnected.bind(this)}),n=await Promise.all(this.multicodecs.map((n=>e.register(n,t)))),r=setTimeout(this.runHeartbeat,ML);this.status={code:hj.started,registrarTopologyIds:n,heartbeatTimeout:r,hearbeatStartMs:Date.now()+ML},this.score.start(),this.directPeerInitial=setTimeout((()=>{Promise.resolve().then((async()=>{await Promise.all(Array.from(this.direct).map((async e=>await this.connect(e))))})).catch((e=>{this.log(e)}))}),$L),this.log("started")}async stop(){if(this.log("stopping"),this.status.code!==hj.started)return;const{registrarTopologyIds:e}=this.status;this.status={code:hj.stopped};const t=this.components.getRegistrar();e.forEach((e=>t.unregister(e))),this.outboundInflightQueue.end();for(const n of this.streamsOutbound.values())n.close();this.streamsOutbound.clear();for(const n of this.streamsInbound.values())n.close();this.streamsInbound.clear(),this.peers.clear(),this.subscriptions.clear(),this.heartbeatTimer&&(this.heartbeatTimer.cancel(),this.heartbeatTimer=null),this.score.stop(),this.mesh.clear(),this.fanout.clear(),this.fanoutLastpub.clear(),this.gossip.clear(),this.control.clear(),this.peerhave.clear(),this.iasked.clear(),this.backoff.clear(),this.outbound.clear(),this.gossipTracer.clear(),this.seenCache.clear(),this.fastMsgIdCache&&this.fastMsgIdCache.clear(),this.directPeerInitial&&clearTimeout(this.directPeerInitial),this.log("stopped")}dumpPeerScoreStats(){return this.score.dumpPeerScoreStats()}onIncomingStream({stream:e,connection:t}){if(!this.isStarted())return;const n=t.remotePeer;this.addPeer(n,t.stat.direction),this.createInboundStream(n,e),this.outboundInflightQueue.push({peerId:n,connection:t})}onPeerConnected(e,t){this.isStarted()&&(this.addPeer(e,t.stat.direction),this.outboundInflightQueue.push({peerId:e,connection:t}))}onPeerDisconnected(e){this.log("connection ended %p",e),this.removePeer(e)}async createOutboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(this.peers.has(n)&&!this.streamsOutbound.has(n))try{const r=new lj(await t.newStream(this.multicodecs),(e=>this.log.error("outbound pipe error",e)),{maxBufferSize:this.opts.maxOutboundBufferSize});this.log("create outbound stream %p",e),this.streamsOutbound.set(n,r);const s=r.protocol;s===SL&&this.floodsubPeers.add(n),this.metrics?.peersPerProtocol.inc({protocol:s},1),this.subscriptions.size>0&&(this.log("send subscriptions to",n),this.sendSubscriptions(n,Array.from(this.subscriptions),!0))}catch(r){this.log.error("createOutboundStream error",r)}}async createInboundStream(e,t){if(!this.isStarted())return;const n=e.toString();if(!this.peers.has(n))return;const r=this.streamsInbound.get(n);void 0!==r&&(this.log("replacing existing inbound steam %s",n),r.close()),this.log("create inbound stream %s",n);const s=new uj(t);this.streamsInbound.set(n,s),this.pipePeerReadStream(e,s.source).catch((e=>this.log(e)))}addPeer(e,t){const n=e.toString();this.peers.has(n)||(this.log("new peer %p",e),this.peers.add(n),this.score.addPeer(n),this.outbound.has(n)||this.outbound.set(n,"outbound"===t))}removePeer(e){const t=e.toString();if(!this.peers.has(t))return;this.log("delete peer %p",e),this.peers.delete(t);const n=this.streamsOutbound.get(t),r=this.streamsInbound.get(t);n&&this.metrics?.peersPerProtocol.inc({protocol:n.protocol},-1),n?.close(),r?.close(),this.streamsOutbound.delete(t),this.streamsInbound.delete(t);for(const s of this.topics.values())s.delete(t);for(const[s,i]of this.mesh)!0===i.delete(t)&&this.metrics?.onRemoveFromMesh(s,PU.Dc,1);for(const s of this.fanout.values())s.delete(t);this.floodsubPeers.delete(t),this.gossip.delete(t),this.control.delete(t),this.outbound.delete(t),this.score.removePeer(t),this.acceptFromWhitelist.delete(t)}get started(){return this.status.code===hj.started}getMeshPeers(e){const t=this.mesh.get(e);return t?Array.from(t):[]}getSubscribers(e){const t=this.topics.get(e);return(t?Array.from(t):[]).map((e=>Fu(e)))}getTopics(){return Array.from(this.subscriptions)}async pipePeerReadStream(e,t){try{await vm(t,(async t=>{for await(const r of t)try{const t=r.subarray(),n=vL.decode(t);this.metrics?.onRpcRecv(n,t.length),this.opts.awaitRpcHandler?await this.handleReceivedRpc(e,n):this.handleReceivedRpc(e,n).catch((e=>this.log(e)))}catch(n){this.log(n)}}))}catch(uS){this.log.error(uS),this.onPeerDisconnected(e)}}async handleReceivedRpc(e,t){if(!this.acceptFrom(e.toString()))return this.log("received message from unacceptable peer %p",e),void this.metrics?.rpcRecvNotAccepted.inc();if(this.log("rpc from %p",e),t.subscriptions&&t.subscriptions.length>0&&(t.subscriptions.forEach((t=>{this.handleReceivedSubscription(e,t)})),this.dispatchEvent(new yL("subscription-change",{detail:{peerId:e,subscriptions:t.subscriptions.filter((e=>null!==e.topic)).map((e=>({topic:e.topic??"",subscribe:Boolean(e.subscribe)})))}}))),t.messages)for(const n of t.messages){const t=this.handleReceivedMessage(e,n).catch((e=>this.log(e)));this.opts.awaitRpcMessageHandler&&await t}t.control&&await this.handleControlMessage(e.toString(),t.control)}handleReceivedSubscription(e,t){if(null==t.topic)return;this.log("subscription update from %p topic %s",e,t.topic);let n=this.topics.get(t.topic);null==n&&(n=new Set,this.topics.set(t.topic,n)),t.subscribe?n.add(e.toString()):n.delete(e.toString())}async handleReceivedMessage(e,t){this.metrics?.onMsgRecvPreValidation(t.topic);const n=await this.validateReceivedMessage(e,t);switch(this.metrics?.onMsgRecvResult(t.topic,n.code),n.code){case lU.duplicate:return this.score.duplicateMessage(e.toString(),n.msgIdStr,t.topic),void this.mcache.observeDuplicate(n.msgIdStr,e.toString());case lU.invalid:if(n.msgIdStr){const r=n.msgIdStr;this.score.rejectMessage(e.toString(),r,t.topic,n.reason),this.gossipTracer.rejectMessage(r,n.reason)}else this.score.rejectInvalidMessage(e.toString(),t.topic);return void this.metrics?.onMsgRecvInvalid(t.topic,n);case lU.valid:if(this.score.validateMessage(n.messageId.msgIdStr),this.gossipTracer.deliverMessage(n.messageId.msgIdStr),this.mcache.put(n.messageId,t,!this.opts.asyncValidation),this.subscriptions.has(t.topic)){const t=this.components.getPeerId().equals(e);t&&!this.opts.emitSelf||(super.dispatchEvent(new yL("gossipsub:message",{detail:{propagationSource:e,msgId:n.messageId.msgIdStr,msg:n.msg}})),super.dispatchEvent(new yL("message",{detail:n.msg})))}this.opts.asyncValidation||this.forwardMessage(n.messageId.msgIdStr,t,e.toString())}}async validateReceivedMessage(e,t){const n=this.fastMsgIdFn?.(t),r=n?this.fastMsgIdCache?.get(n):void 0;if(r)return{code:lU.duplicate,msgIdStr:r};const s=await GU(this.globalSignaturePolicy,t);if(!s.valid)return{code:lU.invalid,reason:aU.Error,error:s.error};const i=s.message;try{this.dataTransform&&(i.data=this.dataTransform.inboundTransform(t.topic,i.data))}catch(u){return this.log("Invalid message, transform failed",u),{code:lU.invalid,reason:aU.Error,error:cU.TransformFailed}}const o=await this.msgIdFn(i),a=this.msgIdToStrFn(o),c={msgId:o,msgIdStr:a};if(n&&this.fastMsgIdCache?.put(n,a),this.seenCache.has(a))return{code:lU.duplicate,msgIdStr:a};this.seenCache.put(a);const l=this.topicValidators.get(t.topic);if(null!=l){let t;try{t=await l(i.topic,i,e)}catch(u){const e=u.code;e===ZL&&(t=oU.Ignore),t=e===XL?oU.Reject:oU.Ignore}if(t!==oU.Accept)return{code:lU.invalid,reason:uU(t),msgIdStr:a}}return{code:lU.valid,messageId:c,msg:i}}getScore(e){return this.score.score(e)}sendSubscriptions(e,t,n){this.sendRpc(e,{subscriptions:t.map((e=>({topic:e,subscribe:n}))),messages:[]})}async handleControlMessage(e,t){if(void 0===t)return;const n=t.ihave?this.handleIHave(e,t.ihave):[],r=t.iwant?this.handleIWant(e,t.iwant):[],s=t.graft?await this.handleGraft(e,t.graft):[];t.prune&&await this.handlePrune(e,t.prune),(n.length||r.length||s.length)&&this.sendRpc(e,sM(r,{iwant:n,prune:s}))}acceptFrom(e){if(this.direct.has(e))return!0;const t=Date.now(),n=this.acceptFromWhitelist.get(e);if(n&&n.messagesAccepted<tM&&n.acceptUntil>=t)return n.messagesAccepted+=1,!0;const r=this.score.score(e);return r>=eM?this.acceptFromWhitelist.set(e,{messagesAccepted:0,acceptUntil:t+nM}):this.acceptFromWhitelist.delete(e),r>=this.opts.scoreThresholds.graylistThreshold}handleIHave(e,t){if(!t.length)return[];const n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IHAVE: ignoring peer %s with score below threshold [ score = %d ]",e,n),this.metrics?.ihaveRcvIgnored.inc({reason:MU.LowScore}),[];const r=(this.peerhave.get(e)??0)+1;if(this.peerhave.set(e,r),r>WL)return this.log("IHAVE: peer %s has advertised too many times (%d) within this heartbeat interval; ignoring",e,r),this.metrics?.ihaveRcvIgnored.inc({reason:MU.MaxIhave}),[];const s=this.iasked.get(e)??0;if(s>=GL)return this.log("IHAVE: peer %s has already advertised too many messages (%d); ignoring",e,s),this.metrics?.ihaveRcvIgnored.inc({reason:MU.MaxIasked}),[];const i=new Map;if(t.forEach((({topicID:e,messageIDs:t})=>{if(!e||!t||!this.mesh.has(e))return;let n=0;t.forEach((e=>{const t=this.msgIdToStrFn(e);this.seenCache.has(t)||(i.set(t,e),n++)})),this.metrics?.onIhaveRcv(e,t.length,n)})),!i.size)return[];let o=i.size;o+s>GL&&(o=GL-s),this.log("IHAVE: Asking for %d out of %d messages from %s",o,i.size,e);let a=Array.from(i.values());return iM(a),a=a.slice(0,o),this.iasked.set(e,s+o),this.gossipTracer.addPromise(e,a),[{messageIDs:a}]}handleIWant(e,t){if(!t.length)return[];const n=this.score.score(e);if(n<this.opts.scoreThresholds.gossipThreshold)return this.log("IWANT: ignoring peer %s with score below threshold [score = %d]",e,n),[];const r=new Map,s=new Map;let i=0;return t.forEach((({messageIDs:t})=>{t&&t.forEach((t=>{const n=this.msgIdToStrFn(t),o=this.mcache.getWithIWantCount(n,e);null!=o?(s.set(o.msg.topic,1+(s.get(o.msg.topic)??0)),o.count>LL?this.log("IWANT: Peer %s has asked for message %s too many times: ignoring request",e,t):r.set(n,o.msg)):i++}))})),this.metrics?.onIwantRcv(s,i),r.size?(this.log("IWANT: Sending %d messages to %s",r.size,e),Array.from(r.values())):(this.log("IWANT: Could not provide any wanted messages to %s",e),[])}async handleGraft(e,t){const n=[],r=this.score.score(e),s=Date.now();let i=this.opts.doPX;return t.forEach((({topicID:t})=>{if(!t)return;const o=this.mesh.get(t);if(!o)return void(i=!1);if(o.has(e))return;if(this.direct.has(e))return this.log("GRAFT: ignoring request from direct peer %s",e),n.push(t),void(i=!1);const a=this.backoff.get(t)?.get(e);if("number"===typeof a&&s<a){this.log("GRAFT: ignoring backed off peer %s",e),this.score.addPenalty(e,1,LU.GraftBackoff),i=!1;const r=a+this.opts.graftFloodThreshold-this.opts.pruneBackoff;return s<r&&this.score.addPenalty(e,1,LU.GraftBackoff),this.addBackoff(e,t),void n.push(t)}return r<0?(this.log("GRAFT: ignoring peer %s with negative score: score=%d, topic=%s",e,r,t),n.push(t),i=!1,void this.addBackoff(e,t)):o.size>=this.opts.Dhi&&!this.outbound.get(e)?(n.push(t),void this.addBackoff(e,t)):(this.log("GRAFT: Add mesh link from %s in %s",e,t),this.score.graft(e,t),o.add(e),void this.metrics?.onAddToMesh(t,DU.Subscribed,1))})),n.length?await Promise.all(n.map((t=>this.makePrune(e,t,i)))):[]}async handlePrune(e,t){const n=this.score.score(e);for(const{topicID:r,backoff:s,peers:i}of t){if(null==r)continue;const t=this.mesh.get(r);if(!t)return;if(this.log("PRUNE: Remove mesh link to %s in %s",e,r),this.score.prune(e,r),t.has(e)&&(t.delete(e),this.metrics?.onRemoveFromMesh(r,PU.Unsub,1)),"number"===typeof s&&s>0?this.doAddBackoff(e,r,1e3*s):this.addBackoff(e,r),i&&i.length){if(n<this.opts.scoreThresholds.acceptPXThreshold){this.log("PRUNE: ignoring PX from peer %s with insufficient score [score = %d, topic = %s]",e,n,r);continue}await this.pxConnect(i)}}}addBackoff(e,t){this.doAddBackoff(e,t,this.opts.pruneBackoff)}doAddBackoff(e,t,n){let r=this.backoff.get(t);r||(r=new Map,this.backoff.set(t,r));const s=Date.now()+n,i=r.get(e)??0;i<s&&r.set(e,s)}applyIwantPenalties(){this.gossipTracer.getBrokenPromises().forEach(((e,t)=>{this.log("peer %s didn't follow up in %d IWANT requests; adding penalty",t,e),this.score.addPenalty(t,e,LU.BrokenPromise)}))}clearBackoff(){if(this.heartbeatTicks%jL!==0)return;const e=Date.now();this.backoff.forEach(((t,n)=>{t.forEach(((n,r)=>{n<e&&t.delete(r)})),0===t.size&&this.backoff.delete(n)}))}async directConnect(){const e=[];this.direct.forEach((t=>{this.streamsOutbound.has(t)||e.push(t)})),await Promise.all(e.map((async e=>await this.connect(e))))}async pxConnect(e){e.length>this.opts.prunePeers&&(iM(e),e=e.slice(0,this.opts.prunePeers));const t=[];await Promise.all(e.map((async e=>{if(!e.peerID)return;const n=ju(e.peerID).toString();if(!this.peers.has(n))if(e.signedPeerRecord)try{const r=await tL.openAndCertify(e.signedPeerRecord,"libp2p-peer-record"),s=r.peerId;if(!r.peerId.equals(n))return void this.log("bogus peer record obtained through px: peer ID %p doesn't match expected peer %p",s,n);if(!await this.components.getPeerStore().addressBook.consumePeerRecord(r))return void this.log("bogus peer record obtained through px: could not add peer record to address book");t.push(n)}catch(r){this.log("bogus peer record obtained through px: invalid signature or not a peer record")}else t.push(n)}))),t.length&&await Promise.all(t.map((async e=>await this.connect(e))))}async connect(e){this.log("Initiating connection with %s",e);const t=Fu(e),n=await this.components.getConnectionManager().openConnection(t);for(const r of this.multicodecs)for(const e of this.components.getRegistrar().getTopologies(r))e.onConnect(t,n)}subscribe(e){if(this.status.code!==hj.started)throw new Error("Pubsub has not started");if(!this.subscriptions.has(e)){this.subscriptions.add(e);for(const t of this.peers.keys())this.sendSubscriptions(t,[e],!0)}this.join(e)}unsubscribe(e){if(this.status.code!==hj.started)throw new Error("Pubsub is not started");const t=this.subscriptions.delete(e);if(this.log("unsubscribe from %s - am subscribed %s",e,t),t)for(const n of this.peers.keys())this.sendSubscriptions(n,[e],!1);this.leave(e).catch((e=>{this.log(e)}))}join(e){if(this.status.code!==hj.started)throw new Error("Gossipsub has not started");if(this.mesh.has(e))return;this.log("JOIN %s",e),this.metrics?.onJoin(e);const t=new Set,n=this.fanout.get(e);if(n&&(this.fanout.delete(e),this.fanoutLastpub.delete(e),n.forEach((e=>{!this.direct.has(e)&&this.score.score(e)>=0&&t.add(e)})),this.metrics?.onAddToMesh(e,DU.Fanout,t.size)),t.size<this.opts.D){const n=t.size,r=this.getRandomGossipPeers(e,this.opts.D,(e=>!t.has(e)&&!this.direct.has(e)&&this.score.score(e)>=0));r.forEach((e=>{t.add(e)})),this.metrics?.onAddToMesh(e,DU.Random,t.size-n)}this.mesh.set(e,t),t.forEach((t=>{this.log("JOIN: Add mesh link to %s in %s",t,e),this.sendGraft(t,e)}))}async leave(e){if(this.status.code!==hj.started)throw new Error("Gossipsub has not started");this.log("LEAVE %s",e),this.metrics?.onLeave(e);const t=this.mesh.get(e);t&&(await Promise.all(Array.from(t).map((async t=>(this.log("LEAVE: Remove mesh link to %s in %s",t,e),await this.sendPrune(t,e))))),this.mesh.delete(e))}selectPeersToForward(e,t,n){const r=new Set,s=this.topics.get(e);s&&(this.direct.forEach((e=>{s.has(e)&&t!==e&&!n?.has(e)&&r.add(e)})),this.floodsubPeers.forEach((e=>{s.has(e)&&t!==e&&!n?.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&r.add(e)})));const i=this.mesh.get(e);return i&&i.size>0&&i.forEach((e=>{t===e||n?.has(e)||r.add(e)})),r}selectPeersToPublish(e){const t=new Set,n={direct:0,floodsub:0,mesh:0,fanout:0},r=this.topics.get(e);if(r)if(this.opts.floodPublish)r.forEach((e=>{this.direct.has(e)?(t.add(e),n.direct++):this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),n.floodsub++)}));else{this.direct.forEach((e=>{r.has(e)&&(t.add(e),n.direct++)})),this.floodsubPeers.forEach((e=>{r.has(e)&&this.score.score(e)>=this.opts.scoreThresholds.publishThreshold&&(t.add(e),n.floodsub++)}));const s=this.mesh.get(e);if(s&&s.size>0)s.forEach((e=>{t.add(e),n.mesh++}));else{const r=this.fanout.get(e);if(r&&r.size>0)r.forEach((e=>{t.add(e),n.fanout++}));else{const r=this.getRandomGossipPeers(e,this.opts.D,(e=>this.score.score(e)>=this.opts.scoreThresholds.publishThreshold));r.size>0&&(this.fanout.set(e,r),r.forEach((e=>{t.add(e),n.fanout++})))}this.fanoutLastpub.set(e,Date.now())}}return{tosend:t,tosendCount:n}}forwardMessage(e,t,n,r){n&&this.score.deliverMessage(n,e,t.topic);const s=this.selectPeersToForward(t.topic,n,r),i=sM([t]);s.forEach((e=>{this.sendRpc(e,i)})),this.metrics?.onForwardMsg(t.topic,s.size)}async publish(e,t){const n=this.dataTransform?this.dataTransform.outboundTransform(e,t):t;if(null==this.publishConfig)throw Error("PublishError.Uninitialized");const{raw:r,msg:s}=await qU(this.publishConfig,e,t,n),i=await this.msgIdFn(s),o=this.msgIdToStrFn(i);if(this.seenCache.has(o))throw Error("PublishError.Duplicate");const{tosend:a,tosendCount:c}=this.selectPeersToPublish(e),l=!0===this.opts.emitSelf&&this.subscriptions.has(e);if(0===a.size&&!this.opts.allowPublishToZeroPeers&&!l)throw Error("PublishError.InsufficientPeers");this.seenCache.put(o),this.mcache.put({msgId:i,msgIdStr:o},r,!0),this.publishedMessageIds.put(o);const u=sM([r]);for(const h of a){const e=this.sendRpc(h,u);e||a.delete(h)}return this.metrics?.onPublishMsg(e,c,a.size,null!=r.data?r.data.length:0),l&&(a.add(this.components.getPeerId().toString()),super.dispatchEvent(new yL("gossipsub:message",{detail:{propagationSource:this.components.getPeerId(),msgId:o,msg:s}})),super.dispatchEvent(new yL("message",{detail:s}))),{recipients:Array.from(a.values()).map((e=>Fu(e)))}}reportMessageValidationResult(e,t,n){if(n===oU.Accept){const r=this.mcache.validate(e);if(this.metrics?.onReportValidationMcacheHit(null!==r),null!=r){const{message:s,originatingPeers:i}=r;this.score.deliverMessage(t.toString(),e,s.topic),this.forwardMessage(e,r.message,t.toString(),i),this.metrics?.onReportValidation(s.topic,n)}}else{const r=this.mcache.remove(e);if(this.metrics?.onReportValidationMcacheHit(null!==r),r){const s=uU(n),{message:i,originatingPeers:o}=r;this.score.rejectMessage(t.toString(),e,i.topic,s);for(const t of o)this.score.rejectMessage(t,e,i.topic,s);this.metrics?.onReportValidation(i.topic,n)}}}sendGraft(e,t){const n=[{topicID:t}],r=sM([],{graft:n});this.sendRpc(e,r)}async sendPrune(e,t){const n=[await this.makePrune(e,t,this.opts.doPX)],r=sM([],{prune:n});this.sendRpc(e,r)}sendRpc(e,t){const n=this.streamsOutbound.get(e);if(!n)return this.log(`Cannot send RPC to ${e} as there is no open stream to it available`),!1;const r=this.control.get(e);r&&(this.piggybackControl(e,t,r),this.control.delete(e));const s=this.gossip.get(e);s&&(this.piggybackGossip(e,t,s),this.gossip.delete(e));const i=vL.encode(t).finish();try{n.push(i)}catch(o){return this.log.error(`Cannot send rpc to ${e}`,o),r&&this.control.set(e,r),s&&this.gossip.set(e,s),!1}return this.metrics?.onRpcSent(t,i.length),!0}piggybackControl(e,t,n){const r=(n.graft||[]).filter((({topicID:t})=>(t&&this.mesh.get(t)||new Set).has(e))),s=(n.prune||[]).filter((({topicID:t})=>!(t&&this.mesh.get(t)||new Set).has(e)));(r.length||s.length)&&(t.control?(t.control.graft=t.control.graft&&t.control.graft.concat(r),t.control.prune=t.control.prune&&t.control.prune.concat(s)):t.control={graft:r,prune:s,ihave:[],iwant:[]})}piggybackGossip(e,t,n){t.control||(t.control={ihave:[],iwant:[],graft:[],prune:[]}),t.control.ihave=n}async sendGraftPrune(e,t,n){const r=this.opts.doPX;for(const[s,i]of e){const e=i.map((e=>({topicID:e})));let o=[];const a=t.get(s);a&&(o=await Promise.all(a.map((async e=>await this.makePrune(s,e,r&&!n.get(s))))),t.delete(s));const c=sM([],{graft:e,prune:o});this.sendRpc(s,c)}for(const[s,i]of t){const e=await Promise.all(i.map((async e=>await this.makePrune(s,e,r&&!n.get(s))))),t=sM([],{prune:e});this.sendRpc(s,t)}}emitGossip(e){const t=this.mcache.getGossipIDs(new Set(e.keys()));for(const[n,r]of e)this.doEmitGossip(n,r,t.get(n)??[])}doEmitGossip(e,t,n){if(!n.length)return;if(iM(n),n.length>GL&&this.log("too many messages for gossip; will truncate IHAVE list (%d messages)",n.length),!t.size)return;let r=this.opts.Dlazy;const s=PL*t.size;let i=t;s>r&&(r=s),r>i.size?r=i.size:i=iM(Array.from(i)).slice(0,r),i.forEach((t=>{let r=n;n.length>GL&&(r=iM(r.slice()).slice(0,GL)),this.pushGossip(t,{topicID:e,messageIDs:r})}))}flush(){for(const[e,t]of this.gossip.entries())this.gossip.delete(e),this.sendRpc(e,sM([],{ihave:t}));for(const[e,t]of this.control.entries())this.control.delete(e),this.sendRpc(e,sM([],{graft:t.graft,prune:t.prune}))}pushGossip(e,t){this.log("Add gossip to %s",e);const n=this.gossip.get(e)||[];this.gossip.set(e,n.concat(t))}async makePrune(e,t,n){if(this.score.prune(e,t),this.streamsOutbound.get(e).protocol===kL)return{topicID:t,peers:[]};const r=this.opts.pruneBackoff/1e3;if(!n)return{topicID:t,peers:[],backoff:r};const s=this.getRandomGossipPeers(t,this.opts.prunePeers,(t=>t!==e&&this.score.score(t)>=0)),i=await Promise.all(Array.from(s).map((async e=>{const t=Fu(e);return{peerID:t.toBytes(),signedPeerRecord:await this.components.getPeerStore().addressBook.getRawEnvelope(t)}})));return{topicID:t,peers:i,backoff:r}}async heartbeat(){const{D:e,Dlo:t,Dhi:n,Dscore:r,Dout:s,fanoutTTL:i}=this.opts;this.heartbeatTicks++;const o=new Map,a=e=>{let t=o.get(e);return void 0===t&&(t=this.score.score(e),o.set(e,t)),t},c=new Map,l=new Map,u=new Map;this.clearBackoff(),this.peerhave.clear(),this.metrics?.cacheSize.set({cache:"iasked"},this.iasked.size),this.iasked.clear(),this.applyIwantPenalties(),this.heartbeatTicks%this.opts.directConnectTicks===0&&await this.directConnect(),this.fastMsgIdCache?.prune(),this.seenCache.prune(),this.gossipTracer.prune(),this.publishedMessageIds.prune();const h=new Map;this.mesh.forEach(((i,o)=>{const d=this.topics.get(o),p=new Set,f=new Set;if(h.set(o,f),d){const e=iM(Array.from(d)),t=this.backoff.get(o);for(const n of e){const e=this.streamsOutbound.get(n);if(e&&this.multicodecs.includes(e.protocol)&&!i.has(n)&&!this.direct.has(n)){const e=a(n);t&&t.has(n)||!(e>=0)||p.add(n),e>=this.opts.scoreThresholds.gossipThreshold&&f.add(n)}}}const g=(e,t)=>{this.log("HEARTBEAT: Remove mesh link to %s in %s",e,o),this.addBackoff(e,o),i.delete(e),a(e)>=this.opts.scoreThresholds.gossipThreshold&&f.add(e),this.metrics?.onRemoveFromMesh(o,t,1);const n=l.get(e);n?n.push(o):l.set(e,[o])},m=(e,t)=>{this.log("HEARTBEAT: Add mesh link to %s in %s",e,o),this.score.graft(e,o),i.add(e),f.delete(e),this.metrics?.onAddToMesh(o,t,1);const n=c.get(e);n?n.push(o):c.set(e,[o])};if(i.forEach((e=>{const t=a(e);t<0&&(this.log("HEARTBEAT: Prune peer %s with negative score: score=%d, topic=%s",e,t,o),g(e,PU.BadScore),u.set(e,!0))})),i.size<t){const t=e-i.size,n=YF(p,t);n.forEach((e=>{m(e,DU.NotEnough)}))}if(i.size>n){let t=Array.from(i);t.sort(((e,t)=>a(t)-a(e))),t=t.slice(0,r).concat(iM(t.slice(r)));let n=0;if(t.slice(0,e).forEach((e=>{this.outbound.get(e)&&n++})),n<s){const r=e=>{const n=t[e];for(let r=e;r>0;r--)t[r]=t[r-1];t[0]=n};if(n>0){let s=n;for(let n=1;n<e&&s>0;n++)this.outbound.get(t[n])&&(r(n),s--)}let s=e-n;for(let n=e;n<t.length&&s>0;n++)this.outbound.get(t[n])&&(r(n),s--)}t.slice(e).forEach((e=>{g(e,PU.Excess)}))}if(i.size>=t){let e=0;if(i.forEach((t=>{this.outbound.get(t)&&e++})),e<s){const t=s-e,n=WF(p,t,(e=>!0===this.outbound.get(e)));n.forEach((e=>{m(e,DU.Outbound)}))}}if(this.heartbeatTicks%this.opts.opportunisticGraftTicks===0&&i.size>1){const e=Array.from(i).sort(((e,t)=>a(e)-a(t))),t=Math.floor(i.size/2),n=a(e[t]);if(n<this.opts.scoreThresholds.opportunisticGraftThreshold){const e=this.opts.opportunisticGraftPeers,t=WF(p,e,(e=>a(e)>n));for(const n of t)this.log("HEARTBEAT: Opportunistically graft peer %s on topic %s",n,o),m(n,DU.Opportunistic)}}}));const d=Date.now();this.fanoutLastpub.forEach(((e,t)=>{e+i<d&&(this.fanout.delete(t),this.fanoutLastpub.delete(t))})),this.fanout.forEach(((t,n)=>{const r=this.topics.get(n);t.forEach((e=>{(!r.has(e)||a(e)<this.opts.scoreThresholds.publishThreshold)&&t.delete(e)}));const s=this.topics.get(n),i=[],o=new Set;if(h.set(n,o),s){const e=iM(Array.from(s));for(const n of e){const e=this.streamsOutbound.get(n);if(e&&this.multicodecs.includes(e.protocol)&&!t.has(n)&&!this.direct.has(n)){const e=a(n);e>=this.opts.scoreThresholds.publishThreshold&&i.push(n),e>=this.opts.scoreThresholds.gossipThreshold&&o.add(n)}}}if(t.size<e){const n=e-t.size;i.slice(0,n).forEach((e=>{t.add(e),o?.delete(e)}))}})),this.emitGossip(h),await this.sendGraftPrune(c,l,u),this.flush(),this.mcache.shift(),this.dispatchEvent(new yL("gossipsub:heartbeat"))}getRandomGossipPeers(e,t,n=(()=>!0)){const r=this.topics.get(e);if(!r)return new Set;let s=[];return r.forEach((e=>{const t=this.streamsOutbound.get(e);t&&this.multicodecs.includes(t.protocol)&&n(e)&&s.push(e)})),s=iM(s),t>0&&s.length>t&&(s=s.slice(0,t)),new Set(s)}onScrapeMetrics(e){e.mcacheSize.set(this.mcache.size),e.cacheSize.set({cache:"direct"},this.direct.size),e.cacheSize.set({cache:"seenCache"},this.seenCache.size),e.cacheSize.set({cache:"fastMsgIdCache"},this.fastMsgIdCache?.size??0),e.cacheSize.set({cache:"publishedMessageIds"},this.publishedMessageIds.size),e.cacheSize.set({cache:"mcache"},this.mcache.size),e.cacheSize.set({cache:"score"},this.score.size),e.cacheSize.set({cache:"gossipTracer.promises"},this.gossipTracer.size),e.cacheSize.set({cache:"gossipTracer.requests"},this.gossipTracer.requestMsByMsgSize),e.cacheSize.set({cache:"topics"},this.topics.size),e.cacheSize.set({cache:"subscriptions"},this.subscriptions.size),e.cacheSize.set({cache:"mesh"},this.mesh.size),e.cacheSize.set({cache:"fanout"},this.fanout.size),e.cacheSize.set({cache:"peers"},this.peers.size),e.cacheSize.set({cache:"streamsOutbound"},this.streamsOutbound.size),e.cacheSize.set({cache:"streamsInbound"},this.streamsInbound.size),e.cacheSize.set({cache:"acceptFromWhitelist"},this.acceptFromWhitelist.size),e.cacheSize.set({cache:"gossip"},this.gossip.size),e.cacheSize.set({cache:"control"},this.control.size),e.cacheSize.set({cache:"peerhave"},this.peerhave.size),e.cacheSize.set({cache:"outbound"},this.outbound.size);let t=0;for(const i of this.backoff.values())t+=i.size;e.cacheSize.set({cache:"backoff"},t);for(const[i,o]of this.topics)e.topicPeersCount.set({topicStr:i},o.size);for(const[i,o]of this.mesh)e.meshPeerCounts.set({topicStr:i},o.size);const n=[],r=new Map;e.behaviourPenalty.reset();for(const i of this.peers.keys()){const t=this.score.score(i);n.push(t),r.set(i,t),e.behaviourPenalty.observe(this.score.peerStats.get(i)?.behaviourPenalty??0)}e.registerScores(n,this.opts.scoreThresholds),e.registerScorePerMesh(this.mesh,r);const s=GF(this.peers.keys(),this.score.peerStats,this.score.params,this.score.peerIPs,e.topicStrToLabel);e.registerScoreWeights(s)}}dj.multicodec=AL;const pj=()=>({gossipsub:e=>{const t=new dj({allowPublishToZeroPeers:!0,fallbackToFloodsub:!0,emitSelf:!0,maxInboundStreams:64,maxOutboundStreams:128});return t.init({getPeerId(){return e.peerId},getPeerStore(){return e.peerStore},getRegistrar(){return e.registrar},getConnectionManager(){return e.connectionManager}}),t}}),fj=Fe("libp2p-delegated-peer-routing"),gj=3e4,mj=4;var yj,wj;(function(e){e[e["SENDING_QUERY"]=0]="SENDING_QUERY",e[e["PEER_RESPONSE"]=1]="PEER_RESPONSE",e[e["FINAL_PEER"]=2]="FINAL_PEER",e[e["QUERY_ERROR"]=3]="QUERY_ERROR",e[e["PROVIDER"]=4]="PROVIDER",e[e["VALUE"]=5]="VALUE",e[e["ADDING_PEER"]=6]="ADDING_PEER",e[e["DIALING_PEER"]=7]="DIALING_PEER"})(yj||(yj={})),function(e){e[e["PUT_VALUE"]=0]="PUT_VALUE",e[e["GET_VALUE"]=1]="GET_VALUE",e[e["ADD_PROVIDER"]=2]="ADD_PROVIDER",e[e["GET_PROVIDERS"]=3]="GET_PROVIDERS",e[e["FIND_NODE"]=4]="FIND_NODE",e[e["PING"]=5]="PING"}(wj||(wj={}));class bj{constructor(e){if(null==e)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new yu({concurrency:mj});const{protocol:t,host:n,port:r}=e.getEndpointConfig();fj(`enabled DelegatedPeerRouting via ${t}://${n}:${r}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async findPeer(e,t={}){fj("findPeer starts: %p",e),t.timeout=t.timeout??gj,t.signal=al([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const n=Ay(),r=Ay();this.httpQueue.add((async()=>(n.resolve(),await r.promise)));try{await n.promise;for await(const n of this.client.dht.findPeer(e,t))if("FINAL_PEER"===n.name){const e={id:n.peer.id,multiaddrs:n.peer.multiaddrs,protocols:[]};return e}}catch(uS){throw fj.error("findPeer errored: %o",uS),uS}finally{r.resolve(),fj("findPeer finished: %p",e)}throw je(new Error("Not found"),"ERR_NOT_FOUND")}async*getClosestPeers(e,t={}){let n;const r=Lt.asCID(e);n=null!=r?r:ju(e),fj("getClosestPeers starts: %s",n),t.timeout=t.timeout??gj,t.signal=al([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const s=Ay(),i=Ay();this.httpQueue.add((async()=>(s.resolve(),await i.promise)));try{await s.promise;for await(const e of this.client.dht.query(n,t))"PEER_RESPONSE"===e.name&&(yield*e.closer.map((e=>({id:e.id,multiaddrs:e.multiaddrs,protocols:[]}))))}catch(uS){throw fj.error("getClosestPeers errored:",uS),uS}finally{i.resolve(),fj("getClosestPeers finished: %b",e)}}}function vj(e){return()=>new bj(e)}const Ej=Fe("libp2p:delegated-content-routing"),_j=3e4,Sj=4,kj=2;var Aj,Tj;(function(e){e[e["SENDING_QUERY"]=0]="SENDING_QUERY",e[e["PEER_RESPONSE"]=1]="PEER_RESPONSE",e[e["FINAL_PEER"]=2]="FINAL_PEER",e[e["QUERY_ERROR"]=3]="QUERY_ERROR",e[e["PROVIDER"]=4]="PROVIDER",e[e["VALUE"]=5]="VALUE",e[e["ADDING_PEER"]=6]="ADDING_PEER",e[e["DIALING_PEER"]=7]="DIALING_PEER"})(Aj||(Aj={})),function(e){e[e["PUT_VALUE"]=0]="PUT_VALUE",e[e["GET_VALUE"]=1]="GET_VALUE",e[e["ADD_PROVIDER"]=2]="ADD_PROVIDER",e[e["GET_PROVIDERS"]=3]="GET_PROVIDERS",e[e["FIND_NODE"]=4]="FIND_NODE",e[e["PING"]=5]="PING"}(Tj||(Tj={}));class Cj{constructor(e){if(null==e)throw new Error("missing ipfs http client");this.client=e,this.started=!1,this.abortController=new AbortController,this.httpQueue=new yu({concurrency:Sj}),this.httpQueueRefs=new yu({concurrency:kj});const{protocol:t,host:n,port:r}=e.getEndpointConfig();Ej(`enabled DelegatedContentRouting via ${t}://${n}:${r}`)}isStarted(){return this.started}start(){this.started=!0}stop(){this.httpQueue.clear(),this.httpQueueRefs.clear(),this.abortController.abort(),this.abortController=new AbortController,this.started=!1}async*findProviders(e,t={}){Ej("findProviders starts: %c",e),t.timeout=t.timeout??_j,t.signal=al([this.abortController.signal].concat(null!=t.signal?[t.signal]:[]));const n=Ay(),r=Ay();this.httpQueue.add((async()=>(n.resolve(),await r.promise)));try{await n.promise;for await(const n of this.client.dht.findProvs(e,t))"PROVIDER"===n.name&&(yield*n.providers.map((e=>{const t={id:e.id,protocols:[],multiaddrs:e.multiaddrs};return t})))}catch(uS){throw Ej.error("findProviders errored:",uS),uS}finally{r.resolve(),Ej("findProviders finished: %c",e)}}async provide(e,t={}){Ej("provide starts: %c",e),t.timeout=t.timeout??_j,t.signal=al([this.abortController.signal].concat(null!=t.signal?[t.signal]:[])),await this.httpQueueRefs.add((async()=>{await this.client.block.stat(e,t),await Zg(this.client.dht.provide(e,t))})),Ej("provide finished: %c",e)}async put(e,t,n={}){Ej("put value start: %b",e),n.timeout=n.timeout??_j,n.signal=al([this.abortController.signal].concat(null!=n.signal?[n.signal]:[])),await this.httpQueue.add((async()=>{await Zg(this.client.dht.put(e,t,n))})),Ej("put value finished: %b",e)}async get(e,t={}){return Ej("get value start: %b",e),t.timeout=t.timeout??_j,t.signal=al([this.abortController.signal].concat(null!=t.signal?[t.signal]:[])),await this.httpQueue.add((async()=>{for await(const n of this.client.dht.get(e,t))if("VALUE"===n.name)return Ej("get value finished: %b",e),n.value;throw je(new Error("Not found"),"ERR_NOT_FOUND")}))}}function Ij(e){return()=>new Cj(e)}const Rj=e=>Promise.reject(new Error(`No base found for "${e}"`));class Oj{constructor(e){this._basesByName={},this._basesByPrefix={},this._loadBase=e.loadBase||Rj;for(const t of e.bases)this.addBase(t)}addBase(e){if(this._basesByName[e.name]||this._basesByPrefix[e.prefix])throw new Error(`Codec already exists for codec "${e.name}"`);this._basesByName[e.name]=e,this._basesByPrefix[e.prefix]=e}removeBase(e){delete this._basesByName[e.name],delete this._basesByPrefix[e.prefix]}async getBase(e){if(this._basesByName[e])return this._basesByName[e];if(this._basesByPrefix[e])return this._basesByPrefix[e];const t=await this._loadBase(e);return null==this._basesByName[t.name]&&null==this._basesByPrefix[t.prefix]&&this.addBase(t),t}listBases(){return Object.values(this._basesByName)}}const xj=e=>Promise.reject(new Error(`No codec found for "${e}"`));class Nj{constructor(e){this._codecsByName={},this._codecsByCode={},this._loadCodec=e.loadCodec||xj;for(const t of e.codecs)this.addCodec(t)}addCodec(e){if(this._codecsByName[e.name]||this._codecsByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._codecsByName[e.name]=e,this._codecsByCode[e.code]=e}removeCodec(e){delete this._codecsByName[e.name],delete this._codecsByCode[e.code]}async getCodec(e){const t="string"===typeof e?this._codecsByName:this._codecsByCode;if(t[e])return t[e];const n=await this._loadCodec(e);return null==t[e]&&this.addCodec(n),n}listCodecs(){return Object.values(this._codecsByName)}}const Dj=e=>Promise.reject(new Error(`No hasher found for "${e}"`));class Pj{constructor(e){this._hashersByName={},this._hashersByCode={},this._loadHasher=e.loadHasher||Dj;for(const t of e.hashers)this.addHasher(t)}addHasher(e){if(this._hashersByName[e.name]||this._hashersByCode[e.code])throw new Error(`Resolver already exists for codec "${e.name}"`);this._hashersByName[e.name]=e,this._hashersByCode[e.code]=e}removeHasher(e){delete this._hashersByName[e.name],delete this._hashersByCode[e.code]}async getHasher(e){const t="string"===typeof e?this._hashersByName:this._hashersByCode;if(t[e])return t[e];const n=await this._loadHasher(e);return null==t[e]&&this.addHasher(n),n}listHashers(){return Object.values(this._hashersByName)}}function Lj(e){try{e=vI(dc(e))}catch(uS){}return e=e.toString(),e}var Mj=()=>{};const Bj=Fe("ipfs-http-client:lib:error-handler"),Uj=ne.bind({ignoreUndefined:!0}),Vj=re.isBrowser||re.isWebWorker?location.protocol:"http",Fj=re.isBrowser||re.isWebWorker?location.hostname:"localhost",jj=re.isBrowser||re.isWebWorker?location.port:"5001",zj=(e={})=>{let t,n,r={};if("string"===typeof e||uc(e))t=new URL(Lj(e));else if(e instanceof URL)t=e;else if("string"===typeof e.url||uc(e.url))t=new URL(Lj(e.url)),r=e;else if(e.url instanceof URL)t=e.url,r=e;else{r=e||{};const n=(r.protocol||Vj).replace(":",""),s=(r.host||Fj).split(":")[0],i=r.port||jj;t=new URL(`${n}://${s}:${i}`)}if(r.apiPath?t.pathname=r.apiPath:"/"!==t.pathname&&void 0!==t.pathname||(t.pathname="api/v0"),re.isNode){const e=Mj(t);n=r.agent||new e({keepAlive:!0,maxSockets:6})}return{...r,host:t.host,protocol:t.protocol.replace(":",""),port:Number(t.port),apiPath:t.pathname,url:t,agent:n}},$j=async e=>{let t;try{if((e.headers.get("Content-Type")||"").startsWith("application/json")){const n=await e.json();Bj(n),t=n.Message||n.message}else t=await e.text()}catch(uS){Bj("Failed to parse error response",uS),t=uS.message}let n=new wu.HTTPError(e);throw t&&(t.includes("deadline has elapsed")&&(n=new wu.TimeoutError),t&&t.includes("context deadline exceeded")&&(n=new wu.TimeoutError)),t&&t.includes("request timed out")&&(n=new wu.TimeoutError),t&&(n.message=t),n},Hj=/[A-Z\u00C0-\u00D6\u00D8-\u00DE]/g,Kj=e=>e.replace(Hj,(function(e){return"-"+e.toLowerCase()})),qj=e=>"string"===typeof e?hl(e):e;class Gj extends wu{constructor(e={}){const t=zj(e);super({timeout:qj(t.timeout||0)||void 0,headers:t.headers,base:`${t.url}`,handleError:$j,transformSearchParams:e=>{const t=new URLSearchParams;for(const[n,r]of e)"undefined"!==r&&"null"!==r&&"signal"!==n&&t.append(Kj(n),r),"timeout"!==n||isNaN(r)||t.append(Kj(n),r);return t},agent:t.agent}),delete this.get,delete this.put,delete this.delete,delete this.options;const n=this.fetch;this.fetch=(e,r={})=>("string"!==typeof e||e.startsWith("/")||(e=`${t.url}/${e}`),n.call(this,e,Uj(r,{method:"POST"})))}}wu.HTTPError;const Wj=e=>t=>e(new Gj(t),t);function Yj(e){if(null!=e)return"string"===typeof e?e:e.toString(8).padStart(4,"0")}function Jj(e){if(null==e)return;let t;if(null!=e.secs&&(t={secs:e.secs,nsecs:e.nsecs}),null!=e.Seconds&&(t={secs:e.Seconds,nsecs:e.FractionalNanoseconds}),Array.isArray(e)&&(t={secs:e[0],nsecs:e[1]}),e instanceof Date){const n=e.getTime(),r=Math.floor(n/1e3);t={secs:r,nsecs:1e3*(n-1e3*r)}}if(Object.prototype.hasOwnProperty.call(t,"secs")){if(null!=t&&null!=t.nsecs&&(t.nsecs<0||t.nsecs>999999999))throw je(new Error("mtime-nsecs must be within the range [0,999999999]"),"ERR_INVALID_MTIME_NSECS");return t}}function Qj({arg:e,searchParams:t,hashAlg:n,mtime:r,mode:s,...i}={}){t&&(i={...i,...t}),n&&(i.hash=n),null!=r&&(r=Jj(r),i.mtime=r.secs,i.mtimeNsecs=r.nsecs),null!=s&&(i.mode=Yj(s)),i.timeout&&!isNaN(i.timeout)&&(i.timeout=`${i.timeout}ms`),void 0===e||null===e?e=[]:Array.isArray(e)||(e=[e]);const o=new URLSearchParams(i);return e.forEach((e=>o.append("arg",e))),o}const Xj=Wj((e=>{async function t(t={}){const n=await(await e.post("bitswap/wantlist",{signal:t.signal,searchParams:Qj(t),headers:t.headers})).json();return(n.Keys||[]).map((e=>Lt.parse(e["/"])))}return t})),Zj=Wj((e=>{async function t(t,n={}){const r=await(await e.post("bitswap/wantlist",{signal:n.signal,searchParams:Qj({...n,peer:t.toString()}),headers:n.headers})).json();return(r.Keys||[]).map((e=>Lt.parse(e["/"])))}return t})),ez=Wj((e=>{async function t(t={}){const n=await e.post("bitswap/stat",{searchParams:Qj(t),signal:t.signal,headers:t.headers});return tz(await n.json())}return t}));function tz(e){return{provideBufLen:e.ProvideBufLen,wantlist:(e.Wantlist||[]).map((e=>Lt.parse(e["/"]))),peers:(e.Peers||[]).map((e=>Fu(e))),blocksReceived:BigInt(e.BlocksReceived),dataReceived:BigInt(e.DataReceived),blocksSent:BigInt(e.BlocksSent),dataSent:BigInt(e.DataSent),dupBlksReceived:BigInt(e.DupBlksReceived),dupDataReceived:BigInt(e.DupDataReceived)}}const nz=Wj((e=>{async function t(t,n={}){const r=await e.post("bitswap/unwant",{signal:n.signal,searchParams:Qj({arg:t.toString(),...n}),headers:n.headers});return r.json()}return t}));function rz(e){return{wantlist:Xj(e),wantlistForPeer:Zj(e),unwant:nz(e),stat:ez(e)}}const sz=Wj((e=>{async function t(t,n={}){const r=await e.post("block/get",{signal:n.signal,searchParams:Qj({arg:t.toString(),...n}),headers:n.headers});return new Uint8Array(await r.arrayBuffer())}return t}));async function iz(e){if(By(e))return new Blob([e]);if("string"===typeof e||e instanceof String)return new Blob([e.toString()]);if(Uy(e))return e;if(Fy(e)&&(e=Py(e)),Symbol.iterator in e||Symbol.asyncIterator in e){const t=My(e),{value:n,done:r}=await t.peek();if(r)return oz(t);if(t.push(n),Number.isInteger(n))return new Blob([Uint8Array.from(await Qg(t))]);if(By(n)||"string"===typeof n||n instanceof String)return oz(t)}throw je(new Error(`Unexpected input: ${e}`),"ERR_UNEXPECTED_INPUT")}async function oz(e){const t=[];for await(const n of e)t.push(n);return new Blob(t)}function az(e){return mb(e,iz,!0)}function cz(e){if(null!=e)return"string"===typeof e?e:e.toString(8).padStart(4,"0")}async function lz(e,t,n={}){const r=[],s=new FormData;let i=0,o=0;for await(const{content:a,path:c,mode:l,mtime:u}of az(e)){let e="";const t=a?"file":"dir";i>0&&(e=`-${i}`);let n=t+e;const h=[];if(null!==l&&void 0!==l&&h.push(`mode=${cz(l)}`),null!=u){const{secs:e,nsecs:t}=u;h.push(`mtime=${e}`),null!=t&&h.push(`mtime-nsecs=${t}`)}if(h.length&&(n=`${n}?${h.join("&")}`),a){s.set(n,a,null!=c?encodeURIComponent(c):void 0);const e=o+a.size;r.push({name:c,start:o,end:e}),o=e}else{if(null==c)throw new Error("path or content or both must be set");s.set(n,new File([""],encodeURIComponent(c),{type:"application/x-directory"}))}i++}return{total:o,parts:r,headers:n,body:s}}function uz(e){return e.filter(Boolean)}function hz(...e){return(0,al.anySignal)(uz(e))}const dz=Wj((e=>{async function t(n,r={}){const s=new AbortController,i=hz(s.signal,r.signal);let o;try{const t=await e.post("block/put",{signal:i,searchParams:Qj(r),...await lz([n],s,r.headers)});o=await t.json()}catch(uS){if("dag-pb"===r.format)return t(n,{...r,format:"protobuf"});if("dag-cbor"===r.format)return t(n,{...r,format:"cbor"});throw uS}return Lt.parse(o.Key)}return t})),pz=Wj((e=>{async function*t(t,n={}){Array.isArray(t)||(t=[t]);const r=await e.post("block/rm",{signal:n.signal,searchParams:Qj({arg:t.map((e=>e.toString())),"stream-channels":!0,...n}),headers:n.headers});for await(const e of r.ndjson())yield fz(e)}return t}));function fz(e){const t={cid:Lt.parse(e.Hash)};return e.Error&&(t.error=new Error(e.Error)),t}const gz=Wj((e=>{async function t(t,n={}){const r=await e.post("block/stat",{signal:n.signal,searchParams:Qj({arg:t.toString(),...n}),headers:n.headers}),s=await r.json();return{cid:Lt.parse(s.Key),size:s.Size}}return t}));function mz(e){return{get:sz(e),put:dz(e),rm:pz(e),stat:gz(e)}}const yz=Wj((e=>{async function t(t,n={}){const r=await e.post("bootstrap/add",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),{Peers:s}=await r.json();return{Peers:s.map((e=>dc(e)))}}return t})),wz=Wj((e=>{async function t(t={}){const n=await e.post("bootstrap/rm",{signal:t.signal,searchParams:Qj({...t,all:!0}),headers:t.headers}),{Peers:r}=await n.json();return{Peers:r.map((e=>dc(e)))}}return t})),bz=Wj((e=>{async function t(t={}){const n=await e.post("bootstrap/list",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),{Peers:r}=await n.json();return{Peers:r.map((e=>dc(e)))}}return t})),vz=Wj((e=>{async function t(t={}){const n=await e.post("bootstrap/add",{signal:t.signal,searchParams:Qj({...t,default:!0}),headers:t.headers}),{Peers:r}=await n.json();return{Peers:r.map((e=>dc(e)))}}return t})),Ez=Wj((e=>{async function t(t,n={}){const r=await e.post("bootstrap/rm",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),{Peers:s}=await r.json();return{Peers:s.map((e=>dc(e)))}}return t}));function _z(e){return{add:yz(e),clear:wz(e),list:bz(e),reset:vz(e),rm:Ez(e)}}const Sz=Wj((e=>{async function t(t,n={}){const r=await e.post("config/profile/apply",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return{original:s.OldCfg,updated:s.NewCfg}}return t}));function kz(e){if(null==e)return e;const t=/^[A-Z]+$/,n={};return Object.keys(e).reduce(((n,r)=>(t.test(r)?n[r.toLowerCase()]=e[r]:t.test(r[0])?n[r[0].toLowerCase()+r.slice(1)]=e[r]:n[r]=e[r],n)),n)}const Az=Wj((e=>{async function t(t={}){const n=await e.post("config/profile/list",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),r=await n.json();return r.map((e=>kz(e)))}return t}));function Tz(e){return{apply:Sz(e),list:Az(e)}}const Cz=Wj((e=>{const t=async(t,n={})=>{if(!t)throw new Error("key argument is required");const r=await e.post("config",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return s.Value};return t})),Iz=Wj((e=>{const t=async(t={})=>{const n=await e.post("config/show",{signal:t.signal,searchParams:Qj({...t}),headers:t.headers}),r=await n.json();return r};return t})),Rz=Wj((e=>{const t=async(t,n={})=>{const r=new AbortController,s=hz(r.signal,n.signal),i=await e.post("config/replace",{signal:s,searchParams:Qj(n),...await lz([$o(JSON.stringify(t))],r,n.headers)});await i.text()};return t})),Oz=Wj((e=>{const t=async(t,n,r={})=>{if("string"!==typeof t)throw new Error("Invalid key type");const s={...r,...xz(t,n)},i=await e.post("config",{signal:r.signal,searchParams:Qj(s),headers:r.headers});await i.text()};return t})),xz=(e,t)=>{switch(typeof t){case"boolean":return{arg:[e,t.toString()],bool:!0};case"string":return{arg:[e,t]};default:return{arg:[e,JSON.stringify(t)],json:!0}}};function Nz(e){return{getAll:Iz(e),get:Cz(e),set:Oz(e),replace:Rz(e),profiles:Tz(e)}}const Dz=Wj((e=>{async function*t(t,n={}){const r=await e.post("dag/export",{signal:n.signal,searchParams:Qj({arg:t.toString()}),headers:n.headers});yield*r.iterator()}return t}));async function*Pz(e,t,n,r,s){const i=async e=>{const t=await n.getCodec(e.code),i=await r(e,s);return t.decode(i)},o=t.split("/").filter(Boolean);let a=await i(e),c=e;while(o.length){const e=o.shift();if(!e)throw je(new Error(`Could not resolve path "${t}"`),"ERR_INVALID_PATH");if(!Object.prototype.hasOwnProperty.call(a,e))throw je(new Error(`no link named "${e}" under ${c}`),"ERR_NO_LINK");a=a[e],yield{value:a,remainderPath:o.join("/")};const n=Lt.asCID(a);n&&(c=n,a=await i(a))}yield{value:a,remainderPath:""}}const Lz=(e,t)=>{const n=Wj(((t,n)=>{const r=sz(n),s=async(t,n={})=>{if(n.path){const s=n.localResolve?await rI(Pz(t,n.path,e,r,n)):await qu(Pz(t,n.path,e,r,n)),i=s;if(!i)throw je(new Error("Not found"),"ERR_NOT_FOUND");return i}const s=await e.getCodec(t.code),i=await r(t,n),o=s.decode(i);return{value:o,remainderPath:""}};return s}));return n(t)},Mz=Wj((e=>{async function*t(t,n={}){const r=new AbortController,s=hz(r.signal,n.signal),{headers:i,body:o}=await lz(t,r,n.headers),a=await e.post("dag/import",{signal:s,headers:i,body:o,searchParams:Qj({"pin-roots":n.pinRoots})});for await(const{Root:e}of a.ndjson())if(void 0!==e){const{Cid:{"/":t},PinErrorMsg:n}=e;yield{root:{cid:Lt.parse(t),pinErrorMsg:n}}}}return t})),Bz=(e,t)=>{const n=Wj((t=>{const n=async(n,r={})=>{const s={storeCodec:"dag-cbor",hashAlg:"sha2-256",...r};let i;if(s.inputCodec){if(!(n instanceof Uint8Array))throw new Error("Can only inputCodec on raw bytes that can be decoded");i=n}else{const t=await e.getCodec(s.storeCodec);i=t.encode(n),s.inputCodec=s.storeCodec}const o=new AbortController,a=hz(o.signal,s.signal),c=await t.post("dag/put",{timeout:s.timeout,signal:a,searchParams:Qj(s),...await lz([i],o,s.headers)}),l=await c.json();return Lt.parse(l.Cid["/"])};return n}));return n(t)},Uz=Wj((e=>{const t=async(t,n={})=>{const r=await e.post("dag/resolve",{signal:n.signal,searchParams:Qj({arg:`${t}${n.path?`/${n.path}`.replace(/\/[/]+/g,"/"):""}`,...n}),headers:n.headers}),s=await r.json();return{cid:Lt.parse(s.Cid["/"]),remainderPath:s.RemPath}};return t}));function Vz(e,t){return{export:Dz(t),get:Lz(e,t),import:Mz(t),put:Bz(e,t),resolve:Uz(t)}}const Fz=0,jz=1,zz=2,$z=3,Hz=4,Kz=5,qz=6,Gz=7,Wz=e=>{if(e.Type===Fz)return{name:"SENDING_QUERY",type:e.Type};if(e.Type===jz)return{from:Fu(e.ID),name:"PEER_RESPONSE",type:e.Type,messageType:0,messageName:"PUT_VALUE",closer:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:Fu(e),multiaddrs:t.map((e=>dc(e))),protocols:[]}))),providers:(e.Responses||[]).map((({ID:e,Addrs:t})=>({id:Fu(e),multiaddrs:t.map((e=>dc(e))),protocols:[]})))};if(e.Type===zz){let t={id:e.ID??Fu(e.ID),multiaddrs:[],protocols:[]};return e.Responses&&e.Responses.length&&(t={id:Fu(e.Responses[0].ID),multiaddrs:e.Responses[0].Addrs.map((e=>dc(e))),protocols:[]}),{name:"FINAL_PEER",type:e.Type,peer:t}}if(e.Type===$z)return{name:"QUERY_ERROR",type:e.Type,error:new Error(e.Extra)};if(e.Type===Hz)return{name:"PROVIDER",type:e.Type,providers:e.Responses.map((({ID:e,Addrs:t})=>({id:Fu(e),multiaddrs:t.map((e=>dc(e))),protocols:[]})))};if(e.Type===Kz)return{name:"VALUE",type:e.Type,value:$o(e.Extra,"base64pad")};if(e.Type===qz){const t=e.Responses.map((({ID:e})=>Fu(e)));if(!t.length)throw new Error("No peer found");return{name:"ADDING_PEER",type:e.Type,peer:t[0]}}if(e.Type===Gz)return{name:"DIALING_PEER",type:e.Type,peer:Fu(e.ID)};throw new Error("Unknown DHT event type")},Yz=Wj((e=>{async function*t(t,n={}){const r=await e.post("dht/findpeer",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers});for await(const e of r.ndjson())yield Wz(e)}return t})),Jz=Wj((e=>{async function*t(t,n={}){const r=await e.post("dht/findprovs",{signal:n.signal,searchParams:Qj({arg:t.toString(),...n}),headers:n.headers});for await(const e of r.ndjson())yield Wz(e)}return t})),Qz=Wj((e=>{async function*t(t,n={}){const r=await e.post("dht/get",{signal:n.signal,searchParams:Qj({arg:t instanceof Uint8Array?ia(t):t.toString(),...n}),headers:n.headers});for await(const e of r.ndjson())yield Wz(e)}return t})),Xz=Wj((e=>{async function*t(t,n={recursive:!1}){const r=Array.isArray(t)?t:[t],s=await e.post("dht/provide",{signal:n.signal,searchParams:Qj({arg:r.map((e=>e.toString())),...n}),headers:n.headers});for await(const e of s.ndjson())yield Wz(e)}return t})),Zz=Wj((e=>{async function*t(t,n,r={}){const s=new AbortController,i=hz(s.signal,r.signal),o=await e.post("dht/put",{signal:i,searchParams:Qj({arg:t instanceof Uint8Array?ia(t):t.toString(),...r}),...await lz([n],s,r.headers)});for await(const e of o.ndjson())yield Wz(e)}return t})),e$=Wj((e=>{async function*t(t,n={}){const r=await e.post("dht/query",{signal:n.signal,searchParams:Qj({arg:t.toString(),...n}),headers:n.headers});for await(const e of r.ndjson())yield Wz(e)}return t}));function t$(e){return{findPeer:Yz(e),findProvs:Jz(e),get:Qz(e),provide:Xz(e),put:Zz(e),query:e$(e)}}const n$=Wj((e=>{async function t(t={}){const n=await e.post("diag/cmds",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return n.json()}return t})),r$=Wj((e=>{async function t(t={}){const n=await e.post("diag/net",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return n.json()}return t})),s$=Wj((e=>{async function t(t={}){const n=await e.post("diag/sys",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return n.json()}return t}));function i$(e){return{cmds:n$(e),net:r$(e),sys:s$(e)}}const o$=Wj((e=>{async function t(t,n,r={}){const s=await e.post("files/chmod",{signal:r.signal,searchParams:Qj({arg:t,mode:n,...r}),headers:r.headers});await s.text()}return t})),a$=Wj((e=>{async function t(t,n,r={}){const s=Array.isArray(t)?t:[t],i=await e.post("files/cp",{signal:r.signal,searchParams:Qj({arg:s.concat(n).map((e=>Lt.asCID(e)?`/ipfs/${e}`:e)),...r}),headers:r.headers});await i.text()}return t})),c$=Wj((e=>{async function t(t,n={}){if(!t||"string"!==typeof t)throw new Error("ipfs.files.flush requires a path");const r=await e.post("files/flush",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return Lt.parse(s.Cid)}return t}));function l$(e){const t=kz(e);return Object.prototype.hasOwnProperty.call(t,"mode")&&(t.mode=parseInt(t.mode,8)),Object.prototype.hasOwnProperty.call(t,"mtime")&&(t.mtime={secs:t.mtime,nsecs:t.mtimeNsecs||0},delete t.mtimeNsecs),t}const u$=Wj((e=>{async function*t(t,n={}){if(!t)throw new Error("ipfs.files.ls requires a path");const r=await e.post("files/ls",{signal:n.signal,searchParams:Qj({arg:Lt.asCID(t)?`/ipfs/${t}`:t,long:!0,...n,stream:!0}),headers:n.headers});for await(const e of r.ndjson())if("Entries"in e)for(const t of e.Entries||[])yield h$(l$(t));else yield h$(l$(e))}return t}));function h$(e){return e.hash&&(e.cid=Lt.parse(e.hash)),delete e.hash,e.type=1===e.type?"directory":"file",e}const d$=Wj((e=>{async function t(t,n={}){const r=await e.post("files/mkdir",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers});await r.text()}return t})),p$=Wj((e=>{async function t(t,n,r={}){Array.isArray(t)||(t=[t]);const s=await e.post("files/mv",{signal:r.signal,searchParams:Qj({arg:t.concat(n),...r}),headers:r.headers});await s.text()}return t}));var f$=n(1128);const g$=Wj((e=>{async function*t(t,n={}){const r=await e.post("files/read",{signal:n.signal,searchParams:Qj({arg:t,count:n.length,...n}),headers:n.headers});yield*f$(r.body)}return t})),m$=Wj((e=>{async function t(t,n={}){const r=await e.post("files/rm",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.text();if(""!==s){const e=new wu.HTTPError(r);throw e.message=s,e}}return t})),y$=Wj((e=>{async function t(t,n={}){const r=await e.post("files/stat",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return s.WithLocality=s.WithLocality||!1,w$(l$(s))}return t}));function w$(e){return e.cid=Lt.parse(e.hash),delete e.hash,e}const b$=Wj((e=>{async function t(t,n={}){const r=await e.post("files/touch",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers});await r.text()}return t})),v$=Wj((e=>{async function t(t,n,r={}){const s=new AbortController,i=hz(s.signal,r.signal),o=await e.post("files/write",{signal:i,searchParams:Qj({arg:t,streamChannels:!0,count:r.length,...r}),...await lz([{content:n,path:"arg",mode:Yj(r.mode),mtime:Jj(r.mtime)}],s,r.headers)});await o.text()}return t}));function E$(e){return{chmod:o$(e),cp:a$(e),flush:c$(e),ls:u$(e),mkdir:d$(e),mv:p$(e),read:g$(e),rm:m$(e),stat:y$(e),touch:b$(e),write:v$(e)}}const _$=Wj((e=>{const t=async(e,t,n={})=>{throw je(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};return t})),S$=Wj((e=>{async function t(t,n={type:"Ed25519"}){const r=await e.post("key/gen",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return kz(s)}return t})),k$=Wj((e=>{async function t(t,n,r,s={}){const i=await e.post("key/import",{signal:s.signal,searchParams:Qj({arg:t,pem:n,password:r,...s}),headers:s.headers}),o=await i.json();return kz(o)}return t})),A$=Wj((e=>{const t=async(e,t={})=>{throw je(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};return t})),T$=Wj((e=>{async function t(t={}){const n=await e.post("key/list",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),r=await n.json();return(r.Keys||[]).map((e=>kz(e)))}return t})),C$=Wj((e=>{async function t(t,n,r={}){const s=await e.post("key/rename",{signal:r.signal,searchParams:Qj({arg:[t,n],...r}),headers:r.headers});return kz(await s.json())}return t})),I$=Wj((e=>{async function t(t,n={}){const r=await e.post("key/rm",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return kz(s.Keys[0])}return t}));function R$(e){return{export:_$(e),gen:S$(e),import:k$(e),info:A$(e),list:T$(e),rename:C$(e),rm:I$(e)}}const O$=Wj((e=>{async function t(t,n,r={}){const s=await e.post("log/level",{signal:r.signal,searchParams:Qj({arg:[t,n],...r}),headers:r.headers});return kz(await s.json())}return t})),x$=Wj((e=>{async function t(t={}){const n=await e.post("log/ls",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),r=await n.json();return r.Strings}return t})),N$=Wj((e=>{async function*t(t={}){const n=await e.post("log/tail",{signal:t.signal,searchParams:Qj(t),headers:t.headers});yield*n.ndjson()}return t}));function D$(e){return{level:O$(e),ls:x$(e),tail:N$(e)}}const P$=Wj((e=>{async function t(t,n={}){const r=await e.post("name/publish",{signal:n.signal,searchParams:Qj({arg:`${t}`,...n}),headers:n.headers});return kz(await r.json())}return t})),L$=Wj((e=>{async function*t(t,n={}){const r=await e.post("name/resolve",{signal:n.signal,searchParams:Qj({arg:t,stream:!0,...n}),headers:n.headers});for await(const e of r.ndjson())yield e.Path}return t})),M$=Wj((e=>{async function t(t,n={}){const r=await e.post("name/pubsub/cancel",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers});return kz(await r.json())}return t})),B$=Wj((e=>{async function t(t={}){const n=await e.post("name/pubsub/state",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return kz(await n.json())}return t})),U$=Wj((e=>{async function t(t={}){const n=await e.post("name/pubsub/subs",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),r=await n.json();return r.Strings||[]}return t}));function V$(e){return{cancel:M$(e),state:B$(e),subs:U$(e)}}function F$(e){return{publish:P$(e),resolve:L$(e),pubsub:V$(e)}}const j$=Wj((e=>{async function t(t,n={}){const r=await e.post("object/data",{signal:n.signal,searchParams:Qj({arg:`${t instanceof Uint8Array?Lt.decode(t):t}`,...n}),headers:n.headers}),s=await r.arrayBuffer();return new Uint8Array(s,0,s.byteLength)}return t})),z$=Wj((e=>{async function t(t,n={}){const r=await e.post("object/get",{signal:n.signal,searchParams:Qj({arg:`${t instanceof Uint8Array?Lt.decode(t):t}`,dataEncoding:"base64",...n}),headers:n.headers}),s=await r.json();return{Data:$o(s.Data,"base64pad"),Links:(s.Links||[]).map((e=>({Name:e.Name,Hash:Lt.parse(e.Hash),Tsize:e.Size})))}}return t})),$$=Wj((e=>{async function t(t,n={}){const r=await e.post("object/links",{signal:n.signal,searchParams:Qj({arg:`${t instanceof Uint8Array?Lt.decode(t):t}`,...n}),headers:n.headers}),s=await r.json();return(s.Links||[]).map((e=>({Name:e.Name,Tsize:e.Size,Hash:Lt.parse(e.Hash)})))}return t})),H$=Wj((e=>{async function t(t={}){const n=await e.post("object/new",{signal:t.signal,searchParams:Qj({arg:t.template,...t}),headers:t.headers}),{Hash:r}=await n.json();return Lt.parse(r)}return t})),K$=(e,t)=>{const n=Wj((n=>{const r=Bz(e,t);async function s(e,t={}){return r(e,{...t,storeCodec:"dag-pb",hashAlg:"sha2-256",version:1})}return s}));return n(t)},q$=Wj((e=>{async function t(t,n={}){const r=await e.post("object/stat",{signal:n.signal,searchParams:Qj({arg:`${t}`,...n}),headers:n.headers}),s=await r.json();return{...s,Hash:Lt.parse(s.Hash)}}return t})),G$=Wj((e=>{async function t(t,n,r={}){const s=await e.post("object/patch/add-link",{signal:r.signal,searchParams:Qj({arg:[`${t}`,n.Name||n.name||"",(n.Hash||n.cid||"").toString()||null],...r}),headers:r.headers}),{Hash:i}=await s.json();return Lt.parse(i)}return t})),W$=Wj((e=>{async function t(t,n,r={}){const s=new AbortController,i=hz(s.signal,r.signal),o=await e.post("object/patch/append-data",{signal:i,searchParams:Qj({arg:`${t}`,...r}),...await lz([n],s,r.headers)}),{Hash:a}=await o.json();return Lt.parse(a)}return t})),Y$=Wj((e=>{async function t(t,n,r={}){const s=await e.post("object/patch/rm-link",{signal:r.signal,searchParams:Qj({arg:[`${t}`,n.Name||n.name||null],...r}),headers:r.headers}),{Hash:i}=await s.json();return Lt.parse(i)}return t})),J$=Wj((e=>{async function t(t,n,r={}){const s=new AbortController,i=hz(s.signal,r.signal),o=await e.post("object/patch/set-data",{signal:i,searchParams:Qj({arg:[`${t}`],...r}),...await lz([n],s,r.headers)}),{Hash:a}=await o.json();return Lt.parse(a)}return t}));function Q$(e){return{addLink:G$(e),appendData:W$(e),rmLink:Y$(e),setData:J$(e)}}function X$(e,t){return{data:j$(t),get:z$(t),links:$$(t),new:H$(t),put:K$(e,t),stat:q$(t),patch:Q$(t)}}const Z$=Wj((e=>{async function*t(t,n={}){for await(const{path:r,recursive:s,metadata:i}of Wu(t)){const t=await e.post("pin/add",{signal:n.signal,searchParams:Qj({...n,arg:r,recursive:s,metadata:i?JSON.stringify(i):void 0,stream:!0}),headers:n.headers});for await(const e of t.ndjson())if(e.Pins)for(const t of e.Pins)yield Lt.parse(t);else yield Lt.parse(e)}}return t}));function eH(e){const t=Z$(e);return Wj((()=>{async function e(e,n={}){return qu(t([{path:e,...n}],n))}return e}))(e)}function tH(e,t,n){const r={type:e,cid:Lt.parse(t)};return n&&(r.metadata=n),r}const nH=Wj((e=>{async function*t(t={}){let n=[];t.paths&&(n=Array.isArray(t.paths)?t.paths:[t.paths]);const r=await e.post("pin/ls",{signal:t.signal,searchParams:Qj({...t,arg:n.map((e=>`${e}`)),stream:!0}),headers:t.headers});for await(const e of r.ndjson()){if(e.Keys){for(const t of Object.keys(e.Keys))yield tH(e.Keys[t].Type,t,e.Keys[t].Metadata);return}yield tH(e.Type,e.Cid,e.Metadata)}}return t})),rH=Wj((e=>{async function*t(t,n={}){for await(const{path:r,recursive:s}of Wu(t)){const t=new URLSearchParams(n.searchParams);t.append("arg",`${r}`),null!=s&&t.set("recursive",String(s));const i=await e.post("pin/rm",{signal:n.signal,headers:n.headers,searchParams:Qj({...n,arg:`${r}`,recursive:s})});for await(const e of i.ndjson())e.Pins?yield*e.Pins.map((e=>Lt.parse(e))):yield Lt.parse(e)}}return t})),sH=e=>{const t=rH(e);return Wj((()=>{async function e(e,n={}){return qu(t([{path:e,...n}],n))}return e}))(e)},iH=({Name:e,Status:t,Cid:n})=>({cid:Lt.parse(n),name:e,status:t}),oH=e=>{if("string"===typeof e&&""!==e)return e;throw new TypeError("service name must be passed")},aH=e=>{if(Lt.asCID(e))return e.toString();throw new TypeError("CID instance expected instead of "+typeof e)},cH=({service:e,cid:t,name:n,status:r,all:s})=>{const i=Qj({service:oH(e),name:n,force:!!s||void 0});if(t)for(const o of t)i.append("cid",aH(o));if(r)for(const o of r)i.append("status",o);return i},lH=({cid:e,service:t,background:n,name:r,origins:s})=>{const i=Qj({arg:aH(e),service:oH(t),name:r,background:!!n||void 0});if(s)for(const o of s)i.append("origin",o.toString());return i};function uH(e){async function t(t,{timeout:n,signal:r,headers:s,...i}){const o=await e.post("pin/remote/add",{timeout:n,signal:r,headers:s,searchParams:lH({cid:t,...i})});return iH(await o.json())}return t}function hH(e){async function*t({timeout:t,signal:n,headers:r,...s}){const i=await e.post("pin/remote/ls",{timeout:t,signal:n,headers:r,searchParams:cH(s)});for await(const e of i.ndjson())yield iH(e)}return t}function dH(e){async function t({timeout:t,signal:n,headers:r,...s}){await e.post("pin/remote/rm",{timeout:t,signal:n,headers:r,searchParams:cH({...s,all:!1})})}return t}function pH(e){async function t({timeout:t,signal:n,headers:r,...s}){await e.post("pin/remote/rm",{timeout:t,signal:n,headers:r,searchParams:cH({...s,all:!0})})}return t}function fH(e){const t=String(e);if("undefined"===t)throw Error("endpoint is required");return"/"===t[t.length-1]?t.slice(0,-1):t}function gH(e){return{service:e.Service,endpoint:new URL(e.ApiEndpoint),...e.Stat&&{stat:mH(e.Stat)}}}function mH(e){switch(e.Status){case"valid":{const{Pinning:t,Pinned:n,Queued:r,Failed:s}=e.PinCount;return{status:"valid",pinCount:{queued:r,pinning:t,pinned:n,failed:s}}}case"invalid":return{status:"invalid"};default:return{status:e.Status}}}function yH(e){async function t(t,n){const{endpoint:r,key:s,headers:i,timeout:o,signal:a}=n;await e.post("pin/remote/service/add",{timeout:o,signal:a,searchParams:Qj({arg:[t,fH(r),s]}),headers:i})}return t}function wH(e){async function t(t={}){const{stat:n,headers:r,timeout:s,signal:i}=t,o=await e.post("pin/remote/service/ls",{timeout:s,signal:i,headers:r,searchParams:!0===n?Qj({stat:n}):void 0}),{RemoteServices:a}=await o.json();return a.map(gH)}return t}function bH(e){async function t(t,n={}){await e.post("pin/remote/service/rm",{signal:n.signal,headers:n.headers,searchParams:Qj({arg:t})})}return t}function vH(e){const t=new Gj(e);return{add:yH(t),ls:wH(t),rm:bH(t)}}function EH(e){const t=new Gj(e);return{add:uH(t),ls:hH(t),rm:dH(t),rmAll:pH(t),service:vH(e)}}function _H(e){return{addAll:Z$(e),add:eH(e),ls:nH(e),rmAll:rH(e),rm:sH(e),remote:EH(e)}}const SH=e=>Array.isArray(e)?e.map(kH):e,kH=e=>ia(AH(e)),AH=e=>Ue.decode(e),TH=e=>BigInt(`0x${ia(Ue.decode(e),"base16")}`),CH=e=>Ue.encode($o(e)),IH=Wj((e=>{async function t(t={}){const{Strings:n}=await(await e.post("pubsub/ls",{signal:t.signal,searchParams:Qj(t),headers:t.headers})).json();return SH(n)||[]}return t})),RH=Wj((e=>{async function t(t,n={}){const r=await e.post("pubsub/peers",{signal:n.signal,searchParams:Qj({arg:CH(t),...n}),headers:n.headers}),{Strings:s}=await r.json();return s||[]}return t})),OH=Wj((e=>{async function t(t,n,r={}){const s=Qj({arg:CH(t),...r}),i=new AbortController,o=hz(i.signal,r.signal),a=await e.post("pubsub/pub",{signal:o,searchParams:s,...await lz([n],i,r.headers)});await a.text()}return t})),xH=Fe("ipfs-http-client:pubsub:subscribe"),NH=(e,t)=>Wj((e=>{async function n(n,r,s={}){let i,o;s.signal=t.subscribe(n,r,s.signal);const a=new Promise(((e,t)=>{i=e,o=t})),c=setTimeout((()=>i()),1e3);return e.post("pubsub/sub",{signal:s.signal,searchParams:Qj({arg:CH(n),...s}),headers:s.headers}).catch((e=>{t.unsubscribe(n,r),o(e)})).then((e=>{clearTimeout(c),e&&(DH(e,{onMessage:e=>{r&&("function"!==typeof r?"function"===typeof r.handleEvent&&r.handleEvent(e):r(e))},onEnd:()=>t.unsubscribe(n,r),onError:s.onError}),i())})),a}return n}))(e);async function DH(e,{onMessage:t,onEnd:n,onError:r}){r=r||xH;try{for await(const n of e.ndjson())try{if(!n.from)continue;null!=n.from&&null!=n.seqno?t({type:"signed",from:Fu(n.from),data:AH(n.data),sequenceNumber:TH(n.seqno),topic:kH(n.topicIDs[0]),key:AH(n.key??"u"),signature:AH(n.signature??"u")}):t({type:"unsigned",data:AH(n.data),topic:kH(n.topicIDs[0])})}catch(uS){uS.message=`Failed to parse pubsub message: ${uS.message}`,r(uS,!1,n)}}catch(uS){PH(uS)||r(uS,!0)}finally{n()}}const PH=e=>{switch(e.type){case"aborted":return!0;case"abort":return!0;default:return"AbortError"===e.name}},LH=(e,t)=>{async function n(e,n){t.unsubscribe(e,n)}return n};class MH{constructor(){this._subs=new Map}subscribe(e,t,n){const r=this._subs.get(e)||[];if(r.find((e=>e.handler===t)))throw new Error(`Already subscribed to ${e} with this handler`);const s=new AbortController;return this._subs.set(e,[{handler:t,controller:s}].concat(r)),n&&n.addEventListener("abort",(()=>this.unsubscribe(e,t))),s.signal}unsubscribe(e,t){const n=this._subs.get(e)||[];let r;t?(this._subs.set(e,n.filter((e=>e.handler!==t))),r=n.filter((e=>e.handler===t))):(this._subs.set(e,[]),r=n),(this._subs.get(e)||[]).length||this._subs.delete(e),r.forEach((e=>e.controller.abort()))}}function BH(e){const t=new MH;return{ls:IH(e),peers:RH(e),publish:OH(e),subscribe:NH(e,t),unsubscribe:LH(e,t)}}const UH=Wj((e=>{async function*t(t={}){const n=await e.post("refs/local",{signal:t.signal,transform:kz,searchParams:Qj(t),headers:t.headers});yield*n.ndjson()}return t})),VH=Wj(((e,t)=>{const n=async function*(t,n={}){const r=Array.isArray(t)?t:[t],s=await e.post("refs",{signal:n.signal,searchParams:Qj({arg:r.map((e=>`${e instanceof Uint8Array?Lt.decode(e):e}`)),...n}),headers:n.headers,transform:kz});yield*s.ndjson()};return Object.assign(n,{local:UH(t)})})),FH=Wj((e=>{async function*t(t={}){const n=await e.post("repo/gc",{signal:t.signal,searchParams:Qj(t),headers:t.headers,transform:e=>({err:e.Error?new Error(e.Error):null,cid:(e.Key||{})["/"]?Lt.parse(e.Key["/"]):null})});yield*n.ndjson()}return t})),jH=Wj((e=>{async function t(t={}){const n=await e.post("repo/stat",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),r=await n.json();return{numObjects:BigInt(r.NumObjects),repoSize:BigInt(r.RepoSize),repoPath:r.RepoPath,version:r.Version,storageMax:BigInt(r.StorageMax)}}return t})),zH=Wj((e=>{async function t(t={}){const n=await(await e.post("repo/version",{signal:t.signal,searchParams:Qj(t),headers:t.headers})).json();return n.Version}return t}));function $H(e){return{gc:FH(e),stat:jH(e),version:zH(e)}}const HH=Wj((e=>{async function*t(t={}){const n=await e.post("stats/bw",{signal:t.signal,searchParams:Qj(t),headers:t.headers,transform:e=>({totalIn:BigInt(e.TotalIn),totalOut:BigInt(e.TotalOut),rateIn:parseFloat(e.RateIn),rateOut:parseFloat(e.RateOut)})});yield*n.ndjson()}return t}));function KH(e){return{bitswap:ez(e),repo:jH(e),bw:HH(e)}}const qH=Wj((e=>{async function t(t={}){const n=await e.post("swarm/addrs",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),{Addrs:r}=await n.json();return Object.keys(r).map((e=>({id:Fu(e),addrs:(r[e]||[]).map((e=>dc(e)))})))}return t})),GH=Wj((e=>{async function t(t,n={}){const r=await e.post("swarm/connect",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),{Strings:s}=await r.json();return s||[]}return t})),WH=Wj((e=>{async function t(t,n={}){const r=await e.post("swarm/disconnect",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),{Strings:s}=await r.json();return s||[]}return t})),YH=Wj((e=>{async function t(t={}){const n=await e.post("swarm/addrs/local",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),{Strings:r}=await n.json();return(r||[]).map((e=>dc(e)))}return t})),JH=Wj((e=>{async function t(t={}){const n=await e.post("swarm/peers",{signal:t.signal,searchParams:Qj(t),headers:t.headers}),{Peers:r}=await n.json();return(r||[]).map((e=>({addr:dc(e.Addr),peer:Fu(e.Peer),muxer:e.Muxer,latency:e.Latency,streams:e.Streams,direction:null==e.Direction?void 0:0===e.Direction?"inbound":"outbound"})))}return t}));function QH(e){return{addrs:qH(e),connect:GH(e),disconnect:WH(e),localAddrs:YH(e),peers:JH(e)}}const XH=Wj((e=>{async function*t(t,n={}){const r=new AbortController,s=hz(r.signal,n.signal),{headers:i,body:o,total:a,parts:c}=await lz(t,r,n.headers),[l,u]="function"===typeof n.progress?ZH(a,c,n.progress):[void 0,void 0],h=await e.post("add",{searchParams:Qj({"stream-channels":!0,...n,progress:Boolean(l)}),onUploadProgress:u,signal:s,headers:i,body:o});for await(let e of h.ndjson())e=kz(e),void 0!==e.hash?yield tK(e):l&&l(e.bytes||0,e.name)}return t})),ZH=(e,t,n)=>t?[void 0,eK(e,t,n)]:[n,void 0],eK=(e,t,n)=>{let r=0;const s=t.length;return({loaded:i,total:o})=>{const a=Math.floor(i/o*e);while(r<s){const{start:e,end:s,name:i}=t[r];if(a<s){n(a-e,i);break}n(s-e,i),r+=1}}};function tK({name:e,hash:t,size:n,mode:r,mtime:s,mtimeNsecs:i}){const o={path:e,cid:Lt.parse(t),size:parseInt(n)};return null!=r&&(o.mode=parseInt(r,8)),null!=s&&(o.mtime={secs:s,nsecs:i||0}),o}function nK(e){const t=XH(e);return Wj((()=>{async function e(e,n={}){return await qu(t(qy(e),n))}return e}))(e)}const rK=Wj((e=>{async function*t(t,n={}){const r=await e.post("cat",{signal:n.signal,searchParams:Qj({arg:t.toString(),...n}),headers:n.headers});yield*r.iterator()}return t})),sK=Wj((e=>{const t=async(t={})=>{const n=await e.post("commands",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return n.json()};return t})),iK=Wj((e=>{const t=async(t,n={})=>{const r=await e.post("dns",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),s=await r.json();return s.Path};return t})),oK=Wj((e=>()=>{const t=new URL(e.opts.base||"");return{host:t.hostname,port:t.port,protocol:t.protocol,pathname:t.pathname,"api-path":t.pathname}})),aK=Wj((e=>{async function*t(t,n={}){const r={arg:`${t instanceof Uint8Array?Lt.decode(t):t}`,...n};r.compressionLevel&&(r["compression-level"]=r.compressionLevel,delete r.compressionLevel);const s=await e.post("get",{signal:n.signal,searchParams:Qj(r),headers:n.headers});yield*s.iterator()}return t})),cK=Wj((e=>{async function t(t={}){const n=await e.post("id",{signal:t.signal,searchParams:Qj({arg:t.peerId?t.peerId.toString():void 0,...t}),headers:t.headers}),r=await n.json(),s={...kz(r)};return s.id=Fu(s.id),s.addresses&&(s.addresses=s.addresses.map((e=>dc(e)))),s}return t})),lK=e=>{const t=cK(e);async function n(e={}){const n=await t(e);return Boolean(n&&n.addresses&&n.addresses.length)}return n},uK=Wj(((e,t)=>{async function*n(n,r={}){const s=`${n instanceof Uint8Array?Lt.decode(n):n}`;async function i(e){let n=e.Hash;if(n.includes("/")){const e=n.startsWith("/ipfs/")?n:`/ipfs/${n}`,r=await y$(t)(e);n=r.cid}else n=Lt.parse(n);const r={name:e.Name,path:s+(e.Name?`/${e.Name}`:""),size:e.Size,cid:n,type:hK(e)};return e.Mode&&(r.mode=parseInt(e.Mode,8)),void 0!==e.Mtime&&null!==e.Mtime&&(r.mtime={secs:e.Mtime},void 0!==e.MtimeNsecs&&null!==e.MtimeNsecs&&(r.mtime.nsecs=e.MtimeNsecs)),r}const o=await e.post("ls",{signal:r.signal,searchParams:Qj({arg:s,...r}),headers:r.headers});for await(let e of o.ndjson()){if(e=e.Objects,!e)throw new Error("expected .Objects in results");if(e=e[0],!e)throw new Error("expected one array in results.Objects");const t=e.Links;if(!Array.isArray(t))throw new Error("expected one array in results.Objects[0].Links");if(!t.length)return void(yield i(e));yield*t.map(i)}}return n}));function hK(e){switch(e.Type){case 1:case 5:return"dir";case 2:return"file";default:return"file"}}const dK=Wj((e=>{async function t(t={}){const n=await e.post("dns",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return kz(await n.json())}return t})),pK=Wj((e=>{async function*t(t,n={}){const r=await e.post("ping",{signal:n.signal,searchParams:Qj({arg:`${t}`,...n}),headers:n.headers,transform:kz});yield*r.ndjson()}return t})),fK=Wj((e=>{async function t(t,n={}){const r=await e.post("resolve",{signal:n.signal,searchParams:Qj({arg:t,...n}),headers:n.headers}),{Path:s}=await r.json();return s}return t})),gK=Wj((e=>{const t=async(e={})=>{throw je(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};return t})),mK=Wj((e=>{async function t(t={}){const n=await e.post("shutdown",{signal:t.signal,searchParams:Qj(t),headers:t.headers});await n.text()}return t})),yK=Wj((e=>{async function t(t={}){const n=await e.post("version",{signal:t.signal,searchParams:Qj(t),headers:t.headers});return{...kz(await n.json()),"ipfs-http-client":"1.0.0"}}return t}));n(4701),n(1819);function wK(e={}){const t={name:Yi.name,code:Yi.code,encode:e=>e,decode:e=>e},n=Object.values(ko);(e.ipld&&e.ipld.bases?e.ipld.bases:[]).forEach((e=>n.push(e)));const r=new Oj({bases:n,loadBase:e.ipld&&e.ipld.loadBase}),s=Object.values(To);[o,a,c,l,t].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>s.push(e)));const i=new Nj({codecs:s,loadCodec:e.ipld&&e.ipld.loadCodec}),u=Object.values(Ao);(e.ipld&&e.ipld.hashers?e.ipld.hashers:[]).forEach((e=>u.push(e)));const h=new Pj({hashers:u,loadHasher:e.ipld&&e.ipld.loadHasher}),d={add:nK(e),addAll:XH(e),bitswap:rz(e),block:mz(e),bootstrap:_z(e),cat:rK(e),commands:sK(e),config:Nz(e),dag:Vz(i,e),dht:t$(e),diag:i$(e),dns:iK(e),files:E$(e),get:aK(e),getEndpointConfig:oK(e),id:cK(e),isOnline:lK(e),key:R$(e),log:D$(e),ls:uK(e),mount:dK(e),name:F$(e),object:X$(i,e),pin:_H(e),ping:pK(e),pubsub:BH(e),refs:VH(e),repo:$H(e),resolve:fK(e),start:gK(e),stats:KH(e),stop:mK(e),swarm:QH(e),version:yK(e),bases:r,codecs:i,hashers:h};return d}const bK=421,vK=290,EK=2e3,_K=Object.create(null);_K["open"]="0",_K["close"]="1",_K["ping"]="2",_K["pong"]="3",_K["message"]="4",_K["upgrade"]="5",_K["noop"]="6";const SK=Object.create(null);Object.keys(_K).forEach((e=>{SK[_K[e]]=e}));const kK={type:"error",data:"parser error"},AK="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),TK="function"===typeof ArrayBuffer,CK=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,IK=({type:e,data:t},n,r)=>AK&&t instanceof Blob?n?r(t):RK(t,r):TK&&(t instanceof ArrayBuffer||CK(t))?n?r(t):RK(new Blob([t]),r):r(_K[e]+(t||"")),RK=(e,t)=>{const n=new FileReader;return n.onload=function(){const e=n.result.split(",")[1];t("b"+e)},n.readAsDataURL(e)};var OK=IK;const xK="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",NK="undefined"===typeof Uint8Array?[]:new Uint8Array(256);for(let K6=0;K6<xK.length;K6++)NK[xK.charCodeAt(K6)]=K6;const DK=e=>{let t,n,r,s,i,o=.75*e.length,a=e.length,c=0;"="===e[e.length-1]&&(o--,"="===e[e.length-2]&&o--);const l=new ArrayBuffer(o),u=new Uint8Array(l);for(t=0;t<a;t+=4)n=NK[e.charCodeAt(t)],r=NK[e.charCodeAt(t+1)],s=NK[e.charCodeAt(t+2)],i=NK[e.charCodeAt(t+3)],u[c++]=n<<2|r>>4,u[c++]=(15&r)<<4|s>>2,u[c++]=(3&s)<<6|63&i;return l},PK="function"===typeof ArrayBuffer,LK=(e,t)=>{if("string"!==typeof e)return{type:"message",data:BK(e,t)};const n=e.charAt(0);if("b"===n)return{type:"message",data:MK(e.substring(1),t)};const r=SK[n];return r?e.length>1?{type:SK[n],data:e.substring(1)}:{type:SK[n]}:kK},MK=(e,t)=>{if(PK){const n=DK(e);return BK(n,t)}return{base64:!0,data:e}},BK=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}};var UK=LK;const VK=String.fromCharCode(30),FK=(e,t)=>{const n=e.length,r=new Array(n);let s=0;e.forEach(((e,i)=>{OK(e,!1,(e=>{r[i]=e,++s===n&&t(r.join(VK))}))}))},jK=(e,t)=>{const n=e.split(VK),r=[];for(let s=0;s<n.length;s++){const e=UK(n[s],t);if(r.push(e),"error"===e.type)break}return r},zK=4;function $K(e){if(e)return HK(e)}function HK(e){for(var t in $K.prototype)e[t]=$K.prototype[t];return e}$K.prototype.on=$K.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},$K.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this},$K.prototype.off=$K.prototype.removeListener=$K.prototype.removeAllListeners=$K.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+e];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var s=0;s<r.length;s++)if(n=r[s],n===t||n.fn===t){r.splice(s,1);break}return 0===r.length&&delete this._callbacks["$"+e],this},$K.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(n){n=n.slice(0);r=0;for(var s=n.length;r<s;++r)n[r].apply(this,t)}return this},$K.prototype.emitReserved=$K.prototype.emit,$K.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},$K.prototype.hasListeners=function(e){return!!this.listeners(e).length};const KK=(()=>"undefined"!==typeof self?self:"undefined"!==typeof window?window:Function("return this")())();function qK(e,...t){return t.reduce(((t,n)=>(e.hasOwnProperty(n)&&(t[n]=e[n]),t)),{})}const GK=setTimeout,WK=clearTimeout;function YK(e,t){t.useNativeTimers?(e.setTimeoutFn=GK.bind(KK),e.clearTimeoutFn=WK.bind(KK)):(e.setTimeoutFn=setTimeout.bind(KK),e.clearTimeoutFn=clearTimeout.bind(KK))}const JK=1.33;function QK(e){return"string"===typeof e?XK(e):Math.ceil((e.byteLength||e.size)*JK)}function XK(e){let t=0,n=0;for(let r=0,s=e.length;r<s;r++)t=e.charCodeAt(r),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(r++,n+=4);return n}class ZK extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class eq extends $K{constructor(e){super(),this.writable=!1,YK(this,e),this.opts=e,this.query=e.query,this.readyState="",this.socket=e.socket}onError(e,t,n){return super.emitReserved("error",new ZK(e,t,n)),this}open(){return"closed"!==this.readyState&&""!==this.readyState||(this.readyState="opening",this.doOpen()),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=UK(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}}const tq="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),nq=64,rq={};let sq,iq=0,oq=0;function aq(e){let t="";do{t=tq[e%nq]+t,e=Math.floor(e/nq)}while(e>0);return t}function cq(){const e=aq(+new Date);return e!==sq?(iq=0,sq=e):e+"."+aq(iq++)}for(;oq<nq;oq++)rq[tq[oq]]=oq;function lq(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function uq(e){let t={},n=e.split("&");for(let r=0,s=n.length;r<s;r++){let e=n[r].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}let hq=!1;try{hq="undefined"!==typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(uS){}const dq=hq;function pq(e){const t=e.xdomain;try{if("undefined"!==typeof XMLHttpRequest&&(!t||dq))return new XMLHttpRequest}catch(n){}if(!t)try{return new(KK[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(n){}}function fq(){}const gq=function(){const e=new pq({xdomain:!1});return null!=e.responseType}();class mq extends eq{constructor(e){if(super(e),this.polling=!1,"undefined"!==typeof location){const t="https:"===location.protocol;let n=location.port;n||(n=t?"443":"80"),this.xd="undefined"!==typeof location&&e.hostname!==location.hostname||n!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=gq&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)};jK(e,this.socket.binaryType).forEach(t),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,FK(e,(e=>{this.doWrite(e,(()=>{this.writable=!0,this.emitReserved("drain")}))}))}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let n="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=cq()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port);const r=lq(e),s=-1!==this.opts.hostname.indexOf(":");return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new yq(this.uri(),e)}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",((e,t)=>{this.onError("xhr post error",e,t)}))}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",((e,t)=>{this.onError("xhr poll error",e,t)})),this.pollXhr=e}}class yq extends $K{constructor(e,t){super(),YK(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=qK(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new pq(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(n){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(n){}try{t.setRequestHeader("Accept","*/*")}catch(n){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn((()=>{this.onError("number"===typeof t.status?t.status:0)}),0))},t.send(this.data)}catch(n){return void this.setTimeoutFn((()=>{this.onError(n)}),0)}"undefined"!==typeof document&&(this.index=yq.requestsCount++,yq.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if("undefined"!==typeof this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=fq,e)try{this.xhr.abort()}catch(t){}"undefined"!==typeof document&&delete yq.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(yq.requestsCount=0,yq.requests={},"undefined"!==typeof document)if("function"===typeof attachEvent)attachEvent("onunload",wq);else if("function"===typeof addEventListener){const e="onpagehide"in KK?"pagehide":"unload";addEventListener(e,wq,!1)}function wq(){for(let e in yq.requests)yq.requests.hasOwnProperty(e)&&yq.requests[e].abort()}const bq=(()=>{const e="function"===typeof Promise&&"function"===typeof Promise.resolve;return e?e=>Promise.resolve().then(e):(e,t)=>t(e,0)})(),vq=KK.WebSocket||KK.MozWebSocket,Eq=!0,_q="arraybuffer",Sq="undefined"!==typeof navigator&&"string"===typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class kq extends eq{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,n=Sq?{}:qK(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=Eq&&!Sq?t?new vq(e,t):new vq(e):new vq(e,t,n)}catch(uS){return this.emitReserved("error",uS)}this.ws.binaryType=this.socket.binaryType||_q,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],r=t===e.length-1;OK(n,this.supportsBinary,(e=>{const t={};if(!Eq&&(n.options&&(t.compress=n.options.compress),this.opts.perMessageDeflate)){const n="string"===typeof e?Buffer.byteLength(e):e.length;n<this.opts.perMessageDeflate.threshold&&(t.compress=!1)}try{Eq?this.ws.send(e):this.ws.send(e,t)}catch(s){}r&&bq((()=>{this.writable=!0,this.emitReserved("drain")}),this.setTimeoutFn)}))}}doClose(){"undefined"!==typeof this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let n="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(n=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=cq()),this.supportsBinary||(e.b64=1);const r=lq(e),s=-1!==this.opts.hostname.indexOf(":");return t+"://"+(s?"["+this.opts.hostname+"]":this.opts.hostname)+n+this.opts.path+(r.length?"?"+r:"")}check(){return!!vq}}const Aq={websocket:kq,polling:mq},Tq=/^(?:(?![^:@]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Cq=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Iq(e){const t=e,n=e.indexOf("["),r=e.indexOf("]");-1!=n&&-1!=r&&(e=e.substring(0,n)+e.substring(n,r).replace(/:/g,";")+e.substring(r,e.length));let s=Tq.exec(e||""),i={},o=14;while(o--)i[Cq[o]]=s[o]||"";return-1!=n&&-1!=r&&(i.source=t,i.host=i.host.substring(1,i.host.length-1).replace(/;/g,":"),i.authority=i.authority.replace("[","").replace("]","").replace(/;/g,":"),i.ipv6uri=!0),i.pathNames=Rq(i,i["path"]),i.queryKey=Oq(i,i["query"]),i}function Rq(e,t){const n=/\/{2,9}/g,r=t.replace(n,"/").split("/");return"/"!=t.slice(0,1)&&0!==t.length||r.splice(0,1),"/"==t.slice(-1)&&r.splice(r.length-1,1),r}function Oq(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,r){t&&(n[t]=r)})),n}class xq extends $K{constructor(e,t={}){super(),e&&"object"===typeof e&&(t=e,e=null),e?(e=Iq(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Iq(t.host).host),YK(this,t),this.secure=null!=t.secure?t.secure:"undefined"!==typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!==typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!==typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.readyState="",this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+"/","string"===typeof this.opts.query&&(this.opts.query=uq(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"===typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=zK,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new Aq[e](n)}open(){let e;if(this.opts.rememberUpgrade&&xq.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn((()=>{this.emitReserved("error","No transports available")}),0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(t){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",(e=>this.onClose("transport close",e)))}probe(e){let t=this.createTransport(e),n=!1;xq.priorWebsocketSuccess=!1;const r=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",(e=>{if(!n)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;xq.priorWebsocketSuccess="websocket"===t.name,this.transport.pause((()=>{n||"closed"!==this.readyState&&(l(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())}))}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}})))};function s(){n||(n=!0,l(),t.close(),t=null)}const i=e=>{const n=new Error("probe error: "+e);n.transport=t.name,s(),this.emitReserved("upgradeError",n)};function o(){i("transport closed")}function a(){i("socket closed")}function c(e){t&&e.name!==t.name&&s()}const l=()=>{t.removeListener("open",r),t.removeListener("error",i),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",r),t.once("error",i),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",xq.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade&&this.transport.pause){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn((()=>{this.onClose("ping timeout")}),this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){const e=this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1;if(!e)return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const e=this.writeBuffer[n].data;if(e&&(t+=QK(e)),n>0&&t>this.maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}write(e,t,n){return this.sendPacket("message",e,t,n),this}send(e,t,n){return this.sendPacket("message",e,t,n),this}sendPacket(e,t,n,r){if("function"===typeof t&&(r=t,t=void 0),"function"===typeof n&&(r=n,n=null),"closing"===this.readyState||"closed"===this.readyState)return;n=n||{},n.compress=!1!==n.compress;const s={type:e,data:t,options:n};this.emitReserved("packetCreate",s),this.writeBuffer.push(s),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",(()=>{this.upgrading?n():e()})):this.upgrading?n():e()),this}onError(e){xq.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"===typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}xq.protocol=zK;xq.protocol;function Nq(e,t="",n){let r=e;n=n||"undefined"!==typeof location&&location,null==e&&(e=n.protocol+"//"+n.host),"string"===typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?n.protocol+e:n.host+e),/^(https?|wss?):\/\//.test(e)||(e="undefined"!==typeof n?n.protocol+"//"+e:"https://"+e),r=Iq(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const s=-1!==r.host.indexOf(":"),i=s?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(n&&n.port===r.port?"":":"+r.port),r}const Dq="function"===typeof ArrayBuffer,Pq=e=>"function"===typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,Lq=Object.prototype.toString,Mq="function"===typeof Blob||"undefined"!==typeof Blob&&"[object BlobConstructor]"===Lq.call(Blob),Bq="function"===typeof File||"undefined"!==typeof File&&"[object FileConstructor]"===Lq.call(File);function Uq(e){return Dq&&(e instanceof ArrayBuffer||Pq(e))||Mq&&e instanceof Blob||Bq&&e instanceof File}function Vq(e,t){if(!e||"object"!==typeof e)return!1;if(Array.isArray(e)){for(let t=0,n=e.length;t<n;t++)if(Vq(e[t]))return!0;return!1}if(Uq(e))return!0;if(e.toJSON&&"function"===typeof e.toJSON&&1===arguments.length)return Vq(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Vq(e[n]))return!0;return!1}function Fq(e){const t=[],n=e.data,r=e;return r.data=jq(n,t),r.attachments=t.length,{packet:r,buffers:t}}function jq(e,t){if(!e)return e;if(Uq(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}if(Array.isArray(e)){const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=jq(e[r],t);return n}if("object"===typeof e&&!(e instanceof Date)){const n={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=jq(e[r],t));return n}return e}function zq(e,t){return e.data=$q(e.data,t),e.attachments=void 0,e}function $q(e,t){if(!e)return e;if(e&&!0===e._placeholder){const n="number"===typeof e.num&&e.num>=0&&e.num<t.length;if(n)return t[e.num];throw new Error("illegal attachments")}if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=$q(e[n],t);else if("object"===typeof e)for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=$q(e[n],t));return e}const Hq=5;var Kq;(function(e){e[e["CONNECT"]=0]="CONNECT",e[e["DISCONNECT"]=1]="DISCONNECT",e[e["EVENT"]=2]="EVENT",e[e["ACK"]=3]="ACK",e[e["CONNECT_ERROR"]=4]="CONNECT_ERROR",e[e["BINARY_EVENT"]=5]="BINARY_EVENT",e[e["BINARY_ACK"]=6]="BINARY_ACK"})(Kq||(Kq={}));class qq{constructor(e){this.replacer=e}encode(e){return e.type!==Kq.EVENT&&e.type!==Kq.ACK||!Vq(e)?[this.encodeAsString(e)]:(e.type=e.type===Kq.EVENT?Kq.BINARY_EVENT:Kq.BINARY_ACK,this.encodeAsBinary(e))}encodeAsString(e){let t=""+e.type;return e.type!==Kq.BINARY_EVENT&&e.type!==Kq.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Fq(e),n=this.encodeAsString(t.packet),r=t.buffers;return r.unshift(n),r}}class Gq extends $K{constructor(e){super(),this.reviver=e}add(e){let t;if("string"===typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e),t.type===Kq.BINARY_EVENT||t.type===Kq.BINARY_ACK?(this.reconstructor=new Wq(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Uq(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(void 0===Kq[n.type])throw new Error("unknown packet type "+n.type);if(n.type===Kq.BINARY_EVENT||n.type===Kq.BINARY_ACK){const r=t+1;while("-"!==e.charAt(++t)&&t!=e.length);const s=e.substring(r,t);if(s!=Number(s)||"-"!==e.charAt(t))throw new Error("Illegal attachments");n.attachments=Number(s)}if("/"===e.charAt(t+1)){const r=t+1;while(++t){const n=e.charAt(t);if(","===n)break;if(t===e.length)break}n.nsp=e.substring(r,t)}else n.nsp="/";const r=e.charAt(t+1);if(""!==r&&Number(r)==r){const r=t+1;while(++t){const n=e.charAt(t);if(null==n||Number(n)!=n){--t;break}if(t===e.length)break}n.id=Number(e.substring(r,t+1))}if(e.charAt(++t)){const r=this.tryParse(e.substr(t));if(!Gq.isPayloadValid(n.type,r))throw new Error("invalid payload");n.data=r}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case Kq.CONNECT:return"object"===typeof t;case Kq.DISCONNECT:return void 0===t;case Kq.CONNECT_ERROR:return"string"===typeof t||"object"===typeof t;case Kq.EVENT:case Kq.BINARY_EVENT:return Array.isArray(t)&&t.length>0;case Kq.ACK:case Kq.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&this.reconstructor.finishedReconstruction()}}class Wq{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=zq(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}function Yq(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const Jq=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Qq extends $K{constructor(e,t,n){super(),this.connected=!1,this.receiveBuffer=[],this.sendBuffer=[],this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Yq(e,"open",this.onopen.bind(this)),Yq(e,"packet",this.onpacket.bind(this)),Yq(e,"error",this.onerror.bind(this)),Yq(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io["_reconnecting"]||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(Jq.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');t.unshift(e);const n={type:Kq.EVENT,data:t,options:{}};if(n.options.compress=!1!==this.flags.compress,"function"===typeof t[t.length-1]){const e=this.ids++,r=t.pop();this._registerAckCallback(e,r),n.id=e}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable,s=this.flags.volatile&&(!r||!this.connected);return s||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,t){const n=this.flags.timeout;if(void 0===n)return void(this.acks[e]=t);const r=this.io.setTimeoutFn((()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))}),n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,[null,...e])}}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth((e=>{this.packet({type:Kq.CONNECT,data:e})})):this.packet({type:Kq.CONNECT,data:this.auth})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){const t=e.nsp===this.nsp;if(t)switch(e.type){case Kq.CONNECT:if(e.data&&e.data.sid){const t=e.data.sid;this.onconnect(t)}else this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Kq.EVENT:case Kq.BINARY_EVENT:this.onevent(e);break;case Kq.ACK:case Kq.BINARY_ACK:this.onack(e);break;case Kq.DISCONNECT:this.ondisconnect();break;case Kq.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t);break}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e)}ack(e){const t=this;let n=!1;return function(...r){n||(n=!0,t.packet({type:Kq.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];"function"===typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e){this.id=e,this.connected=!0,this.emitBuffered(),this.emitReserved("connect")}emitBuffered(){this.receiveBuffer.forEach((e=>this.emitEvent(e))),this.receiveBuffer=[],this.sendBuffer.forEach((e=>{this.notifyOutgoingListeners(e),this.packet(e)})),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach((e=>e())),this.subs=void 0),this.io["_destroy"](this)}disconnect(){return this.connected&&this.packet({type:Kq.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Xq(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Xq.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-n:e+n}return 0|Math.min(e,this.max)},Xq.prototype.reset=function(){this.attempts=0},Xq.prototype.setMin=function(e){this.ms=e},Xq.prototype.setMax=function(e){this.max=e},Xq.prototype.setJitter=function(e){this.jitter=e};class Zq extends $K{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&"object"===typeof e&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,YK(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(n=t.randomizationFactor)&&void 0!==n?n:.5),this.backoff=new Xq({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||Z;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new xq(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Yq(t,"open",(function(){n.onopen(),e&&e()})),s=Yq(t,"error",(t=>{n.cleanup(),n._readyState="closed",this.emitReserved("error",t),e?e(t):n.maybeReconnectOnOpen()}));if(!1!==this._timeout){const e=this._timeout;0===e&&r();const n=this.setTimeoutFn((()=>{r(),t.close(),t.emit("error",new Error("timeout"))}),e);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}return this.subs.push(r),this.subs.push(s),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Yq(e,"ping",this.onping.bind(this)),Yq(e,"data",this.ondata.bind(this)),Yq(e,"error",this.onerror.bind(this)),Yq(e,"close",this.onclose.bind(this)),Yq(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){bq((()=>{this.emitReserved("packet",e)}),this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n||(n=new Qq(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t){const e=this.nsps[n];if(e.active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach((e=>e())),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn((()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open((t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()})))}),t);this.opts.autoUnref&&n.unref(),this.subs.push((function(){clearTimeout(n)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const eG={};function tG(e,t){"object"===typeof e&&(t=e,e=void 0),t=t||{};const n=Nq(e,t.path||"/socket.io"),r=n.source,s=n.id,i=n.path,o=eG[s]&&i in eG[s]["nsps"],a=t.forceNew||t["force new connection"]||!1===t.multiplex||o;let c;return a?c=new Zq(r,t):(eG[s]||(eG[s]=new Zq(r,t)),c=eG[s]),n.query&&!t.query&&(t.query=n.queryKey),c.socket(n.path,t)}Object.assign(tG,{Manager:Zq,Socket:Qq,io:tG,connect:tG});var nG=n(5317);const rG=65536,sG=5e3;class iG{constructor(e,t){this.label=e.label,this.open=Ay(),this.channel=e,this.channel.binaryType="arraybuffer",this.log=t.log,"number"===typeof this.channel.bufferedAmountLowThreshold&&(this.channel.bufferedAmountLowThreshold=rG),e.addEventListener("message",(e=>{t.onMessage(e)})),e.addEventListener("bufferedamountlow",(()=>{this.log("stop backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open.resolve()})),e.addEventListener("open",(()=>{this.open.resolve(),t.onOpen()})),e.addEventListener("close",(()=>{t.onClose()})),e.addEventListener("error",(n=>{if("Transport channel closed"===n.error?.message)return this.close();t.log.error('channel encounter an error in state "%s" message: "%s" detail: "%s',e.readyState,n.error?.message,n.error?.errorDetail);const r=n.error instanceof Error?n.error:new Error(`datachannel error: ${n.error?.message} ${n.error?.errorDetail}`);t.onError(je(r,"ERR_DATA_CHANNEL"))}));let n=!1;this.closingInterval=setInterval((()=>{"closing"===e.readyState?(n&&t.onClose(),n=!0):n=!1}),sG)}async send(e){await this.open.promise,this.channel.send(e),this.channel.bufferedAmount>rG&&(this.log("start backpressure: bufferedAmount %d",this.channel.bufferedAmount),this.open=Ay())}close(){clearInterval(this.closingInterval),this.channel.close()}get bufferedAmount(){return this.channel.bufferedAmount}}var oG=n(6190);const aG={iceServers:[{urls:["stun:stun.l.google.com:19302","stun:global.stun.twilio.com:3478"]}]};function cG(){if("undefined"===typeof globalThis)throw je(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");const e={RTCPeerConnection:globalThis.RTCPeerConnection??globalThis.mozRTCPeerConnection??globalThis.webkitRTCPeerConnection,RTCSessionDescription:globalThis.RTCSessionDescription??globalThis.mozRTCSessionDescription??globalThis.webkitRTCSessionDescription,RTCIceCandidate:globalThis.RTCIceCandidate??globalThis.mozRTCIceCandidate??globalThis.webkitRTCIceCandidate};if(null==e.RTCPeerConnection)throw je(new Error("No WebRTC support detected"),"ERR_WEBRTC_SUPPORT");return e}class lG extends gL{constructor(e){super(),this.id=e.id??ia(nG(4),"hex").slice(0,7),this.log=Fe(`libp2p:webrtc-peer:${e.logPrefix}:${this.id}`),this.wrtc=e.wrtc??cG(),this.peerConnection=new this.wrtc.RTCPeerConnection(Object.assign({},aG,e.peerConnectionConfig)),this.closed=!1,this.connected=Ay(),this.source=im(),this.sink=async e=>{if(await this.connected.promise,null==this.channel)throw je(new Error("Connected but no channel?!"),"ERR_DATA_CHANNEL");for await(const t of e)await this.channel.send(t);await this.close()}}handleDataChannelEvent(e){const t=e.channel;null!=t?this.channel=new iG(t,{log:this.log,onMessage:e=>{this.source.push(new Uint8Array(e.data))},onOpen:()=>{this.connected.resolve(),this.dispatchEvent(new yL("ready"))},onClose:()=>{this.close().catch((e=>{this.log("error closing connection after channel close",e)}))},onError:e=>{this.close(e).catch((e=>{this.log("error closing connection after channel error",e)}))}}):this.close(je(new Error("Data channel event is missing `channel` property"),"ERR_DATA_CHANNEL")).catch((e=>{this.log("Error closing after event channel was found to be null",e)}))}async close(e){if(this.closed=!0,null==e&&null!=this.channel)while(this.channel.bufferedAmount>0)await oG(100);this.channel?.close(),this.peerConnection.close(),this.source.end(e),this.dispatchEvent(new yL("close"))}}class uG extends gL{constructor(e){super(),this.log=e.log,this.peerConnection=e.peerConnection,this.wrtc=e.wrtc,this.status="idle",this.peerConnection.addEventListener("negotiationneeded",(()=>{this.log("peer connection negotiation needed"),this.handleRenegotiate({type:"renegotiate"}).catch((e=>{this.log.error("could not renegotiate %o",e)}))}))}async handleSignal(e){return this.log('incoming signal "%s"',e.type),"offer"===e.type?await this.handleOffer(e):"answer"===e.type?await this.handleAnswer(e):"candidate"===e.type?await this.handleCandidate(e):"renegotiate"===e.type?await this.handleRenegotiate(e):"goodbye"===e.type?await this.handleGoodye(e):void this.log(`Unknown signal type ${e.type}`)}async handleOffer(e){}async handleAnswer(e){}async handleRenegotiate(e){}async handleGoodye(e){this.peerConnection.close()}async handleCandidate(e){const t=new this.wrtc.RTCIceCandidate(e.candidate);try{await this.peerConnection.addIceCandidate(t)}catch(uS){if(null!=t.address&&!t.address.endsWith(".local"))throw je(uS,"ERR_ADD_ICE_CANDIDATE");this.log("ignoring unsupported ICE candidate.")}}}const hG=Fe("libp2p:webrtc-peer:receiver");class dG extends lG{constructor(e={}){super({...e,logPrefix:"receiver"}),this.handshake=new pG({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,answerOptions:e.answerOptions}),this.handshake.addEventListener("signal",(e=>this.dispatchEvent(new yL("signal",{detail:e.detail})))),this.peerConnection.addEventListener("datachannel",(e=>{this.handleDataChannelEvent(e)}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class pG extends uG{constructor(e){super(e),this.options=e,this.status="idle",this.iceCandidates=[]}async handleRenegotiate(){hG.trace("renegotiate"),this.dispatchEvent(new yL("signal",{detail:{type:"renegotiate"}}))}async handleOffer(e){await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e));for(const n of this.iceCandidates)await this.handleCandidate(n);this.iceCandidates=[];const t=await this.peerConnection.createAnswer(this.options.answerOptions);await this.peerConnection.setLocalDescription(t),hG.trace("handle offer",this.peerConnection.localDescription),this.dispatchEvent(new yL("signal",{detail:this.peerConnection.localDescription??t}))}async handleCandidate(e){null!=this.peerConnection.remoteDescription&&null!=this.peerConnection.remoteDescription.type?await super.handleCandidate(e):this.iceCandidates.push(e)}}class fG extends Error{constructor(e){super(e),this.name="TimeoutError"}}class gG extends Error{constructor(e){super(),this.name="AbortError",this.message=e}}const mG=e=>void 0===globalThis.DOMException?new gG(e):new DOMException(e),yG=e=>{const t=void 0===e.reason?mG("This operation was aborted."):e.reason;return t instanceof Error?t:mG(t)};function wG(e,t,n,r){let s;const i=new Promise(((i,o)=>{if("number"!==typeof t||1!==Math.sign(t))throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(t!==Number.POSITIVE_INFINITY){if(r={customTimers:{setTimeout:setTimeout,clearTimeout:clearTimeout},...r},r.signal){const{signal:e}=r;e.aborted&&o(yG(e)),e.addEventListener("abort",(()=>{o(yG(e))}))}s=r.customTimers.setTimeout.call(void 0,(()=>{if("function"===typeof n){try{i(n())}catch(a){o(a)}return}const r="string"===typeof n?n:`Promise timed out after ${t} milliseconds`,s=n instanceof Error?n:new fG(r);"function"===typeof e.cancel&&e.cancel(),o(s)}),t),(async()=>{try{i(await e)}catch(t){o(t)}finally{r.customTimers.clearTimeout.call(void 0,s)}})()}else i(e)}));return i.clear=()=>{clearTimeout(s),s=void 0},i}const bG=e=>{const t=e.on||e.addListener||e.addEventListener,n=e.off||e.removeListener||e.removeEventListener;if(!t||!n)throw new TypeError("Emitter is not compatible");return{addListener:t.bind(e),removeListener:n.bind(e)}};function vG(e,t,n){let r;const s=new Promise(((s,i)=>{if(n={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...n},!(n.count>=0)||n.count!==Number.POSITIVE_INFINITY&&!Number.isInteger(n.count))throw new TypeError("The `count` option should be at least 0 or more");const o=[t].flat(),a=[],{addListener:c,removeListener:l}=bG(e),u=(...e)=>{const t=n.multiArgs?e:e[0];n.filter&&!n.filter(t)||(a.push(t),n.count===a.length&&(r(),s(a)))},h=e=>{r(),i(e)};r=()=>{for(const e of o)l(e,u);for(const e of n.rejectionEvents)l(e,h)};for(const e of o)c(e,u);for(const e of n.rejectionEvents)c(e,h);n.resolveImmediately&&s(a)}));if(s.cancel=r,"number"===typeof n.timeout){const e=wG(s,n.timeout);return e.cancel=r,e}return s}function EG(e,t,n){"function"===typeof n&&(n={filter:n}),n={...n,count:1,resolveImmediately:!1};const r=vG(e,t,n),s=r.then((e=>e[0]));return s.cancel=r.cancel,s}const _G=Fe("libp2p:webrtc-peer:initator"),SG=1e3;class kG extends lG{constructor(e={}){super({...e,logPrefix:"initiator"}),this.handleDataChannelEvent({channel:this.peerConnection.createDataChannel(e.dataChannelLabel??ia(nG(20),"hex").slice(0,7),e.dataChannelInit)}),this.handshake=new AG({log:this.log,peerConnection:this.peerConnection,wrtc:this.wrtc,offerOptions:e.offerOptions}),this.handshake.addEventListener("signal",(e=>{this.dispatchEvent(new yL("signal",{detail:e.detail}))}))}handleSignal(e){this.handshake.handleSignal(e).catch((t=>{this.log("error handling signal %o %o",e,t)}))}}class AG extends uG{constructor(e){super(e),this.options=e,this.status="idle",this.peerConnection.addEventListener("icecandidate",(e=>{if(null==e.candidate)return;const t={type:"candidate",candidate:{candidate:e.candidate.candidate,sdpMLineIndex:e.candidate.sdpMLineIndex,sdpMid:e.candidate.sdpMid}};_G.trace("create candidate",t),this.dispatchEvent(new yL("signal",{detail:t})),this.dispatchEvent(new yL("ice-candidate"))}))}async handleRenegotiate(){if("negotiating"===this.status)return void this.log("already negotiating, queueing");this.status="negotiating";const e=await this.peerConnection.createOffer(this.options.offerOptions);await this.peerConnection.setLocalDescription(e),await EG(this,"ice-candidate"),await oG(SG),_G.trace("renegotiate",this.peerConnection.localDescription),this.dispatchEvent(new yL("signal",{detail:this.peerConnection.localDescription??e}))}async handleAnswer(e){_G.trace("handle answer",e),await this.peerConnection.setRemoteDescription(new this.wrtc.RTCSessionDescription(e)),this.status="idle"}}const TG=Fe("libp2p:webrtc-star:socket");function CG(e,t){const{sink:n,source:r}=e,s={remoteAddr:t.remoteAddr,async sink(e){null!=t.signal&&(e=XF(e,t.signal));try{await n(e)}catch(uS){"aborted"!==uS.type&&TG.error(uS)}},source:null!=t.signal?XF(r,t.signal):r,timeline:{open:Date.now()},async close(){if(e.closed)return;const t=Date.now(),n=setTimeout((()=>{if(null!=s.remoteAddr){const{host:e,port:n}=s.remoteAddr.toOptions();TG("timeout closing socket to %s:%s after %dms, destroying it manually",e,n,Date.now()-t)}e.closed||e.close().catch((e=>{TG.error("could not close socket",e)}))}),EK);try{await e.close()}finally{clearTimeout(n)}}};return e.addEventListener("close",(()=>{null==s.timeline.close&&(s.timeline.close=Date.now())}),{once:!0}),s}function IG(e){const t=e.toString().split("/"),n=e.protos()[1].name,r=e.protos()[2].name,s=e.stringTuples()[1][1];if("tcp"!==n||"ws"!==r&&"wss"!==r)throw new Error(`invalid multiaddr: ${e.toString()}`);if(!lc(e))return`http://${t[2]}:${t[4]}`;if("ws"===r)return`http://${t[2]}${null==s||"80"===s?"":`:${s}`}`;if("wss"===r)return`https://${t[2]}${null==s||"443"===s?"":`:${s}`}`;throw new Error("invalid multiaddr: "+e.toString())}function RG(e){const t="/libp2p-webrtc-star";if(e.startsWith(t)){e=e.substring(t.length,e.length);let n=dc(e);const r=n.stringTuples().filter((e=>421===e[0]))[0];if(null==r[1])throw new Error("invalid multiaddr: "+e);n=n.decapsulate("p2p"),n=n.encapsulate("/p2p-webrtc-star"),n=n.encapsulate(`/p2p/${r[1]}`),e=n.toString()}return e}const OG=Fe("libp2p:webrtc-star:listener"),xG={transports:["websocket"],path:"/socket.io-next/"};class NG extends gL{constructor(e,t,n,r,s){super(),this.signallingAddr=t,this.socket=tG(e,xG),this.connections=[],this.channels=new Map,this.pendingSignals=new Map,this.upgrader=n,this.handler=r,this.channelOptions=s,this.handleWsHandshake=this.handleWsHandshake.bind(this);let i=!1;this.socket.on("connect_error",(e=>{i&&"TransportError"===e.type||this.dispatchEvent(new yL("error",{detail:e}))})),this.socket.on("error",(e=>{this.dispatchEvent(new yL("error",{detail:e}))})),this.socket.on("ws-handshake",this.handleWsHandshake),this.socket.on("ws-peer",(e=>{this.dispatchEvent(new yL("peer",{detail:e}))})),this.socket.on("connect",(()=>{this.socket.emit("ss-join",this.signallingAddr.toString()),i&&this.dispatchEvent(new yL("reconnect"))})),this.socket.once("connect",(()=>{i=!0,this.dispatchEvent(new yL("listening"))})),this.socket.on("disconnect",(()=>{this.dispatchEvent(new yL("disconnect"))}))}_createChannel(e,t,n){const r={...this.channelOptions},s=new dG(r),i=e=>{const t=e.detail;OG.error("incoming connection errored",t)};return s.addEventListener("error",i),s.addEventListener("close",(()=>{s.removeEventListener("error",i)}),{once:!0}),s.addEventListener("signal",(r=>{const s=r.detail;this.socket.emit("ss-handshake",{intentId:e,srcMultiaddr:t,dstMultiaddr:n,answer:!0,signal:s})})),s.addEventListener("ready",(()=>{const t=CG(s,{remoteAddr:this.signallingAddr});OG("new inbound connection %s",t.remoteAddr);try{this.upgrader.upgradeInbound(t).then((n=>{OG("inbound connection %s upgraded",t.remoteAddr),this.connections.push(t);const r=()=>{this.connections=this.connections.filter((e=>e!==t)),this.channels.delete(e),this.pendingSignals.delete(e)};s.addEventListener("close",r,{once:!0}),this.dispatchEvent(new yL("connection",{detail:n})),this.handler(n)})).catch((e=>{OG.error("inbound connection failed to upgrade",e),t.close().catch((e=>{OG.error("inbound connection failed to close after failing to upgrade",e)}))}))}catch(uS){OG.error("inbound connection failed to upgrade",uS),t.close().catch((e=>{OG.error("inbound connection failed to close after failing to upgrade",e)}))}}),{once:!0}),s}handleWsHandshake(e){if(OG('incoming handshake. signal type "%s" is answer %s',e.signal.type,e.answer),!0===e.answer||null!=e.err||null==e.intentId)return;const t=e.intentId;let n=this.pendingSignals.get(t);null==n&&(n=[],this.pendingSignals.set(t,n)),n.push(e);let r=this.channels.get(t);if(null==r){if("offer"!==e.signal.type)return void OG("handshake is not an offer and channel does not exist, buffering until we receive an offer");OG("creating new channel to handle offer handshake"),r=this._createChannel(e.intentId,e.srcMultiaddr,e.dstMultiaddr),this.channels.set(t,r)}else OG("channel already exists, using it to handle handshake");while(n.length>0){const e=n.shift();null!=e?.signal&&r.handleSignal(e.signal)}}async close(){this.socket.emit("ss-leave",this.signallingAddr.toString()),this.socket.removeAllListeners(),this.socket.close(),await Promise.all([...this.connections.map((async e=>await e.close())),...Array.from(this.channels.values()).map((async e=>await e.close()))]),this.dispatchEvent(new yL("close"))}}class DG extends gL{constructor(e,t,n,r,s){super(),this.upgrader=e,this.handler=t,this.peerId=n,this.transport=r,this.options=s}async listen(e){if(null!=this.listeningAddr)throw je(new Error("listener already in use"),"ERR_ALREADY_LISTENING");const t=Ay();let n;this.listeningAddr=e,n=e.protoCodes().includes(bK)?e:e.encapsulate(`/p2p/${this.peerId.toString()}`);const r=this.signallingUrl=IG(e);OG("connecting to signalling server on: %s",this.signallingUrl);const s=new NG(this.signallingUrl,n,this.upgrader,this.handler,this.options.channelOptions);return s.addEventListener("error",(e=>{const n=e.detail;OG("error connecting to signalling server %o",n),s.close().catch((e=>{OG.error("error closing server after error",e)})),t.reject(n)})),s.addEventListener("listening",(()=>{OG("connected to signalling server"),this.dispatchEvent(new yL("listening")),t.resolve()})),s.addEventListener("peer",(e=>{this.transport.peerDiscovered(e.detail)})),s.addEventListener("connection",(t=>{const n=t.detail;if(null==n.remoteAddr)try{n.remoteAddr=e.decapsulateCode(bK).encapsulate(`/p2p/${n.remotePeer.toString()}`)}catch(uS){OG.error("could not determine remote address",uS)}this.dispatchEvent(new yL("connection",{detail:n}))})),s.addEventListener("disconnect",(()=>{this.transport.sigServers.delete(r)})),s.addEventListener("reconnect",(()=>{this.transport.sigServers.set(r,s)})),this.transport.sigServers.set(this.signallingUrl,s),await t.promise}async close(){if(null!=this.signallingUrl){const e=this.transport.sigServers.get(this.signallingUrl);null!=e&&(await e.close(),this.transport.sigServers.delete(this.signallingUrl))}this.dispatchEvent(new yL("close")),this.listeningAddr=void 0}getAddrs(){return null!=this.listeningAddr?[this.listeningAddr]:[]}}function PG(e,t,n,r,s){return new DG(e,t,n,r,s)}function LG(e,t){if(e.length!==t.length)throw new Error("Inputs should have the same length");const n=Bo(e.length);for(let r=0;r<e.length;r++)n[r]=e[r]^t[r];return Lo(n)}const MG=Symbol.for("@libp2p/transport");var BG;(function(e){e[e["FATAL_ALL"]=0]="FATAL_ALL",e[e["NO_FATAL"]=1]="NO_FATAL"})(BG||(BG={}));const UG=Symbol.for("@libp2p/peer-discovery");const VG="RTCPeerConnection"in globalThis,FG=Fe("libp2p:webrtc-star"),jG=()=>{};class zG extends gL{constructor(){super(...arguments),this.started=!1}get[UG](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star-discovery"}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}dispatchEvent(e){return!!this.isStarted()&&super.dispatchEvent(e)}}class $G{constructor(e){null!=e?.wrtc&&(this.wrtc=e.wrtc),this.sigServers=new Map,this._discovery=new zG,this.discovery=()=>this._discovery,this.peerDiscovered=this.peerDiscovered.bind(this)}get[MG](){return!0}get[Symbol.toStringTag](){return"@libp2p/webrtc-star"}async dial(e,t){const n=await this._connect(e,t),r=CG(n,{remoteAddr:e,signal:t.signal});FG("new outbound connection %s",r.remoteAddr);const s=await t.upgrader.upgradeOutbound(r);return FG("outbound connection %s upgraded",r.remoteAddr),s}async _connect(e,t){if(!0===t.signal?.aborted)throw new JF;const n={...t.channelOptions??{}};null!=this.wrtc&&(n.wrtc=this.wrtc);const r=e.toOptions(),s=ia(nG(36),"hex");return await new Promise(((i,o)=>{const a=this.sigServers.get(IG(e));if(null==a?.socket)return o(je(new Error("unknown signal server to use"),"ERR_UNKNOWN_SIGNAL_SERVER"));let c=!1;FG("dialing %s:%s",r.host,r.port);const l=new kG(n),u=e=>{const t=e.detail;if(!c){const e=`connection error ${r.host}:${r.port}: ${t.message}`;FG.error(e),p(t)}},h=()=>{c=!0,FG("connection opened %s:%s",r.host,r.port),p()},d=()=>{FG.error("connection aborted %s:%s",r.host,r.port),l.close().finally((()=>{p(new JF)}))},p=e=>{l.removeEventListener("ready",h),t.signal?.removeEventListener("abort",d),null==e?i(l):o(e)};l.addEventListener("ready",h,{once:!0}),l.addEventListener("close",(()=>{l.removeEventListener("error",u)})),t.signal?.addEventListener("abort",d),l.addEventListener("signal",(t=>{const n=t.detail;a.socket.emit("ss-handshake",{intentId:s,srcMultiaddr:a.signallingAddr.toString(),dstMultiaddr:e.toString(),signal:n})})),a.socket.on("ws-handshake",(e=>{e.intentId===s&&null!=e.err&&l.close().finally((()=>{o(je(new Error(e.err),"ERR_SIGNALLING_FAILED"))})),e.intentId!==s||null==e.answer||l.closed||l.handleSignal(e.signal)}))}))}createListener(e){if(!VG&&null==this.wrtc)throw je(new Error("no WebRTC support"),"ERR_NO_WEBRTC_SUPPORT");if(e.channelOptions=e.channelOptions??{},null!=this.wrtc&&(e.channelOptions.wrtc=this.wrtc),null==this.peerId)throw je(new Error("PeerId not set"),"ERR_MISSING_PEER_ID");return PG(e.upgrader,e.handler??jG,this.peerId,this,e)}filter(e){return e=Array.isArray(e)?e:[e],e.filter((e=>!e.protoCodes().includes(vK)&&Tc.matches(e)))}peerDiscovered(e){FG("peer discovered: %s",e),e=RG(e);const t=dc(e),n=t.getPeerId();if(null==n)return;const r=Fu(n);this._discovery.dispatchEvent(new yL("peer",{detail:{id:r,multiaddrs:[t],protocols:[]}}))}}function HG(e={}){const t=new $G(e);return{transport:e=>(t.peerId=e.peerId,t),discovery:t.discovery}}function KG(){const e=HG(),t={transports:[e.transport],peerDiscovery:[e.discovery],connectionManager:{maxParallelDials:150,maxDialsPerPeer:4,dialTimeout:1e4,autoDial:!0},nat:{enabled:!1},metrics:{enabled:!0}};return t}var qG,GG;async function*WG(e,t){yield*Iy(e,(async e=>(await t.addressBook.add(e.id,e.multiaddrs),e)))}function YG(e){const t=new Set;return em(e,(e=>!t.has(e.id.toString())&&(t.add(e.id.toString()),!0)))}async function*JG(e,t=1){let n=0;for await(const r of e)n++,yield r;if(n<t)throw je(new Error("not found"),"NOT_FOUND")}(function(e){e["NOT_STARTED_YET"]="The libp2p node is not started yet",e["DHT_DISABLED"]="DHT is not available",e["PUBSUB_DISABLED"]="PubSub is not available",e["CONN_ENCRYPTION_REQUIRED"]="At least one connection encryption module is required",e["ERR_TRANSPORTS_REQUIRED"]="At least one transport module is required",e["ERR_PROTECTOR_REQUIRED"]="Private network is enforced, but no protector was provided",e["NOT_FOUND"]="Not found"})(qG||(qG={})),function(e){e["DHT_DISABLED"]="ERR_DHT_DISABLED",e["ERR_PUBSUB_DISABLED"]="ERR_PUBSUB_DISABLED",e["PUBSUB_NOT_STARTED"]="ERR_PUBSUB_NOT_STARTED",e["DHT_NOT_STARTED"]="ERR_DHT_NOT_STARTED",e["CONN_ENCRYPTION_REQUIRED"]="ERR_CONN_ENCRYPTION_REQUIRED",e["ERR_TRANSPORTS_REQUIRED"]="ERR_TRANSPORTS_REQUIRED",e["ERR_PROTECTOR_REQUIRED"]="ERR_PROTECTOR_REQUIRED",e["ERR_PEER_DIAL_INTERCEPTED"]="ERR_PEER_DIAL_INTERCEPTED",e["ERR_CONNECTION_INTERCEPTED"]="ERR_CONNECTION_INTERCEPTED",e["ERR_INVALID_PROTOCOLS_FOR_STREAM"]="ERR_INVALID_PROTOCOLS_FOR_STREAM",e["ERR_CONNECTION_ENDED"]="ERR_CONNECTION_ENDED",e["ERR_CONNECTION_FAILED"]="ERR_CONNECTION_FAILED",e["ERR_NODE_NOT_STARTED"]="ERR_NODE_NOT_STARTED",e["ERR_ALREADY_ABORTED"]="ERR_ALREADY_ABORTED",e["ERR_TOO_MANY_ADDRESSES"]="ERR_TOO_MANY_ADDRESSES",e["ERR_NO_VALID_ADDRESSES"]="ERR_NO_VALID_ADDRESSES",e["ERR_RELAYED_DIAL"]="ERR_RELAYED_DIAL",e["ERR_DIALED_SELF"]="ERR_DIALED_SELF",e["ERR_DISCOVERED_SELF"]="ERR_DISCOVERED_SELF",e["ERR_DUPLICATE_TRANSPORT"]="ERR_DUPLICATE_TRANSPORT",e["ERR_ENCRYPTION_FAILED"]="ERR_ENCRYPTION_FAILED",e["ERR_HOP_REQUEST_FAILED"]="ERR_HOP_REQUEST_FAILED",e["ERR_INVALID_KEY"]="ERR_INVALID_KEY",e["ERR_INVALID_MESSAGE"]="ERR_INVALID_MESSAGE",e["ERR_INVALID_PARAMETERS"]="ERR_INVALID_PARAMETERS",e["ERR_INVALID_PEER"]="ERR_INVALID_PEER",e["ERR_MUXER_UNAVAILABLE"]="ERR_MUXER_UNAVAILABLE",e["ERR_NOT_FOUND"]="ERR_NOT_FOUND",e["ERR_TIMEOUT"]="ERR_TIMEOUT",e["ERR_TRANSPORT_UNAVAILABLE"]="ERR_TRANSPORT_UNAVAILABLE",e["ERR_TRANSPORT_DIAL_FAILED"]="ERR_TRANSPORT_DIAL_FAILED",e["ERR_UNSUPPORTED_PROTOCOL"]="ERR_UNSUPPORTED_PROTOCOL",e["ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED"]="ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED",e["ERR_INVALID_MULTIADDR"]="ERR_INVALID_MULTIADDR",e["ERR_SIGNATURE_NOT_VALID"]="ERR_SIGNATURE_NOT_VALID",e["ERR_FIND_SELF"]="ERR_FIND_SELF",e["ERR_NO_ROUTERS_AVAILABLE"]="ERR_NO_ROUTERS_AVAILABLE",e["ERR_CONNECTION_NOT_MULTIPLEXED"]="ERR_CONNECTION_NOT_MULTIPLEXED",e["ERR_NO_DIAL_TOKENS"]="ERR_NO_DIAL_TOKENS",e["ERR_KEYCHAIN_REQUIRED"]="ERR_KEYCHAIN_REQUIRED",e["ERR_INVALID_CMS"]="ERR_INVALID_CMS",e["ERR_MISSING_KEYS"]="ERR_MISSING_KEYS",e["ERR_NO_KEY"]="ERR_NO_KEY",e["ERR_INVALID_KEY_NAME"]="ERR_INVALID_KEY_NAME",e["ERR_INVALID_KEY_TYPE"]="ERR_INVALID_KEY_TYPE",e["ERR_KEY_ALREADY_EXISTS"]="ERR_KEY_ALREADY_EXISTS",e["ERR_INVALID_KEY_SIZE"]="ERR_INVALID_KEY_SIZE",e["ERR_KEY_NOT_FOUND"]="ERR_KEY_NOT_FOUND",e["ERR_OLD_KEY_NAME_INVALID"]="ERR_OLD_KEY_NAME_INVALID",e["ERR_NEW_KEY_NAME_INVALID"]="ERR_NEW_KEY_NAME_INVALID",e["ERR_PASSWORD_REQUIRED"]="ERR_PASSWORD_REQUIRED",e["ERR_PEM_REQUIRED"]="ERR_PEM_REQUIRED",e["ERR_CANNOT_READ_KEY"]="ERR_CANNOT_READ_KEY",e["ERR_MISSING_PRIVATE_KEY"]="ERR_MISSING_PRIVATE_KEY",e["ERR_MISSING_PUBLIC_KEY"]="ERR_MISSING_PUBLIC_KEY",e["ERR_INVALID_OLD_PASS_TYPE"]="ERR_INVALID_OLD_PASS_TYPE",e["ERR_INVALID_NEW_PASS_TYPE"]="ERR_INVALID_NEW_PASS_TYPE",e["ERR_INVALID_PASS_LENGTH"]="ERR_INVALID_PASS_LENGTH",e["ERR_NOT_IMPLEMENTED"]="ERR_NOT_IMPLEMENTED",e["ERR_WRONG_PING_ACK"]="ERR_WRONG_PING_ACK",e["ERR_INVALID_RECORD"]="ERR_INVALID_RECORD",e["ERR_ALREADY_SUCCEEDED"]="ERR_ALREADY_SUCCEEDED",e["ERR_NO_HANDLER_FOR_PROTOCOL"]="ERR_NO_HANDLER_FOR_PROTOCOL",e["ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS"]="ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS",e["ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS"]="ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS",e["ERR_CONNECTION_DENIED"]="ERR_CONNECTION_DENIED"}(GG||(GG={}));var QG=n(7550),XG=n(1528);const ZG=Fe("libp2p:peer-routing");class eW{constructor(e,t){this.components=e,this.routers=t.routers,this.refreshManagerInit=t.refreshManager??{},this.started=!1,this._findClosestPeersTask=this._findClosestPeersTask.bind(this)}isStarted(){return this.started}async start(){this.started||0===this.routers.length||null!=this.timeoutId||!1===this.refreshManagerInit.enabled||(this.timeoutId=(0,QG.setDelayedInterval)(this._findClosestPeersTask,this.refreshManagerInit.interval,this.refreshManagerInit.bootDelay),this.started=!0)}async _findClosestPeersTask(){if(null==this.abortController)try{this.abortController=new Ho.TimeoutController(this.refreshManagerInit.timeout??1e4);try{(0,XG.setMaxListeners)?.(1/0,this.abortController.signal)}catch{}await Zg(this.getClosestPeers(this.components.peerId.toBytes(),{signal:this.abortController.signal}))}catch(uS){ZG.error(uS)}finally{this.abortController?.clear(),this.abortController=void 0}}async stop(){(0,QG.clearDelayedInterval)(this.timeoutId),this.abortController?.abort(),this.started=!1}async findPeer(e,t){if(0===this.routers.length)throw je(new Error("No peer routers available"),GG.ERR_NO_ROUTERS_AVAILABLE);if(e.toString()===this.components.peerId.toString())throw je(new Error("Should not try to find self"),GG.ERR_FIND_SELF);const n=await vm(gm(...this.routers.map((n=>async function*(){try{yield await n.findPeer(e,t)}catch(uS){ZG.error(uS)}}()))),(e=>em(e,Boolean)),(e=>WG(e,this.components.peerStore)),(async e=>await rI(e)));if(null!=n)return n;throw je(new Error(qG.NOT_FOUND),GG.ERR_NOT_FOUND)}async*getClosestPeers(e,t){if(0===this.routers.length)throw je(new Error("No peer routers available"),GG.ERR_NO_ROUTERS_AVAILABLE);yield*vm(gm(...this.routers.map((n=>n.getClosestPeers(e,t)))),(e=>WG(e,this.components.peerStore)),(e=>YG(e)),(e=>JG(e)))}}class tW{constructor(e,t){this.routers=t.routers??[],this.started=!1,this.components=e}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(0===this.routers.length)throw je(new Error("No content this.routers available"),GG.ERR_NO_ROUTERS_AVAILABLE);yield*vm(gm(...this.routers.map((n=>n.findProviders(e,t)))),(e=>WG(e,this.components.peerStore)),(e=>YG(e)),(e=>JG(e)))}async provide(e,t={}){if(0===this.routers.length)throw je(new Error("No content routers available"),GG.ERR_NO_ROUTERS_AVAILABLE);await Promise.all(this.routers.map((async n=>await n.provide(e,t))))}async put(e,t,n){if(!this.isStarted())throw je(new Error(qG.NOT_STARTED_YET),GG.DHT_NOT_STARTED);const r=this.components.dht;null!=r&&await Zg(r.put(e,t,n))}async get(e,t){if(!this.isStarted())throw je(new Error(qG.NOT_STARTED_YET),GG.DHT_NOT_STARTED);const n=this.components.dht;if(null!=n)for await(const r of n.get(e,t))if("VALUE"===r.name)return r.value;throw je(new Error(qG.NOT_FOUND),GG.ERR_NOT_FOUND)}async*getMany(e,t,n){if(!this.isStarted())throw je(new Error(qG.NOT_STARTED_YET),GG.DHT_NOT_STARTED);if(null==t||0===t)return;let r=0;const s=this.components.dht;if(null!=s)for await(const i of s.get(e,n))if("VALUE"===i.name&&(yield{from:i.from,val:i.value},r++,r===t))break;if(0===r)throw je(new Error(qG.NOT_FOUND),GG.ERR_NOT_FOUND)}}function nW(e){const t=e.getPeerId();if(null==t)throw je(new Error(`${e.toString()} does not have a valid peer type`),GG.ERR_INVALID_MULTIADDR);try{return Fu(t)}catch(uS){throw je(new Error(`${e.toString()} is not a valid peer type`),GG.ERR_INVALID_MULTIADDR)}}function rW(e){if(Ru(e))return{id:e,multiaddrs:[],protocols:[]};let t;return"string"===typeof e&&(e=dc(e)),uc(e)&&(t=e,e=nW(e)),{id:e,multiaddrs:null!=t?[t]:[],protocols:[]}}const sW=e=>e;class iW extends gL{constructor(e,t){super();const{listen:n=[],announce:r=[]}=t;this.components=e,this.listen=new Set(n.map((e=>e.toString()))),this.announce=new Set(r.map((e=>e.toString()))),this.observed=new Set,this.announceFilter=t.announceFilter??sW}getListenAddrs(){return Array.from(this.listen).map((e=>dc(e)))}getAnnounceAddrs(){return Array.from(this.announce).map((e=>dc(e)))}getObservedAddrs(){return Array.from(this.observed).map((e=>dc(e)))}confirmObservedAddr(e){}removeObservedAddr(e){}addObservedAddr(e){let t=dc(e);const n=t.getPeerId();if(null!=n){const e=Fu(n);e.equals(this.components.peerId)&&(t=t.decapsulate(dc(`/p2p/${this.components.peerId.toString()}`)))}const r=t.toString();this.observed.has(r)||(this.observed.add(r),this.dispatchEvent(new yL("change:addresses")))}getAddresses(){let e=this.getAnnounceAddrs().map((e=>e.toString()));0===e.length&&(e=this.components.transportManager.getAddrs().map((e=>e.toString()))),e=e.concat(this.getObservedAddrs().map((e=>e.toString())));const t=new Set(e);return this.announceFilter(Array.from(t).map((e=>dc(e)))).map((e=>e.getPeerId()===this.components.peerId.toString()?e:e.encapsulate(`/p2p/${this.components.peerId.toString()}`)))}}const oW=Fe("libp2p:connection-manager:latency-monitor:visibility-change-emitter");class aW extends gL{constructor(){super(),this.hidden="hidden",this.visibilityChange="visibilityChange",null!=globalThis.document&&(this._initializeVisibilityVarNames(),this._addVisibilityChangeListener())}_initializeVisibilityVarNames(){let e="hidden",t="visibilitychange";"undefined"!==typeof globalThis.document.hidden?(e="hidden",t="visibilitychange"):"undefined"!==typeof globalThis.document.mozHidden?(e="mozHidden",t="mozvisibilitychange"):"undefined"!==typeof globalThis.document.msHidden?(e="msHidden",t="msvisibilitychange"):"undefined"!==typeof globalThis.document.webkitHidden&&(e="webkitHidden",t="webkitvisibilitychange"),this.hidden=e,this.visibilityChange=t}_addVisibilityChangeListener(){"undefined"===typeof globalThis.document.addEventListener||"undefined"===typeof document[this.hidden]?oW("Checking page visibility requires a browser that supports the Page Visibility API."):globalThis.document.addEventListener(this.visibilityChange,this._handleVisibilityChange.bind(this),!1)}isVisible(){if(void 0!==this.hidden&&void 0!==document[this.hidden])return null==document[this.hidden]}_handleVisibilityChange(){const e=!1===globalThis.document[this.hidden];oW(e?"Page Visible":"Page Hidden"),this.dispatchEvent(new yL("visibilityChange",{detail:e}))}}const cW=Fe("libp2p:connection-manager:latency-monitor");class lW extends gL{constructor(e={}){super();const{latencyCheckIntervalMs:t,dataEmitIntervalMs:n,asyncTestFn:r,latencyRandomPercentage:s}=e;this.latencyCheckIntervalMs=t??500,this.latencyRandomPercentage=s??10,this.latencyCheckMultiply=this.latencyRandomPercentage/100*2*this.latencyCheckIntervalMs,this.latencyCheckSubtract=this.latencyCheckMultiply/2,this.dataEmitIntervalMs=null===n||0===n?void 0:n??5e3,cW("latencyCheckIntervalMs: %s dataEmitIntervalMs: %s",this.latencyCheckIntervalMs,this.dataEmitIntervalMs),null!=this.dataEmitIntervalMs?cW("Expecting ~%s events per summary",this.latencyCheckIntervalMs/this.dataEmitIntervalMs):cW("Not emitting summaries"),this.asyncTestFn=r,null!=globalThis.process?.hrtime?(cW("Using process.hrtime for timing"),this.now=globalThis.process.hrtime,this.getDeltaMS=e=>{const t=this.now(e);return 1e3*t[0]+t[1]/1e6}):"undefined"!==typeof window&&null!=window.performance?.now?(cW("Using performance.now for timing"),this.now=window.performance.now.bind(window.performance),this.getDeltaMS=e=>Math.round(this.now()-e)):(cW("Using Date.now for timing"),this.now=Date.now,this.getDeltaMS=e=>this.now()-e),this.latencyData=this.initLatencyData()}start(){uW()&&(this.visibilityChangeEmitter=new aW,this.visibilityChangeEmitter.addEventListener("visibilityChange",(e=>{const{detail:t}=e;t?this._startTimers():(this._emitSummary(),this._stopTimers())}))),!0===this.visibilityChangeEmitter?.isVisible()&&this._startTimers()}stop(){this._stopTimers()}_startTimers(){null==this.checkLatencyID&&(this.checkLatency(),null!=this.dataEmitIntervalMs&&(this.emitIntervalID=setInterval((()=>this._emitSummary()),this.dataEmitIntervalMs),"function"===typeof this.emitIntervalID.unref&&this.emitIntervalID.unref()))}_stopTimers(){null!=this.checkLatencyID&&(clearTimeout(this.checkLatencyID),this.checkLatencyID=void 0),null!=this.emitIntervalID&&(clearInterval(this.emitIntervalID),this.emitIntervalID=void 0)}_emitSummary(){const e=this.getSummary();e.events>0&&this.dispatchEvent(new yL("data",{detail:e}))}getSummary(){const e={events:this.latencyData.events,minMs:this.latencyData.minMs,maxMs:this.latencyData.maxMs,avgMs:this.latencyData.events>0?this.latencyData.totalMs/this.latencyData.events:Number.POSITIVE_INFINITY,lengthMs:this.getDeltaMS(this.latencyData.startTime)};return this.latencyData=this.initLatencyData(),cW.trace("Summary: %O",e),e}checkLatency(){const e=Math.random()*this.latencyCheckMultiply-this.latencyCheckSubtract,t={deltaOffset:Math.ceil(this.latencyCheckIntervalMs+e),startTime:this.now()},n=()=>{if(null==this.checkLatencyID)return;const e=this.getDeltaMS(t.startTime)-t.deltaOffset;this.checkLatency(),this.latencyData.events++,this.latencyData.minMs=Math.min(this.latencyData.minMs,e),this.latencyData.maxMs=Math.max(this.latencyData.maxMs,e),this.latencyData.totalMs+=e,cW.trace("MS: %s Data: %O",e,this.latencyData)};cW.trace("localData: %O",t),this.checkLatencyID=setTimeout((()=>{null!=this.asyncTestFn?(t.deltaOffset=0,t.startTime=this.now(),this.asyncTestFn(n)):(t.deltaOffset-=1,n())}),t.deltaOffset),"function"===typeof this.checkLatencyID.unref&&this.checkLatencyID.unref()}initLatencyData(){return{startTime:this.now(),minMs:Number.POSITIVE_INFINITY,maxMs:Number.NEGATIVE_INFINITY,events:0,totalMs:0}}}function uW(){return"undefined"!==typeof globalThis.window}var hW=n(5748);const dW="OPEN",pW="CLOSING",fW="CLOSED";function gW(e,t){const n={[Symbol.iterator]:()=>n,next:()=>{const n=e.next(),r=n.value;if(!0===n.done||null==r){const e={done:!0,value:void 0};return e}return{done:!1,value:t(r)}}};return n}class mW{constructor(e){if(this.map=new Map,null!=e)for(const[t,n]of e.entries())this.map.set(t.toString(),n)}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){this.map.delete(e.toString())}entries(){return gW(this.map.entries(),(e=>[Fu(e[0]),e[1]]))}forEach(e){this.map.forEach(((t,n)=>{e(t,Fu(n),this)}))}get(e){return this.map.get(e.toString())}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),t)}keys(){return gW(this.map.keys(),(e=>Fu(e)))}values(){return this.map.values()}get size(){return this.map.size}}class yW{constructor(e){if(this.set=new Set,null!=e)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return gW(this.set.entries(),(e=>{const t=Fu(e[0]);return[t,t]}))}forEach(e){this.set.forEach((t=>{const n=Fu(t);e(n,n,this)}))}has(e){return this.set.has(e.toString())}values(){return gW(this.set.values(),(e=>Fu(e)))}intersection(e){const t=new yW;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new yW;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new yW;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}class wW{constructor(e){if(this.list=[],null!=e)for(const t of e)this.list.push(t.toString())}[Symbol.iterator](){return mapIterable(this.list.entries(),(e=>peerIdFromString(e[1])))}concat(e){const t=new wW(this);for(const n of e)t.push(n);return t}entries(){return mapIterable(this.list.entries(),(e=>[e[0],peerIdFromString(e[1])]))}every(e){return this.list.every(((t,n)=>e(peerIdFromString(t),n,this)))}filter(e){const t=new wW;return this.list.forEach(((n,r)=>{const s=peerIdFromString(n);e(s,r,this)&&t.push(s)})),t}find(e){const t=this.list.find(((t,n)=>e(peerIdFromString(t),n,this)));if(null!=t)return peerIdFromString(t)}findIndex(e){return this.list.findIndex(((t,n)=>e(peerIdFromString(t),n,this)))}forEach(e){this.list.forEach(((t,n)=>{e(peerIdFromString(t),n,this)}))}includes(e){return this.list.includes(e.toString())}indexOf(e){return this.list.indexOf(e.toString())}pop(){const e=this.list.pop();if(null!=e)return peerIdFromString(e)}push(...e){for(const t of e)this.list.push(t.toString())}shift(){const e=this.list.shift();if(null!=e)return peerIdFromString(e)}unshift(...e){let t=this.list.length;for(let n=e.length-1;n>-1;n--)this.list.unshift(e[n].toString());return t}get length(){return this.list.length}}const bW="keep-alive";var vW=n(8278);const EW=Fe("libp2p:connection-manager"),_W={maxConnections:1/0,minConnections:0,maxData:1/0,maxSentData:1/0,maxReceivedData:1/0,maxEventLoopDelay:1/0,pollInterval:2e3,autoDialInterval:1e4,movingAverageInterval:6e4,inboundConnectionThreshold:5,maxIncomingPendingConnections:10},SW="libp2p",kW="connection-manager",AW=6e4;class TW extends gL{constructor(e,t){if(super(),this.opts=ne.call({ignoreUndefined:!0},_W,t),this.opts.maxConnections<this.opts.minConnections)throw je(new Error("Connection Manager maxConnections must be greater than minConnections"),GG.ERR_INVALID_PARAMETERS);EW("options: %o",this.opts),this.components=e,this.connections=new Map,this.started=!1,this._checkMetrics=this._checkMetrics.bind(this),this.latencyMonitor=new lW({latencyCheckIntervalMs:t.pollInterval,dataEmitIntervalMs:t.pollInterval});try{(0,XG.setMaxListeners)?.(1/0,this)}catch{}this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.startupReconnectTimeout=t.startupReconnectTimeout??AW,this.dialTimeout=t.dialTimeout??3e4,this.allow=(t.allow??[]).map((e=>dc(e))),this.deny=(t.deny??[]).map((e=>dc(e))),this.inboundConnectionRateLimiter=new vW.RateLimiterMemory({points:this.opts.inboundConnectionThreshold,duration:1}),this.incomingPendingConnections=0}isStarted(){return this.started}async start(){null!=this.components.metrics&&(this.timer=this.timer??hW(this._checkMetrics,this.opts.pollInterval)),this.components.metrics?.updateComponentMetric({system:SW,component:kW,metric:"connections",label:"direction",value:()=>{const e={inbound:0,outbound:0};for(const t of this.connections.values())for(const n of t)"inbound"===n.stat.direction?e.inbound++:e.outbound++;return e}}),this.components.metrics?.updateComponentMetric({system:SW,component:kW,metric:"protocol-streams-total",label:"protocol",value:()=>{const e={};for(const t of this.connections.values())for(const n of t)for(const t of n.streams){const n=`${t.stat.direction} ${t.stat.protocol??"unnegotiated"}`;e[n]=(e[n]??0)+1}return e}}),this.components.metrics?.updateComponentMetric({system:SW,component:kW,metric:"protocol-streams-per-connection-90th-percentile",label:"protocol",value:()=>{const e={};for(const n of this.connections.values())for(const t of n){const n={};for(const e of t.streams){const t=`${e.stat.direction} ${e.stat.protocol??"unnegotiated"}`;n[t]=(n[t]??0)+1}for(const[t,r]of Object.entries(n))e[t]=e[t]??[],e[t].push(r)}const t={};for(let[n,r]of Object.entries(e)){r=r.sort(((e,t)=>e-t));const e=Math.floor(.9*r.length);t[n]=r[e]}return t}}),this.latencyMonitor.start(),this._onLatencyMeasure=this._onLatencyMeasure.bind(this),this.latencyMonitor.addEventListener("data",this._onLatencyMeasure),this.started=!0,EW("started")}async afterStart(){this.components.upgrader.addEventListener("connection",this.onConnect),this.components.upgrader.addEventListener("connectionEnd",this.onDisconnect),Promise.resolve().then((async()=>{const e=[];for(const t of await this.components.peerStore.all()){const n=await this.components.peerStore.getTags(t.id),r=n.filter((e=>e.name===bW)).length>0;r&&e.push(t.id)}this.connectOnStartupController?.clear(),this.connectOnStartupController=new Ho.TimeoutController(this.startupReconnectTimeout);try{(0,XG.setMaxListeners)?.(1/0,this.connectOnStartupController.signal)}catch{}await Promise.all(e.map((async e=>{await this.openConnection(e,{signal:this.connectOnStartupController?.signal}).catch((e=>{EW.error(e)}))})))})).catch((e=>{EW.error(e)})).finally((()=>{this.connectOnStartupController?.clear()}))}async beforeStop(){this.connectOnStartupController?.abort(),this.components.upgrader.removeEventListener("connection",this.onConnect),this.components.upgrader.removeEventListener("connectionEnd",this.onDisconnect)}async stop(){this.timer?.clear(),this.latencyMonitor.removeEventListener("data",this._onLatencyMeasure),this.latencyMonitor.stop(),this.started=!1,await this._close(),EW("stopped")}async _close(){const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(uS){EW.error(uS)}})());EW("closing %d connections",e.length),await Promise.all(e),this.connections.clear()}async _checkMetrics(){const e=this.components.metrics;if(null!=e)try{const t=e.getGlobal().getMovingAverages(),n=t.dataReceived[this.opts.movingAverageInterval].movingAverage;await this._checkMaxLimit("maxReceivedData",n);const r=t.dataSent[this.opts.movingAverageInterval].movingAverage;await this._checkMaxLimit("maxSentData",r);const s=n+r;await this._checkMaxLimit("maxData",s),EW.trace("metrics update",s)}finally{this.timer=hW(this._checkMetrics,this.opts.pollInterval)}}onConnect(e){this._onConnect(e).catch((e=>{EW.error(e)}))}async _onConnect(e){const{detail:t}=e;if(!this.started)return void await t.close();const n=t.remotePeer,r=n.toString(),s=this.connections.get(r);null!=s?s.push(t):this.connections.set(r,[t]),null!=n.publicKey&&await this.components.peerStore.keyBook.set(n,n.publicKey);const i=this.getConnections().length,o=i-this.opts.maxConnections;await this._checkMaxLimit("maxConnections",i,o),this.dispatchEvent(new yL("peer:connect",{detail:t}))}onDisconnect(e){const{detail:t}=e;if(!this.started)return;const n=t.remotePeer.toString();let r=this.connections.get(n);null!=r&&r.length>1?(r=r.filter((e=>e.id!==t.id)),this.connections.set(n,r)):null!=r&&(this.connections.delete(n),this.dispatchEvent(new yL("peer:disconnect",{detail:t})),this.components.metrics?.onPeerDisconnected(t.remotePeer))}getConnections(e){if(null!=e)return this.connections.get(e.toString())??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}async openConnection(e,t={}){EW("dial to %p",e);const n=this.getConnections(e);if(n.length>0)return EW("had an existing connection to %p",e),n[0];let r;if(null==t?.signal){r=new Ho.TimeoutController(this.dialTimeout),t.signal=r.signal;try{(0,XG.setMaxListeners)?.(1/0,r.signal)}catch{}}try{const n=await this.components.dialer.dial(e,t);let r=this.connections.get(e.toString());null==r&&(r=[],this.connections.set(e.toString(),r));let s=!1;for(const e of r)e.id===n.id&&(s=!0);return s||r.push(n),n}finally{null!=r&&r.clear()}}async closeConnections(e){const t=this.connections.get(e.toString())??[];await Promise.all(t.map((async e=>await e.close())))}getAll(e){if(!Ru(e))throw je(new Error("peerId must be an instance of peer-id"),GG.ERR_INVALID_PARAMETERS);const t=e.toString(),n=this.connections.get(t);return null!=n?n.filter((e=>e.stat.status===dW)):[]}_onLatencyMeasure(e){const{detail:t}=e;this._checkMaxLimit("maxEventLoopDelay",t.avgMs,1).catch((e=>{EW.error(e)}))}async _checkMaxLimit(e,t,n=1){const r=this.opts[e];EW.trace("checking limit of %s. current value: %d of %d",e,t,r),t>r&&(EW("%s: limit exceeded: %p, %d/%d, pruning %d connection(s)",this.components.peerId,e,t,r,n),await this._pruneConnections(n))}async _pruneConnections(e){const t=this.getConnections(),n=new mW;for(const i of t){const e=i.remotePeer;if(n.has(e))continue;const t=await this.components.peerStore.getTags(e);n.set(e,t.reduce(((e,t)=>e+t.value),0))}const r=t.sort(((e,t)=>{const r=n.get(e.remotePeer)??0,s=n.get(t.remotePeer)??0;return r>s?1:r<s?-1:0})),s=[];for(const i of r)if(EW("too many connections open - closing a connection to %p",i.remotePeer),s.push(i),s.length===e)break;await Promise.all(s.map((async e=>{try{await e.close()}catch(uS){EW.error(uS)}this.onDisconnect(new yL("connectionEnd",{detail:e}))})))}async acceptIncomingConnection(e){const t=this.deny.some((t=>e.remoteAddr.toString().startsWith(t.toString())));if(t)return EW("connection from %s refused - connection remote address was in deny list",e.remoteAddr),!1;const n=this.allow.some((t=>e.remoteAddr.toString().startsWith(t.toString())));if(n)return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.opts.maxIncomingPendingConnections)return EW("connection from %s refused - incomingPendingConnections exceeded by peer %s",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const t=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(t,1)}catch{return EW("connection from %s refused - inboundConnectionThreshold exceeded by host %s",t,e.remoteAddr),!1}}return this.getConnections().length<this.opts.maxConnections?(this.incomingPendingConnections++,!0):(EW("connection from %s refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}}const CW=Fe("libp2p:connection-manager:auto-dialler"),IW={enabled:!0,minConnections:0,autoDialInterval:1e4};class RW{constructor(e,t){this.components=e,this.options=ne.call({ignoreUndefined:!0},IW,t),this.running=!1,this._autoDial=this._autoDial.bind(this),CW("options: %j",this.options)}isStarted(){return this.running}async start(){this.options.enabled?(this.running=!0,this._autoDial().catch((e=>{CW.error("could start autodial",e)})),CW("started")):CW("not enabled")}async stop(){this.options.enabled?(this.running=!1,null!=this.autoDialTimeout&&this.autoDialTimeout.clear(),CW("stopped")):CW("not enabled")}async _autoDial(){null!=this.autoDialTimeout&&this.autoDialTimeout.clear();const e=this.options.minConnections;if(this.components.connectionManager.getConnections().length>=e)return void(this.autoDialTimeout=hW(this._autoDial,this.options.autoDialInterval));const t=await this.components.peerStore.all(),n=await vm(t.sort((()=>Math.random()>.5?1:-1)),(e=>em(e,(e=>!e.id.equals(this.components.peerId)))),(e=>_P(e,((e,t)=>t.protocols.length>e.protocols.length||null!=t.id.publicKey&&null==e.id.publicKey?1:-1))),(async e=>await Qg(e)));for(let r=0;this.running&&r<n.length&&this.components.connectionManager.getConnections().length<e;r++){if(!this.running)return;const e=n[r];if(0===this.components.connectionManager.getConnections(e.id).length){CW("connecting to a peerStore stored peer %p",e.id);try{await this.components.connectionManager.openConnection(e.id)}catch(uS){CW.error("could not connect to peerStore stored peer",uS)}}}this.running&&(this.autoDialTimeout=hW(this._autoDial,this.options.autoDialInterval))}}var OW;(function(e){let t,n,r,s,i,o;(function(e){e["SUCCESS"]="SUCCESS",e["HOP_SRC_ADDR_TOO_LONG"]="HOP_SRC_ADDR_TOO_LONG",e["HOP_DST_ADDR_TOO_LONG"]="HOP_DST_ADDR_TOO_LONG",e["HOP_SRC_MULTIADDR_INVALID"]="HOP_SRC_MULTIADDR_INVALID",e["HOP_DST_MULTIADDR_INVALID"]="HOP_DST_MULTIADDR_INVALID",e["HOP_NO_CONN_TO_DST"]="HOP_NO_CONN_TO_DST",e["HOP_CANT_DIAL_DST"]="HOP_CANT_DIAL_DST",e["HOP_CANT_OPEN_DST_STREAM"]="HOP_CANT_OPEN_DST_STREAM",e["HOP_CANT_SPEAK_RELAY"]="HOP_CANT_SPEAK_RELAY",e["HOP_CANT_RELAY_TO_SELF"]="HOP_CANT_RELAY_TO_SELF",e["STOP_SRC_ADDR_TOO_LONG"]="STOP_SRC_ADDR_TOO_LONG",e["STOP_DST_ADDR_TOO_LONG"]="STOP_DST_ADDR_TOO_LONG",e["STOP_SRC_MULTIADDR_INVALID"]="STOP_SRC_MULTIADDR_INVALID",e["STOP_DST_MULTIADDR_INVALID"]="STOP_DST_MULTIADDR_INVALID",e["STOP_RELAY_REFUSED"]="STOP_RELAY_REFUSED",e["MALFORMED_MESSAGE"]="MALFORMED_MESSAGE"})(t=e.Status||(e.Status={})),function(e){e[e["SUCCESS"]=100]="SUCCESS",e[e["HOP_SRC_ADDR_TOO_LONG"]=220]="HOP_SRC_ADDR_TOO_LONG",e[e["HOP_DST_ADDR_TOO_LONG"]=221]="HOP_DST_ADDR_TOO_LONG",e[e["HOP_SRC_MULTIADDR_INVALID"]=250]="HOP_SRC_MULTIADDR_INVALID",e[e["HOP_DST_MULTIADDR_INVALID"]=251]="HOP_DST_MULTIADDR_INVALID",e[e["HOP_NO_CONN_TO_DST"]=260]="HOP_NO_CONN_TO_DST",e[e["HOP_CANT_DIAL_DST"]=261]="HOP_CANT_DIAL_DST",e[e["HOP_CANT_OPEN_DST_STREAM"]=262]="HOP_CANT_OPEN_DST_STREAM",e[e["HOP_CANT_SPEAK_RELAY"]=270]="HOP_CANT_SPEAK_RELAY",e[e["HOP_CANT_RELAY_TO_SELF"]=280]="HOP_CANT_RELAY_TO_SELF",e[e["STOP_SRC_ADDR_TOO_LONG"]=320]="STOP_SRC_ADDR_TOO_LONG",e[e["STOP_DST_ADDR_TOO_LONG"]=321]="STOP_DST_ADDR_TOO_LONG",e[e["STOP_SRC_MULTIADDR_INVALID"]=350]="STOP_SRC_MULTIADDR_INVALID",e[e["STOP_DST_MULTIADDR_INVALID"]=351]="STOP_DST_MULTIADDR_INVALID",e[e["STOP_RELAY_REFUSED"]=390]="STOP_RELAY_REFUSED",e[e["MALFORMED_MESSAGE"]=400]="MALFORMED_MESSAGE"}(n||(n={})),function(e){e.codec=()=>Ch(n)}(t=e.Status||(e.Status={})),function(e){e["HOP"]="HOP",e["STOP"]="STOP",e["STATUS"]="STATUS",e["CAN_HOP"]="CAN_HOP"}(r=e.Type||(e.Type={})),function(e){e[e["HOP"]=1]="HOP",e[e["STOP"]=2]="STOP",e[e["STATUS"]=3]="STATUS",e[e["CAN_HOP"]=4]="CAN_HOP"}(s||(s={})),function(e){e.codec=()=>Ch(s)}(r=e.Type||(e.Type={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{if(!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.id&&e.id.byteLength>0)&&(t.uint32(10),t.bytes(e.id)),null!=e.addrs)for(const r of e.addrs)t.uint32(18),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={id:new Uint8Array(0),addrs:[]},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.addrs.push(e.bytes());break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(i=e.Peer||(e.Peer={})),e.codec=()=>(null==o&&(o=Ih(((t,n,r={})=>{!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.Type.codec().encode(t.type,n)),null!=t.srcPeer&&(n.uint32(18),e.Peer.codec().encode(t.srcPeer,n,{writeDefaults:!1})),null!=t.dstPeer&&(n.uint32(26),e.Peer.codec().encode(t.dstPeer,n,{writeDefaults:!1})),null!=t.code&&(n.uint32(32),e.Status.codec().encode(t.code,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={},s=null==n?t.len:t.pos+n;while(t.pos<s){const n=t.uint32();switch(n>>>3){case 1:r.type=e.Type.codec().decode(t);break;case 2:r.srcPeer=e.Peer.codec().decode(t,t.uint32());break;case 3:r.dstPeer=e.Peer.codec().decode(t,t.uint32());break;case 4:r.code=e.Status.codec().decode(t);break;default:t.skipType(7&n);break}}return r}))),o),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(OW||(OW={}));const xW=Fe("libp2p:stream:converter");function NW(e,t={}){const{stream:n,remoteAddr:r}=e,{sink:s,source:i}=n,o=async function*(){for await(const e of i)yield*e}(),a={async sink(e){null!=t.signal&&(e=XF(e,t.signal));try{await s(e),await c()}catch(uS){"aborted"!==uS.type&&xW(uS)}},source:null!=t.signal?XF(o,t.signal):o,remoteAddr:r,timeline:{open:Date.now(),close:void 0},async close(){await s(async function*(){yield new Uint8Array(0)}()),await c()}};async function c(){return null==a.timeline.close&&(a.timeline.close=Date.now()),await Promise.resolve()}return a}const DW="/libp2p/circuit/relay/0.1.0";function PW(e){const t=new Map;async function n(n){const r=n.toString().split("/p2p-circuit").find((e=>""!==e)),i=dc(r),o=i.getPeerId();if(null==o)throw new Error("Could not determine relay peer from multiaddr");const a=Fu(o);await e.peerStore.addressBook.add(a,[i]);const c=await e.connectionManager.openConnection(a),l=c.remoteAddr.encapsulate("/p2p-circuit");t.set(c.remotePeer.toString(),l),s.dispatchEvent(new yL("listening"))}function r(){const e=[];for(const n of t.values())e.push(n);return e}const s=Object.assign(new gL,{close:async()=>await Promise.resolve(),listen:n,getAddrs:r});return e.connectionManager.addEventListener("peer:disconnect",(e=>{const{detail:n}=e,r=t.delete(n.remotePeer.toString());r&&s.dispatchEvent(new yL("close"))})),s}function LW(e,t){e.write({type:OW.Type.STATUS,code:t})}function MW(e,t){try{null!=e.dstPeer?.addrs&&e.dstPeer.addrs.forEach((e=>dc(e)))}catch(uS){throw LW(t,e.type===OW.Type.HOP?OW.Status.HOP_DST_MULTIADDR_INVALID:OW.Status.STOP_DST_MULTIADDR_INVALID),uS}try{null!=e.srcPeer?.addrs&&e.srcPeer.addrs.forEach((e=>dc(e)))}catch(uS){throw LW(t,e.type===OW.Type.HOP?OW.Status.HOP_SRC_MULTIADDR_INVALID:OW.Status.STOP_SRC_MULTIADDR_INVALID),uS}}function BW(e){const t=im(),n=dv(e.source),r=Ay();let s;const i=e.sink(async function*(){yield*t;const e=await r.promise;yield*e}());i.catch((e=>{s=e}));const o={sink:async e=>null!=s?await Promise.reject(s):(r.resolve(e),await i),source:n};return{reader:n,writer:t,stream:o,rest:()=>t.end(),write:t.push,read:async()=>{const e=await n.next();if(null!=e.value)return e.value}}}const UW=Fe("libp2p:circuit:stream-handler");class VW{constructor(e){const{stream:t,maxLength:n=4096}=e;this.stream=t,this.shake=BW(this.stream),this.decoder=cj.fromReader(this.shake.reader,{maxDataLength:n})}async read(){const e=await this.decoder.next();if(null!=e.value){const t=OW.decode(e.value);return UW("read message type",t.type),t}UW("read received no value, closing stream"),this.close()}write(e){UW("write message type %s",e.type),this.shake.write(rj.single(OW.encode(e)))}rest(){return this.shake.rest(),this.shake.stream}end(e){this.write(e),this.close()}close(){UW("closing the stream"),this.rest().sink([]).catch((e=>{UW.error(e)}))}}const FW=Fe("libp2p:circuit:stop");function jW(e){const{connection:t,request:n,streamHandler:r}=e;try{MW(n,r)}catch(uS){return void FW.error("invalid stop request via peer %p %o",t.remotePeer,uS)}return FW("stop request is valid"),r.write({type:OW.Type.STATUS,code:OW.Status.SUCCESS}),r.rest()}async function zW(e){const{connection:t,request:n,signal:r}=e,s=await t.newStream(DW,{signal:r});FW("starting stop request to %p",t.remotePeer);const i=new VW({stream:s});i.write(n);const o=await i.read();if(null!=o){if(o.code===OW.Status.SUCCESS)return FW("stop request to %p was successful",t.remotePeer),i.rest();FW("stop request failed with code %d",o.code),i.close()}else i.close()}const $W=Fe("libp2p:circuit:hop");async function HW(e){const{connection:t,request:n,streamHandler:r,circuit:s,connectionManager:i}=e;if(!s.hopEnabled())return $W("HOP request received but we are not acting as a relay"),r.end({type:OW.Type.STATUS,code:OW.Status.HOP_CANT_SPEAK_RELAY});try{MW(n,r)}catch(uS){return void $W.error("invalid hop request via peer %p %o",t.remotePeer,uS)}if(null==n.dstPeer)return void $W("HOP request received but we do not receive a dstPeer");const o=ju(n.dstPeer.id),a=i.getConnections(o);if(0===a.length&&!s.hopActive())return $W("HOP request received but we are not connected to the destination peer"),r.end({type:OW.Type.STATUS,code:OW.Status.HOP_NO_CONN_TO_DST});if(0===a.length)return $W("did not have connection to remote peer"),r.end({type:OW.Type.STATUS,code:OW.Status.HOP_NO_CONN_TO_DST});const c={type:OW.Type.STOP,dstPeer:n.dstPeer,srcPeer:n.srcPeer};let l;try{$W("performing STOP request");const e=await zW({connection:a[0],request:c});if(null==e)throw new Error("Could not stop");l=e}catch(uS){return void $W.error(uS)}$W("hop request from %p is valid",t.remotePeer),r.write({type:OW.Type.STATUS,code:OW.Status.SUCCESS});const u=r.rest();return $W("creating related connections"),await vm(u,l,u)}async function KW(e){const{connection:t,request:n,signal:r}=e,s=await t.newStream(DW,{signal:r}),i=new VW({stream:s});i.write(n);const o=await i.read();if(null==o)throw je(new Error("HOP request had no response"),GG.ERR_HOP_REQUEST_FAILED);if(o.code===OW.Status.SUCCESS)return $W("hop request was successful"),i.rest();throw $W("hop request failed with code %d, closing stream",o.code),i.close(),je(new Error(`HOP request failed with code "${o.code??"unknown"}"`),GG.ERR_HOP_REQUEST_FAILED)}async function qW(e){const{connection:t,signal:n}=e,r=await t.newStream(DW,{signal:n}),s=new VW({stream:r});s.write({type:OW.Type.CAN_HOP});const i=await s.read();return await s.close(),null!=i&&i.code===OW.Status.SUCCESS}function GW(e){const{connection:t,streamHandler:n,circuit:r}=e,s=r.hopEnabled();$W("can hop (%s) request from %p",s,t.remotePeer),n.end({type:OW.Type.STATUS,code:s?OW.Status.SUCCESS:OW.Status.HOP_CANT_SPEAK_RELAY})}const WW=Fe("libp2p:circuit");class YW{constructor(e,t){this._init=t,this.components=e,this._started=!1}isStarted(){return this._started}async start(){this._started||(this._started=!0,await this.components.registrar.handle(DW,(e=>{this._onProtocol(e).catch((e=>{WW.error(e)}))})).catch((e=>{WW.error(e)})))}async stop(){await this.components.registrar.unhandle(DW)}hopEnabled(){return!0}hopActive(){return!0}get[MG](){return!0}get[Symbol.toStringTag](){return"libp2p/circuit-relay-v1"}async _onProtocol(e){const{connection:t,stream:n}=e,r=new Ho.TimeoutController(this._init.hop.timeout);try{(0,XG.setMaxListeners)?.(1/0,r.signal)}catch{}try{const e=ej(n,r.signal),s=new VW({stream:{...n,...e}}),i=await s.read();if(null==i)return WW("request was invalid, could not read from stream"),s.write({type:OW.Type.STATUS,code:OW.Status.MALFORMED_MESSAGE}),void s.close();let o;switch(i.type){case OW.Type.CAN_HOP:WW("received CAN_HOP request from %p",t.remotePeer),await GW({circuit:this,connection:t,streamHandler:s});break;case OW.Type.HOP:WW("received HOP request from %p",t.remotePeer),await HW({connection:t,request:i,streamHandler:s,circuit:this,connectionManager:this.components.connectionManager});break;case OW.Type.STOP:WW("received STOP request from %p",t.remotePeer),o=await jW({connection:t,request:i,streamHandler:s});break;default:return WW("Request of type %s not supported",i.type),s.write({type:OW.Type.STATUS,code:OW.Status.MALFORMED_MESSAGE}),void s.close()}if(null!=o){const e=t.remoteAddr.encapsulate("/p2p-circuit").encapsulate(dc(i.dstPeer?.addrs[0])),n=dc(i.srcPeer?.addrs[0]),r=NW({stream:o,remoteAddr:e,localAddr:n}),s=i.type===OW.Type.HOP?"relay":"inbound";WW("new %s connection %s",s,r.remoteAddr);const a=await this.components.upgrader.upgradeInbound(r);WW("%s connection %s upgraded",s,r.remoteAddr),null!=this.handler&&this.handler(a)}}finally{r.clear()}}async dial(e,t={}){const n=e.toString().split("/p2p-circuit"),r=dc(n[0]),s=dc(n[n.length-1]),i=r.getPeerId(),o=s.getPeerId();if(null==i||null==o){const e="Circuit relay dial failed as addresses did not have peer id";throw WW.error(e),je(new Error(e),GG.ERR_RELAYED_DIAL)}const a=Fu(i),c=Fu(o);let l=!1;const u=this.components.connectionManager.getConnections(a);let h=u[0];null==h&&(await this.components.peerStore.addressBook.add(a,[r]),h=await this.components.connectionManager.openConnection(a,t),l=!0);try{const n=await KW({...t,connection:h,request:{type:OW.Type.HOP,srcPeer:{id:this.components.peerId.toBytes(),addrs:this.components.addressManager.getAddresses().map((e=>e.bytes))},dstPeer:{id:c.toBytes(),addrs:[dc(s).bytes]}}}),i=r.encapsulate(`/p2p-circuit/p2p/${this.components.peerId.toString()}`),o=NW({stream:n,remoteAddr:e,localAddr:i});return WW("new outbound connection %s",o.remoteAddr),await this.components.upgrader.upgradeOutbound(o)}catch(uS){throw WW.error("Circuit relay dial failed",uS),l&&await h.close(),uS}}createListener(e){return this.handler=e.handler,PW({connectionManager:this.components.connectionManager,peerStore:this.components.peerStore})}filter(e){return e=Array.isArray(e)?e:[e],e.filter((e=>Nc.matches(e)))}}async function JW(e){const t=(new TextEncoder).encode(e),n=await ho.digest(t);return Lt.createV0(n)}const QW=6e4,XW=15*QW,ZW=30*QW,eY=290,tY="hop_relay",nY="true",rY="/libp2p/relay";var sY=n(2346);const iY="[a-fA-F\\d:]",oY=e=>e&&e.includeBoundaries?`(?:(?<=\\s|^)(?=${iY})|(?<=${iY})(?=\\s|$))`:"",aY="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",cY="[a-fA-F\\d]{1,4}",lY=`\n(?:\n(?:${cY}:){7}(?:${cY}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${cY}:){6}(?:${aY}|:${cY}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${cY}:){5}(?::${aY}|(?::${cY}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${cY}:){4}(?:(?::${cY}){0,1}:${aY}|(?::${cY}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${cY}:){3}(?:(?::${cY}){0,2}:${aY}|(?::${cY}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${cY}:){2}(?:(?::${cY}){0,3}:${aY}|(?::${cY}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${cY}:){1}(?:(?::${cY}){0,4}:${aY}|(?::${cY}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${cY}){0,5}:${aY}|(?::${cY}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),uY=new RegExp(`(?:^${aY}$)|(?:^${lY}$)`),hY=new RegExp(`^${aY}$`),dY=new RegExp(`^${lY}$`),pY=e=>e&&e.exact?uY:new RegExp(`(?:${oY(e)}${aY}${oY(e)})|(?:${oY(e)}${lY}${oY(e)})`,"g");pY.v4=e=>e&&e.exact?hY:new RegExp(`${oY(e)}${aY}${oY(e)}`,"g"),pY.v6=e=>e&&e.exact?dY:new RegExp(`${oY(e)}${lY}${oY(e)}`,"g");var fY=pY,gY=n(3246);const{isValid:mY,parse:yY}=gY,wY=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],bY=wY.map((e=>new sY.Netmask(e)));function vY(e){for(let t of bY)if(t.contains(e))return!0;return!1}function EY(e){return/^::$/.test(e)||/^::1$/.test(e)||/^::f{4}:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^::f{4}:0.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(e)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(e)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(e)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(e)||/^ff([0-9a-fA-F]{2,2}):/i.test(e)}var _Y=e=>{if(mY(e)){const t=yY(e);if("ipv4"===t.kind())return vY(t.toNormalizedString());if("ipv6"===t.kind())return EY(e)}else if(sa(e)&&fY.v6().test(e))return EY(e)},SY=_Y;function kY(e){const{address:t}=e.nodeAddress();return Boolean(SY(t))}function AY(e,t){const n=kY(e.multiaddr),r=kY(t.multiaddr);return n&&!r?1:!n&&r||e.isCertified&&!t.isCertified?-1:!e.isCertified&&t.isCertified?1:0}const TY=Fe("libp2p:auto-relay"),CY=()=>{};class IY{constructor(e,t){this.components=e,this.addressSorter=t.addressSorter??AY,this.maxListeners=t.maxListeners??1,this.listenRelays=new Set,this.onError=t.onError??CY,this._onProtocolChange=this._onProtocolChange.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this),this.components.peerStore.addEventListener("change:protocols",(e=>{this._onProtocolChange(e).catch((e=>{TY.error(e)}))})),this.components.connectionManager.addEventListener("peer:disconnect",this._onPeerDisconnected)}async _onProtocolChange(e){const{peerId:t,protocols:n}=e.detail,r=t.toString(),s=n.find((e=>e===DW));if(null!=s){if(!this.listenRelays.has(r))try{const e=this.components.connectionManager.getConnections(t);if(0===e.length)return;const n=e[0];if(n.remoteAddr.protoCodes().includes(eY))return void TY(`relayed connection to ${r} will not be used to hop on`);const s=await qW({connection:n});s&&(await this.components.peerStore.metadataBook.setValue(t,tY,$o(nY)),await this._addListenRelay(n,r))}catch(uS){this.onError(uS)}}else this.listenRelays.has(r)&&await this._removeListenRelay(r)}_onPeerDisconnected(e){const t=e.detail,n=t.remotePeer,r=n.toString();this.listenRelays.has(r)&&this._removeListenRelay(r).catch((e=>{TY.error(e)}))}async _addListenRelay(e,t){try{if(this.listenRelays.size>=this.maxListeners)return;const n=await vm(await this.components.peerStore.addressBook.get(e.remotePeer),(e=>_P(e,this.addressSorter)),(async e=>await Qg(e))),r=await Promise.all(n.map((async t=>{try{let n=t.multiaddr;return null==n.getPeerId()&&(n=n.encapsulate(`/p2p/${e.remotePeer.toString()}`)),n=n.encapsulate("/p2p-circuit"),await this.components.transportManager.listen([n]),!0}catch(uS){TY.error("error listening on circuit address",uS),this.onError(uS)}return!1})));r.includes(!0)&&this.listenRelays.add(t)}catch(uS){this.onError(uS),this.listenRelays.delete(t)}}async _removeListenRelay(e){this.listenRelays.delete(e)&&await this._listenOnAvailableHopRelays([e])}async _listenOnAvailableHopRelays(e=[]){if(this.listenRelays.size>=this.maxListeners)return;const t=[],n=await this.components.peerStore.all();for(const{id:r,metadata:s}of n){const n=r.toString();if(this.listenRelays.has(n))continue;if(e.includes(n))continue;const i=s.get(tY);if(null==i||ia(i)!==nY)continue;const o=this.components.connectionManager.getConnections(r);if(0!==o.length){if(await this._addListenRelay(o[0],n),this.listenRelays.size>=this.maxListeners)return}else t.push(r)}for(const r of t)if(await this._tryToListenOnRelay(r),this.listenRelays.size>=this.maxListeners)return;try{const e=await JW(rY);for await(const t of this.components.contentRouting.findProviders(e)){if(0===t.multiaddrs.length)continue;const e=t.id;if(!e.equals(this.components.peerId)&&(await this.components.peerStore.addressBook.add(e,t.multiaddrs),await this._tryToListenOnRelay(e),this.listenRelays.size>=this.maxListeners))return}}catch(uS){this.onError(uS)}}async _tryToListenOnRelay(e){try{const t=await this.components.connectionManager.openConnection(e);await this._addListenRelay(t,e.toString())}catch(uS){TY.error("Could not use %p as relay",e,uS),this.onError(uS,`could not connect and listen on known hop relay ${e.toString()}`)}}}const RY=Fe("libp2p:relay");class OY{constructor(e,t){this.components=e,this.autoRelay=!1!==t.autoRelay?.enabled?new IY(e,{addressSorter:t.addressSorter,...t.autoRelay}):void 0,this.started=!1,this.init=t,this._advertiseService=this._advertiseService.bind(this)}isStarted(){return this.started}async start(){!1!==this.init.hop.enabled&&!1!==this.init.advertise.enabled&&(this.timeout=(0,QG.setDelayedInterval)(this._advertiseService,this.init.advertise.ttl,this.init.advertise.bootDelay)),this.started=!0}async stop(){null!=this.timeout&&(0,QG.clearDelayedInterval)(this.timeout),this.started=!1}async _advertiseService(){try{const e=await JW(rY);await this.components.contentRouting.provide(e)}catch(uS){uS.code===GG.ERR_NO_ROUTERS_AVAILABLE?(RY.error("a content router, such as a DHT, must be provided in order to advertise the relay service",uS),await this.stop()):RY.error(uS)}}}var xY=n(4203);n(4669),n(4760);const NY=Rh.pki,DY=(e,t)=>{const n=NY.rsa.setPublicKey(t.n,t.e),r=NY.createCertificate();r.publicKey=n,r.serialNumber="01",r.validity.notBefore=new Date,r.validity.notAfter=new Date,r.validity.notAfter.setFullYear(r.validity.notBefore.getFullYear()+10);const s=[{name:"organizationName",value:"ipfs"},{shortName:"OU",value:"keystore"},{name:"commonName",value:e.id}];return r.setSubject(s),r.setIssuer(s),r.setExtensions([{name:"basicConstraints",cA:!0},{name:"keyUsage",keyCertSign:!0,digitalSignature:!0,nonRepudiation:!0,keyEncipherment:!0,dataEncipherment:!0},{name:"extKeyUsage",serverAuth:!0,clientAuth:!0,codeSigning:!0,emailProtection:!0,timeStamping:!0},{name:"nsCertType",client:!0,server:!0,email:!0,objsign:!0,sslCA:!0,emailCA:!0,objCA:!0}]),r.sign(t),r};async function PY(e,t){const n=e.map(t),r=await Promise.all(n),s=r.findIndex((e=>e));return e[s]}const LY=Fe("libp2p:keychain:cms"),MY=new WeakMap;class BY{constructor(e,t){if(null==e)throw je(new Error("keychain is required"),GG.ERR_KEYCHAIN_REQUIRED);this.keychain=e,MY.set(this,{dek:t})}async encrypt(e,t){if(!(t instanceof Uint8Array))throw je(new Error("Plain data must be a Uint8Array"),GG.ERR_INVALID_PARAMETERS);const n=await this.keychain.findKeyByName(e),r=await this.keychain.getPrivateKey(e),s=MY.get(this);if(null==s)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const i=s.dek,o=Rh.pki.decryptRsaPrivateKey(r,i),a=await DY(n,o),c=Rh.pkcs7.createEnvelopedData();c.addRecipient(a),c.content=Rh.util.createBuffer(t),c.encrypt();const l=Rh.asn1.toDer(c.toAsn1()).getBytes();return $o(l,"ascii")}async decrypt(e){if(!(e instanceof Uint8Array))throw je(new Error("CMS data is required"),GG.ERR_INVALID_PARAMETERS);let t;try{const n=Rh.util.createBuffer(ia(e,"ascii")),r=Rh.asn1.fromDer(n);t=Rh.pkcs7.messageFromAsn1(r)}catch(uS){throw LY.error(uS),je(new Error("Invalid CMS"),GG.ERR_INVALID_CMS)}const n=t.recipients.filter((e=>e.issuer.find((e=>"O"===e.shortName&&"ipfs"===e.value)))).filter((e=>e.issuer.find((e=>"CN"===e.shortName)))).map((e=>({recipient:e,keyId:e.issuer.find((e=>"CN"===e.shortName)).value}))),r=await PY(n,(async e=>{try{const t=await this.keychain.findKeyById(e.keyId);if(null!=t)return!0}catch(uS){return!1}return!1}));if(null==r){const e=n.map((e=>e.keyId));throw je(new Error(`Decryption needs one of the key(s): ${e.join(", ")}`),GG.ERR_MISSING_KEYS,{missingKeys:e})}const s=await this.keychain.findKeyById(r.keyId);if(null==s)throw je(new Error("No key available to decrypto"),GG.ERR_NO_KEY);const i=await this.keychain.getPrivateKey(s.name),o=MY.get(this);if(null==o)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const a=o.dek,c=Rh.pki.decryptRsaPrivateKey(i,a);return t.decrypt(r.recipient,c),$o(t.content.getBytes(),"ascii")}}const UY=Fe("libp2p:keychain"),VY="/pkcs8/",FY="/info/",jY=new WeakMap,zY={minKeyLength:14,minSaltLength:16,minIterationCount:1e3},$Y={dek:{keyLength:64,iterationCount:1e4,salt:"you should override this value with a crypto secure random number",hash:"sha2-512"}};function HY(e){return null!=e&&("string"===typeof e&&(e===xY(e.trim())&&e.length>0))}async function KY(){const e=200,t=1e3,n=Math.random()*(t-e)+e;await new Promise((e=>setTimeout(e,n)))}function qY(e){return new rl(VY+e)}function GY(e){return new rl(FY+e)}class WY{constructor(e,t){if(this.components=e,this.init=ne($Y,t),null!=this.init.pass&&this.init.pass?.length<20)throw new Error("pass must be least 20 characters");if(null!=this.init.dek?.keyLength&&this.init.dek.keyLength<zY.minKeyLength)throw new Error(`dek.keyLength must be least ${zY.minKeyLength} bytes`);if(null!=this.init.dek?.salt?.length&&this.init.dek.salt.length<zY.minSaltLength)throw new Error(`dek.saltLength must be least ${zY.minSaltLength} bytes`);if(null!=this.init.dek?.iterationCount&&this.init.dek.iterationCount<zY.minIterationCount)throw new Error(`dek.iterationCount must be least ${zY.minIterationCount}`);const n=null!=this.init.pass&&null!=this.init.dek?.salt?$U(this.init.pass,this.init.dek?.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";jY.set(this,{dek:n}),this.started=!1}isStarted(){return this.started}async start(){const e=GY("self");await this.components.datastore.has(e)||await this.importPeer("self",this.components.peerId),this.started=!0}stop(){this.started=!1}get cms(){const e=jY.get(this);if(null==e)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const t=e.dek;return new BY(this,t)}static generateOptions(){const e=Object.assign({},$Y),t=3*Math.ceil(zY.minSaltLength/3);return e.dek.salt=ia(Kd(t),"base64"),e}static get options(){return $Y}async createKey(e,t,n=2048){if(!HY(e)||"self"===e)throw await KY(),je(new Error("Invalid key name"),GG.ERR_INVALID_KEY_NAME);if("string"!==typeof t)throw await KY(),je(new Error("Invalid key type"),GG.ERR_INVALID_KEY_TYPE);const r=qY(e),s=await this.components.datastore.has(r);if(s)throw await KY(),je(new Error("Key name already exists"),GG.ERR_KEY_ALREADY_EXISTS);switch(t.toLowerCase()){case"rsa":if(!Number.isSafeInteger(n)||n<2048)throw await KY(),je(new Error("Invalid RSA key size"),GG.ERR_INVALID_KEY_SIZE);break;default:break}let i;try{const s=await qf(t,n),o=await s.id(),a=jY.get(this);if(null==a)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const c=a.dek,l=await s.export(c);i={name:e,id:o};const u=this.components.datastore.batch();u.put(r,$o(l)),u.put(GY(e),$o(JSON.stringify(i))),await u.commit()}catch(uS){throw await KY(),uS}return i}async listKeys(){const e={prefix:FY},t=[];for await(const n of this.components.datastore.query(e))t.push(JSON.parse(ia(n.value)));return t}async findKeyById(e){try{const t=await this.listKeys();return t.find((t=>t.id===e))}catch(uS){throw await KY(),uS}}async findKeyByName(e){if(!HY(e))throw await KY(),je(new Error(`Invalid key name '${e}'`),GG.ERR_INVALID_KEY_NAME);const t=GY(e);try{const e=await this.components.datastore.get(t);return JSON.parse(ia(e))}catch(uS){throw await KY(),UY.error(uS),je(new Error(`Key '${e}' does not exist.`),GG.ERR_KEY_NOT_FOUND)}}async removeKey(e){if(!HY(e)||"self"===e)throw await KY(),je(new Error(`Invalid key name '${e}'`),GG.ERR_INVALID_KEY_NAME);const t=qY(e),n=await this.findKeyByName(e),r=this.components.datastore.batch();return r.delete(t),r.delete(GY(e)),await r.commit(),n}async renameKey(e,t){if(!HY(e)||"self"===e)throw await KY(),je(new Error(`Invalid old key name '${e}'`),GG.ERR_OLD_KEY_NAME_INVALID);if(!HY(t)||"self"===t)throw await KY(),je(new Error(`Invalid new key name '${t}'`),GG.ERR_NEW_KEY_NAME_INVALID);const n=qY(e),r=qY(t),s=GY(e),i=GY(t),o=await this.components.datastore.has(r);if(o)throw await KY(),je(new Error(`Key '${t}' already exists`),GG.ERR_KEY_ALREADY_EXISTS);try{const e=await this.components.datastore.get(n),o=await this.components.datastore.get(s),a=JSON.parse(ia(o));a.name=t;const c=this.components.datastore.batch();return c.put(r,e),c.put(i,$o(JSON.stringify(a))),c.delete(n),c.delete(s),await c.commit(),a}catch(uS){throw await KY(),uS}}async exportKey(e,t){if(!HY(e))throw await KY(),je(new Error(`Invalid key name '${e}'`),GG.ERR_INVALID_KEY_NAME);if(null==t)throw await KY(),je(new Error("Password is required"),GG.ERR_PASSWORD_REQUIRED);const n=qY(e);try{const e=await this.components.datastore.get(n),r=ia(e),s=jY.get(this);if(null==s)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const i=s.dek,o=await Qf(r,i);return await o.export(t)}catch(uS){throw await KY(),uS}}async importKey(e,t,n){if(!HY(e)||"self"===e)throw await KY(),je(new Error(`Invalid key name '${e}'`),GG.ERR_INVALID_KEY_NAME);if(null==t)throw await KY(),je(new Error("PEM encoded key is required"),GG.ERR_PEM_REQUIRED);const r=qY(e),s=await this.components.datastore.has(r);if(s)throw await KY(),je(new Error(`Key '${e}' already exists`),GG.ERR_KEY_ALREADY_EXISTS);let i,o;try{i=await Qf(t,n)}catch(uS){throw await KY(),je(new Error("Cannot read the key, most likely the password is wrong"),GG.ERR_CANNOT_READ_KEY)}try{o=await i.id();const e=jY.get(this);if(null==e)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const n=e.dek;t=await i.export(n)}catch(uS){throw await KY(),uS}const a={name:e,id:o},c=this.components.datastore.batch();return c.put(r,$o(t)),c.put(GY(e),$o(JSON.stringify(a))),await c.commit(),a}async importPeer(e,t){try{if(!HY(e))throw je(new Error(`Invalid key name '${e}'`),GG.ERR_INVALID_KEY_NAME);if(null==t)throw je(new Error("PeerId is required"),GG.ERR_MISSING_PRIVATE_KEY);if(null==t.privateKey)throw je(new Error("PeerId.privKey is required"),GG.ERR_MISSING_PRIVATE_KEY);const n=await Yf(t.privateKey),r=qY(e),s=await this.components.datastore.has(r);if(s)throw await KY(),je(new Error(`Key '${e}' already exists`),GG.ERR_KEY_ALREADY_EXISTS);const i=jY.get(this);if(null==i)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const o=i.dek,a=await n.export(o),c={name:e,id:t.toString()},l=this.components.datastore.batch();return l.put(r,$o(a)),l.put(GY(e),$o(JSON.stringify(c))),await l.commit(),c}catch(uS){throw await KY(),uS}}async getPrivateKey(e){if(!HY(e))throw await KY(),je(new Error(`Invalid key name '${e}'`),GG.ERR_INVALID_KEY_NAME);try{const t=qY(e),n=await this.components.datastore.get(t);return ia(n)}catch(uS){throw await KY(),UY.error(uS),je(new Error(`Key '${e}' does not exist.`),GG.ERR_KEY_NOT_FOUND)}}async rotateKeychainPass(e,t){if("string"!==typeof e)throw await KY(),je(new Error(`Invalid old pass type '${typeof e}'`),GG.ERR_INVALID_OLD_PASS_TYPE);if("string"!==typeof t)throw await KY(),je(new Error(`Invalid new pass type '${typeof t}'`),GG.ERR_INVALID_NEW_PASS_TYPE);if(t.length<20)throw await KY(),je(new Error(`Invalid pass length ${t.length}`),GG.ERR_INVALID_PASS_LENGTH);UY("recreating keychain");const n=jY.get(this);if(null==n)throw je(new Error("dek missing"),GG.ERR_INVALID_PARAMETERS);const r=n.dek;this.init.pass=t;const s=null!=t&&null!=this.init.dek?.salt?$U(t,this.init.dek.salt,this.init.dek?.iterationCount,this.init.dek?.keyLength,this.init.dek?.hash):"";jY.set(this,{dek:s});const i=await this.listKeys();for(const o of i){const e=await this.components.datastore.get(qY(o.name)),t=ia(e),n=await Qf(t,r),i=s.toString(),a=await n.export(i),c=this.components.datastore.batch(),l={name:o.name,id:o.id};c.put(qY(o.name),$o(a)),c.put(GY(o.name),$o(JSON.stringify(l))),await c.commit()}UY("keychain reconstructed")}}async function*YY(e,t){for await(const n of e)await t(n),yield n}const JY=3e4,QY=3e4,XY=100,ZY=4,eJ=25,tJ={computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50};class nJ{constructor(e){if("number"!==typeof e)throw new Error("must provide a timespan to the moving average constructor");if(e<=0)throw new Error("must provide a timespan > 0 to the moving average constructor");this.timespan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timespan)}push(e,t){if(null!=this.previousTime){const n=this.alpha(e,this.previousTime),r=t-this.movingAverage,s=n*r;this.movingAverage=n*t+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+r*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*r}else this.movingAverage=t;this.previousTime=e}}function rJ(e){return new nJ(e)}class sJ extends gL{constructor(e){super(),this.enabled=e.enabled,this.queue=[],this.stats={dataReceived:0n,dataSent:0n},this.frequencyLastTime=Date.now(),this.frequencyAccumulators={},this.movingAverages={dataReceived:[],dataSent:[]},this.computeThrottleMaxQueueSize=e.computeThrottleMaxQueueSize,this.computeThrottleTimeout=e.computeThrottleTimeout,this._update=this._update.bind(this),this.movingAverageIntervals=e.movingAverageIntervals;for(let t=0;t<e.initialCounters.length;t++){const n=e.initialCounters[t];this.stats[n]=0n,this.movingAverages[n]=[];for(let e=0;e<this.movingAverageIntervals.length;e++){const t=this.movingAverageIntervals[e],r=this.movingAverages[n][t]=rJ(t);r.push(this.frequencyLastTime,0)}}}start(){this.enabled&&this.queue.length>0&&this._resetComputeTimeout()}stop(){null!=this.timeout&&(this.timeout.clear(),this.timeout=null)}getSnapshot(){return Object.assign({},this.stats)}getMovingAverages(){return Object.assign({},this.movingAverages)}push(e,t){this.queue.push([e,t,Date.now()]),this._resetComputeTimeout()}_resetComputeTimeout(){this.timeout=hW(this._update,this._nextTimeout())}_nextTimeout(){const e=this.queue.length/this.computeThrottleMaxQueueSize,t=Math.max(this.computeThrottleTimeout*(1-e),0);return t}_update(){if(this.timeout=null,this.queue.length>0){let e=["",0,0];for(e of this.queue)this._applyOp(e);this.queue=[],e.length>2&&""!==e[0]&&this._updateFrequency(e[2]),this.dispatchEvent(new yL("update",{detail:this.stats}))}}_updateFrequency(e){const t=e-this.frequencyLastTime;this._updateFrequencyFor("dataReceived",t,e),this._updateFrequencyFor("dataSent",t,e),this.frequencyLastTime=e}_updateFrequencyFor(e,t,n){const r=this.frequencyAccumulators[e]??0;this.frequencyAccumulators[e]=0;const s=t??1,i=r/s*1e3;let o=this.movingAverages[e];null==o&&(o=this.movingAverages[e]=[]);const a=this.movingAverageIntervals;for(let c=0;c<a.length;c++){const e=a[c];let t=o[e];null==t&&(t=o[e]=rJ(e)),t.push(n,i)}}_applyOp(e){const t=e[0],n=e[1];if("number"!==typeof n)throw new Error("invalid increment number");let r;r=Object.prototype.hasOwnProperty.call(this.stats,t)?this.stats[t]:this.stats[t]=0n,this.stats[t]=r+BigInt(n),null==this.frequencyAccumulators[t]&&(this.frequencyAccumulators[t]=0),this.frequencyAccumulators[t]+=n}}const iJ=["dataReceived","dataSent"],oJ={in:"dataReceived",out:"dataSent"};class aJ{constructor(e){this.enabled=e.enabled,this.statsInit={...e,initialCounters:iJ},this.globalStats=new sJ(this.statsInit),this.peerStats=new Map,this.protocolStats=new Map,this.oldPeers=Rl(e.maxOldPeersRetention??tJ.maxOldPeersRetention),this.running=!1,this._onMessage=this._onMessage.bind(this),this.systems=new Map}isStarted(){return this.running}async start(){this.enabled&&(this.running=!0)}async stop(){if(this.running){this.running=!1,this.globalStats.stop();for(const e of this.peerStats.values())e.stop();for(const e of this.protocolStats.values())e.stop()}}getGlobal(){return this.globalStats}getPeers(){return Array.from(this.peerStats.keys())}getComponentMetrics(){return this.systems}updateComponentMetric(e){const{system:t="libp2p",component:n,metric:r,value:s,label:i,help:o}=e;this.systems.has(t)||this.systems.set(t,new Map);const a=this.systems.get(t);if(null==a)throw new Error("Unknown metric system");a.has(n)||a.set(n,new Map);const c=a.get(n);if(null==c)throw new Error("Unknown metric component");c.set(r,{label:i,help:o,calculate:"function"!==typeof s?()=>s:s})}forPeer(e){const t=e.toString();return this.peerStats.get(t)??this.oldPeers.get(t)}getProtocols(){return Array.from(this.protocolStats.keys())}forProtocol(e){return this.protocolStats.get(e)}onPeerDisconnected(e){const t=e.toString(),n=this.peerStats.get(t);null!=n&&(n.stop(),this.peerStats.delete(t),this.oldPeers.set(t,n))}_onMessage(e){if(!this.running)return;const{remotePeer:t,protocol:n,direction:r,dataLength:s}=e,i=oJ[r];let o=this.forPeer(t);if(null==o){const e=new sJ(this.statsInit);this.peerStats.set(t.toString(),e),o=e}if(o.push(i,s),this.globalStats.push(i,s),null!=n){let e=this.forProtocol(n);if(null==e){const t=new sJ(this.statsInit);this.protocolStats.set(n,t),e=t}e.push(i,s)}}updatePlaceholder(e,t){if(!this.running)return;const n=e.toString(),r=this.peerStats.get(n)??this.oldPeers.get(n),s=t.toString(),i=this.peerStats.get(s)??this.oldPeers.get(s);let o=r;null!=i&&(o=cJ(i,o),this.oldPeers.remove(s)),this.peerStats.delete(e.toString()),this.peerStats.set(s,o),o.start()}trackStream(e){const{stream:t,remotePeer:n,protocol:r}=e;if(!this.running)return;const s=t.source;t.source=YY(s,(e=>this._onMessage({remotePeer:n,protocol:r,direction:"in",dataLength:e.byteLength})));const i=t.sink;t.sink=async e=>await vm(e,(e=>YY(e,(e=>{this._onMessage({remotePeer:n,protocol:r,direction:"out",dataLength:e.byteLength})}))),i)}}function cJ(e,t){return e.stop(),t.stop(),e.queue=[...e.queue,...t.queue],e}async function lJ(e){try{const t=await e;return{status:"fulfilled",value:t,isFulfilled:!0,isRejected:!1}}catch(t){return{status:"rejected",reason:t,isFulfilled:!1,isRejected:!0}}}function uJ(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function hJ(e,t,n){uJ(e,t),t.set(e,n)}function dJ(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}function pJ(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}function fJ(e,t,n){var r=pJ(e,t,"set");return dJ(e,r,n),n}function gJ(e,t){return t.get?t.get.call(e):t.value}function mJ(e,t){var n=pJ(e,t,"get");return gJ(e,n)}let yJ;class wJ{constructor(e){Wo(this,"value",void 0),Wo(this,"next",void 0),this.value=e}}var bJ=new WeakMap,vJ=new WeakMap,EJ=new WeakMap;yJ=Symbol.iterator;class _J{constructor(){hJ(this,bJ,{writable:!0,value:void 0}),hJ(this,vJ,{writable:!0,value:void 0}),hJ(this,EJ,{writable:!0,value:void 0}),this.clear()}enqueue(e){var t;const n=new wJ(e);mJ(this,bJ)?(mJ(this,vJ).next=n,fJ(this,vJ,n)):(fJ(this,bJ,n),fJ(this,vJ,n)),fJ(this,EJ,(t=mJ(this,EJ),t++,t))}dequeue(){var e;const t=mJ(this,bJ);if(t)return fJ(this,bJ,mJ(this,bJ).next),fJ(this,EJ,(e=mJ(this,EJ),e--,e)),t.value}clear(){fJ(this,bJ,void 0),fJ(this,vJ,void 0),fJ(this,EJ,0)}get size(){return mJ(this,EJ)}*[yJ](){let e=mJ(this,bJ);while(e)yield e.value,e=e.next}}function SJ(e){if(!Number.isInteger(e)&&e!==Number.POSITIVE_INFINITY||!(e>0))throw new TypeError("Expected `concurrency` to be a number from 1 and up");const t=new _J;let n=0;const r=()=>{n--,t.size>0&&t.dequeue()()},s=async(e,t,s)=>{n++;const i=(async()=>e(...s))();t(i);try{await i}catch{}r()},i=(r,i,o)=>{t.enqueue(s.bind(void 0,r,i,o)),(async()=>{await Promise.resolve(),n<e&&t.size>0&&t.dequeue()()})()},o=(e,...t)=>new Promise((n=>{i(e,n,t)}));return Object.defineProperties(o,{activeCount:{get:()=>n},pendingCount:{get:()=>t.size},clearQueue:{value:()=>{t.clear()}}}),o}async function kJ(e,t={}){const{concurrency:n=Number.POSITIVE_INFINITY}=t,r=SJ(n);return Promise.all(e.map((e=>e&&"function"===typeof e.then?lJ(e):lJ("function"===typeof e?r((()=>e())):Promise.resolve(e)))))}class AJ extends Map{constructor(e){super();const{system:t,component:n,metric:r,metrics:s}=e;this.system=t??"libp2p",this.component=n,this.metric=r,this.metrics=s,this.updateComponentMetric()}set(e,t){return super.set(e,t),this.updateComponentMetric(),this}delete(e){const t=super.delete(e);return this.updateComponentMetric(),t}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metrics.updateComponentMetric({system:this.system,component:this.component,metric:this.metric,value:this.size})}}function TJ(e){const{system:t,component:n,metric:r,metrics:s}=e;let i;return i=null!=s?new AJ({system:t,component:n,metric:r,metrics:s}):new Map,i}const CJ=Fe("libp2p:transports");class IJ extends gL{constructor(e,t={}){super(),this.components=e,this.started=!1,this.transports=new Map,this.listeners=TJ({component:"transport-manager",metric:"listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??RJ.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(null==t)throw je(new Error("Transport must have a valid tag"),GG.ERR_INVALID_KEY);if(this.transports.has(t))throw je(new Error("There is already a transport with this tag"),GG.ERR_DUPLICATE_TRANSPORT);CJ("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}async start(){const e=this.components.addressManager.getListenAddrs();await this.listen(e),this.started=!0}async stop(){const e=[];for(const[t,n]of this.listeners){CJ("closing listeners for %s",t);while(n.length>0){const t=n.pop();null!=t&&e.push(t.close())}}await Promise.all(e),CJ("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){const n=this.transportForMultiaddr(e);if(null==n)throw je(new Error(`No transport available for address ${String(e)}`),GG.ERR_TRANSPORT_UNAVAILABLE);try{return await n.dial(e,{...t,upgrader:this.components.upgrader})}catch(uS){throw null==uS.code&&(uS.code=GG.ERR_TRANSPORT_DIAL_FAILED),uS}}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}transportForMultiaddr(e){for(const t of this.transports.values()){const n=t.filter([e]);if(n.length>0)return t}}async listen(e){if(null==e||0===e.length)return void CJ("no addresses were provided for listening, this node is dial only");const t=[];for(const[n,r]of this.transports.entries()){const s=r.filter(e),i=[];for(const e of s){CJ("creating listener for %s on %s",n,e);const t=r.createListener({upgrader:this.components.upgrader});let s=this.listeners.get(n);null==s&&(s=[],this.listeners.set(n,s)),s.push(t),t.addEventListener("listening",(()=>{this.dispatchEvent(new yL("listener:listening",{detail:t}))})),t.addEventListener("close",(()=>{this.dispatchEvent(new yL("listener:close",{detail:t}))})),i.push(t.listen(e))}if(0===i.length){t.push(n);continue}const o=await kJ(i),a=o.find((e=>e.isFulfilled));if(null==a&&this.faultTolerance!==RJ.NO_FATAL)throw je(new Error(`Transport (${n}) could not listen on any available address`),GG.ERR_NO_VALID_ADDRESSES)}if(t.length===this.transports.size){const e=`no valid addresses were provided for transports [${t.join(", ")}]`;if(this.faultTolerance===RJ.FATAL_ALL)throw je(new Error(e),GG.ERR_NO_VALID_ADDRESSES);CJ(`libp2p in dial mode only: ${e}`)}}async remove(e){CJ("removing %s",e);for(const t of this.listeners.get(e)??[])await t.close();this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}var RJ;(function(e){e[e["FATAL_ALL"]=0]="FATAL_ALL",e[e["NO_FATAL"]=1]="NO_FATAL"})(RJ||(RJ={}));const OJ="/multistream/1.0.0",xJ=1024,NJ=Fe("libp2p:mss"),DJ=$o("\n");function PJ(e){const t=new Aw(e,DJ);return rj.single(t)}function LJ(e,t,n={}){const r=PJ(t);!0===n.writeBytes?e.push(r.subarray()):e.push(r)}function MJ(e,t,n={}){const r=new Aw;for(const s of t)r.append(PJ(s));!0===n.writeBytes?e.push(r.subarray()):e.push(r)}async function BJ(e,t){let n=1;const r={[Symbol.asyncIterator]:()=>r,next:async()=>await e.next(n)};let s=r;null!=t?.signal&&(s=XF(r,t.signal));const i=e=>{n=e},o=await vm(s,cj({onLength:i,maxDataLength:xJ}),(async e=>await rI(e)));if(null==o||0===o.length)throw je(new Error("no buffer returned"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");if(o.get(o.byteLength-1)!==DJ[0])throw NJ.error("Invalid mss message - missing newline - %s",o.subarray()),je(new Error("missing newline"),"ERR_INVALID_MULTISTREAM_SELECT_MESSAGE");return o.sublist(0,-1)}async function UJ(e,t){const n=await BJ(e,t);return ia(n.subarray())}const VJ=Fe("libp2p:mss:select");async function FJ(e,t,n={}){t=Array.isArray(t)?[...t]:[t];const{reader:r,writer:s,rest:i,stream:o}=BW(e),a=t.shift();if(null==a)throw new Error("At least one protocol must be specified");VJ('select: write ["%s", "%s"]',OJ,a);const c=$o(OJ),l=$o(a);MJ(s,[c,l],n);let u=await UJ(r,n);if(VJ('select: read "%s"',u),u===OJ&&(u=await UJ(r,n),VJ('select: read "%s"',u)),u===a)return i(),{stream:o,protocol:a};for(const h of t){VJ('select: write "%s"',h),LJ(s,$o(h),n);const e=await UJ(r,n);if(VJ('select: read "%s" for "%s"',e,h),e===h)return i(),{stream:o,protocol:h}}throw i(),je(new Error("protocol selection failed"),"ERR_UNSUPPORTED_PROTOCOL")}const jJ=Fe("libp2p:mss:handle");async function zJ(e,t,n){t=Array.isArray(t)?t:[t];const{writer:r,reader:s,rest:i,stream:o}=BW(e);while(1){const e=await UJ(s,n);if(jJ('read "%s"',e),e!==OJ){if(t.includes(e))return LJ(r,$o(e),n),jJ('respond with "%s" for "%s"',e,e),i(),{stream:o,protocol:e};"ls"!==e?(LJ(r,$o("na"),n),jJ('respond with "na" for "%s"',e)):(LJ(r,new Aw(...t.map((e=>PJ($o(e))))),n),jJ('respond with "%s" for %s',t,e))}else jJ('respond with "%s" for "%s"',OJ,e),LJ(r,$o(OJ),n)}}var $J=n(2163);const HJ=Symbol.for("@libp2p/connection");const KJ=Fe("libp2p:connection");class qJ{constructor(e){const{remoteAddr:t,remotePeer:n,newStream:r,close:s,getStreams:i,stat:o}=e;this.id=`${parseInt(String(1e9*Math.random())).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.stat={...o,status:dW},this._newStream=r,this._close=s,this._getStreams=i,this.tags=[],this._closing=!1}get[Symbol.toStringTag](){return"Connection"}get[HJ](){return!0}get streams(){return this._getStreams()}async newStream(e,t){if(this.stat.status===pW)throw je(new Error("the connection is being closed"),"ERR_CONNECTION_BEING_CLOSED");if(this.stat.status===fW)throw je(new Error("the connection is closed"),"ERR_CONNECTION_CLOSED");Array.isArray(e)||(e=[e]);const n=await this._newStream(e,t);return n.stat.direction="outbound",n}addStream(e){e.stat.direction="inbound"}removeStream(e){}async close(){if(this.stat.status!==fW&&!this._closing){this.stat.status=pW;try{this.streams.forEach((e=>e.close()))}catch(uS){KJ.error(uS)}this._closing=!0,await this._close(),this._closing=!1,this.stat.timeline.close=Date.now(),this.stat.status=fW}}}function GJ(e){return new qJ(e)}const WJ=Fe("libp2p:registrar"),YJ=32,JJ=64;class QJ{constructor(e){this.topologies=new Map,this.handlers=new Map,this.components=e,this._onDisconnect=this._onDisconnect.bind(this),this._onProtocolChange=this._onProtocolChange.bind(this),this.components.connectionManager.addEventListener("peer:disconnect",this._onDisconnect),this.components.peerStore.addEventListener("change:protocols",this._onProtocolChange)}getProtocols(){return Array.from(new Set([...this.topologies.keys(),...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(null==t)throw je(new Error(`No handler registered for protocol ${e}`),GG.ERR_NO_HANDLER_FOR_PROTOCOL);return t}getTopologies(e){const t=this.topologies.get(e);return null==t?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e))throw je(new Error(`Handler already registered for protocol ${e}`),GG.ERR_PROTOCOL_HANDLER_ALREADY_REGISTERED);const r=ne.bind({ignoreUndefined:!0})({maxInboundStreams:YJ,maxOutboundStreams:JJ},n);this.handlers.set(e,{handler:t,options:r}),await this.components.peerStore.protoBook.add(this.components.peerId,[e])}async unhandle(e){const t=Array.isArray(e)?e:[e];t.forEach((e=>{this.handlers.delete(e)})),await this.components.peerStore.protoBook.remove(this.components.peerId,t)}async register(e,t){if(!lL(t))throw WJ.error("topology must be an instance of interfaces/topology"),je(new Error("topology must be an instance of interfaces/topology"),GG.ERR_INVALID_PARAMETERS);const n=`${(1e9*Math.random()).toString(36)}${Date.now()}`;let r=this.topologies.get(e);return null==r&&(r=new Map,this.topologies.set(e,r)),r.set(n,t),await t.setRegistrar(this),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),0===n.size&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail;this.components.peerStore.protoBook.get(t.remotePeer).then((e=>{for(const n of e){const e=this.topologies.get(n);if(null!=e)for(const n of e.values())n.onDisconnect(t.remotePeer)}})).catch((e=>{WJ.error(e)}))}_onProtocolChange(e){const{peerId:t,protocols:n,oldProtocols:r}=e.detail,s=r.filter((e=>!n.includes(e))),i=n.filter((e=>!r.includes(e)));for(const o of s){const e=this.topologies.get(o);if(null!=e)for(const n of e.values())n.onDisconnect(t)}for(const o of i){const e=this.topologies.get(o);if(null!=e)for(const n of e.values()){const e=this.components.connectionManager.getConnections(t)[0];null!=e&&n.onConnect(t,e)}}}}const XJ=Fe("libp2p:upgrader");function ZJ(e,t){try{const{options:n}=t.getHandler(e);return n.maxInboundStreams}catch(uS){if(uS.code!==GG.ERR_NO_HANDLER_FOR_PROTOCOL)throw uS}return YJ}function eQ(e,t){try{const{options:n}=t.getHandler(e);return n.maxOutboundStreams}catch(uS){if(uS.code!==GG.ERR_NO_HANDLER_FOR_PROTOCOL)throw uS}return JJ}function tQ(e,t,n){let r=0;return n.streams.forEach((n=>{n.stat.direction===t&&n.stat.protocol===e&&r++})),r}class nQ extends gL{constructor(e,t){super(),this.components=e,this.connectionEncryption=new Map,t.connectionEncryption.forEach((e=>{this.connectionEncryption.set(e.protocol,e)})),this.muxers=new Map,t.muxers.forEach((e=>{this.muxers.set(e.protocol,e)})),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout}async upgradeInbound(e){const t=await this.components.connectionManager.acceptIncomingConnection(e);if(!t)throw je(new Error("connection denied"),GG.ERR_CONNECTION_DENIED);let n,r,s,i,o,a,c;const l=this.components.metrics,u=new Ho.TimeoutController(this.inboundUpgradeTimeout);try{(0,XG.setMaxListeners)?.(1/0,u.signal)}catch{}try{const t=ej(e,u.signal);if(e.source=t.source,e.sink=t.sink,await this.components.connectionGater.denyInboundConnection(e))throw je(new Error("The multiaddr connection is blocked by gater.acceptConnection"),GG.ERR_CONNECTION_INTERCEPTED);if(null!=l){({setTarget:a,proxy:c}=$J());const t=`${(1e9*Math.random()).toString(36)}${Date.now()}`;a({toString:()=>t}),l.trackStream({stream:e,remotePeer:c})}XJ("starting the inbound connection upgrade");let h=e;const d=this.components.connectionProtector;null!=d&&(XJ("protecting the inbound connection"),h=await d.protect(e));try{if(({conn:n,remotePeer:r,protocol:o}=await this._encryptInbound(h)),await this.components.connectionGater.denyInboundEncryptedConnection(r,{...h,...n}))throw je(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),GG.ERR_CONNECTION_INTERCEPTED);if(this.muxers.size>0){const e=await this._multiplexInbound({...h,...n},this.muxers);i=e.muxerFactory,s=e.stream}else s=n}catch(uS){throw XJ.error("Failed to upgrade inbound connection",uS),uS}if(await this.components.connectionGater.denyInboundUpgradedConnection(r,{...h,...n}))throw je(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),GG.ERR_CONNECTION_INTERCEPTED);return null!=l&&(l.updatePlaceholder(c,r),a(r)),XJ("Successfully upgraded inbound connection"),this._createConnection({cryptoProtocol:o,direction:"inbound",maConn:e,upgradedConn:s,muxerFactory:i,remotePeer:r})}finally{this.components.connectionManager.afterUpgradeInbound(),u.clear()}}async upgradeOutbound(e,t){const n=e.remoteAddr.getPeerId();if(null==n)throw je(new Error("outbound connection must have a peer id"),GG.ERR_INVALID_MULTIADDR);const r=Fu(n);if(await this.components.connectionGater.denyOutboundConnection(r,e))throw je(new Error("The multiaddr connection is blocked by connectionGater.denyOutboundConnection"),GG.ERR_CONNECTION_INTERCEPTED);let s,i,o,a,c,l,u;const h=this.components.metrics;if(null!=h){({setTarget:l,proxy:u}=$J());const t=`${(1e9*Math.random()).toString(36)}${Date.now()}`;l({toB58String:()=>t}),h.trackStream({stream:e,remotePeer:u})}XJ("Starting the outbound connection upgrade");let d=e;if(!0!==t?.skipProtection){const t=this.components.connectionProtector;null!=t&&(d=await t.protect(e))}try{if(s=d,!0!==t?.skipEncryption){if(({conn:s,remotePeer:i,protocol:a}=await this._encryptOutbound(d,r)),await this.components.connectionGater.denyOutboundEncryptedConnection(i,{...d,...s}))throw je(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),GG.ERR_CONNECTION_INTERCEPTED)}else a="native",i=r;if(o=s,null!=t?.muxerFactory)c=t.muxerFactory;else if(this.muxers.size>0){const e=await this._multiplexOutbound({...d,...s},this.muxers);c=e.muxerFactory,o=e.stream}}catch(uS){throw XJ.error("Failed to upgrade outbound connection",uS),await e.close(uS),uS}if(await this.components.connectionGater.denyOutboundUpgradedConnection(i,{...d,...s}))throw je(new Error("The multiaddr connection is blocked by gater.acceptEncryptedConnection"),GG.ERR_CONNECTION_INTERCEPTED);return null!=h&&(h.updatePlaceholder(u,i),l(i)),XJ("Successfully upgraded outbound connection"),this._createConnection({cryptoProtocol:a,direction:"outbound",maConn:e,upgradedConn:o,muxerFactory:c,remotePeer:i})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:r,upgradedConn:s,remotePeer:i,muxerFactory:o}=e;let a,c,l;null!=o&&(a=o.createStreamMuxer({direction:n,onIncomingStream:e=>{null!=l&&Promise.resolve().then((async()=>{const t=this.components.registrar.getProtocols(),{stream:r,protocol:s}=await zJ(e,t);XJ("%s: incoming stream opened on %s",n,s);const o=this.components.metrics;if(null!=o&&o.trackStream({stream:r,remotePeer:i,protocol:s}),null==l)return;const a=ZJ(s,this.components.registrar),c=tQ(s,"inbound",l);c!==a?(e.source=r.source,e.sink=r.sink,e.stat.protocol=s,this.components.peerStore.protoBook.add(i,[s]).catch((e=>XJ.error(e))),l.addStream(e),this._onStream({connection:l,stream:e,protocol:s})):e.abort(je(new Error(`Too many inbound protocol streams for protocol "${s}" - limit ${a}`),GG.ERR_TOO_MANY_INBOUND_PROTOCOL_STREAMS))})).catch((t=>{XJ.error(t),null==e.stat.timeline.close&&e.close()}))},onStreamEnd:e=>{l?.removeStream(e.id)}}),c=async(e,t={})=>{if(null==a)throw je(new Error("Stream is not multiplexed"),GG.ERR_MUXER_UNAVAILABLE);XJ("%s: starting new stream on %s",n,e);const r=await a.newStream(),s=this.components.metrics;let o;try{if(null==t.signal){XJ("No abort signal was passed while trying to negotiate protocols %s falling back to default timeout",e),o=new Ho.TimeoutController(3e4),t.signal=o.signal;try{(0,XG.setMaxListeners)?.(1/0,o.signal)}catch{}}const{stream:n,protocol:a}=await FJ(r,e,t);null!=s&&s.trackStream({stream:n,remotePeer:i,protocol:a});const c=eQ(a,this.components.registrar),u=tQ(a,"outbound",l);if(u===c){const e=je(new Error(`Too many outbound protocol streams for protocol "${a}" - limit ${c}`),GG.ERR_TOO_MANY_OUTBOUND_PROTOCOL_STREAMS);throw r.abort(e),e}return this.components.peerStore.protoBook.add(i,[a]).catch((e=>XJ.error(e))),r.source=n.source,r.sink=n.sink,r.stat.protocol=a,r}catch(uS){if(XJ.error("could not create new stream",uS),null==r.stat.timeline.close&&r.close(),null!=uS.code)throw uS;throw je(uS,GG.ERR_UNSUPPORTED_PROTOCOL)}finally{null!=o&&o.clear()}},vm(s,a,s).catch(XJ.error));const u=r.timeline;r.timeline=new Proxy(u,{set:(...e)=>(null!=l&&"close"===e[1]&&null!=e[2]&&null==u.close&&(async()=>{try{"OPEN"===l.stat.status&&await l.close()}catch(uS){XJ.error(uS)}finally{this.dispatchEvent(new yL("connectionEnd",{detail:l}))}})().catch((e=>{XJ.error(e)})),Reflect.set(...e))}),r.timeline.upgraded=Date.now();const h=()=>{throw je(new Error("connection is not multiplexed"),GG.ERR_CONNECTION_NOT_MULTIPLEXED)};return l=GJ({remoteAddr:r.remoteAddr,remotePeer:i,stat:{status:"OPEN",direction:n,timeline:r.timeline,multiplexer:a?.protocol,encryption:t},newStream:c??h,getStreams:()=>null!=a?a.streams:h(),close:async()=>{await r.close(),null!=a&&a.close()}}),this.dispatchEvent(new yL("connection",{detail:l})),l}_onStream(e){const{connection:t,stream:n,protocol:r}=e,{handler:s}=this.components.registrar.getHandler(r);s({connection:t,stream:n})}async _encryptInbound(e){const t=Array.from(this.connectionEncryption.keys());XJ("handling inbound crypto protocol selection",t);try{const{stream:n,protocol:r}=await zJ(e,t,{writeBytes:!0}),s=this.connectionEncryption.get(r);if(null==s)throw new Error(`no crypto module found for ${r}`);return XJ("encrypting inbound connection..."),{...await s.secureInbound(this.components.peerId,n),protocol:r}}catch(uS){throw je(uS,GG.ERR_ENCRYPTION_FAILED)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncryption.keys());XJ("selecting outbound crypto protocol",n);try{const{stream:r,protocol:s}=await FJ(e,n,{writeBytes:!0}),i=this.connectionEncryption.get(s);if(null==i)throw new Error(`no crypto module found for ${s}`);return XJ("encrypting outbound connection to %p",t),{...await i.secureOutbound(this.components.peerId,r,t),protocol:s}}catch(uS){throw je(uS,GG.ERR_ENCRYPTION_FAILED)}}async _multiplexOutbound(e,t){const n=Array.from(t.keys());XJ("outbound selecting muxer %s",n);try{const{stream:r,protocol:s}=await FJ(e,n,{writeBytes:!0});XJ("%s selected as muxer protocol",s);const i=t.get(s);return{stream:r,muxerFactory:i}}catch(uS){throw XJ.error("error multiplexing outbound stream",uS),je(uS,GG.ERR_MUXER_UNAVAILABLE)}}async _multiplexInbound(e,t){const n=Array.from(t.keys());XJ("inbound handling muxers %s",n);try{const{stream:r,protocol:s}=await zJ(e,n,{writeBytes:!0}),i=t.get(s);return{stream:r,muxerFactory:i}}catch(uS){throw XJ.error("error multiplexing inbound stream",uS),je(uS,GG.ERR_MUXER_UNAVAILABLE)}}}var rQ;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{if(!1!==n.lengthDelimited&&t.fork(),null!=e.protocolVersion&&(t.uint32(42),t.string(e.protocolVersion)),null!=e.agentVersion&&(t.uint32(50),t.string(e.agentVersion)),null!=e.publicKey&&(t.uint32(10),t.bytes(e.publicKey)),null!=e.listenAddrs)for(const r of e.listenAddrs)t.uint32(18),t.bytes(r);if(null!=e.observedAddr&&(t.uint32(34),t.bytes(e.observedAddr)),null!=e.protocols)for(const r of e.protocols)t.uint32(26),t.string(r);null!=e.signedPeerRecord&&(t.uint32(66),t.bytes(e.signedPeerRecord)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={listenAddrs:[],protocols:[]},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 5:n.protocolVersion=e.string();break;case 6:n.agentVersion=e.string();break;case 1:n.publicKey=e.bytes();break;case 2:n.listenAddrs.push(e.bytes());break;case 4:n.observedAddr=e.bytes();break;case 3:n.protocols.push(e.string());break;case 8:n.signedPeerRecord=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(rQ||(rQ={}));const sQ="0.0.0",iQ="libp2p",oQ=`js-libp2p/${sQ}`,aQ="0.1.0",cQ="id",lQ="id/push",uQ="1.0.0",hQ="1.0.0",dQ=Fe("libp2p:identify"),pQ=8192;class fQ{constructor(e,t){this.components=e,this.started=!1,this.init=t,this.identifyProtocolStr=`/${t.protocolPrefix}/${cQ}/${uQ}`,this.identifyPushProtocolStr=`/${t.protocolPrefix}/${lQ}/${hQ}`,this.host={protocolVersion:`${t.protocolPrefix}/${aQ}`,...t.host},this.components.connectionManager.addEventListener("peer:connect",(e=>{const t=e.detail;this.identify(t).catch(dQ.error)})),this.components.peerStore.addEventListener("change:multiaddrs",(e=>{const{peerId:t}=e.detail;this.components.peerId.equals(t)&&this.pushToPeerStore().catch((e=>dQ.error(e)))})),this.components.peerStore.addEventListener("change:protocols",(e=>{const{peerId:t}=e.detail;this.components.peerId.equals(t)&&this.pushToPeerStore().catch((e=>dQ.error(e)))}))}isStarted(){return this.started}async start(){this.started||(await this.components.peerStore.metadataBook.setValue(this.components.peerId,"AgentVersion",$o(this.host.agentVersion)),await this.components.peerStore.metadataBook.setValue(this.components.peerId,"ProtocolVersion",$o(this.host.protocolVersion)),await this.components.registrar.handle(this.identifyProtocolStr,(e=>{this._handleIdentify(e).catch((e=>{dQ.error(e)}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),await this.components.registrar.handle(this.identifyPushProtocolStr,(e=>{this._handlePush(e).catch((e=>{dQ.error(e)}))}),{maxInboundStreams:this.init.maxPushIncomingStreams,maxOutboundStreams:this.init.maxPushOutgoingStreams}),this.started=!0)}async stop(){await this.components.registrar.unhandle(this.identifyProtocolStr),await this.components.registrar.unhandle(this.identifyPushProtocolStr),this.started=!1}async push(e){const t=await this.components.peerStore.addressBook.getRawEnvelope(this.components.peerId),n=this.components.addressManager.getAddresses().map((e=>e.bytes)),r=await this.components.peerStore.protoBook.get(this.components.peerId),s=e.map((async e=>{let s;const i=new Ho.TimeoutController(this.init.timeout);try{(0,XG.setMaxListeners)?.(1/0,i.signal)}catch{}try{s=await e.newStream([this.identifyPushProtocolStr],{signal:i.signal});const o=ej(s,i.signal);await o.sink(vm([rQ.encode({listenAddrs:n,signedPeerRecord:t,protocols:r})],rj()))}catch(uS){dQ.error("could not push identify update to peer",uS)}finally{null!=s&&s.close(),i.clear()}}));await Promise.all(s)}async pushToPeerStore(){if(!this.isStarted())return;const e=[];for(const t of this.components.connectionManager.getConnections()){const n=t.remotePeer,r=await this.components.peerStore.get(n);r.protocols.includes(this.identifyPushProtocolStr)&&e.push(t)}await this.push(e)}async _identify(e,t={}){let n,r,s=t.signal;if(null==s){n=new Ho.TimeoutController(this.init.timeout),s=n.signal;try{(0,XG.setMaxListeners)?.(1/0,n.signal)}catch{}}try{r=await e.newStream([this.identifyProtocolStr],{signal:s});const t=ej(r,s),n=await vm([],t,cj({maxDataLength:this.init.maxIdentifyMessageSize??pQ}),(async e=>await rI(e)));if(null==n)throw je(new Error("No data could be retrieved"),GG.ERR_CONNECTION_ENDED);try{return rQ.decode(n)}catch(uS){throw je(uS,GG.ERR_INVALID_MESSAGE)}}finally{null!=n&&n.clear(),null!=r&&r.close()}}async identify(e,t={}){const n=await this._identify(e,t),{publicKey:r,listenAddrs:s,protocols:i,observedAddr:o,signedPeerRecord:a,agentVersion:c,protocolVersion:l}=n;if(null==r)throw je(new Error("public key was missing from identify message"),GG.ERR_MISSING_PUBLIC_KEY);const u=await $u(r);if(!e.remotePeer.equals(u))throw je(new Error("identified peer does not match the expected peer"),GG.ERR_INVALID_PEER);if(this.components.peerId.equals(u))throw je(new Error("identified peer is our own peer id?"),GG.ERR_INVALID_PEER);const h=fQ.getCleanMultiaddr(o);if(null!=a){dQ("received signed peer record from %p",u);try{const e=await tL.openAndCertify(a,aL.DOMAIN);if(!e.peerId.equals(u))throw je(new Error("identified peer does not match the expected peer"),GG.ERR_INVALID_PEER);if(await this.components.peerStore.addressBook.consumePeerRecord(e))return await this.components.peerStore.protoBook.set(u,i),null!=c&&await this.components.peerStore.metadataBook.setValue(u,"AgentVersion",$o(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(u,"ProtocolVersion",$o(l)),void dQ("identify completed for peer %p and protocols %o",u,i)}catch(uS){dQ("received invalid envelope, discard it and fallback to listenAddrs is available",uS)}}else dQ("no signed peer record received from %p",u);dQ("falling back to legacy addresses from %p",u);try{await this.components.peerStore.addressBook.set(u,s.map((e=>dc(e))))}catch(uS){dQ.error("received invalid addrs",uS)}await this.components.peerStore.protoBook.set(u,i),null!=c&&await this.components.peerStore.metadataBook.setValue(u,"AgentVersion",$o(c)),null!=l&&await this.components.peerStore.metadataBook.setValue(u,"ProtocolVersion",$o(l)),dQ("identify completed for peer %p and protocols %o",u,i),dQ("received observed address of %s",h?.toString())}async _handleIdentify(e){const{connection:t,stream:n}=e,r=new Ho.TimeoutController(this.init.timeout);try{(0,XG.setMaxListeners)?.(1/0,r.signal)}catch{}try{const e=this.components.peerId.publicKey??new Uint8Array(0),s=await this.components.peerStore.get(this.components.peerId),i=this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(ga("p2p").code)));let o=s.peerRecordEnvelope;if(i.length>0&&null==o){const e=new aL({peerId:this.components.peerId,multiaddrs:i}),t=await tL.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t),o=t.marshal().subarray()}const a=rQ.encode({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:e,listenAddrs:i.map((e=>e.bytes)),signedPeerRecord:o,observedAddr:t.remoteAddr.bytes,protocols:s.protocols}),c=ej(n,r.signal),l=vm([a],rj());await c.sink(l)}catch(uS){dQ.error("could not respond to identify request",uS)}finally{n.close(),r.clear()}}async _handlePush(e){const{connection:t,stream:n}=e,r=new Ho.TimeoutController(this.init.timeout);try{(0,XG.setMaxListeners)?.(1/0,r.signal)}catch{}let s;try{const e=ej(n,r.signal),t=await vm([],e,cj({maxDataLength:this.init.maxIdentifyMessageSize??pQ}),(async e=>await rI(e)));null!=t&&(s=rQ.decode(t))}catch(uS){return dQ.error("received invalid message",uS)}finally{n.close(),r.clear()}if(null==s)return dQ.error("received invalid message");const i=t.remotePeer;if(this.components.peerId.equals(i))dQ("received push from ourselves?");else{if(dQ("received push from %p",i),null!=s.signedPeerRecord){dQ("received signedPeerRecord in push");try{const e=await tL.openAndCertify(s.signedPeerRecord,aL.DOMAIN);if(await this.components.peerStore.addressBook.consumePeerRecord(e))return dQ("consumed signedPeerRecord sent in push"),void await this.components.peerStore.protoBook.set(i,s.protocols);dQ("failed to consume signedPeerRecord sent in push")}catch(uS){dQ("received invalid envelope, discard it and fallback to listenAddrs is available",uS)}}else dQ("did not receive signedPeerRecord in push");try{await this.components.peerStore.addressBook.set(i,s.listenAddrs.map((e=>dc(e))))}catch(uS){dQ.error("received invalid addrs",uS)}try{await this.components.peerStore.protoBook.set(i,s.protocols)}catch(uS){dQ.error("received invalid protocols",uS)}dQ("handled push from %p",i)}}static getCleanMultiaddr(e){if(null!=e&&e.length>0)try{return dc(e)}catch{}}}var gQ,mQ;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),!0!==n.writeDefaults&&""===e.identifier||(t.uint32(10),t.string(e.identifier)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={identifier:""},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.identifier=e.string();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(gQ||(gQ={})),function(e){let t,n,r;(function(e){e["OK"]="OK",e["NOT_FOUND"]="NOT_FOUND",e["ERROR"]="ERROR"})(t=e.StatusCode||(e.StatusCode={})),function(e){e[e["OK"]=0]="OK",e[e["NOT_FOUND"]=1]="NOT_FOUND",e[e["ERROR"]=2]="ERROR"}(n||(n={})),function(e){e.codec=()=>Ch(n)}(t=e.StatusCode||(e.StatusCode={})),e.codec=()=>(null==r&&(r=Ih(((t,r,s={})=>{!1!==s.lengthDelimited&&r.fork(),(!0===s.writeDefaults||null!=t.status&&0!==n[t.status])&&(r.uint32(8),e.StatusCode.codec().encode(t.status,r)),(!0===s.writeDefaults||null!=t.data&&t.data.byteLength>0)&&(r.uint32(18),r.bytes(t.data)),!1!==s.lengthDelimited&&r.ldelim()}),((n,r)=>{const s={status:t.OK,data:new Uint8Array(0)},i=null==r?n.len:n.pos+r;while(n.pos<i){const t=n.uint32();switch(t>>>3){case 1:s.status=e.StatusCode.codec().decode(n);break;case 2:s.data=n.bytes();break;default:n.skipType(7&t);break}}return s}))),r),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(mQ||(mQ={}));const yQ="0.0.1",wQ="fetch",bQ=Fe("libp2p:fetch");class vQ{constructor(e,t){this.started=!1,this.components=e,this.protocol=`/${t.protocolPrefix??"libp2p"}/${wQ}/${yQ}`,this.lookupFunctions=new Map,this.handleMessage=this.handleMessage.bind(this),this.init=t}async start(){await this.components.registrar.handle(this.protocol,(e=>{this.handleMessage(e).catch((e=>{bQ.error(e)})).finally((()=>{e.stream.close()}))}),{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}async fetch(e,t,n={}){bQ("dialing %s to %p",this.protocol,e);const r=await this.components.connectionManager.openConnection(e,n);let s,i,o=n.signal;if(null==o){s=new Ho.TimeoutController(this.init.timeout),o=s.signal;try{(0,XG.setMaxListeners)?.(1/0,s.signal)}catch{}}try{i=await r.newStream([this.protocol],{signal:o});const e=ej(i,o),n=await vm([gQ.encode({identifier:t})],rj(),e,cj(),(async function(e){const t=await rI(e);if(null==t)throw je(new Error("No data received"),GG.ERR_INVALID_MESSAGE);const n=mQ.decode(t);switch(n.status){case mQ.StatusCode.OK:return n.data;case mQ.StatusCode.NOT_FOUND:return null;case mQ.StatusCode.ERROR:{const e=(new TextDecoder).decode(n.data);throw je(new Error("Error in fetch protocol response: "+e),GG.ERR_INVALID_PARAMETERS)}default:throw je(new Error("Unknown response status"),GG.ERR_INVALID_MESSAGE)}}));return n??null}finally{null!=s&&s.clear(),null!=i&&i.close()}}async handleMessage(e){const{stream:t}=e,n=this;await vm(t,cj(),(async function*(e){const t=await rI(e);if(null==t)throw je(new Error("No data received"),GG.ERR_INVALID_MESSAGE);const r=gQ.decode(t);let s;const i=n._getLookupFunction(r.identifier);if(null!=i){const e=await i(r.identifier);s=null!=e?{status:mQ.StatusCode.OK,data:e}:{status:mQ.StatusCode.NOT_FOUND,data:new Uint8Array(0)}}else{const e=(new TextEncoder).encode("No lookup function registered for key: "+r.identifier);s={status:mQ.StatusCode.ERROR,data:e}}yield mQ.encode(s)}),rj(),t)}_getLookupFunction(e){for(const t of this.lookupFunctions.keys())if(e.startsWith(t))return this.lookupFunctions.get(t)}registerLookupFunction(e,t){if(this.lookupFunctions.has(e))throw je(new Error("Fetch protocol handler for key prefix '"+e+"' already registered"),GG.ERR_KEY_ALREADY_EXISTS);this.lookupFunctions.set(e,t)}unregisterLookupFunction(e,t){if(null!=t){const n=this.lookupFunctions.get(e);if(n!==t)return}this.lookupFunctions.delete(e)}}const EQ=32,_Q="1.0.0",SQ="ping",kQ=Fe("libp2p:ping");class AQ{constructor(e,t){this.components=e,this.started=!1,this.protocol=`/${t.protocolPrefix}/${SQ}/${_Q}`,this.init=t}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.init.maxInboundStreams,maxOutboundStreams:this.init.maxOutboundStreams}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){const{stream:t}=e;vm(t,t).catch((e=>{kQ.error(e)}))}async ping(e,t={}){kQ("dialing %s to %p",this.protocol,e);const n=Date.now(),r=Kd(EQ),s=await this.components.connectionManager.openConnection(e,t);let i,o,a=t.signal;if(null==a){i=new Ho.TimeoutController(this.init.timeout),a=i.signal;try{(0,XG.setMaxListeners)?.(1/0,i.signal)}catch{}}try{o=await s.newStream([this.protocol],{signal:a});const e=ej(o,a),t=await vm([r],e,(async e=>await rI(e))),i=Date.now();if(null==t||!Ja(r,t.subarray()))throw je(new Error("Received wrong ping ack"),GG.ERR_WRONG_PING_ACK);return i-n}finally{null!=i&&i.clear(),null!=o&&o.close()}}}async function TQ(){throw new Error("Not supported in browsers")}var CQ=n(8346);const IQ="object"===typeof window&&"object"===typeof document&&9===document.nodeType,RQ=CQ(),OQ=IQ&&!RQ,xQ=RQ&&!IQ,NQ=RQ&&IQ,DQ="undefined"!==typeof globalThis.process&&"undefined"!==typeof globalThis.process.release&&"node"===globalThis.process.release.name&&!RQ,PQ="function"===typeof importScripts&&"undefined"!==typeof self&&"undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,LQ=("undefined"!==typeof globalThis.process&&"undefined"!==typeof globalThis.process.env&&globalThis.process.env["NODE"+(()=>"_")()+"ENV"],"undefined"!==typeof navigator&&"ReactNative"===navigator.product);var MQ=n(7341);function BQ(e){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(e)||/^::1$/.test(e)}function UQ(e){const{address:t}=e.nodeAddress();return BQ(t)}const VQ=Fe("libp2p:nat"),FQ=7200;function jQ(e=1024,t=65535){return Math.floor(Math.random()*(t-e+1)+e)}class zQ{constructor(e,t){if(this.components=e,this.started=!1,this.enabled=t.enabled,this.externalAddress=t.externalAddress,this.localAddress=t.localAddress,this.description=t.description??`${iQ}@${sQ} ${this.components.peerId.toString()}`,this.ttl=t.ttl??FQ,this.keepAlive=t.keepAlive??!0,this.gateway=t.gateway,this.ttl<FQ)throw je(new Error(`NatManager ttl should be at least ${FQ} seconds`),GG.ERR_INVALID_PARAMETERS)}isStarted(){return this.started}start(){}afterStart(){OQ||!this.enabled||this.started||(this.started=!0,this._start().catch((e=>{VQ.error(e)})))}async _start(){const e=this.components.transportManager.getAddrs();for(const t of e){const{family:e,host:n,port:r,transport:s}=t.toOptions();if(!t.isThinWaistAddress()||"tcp"!==s)continue;if(UQ(t))continue;if(4!==e)continue;const i=await this._getClient(),o=this.externalAddress??await i.externalIp();if(MQ(o))throw new Error(`${o} is private - please set config.nat.externalIp to an externally routable IP or ensure you are not behind a double NAT`);const a=jQ();VQ(`opening uPnP connection from ${o}:${a} to ${n}:${r}`),await i.map({publicPort:a,localPort:r,localAddress:this.localAddress,protocol:"TCP"===s.toUpperCase()?"TCP":"UDP"}),this.components.addressManager.addObservedAddr(cc({family:4,address:o,port:a},s))}}async _getClient(){return null!=this.client||(this.client=await TQ({description:this.description,ttl:this.ttl,keepAlive:this.keepAlive,gateway:this.gateway})),this.client}async stop(){if(!OQ&&null!=this.client)try{await this.client.close(),this.client=void 0}catch(uS){VQ.error(uS)}}}const $Q=Fe("libp2p:peer-record-updater");class HQ{constructor(e){this.components=e,this.started=!1,this.update=this.update.bind(this)}isStarted(){return this.started}async start(){this.started=!0,this.components.transportManager.addEventListener("listener:listening",this.update),this.components.transportManager.addEventListener("listener:close",this.update),this.components.addressManager.addEventListener("change:addresses",this.update)}async stop(){this.started=!1,this.components.transportManager.removeEventListener("listener:listening",this.update),this.components.transportManager.removeEventListener("listener:close",this.update),this.components.addressManager.removeEventListener("change:addresses",this.update)}update(){Promise.resolve().then((async()=>{const e=new aL({peerId:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(ga("p2p").code)))}),t=await tL.seal(e,this.components.peerId);await this.components.peerStore.addressBook.consumePeerRecord(t)})).catch((e=>{$Q.error("Could not update self peer record: %o",e)}))}}class KQ{constructor(e){this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if("FINAL_PEER"===n.name)return n.peer;throw je(new Error(qG.NOT_FOUND),GG.ERR_NOT_FOUND)}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))"FINAL_PEER"===n.name&&(yield n.peer)}}const qQ={ERR_INVALID_PARAMETERS:"ERR_INVALID_PARAMETERS",ERR_NOT_FOUND:"ERR_NOT_FOUND"},GQ=Fe("libp2p:peer-store:address-book"),WQ="change:multiaddrs";async function YQ(){return!0}class JQ{constructor(e,t,n){this.dispatchEvent=e,this.store=t,this.addressFilter=n??YQ}async consumePeerRecord(e){GQ.trace("consumePeerRecord await write lock");const t=await this.store.lock.writeLock();let n,r,s;GQ.trace("consumePeerRecord got write lock");try{let t;try{t=aL.createFromProtobuf(e.payload)}catch(uS){return GQ.error("invalid peer record received"),!1}n=t.peerId;const i=t.multiaddrs;if(!n.equals(e.peerId))return GQ("signing key does not match PeerId in the PeerRecord"),!1;if(null==i||0===i.length)return!1;if(await this.store.has(n)&&(r=await this.store.load(n),null!=r.peerRecordEnvelope)){const e=await tL.createFromProtobuf(r.peerRecordEnvelope),n=aL.createFromProtobuf(e.payload);if(n.seqNumber>=t.seqNumber)return GQ("sequence number was lower or equal to existing sequence number - stored: %d received: %d",n.seqNumber,t.seqNumber),!1}const o=await QQ(n,i,this.addressFilter,!0);s=await this.store.patchOrCreate(n,{addresses:o,peerRecordEnvelope:e.marshal().subarray()}),GQ("stored provided peer record for %p",t.peerId)}finally{GQ.trace("consumePeerRecord release write lock"),t()}return this.dispatchEvent(new yL(WQ,{detail:{peerId:n,multiaddrs:s.addresses.map((({multiaddr:e})=>e)),oldMultiaddrs:null==r?[]:r.addresses.map((({multiaddr:e})=>e))}})),!0}async getRawEnvelope(e){GQ.trace("getRawEnvelope await read lock");const t=await this.store.lock.readLock();GQ.trace("getRawEnvelope got read lock");try{const t=await this.store.load(e);return t.peerRecordEnvelope}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{GQ.trace("getRawEnvelope release read lock"),t()}}async getPeerRecord(e){const t=await this.getRawEnvelope(e);if(null!=t)return await tL.createFromProtobuf(t)}async get(e){e=Vu(e),GQ.trace("get wait for read lock");const t=await this.store.lock.readLock();GQ.trace("get got read lock");try{const t=await this.store.load(e);return t.addresses}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{GQ.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Vu(e),!Array.isArray(t))throw GQ.error("multiaddrs must be an array of Multiaddrs"),je(new Error("multiaddrs must be an array of Multiaddrs"),qQ.ERR_INVALID_PARAMETERS);GQ.trace("set await write lock");const n=await this.store.lock.writeLock();GQ.trace("set got write lock");let r,s,i=!1;try{const n=await QQ(e,t,this.addressFilter);if(0===n.length)return;try{if(r=await this.store.load(e),i=!0,new Set([...n.map((({multiaddr:e})=>e.toString())),...r.addresses.map((({multiaddr:e})=>e.toString()))]).size===r.addresses.length&&n.length===r.addresses.length)return}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}s=await this.store.patchOrCreate(e,{addresses:n}),GQ("set multiaddrs for %p",e)}finally{GQ.trace("set multiaddrs for %p",e),GQ("set release write lock"),n()}this.dispatchEvent(new yL(WQ,{detail:{peerId:e,multiaddrs:s.addresses.map((e=>e.multiaddr)),oldMultiaddrs:null==r?[]:r.addresses.map((({multiaddr:e})=>e))}})),i||this.dispatchEvent(new yL("peer",{detail:{id:e,multiaddrs:s.addresses.map((e=>e.multiaddr)),protocols:s.protocols}}))}async add(e,t){if(e=Vu(e),!Array.isArray(t))throw GQ.error("multiaddrs must be an array of Multiaddrs"),je(new Error("multiaddrs must be an array of Multiaddrs"),qQ.ERR_INVALID_PARAMETERS);GQ.trace("add await write lock");const n=await this.store.lock.writeLock();let r,s,i;GQ.trace("add got write lock");try{const n=await QQ(e,t,this.addressFilter);if(0===n.length)return;try{if(s=await this.store.load(e),r=!0,new Set([...n.map((({multiaddr:e})=>e.toString())),...s.addresses.map((({multiaddr:e})=>e.toString()))]).size===s.addresses.length)return}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}i=await this.store.mergeOrCreate(e,{addresses:n}),GQ("added multiaddrs for %p",e)}finally{GQ.trace("set release write lock"),n()}this.dispatchEvent(new yL(WQ,{detail:{peerId:e,multiaddrs:i.addresses.map((e=>e.multiaddr)),oldMultiaddrs:null==s?[]:s.addresses.map((({multiaddr:e})=>e))}})),!0===r&&this.dispatchEvent(new yL("peer",{detail:{id:e,multiaddrs:i.addresses.map((e=>e.multiaddr)),protocols:i.protocols}}))}async delete(e){e=Vu(e),GQ.trace("delete await write lock");const t=await this.store.lock.writeLock();let n;GQ.trace("delete got write lock");try{try{n=await this.store.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(e,{addresses:[]})}finally{GQ.trace("delete release write lock"),t()}null!=n&&this.dispatchEvent(new yL(WQ,{detail:{peerId:e,multiaddrs:[],oldMultiaddrs:null==n?[]:n.addresses.map((({multiaddr:e})=>e))}}))}}async function QQ(e,t,n,r=!1){return await vm(t,(e=>YY(e,(e=>{if(!uc(e))throw GQ.error("multiaddr must be an instance of Multiaddr"),je(new Error("multiaddr must be an instance of Multiaddr"),qQ.ERR_INVALID_PARAMETERS)}))),(t=>em(t,(async t=>await n(e,t)))),(e=>Iy(e,(e=>({multiaddr:e,isCertified:r})))),(async e=>await Qg(e)))}const XQ=Fe("libp2p:peer-store:key-book"),ZQ="change:pubkey";class eX{constructor(e,t){this.dispatchEvent=e,this.store=t}async set(e,t){if(e=Vu(e),!(t instanceof Uint8Array))throw XQ.error("publicKey must be an instance of Uint8Array to store data"),je(new Error("publicKey must be an instance of PublicKey"),qQ.ERR_INVALID_PARAMETERS);XQ.trace("set await write lock");const n=await this.store.lock.writeLock();XQ.trace("set got write lock");let r,s=!1;try{try{if(r=await this.store.load(e),null!=r.pubKey&&Ja(r.pubKey,t))return}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(e,{pubKey:t}),s=!0}finally{XQ.trace("set release write lock"),n()}s&&this.dispatchEvent(new yL(ZQ,{detail:{peerId:e,publicKey:t,oldPublicKey:null==r?void 0:r.pubKey}}))}async get(e){e=Vu(e),XQ.trace("get await write lock");const t=await this.store.lock.readLock();XQ.trace("get got write lock");try{const t=await this.store.load(e);return t.pubKey}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{XQ("get release write lock"),t()}}async delete(e){e=Vu(e),XQ.trace("delete await write lock");const t=await this.store.lock.writeLock();let n;XQ.trace("delete got write lock");try{try{n=await this.store.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(e,{pubKey:void 0})}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{XQ.trace("delete release write lock"),t()}this.dispatchEvent(new yL(ZQ,{detail:{peerId:e,publicKey:void 0,oldPublicKey:null==n?void 0:n.pubKey}}))}}const tX=Fe("libp2p:peer-store:metadata-book"),nX="change:metadata";class rX{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){e=Vu(e),tX.trace("get await read lock");const t=await this.store.lock.readLock();tX.trace("get got read lock");try{const t=await this.store.load(e);return t.metadata}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{tX.trace("get release read lock"),t()}return new Map}async getValue(e,t){e=Vu(e),tX.trace("getValue await read lock");const n=await this.store.lock.readLock();tX.trace("getValue got read lock");try{const n=await this.store.load(e);return n.metadata.get(t)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{tX.trace("getValue release write lock"),n()}}async set(e,t){if(e=Vu(e),!(t instanceof Map))throw tX.error("valid metadata must be provided to store data"),je(new Error("valid metadata must be provided"),qQ.ERR_INVALID_PARAMETERS);tX.trace("set await write lock");const n=await this.store.lock.writeLock();let r;tX.trace("set got write lock");try{try{r=await this.store.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}await this.store.mergeOrCreate(e,{metadata:t})}finally{tX.trace("set release write lock"),n()}this.dispatchEvent(new yL(nX,{detail:{peerId:e,metadata:t,oldMetadata:null==r?new Map:r.metadata}}))}async setValue(e,t,n){if(e=Vu(e),"string"!==typeof t||!(n instanceof Uint8Array))throw tX.error("valid key and value must be provided to store data"),je(new Error("valid key and value must be provided"),qQ.ERR_INVALID_PARAMETERS);tX.trace("setValue await write lock");const r=await this.store.lock.writeLock();let s,i;tX.trace("setValue got write lock");try{try{s=await this.store.load(e);const r=s.metadata.get(t);if(null!=r&&Ja(n,r))return}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}i=await this.store.mergeOrCreate(e,{metadata:new Map([[t,n]])})}finally{tX.trace("setValue release write lock"),r()}this.dispatchEvent(new yL(nX,{detail:{peerId:e,metadata:i.metadata,oldMetadata:null==s?new Map:s.metadata}}))}async delete(e){e=Vu(e),tX.trace("delete await write lock");const t=await this.store.lock.writeLock();let n;tX.trace("delete got write lock");try{try{n=await this.store.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}null!=n&&await this.store.patch(e,{metadata:new Map})}finally{tX.trace("delete release write lock"),t()}null!=n&&this.dispatchEvent(new yL(nX,{detail:{peerId:e,metadata:new Map,oldMetadata:n.metadata}}))}async deleteValue(e,t){e=Vu(e),tX.trace("deleteValue await write lock");const n=await this.store.lock.writeLock();let r,s;tX.trace("deleteValue got write lock");try{s=await this.store.load(e),r=s.metadata,r.delete(t),await this.store.patch(e,{metadata:r})}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{tX.trace("deleteValue release write lock"),n()}null!=r&&this.dispatchEvent(new yL(nX,{detail:{peerId:e,metadata:r,oldMetadata:null==s?new Map:s.metadata}}))}}const sX=Fe("libp2p:peer-store:proto-book"),iX="change:protocols";class oX{constructor(e,t){this.dispatchEvent=e,this.store=t}async get(e){sX.trace("get wait for read lock");const t=await this.store.lock.readLock();sX.trace("get got read lock");try{const t=await this.store.load(e);return t.protocols}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}finally{sX.trace("get release read lock"),t()}return[]}async set(e,t){if(e=Vu(e),!Array.isArray(t))throw sX.error("protocols must be provided to store data"),je(new Error("protocols must be provided"),qQ.ERR_INVALID_PARAMETERS);sX.trace("set await write lock");const n=await this.store.lock.writeLock();let r,s;sX.trace("set got write lock");try{try{if(r=await this.store.load(e),new Set([...t]).size===r.protocols.length)return}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}s=await this.store.patchOrCreate(e,{protocols:t}),sX("stored provided protocols for %p",e)}finally{sX.trace("set release write lock"),n()}this.dispatchEvent(new yL(iX,{detail:{peerId:e,protocols:s.protocols,oldProtocols:null==r?[]:r.protocols}}))}async add(e,t){if(e=Vu(e),!Array.isArray(t))throw sX.error("protocols must be provided to store data"),je(new Error("protocols must be provided"),qQ.ERR_INVALID_PARAMETERS);sX.trace("add await write lock");const n=await this.store.lock.writeLock();let r,s;sX.trace("add got write lock");try{try{if(r=await this.store.load(e),new Set([...r.protocols,...t]).size===r.protocols.length)return}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}s=await this.store.mergeOrCreate(e,{protocols:t}),sX("added provided protocols for %p",e)}finally{sX.trace("add release write lock"),n()}this.dispatchEvent(new yL(iX,{detail:{peerId:e,protocols:s.protocols,oldProtocols:null==r?[]:r.protocols}}))}async remove(e,t){if(e=Vu(e),!Array.isArray(t))throw sX.error("protocols must be provided to store data"),je(new Error("protocols must be provided"),qQ.ERR_INVALID_PARAMETERS);sX.trace("remove await write lock");const n=await this.store.lock.writeLock();let r,s;sX.trace("remove got write lock");try{try{r=await this.store.load(e);const n=new Set(r.protocols);for(const e of t)n.delete(e);if(r.protocols.length===n.size)return;t=Array.from(n)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}s=await this.store.patchOrCreate(e,{protocols:t})}finally{sX.trace("remove release write lock"),n()}this.dispatchEvent(new yL(iX,{detail:{peerId:e,protocols:s.protocols,oldProtocols:null==r?[]:r.protocols}}))}async delete(e){e=Vu(e),sX.trace("delete await write lock");const t=await this.store.lock.writeLock();let n;sX.trace("delete got write lock");try{try{n=await this.store.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS}await this.store.patchOrCreate(e,{protocols:[]})}finally{sX.trace("delete release write lock"),t()}null!=n&&this.dispatchEvent(new yL(iX,{detail:{peerId:e,protocols:[],oldProtocols:n.protocols}}))}}var aX,cX,lX;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{if(!1!==n.lengthDelimited&&t.fork(),null!=e.addresses)for(const r of e.addresses)t.uint32(10),cX.codec().encode(r,t,{writeDefaults:!0});if(null!=e.protocols)for(const r of e.protocols)t.uint32(18),t.string(r);if(null!=e.metadata)for(const r of e.metadata)t.uint32(26),lX.codec().encode(r,t,{writeDefaults:!0});null!=e.pubKey&&(t.uint32(34),t.bytes(e.pubKey)),null!=e.peerRecordEnvelope&&(t.uint32(42),t.bytes(e.peerRecordEnvelope)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={addresses:[],protocols:[],metadata:[]},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.addresses.push(cX.codec().decode(e,e.uint32()));break;case 2:n.protocols.push(e.string());break;case 3:n.metadata.push(lX.codec().decode(e,e.uint32()));break;case 4:n.pubKey=e.bytes();break;case 5:n.peerRecordEnvelope=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(aX||(aX={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.multiaddr&&e.multiaddr.byteLength>0)&&(t.uint32(10),t.bytes(e.multiaddr)),null!=e.isCertified&&(t.uint32(16),t.bool(e.isCertified)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={multiaddr:new Uint8Array(0)},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.multiaddr=e.bytes();break;case 2:n.isCertified=e.bool();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(cX||(cX={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),!0!==n.writeDefaults&&""===e.key||(t.uint32(10),t.string(e.key)),(!0===n.writeDefaults||null!=e.value&&e.value.byteLength>0)&&(t.uint32(18),t.bytes(e.value)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={key:"",value:new Uint8Array(0)},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.key=e.string();break;case 2:n.value=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(lX||(lX={}));const uX=Fe("libp2p:peer-store:store"),hX="/peers/";class dX{constructor(e){this.components=e,this.lock=ZI({name:"peer-store",singleProcess:!0})}_peerIdToDatastoreKey(e){if(null==e.type)throw uX.error("peerId must be an instance of peer-id to store data"),je(new Error("peerId must be an instance of peer-id"),qQ.ERR_INVALID_PARAMETERS);const t=e.toCID().toString();return new rl(`${hX}${t}`)}async has(e){return await this.components.datastore.has(this._peerIdToDatastoreKey(e))}async delete(e){await this.components.datastore.delete(this._peerIdToDatastoreKey(e))}async load(e){const t=await this.components.datastore.get(this._peerIdToDatastoreKey(e)),n=aX.decode(t),r=new Map;for(const s of n.metadata)r.set(s.key,s.value);return{...n,id:e,addresses:n.addresses.map((({multiaddr:e,isCertified:t})=>({multiaddr:dc(e),isCertified:t??!1}))),metadata:r,pubKey:n.pubKey??void 0,peerRecordEnvelope:n.peerRecordEnvelope??void 0}}async save(e){if(null!=e.pubKey&&null!=e.id.publicKey&&!Ja(e.pubKey,e.id.publicKey))throw uX.error("peer publicKey bytes do not match peer id publicKey bytes"),je(new Error("publicKey bytes do not match peer id publicKey bytes"),qQ.ERR_INVALID_PARAMETERS);const t=new Set,n=e.addresses.filter((e=>!t.has(e.multiaddr.toString())&&(t.add(e.multiaddr.toString()),!0))).sort(((e,t)=>e.multiaddr.toString().localeCompare(t.multiaddr.toString()))).map((({multiaddr:e,isCertified:t})=>({multiaddr:e.bytes,isCertified:t}))),r=[];[...e.metadata.keys()].sort().forEach((t=>{const n=e.metadata.get(t);null!=n&&r.push({key:t,value:n})}));const s=aX.encode({addresses:n,protocols:e.protocols.sort(),pubKey:e.pubKey,metadata:r,peerRecordEnvelope:e.peerRecordEnvelope});return await this.components.datastore.put(this._peerIdToDatastoreKey(e.id),s.subarray()),await this.load(e.id)}async patch(e,t){const n=await this.load(e);return await this._patch(e,t,n)}async patchOrCreate(e,t){let n;try{n=await this.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._patch(e,t,n)}async _patch(e,t,n){return await this.save({...n,...t,id:e})}async merge(e,t){const n=await this.load(e);return await this._merge(e,t,n)}async mergeOrCreate(e,t){let n;try{n=await this.load(e)}catch(uS){if(uS.code!==qQ.ERR_NOT_FOUND)throw uS;n={id:e,addresses:[],protocols:[],metadata:new Map}}return await this._merge(e,t,n)}async _merge(e,t,n){const r=new Map;return n.addresses.forEach((e=>{r.set(e.multiaddr.toString(),e.isCertified)})),(t.addresses??[]).forEach((e=>{const t=e.multiaddr.toString(),n=Boolean(r.get(t)),s=n||e.isCertified;r.set(t,s)})),await this.save({id:e,addresses:Array.from(r.entries()).map((([e,t])=>({multiaddr:dc(e),isCertified:t}))),protocols:Array.from(new Set([...n.protocols??[],...t.protocols??[]])),metadata:new Map([...n.metadata?.entries()??[],...t.metadata?.entries()??[]]),pubKey:t.pubKey??(null!=n?n.pubKey:void 0),peerRecordEnvelope:t.peerRecordEnvelope??(null!=n?n.peerRecordEnvelope:void 0)})}async*all(){for await(const e of this.components.datastore.queryKeys({prefix:hX})){const t=e.toString().split("/")[2],n=Ce.decode(t);yield this.load(ju(n))}}}var pX,fX;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{if(!1!==n.lengthDelimited&&t.fork(),null!=e.tags)for(const r of e.tags)t.uint32(10),fX.codec().encode(r,t,{writeDefaults:!0});!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={tags:[]},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.tags.push(fX.codec().decode(e,e.uint32()));break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(pX||(pX={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),!0!==n.writeDefaults&&""===e.name||(t.uint32(10),t.string(e.name)),null!=e.value&&(t.uint32(16),t.uint32(e.value)),null!=e.expiry&&(t.uint32(24),t.uint64(e.expiry)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={name:""},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.name=e.string();break;case 2:n.value=e.uint32();break;case 3:n.expiry=e.uint64();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(fX||(fX={}));const gX=Fe("libp2p:peer-store");class mX extends gL{constructor(e,t={}){super(),this.components=e,this.store=new dX(e),this.addressBook=new JQ(this.dispatchEvent.bind(this),this.store,t.addressFilter),this.keyBook=new eX(this.dispatchEvent.bind(this),this.store),this.metadataBook=new rX(this.dispatchEvent.bind(this),this.store),this.protoBook=new oX(this.dispatchEvent.bind(this),this.store)}async forEach(e){gX.trace("getPeers await read lock");const t=await this.store.lock.readLock();gX.trace("getPeers got read lock");try{for await(const t of this.store.all())t.id.equals(this.components.peerId)||e(t)}finally{gX.trace("getPeers release read lock"),t()}}async all(){const e=[];return await this.forEach((t=>{e.push(t)})),e}async delete(e){gX.trace("delete await write lock");const t=await this.store.lock.writeLock();gX.trace("delete got write lock");try{await this.store.delete(e)}finally{gX.trace("delete release write lock"),t()}}async get(e){gX.trace("get await read lock");const t=await this.store.lock.readLock();gX.trace("get got read lock");try{return await this.store.load(e)}finally{gX.trace("get release read lock"),t()}}async has(e){gX.trace("has await read lock");const t=await this.store.lock.readLock();gX.trace("has got read lock");try{return await this.store.has(e)}finally{gX.trace("has release read lock"),t()}}async tagPeer(e,t,n={}){const r=n.value??0,s=Math.round(r),i=n.ttl??void 0;if(s!==r||s<0||s>100)throw je(new Error("Tag value must be between 0-100"),"ERR_TAG_VALUE_OUT_OF_BOUNDS");const o=await this.metadataBook.getValue(e,"tags");let a=[];null!=o&&(a=pX.decode(o).tags);for(const c of a)if(c.name===t)throw je(new Error("Peer already tagged"),"ERR_DUPLICATE_TAG");a.push({name:t,value:s,expiry:null==i?void 0:BigInt(Date.now()+i)}),await this.metadataBook.setValue(e,"tags",pX.encode({tags:a}).subarray())}async unTagPeer(e,t){const n=await this.metadataBook.getValue(e,"tags");let r=[];null!=n&&(r=pX.decode(n).tags),r=r.filter((e=>e.name!==t)),await this.metadataBook.setValue(e,"tags",pX.encode({tags:r}).subarray())}async getTags(e){const t=await this.metadataBook.getValue(e,"tags");let n=[];null!=t&&(n=pX.decode(t).tags);const r=BigInt(Date.now()),s=n.filter((e=>null==e.expiry||e.expiry>r));return s.length!==n.length&&await this.metadataBook.setValue(e,"tags",pX.encode({tags:s}).subarray()),s.map((e=>({name:e.name,value:e.value??0})))}}class yX{constructor(e){this.dht=e}async provide(e){await Zg(this.dht.provide(e))}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))"PROVIDER"===n.name&&(yield*n.providers)}async put(e,t,n){await Zg(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if("VALUE"===n.name)return n.value;throw je(new Error("Not found"),"ERR_NOT_FOUND")}}class wX{constructor(e={}){this._started=!1,this._peerId=e.peerId,this._addressManager=e.addressManager,this._peerStore=e.peerStore,this._upgrader=e.upgrader,this._metrics=e.metrics,this._registrar=e.registrar,this._connectionManager=e.connectionManager,this._transportManager=e.transportManager,this._connectionGater=e.connectionGater,this._contentRouting=e.contentRouting,this._peerRouting=e.peerRouting,this._datastore=e.datastore,this._connectionProtector=e.connectionProtector,this._dht=e.dht,this._pubsub=e.pubsub,this._dialer=e.dialer}isStarted(){return this._started}async beforeStart(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.beforeStart&&await e.beforeStart()})))}async start(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{await e.start()}))),this._started=!0}async afterStart(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.afterStart&&await e.afterStart()})))}async beforeStop(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.beforeStop&&await e.beforeStop()})))}async stop(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{await e.stop()}))),this._started=!1}async afterStop(){await Promise.all(Object.values(this).filter((e=>AU(e))).map((async e=>{null!=e.afterStop&&await e.afterStop()})))}get peerId(){if(null==this._peerId)throw je(new Error("peerId not set"),"ERR_SERVICE_MISSING");return this._peerId}set peerId(e){this._peerId=e}get addressManager(){if(null==this._addressManager)throw je(new Error("addressManager not set"),"ERR_SERVICE_MISSING");return this._addressManager}set addressManager(e){this._addressManager=e}get peerStore(){if(null==this._peerStore)throw je(new Error("peerStore not set"),"ERR_SERVICE_MISSING");return this._peerStore}set peerStore(e){this._peerStore=e}get upgrader(){if(null==this._upgrader)throw je(new Error("upgrader not set"),"ERR_SERVICE_MISSING");return this._upgrader}set upgrader(e){this._upgrader=e}get registrar(){if(null==this._registrar)throw je(new Error("registrar not set"),"ERR_SERVICE_MISSING");return this._registrar}set registrar(e){this._registrar=e}get connectionManager(){if(null==this._connectionManager)throw je(new Error("connectionManager not set"),"ERR_SERVICE_MISSING");return this._connectionManager}set connectionManager(e){this._connectionManager=e}get transportManager(){if(null==this._transportManager)throw je(new Error("transportManager not set"),"ERR_SERVICE_MISSING");return this._transportManager}set transportManager(e){this._transportManager=e}get connectionGater(){if(null==this._connectionGater)throw je(new Error("connectionGater not set"),"ERR_SERVICE_MISSING");return this._connectionGater}set connectionGater(e){this._connectionGater=e}get contentRouting(){if(null==this._contentRouting)throw je(new Error("contentRouting not set"),"ERR_SERVICE_MISSING");return this._contentRouting}set contentRouting(e){this._contentRouting=e}get peerRouting(){if(null==this._peerRouting)throw je(new Error("peerRouting not set"),"ERR_SERVICE_MISSING");return this._peerRouting}set peerRouting(e){this._peerRouting=e}get datastore(){if(null==this._datastore)throw je(new Error("datastore not set"),"ERR_SERVICE_MISSING");return this._datastore}set datastore(e){this._datastore=e}get connectionProtector(){return this._connectionProtector}set connectionProtector(e){this._connectionProtector=e}get dialer(){if(null==this._dialer)throw je(new Error("dialer not set"),"ERR_SERVICE_MISSING");return this._dialer}set dialer(e){this._dialer=e}get metrics(){return this._metrics}set metrics(e){this._metrics=e}get dht(){return this._dht}set dht(e){this._dht=e}get pubsub(){return this._pubsub}set pubsub(e){this._pubsub=e}}var bX=n(3707);const vX=globalThis.fetch,EX=globalThis.Headers;globalThis.Request,globalThis.Response;function _X(e,t,n){return`${e}?name=${t}&type=${n}`}async function SX(e,t){const n=await vX(e,{headers:new EX({accept:"application/dns-json"}),signal:t}),r=await n.json();return r}function kX(e,t){return`${t}_${e}`}const AX=Object.assign(se("dns-over-http-resolver"),{error:se("dns-over-http-resolver:error")});class TX{constructor(e={}){this._cache=new bX({max:e?.maxCache??100}),this._TXTcache=new bX({max:e?.maxCache??100}),this._servers=["https://cloudflare-dns.com/dns-query","https://dns.google/resolve"],this._request=e.request??SX,this._abortControllers=[]}cancel(){this._abortControllers.forEach((e=>e.abort()))}getServers(){return this._servers}_getShuffledServers(){const e=[...this._servers];for(let t=e.length-1;t>0;t--){const n=Math.floor(Math.random()*t),r=e[t];e[t]=e[n],e[n]=r}return e}setServers(e){this._servers=e}async resolve(e,t="A"){switch(t){case"A":return await this.resolve4(e);case"AAAA":return await this.resolve6(e);case"TXT":return await this.resolveTxt(e);default:throw new Error(`${t} is not supported`)}}async resolve4(e){const t="A",n=this._cache.get(kX(e,t));if(null!=n)return n;let r=!1;for(const s of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(_X(s,e,t),n.signal),i=r.Answer.map((e=>e.data)),o=Math.min(...r.Answer.map((e=>e.TTL)));return this._cache.set(kX(e,t),i,{ttl:o}),i}catch(uS){n.signal.aborted&&(r=!0),AX.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==n))}}if(r)throw Object.assign(new Error("queryA ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolve6(e){const t="AAAA",n=this._cache.get(kX(e,t));if(null!=n)return n;let r=!1;for(const s of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(_X(s,e,t),n.signal),i=r.Answer.map((e=>e.data)),o=Math.min(...r.Answer.map((e=>e.TTL)));return this._cache.set(kX(e,t),i,{ttl:o}),i}catch(uS){n.signal.aborted&&(r=!0),AX.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==n))}}if(r)throw Object.assign(new Error("queryAaaa ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}async resolveTxt(e){const t="TXT",n=this._TXTcache.get(kX(e,t));if(null!=n)return n;let r=!1;for(const s of this._getShuffledServers()){const n=new AbortController;this._abortControllers.push(n);try{const r=await this._request(_X(s,e,t),n.signal),i=r.Answer.map((e=>[e.data.replace(/['"]+/g,"")])),o=Math.min(...r.Answer.map((e=>e.TTL)));return this._TXTcache.set(kX(e,t),i,{ttl:o}),i}catch(uS){n.signal.aborted&&(r=!0),AX.error(`${s} could not resolve ${e} record ${t}`)}finally{this._abortControllers=this._abortControllers.filter((e=>e!==n))}}if(r)throw Object.assign(new Error("queryTxt ECANCELLED"),{code:"ECANCELLED"});throw new Error(`Could not resolve ${e} record ${t}`)}clearCache(){this._cache.clear(),this._TXTcache.clear()}}var CX=TX,IX=CX;const{code:RX}=ga("dnsaddr");async function OX(e,t={}){const n=new IX;null!=t.signal&&t.signal.addEventListener("abort",(()=>{n.cancel()}));const r=e.getPeerId(),[,s]=e.stringTuples().find((([e])=>e===RX))??[];if(null==s)throw new Error("No hostname found in multiaddr");const i=await n.resolveTxt(`_dnsaddr.${s}`);let o=i.flat().map((e=>e.split("=")[1]));return null!=r&&(o=o.filter((e=>e.includes(r)))),o}const xX={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:e=>e},connectionManager:{maxConnections:300,minConnections:50,autoDial:!0,autoDialInterval:1e4,maxParallelDials:XY,maxDialsPerPeer:ZY,dialTimeout:JY,inboundUpgradeTimeout:QY,resolvers:{dnsaddr:OX},addressSorter:AY},connectionGater:{},transportManager:{faultTolerance:RJ.FATAL_ALL},metrics:{enabled:!1,computeThrottleMaxQueueSize:1e3,computeThrottleTimeout:2e3,movingAverageIntervals:[6e4,3e5,9e5],maxOldPeersRetention:50},peerRouting:{refreshManager:{enabled:!0,interval:6e5,bootDelay:1e4}},nat:{enabled:!0,ttl:7200,keepAlive:!0},relay:{enabled:!0,advertise:{bootDelay:XW,enabled:!1,ttl:ZW},hop:{enabled:!1,active:!1,timeout:3e4},autoRelay:{enabled:!1,maxListeners:2}},identify:{protocolPrefix:"ipfs",host:{agentVersion:oQ},timeout:6e4,maxInboundStreams:1,maxOutboundStreams:1,maxPushIncomingStreams:1,maxPushOutgoingStreams:1},ping:{protocolPrefix:"ipfs",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4},fetch:{protocolPrefix:"libp2p",maxInboundStreams:1,maxOutboundStreams:1,timeout:1e4}};function NX(e){const t=ne(xX,e);if(null==t.transports||t.transports.length<1)throw je(new Error(qG.ERR_TRANSPORTS_REQUIRED),GG.ERR_TRANSPORTS_REQUIRED);if(null==t.connectionEncryption||0===t.connectionEncryption.length)throw je(new Error(qG.CONN_ENCRYPTION_REQUIRED),GG.CONN_ENCRYPTION_REQUIRED);if(null===t.connectionProtector&&null!=globalThis.process?.env?.LIBP2P_FORCE_PNET)throw je(new Error(qG.ERR_PROTECTOR_REQUIRED),GG.ERR_PROTECTOR_REQUIRED);return t.identify.host.agentVersion===oQ&&(DQ||xQ?t.identify.host.agentVersion+=` UserAgent=${globalThis.process.version}`:(OQ||PQ||NQ||LQ)&&(t.identify.host.agentVersion+=` UserAgent=${globalThis.navigator.userAgent}`)),t}var DX;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.id&&e.id.byteLength>0)&&(t.uint32(10),t.bytes(e.id)),null!=e.pubKey&&(t.uint32(18),t.bytes(e.pubKey)),null!=e.privKey&&(t.uint32(26),t.bytes(e.privKey)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={id:new Uint8Array(0)},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.id=e.bytes();break;case 2:n.pubKey=e.bytes();break;case 3:n.privKey=e.bytes();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(DX||(DX={}));const PX=async()=>{const e=await qf("Ed25519"),t=await MX(e);if("Ed25519"===t.type)return t;throw new Error(`Generated unexpected PeerId type "${t.type}"`)},LX=async e=>{const t=await qf("RSA",e?.bits??2048),n=await MX(t);if("RSA"===n.type)return n;throw new Error(`Generated unexpected PeerId type "${n.type}"`)};async function MX(e){return await $u(Wf(e.public),Jf(e))}class BX extends gL{get[UG](){return!0}get[Symbol.toStringTag](){return"@libp2p/dummy-dht"}get wan(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}get lan(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}get(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}findProviders(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}findPeer(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}getClosestPeers(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}provide(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}put(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}async getMode(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}async setMode(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}async refreshRoutingTable(){throw je(new Error(qG.DHT_DISABLED),GG.DHT_DISABLED)}}class UX extends gL{constructor(){super(...arguments),this.topicValidators=new Map}isStarted(){return!1}start(){}stop(){}get globalSignaturePolicy(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}get multicodecs(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}getPeers(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}getTopics(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}subscribe(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}unsubscribe(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}getSubscribers(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}async publish(){throw je(new Error(qG.PUBSUB_DISABLED),GG.ERR_PUBSUB_DISABLED)}}class VX extends Error{constructor(e="The operation was aborted"){super(e),this.code=VX.code,this.type=VX.type}static get code(){return"ABORT_ERR"}static get type(){return"aborted"}}var FX=n(2119);const jX=Fe("libp2p:dialer:dial-request");class zX{constructor(e){const{addrs:t,dialAction:n,dialer:r}=e;this.addrs=t,this.dialer=r,this.dialAction=n}async run(e={}){const t=this.dialer.getTokens(this.addrs.length);if(t.length<1)throw je(new Error("No dial tokens available"),GG.ERR_NO_DIAL_TOKENS);const n=new FX;for(const o of t)n.push(o).catch((e=>{jX.error(e)}));const r=this.addrs.map((()=>{const e=new AbortController;try{(0,XG.setMaxListeners)?.(1/0,e.signal)}catch{}return e}));if(null!=e.signal)try{(0,XG.setMaxListeners)?.(1/0,e.signal)}catch{}let s=0,i=!1;try{return await Promise.any(this.addrs.map((async(o,a)=>{const c=await n.shift();if(i)throw this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0]),je(new Error("dialAction already succeeded"),GG.ERR_ALREADY_SUCCEEDED);const l=r[a];if(null==l)throw je(new Error("dialAction did not come with an AbortController"),GG.ERR_INVALID_PARAMETERS);let u;try{const t=l.signal;u=await this.dialAction(o,{...e,signal:null!=e.signal?(0,al.anySignal)([t,e.signal]):t}),r[a]=void 0}finally{s++,this.addrs.length-s>=t.length?n.push(c).catch((e=>{jX.error(e)})):this.dialer.releaseToken(t.splice(t.indexOf(c),1)[0])}if(null==u)throw je(new Error("dialAction led to empty object"),GG.ERR_TRANSPORT_DIAL_FAILED);return i=!0,u})))}finally{r.forEach((e=>{void 0!==e&&e.abort()})),t.forEach((e=>this.dialer.releaseToken(e)))}}}const $X=Fe("libp2p:dialer"),HX="dialler",KX="pending-dials",qX="pending-dial-targets";class GX{constructor(e,t={}){this.started=!1,this.addressSorter=t.addressSorter??AY,this.maxAddrsToDial=t.maxAddrsToDial??eJ,this.timeout=t.dialTimeout??JY,this.maxDialsPerPeer=t.maxDialsPerPeer??ZY,this.tokens=[...new Array(t.maxParallelDials??XY)].map(((e,t)=>t)),this.components=e,this.pendingDials=TJ({component:HX,metric:KX,metrics:t.metrics}),this.pendingDialTargets=TJ({component:HX,metric:qX,metrics:e.metrics});for(const[n,r]of Object.entries(t.resolvers??{}))oc.set(n,r)}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1;for(const e of this.pendingDials.values())try{e.controller.abort()}catch(uS){$X.error(uS)}this.pendingDials.clear();for(const e of this.pendingDialTargets.values())e.reject(new VX("Dialer was destroyed"));this.pendingDialTargets.clear()}async dial(e,t={}){const{id:n,multiaddrs:r}=rW(e);if(this.components.peerId.equals(n))throw je(new Error("Tried to dial self"),GG.ERR_DIALED_SELF);if($X("check multiaddrs %p",n),null!=r&&r.length>0&&($X("storing multiaddrs %p",n,r),await this.components.peerStore.addressBook.add(n,r)),await this.components.connectionGater.denyDialPeer(n))throw je(new Error("The dial request is blocked by gater.allowDialPeer"),GG.ERR_PEER_DIAL_INTERCEPTED);$X("creating dial target for %p",n);const s=await this._createCancellableDialTarget(n,t);if(0===s.addrs.length)throw je(new Error("The dial request has no valid addresses"),GG.ERR_NO_VALID_ADDRESSES);const i=this.pendingDials.get(s.id)??this._createPendingDial(s,t);try{const e=await i.promise;return $X("dial succeeded to %s",s.id),e}catch(uS){throw $X("dial failed to %s",s.id,uS),i.controller.signal.aborted&&(uS.code=GG.ERR_TIMEOUT),$X.error(uS),uS}finally{i.destroy()}}async _createCancellableDialTarget(e,t){const n=`${parseInt(String(1e9*Math.random()),10).toString()}${Date.now()}`,r=new Promise(((e,t)=>{this.pendingDialTargets.set(n,{resolve:e,reject:t})}));try{const n=await Promise.race([this._createDialTarget(e,t),r]);return n}finally{this.pendingDialTargets.delete(n)}}async _createDialTarget(e,t){const n=this._resolve.bind(this),r=await vm(await this.components.peerStore.addressBook.get(e),(t=>em(t,(async t=>!await this.components.connectionGater.denyDialMultiaddr(e,t.multiaddr)))),(e=>_P(e,this.addressSorter)),(async function*(e){for await(const r of e)yield*await n(r.multiaddr,t)}),(e=>em(e,(e=>Boolean(this.components.transportManager.transportForMultiaddr(e))))),(t=>Iy(t,(t=>e.toString()===t.getPeerId()?t:t.encapsulate(`/p2p/${e.toString()}`)))),(async e=>await Qg(e)));if(r.length>this.maxAddrsToDial)throw await this.components.peerStore.delete(e),je(new Error("dial with more addresses than allowed"),GG.ERR_TOO_MANY_ADDRESSES);return{id:e.toString(),addrs:r}}_createPendingDial(e,t={}){const n=async(e,t={})=>{if(!0===t.signal?.aborted)throw je(new Error("already aborted"),GG.ERR_ALREADY_ABORTED);return await this.components.transportManager.dial(e,t).catch((t=>{throw $X.error("dial to %s failed",e,t),t}))},r=new zX({addrs:e.addrs,dialAction:n,dialer:this}),s=new Ho.TimeoutController(this.timeout),i=[s.signal];null!=t.signal&&i.push(t.signal);const o=(0,al.anySignal)(i);try{(0,XG.setMaxListeners)?.(1/0,o)}catch{}const a={dialRequest:r,controller:s,promise:r.run({...t,signal:o}),destroy:()=>{s.clear(),this.pendingDials.delete(e.id)}};return this.pendingDials.set(e.id,a),a}getTokens(e){const t=Math.min(e,this.maxDialsPerPeer,this.tokens.length),n=this.tokens.splice(0,t);return $X("%d tokens request, returning %d, %d remaining",e,t,this.tokens.length),n}releaseToken(e){this.tokens.includes(e)||($X("token %d released",e),this.tokens.push(e))}async _resolve(e,t){const n=e.protoNames().includes("dnsaddr");if(!n)return[e];const r=await this._resolveRecord(e,t),s=await Promise.all(r.map((async e=>await this._resolve(e,t)))),i=s.flat();return i.reduce(((e,t)=>(null==e.find((e=>e.equals(t)))&&e.push(t),e)),[])}async _resolveRecord(e,t){try{e=dc(e.toString());const n=await e.resolve(t);return n}catch(uS){return $X.error(`multiaddr ${e.toString()} could not be resolved`,uS),[]}}}const WX=Fe("libp2p");class YX extends gL{constructor(e){super(),this.started=!1,this.peerId=e.peerId;const t=this.components=new wX({peerId:e.peerId,datastore:e.datastore??new fm,connectionGater:{denyDialPeer:async()=>await Promise.resolve(!1),denyDialMultiaddr:async()=>await Promise.resolve(!1),denyInboundConnection:async()=>await Promise.resolve(!1),denyOutboundConnection:async()=>await Promise.resolve(!1),denyInboundEncryptedConnection:async()=>await Promise.resolve(!1),denyOutboundEncryptedConnection:async()=>await Promise.resolve(!1),denyInboundUpgradedConnection:async()=>await Promise.resolve(!1),denyOutboundUpgradedConnection:async()=>await Promise.resolve(!1),filterMultiaddrForPeer:async()=>await Promise.resolve(!0),...e.connectionGater}});t.peerStore=new mX(t,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...e.peerStore}),this.services=[t],e.metrics.enabled&&(this.metrics=this.components.metrics=new aJ(e.metrics)),this.peerStore=this.components.peerStore,this.peerStore.addEventListener("peer",(e=>{const{detail:t}=e;this.dispatchEvent(new yL("peer:discovery",{detail:t}))})),null!=e.connectionProtector&&(this.components.connectionProtector=e.connectionProtector(t)),this.components.upgrader=new nQ(this.components,{connectionEncryption:(e.connectionEncryption??[]).map((e=>this.configureComponent(e(this.components)))),muxers:(e.streamMuxers??[]).map((e=>this.configureComponent(e(this.components)))),inboundUpgradeTimeout:e.connectionManager.inboundUpgradeTimeout}),this.components.dialer=new GX(this.components,e.connectionManager),this.connectionManager=this.components.connectionManager=new TW(this.components,e.connectionManager),this.registrar=this.components.registrar=new QJ(this.components),this.components.transportManager=new IJ(this.components,e.transportManager),this.components.addressManager=new iW(this.components,e.addresses),this.configureComponent(new HQ(this.components)),this.configureComponent(new RW(this.components,{enabled:e.connectionManager.autoDial,minConnections:e.connectionManager.minConnections,autoDialInterval:e.connectionManager.autoDialInterval}));const n=WY.generateOptions();this.keychain=this.configureComponent(new WY(this.components,{...n,...e.keychain})),this.services.push(new zQ(this.components,e.nat)),e.transports.forEach((e=>{this.components.transportManager.add(this.configureComponent(e(this.components)))})),this.identifyService=new fQ(this.components,{...e.identify}),this.configureComponent(this.identifyService),null!=e.dht?this.dht=this.components.dht=e.dht(this.components):this.dht=new BX,null!=e.pubsub?this.pubsub=this.components.pubsub=e.pubsub(this.components):this.pubsub=new UX;const r=(e.peerRouters??[]).map((e=>this.configureComponent(e(this.components))));null!=e.dht&&(r.push(this.configureComponent(new KQ(this.dht))),this.dht.addEventListener("peer",(e=>{this.onDiscoveryPeer(e)}))),this.peerRouting=this.components.peerRouting=this.configureComponent(new eW(this.components,{...e.peerRouting,routers:r}));const s=(e.contentRouters??[]).map((e=>this.configureComponent(e(this.components))));null!=e.dht&&s.push(this.configureComponent(new yX(this.dht))),this.contentRouting=this.components.contentRouting=this.configureComponent(new tW(this.components,{routers:s})),e.relay.enabled&&(this.components.transportManager.add(this.configureComponent(new YW(this.components,e.relay))),this.configureComponent(new OY(this.components,{addressSorter:e.connectionManager.addressSorter,...e.relay}))),this.fetchService=this.configureComponent(new vQ(this.components,{...e.fetch})),this.pingService=this.configureComponent(new AQ(this.components,{...e.ping}));for(const i of e.peerDiscovery??[]){const e=this.configureComponent(i(this.components));e.addEventListener("peer",(e=>{this.onDiscoveryPeer(e)}))}}configureComponent(e){return AU(e)&&this.services.push(e),e}async start(){if(!this.started){this.started=!0,WX("libp2p is starting");try{await Promise.all(this.services.map((async e=>{null!=e.beforeStart&&await e.beforeStart()}))),await Promise.all(this.services.map((e=>e.start()))),await Promise.all(this.services.map((async e=>{null!=e.afterStart&&await e.afterStart()}))),WX("libp2p has started")}catch(uS){throw WX.error("An error occurred starting libp2p",uS),await this.stop(),uS}}}async stop(){this.started&&(WX("libp2p is stopping"),this.started=!1,await Promise.all(this.services.map((async e=>{null!=e.beforeStop&&await e.beforeStop()}))),await Promise.all(this.services.map((e=>e.stop()))),await Promise.all(this.services.map((async e=>{null!=e.afterStop&&await e.afterStop()}))),WX("libp2p has stopped"))}isStarted(){return this.started}getConnections(e){return this.components.connectionManager.getConnections(e)}getPeers(){const e=new yW;for(const t of this.components.connectionManager.getConnections())e.add(t.remotePeer);return Array.from(e)}async dial(e,t={}){const{id:n,multiaddrs:r}=rW(e);return await this.components.peerStore.addressBook.add(n,r),await this.components.connectionManager.openConnection(n,t)}async dialProtocol(e,t,n={}){if(null==t)throw je(new Error("no protocols were provided to open a stream"),GG.ERR_INVALID_PROTOCOLS_FOR_STREAM);if(t=Array.isArray(t)?t:[t],0===t.length)throw je(new Error("no protocols were provided to open a stream"),GG.ERR_INVALID_PROTOCOLS_FOR_STREAM);const r=await this.dial(e,n);return await r.newStream(t,n)}getMultiaddrs(){return this.components.addressManager.getAddresses()}async hangUp(e){const{id:t}=rW(e);await this.components.connectionManager.closeConnections(t)}async getPublicKey(e,t={}){if(WX("getPublicKey %p",e),null!=e.publicKey)return e.publicKey;const n=await this.peerStore.get(e);if(null!=n.pubKey)return n.pubKey;if(null==this.dht)throw je(new Error("Public key was not in the peer store and the DHT is not enabled"),GG.ERR_NO_ROUTERS_AVAILABLE);const r=ya([$o("/pk/"),e.multihash.digest]);for await(const s of this.dht.get(r,t))if("VALUE"===s.name){const t=Gf(s.value);return await this.peerStore.keyBook.set(e,s.value),t.bytes}throw je(new Error(`Node not responding with its public key: ${e.toString()}`),GG.ERR_INVALID_RECORD)}async fetch(e,t,n={}){const{id:r,multiaddrs:s}=rW(e);return null!=s&&await this.components.peerStore.addressBook.add(r,s),await this.fetchService.fetch(r,t,n)}async ping(e,t={}){const{id:n,multiaddrs:r}=rW(e);return r.length>0&&await this.components.peerStore.addressBook.add(n,r),await this.pingService.ping(n,t)}async handle(e,t,n){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.handle(e,t,n)})))}async unhandle(e){Array.isArray(e)||(e=[e]),await Promise.all(e.map((async e=>{await this.components.registrar.unhandle(e)})))}onDiscoveryPeer(e){const{detail:t}=e;t.id.toString()!==this.peerId.toString()?(t.multiaddrs.length>0&&this.components.peerStore.addressBook.add(t.id,t.multiaddrs).catch((e=>WX.error(e))),t.protocols.length>0&&this.components.peerStore.protoBook.set(t.id,t.protocols).catch((e=>WX.error(e))),this.dispatchEvent(new yL("peer:discovery",{detail:t}))):WX.error(new Error(GG.ERR_DISCOVERED_SELF))}}async function JX(e){return null==e.peerId&&(e.peerId=await PX()),new YX(NX(e))}async function QX(e){return await JX(e)}var XX=n(1918);const ZX=1e3,eZ=60*ZX,tZ=60*eZ,nZ=36*tZ,rZ="/lan",sZ="/ipfs",iZ="/kad/1.0.0",oZ="/dht/record",aZ="/dht/provider",cZ=256,lZ=24*tZ,uZ=tZ,hZ=20,dZ=3,pZ=Number(5*eZ),fZ=Number(30*ZX),gZ=Number(5*eZ),mZ=Number(30*ZX),yZ=Number(30*ZX),wZ=$o("/pk/");function bZ(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,n]]=e.stringTuples();return(4===t||6===t)&&(null!=n&&!MQ(n))}))}}function vZ(e){return{...e,multiaddrs:e.multiaddrs.filter((e=>{const[[t,n]]=e.stringTuples();return(4===t||6===t)&&(null!=n&&MQ(n))}))}}async function EZ(e){const t=await ho.digest(e);return t.digest}async function _Z(e){return await EZ(e.toBytes())}function SZ(e){return new rl(`${oZ}/${ia(e,"base32")}`,!1)}function kZ(e){return ya([wZ,e.toBytes()])}function AZ(e){return"/pk/"===ia(e.subarray(0,4))}function TZ(e){return ju(e.subarray(4))}function CZ(e,t){const n=new Date,r=new Nm(e,t,n);return r.serialize()}function IZ(e,t=100){let n;return()=>{clearTimeout(n),n=setTimeout((()=>e()),t)}}const RZ="kad-close",OZ=50,xZ=20,NZ=1e4,DZ=10,PZ="routing-table-size",LZ="ping-queue-size",MZ="ping-running";class BZ{constructor(e,t){const{kBucketSize:n,pingTimeout:r,lan:s,pingConcurrency:i,protocol:o,tagName:a,tagValue:c}=t;this.components=e,this.log=Fe(`libp2p:kad-dht:${s?"lan":"wan"}:routing-table`),this.kBucketSize=n??xZ,this.pingTimeout=r??NZ,this.pingConcurrency=i??DZ,this.lan=s,this.running=!1,this.protocol=o,this.tagName=a??RZ,this.tagValue=c??OZ;const l=()=>{this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:LZ,value:this.pingQueue.size}),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:MZ,value:this.pingQueue.pending})};this.pingQueue=new yu({concurrency:this.pingConcurrency}),this.pingQueue.addListener("add",l),this.pingQueue.addListener("next",l),this._onPing=this._onPing.bind(this)}isStarted(){return this.running}async start(){this.running=!0;const e=new XX({localNodeId:await _Z(this.components.peerId),numberOfNodesPerKBucket:this.kBucketSize,numberOfNodesToPing:1});this.kb=e,e.on("ping",this._onPing),this._tagPeers(e)}async stop(){this.running=!1,this.pingQueue.clear(),this.kb=void 0}_tagPeers(e){let t=new yW;const n=IZ((()=>{const n=new yW(e.closest(e.localNodeId,xZ).map((e=>e.peer))),r=n.difference(t),s=t.difference(n);Promise.resolve().then((async()=>{for(const e of r)await this.components.peerStore.tagPeer(e,this.tagName,{value:this.tagValue});for(const e of s)await this.components.peerStore.unTagPeer(e,this.tagName)})).catch((e=>{this.log.error("Could not update peer tags",e)})),t=n}));e.on("added",(()=>{n()})),e.on("removed",(()=>{n()}))}_onPing(e,t){this.pingQueue.add((async()=>{if(!this.running)return;let n=0;try{await Promise.all(e.map((async e=>{let t;try{t=new Ho.TimeoutController(this.pingTimeout);const r={signal:t.signal};this.log("pinging old contact %p",e.peer);const s=await this.components.connectionManager.openConnection(e.peer,r),i=await s.newStream(this.protocol,r);i.close(),n++}catch(uS){this.running&&null!=this.kb&&(this.log.error("could not ping peer %p",e.peer,uS),this.log("evicting old contact after ping failed %p",e),this.kb.remove(e.id))}finally{null!=t&&t.clear(),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:PZ,value:this.size})}}))),this.running&&n<e.length&&null!=this.kb&&(this.log("adding new contact %p",t.peer),this.kb.add(t))}catch(uS){this.log.error("could not process k-bucket ping event",uS)}})).catch((e=>{this.log.error("could not process k-bucket ping event",e)}))}get size(){return null==this.kb?0:this.kb.count()}async find(e){const t=await _Z(e),n=this.closestPeer(t);if(null!=n&&e.equals(n))return n}closestPeer(e){const t=this.closestPeers(e,1);if(t.length>0)return t[0]}closestPeers(e,t=this.kBucketSize){if(null==this.kb)return[];const n=this.kb.closest(e,t);return n.map((e=>e.peer))}async add(e){if(null==this.kb)throw new Error("RoutingTable is not started");const t=await _Z(e);this.kb.add({id:t,peer:e}),this.log("added %p with kad id %b",e,t),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:PZ,value:this.size})}async remove(e){if(null==this.kb)throw new Error("RoutingTable is not started");const t=await _Z(e);this.kb.remove(t),this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:PZ,value:this.size})}}var UZ=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782];const VZ=15;class FZ{constructor(e){const{peerRouting:t,routingTable:n,refreshInterval:r,refreshQueryTimeout:s,lan:i}=e;this.log=Fe(`libp2p:kad-dht:${i?"lan":"wan"}:routing-table:refresh`),this.peerRouting=t,this.routingTable=n,this.refreshInterval=r??gZ,this.refreshQueryTimeout=s??mZ,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async start(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){null!=this.refreshTimeoutId&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1){this.log("refreshing routing table");const t=this._maxCommonPrefix(),n=this._getTrackedCommonPrefixLengthsForRefresh(t);this.log(`max common prefix length ${t}`),this.log(`tracked CPLs [ ${n.map((e=>e.toISOString())).join(", ")} ]`),Promise.all(n.map((async(r,s)=>{try{if(await this._refreshCommonPrefixLength(s,r,e),0===this._numPeersForCpl(t)){const t=Math.min(2*(s+1),n.length-1);for(let n=s+1;n<t+1;n++)try{await this._refreshCommonPrefixLength(n,r,e)}catch(uS){this.log.error(uS)}}}catch(uS){this.log.error(uS)}}))).catch((e=>{this.log.error(e)})).then((()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),null!=this.refreshTimeoutId.unref&&this.refreshTimeoutId.unref()})).catch((e=>{this.log.error(e)}))}async _refreshCommonPrefixLength(e,t,n){if(!n&&t.getTime()>Date.now()-this.refreshInterval)return void this.log("not running refresh for cpl %s as time since last refresh not above interval",e);const r=await this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,r,this.routingTable.size);const s=new Ho.TimeoutController(this.refreshQueryTimeout);try{const t=await Px(this.peerRouting.getClosestPeers(r.toBytes(),{signal:s.signal}));this.log(`found ${t} peers that were close to imaginary peer %p`,r),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,r,this.routingTable.size)}finally{s.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>VZ&&(e=VZ);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}async _generateRandomPeerId(e){if(null==this.routingTable.kb)throw new Error("Routing table not started");const t=Kd(2),n=(t[1]<<8)+t[0],r=await this._makePeerId(this.routingTable.kb.localNodeId,n,e);return ju(r)}async _makePeerId(e,t,n){if(n>VZ)throw new Error(`Cannot generate peer ID for common prefix length greater than ${VZ}`);const r=new DataView(e.buffer,e.byteOffset,e.byteLength),s=r.getUint16(0,!1),i=s^32768>>n,o=65535<<16-(n+1),a=i&o|t&~o,c=UZ[a],l=new ArrayBuffer(34),u=new DataView(l,0,l.byteLength);return u.setUint8(0,ho.code),u.setUint8(1,32),u.setUint32(2,c,!1),new Uint8Array(u.buffer,u.byteOffset,u.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){if(null!=this.routingTable.kb)for(const{id:e}of this.routingTable.kb.toIterable()){const t=LG(this.routingTable.kb.localNodeId,e);let n=0;for(const e of t){if(0!==e)break;n++}yield n}}}var jZ,zZ;(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),null!=e.key&&(t.uint32(10),t.bytes(e.key)),null!=e.value&&(t.uint32(18),t.bytes(e.value)),null!=e.author&&(t.uint32(26),t.bytes(e.author)),null!=e.signature&&(t.uint32(34),t.bytes(e.signature)),null!=e.timeReceived&&(t.uint32(42),t.string(e.timeReceived)),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.key=e.bytes();break;case 2:n.value=e.bytes();break;case 3:n.author=e.bytes();break;case 4:n.signature=e.bytes();break;case 5:n.timeReceived=e.string();break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(jZ||(jZ={})),function(e){let t,n,r,s,i,o;(function(e){e["PUT_VALUE"]="PUT_VALUE",e["GET_VALUE"]="GET_VALUE",e["ADD_PROVIDER"]="ADD_PROVIDER",e["GET_PROVIDERS"]="GET_PROVIDERS",e["FIND_NODE"]="FIND_NODE",e["PING"]="PING"})(t=e.MessageType||(e.MessageType={})),function(e){e[e["PUT_VALUE"]=0]="PUT_VALUE",e[e["GET_VALUE"]=1]="GET_VALUE",e[e["ADD_PROVIDER"]=2]="ADD_PROVIDER",e[e["GET_PROVIDERS"]=3]="GET_PROVIDERS",e[e["FIND_NODE"]=4]="FIND_NODE",e[e["PING"]=5]="PING"}(n||(n={})),function(e){e.codec=()=>Ch(n)}(t=e.MessageType||(e.MessageType={})),function(e){e["NOT_CONNECTED"]="NOT_CONNECTED",e["CONNECTED"]="CONNECTED",e["CAN_CONNECT"]="CAN_CONNECT",e["CANNOT_CONNECT"]="CANNOT_CONNECT"}(r=e.ConnectionType||(e.ConnectionType={})),function(e){e[e["NOT_CONNECTED"]=0]="NOT_CONNECTED",e[e["CONNECTED"]=1]="CONNECTED",e[e["CAN_CONNECT"]=2]="CAN_CONNECT",e[e["CANNOT_CONNECT"]=3]="CANNOT_CONNECT"}(s||(s={})),function(e){e.codec=()=>Ch(s)}(r=e.ConnectionType||(e.ConnectionType={})),function(t){let n;t.codec=()=>(null==n&&(n=Ih(((t,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),null!=t.id&&(n.uint32(10),n.bytes(t.id)),null==t.addrs)throw new Error('Protocol error: required field "addrs" was not found in object');for(const e of t.addrs)n.uint32(18),n.bytes(e);null!=t.connection&&(n.uint32(24),e.ConnectionType.codec().encode(t.connection,n)),!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={addrs:[]},s=null==n?t.len:t.pos+n;while(t.pos<s){const n=t.uint32();switch(n>>>3){case 1:r.id=t.bytes();break;case 2:r.addrs.push(t.bytes());break;case 3:r.connection=e.ConnectionType.codec().decode(t);break;default:t.skipType(7&n);break}}return r}))),n),t.encode=e=>vh(e,t.codec()),t.decode=e=>bh(e,t.codec())}(i=e.Peer||(e.Peer={})),e.codec=()=>(null==o&&(o=Ih(((t,n,r={})=>{if(!1!==r.lengthDelimited&&n.fork(),null!=t.type&&(n.uint32(8),e.MessageType.codec().encode(t.type,n)),null!=t.clusterLevelRaw&&(n.uint32(80),n.int32(t.clusterLevelRaw)),null!=t.key&&(n.uint32(18),n.bytes(t.key)),null!=t.record&&(n.uint32(26),n.bytes(t.record)),null==t.closerPeers)throw new Error('Protocol error: required field "closerPeers" was not found in object');for(const s of t.closerPeers)n.uint32(66),e.Peer.codec().encode(s,n);if(null==t.providerPeers)throw new Error('Protocol error: required field "providerPeers" was not found in object');for(const s of t.providerPeers)n.uint32(74),e.Peer.codec().encode(s,n);!1!==r.lengthDelimited&&n.ldelim()}),((t,n)=>{const r={closerPeers:[],providerPeers:[]},s=null==n?t.len:t.pos+n;while(t.pos<s){const n=t.uint32();switch(n>>>3){case 1:r.type=e.MessageType.codec().decode(t);break;case 10:r.clusterLevelRaw=t.int32();break;case 2:r.key=t.bytes();break;case 3:r.record=t.bytes();break;case 8:r.closerPeers.push(e.Peer.codec().decode(t,t.uint32()));break;case 9:r.providerPeers.push(e.Peer.codec().decode(t,t.uint32()));break;default:t.skipType(7&n);break}}return r}))),o),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(zZ||(zZ={}));const $Z=zZ.MessageType,HZ=zZ.ConnectionType,KZ=Object.keys($Z);class qZ{constructor(e,t,n){if(!(t instanceof Uint8Array))throw new Error("Key must be a Uint8Array");this.type=e,this.key=t,this.clusterLevelRaw=n,this.closerPeers=[],this.providerPeers=[],this.record=void 0}get clusterLevel(){const e=this.clusterLevelRaw-1;return e<0?0:e}set clusterLevel(e){this.clusterLevelRaw=e}serialize(){return zZ.encode({key:this.key,type:this.type,clusterLevelRaw:this.clusterLevelRaw,closerPeers:this.closerPeers.map(GZ),providerPeers:this.providerPeers.map(GZ),record:null==this.record?void 0:this.record.serialize().subarray()})}static deserialize(e){const t=zZ.decode(e),n=new qZ(t.type??zZ.MessageType.PUT_VALUE,t.key??Uint8Array.from([]),t.clusterLevelRaw??0);return n.closerPeers=t.closerPeers.map(WZ),n.providerPeers=t.providerPeers.map(WZ),null!=t.record?.length&&(n.record=Nm.deserialize(t.record)),n}}function GZ(e){const t={id:e.id.toBytes(),addrs:(e.multiaddrs??[]).map((e=>e.bytes)),connection:HZ.CONNECTED};return t}function WZ(e){if(null==e.id)throw new Error("Invalid peer in message");return{id:ju(e.id),multiaddrs:(e.addrs??[]).map((e=>dc(e))),protocols:[]}}function YZ(e){return{...e,name:"SENDING_QUERY",type:0,messageName:e.type,messageType:KZ.indexOf(e.type.toString())}}function JZ(e){return{...e,name:"PEER_RESPONSE",type:1,messageName:e.messageType,closer:null!=e.closer?e.closer:[],providers:null!=e.providers?e.providers:[]}}function QZ(e){return{...e,name:"FINAL_PEER",type:2}}function XZ(e){return{...e,name:"QUERY_ERROR",type:3}}function ZZ(e){return{...e,name:"PROVIDER",type:4}}function e1(e){return{...e,name:"VALUE",type:5}}function t1(e){return{...e,name:"DIALING_PEER",type:7}}class n1 extends gL{constructor(e,t){super();const{protocol:n,lan:r}=t;this.components=e,this.log=Fe(`libp2p:kad-dht:${r?"lan":"wan"}:network`),this.running=!1,this.protocol=n}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(e,t,n={}){if(!this.running)return;let r;this.log("sending %s to %p",t.type,e),yield t1({peer:e}),yield YZ({to:e,type:t.type});try{const r=await this.components.connectionManager.openConnection(e,n),s=await r.newStream(this.protocol,n),i=await this._writeReadMessage(s,t.serialize(),n);yield JZ({from:e,messageType:i.type,closer:i.closerPeers,providers:i.providerPeers,record:i.record})}catch(uS){yield XZ({from:e,error:uS})}finally{null!=r&&r.close()}}async*sendMessage(e,t,n={}){if(!this.running)return;let r;this.log("sending %s to %p",t.type,e),yield t1({peer:e}),yield YZ({to:e,type:t.type});try{const r=await this.components.connectionManager.openConnection(e,n),s=await r.newStream(this.protocol,n);await this._writeMessage(s,t.serialize(),n),yield JZ({from:e,messageType:t.type})}catch(uS){yield XZ({from:e,error:uS})}finally{null!=r&&r.close()}}async _writeMessage(e,t,n){null!=n.signal&&(e=ej(e,n.signal)),await vm([t],rj(),e,Zg)}async _writeReadMessage(e,t,n){null!=n.signal&&(e=ej(e,n.signal));const r=await vm([t],rj(),e,cj(),(async e=>{const t=await rI(e);if(null!=t)return t;throw je(new Error("No message received"),"ERR_NO_MESSAGE_RECEIVED")})),s=qZ.deserialize(r);return s.closerPeers.forEach((e=>{this.dispatchEvent(new yL("peer",{detail:e}))})),s.providerPeers.forEach((e=>{this.dispatchEvent(new yL("peer",{detail:e}))})),s}}function r1(e,t){const n=t.key,r=ia(n),s=r.split("/");if(s.length<3)return;const i=e[s[1].toString()];if(null==i){const e="Invalid record keytype";throw je(new Error(e),"ERR_INVALID_RECORD_KEY_TYPE")}return i(n,t.value)}const s1=async(e,t)=>{if(!(e instanceof Uint8Array))throw je(new Error('"key" must be a Uint8Array'),"ERR_INVALID_RECORD_KEY_NOT_BUFFER");if(e.byteLength<5)throw je(new Error("invalid public key record"),"ERR_INVALID_RECORD_KEY_TOO_SHORT");const n=ia(e.subarray(0,4));if("/pk/"!==n)throw je(new Error("key was not prefixed with /pk/"),"ERR_INVALID_RECORD_KEY_BAD_PREFIX");const r=e.slice(4),s=await ho.digest(t);if(!Ja(r,s.bytes))throw je(new Error("public key does not match passed in key"),"ERR_INVALID_RECORD_HASH_MISMATCH")},i1={pk:s1};function o1(e,t,n){if(0===n.length){const e="No records given";throw je(new Error(e),"ERR_NO_RECORDS_RECEIVED")}const r=ia(t),s=r.split("/");if(s.length<3){const e="Record key does not have a selector function";throw je(new Error(e),"ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY")}const i=e[s[1].toString()];if(null==i){const e=`Unrecognized key prefix: ${s[1]}`;throw je(new Error(e),"ERR_UNRECOGNIZED_KEY_PREFIX")}return 1===n.length?0:i(t,n)}function a1(e,t){return 0}const c1={pk:a1};class l1{constructor(e,t){const{validators:n,selectors:r,peerRouting:s,queryManager:i,routingTable:o,network:a,lan:c}=t;this.components=e,this.log=Fe(`libp2p:kad-dht:${c?"lan":"wan"}:content-fetching`),this.validators=n,this.selectors=r,this.peerRouting=s,this.queryManager=i,this.routingTable=o,this.network=a}async putLocal(e,t){const n=SZ(e);await this.components.datastore.put(n,t)}async getLocal(e){this.log("getLocal %b",e);const t=SZ(e);this.log("fetching record for key %k",t);const n=await this.components.datastore.get(t);this.log("found %k in local datastore",t);const r=Nm.deserialize(n);return await r1(this.validators,r),r}async*sendCorrectionRecord(e,t,n,r={}){this.log("sendCorrection for %b",e);const s=await CZ(e,n);for(const{value:i,from:o}of t){if(Ja(i,n)){this.log("record was ok");continue}if(this.components.peerId.equals(o)){try{const t=SZ(e);this.log(`Storing corrected record for key ${t.toString()}`),await this.components.datastore.put(t,s.subarray())}catch(uS){this.log.error("Failed error correcting self",uS)}continue}let t=!1;const a=new qZ($Z.PUT_VALUE,e,0);a.record=Nm.deserialize(s);for await(const e of this.network.sendRequest(o,a,r))"PEER_RESPONSE"===e.name&&null!=e.record&&Ja(e.record.value,Nm.deserialize(s).value)&&(t=!0),yield e;t||(yield XZ({from:o,error:je(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})),this.log.error("Failed error correcting entry")}}async*put(e,t,n={}){this.log("put key %b value %b",e,t);const r=await CZ(e,t),s=SZ(e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,r.subarray()),yield*vm(this.peerRouting.getClosestPeers(e,{signal:n.signal}),(t=>Iy(t,(t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const s=[],i=new qZ($Z.PUT_VALUE,e,0);i.record=Nm.deserialize(r),this.log("send put to %p",t.peer.id);for await(const e of this.network.sendRequest(t.peer.id,i,n))s.push(e),"PEER_RESPONSE"===e.name&&(null!=e.record&&Ja(e.record.value,Nm.deserialize(r).value)||s.push(XZ({from:t.peer.id,error:je(new Error("value not put correctly"),"ERR_PUT_VALUE_INVALID")})));return s}))),(e=>Cy(e,{ordered:!1,concurrency:dZ})),(async function*(e){for await(const t of e)yield*t}))}async*get(e,t={}){this.log("get %b",e);const n=[];for await(const o of this.getMany(e,t))"VALUE"===o.name&&n.push(o),yield o;if(0===n.length)return;const r=n.map((e=>e.value));let s=0;try{s=o1(this.selectors,e,r)}catch(uS){if("ERR_NO_SELECTOR_FUNCTION_FOR_RECORD_KEY"!==uS.code)throw uS}const i=r[s];if(this.log("GetValue %b %b",e,i),null==i)throw je(new Error("best value was not found"),"ERR_NOT_FOUND");yield*this.sendCorrectionRecord(e,n,i,t),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const t=await this.getLocal(e);yield e1({value:t.value,from:this.components.peerId})}catch(uS){this.log("error getting local value for %b",e,uS)}const n=await EZ(e),r=this.routingTable.closestPeers(n);this.log("found %d peers in routing table",r.length);const s=this,i=async function*({peer:t,signal:n}){for await(const r of s.peerRouting.getValueOrPeers(t,e,{signal:n}))yield r,"PEER_RESPONSE"===r.name&&null!=r.record&&(yield e1({from:t,value:r.record.value}))};yield*this.queryManager.run(e,r,i,t)}}class u1{constructor(e,t){const{network:n,peerRouting:r,queryManager:s,routingTable:i,providers:o,lan:a}=t;this.components=e,this.log=Fe(`libp2p:kad-dht:${a?"lan":"wan"}:content-routing`),this.network=n,this.peerRouting=r,this.queryManager=s,this.routingTable=i,this.providers=o}async*provide(e,t,n={}){this.log("provide %s",e),await this.providers.addProvider(e,this.components.peerId);const r=new qZ($Z.ADD_PROVIDER,e.bytes,0);r.providerPeers=[{id:this.components.peerId,multiaddrs:t,protocols:[]}];let s=0;const i=t=>async()=>{if("FINAL_PEER"!==t.name)return[t];const i=[];this.log("putProvider %s to %p",e,t.peer.id);try{this.log("sending provider record for %s to %p",e,t.peer.id);for await(const o of this.network.sendMessage(t.peer.id,r,n))"PEER_RESPONSE"===o.name&&(this.log("sent provider record for %s to %p",e,t.peer.id),s++),i.push(o)}catch(uS){this.log.error("error sending provide record to peer %p",t.peer.id,uS),i.push(XZ({from:t.peer.id,error:uS}))}return i};yield*vm(this.peerRouting.getClosestPeers(e.multihash.bytes,n),(e=>Iy(e,(e=>i(e)))),(e=>Cy(e,{ordered:!1,concurrency:dZ})),(async function*(e){for await(const t of e)yield*t})),this.log("sent provider records to %d peers",s)}async*findProviders(e,t){const n=this.routingTable.kBucketSize,r=e.multihash.bytes,s=await EZ(r),i=this;this.log("findProviders %c",e);const o=await this.providers.getProviders(e);if(o.length>0){const e=[];for(const t of o.slice(0,n))e.push({id:t,multiaddrs:(await this.components.peerStore.addressBook.get(t)??[]).map((e=>e.multiaddr)),protocols:[]});yield JZ({from:this.components.peerId,messageType:$Z.GET_PROVIDERS,providers:e}),yield ZZ({from:this.components.peerId,providers:e})}if(o.length>=n)return;const a=async function*({peer:e,signal:t}){const n=new qZ($Z.GET_PROVIDERS,r,0);yield*i.network.sendRequest(e,n,{signal:t})},c=new Set(o.map((e=>e.toString())));for await(const l of this.queryManager.run(r,this.routingTable.closestPeers(s),a,t))if(yield l,"PEER_RESPONSE"===l.name){this.log("Found %d provider entries for %c and %d closer peers",l.providers.length,e,l.closer.length);const t=[];for(const e of l.providers)c.has(e.id.toString())||(c.add(e.id.toString()),t.push(e));if(t.length>0&&(yield ZZ({from:l.from,providers:t})),c.size===n)return}}}class h1{constructor(e,t){this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return this.peerDistances.map((e=>e.peerId))}async add(e){if(null!=this.peerDistances.find((t=>t.peerId.equals(e))))return;const t=await _Z(e),n={peerId:e,distance:LG(this.originDhtKey,t)};this.peerDistances.push(n),this.peerDistances.sort(((e,t)=>Xx(e.distance,t.distance))),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async anyCloser(e){if(0===e.length)return!1;if(0===this.length)return!0;const t=await Promise.all(e.map(_Z)),n=this.peerDistances[this.peerDistances.length-1].distance;for(const r of t){const e=LG(this.originDhtKey,r);if(Xx(e,n)<0)return!0}return!1}}class d1{constructor(e,t){const{routingTable:n,network:r,validators:s,queryManager:i,lan:o}=t;this.components=e,this.routingTable=n,this.network=r,this.validators=s,this.queryManager=i,this.log=Fe(`libp2p:kad-dht:${o?"lan":"wan"}:peer-routing`)}async findPeerLocal(e){let t;const n=await this.routingTable.find(e);if(null!=n){this.log("findPeerLocal found %p in routing table",e);try{t=await this.components.peerStore.get(n)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}}if(null==t)try{t=await this.components.peerStore.get(e)}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}if(null!=t)return this.log("findPeerLocal found %p in peer store",e),{id:t.id,multiaddrs:t.addresses.map((e=>e.multiaddr)),protocols:[]}}async*_getValueSingle(e,t,n={}){const r=new qZ($Z.GET_VALUE,t,0);yield*this.network.sendRequest(e,r,n)}async*getPublicKeyFromNode(e,t={}){const n=kZ(e);for await(const r of this._getValueSingle(e,n,t))if(yield r,"PEER_RESPONSE"===r.name&&null!=r.record){const t=await $u(Wf({bytes:r.record.value}));if(!t.equals(e))throw je(new Error("public key does not match id"),"ERR_PUBLIC_KEY_DOES_NOT_MATCH_ID");if(null==t.publicKey)throw je(new Error("public key missing"),"ERR_PUBLIC_KEY_MISSING");yield e1({from:e,value:t.publicKey})}throw je(new Error(`Node not responding with its public key: ${e.toString()}`),"ERR_INVALID_RECORD")}async*findPeer(e,t={}){this.log("findPeer %p",e);const n=await this.findPeerLocal(e);if(null!=n)return this.log("found local"),void(yield QZ({from:this.components.peerId,peer:n}));const r=await _Z(e),s=this.routingTable.closestPeers(r),i=s.find((t=>t.equals(e)));if(null!=i)try{const t=await this.components.peerStore.get(e);return this.log("found in peerStore"),void(yield QZ({from:this.components.peerId,peer:{id:t.id,multiaddrs:t.addresses.map((e=>e.multiaddr)),protocols:[]}}))}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}const o=this,a=async function*({peer:t,signal:n}){const r=new qZ($Z.FIND_NODE,e.toBytes(),0);for await(const s of o.network.sendRequest(t,r,{signal:n}))if(yield s,"PEER_RESPONSE"===s.name){const t=s.closer.find((t=>t.id.equals(e)));null!=t&&(yield QZ({from:s.from,peer:t}))}};let c=!1;for await(const l of this.queryManager.run(e.toBytes(),s,a,t))"FINAL_PEER"===l.name&&(c=!0),yield l;c||(yield XZ({from:this.components.peerId,error:je(new Error("Not found"),"ERR_NOT_FOUND")}))}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await EZ(e),r=this.routingTable.closestPeers(n),s=this,i=new h1(n,this.routingTable.kBucketSize);await Promise.all(r.map((async e=>await i.add(e))));const o=async function*({peer:t,signal:n}){s.log("closerPeersSingle %s from %p",ia(e,"base32"),t);const r=new qZ($Z.FIND_NODE,e,0);yield*s.network.sendRequest(t,r,{signal:n})};for await(const a of this.queryManager.run(e,r,o,t))yield a,"PEER_RESPONSE"===a.name&&await Promise.all(a.closer.map((async e=>await i.add(e.id))));this.log("found %d peers close to %b",i.length,e);for(const a of i.peers)yield QZ({from:this.components.peerId,peer:{id:a,multiaddrs:(await this.components.peerStore.addressBook.get(a)??[]).map((e=>e.multiaddr)),protocols:[]}})}async*getValueOrPeers(e,t,n={}){for await(const r of this._getValueSingle(e,t,n)){if("PEER_RESPONSE"===r.name&&null!=r.record)try{await this._verifyRecordOnline(r.record)}catch(uS){const t="invalid record received, discarded";this.log(t),yield XZ({from:r.from,error:je(new Error(t),"ERR_INVALID_RECORD")});continue}yield r}}async _verifyRecordOnline(e){if(null==e.timeReceived)throw je(new Error("invalid record received"),"ERR_INVALID_RECORD");await r1(this.validators,new Nm(e.key,e.value,e.timeReceived))}async getCloserPeersOffline(e,t){const n=await EZ(e),r=this.routingTable.closestPeers(n),s=[];for(const i of r)if(!i.equals(t))try{const e=await this.components.peerStore.addressBook.get(i),t=await this.components.peerStore.protoBook.get(i);s.push({id:i,multiaddrs:e.map((e=>e.multiaddr)),protocols:t})}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}return s.length>0?this.log("getCloserPeersOffline found %d peer(s) closer to %b than %p",s.length,e,t):this.log("getCloserPeersOffline could not find peer closer to %b than %p",e,t),s}}const p1=Fe("libp2p:kad-dht:providers");class f1{constructor(e,t={}){const{cacheSize:n,cleanupInterval:r,provideValidity:s}=t;this.components=e,this.cleanupInterval=r??uZ,this.provideValidity=s??lZ,this.cache=Rl(n??cZ),this.syncQueue=new yu({concurrency:1}),this.started=!1}isStarted(){return this.started}async start(){this.started||(this.started=!0,this.cleaner=setInterval((()=>{this._cleanup().catch((e=>{p1.error(e)}))}),this.cleanupInterval))}async stop(){this.started=!1,null!=this.cleaner&&(clearInterval(this.cleaner),this.cleaner=void 0)}async _cleanup(){return await this.syncQueue.add((async()=>{const e=Date.now();let t=0,n=0;const r=new Map,s=this.components.datastore.batch(),i=this.components.datastore.query({prefix:aZ});for await(const o of i)try{const{cid:e,peerId:i}=y1(o.key),a=b1(o.value).getTime(),c=Date.now(),l=c-a,u=l>this.provideValidity;if(p1("comparing: %d - %d = %d > %d %s",c,a,l,this.provideValidity,u?"(expired)":""),u){n++,s.delete(o.key);const t=r.get(e)??new Set;t.add(i),r.set(e,t)}t++}catch(uS){p1.error(uS.message)}r.size>0?(p1("deleting %d / %d entries",n,t),await s.commit()):p1("nothing to delete");for(const[o,a]of r){const e=g1(o),t=this.cache.get(e);if(null!=t){for(const e of a)t.delete(e);0===t.size?this.cache.remove(e):this.cache.set(e,t)}}p1("Cleanup successful (%dms)",Date.now()-e)}))}async _getProvidersMap(e){const t=g1(e);let n=this.cache.get(t);return null==n&&(n=await w1(this.components.datastore,e),this.cache.set(t,n)),n}async addProvider(e,t){return await this.syncQueue.add((async()=>{p1("%p provides %s",t,e);const n=await this._getProvidersMap(e);p1("loaded %s provs",n.size);const r=new Date;n.set(t.toString(),r);const s=g1(e);this.cache.set(s,n),await m1(this.components.datastore,e,t,r)}))}async getProviders(e){return await this.syncQueue.add((async()=>{p1("get providers for %s",e);const t=await this._getProvidersMap(e);return[...t.keys()].map((e=>Fu(e)))}))}}function g1(e){const t="string"===typeof e?e:ia(e.multihash.bytes,"base32");return`${aZ}/${t}`}async function m1(e,t,n,r){const s=[g1(t),"/",n.toString()].join(""),i=new rl(s),o=Uint8Array.from(ma.encode(r.getTime()));return await e.put(i,o)}function y1(e){const t=e.toString().split("/");if(5!==t.length)throw new Error(`incorrectly formatted provider entry key in datastore: ${e.toString()}`);return{cid:t[3],peerId:t[4]}}async function w1(e,t){const n=new Map,r=e.query({prefix:g1(t)});for await(const s of r){const{peerId:e}=y1(s.key);n.set(e,b1(s.value))}return n}function b1(e){return new Date(ma.decode(e))}const v1=BigInt("0xFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFF");async function*E1(e){const{key:t,startingPeer:n,ourPeerId:r,signal:s,query:i,alpha:o,pathIndex:a,numPaths:c,cleanUp:l,queryFuncTimeout:u,log:h,peersSeen:d}=e,p=new yu({concurrency:o}),f=await EZ(t);function g(e,n){if(null==e)return;d.add(e);const o=BigInt("0x"+ia(LG(n,f),"base16"));p.add((async()=>{let n;const l=[s];null!=u&&(n=new Ho.TimeoutController(u),l.push(n.signal));const m=(0,al.anySignal)(l);try{for await(const n of i({key:t,peer:e,signal:m,pathIndex:a,numPaths:c})){if(m.aborted)return;if("PEER_RESPONSE"===n.name)for(const s of n.closer){if(d.has(s.id)){h("already seen %p in query",s.id);continue}if(r.equals(s.id)){h("not querying ourselves");continue}const n=await _Z(s.id),i=BigInt("0x"+ia(LG(n,f),"base16"));i>o?h("skipping %p as they are not closer to %b than %p",s.id,t,e):(h("querying closer peer %p",s.id),g(s.id,n))}p.emit("completed",n)}n?.clear()}catch(uS){s.aborted?p.emit("error",uS):p.emit("completed",XZ({from:e,error:uS}))}finally{n?.clear()}}),{priority:v1-o}).catch((e=>{h.error(e)}))}g(n,await _Z(n)),yield*_1(p,s,l,h)}async function*_1(e,t,n,r){let s=Ay(),i=!0;const o=[],a=()=>{i&&(r("clean up queue, results %d, queue size %d, pending tasks %d",o.length,e.size,e.pending),i=!1,e.clear(),o.splice(0,o.length))};e.on("completed",(e=>{o.push(e),s.resolve()})),e.on("error",(e=>{r("queue error",e),a(),s.reject(e)})),e.on("idle",(()=>{r("queue idle"),i=!1,s.resolve()})),t.addEventListener("abort",(()=>{r("abort queue");const e=i;a(),e&&s.reject(je(new Error("Query aborted"),"ERR_QUERY_ABORTED"))})),n.addEventListener("cleanup",(()=>{a(),s.resolve()}));while(i){await s.promise,s=Ay();while(o.length>0){const e=o.shift();null!=e&&(yield e)}}yield*o}const S1="running-queries";class k1{constructor(e,t){const{lan:n=!1,disjointPaths:r=hZ,alpha:s=dZ}=t;this.components=e,this.disjointPaths=r??hZ,this.controllers=new Set,this.running=!1,this.alpha=s??dZ,this.lan=n,this.queries=0}isStarted(){return this.running}async start(){this.running=!0}async stop(){this.running=!1;for(const e of this.controllers)e.abort();this.controllers.clear()}async*run(e,t,n,r={}){if(!this.running)throw new Error("QueryManager not started");let s;if(null==r.signal){s=new Ho.TimeoutController(yZ),r.signal=s.signal;try{null!=XG.setMaxListeners&&(0,XG.setMaxListeners)(1/0,s.signal)}catch{}}const i=new AbortController;this.controllers.add(i);const o=[i.signal];null!=r.signal&&o.push(r.signal);const a=(0,al.anySignal)(o);try{null!=XG.setMaxListeners&&(0,XG.setMaxListeners)(1/0,a)}catch{}const c=Fe(`libp2p:kad-dht:${this.lan?"lan":"wan"}:query:`+ia(e,"base58btc")),l=t.slice(0,Math.min(this.disjointPaths,t.length)),u=Date.now(),h=new gL;try{if(c("query:start"),this.queries++,this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:S1,value:this.queries}),0===t.length)return void c.error("Running query with no peers");const s=new yW,i=l.map(((t,i)=>E1({key:e,startingPeer:t,ourPeerId:this.components.peerId,signal:a,query:n,pathIndex:i,numPaths:l.length,alpha:this.alpha,cleanUp:h,queryFuncTimeout:r.queryFuncTimeout,log:c,peersSeen:s})));for await(const e of gm(...i))yield e,"QUERY_ERROR"===e.name&&c("error",e.error)}catch(uS){if(this.running||"ERR_QUERY_ABORTED"!==uS.code)throw uS}finally{this.controllers.delete(i),null!=s&&s.clear(),this.queries--,this.components.metrics?.updateComponentMetric({system:"libp2p",component:"kad-dht-"+(this.lan?"lan":"wan"),metric:S1,value:this.queries}),h.dispatchEvent(new yL("cleanup")),c("query:done in %dms",Date.now()-u)}}}const A1=Fe("libp2p:kad-dht:rpc:handlers:add-provider");class T1{constructor(e){const{providers:t}=e;this.providers=t}async handle(e,t){if(A1("start"),null==t.key||0===t.key.length)throw je(new Error("Missing key"),"ERR_MISSING_KEY");let n;try{n=Lt.decode(t.key)}catch(uS){throw je(new Error("Invalid CID"),"ERR_INVALID_CID")}null!=t.providerPeers&&0!==t.providerPeers.length||A1.error("no providers found in message"),await Promise.all(t.providerPeers.map((async t=>{t.id.equals(e)?t.multiaddrs.length<1?A1("no valid addresses for provider %p. Ignore",e):(A1("received provider %p for %s (addrs %s)",e,n,t.multiaddrs.map((e=>e.toString()))),await this.providers.addProvider(n,t.id)):A1("invalid provider peer %p from %p",t.id,e)})))}}const C1=Fe("libp2p:kad-dht:rpc:handlers:find-node");class I1{constructor(e,t){const{peerRouting:n,lan:r}=t;this.components=e,this.peerRouting=n,this.lan=Boolean(r)}async handle(e,t){C1("incoming request from %p for peers closer to %b",e,t.key);let n=[];n=Ja(this.components.peerId.toBytes(),t.key)?[{id:this.components.peerId,multiaddrs:this.components.addressManager.getAddresses().map((e=>e.decapsulateCode(ga("p2p").code))),protocols:[]}]:await this.peerRouting.getCloserPeersOffline(t.key,e),n=n.map(this.lan?vZ:bZ).filter((({multiaddrs:e})=>e.length));const r=new qZ(t.type,new Uint8Array(0),t.clusterLevel);return n.length>0?r.closerPeers=n:C1("could not find any peers closer to %b than %p",t.key,e),r}}const R1=Fe("libp2p:kad-dht:rpc:handlers:get-providers");class O1{constructor(e,t){const{peerRouting:n,providers:r,lan:s}=t;this.components=e,this.peerRouting=n,this.providers=r,this.lan=Boolean(s)}async handle(e,t){let n;try{n=Lt.decode(t.key)}catch(uS){throw je(new Error("Invalid CID"),"ERR_INVALID_CID")}R1("%p asking for providers for %s",e,n);const[r,s]=await Promise.all([this.providers.getProviders(n),this.peerRouting.getCloserPeersOffline(t.key,e)]),i=await this._getPeers(r),o=await this._getPeers(s.map((({id:e})=>e))),a=new qZ(t.type,t.key,t.clusterLevel);return i.length>0&&(a.providerPeers=i),o.length>0&&(a.closerPeers=o),R1("got %s providers %s closerPeers",i.length,o.length),a}async _getAddresses(e){const t=await this.components.peerStore.addressBook.get(e);return t.map((e=>e.multiaddr))}async _getPeers(e){const t=[],n=this.lan?vZ:bZ;for(const r of e){const e=n({id:r,multiaddrs:await this._getAddresses(r),protocols:[]});e.multiaddrs.length>0&&t.push(e)}return t}}const x1=Fe("libp2p:kad-dht:rpc:handlers:get-value");class N1{constructor(e,t){const{peerRouting:n}=t;this.components=e,this.peerRouting=n}async handle(e,t){const n=t.key;if(x1("%p asked for key %b",e,n),null==n||0===n.length)throw je(new Error("Invalid key"),"ERR_INVALID_KEY");const r=new qZ($Z.GET_VALUE,n,t.clusterLevel);if(AZ(n)){x1("is public key");const e=TZ(n);let t;try{const n=await this.components.peerStore.keyBook.get(e);if(null==n)throw je(new Error("No public key found in key book"),"ERR_NOT_FOUND");t=n}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}if(null!=t)return x1("returning found public key"),r.record=new Nm(n,t,new Date),r}const[s,i]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getCloserPeersOffline(t.key,e)]);return null!=s&&(x1("had record for %b in local datastore",n),r.record=s),i.length>0&&(x1("had %s closer peers in routing table",i.length),r.closerPeers=i),r}async _checkLocalDatastore(e){x1("checkLocalDatastore looking for %b",e);const t=SZ(e);let n;try{n=await this.components.datastore.get(t)}catch(uS){if("ERR_NOT_FOUND"===uS.code)return;throw uS}const r=Nm.deserialize(n);if(null==r)throw je(new Error("Invalid record"),"ERR_INVALID_RECORD");if(!(null==r.timeReceived||Date.now()-r.timeReceived.getTime()>nZ))return r;await this.components.datastore.delete(t)}}const D1=Fe("libp2p:kad-dht:rpc:handlers:ping");class P1{async handle(e,t){return D1("ping from %p",e),t}}class L1{constructor(e,t){const{validators:n}=t;this.components=e,this.log=Fe("libp2p:kad-dht:rpc:handlers:put-value"),this.validators=n}async handle(e,t){const n=t.key;this.log("%p asked us to store value for key %b",e,n);const r=t.record;if(null==r){const t=`Empty record from: ${e.toString()}`;throw this.log.error(t),je(new Error(t),"ERR_EMPTY_RECORD")}try{await r1(this.validators,r),r.timeReceived=new Date;const e=SZ(r.key);await this.components.datastore.put(e,r.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,e)}catch(uS){this.log("did not put record for key %b into datastore %o",n,uS)}return t}}class M1{constructor(e,t){const{providers:n,peerRouting:r,validators:s,lan:i}=t;this.log=Fe("libp2p:kad-dht:rpc"),this.routingTable=t.routingTable,this.handlers={[$Z.GET_VALUE]:new N1(e,{peerRouting:r}),[$Z.PUT_VALUE]:new L1(e,{validators:s}),[$Z.FIND_NODE]:new I1(e,{peerRouting:r,lan:i}),[$Z.ADD_PROVIDER]:new T1({providers:n}),[$Z.GET_PROVIDERS]:new O1(e,{peerRouting:r,providers:n,lan:i}),[$Z.PING]:new P1}}async handleMessage(e,t){try{await this.routingTable.add(e)}catch(uS){this.log.error("Failed to update the kbucket store",uS)}const n=this.handlers[t.type];if(null!=n)return await n.handle(e,t);this.log.error(`no handler found for message type: ${t.type}`)}onIncomingStream(e){Promise.resolve().then((async()=>{const{stream:t,connection:n}=e,r=n.remotePeer;try{await this.routingTable.add(r)}catch(uS){this.log.error(uS)}const s=this;await vm(t,cj(),(async function*(e){for await(const t of e){const e=qZ.deserialize(t);s.log("incoming %s from %p",e.type,r);const n=await s.handleMessage(r,e);null!=n&&(yield n.serialize())}}),rj(),t)})).catch((e=>{this.log.error(e)}))}}class B1 extends gL{constructor(e,t){super();const{protocol:n,lan:r}=t;this.components=e,this.log=Fe("libp2p:kad-dht:topology-listener:"+(r?"lan":"wan")),this.running=!1,this.protocol=n}isStarted(){return this.running}async start(){if(this.running)return;this.running=!0;const e=dL({onConnect:e=>{this.log("observed peer %p with protocol %s",e,this.protocol),this.dispatchEvent(new yL("peer",{detail:e}))}});this.registrarId=await this.components.registrar.register(this.protocol,e)}stop(){this.running=!1,null!=this.registrarId&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class U1{constructor(e,t){const{peerRouting:n,lan:r,count:s,interval:i,queryTimeout:o}=t;this.components=e,this.log=Fe(`libp2p:kad-dht:${r?"lan":"wan"}:query-self`),this.running=!1,this.peerRouting=n,this.count=s??hZ,this.interval=i??pZ,this.queryTimeout=o??fZ}isStarted(){return this.running}async start(){this.running||(this.running=!0,this._querySelf())}async stop(){this.running=!1,null!=this.timeoutId&&clearTimeout(this.timeoutId),null!=this.controller&&this.controller.abort()}_querySelf(){Promise.resolve().then((async()=>{const e=new Ho.TimeoutController(this.queryTimeout);try{this.controller=new AbortController;const t=(0,al.anySignal)([this.controller.signal,e.signal]);try{null!=XG.setMaxListeners&&(0,XG.setMaxListeners)(1/0,t)}catch{}const n=await vm(this.peerRouting.getClosestPeers(this.components.peerId.toBytes(),{signal:t}),(e=>tm(e,this.count)),(async e=>await Px(e)));this.log("query ran successfully - found %d peers",n)}catch(uS){this.log("query error",uS)}finally{this.timeoutId=setTimeout(this._querySelf.bind(this),this.interval),e.clear()}})).catch((e=>{this.log("query error",e)}))}}const V1=32,F1=64;class j1 extends gL{constructor(e,t){super();const{kBucketSize:n,clientMode:r,validators:s,selectors:i,querySelfInterval:o,lan:a,protocolPrefix:c,pingTimeout:l,pingConcurrency:u,maxInboundStreams:h,maxOutboundStreams:d}=t;this.running=!1,this.components=e,this.lan=Boolean(a),this.log=Fe("libp2p:kad-dht:"+(!0===a?"lan":"wan")),this.protocol=`${c??sZ}${!0===a?rZ:""}${iZ}`,this.kBucketSize=n??20,this.clientMode=r??!0,this.maxInboundStreams=h??V1,this.maxOutboundStreams=d??F1,this.routingTable=new BZ(e,{kBucketSize:n,lan:this.lan,pingTimeout:l,pingConcurrency:u,protocol:this.protocol}),this.providers=new f1(e),this.validators={...i1,...s},this.selectors={...c1,...i},this.network=new n1(e,{protocol:this.protocol,lan:this.lan}),this.queryManager=new k1(e,{disjointPaths:Math.ceil(this.kBucketSize/2),lan:a}),this.peerRouting=new d1(e,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,lan:this.lan}),this.contentFetching=new l1(e,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,network:this.network,lan:this.lan}),this.contentRouting=new u1(e,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,lan:this.lan}),this.routingTableRefresh=new FZ({peerRouting:this.peerRouting,routingTable:this.routingTable,lan:this.lan}),this.rpc=new M1(e,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,lan:this.lan}),this.topologyListener=new B1(e,{protocol:this.protocol,lan:this.lan}),this.querySelf=new U1(e,{peerRouting:this.peerRouting,interval:o,lan:this.lan}),this.network.addEventListener("peer",(e=>{const t=e.detail;this.onPeerConnect(t).catch((e=>{this.log.error("could not add %p to routing table",t.id,e)})),this.dispatchEvent(new yL("peer",{detail:t}))})),this.topologyListener.addEventListener("peer",(e=>{const t=e.detail;Promise.resolve().then((async()=>{const e=await this.components.peerStore.addressBook.get(t),n={id:t,multiaddrs:e.map((e=>e.multiaddr)),protocols:[]};await this.onPeerConnect(n)})).catch((e=>{this.log.error("could not add %p to routing table",t,e)}))}))}get[UG](){return!0}get[Symbol.toStringTag](){return"@libp2p/kad-dht"}async onPeerConnect(e){if(this.log("peer %p connected with protocols %s",e.id,e.protocols),e=this.lan?vZ(e):bZ(e),0!==e.multiaddrs.length)try{await this.routingTable.add(e.id)}catch(uS){this.log.error("could not add %p to routing table",e.id,uS)}else this.log("ignoring %p as they do not have any %s addresses in %s",e.id,this.lan?"private":"public",e.multiaddrs.map((e=>e.toString())))}isStarted(){return this.running}async getMode(){return this.clientMode?"client":"server"}async setMode(e){await this.components.registrar.unhandle(this.protocol),"client"===e?(this.log("enabling client mode"),this.clientMode=!0):(this.log("enabling server mode"),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running=!0,await this.setMode(this.clientMode?"client":"server"),await Promise.all([this.providers.start(),this.queryManager.start(),this.network.start(),this.routingTable.start(),this.topologyListener.start(),this.querySelf.start()]),await this.routingTableRefresh.start()}async stop(){this.running=!1,await Promise.all([this.providers.stop(),this.queryManager.stop(),this.network.stop(),this.routingTable.stop(),this.routingTableRefresh.stop(),this.topologyListener.stop(),this.querySelf.stop()])}async*put(e,t,n={}){yield*this.contentFetching.put(e,t,n)}async*get(e,t={}){yield*this.contentFetching.get(e,t)}async*provide(e,t={}){yield*this.contentRouting.provide(e,this.components.addressManager.getAddresses(),t)}async*findProviders(e,t={}){yield*this.contentRouting.findProviders(e,t)}async*findPeer(e,t={}){yield*this.peerRouting.findPeer(e,t)}async*getClosestPeers(e,t={}){yield*this.peerRouting.getClosestPeers(e,t)}async refreshRoutingTable(){await this.routingTableRefresh.refreshTable(!0)}}const z1=Fe("libp2p:kad-dht");class $1 extends gL{constructor(e,t,n){super(),this.components=e,this.wan=t,this.lan=n,this.wan.addEventListener("peer",(e=>{this.dispatchEvent(new yL("peer",{detail:e.detail}))})),this.lan.addEventListener("peer",(e=>{this.dispatchEvent(new yL("peer",{detail:e.detail}))}))}get[UG](){return!0}get[Symbol.toStringTag](){return"@libp2p/dual-kad-dht"}isStarted(){return this.wan.isStarted()&&this.lan.isStarted()}async getMode(){return await this.wan.getMode()}async setMode(e){await this.wan.setMode(e)}async start(){await Promise.all([this.lan.start(),this.wan.start()])}async stop(){await Promise.all([this.lan.stop(),this.wan.stop()])}async*put(e,t,n={}){for await(const r of gm(this.lan.put(e,t,n),this.wan.put(e,t,n)))yield r}async*get(e,t={}){let n=!1,r=!1;for await(const s of gm(this.lan.get(e,t),this.wan.get(e,t)))yield s,"DIALING_PEER"===s.name&&(n=!0),"VALUE"===s.name&&(n=!0,null!=s.value&&(r=!0)),"SENDING_QUERY"===s.name&&(n=!0);if(!n)throw je(new Error("No peers found in routing table!"),"ERR_NO_PEERS_IN_ROUTING_TABLE");r||(yield XZ({from:this.components.peerId,error:je(new Error("Not found"),"ERR_NOT_FOUND")}))}async*provide(e,t={}){let n=0,r=0;const s=[],i=[this.lan];"server"===await this.wan.getMode()&&i.push(this.wan);for await(const o of gm(...i.map((n=>n.provide(e,t)))))yield o,"SENDING_QUERY"===o.name&&n++,"QUERY_ERROR"===o.name&&s.push(o.error),"PEER_RESPONSE"===o.name&&"ADD_PROVIDER"===o.messageName&&(z1("sent provider record for %s to %p",e,o.from),r++);if(0===r){if(s.length>0)throw je(new Error(`Failed to provide to ${s.length} of ${n} peers`),"ERR_PROVIDES_FAILED",{errors:s});throw je(new Error("Failed to provide - no peers found"),"ERR_PROVIDES_FAILED")}}async*findProviders(e,t={}){yield*gm(this.lan.findProviders(e,t),this.wan.findProviders(e,t))}async*findPeer(e,t={}){let n=!1;for await(const r of gm(this.lan.findPeer(e,t),this.wan.findPeer(e,t)))yield r,"SENDING_QUERY"!==r.name&&"FINAL_PEER"!==r.name||(n=!0);if(!n)throw je(new Error("Peer lookup failed"),"ERR_LOOKUP_FAILED")}async*getClosestPeers(e,t={}){yield*gm(this.lan.getClosestPeers(e,t),this.wan.getClosestPeers(e,t))}async refreshRoutingTable(){await Promise.all([this.lan.refreshRoutingTable(),this.wan.refreshRoutingTable()])}}class H1 extends $1{constructor(e,t){super(e,new j1(e,{protocolPrefix:"/ipfs",...t,lan:!1}),new j1(e,{protocolPrefix:"/ipfs",...t,clientMode:!1,lan:!0}))}}function K1(e){return t=>new H1(t,e)}const q1=Fe("libp2p:bootstrap"),G1="bootstrap",W1=50,Y1=12e4,J1=1e3;class Q1 extends gL{constructor(e,t={list:[]}){if(null==t.list||0===t.list.length)throw new Error("Bootstrap requires a list of peer addresses");super(),this.components=e,this.timeout=t.timeout??J1,this.list=[];for(const n of t.list){if(!Dc.matches(n)){q1.error("Invalid multiaddr");continue}const e=dc(n),t=e.getPeerId();if(null==t){q1.error("Invalid bootstrap multiaddr without peer id");continue}const r={id:Fu(t),multiaddrs:[e],protocols:[]};this.list.push(r)}this._init=t}get[UG](){return!0}get[Symbol.toStringTag](){return"@libp2p/bootstrap"}isStarted(){return Boolean(this.timer)}start(){this.isStarted()||(q1("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout((()=>{this._discoverBootstrapPeers().catch((e=>{q1.error(e)}))}),this.timeout))}async _discoverBootstrapPeers(){if(null!=this.timer)for(const e of this.list){if(await this.components.peerStore.tagPeer(e.id,this._init.tagName??G1,{value:this._init.tagValue??W1,ttl:this._init.tagTTL??Y1}),null==this.timer)return;this.dispatchEvent(new yL("peer",{detail:e}))}}stop(){null!=this.timer&&clearTimeout(this.timer),this.timer=void 0}}function X1(e){return t=>new Q1(t,e)}Q1.tag="bootstrap";var Z1=WebSocket,e0=n(409);function t0(e){return e instanceof ArrayBuffer||"ArrayBuffer"===e?.constructor?.name&&"number"===typeof e?.byteLength}var n0=e=>{e.binaryType="arraybuffer";const t=async()=>await new Promise(((t,n)=>{if(s)return t();if(null!=r)return n(r);const i=t=>{e.removeEventListener("open",o),e.removeEventListener("error",a),t()},o=()=>i(t),a=t=>{i((()=>n(t.error??new Error(`connect ECONNREFUSED ${e.url}`))))};e.addEventListener("open",o),e.addEventListener("error",a)})),n=async function*(){const n=new e0.zN((({push:t,stop:n,fail:r})=>{const s=e=>{let n=null;"string"===typeof e.data&&(n=$o(e.data)),t0(e.data)&&(n=new Uint8Array(e.data)),e.data instanceof Uint8Array&&(n=e.data),null!=n&&t(n)},i=e=>r(e.error??new Error("Socket error"));return e.addEventListener("message",s),e.addEventListener("error",i),e.addEventListener("close",n),()=>{e.removeEventListener("message",s),e.removeEventListener("error",i),e.removeEventListener("close",n)}}),{highWaterMark:1/0});await t();for await(const e of n)yield t0(e)?new Uint8Array(e):e}();let r,s=1===e.readyState;return e.addEventListener("open",(()=>{s=!0,r=null})),e.addEventListener("close",(()=>{s=!1,r=null})),e.addEventListener("error",(t=>{s||(r=t.error??new Error(`connect ECONNREFUSED ${e.url}`))})),Object.assign(n,{connected:t})},r0=e=>{if(e.readyState>=2)throw new Error("socket closed");if(1!==e.readyState)return new Promise(((t,n)=>{function r(){e.removeEventListener("open",s),e.removeEventListener("error",i)}function s(){r(),t()}function i(t){r(),n(t.error??new Error(`connect ECONNREFUSED ${e.url}`))}e.addEventListener("open",s),e.addEventListener("error",i)}))},s0=(e,t)=>{t=t??{},t.closeOnEnd=!1!==t.closeOnEnd;const n=async n=>{for await(const t of n){try{await r0(e)}catch(uS){if("socket closed"===uS.message)break;throw uS}e.send(t)}if(null!=t.closeOnEnd&&e.readyState<=1)return await new Promise(((t,n)=>{e.addEventListener("close",(e=>{if(e.wasClean||1006===e.code)t();else{const t=Object.assign(new Error("ws error"),{event:e});n(t)}})),setTimeout((()=>e.close()))}))};return n},i0=(e,t)=>{t=t??{};const n=n0(e);let r=t.remoteAddress,s=t.remotePort;if(null!=e.url)try{const t=new URL(e.url);r=t.hostname,s=parseInt(t.port,10)}catch{}if(null==r||null==s)throw new Error("Remote connection did not have address and/or port");const i={sink:s0(e,t),source:n,connected:async()=>await n.connected(),close:async()=>{e.readyState!==e.CONNECTING&&e.readyState!==e.OPEN||await new Promise((t=>{e.addEventListener("close",(()=>{t()})),e.close()}))},destroy:()=>{null!=e.terminate?e.terminate():e.close()},remoteAddress:r,remotePort:s,socket:e};return i};const o0={http:"ws",https:"wss"},a0="ws";var c0=(e,t)=>(0,Vc.relative)(e,t,o0,a0);function l0(e,t){const n="undefined"===typeof window?"":window.location;t=t??{};const r=c0(e,n.toString()),s=new Z1(r,t.websocket);return i0(s,t)}function u0(){throw new Error("WebSocket Servers can not be created in the browser!")}const h0=421,d0=290,p0=6,f0=478,g0=2e3,m0=Fe("libp2p:websockets:socket");function y0(e,t,n){n=n??{};const r={async sink(t){null!=n?.signal&&(t=XF(t,n.signal));try{await e.sink(t)}catch(uS){"aborted"!==uS.type&&m0.error(uS)}},source:null!=n.signal?XF(e.source,n.signal):e.source,remoteAddr:t,timeline:{open:Date.now()},async close(){const t=Date.now();try{await PI(e.close(),{milliseconds:g0})}catch(uS){const{host:s,port:i}=r.remoteAddr.toOptions();m0("timeout closing stream to %s:%s after %dms, destroying it manually",s,i,Date.now()-t),e.destroy()}finally{r.timeline.close=Date.now()}}};return e.socket.addEventListener("close",(()=>{null==r.timeline.close&&(r.timeline.close=Date.now())}),{once:!0}),r}function w0(e){return e.filter((e=>{if(e.protoCodes().includes(d0))return!1;const t=e.decapsulateCode(h0);return _c.matches(t)||Sc.matches(t)}))}function b0(e){return e.filter((e=>{if(e.protoCodes().includes(d0))return!1;const t=e.decapsulateCode(h0);return Sc.matches(t)&&mc.matches(t.decapsulateCode(p0).decapsulateCode(f0))}))}const v0=Fe("libp2p:websockets");class E0{constructor(e){this.init=e}get[Symbol.toStringTag](){return"@libp2p/websockets"}get[MG](){return!0}async dial(e,t){v0("dialing %s",e),t=t??{};const n=await this._connect(e,t),r=y0(n,e);v0("new outbound connection %s",r.remoteAddr);const s=await t.upgrader.upgradeOutbound(r);return v0("outbound connection %s upgraded",r.remoteAddr),s}async _connect(e,t){if(!0===t?.signal?.aborted)throw new VX;const n=e.toOptions();v0("dialing %s:%s",n.host,n.port);const r=Ay(),s=e=>{v0.error("connection error:",e),r.reject(e)},i=l0(vI(e),this.init);if(null!=i.socket.on?i.socket.on("error",s):i.socket.onerror=s,null==t.signal)return await Promise.race([i.connected(),r.promise]),v0("connected %s",e),i;let o;const a=new Promise(((e,n)=>{if(o=()=>{n(new VX),i.close().catch((e=>{v0.error("error closing raw socket",e)}))},!0===t?.signal?.aborted)return o();t?.signal?.addEventListener("abort",o)}));try{await Promise.race([a,r.promise,i.connected()])}finally{null!=o&&t?.signal?.removeEventListener("abort",o)}return v0("connected %s",e),i}createListener(e){return u0({...this.init,...e})}filter(e){return e=Array.isArray(e)?e:[e],null!=this.init?.filter?this.init?.filter(e):OQ||PQ?b0(e):w0(e)}}function _0(e={}){return()=>new E0(e)}function S0(e){return new Uint8Array(e)}var k0;(function(e){e[e["NEW_STREAM"]=0]="NEW_STREAM",e[e["MESSAGE_RECEIVER"]=1]="MESSAGE_RECEIVER",e[e["MESSAGE_INITIATOR"]=2]="MESSAGE_INITIATOR",e[e["CLOSE_RECEIVER"]=3]="CLOSE_RECEIVER",e[e["CLOSE_INITIATOR"]=4]="CLOSE_INITIATOR",e[e["RESET_RECEIVER"]=5]="RESET_RECEIVER",e[e["RESET_INITIATOR"]=6]="RESET_INITIATOR"})(k0||(k0={}));const A0=Object.freeze({0:"NEW_STREAM",1:"MESSAGE_RECEIVER",2:"MESSAGE_INITIATOR",3:"CLOSE_RECEIVER",4:"CLOSE_INITIATOR",5:"RESET_RECEIVER",6:"RESET_INITIATOR"}),T0=Object.freeze({NEW_STREAM:k0.NEW_STREAM,MESSAGE:k0.MESSAGE_INITIATOR,CLOSE:k0.CLOSE_INITIATOR,RESET:k0.RESET_INITIATOR}),C0=Object.freeze({MESSAGE:k0.MESSAGE_RECEIVER,CLOSE:k0.CLOSE_RECEIVER,RESET:k0.RESET_RECEIVER}),I0=1048576,R0=(e,t)=>t.append(e);async function*O0(e,t={}){let n=new Aw,r=!1,s=Ay(),i=Number(t.size??I0);(isNaN(i)||0===i||i<0)&&(i=I0);const o=t.yieldAfter??0,a=t.serialize??R0;Promise.resolve().then((async()=>{try{let t;for await(const r of e)a(r,n),n.byteLength>=i?(clearTimeout(t),s.resolve()):t=setTimeout((()=>{s.resolve()}),o);clearTimeout(t),s.resolve()}catch(uS){s.reject(uS)}finally{r=!0}}));while(!r)if(await s.promise,s=Ay(),n.byteLength>0){const e=n;n=new Aw,yield e.subarray()}}var x0=O0;const N0=10240;class D0{constructor(){this._pool=S0(N0),this._poolOffset=0}write(e,t){const n=this._pool;let r=this._poolOffset;ma.encode(e.id<<3|e.type,n,r),r+=ma.encode.bytes??0,e.type!==k0.NEW_STREAM&&e.type!==k0.MESSAGE_INITIATOR&&e.type!==k0.MESSAGE_RECEIVER||null==e.data?ma.encode(0,n,r):ma.encode(e.data.length,n,r),r+=ma.encode.bytes??0;const s=n.subarray(this._poolOffset,r);N0-r<100?(this._pool=S0(N0),this._poolOffset=0):this._poolOffset=r,t.append(s),e.type!==k0.NEW_STREAM&&e.type!==k0.MESSAGE_INITIATOR&&e.type!==k0.MESSAGE_RECEIVER||null==e.data||t.append(e.data)}}const P0=new D0;async function*L0(e,t=0){if(null!=t&&0!==t)yield*x0(e,{size:t,serialize:(e,t)=>{for(const n of e)P0.write(n,t)}});else for await(const n of e){const e=new Aw;for(const t of n)P0.write(t,e);yield e.subarray()}}const M0=1<<20,B0=4<<20;class U0{constructor(e=M0,t=B0){this._buffer=new Aw,this._headerInfo=null,this._maxMessageSize=e,this._maxUnprocessedMessageQueueSize=t}write(e){if(null==e||0===e.length)return[];if(this._buffer.append(e),this._buffer.byteLength>this._maxUnprocessedMessageQueueSize)throw Object.assign(new Error("unprocessed message queue size too large!"),{code:"ERR_MSG_QUEUE_TOO_BIG"});const t=[];while(0!==this._buffer.length){if(null==this._headerInfo)try{this._headerInfo=this._decodeHeader(this._buffer)}catch(uS){if("ERR_MSG_TOO_BIG"===uS.code)throw uS;break}const{id:e,type:n,length:r,offset:s}=this._headerInfo,i=this._buffer.length-s;if(i<r)break;const o={id:e,type:n};n!==k0.NEW_STREAM&&n!==k0.MESSAGE_INITIATOR&&n!==k0.MESSAGE_RECEIVER||(o.data=this._buffer.sublist(s,s+r)),t.push(o),this._buffer.consume(s+r),this._headerInfo=null}return t}_decodeHeader(e){const{value:t,offset:n}=j0(e),{value:r,offset:s}=j0(e,n),i=7&t;if(null==A0[i])throw new Error(`Invalid type received: ${i}`);if(r>this._maxMessageSize)throw Object.assign(new Error("message size too large!"),{code:"ERR_MSG_TOO_BIG"});return{id:t>>3,type:i,offset:n+s,length:r}}}const V0=128,F0=127;function j0(e,t=0){let n,r=0,s=0,i=t;const o=e.length;do{if(i>=o||s>49)throw t=0,new RangeError("Could not decode varint");n=e.get(i++),r+=s<28?(n&F0)<<s:(n&F0)*Math.pow(2,s),s+=7}while(n>=V0);return t=i-t,{value:r,offset:t}}const z0=Fe("libp2p:mplex:stream"),$0="ERR_STREAM_RESET",H0="ERR_STREAM_ABORT",K0="ERR_SINK_ENDED",q0="ERR_DOUBLE_SINK";function G0(e){const{id:t,name:n,send:r,onEnd:s,type:i="initiator",maxMsgSize:o=M0}=e,a=new AbortController,c=new AbortController,l=new AbortController,u="initiator"===i?T0:C0,h="initiator"===i?`i${t}`:`r${t}`,d=`${null==n?t:n}`;let p,f=!1,g=!1,m=!1;const y={open:Date.now()},w=e=>{f||(f=!0,z0.trace("%s stream %s source end - err: %o",i,d,e),null!=e&&null==p&&(p=e),g&&(E.stat.timeline.close=Date.now(),null!=s&&s(p)))},b=e=>{g||(g=!0,z0.trace("%s stream %s sink end - err: %o",i,d,e),null!=e&&null==p&&(p=e),f&&(y.close=Date.now(),null!=s&&s(p)))},v=im({onEnd:w}),E={close:()=>{z0.trace("%s stream %s close",i,d),E.closeRead(),E.closeWrite()},closeRead:()=>{z0.trace("%s stream %s closeRead",i,d),f||v.end()},closeWrite:()=>{if(z0.trace("%s stream %s closeWrite",i,d),!g){l.abort();try{r({id:t,type:u.CLOSE})}catch(uS){z0.trace("%s stream %s error sending close",i,n,uS)}b()}},abort:e=>{z0.trace("%s stream %s abort",i,d,e),v.end(e),a.abort(),b(e)},reset:()=>{const e=je(new Error("stream reset"),$0);c.abort(),v.end(e),b(e)},sink:async e=>{if(m)throw je(new Error("sink already called on stream"),q0);if(m=!0,g)throw je(new Error("stream closed for writing"),K0);e=XF(e,(0,al.anySignal)([a.signal,c.signal,l.signal]));try{"initiator"===i&&r({id:t,type:T0.NEW_STREAM,data:new Aw($o(d))});for await(let n of e)while(n.length>0){if(n.length<=o){r({id:t,type:u.MESSAGE,data:n instanceof Uint8Array?new Aw(n):n});break}n=n instanceof Uint8Array?new Aw(n):n,r({id:t,type:u.MESSAGE,data:n.sublist(0,o)}),n.consume(o)}}catch(uS){if("aborted"===uS.type&&"The operation was aborted"===uS.message){if(l.signal.aborted)return;c.signal.aborted&&(uS.message="stream reset",uS.code=$0),a.signal.aborted&&(uS.message="stream aborted",uS.code=H0)}if(uS.code===$0)z0.trace("%s stream %s reset",i,n);else{z0.trace("%s stream %s error",i,n,uS);try{r({id:t,type:u.RESET})}catch(uS){z0.trace("%s stream %s error sending reset",i,n,uS)}}return v.end(uS),void b(uS)}try{r({id:t,type:u.CLOSE})}catch(uS){z0.trace("%s stream %s error sending close",i,n,uS)}b()},source:v,sourcePush:e=>{v.push(e)},sourceReadableLength(){return v.readableLength},stat:{direction:"initiator"===i?"outbound":"inbound",timeline:y},metadata:{},id:h};return E}const W0=Fe("libp2p:mplex"),Y0=1024,J0=1024,Q0=4194304,X0=5;function Z0(e){const t={...e,type:`${A0[e.type]} (${e.type})`};return e.type===k0.NEW_STREAM&&(t.data=ia(e.data instanceof Uint8Array?e.data:e.data.subarray())),e.type!==k0.MESSAGE_INITIATOR&&e.type!==k0.MESSAGE_RECEIVER||(t.data=ia(e.data instanceof Uint8Array?e.data:e.data.subarray(),"base16")),t}class e2{constructor(e){this.protocol="/mplex/6.7.0",e=e??{},this._streamId=0,this._streams={initiators:new Map,receivers:new Map},this._init=e,this.sink=this._createSink();const t=this._createSource();this._source=t,this.source=t,this.closeController=new AbortController,this.rateLimiter=new vW.RateLimiterMemory({points:e.disconnectThreshold??X0,duration:1})}get streams(){const e=[];for(const t of this._streams.initiators.values())e.push(t);for(const t of this._streams.receivers.values())e.push(t);return e}newStream(e){if(this.closeController.signal.aborted)throw new Error("Muxer already closed");const t=this._streamId++;e=null==e?t.toString():e.toString();const n=this._streams.initiators;return this._newStream({id:t,name:e,type:"initiator",registry:n})}close(e){this.closeController.signal.aborted||(null!=e?this.streams.forEach((t=>t.abort(e))):this.streams.forEach((e=>e.close())),this.closeController.abort())}_newReceiverStream(e){const{id:t,name:n}=e,r=this._streams.receivers;return this._newStream({id:t,name:n,type:"receiver",registry:r})}_newStream(e){const{id:t,name:n,type:r,registry:s}=e;if(W0("new %s stream %s",r,t),"initiator"===r&&this._streams.initiators.size===(this._init.maxOutboundStreams??J0))throw je(new Error("Too many outbound streams open"),"ERR_TOO_MANY_OUTBOUND_STREAMS");if(s.has(t))throw new Error(`${r} stream ${t} already exists!`);const i=e=>{W0.enabled&&W0.trace("%s stream %s send",r,t,Z0(e)),this._source.push(e)},o=()=>{W0("%s stream with id %s and protocol %s ended",r,t,a.stat.protocol),s.delete(t),null!=this._init.onStreamEnd&&this._init.onStreamEnd(a)},a=G0({id:t,name:n,send:i,type:r,onEnd:o,maxMsgSize:this._init.maxMsgSize});return s.set(t,a),a}_createSink(){const e=async e=>{const t=[this.closeController.signal];null!=this._init.signal&&t.push(this._init.signal),e=XF(e,al(t));try{const t=new U0(this._init.maxMsgSize,this._init.maxUnprocessedMessageQueueSize);for await(const n of e)for(const e of t.write(n))await this._handleIncoming(e);this._source.end()}catch(uS){W0("error in sink",uS),this._source.end(uS)}};return e}_createSource(){const e=e=>{this.close(e)},t=om({objectMode:!0,onEnd:e});return Object.assign(L0(t,this._init.minSendBytes),{push:t.push,end:t.end,return:t.return})}async _handleIncoming(e){const{id:t,type:n}=e;if(W0.enabled&&W0.trace("incoming message",Z0(e)),e.type===k0.NEW_STREAM){if(this._streams.receivers.size===(this._init.maxInboundStreams??Y0)){W0("too many inbound streams open"),this._source.push({id:t,type:k0.RESET_RECEIVER});try{await this.rateLimiter.consume("new-stream",1)}catch{return W0("rate limit hit when opening too many new streams over the inbound stream limit - closing remote connection"),void this._source.end(new Error("Too many open streams"))}return}const n=this._newReceiverStream({id:t,name:ia(e.data instanceof Uint8Array?e.data:e.data.subarray())});return void(null!=this._init.onIncomingStream&&this._init.onIncomingStream(n))}const r=1===(1&n)?this._streams.initiators:this._streams.receivers,s=r.get(t);if(null==s)return void W0("missing stream %s for message type %s",t,A0[n]);const i=this._init.maxStreamBufferSize??Q0;switch(n){case k0.MESSAGE_INITIATOR:case k0.MESSAGE_RECEIVER:if(s.sourceReadableLength()>i){this._source.push({id:e.id,type:n===k0.MESSAGE_INITIATOR?k0.RESET_RECEIVER:k0.RESET_INITIATOR});const t=je(new Error("Input buffer full - increase Mplex maxBufferSize to accommodate slow consumers"),"ERR_STREAM_INPUT_BUFFER_FULL");return void s.abort(t)}s.sourcePush(e.data);break;case k0.CLOSE_INITIATOR:case k0.CLOSE_RECEIVER:s.closeRead();break;case k0.RESET_INITIATOR:case k0.RESET_RECEIVER:s.reset();break;default:W0("unknown message type %s",n)}}}class t2{constructor(e={}){this.protocol="/mplex/6.7.0",this._init=e}createStreamMuxer(e={}){return new e2({...e,...this._init})}}function n2(e={}){return()=>new t2(e)}function r2(e,t={}){const n=BW(e),r=cj.fromReader(n.reader,t),s={read:async e=>{const{value:t}=await n.reader.next(e);if(null==t)throw new Error("Value is null");return t},readLP:async()=>{const{value:e}=await r.next();if(null==e)throw new Error("Value is null");return e},readPB:async e=>{const t=await s.readLP();if(null==t)throw new Error("Value is null");const n=t instanceof Uint8Array?t:t.subarray();return e.decode(n)},write:e=>{e instanceof Uint8Array?n.writer.push(e):n.writer.push(e.subarray())},writeLP:e=>{s.write(rj.single(e,t))},writePB:(e,t)=>{s.writeLP(t.encode(e))},pb:e=>({read:async()=>await s.readPB(e),write:t=>s.writePB(t,e)}),unwrap:()=>(n.rest(),n.stream)};return s}function s2(){const e=Ay();let t=!1;return{sink:async n=>{if(t)throw new Error("already piped");t=!0,e.resolve(n)},source:async function*(){const t=await e.promise;yield*t}()}}function i2(){const e=s2(),t=s2();return[{source:e.source,sink:t.sink},{source:t.source,sink:e.sink}]}const o2=65535,a2=o2-16,c2=Boolean(globalThis.process?.env?.DUMP_SESSION_KEYS);var l2=n(3017),u2=n(2578),h2=n(9300),d2=n(5602);const p2={hashSHA256(e){return(0,h2.vp)(e)},getHKDF(e,t){const n=new l2.t(h2.mE,t,e),r=n.expand(96),s=r,i=s.subarray(0,32),o=s.subarray(32,64),a=s.subarray(64,96);return[i,o,a]},generateX25519KeyPair(){const e=u2.Au();return{publicKey:e.publicKey,privateKey:e.secretKey}},generateX25519KeyPairFromSeed(e){const t=u2._w(e);return{publicKey:t.publicKey,privateKey:t.secretKey}},generateX25519SharedKey(e,t){return u2.gi(e,t)},chaCha20Poly1305Encrypt(e,t,n,r){const s=new d2.OK(r);return s.seal(t,e,n)},chaCha20Poly1305Decrypt(e,t,n,r,s){const i=new d2.OK(r);return i.open(t,e,n,s)}},f2=e=>globalThis.Buffer?globalThis.Buffer.allocUnsafe(e):new Uint8Array(e),g2=e=>{const t=f2(2);return new DataView(t.buffer,t.byteOffset,t.byteLength).setUint16(0,e,!1),t};g2.bytes=2;const m2=e=>{if(e.length<2)throw RangeError("Could not decode int16BE");return e instanceof Uint8Array?new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1):e.getUint16(0)};function y2(e){return ya([e.ne,e.ciphertext],e.ne.length+e.ciphertext.length)}function w2(e){return ya([e.ne,e.ns,e.ciphertext],e.ne.length+e.ns.length+e.ciphertext.length)}function b2(e){return ya([e.ns,e.ciphertext],e.ns.length+e.ciphertext.length)}function v2(e){if(e.length<32)throw new Error("Cannot decode stage 0 MessageBuffer: length less than 32 bytes.");return{ne:e.subarray(0,32),ciphertext:e.subarray(32,e.length),ns:new Uint8Array(0)}}function E2(e){if(e.length<80)throw new Error("Cannot decode stage 1 MessageBuffer: length less than 80 bytes.");return{ne:e.subarray(0,32),ns:e.subarray(32,80),ciphertext:e.subarray(80,e.length)}}function _2(e){if(e.length<48)throw new Error("Cannot decode stage 2 MessageBuffer: length less than 48 bytes.");return{ne:new Uint8Array(0),ns:e.subarray(0,48),ciphertext:e.subarray(48,e.length)}}function S2(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=a2){let s=n+a2;s>r.length&&(s=r.length);const i=e.encrypt(r.subarray(n,s),e.session);t?.encryptedPackets.increment(),yield g2(i.byteLength),yield i}}}function k2(e,t){return async function*(n){for await(const r of n)for(let n=0;n<r.length;n+=o2){let s=n+o2;if(s>r.length&&(s=r.length),s-d2.pg<n)throw new Error("Invalid chunk");const i=r.subarray(n,s),o=r.subarray(n,s-d2.pg),{plaintext:a,valid:c}=e.decrypt(i,e.session,o);if(!c)throw t?.decryptErrors.increment(),new Error("Failed to validate decrypted chunk");t?.decryptedPackets.increment(),yield a}}}m2.bytes=2;class A2 extends Error{constructor(e="Unexpected Peer"){super(e),this.code=A2.code}static get code(){return"ERR_UNEXPECTED_PEER"}}class T2 extends Error{constructor(e="Invalid crypto exchange"){super(e),this.code=T2.code}static get code(){return"ERR_INVALID_CRYPTO_EXCHANGE"}}class C2 extends Error{constructor(e="Invalid crypto transmission"){super(e),this.code=C2.code}static get code(){return"ERR_INVALID_CRYPTO_TRANSMISSION"}}var I2,R2;async function O2(e,t,n){const r=await N2(e,L2(t));if(null==e.publicKey)throw new Error("PublicKey was missing from local PeerId");return x2(e.publicKey,r,n)}function x2(e,t,n){return R2.encode({identityKey:e,identitySig:t,extensions:n??{webtransportCerthashes:[]}}).subarray()}async function N2(e,t){if(null==e.privateKey)throw new Error("PrivateKey was missing from PeerId");const n=await Yf(e.privateKey);return await n.sign(t)}async function D2(e){return await $u(e.identityKey)}function P2(e){return R2.decode(e)}function L2(e){const t=$o("noise-libp2p-static-key:");return ya([t,e],t.length+e.length)}async function M2(e,t,n){const r=await $u(t.identityKey);if(!r.equals(n))throw new Error("Peer ID doesn't match libp2p public key.");const s=L2(e);if(null==r.publicKey)throw new Error("PublicKey was missing from PeerId");if(null==t.identitySig)throw new Error("Signature was missing from message");const i=Gf(r.publicKey),o=await i.verify(s,t.identitySig);if(!o)throw new Error("Static key doesn't match to peer that signed payload!");return r}function B2(e){return e instanceof Uint8Array&&32===e.length}(function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{if(!1!==n.lengthDelimited&&t.fork(),null!=e.webtransportCerthashes)for(const r of e.webtransportCerthashes)t.uint32(10),t.bytes(r);!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={webtransportCerthashes:[]},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.webtransportCerthashes.push(e.bytes());break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())})(I2||(I2={})),function(e){let t;e.codec=()=>(null==t&&(t=Ih(((e,t,n={})=>{!1!==n.lengthDelimited&&t.fork(),(!0===n.writeDefaults||null!=e.identityKey&&e.identityKey.byteLength>0)&&(t.uint32(10),t.bytes(e.identityKey)),(!0===n.writeDefaults||null!=e.identitySig&&e.identitySig.byteLength>0)&&(t.uint32(18),t.bytes(e.identitySig)),null!=e.extensions&&(t.uint32(34),I2.codec().encode(e.extensions,t,{writeDefaults:!1})),!1!==n.lengthDelimited&&t.ldelim()}),((e,t)=>{const n={identityKey:new Uint8Array(0),identitySig:new Uint8Array(0)},r=null==t?e.len:e.pos+t;while(e.pos<r){const t=e.uint32();switch(t>>>3){case 1:n.identityKey=e.bytes();break;case 2:n.identitySig=e.bytes();break;case 4:n.extensions=I2.codec().decode(e,e.uint32());break;default:e.skipType(7&t);break}}return n}))),t),e.encode=t=>vh(t,e.codec()),e.decode=t=>bh(t,e.codec())}(R2||(R2={}));const U2=Fe("libp2p:noise");let V2;function F2(e){V2(`LOCAL_STATIC_PUBLIC_KEY ${ia(e.publicKey,"hex")}`),V2(`LOCAL_STATIC_PRIVATE_KEY ${ia(e.privateKey,"hex")}`)}function j2(e){e?(V2(`LOCAL_PUBLIC_EPHEMERAL_KEY ${ia(e.publicKey,"hex")}`),V2(`LOCAL_PRIVATE_EPHEMERAL_KEY ${ia(e.privateKey,"hex")}`)):V2("Missing local ephemeral keys.")}function z2(e){V2(`REMOTE_STATIC_PUBLIC_KEY ${ia(e,"hex")}`)}function $2(e){V2(`REMOTE_EPHEMERAL_PUBLIC_KEY ${ia(e,"hex")}`)}function H2(e){e.cs1&&e.cs2?(V2(`CIPHER_STATE_1 ${e.cs1.n.getUint64()} ${ia(e.cs1.k,"hex")}`),V2(`CIPHER_STATE_2 ${e.cs2.n.getUint64()} ${ia(e.cs2.k,"hex")}`)):V2("Missing cipher state.")}V2=c2?U2:Object.assign((()=>{}),{enabled:!1,trace:()=>{},error:()=>{}});const K2=0,q2=4294967295,G2="Cipherstate has reached maximum n, a new handshake must be performed";class W2{constructor(e=K2){this.n=e,this.bytes=new Uint8Array(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>q2)throw new Error(G2)}}class Y2{constructor(e){this.crypto=e}encryptWithAd(e,t,n){const r=this.encrypt(e.k,e.n,t,n);return e.n.increment(),r}decryptWithAd(e,t,n,r){const{plaintext:s,valid:i}=this.decrypt(e.k,e.n,t,n,r);return i&&e.n.increment(),{plaintext:s,valid:i}}hasKey(e){return!this.isEmptyKey(e.k)}createEmptyKey(){return new Uint8Array(32)}isEmptyKey(e){const t=this.createEmptyKey();return Ja(t,e)}encrypt(e,t,n,r){return t.assertValue(),this.crypto.chaCha20Poly1305Encrypt(r,t.getBytes(),n,e)}encryptAndHash(e,t){let n;return n=this.hasKey(e.cs)?this.encryptWithAd(e.cs,e.h,t):t,this.mixHash(e,n),n}decrypt(e,t,n,r,s){t.assertValue();const i=this.crypto.chaCha20Poly1305Decrypt(r,t.getBytes(),n,e,s);return i?{plaintext:i,valid:!0}:{plaintext:new Uint8Array(0),valid:!1}}decryptAndHash(e,t){let n,r=!0;return this.hasKey(e.cs)?({plaintext:n,valid:r}=this.decryptWithAd(e.cs,e.h,t)):n=t,this.mixHash(e,t),{plaintext:n,valid:r}}dh(e,t){try{const n=this.crypto.generateX25519SharedKey(e,t);return 32===n.length?n:n.subarray(0,32)}catch(n){const e=n;return U2(e.message),new Uint8Array(32)}}mixHash(e,t){e.h=this.getHash(e.h,t)}getHash(e,t){const n=this.crypto.hashSHA256(ya([e,t],e.length+t.length));return n}mixKey(e,t){const[n,r]=this.crypto.getHKDF(e.ck,t);e.cs=this.initializeKey(r),e.ck=n}initializeKey(e){return{k:e,n:new W2}}initializeSymmetric(e){const t=$o(e,"utf-8"),n=this.hashProtocolName(t),r=n,s=this.createEmptyKey(),i=this.initializeKey(s);return{cs:i,ck:r,h:n}}hashProtocolName(e){if(e.length<=32){const t=new Uint8Array(32);return t.set(e),t}return this.getHash(e,new Uint8Array(0))}split(e){const[t,n]=this.crypto.getHKDF(e.ck,new Uint8Array(0)),r=this.initializeKey(t),s=this.initializeKey(n);return{cs1:r,cs2:s}}writeMessageRegular(e,t){const n=this.encryptWithAd(e,new Uint8Array(0),t),r=this.createEmptyKey(),s=new Uint8Array(0);return{ne:r,ns:s,ciphertext:n}}readMessageRegular(e,t){return this.decryptWithAd(e,new Uint8Array(0),t.ciphertext)}}class J2 extends Y2{initializeInitiator(e,t,n,r){const s="Noise_XX_25519_ChaChaPoly_SHA256",i=this.initializeSymmetric(s);this.mixHash(i,e);const o=new Uint8Array(32);return{ss:i,s:t,rs:n,psk:r,re:o}}initializeResponder(e,t,n,r){const s="Noise_XX_25519_ChaChaPoly_SHA256",i=this.initializeSymmetric(s);this.mixHash(i,e);const o=new Uint8Array(32);return{ss:i,s:t,rs:n,psk:r,re:o}}writeMessageA(e,t,n){const r=new Uint8Array(0);e.e=void 0!==n?n:this.crypto.generateX25519KeyPair();const s=e.e.publicKey;this.mixHash(e.ss,s);const i=this.encryptAndHash(e.ss,t);return{ne:s,ns:r,ciphertext:i}}writeMessageB(e,t){e.e=this.crypto.generateX25519KeyPair();const n=e.e.publicKey;this.mixHash(e.ss,n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const r=e.s.publicKey,s=this.encryptAndHash(e.ss,r);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const i=this.encryptAndHash(e.ss,t);return{ne:n,ns:s,ciphertext:i}}writeMessageC(e,t){const n=e.s.publicKey,r=this.encryptAndHash(e.ss,n);this.mixKey(e.ss,this.dh(e.s.privateKey,e.re));const s=this.encryptAndHash(e.ss,t),i=this.createEmptyKey(),o={ne:i,ns:r,ciphertext:s},{cs1:a,cs2:c}=this.split(e.ss);return{h:e.ss.h,messageBuffer:o,cs1:a,cs2:c}}readMessageA(e,t){return B2(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),this.decryptAndHash(e.ss,t.ciphertext)}readMessageB(e,t){if(B2(t.ne)&&(e.re=t.ne),this.mixHash(e.ss,e.re),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.re));const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);r&&B2(n)&&(e.rs=n),this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext);return{plaintext:s,valid:r&&i}}readMessageC(e,t){const{plaintext:n,valid:r}=this.decryptAndHash(e.ss,t.ns);if(r&&B2(n)&&(e.rs=n),!e.e)throw new Error("Handshake state `e` param is missing.");this.mixKey(e.ss,this.dh(e.e.privateKey,e.rs));const{plaintext:s,valid:i}=this.decryptAndHash(e.ss,t.ciphertext),{cs1:o,cs2:a}=this.split(e.ss);return{h:e.ss.h,plaintext:s,valid:r&&i,cs1:o,cs2:a}}initSession(e,t,n){const r=this.createEmptyKey(),s=new Uint8Array(32);let i;return i=e?this.initializeInitiator(t,n,s,r):this.initializeResponder(t,n,s,r),{hs:i,i:e,mc:0}}sendMessage(e,t,n){let r;if(0===e.mc)r=this.writeMessageA(e.hs,t,n);else if(1===e.mc)r=this.writeMessageB(e.hs,t);else if(2===e.mc){const{h:n,messageBuffer:s,cs1:i,cs2:o}=this.writeMessageC(e.hs,t);r=s,e.h=n,e.cs1=i,e.cs2=o}else{if(!(e.mc>2))throw new Error("Session invalid.");if(e.i){if(!e.cs1)throw new Error("CS1 (cipher state) is not defined");r=this.writeMessageRegular(e.cs1,t)}else{if(!e.cs2)throw new Error("CS2 (cipher state) is not defined");r=this.writeMessageRegular(e.cs2,t)}}return e.mc++,r}recvMessage(e,t){let n=new Uint8Array(0),r=!1;if(0===e.mc)({plaintext:n,valid:r}=this.readMessageA(e.hs,t));else if(1===e.mc)({plaintext:n,valid:r}=this.readMessageB(e.hs,t));else if(2===e.mc){const{h:s,plaintext:i,valid:o,cs1:a,cs2:c}=this.readMessageC(e.hs,t);n=i,r=o,e.h=s,e.cs1=a,e.cs2=c}return e.mc++,{plaintext:n,valid:r}}}class Q2{constructor(e,t,n,r,s,i,o,a){this.remoteExtensions={webtransportCerthashes:[]},this.isInitiator=e,this.payload=t,this.prologue=n,this.staticKeypair=s,this.connection=i,o&&(this.remotePeer=o),this.xx=a??new J2(r),this.session=this.xx.initSession(this.isInitiator,this.prologue,this.staticKeypair)}async propose(){if(F2(this.session.hs.s),this.isInitiator){U2("Stage 0 - Initiator starting to send first message.");const e=this.xx.sendMessage(this.session,new Uint8Array(0));this.connection.writeLP(y2(e)),U2("Stage 0 - Initiator finished sending first message."),j2(this.session.hs.e)}else{U2("Stage 0 - Responder waiting to receive first message...");const e=v2((await this.connection.readLP()).subarray()),{valid:t}=this.xx.recvMessage(this.session,e);if(!t)throw new T2("xx handshake stage 0 validation fail");U2("Stage 0 - Responder received first message."),$2(this.session.hs.re)}}async exchange(){if(this.isInitiator){U2("Stage 1 - Initiator waiting to receive first message from responder...");const t=E2((await this.connection.readLP()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new T2("xx handshake stage 1 validation fail");U2("Stage 1 - Initiator received the message."),$2(this.session.hs.re),z2(this.session.hs.rs),U2("Initiator going to check remote's signature...");try{const e=P2(n);this.remotePeer=this.remotePeer||await D2(e),await M2(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new A2(`Error occurred while verifying signed payload: ${t.message}`)}U2("All good with the signature!")}else{U2("Stage 1 - Responder sending out first message with signed payload and static key.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(w2(e)),U2("Stage 1 - Responder sent the second handshake message with signed payload."),j2(this.session.hs.e)}}async finish(){if(this.isInitiator){U2("Stage 2 - Initiator sending third handshake message.");const e=this.xx.sendMessage(this.session,this.payload);this.connection.writeLP(b2(e)),U2("Stage 2 - Initiator sent message with signed payload.")}else{U2("Stage 2 - Responder waiting for third handshake message...");const t=_2((await this.connection.readLP()).subarray()),{plaintext:n,valid:r}=this.xx.recvMessage(this.session,t);if(!r)throw new T2("xx handshake stage 2 validation fail");U2("Stage 2 - Responder received the message, finished handshake.");try{const e=P2(n);this.remotePeer=this.remotePeer||await D2(e),await M2(this.session.hs.rs,e,this.remotePeer),this.setRemoteNoiseExtension(e.extensions)}catch(e){const t=e;throw new A2(`Error occurred while verifying signed payload: ${t.message}`)}}H2(this.session)}encrypt(e,t){const n=this.getCS(t);return this.xx.encryptWithAd(n,new Uint8Array(0),e)}decrypt(e,t,n){const r=this.getCS(t,!1);return this.xx.decryptWithAd(r,new Uint8Array(0),e,n)}getRemoteStaticKey(){return this.session.hs.rs}getCS(e,t=!0){if(!e.cs1||!e.cs2)throw new T2("Handshake not completed properly, cipher state does not exist.");return this.isInitiator?t?e.cs1:e.cs2:t?e.cs2:e.cs1}setRemoteNoiseExtension(e){e&&(this.remoteExtensions=e)}}function X2(e){return{xxHandshakeSuccesses:e.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:e.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:e.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:e.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:e.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}class Z2{constructor(e={}){this.protocol="/noise";const{staticNoiseKey:t,extensions:n,crypto:r,prologueBytes:s,metrics:i}=e;this.crypto=r??p2,this.extensions=n,this.metrics=i?X2(i):void 0,this.staticKeys=t?this.crypto.generateX25519KeyPairFromSeed(t):this.crypto.generateX25519KeyPair(),this.prologue=s??new Uint8Array(0)}async secureOutbound(e,t,n){const r=r2(t,{lengthEncoder:g2,lengthDecoder:m2,maxDataLength:o2}),s=await this.performHandshake({connection:r,isInitiator:!0,localPeer:e,remotePeer:n}),i=await this.createSecureConnection(r,s);return{conn:i,remoteExtensions:s.remoteExtensions,remotePeer:s.remotePeer}}async secureInbound(e,t,n){const r=r2(t,{lengthEncoder:g2,lengthDecoder:m2,maxDataLength:o2}),s=await this.performHandshake({connection:r,isInitiator:!1,localPeer:e,remotePeer:n}),i=await this.createSecureConnection(r,s);return{conn:i,remotePeer:s.remotePeer,remoteExtensions:s.remoteExtensions}}async performHandshake(e){const t=await O2(e.localPeer,this.staticKeys.publicKey,this.extensions);return await this.performXXHandshake(e,t)}async performXXHandshake(e,t){const{isInitiator:n,remotePeer:r,connection:s}=e,i=new Q2(n,t,this.prologue,this.crypto,this.staticKeys,s,r);try{await i.propose(),await i.exchange(),await i.finish(),this.metrics?.xxHandshakeSuccesses.increment()}catch(o){if(this.metrics?.xxHandshakeErrors.increment(),o instanceof Error)throw o.message=`Error occurred during XX handshake: ${o.message}`,o}return i}async createSecureConnection(e,t){const[n,r]=i2(),s=e.unwrap();return await vm(n,S2(t,this.metrics),s,cj({lengthDecoder:m2}),k2(t,this.metrics),n),r}}function e3(e={}){return()=>new Z2(e)}const t3=ne.bind({ignoreUndefined:!0,concatArrays:!0});function n3({options:e={},peerId:t,multiaddrs:n=[],repo:r,keychainConfig:s={},config:i={}}){const{datastore:o}=r,a=r3({options:e,config:i,datastore:o,keychainConfig:s,peerId:t,multiaddrs:n});return"function"===typeof e.libp2p?e.libp2p({libp2pOptions:a,options:e,config:i,datastore:o,peerId:t}):QX(a)}function r3({options:e,config:t,datastore:n,keychainConfig:r,peerId:s,multiaddrs:i}){const o=()=>{const e=um(t,"Pubsub.Router")||"gossipsub",n=pj();if(!n[e])throw je(new Error(`Router unavailable. Configure libp2p.modules.pubsub to use the ${e} router.`),"ERR_NOT_SUPPORTED");return n[e]},a={datastore:n,peerId:s},c={addresses:{listen:i.map((e=>e.toString())),announce:um(e,"addresses.announce",um(t,"Addresses.Announce",[])),noAnnounce:um(e,"addresses.noAnnounce",um(t,"Addresses.NoAnnounce",[]))},connectionManager:um(e,"connectionManager",{maxConnections:um(e,"config.Swarm.ConnMgr.HighWater",um(t,"Swarm.ConnMgr.HighWater")),minConnections:um(e,"config.Swarm.ConnMgr.LowWater",um(t,"Swarm.ConnMgr.LowWater"))}),keychain:r,identify:{host:{agentVersion:`js-ipfs/${rC}`}},contentRouters:[],peerRouters:[],peerDiscovery:[],transports:[],streamMuxers:[n2({maxInboundStreams:256,maxOutboundStreams:1024})],connectionEncryption:[e3()],relay:{enabled:um(e,"relay.enabled",um(t,"relay.enabled",!0)),hop:{enabled:um(e,"relay.hop.enabled",um(t,"relay.hop.enabled",!1)),active:um(e,"relay.hop.active",um(t,"relay.hop.active",!1))}},nat:{enabled:!um(t,"Swarm.DisableNatPortMap",!1)}};um(e,"config.Pubsub.Enabled",um(t,"Pubsub.Enabled",!0))&&(c.pubsub=o()),"none"!==um(t,"Routing.Type","dhtclient")&&(c.dht=K1({clientMode:"dhtserver"!==um(t,"Routing.Type","dht"),kBucketSize:um(e,"dht.kBucketSize",20),validators:{ipns:zg},selectors:{ipns:hm}}));const l=um(e,"config.Bootstrap",um(t,"Bootstrap",[]));l.length>0&&c.peerDiscovery?.push(X1({list:l}));let u=um(e,"libp2p",void 0);"function"===typeof u&&(u=void 0);const h=t3(a,KG(),c,u),d=um(e,"config.Addresses.Delegates",um(t,"Addresses.Delegates",[]));if(d.length>0){const e=d[Math.floor(Math.random()*d.length)],t=dc(e).toOptions(),n={host:t.host,protocol:443===parseInt(t.port)?"https":"http",port:t.port},r=wK(n);h.contentRouters?.push(Ij(r)),h.peerRouters?.push(vj(r))}return um(e,"config.Discovery.MDNS.Enabled",um(t,"Discovery.MDNS.Enabled",!0))||(h.peerDiscovery=h.peerDiscovery?.filter((e=>{try{if("function"===typeof e)return"@libp2p/mdns"!==e({})[Symbol.toStringTag]}catch{}return!0}))),null==h.transports&&(h.transports=[]),null==h.transports.find((e=>{try{if("function"===typeof e)return"@libp2p/websockets"===e({})[Symbol.toStringTag]}catch{}return!1}))&&h.transports.push(_0()),h}const s3=ne.bind({ignoreUndefined:!0}),i3=Fe("ipfs:components:peer:storage");class o3{constructor(e,t,n,r,s){this.print=r,this.peerId=e,this.keychain=t,this.repo=n,this.print=r,this.isNew=s}static async start(e,t,n){const{repoAutoMigrate:r,repo:s,onMigrationProgress:i}=n,o="string"===typeof s||null==s?VP(e,t,{path:s,autoMigrate:r,onMigrationProgress:i}):s,{peerId:a,keychain:c,isNew:l}=await a3(e,o,n);return new o3(a,c,o,e,l)}}const a3=async(e,t,n)=>{if(!t.closed)return{...await d3(t,n),isNew:!1};try{return await t.open(),{...await d3(t,n),isNew:!1}}catch(uS){if(uS.code!==_D)throw uS;if(n.init&&!1===n.init.allowNew)throw new Po("Initialization of new repos disabled by config, pass `config.init.isNew: true` to enable it");return{...await c3(e,t,n),isNew:!0}}},c3=async(e,t,n)=>{const r=n.init||{},s=await t.exists();if(i3("repo exists?",s),!0===s)throw new Error("repo already exists");const i=r.privateKey?await l3(r.privateKey):await u3(e,r),o=h3(i);i3("peer identity: %s",o.PeerID);const a={...s3(f3(by(),r.profiles),n.config),Identity:o};await t.init(a),await t.open(),i3("repo opened");const c={pass:n.pass};try{c.dek=await t.config.get("Keychain.DEK")}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS}const l=await n3({options:void 0,multiaddrs:void 0,peerId:i,repo:t,config:a,keychainConfig:c});return await t.datastore.has(new rl("/info/self"))||await l.keychain.importPeer("self",i),await t.config.set("Keychain",{DEK:l.keychain.init.dek}),{peerId:i,keychain:l.keychain}},l3=async e=>{if(i3("using user-supplied private-key"),Ru(e))return e;const t=$o(e,"base64pad"),n=await Yf(t);return await $u(n.public.bytes,n.bytes)},u3=(e,{algorithm:t="Ed25519",bits:n=2048})=>{if(e("generating %s keypair...",t),"Ed25519"===t)return PX();if("RSA"===t)return LX({bits:n});throw je(new Error("Unknown PeerId algorithm"),"ERR_UNKNOWN_PEER_ID_ALGORITHM")},h3=e=>{if(null==e.privateKey)throw je(new Error("Private key missing"),"ERR_MISSING_PRIVATE_KEY");return{PeerID:e.toString(),PrivKey:ia(e.privateKey,"base64pad")}},d3=async(e,t)=>{const n=t.config,r=t.init&&t.init.profiles||[],s=t.pass,i=await e.config.getAll(),o=p3(f3(i,r),n);if(i!==o&&await e.config.replace(o),!o.Identity||!o.Identity.PrivKey)throw new Io("No private key was found in the config, please intialize the repo");const a=$o(o.Identity.PrivKey,"base64pad"),c=await Yf(a),l=await $u(c.public.bytes,c.bytes),u=await n3({options:void 0,multiaddrs:void 0,peerId:l,repo:e,config:o,keychainConfig:{pass:s,...o.Keychain}});return{peerId:l,keychain:u.keychain}},p3=(e,t)=>t?s3(e,t):e,f3=(e,t)=>(t||[]).reduce(((e,t)=>{const n=fC[t];if(!n)throw new Error(`Could not find profile with name '${t}'`);return i3("applying profile %s",t),n.transform(e)}),e);var g3=n(1962);function m3(e){let t=new Uint8Array(e.reduce(((e,t)=>e+ma.encodingLength(t)),0)),n=0;for(const r of e)t=ma.encode(r,t,n),n+=ma.encodingLength(r);return t}var y3=m3;class w3{constructor(e,t,n){this._refCounter=1,this.cid=e,this.priority=t||1,this.wantType=n}inc(){this._refCounter+=1}dec(){this._refCounter=Math.max(0,this._refCounter-1)}hasRefs(){return this._refCounter>0}get[Symbol.toStringTag](){const e=this.cid.toString(Ae);return`WantlistEntry <key: ${e}, priority: ${this.priority}, refs: ${this._refCounter}>`}equals(e){return this._refCounter===e._refCounter&&this.cid.equals(e.cid)&&this.priority===e.priority&&this.wantType===e.wantType}}const b3=ze.Reader,v3=ze.Writer,E3=ze.util,_3=ze.roots["ipfs-bitswap"]||(ze.roots["ipfs-bitswap"]={}),S3=_3.Message=(()=>{function e(e){if(this.blocks=[],this.payload=[],this.blockPresences=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.wantlist=null,e.prototype.blocks=E3.emptyArray,e.prototype.payload=E3.emptyArray,e.prototype.blockPresences=E3.emptyArray,e.prototype.pendingBytes=0,e.encode=function(e,t){if(t||(t=v3.create()),null!=e.wantlist&&Object.hasOwnProperty.call(e,"wantlist")&&_3.Message.Wantlist.encode(e.wantlist,t.uint32(10).fork()).ldelim(),null!=e.blocks&&e.blocks.length)for(var n=0;n<e.blocks.length;++n)t.uint32(18).bytes(e.blocks[n]);if(null!=e.payload&&e.payload.length)for(n=0;n<e.payload.length;++n)_3.Message.Block.encode(e.payload[n],t.uint32(26).fork()).ldelim();if(null!=e.blockPresences&&e.blockPresences.length)for(n=0;n<e.blockPresences.length;++n)_3.Message.BlockPresence.encode(e.blockPresences[n],t.uint32(34).fork()).ldelim();return null!=e.pendingBytes&&Object.hasOwnProperty.call(e,"pendingBytes")&&t.uint32(40).int32(e.pendingBytes),t},e.decode=function(e,t){e instanceof b3||(e=b3.create(e));var n=void 0===t?e.len:e.pos+t,r=new _3.Message;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.wantlist=_3.Message.Wantlist.decode(e,e.uint32());break;case 2:r.blocks&&r.blocks.length||(r.blocks=[]),r.blocks.push(e.bytes());break;case 3:r.payload&&r.payload.length||(r.payload=[]),r.payload.push(_3.Message.Block.decode(e,e.uint32()));break;case 4:r.blockPresences&&r.blockPresences.length||(r.blockPresences=[]),r.blockPresences.push(_3.Message.BlockPresence.decode(e,e.uint32()));break;case 5:r.pendingBytes=e.int32();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof _3.Message)return e;var t=new _3.Message;if(null!=e.wantlist){if("object"!==typeof e.wantlist)throw TypeError(".Message.wantlist: object expected");t.wantlist=_3.Message.Wantlist.fromObject(e.wantlist)}if(e.blocks){if(!Array.isArray(e.blocks))throw TypeError(".Message.blocks: array expected");t.blocks=[];for(var n=0;n<e.blocks.length;++n)"string"===typeof e.blocks[n]?E3.base64.decode(e.blocks[n],t.blocks[n]=E3.newBuffer(E3.base64.length(e.blocks[n])),0):e.blocks[n].length>=0&&(t.blocks[n]=e.blocks[n])}if(e.payload){if(!Array.isArray(e.payload))throw TypeError(".Message.payload: array expected");t.payload=[];for(n=0;n<e.payload.length;++n){if("object"!==typeof e.payload[n])throw TypeError(".Message.payload: object expected");t.payload[n]=_3.Message.Block.fromObject(e.payload[n])}}if(e.blockPresences){if(!Array.isArray(e.blockPresences))throw TypeError(".Message.blockPresences: array expected");t.blockPresences=[];for(n=0;n<e.blockPresences.length;++n){if("object"!==typeof e.blockPresences[n])throw TypeError(".Message.blockPresences: object expected");t.blockPresences[n]=_3.Message.BlockPresence.fromObject(e.blockPresences[n])}}return null!=e.pendingBytes&&(t.pendingBytes=0|e.pendingBytes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.blocks=[],n.payload=[],n.blockPresences=[]),t.defaults&&(n.wantlist=null,n.pendingBytes=0),null!=e.wantlist&&e.hasOwnProperty("wantlist")&&(n.wantlist=_3.Message.Wantlist.toObject(e.wantlist,t)),e.blocks&&e.blocks.length){n.blocks=[];for(var r=0;r<e.blocks.length;++r)n.blocks[r]=t.bytes===String?E3.base64.encode(e.blocks[r],0,e.blocks[r].length):t.bytes===Array?Array.prototype.slice.call(e.blocks[r]):e.blocks[r]}if(e.payload&&e.payload.length){n.payload=[];for(r=0;r<e.payload.length;++r)n.payload[r]=_3.Message.Block.toObject(e.payload[r],t)}if(e.blockPresences&&e.blockPresences.length){n.blockPresences=[];for(r=0;r<e.blockPresences.length;++r)n.blockPresences[r]=_3.Message.BlockPresence.toObject(e.blockPresences[r],t)}return null!=e.pendingBytes&&e.hasOwnProperty("pendingBytes")&&(n.pendingBytes=e.pendingBytes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message"},e.Wantlist=function(){function e(e){if(this.entries=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.entries=E3.emptyArray,e.prototype.full=!1,e.encode=function(e,t){if(t||(t=v3.create()),null!=e.entries&&e.entries.length)for(var n=0;n<e.entries.length;++n)_3.Message.Wantlist.Entry.encode(e.entries[n],t.uint32(10).fork()).ldelim();return null!=e.full&&Object.hasOwnProperty.call(e,"full")&&t.uint32(16).bool(e.full),t},e.decode=function(e,t){e instanceof b3||(e=b3.create(e));var n=void 0===t?e.len:e.pos+t,r=new _3.Message.Wantlist;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.entries&&r.entries.length||(r.entries=[]),r.entries.push(_3.Message.Wantlist.Entry.decode(e,e.uint32()));break;case 2:r.full=e.bool();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof _3.Message.Wantlist)return e;var t=new _3.Message.Wantlist;if(e.entries){if(!Array.isArray(e.entries))throw TypeError(".Message.Wantlist.entries: array expected");t.entries=[];for(var n=0;n<e.entries.length;++n){if("object"!==typeof e.entries[n])throw TypeError(".Message.Wantlist.entries: object expected");t.entries[n]=_3.Message.Wantlist.Entry.fromObject(e.entries[n])}}return null!=e.full&&(t.full=Boolean(e.full)),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.entries=[]),t.defaults&&(n.full=!1),e.entries&&e.entries.length){n.entries=[];for(var r=0;r<e.entries.length;++r)n.entries[r]=_3.Message.Wantlist.Entry.toObject(e.entries[r],t)}return null!=e.full&&e.hasOwnProperty("full")&&(n.full=e.full),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Wantlist"},e.WantType=function(){const e={},t=Object.create(e);return t[e[0]="Block"]=0,t[e[1]="Have"]=1,t}(),e.Entry=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.block=E3.newBuffer([]),e.prototype.priority=0,e.prototype.cancel=!1,e.prototype.wantType=0,e.prototype.sendDontHave=!1,e.encode=function(e,t){return t||(t=v3.create()),null!=e.block&&Object.hasOwnProperty.call(e,"block")&&t.uint32(10).bytes(e.block),null!=e.priority&&Object.hasOwnProperty.call(e,"priority")&&t.uint32(16).int32(e.priority),null!=e.cancel&&Object.hasOwnProperty.call(e,"cancel")&&t.uint32(24).bool(e.cancel),null!=e.wantType&&Object.hasOwnProperty.call(e,"wantType")&&t.uint32(32).int32(e.wantType),null!=e.sendDontHave&&Object.hasOwnProperty.call(e,"sendDontHave")&&t.uint32(40).bool(e.sendDontHave),t},e.decode=function(e,t){e instanceof b3||(e=b3.create(e));var n=void 0===t?e.len:e.pos+t,r=new _3.Message.Wantlist.Entry;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.block=e.bytes();break;case 2:r.priority=e.int32();break;case 3:r.cancel=e.bool();break;case 4:r.wantType=e.int32();break;case 5:r.sendDontHave=e.bool();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof _3.Message.Wantlist.Entry)return e;var t=new _3.Message.Wantlist.Entry;switch(null!=e.block&&("string"===typeof e.block?E3.base64.decode(e.block,t.block=E3.newBuffer(E3.base64.length(e.block)),0):e.block.length>=0&&(t.block=e.block)),null!=e.priority&&(t.priority=0|e.priority),null!=e.cancel&&(t.cancel=Boolean(e.cancel)),e.wantType){case"Block":case 0:t.wantType=0;break;case"Have":case 1:t.wantType=1;break}return null!=e.sendDontHave&&(t.sendDontHave=Boolean(e.sendDontHave)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.block="":(n.block=[],t.bytes!==Array&&(n.block=E3.newBuffer(n.block))),n.priority=0,n.cancel=!1,n.wantType=t.enums===String?"Block":0,n.sendDontHave=!1),null!=e.block&&e.hasOwnProperty("block")&&(n.block=t.bytes===String?E3.base64.encode(e.block,0,e.block.length):t.bytes===Array?Array.prototype.slice.call(e.block):e.block),null!=e.priority&&e.hasOwnProperty("priority")&&(n.priority=e.priority),null!=e.cancel&&e.hasOwnProperty("cancel")&&(n.cancel=e.cancel),null!=e.wantType&&e.hasOwnProperty("wantType")&&(n.wantType=t.enums===String?_3.Message.Wantlist.WantType[e.wantType]:e.wantType),null!=e.sendDontHave&&e.hasOwnProperty("sendDontHave")&&(n.sendDontHave=e.sendDontHave),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Wantlist.Entry"},e}(),e}(),e.Block=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.prefix=E3.newBuffer([]),e.prototype.data=E3.newBuffer([]),e.encode=function(e,t){return t||(t=v3.create()),null!=e.prefix&&Object.hasOwnProperty.call(e,"prefix")&&t.uint32(10).bytes(e.prefix),null!=e.data&&Object.hasOwnProperty.call(e,"data")&&t.uint32(18).bytes(e.data),t},e.decode=function(e,t){e instanceof b3||(e=b3.create(e));var n=void 0===t?e.len:e.pos+t,r=new _3.Message.Block;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.prefix=e.bytes();break;case 2:r.data=e.bytes();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof _3.Message.Block)return e;var t=new _3.Message.Block;return null!=e.prefix&&("string"===typeof e.prefix?E3.base64.decode(e.prefix,t.prefix=E3.newBuffer(E3.base64.length(e.prefix)),0):e.prefix.length>=0&&(t.prefix=e.prefix)),null!=e.data&&("string"===typeof e.data?E3.base64.decode(e.data,t.data=E3.newBuffer(E3.base64.length(e.data)),0):e.data.length>=0&&(t.data=e.data)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.prefix="":(n.prefix=[],t.bytes!==Array&&(n.prefix=E3.newBuffer(n.prefix))),t.bytes===String?n.data="":(n.data=[],t.bytes!==Array&&(n.data=E3.newBuffer(n.data)))),null!=e.prefix&&e.hasOwnProperty("prefix")&&(n.prefix=t.bytes===String?E3.base64.encode(e.prefix,0,e.prefix.length):t.bytes===Array?Array.prototype.slice.call(e.prefix):e.prefix),null!=e.data&&e.hasOwnProperty("data")&&(n.data=t.bytes===String?E3.base64.encode(e.data,0,e.data.length):t.bytes===Array?Array.prototype.slice.call(e.data):e.data),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.Block"},e}(),e.BlockPresenceType=function(){const e={},t=Object.create(e);return t[e[0]="Have"]=0,t[e[1]="DontHave"]=1,t}(),e.BlockPresence=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.cid=E3.newBuffer([]),e.prototype.type=0,e.encode=function(e,t){return t||(t=v3.create()),null!=e.cid&&Object.hasOwnProperty.call(e,"cid")&&t.uint32(10).bytes(e.cid),null!=e.type&&Object.hasOwnProperty.call(e,"type")&&t.uint32(16).int32(e.type),t},e.decode=function(e,t){e instanceof b3||(e=b3.create(e));var n=void 0===t?e.len:e.pos+t,r=new _3.Message.BlockPresence;while(e.pos<n){var s=e.uint32();switch(s>>>3){case 1:r.cid=e.bytes();break;case 2:r.type=e.int32();break;default:e.skipType(7&s);break}}return r},e.fromObject=function(e){if(e instanceof _3.Message.BlockPresence)return e;var t=new _3.Message.BlockPresence;switch(null!=e.cid&&("string"===typeof e.cid?E3.base64.decode(e.cid,t.cid=E3.newBuffer(E3.base64.length(e.cid)),0):e.cid.length>=0&&(t.cid=e.cid)),e.type){case"Have":case 0:t.type=0;break;case"DontHave":case 1:t.type=1;break}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(t.bytes===String?n.cid="":(n.cid=[],t.bytes!==Array&&(n.cid=E3.newBuffer(n.cid))),n.type=t.enums===String?"Have":0),null!=e.cid&&e.hasOwnProperty("cid")&&(n.cid=t.bytes===String?E3.base64.encode(e.cid,0,e.cid.length):t.bytes===Array?Array.prototype.slice.call(e.cid):e.cid),null!=e.type&&e.hasOwnProperty("type")&&(n.type=t.enums===String?_3.Message.BlockPresenceType[e.type]:e.type),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,ze.util.toJSONOptions)},e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/Message.BlockPresence"},e}(),e})(),k3={Block:S3.Wantlist.WantType.Block,Have:S3.Wantlist.WantType.Have},A3=(e,t)=>Array.prototype.slice.call(t,0).sort(((t,n)=>{const r=e(t),s=e(n);return r<s?-1:r>s?1:0}));class T3{constructor(e,t){this.set=t?TJ({system:"ipfs",component:"bitswap",metric:"wantlist",metrics:t.metrics}):new Map,this._stats=e}get length(){return this.set.size}add(e,t,n){const r=e.toString(Ae),s=this.set.get(r);s?(s.inc(),s.priority=t,s.wantType===k3.Have&&n===k3.Block&&(s.wantType=n)):(this.set.set(r,new w3(e,t,n)),this._stats&&this._stats.push(null,"wantListSize",1))}remove(e){const t=e.toString(Ae),n=this.set.get(t);n&&(n.dec(),n.hasRefs()||(this.set.delete(t),this._stats&&this._stats.push(null,"wantListSize",-1)))}removeForce(e){this.set.has(e)&&this.set.delete(e)}forEach(e){return this.set.forEach(e)}entries(){return this.set.entries()}sortedEntries(){return new Map(A3((e=>e[1].key),Array.from(this.set.entries())))}contains(e){const t=e.toString(Ae);return this.set.has(t)}get(e){const t=e.toString(Ae);return this.set.get(t)}}T3.Entry=w3;const C3=T3.Entry;class I3{constructor(e,t,n,r,s){this.entry=new C3(e,t,n),this.cancel=Boolean(r),this.sendDontHave=Boolean(s)}get cid(){return this.entry.cid}set cid(e){this.entry.cid=e}get priority(){return this.entry.priority}set priority(e){this.entry.priority=e}get wantType(){return this.entry.wantType}set wantType(e){this.entry.wantType=e}get[Symbol.toStringTag](){const e=this.cid.toString(Ae);return`BitswapMessageEntry ${e} <cancel: ${this.cancel}, priority: ${this.priority}>`}equals(e){return this.cancel===e.cancel&&this.sendDontHave===e.sendDontHave&&this.wantType===e.wantType&&this.entry.equals(e.entry)}}const R3=(e,t)=>{const n=["bitswap"];return t&&n.push(t),e&&n.push(`${e.toString().slice(0,8)}`),Object.assign(se(n.join(":")),{error:se(n.concat(["error"]).join(":"))})},O3=(e,t)=>{if(e.size!==t.size)return!1;for(const[n,r]of e){const e=t.get(n);if(void 0===e)return!1;if(r instanceof Uint8Array&&e instanceof Uint8Array&&!Ja(r,e))return!1;if(r instanceof I3&&e instanceof I3&&!r.equals(e))return!1}return!0};class x3{constructor(e){this.full=e,this.wantlist=new Map,this.blocks=new Map,this.blockPresences=new Map,this.pendingBytes=0}get empty(){return 0===this.blocks.size&&0===this.wantlist.size&&0===this.blockPresences.size}addEntry(e,t,n,r,s){null==n&&(n=x3.WantType.Block);const i=e.toString(Ae),o=this.wantlist.get(i);o?(o.wantType===n&&(o.priority=t),r&&(o.cancel=Boolean(r)),s&&(o.sendDontHave=Boolean(s)),n===x3.WantType.Block&&o.wantType===x3.WantType.Have&&(o.wantType=n)):this.wantlist.set(i,new I3(e,t,n,r,s))}addBlock(e,t){const n=e.toString(Ae);this.blocks.set(n,t)}addHave(e){const t=e.toString(Ae);this.blockPresences.has(t)||this.blockPresences.set(t,x3.BlockPresenceType.Have)}addDontHave(e){const t=e.toString(Ae);this.blockPresences.has(t)||this.blockPresences.set(t,x3.BlockPresenceType.DontHave)}cancel(e){const t=e.toString(Ae);this.wantlist.delete(t),this.addEntry(e,0,x3.WantType.Block,!0,!1)}setPendingBytes(e){this.pendingBytes=e}serializeToBitswap100(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),cancel:Boolean(e.cancel)}))),full:!!this.full||void 0},blocks:Array.from(this.blocks.values())};return S3.encode(e).finish()}serializeToBitswap110(){const e={wantlist:{entries:Array.from(this.wantlist.values()).map((e=>({block:e.cid.bytes,priority:Number(e.priority),wantType:e.wantType,cancel:Boolean(e.cancel),sendDontHave:Boolean(e.sendDontHave)}))),full:!!this.full||void 0},blockPresences:[],payload:[],pendingBytes:this.pendingBytes};for(const[t,n]of this.blocks.entries()){const r=Lt.parse(t),s=r.version,i=r.code,o=r.multihash.code,a=r.multihash.digest.length,c=y3([s,i,o,a]);e.payload.push(new S3.Block({prefix:c,data:n}))}for(const[t,n]of this.blockPresences)e.blockPresences.push(new S3.BlockPresence({cid:Lt.parse(t).bytes,type:n}));return this.pendingBytes>0&&(e.pendingBytes=this.pendingBytes),S3.encode(e).finish()}equals(e){return!!(this.full===e.full&&this.pendingBytes===e.pendingBytes&&O3(this.wantlist,e.wantlist)&&O3(this.blocks,e.blocks)&&O3(this.blockPresences,e.blockPresences))}get[Symbol.toStringTag](){const e=Array.from(this.wantlist.keys()),t=Array.from(this.blocks.keys());return`BitswapMessage <full: ${this.full}, list: ${e}, blocks: ${t}>`}}x3.deserialize=async(e,t)=>{const n=S3.decode(e),r=n.wantlist&&n.wantlist.full||!1,s=new x3(r);return n.wantlist&&n.wantlist.entries&&n.wantlist.entries.forEach((e=>{if(!e.block)return;const t=Lt.decode(e.block);s.addEntry(t,e.priority||0,e.wantType,Boolean(e.cancel),Boolean(e.sendDontHave))})),n.blockPresences&&n.blockPresences.forEach((e=>{if(!e.cid)return;const t=Lt.decode(e.cid);e.type===x3.BlockPresenceType.Have?s.addHave(t):s.addDontHave(t)})),n.blocks.length>0?(await Promise.all(n.blocks.map((async e=>{const t=await ho.digest(e),n=Lt.createV0(t);s.addBlock(n,e)}))),s):n.payload.length>0?(await Promise.all(n.payload.map((async e=>{if(!e.prefix||!e.data)return;const n=g3(e.prefix),r=n[0],i=n[1],o=n[2],a=o===ho.code?ho:t&&await t.getHasher(o);if(!a)throw je(new Error("Unknown hash algorithm"),"ERR_UNKNOWN_HASH_ALG");const c=await a.digest(e.data),l=Lt.create(r,i,c);s.addBlock(l,e.data)}))),s.setPendingBytes(n.pendingBytes),s):s},x3.blockPresenceSize=e=>e.bytes.length+1,x3.Entry=I3,x3.WantType={Block:S3.Wantlist.WantType.Block,Have:S3.Wantlist.WantType.Have},x3.BlockPresenceType={Have:S3.BlockPresenceType.Have,DontHave:S3.BlockPresenceType.DontHave};const N3=3,D3=Math.pow(2,31)-1,P3=1e3,L3=1;var M3=B3;function B3(e,t,n){var r=null,s=null,i=function(){r&&(clearTimeout(r),s=null,r=null)},o=function(){var e=s;i(),e&&e()},a=function(){if(!t)return e.apply(this,arguments);var o=this,a=arguments,c=n&&!r;return i(),s=function(){e.apply(o,a)},r=setTimeout((function(){if(r=null,!c){var e=s;return s=null,e()}}),t),c?s():void 0};return a.cancel=i,a.flush=o,a}class U3{constructor(e,t,n){this.peerId=t,this.network=n,this.refcnt=1,this._entries=[],this._log=R3(e,"msgqueue"),this.sendEntries=M3(this._sendEntries.bind(this),L3)}addMessage(e){e.empty||this.send(e)}addEntries(e){this._entries=this._entries.concat(e),this.sendEntries()}_sendEntries(){if(!this._entries.length)return;const e=new x3(!1);this._entries.forEach((t=>{t.cancel?e.cancel(t.cid):e.addEntry(t.cid,t.priority)})),this._entries=[],this.addMessage(e)}async send(e){try{await this.network.connectTo(this.peerId)}catch(uS){return void this._log.error("cant connect to peer %s: %s",this.peerId.toString(),uS.message)}this._log("sending message to peer %s",this.peerId.toString()),this.network.sendMessage(this.peerId,e).catch((e=>{this._log.error("send error: %s",e.message)}))}}class V3{constructor(e,t,n,r){this.peers=TJ({system:"ipfs",component:"bitswap",metric:"want-manager-peers",metrics:r.metrics}),this.wantlist=new T3(n,r),this.network=t,this._stats=n,this._peerId=e,this._log=R3(e,"want")}_addEntries(e,t,n){const r=e.map(((e,n)=>new x3.Entry(e,D3-n,x3.WantType.Block,t)));r.forEach((e=>{e.cancel?n?this.wantlist.removeForce(e.cid.toString(Ae)):this.wantlist.remove(e.cid):(this._log("adding to wl"),this.wantlist.add(e.cid,e.priority))}));for(const s of this.peers.values())s.addEntries(r)}_startPeerHandler(e){let t=this.peers.get(e.toString());if(t)return void t.refcnt++;t=new U3(this._peerId,e,this.network);const n=new x3(!0);for(const r of this.wantlist.entries())n.addEntry(r[1].cid,r[1].priority);return t.addMessage(n),this.peers.set(e.toString(),t),t}_stopPeerHandler(e){const t=this.peers.get(e.toString());t&&(t.refcnt--,t.refcnt>0||this.peers.delete(e.toString()))}wantBlocks(e,t={}){this._addEntries(e,!1),t&&t.signal&&t.signal.addEventListener("abort",(()=>{this.cancelWants(e)}))}unwantBlocks(e){this._log("unwant blocks: %s",e.length),this._addEntries(e,!0,!0)}cancelWants(e){this._log("cancel wants: %s",e.length),this._addEntries(e,!0)}connectedPeers(){return Array.from(this.peers.keys())}connected(e){this._startPeerHandler(e)}disconnected(e){this._stopPeerHandler(e)}start(){}stop(){this.peers.forEach((e=>this.disconnected(e.peerId)))}}const F3="/ipfs/bitswap/1.0.0",j3="/ipfs/bitswap/1.1.0",z3="/ipfs/bitswap/1.2.0",$3=32,H3=128,K3=3e4;class q3{constructor(e,t,n,r={}){this._log=R3(e.peerId,"network"),this._libp2p=e,this._bitswap=t,this._protocols=[F3],r.b100Only||(this._protocols.unshift(j3),this._protocols.unshift(z3)),this._stats=n,this._running=!1,this._onPeerConnect=this._onPeerConnect.bind(this),this._onPeerDisconnect=this._onPeerDisconnect.bind(this),this._onConnection=this._onConnection.bind(this),this._hashLoader=r.hashLoader,this._maxInboundStreams=r.maxInboundStreams??$3,this._maxOutboundStreams=r.maxOutboundStreams??H3,this._incomingStreamTimeout=r.incomingStreamTimeout??K3}async start(){this._running=!0,await this._libp2p.handle(this._protocols,this._onConnection,{maxInboundStreams:this._maxInboundStreams,maxOutboundStreams:this._maxOutboundStreams});const e=dL({onConnect:this._onPeerConnect,onDisconnect:this._onPeerDisconnect});this._registrarIds=[];for(const t of this._protocols)this._registrarIds.push(await this._libp2p.registrar.register(t,e));this._libp2p.getConnections().forEach((e=>{this._onPeerConnect(e.remotePeer)}))}async stop(){if(this._running=!1,await this._libp2p.unhandle(this._protocols),null!=this._registrarIds){for(const e of this._registrarIds)this._libp2p.registrar.unregister(e);this._registrarIds=[]}}_onConnection({stream:e,connection:t}){if(!this._running)return;const n=new Ho.TimeoutController(this._incomingStreamTimeout);Promise.resolve().then((async()=>{this._log("incoming new bitswap %s connection from %p",e.stat.protocol,t.remotePeer),await vm(XF(e.source,n.signal),cj(),(async e=>{for await(const r of e){try{const e=await x3.deserialize(r.subarray(),this._hashLoader);await this._bitswap._receiveMessage(t.remotePeer,e)}catch(uS){this._bitswap._receiveError(uS);break}n.reset()}}))})).catch((t=>{this._log(t),e.abort(t)})).finally((()=>{n.clear(),e.close()}))}_onPeerConnect(e){this._bitswap._onPeerConnected(e)}_onPeerDisconnect(e){this._bitswap._onPeerDisconnected(e)}findProviders(e,t={}){return this._libp2p.contentRouting.findProviders(e,t)}async findAndConnect(e,t){const n=[];let r=0;for await(const s of this.findProviders(e,t))if(this._log(`connecting to provider ${s.id}`),n.push(this.connectTo(s.id,t).catch((e=>{this._log.error(e)}))),r++,r===N3)break;await Promise.all(n)}async provide(e,t){await this._libp2p.contentRouting.provide(e,t)}async sendMessage(e,t){if(!this._running)throw new Error("network isn't running");const n=e.toString();this._log("sendMessage to %s",n,t);const r=await this._libp2p.dial(e),s=await r.newStream([z3,j3,F3]);await G3(s,t,this._log),this._updateSentStats(e,t.blocks)}async connectTo(e,t){if(!this._running)throw new Error("network isn't running");return this._libp2p.dial(e,t)}_updateSentStats(e,t){const n=e.toString();if(this._stats){for(const e of t.values())this._stats.push(n,"dataSent",e.length);this._stats.push(n,"blocksSent",t.size)}}}async function G3(e,t,n){try{let n;switch(e.stat.protocol){case F3:n=t.serializeToBitswap100();break;case j3:case z3:n=t.serializeToBitswap110();break;default:throw new Error("Unknown protocol: "+e.stat.protocol)}await vm([n],rj(),e)}catch(uS){n(uS)}finally{e.close()}}class W3{constructor(e){this.partner=e,this.wantlist=new T3,this.exchangeCount=0,this.sentToPeer=new Map,this.accounting={bytesSent:0,bytesRecv:0}}sentBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesSent+=e}receivedBytes(e){this.exchangeCount++,this.lastExchange=(new Date).getTime(),this.accounting.bytesRecv+=e}wants(e,t,n){this.wantlist.add(e,t,n)}cancelWant(e){this.wantlist.remove(e)}wantlistContains(e){return this.wantlist.get(e)}debtRatio(){return this.accounting.bytesSent/(this.accounting.bytesRecv+1)}}class Y3 extends Map{constructor(e,t){super(),this._cmp=t||this._defaultSort,this._keys=[];for(const[n,r]of e||[])this.set(n,r)}update(e){if(e<0||e>=this._keys.length)return;const t=this._keys[e];this._keys.splice(e,1);const n=this._find(t);this._keys.splice(n,0,t)}set(e,t){if(this.has(e)){const t=this.indexOf(e);this._keys.splice(t,1)}super.set(e,t);const n=this._find(e);return this._keys.splice(n,0,e),this}clear(){super.clear(),this._keys=[]}delete(e){if(!this.has(e))return!1;const t=this.indexOf(e);return this._keys.splice(t,1),super.delete(e)}indexOf(e){if(!this.has(e))return-1;const t=this._find(e);if(this._keys[t]===e)return t;for(let n=1;n<this._keys.length;n++){if(this._keys[t+n]===e)return t+n;if(this._keys[t-n]===e)return t-n}return-1}_find(e){let t=0,n=this._keys.length;while(t<n){const r=t+n>>>1,s=this._kCmp(this._keys[r],e);if(s<0)t=r+1;else{if(!(s>0))return r;n=r}}return t}*keys(){for(const e of this._keys)yield e}*values(){for(const e of this._keys)yield this.get(e)}*entries(){for(const e of this._keys)yield[e,this.get(e)]}*[Symbol.iterator](){yield*this.entries()}forEach(e,t){if(e)for(const n of this._keys)e.apply(t,[[n,this.get(n)]])}_defaultSort(e,t){return e[0]<t[0]?-1:t[0]<e[0]?1:0}_kCmp(e,t){return this._cmp([e,this.get(e)],[t,this.get(t)])}}const J3={hasNewInfo(){return!1},merge(){}};class Q3{constructor(e=J3){this._taskMerger=e,this._byPeer=new Y3([],X3.compare)}pushTasks(e,t){let n=this._byPeer.get(e.toString());n||(n=new X3(e,this._taskMerger)),n.pushTasks(t),this._byPeer.set(e.toString(),n)}popTasks(e){const t=this._head();if(void 0===t)return{tasks:[],pendingSize:0};const{tasks:n,pendingSize:r}=t.popTasks(e);if(0===n.length)return{tasks:n,pendingSize:r};const s=t.peerId;return t.isIdle()?this._byPeer.delete(s.toString()):this._byPeer.update(0),{peerId:s,tasks:n,pendingSize:r}}_head(){if(0!==this._byPeer.size)for(const[,e]of this._byPeer)return e}remove(e,t){const n=this._byPeer.get(t.toString());n&&n.remove(e)}tasksDone(e,t){const n=this._byPeer.get(e.toString());if(!n)return;const r=this._byPeer.indexOf(e.toString());for(const s of t)n.taskDone(s);this._byPeer.update(r)}}class X3{constructor(e,t){this.peerId=e,this._taskMerger=t,this._activeTotalSize=0,this._pending=new Z3,this._active=new Set}pushTasks(e){for(const t of e)this._pushTask(t)}_pushTask(e){if(!this._taskHasMoreInfoThanActiveTasks(e))return;const t=this._pending.get(e.topic);if(t)return e.priority>t.priority&&this._pending.updatePriority(e.topic,e.priority),void this._taskMerger.merge(e,t);this._pending.add(e)}_taskHasMoreInfoThanActiveTasks(e){const t=[];for(const n of this._active)n.topic===e.topic&&t.push(n);return 0===t.length||this._taskMerger.hasNewInfo(e,t)}popTasks(e){let t=0;const n=[],r=this._pending.tasks();for(let s=0;s<r.length&&t<e;s++){const e=r[s];n.push(e),t+=e.size,this._pending.delete(e.topic),this._activeTotalSize+=e.size,this._active.add(e)}return{tasks:n,pendingSize:this._pending.totalSize}}taskDone(e){this._active.has(e)&&(this._activeTotalSize-=e.size,this._active.delete(e))}remove(e){this._pending.delete(e)}isIdle(){return 0===this._pending.length&&0===this._active.size}static compare(e,t){return 0===e[1]._pending.length?1:0===t[1]._pending.length?-1:e[1]._activeTotalSize===t[1]._activeTotalSize?t[1]._pending.length-e[1]._pending.length:e[1]._activeTotalSize-t[1]._activeTotalSize}}class Z3{constructor(){this._tasks=new Y3([],this._compare)}get length(){return this._tasks.size}get totalSize(){return[...this._tasks.values()].reduce(((e,t)=>e+t.task.size),0)}get(e){return(this._tasks.get(e)||{}).task}add(e){this._tasks.set(e.topic,{created:Date.now(),task:e})}delete(e){this._tasks.delete(e)}tasks(){return[...this._tasks.values()].map((e=>e.task))}updatePriority(e,t){const n=this._tasks.get(e);if(!n)return;const r=this._tasks.indexOf(e);n.task.priority=t,this._tasks.update(r)}_compare(e,t){return e[1].task.priority===t[1].task.priority?e[1].created-t[1].created:t[1].task.priority-e[1].task.priority}}const e6={hasNewInfo(e,t){let n=!1,r=!1;for(const s of t)s.data.haveBlock&&(n=!0),s.data.isWantBlock&&(r=!0);return!(r||!e.data.isWantBlock)||!(n||!e.data.haveBlock)},merge(e,t){const n=e.data,r=t.data;!r.haveBlock&&n.haveBlock&&(r.haveBlock=n.haveBlock,r.blockSize=n.blockSize),!r.isWantBlock&&n.isWantBlock&&(r.isWantBlock=!0,r.haveBlock&&!n.haveBlock||(r.haveBlock=n.haveBlock,t.size=e.size)),r.isWantBlock&&r.haveBlock&&(t.size=r.blockSize)}},t6=x3.WantType,n6=16384,r6=1024;class s6{constructor(e,t,n,r,s,i={}){this._log=R3(e,"engine"),this.blockstore=t,this.network=n,this._stats=r,this._opts=this._processOpts(i),this.ledgerMap=TJ({system:"ipfs",component:"bitswap",metric:"ledger-map",metrics:s.metrics}),this._running=!1,this._requestQueue=new Q3(e6)}_processOpts(e){return{maxSizeReplaceHasWithBlock:r6,targetMessageSize:n6,...e}}_scheduleProcessTasks(){setTimeout((()=>{this._processTasks()}))}async _processTasks(){if(!this._running)return;const{peerId:e,tasks:t,pendingSize:n}=this._requestQueue.popTasks(this._opts.targetMessageSize);if(0===t.length)return;const r=new x3(!1);r.setPendingBytes(n);const s=[],i=new Map;for(const a of t){const e=Lt.parse(a.topic);a.data.haveBlock?a.data.isWantBlock?(s.push(e),i.set(a.topic,a.data)):r.addHave(e):r.addDontHave(e)}const o=await this._getBlocks(s);for(const[a,c]of i){const e=Lt.parse(a),t=o.get(a);t?r.addBlock(e,t):c.sendDontHave&&r.addDontHave(e)}if(r.empty)return e&&this._requestQueue.tasksDone(e,t),void this._scheduleProcessTasks();try{e&&await this.network.sendMessage(e,r);for(const[t,n]of o.entries())e&&this.messageSent(e,Lt.parse(t),n)}catch(uS){this._log.error(uS)}e&&this._requestQueue.tasksDone(e,t),this._scheduleProcessTasks()}wantlistForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return n?n.wantlist.sortedEntries():new Map}ledgerForPeer(e){const t=e.toString(),n=this.ledgerMap.get(t);return n?{peer:n.partner,value:n.debtRatio(),sent:n.accounting.bytesSent,recv:n.accounting.bytesRecv,exchanged:n.exchangeCount}:null}peers(){return Array.from(this.ledgerMap.values()).map((e=>e.partner))}receivedBlocks(e){if(e.length){for(const t of this.ledgerMap.values())for(const n of e){const e=t.wantlistContains(n.cid);if(!e)continue;const r=n.data.length,s=this._sendAsBlock(e.wantType,r);let i=r;s||(i=x3.blockPresenceSize(e.cid)),this._requestQueue.pushTasks(t.partner,[{topic:e.cid.toString(Ae),priority:e.priority,size:i,data:{blockSize:r,isWantBlock:s,haveBlock:!0,sendDontHave:!1}}])}this._scheduleProcessTasks()}}async messageReceived(e,t){const n=this._findOrCreate(e);if(t.empty)return;if(t.full&&(n.wantlist=new T3),this._updateBlockAccounting(t.blocks,n),0===t.wantlist.size)return void this._scheduleProcessTasks();const r=[],s=[];t.wantlist.forEach((e=>{e.cancel?(n.cancelWant(e.cid),r.push(e.cid)):(n.wants(e.cid,e.priority,e.wantType),s.push(e))})),this._cancelWants(e,r),await this._addWants(e,s),this._scheduleProcessTasks()}_cancelWants(e,t){for(const n of t)this._requestQueue.remove(n.toString(Ae),e)}async _addWants(e,t){const n=await this._getBlockSizes(t.map((e=>e.cid))),r=[];for(const s of t){const t=s.cid.toString(Ae),i=n.get(t);if(null==i)s.sendDontHave&&r.push({topic:t,priority:s.priority,size:x3.blockPresenceSize(s.cid),data:{isWantBlock:s.wantType===t6.Block,blockSize:0,haveBlock:!1,sendDontHave:s.sendDontHave}});else{const e=this._sendAsBlock(s.wantType,i);let n=i;e||(n=x3.blockPresenceSize(s.cid)),r.push({topic:t,priority:s.priority,size:n,data:{isWantBlock:e,blockSize:i,haveBlock:!0,sendDontHave:s.sendDontHave}})}this._requestQueue.pushTasks(e,r)}}_sendAsBlock(e,t){return e===t6.Block||t<=this._opts.maxSizeReplaceHasWithBlock}async _getBlockSizes(e){const t=await this._getBlocks(e);return new Map([...t].map((([e,t])=>[e,t.length])))}async _getBlocks(e){const t=new Map;return await Promise.all(e.map((async e=>{try{const n=await this.blockstore.get(e);t.set(e.toString(Ae),n)}catch(n){"ERR_NOT_FOUND"!==n.code&&this._log.error("failed to query blockstore for %s: %s",e,n)}}))),t}_updateBlockAccounting(e,t){for(const n of e.values())this._log("got block (%s bytes)",n.length),t.receivedBytes(n.length)}messageSent(e,t,n){const r=this._findOrCreate(e);r.sentBytes(n.length),r.wantlist.remove(t)}numBytesSentTo(e){return this._findOrCreate(e).accounting.bytesSent}numBytesReceivedFrom(e){return this._findOrCreate(e).accounting.bytesRecv}peerDisconnected(e){this.ledgerMap.delete(e.toString())}_findOrCreate(e){const t=e.toString(),n=this.ledgerMap.get(t);if(n)return n;const r=new W3(e);return this.ledgerMap.set(t,r),this._stats&&this._stats.push(t,"peerCount",1),r}start(){this._running=!0}stop(){this._running=!1}}const i6=e=>`unwant:${ia(e.multihash.bytes,"base64")}`,o6=e=>`block:${ia(e.multihash.bytes,"base64")}`;class a6 extends XG.EventEmitter{constructor(e){super(),this.setMaxListeners(P3),this._log=R3(e,"notif")}hasBlock(e,t){const n=o6(e);this._log(n),this.emit(n,t)}wantBlock(e,t={}){if(!e)throw new Error("Not a valid cid");const n=o6(e),r=i6(e);return this._log(`wantBlock:${e}`),new Promise(((s,i)=>{const o=()=>{this.removeListener(n,a),i(new Error(`Block for ${e} unwanted`))},a=e=>{this.removeListener(r,o),s(e)};this.once(r,o),this.once(n,a),t&&t.signal&&t.signal.addEventListener("abort",(()=>{this.removeListener(n,a),this.removeListener(r,o),i(new Error(`Want for ${e} aborted`))}))}))}unwantBlock(e){const t=i6(e);this._log(t),this.emit(t)}}var c6=n(1547);class l6 extends XG.EventEmitter{constructor(e,t){super(),this._options=t,this._queue=[],this._stats={},this._frequencyLastTime=Date.now(),this._frequencyAccumulators={},this._movingAverages={},this._update=this._update.bind(this),e.forEach((e=>{this._stats[e]=BigInt(0),this._movingAverages[e]={},this._options.movingAverageIntervals.forEach((t=>{const n=this._movingAverages[e][t]=c6(t);n.push(this._frequencyLastTime,0)}))})),this._enabled=this._options.enabled}enable(){this._enabled=!0}disable(){this._disabled=!0}stop(){this._timeout&&clearTimeout(this._timeout)}get snapshot(){return Object.assign({},this._stats)}get movingAverages(){return Object.assign({},this._movingAverages)}push(e,t){this._enabled&&(this._queue.push([e,t,Date.now()]),this._resetComputeTimeout())}_resetComputeTimeout(){this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._update,this._nextTimeout())}_nextTimeout(){const e=this._queue.length/this._options.computeThrottleMaxQueueSize;return Math.max(this._options.computeThrottleTimeout*(1-e),0)}_update(){if(this._timeout=null,this._queue.length){let e;while(this._queue.length){const t=e=this._queue.shift();t&&this._applyOp(t)}e&&this._updateFrequency(e[2]),this.emit("update",this._stats)}}_updateFrequency(e){const t=e-this._frequencyLastTime;t&&Object.keys(this._stats).forEach((n=>{this._updateFrequencyFor(n,t,e)})),this._frequencyLastTime=e}_updateFrequencyFor(e,t,n){const r=this._frequencyAccumulators[e]||0;this._frequencyAccumulators[e]=0;const s=r/t*1e3;let i=this._movingAverages[e];i||(i=this._movingAverages[e]={}),this._options.movingAverageIntervals.forEach((e=>{let t=i[e];t||(t=i[e]=c6(e)),t.push(n,s)}))}_applyOp(e){const t=e[0],n=e[1];if("number"!==typeof n)throw new Error(`invalid increment number: ${n}`);Object.prototype.hasOwnProperty.call(this._stats,t)||(this._stats[t]=BigInt(0)),this._stats[t]=BigInt(this._stats[t])+BigInt(n),this._frequencyAccumulators[t]||(this._frequencyAccumulators[t]=0),this._frequencyAccumulators[t]+=n}}const u6={enabled:!1,computeThrottleTimeout:1e3,computeThrottleMaxQueueSize:1e3,movingAverageIntervals:[6e4,3e5,9e5]};class h6 extends XG.EventEmitter{constructor(e,t=[],n=u6){super();const r=Object.assign({},u6,n);if("number"!==typeof r.computeThrottleTimeout)throw new Error("need computeThrottleTimeout");if("number"!==typeof r.computeThrottleMaxQueueSize)throw new Error("need computeThrottleMaxQueueSize");this._initialCounters=t,this._options=r,this._enabled=this._options.enabled,this._global=new l6(t,r),this._global.on("update",(e=>this.emit("update",e))),this._peers=TJ({system:"ipfs",component:"bitswap",metric:"stats-peers",metrics:e.metrics})}enable(){this._enabled=!0,this._options.enabled=!0,this._global.enable()}disable(){this._enabled=!1,this._options.enabled=!1,this._global.disable()}stop(){this._enabled=!1,this._global.stop();for(const e of this._peers)e[1].stop()}get snapshot(){return this._global.snapshot}get movingAverages(){return this._global.movingAverages}forPeer(e){const t="string"!==typeof e&&e.toString?e.toString():`${e}`;return this._peers.get(t)}push(e,t,n){if(this._enabled&&(this._global.push(t,n),e)){let r=this._peers.get(e);r||(r=new l6(this._initialCounters,this._options),this._peers.set(e,r)),r.push(t,n)}}disconnected(e){const t=e.toString(),n=this._peers.get(t);n&&(n.stop(),this._peers.delete(t))}}const d6={statsEnabled:!1,statsComputeThrottleTimeout:1e3,statsComputeThrottleMaxQueueSize:1e3},p6=["blocksReceived","dataReceived","dupBlksReceived","dupDataReceived","blocksSent","dataSent","providesBufferLength","wantListLength","peerCount"];class f6 extends NP{constructor(e,t,n={}){super(),this._libp2p=e,this._log=R3(this.peerId),this._options=Object.assign({},d6,n),this._stats=new h6(e,p6,{enabled:this._options.statsEnabled,computeThrottleTimeout:this._options.statsComputeThrottleTimeout,computeThrottleMaxQueueSize:this._options.statsComputeThrottleMaxQueueSize}),this.network=new q3(e,this,this._stats,{hashLoader:n.hashLoader,maxInboundStreams:n.maxInboundStreams,maxOutboundStreams:n.maxOutboundStreams,incomingStreamTimeout:n.incomingStreamTimeout}),this.blockstore=t,this.engine=new s6(this.peerId,t,this.network,this._stats,e),this.wm=new V3(this.peerId,this.network,this._stats,e),this.notifications=new a6(this.peerId),this.started=!1}isStarted(){return this.started}get peerId(){return this._libp2p.peerId}async _receiveMessage(e,t){try{await this.engine.messageReceived(e,t)}catch(uS){this._log("failed to receive message",t)}if(0===t.blocks.size)return;const n=[];for(const[r,s]of t.blocks.entries()){const e=Lt.parse(r);n.push({wasWanted:this.wm.wantlist.contains(e),cid:e,data:s})}this.wm.cancelWants(n.filter((({wasWanted:e})=>e)).map((({cid:e})=>e))),await Promise.all(n.map((({cid:t,wasWanted:n,data:r})=>this._handleReceivedBlock(e,t,r,n))))}async _handleReceivedBlock(e,t,n,r){this._log("received block");const s=await this.blockstore.has(t);this._updateReceiveCounters(e.toString(),t,n,s),r&&await this.put(t,n)}_updateReceiveCounters(e,t,n,r){this._stats.push(e,"blocksReceived",1),this._stats.push(e,"dataReceived",n.length),r&&(this._stats.push(e,"dupBlksReceived",1),this._stats.push(e,"dupDataReceived",n.length))}_receiveError(e){this._log.error("ReceiveError: %s",e.message)}_onPeerConnected(e){this.wm.connected(e)}_onPeerDisconnected(e){this.wm.disconnected(e),this.engine.peerDisconnected(e),this._stats.disconnected(e)}enableStats(){this._stats.enable()}disableStats(){this._stats.disable()}wantlistForPeer(e,t){return this.engine.wantlistForPeer(e)}ledgerForPeer(e){return this.engine.ledgerForPeer(e)}async get(e,t={}){const n=(e,t)=>(this.wm.wantBlocks([e],t),this.notifications.wantBlock(e,t));let r=!1;const s=async(e,t)=>{try{const n=await this.blockstore.get(e,t);return n}catch(uS){if("ERR_NOT_FOUND"!==uS.code)throw uS;return r||(r=!0,this.network.findAndConnect(e,t).catch((e=>this._log.error(e)))),n(e,t)}},i=new AbortController,o=t.signal?(0,al.anySignal)([t.signal,i.signal]):i.signal;try{const t=await Promise.race([this.notifications.wantBlock(e,{signal:o}),s(e,{signal:o})]);return t}finally{i.abort()}}async*getMany(e,t={}){for await(const n of e)yield this.get(n,t)}unwant(e){const t=Array.isArray(e)?e:[e];this.wm.unwantBlocks(t),t.forEach((e=>this.notifications.unwantBlock(e)))}cancelWants(e){this.wm.cancelWants(Array.isArray(e)?e:[e])}async put(e,t,n){await this.blockstore.put(e,t),this._sendHaveBlockNotifications(e,t)}async*putMany(e,t){for await(const{key:n,value:r}of this.blockstore.putMany(e,t))this._sendHaveBlockNotifications(n,r),yield{key:n,value:r}}_sendHaveBlockNotifications(e,t){this.notifications.hasBlock(e,t),this.engine.receivedBlocks([{cid:e,data:t}]),this.network.provide(e).catch((e=>{this._log.error("Failed to provide: %s",e.message)}))}getWantlist(){return this.wm.wantlist.entries()}peers(){return this.engine.peers()}stat(){return this._stats}async start(){this.wm.start(),await this.network.start(),this.engine.start(),this.started=!0}async stop(){this._stats.stop(),this.wm.stop(),await this.network.stop(),this.engine.stop(),this.started=!1}unwrap(){return this.blockstore}}const g6=(e,t,n={})=>new f6(e,t,n);function m6(e){return e=e||new Error("Not Found"),je(e,"ERR_NOT_FOUND")}function y6(e){return e=e||new Error("Aborted"),je(e,"ERR_ABORTED")}class w6 extends NP{constructor(e,t){super(),this.child=e,this.bitswap=t}open(){return this.child.open()}close(){return this.child.close()}unwrap(){return this.child}async put(e,t,n={}){await this.has(e)||(this.bitswap.isStarted()?await this.bitswap.put(e,t,n):await this.child.put(e,t,n))}async*putMany(e,t={}){const n=em(e,(async({key:e})=>!await this.has(e)));this.bitswap.isStarted()?yield*this.bitswap.putMany(n,t):yield*this.child.putMany(n,t)}async get(e,t={}){return!await this.has(e)&&this.bitswap.isStarted()?this.bitswap.get(e,t):this.child.get(e,t)}async*getMany(e,t={}){const n=im({objectMode:!0}),r=im({objectMode:!0});Promise.resolve().then((async()=>{for await(const t of e)!await this.has(t)&&this.bitswap.isStarted()?n.push(t):r.push(t);n.end(),r.end()})),yield*gm(this.bitswap.getMany(n,t),this.child.getMany(r,t))}async delete(e,t){await this.child.delete(e,t)}async*deleteMany(e,t){yield*this.child.deleteMany(e,t)}async has(e,t={}){return this.child.has(e,t)}async*query(e,t={}){yield*this.child.query(e,t)}async*queryKeys(e,t={}){yield*this.child.queryKeys(e,t)}}class b6{constructor(e,t,n,r,s){this.peerId=e,this.libp2p=t,this.bitswap=n,this.repo=r,this.blockstore=s}static async start({peerId:e,repo:t,print:n,hashers:r,options:s}){t.closed&&await t.open();const i=await t.config.getAll(),o=await n3({options:s,repo:t,peerId:e,multiaddrs:v6(e,i),config:i,keychainConfig:void 0});await o.start();for(const l of o.getMultiaddrs())n(`Swarm listening on ${l.toString()}`);const a=g6(o,t.blocks,{statsEnabled:!0,hashLoader:r,maxInboundStreams:1024,maxOutboundStreams:1024});await a.start();const c=new w6(t.blocks,a);return t.blocks=c,t.pins.blockstore=c,new b6(e,o,a,t,c)}static async stop(e){e.repo.blocks=e.blockstore.unwrap(),e.repo.pins.blockstore=e.blockstore.unwrap(),await e.bitswap.stop(),await e.libp2p.stop()}}const v6=(e,t)=>{const n=e.toString(),r=[],s=t.Addresses&&t.Addresses.Swarm||[];for(const i of s){let e=dc(i);if(e.protoCodes().includes(E6))throw je(new Error("websocket-star swarm addresses are not supported. See https://github.com/ipfs/js-ipfs/issues/2779"),"ERR_WEBSOCKET_STAR_SWARM_ADDR_NOT_SUPPORTED");const t=e.getPeerId();t&&t!==n&&(e=e.encapsulate(`/p2p/${n}`)),r.push(e)}return r},E6=479;function _6({network:e}){async function t(t={}){const n=[],{libp2p:r}=await e.use(t);return await r.peerStore.forEach((e=>{n.push({id:e.id,addrs:e.addresses.map((e=>e.multiaddr))})})),n}return pl(t)}function S6({network:e}){async function t(t,n={}){const{libp2p:r}=await e.use(n);await r.dial(t,n)}return pl(t)}function k6({network:e}){async function t(t,n={}){const{libp2p:r}=await e.use(n);await r.hangUp(t)}return pl(t)}function A6({network:e}){async function t(t={}){const{libp2p:n}=await e.use(t);return n.getMultiaddrs()}return pl(t)}function T6({network:e}){async function t(t={}){const{libp2p:n}=await e.use(t);if(t.verbose){const e=[];for(const r of n.getConnections()){const n={addr:r.remoteAddr,peer:r.remotePeer};(t.verbose||t.direction)&&(n.direction=r.stat.direction),t.verbose&&(n.muxer=r.stat.multiplexer,n.latency="n/a",n.streams=[]),e.push(n)}return e}const r=new Map;for(const e of n.getConnections()){const t={addr:e.remoteAddr,peer:e.remotePeer};r.set(e.remotePeer.toString(),t)}return Array.from(r.values())}return pl(t)}class C6{constructor({network:e}){this.addrs=_6({network:e}),this.connect=S6({network:e}),this.disconnect=k6({network:e}),this.localAddrs=A6({network:e}),this.peers=T6({network:e})}}const I6={success:!0,time:0,text:""};function R6({network:e}){async function*t(t,n={}){const{libp2p:r}=await e.use();n.count=n.count||10;const s=await r.peerStore.get(t);let i=s&&s.id;if(!i){yield{...I6,text:`Looking up peer ${t}`};const e=await r.peerRouting.findPeer(t);i=e&&e.id}if(!i)throw new Error("Peer was not found");yield{...I6,text:`PING ${i.toString()}`};let o=0,a=0;for(let e=0;e<n.count;e++)try{const e=await r.ping(i);a+=e,o++,yield{...I6,time:e}}catch(uS){yield{...I6,success:!1,text:uS.toString()}}if(o){const e=a/o;yield{...I6,text:`Average latency: ${e}ms`}}}return pl(t)}const O6="/ipns/";function x6(e){let t;if(e.startsWith(O6)&&(e=e.substring(O6.length)),"1"!==e[0]&&"Q"!==e[0]||(e=`z${e}`),"z"===e[0]&&(t=Ae.decode(e)),"k"===e[0]&&(t=no.decode(e)),!t)throw new Error("Could not parse string");if(1!==t[0]&&114!==t[1]&&(t=ya([[1,114],t])),40!==t.length)throw new Error("Incorrect length "+t.length);return ya([$o(O6),t.subarray(2)])}function N6({network:e,repo:t,peerId:n}){const{get:r,put:s,findProvs:i,findPeer:o,provide:a,query:c}={async*get(t,r={}){const{libp2p:s}=await D6(e,n,r),i=t instanceof Uint8Array?t:x6(t);if(null==s.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.get(i,r)},async*put(t,r,s){const{libp2p:i}=await D6(e,n,s),o=t instanceof Uint8Array?t:x6(t);if(null==i.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.put(o,r,s)},async*findProvs(t,r={}){const{libp2p:s}=await D6(e,n,r);if(null==s.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.findProviders(t,{signal:r.signal})},async*findPeer(t,r={}){const{libp2p:s}=await D6(e,n,r);if(null==s.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.findPeer(t,{signal:r.signal})},async*provide(r,s={recursive:!1}){const{libp2p:i}=await D6(e,n,s),o=await t.blocks.has(r);if(!o)throw je(new Error("block(s) not found locally, cannot provide"),"ERR_BLOCK_NOT_FOUND");if(s.recursive)throw je(new Error("not implemented yet"),"ERR_NOT_IMPLEMENTED_YET");if(null==i.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*i.dht.provide(r)},async*query(t,r={}){const{libp2p:s}=await D6(e,n,r);let i;const o=Lt.asCID(t);if(i=null!=o?o.multihash.bytes:Fu(t.toString()).toBytes(),null==s.dht)throw je(new Error("dht not configured"),"ERR_DHT_NOT_CONFIGURED");yield*s.dht.getClosestPeers(i,r)}};return{get:pl(r),put:pl(s),findProvs:pl(i),findPeer:pl(o),provide:pl(a),query:pl(c)}}const D6=async(e,t,n)=>{const r=await e.use(n);if(null!=r.libp2p.dht)return r;{const e=async function*(){yield{from:t,name:"QUERY_ERROR",type:3,error:new Po("dht not enabled")}};return{libp2p:{dht:{get:e,put:e,findProviders:e,findPeer:e,provide:e,getClosestPeers:e}}}}};function P6({network:e,config:t}){const n=um(t||{},"Pubsub.Enabled",!0),r={};let s;return{subscribe:n?pl(i):L6,unsubscribe:n?pl(o):L6,publish:n?pl(a):L6,ls:n?pl(c):L6,peers:n?pl(l):L6};async function i(t,n,i={}){const{libp2p:o}=await e.use(i);o.pubsub.subscribe(t),null==s&&(s=e=>{const t=e.detail;r[t.topic]&&r[t.topic].forEach((e=>{"function"!==typeof e?null!=e&&null!=e.handleEvent&&e.handleEvent(t):e(t)}))},o.pubsub.addEventListener("message",s)),null!=n&&(null==r[t]&&(r[t]=[]),r[t].push(n))}async function o(t,n,i={}){const{libp2p:o}=await e.use(i);null!=n&&null!=r[t]&&(r[t]=r[t].filter((e=>e!==n)),0===r[t].length&&delete r[t]),"function"!==typeof n&&delete r[t],null==r[t]&&o.pubsub.unsubscribe(t),0===Object.keys(r).length&&(o.pubsub.removeEventListener("message",s),s=void 0)}async function a(t,n,r={}){const{libp2p:s}=await e.use(r);if(!n)throw je(new Error('argument "data" is required'),"ERR_ARG_REQUIRED");await s.pubsub.publish(t,n)}async function c(t={}){const{libp2p:n}=await e.use(t);return n.pubsub.getTopics()}async function l(t,n={}){const{libp2p:r}=await e.use(n);return r.pubsub.getSubscribers(t)}}const L6=async()=>{throw new Po("pubsub not enabled")},M6=ne.bind({ignoreUndefined:!0}),B6=Fe("ipfs"),U6=3e4;class V6{constructor({print:e,storage:t,codecs:n,options:r}){const{peerId:s,repo:i,keychain:o}=t,a=Tl.create(b6),c=CI(r.preload),l=Tu(),u=Cu({network:a}),h=new Vm(r),d=Object.values(Ao);(r.ipld&&r.ipld.hashers?r.ipld.hashers:[]).forEach((e=>d.push(e))),this.hashers=new Pj({hashers:d,loadHasher:r.ipld&&r.ipld.loadHasher});const p=Object.values(ko);(r.ipld&&r.ipld.bases?r.ipld.bases:[]).forEach((e=>p.push(e))),this.bases=new Oj({bases:p,loadBase:r.ipld&&r.ipld.loadBase});const f=new nh({repo:i,codecs:n}),g=new Dy({codecs:n,hashers:this.hashers,preload:c,repo:i}),m=new Zm({dns:l,ipns:h,repo:i,codecs:n,peerId:s,isOnline:u,keychain:o,options:r}),y=Hu({repo:i,codecs:n,bases:this.bases,name:m}),w=new mI({repo:i,codecs:n,hashers:this.hashers,preload:c}),b=Object.assign(ny({repo:i,codecs:n,resolve:y,preload:c}),{local:ly({repo:t.repo})}),{add:v,addAll:E,cat:_,get:S,ls:k}=new nC({preload:c,repo:i,options:r.EXPERIMENTAL,hashers:this.hashers}),A=ZO({repo:i,preload:c,hashers:this.hashers,options:r}),T=RI({files:A,preload:c,options:r.preload});this.preload=c,this.name=m,this.ipns=h,this.pin=f,this.resolve=y,this.block=g,this.refs=b,this.start=Cl({network:a,peerId:s,repo:i,preload:c,ipns:h,mfsPreload:T,print:e,keychain:o,hashers:this.hashers,options:r}),this.stop=Il({network:a,preload:c,mfsPreload:T,ipns:h,repo:i}),this.dht=N6({network:a,repo:i,peerId:s}),this.pubsub=P6({network:a,config:r.config}),this.dns=l,this.isOnline=u,this.id=cC({network:a,peerId:s}),this.version=oC({repo:i}),this.bitswap=new fy({network:a}),this.bootstrap=new _y({repo:i}),this.config=mC({repo:i}),this.ping=R6({network:a}),this.add=v,this.addAll=E,this.cat=_,this.get=S,this.ls=k,this.dag=w,this.files=A,this.key=new lx({keychain:o}),this.object=new _x({preload:c,codecs:n,repo:i}),this.repo=new Ix({repo:i,hashers:this.hashers}),this.stats=new xx({repo:i,network:a}),this.swarm=new C6({network:a}),Object.defineProperty(this,"libp2p",{get(){const e=a.try();return e?e.libp2p:void 0}});const C=()=>Promise.reject(je(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")),I=async function*(){throw je(new Error("Not implemented"),"ERR_NOT_IMPLEMENTED")};this.commands=C,this.diag={cmds:C,net:C,sys:C},this.log={level:C,ls:C,tail:I},this.mount=C,this.codecs=n}async init(){throw new Oo}}const F6=async e=>{const t=bn({Data:new tt({type:"directory"}).marshal(),Links:[]}),n=await e.block.put(t,{mhtype:"sha2-256",format:"dag-pb"});return await e.pin.add(n),n},j6=()=>({start:!0,EXPERIMENTAL:{},preload:{enabled:!re.isTest,addresses:["/dns4/node0.preload.ipfs.io/https","/dns4/node1.preload.ipfs.io/https","/dns4/node2.preload.ipfs.io/https","/dns4/node3.preload.ipfs.io/https"]}});async function z6(e={}){e=M6(j6(),e);const t=e.init||{},n={name:Yi.name,code:Yi.code,encode:e=>e,decode:e=>e},r=Object.values(To);[o,a,c,l,n].concat(e.ipld&&e.ipld.codecs||[]).forEach((e=>r.push(e)));const s=new Nj({codecs:r,loadCodec:e.ipld&&e.ipld.loadCodec}),i=e.silent?B6:console.log;B6("creating repo");const u=await o3.start(i,s,e);B6("getting repo config");const h=await u.repo.config.getAll(),d=new V6({storage:u,print:i,codecs:s,options:{...e,config:h}});if(B6("starting preload"),await d.preload.start(),B6("starting storage"),d.ipns.startOffline(u),u.isNew&&!t.emptyRepo){const e=await F6(d);if(B6("adding default assets"),await Co({addAll:d.addAll,print:i}),B6("initializing IPNS keyspace"),null==u.peerId.publicKey)throw je(new Error("Public key missing"),"ERR_MISSING_PUBLIC_KEY");const t=new Ho.TimeoutController(U6);try{await d.ipns.initializeKeyspace(u.peerId,$o(`/ipfs/${e}`),{signal:t.signal})}finally{t.clear()}}return!1!==e.start&&(B6("starting node"),await d.start()),d}n(5057);const $6=z6},7601:function(e,t,n){"use strict";n.d(t,{Ui:function(){return Dt}});n(3767),n(8585),n(8696),n(7658),n(2801);var r=n(3248);function s(e){return e||(e={}),{delay:void 0===e.delay?200:e.delay,initialDelay:void 0===e.initialDelay?0:e.initialDelay,minDelay:void 0===e.minDelay?0:e.minDelay,maxDelay:void 0===e.maxDelay?0:e.maxDelay,factor:void 0===e.factor?0:e.factor,maxAttempts:void 0===e.maxAttempts?3:e.maxAttempts,timeout:void 0===e.timeout?0:e.timeout,jitter:!0===e.jitter,handleError:void 0===e.handleError?null:e.handleError,handleTimeout:void 0===e.handleTimeout?null:e.handleTimeout,beforeAttempt:void 0===e.beforeAttempt?null:e.beforeAttempt,calculateDelay:void 0===e.calculateDelay?null:e.calculateDelay}}async function i(e){return new Promise(((t,n)=>{setTimeout(t,e)}))}function o(e,t){let n=t.delay;if(0===n)return 0;if(t.factor&&(n*=Math.pow(t.factor,e.attemptNum-1),0!==t.maxDelay&&(n=Math.min(n,t.maxDelay))),t.jitter){const e=Math.ceil(t.minDelay),r=Math.floor(n);n=Math.floor(Math.random()*(r-e+1))+e}return Math.round(n)}async function a(e,t){const n=s(t);for(const s of["delay","initialDelay","minDelay","maxDelay","maxAttempts","timeout"]){const e=n[s];if(!Number.isInteger(e)||e<0)throw new Error(`Value for ${s} must be an integer greater than or equal to 0`)}if(n.factor.constructor!==Number||n.factor<0)throw new Error("Value for factor must be a number greater than or equal to 0");if(n.delay<n.minDelay)throw new Error(`delay cannot be less than minDelay (delay: ${n.delay}, minDelay: ${n.minDelay}`);const r={attemptNum:0,attemptsRemaining:n.maxAttempts?n.maxAttempts:-1,aborted:!1,abort(){r.aborted=!0}},a=n.calculateDelay||o;async function c(){if(n.beforeAttempt&&n.beforeAttempt(r,n),r.aborted){const e=new Error("Attempt aborted");throw e.code="ATTEMPT_ABORTED",e}const t=async e=>{if(n.handleError&&await n.handleError(e,r,n),r.aborted||0===r.attemptsRemaining)throw e;r.attemptNum++;const t=a(r,n);return t&&await i(t),c()};return r.attemptsRemaining>0&&r.attemptsRemaining--,n.timeout?new Promise(((s,i)=>{const o=setTimeout((()=>{if(n.handleTimeout)try{s(n.handleTimeout(r,n))}catch(e){i(e)}else{const e=new Error(`Retry timeout (attemptNum: ${r.attemptNum}, timeout: ${n.timeout})`);e.code="ATTEMPT_TIMEOUT",i(e)}}),n.timeout);e(r,n).then((e=>{clearTimeout(o),s(e)})).catch((e=>{clearTimeout(o),t(e).then(s).catch(i)}))})):e(r,n).catch(t)}const l=n.calculateDelay?n.calculateDelay(r,n):n.initialDelay;return l&&await i(l),c()}const c=e=>e.toLowerCase(),l=/^\s*/g,u=e=>e.replace(l,""),h=/([A-Z])/g,d=(e,t)=>u(e.replace(h,(e=>`${t}${c(e)}`)));"undefined"!==typeof TextEncoder&&new TextEncoder;let p="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});p&&1===p.decode(new Uint8Array).length&&(p=null);const f=()=>new Map,g=e=>void 0===e?null:e;class m{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let y=new m,w=!0;try{"undefined"!==typeof localStorage&&(y=localStorage,w=!1)}catch(Pt){}const b=y,v="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name);let E;"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);const _=()=>{if(void 0===E)if(v){E=f();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];"-"===r[0]?(null!==t&&E.set(t,""),t=r):null!==t&&(E.set(t,r),t=null)}null!==t&&E.set(t,"")}else"object"===typeof location?(E=f(),(location.search||"?").slice(1).split("&").forEach((e=>{if(0!==e.length){const[t,n]=e.split("=");E.set(`--${d(t,"-")}`,n),E.set(`-${d(t,"-")}`,n)}}))):E=f();return E},S=e=>_().has(e),k=e=>g(v?{NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}[e.toUpperCase()]:b.getItem(e)),A=e=>S("--"+e)||null!==k(e);A("production");const T=128,C=127,I=e=>e.arr[e.pos++],R=e=>{let t=0,n=0;while(1){const r=e.arr[e.pos++];if(t|=(r&C)<<n,n+=7,r<T)return t>>>0;if(n>35)throw new Error("Integer out of range!")}},O=e=>{let t=R(e);if(0===t)return"";{let n=String.fromCodePoint(I(e));if(--t<100)while(t--)n+=String.fromCodePoint(I(e));else while(t>0){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},x=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},N=(e,t)=>{while(t>C)x(e,T|C&t),t>>>=7;x(e,C&t)},D=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;N(e,r);for(let s=0;s<r;s++)x(e,n.codePointAt(s))};var P;(function(e){e[e["Token"]=0]="Token",e[e["PermissionDenied"]=1]="PermissionDenied",e[e["Authenticated"]=2]="Authenticated"})(P||(P={}));const L=(e,t)=>{N(e,P.Token),D(e,t)},M=(e,t,n)=>{switch(R(e)){case P.PermissionDenied:t(O(e));break;case P.Authenticated:n();break}},B={code:4401,reason:"Unauthorized"},U={code:4403,reason:"Forbidden"},V=e=>Array.from(e.entries()).map((([e,t])=>({clientId:e,...t})));var F;(function(e){e[e["Connecting"]=0]="Connecting",e[e["Open"]=1]="Open",e[e["Closing"]=2]="Closing",e[e["Closed"]=3]="Closed"})(F||(F={}));const j=()=>new Map,z=(e,t,n)=>{let r=e.get(t);return void 0===r&&e.set(t,r=n()),r},$=String.fromCharCode,H=e=>e.toLowerCase(),K=/^\s*/g,q=e=>e.replace(K,""),G=/([A-Z])/g,W=(e,t)=>q(e.replace(G,(e=>`${t}${H(e)}`)));"undefined"!==typeof TextEncoder&&new TextEncoder;let Y="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});Y&&1===Y.decode(new Uint8Array).length&&(Y=null);const J=e=>void 0===e?null:e;class Q{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let X=new Q,Z=!0;try{"undefined"!==typeof localStorage&&(X=localStorage,Z=!1)}catch(Pt){}const ee=X,te=e=>Z||addEventListener("storage",e),ne="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name),re="undefined"!==typeof window&&!ne;let se;"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);const ie=()=>{if(void 0===se)if(ne){se=j();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];"-"===r[0]?(null!==t&&se.set(t,""),t=r):null!==t&&(se.set(t,r),t=null)}null!==t&&se.set(t,"")}else"object"===typeof location?(se=j(),(location.search||"?").slice(1).split("&").forEach((e=>{if(0!==e.length){const[t,n]=e.split("=");se.set(`--${W(t,"-")}`,n),se.set(`-${W(t,"-")}`,n)}}))):se=j();return se},oe=e=>ie().has(e),ae=e=>J(ne?{NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}[e.toUpperCase()]:ee.getItem(e)),ce=e=>oe("--"+e)||null!==ae(e);ce("production");const le=Math.floor,ue=(e,t)=>e<t?e:t,he=(e,t)=>e>t?e:t,de=128,pe=127;class fe{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const ge=()=>new fe,me=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},ye=e=>{const t=new Uint8Array(me(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(xe(e.cbuf.buffer,0,e.cpos),n),t},we=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},be=(e,t)=>{while(t>pe)we(e,de|pe&t),t>>>=7;we(e,pe&t)},ve=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;be(e,r);for(let s=0;s<r;s++)we(e,n.codePointAt(s))},Ee=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=ue(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(he(2*n,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},_e=(e,t)=>{be(e,t.byteLength),Ee(e,t)};class Se{constructor(e){this.arr=e,this.pos=0}}const ke=e=>new Se(e),Ae=(e,t)=>{const n=xe(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},Te=e=>Ae(e,Ie(e)),Ce=e=>e.arr[e.pos++],Ie=e=>{let t=0,n=0;while(1){const r=e.arr[e.pos++];if(t|=(r&pe)<<n,n+=7,r<de)return t>>>0;if(n>35)throw new Error("Integer out of range!")}},Re=e=>{let t=Ie(e);if(0===t)return"";{let n=String.fromCodePoint(Ce(e));if(--t<100)while(t--)n+=String.fromCodePoint(Ce(e));else while(t>0){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},Oe=e=>new Uint8Array(e),xe=(e,t,n)=>new Uint8Array(e,t,n),Ne=e=>new Uint8Array(e),De=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=$(e[n]);return btoa(t)},Pe=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),Le=e=>{const t=atob(e),n=Oe(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},Me=e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},Be=re?De:Pe,Ue=re?Le:Me,Ve=new Map;class Fe{constructor(e){this.room=e,this.onmessage=null,te((t=>t.key===e&&null!==this.onmessage&&this.onmessage({data:Ue(t.newValue||"")})))}postMessage(e){ee.setItem(this.room,Be(Ne(e)))}}const je="undefined"===typeof BroadcastChannel?Fe:BroadcastChannel,ze=e=>z(Ve,e,(()=>{const t=new Set,n=new je(e);return n.onmessage=e=>t.forEach((t=>t(e.data))),{bc:n,subs:t}})),$e=(e,t)=>ze(e).subs.add(t),He=(e,t)=>ze(e).subs.delete(t),Ke=(e,t)=>{const n=ze(e);n.bc.postMessage(t),n.subs.forEach((e=>e(t)))},qe=Date.now,Ge=()=>new Set,We=Array.from;class Ye{constructor(){this._observers=j()}on(e,t){z(this._observers,e,Ge).add(t)}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return We((this._observers.get(e)||j()).values()).forEach((e=>e(...t)))}destroy(){this._observers=j()}}const Je=Object.keys,Qe=(e,t)=>{const n=[];for(const r in e)n.push(t(e[r],r));return n},Xe=e=>Je(e).length,Ze=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),et=(e,t)=>e===t,tt=(e,t)=>{if(null==e||null==t)return et(e,t);if(e.constructor!==t.constructor)return!1;if(e===t)return!0;switch(e.constructor){case ArrayBuffer:e=new Uint8Array(e),t=new Uint8Array(t);case Uint8Array:if(e.byteLength!==t.byteLength)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;break;case Set:if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;break;case Map:if(e.size!==t.size)return!1;for(const n of e.keys())if(!t.has(n)||!tt(e.get(n),t.get(n)))return!1;break;case Object:if(Xe(e)!==Xe(t))return!1;for(const n in e)if(!Ze(e,n)||!tt(e[n],t[n]))return!1;break;case Array:if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!tt(e[n],t[n]))return!1;break;default:return!1}return!0},nt=3e4;class rt extends Ye{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval((()=>{const e=qe();null!==this.getLocalState()&&nt/2<=e-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const t=[];this.meta.forEach(((n,r)=>{r!==this.clientID&&nt<=e-n.lastUpdated&&this.states.has(r)&&t.push(r)})),t.length>0&&st(this,t,"timeout")}),le(nt/10)),e.on("destroy",(()=>{this.destroy()})),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const t=this.clientID,n=this.meta.get(t),r=void 0===n?0:n.clock+1,s=this.states.get(t);null===e?this.states.delete(t):this.states.set(t,e),this.meta.set(t,{clock:r,lastUpdated:qe()});const i=[],o=[],a=[],c=[];null===e?c.push(t):null==s?null!=e&&i.push(t):(o.push(t),tt(s,e)||a.push(t)),(i.length>0||a.length>0||c.length>0)&&this.emit("change",[{added:i,updated:a,removed:c},"local"]),this.emit("update",[{added:i,updated:o,removed:c},"local"])}setLocalStateField(e,t){const n=this.getLocalState();null!==n&&this.setLocalState({...n,[e]:t})}getStates(){return this.states}}const st=(e,t,n)=>{const r=[];for(let s=0;s<t.length;s++){const n=t[s];if(e.states.has(n)){if(e.states.delete(n),n===e.clientID){const t=e.meta.get(n);e.meta.set(n,{clock:t.clock+1,lastUpdated:qe()})}r.push(n)}}r.length>0&&(e.emit("change",[{added:[],updated:[],removed:r},n]),e.emit("update",[{added:[],updated:[],removed:r},n]))},it=(e,t,n=e.states)=>{const r=t.length,s=ge();be(s,r);for(let i=0;i<r;i++){const r=t[i],o=n.get(r)||null,a=e.meta.get(r).clock;be(s,r),be(s,a),ve(s,JSON.stringify(o))}return ye(s)},ot=(e,t,n)=>{const r=ke(t),s=qe(),i=[],o=[],a=[],c=[],l=Ie(r);for(let u=0;u<l;u++){const t=Ie(r);let n=Ie(r);const l=JSON.parse(Re(r)),u=e.meta.get(t),h=e.states.get(t),d=void 0===u?0:u.clock;(d<n||d===n&&null===l&&e.states.has(t))&&(null===l?t===e.clientID&&null!=e.getLocalState()?n++:e.states.delete(t):e.states.set(t,l),e.meta.set(t,{clock:n,lastUpdated:s}),void 0===u&&null!==l?i.push(t):void 0!==u&&null===l?c.push(t):null!==l&&(tt(l,h)||a.push(t),o.push(t)))}(i.length>0||a.length>0||c.length>0)&&e.emit("change",[{added:i,updated:a,removed:c},n]),(i.length>0||o.length>0||c.length>0)&&e.emit("update",[{added:i,updated:o,removed:c},n])},at=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else void 0!==n&&n()}},ct=e=>Qe(e,((e,t)=>`${encodeURIComponent(t)}=${encodeURIComponent(e)}`)).join("&");class lt{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}class ut{constructor(e){this.data=e,this.encoder=ge(),this.decoder=ke(new Uint8Array(this.data))}readVarUint(){return Ie(this.decoder)}readVarUint8Array(){return Te(this.decoder)}writeVarUint(e){return be(this.encoder,e)}writeVarUint8Array(e){return _e(this.encoder,e)}length(){return me(this.encoder)}}const ht=0,dt=1,pt=2,ft=(e,t)=>{be(e,ht);const n=r.gJ(t);_e(e,n)},gt=(e,t,n)=>{be(e,dt),_e(e,r.D$(t,n))},mt=(e,t,n)=>gt(t,n,Te(e)),yt=(e,t,n)=>{try{r.NG(t,Te(e),n)}catch(s){console.error("Caught error while handling a Yjs update",s)}},wt=(e,t)=>{be(e,pt),_e(e,t)},bt=yt,vt=(e,t,n,r)=>{const s=Ie(e);switch(s){case ht:mt(e,t,n);break;case dt:yt(e,n,r);break;case pt:bt(e,n,r);break;default:throw new Error("Unknown message type")}return s};var Et,_t;(function(e){e[e["Sync"]=0]="Sync",e[e["Awareness"]=1]="Awareness",e[e["Auth"]=2]="Auth",e[e["QueryAwareness"]=3]="QueryAwareness",e[e["Stateless"]=5]="Stateless"})(Et||(Et={})),function(e){e["Connecting"]="connecting",e["Connected"]="connected",e["Disconnected"]="disconnected"}(_t||(_t={}));class St{constructor(){this.encoder=ge()}get(e){return e.encoder}toUint8Array(){return ye(this.encoder)}}class kt{constructor(e){this.broadcasted=!1,this.message=e}setBroadcasted(e){return this.broadcasted=e,this}apply(e,t=!0){const{message:n}=this,r=n.readVarUint();switch(r){case Et.Sync:this.applySyncMessage(e,t);break;case Et.Awareness:this.applyAwarenessMessage(e);break;case Et.Auth:this.applyAuthMessage(e);break;case Et.QueryAwareness:this.applyQueryAwarenessMessage(e);break;case Et.Stateless:e.receiveStateless(Re(n.decoder));break;default:throw new Error(`Can’t apply message of unknown type: ${r}`)}n.length()>1&&(this.broadcasted?e.broadcast(St,{encoder:n.encoder}):e.send(St,{encoder:n.encoder}))}applySyncMessage(e,t){const{message:n}=this;n.writeVarUint(Et.Sync);const r=vt(n.decoder,n.encoder,e.document,e);t&&r===dt&&(e.synced=!0),r!==pt&&r!==dt||e.unsyncedChanges>0&&(e.unsyncedChanges-=1)}applyAwarenessMessage(e){const{message:t}=this;ot(e.awareness,t.readVarUint8Array(),e)}applyAuthMessage(e){const{message:t}=this;M(t.decoder,e.permissionDeniedHandler.bind(e),e.authenticatedHandler.bind(e))}applyQueryAwarenessMessage(e){const{message:t}=this;t.writeVarUint(Et.Awareness),t.writeVarUint8Array(it(e.awareness,Array.from(e.awareness.getStates().keys())))}}class At{constructor(e,t={}){this.message=new e,this.encoder=this.message.get(t)}create(){return ye(this.encoder)}send(e){null===e||void 0===e||e.send(this.create())}broadcast(e){Ke(e,this.create())}}class Tt extends St{constructor(){super(...arguments),this.type=Et.Sync,this.description="First sync step"}get(e){if("undefined"===typeof e.document)throw new Error("The sync step one message requires document as an argument");return be(this.encoder,this.type),ft(this.encoder,e.document),this.encoder}}class Ct extends St{constructor(){super(...arguments),this.type=Et.Sync,this.description="Second sync step"}get(e){if("undefined"===typeof e.document)throw new Error("The sync step two message requires document as an argument");return be(this.encoder,this.type),gt(this.encoder,e.document),this.encoder}}class It extends St{constructor(){super(...arguments),this.type=Et.QueryAwareness,this.description="Queries awareness states"}get(e){return be(this.encoder,this.type),this.encoder}}class Rt extends St{constructor(){super(...arguments),this.type=Et.Auth,this.description="Authentication"}get(e){if("undefined"===typeof e.token)throw new Error("The authentication message requires `token` as an argument.");return be(this.encoder,this.type),L(this.encoder,e.token),this.encoder}}class Ot extends St{constructor(){super(...arguments),this.type=Et.Awareness,this.description="Awareness states update"}get(e){if("undefined"===typeof e.awareness)throw new Error("The awareness message requires awareness as an argument");if("undefined"===typeof e.clients)throw new Error("The awareness message requires clients as an argument");let t;return be(this.encoder,this.type),t=void 0===e.states?it(e.awareness,e.clients):it(e.awareness,e.clients,e.states),_e(this.encoder,t),this.encoder}}class xt extends St{constructor(){super(...arguments),this.type=Et.Sync,this.description="A document update"}get(e){return be(this.encoder,this.type),wt(this.encoder,e.update),this.encoder}}class Nt extends St{constructor(){super(...arguments),this.type=Et.Stateless,this.description="A stateless message"}get(e){var t;return be(this.encoder,this.type),ve(this.encoder,null!==(t=e.payload)&&void 0!==t?t:""),this.encoder}}class Dt extends lt{constructor(e){super(),this.configuration={name:"",url:"",document:void 0,awareness:void 0,WebSocketPolyfill:void 0,token:null,parameters:{},connect:!0,broadcast:!0,forceSyncInterval:!1,messageReconnectTimeout:3e4,delay:1e3,initialDelay:0,factor:2,maxAttempts:0,minDelay:1e3,maxDelay:3e4,jitter:!0,timeout:0,onAuthenticated:()=>null,onAuthenticationFailed:()=>null,onOpen:()=>null,onConnect:()=>null,onMessage:()=>null,onOutgoingMessage:()=>null,onStatus:()=>null,onSynced:()=>null,onDisconnect:()=>null,onClose:()=>null,onDestroy:()=>null,onAwarenessUpdate:()=>null,onAwarenessChange:()=>null,onStateless:()=>null,quiet:!1},this.subscribedToBroadcastChannel=!1,this.webSocket=null,this.shouldConnect=!0,this.status=_t.Disconnected,this.isSynced=!1,this.unsyncedChanges=0,this.isAuthenticated=!1,this.lastMessageReceived=0,this.mux=at(),this.intervals={forceSync:null,connectionChecker:null},this.connectionAttempt=null,this.boundConnect=this.connect.bind(this),this.boundBeforeUnload=this.beforeUnload.bind(this),this.boundBroadcastChannelSubscriber=this.broadcastChannelSubscriber.bind(this),this.setConfiguration(e),this.configuration.document=e.document?e.document:new r.QW,this.configuration.awareness=e.awareness?e.awareness:new rt(this.document),this.configuration.WebSocketPolyfill=e.WebSocketPolyfill?e.WebSocketPolyfill:WebSocket,this.on("open",this.configuration.onOpen),this.on("authenticated",this.configuration.onAuthenticated),this.on("authenticationFailed",this.configuration.onAuthenticationFailed),this.on("connect",this.configuration.onConnect),this.on("message",this.configuration.onMessage),this.on("outgoingMessage",this.configuration.onOutgoingMessage),this.on("synced",this.configuration.onSynced),this.on("status",this.configuration.onStatus),this.on("disconnect",this.configuration.onDisconnect),this.on("close",this.configuration.onClose),this.on("destroy",this.configuration.onDestroy),this.on("awarenessUpdate",this.configuration.onAwarenessUpdate),this.on("awarenessChange",this.configuration.onAwarenessChange),this.on("stateless",this.configuration.onStateless),this.awareness.on("update",(()=>{this.emit("awarenessUpdate",{states:V(this.awareness.getStates())})})),this.awareness.on("change",(()=>{this.emit("awarenessChange",{states:V(this.awareness.getStates())})})),this.document.on("update",this.documentUpdateHandler.bind(this)),this.awareness.on("update",this.awarenessUpdateHandler.bind(this)),this.registerEventListeners(),this.intervals.connectionChecker=setInterval(this.checkConnection.bind(this),this.configuration.messageReconnectTimeout/10),this.configuration.forceSyncInterval&&(this.intervals.forceSync=setInterval(this.forceSync.bind(this),this.configuration.forceSyncInterval)),"undefined"!==typeof e.connect&&(this.shouldConnect=e.connect),this.shouldConnect&&this.connect()}setConfiguration(e={}){this.configuration={...this.configuration,...e}}async connect(){if(this.status===_t.Connected)return;this.cancelWebsocketRetry&&(this.cancelWebsocketRetry(),this.cancelWebsocketRetry=void 0),this.unsyncedChanges=0,this.shouldConnect=!0,this.subscribeToBroadcastChannel();const e=()=>{let e=!1;const t=a(this.createWebSocketConnection.bind(this),{delay:this.configuration.delay,initialDelay:this.configuration.initialDelay,factor:this.configuration.factor,maxAttempts:this.configuration.maxAttempts,minDelay:this.configuration.minDelay,maxDelay:this.configuration.maxDelay,jitter:this.configuration.jitter,timeout:this.configuration.timeout,beforeAttempt:t=>{this.shouldConnect&&!e||t.abort()}}).catch((e=>{if(e&&"ATTEMPT_ABORTED"!==e.code)throw e}));return{retryPromise:t,cancelFunc:()=>{e=!0}}},{retryPromise:t,cancelFunc:n}=e();return this.cancelWebsocketRetry=n,t}createWebSocketConnection(){return new Promise(((e,t)=>{this.webSocket&&(this.webSocket.close(),this.webSocket=null);const n=new this.configuration.WebSocketPolyfill(this.url);n.binaryType="arraybuffer",n.onmessage=this.onMessage.bind(this),n.onclose=this.onClose.bind(this),n.onopen=this.onOpen.bind(this),n.onerror=e=>{t(e)},this.webSocket=n,this.synced=!1,this.status=_t.Connecting,this.emit("status",{status:_t.Connecting}),this.connectionAttempt={resolve:e,reject:t}}))}resolveConnectionAttempt(){var e;null===(e=this.connectionAttempt)||void 0===e||e.resolve(),this.connectionAttempt=null,this.status=_t.Connected,this.emit("status",{status:_t.Connected}),this.emit("connect")}stopConnectionAttempt(){this.connectionAttempt=null}rejectConnectionAttempt(){var e;null===(e=this.connectionAttempt)||void 0===e||e.reject(),this.connectionAttempt=null}get document(){return this.configuration.document}get awareness(){return this.configuration.awareness}get hasUnsyncedChanges(){return this.unsyncedChanges>0}checkConnection(){var e;this.status===_t.Connected&&this.lastMessageReceived&&(this.configuration.messageReconnectTimeout>=qe()-this.lastMessageReceived||null===(e=this.webSocket)||void 0===e||e.close())}forceSync(){this.webSocket&&this.send(Tt,{document:this.document})}beforeUnload(){st(this.awareness,[this.document.clientID],"window unload")}registerEventListeners(){"undefined"!==typeof window&&(window.addEventListener("online",this.boundConnect),window.addEventListener("beforeunload",this.boundBeforeUnload))}sendStateless(e){this.send(Nt,{payload:e})}documentUpdateHandler(e,t){t!==this&&(this.unsyncedChanges+=1,this.send(xt,{update:e},!0))}awarenessUpdateHandler({added:e,updated:t,removed:n},r){const s=e.concat(t).concat(n);this.send(Ot,{awareness:this.awareness,clients:s},!0)}permissionDeniedHandler(e){this.emit("authenticationFailed",{reason:e}),this.isAuthenticated=!1,this.shouldConnect=!1}authenticatedHandler(){this.isAuthenticated=!0,this.emit("authenticated"),this.startSync()}get serverUrl(){while("/"===this.configuration.url[this.configuration.url.length-1])return this.configuration.url.slice(0,this.configuration.url.length-1);return this.configuration.url}get url(){const e=ct(this.configuration.parameters);return`${this.serverUrl}/${this.configuration.name}${0===e.length?"":`?${e}`}`}get synced(){return this.isSynced}set synced(e){this.isSynced!==e&&(this.isSynced=e,this.emit("synced",{state:e}),this.emit("sync",{state:e}))}receiveStateless(e){this.emit("stateless",{payload:e})}get isAuthenticationRequired(){return!!this.configuration.token&&!this.isAuthenticated}disconnect(){if(this.shouldConnect=!1,this.disconnectBroadcastChannel(),null!==this.webSocket)try{this.webSocket.close()}catch{}}async onOpen(e){this.emit("open",{event:e}),this.isAuthenticationRequired?this.send(Rt,{token:await this.getToken()}):this.startSync()}async getToken(){if("function"===typeof this.configuration.token){const e=await this.configuration.token();return e}return this.configuration.token}startSync(){this.send(Tt,{document:this.document}),null!==this.awareness.getLocalState()&&this.send(Ot,{awareness:this.awareness,clients:[this.document.clientID]})}send(e,t,n=!1){var r;if(n&&this.mux((()=>{this.broadcast(e,t)})),(null===(r=this.webSocket)||void 0===r?void 0:r.readyState)===F.Open){const n=new At(e,t);this.emit("outgoingMessage",{message:n.message}),n.send(this.webSocket)}}onMessage(e){this.resolveConnectionAttempt(),this.lastMessageReceived=qe();const t=new ut(e.data);this.emit("message",{event:e,message:t}),new kt(t).apply(this)}onClose(e){this.emit("close",{event:e}),this.webSocket=null,this.isAuthenticated=!1,this.synced=!1,this.status===_t.Connected&&(st(this.awareness,Array.from(this.awareness.getStates().keys()).filter((e=>e!==this.document.clientID)),this),this.status=_t.Disconnected,this.emit("status",{status:_t.Disconnected}),this.emit("disconnect",{event:e})),e.code===B.code&&(this.configuration.quiet||console.warn("[HocuspocusProvider] An authentication token is required, but you didn’t send one. Try adding a `token` to your HocuspocusProvider configuration. Won’t try again."),this.shouldConnect=!1),e.code===U.code&&(this.configuration.quiet||console.warn("[HocuspocusProvider] The provided authentication token isn’t allowed to connect to this server. Will try again.")),this.connectionAttempt?this.rejectConnectionAttempt():this.shouldConnect&&this.connect(),this.shouldConnect||this.status!==_t.Disconnected&&(this.status=_t.Disconnected,this.emit("status",{status:_t.Disconnected}),this.emit("disconnect",{event:e}))}destroy(){this.emit("destroy"),this.intervals.forceSync&&clearInterval(this.intervals.forceSync),clearInterval(this.intervals.connectionChecker),st(this.awareness,[this.document.clientID],"provider destroy"),this.stopConnectionAttempt(),this.disconnect(),this.awareness.off("update",this.awarenessUpdateHandler),this.document.off("update",this.documentUpdateHandler),this.removeAllListeners(),"undefined"!==typeof window&&(window.removeEventListener("online",this.boundConnect),window.removeEventListener("beforeunload",this.boundBeforeUnload))}get broadcastChannel(){return`${this.serverUrl}/${this.configuration.name}`}broadcastChannelSubscriber(e){this.mux((()=>{const t=new ut(e);new kt(t).setBroadcasted(!0).apply(this,!1)}))}subscribeToBroadcastChannel(){this.subscribedToBroadcastChannel||($e(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!0),this.mux((()=>{this.broadcast(Tt,{document:this.document}),this.broadcast(Ct,{document:this.document}),this.broadcast(It),this.broadcast(Ot,{awareness:this.awareness,clients:[this.document.clientID]})}))}disconnectBroadcastChannel(){this.send(Ot,{awareness:this.awareness,clients:[this.document.clientID],states:new Map},!0),this.subscribedToBroadcastChannel&&(He(this.broadcastChannel,this.boundBroadcastChannelSubscriber),this.subscribedToBroadcastChannel=!1)}broadcast(e,t){this.configuration.broadcast&&this.subscribedToBroadcastChannel&&new At(e,t).broadcast(this.broadcastChannel)}setAwarenessField(e,t){this.awareness.setLocalStateField(e,t)}}},2066:function(e,t,n){"use strict";n.d(t,{ML:function(){return Tn},hj:function(){return Ie},vc:function(){return xn},NB:function(){return Nn},nU:function(){return se},Nl:function(){return Q},Jo:function(){return Bt},EG:function(){return qt},xh:function(){return Je},Cf:function(){return Cn},K9:function(){return Dn},P1:function(){return te},x2:function(){return In},pr:function(){return Gt},zK:function(){return Rn},S0:function(){return On}});n(7658);var r=n(157),s=n(1460),i=n(203),o=n(1543),a=n(1382);const c=(e,t)=>!e.selection.empty&&(t&&t(e.tr.deleteSelection().scrollIntoView()),!0);function l(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("backward",e):n.parentOffset>0)?null:n}const u=(e,t,n)=>{let s=l(e,n);if(!s)return!1;let i=p(s);if(!i){let n=s.blockRange(),r=n&&(0,a.k9)(n);return null!=r&&(t&&t(e.tr.lift(n,r).scrollIntoView()),!0)}let c=i.nodeBefore;if(!c.type.spec.isolating&&x(e,i,t))return!0;if(0==s.parent.content.size&&(h(c,"end")||r.qv.isSelectable(c))){let n=(0,a.dR)(e.doc,s.before(),s.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(h(c,"end")?r.Y1.findFrom(s.doc.resolve(s.mapping.map(i.pos,-1)),-1):r.qv.create(s.doc,i.pos-c.nodeSize)),t(s.scrollIntoView())}return!0}}return!(!c.isAtom||i.depth!=s.depth-1)&&(t&&t(e.tr.delete(i.pos-c.nodeSize,i.pos).scrollIntoView()),!0)};function h(e,t,n=!1){for(let r=e;r;r="start"==t?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}const d=(e,t,n)=>{let{$head:s,empty:i}=e.selection,o=s;if(!i)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("backward",e):s.parentOffset>0)return!1;o=p(s)}let a=o&&o.nodeBefore;return!(!a||!r.qv.isSelectable(a))&&(t&&t(e.tr.setSelection(r.qv.create(e.doc,o.pos-a.nodeSize)).scrollIntoView()),!0)};function p(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){if(e.index(t)>0)return e.doc.resolve(e.before(t+1));if(e.node(t).type.spec.isolating)break}return null}function f(e,t){let{$cursor:n}=e.selection;return!n||(t?!t.endOfTextblock("forward",e):n.parentOffset<n.parent.content.size)?null:n}const g=(e,t,n)=>{let s=f(e,n);if(!s)return!1;let i=y(s);if(!i)return!1;let c=i.nodeAfter;if(x(e,i,t))return!0;if(0==s.parent.content.size&&(h(c,"start")||r.qv.isSelectable(c))){let n=(0,a.dR)(e.doc,s.before(),s.after(),o.p2.empty);if(n&&n.slice.size<n.to-n.from){if(t){let s=e.tr.step(n);s.setSelection(h(c,"start")?r.Y1.findFrom(s.doc.resolve(s.mapping.map(i.pos)),1):r.qv.create(s.doc,s.mapping.map(i.pos))),t(s.scrollIntoView())}return!0}}return!(!c.isAtom||i.depth!=s.depth-1)&&(t&&t(e.tr.delete(i.pos,i.pos+c.nodeSize).scrollIntoView()),!0)},m=(e,t,n)=>{let{$head:s,empty:i}=e.selection,o=s;if(!i)return!1;if(s.parent.isTextblock){if(n?!n.endOfTextblock("forward",e):s.parentOffset<s.parent.content.size)return!1;o=y(s)}let a=o&&o.nodeAfter;return!(!a||!r.qv.isSelectable(a))&&(t&&t(e.tr.setSelection(r.qv.create(e.doc,o.pos)).scrollIntoView()),!0)};function y(e){if(!e.parent.type.spec.isolating)for(let t=e.depth-1;t>=0;t--){let n=e.node(t);if(e.index(t)+1<n.childCount)return e.doc.resolve(e.after(t+1));if(n.type.spec.isolating)break}return null}const w=(e,t)=>{let n,s=e.selection,i=s instanceof r.qv;if(i){if(s.node.isTextblock||!(0,a.Mn)(e.doc,s.from))return!1;n=s.from}else if(n=(0,a.GJ)(e.doc,s.from,-1),null==n)return!1;if(t){let s=e.tr.join(n);i&&s.setSelection(r.qv.create(s.doc,n-e.doc.resolve(n).nodeBefore.nodeSize)),t(s.scrollIntoView())}return!0},b=(e,t)=>{let n,s=e.selection;if(s instanceof r.qv){if(s.node.isTextblock||!(0,a.Mn)(e.doc,s.to))return!1;n=s.to}else if(n=(0,a.GJ)(e.doc,s.to,1),null==n)return!1;return t&&t(e.tr.join(n).scrollIntoView()),!0},v=(e,t)=>{let{$from:n,$to:r}=e.selection,s=n.blockRange(r),i=s&&(0,a.k9)(s);return null!=i&&(t&&t(e.tr.lift(s,i).scrollIntoView()),!0)},E=(e,t)=>{let{$head:n,$anchor:r}=e.selection;return!(!n.parent.type.spec.code||!n.sameParent(r))&&(t&&t(e.tr.insertText("\n").scrollIntoView()),!0)};function _(e){for(let t=0;t<e.edgeCount;t++){let{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const S=(e,t)=>{let{$head:n,$anchor:s}=e.selection;if(!n.parent.type.spec.code||!n.sameParent(s))return!1;let i=n.node(-1),o=n.indexAfter(-1),a=_(i.contentMatchAt(o));if(!a||!i.canReplaceWith(o,o,a))return!1;if(t){let s=n.after(),i=e.tr.replaceWith(s,s,a.createAndFill());i.setSelection(r.Y1.near(i.doc.resolve(s),1)),t(i.scrollIntoView())}return!0},k=(e,t)=>{let n=e.selection,{$from:s,$to:i}=n;if(n instanceof r.C1||s.parent.inlineContent||i.parent.inlineContent)return!1;let o=_(i.parent.contentMatchAt(i.indexAfter()));if(!o||!o.isTextblock)return!1;if(t){let n=(!s.parentOffset&&i.index()<i.parent.childCount?s:i).pos,a=e.tr.insert(n,o.createAndFill());a.setSelection(r.Bs.create(a.doc,n+1)),t(a.scrollIntoView())}return!0},A=(e,t)=>{let{$cursor:n}=e.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if((0,a.Ax)(e.doc,r))return t&&t(e.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),s=r&&(0,a.k9)(r);return null!=s&&(t&&t(e.tr.lift(r,s).scrollIntoView()),!0)};function T(e){return(t,n)=>{let{$from:s,$to:i}=t.selection;if(t.selection instanceof r.qv&&t.selection.node.isBlock)return!(!s.parentOffset||!(0,a.Ax)(t.doc,s.pos))&&(n&&n(t.tr.split(s.pos).scrollIntoView()),!0);if(!s.parent.isBlock)return!1;if(n){let o=i.parentOffset==i.parent.content.size,c=t.tr;(t.selection instanceof r.Bs||t.selection instanceof r.C1)&&c.deleteSelection();let l=0==s.depth?null:_(s.node(-1).contentMatchAt(s.indexAfter(-1))),u=e&&e(i.parent,o),h=u?[u]:o&&l?[{type:l}]:void 0,d=(0,a.Ax)(c.doc,c.mapping.map(s.pos),1,h);if(h||d||!(0,a.Ax)(c.doc,c.mapping.map(s.pos),1,l?[{type:l}]:void 0)||(l&&(h=[{type:l}]),d=!0),d&&(c.split(c.mapping.map(s.pos),1,h),!o&&!s.parentOffset&&s.parent.type!=l)){let e=c.mapping.map(s.before()),t=c.doc.resolve(e);l&&s.node(-1).canReplaceWith(t.index(),t.index()+1,l)&&c.setNodeMarkup(c.mapping.map(s.before()),l)}n(c.scrollIntoView())}return!0}}const C=T(),I=(e,t)=>{let n,{$from:s,to:i}=e.selection,o=s.sharedDepth(i);return 0!=o&&(n=s.before(o),t&&t(e.tr.setSelection(r.qv.create(e.doc,n))),!0)},R=(e,t)=>(t&&t(e.tr.setSelection(new r.C1(e.doc))),!0);function O(e,t,n){let r=t.nodeBefore,s=t.nodeAfter,i=t.index();return!!(r&&s&&r.type.compatibleContent(s.type))&&(!r.content.size&&t.parent.canReplace(i-1,i)?(n&&n(e.tr.delete(t.pos-r.nodeSize,t.pos).scrollIntoView()),!0):!(!t.parent.canReplace(i,i+1)||!s.isTextblock&&!(0,a.Mn)(e.doc,t.pos))&&(n&&n(e.tr.clearIncompatible(t.pos,r.type,r.contentMatchAt(r.childCount)).join(t.pos).scrollIntoView()),!0))}function x(e,t,n){let s,i,c=t.nodeBefore,l=t.nodeAfter;if(c.type.spec.isolating||l.type.spec.isolating)return!1;if(O(e,t,n))return!0;let u=t.parent.canReplace(t.index(),t.index()+1);if(u&&(s=(i=c.contentMatchAt(c.childCount)).findWrapping(l.type))&&i.matchType(s[0]||l.type).validEnd){if(n){let r=t.pos+l.nodeSize,i=o.HY.empty;for(let e=s.length-1;e>=0;e--)i=o.HY.from(s[e].create(null,i));i=o.HY.from(c.copy(i));let u=e.tr.step(new a.FC(t.pos-1,r,t.pos,r,new o.p2(i,1,0),s.length,!0)),h=r+2*s.length;(0,a.Mn)(u.doc,h)&&u.join(h),n(u.scrollIntoView())}return!0}let d=r.Y1.findFrom(t,1),p=d&&d.$from.blockRange(d.$to),f=p&&(0,a.k9)(p);if(null!=f&&f>=t.depth)return n&&n(e.tr.lift(p,f).scrollIntoView()),!0;if(u&&h(l,"start",!0)&&h(c,"end")){let r=c,s=[];for(;;){if(s.push(r),r.isTextblock)break;r=r.lastChild}let i=l,u=1;for(;!i.isTextblock;i=i.firstChild)u++;if(r.canReplace(r.childCount,r.childCount,i.content)){if(n){let r=o.HY.empty;for(let e=s.length-1;e>=0;e--)r=o.HY.from(s[e].copy(r));let i=e.tr.step(new a.FC(t.pos-s.length,t.pos+l.nodeSize,t.pos+u,t.pos+l.nodeSize-u,new o.p2(r,s.length,0),0,!0));n(i.scrollIntoView())}return!0}}return!1}function N(e){return function(t,n){let s=t.selection,i=e<0?s.$from:s.$to,o=i.depth;while(i.node(o).isInline){if(!o)return!1;o--}return!!i.node(o).isTextblock&&(n&&n(t.tr.setSelection(r.Bs.create(t.doc,e<0?i.start(o):i.end(o)))),!0)}}const D=N(-1),P=N(1);function L(e,t=null){return function(n,r){let{$from:s,$to:i}=n.selection,o=s.blockRange(i),c=o&&(0,a.nd)(o,e,t);return!!c&&(r&&r(n.tr.wrap(o,c).scrollIntoView()),!0)}}function M(e,t=null){return function(n,r){let s=!1;for(let i=0;i<n.selection.ranges.length&&!s;i++){let{$from:{pos:r},$to:{pos:o}}=n.selection.ranges[i];n.doc.nodesBetween(r,o,((r,i)=>{if(s)return!1;if(r.isTextblock&&!r.hasMarkup(e,t))if(r.type==e)s=!0;else{let t=n.doc.resolve(i),r=t.index();s=t.parent.canReplaceWith(r,r+1,e)}}))}if(!s)return!1;if(r){let s=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:i},$to:{pos:o}}=n.selection.ranges[r];s.setBlockType(i,o,e,t)}r(s.scrollIntoView())}return!0}}function B(...e){return function(t,n,r){for(let s=0;s<e.length;s++)if(e[s](t,n,r))return!0;return!1}}let U=B(c,u,d),V=B(c,g,m);const F={Enter:B(E,k,A,C),"Mod-Enter":S,Backspace:U,"Mod-Backspace":U,"Shift-Backspace":U,Delete:V,"Mod-Delete":V,"Mod-a":R},j={"Ctrl-h":F["Backspace"],"Alt-Backspace":F["Mod-Backspace"],"Ctrl-d":F["Delete"],"Ctrl-Alt-Backspace":F["Mod-Delete"],"Alt-Delete":F["Mod-Delete"],"Alt-d":F["Mod-Delete"],"Ctrl-a":D,"Ctrl-e":P};for(let Pn in F)j[Pn]=F[Pn];"undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&os.platform();function z(e,t=null){return function(n,r){let{$from:s,$to:i}=n.selection,c=s.blockRange(i),l=!1,u=c;if(!c)return!1;if(c.depth>=2&&s.node(c.depth-1).type.compatibleContent(e)&&0==c.startIndex){if(0==s.index(c.depth-1))return!1;let e=n.doc.resolve(c.start-2);u=new o.Ts(e,e,c.depth),c.endIndex<c.parent.childCount&&(c=new o.Ts(s,n.doc.resolve(i.end(c.depth)),c.depth)),l=!0}let h=(0,a.nd)(u,e,t,c);return!!h&&(r&&r($(n.tr,c,h,l,e).scrollIntoView()),!0)}}function $(e,t,n,r,s){let i=o.HY.empty;for(let a=n.length-1;a>=0;a--)i=o.HY.from(n[a].type.create(n[a].attrs,i));e.step(new a.FC(t.start-(r?2:0),t.end,t.start,t.end,new o.p2(i,0,0),n.length,!0));let c=0;for(let o=0;o<n.length;o++)n[o].type==s&&(c=o+1);let l=n.length-c,u=t.start+n.length-(r?2:0),h=t.parent;for(let o=t.startIndex,d=t.endIndex,p=!0;o<d;o++,p=!1)!p&&(0,a.Ax)(e.doc,u,l)&&(e.split(u,l),u+=2*l),u+=h.child(o).nodeSize;return e}function H(e){return function(t,n){let{$from:r,$to:s}=t.selection,i=r.blockRange(s,(t=>t.childCount>0&&t.firstChild.type==e));return!!i&&(!n||(r.node(i.depth-1).type==e?K(t,n,e,i):q(t,n,i)))}}function K(e,t,n,r){let s=e.tr,i=r.end,c=r.$to.end(r.depth);i<c&&(s.step(new a.FC(i-1,c,i,c,new o.p2(o.HY.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new o.Ts(s.doc.resolve(r.$from.pos),s.doc.resolve(c),r.depth));const l=(0,a.k9)(r);if(null==l)return!1;s.lift(r,l);let u=s.mapping.map(i,-1)-1;return(0,a.Mn)(s.doc,u)&&s.join(u),t(s.scrollIntoView()),!0}function q(e,t,n){let r=e.tr,s=n.parent;for(let o=n.end,a=n.endIndex-1,g=n.startIndex;a>g;a--)o-=s.child(a).nodeSize,r.delete(o-1,o+1);let i=r.doc.resolve(n.start),c=i.nodeAfter;if(r.mapping.map(n.end)!=n.start+i.nodeAfter.nodeSize)return!1;let l=0==n.startIndex,u=n.endIndex==s.childCount,h=i.node(-1),d=i.index(-1);if(!h.canReplace(d+(l?0:1),d+1,c.content.append(u?o.HY.empty:o.HY.from(s))))return!1;let p=i.pos,f=p+c.nodeSize;return r.step(new a.FC(p-(l?1:0),f+(u?1:0),p+1,f-1,new o.p2((l?o.HY.empty:o.HY.from(s.copy(o.HY.empty))).append(u?o.HY.empty:o.HY.from(s.copy(o.HY.empty))),l?0:1,u?0:1),l?0:1)),t(r.scrollIntoView()),!0}function G(e){return function(t,n){let{$from:r,$to:s}=t.selection,i=r.blockRange(s,(t=>t.childCount>0&&t.firstChild.type==e));if(!i)return!1;let c=i.startIndex;if(0==c)return!1;let l=i.parent,u=l.child(c-1);if(u.type!=e)return!1;if(n){let r=u.lastChild&&u.lastChild.type==l.type,s=o.HY.from(r?e.create():null),c=new o.p2(o.HY.from(e.create(null,o.HY.from(l.type.create(null,s)))),r?3:1,0),h=i.start,d=i.end;n(t.tr.step(new a.FC(h-(r?3:1),d,h,d,c,1,!0)).scrollIntoView())}return!0}}function W(e){const{state:t,transaction:n}=e;let{selection:r}=n,{doc:s}=n,{storedMarks:i}=n;return{...t,apply:t.apply.bind(t),applyTransaction:t.applyTransaction.bind(t),filterTransaction:t.filterTransaction,plugins:t.plugins,schema:t.schema,reconfigure:t.reconfigure.bind(t),toJSON:t.toJSON.bind(t),get storedMarks(){return i},get selection(){return r},get doc(){return s},get tr(){return r=n.selection,s=n.doc,i=n.storedMarks,n}}}class Y{constructor(e){this.editor=e.editor,this.rawCommands=this.editor.extensionManager.commands,this.customState=e.state}get hasCustomState(){return!!this.customState}get state(){return this.customState||this.editor.state}get commands(){const{rawCommands:e,editor:t,state:n}=this,{view:r}=t,{tr:s}=n,i=this.buildProps(s);return Object.fromEntries(Object.entries(e).map((([e,t])=>{const n=(...e)=>{const n=t(...e)(i);return s.getMeta("preventDispatch")||this.hasCustomState||r.dispatch(s),n};return[e,n]})))}get chain(){return()=>this.createChain()}get can(){return()=>this.createCan()}createChain(e,t=!0){const{rawCommands:n,editor:r,state:s}=this,{view:i}=r,o=[],a=!!e,c=e||s.tr,l=()=>(a||!t||c.getMeta("preventDispatch")||this.hasCustomState||i.dispatch(c),o.every((e=>!0===e))),u={...Object.fromEntries(Object.entries(n).map((([e,n])=>{const r=(...e)=>{const r=this.buildProps(c,t),s=n(...e)(r);return o.push(s),u};return[e,r]}))),run:l};return u}createCan(e){const{rawCommands:t,state:n}=this,r=!1,s=e||n.tr,i=this.buildProps(s,r),o=Object.fromEntries(Object.entries(t).map((([e,t])=>[e,(...e)=>t(...e)({...i,dispatch:void 0})])));return{...o,chain:()=>this.createChain(s,r)}}buildProps(e,t=!0){const{rawCommands:n,editor:r,state:s}=this,{view:i}=r;s.storedMarks&&e.setStoredMarks(s.storedMarks);const o={tr:e,editor:r,view:i,state:W({state:s,transaction:e}),dispatch:t?()=>{}:void 0,chain:()=>this.createChain(e),can:()=>this.createCan(e),get commands(){return Object.fromEntries(Object.entries(n).map((([e,t])=>[e,(...e)=>t(...e)(o)])))}};return o}}class J{constructor(){this.callbacks={}}on(e,t){return this.callbacks[e]||(this.callbacks[e]=[]),this.callbacks[e].push(t),this}emit(e,...t){const n=this.callbacks[e];return n&&n.forEach((e=>e.apply(this,t))),this}off(e,t){const n=this.callbacks[e];return n&&(t?this.callbacks[e]=n.filter((e=>e!==t)):delete this.callbacks[e]),this}removeAllListeners(){this.callbacks={}}}function Q(e,t,n){if(void 0===e.config[t]&&e.parent)return Q(e.parent,t,n);if("function"===typeof e.config[t]){const r=e.config[t].bind({...n,parent:e.parent?Q(e.parent,t,n):null});return r}return e.config[t]}function X(e){const t=e.filter((e=>"extension"===e.type)),n=e.filter((e=>"node"===e.type)),r=e.filter((e=>"mark"===e.type));return{baseExtensions:t,nodeExtensions:n,markExtensions:r}}function Z(e){const t=[],{nodeExtensions:n,markExtensions:r}=X(e),s=[...n,...r],i={default:null,rendered:!0,renderHTML:null,parseHTML:null,keepOnSplit:!0,isRequired:!1};return e.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},r=Q(e,"addGlobalAttributes",n);if(!r)return;const s=r();s.forEach((e=>{e.types.forEach((n=>{Object.entries(e.attributes).forEach((([e,r])=>{t.push({type:n,name:e,attribute:{...i,...r}})}))}))}))})),s.forEach((e=>{const n={name:e.name,options:e.options,storage:e.storage},r=Q(e,"addAttributes",n);if(!r)return;const s=r();Object.entries(s).forEach((([n,r])=>{const s={...i,...r};(null===r||void 0===r?void 0:r.isRequired)&&void 0===(null===r||void 0===r?void 0:r.default)&&delete s.default,t.push({type:e.name,name:n,attribute:s})}))})),t}function ee(e,t){if("string"===typeof e){if(!t.nodes[e])throw Error(`There is no node type named '${e}'. Maybe you forgot to add the extension?`);return t.nodes[e]}return e}function te(...e){return e.filter((e=>!!e)).reduce(((e,t)=>{const n={...e};return Object.entries(t).forEach((([e,t])=>{const r=n[e];n[e]=r?"class"===e?[n[e],t].join(" "):"style"===e?[n[e],t].join("; "):t:t})),n}),{})}function ne(e,t){return t.filter((e=>e.attribute.rendered)).map((t=>t.attribute.renderHTML?t.attribute.renderHTML(e.attrs)||{}:{[t.name]:e.attrs[t.name]})).reduce(((e,t)=>te(e,t)),{})}function re(e){return"function"===typeof e}function se(e,t=undefined,...n){return re(e)?t?e.bind(t)(...n):e(...n):e}function ie(e={}){return 0===Object.keys(e).length&&e.constructor===Object}function oe(e){return"string"!==typeof e?e:e.match(/^[+-]?(?:\d*\.)?\d+$/)?Number(e):"true"===e||"false"!==e&&e}function ae(e,t){return e.style?e:{...e,getAttrs:n=>{const r=e.getAttrs?e.getAttrs(n):e.attrs;if(!1===r)return!1;const s=t.reduce(((e,t)=>{const r=t.attribute.parseHTML?t.attribute.parseHTML(n):oe(n.getAttribute(t.name));return null===r||void 0===r?e:{...e,[t.name]:r}}),{});return{...r,...s}}}}function ce(e){return Object.fromEntries(Object.entries(e).filter((([e,t])=>("attrs"!==e||!ie(t))&&(null!==t&&void 0!==t))))}function le(e){var t;const n=Z(e),{nodeExtensions:r,markExtensions:s}=X(e),i=null===(t=r.find((e=>Q(e,"topNode"))))||void 0===t?void 0:t.name,a=Object.fromEntries(r.map((t=>{const r=n.filter((e=>e.type===t.name)),s={name:t.name,options:t.options,storage:t.storage},i=e.reduce(((e,n)=>{const r=Q(n,"extendNodeSchema",s);return{...e,...r?r(t):{}}}),{}),o=ce({...i,content:se(Q(t,"content",s)),marks:se(Q(t,"marks",s)),group:se(Q(t,"group",s)),inline:se(Q(t,"inline",s)),atom:se(Q(t,"atom",s)),selectable:se(Q(t,"selectable",s)),draggable:se(Q(t,"draggable",s)),code:se(Q(t,"code",s)),defining:se(Q(t,"defining",s)),isolating:se(Q(t,"isolating",s)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null===e||void 0===e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),a=se(Q(t,"parseHTML",s));a&&(o.parseDOM=a.map((e=>ae(e,r))));const c=Q(t,"renderHTML",s);c&&(o.toDOM=e=>c({node:e,HTMLAttributes:ne(e,r)}));const l=Q(t,"renderText",s);return l&&(o.toText=l),[t.name,o]}))),c=Object.fromEntries(s.map((t=>{const r=n.filter((e=>e.type===t.name)),s={name:t.name,options:t.options,storage:t.storage},i=e.reduce(((e,n)=>{const r=Q(n,"extendMarkSchema",s);return{...e,...r?r(t):{}}}),{}),o=ce({...i,inclusive:se(Q(t,"inclusive",s)),excludes:se(Q(t,"excludes",s)),group:se(Q(t,"group",s)),spanning:se(Q(t,"spanning",s)),code:se(Q(t,"code",s)),attrs:Object.fromEntries(r.map((e=>{var t;return[e.name,{default:null===(t=null===e||void 0===e?void 0:e.attribute)||void 0===t?void 0:t.default}]})))}),a=se(Q(t,"parseHTML",s));a&&(o.parseDOM=a.map((e=>ae(e,r))));const c=Q(t,"renderHTML",s);return c&&(o.toDOM=e=>c({mark:e,HTMLAttributes:ne(e,r)})),[t.name,o]})));return new o.V_({topNode:i,nodes:a,marks:c})}function ue(e,t){return t.nodes[e]||t.marks[e]||null}function he(e,t){return Array.isArray(t)?t.some((t=>{const n="string"===typeof t?t:t.name;return n===e.name})):t}const de=(e,t=500)=>{let n="";const r=e.parentOffset;return e.parent.nodesBetween(Math.max(0,r-t),r,((e,t,s,i)=>{var o,a;const c=(null===(a=(o=e.type.spec).toText)||void 0===a?void 0:a.call(o,{node:e,pos:t,parent:s,index:i}))||e.textContent||"%leaf%";n+=c.slice(0,Math.max(0,r-t))})),n};function pe(e){return"[object RegExp]"===Object.prototype.toString.call(e)}class fe{constructor(e){this.find=e.find,this.handler=e.handler}}const ge=(e,t)=>{if(pe(t))return t.exec(e);const n=t(e);if(!n)return null;const r=[n.text];return r.index=n.index,r.input=e,r.data=n.data,n.replaceWith&&(n.text.includes(n.replaceWith)||console.warn('[tiptap warn]: "inputRuleMatch.replaceWith" must be part of "inputRuleMatch.text".'),r.push(n.replaceWith)),r};function me(e){var t;const{editor:n,from:r,to:s,text:i,rules:o,plugin:a}=e,{view:c}=n;if(c.composing)return!1;const l=c.state.doc.resolve(r);if(l.parent.type.spec.code||(null===(t=l.nodeBefore||l.nodeAfter)||void 0===t?void 0:t.marks.find((e=>e.type.spec.code))))return!1;let u=!1;const h=de(l)+i;return o.forEach((e=>{if(u)return;const t=ge(h,e.find);if(!t)return;const o=c.state.tr,l=W({state:c.state,transaction:o}),d={from:r-(t[0].length-i.length),to:s},{commands:p,chain:f,can:g}=new Y({editor:n,state:l}),m=e.handler({state:l,range:d,match:t,commands:p,chain:f,can:g});null!==m&&o.steps.length&&(o.setMeta(a,{transform:o,from:r,to:s,text:i}),c.dispatch(o),u=!0)})),u}function ye(e){const{editor:t,rules:n}=e,s=new r.Sy({state:{init(){return null},apply(e,t){const n=e.getMeta(s);return n||(e.selectionSet||e.docChanged?null:t)}},props:{handleTextInput(e,r,i,o){return me({editor:t,from:r,to:i,text:o,rules:n,plugin:s})},handleDOMEvents:{compositionend:e=>(setTimeout((()=>{const{$cursor:r}=e.state.selection;r&&me({editor:t,from:r.pos,to:r.pos,text:"",rules:n,plugin:s})})),!1)},handleKeyDown(e,r){if("Enter"!==r.key)return!1;const{$cursor:i}=e.state.selection;return!!i&&me({editor:t,from:i.pos,to:i.pos,text:"\n",rules:n,plugin:s})}},isInputRules:!0});return s}function we(e){return"number"===typeof e}class be{constructor(e){this.find=e.find,this.handler=e.handler}}const ve=(e,t)=>{if(pe(t))return[...e.matchAll(t)];const n=t(e);return n?n.map((t=>{const n=[t.text];return n.index=t.index,n.input=e,n.data=t.data,t.replaceWith&&(t.text.includes(t.replaceWith)||console.warn('[tiptap warn]: "pasteRuleMatch.replaceWith" must be part of "pasteRuleMatch.text".'),n.push(t.replaceWith)),n})):[]};function Ee(e){const{editor:t,state:n,from:r,to:s,rule:i}=e,{commands:o,chain:a,can:c}=new Y({editor:t,state:n}),l=[];n.doc.nodesBetween(r,s,((e,t)=>{if(!e.isTextblock||e.type.spec.code)return;const u=Math.max(r,t),h=Math.min(s,t+e.content.size),d=e.textBetween(u-t,h-t,void 0,"￼"),p=ve(d,i.find);p.forEach((e=>{if(void 0===e.index)return;const t=u+e.index+1,r=t+e[0].length,s={from:n.tr.mapping.map(t),to:n.tr.mapping.map(r)},h=i.handler({state:n,range:s,match:e,commands:o,chain:a,can:c});l.push(h)}))}));const u=l.every((e=>null!==e));return u}function _e(e){const{editor:t,rules:n}=e;let s=null,i=!1,o=!1;const a=n.map((e=>new r.Sy({view(e){const t=t=>{var n;s=(null===(n=e.dom.parentElement)||void 0===n?void 0:n.contains(t.target))?e.dom.parentElement:null};return window.addEventListener("dragstart",t),{destroy(){window.removeEventListener("dragstart",t)}}},props:{handleDOMEvents:{drop:e=>(o=s===e.dom.parentElement,!1),paste:(e,t)=>{var n;const r=null===(n=t.clipboardData)||void 0===n?void 0:n.getData("text/html");return i=!!(null===r||void 0===r?void 0:r.includes("data-pm-slice")),!1}}},appendTransaction:(n,r,s)=>{const a=n[0],c="paste"===a.getMeta("uiEvent")&&!i,l="drop"===a.getMeta("uiEvent")&&!o;if(!c&&!l)return;const u=r.doc.content.findDiffStart(s.doc.content),h=r.doc.content.findDiffEnd(s.doc.content);if(!we(u)||!h||u===h.b)return;const d=s.tr,p=W({state:s,transaction:d}),f=Ee({editor:t,state:p,from:Math.max(u-1,0),to:h.b-1,rule:e});return f&&d.steps.length?d:void 0}})));return a}function Se(e){const t=e.filter(((t,n)=>e.indexOf(t)!==n));return[...new Set(t)]}class ke{constructor(e,t){this.splittableMarks=[],this.editor=t,this.extensions=ke.resolve(e),this.schema=le(this.extensions),this.extensions.forEach((e=>{var t;this.editor.extensionStorage[e.name]=e.storage;const n={name:e.name,options:e.options,storage:e.storage,editor:this.editor,type:ue(e.name,this.schema)};if("mark"===e.type){const r=null===(t=se(Q(e,"keepOnSplit",n)))||void 0===t||t;r&&this.splittableMarks.push(e.name)}const r=Q(e,"onBeforeCreate",n);r&&this.editor.on("beforeCreate",r);const s=Q(e,"onCreate",n);s&&this.editor.on("create",s);const i=Q(e,"onUpdate",n);i&&this.editor.on("update",i);const o=Q(e,"onSelectionUpdate",n);o&&this.editor.on("selectionUpdate",o);const a=Q(e,"onTransaction",n);a&&this.editor.on("transaction",a);const c=Q(e,"onFocus",n);c&&this.editor.on("focus",c);const l=Q(e,"onBlur",n);l&&this.editor.on("blur",l);const u=Q(e,"onDestroy",n);u&&this.editor.on("destroy",u)}))}static resolve(e){const t=ke.sort(ke.flatten(e)),n=Se(t.map((e=>e.name)));return n.length&&console.warn(`[tiptap warn]: Duplicate extension names found: [${n.map((e=>`'${e}'`)).join(", ")}]. This can lead to issues.`),t}static flatten(e){return e.map((e=>{const t={name:e.name,options:e.options,storage:e.storage},n=Q(e,"addExtensions",t);return n?[e,...this.flatten(n())]:e})).flat(10)}static sort(e){const t=100;return e.sort(((e,n)=>{const r=Q(e,"priority")||t,s=Q(n,"priority")||t;return r>s?-1:r<s?1:0}))}get commands(){return this.extensions.reduce(((e,t)=>{const n={name:t.name,options:t.options,storage:t.storage,editor:this.editor,type:ue(t.name,this.schema)},r=Q(t,"addCommands",n);return r?{...e,...r()}:e}),{})}get plugins(){const{editor:e}=this,t=ke.sort([...this.extensions].reverse()),n=[],r=[],s=t.map((t=>{const s={name:t.name,options:t.options,storage:t.storage,editor:e,type:ue(t.name,this.schema)},o=[],a=Q(t,"addKeyboardShortcuts",s);let c={};if("mark"===t.type&&t.config.exitable&&(c.ArrowRight=()=>xn.handleExit({editor:e,mark:t})),a){const t=Object.fromEntries(Object.entries(a()).map((([t,n])=>[t,()=>n({editor:e})])));c={...c,...t}}const l=(0,i.h)(c);o.push(l);const u=Q(t,"addInputRules",s);he(t,e.options.enableInputRules)&&u&&n.push(...u());const h=Q(t,"addPasteRules",s);he(t,e.options.enablePasteRules)&&h&&r.push(...h());const d=Q(t,"addProseMirrorPlugins",s);if(d){const e=d();o.push(...e)}return o})).flat();return[ye({editor:e,rules:n}),..._e({editor:e,rules:r}),...s]}get attributes(){return Z(this.extensions)}get nodeViews(){const{editor:e}=this,{nodeExtensions:t}=X(this.extensions);return Object.fromEntries(t.filter((e=>!!Q(e,"addNodeView"))).map((t=>{const n=this.attributes.filter((e=>e.type===t.name)),r={name:t.name,options:t.options,storage:t.storage,editor:e,type:ee(t.name,this.schema)},s=Q(t,"addNodeView",r);if(!s)return[];const i=(r,i,o,a)=>{const c=ne(r,n);return s()({editor:e,node:r,getPos:o,decorations:a,HTMLAttributes:c,extension:t})};return[t.name,i]})))}}function Ae(e){return Object.prototype.toString.call(e).slice(8,-1)}function Te(e){return"Object"===Ae(e)&&(e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype)}function Ce(e,t){const n={...e};return Te(e)&&Te(t)&&Object.keys(t).forEach((r=>{Te(t[r])?r in e?n[r]=Ce(e[r],t[r]):Object.assign(n,{[r]:t[r]}):Object.assign(n,{[r]:t[r]})})),n}class Ie{constructor(e={}){this.type="extension",this.name="extension",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=se(Q(this,"addOptions",{name:this.name}))),this.storage=se(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Ie(e)}configure(e={}){const t=this.extend();return t.options=Ce(this.options,e),t.storage=se(Q(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Ie(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=se(Q(t,"addOptions",{name:t.name})),t.storage=se(Q(t,"addStorage",{name:t.name,options:t.options})),t}}function Re(e,t,n){const{from:r,to:s}=t,{blockSeparator:i="\n\n",textSerializers:o={}}=n||{};let a="",c=!0;return e.nodesBetween(r,s,((e,n,l,u)=>{var h;const d=null===o||void 0===o?void 0:o[e.type.name];d?(e.isBlock&&!c&&(a+=i,c=!0),l&&(a+=d({node:e,pos:n,parent:l,index:u,range:t}))):e.isText?(a+=null===(h=null===e||void 0===e?void 0:e.text)||void 0===h?void 0:h.slice(Math.max(r,n)-n,s-n),c=!1):e.isBlock&&!c&&(a+=i,c=!0)})),a}function Oe(e){return Object.fromEntries(Object.entries(e.nodes).filter((([,e])=>e.spec.toText)).map((([e,t])=>[e,t.spec.toText])))}const xe=Ie.create({name:"clipboardTextSerializer",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("clipboardTextSerializer"),props:{clipboardTextSerializer:()=>{const{editor:e}=this,{state:t,schema:n}=e,{doc:r,selection:s}=t,{ranges:i}=s,o=Math.min(...i.map((e=>e.$from.pos))),a=Math.max(...i.map((e=>e.$to.pos))),c=Oe(n),l={from:o,to:a};return Re(r,l,{textSerializers:c})}}})]}}),Ne=()=>({editor:e,view:t})=>(requestAnimationFrame((()=>{var n;e.isDestroyed||(t.dom.blur(),null===(n=null===window||void 0===window?void 0:window.getSelection())||void 0===n||n.removeAllRanges())})),!0),De=(e=!1)=>({commands:t})=>t.setContent("",e),Pe=()=>({state:e,tr:t,dispatch:n})=>{const{selection:r}=t,{ranges:s}=r;return!n||(s.forEach((({$from:n,$to:r})=>{e.doc.nodesBetween(n.pos,r.pos,((e,n)=>{if(e.type.isText)return;const{doc:r,mapping:s}=t,i=r.resolve(s.map(n)),o=r.resolve(s.map(n+e.nodeSize)),c=i.blockRange(o);if(!c)return;const l=(0,a.k9)(c);if(e.type.isTextblock){const{defaultType:e}=i.parent.contentMatchAt(i.index());t.setNodeMarkup(c.start,e)}(l||0===l)&&t.lift(c,l)}))})),!0)},Le=e=>t=>e(t),Me=()=>({state:e,dispatch:t})=>k(e,t),Be=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,r=n.$anchor.node();if(r.content.size>0)return!1;const s=e.selection.$anchor;for(let i=s.depth;i>0;i-=1){const n=s.node(i);if(n.type===r.type){if(t){const t=s.before(i),n=s.after(i);e.delete(t,n).scrollIntoView()}return!0}}return!1},Ue=e=>({tr:t,state:n,dispatch:r})=>{const s=ee(e,n.schema),i=t.selection.$anchor;for(let e=i.depth;e>0;e-=1){const n=i.node(e);if(n.type===s){if(r){const n=i.before(e),r=i.after(e);t.delete(n,r).scrollIntoView()}return!0}}return!1},Ve=e=>({tr:t,dispatch:n})=>{const{from:r,to:s}=e;return n&&t.delete(r,s),!0},Fe=()=>({state:e,dispatch:t})=>c(e,t),je=()=>({commands:e})=>e.keyboardShortcut("Enter"),ze=()=>({state:e,dispatch:t})=>S(e,t);function $e(e,t,n={strict:!0}){const r=Object.keys(t);return!r.length||r.every((r=>n.strict?t[r]===e[r]:pe(t[r])?t[r].test(e[r]):t[r]===e[r]))}function He(e,t,n={}){return e.find((e=>e.type===t&&$e(e.attrs,n)))}function Ke(e,t,n={}){return!!He(e,t,n)}function qe(e,t,n={}){if(!e||!t)return;let r=e.parent.childAfter(e.parentOffset);if(e.parentOffset===r.offset&&0!==r.offset&&(r=e.parent.childBefore(e.parentOffset)),!r.node)return;const s=He([...r.node.marks],t,n);if(!s)return;let i=r.index,o=e.start()+r.offset,a=i+1,c=o+r.node.nodeSize;He([...r.node.marks],t,n);while(i>0&&s.isInSet(e.parent.child(i-1).marks))i-=1,o-=e.parent.child(i).nodeSize;while(a<e.parent.childCount&&Ke([...e.parent.child(a).marks],t,n))c+=e.parent.child(a).nodeSize,a+=1;return{from:o,to:c}}function Ge(e,t){if("string"===typeof e){if(!t.marks[e])throw Error(`There is no mark type named '${e}'. Maybe you forgot to add the extension?`);return t.marks[e]}return e}const We=(e,t={})=>({tr:n,state:s,dispatch:i})=>{const o=Ge(e,s.schema),{doc:a,selection:c}=n,{$from:l,from:u,to:h}=c;if(i){const e=qe(l,o,t);if(e&&e.from<=u&&e.to>=h){const t=r.Bs.create(a,e.from,e.to);n.setSelection(t)}}return!0},Ye=e=>t=>{const n="function"===typeof e?e(t):e;for(let e=0;e<n.length;e+=1)if(n[e](t))return!0;return!1};function Je(e){return e instanceof r.Bs}function Qe(e=0,t=0,n=0){return Math.min(Math.max(e,t),n)}function Xe(e,t=null){if(!t)return null;const n=r.Y1.atStart(e),s=r.Y1.atEnd(e);if("start"===t||!0===t)return n;if("end"===t)return s;const i=n.from,o=s.to;return"all"===t?r.Bs.create(e,Qe(0,i,o),Qe(e.content.size,i,o)):r.Bs.create(e,Qe(t,i,o),Qe(t,i,o))}function Ze(){return["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document}const et=(e=null,t={})=>({editor:n,view:r,tr:s,dispatch:i})=>{t={scrollIntoView:!0,...t};const o=()=>{Ze()&&r.dom.focus(),requestAnimationFrame((()=>{n.isDestroyed||(r.focus(),(null===t||void 0===t?void 0:t.scrollIntoView)&&n.commands.scrollIntoView())}))};if(r.hasFocus()&&null===e||!1===e)return!0;if(i&&null===e&&!Je(n.state.selection))return o(),!0;const a=Xe(s.doc,e)||n.state.selection,c=n.state.selection.eq(a);return i&&(c||s.setSelection(a),c&&s.storedMarks&&s.setStoredMarks(s.storedMarks),o()),!0},tt=(e,t)=>n=>e.every(((e,r)=>t(e,{...n,index:r}))),nt=(e,t)=>({tr:n,commands:r})=>r.insertContentAt({from:n.selection.from,to:n.selection.to},e,t);function rt(e){const t=`<body>${e}</body>`;return(new window.DOMParser).parseFromString(t,"text/html").body}function st(e,t,n){if(n={slice:!0,parseOptions:{},...n},"object"===typeof e&&null!==e)try{return Array.isArray(e)&&e.length>0?o.HY.fromArray(e.map((e=>t.nodeFromJSON(e)))):t.nodeFromJSON(e)}catch(r){return console.warn("[tiptap warn]: Invalid content.","Passed value:",e,"Error:",r),st("",t,n)}if("string"===typeof e){const r=o.aw.fromSchema(t);return n.slice?r.parseSlice(rt(e),n.parseOptions).content:r.parse(rt(e),n.parseOptions)}return st("",t,n)}function it(e,t,n){const s=e.steps.length-1;if(s<t)return;const i=e.steps[s];if(!(i instanceof a.Pu||i instanceof a.FC))return;const o=e.mapping.maps[s];let c=0;o.forEach(((e,t,n,r)=>{0===c&&(c=r)})),e.setSelection(r.Y1.near(e.doc.resolve(c),n))}const ot=e=>e.toString().startsWith("<"),at=(e,t,n)=>({tr:r,dispatch:s,editor:i})=>{if(s){n={parseOptions:{},updateSelection:!0,...n};const s=st(t,i.schema,{parseOptions:{preserveWhitespace:"full",...n.parseOptions}});if("<>"===s.toString())return!0;let{from:o,to:a}="number"===typeof e?{from:e,to:e}:e,c=!0,l=!0;const u=ot(s)?s:[s];if(u.forEach((e=>{e.check(),c=!!c&&(e.isText&&0===e.marks.length),l=!!l&&e.isBlock})),o===a&&l){const{parent:e}=r.doc.resolve(o),t=e.isTextblock&&!e.type.spec.code&&!e.childCount;t&&(o-=1,a+=1)}c?Array.isArray(t)?r.insertText(t.map((e=>e.text||"")).join(""),o,a):"object"===typeof t&&t&&t.text?r.insertText(t.text,o,a):r.insertText(t,o,a):r.replaceWith(o,a,s),n.updateSelection&&it(r,r.steps.length-1,-1)}return!0},ct=()=>({state:e,dispatch:t})=>w(e,t),lt=()=>({state:e,dispatch:t})=>b(e,t),ut=()=>({state:e,dispatch:t})=>u(e,t),ht=()=>({state:e,dispatch:t})=>g(e,t);function dt(){return"undefined"!==typeof navigator&&/Mac/.test(navigator.platform)}function pt(e){const t=e.split(/-(?!$)/);let n,r,s,i,o=t[t.length-1];"Space"===o&&(o=" ");for(let a=0;a<t.length-1;a+=1){const e=t[a];if(/^(cmd|meta|m)$/i.test(e))i=!0;else if(/^a(lt)?$/i.test(e))n=!0;else if(/^(c|ctrl|control)$/i.test(e))r=!0;else if(/^s(hift)?$/i.test(e))s=!0;else{if(!/^mod$/i.test(e))throw new Error(`Unrecognized modifier name: ${e}`);Ze()||dt()?i=!0:r=!0}}return n&&(o=`Alt-${o}`),r&&(o=`Ctrl-${o}`),i&&(o=`Meta-${o}`),s&&(o=`Shift-${o}`),o}const ft=e=>({editor:t,view:n,tr:r,dispatch:s})=>{const i=pt(e).split(/-(?!$)/),o=i.find((e=>!["Alt","Ctrl","Meta","Shift"].includes(e))),a=new KeyboardEvent("keydown",{key:"Space"===o?" ":o,altKey:i.includes("Alt"),ctrlKey:i.includes("Ctrl"),metaKey:i.includes("Meta"),shiftKey:i.includes("Shift"),bubbles:!0,cancelable:!0}),c=t.captureTransaction((()=>{n.someProp("handleKeyDown",(e=>e(n,a)))}));return null===c||void 0===c||c.steps.forEach((e=>{const t=e.map(r.mapping);t&&s&&r.maybeStep(t)})),!0};function gt(e,t,n={}){const{from:r,to:s,empty:i}=e.selection,o=t?ee(t,e.schema):null,a=[];e.doc.nodesBetween(r,s,((e,t)=>{if(e.isText)return;const n=Math.max(r,t),i=Math.min(s,t+e.nodeSize);a.push({node:e,from:n,to:i})}));const c=s-r,l=a.filter((e=>!o||o.name===e.node.type.name)).filter((e=>$e(e.node.attrs,n,{strict:!1})));if(i)return!!l.length;const u=l.reduce(((e,t)=>e+t.to-t.from),0);return u>=c}const mt=(e,t={})=>({state:n,dispatch:r})=>{const s=ee(e,n.schema),i=gt(n,s,t);return!!i&&v(n,r)},yt=()=>({state:e,dispatch:t})=>A(e,t),wt=e=>({state:t,dispatch:n})=>{const r=ee(e,t.schema);return H(r)(t,n)},bt=()=>({state:e,dispatch:t})=>E(e,t);function vt(e,t){return t.nodes[e]?"node":t.marks[e]?"mark":null}function Et(e,t){const n="string"===typeof t?[t]:t;return Object.keys(e).reduce(((t,r)=>(n.includes(r)||(t[r]=e[r]),t)),{})}const _t=(e,t)=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=vt("string"===typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(i=ee(e,r.schema)),"mark"===a&&(o=Ge(e,r.schema)),s&&n.selection.ranges.forEach((e=>{r.doc.nodesBetween(e.$from.pos,e.$to.pos,((e,r)=>{i&&i===e.type&&n.setNodeMarkup(r,void 0,Et(e.attrs,t)),o&&e.marks.length&&e.marks.forEach((s=>{o===s.type&&n.addMark(r,r+e.nodeSize,o.create(Et(s.attrs,t)))}))}))})),!0)},St=()=>({tr:e,dispatch:t})=>(t&&e.scrollIntoView(),!0),kt=()=>({tr:e,commands:t})=>t.setTextSelection({from:0,to:e.doc.content.size}),At=()=>({state:e,dispatch:t})=>d(e,t),Tt=()=>({state:e,dispatch:t})=>m(e,t),Ct=()=>({state:e,dispatch:t})=>I(e,t),It=()=>({state:e,dispatch:t})=>P(e,t),Rt=()=>({state:e,dispatch:t})=>D(e,t);function Ot(e,t,n={}){return st(e,t,{slice:!1,parseOptions:n})}const xt=(e,t=!1,n={})=>({tr:r,editor:s,dispatch:i})=>{const{doc:o}=r,a=Ot(e,s.schema,n);return i&&r.replaceWith(0,o.content.size,a).setMeta("preventUpdate",!t),!0};function Nt(e){for(let t=0;t<e.edgeCount;t+=1){const{type:n}=e.edge(t);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}function Dt(e,t){for(let n=e.depth;n>0;n-=1){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}}function Pt(e){return t=>Dt(t.$from,e)}function Lt(e,t){const n=o.PW.fromSchema(t).serializeFragment(e),r=document.implementation.createHTMLDocument(),s=r.createElement("div");return s.appendChild(n),s.innerHTML}function Mt(e,t){const n={from:0,to:e.content.size};return Re(e,n,t)}function Bt(e,t){const n=Ge(t,e.schema),{from:r,to:s,empty:i}=e.selection,o=[];i?(e.storedMarks&&o.push(...e.storedMarks),o.push(...e.selection.$head.marks())):e.doc.nodesBetween(r,s,(e=>{o.push(...e.marks)}));const a=o.find((e=>e.type.name===n.name));return a?{...a.attrs}:{}}function Ut(e,t){const n=ee(t,e.schema),{from:r,to:s}=e.selection,i=[];e.doc.nodesBetween(r,s,(e=>{i.push(e)}));const o=i.reverse().find((e=>e.type.name===n.name));return o?{...o.attrs}:{}}function Vt(e,t){const n=vt("string"===typeof t?t:t.name,e.schema);return"node"===n?Ut(e,t):"mark"===n?Bt(e,t):{}}function Ft(e,t,n){const r=[];return e===t?n.resolve(e).marks().forEach((t=>{const s=n.resolve(e-1),i=qe(s,t.type);i&&r.push({mark:t,...i})})):n.nodesBetween(e,t,((e,t)=>{r.push(...e.marks.map((n=>({from:t,to:t+e.nodeSize,mark:n}))))})),r}function jt(e,t,n){return Object.fromEntries(Object.entries(n).filter((([n])=>{const r=e.find((e=>e.type===t&&e.name===n));return!!r&&r.attribute.keepOnSplit})))}function zt(e,t,n={}){const{empty:r,ranges:s}=e.selection,i=t?Ge(t,e.schema):null;if(r)return!!(e.storedMarks||e.selection.$from.marks()).filter((e=>!i||i.name===e.type.name)).find((e=>$e(e.attrs,n,{strict:!1})));let o=0;const a=[];if(s.forEach((({$from:t,$to:n})=>{const r=t.pos,s=n.pos;e.doc.nodesBetween(r,s,((e,t)=>{if(!e.isText&&!e.marks.length)return;const n=Math.max(r,t),i=Math.min(s,t+e.nodeSize),c=i-n;o+=c,a.push(...e.marks.map((e=>({mark:e,from:n,to:i}))))}))})),0===o)return!1;const c=a.filter((e=>!i||i.name===e.mark.type.name)).filter((e=>$e(e.mark.attrs,n,{strict:!1}))).reduce(((e,t)=>e+t.to-t.from),0),l=a.filter((e=>!i||e.mark.type!==i&&e.mark.type.excludes(i))).reduce(((e,t)=>e+t.to-t.from),0),u=c>0?c+l:c;return u>=o}function $t(e,t,n={}){if(!t)return gt(e,null,n)||zt(e,null,n);const r=vt(t,e.schema);return"node"===r?gt(e,t,n):"mark"===r&&zt(e,t,n)}function Ht(e,t){const{nodeExtensions:n}=X(t),r=n.find((t=>t.name===e));if(!r)return!1;const s={name:r.name,options:r.options,storage:r.storage},i=se(Q(r,"group",s));return"string"===typeof i&&i.split(" ").includes("list")}function Kt(e){var t;const n=null===(t=e.type.createAndFill())||void 0===t?void 0:t.toJSON(),r=e.toJSON();return JSON.stringify(n)===JSON.stringify(r)}function qt(e){return e instanceof r.qv}function Gt(e,t,n){const r=0,s=e.state.doc.content.size,i=Qe(t,r,s),o=Qe(n,r,s),a=e.coordsAtPos(i),c=e.coordsAtPos(o,-1),l=Math.min(a.top,c.top),u=Math.max(a.bottom,c.bottom),h=Math.min(a.left,c.left),d=Math.max(a.right,c.right),p=d-h,f=u-l,g=h,m=l,y={top:l,bottom:u,left:h,right:d,width:p,height:f,x:g,y:m};return{...y,toJSON:()=>y}}function Wt(e,t,n){var r;const{selection:s}=t;let i=null;if(Je(s)&&(i=s.$cursor),i){const t=null!==(r=e.storedMarks)&&void 0!==r?r:i.marks();return!!n.isInSet(t)||!t.some((e=>e.type.excludes(n)))}const{ranges:o}=s;return o.some((({$from:t,$to:r})=>{let s=0===t.depth&&(e.doc.inlineContent&&e.doc.type.allowsMarkType(n));return e.doc.nodesBetween(t.pos,r.pos,((e,t,r)=>{if(s)return!1;if(e.isInline){const t=!r||r.type.allowsMarkType(n),i=!!n.isInSet(e.marks)||!e.marks.some((e=>e.type.excludes(n)));s=t&&i}return!s})),s}))}const Yt=(e,t={})=>({tr:n,state:r,dispatch:s})=>{const{selection:i}=n,{empty:o,ranges:a}=i,c=Ge(e,r.schema);if(s)if(o){const e=Bt(r,c);n.addStoredMark(c.create({...e,...t}))}else a.forEach((e=>{const s=e.$from.pos,i=e.$to.pos;r.doc.nodesBetween(s,i,((e,r)=>{const o=Math.max(r,s),a=Math.min(r+e.nodeSize,i),l=e.marks.find((e=>e.type===c));l?e.marks.forEach((e=>{c===e.type&&n.addMark(o,a,c.create({...e.attrs,...t}))})):n.addMark(o,a,c.create(t))}))}));return Wt(r,n,c)},Jt=(e,t)=>({tr:n})=>(n.setMeta(e,t),!0),Qt=(e,t={})=>({state:n,dispatch:r,chain:s})=>{const i=ee(e,n.schema);return i.isTextblock?s().command((({commands:e})=>{const r=M(i,t)(n);return!!r||e.clearNodes()})).command((({state:e})=>M(i,t)(e,r))).run():(console.warn('[tiptap warn]: Currently "setNode()" only supports text block nodes.'),!1)},Xt=e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,s=Qe(e,0,n.content.size),i=r.qv.create(n,s);t.setSelection(i)}return!0},Zt=e=>({tr:t,dispatch:n})=>{if(n){const{doc:n}=t,{from:s,to:i}="number"===typeof e?{from:e,to:e}:e,o=r.Bs.atStart(n).from,a=r.Bs.atEnd(n).to,c=Qe(s,o,a),l=Qe(i,o,a),u=r.Bs.create(n,c,l);t.setSelection(u)}return!0},en=e=>({state:t,dispatch:n})=>{const r=ee(e,t.schema);return G(r)(t,n)};function tn(e,t){const n=e.storedMarks||e.selection.$to.parentOffset&&e.selection.$from.marks();if(n){const r=n.filter((e=>null===t||void 0===t?void 0:t.includes(e.type.name)));e.tr.ensureMarks(r)}}const nn=({keepMarks:e=!0}={})=>({tr:t,state:n,dispatch:s,editor:i})=>{const{selection:o,doc:c}=t,{$from:l,$to:u}=o,h=i.extensionManager.attributes,d=jt(h,l.node().type.name,l.node().attrs);if(o instanceof r.qv&&o.node.isBlock)return!(!l.parentOffset||!(0,a.Ax)(c,l.pos))&&(s&&(e&&tn(n,i.extensionManager.splittableMarks),t.split(l.pos).scrollIntoView()),!0);if(!l.parent.isBlock)return!1;if(s){const s=u.parentOffset===u.parent.content.size;o instanceof r.Bs&&t.deleteSelection();const c=0===l.depth?void 0:Nt(l.node(-1).contentMatchAt(l.indexAfter(-1)));let h=s&&c?[{type:c,attrs:d}]:void 0,p=(0,a.Ax)(t.doc,t.mapping.map(l.pos),1,h);if(h||p||!(0,a.Ax)(t.doc,t.mapping.map(l.pos),1,c?[{type:c}]:void 0)||(p=!0,h=c?[{type:c,attrs:d}]:void 0),p&&(t.split(t.mapping.map(l.pos),1,h),c&&!s&&!l.parentOffset&&l.parent.type!==c)){const e=t.mapping.map(l.before()),n=t.doc.resolve(e);l.node(-1).canReplaceWith(n.index(),n.index()+1,c)&&t.setNodeMarkup(t.mapping.map(l.before()),c)}e&&tn(n,i.extensionManager.splittableMarks),t.scrollIntoView()}return!0},rn=e=>({tr:t,state:n,dispatch:s,editor:i})=>{var c;const l=ee(e,n.schema),{$from:u,$to:h}=n.selection,d=n.selection.node;if(d&&d.isBlock||u.depth<2||!u.sameParent(h))return!1;const p=u.node(-1);if(p.type!==l)return!1;const f=i.extensionManager.attributes;if(0===u.parent.content.size&&u.node(-1).childCount===u.indexAfter(-1)){if(2===u.depth||u.node(-3).type!==l||u.index(-2)!==u.node(-2).childCount-1)return!1;if(s){let e=o.HY.empty;const n=u.index(-1)?1:u.index(-2)?2:3;for(let t=u.depth-n;t>=u.depth-3;t-=1)e=o.HY.from(u.node(t).copy(e));const s=u.indexAfter(-1)<u.node(-2).childCount?1:u.indexAfter(-2)<u.node(-3).childCount?2:3,i=jt(f,u.node().type.name,u.node().attrs),a=(null===(c=l.contentMatch.defaultType)||void 0===c?void 0:c.createAndFill(i))||void 0;e=e.append(o.HY.from(l.createAndFill(null,a)||void 0));const h=u.before(u.depth-(n-1));t.replace(h,u.after(-s),new o.p2(e,4-n,0));let d=-1;t.doc.nodesBetween(h,t.doc.content.size,((e,t)=>{if(d>-1)return!1;e.isTextblock&&0===e.content.size&&(d=t+1)})),d>-1&&t.setSelection(r.Bs.near(t.doc.resolve(d))),t.scrollIntoView()}return!0}const g=h.pos===u.end()?p.contentMatchAt(0).defaultType:null,m=jt(f,p.type.name,p.attrs),y=jt(f,u.node().type.name,u.node().attrs);t.delete(u.pos,h.pos);const w=g?[{type:l,attrs:m},{type:g,attrs:y}]:[{type:l,attrs:m}];if(!(0,a.Ax)(t.doc,u.pos,2))return!1;if(s){const{selection:e,storedMarks:r}=n,{splittableMarks:o}=i.extensionManager,a=r||e.$to.parentOffset&&e.$from.marks();if(t.split(u.pos,2,w).scrollIntoView(),!a||!s)return!0;const c=a.filter((e=>o.includes(e.type.name)));t.ensureMarks(c)}return!0},sn=(e,t)=>{const n=Pt((e=>e.type===t))(e.selection);if(!n)return!0;const r=e.doc.resolve(Math.max(0,n.pos-1)).before(n.depth);if(void 0===r)return!0;const s=e.doc.nodeAt(r),i=n.node.type===(null===s||void 0===s?void 0:s.type)&&(0,a.Mn)(e.doc,n.pos);return!i||(e.join(n.pos),!0)},on=(e,t)=>{const n=Pt((e=>e.type===t))(e.selection);if(!n)return!0;const r=e.doc.resolve(n.start).after(n.depth);if(void 0===r)return!0;const s=e.doc.nodeAt(r),i=n.node.type===(null===s||void 0===s?void 0:s.type)&&(0,a.Mn)(e.doc,r);return!i||(e.join(r),!0)},an=(e,t,n)=>({editor:r,tr:s,state:i,dispatch:o,chain:a,commands:c,can:l})=>{const{extensions:u,splittableMarks:h}=r.extensionManager,d=ee(e,i.schema),p=ee(t,i.schema),{selection:f,storedMarks:g}=i,{$from:m,$to:y}=f,w=m.blockRange(y),b=g||f.$to.parentOffset&&f.$from.marks();if(!w)return!1;const v=Pt((e=>Ht(e.type.name,u)))(f);if(w.depth>=1&&v&&w.depth-v.depth<=1){if(v.node.type===d)return c.liftListItem(p);if(Ht(v.node.type.name,u)&&d.validContent(v.node.content)&&o)return a().command((()=>(s.setNodeMarkup(v.pos,d),!0))).command((()=>sn(s,d))).command((()=>on(s,d))).run()}return n&&b&&o?a().command((()=>{const e=l().wrapInList(d),t=b.filter((e=>h.includes(e.type.name)));return s.ensureMarks(t),!!e||c.clearNodes()})).wrapInList(d).command((()=>sn(s,d))).command((()=>on(s,d))).run():a().command((()=>{const e=l().wrapInList(d);return!!e||c.clearNodes()})).wrapInList(d).command((()=>sn(s,d))).command((()=>on(s,d))).run()},cn=(e,t={},n={})=>({state:r,commands:s})=>{const{extendEmptyMarkRange:i=!1}=n,o=Ge(e,r.schema),a=zt(r,o,t);return a?s.unsetMark(o,{extendEmptyMarkRange:i}):s.setMark(o,t)},ln=(e,t,n={})=>({state:r,commands:s})=>{const i=ee(e,r.schema),o=ee(t,r.schema),a=gt(r,i,n);return a?s.setNode(o):s.setNode(i,n)},un=(e,t={})=>({state:n,commands:r})=>{const s=ee(e,n.schema),i=gt(n,s,t);return i?r.lift(s):r.wrapIn(s,t)},hn=()=>({state:e,dispatch:t})=>{const n=e.plugins;for(let r=0;r<n.length;r+=1){const s=n[r];let i;if(s.spec.isInputRules&&(i=s.getState(e))){if(t){const t=e.tr,n=i.transform;for(let e=n.steps.length-1;e>=0;e-=1)t.step(n.steps[e].invert(n.docs[e]));if(i.text){const n=t.doc.resolve(i.from).marks();t.replaceWith(i.from,i.to,e.schema.text(i.text,n))}else t.delete(i.from,i.to)}return!0}}return!1},dn=()=>({tr:e,dispatch:t})=>{const{selection:n}=e,{empty:r,ranges:s}=n;return r||t&&s.forEach((t=>{e.removeMark(t.$from.pos,t.$to.pos)})),!0},pn=(e,t={})=>({tr:n,state:r,dispatch:s})=>{var i;const{extendEmptyMarkRange:o=!1}=t,{selection:a}=n,c=Ge(e,r.schema),{$from:l,empty:u,ranges:h}=a;if(!s)return!0;if(u&&o){let{from:e,to:t}=a;const r=null===(i=l.marks().find((e=>e.type===c)))||void 0===i?void 0:i.attrs,s=qe(l,c,r);s&&(e=s.from,t=s.to),n.removeMark(e,t,c)}else h.forEach((e=>{n.removeMark(e.$from.pos,e.$to.pos,c)}));return n.removeStoredMark(c),!0},fn=(e,t={})=>({tr:n,state:r,dispatch:s})=>{let i=null,o=null;const a=vt("string"===typeof e?e:e.name,r.schema);return!!a&&("node"===a&&(i=ee(e,r.schema)),"mark"===a&&(o=Ge(e,r.schema)),s&&n.selection.ranges.forEach((e=>{const s=e.$from.pos,a=e.$to.pos;r.doc.nodesBetween(s,a,((e,r)=>{i&&i===e.type&&n.setNodeMarkup(r,void 0,{...e.attrs,...t}),o&&e.marks.length&&e.marks.forEach((i=>{if(o===i.type){const c=Math.max(r,s),l=Math.min(r+e.nodeSize,a);n.addMark(c,l,o.create({...i.attrs,...t}))}}))}))})),!0)},gn=(e,t={})=>({state:n,dispatch:r})=>{const s=ee(e,n.schema);return L(s,t)(n,r)},mn=(e,t={})=>({state:n,dispatch:r})=>{const s=ee(e,n.schema);return z(s,t)(n,r)};var yn=Object.freeze({__proto__:null,blur:Ne,clearContent:De,clearNodes:Pe,command:Le,createParagraphNear:Me,deleteCurrentNode:Be,deleteNode:Ue,deleteRange:Ve,deleteSelection:Fe,enter:je,exitCode:ze,extendMarkRange:We,first:Ye,focus:et,forEach:tt,insertContent:nt,insertContentAt:at,joinUp:ct,joinDown:lt,joinBackward:ut,joinForward:ht,keyboardShortcut:ft,lift:mt,liftEmptyBlock:yt,liftListItem:wt,newlineInCode:bt,resetAttributes:_t,scrollIntoView:St,selectAll:kt,selectNodeBackward:At,selectNodeForward:Tt,selectParentNode:Ct,selectTextblockEnd:It,selectTextblockStart:Rt,setContent:xt,setMark:Yt,setMeta:Jt,setNode:Qt,setNodeSelection:Xt,setTextSelection:Zt,sinkListItem:en,splitBlock:nn,splitListItem:rn,toggleList:an,toggleMark:cn,toggleNode:ln,toggleWrap:un,undoInputRule:hn,unsetAllMarks:dn,unsetMark:pn,updateAttributes:fn,wrapIn:gn,wrapInList:mn});const wn=Ie.create({name:"commands",addCommands(){return{...yn}}}),bn=Ie.create({name:"editable",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("editable"),props:{editable:()=>this.editor.options.editable}})]}}),vn=Ie.create({name:"focusEvents",addProseMirrorPlugins(){const{editor:e}=this;return[new r.Sy({key:new r.H$("focusEvents"),props:{handleDOMEvents:{focus:(t,n)=>{e.isFocused=!0;const r=e.state.tr.setMeta("focus",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1},blur:(t,n)=>{e.isFocused=!1;const r=e.state.tr.setMeta("blur",{event:n}).setMeta("addToHistory",!1);return t.dispatch(r),!1}}}})]}}),En=Ie.create({name:"keymap",addKeyboardShortcuts(){const e=()=>this.editor.commands.first((({commands:e})=>[()=>e.undoInputRule(),()=>e.command((({tr:t})=>{const{selection:n,doc:s}=t,{empty:i,$anchor:o}=n,{pos:a,parent:c}=o,l=r.Y1.atStart(s).from===a;return!(!(i&&l&&c.type.isTextblock)||c.textContent.length)&&e.clearNodes()})),()=>e.deleteSelection(),()=>e.joinBackward(),()=>e.selectNodeBackward()])),t=()=>this.editor.commands.first((({commands:e})=>[()=>e.deleteSelection(),()=>e.deleteCurrentNode(),()=>e.joinForward(),()=>e.selectNodeForward()])),n=()=>this.editor.commands.first((({commands:e})=>[()=>e.newlineInCode(),()=>e.createParagraphNear(),()=>e.liftEmptyBlock(),()=>e.splitBlock()])),s={Enter:n,"Mod-Enter":()=>this.editor.commands.exitCode(),Backspace:e,"Mod-Backspace":e,"Shift-Backspace":e,Delete:t,"Mod-Delete":t,"Mod-a":()=>this.editor.commands.selectAll()},i={...s},o={...s,"Ctrl-h":e,"Alt-Backspace":e,"Ctrl-d":t,"Ctrl-Alt-Backspace":t,"Alt-Delete":t,"Alt-d":t,"Ctrl-a":()=>this.editor.commands.selectTextblockStart(),"Ctrl-e":()=>this.editor.commands.selectTextblockEnd()};return Ze()||dt()?o:i},addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("clearDocument"),appendTransaction:(e,t,n)=>{const s=e.some((e=>e.docChanged))&&!t.doc.eq(n.doc);if(!s)return;const{empty:i,from:o,to:a}=t.selection,c=r.Y1.atStart(t.doc).from,l=r.Y1.atEnd(t.doc).to,u=o===c&&a===l,h=0===n.doc.textBetween(0,n.doc.content.size," "," ").length;if(i||!u||!h)return;const d=n.tr,p=W({state:n,transaction:d}),{commands:f}=new Y({editor:this.editor,state:p});return f.clearNodes(),d.steps.length?d:void 0}})]}}),_n=Ie.create({name:"tabindex",addProseMirrorPlugins(){return[new r.Sy({key:new r.H$("tabindex"),props:{attributes:this.editor.isEditable?{tabindex:"0"}:{}}})]}});var Sn=Object.freeze({__proto__:null,ClipboardTextSerializer:xe,Commands:wn,Editable:bn,FocusEvents:vn,Keymap:En,Tabindex:_n});const kn='.ProseMirror {\n  position: relative;\n}\n\n.ProseMirror {\n  word-wrap: break-word;\n  white-space: pre-wrap;\n  white-space: break-spaces;\n  -webkit-font-variant-ligatures: none;\n  font-variant-ligatures: none;\n  font-feature-settings: "liga" 0; /* the above doesn\'t seem to work in Edge */\n}\n\n.ProseMirror [contenteditable="false"] {\n  white-space: normal;\n}\n\n.ProseMirror [contenteditable="false"] [contenteditable="true"] {\n  white-space: pre-wrap;\n}\n\n.ProseMirror pre {\n  white-space: pre-wrap;\n}\n\nimg.ProseMirror-separator {\n  display: inline !important;\n  border: none !important;\n  margin: 0 !important;\n  width: 1px !important;\n  height: 1px !important;\n}\n\n.ProseMirror-gapcursor {\n  display: none;\n  pointer-events: none;\n  position: absolute;\n  margin: 0;\n}\n\n.ProseMirror-gapcursor:after {\n  content: "";\n  display: block;\n  position: absolute;\n  top: -2px;\n  width: 20px;\n  border-top: 1px solid black;\n  animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;\n}\n\n@keyframes ProseMirror-cursor-blink {\n  to {\n    visibility: hidden;\n  }\n}\n\n.ProseMirror-hideselection *::selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection *::-moz-selection {\n  background: transparent;\n}\n\n.ProseMirror-hideselection * {\n  caret-color: transparent;\n}\n\n.ProseMirror-focused .ProseMirror-gapcursor {\n  display: block;\n}\n\n.tippy-box[data-animation=fade][data-state=hidden] {\n  opacity: 0\n}';function An(e,t){const n=document.querySelector("style[data-tiptap-style]");if(null!==n)return n;const r=document.createElement("style");return t&&r.setAttribute("nonce",t),r.setAttribute("data-tiptap-style",""),r.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(r),r}class Tn extends J{constructor(e={}){super(),this.isFocused=!1,this.extensionStorage={},this.options={element:document.createElement("div"),content:"",injectCSS:!0,injectNonce:void 0,extensions:[],autofocus:!1,editable:!0,editorProps:{},parseOptions:{},enableInputRules:!0,enablePasteRules:!0,enableCoreExtensions:!0,onBeforeCreate:()=>null,onCreate:()=>null,onUpdate:()=>null,onSelectionUpdate:()=>null,onTransaction:()=>null,onFocus:()=>null,onBlur:()=>null,onDestroy:()=>null},this.isCapturingTransaction=!1,this.capturedTransaction=null,this.setOptions(e),this.createExtensionManager(),this.createCommandManager(),this.createSchema(),this.on("beforeCreate",this.options.onBeforeCreate),this.emit("beforeCreate",{editor:this}),this.createView(),this.injectCSS(),this.on("create",this.options.onCreate),this.on("update",this.options.onUpdate),this.on("selectionUpdate",this.options.onSelectionUpdate),this.on("transaction",this.options.onTransaction),this.on("focus",this.options.onFocus),this.on("blur",this.options.onBlur),this.on("destroy",this.options.onDestroy),window.setTimeout((()=>{this.isDestroyed||(this.commands.focus(this.options.autofocus),this.emit("create",{editor:this}))}),0)}get storage(){return this.extensionStorage}get commands(){return this.commandManager.commands}chain(){return this.commandManager.chain()}can(){return this.commandManager.can()}injectCSS(){this.options.injectCSS&&document&&(this.css=An(kn,this.options.injectNonce))}setOptions(e={}){this.options={...this.options,...e},this.view&&this.state&&!this.isDestroyed&&(this.options.editorProps&&this.view.setProps(this.options.editorProps),this.view.updateState(this.state))}setEditable(e,t=!0){this.setOptions({editable:e}),t&&this.emit("update",{editor:this,transaction:this.state.tr})}get isEditable(){return this.options.editable&&this.view&&this.view.editable}get state(){return this.view.state}registerPlugin(e,t){const n=re(t)?t(e,[...this.state.plugins]):[...this.state.plugins,e],r=this.state.reconfigure({plugins:n});this.view.updateState(r)}unregisterPlugin(e){if(this.isDestroyed)return;const t="string"===typeof e?`${e}$`:e.key,n=this.state.reconfigure({plugins:this.state.plugins.filter((e=>!e.key.startsWith(t)))});this.view.updateState(n)}createExtensionManager(){const e=this.options.enableCoreExtensions?Object.values(Sn):[],t=[...e,...this.options.extensions].filter((e=>["extension","node","mark"].includes(null===e||void 0===e?void 0:e.type)));this.extensionManager=new ke(t,this)}createCommandManager(){this.commandManager=new Y({editor:this})}createSchema(){this.schema=this.extensionManager.schema}createView(){const e=Ot(this.options.content,this.schema,this.options.parseOptions),t=Xe(e,this.options.autofocus);this.view=new s.tk(this.options.element,{...this.options.editorProps,dispatchTransaction:this.dispatchTransaction.bind(this),state:r.yy.create({doc:e,selection:t||void 0})});const n=this.state.reconfigure({plugins:this.extensionManager.plugins});this.view.updateState(n),this.createNodeViews();const i=this.view.dom;i.editor=this}createNodeViews(){this.view.setProps({nodeViews:this.extensionManager.nodeViews})}captureTransaction(e){this.isCapturingTransaction=!0,e(),this.isCapturingTransaction=!1;const t=this.capturedTransaction;return this.capturedTransaction=null,t}dispatchTransaction(e){if(this.view.isDestroyed)return;if(this.isCapturingTransaction)return this.capturedTransaction?void e.steps.forEach((e=>{var t;return null===(t=this.capturedTransaction)||void 0===t?void 0:t.step(e)})):void(this.capturedTransaction=e);const t=this.state.apply(e),n=!this.state.selection.eq(t.selection);this.view.updateState(t),this.emit("transaction",{editor:this,transaction:e}),n&&this.emit("selectionUpdate",{editor:this,transaction:e});const r=e.getMeta("focus"),s=e.getMeta("blur");r&&this.emit("focus",{editor:this,event:r.event,transaction:e}),s&&this.emit("blur",{editor:this,event:s.event,transaction:e}),e.docChanged&&!e.getMeta("preventUpdate")&&this.emit("update",{editor:this,transaction:e})}getAttributes(e){return Vt(this.state,e)}isActive(e,t){const n="string"===typeof e?e:null,r="string"===typeof e?t:e;return $t(this.state,n,r)}getJSON(){return this.state.doc.toJSON()}getHTML(){return Lt(this.state.doc.content,this.schema)}getText(e){const{blockSeparator:t="\n\n",textSerializers:n={}}=e||{};return Mt(this.state.doc,{blockSeparator:t,textSerializers:{...Oe(this.schema),...n}})}get isEmpty(){return Kt(this.state.doc)}getCharacterCount(){return console.warn('[tiptap warn]: "editor.getCharacterCount()" is deprecated. Please use "editor.storage.characterCount.characters()" instead.'),this.state.doc.content.size-2}destroy(){this.emit("destroy"),this.view&&this.view.destroy(),this.removeAllListeners()}get isDestroyed(){var e;return!(null===(e=this.view)||void 0===e?void 0:e.docView)}}function Cn(e){return new fe({find:e.find,handler:({state:t,range:n,match:r})=>{const s=se(e.getAttributes,void 0,r);if(!1===s||null===s)return null;const{tr:i}=t,o=r[r.length-1],a=r[0];let c=n.to;if(o){const r=a.search(/\S/),l=n.from+a.indexOf(o),u=l+o.length,h=Ft(n.from,n.to,t.doc).filter((t=>{const n=t.mark.type.excluded;return n.find((n=>n===e.type&&n!==t.mark.type))})).filter((e=>e.to>l));if(h.length)return null;u<n.to&&i.delete(u,n.to),l>n.from&&i.delete(n.from+r,l),c=n.from+r+o.length,i.addMark(n.from+r,c,e.type.create(s||{})),i.removeStoredMark(e.type)}}})}function In(e){return new fe({find:e.find,handler:({state:t,range:n,match:r})=>{const s=se(e.getAttributes,void 0,r)||{},{tr:i}=t,o=n.from;let a=n.to;if(r[1]){const t=r[0].lastIndexOf(r[1]);let n=o+t;n>a?n=a:a=n+r[1].length;const c=r[0][r[0].length-1];i.insertText(c,o+r[0].length-1),i.replaceWith(n,a,e.type.create(s))}else r[0]&&i.replaceWith(o,a,e.type.create(s))}})}function Rn(e){return new fe({find:e.find,handler:({state:t,range:n,match:r})=>{const s=t.doc.resolve(n.from),i=se(e.getAttributes,void 0,r)||{};if(!s.node(-1).canReplaceWith(s.index(-1),s.indexAfter(-1),e.type))return null;t.tr.delete(n.from,n.to).setBlockType(n.from,n.from,e.type,i)}})}function On(e){return new fe({find:e.find,handler:({state:t,range:n,match:r,chain:s})=>{const i=se(e.getAttributes,void 0,r)||{},o=t.tr.delete(n.from,n.to),c=o.doc.resolve(n.from),l=c.blockRange(),u=l&&(0,a.nd)(l,e.type,i);if(!u)return null;if(o.wrap(l,u),e.keepMarks&&e.editor){const{selection:n,storedMarks:r}=t,{splittableMarks:s}=e.editor.extensionManager,i=r||n.$to.parentOffset&&n.$from.marks();if(i){const e=i.filter((e=>s.includes(e.type.name)));o.ensureMarks(e)}}if(e.keepAttributes){const t="bulletList"===e.type.name||"orderedList"===e.type.name?"listItem":"taskList";s().updateAttributes(t,i).run()}const h=o.doc.resolve(n.from-1).nodeBefore;h&&h.type===e.type&&(0,a.Mn)(o.doc,n.from-1)&&(!e.joinPredicate||e.joinPredicate(r,h))&&o.join(n.from-1)}})}class xn{constructor(e={}){this.type="mark",this.name="mark",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=se(Q(this,"addOptions",{name:this.name}))),this.storage=se(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new xn(e)}configure(e={}){const t=this.extend();return t.options=Ce(this.options,e),t.storage=se(Q(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new xn(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=se(Q(t,"addOptions",{name:t.name})),t.storage=se(Q(t,"addStorage",{name:t.name,options:t.options})),t}static handleExit({editor:e,mark:t}){const{tr:n}=e.state,r=e.state.selection.$from,s=r.pos===r.end();if(s){const s=r.marks(),i=!!s.find((e=>(null===e||void 0===e?void 0:e.type.name)===t.name));if(!i)return!1;const o=s.find((e=>(null===e||void 0===e?void 0:e.type.name)===t.name));return o&&n.removeStoredMark(o),n.insertText(" ",r.pos),e.view.dispatch(n),!0}return!1}}class Nn{constructor(e={}){this.type="node",this.name="node",this.parent=null,this.child=null,this.config={name:this.name,defaultOptions:{}},this.config={...this.config,...e},this.name=this.config.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${this.name}".`),this.options=this.config.defaultOptions,this.config.addOptions&&(this.options=se(Q(this,"addOptions",{name:this.name}))),this.storage=se(Q(this,"addStorage",{name:this.name,options:this.options}))||{}}static create(e={}){return new Nn(e)}configure(e={}){const t=this.extend();return t.options=Ce(this.options,e),t.storage=se(Q(t,"addStorage",{name:t.name,options:t.options})),t}extend(e={}){const t=new Nn(e);return t.parent=this,this.child=t,t.name=e.name?e.name:t.parent.name,e.defaultOptions&&console.warn(`[tiptap warn]: BREAKING CHANGE: "defaultOptions" is deprecated. Please use "addOptions" instead. Found in extension: "${t.name}".`),t.options=se(Q(t,"addOptions",{name:t.name})),t.storage=se(Q(t,"addStorage",{name:t.name,options:t.options})),t}}function Dn(e){return new be({find:e.find,handler:({state:t,range:n,match:r})=>{const s=se(e.getAttributes,void 0,r);if(!1===s||null===s)return null;const{tr:i}=t,o=r[r.length-1],a=r[0];let c=n.to;if(o){const r=a.search(/\S/),l=n.from+a.indexOf(o),u=l+o.length,h=Ft(n.from,n.to,t.doc).filter((t=>{const n=t.mark.type.excluded;return n.find((n=>n===e.type&&n!==t.mark.type))})).filter((e=>e.to>l));if(h.length)return null;u<n.to&&i.delete(u,n.to),l>n.from&&i.delete(n.from+r,l),c=n.from+r+o.length,i.addMark(n.from+r,c,e.type.create(s||{})),i.removeStoredMark(e.type)}}})}},2019:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(2066),s=n(157);const i=r.hj.create({name:"characterCount",addOptions(){return{limit:null,mode:"textSize"}},addStorage(){return{characters:()=>0,words:()=>0}},onBeforeCreate(){this.storage.characters=e=>{const t=(null===e||void 0===e?void 0:e.node)||this.editor.state.doc,n=(null===e||void 0===e?void 0:e.mode)||this.options.mode;if("textSize"===n){const e=t.textBetween(0,t.content.size,void 0," ");return e.length}return t.nodeSize},this.storage.words=e=>{const t=(null===e||void 0===e?void 0:e.node)||this.editor.state.doc,n=t.textBetween(0,t.content.size," "," "),r=n.split(" ").filter((e=>""!==e));return r.length}},addProseMirrorPlugins(){return[new s.Sy({key:new s.H$("characterCount"),filterTransaction:(e,t)=>{const n=this.options.limit;if(!e.docChanged||0===n||null===n||void 0===n)return!0;const r=this.storage.characters({node:t.doc}),s=this.storage.characters({node:e.doc});if(s<=n)return!0;if(r>n&&s>n&&s<=r)return!0;if(r>n&&s>n&&s>r)return!1;const i=e.getMeta("paste");if(!i)return!1;const o=e.selection.$head.pos,a=s-n,c=o-a,l=o;e.deleteRange(c,l);const u=this.storage.characters({node:e.doc});return!(u>n)}})]}})},5017:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r=n(2066),s=(n(7658),n(3248)),i=n(1460),o=n(157);var a=n(7195),c=n(1811),l=n(1383);const u=e=>{const t=document.createElement("span");t.classList.add("ProseMirror-yjs-cursor"),t.setAttribute("style",`border-color: ${e.color}`);const n=document.createElement("div");n.setAttribute("style",`background-color: ${e.color}`),n.insertBefore(document.createTextNode(e.name),null);const r=document.createTextNode("⁠"),s=document.createTextNode("⁠");return t.insertBefore(r,null),t.insertBefore(n,null),t.insertBefore(s,null),t},h=e=>({style:`background-color: ${e.color}70`,class:"ProseMirror-yjs-selection"}),d=/^#[0-9a-fA-F]{6}$/,p=(e,t,n,r)=>{const o=c.Gt.getState(e),u=o.doc,h=[];return null!=o.snapshot||null!=o.prevSnapshot||null===o.binding?i.EH.create(e.doc,[]):(t.getStates().forEach(((t,c)=>{if(c!==u.clientID&&null!=t.cursor){const p=t.user||{};null==p.color?p.color="#ffa500":d.test(p.color)||console.warn("A user uses an unsupported color format",p),null==p.name&&(p.name=`User: ${c}`);let f=(0,a.SF)(u,o.type,s.og(t.cursor.anchor),o.binding.mapping),g=(0,a.SF)(u,o.type,s.og(t.cursor.head),o.binding.mapping);if(null!==f&&null!==g){const t=l.Fp(e.doc.content.size-1,0);f=l.VV(f,t),g=l.VV(g,t),h.push(i.p.widget(g,(()=>n(p)),{key:c+"",side:10}));const s=l.VV(f,g),o=l.Fp(f,g);h.push(i.p.inline(s,o,r(p),{inclusiveEnd:!0,inclusiveStart:!1}))}}})),i.EH.create(e.doc,h))},f=(e,{cursorBuilder:t=u,selectionBuilder:n=h,getSelection:r=(e=>e.selection)}={},i="cursor")=>new o.Sy({key:c.uJ,state:{init(r,s){return p(s,e,t,n)},apply(r,s,i,o){const a=c.Gt.getState(o),l=r.getMeta(c.uJ);return a&&a.isChangeOrigin||l&&l.awarenessUpdated?p(o,e,t,n):s.map(r.mapping,r.doc)}},props:{decorations:e=>c.uJ.getState(e)},view:t=>{const n=()=>{t.docView&&(0,a.US)(t,c.uJ,{awarenessUpdated:!0})},o=()=>{const n=c.Gt.getState(t.state),o=e.getLocalState()||{};if(null!=n.binding)if(t.hasFocus()){const c=r(t.state),l=(0,a.JR)(c.anchor,n.type,n.binding.mapping),u=(0,a.JR)(c.head,n.type,n.binding.mapping);null!=o.cursor&&s.Uq(s.og(o.cursor.anchor),l)&&s.Uq(s.og(o.cursor.head),u)||e.setLocalStateField(i,{anchor:l,head:u})}else null!=o.cursor&&null!==(0,a.SF)(n.doc,n.type,s.og(o.cursor.anchor),n.binding.mapping)&&e.setLocalStateField(i,null)};return e.on("change",n),t.dom.addEventListener("focusin",o),t.dom.addEventListener("focusout",o),{update:o,destroy:()=>{t.dom.removeEventListener("focusin",o),t.dom.removeEventListener("focusout",o),e.off("change",n),e.setLocalStateField(i,null)}}}}),g=e=>Array.from(e.entries()).map((([e,t])=>({clientId:e,...t.user}))),m=()=>null,y=r.hj.create({name:"collaborationCursor",addOptions(){return{provider:null,user:{name:null,color:null},render:e=>{const t=document.createElement("span");t.classList.add("collaboration-cursor__caret"),t.setAttribute("style",`border-color: ${e.color}`);const n=document.createElement("div");return n.classList.add("collaboration-cursor__label"),n.setAttribute("style",`background-color: ${e.color}`),n.insertBefore(document.createTextNode(e.name),null),t.insertBefore(n,null),t},onUpdate:m}},onCreate(){this.options.onUpdate!==m&&console.warn('[tiptap warn]: DEPRECATED: The "onUpdate" option is deprecated. Please use `editor.storage.collaborationCursor.users` instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor')},addStorage(){return{users:[]}},addCommands(){return{updateUser:e=>()=>(this.options.user=e,this.options.provider.awareness.setLocalStateField("user",this.options.user),!0),user:e=>({editor:t})=>(console.warn('[tiptap warn]: DEPRECATED: The "user" command is deprecated. Please use "updateUser" instead. Read more: https://tiptap.dev/api/extensions/collaboration-cursor'),t.commands.updateUser(e))}},addProseMirrorPlugins(){return[f((()=>(this.options.provider.awareness.setLocalStateField("user",this.options.user),this.storage.users=g(this.options.provider.awareness.states),this.options.provider.awareness.on("update",(()=>{this.storage.users=g(this.options.provider.awareness.states)})),this.options.provider.awareness))(),{cursorBuilder:this.options.render})]}})},5808:function(e,t,n){"use strict";n.d(t,{ZP:function(){return X}});var r=n(2066),s=n(1811),i=n(157);n(7658);const o=()=>{let e=!0;return(t,n)=>{if(e){e=!1;try{t()}finally{e=!0}}else void 0!==n&&n()}};var a=n(1543),c=n(1383),l=n(1370),u=n(893);const h=/[\uD800-\uDBFF]/,d=/[\uDC00-\uDFFF]/,p=(e,t)=>{let n=0,r=0;while(n<e.length&&n<t.length&&e[n]===t[n])n++;h.test(e[n-1])&&n--;while(r+n<e.length&&r+n<t.length&&e[e.length-r-1]===t[t.length-r-1])r++;return d.test(e[e.length-r])&&r--,{index:n,remove:e.length-n-r,insert:t.slice(n,t.length-r)}},f=p;var g=n(6969),m=n(3248),y=n(7195),w=n(6157),b=n(6413),v=n(7214),E=n(1634);const _=(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&t.sv.get(e.id.client)>e.id.clock&&!m.uY(t.ds,e.id),S=[{light:"#ecd44433",dark:"#ecd444"}],k=(e,t,n)=>{if(!e.has(n)){if(e.size<t.length){const n=u.Ue();e.forEach((e=>n.add(e))),t=t.filter((e=>!n.has(e)))}e.set(n,w.kw(t))}return e.get(n)},A=(e,{colors:t=S,colorMapping:n=new Map,permanentUserData:r=null,onFirstRender:o=(()=>{})}={})=>{let a,c=!1;const l=new i.Sy({props:{editable:e=>{const t=s.Gt.getState(e);return null==t.snapshot&&null==t.prevSnapshot}},key:s.Gt,state:{init:(s,i)=>({type:e,doc:e.doc,binding:null,snapshot:null,prevSnapshot:null,isChangeOrigin:!1,colors:t,colorMapping:n,permanentUserData:r}),apply:(e,t)=>{const n=e.getMeta(s.Gt);if(void 0!==n){t=Object.assign({},t);for(const e in n)t[e]=n[e]}return t.isChangeOrigin=void 0!==n&&!!n.isChangeOrigin,null!==t.binding&&(void 0===n||null==n.snapshot&&null==n.prevSnapshot||E.Vs(0,(()=>{null==t.binding||t.binding.isDestroyed||(null==n.restore?t.binding._renderSnapshot(n.snapshot,n.prevSnapshot,t):(t.binding._renderSnapshot(n.snapshot,n.snapshot,t),delete t.restore,delete t.snapshot,delete t.prevSnapshot,t.binding._prosemirrorChanged(t.binding.prosemirrorView.state.doc)))}))),t}},view:t=>{const n=new I(e,t);return null!=a&&clearTimeout(a),a=E.Vs(0,(()=>{n._forceRerender(),t.dispatch(t.state.tr.setMeta(s.Gt,{binding:n})),o()})),{update:()=>{const e=l.getState(t.state);null==e.snapshot&&null==e.prevSnapshot&&(c||null!==t.state.doc.content.findDiffStart(t.state.doc.type.createAndFill().content))&&(c=!0,n._prosemirrorChanged(t.state.doc))},destroy:()=>{clearTimeout(a),n.destroy()}}}});return l},T=(e,t,n)=>{if(null!==t&&null!==t.anchor&&null!==t.head){const r=(0,y.SF)(n.doc,n.type,t.anchor,n.mapping),s=(0,y.SF)(n.doc,n.type,t.head,n.mapping);null!==r&&null!==s&&(e=e.setSelection(i.Bs.create(e.doc,r,s)))}},C=(e,t)=>({anchor:(0,y.JR)(t.selection.anchor,e.type,e.mapping),head:(0,y.JR)(t.selection.head,e.type,e.mapping)});class I{constructor(e,t){this.type=e,this.prosemirrorView=t,this.mux=o(),this.isDestroyed=!1,this.mapping=new Map,this._observeFunction=this._typeChanged.bind(this),this.doc=e.doc,this.beforeTransactionSelection=null,this.beforeAllTransactions=()=>{null===this.beforeTransactionSelection&&(this.beforeTransactionSelection=C(this,t.state))},this.afterAllTransactions=()=>{this.beforeTransactionSelection=null},this.doc.on("beforeAllTransactions",this.beforeAllTransactions),this.doc.on("afterAllTransactions",this.afterAllTransactions),e.observeDeep(this._observeFunction),this._domSelectionInView=null}get _tr(){return this.prosemirrorView.state.tr.setMeta("addToHistory",!1)}_isLocalCursorInView(){return!!this.prosemirrorView.hasFocus()&&(b.jU&&null===this._domSelectionInView&&(E.Vs(0,(()=>{this._domSelectionInView=null})),this._domSelectionInView=this._isDomSelectionInView()),this._domSelectionInView)}_isDomSelectionInView(){const e=this.prosemirrorView._root.getSelection(),t=this.prosemirrorView._root.createRange();t.setStart(e.anchorNode,e.anchorOffset),t.setEnd(e.focusNode,e.focusOffset);const n=t.getClientRects();0===n.length&&t.startContainer&&t.collapsed&&t.selectNodeContents(t.startContainer);const r=t.getBoundingClientRect(),s=v.JU.documentElement;return r.bottom>=0&&r.right>=0&&r.left<=(window.innerWidth||s.clientWidth||0)&&r.top<=(window.innerHeight||s.clientHeight||0)}renderSnapshot(e,t){t||(t=m.Ox(m.VG(),new Map)),this.prosemirrorView.dispatch(this._tr.setMeta(s.Gt,{snapshot:e,prevSnapshot:t}))}unrenderSnapshot(){this.mapping=new Map,this.mux((()=>{const e=this.type.toArray().map((e=>O(e,this.prosemirrorView.state.schema,this.mapping))).filter((e=>null!==e)),t=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(e),0,0));t.setMeta(s.Gt,{snapshot:null,prevSnapshot:null}),this.prosemirrorView.dispatch(t)}))}_forceRerender(){this.mapping=new Map,this.mux((()=>{const e=this.type.toArray().map((e=>O(e,this.prosemirrorView.state.schema,this.mapping))).filter((e=>null!==e)),t=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(e),0,0));this.prosemirrorView.dispatch(t.setMeta(s.Gt,{isChangeOrigin:!0}))}))}_renderSnapshot(e,t,n){e||(e=m.CO(this.doc)),this.mapping=new Map,this.mux((()=>{this.doc.transact((r=>{const i=n.permanentUserData;i&&i.dss.forEach((e=>{m.UQ(r,e,(e=>{}))}));const o=(e,t)=>{const r="added"===e?i.getUserByClientId(t.client):i.getUserByDeletedId(t);return{user:r,type:e,color:k(n.colorMapping,n.colors,r)}},c=m.ud(this.type,new m.aC(t.ds,e.sv)).map((n=>!n._item.deleted||_(n._item,e)||_(n._item,t)?O(n,this.prosemirrorView.state.schema,new Map,e,t,o):null)).filter((e=>null!==e)),l=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(c),0,0));this.prosemirrorView.dispatch(l.setMeta(s.Gt,{isChangeOrigin:!0}))}),s.Gt)}))}_typeChanged(e,t){const n=s.Gt.getState(this.prosemirrorView.state);0!==e.length&&null==n.snapshot&&null==n.prevSnapshot?this.mux((()=>{const e=(e,t)=>this.mapping.delete(t);m.UQ(t,t.deleteSet,(e=>e.constructor===m.ck&&this.mapping.delete(e.content.type))),t.changed.forEach(e),t.changedParentTypes.forEach(e);const n=this.type.toArray().map((e=>R(e,this.prosemirrorView.state.schema,this.mapping))).filter((e=>null!==e));let r=this._tr.replace(0,this.prosemirrorView.state.doc.content.size,new a.p2(new a.HY(n),0,0));T(r,this.beforeTransactionSelection,this),r=r.setMeta(s.Gt,{isChangeOrigin:!0}),null!==this.beforeTransactionSelection&&this._isLocalCursorInView()&&r.scrollIntoView(),this.prosemirrorView.dispatch(r)})):this.renderSnapshot(n.snapshot,n.prevSnapshot)}_prosemirrorChanged(e){this.mux((()=>{this.doc.transact((()=>{K(this.doc,this.type,e,this.mapping),this.beforeTransactionSelection=C(this,this.prosemirrorView.state)}),s.Gt)}))}destroy(){this.isDestroyed=!0,this.type.unobserveDeep(this._observeFunction),this.doc.off("beforeAllTransactions",this.beforeAllTransactions),this.doc.off("afterAllTransactions",this.afterAllTransactions)}}const R=(e,t,n,r,s,i)=>{const o=n.get(e);if(void 0===o){if(e instanceof m.lt)return O(e,t,n,r,s,i);throw g.Nw()}return o},O=(e,t,n,r,i,o)=>{const a=[],c=e=>{if(e.constructor===m.lt){const s=R(e,t,n,r,i,o);null!==s&&a.push(s)}else{const s=x(e,t,n,r,i,o);null!==s&&s.forEach((e=>{null!==e&&a.push(e)}))}};void 0===r||void 0===i?e.toArray().forEach(c):m.ud(e,new m.aC(i.ds,r.sv)).forEach(c);try{const s=e.getAttributes(r);void 0!==r&&(_(e._item,r)?_(e._item,i)||(s.ychange=o?o("added",e._item.id):{type:"added"}):s.ychange=o?o("removed",e._item.id):{type:"removed"});const c=t.node(e.nodeName,s,a);return n.set(e,c),c}catch(l){return e.doc.transact((t=>{e._item.delete(t)}),s.Gt),n.delete(e),null}},x=(e,t,n,r,i,o)=>{const a=[],c=e.toDelta(r,i,o);try{for(let e=0;e<c.length;e++){const n=c[e],r=[];for(const e in n.attributes)r.push(t.mark(e,n.attributes[e]));a.push(t.text(n.insert,r))}}catch(l){return e.doc.transact((t=>{e._item.delete(t)}),s.Gt),null}return a},N=(e,t)=>{const n=new m.eI,r=e.map((e=>({insert:e.text,attributes:H(e.marks)})));return n.applyDelta(r),t.set(n,e),n},D=(e,t)=>{const n=new m.lt(e.type.name);for(const r in e.attrs){const t=e.attrs[r];null!==t&&"ychange"!==r&&n.setAttribute(r,t)}return n.insert(0,B(e).map((e=>P(e,t)))),t.set(n,e),n},P=(e,t)=>e instanceof Array?N(e,t):D(e,t),L=e=>"object"===typeof e&&null!==e,M=(e,t)=>{const n=Object.keys(e).filter((t=>null!==e[t]));let r=n.length===Object.keys(t).filter((e=>null!==t[e])).length;for(let s=0;s<n.length&&r;s++){const i=n[s],o=e[i],a=t[i];r="ychange"===i||o===a||L(o)&&L(a)&&M(o,a)}return r},B=e=>{const t=e.content.content,n=[];for(let r=0;r<t.length;r++){const e=t[r];if(e.isText){const e=[];for(let n=t[r];r<t.length&&n.isText;n=t[++r])e.push(n);r--,n.push(e)}else n.push(e)}return n},U=(e,t)=>{const n=e.toDelta();return n.length===t.length&&n.every(((e,n)=>e.insert===t[n].text&&l.XP(e.attributes||{}).length===t[n].marks.length&&t[n].marks.every((t=>M(e.attributes[t.type.name]||{},t.attrs)))))},V=(e,t)=>{if(e instanceof m.lt&&!(t instanceof Array)&&q(e,t)){const n=B(t);return e._length===n.length&&M(e.getAttributes(),t.attrs)&&e.toArray().every(((e,t)=>V(e,n[t])))}return e instanceof m.eI&&t instanceof Array&&U(e,t)},F=(e,t)=>e===t||e instanceof Array&&t instanceof Array&&e.length===t.length&&e.every(((e,n)=>t[n]===e)),j=(e,t,n)=>{const r=e.toArray(),s=B(t),i=s.length,o=r.length,a=c.VV(o,i);let l=0,u=0,h=!1;for(;l<a;l++){const e=r[l],t=s[l];if(F(n.get(e),t))h=!0;else if(!V(e,t))break}for(;l+u<a;u++){const e=r[o-u-1],t=s[i-u-1];if(F(n.get(e),t))h=!0;else if(!V(e,t))break}return{equalityFactor:l+u,foundMappedChild:h}},z=e=>{let t="",n=e._start;const r={};while(null!==n)n.deleted||(n.countable&&n.content instanceof m.$_?t+=n.content.str:n.content instanceof m.MM&&(r[n.content.key]=null)),n=n.right;return{str:t,nAttrs:r}},$=(e,t,n)=>{n.set(e,t);const{nAttrs:r,str:s}=z(e),i=t.map((e=>({insert:e.text,attributes:Object.assign({},r,H(e.marks))}))),{insert:o,remove:a,index:c}=f(s,i.map((e=>e.insert)).join(""));e.delete(c,a),e.insert(c,o),e.applyDelta(i.map((e=>({retain:e.insert.length,attributes:e.attributes}))))},H=e=>{const t={};return e.forEach((e=>{"ychange"!==e.type.name&&(t[e.type.name]=e.attrs)})),t},K=(e,t,n,r)=>{if(t instanceof m.lt&&t.nodeName!==n.type.name)throw new Error("node name mismatch!");if(r.set(t,n),t instanceof m.lt){const e=t.getAttributes(),r=n.attrs;for(const n in r)null!==r[n]?e[n]!==r[n]&&"ychange"!==n&&t.setAttribute(n,r[n]):t.removeAttribute(n);for(const n in e)void 0===r[n]&&t.removeAttribute(n)}const i=B(n),o=i.length,a=t.toArray(),l=a.length,u=c.VV(o,l);let h=0,d=0;for(;h<u;h++){const e=a[h],t=i[h];if(!F(r.get(e),t)){if(!V(e,t))break;r.set(e,t)}}for(;d+h+1<u;d++){const e=a[l-d-1],t=i[o-d-1];if(!F(r.get(e),t)){if(!V(e,t))break;r.set(e,t)}}e.transact((()=>{while(l-h-d>0&&o-h-d>0){const n=a[h],s=i[h],c=a[l-d-1],u=i[o-d-1];if(n instanceof m.eI&&s instanceof Array)U(n,s)||$(n,s,r),h+=1;else{let i=n instanceof m.lt&&q(n,s),o=c instanceof m.lt&&q(c,u);if(i&&o){const e=j(n,s,r),t=j(c,u,r);e.foundMappedChild&&!t.foundMappedChild?o=!1:!e.foundMappedChild&&t.foundMappedChild||e.equalityFactor<t.equalityFactor?i=!1:o=!1}i?(K(e,n,s,r),h+=1):o?(K(e,c,u,r),d+=1):(t.delete(h,1),t.insert(h,[P(s,r)]),h+=1)}}const n=l-h-d;if(1===l&&0===o&&a[0]instanceof m.eI?a[0].delete(0,a[0].length):n>0&&t.delete(h,n),h+d<o){const e=[];for(let t=h;t<o-d;t++)e.push(P(i[t],r));t.insert(h,e)}}),s.Gt)},q=(e,t)=>!(t instanceof Array)&&e.nodeName===t.type.name,G=e=>{const t=s.Gk.getState(e).undoManager;if(null!=t)return t.undo(),!0},W=e=>{const t=s.Gk.getState(e).undoManager;if(null!=t)return t.redo(),!0},Y=new Set(["paragraph"]),J=(e,t)=>!(e instanceof m.ck)||!(e.content instanceof m.zc)||!(e.content.type instanceof m.xv||e.content.type instanceof m.lt&&t.has(e.content.type.nodeName))||0===e.content.type._length,Q=({protectedNodes:e=Y,trackedOrigins:t=[],undoManager:n=null}={})=>new i.Sy({key:s.Gk,state:{init:(r,i)=>{const o=s.Gt.getState(i),a=n||new m.H6(o.type,{trackedOrigins:new Set([s.Gt].concat(t)),deleteFilter:t=>J(t,e)});return{undoManager:a,prevSel:null,hasUndoOps:a.undoStack.length>0,hasRedoOps:a.redoStack.length>0}},apply:(e,t,n,r)=>{const i=s.Gt.getState(r).binding,o=t.undoManager,a=o.undoStack.length>0,c=o.redoStack.length>0;return i?{undoManager:o,prevSel:C(i,n),hasUndoOps:a,hasRedoOps:c}:a!==t.hasUndoOps||c!==t.hasRedoOps?Object.assign({},t,{hasUndoOps:o.undoStack.length>0,hasRedoOps:o.redoStack.length>0}):t}},view:e=>{const t=s.Gt.getState(e.state),n=s.Gk.getState(e.state).undoManager;return n.on("stack-item-added",(({stackItem:n})=>{const r=t.binding;r&&n.meta.set(r,s.Gk.getState(e.state).prevSel)})),n.on("stack-item-popped",(({stackItem:e})=>{const n=t.binding;n&&(n.beforeTransactionSelection=e.meta.get(n)||n.beforeTransactionSelection)})),{destroy:()=>{n.destroy()}}}}),X=r.hj.create({name:"collaboration",priority:1e3,addOptions(){return{document:null,field:"default",fragment:null}},onCreate(){this.editor.extensionManager.extensions.find((e=>"history"===e.name))&&console.warn('[tiptap warn]: "@tiptap/extension-collaboration" comes with its own history support and is not compatible with "@tiptap/extension-history".')},addCommands(){return{undo:()=>({tr:e,state:t,dispatch:n})=>{e.setMeta("preventDispatch",!0);const r=s.Gk.getState(t).undoManager;return 0!==r.undoStack.length&&(!n||G(t))},redo:()=>({tr:e,state:t,dispatch:n})=>{e.setMeta("preventDispatch",!0);const r=s.Gk.getState(t).undoManager;return 0!==r.redoStack.length&&(!n||W(t))}}},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo()}},addProseMirrorPlugins(){const e=this.options.fragment?this.options.fragment:this.options.document.getXmlFragment(this.options.field);return[A(e,{onFirstRender:()=>{var e;null===(e=this.options.onFirstRender)||void 0===e||e.apply(this)}}),Q()]}})},3778:function(e,t,n){"use strict";n.d(t,{ZP:function(){return o}});var r=n(2066);const s=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))$/,i=/(?:^|\s)((?:==)((?:[^~=]+))(?:==))/g,o=r.vc.create({name:"highlight",addOptions(){return{multicolor:!1,HTMLAttributes:{}}},addAttributes(){return this.options.multicolor?{color:{default:null,parseHTML:e=>e.getAttribute("data-color")||e.style.backgroundColor,renderHTML:e=>e.color?{"data-color":e.color,style:`background-color: ${e.color}; color: inherit`}:{}}}:{}},parseHTML(){return[{tag:"mark"}]},renderHTML({HTMLAttributes:e}){return["mark",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setHighlight:e=>({commands:t})=>t.setMark(this.name,e),toggleHighlight:e=>({commands:t})=>t.toggleMark(this.name,e),unsetHighlight:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-h":()=>this.editor.commands.toggleHighlight()}},addInputRules(){return[(0,r.Cf)({find:s,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:i,type:this.type})]}})},3747:function(e,t,n){"use strict";n.d(t,{ZP:function(){return i}});var r=n(2066);const s=/^\s*(\[([( |x])?\])\s$/,i=r.NB.create({name:"taskItem",addOptions(){return{nested:!1,HTMLAttributes:{}}},content(){return this.options.nested?"paragraph block*":"paragraph+"},defining:!0,addAttributes(){return{checked:{default:!1,keepOnSplit:!1,parseHTML:e=>"true"===e.getAttribute("data-checked"),renderHTML:e=>({"data-checked":e.checked})}}},parseHTML(){return[{tag:`li[data-type="${this.name}"]`,priority:51}]},renderHTML({node:e,HTMLAttributes:t}){return["li",(0,r.P1)(this.options.HTMLAttributes,t,{"data-type":this.name}),["label",["input",{type:"checkbox",checked:e.attrs.checked?"checked":null}],["span"]],["div",0]]},addKeyboardShortcuts(){const e={Enter:()=>this.editor.commands.splitListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)};return this.options.nested?{...e,Tab:()=>this.editor.commands.sinkListItem(this.name)}:e},addNodeView(){return({node:e,HTMLAttributes:t,getPos:n,editor:r})=>{const s=document.createElement("li"),i=document.createElement("label"),o=document.createElement("span"),a=document.createElement("input"),c=document.createElement("div");return i.contentEditable="false",a.type="checkbox",a.addEventListener("change",(t=>{if(!r.isEditable&&!this.options.onReadOnlyChecked)return void(a.checked=!a.checked);const{checked:s}=t.target;r.isEditable&&"function"===typeof n&&r.chain().focus(void 0,{scrollIntoView:!1}).command((({tr:e})=>{const t=n(),r=e.doc.nodeAt(t);return e.setNodeMarkup(t,void 0,{...null===r||void 0===r?void 0:r.attrs,checked:s}),!0})).run(),!r.isEditable&&this.options.onReadOnlyChecked&&(this.options.onReadOnlyChecked(e,s)||(a.checked=!a.checked))})),Object.entries(this.options.HTMLAttributes).forEach((([e,t])=>{s.setAttribute(e,t)})),s.dataset.checked=e.attrs.checked,e.attrs.checked&&a.setAttribute("checked","checked"),i.append(a,o),s.append(i,c),Object.entries(t).forEach((([e,t])=>{s.setAttribute(e,t)})),{dom:s,contentDOM:c,update:e=>e.type===this.type&&(s.dataset.checked=e.attrs.checked,e.attrs.checked?a.setAttribute("checked","checked"):a.removeAttribute("checked"),!0)}}},addInputRules(){return[(0,r.S0)({find:s,type:this.type,getAttributes:e=>({checked:"x"===e[e.length-1]})})]}})},1531:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(2066);const s=r.NB.create({name:"taskList",addOptions(){return{itemTypeName:"taskItem",HTMLAttributes:{}}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:`ul[data-type="${this.name}"]`,priority:51}]},renderHTML({HTMLAttributes:e}){return["ul",(0,r.P1)(this.options.HTMLAttributes,e,{"data-type":this.name}),0]},addCommands(){return{toggleTaskList:()=>({commands:e})=>e.toggleList(this.name,this.options.itemTypeName)}},addKeyboardShortcuts(){return{"Mod-Shift-9":()=>this.editor.commands.toggleTaskList()}}})},6355:function(e,t,n){"use strict";n.d(t,{Z:function(){return xe}});n(7658);var r=n(2066);const s=/^\s*>\s$/,i=r.NB.create({name:"blockquote",addOptions(){return{HTMLAttributes:{}}},content:"block+",group:"block",defining:!0,parseHTML(){return[{tag:"blockquote"}]},renderHTML({HTMLAttributes:e}){return["blockquote",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setBlockquote:()=>({commands:e})=>e.wrapIn(this.name),toggleBlockquote:()=>({commands:e})=>e.toggleWrap(this.name),unsetBlockquote:()=>({commands:e})=>e.lift(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-b":()=>this.editor.commands.toggleBlockquote()}},addInputRules(){return[(0,r.S0)({find:s,type:this.type})]}}),o=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))$/,a=/(?:^|\s)((?:\*\*)((?:[^*]+))(?:\*\*))/g,c=/(?:^|\s)((?:__)((?:[^__]+))(?:__))$/,l=/(?:^|\s)((?:__)((?:[^__]+))(?:__))/g,u=r.vc.create({name:"bold",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"strong"},{tag:"b",getAttrs:e=>"normal"!==e.style.fontWeight&&null},{style:"font-weight",getAttrs:e=>/^(bold(er)?|[5-9]\d{2,})$/.test(e)&&null}]},renderHTML({HTMLAttributes:e}){return["strong",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setBold:()=>({commands:e})=>e.setMark(this.name),toggleBold:()=>({commands:e})=>e.toggleMark(this.name),unsetBold:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-b":()=>this.editor.commands.toggleBold(),"Mod-B":()=>this.editor.commands.toggleBold()}},addInputRules(){return[(0,r.Cf)({find:o,type:this.type}),(0,r.Cf)({find:c,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:a,type:this.type}),(0,r.K9)({find:l,type:this.type})]}}),h=r.NB.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",(0,r.P1)(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),d=r.vc.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>{const t=e.hasAttribute("style");return!!t&&{}}}]},renderHTML({HTMLAttributes:e}){return["span",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=(0,r.Jo)(e,this.type),s=Object.entries(n).some((([,e])=>!!e));return!!s||t.unsetMark(this.name)}}}}),p=/^\s*([-+*])\s$/,f=r.NB.create({name:"bulletList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},parseHTML(){return[{tag:"ul"}]},renderHTML({HTMLAttributes:e}){return["ul",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleBulletList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(h.name,this.editor.getAttributes(d.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-8":()=>this.editor.commands.toggleBulletList()}},addInputRules(){let e=(0,r.S0)({find:p,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=(0,r.S0)({find:p,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(d.name),editor:this.editor})),[e]}}),g=/(?:^|\s)((?:`)((?:[^`]+))(?:`))$/,m=/(?:^|\s)((?:`)((?:[^`]+))(?:`))/g,y=r.vc.create({name:"code",addOptions(){return{HTMLAttributes:{}}},excludes:"_",code:!0,exitable:!0,parseHTML(){return[{tag:"code"}]},renderHTML({HTMLAttributes:e}){return["code",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setCode:()=>({commands:e})=>e.setMark(this.name),toggleCode:()=>({commands:e})=>e.toggleMark(this.name),unsetCode:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-e":()=>this.editor.commands.toggleCode()}},addInputRules(){return[(0,r.Cf)({find:g,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:m,type:this.type})]}});var w=n(157);const b=/^```([a-z]+)?[\s\n]$/,v=/^~~~([a-z]+)?[\s\n]$/,E=r.NB.create({name:"codeBlock",addOptions(){return{languageClassPrefix:"language-",exitOnTripleEnter:!0,exitOnArrowDown:!0,HTMLAttributes:{}}},content:"text*",marks:"",group:"block",code:!0,defining:!0,addAttributes(){return{language:{default:null,parseHTML:e=>{var t;const{languageClassPrefix:n}=this.options,r=[...(null===(t=e.firstElementChild)||void 0===t?void 0:t.classList)||[]],s=r.filter((e=>e.startsWith(n))).map((e=>e.replace(n,""))),i=s[0];return i||null},rendered:!1}}},parseHTML(){return[{tag:"pre",preserveWhitespace:"full"}]},renderHTML({node:e,HTMLAttributes:t}){return["pre",(0,r.P1)(this.options.HTMLAttributes,t),["code",{class:e.attrs.language?this.options.languageClassPrefix+e.attrs.language:null},0]]},addCommands(){return{setCodeBlock:e=>({commands:t})=>t.setNode(this.name,e),toggleCodeBlock:e=>({commands:t})=>t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return{"Mod-Alt-c":()=>this.editor.commands.toggleCodeBlock(),Backspace:()=>{const{empty:e,$anchor:t}=this.editor.state.selection,n=1===t.pos;return!(!e||t.parent.type.name!==this.name)&&(!(!n&&t.parent.textContent.length)&&this.editor.commands.clearNodes())},Enter:({editor:e})=>{if(!this.options.exitOnTripleEnter)return!1;const{state:t}=e,{selection:n}=t,{$from:r,empty:s}=n;if(!s||r.parent.type!==this.type)return!1;const i=r.parentOffset===r.parent.nodeSize-2,o=r.parent.textContent.endsWith("\n\n");return!(!i||!o)&&e.chain().command((({tr:e})=>(e.delete(r.pos-2,r.pos),!0))).exitCode().run()},ArrowDown:({editor:e})=>{if(!this.options.exitOnArrowDown)return!1;const{state:t}=e,{selection:n,doc:r}=t,{$from:s,empty:i}=n;if(!i||s.parent.type!==this.type)return!1;const o=s.parentOffset===s.parent.nodeSize-2;if(!o)return!1;const a=s.after();if(void 0===a)return!1;const c=r.nodeAt(a);return!c&&e.commands.exitCode()}}},addInputRules(){return[(0,r.zK)({find:b,type:this.type,getAttributes:e=>({language:e[1]})}),(0,r.zK)({find:v,type:this.type,getAttributes:e=>({language:e[1]})})]},addProseMirrorPlugins(){return[new w.Sy({key:new w.H$("codeBlockVSCodeHandler"),props:{handlePaste:(e,t)=>{if(!t.clipboardData)return!1;if(this.editor.isActive(this.type.name))return!1;const n=t.clipboardData.getData("text/plain"),r=t.clipboardData.getData("vscode-editor-data"),s=r?JSON.parse(r):void 0,i=null===s||void 0===s?void 0:s.mode;if(!n||!i)return!1;const{tr:o}=e.state;return o.replaceSelectionWith(this.type.create({language:i})),o.setSelection(w.Bs.near(o.doc.resolve(Math.max(0,o.selection.from-2)))),o.insertText(n.replace(/\r\n?/g,"\n")),o.setMeta("paste",!0),e.dispatch(o),!0}}})]}}),_=r.NB.create({name:"doc",topNode:!0,content:"block+"});var S=n(1382);function k(e={}){return new w.Sy({view(t){return new A(t,e)}})}class A{constructor(e,t){this.editorView=e,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=t.width||1,this.color=t.color||"black",this.class=t.class,this.handlers=["dragover","dragend","drop","dragleave"].map((t=>{let n=e=>{this[t](e)};return e.dom.addEventListener(t,n),{name:t,handler:n}}))}destroy(){this.handlers.forEach((({name:e,handler:t})=>this.editorView.dom.removeEventListener(e,t)))}update(e,t){null!=this.cursorPos&&t.doc!=e.state.doc&&(this.cursorPos>e.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(e){e!=this.cursorPos&&(this.cursorPos=e,null==e?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let e,t=this.editorView.state.doc.resolve(this.cursorPos),n=!t.parent.inlineContent;if(n){let n=t.nodeBefore,r=t.nodeAfter;if(n||r){let t=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(t){let s=t.getBoundingClientRect(),i=n?s.bottom:s.top;n&&r&&(i=(i+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),e={left:s.left,right:s.right,top:i-this.width/2,bottom:i+this.width/2}}}}if(!e){let t=this.editorView.coordsAtPos(this.cursorPos);e={left:t.left-this.width/2,right:t.left+this.width/2,top:t.top,bottom:t.bottom}}let r,s,i=this.editorView.dom.offsetParent;if(this.element||(this.element=i.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none; background-color: "+this.color),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!i||i==document.body&&"static"==getComputedStyle(i).position)r=-pageXOffset,s=-pageYOffset;else{let e=i.getBoundingClientRect();r=e.left-i.scrollLeft,s=e.top-i.scrollTop}this.element.style.left=e.left-r+"px",this.element.style.top=e.top-s+"px",this.element.style.width=e.right-e.left+"px",this.element.style.height=e.bottom-e.top+"px"}scheduleRemoval(e){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),e)}dragover(e){if(!this.editorView.editable)return;let t=this.editorView.posAtCoords({left:e.clientX,top:e.clientY}),n=t&&t.inside>=0&&this.editorView.state.doc.nodeAt(t.inside),r=n&&n.type.spec.disableDropCursor,s="function"==typeof r?r(this.editorView,t,e):r;if(t&&!s){let e=t.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let t=(0,S.nj)(this.editorView.state.doc,e,this.editorView.dragging.slice);null!=t&&(e=t)}this.setCursor(e),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(e){e.target!=this.editorView.dom&&this.editorView.dom.contains(e.relatedTarget)||this.setCursor(null)}}const T=r.hj.create({name:"dropCursor",addOptions(){return{color:"currentColor",width:1,class:void 0}},addProseMirrorPlugins(){return[k(this.options)]}});var C=n(203),I=n(1543),R=n(1460);class O extends w.Y1{constructor(e){super(e,e)}map(e,t){let n=e.resolve(t.map(this.head));return O.valid(n)?new O(n):w.Y1.near(n)}content(){return I.p2.empty}eq(e){return e instanceof O&&e.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new O(e.resolve(t.pos))}getBookmark(){return new x(this.anchor)}static valid(e){let t=e.parent;if(t.isTextblock||!N(e)||!D(e))return!1;let n=t.type.spec.allowGapCursor;if(null!=n)return n;let r=t.contentMatchAt(e.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(e,t,n=!1){e:for(;;){if(!n&&O.valid(e))return e;let r=e.pos,s=null;for(let n=e.depth;;n--){let i=e.node(n);if(t>0?e.indexAfter(n)<i.childCount:e.index(n)>0){s=i.child(t>0?e.indexAfter(n):e.index(n)-1);break}if(0==n)return null;r+=t;let o=e.doc.resolve(r);if(O.valid(o))return o}for(;;){let i=t>0?s.firstChild:s.lastChild;if(!i){if(s.isAtom&&!s.isText&&!w.qv.isSelectable(s)){e=e.doc.resolve(r+s.nodeSize*t),n=!1;continue e}break}s=i,r+=t;let o=e.doc.resolve(r);if(O.valid(o))return o}return null}}}O.prototype.visible=!1,O.findFrom=O.findGapCursorFrom,w.Y1.jsonID("gapcursor",O);class x{constructor(e){this.pos=e}map(e){return new x(e.map(this.pos))}resolve(e){let t=e.resolve(this.pos);return O.valid(t)?new O(t):w.Y1.near(t)}}function N(e){for(let t=e.depth;t>=0;t--){let n=e.index(t),r=e.node(t);if(0!=n)for(let e=r.child(n-1);;e=e.lastChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}function D(e){for(let t=e.depth;t>=0;t--){let n=e.indexAfter(t),r=e.node(t);if(n!=r.childCount)for(let e=r.child(n);;e=e.firstChild){if(0==e.childCount&&!e.inlineContent||e.isAtom||e.type.spec.isolating)return!0;if(e.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}function P(){return new w.Sy({props:{decorations:V,createSelectionBetween(e,t,n){return t.pos==n.pos&&O.valid(n)?new O(n):null},handleClick:B,handleKeyDown:L,handleDOMEvents:{beforeinput:U}}})}const L=(0,C.$)({ArrowLeft:M("horiz",-1),ArrowRight:M("horiz",1),ArrowUp:M("vert",-1),ArrowDown:M("vert",1)});function M(e,t){const n="vert"==e?t>0?"down":"up":t>0?"right":"left";return function(e,r,s){let i=e.selection,o=t>0?i.$to:i.$from,a=i.empty;if(i instanceof w.Bs){if(!s.endOfTextblock(n)||0==o.depth)return!1;a=!1,o=e.doc.resolve(t>0?o.after():o.before())}let c=O.findGapCursorFrom(o,t,a);return!!c&&(r&&r(e.tr.setSelection(new O(c))),!0)}}function B(e,t,n){if(!e||!e.editable)return!1;let r=e.state.doc.resolve(t);if(!O.valid(r))return!1;let s=e.posAtCoords({left:n.clientX,top:n.clientY});return!(s&&s.inside>-1&&w.qv.isSelectable(e.state.doc.nodeAt(s.inside)))&&(e.dispatch(e.state.tr.setSelection(new O(r))),!0)}function U(e,t){if("insertCompositionText"!=t.inputType||!(e.state.selection instanceof O))return!1;let{$from:n}=e.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(e.state.schema.nodes.text);if(!r)return!1;let s=I.HY.empty;for(let o=r.length-1;o>=0;o--)s=I.HY.from(r[o].createAndFill(null,s));let i=e.state.tr.replace(n.pos,n.pos,new I.p2(s,0,0));return i.setSelection(w.Bs.near(i.doc.resolve(n.pos+1))),e.dispatch(i),!1}function V(e){if(!(e.selection instanceof O))return null;let t=document.createElement("div");return t.className="ProseMirror-gapcursor",R.EH.create(e.doc,[R.p.widget(e.selection.head,t,{key:"gapcursor"})])}const F=r.hj.create({name:"gapCursor",addProseMirrorPlugins(){return[P()]},extendNodeSchema(e){var t;const n={name:e.name,options:e.options,storage:e.storage};return{allowGapCursor:null!==(t=(0,r.nU)((0,r.Nl)(e,"allowGapCursor",n)))&&void 0!==t?t:null}}}),j=r.NB.create({name:"hardBreak",addOptions(){return{keepMarks:!0,HTMLAttributes:{}}},inline:!0,group:"inline",selectable:!1,parseHTML(){return[{tag:"br"}]},renderHTML({HTMLAttributes:e}){return["br",(0,r.P1)(this.options.HTMLAttributes,e)]},renderText(){return"\n"},addCommands(){return{setHardBreak:()=>({commands:e,chain:t,state:n,editor:r})=>e.first([()=>e.exitCode(),()=>e.command((()=>{const{selection:e,storedMarks:s}=n;if(e.$from.parent.type.spec.isolating)return!1;const{keepMarks:i}=this.options,{splittableMarks:o}=r.extensionManager,a=s||e.$to.parentOffset&&e.$from.marks();return t().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{if(t&&a&&i){const t=a.filter((e=>o.includes(e.type.name)));e.ensureMarks(t)}return!0})).run()}))])}},addKeyboardShortcuts(){return{"Mod-Enter":()=>this.editor.commands.setHardBreak(),"Shift-Enter":()=>this.editor.commands.setHardBreak()}}}),z=r.NB.create({name:"heading",addOptions(){return{levels:[1,2,3,4,5,6],HTMLAttributes:{}}},content:"inline*",group:"block",defining:!0,addAttributes(){return{level:{default:1,rendered:!1}}},parseHTML(){return this.options.levels.map((e=>({tag:`h${e}`,attrs:{level:e}})))},renderHTML({node:e,HTMLAttributes:t}){const n=this.options.levels.includes(e.attrs.level),s=n?e.attrs.level:this.options.levels[0];return[`h${s}`,(0,r.P1)(this.options.HTMLAttributes,t),0]},addCommands(){return{setHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.setNode(this.name,e),toggleHeading:e=>({commands:t})=>!!this.options.levels.includes(e.level)&&t.toggleNode(this.name,"paragraph",e)}},addKeyboardShortcuts(){return this.options.levels.reduce(((e,t)=>({...e,[`Mod-Alt-${t}`]:()=>this.editor.commands.toggleHeading({level:t})})),{})},addInputRules(){return this.options.levels.map((e=>(0,r.zK)({find:new RegExp(`^(#{1,${e}})\\s$`),type:this.type,getAttributes:{level:e}})))}});var $=200,H=function(){};H.prototype.append=function(e){return e.length?(e=H.from(e),!this.length&&e||e.length<$&&this.leafAppend(e)||this.length<$&&e.leafPrepend(this)||this.appendInner(e)):this},H.prototype.prepend=function(e){return e.length?H.from(e).append(this):this},H.prototype.appendInner=function(e){return new q(this,e)},H.prototype.slice=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=this.length),e>=t?H.empty:this.sliceInner(Math.max(0,e),Math.min(this.length,t))},H.prototype.get=function(e){if(!(e<0||e>=this.length))return this.getInner(e)},H.prototype.forEach=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length),t<=n?this.forEachInner(e,t,n,0):this.forEachInvertedInner(e,t,n,0)},H.prototype.map=function(e,t,n){void 0===t&&(t=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(t,n){return r.push(e(t,n))}),t,n),r},H.from=function(e){return e instanceof H?e:e&&e.length?new K(e):H.empty};var K=function(e){function t(t){e.call(this),this.values=t}e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t;var n={length:{configurable:!0},depth:{configurable:!0}};return t.prototype.flatten=function(){return this.values},t.prototype.sliceInner=function(e,n){return 0==e&&n==this.length?this:new t(this.values.slice(e,n))},t.prototype.getInner=function(e){return this.values[e]},t.prototype.forEachInner=function(e,t,n,r){for(var s=t;s<n;s++)if(!1===e(this.values[s],r+s))return!1},t.prototype.forEachInvertedInner=function(e,t,n,r){for(var s=t-1;s>=n;s--)if(!1===e(this.values[s],r+s))return!1},t.prototype.leafAppend=function(e){if(this.length+e.length<=$)return new t(this.values.concat(e.flatten()))},t.prototype.leafPrepend=function(e){if(this.length+e.length<=$)return new t(e.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(t.prototype,n),t}(H);H.empty=new K([]);var q=function(e){function t(t,n){e.call(this),this.left=t,this.right=n,this.length=t.length+n.length,this.depth=Math.max(t.depth,n.depth)+1}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},t.prototype.getInner=function(e){return e<this.left.length?this.left.get(e):this.right.get(e-this.left.length)},t.prototype.forEachInner=function(e,t,n,r){var s=this.left.length;return!(t<s&&!1===this.left.forEachInner(e,t,Math.min(n,s),r))&&(!(n>s&&!1===this.right.forEachInner(e,Math.max(t-s,0),Math.min(this.length,n)-s,r+s))&&void 0)},t.prototype.forEachInvertedInner=function(e,t,n,r){var s=this.left.length;return!(t>s&&!1===this.right.forEachInvertedInner(e,t-s,Math.max(n,s)-s,r+s))&&(!(n<s&&!1===this.left.forEachInvertedInner(e,Math.min(t,s),n,r))&&void 0)},t.prototype.sliceInner=function(e,t){if(0==e&&t==this.length)return this;var n=this.left.length;return t<=n?this.left.slice(e,t):e>=n?this.right.slice(e-n,t-n):this.left.slice(e,n).append(this.right.slice(0,t-n))},t.prototype.leafAppend=function(e){var n=this.right.leafAppend(e);if(n)return new t(this.left,n)},t.prototype.leafPrepend=function(e){var n=this.left.leafPrepend(e);if(n)return new t(n,this.right)},t.prototype.appendInner=function(e){return this.left.depth>=Math.max(this.right.depth,e.depth)+1?new t(this.left,new t(this.right,e)):new t(this,e)},t}(H),G=H,W=G;const Y=500;class J{constructor(e,t){this.items=e,this.eventCount=t}popEvent(e,t){if(0==this.eventCount)return null;let n,r,s=this.items.length;for(;;s--){let e=this.items.get(s-1);if(e.selection){--s;break}}t&&(n=this.remapping(s,this.items.length),r=n.maps.length);let i,o,a=e.tr,c=[],l=[];return this.items.forEach(((e,t)=>{if(!e.step)return n||(n=this.remapping(s,t+1),r=n.maps.length),r--,void l.push(e);if(n){l.push(new X(e.map));let t,s=e.step.map(n.slice(r));s&&a.maybeStep(s).doc&&(t=a.mapping.maps[a.mapping.maps.length-1],c.push(new X(t,void 0,void 0,c.length+l.length))),r--,t&&n.appendMap(t,r)}else a.maybeStep(e.step);return e.selection?(i=n?e.selection.map(n.slice(r)):e.selection,o=new J(this.items.slice(0,s).append(l.reverse().concat(c)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:o,transform:a,selection:i}}addTransform(e,t,n,r){let s=[],i=this.eventCount,o=this.items,a=!r&&o.length?o.get(o.length-1):null;for(let l=0;l<e.steps.length;l++){let n,c=e.steps[l].invert(e.docs[l]),u=new X(e.mapping.maps[l],c,t);(n=a&&a.merge(u))&&(u=n,l?s.pop():o=o.slice(0,o.length-1)),s.push(u),t&&(i++,t=void 0),r||(a=u)}let c=i-n.depth;return c>ee&&(o=Q(o,c),i-=c),new J(o.append(s),i)}remapping(e,t){let n=new S.vs;return this.items.forEach(((t,r)=>{let s=null!=t.mirrorOffset&&r-t.mirrorOffset>=e?n.maps.length-t.mirrorOffset:void 0;n.appendMap(t.map,s)}),e,t),n}addMaps(e){return 0==this.eventCount?this:new J(this.items.append(e.map((e=>new X(e)))),this.eventCount)}rebased(e,t){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-t),s=e.mapping,i=e.steps.length,o=this.eventCount;this.items.forEach((e=>{e.selection&&o--}),r);let a=t;this.items.forEach((t=>{let r=s.getMirror(--a);if(null==r)return;i=Math.min(i,r);let c=s.maps[r];if(t.step){let i=e.steps[r].invert(e.docs[r]),l=t.selection&&t.selection.map(s.slice(a+1,r));l&&o++,n.push(new X(c,i,l))}else n.push(new X(c))}),r);let c=[];for(let h=t;h<i;h++)c.push(new X(s.maps[h]));let l=this.items.slice(0,r).append(c).append(n),u=new J(l,o);return u.emptyItemCount()>Y&&(u=u.compress(this.items.length-n.length)),u}emptyItemCount(){let e=0;return this.items.forEach((t=>{t.step||e++})),e}compress(e=this.items.length){let t=this.remapping(0,e),n=t.maps.length,r=[],s=0;return this.items.forEach(((i,o)=>{if(o>=e)r.push(i),i.selection&&s++;else if(i.step){let e=i.step.map(t.slice(n)),o=e&&e.getMap();if(n--,o&&t.appendMap(o,n),e){let a=i.selection&&i.selection.map(t.slice(n));a&&s++;let c,l=new X(o.invert(),e,a),u=r.length-1;(c=r.length&&r[u].merge(l))?r[u]=c:r.push(l)}}else i.map&&n--}),this.items.length,0),new J(W.from(r.reverse()),s)}}function Q(e,t){let n;return e.forEach(((e,r)=>{if(e.selection&&0==t--)return n=r,!1})),e.slice(n)}J.empty=new J(W.empty,0);class X{constructor(e,t,n,r){this.map=e,this.step=t,this.selection=n,this.mirrorOffset=r}merge(e){if(this.step&&e.step&&!e.selection){let t=e.step.merge(this.step);if(t)return new X(t.getMap().invert(),t,this.selection)}}}class Z{constructor(e,t,n,r){this.done=e,this.undone=t,this.prevRanges=n,this.prevTime=r}}const ee=20;function te(e,t,n,r){let s,i=n.getMeta(le);if(i)return i.historyState;n.getMeta(ue)&&(e=new Z(e.done,e.undone,null,0));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return e;if(o&&o.getMeta(le))return o.getMeta(le).redo?new Z(e.done.addTransform(n,void 0,r,ce(t)),e.undone,re(n.mapping.maps[n.steps.length-1]),e.prevTime):new Z(e.done,e.undone.addTransform(n,void 0,r,ce(t)),null,e.prevTime);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(s=n.getMeta("rebased"))?new Z(e.done.rebased(n,s),e.undone.rebased(n,s),se(e.prevRanges,n.mapping),e.prevTime):new Z(e.done.addMaps(n.mapping.maps),e.undone.addMaps(n.mapping.maps),se(e.prevRanges,n.mapping),e.prevTime);{let s=0==e.prevTime||!o&&(e.prevTime<(n.time||0)-r.newGroupDelay||!ne(n,e.prevRanges)),i=o?se(e.prevRanges,n.mapping):re(n.mapping.maps[n.steps.length-1]);return new Z(e.done.addTransform(n,s?t.selection.getBookmark():void 0,r,ce(t)),J.empty,i,n.time)}}function ne(e,t){if(!t)return!1;if(!e.docChanged)return!0;let n=!1;return e.mapping.maps[0].forEach(((e,r)=>{for(let s=0;s<t.length;s+=2)e<=t[s+1]&&r>=t[s]&&(n=!0)})),n}function re(e){let t=[];return e.forEach(((e,n,r,s)=>t.push(r,s))),t}function se(e,t){if(!e)return null;let n=[];for(let r=0;r<e.length;r+=2){let s=t.map(e[r],1),i=t.map(e[r+1],-1);s<=i&&n.push(s,i)}return n}function ie(e,t,n,r){let s=ce(t),i=le.get(t).spec.config,o=(r?e.undone:e.done).popEvent(t,s);if(!o)return;let a=o.selection.resolve(o.transform.doc),c=(r?e.done:e.undone).addTransform(o.transform,t.selection.getBookmark(),i,s),l=new Z(r?c:o.remaining,r?o.remaining:c,null,0);n(o.transform.setSelection(a).setMeta(le,{redo:r,historyState:l}).scrollIntoView())}let oe=!1,ae=null;function ce(e){let t=e.plugins;if(ae!=t){oe=!1,ae=t;for(let e=0;e<t.length;e++)if(t[e].spec.historyPreserveItems){oe=!0;break}}return oe}const le=new w.H$("history"),ue=new w.H$("closeHistory");function he(e={}){return e={depth:e.depth||100,newGroupDelay:e.newGroupDelay||500},new w.Sy({key:le,state:{init(){return new Z(J.empty,J.empty,null,0)},apply(t,n,r){return te(n,r,t,e)}},config:e,props:{handleDOMEvents:{beforeinput(e,t){let n=t.inputType,r="historyUndo"==n?de:"historyRedo"==n?pe:null;return!!r&&(t.preventDefault(),r(e.state,e.dispatch))}}}})}const de=(e,t)=>{let n=le.getState(e);return!(!n||0==n.done.eventCount)&&(t&&ie(n,e,t,!1),!0)},pe=(e,t)=>{let n=le.getState(e);return!(!n||0==n.undone.eventCount)&&(t&&ie(n,e,t,!0),!0)};const fe=r.hj.create({name:"history",addOptions(){return{depth:100,newGroupDelay:500}},addCommands(){return{undo:()=>({state:e,dispatch:t})=>de(e,t),redo:()=>({state:e,dispatch:t})=>pe(e,t)}},addProseMirrorPlugins(){return[he(this.options)]},addKeyboardShortcuts(){return{"Mod-z":()=>this.editor.commands.undo(),"Mod-y":()=>this.editor.commands.redo(),"Shift-Mod-z":()=>this.editor.commands.redo(),"Mod-я":()=>this.editor.commands.undo(),"Shift-Mod-я":()=>this.editor.commands.redo()}}}),ge=r.NB.create({name:"horizontalRule",addOptions(){return{HTMLAttributes:{}}},group:"block",parseHTML(){return[{tag:"hr"}]},renderHTML({HTMLAttributes:e}){return["hr",(0,r.P1)(this.options.HTMLAttributes,e)]},addCommands(){return{setHorizontalRule:()=>({chain:e})=>e().insertContent({type:this.name}).command((({tr:e,dispatch:t})=>{var n;if(t){const{$to:t}=e.selection,r=t.end();if(t.nodeAfter)e.setSelection(w.Bs.create(e.doc,t.pos));else{const s=null===(n=t.parent.type.contentMatch.defaultType)||void 0===n?void 0:n.create();s&&(e.insert(r,s),e.setSelection(w.Bs.create(e.doc,r)))}e.scrollIntoView()}return!0})).run()}},addInputRules(){return[(0,r.x2)({find:/^(?:---|—-|___\s|\*\*\*\s)$/,type:this.type})]}}),me=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))$/,ye=/(?:^|\s)((?:\*)((?:[^*]+))(?:\*))/g,we=/(?:^|\s)((?:_)((?:[^_]+))(?:_))$/,be=/(?:^|\s)((?:_)((?:[^_]+))(?:_))/g,ve=r.vc.create({name:"italic",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"em"},{tag:"i",getAttrs:e=>"normal"!==e.style.fontStyle&&null},{style:"font-style=italic"}]},renderHTML({HTMLAttributes:e}){return["em",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setItalic:()=>({commands:e})=>e.setMark(this.name),toggleItalic:()=>({commands:e})=>e.toggleMark(this.name),unsetItalic:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-i":()=>this.editor.commands.toggleItalic(),"Mod-I":()=>this.editor.commands.toggleItalic()}},addInputRules(){return[(0,r.Cf)({find:me,type:this.type}),(0,r.Cf)({find:we,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:ye,type:this.type}),(0,r.K9)({find:be,type:this.type})]}}),Ee=r.NB.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",(0,r.P1)(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),_e=r.NB.create({name:"listItem",addOptions(){return{HTMLAttributes:{}}},content:"paragraph block*",defining:!0,parseHTML(){return[{tag:"li"}]},renderHTML({HTMLAttributes:e}){return["li",(0,r.P1)(this.options.HTMLAttributes,e),0]},addKeyboardShortcuts(){return{Enter:()=>this.editor.commands.splitListItem(this.name),Tab:()=>this.editor.commands.sinkListItem(this.name),"Shift-Tab":()=>this.editor.commands.liftListItem(this.name)}}}),Se=r.vc.create({name:"textStyle",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"span",getAttrs:e=>{const t=e.hasAttribute("style");return!!t&&{}}}]},renderHTML({HTMLAttributes:e}){return["span",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{removeEmptyTextStyle:()=>({state:e,commands:t})=>{const n=(0,r.Jo)(e,this.type),s=Object.entries(n).some((([,e])=>!!e));return!!s||t.unsetMark(this.name)}}}}),ke=/^(\d+)\.\s$/,Ae=r.NB.create({name:"orderedList",addOptions(){return{itemTypeName:"listItem",HTMLAttributes:{},keepMarks:!1,keepAttributes:!1}},group:"block list",content(){return`${this.options.itemTypeName}+`},addAttributes(){return{start:{default:1,parseHTML:e=>e.hasAttribute("start")?parseInt(e.getAttribute("start")||"",10):1}}},parseHTML(){return[{tag:"ol"}]},renderHTML({HTMLAttributes:e}){const{start:t,...n}=e;return 1===t?["ol",(0,r.P1)(this.options.HTMLAttributes,n),0]:["ol",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{toggleOrderedList:()=>({commands:e,chain:t})=>this.options.keepAttributes?t().toggleList(this.name,this.options.itemTypeName,this.options.keepMarks).updateAttributes(_e.name,this.editor.getAttributes(Se.name)).run():e.toggleList(this.name,this.options.itemTypeName,this.options.keepMarks)}},addKeyboardShortcuts(){return{"Mod-Shift-7":()=>this.editor.commands.toggleOrderedList()}},addInputRules(){let e=(0,r.S0)({find:ke,type:this.type});return(this.options.keepMarks||this.options.keepAttributes)&&(e=(0,r.S0)({find:ke,type:this.type,keepMarks:this.options.keepMarks,keepAttributes:this.options.keepAttributes,getAttributes:()=>this.editor.getAttributes(Se.name),editor:this.editor})),[e]}}),Te=r.NB.create({name:"paragraph",priority:1e3,addOptions(){return{HTMLAttributes:{}}},group:"block",content:"inline*",parseHTML(){return[{tag:"p"}]},renderHTML({HTMLAttributes:e}){return["p",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setParagraph:()=>({commands:e})=>e.setNode(this.name)}},addKeyboardShortcuts(){return{"Mod-Alt-0":()=>this.editor.commands.setParagraph()}}}),Ce=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))$/,Ie=/(?:^|\s)((?:~~)((?:[^~]+))(?:~~))/g,Re=r.vc.create({name:"strike",addOptions(){return{HTMLAttributes:{}}},parseHTML(){return[{tag:"s"},{tag:"del"},{tag:"strike"},{style:"text-decoration",consuming:!1,getAttrs:e=>!!e.includes("line-through")&&{}}]},renderHTML({HTMLAttributes:e}){return["s",(0,r.P1)(this.options.HTMLAttributes,e),0]},addCommands(){return{setStrike:()=>({commands:e})=>e.setMark(this.name),toggleStrike:()=>({commands:e})=>e.toggleMark(this.name),unsetStrike:()=>({commands:e})=>e.unsetMark(this.name)}},addKeyboardShortcuts(){return{"Mod-Shift-x":()=>this.editor.commands.toggleStrike()}},addInputRules(){return[(0,r.Cf)({find:Ce,type:this.type})]},addPasteRules(){return[(0,r.K9)({find:Ie,type:this.type})]}}),Oe=r.NB.create({name:"text",group:"inline"}),xe=r.hj.create({name:"starterKit",addExtensions(){var e,t,n,r,s,o,a,c,l,h,d,p,g,m,w,b,v,S;const k=[];return!1!==this.options.blockquote&&k.push(i.configure(null===(e=this.options)||void 0===e?void 0:e.blockquote)),!1!==this.options.bold&&k.push(u.configure(null===(t=this.options)||void 0===t?void 0:t.bold)),!1!==this.options.bulletList&&k.push(f.configure(null===(n=this.options)||void 0===n?void 0:n.bulletList)),!1!==this.options.code&&k.push(y.configure(null===(r=this.options)||void 0===r?void 0:r.code)),!1!==this.options.codeBlock&&k.push(E.configure(null===(s=this.options)||void 0===s?void 0:s.codeBlock)),!1!==this.options.document&&k.push(_.configure(null===(o=this.options)||void 0===o?void 0:o.document)),!1!==this.options.dropcursor&&k.push(T.configure(null===(a=this.options)||void 0===a?void 0:a.dropcursor)),!1!==this.options.gapcursor&&k.push(F.configure(null===(c=this.options)||void 0===c?void 0:c.gapcursor)),!1!==this.options.hardBreak&&k.push(j.configure(null===(l=this.options)||void 0===l?void 0:l.hardBreak)),!1!==this.options.heading&&k.push(z.configure(null===(h=this.options)||void 0===h?void 0:h.heading)),!1!==this.options.history&&k.push(fe.configure(null===(d=this.options)||void 0===d?void 0:d.history)),!1!==this.options.horizontalRule&&k.push(ge.configure(null===(p=this.options)||void 0===p?void 0:p.horizontalRule)),!1!==this.options.italic&&k.push(ve.configure(null===(g=this.options)||void 0===g?void 0:g.italic)),!1!==this.options.listItem&&k.push(Ee.configure(null===(m=this.options)||void 0===m?void 0:m.listItem)),!1!==this.options.orderedList&&k.push(Ae.configure(null===(w=this.options)||void 0===w?void 0:w.orderedList)),!1!==this.options.paragraph&&k.push(Te.configure(null===(b=this.options)||void 0===b?void 0:b.paragraph)),!1!==this.options.strike&&k.push(Re.configure(null===(v=this.options)||void 0===v?void 0:v.strike)),!1!==this.options.text&&k.push(Oe.configure(null===(S=this.options)||void 0===S?void 0:S.text)),k}})},7200:function(e,t,n){"use strict";n.d(t,{ML:function(){return Lr},kg:function(){return Mr}});n(7658);var r=n(2066),s=n(157);function i(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function o(e){var t=i(e).Element;return e instanceof t||e instanceof Element}function a(e){var t=i(e).HTMLElement;return e instanceof t||e instanceof HTMLElement}function c(e){if("undefined"===typeof ShadowRoot)return!1;var t=i(e).ShadowRoot;return e instanceof t||e instanceof ShadowRoot}var l=Math.max,u=Math.min,h=Math.round;function d(){var e=navigator.userAgentData;return null!=e&&e.brands?e.brands.map((function(e){return e.brand+"/"+e.version})).join(" "):navigator.userAgent}function p(){return!/^((?!chrome|android).)*safari/i.test(d())}function f(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!1);var r=e.getBoundingClientRect(),s=1,c=1;t&&a(e)&&(s=e.offsetWidth>0&&h(r.width)/e.offsetWidth||1,c=e.offsetHeight>0&&h(r.height)/e.offsetHeight||1);var l=o(e)?i(e):window,u=l.visualViewport,d=!p()&&n,f=(r.left+(d&&u?u.offsetLeft:0))/s,g=(r.top+(d&&u?u.offsetTop:0))/c,m=r.width/s,y=r.height/c;return{width:m,height:y,top:g,right:f+m,bottom:g+y,left:f,x:f,y:g}}function g(e){var t=i(e),n=t.pageXOffset,r=t.pageYOffset;return{scrollLeft:n,scrollTop:r}}function m(e){return{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}}function y(e){return e!==i(e)&&a(e)?m(e):g(e)}function w(e){return e?(e.nodeName||"").toLowerCase():null}function b(e){return((o(e)?e.ownerDocument:e.document)||window.document).documentElement}function v(e){return f(b(e)).left+g(e).scrollLeft}function E(e){return i(e).getComputedStyle(e)}function _(e){var t=E(e),n=t.overflow,r=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(n+s+r)}function S(e){var t=e.getBoundingClientRect(),n=h(t.width)/e.offsetWidth||1,r=h(t.height)/e.offsetHeight||1;return 1!==n||1!==r}function k(e,t,n){void 0===n&&(n=!1);var r=a(t),s=a(t)&&S(t),i=b(t),o=f(e,s,n),c={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!n)&&(("body"!==w(t)||_(i))&&(c=y(t)),a(t)?(l=f(t,!0),l.x+=t.clientLeft,l.y+=t.clientTop):i&&(l.x=v(i))),{x:o.left+c.scrollLeft-l.x,y:o.top+c.scrollTop-l.y,width:o.width,height:o.height}}function A(e){var t=f(e),n=e.offsetWidth,r=e.offsetHeight;return Math.abs(t.width-n)<=1&&(n=t.width),Math.abs(t.height-r)<=1&&(r=t.height),{x:e.offsetLeft,y:e.offsetTop,width:n,height:r}}function T(e){return"html"===w(e)?e:e.assignedSlot||e.parentNode||(c(e)?e.host:null)||b(e)}function C(e){return["html","body","#document"].indexOf(w(e))>=0?e.ownerDocument.body:a(e)&&_(e)?e:C(T(e))}function I(e,t){var n;void 0===t&&(t=[]);var r=C(e),s=r===(null==(n=e.ownerDocument)?void 0:n.body),o=i(r),a=s?[o].concat(o.visualViewport||[],_(r)?r:[]):r,c=t.concat(a);return s?c:c.concat(I(T(a)))}function R(e){return["table","td","th"].indexOf(w(e))>=0}function O(e){return a(e)&&"fixed"!==E(e).position?e.offsetParent:null}function x(e){var t=/firefox/i.test(d()),n=/Trident/i.test(d());if(n&&a(e)){var r=E(e);if("fixed"===r.position)return null}var s=T(e);c(s)&&(s=s.host);while(a(s)&&["html","body"].indexOf(w(s))<0){var i=E(s);if("none"!==i.transform||"none"!==i.perspective||"paint"===i.contain||-1!==["transform","perspective"].indexOf(i.willChange)||t&&"filter"===i.willChange||t&&i.filter&&"none"!==i.filter)return s;s=s.parentNode}return null}function N(e){var t=i(e),n=O(e);while(n&&R(n)&&"static"===E(n).position)n=O(n);return n&&("html"===w(n)||"body"===w(n)&&"static"===E(n).position)?t:n||x(e)||t}var D="top",P="bottom",L="right",M="left",B="auto",U=[D,P,L,M],V="start",F="end",j="clippingParents",z="viewport",$="popper",H="reference",K=U.reduce((function(e,t){return e.concat([t+"-"+V,t+"-"+F])}),[]),q=[].concat(U,[B]).reduce((function(e,t){return e.concat([t,t+"-"+V,t+"-"+F])}),[]),G="beforeRead",W="read",Y="afterRead",J="beforeMain",Q="main",X="afterMain",Z="beforeWrite",ee="write",te="afterWrite",ne=[G,W,Y,J,Q,X,Z,ee,te];function re(e){var t=new Map,n=new Set,r=[];function s(e){n.add(e.name);var i=[].concat(e.requires||[],e.requiresIfExists||[]);i.forEach((function(e){if(!n.has(e)){var r=t.get(e);r&&s(r)}})),r.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){n.has(e.name)||s(e)})),r}function se(e){var t=re(e);return ne.reduce((function(e,n){return e.concat(t.filter((function(e){return e.phase===n})))}),[])}function ie(e){var t;return function(){return t||(t=new Promise((function(n){Promise.resolve().then((function(){t=void 0,n(e())}))}))),t}}function oe(e){var t=e.reduce((function(e,t){var n=e[t.name];return e[t.name]=n?Object.assign({},n,t,{options:Object.assign({},n.options,t.options),data:Object.assign({},n.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}var ae={placement:"bottom",modifiers:[],strategy:"absolute"};function ce(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return!t.some((function(e){return!(e&&"function"===typeof e.getBoundingClientRect)}))}function le(e){void 0===e&&(e={});var t=e,n=t.defaultModifiers,r=void 0===n?[]:n,s=t.defaultOptions,i=void 0===s?ae:s;return function(e,t,n){void 0===n&&(n=i);var s={placement:"bottom",orderedModifiers:[],options:Object.assign({},ae,i),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},a=[],c=!1,l={state:s,setOptions:function(n){var a="function"===typeof n?n(s.options):n;h(),s.options=Object.assign({},i,s.options,a),s.scrollParents={reference:o(e)?I(e):e.contextElement?I(e.contextElement):[],popper:I(t)};var c=se(oe([].concat(r,s.options.modifiers)));return s.orderedModifiers=c.filter((function(e){return e.enabled})),u(),l.update()},forceUpdate:function(){if(!c){var e=s.elements,t=e.reference,n=e.popper;if(ce(t,n)){s.rects={reference:k(t,N(n),"fixed"===s.options.strategy),popper:A(n)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(e){return s.modifiersData[e.name]=Object.assign({},e.data)}));for(var r=0;r<s.orderedModifiers.length;r++)if(!0!==s.reset){var i=s.orderedModifiers[r],o=i.fn,a=i.options,u=void 0===a?{}:a,h=i.name;"function"===typeof o&&(s=o({state:s,options:u,name:h,instance:l})||s)}else s.reset=!1,r=-1}}},update:ie((function(){return new Promise((function(e){l.forceUpdate(),e(s)}))})),destroy:function(){h(),c=!0}};if(!ce(e,t))return l;function u(){s.orderedModifiers.forEach((function(e){var t=e.name,n=e.options,r=void 0===n?{}:n,i=e.effect;if("function"===typeof i){var o=i({state:s,name:t,instance:l,options:r}),c=function(){};a.push(o||c)}}))}function h(){a.forEach((function(e){return e()})),a=[]}return l.setOptions(n).then((function(e){!c&&n.onFirstUpdate&&n.onFirstUpdate(e)})),l}}var ue={passive:!0};function he(e){var t=e.state,n=e.instance,r=e.options,s=r.scroll,o=void 0===s||s,a=r.resize,c=void 0===a||a,l=i(t.elements.popper),u=[].concat(t.scrollParents.reference,t.scrollParents.popper);return o&&u.forEach((function(e){e.addEventListener("scroll",n.update,ue)})),c&&l.addEventListener("resize",n.update,ue),function(){o&&u.forEach((function(e){e.removeEventListener("scroll",n.update,ue)})),c&&l.removeEventListener("resize",n.update,ue)}}var de={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:he,data:{}};function pe(e){return e.split("-")[0]}function fe(e){return e.split("-")[1]}function ge(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function me(e){var t,n=e.reference,r=e.element,s=e.placement,i=s?pe(s):null,o=s?fe(s):null,a=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(i){case D:t={x:a,y:n.y-r.height};break;case P:t={x:a,y:n.y+n.height};break;case L:t={x:n.x+n.width,y:c};break;case M:t={x:n.x-r.width,y:c};break;default:t={x:n.x,y:n.y}}var l=i?ge(i):null;if(null!=l){var u="y"===l?"height":"width";switch(o){case V:t[l]=t[l]-(n[u]/2-r[u]/2);break;case F:t[l]=t[l]+(n[u]/2-r[u]/2);break;default:}}return t}function ye(e){var t=e.state,n=e.name;t.modifiersData[n]=me({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})}var we={name:"popperOffsets",enabled:!0,phase:"read",fn:ye,data:{}},be={top:"auto",right:"auto",bottom:"auto",left:"auto"};function ve(e){var t=e.x,n=e.y,r=window,s=r.devicePixelRatio||1;return{x:h(t*s)/s||0,y:h(n*s)/s||0}}function Ee(e){var t,n=e.popper,r=e.popperRect,s=e.placement,o=e.variation,a=e.offsets,c=e.position,l=e.gpuAcceleration,u=e.adaptive,h=e.roundOffsets,d=e.isFixed,p=a.x,f=void 0===p?0:p,g=a.y,m=void 0===g?0:g,y="function"===typeof h?h({x:f,y:m}):{x:f,y:m};f=y.x,m=y.y;var w=a.hasOwnProperty("x"),v=a.hasOwnProperty("y"),_=M,S=D,k=window;if(u){var A=N(n),T="clientHeight",C="clientWidth";if(A===i(n)&&(A=b(n),"static"!==E(A).position&&"absolute"===c&&(T="scrollHeight",C="scrollWidth")),s===D||(s===M||s===L)&&o===F){S=P;var I=d&&A===k&&k.visualViewport?k.visualViewport.height:A[T];m-=I-r.height,m*=l?1:-1}if(s===M||(s===D||s===P)&&o===F){_=L;var R=d&&A===k&&k.visualViewport?k.visualViewport.width:A[C];f-=R-r.width,f*=l?1:-1}}var O,x=Object.assign({position:c},u&&be),B=!0===h?ve({x:f,y:m}):{x:f,y:m};return f=B.x,m=B.y,l?Object.assign({},x,(O={},O[S]=v?"0":"",O[_]=w?"0":"",O.transform=(k.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",O)):Object.assign({},x,(t={},t[S]=v?m+"px":"",t[_]=w?f+"px":"",t.transform="",t))}function _e(e){var t=e.state,n=e.options,r=n.gpuAcceleration,s=void 0===r||r,i=n.adaptive,o=void 0===i||i,a=n.roundOffsets,c=void 0===a||a,l={placement:pe(t.placement),variation:fe(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Ee(Object.assign({},l,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:c})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Ee(Object.assign({},l,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:c})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})}var Se={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:_e,data:{}};function ke(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var n=t.styles[e]||{},r=t.attributes[e]||{},s=t.elements[e];a(s)&&w(s)&&(Object.assign(s.style,n),Object.keys(r).forEach((function(e){var t=r[e];!1===t?s.removeAttribute(e):s.setAttribute(e,!0===t?"":t)})))}))}function Ae(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow),function(){Object.keys(t.elements).forEach((function(e){var r=t.elements[e],s=t.attributes[e]||{},i=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:n[e]),o=i.reduce((function(e,t){return e[t]="",e}),{});a(r)&&w(r)&&(Object.assign(r.style,o),Object.keys(s).forEach((function(e){r.removeAttribute(e)})))}))}}var Te={name:"applyStyles",enabled:!0,phase:"write",fn:ke,effect:Ae,requires:["computeStyles"]};function Ce(e,t,n){var r=pe(e),s=[M,D].indexOf(r)>=0?-1:1,i="function"===typeof n?n(Object.assign({},t,{placement:e})):n,o=i[0],a=i[1];return o=o||0,a=(a||0)*s,[M,L].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}function Ie(e){var t=e.state,n=e.options,r=e.name,s=n.offset,i=void 0===s?[0,0]:s,o=q.reduce((function(e,n){return e[n]=Ce(n,t.rects,i),e}),{}),a=o[t.placement],c=a.x,l=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=c,t.modifiersData.popperOffsets.y+=l),t.modifiersData[r]=o}var Re={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Ie},Oe={left:"right",right:"left",bottom:"top",top:"bottom"};function xe(e){return e.replace(/left|right|bottom|top/g,(function(e){return Oe[e]}))}var Ne={start:"end",end:"start"};function De(e){return e.replace(/start|end/g,(function(e){return Ne[e]}))}function Pe(e,t){var n=i(e),r=b(e),s=n.visualViewport,o=r.clientWidth,a=r.clientHeight,c=0,l=0;if(s){o=s.width,a=s.height;var u=p();(u||!u&&"fixed"===t)&&(c=s.offsetLeft,l=s.offsetTop)}return{width:o,height:a,x:c+v(e),y:l}}function Le(e){var t,n=b(e),r=g(e),s=null==(t=e.ownerDocument)?void 0:t.body,i=l(n.scrollWidth,n.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),o=l(n.scrollHeight,n.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-r.scrollLeft+v(e),c=-r.scrollTop;return"rtl"===E(s||n).direction&&(a+=l(n.clientWidth,s?s.clientWidth:0)-i),{width:i,height:o,x:a,y:c}}function Me(e,t){var n=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(n&&c(n)){var r=t;do{if(r&&e.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function Be(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Ue(e,t){var n=f(e,!1,"fixed"===t);return n.top=n.top+e.clientTop,n.left=n.left+e.clientLeft,n.bottom=n.top+e.clientHeight,n.right=n.left+e.clientWidth,n.width=e.clientWidth,n.height=e.clientHeight,n.x=n.left,n.y=n.top,n}function Ve(e,t,n){return t===z?Be(Pe(e,n)):o(t)?Ue(t,n):Be(Le(b(e)))}function Fe(e){var t=I(T(e)),n=["absolute","fixed"].indexOf(E(e).position)>=0,r=n&&a(e)?N(e):e;return o(r)?t.filter((function(e){return o(e)&&Me(e,r)&&"body"!==w(e)})):[]}function je(e,t,n,r){var s="clippingParents"===t?Fe(e):[].concat(t),i=[].concat(s,[n]),o=i[0],a=i.reduce((function(t,n){var s=Ve(e,n,r);return t.top=l(s.top,t.top),t.right=u(s.right,t.right),t.bottom=u(s.bottom,t.bottom),t.left=l(s.left,t.left),t}),Ve(e,o,r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function ze(){return{top:0,right:0,bottom:0,left:0}}function $e(e){return Object.assign({},ze(),e)}function He(e,t){return t.reduce((function(t,n){return t[n]=e,t}),{})}function Ke(e,t){void 0===t&&(t={});var n=t,r=n.placement,s=void 0===r?e.placement:r,i=n.strategy,a=void 0===i?e.strategy:i,c=n.boundary,l=void 0===c?j:c,u=n.rootBoundary,h=void 0===u?z:u,d=n.elementContext,p=void 0===d?$:d,g=n.altBoundary,m=void 0!==g&&g,y=n.padding,w=void 0===y?0:y,v=$e("number"!==typeof w?w:He(w,U)),E=p===$?H:$,_=e.rects.popper,S=e.elements[m?E:p],k=je(o(S)?S:S.contextElement||b(e.elements.popper),l,h,a),A=f(e.elements.reference),T=me({reference:A,element:_,strategy:"absolute",placement:s}),C=Be(Object.assign({},_,T)),I=p===$?C:A,R={top:k.top-I.top+v.top,bottom:I.bottom-k.bottom+v.bottom,left:k.left-I.left+v.left,right:I.right-k.right+v.right},O=e.modifiersData.offset;if(p===$&&O){var x=O[s];Object.keys(R).forEach((function(e){var t=[L,P].indexOf(e)>=0?1:-1,n=[D,P].indexOf(e)>=0?"y":"x";R[e]+=x[n]*t}))}return R}function qe(e,t){void 0===t&&(t={});var n=t,r=n.placement,s=n.boundary,i=n.rootBoundary,o=n.padding,a=n.flipVariations,c=n.allowedAutoPlacements,l=void 0===c?q:c,u=fe(r),h=u?a?K:K.filter((function(e){return fe(e)===u})):U,d=h.filter((function(e){return l.indexOf(e)>=0}));0===d.length&&(d=h);var p=d.reduce((function(t,n){return t[n]=Ke(e,{placement:n,boundary:s,rootBoundary:i,padding:o})[pe(n)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}function Ge(e){if(pe(e)===B)return[];var t=xe(e);return[De(e),t,De(t)]}function We(e){var t=e.state,n=e.options,r=e.name;if(!t.modifiersData[r]._skip){for(var s=n.mainAxis,i=void 0===s||s,o=n.altAxis,a=void 0===o||o,c=n.fallbackPlacements,l=n.padding,u=n.boundary,h=n.rootBoundary,d=n.altBoundary,p=n.flipVariations,f=void 0===p||p,g=n.allowedAutoPlacements,m=t.options.placement,y=pe(m),w=y===m,b=c||(w||!f?[xe(m)]:Ge(m)),v=[m].concat(b).reduce((function(e,n){return e.concat(pe(n)===B?qe(t,{placement:n,boundary:u,rootBoundary:h,padding:l,flipVariations:f,allowedAutoPlacements:g}):n)}),[]),E=t.rects.reference,_=t.rects.popper,S=new Map,k=!0,A=v[0],T=0;T<v.length;T++){var C=v[T],I=pe(C),R=fe(C)===V,O=[D,P].indexOf(I)>=0,x=O?"width":"height",N=Ke(t,{placement:C,boundary:u,rootBoundary:h,altBoundary:d,padding:l}),U=O?R?L:M:R?P:D;E[x]>_[x]&&(U=xe(U));var F=xe(U),j=[];if(i&&j.push(N[I]<=0),a&&j.push(N[U]<=0,N[F]<=0),j.every((function(e){return e}))){A=C,k=!1;break}S.set(C,j)}if(k)for(var z=f?3:1,$=function(e){var t=v.find((function(t){var n=S.get(t);if(n)return n.slice(0,e).every((function(e){return e}))}));if(t)return A=t,"break"},H=z;H>0;H--){var K=$(H);if("break"===K)break}t.placement!==A&&(t.modifiersData[r]._skip=!0,t.placement=A,t.reset=!0)}}var Ye={name:"flip",enabled:!0,phase:"main",fn:We,requiresIfExists:["offset"],data:{_skip:!1}};function Je(e){return"x"===e?"y":"x"}function Qe(e,t,n){return l(e,u(t,n))}function Xe(e,t,n){var r=Qe(e,t,n);return r>n?n:r}function Ze(e){var t=e.state,n=e.options,r=e.name,s=n.mainAxis,i=void 0===s||s,o=n.altAxis,a=void 0!==o&&o,c=n.boundary,h=n.rootBoundary,d=n.altBoundary,p=n.padding,f=n.tether,g=void 0===f||f,m=n.tetherOffset,y=void 0===m?0:m,w=Ke(t,{boundary:c,rootBoundary:h,padding:p,altBoundary:d}),b=pe(t.placement),v=fe(t.placement),E=!v,_=ge(b),S=Je(_),k=t.modifiersData.popperOffsets,T=t.rects.reference,C=t.rects.popper,I="function"===typeof y?y(Object.assign({},t.rects,{placement:t.placement})):y,R="number"===typeof I?{mainAxis:I,altAxis:I}:Object.assign({mainAxis:0,altAxis:0},I),O=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,x={x:0,y:0};if(k){if(i){var B,U="y"===_?D:M,F="y"===_?P:L,j="y"===_?"height":"width",z=k[_],$=z+w[U],H=z-w[F],K=g?-C[j]/2:0,q=v===V?T[j]:C[j],G=v===V?-C[j]:-T[j],W=t.elements.arrow,Y=g&&W?A(W):{width:0,height:0},J=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:ze(),Q=J[U],X=J[F],Z=Qe(0,T[j],Y[j]),ee=E?T[j]/2-K-Z-Q-R.mainAxis:q-Z-Q-R.mainAxis,te=E?-T[j]/2+K+Z+X+R.mainAxis:G+Z+X+R.mainAxis,ne=t.elements.arrow&&N(t.elements.arrow),re=ne?"y"===_?ne.clientTop||0:ne.clientLeft||0:0,se=null!=(B=null==O?void 0:O[_])?B:0,ie=z+ee-se-re,oe=z+te-se,ae=Qe(g?u($,ie):$,z,g?l(H,oe):H);k[_]=ae,x[_]=ae-z}if(a){var ce,le="x"===_?D:M,ue="x"===_?P:L,he=k[S],de="y"===S?"height":"width",me=he+w[le],ye=he-w[ue],we=-1!==[D,M].indexOf(b),be=null!=(ce=null==O?void 0:O[S])?ce:0,ve=we?me:he-T[de]-C[de]-be+R.altAxis,Ee=we?he+T[de]+C[de]-be-R.altAxis:ye,_e=g&&we?Xe(ve,he,Ee):Qe(g?ve:me,he,g?Ee:ye);k[S]=_e,x[S]=_e-he}t.modifiersData[r]=x}}var et={name:"preventOverflow",enabled:!0,phase:"main",fn:Ze,requiresIfExists:["offset"]},tt=function(e,t){return e="function"===typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e,$e("number"!==typeof e?e:He(e,U))};function nt(e){var t,n=e.state,r=e.name,s=e.options,i=n.elements.arrow,o=n.modifiersData.popperOffsets,a=pe(n.placement),c=ge(a),l=[M,L].indexOf(a)>=0,u=l?"height":"width";if(i&&o){var h=tt(s.padding,n),d=A(i),p="y"===c?D:M,f="y"===c?P:L,g=n.rects.reference[u]+n.rects.reference[c]-o[c]-n.rects.popper[u],m=o[c]-n.rects.reference[c],y=N(i),w=y?"y"===c?y.clientHeight||0:y.clientWidth||0:0,b=g/2-m/2,v=h[p],E=w-d[u]-h[f],_=w/2-d[u]/2+b,S=Qe(v,_,E),k=c;n.modifiersData[r]=(t={},t[k]=S,t.centerOffset=S-_,t)}}function rt(e){var t=e.state,n=e.options,r=n.element,s=void 0===r?"[data-popper-arrow]":r;null!=s&&("string"!==typeof s||(s=t.elements.popper.querySelector(s),s))&&Me(t.elements.popper,s)&&(t.elements.arrow=s)}var st={name:"arrow",enabled:!0,phase:"main",fn:nt,effect:rt,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function it(e,t,n){return void 0===n&&(n={x:0,y:0}),{top:e.top-t.height-n.y,right:e.right-t.width+n.x,bottom:e.bottom-t.height+n.y,left:e.left-t.width-n.x}}function ot(e){return[D,L,P,M].some((function(t){return e[t]>=0}))}function at(e){var t=e.state,n=e.name,r=t.rects.reference,s=t.rects.popper,i=t.modifiersData.preventOverflow,o=Ke(t,{elementContext:"reference"}),a=Ke(t,{altBoundary:!0}),c=it(o,r),l=it(a,s,i),u=ot(c),h=ot(l);t.modifiersData[n]={referenceClippingOffsets:c,popperEscapeOffsets:l,isReferenceHidden:u,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":h})}var ct={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:at},lt=[de,we,Se,Te,Re,Ye,et,st,ct],ut=le({defaultModifiers:lt}),ht="tippy-box",dt="tippy-content",pt="tippy-backdrop",ft="tippy-arrow",gt="tippy-svg-arrow",mt={passive:!0,capture:!0},yt=function(){return document.body};function wt(e,t,n){if(Array.isArray(e)){var r=e[t];return null==r?Array.isArray(n)?n[t]:n:r}return e}function bt(e,t){var n={}.toString.call(e);return 0===n.indexOf("[object")&&n.indexOf(t+"]")>-1}function vt(e,t){return"function"===typeof e?e.apply(void 0,t):e}function Et(e,t){return 0===t?e:function(r){clearTimeout(n),n=setTimeout((function(){e(r)}),t)};var n}function _t(e){return e.split(/\s+/).filter(Boolean)}function St(e){return[].concat(e)}function kt(e,t){-1===e.indexOf(t)&&e.push(t)}function At(e){return e.filter((function(t,n){return e.indexOf(t)===n}))}function Tt(e){return e.split("-")[0]}function Ct(e){return[].slice.call(e)}function It(e){return Object.keys(e).reduce((function(t,n){return void 0!==e[n]&&(t[n]=e[n]),t}),{})}function Rt(){return document.createElement("div")}function Ot(e){return["Element","Fragment"].some((function(t){return bt(e,t)}))}function xt(e){return bt(e,"NodeList")}function Nt(e){return bt(e,"MouseEvent")}function Dt(e){return!(!e||!e._tippy||e._tippy.reference!==e)}function Pt(e){return Ot(e)?[e]:xt(e)?Ct(e):Array.isArray(e)?e:Ct(document.querySelectorAll(e))}function Lt(e,t){e.forEach((function(e){e&&(e.style.transitionDuration=t+"ms")}))}function Mt(e,t){e.forEach((function(e){e&&e.setAttribute("data-state",t)}))}function Bt(e){var t,n=St(e),r=n[0];return null!=r&&null!=(t=r.ownerDocument)&&t.body?r.ownerDocument:document}function Ut(e,t){var n=t.clientX,r=t.clientY;return e.every((function(e){var t=e.popperRect,s=e.popperState,i=e.props,o=i.interactiveBorder,a=Tt(s.placement),c=s.modifiersData.offset;if(!c)return!0;var l="bottom"===a?c.top.y:0,u="top"===a?c.bottom.y:0,h="right"===a?c.left.x:0,d="left"===a?c.right.x:0,p=t.top-r+l>o,f=r-t.bottom-u>o,g=t.left-n+h>o,m=n-t.right-d>o;return p||f||g||m}))}function Vt(e,t,n){var r=t+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(t){e[r](t,n)}))}function Ft(e,t){var n=t;while(n){var r;if(e.contains(n))return!0;n=null==n.getRootNode||null==(r=n.getRootNode())?void 0:r.host}return!1}var jt={isTouch:!1},zt=0;function $t(){jt.isTouch||(jt.isTouch=!0,window.performance&&document.addEventListener("mousemove",Ht))}function Ht(){var e=performance.now();e-zt<20&&(jt.isTouch=!1,document.removeEventListener("mousemove",Ht)),zt=e}function Kt(){var e=document.activeElement;if(Dt(e)){var t=e._tippy;e.blur&&!t.state.isVisible&&e.blur()}}function qt(){document.addEventListener("touchstart",$t,mt),window.addEventListener("blur",Kt)}var Gt="undefined"!==typeof window&&"undefined"!==typeof document,Wt=!!Gt&&!!window.msCrypto;var Yt={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},Jt={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},Qt=Object.assign({appendTo:yt,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},Yt,Jt),Xt=Object.keys(Qt),Zt=function(e){var t=Object.keys(e);t.forEach((function(t){Qt[t]=e[t]}))};function en(e){var t=e.plugins||[],n=t.reduce((function(t,n){var r,s=n.name,i=n.defaultValue;s&&(t[s]=void 0!==e[s]?e[s]:null!=(r=Qt[s])?r:i);return t}),{});return Object.assign({},e,n)}function tn(e,t){var n=t?Object.keys(en(Object.assign({},Qt,{plugins:t}))):Xt,r=n.reduce((function(t,n){var r=(e.getAttribute("data-tippy-"+n)||"").trim();if(!r)return t;if("content"===n)t[n]=r;else try{t[n]=JSON.parse(r)}catch(s){t[n]=r}return t}),{});return r}function nn(e,t){var n=Object.assign({},t,{content:vt(t.content,[e])},t.ignoreAttributes?{}:tn(e,t.plugins));return n.aria=Object.assign({},Qt.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?t.interactive:n.aria.expanded,content:"auto"===n.aria.content?t.interactive?null:"describedby":n.aria.content},n}var rn=function(){return"innerHTML"};function sn(e,t){e[rn()]=t}function on(e){var t=Rt();return!0===e?t.className=ft:(t.className=gt,Ot(e)?t.appendChild(e):sn(t,e)),t}function an(e,t){Ot(t.content)?(sn(e,""),e.appendChild(t.content)):"function"!==typeof t.content&&(t.allowHTML?sn(e,t.content):e.textContent=t.content)}function cn(e){var t=e.firstElementChild,n=Ct(t.children);return{box:t,content:n.find((function(e){return e.classList.contains(dt)})),arrow:n.find((function(e){return e.classList.contains(ft)||e.classList.contains(gt)})),backdrop:n.find((function(e){return e.classList.contains(pt)}))}}function ln(e){var t=Rt(),n=Rt();n.className=ht,n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Rt();function s(n,r){var s=cn(t),i=s.box,o=s.content,a=s.arrow;r.theme?i.setAttribute("data-theme",r.theme):i.removeAttribute("data-theme"),"string"===typeof r.animation?i.setAttribute("data-animation",r.animation):i.removeAttribute("data-animation"),r.inertia?i.setAttribute("data-inertia",""):i.removeAttribute("data-inertia"),i.style.maxWidth="number"===typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?i.setAttribute("role",r.role):i.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||an(o,e.props),r.arrow?a?n.arrow!==r.arrow&&(i.removeChild(a),i.appendChild(on(r.arrow))):i.appendChild(on(r.arrow)):a&&i.removeChild(a)}return r.className=dt,r.setAttribute("data-state","hidden"),an(r,e.props),t.appendChild(n),n.appendChild(r),s(e.props,e.props),{popper:t,onUpdate:s}}ln.$$tippy=!0;var un=1,hn=[],dn=[];function pn(e,t){var n,r,s,i,o,a,c,l=nn(e,Object.assign({},Qt,en(It(t)))),u=!1,h=!1,d=!1,p=!1,f=[],g=Et(J,l.interactiveDebounce),m=un++,y=null,w=At(l.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},v={id:m,reference:e,popper:Rt(),popperInstance:y,props:l,state:b,plugins:w,clearDelayTimeouts:ce,setProps:le,setContent:ue,show:he,hide:de,hideWithInteractivity:pe,enable:oe,disable:ae,unmount:fe,destroy:ge};if(!l.render)return v;var E=l.render(v),_=E.popper,S=E.onUpdate;_.setAttribute("data-tippy-root",""),_.id="tippy-"+v.id,v.popper=_,e._tippy=v,_._tippy=v;var k=w.map((function(e){return e.fn(v)})),A=e.hasAttribute("aria-expanded");return G(),M(),D(),P("onCreate",[v]),l.showOnCreate&&se(),_.addEventListener("mouseenter",(function(){v.props.interactive&&v.state.isVisible&&v.clearDelayTimeouts()})),_.addEventListener("mouseleave",(function(){v.props.interactive&&v.props.trigger.indexOf("mouseenter")>=0&&O().addEventListener("mousemove",g)})),v;function T(){var e=v.props.touch;return Array.isArray(e)?e:[e,0]}function C(){return"hold"===T()[0]}function I(){var e;return!(null==(e=v.props.render)||!e.$$tippy)}function R(){return c||e}function O(){var e=R().parentNode;return e?Bt(e):document}function x(){return cn(_)}function N(e){return v.state.isMounted&&!v.state.isVisible||jt.isTouch||i&&"focus"===i.type?0:wt(v.props.delay,e?0:1,Qt.delay)}function D(e){void 0===e&&(e=!1),_.style.pointerEvents=v.props.interactive&&!e?"":"none",_.style.zIndex=""+v.props.zIndex}function P(e,t,n){var r;(void 0===n&&(n=!0),k.forEach((function(n){n[e]&&n[e].apply(n,t)})),n)&&(r=v.props)[e].apply(r,t)}function L(){var t=v.props.aria;if(t.content){var n="aria-"+t.content,r=_.id,s=St(v.props.triggerTarget||e);s.forEach((function(e){var t=e.getAttribute(n);if(v.state.isVisible)e.setAttribute(n,t?t+" "+r:r);else{var s=t&&t.replace(r,"").trim();s?e.setAttribute(n,s):e.removeAttribute(n)}}))}}function M(){if(!A&&v.props.aria.expanded){var t=St(v.props.triggerTarget||e);t.forEach((function(e){v.props.interactive?e.setAttribute("aria-expanded",v.state.isVisible&&e===R()?"true":"false"):e.removeAttribute("aria-expanded")}))}}function B(){O().removeEventListener("mousemove",g),hn=hn.filter((function(e){return e!==g}))}function U(t){if(!jt.isTouch||!d&&"mousedown"!==t.type){var n=t.composedPath&&t.composedPath()[0]||t.target;if(!v.props.interactive||!Ft(_,n)){if(St(v.props.triggerTarget||e).some((function(e){return Ft(e,n)}))){if(jt.isTouch)return;if(v.state.isVisible&&v.props.trigger.indexOf("click")>=0)return}else P("onClickOutside",[v,t]);!0===v.props.hideOnClick&&(v.clearDelayTimeouts(),v.hide(),h=!0,setTimeout((function(){h=!1})),v.state.isMounted||z())}}}function V(){d=!0}function F(){d=!1}function j(){var e=O();e.addEventListener("mousedown",U,!0),e.addEventListener("touchend",U,mt),e.addEventListener("touchstart",F,mt),e.addEventListener("touchmove",V,mt)}function z(){var e=O();e.removeEventListener("mousedown",U,!0),e.removeEventListener("touchend",U,mt),e.removeEventListener("touchstart",F,mt),e.removeEventListener("touchmove",V,mt)}function $(e,t){K(e,(function(){!v.state.isVisible&&_.parentNode&&_.parentNode.contains(_)&&t()}))}function H(e,t){K(e,t)}function K(e,t){var n=x().box;function r(e){e.target===n&&(Vt(n,"remove",r),t())}if(0===e)return t();Vt(n,"remove",o),Vt(n,"add",r),o=r}function q(t,n,r){void 0===r&&(r=!1);var s=St(v.props.triggerTarget||e);s.forEach((function(e){e.addEventListener(t,n,r),f.push({node:e,eventType:t,handler:n,options:r})}))}function G(){C()&&(q("touchstart",Y,{passive:!0}),q("touchend",Q,{passive:!0})),_t(v.props.trigger).forEach((function(e){if("manual"!==e)switch(q(e,Y),e){case"mouseenter":q("mouseleave",Q);break;case"focus":q(Wt?"focusout":"blur",X);break;case"focusin":q("focusout",X);break}}))}function W(){f.forEach((function(e){var t=e.node,n=e.eventType,r=e.handler,s=e.options;t.removeEventListener(n,r,s)})),f=[]}function Y(e){var t,n=!1;if(v.state.isEnabled&&!Z(e)&&!h){var r="focus"===(null==(t=i)?void 0:t.type);i=e,c=e.currentTarget,M(),!v.state.isVisible&&Nt(e)&&hn.forEach((function(t){return t(e)})),"click"===e.type&&(v.props.trigger.indexOf("mouseenter")<0||u)&&!1!==v.props.hideOnClick&&v.state.isVisible?n=!0:se(e),"click"===e.type&&(u=!n),n&&!r&&ie(e)}}function J(e){var t=e.target,n=R().contains(t)||_.contains(t);if("mousemove"!==e.type||!n){var r=re().concat(_).map((function(e){var t,n=e._tippy,r=null==(t=n.popperInstance)?void 0:t.state;return r?{popperRect:e.getBoundingClientRect(),popperState:r,props:l}:null})).filter(Boolean);Ut(r,e)&&(B(),ie(e))}}function Q(e){var t=Z(e)||v.props.trigger.indexOf("click")>=0&&u;t||(v.props.interactive?v.hideWithInteractivity(e):ie(e))}function X(e){v.props.trigger.indexOf("focusin")<0&&e.target!==R()||v.props.interactive&&e.relatedTarget&&_.contains(e.relatedTarget)||ie(e)}function Z(e){return!!jt.isTouch&&C()!==e.type.indexOf("touch")>=0}function ee(){te();var t=v.props,n=t.popperOptions,r=t.placement,s=t.offset,i=t.getReferenceClientRect,o=t.moveTransition,c=I()?cn(_).arrow:null,l=i?{getBoundingClientRect:i,contextElement:i.contextElement||R()}:e,u={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(e){var t=e.state;if(I()){var n=x(),r=n.box;["placement","reference-hidden","escaped"].forEach((function(e){"placement"===e?r.setAttribute("data-placement",t.placement):t.attributes.popper["data-popper-"+e]?r.setAttribute("data-"+e,""):r.removeAttribute("data-"+e)})),t.attributes.popper={}}}},h=[{name:"offset",options:{offset:s}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!o}},u];I()&&c&&h.push({name:"arrow",options:{element:c,padding:3}}),h.push.apply(h,(null==n?void 0:n.modifiers)||[]),v.popperInstance=ut(l,_,Object.assign({},n,{placement:r,onFirstUpdate:a,modifiers:h}))}function te(){v.popperInstance&&(v.popperInstance.destroy(),v.popperInstance=null)}function ne(){var e,t=v.props.appendTo,n=R();e=v.props.interactive&&t===yt||"parent"===t?n.parentNode:vt(t,[n]),e.contains(_)||e.appendChild(_),v.state.isMounted=!0,ee()}function re(){return Ct(_.querySelectorAll("[data-tippy-root]"))}function se(e){v.clearDelayTimeouts(),e&&P("onTrigger",[v,e]),j();var t=N(!0),r=T(),s=r[0],i=r[1];jt.isTouch&&"hold"===s&&i&&(t=i),t?n=setTimeout((function(){v.show()}),t):v.show()}function ie(e){if(v.clearDelayTimeouts(),P("onUntrigger",[v,e]),v.state.isVisible){if(!(v.props.trigger.indexOf("mouseenter")>=0&&v.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(e.type)>=0&&u)){var t=N(!1);t?r=setTimeout((function(){v.state.isVisible&&v.hide()}),t):s=requestAnimationFrame((function(){v.hide()}))}}else z()}function oe(){v.state.isEnabled=!0}function ae(){v.hide(),v.state.isEnabled=!1}function ce(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(s)}function le(t){if(!v.state.isDestroyed){P("onBeforeUpdate",[v,t]),W();var n=v.props,r=nn(e,Object.assign({},n,It(t),{ignoreAttributes:!0}));v.props=r,G(),n.interactiveDebounce!==r.interactiveDebounce&&(B(),g=Et(J,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?St(n.triggerTarget).forEach((function(e){e.removeAttribute("aria-expanded")})):r.triggerTarget&&e.removeAttribute("aria-expanded"),M(),D(),S&&S(n,r),v.popperInstance&&(ee(),re().forEach((function(e){requestAnimationFrame(e._tippy.popperInstance.forceUpdate)}))),P("onAfterUpdate",[v,t])}}function ue(e){v.setProps({content:e})}function he(){var e=v.state.isVisible,t=v.state.isDestroyed,n=!v.state.isEnabled,r=jt.isTouch&&!v.props.touch,s=wt(v.props.duration,0,Qt.duration);if(!(e||t||n||r)&&!R().hasAttribute("disabled")&&(P("onShow",[v],!1),!1!==v.props.onShow(v))){if(v.state.isVisible=!0,I()&&(_.style.visibility="visible"),D(),j(),v.state.isMounted||(_.style.transition="none"),I()){var i=x(),o=i.box,c=i.content;Lt([o,c],0)}a=function(){var e;if(v.state.isVisible&&!p){if(p=!0,_.offsetHeight,_.style.transition=v.props.moveTransition,I()&&v.props.animation){var t=x(),n=t.box,r=t.content;Lt([n,r],s),Mt([n,r],"visible")}L(),M(),kt(dn,v),null==(e=v.popperInstance)||e.forceUpdate(),P("onMount",[v]),v.props.animation&&I()&&H(s,(function(){v.state.isShown=!0,P("onShown",[v])}))}},ne()}}function de(){var e=!v.state.isVisible,t=v.state.isDestroyed,n=!v.state.isEnabled,r=wt(v.props.duration,1,Qt.duration);if(!(e||t||n)&&(P("onHide",[v],!1),!1!==v.props.onHide(v))){if(v.state.isVisible=!1,v.state.isShown=!1,p=!1,u=!1,I()&&(_.style.visibility="hidden"),B(),z(),D(!0),I()){var s=x(),i=s.box,o=s.content;v.props.animation&&(Lt([i,o],r),Mt([i,o],"hidden"))}L(),M(),v.props.animation?I()&&$(r,v.unmount):v.unmount()}}function pe(e){O().addEventListener("mousemove",g),kt(hn,g),g(e)}function fe(){v.state.isVisible&&v.hide(),v.state.isMounted&&(te(),re().forEach((function(e){e._tippy.unmount()})),_.parentNode&&_.parentNode.removeChild(_),dn=dn.filter((function(e){return e!==v})),v.state.isMounted=!1,P("onHidden",[v]))}function ge(){v.state.isDestroyed||(v.clearDelayTimeouts(),v.unmount(),W(),delete e._tippy,v.state.isDestroyed=!0,P("onDestroy",[v]))}}function fn(e,t){void 0===t&&(t={});var n=Qt.plugins.concat(t.plugins||[]);qt();var r=Object.assign({},t,{plugins:n}),s=Pt(e),i=s.reduce((function(e,t){var n=t&&pn(t,r);return n&&e.push(n),e}),[]);return Ot(e)?i[0]:i}fn.defaultProps=Qt,fn.setDefaultProps=Zt,fn.currentInput=jt;Object.assign({},Te,{effect:function(e){var t=e.state,n={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(t.elements.popper.style,n.popper),t.styles=n,t.elements.arrow&&Object.assign(t.elements.arrow.style,n.arrow)}});fn.setDefaultProps({render:ln});var gn=fn,mn="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};function yn(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var wn=yn,bn="object"==typeof mn&&mn&&mn.Object===Object&&mn,vn=bn,En=vn,_n="object"==typeof self&&self&&self.Object===Object&&self,Sn=En||_n||Function("return this")(),kn=Sn,An=kn,Tn=function(){return An.Date.now()},Cn=Tn,In=/\s/;function Rn(e){var t=e.length;while(t--&&In.test(e.charAt(t)));return t}var On=Rn,xn=On,Nn=/^\s+/;function Dn(e){return e?e.slice(0,xn(e)+1).replace(Nn,""):e}var Pn=Dn,Ln=kn,Mn=Ln.Symbol,Bn=Mn,Un=Bn,Vn=Object.prototype,Fn=Vn.hasOwnProperty,jn=Vn.toString,zn=Un?Un.toStringTag:void 0;function $n(e){var t=Fn.call(e,zn),n=e[zn];try{e[zn]=void 0;var r=!0}catch(i){}var s=jn.call(e);return r&&(t?e[zn]=n:delete e[zn]),s}var Hn=$n,Kn=Object.prototype,qn=Kn.toString;function Gn(e){return qn.call(e)}var Wn=Gn,Yn=Bn,Jn=Hn,Qn=Wn,Xn="[object Null]",Zn="[object Undefined]",er=Yn?Yn.toStringTag:void 0;function tr(e){return null==e?void 0===e?Zn:Xn:er&&er in Object(e)?Jn(e):Qn(e)}var nr=tr;function rr(e){return null!=e&&"object"==typeof e}var sr=rr,ir=nr,or=sr,ar="[object Symbol]";function cr(e){return"symbol"==typeof e||or(e)&&ir(e)==ar}var lr=cr,ur=Pn,hr=wn,dr=lr,pr=NaN,fr=/^[-+]0x[0-9a-f]+$/i,gr=/^0b[01]+$/i,mr=/^0o[0-7]+$/i,yr=parseInt;function wr(e){if("number"==typeof e)return e;if(dr(e))return pr;if(hr(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=hr(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=ur(e);var n=gr.test(e);return n||mr.test(e)?yr(e.slice(2),n?2:8):fr.test(e)?pr:+e}var br=wr,vr=wn,Er=Cn,_r=br,Sr="Expected a function",kr=Math.max,Ar=Math.min;function Tr(e,t,n){var r,s,i,o,a,c,l=0,u=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError(Sr);function p(t){var n=r,i=s;return r=s=void 0,l=t,o=e.apply(i,n),o}function f(e){return l=e,a=setTimeout(y,t),u?p(e):o}function g(e){var n=e-c,r=e-l,s=t-n;return h?Ar(s,i-r):s}function m(e){var n=e-c,r=e-l;return void 0===c||n>=t||n<0||h&&r>=i}function y(){var e=Er();if(m(e))return w(e);a=setTimeout(y,g(e))}function w(e){return a=void 0,d&&r?p(e):(r=s=void 0,o)}function b(){void 0!==a&&clearTimeout(a),l=0,r=c=s=a=void 0}function v(){return void 0===a?o:w(Er())}function E(){var e=Er(),n=m(e);if(r=arguments,s=this,c=e,n){if(void 0===a)return f(c);if(h)return clearTimeout(a),a=setTimeout(y,t),p(c)}return void 0===a&&(a=setTimeout(y,t)),o}return t=_r(t)||0,vr(n)&&(u=!!n.leading,h="maxWait"in n,i=h?kr(_r(n.maxWait)||0,t):i,d="trailing"in n?!!n.trailing:d),E.cancel=b,E.flush=v,E}var Cr=Tr;class Ir{constructor({editor:e,element:t,view:n,tippyOptions:s={},updateDelay:i=250,shouldShow:o}){this.preventHide=!1,this.shouldShow=({view:e,state:t,from:n,to:s})=>{const{doc:i,selection:o}=t,{empty:a}=o,c=!i.textBetween(n,s).length&&(0,r.xh)(t.selection),l=this.element.contains(document.activeElement),u=e.hasFocus()||l;return!(!u||a||c||!this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.dragstartHandler=()=>{this.hide()},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:e})=>{var t;this.preventHide?this.preventHide=!1:(null===e||void 0===e?void 0:e.relatedTarget)&&(null===(t=this.element.parentNode)||void 0===t?void 0:t.contains(e.relatedTarget))||this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.updateHandler=(e,t)=>{var n,s,i;const{state:o,composing:a}=e,{doc:c,selection:l}=o,u=t&&t.doc.eq(c)&&t.selection.eq(l);if(a||u)return;this.createTooltip();const{ranges:h}=l,d=Math.min(...h.map((e=>e.$from.pos))),p=Math.max(...h.map((e=>e.$to.pos))),f=null===(n=this.shouldShow)||void 0===n?void 0:n.call(this,{editor:this.editor,view:e,state:o,oldState:t,from:d,to:p});f?(null===(s=this.tippy)||void 0===s||s.setProps({getReferenceClientRect:(null===(i=this.tippyOptions)||void 0===i?void 0:i.getReferenceClientRect)||(()=>{if((0,r.EG)(o.selection)){const t=e.nodeDOM(d);if(t)return t.getBoundingClientRect()}return(0,r.pr)(e,d,p)})}),this.show()):this.hide()},this.editor=e,this.element=t,this.view=n,this.updateDelay=i,o&&(this.shouldShow=o),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.addEventListener("dragstart",this.dragstartHandler),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=s,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;!this.tippy&&t&&(this.tippy=gn(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"top",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){const{state:n}=e,r=n.selection.$from.pos!==n.selection.$to.pos;this.updateDelay>0&&r?Cr(this.updateHandler,this.updateDelay)(e,t):this.updateHandler(e,t)}show(){var e;null===(e=this.tippy)||void 0===e||e.show()}hide(){var e;null===(e=this.tippy)||void 0===e||e.hide()}destroy(){var e,t;(null===(e=this.tippy)||void 0===e?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(t=this.tippy)||void 0===t||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.view.dom.removeEventListener("dragstart",this.dragstartHandler),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Rr=e=>new s.Sy({key:"string"===typeof e.pluginKey?new s.H$(e.pluginKey):e.pluginKey,view:t=>new Ir({view:t,...e})});r.hj.create({name:"bubbleMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"bubbleMenu",updateDelay:void 0,shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Rr({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,updateDelay:this.options.updateDelay,shouldShow:this.options.shouldShow})]:[]}});var Or=n(3396),xr=n(4870);class Nr{constructor({editor:e,element:t,view:n,tippyOptions:r={},shouldShow:s}){this.preventHide=!1,this.shouldShow=({view:e,state:t})=>{const{selection:n}=t,{$anchor:r,empty:s}=n,i=1===r.depth,o=r.parent.isTextblock&&!r.parent.type.spec.code&&!r.parent.textContent;return!!(e.hasFocus()&&s&&i&&o&&this.editor.isEditable)},this.mousedownHandler=()=>{this.preventHide=!0},this.focusHandler=()=>{setTimeout((()=>this.update(this.editor.view)))},this.blurHandler=({event:e})=>{var t;this.preventHide?this.preventHide=!1:(null===e||void 0===e?void 0:e.relatedTarget)&&(null===(t=this.element.parentNode)||void 0===t?void 0:t.contains(e.relatedTarget))||this.hide()},this.tippyBlurHandler=e=>{this.blurHandler({event:e})},this.editor=e,this.element=t,this.view=n,s&&(this.shouldShow=s),this.element.addEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.on("focus",this.focusHandler),this.editor.on("blur",this.blurHandler),this.tippyOptions=r,this.element.remove(),this.element.style.visibility="visible"}createTooltip(){const{element:e}=this.editor.options,t=!!e.parentElement;!this.tippy&&t&&(this.tippy=gn(e,{duration:0,getReferenceClientRect:null,content:this.element,interactive:!0,trigger:"manual",placement:"right",hideOnClick:"toggle",...this.tippyOptions}),this.tippy.popper.firstChild&&this.tippy.popper.firstChild.addEventListener("blur",this.tippyBlurHandler))}update(e,t){var n,s,i;const{state:o}=e,{doc:a,selection:c}=o,{from:l,to:u}=c,h=t&&t.doc.eq(a)&&t.selection.eq(c);if(h)return;this.createTooltip();const d=null===(n=this.shouldShow)||void 0===n?void 0:n.call(this,{editor:this.editor,view:e,state:o,oldState:t});d?(null===(s=this.tippy)||void 0===s||s.setProps({getReferenceClientRect:(null===(i=this.tippyOptions)||void 0===i?void 0:i.getReferenceClientRect)||(()=>(0,r.pr)(e,l,u))}),this.show()):this.hide()}show(){var e;null===(e=this.tippy)||void 0===e||e.show()}hide(){var e;null===(e=this.tippy)||void 0===e||e.hide()}destroy(){var e,t;(null===(e=this.tippy)||void 0===e?void 0:e.popper.firstChild)&&this.tippy.popper.firstChild.removeEventListener("blur",this.tippyBlurHandler),null===(t=this.tippy)||void 0===t||t.destroy(),this.element.removeEventListener("mousedown",this.mousedownHandler,{capture:!0}),this.editor.off("focus",this.focusHandler),this.editor.off("blur",this.blurHandler)}}const Dr=e=>new s.Sy({key:"string"===typeof e.pluginKey?new s.H$(e.pluginKey):e.pluginKey,view:t=>new Nr({view:t,...e})});r.hj.create({name:"floatingMenu",addOptions(){return{element:null,tippyOptions:{},pluginKey:"floatingMenu",shouldShow:null}},addProseMirrorPlugins(){return this.options.element?[Dr({pluginKey:this.options.pluginKey,editor:this.editor,element:this.options.element,tippyOptions:this.options.tippyOptions,shouldShow:this.options.shouldShow})]:[]}}),(0,Or.aZ)({name:"BubbleMenu",props:{pluginKey:{type:[String,Object],default:"bubbleMenu"},editor:{type:Object,required:!0},updateDelay:{type:Number,default:void 0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(e,{slots:t}){const n=(0,xr.iH)(null);return(0,Or.bv)((()=>{const{updateDelay:t,editor:r,pluginKey:s,shouldShow:i,tippyOptions:o}=e;r.registerPlugin(Rr({updateDelay:t,editor:r,element:n.value,pluginKey:s,shouldShow:i,tippyOptions:o}))})),(0,Or.Jd)((()=>{const{pluginKey:t,editor:n}=e;n.unregisterPlugin(t)})),()=>{var e;return(0,Or.h)("div",{ref:n},null===(e=t.default)||void 0===e?void 0:e.call(t))}}});function Pr(e){return(0,xr.ZM)(((t,n)=>({get(){return t(),e},set(t){e=t,requestAnimationFrame((()=>{requestAnimationFrame((()=>{n()}))}))}})))}class Lr extends r.ML{constructor(e={}){return super(e),this.vueRenderers=(0,xr.qj)(new Map),this.contentComponent=null,this.reactiveState=Pr(this.view.state),this.reactiveExtensionStorage=Pr(this.extensionStorage),this.on("transaction",(()=>{this.reactiveState.value=this.view.state,this.reactiveExtensionStorage.value=this.extensionStorage})),(0,xr.Xl)(this)}get state(){return this.reactiveState?this.reactiveState.value:this.view.state}get storage(){return this.reactiveExtensionStorage?this.reactiveExtensionStorage.value:super.storage}registerPlugin(e,t){super.registerPlugin(e,t),this.reactiveState.value=this.view.state}unregisterPlugin(e){super.unregisterPlugin(e),this.reactiveState.value=this.view.state}}const Mr=(0,Or.aZ)({name:"EditorContent",props:{editor:{default:null,type:Object}},setup(e){const t=(0,xr.iH)(),n=(0,Or.FN)();return(0,Or.m0)((()=>{const r=e.editor;r&&r.options.element&&t.value&&(0,Or.Y3)((()=>{if(!t.value||!r.options.element.firstChild)return;const e=(0,xr.SU)(t.value);t.value.append(...r.options.element.childNodes),r.contentComponent=n.ctx._,r.setOptions({element:e}),r.createNodeViews()}))})),(0,Or.Jd)((()=>{const t=e.editor;if(!t)return;if(t.isDestroyed||t.view.setProps({nodeViews:{}}),t.contentComponent=null,!t.options.element.firstChild)return;const n=document.createElement("div");n.append(...t.options.element.childNodes),t.setOptions({element:n})})),{rootEl:t}},render(){const e=[];return this.editor&&this.editor.vueRenderers.forEach((t=>{const n=(0,Or.h)(Or.lR,{to:t.teleportElement,key:t.id},(0,Or.h)(t.component,{ref:t.id,...t.props}));e.push(n)})),(0,Or.h)("div",{ref:e=>{this.rootEl=e}},...e)}});(0,Or.aZ)({name:"FloatingMenu",props:{pluginKey:{type:null,default:"floatingMenu"},editor:{type:Object,required:!0},tippyOptions:{type:Object,default:()=>({})},shouldShow:{type:Function,default:null}},setup(e,{slots:t}){const n=(0,xr.iH)(null);return(0,Or.bv)((()=>{const{pluginKey:t,editor:r,tippyOptions:s,shouldShow:i}=e;r.registerPlugin(Dr({pluginKey:t,editor:r,element:n.value,tippyOptions:s,shouldShow:i}))})),(0,Or.Jd)((()=>{const{pluginKey:t,editor:n}=e;n.unregisterPlugin(t)})),()=>{var e;return(0,Or.h)("div",{ref:n},null===(e=t.default)||void 0===e?void 0:e.call(t))}}}),(0,Or.aZ)({props:{as:{type:String,default:"div"}},render(){return(0,Or.h)(this.as,{style:{whiteSpace:"pre-wrap"},"data-node-view-content":""})}}),(0,Or.aZ)({props:{as:{type:String,default:"div"}},inject:["onDragStart","decorationClasses"],render(){var e,t;return(0,Or.h)(this.as,{class:this.decorationClasses,style:{whiteSpace:"normal"},"data-node-view-wrapper":"",onDragstart:this.onDragStart},null===(t=(e=this.$slots).default)||void 0===t?void 0:t.call(e))}});Boolean},7214:function(e,t,n){"use strict";n.d(t,{JU:function(){return s},x0:function(){return i}});var r=n(7862);const s="undefined"!==typeof document?document:{},i=("undefined"!==typeof DOMParser&&new DOMParser,e=>r.UI(e,((e,t)=>`${t}:${e};`)).join(""));s.ELEMENT_NODE,s.TEXT_NODE,s.CDATA_SECTION_NODE,s.COMMENT_NODE,s.DOCUMENT_NODE,s.DOCUMENT_TYPE_NODE,s.DOCUMENT_FRAGMENT_NODE},6413:function(e,t,n){"use strict";n.d(t,{jU:function(){return d},UG:function(){return h},hH:function(){return v}});n(7658);var r=n(7862),s=n(654);const i=e=>void 0===e?null:e;class o{constructor(){this.map=new Map}setItem(e,t){this.map.set(e,t)}getItem(e){return this.map.get(e)}}let a=new o,c=!0;try{"undefined"!==typeof localStorage&&(a=localStorage,c=!1)}catch(E){}const l=a;var u=n(7409);const h="undefined"!==typeof process&&process.release&&/node|io\.js/.test(process.release.name),d="undefined"!==typeof window&&"undefined"!==typeof document&&!h;"undefined"!==typeof navigator&&/Mac/.test(navigator.platform);let p;const f=[],g=()=>{if(void 0===p)if(h){p=r.Ue();const e=process.argv;let t=null;for(let n=0;n<e.length;n++){const r=e[n];"-"===r[0]?(null!==t&&p.set(t,""),t=r):null!==t?(p.set(t,r),t=null):f.push(r)}null!==t&&p.set(t,"")}else"object"===typeof location?(p=r.Ue(),(location.search||"?").slice(1).split("&").forEach((e=>{if(0!==e.length){const[t,n]=e.split("=");p.set(`--${s.NF(t,"-")}`,n),p.set(`-${s.NF(t,"-")}`,n)}}))):p=r.Ue();return p},m=e=>g().has(e),y=e=>i(h?{NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}[e.toUpperCase()]:l.getItem(e)),w=e=>m("--"+e)||null!==y(e),b=(w("production"),h&&u.gB({NODE_ENV:"production",BASE_URL:"/tiptap-yjs/"}.FORCE_COLOR,["true","1","2"])),v=!m("no-colors")&&(!h||process.stdout.isTTY||b)&&(!h||m("color")||b||null!==y("COLORTERM")||(y("TERM")||"").includes("color"))},6969:function(e,t,n){"use strict";n.d(t,{Nw:function(){return s},Ue:function(){return r},zR:function(){return i}});const r=e=>new Error(e),s=()=>{throw r("Method unimplemented")},i=()=>{throw r("Unexpected case")}},1634:function(e,t,n){"use strict";n.d(t,{Vs:function(){return i}});n(7658);const r=e=>class{constructor(e){this._=e}destroy(){e(this._)}},s=r(clearTimeout),i=(e,t)=>new s(setTimeout(t,e));r(clearInterval),r((e=>"undefined"!==typeof requestAnimationFrame&&cancelAnimationFrame(e))),r((e=>"undefined"!==typeof cancelIdleCallback&&cancelIdleCallback(e)))},7409:function(e,t,n){"use strict";n.d(t,{PP:function(){return r},gB:function(){return s}});n(3767),n(8585),n(8696);const r=(e,t,n=0)=>{try{for(;n<e.length;n++)e[n](...t)}finally{n<e.length&&r(e,t,n+1)}},s=(e,t)=>t.includes(e)},7862:function(e,t,n){"use strict";n.d(t,{JG:function(){return s},UI:function(){return o},Ue:function(){return r},Yj:function(){return a},Yu:function(){return i}});n(7658);const r=()=>new Map,s=e=>{const t=r();return e.forEach(((e,n)=>{t.set(n,e)})),t},i=(e,t,n)=>{let r=e.get(t);return void 0===r&&e.set(t,r=n()),r},o=(e,t)=>{const n=[];for(const[r,s]of e)n.push(t(s,r));return n},a=(e,t)=>{for(const[n,r]of e)if(t(r,n))return!0;return!1}},1383:function(e,t,n){"use strict";n.d(t,{Fp:function(){return o},GR:function(){return a},GW:function(){return r},VV:function(){return i},Wn:function(){return s}});const r=Math.floor,s=(Math.ceil,Math.abs),i=(Math.imul,Math.round,Math.log10,Math.log2,Math.log,Math.sqrt,(e,t)=>e<t?e:t),o=(e,t)=>e>t?e:t,a=(Number.isNaN,Math.pow,Math.sign,e=>0!==e?e<0:1/e<0)},1370:function(e,t,n){"use strict";n.d(t,{$m:function(){return a},XP:function(){return r}});n(7658);Object.assign;const r=Object.keys,s=e=>r(e).length,i=(e,t)=>{for(const n in e)if(!t(e[n],n))return!1;return!0},o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a=(e,t)=>e===t||s(e)===s(t)&&i(e,((e,n)=>(void 0!==e||o(t,n))&&t[n]===e))},6157:function(e,t,n){"use strict";n.d(t,{kw:function(){return c},U7:function(){return a},k$:function(){return u}});n(3767),n(8585),n(8696);var r=n(1383);"undefined"===typeof window||"undefined"!==typeof window.performance&&window.performance;const s="undefined"===typeof crypto?null:crypto,i=null!==s?e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);return s.getRandomValues(n),t}:e=>{const t=new ArrayBuffer(e),n=new Uint8Array(t);for(let r=0;r<e;r++)n[r]=Math.ceil(4294967295*Math.random()>>>0);return t},o=Math.random,a=()=>new Uint32Array(i(4))[0],c=e=>e[r.GW(o()*e.length)],l=[1e7]+-1e3+-4e3+-8e3+-1e11,u=()=>l.replace(/[018]/g,(e=>(e^a()&15>>e/4).toString(16)))},893:function(e,t,n){"use strict";n.d(t,{Ue:function(){return r}});const r=()=>new Set},654:function(e,t,n){"use strict";n.d(t,{CO:function(){return p},IK:function(){return r},NF:function(){return c},YZ:function(){return u},lz:function(){return d}});n(3767),n(8585),n(8696);const r=String.fromCharCode,s=(String.fromCodePoint,e=>e.toLowerCase()),i=/^\s*/g,o=e=>e.replace(i,""),a=/([A-Z])/g,c=(e,t)=>o(e.replace(a,(e=>`${t}${s(e)}`))),l=e=>{const t=unescape(encodeURIComponent(e)),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.codePointAt(s);return r},u="undefined"!==typeof TextEncoder?new TextEncoder:null,h=e=>u.encode(e),d=u?h:l;let p="undefined"===typeof TextDecoder?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});p&&1===p.decode(new Uint8Array).length&&(p=null)},203:function(e,t,n){"use strict";n.d(t,{$:function(){return w},h:function(){return y}});for(var r={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},i="undefined"!=typeof navigator&&/Chrome\/(\d+)/.exec(navigator.userAgent),o=("undefined"!=typeof navigator&&/Gecko\/\d+/.test(navigator.userAgent),"undefined"!=typeof navigator&&/Mac/.test(navigator.platform)),a="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),c=o||i&&+i[1]<57,l=0;l<10;l++)r[48+l]=r[96+l]=String(l);for(l=1;l<=24;l++)r[l+111]="F"+l;for(l=65;l<=90;l++)r[l]=String.fromCharCode(l+32),s[l]=String.fromCharCode(l);for(var u in r)s.hasOwnProperty(u)||(s[u]=r[u]);function h(e){var t=c&&(e.ctrlKey||e.altKey||e.metaKey)||a&&e.shiftKey&&e.key&&1==e.key.length||"Unidentified"==e.key,n=!t&&e.key||(e.shiftKey?s:r)[e.keyCode]||e.key||"Unidentified";return"Esc"==n&&(n="Escape"),"Del"==n&&(n="Delete"),"Left"==n&&(n="ArrowLeft"),"Up"==n&&(n="ArrowUp"),"Right"==n&&(n="ArrowRight"),"Down"==n&&(n="ArrowDown"),n}var d=n(157);const p="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function f(e){let t,n,r,s,i=e.split(/-(?!$)/),o=i[i.length-1];"Space"==o&&(o=" ");for(let a=0;a<i.length-1;a++){let e=i[a];if(/^(cmd|meta|m)$/i.test(e))s=!0;else if(/^a(lt)?$/i.test(e))t=!0;else if(/^(c|ctrl|control)$/i.test(e))n=!0;else if(/^s(hift)?$/i.test(e))r=!0;else{if(!/^mod$/i.test(e))throw new Error("Unrecognized modifier name: "+e);p?s=!0:n=!0}}return t&&(o="Alt-"+o),n&&(o="Ctrl-"+o),s&&(o="Meta-"+o),r&&(o="Shift-"+o),o}function g(e){let t=Object.create(null);for(let n in e)t[f(n)]=e[n];return t}function m(e,t,n=!0){return t.altKey&&(e="Alt-"+e),t.ctrlKey&&(e="Ctrl-"+e),t.metaKey&&(e="Meta-"+e),n&&t.shiftKey&&(e="Shift-"+e),e}function y(e){return new d.Sy({props:{handleKeyDown:w(e)}})}function w(e){let t=g(e);return function(e,n){let s,i=h(n),o=t[m(i,n)];if(o&&o(e.state,e.dispatch,e))return!0;if(1==i.length&&" "!=i){if(n.shiftKey){let r=t[m(i,n,!1)];if(r&&r(e.state,e.dispatch,e))return!0}if((n.shiftKey||n.altKey||n.metaKey||i.charCodeAt(0)>127)&&(s=r[n.keyCode])&&s!=i){let r=t[m(s,n)];if(r&&r(e.state,e.dispatch,e))return!0}}return!1}}},1543:function(e,t,n){"use strict";n.d(t,{aw:function(){return re},PW:function(){return be},HY:function(){return a},vc:function(){return h},ZU:function(){return ee},NB:function(){return N},Ts:function(){return O},e4:function(){return d},V_:function(){return te},p2:function(){return p}});n(7658);function r(e){this.content=e}r.prototype={constructor:r,find:function(e){for(var t=0;t<this.content.length;t+=2)if(this.content[t]===e)return t;return-1},get:function(e){var t=this.find(e);return-1==t?void 0:this.content[t+1]},update:function(e,t,n){var s=n&&n!=e?this.remove(n):this,i=s.find(e),o=s.content.slice();return-1==i?o.push(n||e,t):(o[i+1]=t,n&&(o[i]=n)),new r(o)},remove:function(e){var t=this.find(e);if(-1==t)return this;var n=this.content.slice();return n.splice(t,2),new r(n)},addToStart:function(e,t){return new r([e,t].concat(this.remove(e).content))},addToEnd:function(e,t){var n=this.remove(e).content.slice();return n.push(e,t),new r(n)},addBefore:function(e,t,n){var s=this.remove(t),i=s.content.slice(),o=s.find(e);return i.splice(-1==o?i.length:o,0,t,n),new r(i)},forEach:function(e){for(var t=0;t<this.content.length;t+=2)e(this.content[t],this.content[t+1])},prepend:function(e){return e=r.from(e),e.size?new r(e.content.concat(this.subtract(e).content)):this},append:function(e){return e=r.from(e),e.size?new r(this.subtract(e).content.concat(e.content)):this},subtract:function(e){var t=this;e=r.from(e);for(var n=0;n<e.content.length;n+=2)t=t.remove(e.content[n]);return t},toObject:function(){var e={};return this.forEach((function(t,n){e[t]=n})),e},get size(){return this.content.length>>1}},r.from=function(e){if(e instanceof r)return e;var t=[];if(e)for(var n in e)t.push(n,e[n]);return new r(t)};var s=r;function i(e,t,n){for(let r=0;;r++){if(r==e.childCount||r==t.childCount)return e.childCount==t.childCount?null:n;let s=e.child(r),o=t.child(r);if(s!=o){if(!s.sameMarkup(o))return n;if(s.isText&&s.text!=o.text){for(let e=0;s.text[e]==o.text[e];e++)n++;return n}if(s.content.size||o.content.size){let e=i(s.content,o.content,n+1);if(null!=e)return e}n+=s.nodeSize}else n+=s.nodeSize}}function o(e,t,n,r){for(let s=e.childCount,i=t.childCount;;){if(0==s||0==i)return s==i?null:{a:n,b:r};let a=e.child(--s),c=t.child(--i),l=a.nodeSize;if(a!=c){if(!a.sameMarkup(c))return{a:n,b:r};if(a.isText&&a.text!=c.text){let e=0,t=Math.min(a.text.length,c.text.length);while(e<t&&a.text[a.text.length-e-1]==c.text[c.text.length-e-1])e++,n--,r--;return{a:n,b:r}}if(a.content.size||c.content.size){let e=o(a.content,c.content,n-1,r-1);if(e)return e}n-=l,r-=l}else n-=l,r-=l}}class a{constructor(e,t){if(this.content=e,this.size=t||0,null==t)for(let n=0;n<e.length;n++)this.size+=e[n].nodeSize}nodesBetween(e,t,n,r=0,s){for(let i=0,o=0;o<t;i++){let a=this.content[i],c=o+a.nodeSize;if(c>e&&!1!==n(a,r+o,s||null,i)&&a.content.size){let s=o+1;a.nodesBetween(Math.max(0,e-s),Math.min(a.content.size,t-s),n,r+s)}o=c}}descendants(e){this.nodesBetween(0,this.size,e)}textBetween(e,t,n,r){let s="",i=!0;return this.nodesBetween(e,t,((o,a)=>{o.isText?(s+=o.text.slice(Math.max(e,a)-a,t-a),i=!n):o.isLeaf?(r?s+="function"===typeof r?r(o):r:o.type.spec.leafText&&(s+=o.type.spec.leafText(o)),i=!n):!i&&o.isBlock&&(s+=n,i=!0)}),0),s}append(e){if(!e.size)return this;if(!this.size)return e;let t=this.lastChild,n=e.firstChild,r=this.content.slice(),s=0;for(t.isText&&t.sameMarkup(n)&&(r[r.length-1]=t.withText(t.text+n.text),s=1);s<e.content.length;s++)r.push(e.content[s]);return new a(r,this.size+e.size)}cut(e,t=this.size){if(0==e&&t==this.size)return this;let n=[],r=0;if(t>e)for(let s=0,i=0;i<t;s++){let o=this.content[s],a=i+o.nodeSize;a>e&&((i<e||a>t)&&(o=o.isText?o.cut(Math.max(0,e-i),Math.min(o.text.length,t-i)):o.cut(Math.max(0,e-i-1),Math.min(o.content.size,t-i-1))),n.push(o),r+=o.nodeSize),i=a}return new a(n,r)}cutByIndex(e,t){return e==t?a.empty:0==e&&t==this.content.length?this:new a(this.content.slice(e,t))}replaceChild(e,t){let n=this.content[e];if(n==t)return this;let r=this.content.slice(),s=this.size+t.nodeSize-n.nodeSize;return r[e]=t,new a(r,s)}addToStart(e){return new a([e].concat(this.content),this.size+e.nodeSize)}addToEnd(e){return new a(this.content.concat(e),this.size+e.nodeSize)}eq(e){if(this.content.length!=e.content.length)return!1;for(let t=0;t<this.content.length;t++)if(!this.content[t].eq(e.content[t]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(e){let t=this.content[e];if(!t)throw new RangeError("Index "+e+" out of range for "+this);return t}maybeChild(e){return this.content[e]||null}forEach(e){for(let t=0,n=0;t<this.content.length;t++){let r=this.content[t];e(r,n,t),n+=r.nodeSize}}findDiffStart(e,t=0){return i(this,e,t)}findDiffEnd(e,t=this.size,n=e.size){return o(this,e,t,n)}findIndex(e,t=-1){if(0==e)return l(0,e);if(e==this.size)return l(this.content.length,e);if(e>this.size||e<0)throw new RangeError(`Position ${e} outside of fragment (${this})`);for(let n=0,r=0;;n++){let s=this.child(n),i=r+s.nodeSize;if(i>=e)return i==e||t>0?l(n+1,i):l(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((e=>e.toJSON())):null}static fromJSON(e,t){if(!t)return a.empty;if(!Array.isArray(t))throw new RangeError("Invalid input for Fragment.fromJSON");return new a(t.map(e.nodeFromJSON))}static fromArray(e){if(!e.length)return a.empty;let t,n=0;for(let r=0;r<e.length;r++){let s=e[r];n+=s.nodeSize,r&&s.isText&&e[r-1].sameMarkup(s)?(t||(t=e.slice(0,r)),t[t.length-1]=s.withText(t[t.length-1].text+s.text)):t&&t.push(s)}return new a(t||e,n)}static from(e){if(!e)return a.empty;if(e instanceof a)return e;if(Array.isArray(e))return this.fromArray(e);if(e.attrs)return new a([e],e.nodeSize);throw new RangeError("Can not convert "+e+" to a Fragment"+(e.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}a.empty=new a([],0);const c={index:0,offset:0};function l(e,t){return c.index=e,c.offset=t,c}function u(e,t){if(e===t)return!0;if(!e||"object"!=typeof e||!t||"object"!=typeof t)return!1;let n=Array.isArray(e);if(Array.isArray(t)!=n)return!1;if(n){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!u(e[n],t[n]))return!1}else{for(let n in e)if(!(n in t)||!u(e[n],t[n]))return!1;for(let n in t)if(!(n in e))return!1}return!0}class h{constructor(e,t){this.type=e,this.attrs=t}addToSet(e){let t,n=!1;for(let r=0;r<e.length;r++){let s=e[r];if(this.eq(s))return e;if(this.type.excludes(s.type))t||(t=e.slice(0,r));else{if(s.type.excludes(this.type))return e;!n&&s.type.rank>this.type.rank&&(t||(t=e.slice(0,r)),t.push(this),n=!0),t&&t.push(s)}}return t||(t=e.slice()),n||t.push(this),t}removeFromSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return e.slice(0,t).concat(e.slice(t+1));return e}isInSet(e){for(let t=0;t<e.length;t++)if(this.eq(e[t]))return!0;return!1}eq(e){return this==e||this.type==e.type&&u(this.attrs,e.attrs)}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Mark.fromJSON");let n=e.marks[t.type];if(!n)throw new RangeError(`There is no mark type ${t.type} in this schema`);return n.create(t.attrs)}static sameSet(e,t){if(e==t)return!0;if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].eq(t[n]))return!1;return!0}static setFrom(e){if(!e||Array.isArray(e)&&0==e.length)return h.none;if(e instanceof h)return[e];let t=e.slice();return t.sort(((e,t)=>e.type.rank-t.type.rank)),t}}h.none=[];class d extends Error{}class p{constructor(e,t,n){this.content=e,this.openStart=t,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(e,t){let n=g(this.content,e+this.openStart,t);return n&&new p(n,this.openStart,this.openEnd)}removeBetween(e,t){return new p(f(this.content,e+this.openStart,t+this.openStart),this.openStart,this.openEnd)}eq(e){return this.content.eq(e.content)&&this.openStart==e.openStart&&this.openEnd==e.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let e={content:this.content.toJSON()};return this.openStart>0&&(e.openStart=this.openStart),this.openEnd>0&&(e.openEnd=this.openEnd),e}static fromJSON(e,t){if(!t)return p.empty;let n=t.openStart||0,r=t.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new p(a.fromJSON(e,t.content),n,r)}static maxOpen(e,t=!0){let n=0,r=0;for(let s=e.firstChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.firstChild)n++;for(let s=e.lastChild;s&&!s.isLeaf&&(t||!s.type.spec.isolating);s=s.lastChild)r++;return new p(e,n,r)}}function f(e,t,n){let{index:r,offset:s}=e.findIndex(t),i=e.maybeChild(r),{index:o,offset:a}=e.findIndex(n);if(s==t||i.isText){if(a!=n&&!e.child(o).isText)throw new RangeError("Removing non-flat range");return e.cut(0,t).append(e.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return e.replaceChild(r,i.copy(f(i.content,t-s-1,n-s-1)))}function g(e,t,n,r){let{index:s,offset:i}=e.findIndex(t),o=e.maybeChild(s);if(i==t||o.isText)return r&&!r.canReplace(s,s,n)?null:e.cut(0,t).append(n).append(e.cut(t));let a=g(o.content,t-i-1,n);return a&&e.replaceChild(s,o.copy(a))}function m(e,t,n){if(n.openStart>e.depth)throw new d("Inserted content deeper than insertion position");if(e.depth-n.openStart!=t.depth-n.openEnd)throw new d("Inconsistent open depths");return y(e,t,n,0)}function y(e,t,n,r){let s=e.index(r),i=e.node(r);if(s==t.index(r)&&r<e.depth-n.openStart){let o=y(e,t,n,r+1);return i.copy(i.content.replaceChild(s,o))}if(n.content.size){if(n.openStart||n.openEnd||e.depth!=r||t.depth!=r){let{start:s,end:o}=A(n,e);return _(i,S(e,s,o,t,r))}{let r=e.parent,s=r.content;return _(r,s.cut(0,e.parentOffset).append(n.content).append(s.cut(t.parentOffset)))}}return _(i,k(e,t,r))}function w(e,t){if(!t.type.compatibleContent(e.type))throw new d("Cannot join "+t.type.name+" onto "+e.type.name)}function b(e,t,n){let r=e.node(n);return w(r,t.node(n)),r}function v(e,t){let n=t.length-1;n>=0&&e.isText&&e.sameMarkup(t[n])?t[n]=e.withText(t[n].text+e.text):t.push(e)}function E(e,t,n,r){let s=(t||e).node(n),i=0,o=t?t.index(n):s.childCount;e&&(i=e.index(n),e.depth>n?i++:e.textOffset&&(v(e.nodeAfter,r),i++));for(let a=i;a<o;a++)v(s.child(a),r);t&&t.depth==n&&t.textOffset&&v(t.nodeBefore,r)}function _(e,t){return e.type.checkContent(t),e.copy(t)}function S(e,t,n,r,s){let i=e.depth>s&&b(e,t,s+1),o=r.depth>s&&b(n,r,s+1),c=[];return E(null,e,s,c),i&&o&&t.index(s)==n.index(s)?(w(i,o),v(_(i,S(e,t,n,r,s+1)),c)):(i&&v(_(i,k(e,t,s+1)),c),E(t,n,s,c),o&&v(_(o,k(n,r,s+1)),c)),E(r,null,s,c),new a(c)}function k(e,t,n){let r=[];if(E(null,e,n,r),e.depth>n){let s=b(e,t,n+1);v(_(s,k(e,t,n+1)),r)}return E(t,null,n,r),new a(r)}function A(e,t){let n=t.depth-e.openStart,r=t.node(n),s=r.copy(e.content);for(let i=n-1;i>=0;i--)s=t.node(i).copy(a.from(s));return{start:s.resolveNoCache(e.openStart+n),end:s.resolveNoCache(s.content.size-e.openEnd-n)}}p.empty=new p(a.empty,0,0);class T{constructor(e,t,n){this.pos=e,this.path=t,this.parentOffset=n,this.depth=t.length/3-1}resolveDepth(e){return null==e?this.depth:e<0?this.depth+e:e}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(e){return this.path[3*this.resolveDepth(e)]}index(e){return this.path[3*this.resolveDepth(e)+1]}indexAfter(e){return e=this.resolveDepth(e),this.index(e)+(e!=this.depth||this.textOffset?1:0)}start(e){return e=this.resolveDepth(e),0==e?0:this.path[3*e-1]+1}end(e){return e=this.resolveDepth(e),this.start(e)+this.node(e).content.size}before(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position before the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]}after(e){if(e=this.resolveDepth(e),!e)throw new RangeError("There is no position after the top-level node");return e==this.depth+1?this.pos:this.path[3*e-1]+this.path[3*e].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let e=this.parent,t=this.index(this.depth);if(t==e.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=e.child(t);return n?e.child(t).cut(n):r}get nodeBefore(){let e=this.index(this.depth),t=this.pos-this.path[this.path.length-1];return t?this.parent.child(e).cut(0,t):0==e?null:this.parent.child(e-1)}posAtIndex(e,t){t=this.resolveDepth(t);let n=this.path[3*t],r=0==t?0:this.path[3*t-1]+1;for(let s=0;s<e;s++)r+=n.child(s).nodeSize;return r}marks(){let e=this.parent,t=this.index();if(0==e.content.size)return h.none;if(this.textOffset)return e.child(t).marks;let n=e.maybeChild(t-1),r=e.maybeChild(t);if(!n){let e=n;n=r,r=e}let s=n.marks;for(var i=0;i<s.length;i++)!1!==s[i].type.spec.inclusive||r&&s[i].isInSet(r.marks)||(s=s[i--].removeFromSet(s));return s}marksAcross(e){let t=this.parent.maybeChild(this.index());if(!t||!t.isInline)return null;let n=t.marks,r=e.parent.maybeChild(e.index());for(var s=0;s<n.length;s++)!1!==n[s].type.spec.inclusive||r&&n[s].isInSet(r.marks)||(n=n[s--].removeFromSet(n));return n}sharedDepth(e){for(let t=this.depth;t>0;t--)if(this.start(t)<=e&&this.end(t)>=e)return t;return 0}blockRange(e=this,t){if(e.pos<this.pos)return e.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==e.pos?1:0);n>=0;n--)if(e.pos<=this.end(n)&&(!t||t(this.node(n))))return new O(this,e,n);return null}sameParent(e){return this.pos-this.parentOffset==e.pos-e.parentOffset}max(e){return e.pos>this.pos?e:this}min(e){return e.pos<this.pos?e:this}toString(){let e="";for(let t=1;t<=this.depth;t++)e+=(e?"/":"")+this.node(t).type.name+"_"+this.index(t-1);return e+":"+this.parentOffset}static resolve(e,t){if(!(t>=0&&t<=e.content.size))throw new RangeError("Position "+t+" out of range");let n=[],r=0,s=t;for(let i=e;;){let{index:e,offset:t}=i.content.findIndex(s),o=s-t;if(n.push(i,e,r+t),!o)break;if(i=i.child(e),i.isText)break;s=o-1,r+=t+1}return new T(t,n,s)}static resolveCached(e,t){for(let r=0;r<C.length;r++){let n=C[r];if(n.pos==t&&n.doc==e)return n}let n=C[I]=T.resolve(e,t);return I=(I+1)%R,n}}let C=[],I=0,R=12;class O{constructor(e,t,n){this.$from=e,this.$to=t,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const x=Object.create(null);class N{constructor(e,t,n,r=h.none){this.type=e,this.attrs=t,this.marks=r,this.content=n||a.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(e){return this.content.child(e)}maybeChild(e){return this.content.maybeChild(e)}forEach(e){this.content.forEach(e)}nodesBetween(e,t,n,r=0){this.content.nodesBetween(e,t,n,r,this)}descendants(e){this.nodesBetween(0,this.content.size,e)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(e,t,n,r){return this.content.textBetween(e,t,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(e){return this==e||this.sameMarkup(e)&&this.content.eq(e.content)}sameMarkup(e){return this.hasMarkup(e.type,e.attrs,e.marks)}hasMarkup(e,t,n){return this.type==e&&u(this.attrs,t||e.defaultAttrs||x)&&h.sameSet(this.marks,n||h.none)}copy(e=null){return e==this.content?this:new N(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new N(this.type,this.attrs,this.content,e)}cut(e,t=this.content.size){return 0==e&&t==this.content.size?this:this.copy(this.content.cut(e,t))}slice(e,t=this.content.size,n=!1){if(e==t)return p.empty;let r=this.resolve(e),s=this.resolve(t),i=n?0:r.sharedDepth(t),o=r.start(i),a=r.node(i),c=a.content.cut(r.pos-o,s.pos-o);return new p(c,r.depth-i,s.depth-i)}replace(e,t,n){return m(this.resolve(e),this.resolve(t),n)}nodeAt(e){for(let t=this;;){let{index:n,offset:r}=t.content.findIndex(e);if(t=t.maybeChild(n),!t)return null;if(r==e||t.isText)return t;e-=r+1}}childAfter(e){let{index:t,offset:n}=this.content.findIndex(e);return{node:this.content.maybeChild(t),index:t,offset:n}}childBefore(e){if(0==e)return{node:null,index:0,offset:0};let{index:t,offset:n}=this.content.findIndex(e);if(n<e)return{node:this.content.child(t),index:t,offset:n};let r=this.content.child(t-1);return{node:r,index:t-1,offset:n-r.nodeSize}}resolve(e){return T.resolveCached(this,e)}resolveNoCache(e){return T.resolve(this,e)}rangeHasMark(e,t,n){let r=!1;return t>e&&this.nodesBetween(e,t,(e=>(n.isInSet(e.marks)&&(r=!0),!r))),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let e=this.type.name;return this.content.size&&(e+="("+this.content.toStringInner()+")"),P(this.marks,e)}contentMatchAt(e){let t=this.type.contentMatch.matchFragment(this.content,0,e);if(!t)throw new Error("Called contentMatchAt on a node with invalid content");return t}canReplace(e,t,n=a.empty,r=0,s=n.childCount){let i=this.contentMatchAt(e).matchFragment(n,r,s),o=i&&i.matchFragment(this.content,t);if(!o||!o.validEnd)return!1;for(let a=r;a<s;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(e,t,n,r){if(r&&!this.type.allowsMarks(r))return!1;let s=this.contentMatchAt(e).matchType(n),i=s&&s.matchFragment(this.content,t);return!!i&&i.validEnd}canAppend(e){return e.content.size?this.canReplace(this.childCount,this.childCount,e.content):this.type.compatibleContent(e.type)}check(){this.type.checkContent(this.content);let e=h.none;for(let t=0;t<this.marks.length;t++)e=this.marks[t].addToSet(e);if(!h.sameSet(e,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((e=>e.type.name))}`);this.content.forEach((e=>e.check()))}toJSON(){let e={type:this.type.name};for(let t in this.attrs){e.attrs=this.attrs;break}return this.content.size&&(e.content=this.content.toJSON()),this.marks.length&&(e.marks=this.marks.map((e=>e.toJSON()))),e}static fromJSON(e,t){if(!t)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(t.marks){if(!Array.isArray(t.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=t.marks.map(e.markFromJSON)}if("text"==t.type){if("string"!=typeof t.text)throw new RangeError("Invalid text node in JSON");return e.text(t.text,n)}let r=a.fromJSON(e,t.content);return e.nodeType(t.type).create(t.attrs,r,n)}}N.prototype.text=void 0;class D extends N{constructor(e,t,n,r){if(super(e,t,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):P(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(e,t){return this.text.slice(e,t)}get nodeSize(){return this.text.length}mark(e){return e==this.marks?this:new D(this.type,this.attrs,this.text,e)}withText(e){return e==this.text?this:new D(this.type,this.attrs,e,this.marks)}cut(e=0,t=this.text.length){return 0==e&&t==this.text.length?this:this.withText(this.text.slice(e,t))}eq(e){return this.sameMarkup(e)&&this.text==e.text}toJSON(){let e=super.toJSON();return e.text=this.text,e}}function P(e,t){for(let n=e.length-1;n>=0;n--)t=e[n].type.name+"("+t+")";return t}class L{constructor(e){this.validEnd=e,this.next=[],this.wrapCache=[]}static parse(e,t){let n=new M(e,t);if(null==n.next)return L.empty;let r=B(n);n.next&&n.err("Unexpected trailing text");let s=G(H(r));return W(s,n),s}matchType(e){for(let t=0;t<this.next.length;t++)if(this.next[t].type==e)return this.next[t].next;return null}matchFragment(e,t=0,n=e.childCount){let r=this;for(let s=t;r&&s<n;s++)r=r.matchType(e.child(s).type);return r}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let e=0;e<this.next.length;e++){let{type:t}=this.next[e];if(!t.isText&&!t.hasRequiredAttrs())return t}return null}compatible(e){for(let t=0;t<this.next.length;t++)for(let n=0;n<e.next.length;n++)if(this.next[t].type==e.next[n].type)return!0;return!1}fillBefore(e,t=!1,n=0){let r=[this];function s(i,o){let c=i.matchFragment(e,n);if(c&&(!t||c.validEnd))return a.from(o.map((e=>e.createAndFill())));for(let e=0;e<i.next.length;e++){let{type:t,next:n}=i.next[e];if(!t.isText&&!t.hasRequiredAttrs()&&-1==r.indexOf(n)){r.push(n);let e=s(n,o.concat(t));if(e)return e}}return null}return s(this,[])}findWrapping(e){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==e)return this.wrapCache[n+1];let t=this.computeWrapping(e);return this.wrapCache.push(e,t),t}computeWrapping(e){let t=Object.create(null),n=[{match:this,type:null,via:null}];while(n.length){let r=n.shift(),s=r.match;if(s.matchType(e)){let e=[];for(let t=r;t.type;t=t.via)e.push(t.type);return e.reverse()}for(let e=0;e<s.next.length;e++){let{type:i,next:o}=s.next[e];i.isLeaf||i.hasRequiredAttrs()||i.name in t||r.type&&!o.validEnd||(n.push({match:i.contentMatch,type:i,via:r}),t[i.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(e){if(e>=this.next.length)throw new RangeError(`There's no ${e}th edge in this content match`);return this.next[e]}toString(){let e=[];function t(n){e.push(n);for(let r=0;r<n.next.length;r++)-1==e.indexOf(n.next[r].next)&&t(n.next[r].next)}return t(this),e.map(((t,n)=>{let r=n+(t.validEnd?"*":" ")+" ";for(let s=0;s<t.next.length;s++)r+=(s?", ":"")+t.next[s].type.name+"->"+e.indexOf(t.next[s].next);return r})).join("\n")}}L.empty=new L(!0);class M{constructor(e,t){this.string=e,this.nodeTypes=t,this.inline=null,this.pos=0,this.tokens=e.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(e){return this.next==e&&(this.pos++||!0)}err(e){throw new SyntaxError(e+" (in content expression '"+this.string+"')")}}function B(e){let t=[];do{t.push(U(e))}while(e.eat("|"));return 1==t.length?t[0]:{type:"choice",exprs:t}}function U(e){let t=[];do{t.push(V(e))}while(e.next&&")"!=e.next&&"|"!=e.next);return 1==t.length?t[0]:{type:"seq",exprs:t}}function V(e){let t=$(e);for(;;)if(e.eat("+"))t={type:"plus",expr:t};else if(e.eat("*"))t={type:"star",expr:t};else if(e.eat("?"))t={type:"opt",expr:t};else{if(!e.eat("{"))break;t=j(e,t)}return t}function F(e){/\D/.test(e.next)&&e.err("Expected number, got '"+e.next+"'");let t=Number(e.next);return e.pos++,t}function j(e,t){let n=F(e),r=n;return e.eat(",")&&(r="}"!=e.next?F(e):-1),e.eat("}")||e.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:t}}function z(e,t){let n=e.nodeTypes,r=n[t];if(r)return[r];let s=[];for(let i in n){let e=n[i];e.groups.indexOf(t)>-1&&s.push(e)}return 0==s.length&&e.err("No node type or group '"+t+"' found"),s}function $(e){if(e.eat("(")){let t=B(e);return e.eat(")")||e.err("Missing closing paren"),t}if(!/\W/.test(e.next)){let t=z(e,e.next).map((t=>(null==e.inline?e.inline=t.isInline:e.inline!=t.isInline&&e.err("Mixing inline and block content"),{type:"name",value:t})));return e.pos++,1==t.length?t[0]:{type:"choice",exprs:t}}e.err("Unexpected token '"+e.next+"'")}function H(e){let t=[[]];return s(i(e,0),n()),t;function n(){return t.push([])-1}function r(e,n,r){let s={term:r,to:n};return t[e].push(s),s}function s(e,t){e.forEach((e=>e.to=t))}function i(e,t){if("choice"==e.type)return e.exprs.reduce(((e,n)=>e.concat(i(n,t))),[]);if("seq"!=e.type){if("star"==e.type){let o=n();return r(t,o),s(i(e.expr,o),o),[r(o)]}if("plus"==e.type){let o=n();return s(i(e.expr,t),o),s(i(e.expr,o),o),[r(o)]}if("opt"==e.type)return[r(t)].concat(i(e.expr,t));if("range"==e.type){let o=t;for(let t=0;t<e.min;t++){let t=n();s(i(e.expr,o),t),o=t}if(-1==e.max)s(i(e.expr,o),o);else for(let t=e.min;t<e.max;t++){let t=n();r(o,t),s(i(e.expr,o),t),o=t}return[r(o)]}if("name"==e.type)return[r(t,void 0,e.value)];throw new Error("Unknown expr type")}for(let r=0;;r++){let o=i(e.exprs[r],t);if(r==e.exprs.length-1)return o;s(o,t=n())}}}function K(e,t){return t-e}function q(e,t){let n=[];return r(t),n.sort(K);function r(t){let s=e[t];if(1==s.length&&!s[0].term)return r(s[0].to);n.push(t);for(let e=0;e<s.length;e++){let{term:t,to:i}=s[e];t||-1!=n.indexOf(i)||r(i)}}}function G(e){let t=Object.create(null);return n(q(e,0));function n(r){let s=[];r.forEach((t=>{e[t].forEach((({term:t,to:n})=>{if(!t)return;let r;for(let e=0;e<s.length;e++)s[e][0]==t&&(r=s[e][1]);q(e,n).forEach((e=>{r||s.push([t,r=[]]),-1==r.indexOf(e)&&r.push(e)}))}))}));let i=t[r.join(",")]=new L(r.indexOf(e.length-1)>-1);for(let e=0;e<s.length;e++){let r=s[e][1].sort(K);i.next.push({type:s[e][0],next:t[r.join(",")]||n(r)})}return i}}function W(e,t){for(let n=0,r=[e];n<r.length;n++){let e=r[n],s=!e.validEnd,i=[];for(let t=0;t<e.next.length;t++){let{type:n,next:o}=e.next[t];i.push(n.name),!s||n.isText||n.hasRequiredAttrs()||(s=!1),-1==r.indexOf(o)&&r.push(o)}s&&t.err("Only non-generatable nodes ("+i.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}function Y(e){let t=Object.create(null);for(let n in e){let r=e[n];if(!r.hasDefault)return null;t[n]=r.default}return t}function J(e,t){let n=Object.create(null);for(let r in e){let s=t&&t[r];if(void 0===s){let t=e[r];if(!t.hasDefault)throw new RangeError("No value supplied for attribute "+r);s=t.default}n[r]=s}return n}function Q(e){let t=Object.create(null);if(e)for(let n in e)t[n]=new Z(e[n]);return t}class X{constructor(e,t,n){this.name=e,this.schema=t,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=Q(n.attrs),this.defaultAttrs=Y(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==e),this.isText="text"==e}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==L.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let e in this.attrs)if(this.attrs[e].isRequired)return!0;return!1}compatibleContent(e){return this==e||this.contentMatch.compatible(e.contentMatch)}computeAttrs(e){return!e&&this.defaultAttrs?this.defaultAttrs:J(this.attrs,e)}create(e=null,t,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new N(this,this.computeAttrs(e),a.from(t),h.setFrom(n))}createChecked(e=null,t,n){return t=a.from(t),this.checkContent(t),new N(this,this.computeAttrs(e),t,h.setFrom(n))}createAndFill(e=null,t,n){if(e=this.computeAttrs(e),t=a.from(t),t.size){let e=this.contentMatch.fillBefore(t);if(!e)return null;t=e.append(t)}let r=this.contentMatch.matchFragment(t),s=r&&r.fillBefore(a.empty,!0);return s?new N(this,e,t.append(s),h.setFrom(n)):null}validContent(e){let t=this.contentMatch.matchFragment(e);if(!t||!t.validEnd)return!1;for(let n=0;n<e.childCount;n++)if(!this.allowsMarks(e.child(n).marks))return!1;return!0}checkContent(e){if(!this.validContent(e))throw new RangeError(`Invalid content for node ${this.name}: ${e.toString().slice(0,50)}`)}allowsMarkType(e){return null==this.markSet||this.markSet.indexOf(e)>-1}allowsMarks(e){if(null==this.markSet)return!0;for(let t=0;t<e.length;t++)if(!this.allowsMarkType(e[t].type))return!1;return!0}allowedMarks(e){if(null==this.markSet)return e;let t;for(let n=0;n<e.length;n++)this.allowsMarkType(e[n].type)?t&&t.push(e[n]):t||(t=e.slice(0,n));return t?t.length?t:h.none:e}static compile(e,t){let n=Object.create(null);e.forEach(((e,r)=>n[e]=new X(e,t,r)));let r=t.spec.topNode||"doc";if(!n[r])throw new RangeError("Schema is missing its top node type ('"+r+"')");if(!n.text)throw new RangeError("Every schema needs a 'text' type");for(let s in n.text.attrs)throw new RangeError("The text node type should not have attributes");return n}}class Z{constructor(e){this.hasDefault=Object.prototype.hasOwnProperty.call(e,"default"),this.default=e.default}get isRequired(){return!this.hasDefault}}class ee{constructor(e,t,n,r){this.name=e,this.rank=t,this.schema=n,this.spec=r,this.attrs=Q(r.attrs),this.excluded=null;let s=Y(this.attrs);this.instance=s?new h(this,s):null}create(e=null){return!e&&this.instance?this.instance:new h(this,J(this.attrs,e))}static compile(e,t){let n=Object.create(null),r=0;return e.forEach(((e,s)=>n[e]=new ee(e,r++,t,s))),n}removeFromSet(e){for(var t=0;t<e.length;t++)e[t].type==this&&(e=e.slice(0,t).concat(e.slice(t+1)),t--);return e}isInSet(e){for(let t=0;t<e.length;t++)if(e[t].type==this)return e[t]}excludes(e){return this.excluded.indexOf(e)>-1}}class te{constructor(e){this.cached=Object.create(null);let t=this.spec={};for(let r in e)t[r]=e[r];t.nodes=s.from(e.nodes),t.marks=s.from(e.marks||{}),this.nodes=X.compile(this.spec.nodes,this),this.marks=ee.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let e=this.nodes[r],t=e.spec.content||"",s=e.spec.marks;e.contentMatch=n[t]||(n[t]=L.parse(t,this.nodes)),e.inlineContent=e.contentMatch.inlineContent,e.markSet="_"==s?null:s?ne(this,s.split(" ")):""!=s&&e.inlineContent?null:[]}for(let r in this.marks){let e=this.marks[r],t=e.spec.excludes;e.excluded=null==t?[e]:""==t?[]:ne(this,t.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(e,t=null,n,r){if("string"==typeof e)e=this.nodeType(e);else{if(!(e instanceof X))throw new RangeError("Invalid node type: "+e);if(e.schema!=this)throw new RangeError("Node type from different schema used ("+e.name+")")}return e.createChecked(t,n,r)}text(e,t){let n=this.nodes.text;return new D(n,n.defaultAttrs,e,h.setFrom(t))}mark(e,t){return"string"==typeof e&&(e=this.marks[e]),e.create(t)}nodeFromJSON(e){return N.fromJSON(this,e)}markFromJSON(e){return h.fromJSON(this,e)}nodeType(e){let t=this.nodes[e];if(!t)throw new RangeError("Unknown node type: "+e);return t}}function ne(e,t){let n=[];for(let r=0;r<t.length;r++){let s=t[r],i=e.marks[s],o=i;if(i)n.push(i);else for(let t in e.marks){let r=e.marks[t];("_"==s||r.spec.group&&r.spec.group.split(" ").indexOf(s)>-1)&&n.push(o=r)}if(!o)throw new SyntaxError("Unknown mark type: '"+t[r]+"'")}return n}class re{constructor(e,t){this.schema=e,this.rules=t,this.tags=[],this.styles=[],t.forEach((e=>{e.tag?this.tags.push(e):e.style&&this.styles.push(e)})),this.normalizeLists=!this.tags.some((t=>{if(!/^(ul|ol)\b/.test(t.tag)||!t.node)return!1;let n=e.nodes[t.node];return n.contentMatch.matchType(n)}))}parse(e,t={}){let n=new de(this,t,!1);return n.addAll(e,t.from,t.to),n.finish()}parseSlice(e,t={}){let n=new de(this,t,!0);return n.addAll(e,t.from,t.to),p.maxOpen(n.finish())}matchTag(e,t,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(fe(e,n.tag)&&(void 0===n.namespace||e.namespaceURI==n.namespace)&&(!n.context||t.matchesContext(n.context))){if(n.getAttrs){let t=n.getAttrs(e);if(!1===t)continue;n.attrs=t||void 0}return n}}}matchStyle(e,t,n,r){for(let s=r?this.styles.indexOf(r)+1:0;s<this.styles.length;s++){let r=this.styles[s],i=r.style;if(!(0!=i.indexOf(e)||r.context&&!n.matchesContext(r.context)||i.length>e.length&&(61!=i.charCodeAt(e.length)||i.slice(e.length+1)!=t))){if(r.getAttrs){let e=r.getAttrs(t);if(!1===e)continue;r.attrs=e||void 0}return r}}}static schemaRules(e){let t=[];function n(e){let n=null==e.priority?50:e.priority,r=0;for(;r<t.length;r++){let e=t[r],s=null==e.priority?50:e.priority;if(s<n)break}t.splice(r,0,e)}for(let r in e.marks){let t=e.marks[r].spec.parseDOM;t&&t.forEach((e=>{n(e=me(e)),e.mark||e.ignore||e.clearMark||(e.mark=r)}))}for(let r in e.nodes){let t=e.nodes[r].spec.parseDOM;t&&t.forEach((e=>{n(e=me(e)),e.node||e.ignore||e.mark||(e.node=r)}))}return t}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new re(e,re.schemaRules(e)))}}const se={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},ie={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},oe={ol:!0,ul:!0},ae=1,ce=2,le=4;function ue(e,t,n){return null!=t?(t?ae:0)|("full"===t?ce:0):e&&"pre"==e.whitespace?ae|ce:n&~le}class he{constructor(e,t,n,r,s,i,o){this.type=e,this.attrs=t,this.marks=n,this.pendingMarks=r,this.solid=s,this.options=o,this.content=[],this.activeMarks=h.none,this.stashMarks=[],this.match=i||(o&le?null:e.contentMatch)}findWrapping(e){if(!this.match){if(!this.type)return[];let t=this.type.contentMatch.fillBefore(a.from(e));if(!t){let t,n=this.type.contentMatch;return(t=n.findWrapping(e.type))?(this.match=n,t):null}this.match=this.type.contentMatch.matchFragment(t)}return this.match.findWrapping(e.type)}finish(e){if(!(this.options&ae)){let e,t=this.content[this.content.length-1];if(t&&t.isText&&(e=/[ \t\r\n\u000c]+$/.exec(t.text))){let n=t;t.text.length==e[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-e[0].length))}}let t=a.from(this.content);return!e&&this.match&&(t=t.append(this.match.fillBefore(a.empty,!0))),this.type?this.type.create(this.attrs,t,this.marks):t}popFromStashMark(e){for(let t=this.stashMarks.length-1;t>=0;t--)if(e.eq(this.stashMarks[t]))return this.stashMarks.splice(t,1)[0]}applyPending(e){for(let t=0,n=this.pendingMarks;t<n.length;t++){let r=n[t];(this.type?this.type.allowsMarkType(r.type):ye(r.type,e))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}}inlineContext(e){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:e.parentNode&&!se.hasOwnProperty(e.parentNode.nodeName.toLowerCase())}}class de{constructor(e,t,n){this.parser=e,this.options=t,this.isOpen=n,this.open=0;let r,s=t.topNode,i=ue(null,t.preserveWhitespace,0)|(n?le:0);r=s?new he(s.type,s.attrs,h.none,h.none,!0,t.topMatch||s.type.contentMatch,i):new he(n?null:e.schema.topNodeType,null,h.none,h.none,!0,null,i),this.nodes=[r],this.find=t.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(e){if(3==e.nodeType)this.addTextNode(e);else if(1==e.nodeType){let t=e.getAttribute("style");if(t){let n=this.readStyles(ge(t));if(!n)return;let[r,s]=n,i=this.top;for(let e=0;e<s.length;e++)this.removePendingMark(s[e],i);for(let e=0;e<r.length;e++)this.addPendingMark(r[e]);this.addElement(e);for(let e=0;e<r.length;e++)this.removePendingMark(r[e],i);for(let e=0;e<s.length;e++)this.addPendingMark(s[e])}else this.addElement(e)}}addTextNode(e){let t=e.nodeValue,n=this.top;if(n.options&ce||n.inlineContext(e)||/[^ \t\r\n\u000c]/.test(t)){if(n.options&ae)t=n.options&ce?t.replace(/\r\n?/g,"\n"):t.replace(/\r?\n|\r/g," ");else if(t=t.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(t)&&this.open==this.nodes.length-1){let r=n.content[n.content.length-1],s=e.previousSibling;(!r||s&&"BR"==s.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(t=t.slice(1))}t&&this.insertNode(this.parser.schema.text(t)),this.findInText(e)}else this.findInside(e)}addElement(e,t){let n,r=e.nodeName.toLowerCase();oe.hasOwnProperty(r)&&this.parser.normalizeLists&&pe(e);let s=this.options.ruleFromNode&&this.options.ruleFromNode(e)||(n=this.parser.matchTag(e,this,t));if(s?s.ignore:ie.hasOwnProperty(r))this.findInside(e),this.ignoreFallback(e);else if(!s||s.skip||s.closeParent){s&&s.closeParent?this.open=Math.max(0,this.open-1):s&&s.skip.nodeType&&(e=s.skip);let t,n=this.top,i=this.needsBlock;if(se.hasOwnProperty(r))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),t=!0,n.type||(this.needsBlock=!0);else if(!e.firstChild)return void this.leafFallback(e);this.addAll(e),t&&this.sync(n),this.needsBlock=i}else this.addElementByRule(e,s,!1===s.consuming?n:void 0)}leafFallback(e){"BR"==e.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(e.ownerDocument.createTextNode("\n"))}ignoreFallback(e){"BR"!=e.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(e){let t=h.none,n=h.none;e:for(let r=0;r<e.length;r+=2)for(let s;;){let i=this.parser.matchStyle(e[r],e[r+1],this,s);if(!i)continue e;if(i.ignore)return null;if(i.clearMark?this.top.pendingMarks.forEach((e=>{i.clearMark(e)&&(n=e.addToSet(n))})):t=this.parser.schema.marks[i.mark].create(i.attrs).addToSet(t),!1!==i.consuming)break;s=i}return[t,n]}addElementByRule(e,t,n){let r,s,i;if(t.node)s=this.parser.schema.nodes[t.node],s.isLeaf?this.insertNode(s.create(t.attrs))||this.leafFallback(e):r=this.enter(s,t.attrs||null,t.preserveWhitespace);else{let e=this.parser.schema.marks[t.mark];i=e.create(t.attrs),this.addPendingMark(i)}let o=this.top;if(s&&s.isLeaf)this.findInside(e);else if(n)this.addElement(e,n);else if(t.getContent)this.findInside(e),t.getContent(e,this.parser.schema).forEach((e=>this.insertNode(e)));else{let n=e;"string"==typeof t.contentElement?n=e.querySelector(t.contentElement):"function"==typeof t.contentElement?n=t.contentElement(e):t.contentElement&&(n=t.contentElement),this.findAround(e,n,!0),this.addAll(n)}r&&this.sync(o)&&this.open--,i&&this.removePendingMark(i,o)}addAll(e,t,n){let r=t||0;for(let s=t?e.childNodes[t]:e.firstChild,i=null==n?null:e.childNodes[n];s!=i;s=s.nextSibling,++r)this.findAtPoint(e,r),this.addDOM(s);this.findAtPoint(e,r)}findPlace(e){let t,n;for(let r=this.open;r>=0;r--){let s=this.nodes[r],i=s.findWrapping(e);if(i&&(!t||t.length>i.length)&&(t=i,n=s,!i.length))break;if(s.solid)break}if(!t)return!1;this.sync(n);for(let r=0;r<t.length;r++)this.enterInner(t[r],null,!1);return!0}insertNode(e){if(e.isInline&&this.needsBlock&&!this.top.type){let e=this.textblockFromContext();e&&this.enterInner(e)}if(this.findPlace(e)){this.closeExtra();let t=this.top;t.applyPending(e.type),t.match&&(t.match=t.match.matchType(e.type));let n=t.activeMarks;for(let r=0;r<e.marks.length;r++)t.type&&!t.type.allowsMarkType(e.marks[r].type)||(n=e.marks[r].addToSet(n));return t.content.push(e.mark(n)),!0}return!1}enter(e,t,n){let r=this.findPlace(e.create(t));return r&&this.enterInner(e,t,!0,n),r}enterInner(e,t=null,n=!1,r){this.closeExtra();let s=this.top;s.applyPending(e),s.match=s.match&&s.match.matchType(e);let i=ue(e,r,s.options);s.options&le&&0==s.content.length&&(i|=le),this.nodes.push(new he(e,t,s.activeMarks,s.pendingMarks,n,null,i)),this.open++}closeExtra(e=!1){let t=this.nodes.length-1;if(t>this.open){for(;t>this.open;t--)this.nodes[t-1].content.push(this.nodes[t].finish(e));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(e){for(let t=this.open;t>=0;t--)if(this.nodes[t]==e)return this.open=t,!0;return!1}get currentPos(){this.closeExtra();let e=0;for(let t=this.open;t>=0;t--){let n=this.nodes[t].content;for(let t=n.length-1;t>=0;t--)e+=n[t].nodeSize;t&&e++}return e}findAtPoint(e,t){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==e&&this.find[n].offset==t&&(this.find[n].pos=this.currentPos)}findInside(e){if(this.find)for(let t=0;t<this.find.length;t++)null==this.find[t].pos&&1==e.nodeType&&e.contains(this.find[t].node)&&(this.find[t].pos=this.currentPos)}findAround(e,t,n){if(e!=t&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==e.nodeType&&e.contains(this.find[r].node)){let e=t.compareDocumentPosition(this.find[r].node);e&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(e){if(this.find)for(let t=0;t<this.find.length;t++)this.find[t].node==e&&(this.find[t].pos=this.currentPos-(e.nodeValue.length-this.find[t].offset))}matchesContext(e){if(e.indexOf("|")>-1)return e.split(/\s*\|\s*/).some(this.matchesContext,this);let t=e.split("/"),n=this.options.context,r=!this.isOpen&&(!n||n.parent.type==this.nodes[0].type),s=-(n?n.depth+1:0)+(r?0:1),i=(e,o)=>{for(;e>=0;e--){let a=t[e];if(""==a){if(e==t.length-1||0==e)continue;for(;o>=s;o--)if(i(e-1,o))return!0;return!1}{let e=o>0||0==o&&r?this.nodes[o].type:n&&o>=s?n.node(o-s).type:null;if(!e||e.name!=a&&-1==e.groups.indexOf(a))return!1;o--}}return!0};return i(t.length-1,this.open)}textblockFromContext(){let e=this.options.context;if(e)for(let t=e.depth;t>=0;t--){let n=e.node(t).contentMatchAt(e.indexAfter(t)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let t in this.parser.schema.nodes){let e=this.parser.schema.nodes[t];if(e.isTextblock&&e.defaultAttrs)return e}}addPendingMark(e){let t=we(e,this.top.pendingMarks);t&&this.top.stashMarks.push(t),this.top.pendingMarks=e.addToSet(this.top.pendingMarks)}removePendingMark(e,t){for(let n=this.open;n>=0;n--){let r=this.nodes[n],s=r.pendingMarks.lastIndexOf(e);if(s>-1)r.pendingMarks=e.removeFromSet(r.pendingMarks);else{r.activeMarks=e.removeFromSet(r.activeMarks);let t=r.popFromStashMark(e);t&&r.type&&r.type.allowsMarkType(t.type)&&(r.activeMarks=t.addToSet(r.activeMarks))}if(r==t)break}}}function pe(e){for(let t=e.firstChild,n=null;t;t=t.nextSibling){let e=1==t.nodeType?t.nodeName.toLowerCase():null;e&&oe.hasOwnProperty(e)&&n?(n.appendChild(t),t=n):"li"==e?n=t:e&&(n=null)}}function fe(e,t){return(e.matches||e.msMatchesSelector||e.webkitMatchesSelector||e.mozMatchesSelector).call(e,t)}function ge(e){let t,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];while(t=n.exec(e))r.push(t[1],t[2].trim());return r}function me(e){let t={};for(let n in e)t[n]=e[n];return t}function ye(e,t){let n=t.schema.nodes;for(let r in n){let s=n[r];if(!s.allowsMarkType(e))continue;let i=[],o=e=>{i.push(e);for(let n=0;n<e.edgeCount;n++){let{type:r,next:s}=e.edge(n);if(r==t)return!0;if(i.indexOf(s)<0&&o(s))return!0}};if(o(s.contentMatch))return!0}}function we(e,t){for(let n=0;n<t.length;n++)if(e.eq(t[n]))return t[n]}class be{constructor(e,t){this.nodes=e,this.marks=t}serializeFragment(e,t={},n){n||(n=Ee(t).createDocumentFragment());let r=n,s=[];return e.forEach((e=>{if(s.length||e.marks.length){let n=0,i=0;while(n<s.length&&i<e.marks.length){let t=e.marks[i];if(this.marks[t.type.name]){if(!t.eq(s[n][0])||!1===t.type.spec.spanning)break;n++,i++}else i++}while(n<s.length)r=s.pop()[1];while(i<e.marks.length){let n=e.marks[i++],o=this.serializeMark(n,e.isInline,t);o&&(s.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(e,t))})),n}serializeNodeInner(e,t){let{dom:n,contentDOM:r}=be.renderSpec(Ee(t),this.nodes[e.type.name](e));if(r){if(e.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(e.content,t,r)}return n}serializeNode(e,t={}){let n=this.serializeNodeInner(e,t);for(let r=e.marks.length-1;r>=0;r--){let s=this.serializeMark(e.marks[r],e.isInline,t);s&&((s.contentDOM||s.dom).appendChild(n),n=s.dom)}return n}serializeMark(e,t,n={}){let r=this.marks[e.type.name];return r&&be.renderSpec(Ee(n),r(e,t))}static renderSpec(e,t,n=null){if("string"==typeof t)return{dom:e.createTextNode(t)};if(null!=t.nodeType)return{dom:t};if(t.dom&&null!=t.dom.nodeType)return t;let r,s=t[0],i=s.indexOf(" ");i>0&&(n=s.slice(0,i),s=s.slice(i+1));let o=n?e.createElementNS(n,s):e.createElement(s),a=t[1],c=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){c=2;for(let e in a)if(null!=a[e]){let t=e.indexOf(" ");t>0?o.setAttributeNS(e.slice(0,t),e.slice(t+1),a[e]):o.setAttribute(e,a[e])}}for(let l=c;l<t.length;l++){let s=t[l];if(0===s){if(l<t.length-1||l>c)throw new RangeError("Content hole must be the only child of its parent node");return{dom:o,contentDOM:o}}{let{dom:t,contentDOM:i}=be.renderSpec(e,s,n);if(o.appendChild(t),i){if(r)throw new RangeError("Multiple content holes");r=i}}}return{dom:o,contentDOM:r}}static fromSchema(e){return e.cached.domSerializer||(e.cached.domSerializer=new be(this.nodesFromSchema(e),this.marksFromSchema(e)))}static nodesFromSchema(e){let t=ve(e.nodes);return t.text||(t.text=e=>e.text),t}static marksFromSchema(e){return ve(e.marks)}}function ve(e){let t={};for(let n in e){let r=e[n].spec.toDOM;r&&(t[n]=r)}return t}function Ee(e){return e.document||window.document}},157:function(e,t,n){"use strict";n.d(t,{Bs:function(){return u},C1:function(){return f},H$:function(){return x},Sy:function(){return I},Y1:function(){return o},qv:function(){return d},yy:function(){return T}});n(7658);var r=n(1543),s=n(1382);const i=Object.create(null);class o{constructor(e,t,n){this.$anchor=e,this.$head=t,this.ranges=n||[new a(e.min(t),e.max(t))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let e=this.ranges;for(let t=0;t<e.length;t++)if(e[t].$from.pos!=e[t].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(e,t=r.p2.empty){let n=t.content.lastChild,s=null;for(let r=0;r<t.openEnd;r++)s=n,n=n.lastChild;let i=e.steps.length,o=this.ranges;for(let a=0;a<o.length;a++){let{$from:c,$to:l}=o[a],u=e.mapping.slice(i);e.replaceRange(u.map(c.pos),u.map(l.pos),a?r.p2.empty:t),0==a&&y(e,i,(n?n.isInline:s&&s.isTextblock)?-1:1)}}replaceWith(e,t){let n=e.steps.length,r=this.ranges;for(let s=0;s<r.length;s++){let{$from:i,$to:o}=r[s],a=e.mapping.slice(n),c=a.map(i.pos),l=a.map(o.pos);s?e.deleteRange(c,l):(e.replaceRangeWith(c,l,t),y(e,n,t.isInline?-1:1))}}static findFrom(e,t,n=!1){let r=e.parent.inlineContent?new u(e):m(e.node(0),e.parent,e.pos,e.index(),t,n);if(r)return r;for(let s=e.depth-1;s>=0;s--){let r=t<0?m(e.node(0),e.node(s),e.before(s+1),e.index(s),t,n):m(e.node(0),e.node(s),e.after(s+1),e.index(s)+1,t,n);if(r)return r}return null}static near(e,t=1){return this.findFrom(e,t)||this.findFrom(e,-t)||new f(e.node(0))}static atStart(e){return m(e,e,0,0,1)||new f(e)}static atEnd(e){return m(e,e,e.content.size,e.childCount,-1)||new f(e)}static fromJSON(e,t){if(!t||!t.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=i[t.type];if(!n)throw new RangeError(`No selection type ${t.type} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in i)throw new RangeError("Duplicate use of selection JSON ID "+e);return i[e]=t,t.prototype.jsonID=e,t}getBookmark(){return u.between(this.$anchor,this.$head).getBookmark()}}o.prototype.visible=!0;class a{constructor(e,t){this.$from=e,this.$to=t}}let c=!1;function l(e){c||e.parent.inlineContent||(c=!0,console["warn"]("TextSelection endpoint not pointing into a node with inline content ("+e.parent.type.name+")"))}class u extends o{constructor(e,t=e){l(e),l(t),super(e,t)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(e,t){let n=e.resolve(t.map(this.head));if(!n.parent.inlineContent)return o.near(n);let r=e.resolve(t.map(this.anchor));return new u(r.parent.inlineContent?r:n,n)}replace(e,t=r.p2.empty){if(super.replace(e,t),t==r.p2.empty){let t=this.$from.marksAcross(this.$to);t&&e.ensureMarks(t)}}eq(e){return e instanceof u&&e.anchor==this.anchor&&e.head==this.head}getBookmark(){return new h(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(e,t){if("number"!=typeof t.anchor||"number"!=typeof t.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new u(e.resolve(t.anchor),e.resolve(t.head))}static create(e,t,n=t){let r=e.resolve(t);return new this(r,n==t?r:e.resolve(n))}static between(e,t,n){let r=e.pos-t.pos;if(n&&!r||(n=r>=0?1:-1),!t.parent.inlineContent){let e=o.findFrom(t,n,!0)||o.findFrom(t,-n,!0);if(!e)return o.near(t,n);t=e.$head}return e.parent.inlineContent||(0==r?e=t:(e=(o.findFrom(e,-n,!0)||o.findFrom(e,n,!0)).$anchor,e.pos<t.pos!=r<0&&(e=t))),new u(e,t)}}o.jsonID("text",u);class h{constructor(e,t){this.anchor=e,this.head=t}map(e){return new h(e.map(this.anchor),e.map(this.head))}resolve(e){return u.between(e.resolve(this.anchor),e.resolve(this.head))}}class d extends o{constructor(e){let t=e.nodeAfter,n=e.node(0).resolve(e.pos+t.nodeSize);super(e,n),this.node=t}map(e,t){let{deleted:n,pos:r}=t.mapResult(this.anchor),s=e.resolve(r);return n?o.near(s):new d(s)}content(){return new r.p2(r.HY.from(this.node),0,0)}eq(e){return e instanceof d&&e.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new p(this.anchor)}static fromJSON(e,t){if("number"!=typeof t.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new d(e.resolve(t.anchor))}static create(e,t){return new d(e.resolve(t))}static isSelectable(e){return!e.isText&&!1!==e.type.spec.selectable}}d.prototype.visible=!1,o.jsonID("node",d);class p{constructor(e){this.anchor=e}map(e){let{deleted:t,pos:n}=e.mapResult(this.anchor);return t?new h(n,n):new p(n)}resolve(e){let t=e.resolve(this.anchor),n=t.nodeAfter;return n&&d.isSelectable(n)?new d(t):o.near(t)}}class f extends o{constructor(e){super(e.resolve(0),e.resolve(e.content.size))}replace(e,t=r.p2.empty){if(t==r.p2.empty){e.delete(0,e.doc.content.size);let t=o.atStart(e.doc);t.eq(e.selection)||e.setSelection(t)}else super.replace(e,t)}toJSON(){return{type:"all"}}static fromJSON(e){return new f(e)}map(e){return new f(e)}eq(e){return e instanceof f}getBookmark(){return g}}o.jsonID("all",f);const g={map(){return this},resolve(e){return new f(e)}};function m(e,t,n,r,s,i=!1){if(t.inlineContent)return u.create(e,n);for(let o=r-(s>0?0:1);s>0?o<t.childCount:o>=0;o+=s){let r=t.child(o);if(r.isAtom){if(!i&&d.isSelectable(r))return d.create(e,n-(s<0?r.nodeSize:0))}else{let t=m(e,r,n+s,s<0?r.childCount:0,s,i);if(t)return t}n+=r.nodeSize*s}return null}function y(e,t,n){let r=e.steps.length-1;if(r<t)return;let i=e.steps[r];if(!(i instanceof s.Pu||i instanceof s.FC))return;let a,c=e.mapping.maps[r];c.forEach(((e,t,n,r)=>{null==a&&(a=r)})),e.setSelection(o.near(e.doc.resolve(a),n))}const w=1,b=2,v=4;class E extends s.wx{constructor(e){super(e.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=e.selection,this.storedMarks=e.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(e){if(e.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=e,this.curSelectionFor=this.steps.length,this.updated=(this.updated|w)&~b,this.storedMarks=null,this}get selectionSet(){return(this.updated&w)>0}setStoredMarks(e){return this.storedMarks=e,this.updated|=b,this}ensureMarks(e){return r.vc.sameSet(this.storedMarks||this.selection.$from.marks(),e)||this.setStoredMarks(e),this}addStoredMark(e){return this.ensureMarks(e.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(e){return this.ensureMarks(e.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(this.updated&b)>0}addStep(e,t){super.addStep(e,t),this.updated=this.updated&~b,this.storedMarks=null}setTime(e){return this.time=e,this}replaceSelection(e){return this.selection.replace(this,e),this}replaceSelectionWith(e,t=!0){let n=this.selection;return t&&(e=e.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||r.vc.none))),n.replaceWith(this,e),this}deleteSelection(){return this.selection.replace(this),this}insertText(e,t,n){let r=this.doc.type.schema;if(null==t)return e?this.replaceSelectionWith(r.text(e),!0):this.deleteSelection();{if(null==n&&(n=t),n=null==n?t:n,!e)return this.deleteRange(t,n);let s=this.storedMarks;if(!s){let e=this.doc.resolve(t);s=n==t?e.marks():e.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(t,n,r.text(e,s)),this.selection.empty||this.setSelection(o.near(this.selection.$to)),this}}setMeta(e,t){return this.meta["string"==typeof e?e:e.key]=t,this}getMeta(e){return this.meta["string"==typeof e?e:e.key]}get isGeneric(){for(let e in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=v,this}get scrolledIntoView(){return(this.updated&v)>0}}function _(e,t){return t&&e?e.bind(t):e}class S{constructor(e,t,n){this.name=e,this.init=_(t.init,n),this.apply=_(t.apply,n)}}const k=[new S("doc",{init(e){return e.doc||e.schema.topNodeType.createAndFill()},apply(e){return e.doc}}),new S("selection",{init(e,t){return e.selection||o.atStart(t.doc)},apply(e){return e.selection}}),new S("storedMarks",{init(e){return e.storedMarks||null},apply(e,t,n,r){return r.selection.$cursor?e.storedMarks:null}}),new S("scrollToSelection",{init(){return 0},apply(e,t){return e.scrolledIntoView?t+1:t}})];class A{constructor(e,t){this.schema=e,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=k.slice(),t&&t.forEach((e=>{if(this.pluginsByKey[e.key])throw new RangeError("Adding different instances of a keyed plugin ("+e.key+")");this.plugins.push(e),this.pluginsByKey[e.key]=e,e.spec.state&&this.fields.push(new S(e.key,e.spec.state,e))}))}}class T{constructor(e){this.config=e}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(e){return this.applyTransaction(e).state}filterTransaction(e,t=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=t){let t=this.config.plugins[n];if(t.spec.filterTransaction&&!t.spec.filterTransaction.call(t,e,this))return!1}return!0}applyTransaction(e){if(!this.filterTransaction(e))return{state:this,transactions:[]};let t=[e],n=this.applyInner(e),r=null;for(;;){let s=!1;for(let i=0;i<this.config.plugins.length;i++){let o=this.config.plugins[i];if(o.spec.appendTransaction){let a=r?r[i].n:0,c=r?r[i].state:this,l=a<t.length&&o.spec.appendTransaction.call(o,a?t.slice(a):t,c,n);if(l&&n.filterTransaction(l,i)){if(l.setMeta("appendedTransaction",e),!r){r=[];for(let e=0;e<this.config.plugins.length;e++)r.push(e<i?{state:n,n:t.length}:{state:this,n:0})}t.push(l),n=n.applyInner(l),s=!0}r&&(r[i]={state:n,n:t.length})}}if(!s)return{state:n,transactions:t}}}applyInner(e){if(!e.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let t=new T(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let s=n[r];t[s.name]=s.apply(e,this[s.name],this,t)}return t}get tr(){return new E(this)}static create(e){let t=new A(e.doc?e.doc.type.schema:e.schema,e.plugins),n=new T(t);for(let r=0;r<t.fields.length;r++)n[t.fields[r].name]=t.fields[r].init(e,n);return n}reconfigure(e){let t=new A(this.schema,e.plugins),n=t.fields,r=new T(t);for(let s=0;s<n.length;s++){let t=n[s].name;r[t]=this.hasOwnProperty(t)?this[t]:n[s].init(e,r)}return r}toJSON(e){let t={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(t.storedMarks=this.storedMarks.map((e=>e.toJSON()))),e&&"object"==typeof e)for(let n in e){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=e[n],s=r.spec.state;s&&s.toJSON&&(t[n]=s.toJSON.call(r,this[r.key]))}return t}static fromJSON(e,t,n){if(!t)throw new RangeError("Invalid input for EditorState.fromJSON");if(!e.schema)throw new RangeError("Required config field 'schema' missing");let s=new A(e.schema,e.plugins),i=new T(s);return s.fields.forEach((s=>{if("doc"==s.name)i.doc=r.NB.fromJSON(e.schema,t.doc);else if("selection"==s.name)i.selection=o.fromJSON(i.doc,t.selection);else if("storedMarks"==s.name)t.storedMarks&&(i.storedMarks=t.storedMarks.map(e.schema.markFromJSON));else{if(n)for(let r in n){let o=n[r],a=o.spec.state;if(o.key==s.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(t,r))return void(i[s.name]=a.fromJSON.call(o,e,t[r],i))}i[s.name]=s.init(e,i)}})),i}}function C(e,t,n){for(let r in e){let s=e[r];s instanceof Function?s=s.bind(t):"handleDOMEvents"==r&&(s=C(s,t,{})),n[r]=s}return n}class I{constructor(e){this.spec=e,this.props={},e.props&&C(e.props,this,this.props),this.key=e.key?e.key.key:O("plugin")}getState(e){return e[this.key]}}const R=Object.create(null);function O(e){return e in R?e+"$"+ ++R[e]:(R[e]=0,e+"$")}class x{constructor(e="key"){this.key=O(e)}get(e){return e.config.pluginsByKey[this.key]}getState(e){return e[this.key]}}},1382:function(e,t,n){"use strict";n.d(t,{Ax:function(){return j},FC:function(){return A},GJ:function(){return K},Mn:function(){return $},Pu:function(){return k},dR:function(){return Y},k9:function(){return x},nd:function(){return D},nj:function(){return W},vs:function(){return g},wx:function(){return de}});n(7658),n(541);var r=n(1543);const s=65535,i=Math.pow(2,16);function o(e,t){return e+t*i}function a(e){return e&s}function c(e){return(e-(e&s))/i}const l=1,u=2,h=4,d=8;class p{constructor(e,t,n){this.pos=e,this.delInfo=t,this.recover=n}get deleted(){return(this.delInfo&d)>0}get deletedBefore(){return(this.delInfo&(l|h))>0}get deletedAfter(){return(this.delInfo&(u|h))>0}get deletedAcross(){return(this.delInfo&h)>0}}class f{constructor(e,t=!1){if(this.ranges=e,this.inverted=t,!e.length&&f.empty)return f.empty}recover(e){let t=0,n=a(e);if(!this.inverted)for(let r=0;r<n;r++)t+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+t+c(e)}mapResult(e,t=1){return this._map(e,t,!1)}map(e,t=1){return this._map(e,t,!0)}_map(e,t,n){let r=0,s=this.inverted?2:1,i=this.inverted?1:2;for(let a=0;a<this.ranges.length;a+=3){let c=this.ranges[a]-(this.inverted?r:0);if(c>e)break;let f=this.ranges[a+s],g=this.ranges[a+i],m=c+f;if(e<=m){let s=f?e==c?-1:e==m?1:t:t,i=c+r+(s<0?0:g);if(n)return i;let y=e==(t<0?c:m)?null:o(a/3,e-c),w=e==c?u:e==m?l:h;return(t<0?e!=c:e!=m)&&(w|=d),new p(i,w,y)}r+=g-f}return n?e+r:new p(e+r,0,null)}touches(e,t){let n=0,r=a(t),s=this.inverted?2:1,i=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let t=this.ranges[o]-(this.inverted?n:0);if(t>e)break;let a=this.ranges[o+s],c=t+a;if(e<=c&&o==3*r)return!0;n+=this.ranges[o+i]-a}return!1}forEach(e){let t=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,s=0;r<this.ranges.length;r+=3){let i=this.ranges[r],o=i-(this.inverted?s:0),a=i+(this.inverted?0:s),c=this.ranges[r+t],l=this.ranges[r+n];e(o,o+c,a,a+l),s+=l-c}}invert(){return new f(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(e){return 0==e?f.empty:new f(e<0?[0,-e,0]:[0,0,e])}}f.empty=new f([]);class g{constructor(e=[],t,n=0,r=e.length){this.maps=e,this.mirror=t,this.from=n,this.to=r}slice(e=0,t=this.maps.length){return new g(this.maps,this.mirror,e,t)}copy(){return new g(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(e,t){this.to=this.maps.push(e),null!=t&&this.setMirror(this.maps.length-1,t)}appendMapping(e){for(let t=0,n=this.maps.length;t<e.maps.length;t++){let r=e.getMirror(t);this.appendMap(e.maps[t],null!=r&&r<t?n+r:void 0)}}getMirror(e){if(this.mirror)for(let t=0;t<this.mirror.length;t++)if(this.mirror[t]==e)return this.mirror[t+(t%2?-1:1)]}setMirror(e,t){this.mirror||(this.mirror=[]),this.mirror.push(e,t)}appendMappingInverted(e){for(let t=e.maps.length-1,n=this.maps.length+e.maps.length;t>=0;t--){let r=e.getMirror(t);this.appendMap(e.maps[t].invert(),null!=r&&r>t?n-r-1:void 0)}}invert(){let e=new g;return e.appendMappingInverted(this),e}map(e,t=1){if(this.mirror)return this._map(e,t,!0);for(let n=this.from;n<this.to;n++)e=this.maps[n].map(e,t);return e}mapResult(e,t=1){return this._map(e,t,!1)}_map(e,t,n){let r=0;for(let s=this.from;s<this.to;s++){let n=this.maps[s],i=n.mapResult(e,t);if(null!=i.recover){let t=this.getMirror(s);if(null!=t&&t>s&&t<this.to){s=t,e=this.maps[t].recover(i.recover);continue}}r|=i.delInfo,e=i.pos}return n?e:new p(e,r,null)}}const m=Object.create(null);class y{getMap(){return f.empty}merge(e){return null}static fromJSON(e,t){if(!t||!t.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=m[t.stepType];if(!n)throw new RangeError(`No step type ${t.stepType} defined`);return n.fromJSON(e,t)}static jsonID(e,t){if(e in m)throw new RangeError("Duplicate use of step JSON ID "+e);return m[e]=t,t.prototype.jsonID=e,t}}class w{constructor(e,t){this.doc=e,this.failed=t}static ok(e){return new w(e,null)}static fail(e){return new w(null,e)}static fromReplace(e,t,n,s){try{return w.ok(e.replace(t,n,s))}catch(i){if(i instanceof r.e4)return w.fail(i.message);throw i}}}function b(e,t,n){let s=[];for(let r=0;r<e.childCount;r++){let i=e.child(r);i.content.size&&(i=i.copy(b(i.content,t,i))),i.isInline&&(i=t(i,n,r)),s.push(i)}return r.HY.fromArray(s)}class v extends y{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=e.resolve(this.from),s=n.node(n.sharedDepth(this.to)),i=new r.p2(b(t.content,((e,t)=>e.isAtom&&t.type.allowsMarkType(this.mark.type)?e.mark(this.mark.addToSet(e.marks)):e),s),t.openStart,t.openEnd);return w.fromReplace(e,this.from,this.to,i)}invert(){return new E(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new v(t.pos,n.pos,this.mark)}merge(e){return e instanceof v&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new v(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new v(t.from,t.to,e.markFromJSON(t.mark))}}y.jsonID("addMark",v);class E extends y{constructor(e,t,n){super(),this.from=e,this.to=t,this.mark=n}apply(e){let t=e.slice(this.from,this.to),n=new r.p2(b(t.content,(e=>e.mark(this.mark.removeFromSet(e.marks))),e),t.openStart,t.openEnd);return w.fromReplace(e,this.from,this.to,n)}invert(){return new v(this.from,this.to,this.mark)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deleted&&n.deleted||t.pos>=n.pos?null:new E(t.pos,n.pos,this.mark)}merge(e){return e instanceof E&&e.mark.eq(this.mark)&&this.from<=e.to&&this.to>=e.from?new E(Math.min(this.from,e.from),Math.max(this.to,e.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new E(t.from,t.to,e.markFromJSON(t.mark))}}y.jsonID("removeMark",E);class _ extends y{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return w.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.addToSet(t.marks));return w.fromReplace(e,this.pos,this.pos+1,new r.p2(r.HY.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);if(t){let e=this.mark.addToSet(t.marks);if(e.length==t.marks.length){for(let n=0;n<t.marks.length;n++)if(!t.marks[n].isInSet(e))return new _(this.pos,t.marks[n]);return new _(this.pos,this.mark)}}return new S(this.pos,this.mark)}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new _(t.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new _(t.pos,e.markFromJSON(t.mark))}}y.jsonID("addNodeMark",_);class S extends y{constructor(e,t){super(),this.pos=e,this.mark=t}apply(e){let t=e.nodeAt(this.pos);if(!t)return w.fail("No node at mark step's position");let n=t.type.create(t.attrs,null,this.mark.removeFromSet(t.marks));return w.fromReplace(e,this.pos,this.pos+1,new r.p2(r.HY.from(n),0,t.isLeaf?0:1))}invert(e){let t=e.nodeAt(this.pos);return t&&this.mark.isInSet(t.marks)?new _(this.pos,this.mark):this}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new S(t.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(e,t){if("number"!=typeof t.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new S(t.pos,e.markFromJSON(t.mark))}}y.jsonID("removeNodeMark",S);class k extends y{constructor(e,t,n,r=!1){super(),this.from=e,this.to=t,this.slice=n,this.structure=r}apply(e){return this.structure&&T(e,this.from,this.to)?w.fail("Structure replace would overwrite content"):w.fromReplace(e,this.from,this.to,this.slice)}getMap(){return new f([this.from,this.to-this.from,this.slice.size])}invert(e){return new k(this.from,this.from+this.slice.size,e.slice(this.from,this.to))}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1);return t.deletedAcross&&n.deletedAcross?null:new k(t.pos,Math.max(t.pos,n.pos),this.slice)}merge(e){if(!(e instanceof k)||e.structure||this.structure)return null;if(this.from+this.slice.size!=e.from||this.slice.openEnd||e.slice.openStart){if(e.to!=this.from||this.slice.openStart||e.slice.openEnd)return null;{let t=this.slice.size+e.slice.size==0?r.p2.empty:new r.p2(e.slice.content.append(this.slice.content),e.slice.openStart,this.slice.openEnd);return new k(e.from,this.to,t,this.structure)}}{let t=this.slice.size+e.slice.size==0?r.p2.empty:new r.p2(this.slice.content.append(e.slice.content),this.slice.openStart,e.slice.openEnd);return new k(this.from,this.to+(e.to-e.from),t,this.structure)}}toJSON(){let e={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new k(t.from,t.to,r.p2.fromJSON(e,t.slice),!!t.structure)}}y.jsonID("replace",k);class A extends y{constructor(e,t,n,r,s,i,o=!1){super(),this.from=e,this.to=t,this.gapFrom=n,this.gapTo=r,this.slice=s,this.insert=i,this.structure=o}apply(e){if(this.structure&&(T(e,this.from,this.gapFrom)||T(e,this.gapTo,this.to)))return w.fail("Structure gap-replace would overwrite content");let t=e.slice(this.gapFrom,this.gapTo);if(t.openStart||t.openEnd)return w.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,t.content);return n?w.fromReplace(e,this.from,this.to,n):w.fail("Content does not fit in gap")}getMap(){return new f([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(e){let t=this.gapTo-this.gapFrom;return new A(this.from,this.from+this.slice.size+t,this.from+this.insert,this.from+this.insert+t,e.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(e){let t=e.mapResult(this.from,1),n=e.mapResult(this.to,-1),r=e.map(this.gapFrom,-1),s=e.map(this.gapTo,1);return t.deletedAcross&&n.deletedAcross||r<t.pos||s>n.pos?null:new A(t.pos,n.pos,r,s,this.slice,this.insert,this.structure)}toJSON(){let e={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(e.slice=this.slice.toJSON()),this.structure&&(e.structure=!0),e}static fromJSON(e,t){if("number"!=typeof t.from||"number"!=typeof t.to||"number"!=typeof t.gapFrom||"number"!=typeof t.gapTo||"number"!=typeof t.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new A(t.from,t.to,t.gapFrom,t.gapTo,r.p2.fromJSON(e,t.slice),t.insert,!!t.structure)}}function T(e,t,n){let r=e.resolve(t),s=n-t,i=r.depth;while(s>0&&i>0&&r.indexAfter(i)==r.node(i).childCount)i--,s--;if(s>0){let e=r.node(i).maybeChild(r.indexAfter(i));while(s>0){if(!e||e.isLeaf)return!0;e=e.firstChild,s--}}return!1}function C(e,t,n,r){let s,i,o=[],a=[];e.doc.nodesBetween(t,n,((e,c,l)=>{if(!e.isInline)return;let u=e.marks;if(!r.isInSet(u)&&l.type.allowsMarkType(r.type)){let l=Math.max(c,t),h=Math.min(c+e.nodeSize,n),d=r.addToSet(u);for(let e=0;e<u.length;e++)u[e].isInSet(d)||(s&&s.to==l&&s.mark.eq(u[e])?s.to=h:o.push(s=new E(l,h,u[e])));i&&i.to==l?i.to=h:a.push(i=new v(l,h,r))}})),o.forEach((t=>e.step(t))),a.forEach((t=>e.step(t)))}function I(e,t,n,s){let i=[],o=0;e.doc.nodesBetween(t,n,((e,a)=>{if(!e.isInline)return;o++;let c=null;if(s instanceof r.ZU){let t,n=e.marks;while(t=s.isInSet(n))(c||(c=[])).push(t),n=t.removeFromSet(n)}else s?s.isInSet(e.marks)&&(c=[s]):c=e.marks;if(c&&c.length){let r=Math.min(a+e.nodeSize,n);for(let e=0;e<c.length;e++){let n,s=c[e];for(let e=0;e<i.length;e++){let t=i[e];t.step==o-1&&s.eq(i[e].style)&&(n=t)}n?(n.to=r,n.step=o):i.push({style:s,from:Math.max(a,t),to:r,step:o})}}})),i.forEach((t=>e.step(new E(t.from,t.to,t.style))))}function R(e,t,n,s=n.contentMatch){let i=e.doc.nodeAt(t),o=[],a=t+1;for(let c=0;c<i.childCount;c++){let t=i.child(c),l=a+t.nodeSize,u=s.matchType(t.type);if(u){s=u;for(let r=0;r<t.marks.length;r++)n.allowsMarkType(t.marks[r].type)||e.step(new E(a,l,t.marks[r]))}else o.push(new k(a,l,r.p2.empty));a=l}if(!s.validEnd){let t=s.fillBefore(r.HY.empty,!0);e.replace(a,a,new r.p2(t,0,0))}for(let r=o.length-1;r>=0;r--)e.step(o[r])}function O(e,t,n){return(0==t||e.canReplace(t,e.childCount))&&(n==e.childCount||e.canReplace(0,n))}function x(e){let t=e.parent,n=t.content.cutByIndex(e.startIndex,e.endIndex);for(let r=e.depth;;--r){let t=e.$from.node(r),s=e.$from.index(r),i=e.$to.indexAfter(r);if(r<e.depth&&t.canReplace(s,i,n))return r;if(0==r||t.type.spec.isolating||!O(t,s,i))break}return null}function N(e,t,n){let{$from:s,$to:i,depth:o}=t,a=s.before(o+1),c=i.after(o+1),l=a,u=c,h=r.HY.empty,d=0;for(let g=o,m=!1;g>n;g--)m||s.index(g)>0?(m=!0,h=r.HY.from(s.node(g).copy(h)),d++):l--;let p=r.HY.empty,f=0;for(let g=o,m=!1;g>n;g--)m||i.after(g+1)<i.end(g)?(m=!0,p=r.HY.from(i.node(g).copy(p)),f++):u++;e.step(new A(l,u,a,c,new r.p2(h.append(p),d,f),h.size-d,!0))}function D(e,t,n=null,r=e){let s=L(e,t),i=s&&M(r,t);return i?s.map(P).concat({type:t,attrs:n}).concat(i.map(P)):null}function P(e){return{type:e,attrs:null}}function L(e,t){let{parent:n,startIndex:r,endIndex:s}=e,i=n.contentMatchAt(r).findWrapping(t);if(!i)return null;let o=i.length?i[0]:t;return n.canReplaceWith(r,s,o)?i:null}function M(e,t){let{parent:n,startIndex:r,endIndex:s}=e,i=n.child(r),o=t.contentMatch.findWrapping(i.type);if(!o)return null;let a=o.length?o[o.length-1]:t,c=a.contentMatch;for(let l=r;c&&l<s;l++)c=c.matchType(n.child(l).type);return c&&c.validEnd?o:null}function B(e,t,n){let s=r.HY.empty;for(let a=n.length-1;a>=0;a--){if(s.size){let e=n[a].type.contentMatch.matchFragment(s);if(!e||!e.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}s=r.HY.from(n[a].type.create(n[a].attrs,s))}let i=t.start,o=t.end;e.step(new A(i,o,i,o,new r.p2(s,0,0),n.length,!0))}function U(e,t,n,s,i){if(!s.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let o=e.steps.length;e.doc.nodesBetween(t,n,((t,n)=>{if(t.isTextblock&&!t.hasMarkup(s,i)&&V(e.doc,e.mapping.slice(o).map(n),s)){e.clearIncompatible(e.mapping.slice(o).map(n,1),s);let a=e.mapping.slice(o),c=a.map(n,1),l=a.map(n+t.nodeSize,1);return e.step(new A(c,l,c+1,l-1,new r.p2(r.HY.from(s.create(i,null,t.marks)),0,0),1,!0)),!1}}))}function V(e,t,n){let r=e.resolve(t),s=r.index();return r.parent.canReplaceWith(s,s+1,n)}function F(e,t,n,s,i){let o=e.doc.nodeAt(t);if(!o)throw new RangeError("No node at given position");n||(n=o.type);let a=n.create(s,null,i||o.marks);if(o.isLeaf)return e.replaceWith(t,t+o.nodeSize,a);if(!n.validContent(o.content))throw new RangeError("Invalid content for node type "+n.name);e.step(new A(t,t+o.nodeSize,t+1,t+o.nodeSize-1,new r.p2(r.HY.from(a),0,0),1,!0))}function j(e,t,n=1,r){let s=e.resolve(t),i=s.depth-n,o=r&&r[r.length-1]||s.parent;if(i<0||s.parent.type.spec.isolating||!s.parent.canReplace(s.index(),s.parent.childCount)||!o.type.validContent(s.parent.content.cutByIndex(s.index(),s.parent.childCount)))return!1;for(let l=s.depth-1,u=n-2;l>i;l--,u--){let e=s.node(l),t=s.index(l);if(e.type.spec.isolating)return!1;let n=e.content.cutByIndex(t,e.childCount),i=r&&r[u]||e;if(i!=e&&(n=n.replaceChild(0,i.type.create(i.attrs))),!e.canReplace(t+1,e.childCount)||!i.type.validContent(n))return!1}let a=s.indexAfter(i),c=r&&r[0];return s.node(i).canReplaceWith(a,a,c?c.type:s.node(i+1).type)}function z(e,t,n=1,s){let i=e.doc.resolve(t),o=r.HY.empty,a=r.HY.empty;for(let c=i.depth,l=i.depth-n,u=n-1;c>l;c--,u--){o=r.HY.from(i.node(c).copy(o));let e=s&&s[u];a=r.HY.from(e?e.type.create(e.attrs,a):i.node(c).copy(a))}e.step(new k(t,t,new r.p2(o.append(a),n,n),!0))}function $(e,t){let n=e.resolve(t),r=n.index();return H(n.nodeBefore,n.nodeAfter)&&n.parent.canReplace(r,r+1)}function H(e,t){return!(!e||!t||e.isLeaf||!e.canAppend(t))}function K(e,t,n=-1){let r=e.resolve(t);for(let s=r.depth;;s--){let e,i,o=r.index(s);if(s==r.depth?(e=r.nodeBefore,i=r.nodeAfter):n>0?(e=r.node(s+1),o++,i=r.node(s).maybeChild(o)):(e=r.node(s).maybeChild(o-1),i=r.node(s+1)),e&&!e.isTextblock&&H(e,i)&&r.node(s).canReplace(o,o+1))return t;if(0==s)break;t=n<0?r.before(s):r.after(s)}}function q(e,t,n){let s=new k(t-n,t+n,r.p2.empty,!0);e.step(s)}function G(e,t,n){let r=e.resolve(t);if(r.parent.canReplaceWith(r.index(),r.index(),n))return t;if(0==r.parentOffset)for(let s=r.depth-1;s>=0;s--){let e=r.index(s);if(r.node(s).canReplaceWith(e,e,n))return r.before(s+1);if(e>0)return null}if(r.parentOffset==r.parent.content.size)for(let s=r.depth-1;s>=0;s--){let e=r.indexAfter(s);if(r.node(s).canReplaceWith(e,e,n))return r.after(s+1);if(e<r.node(s).childCount)return null}return null}function W(e,t,n){let r=e.resolve(t);if(!n.content.size)return t;let s=n.content;for(let i=0;i<n.openStart;i++)s=s.firstChild.content;for(let i=1;i<=(0==n.openStart&&n.size?2:1);i++)for(let e=r.depth;e>=0;e--){let t=e==r.depth?0:r.pos<=(r.start(e+1)+r.end(e+1))/2?-1:1,n=r.index(e)+(t>0?1:0),o=r.node(e),a=!1;if(1==i)a=o.canReplace(n,n,s);else{let e=o.contentMatchAt(n).findWrapping(s.firstChild.type);a=e&&o.canReplaceWith(n,n,e[0])}if(a)return 0==t?r.pos:t<0?r.before(e+1):r.after(e+1)}return null}function Y(e,t,n=t,s=r.p2.empty){if(t==n&&!s.size)return null;let i=e.resolve(t),o=e.resolve(n);return J(i,o,s)?new k(t,n,s):new Q(i,o,s).fit()}function J(e,t,n){return!n.openStart&&!n.openEnd&&e.start()==t.start()&&e.parent.canReplace(e.index(),t.index(),n.content)}y.jsonID("replaceAround",A);class Q{constructor(e,t,n){this.$from=e,this.$to=t,this.unplaced=n,this.frontier=[],this.placed=r.HY.empty;for(let r=0;r<=e.depth;r++){let t=e.node(r);this.frontier.push({type:t.type,match:t.contentMatchAt(e.indexAfter(r))})}for(let s=e.depth;s>0;s--)this.placed=r.HY.from(e.node(s).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){while(this.unplaced.size){let e=this.findFittable();e?this.placeNodes(e):this.openMore()||this.dropNode()}let e=this.mustMoveInline(),t=this.placed.size-this.depth-this.$from.depth,n=this.$from,s=this.close(e<0?this.$to:n.doc.resolve(e));if(!s)return null;let i=this.placed,o=n.depth,a=s.depth;while(o&&a&&1==i.childCount)i=i.firstChild.content,o--,a--;let c=new r.p2(i,o,a);return e>-1?new A(n.pos,e,this.$to.pos,this.$to.end(),c,t):c.size||n.pos!=this.$to.pos?new k(n.pos,s.pos,c):null}findFittable(){let e=this.unplaced.openStart;for(let t=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<e;n++){let s=t.firstChild;if(t.childCount>1&&(r=0),s.type.spec.isolating&&r<=n){e=n;break}t=s.content}for(let t=1;t<=2;t++)for(let n=1==t?e:this.unplaced.openStart;n>=0;n--){let e,s=null;n?(s=ee(this.unplaced.content,n-1).firstChild,e=s.content):e=this.unplaced.content;let i=e.firstChild;for(let o=this.depth;o>=0;o--){let e,{type:a,match:c}=this.frontier[o],l=null;if(1==t&&(i?c.matchType(i.type)||(l=c.fillBefore(r.HY.from(i),!1)):s&&a.compatibleContent(s.type)))return{sliceDepth:n,frontierDepth:o,parent:s,inject:l};if(2==t&&i&&(e=c.findWrapping(i.type)))return{sliceDepth:n,frontierDepth:o,parent:s,wrap:e};if(s&&c.matchType(s.type))break}}}openMore(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=ee(e,t);return!(!s.childCount||s.firstChild.isLeaf)&&(this.unplaced=new r.p2(e,t+1,Math.max(n,s.size+t>=e.size-n?t+1:0)),!0)}dropNode(){let{content:e,openStart:t,openEnd:n}=this.unplaced,s=ee(e,t);if(s.childCount<=1&&t>0){let i=e.size-t<=t+s.size;this.unplaced=new r.p2(X(e,t-1,1),t-1,i?t-1:n)}else this.unplaced=new r.p2(X(e,t,1),t,n)}placeNodes({sliceDepth:e,frontierDepth:t,parent:n,inject:s,wrap:i}){while(this.depth>t)this.closeFrontierNode();if(i)for(let r=0;r<i.length;r++)this.openFrontierNode(i[r]);let o=this.unplaced,a=n?n.content:o.content,c=o.openStart-e,l=0,u=[],{match:h,type:d}=this.frontier[t];if(s){for(let e=0;e<s.childCount;e++)u.push(s.child(e));h=h.matchFragment(s)}let p=a.size+e-(o.content.size-o.openEnd);while(l<a.childCount){let e=a.child(l),t=h.matchType(e.type);if(!t)break;l++,(l>1||0==c||e.content.size)&&(h=t,u.push(te(e.mark(d.allowedMarks(e.marks)),1==l?c:0,l==a.childCount?p:-1)))}let f=l==a.childCount;f||(p=-1),this.placed=Z(this.placed,t,r.HY.from(u)),this.frontier[t].match=h,f&&p<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let r=0,g=a;r<p;r++){let e=g.lastChild;this.frontier.push({type:e.type,match:e.contentMatchAt(e.childCount)}),g=e.content}this.unplaced=f?0==e?r.p2.empty:new r.p2(X(o.content,e-1,1),e-1,p<0?o.openEnd:e-1):new r.p2(X(o.content,e,l),o.openStart,o.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let e,t=this.frontier[this.depth];if(!t.type.isTextblock||!ne(this.$to,this.$to.depth,t.type,t.match,!1)||this.$to.depth==this.depth&&(e=this.findCloseLevel(this.$to))&&e.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);while(n>1&&r==this.$to.end(--n))++r;return r}findCloseLevel(e){e:for(let t=Math.min(this.depth,e.depth);t>=0;t--){let{match:n,type:r}=this.frontier[t],s=t<e.depth&&e.end(t+1)==e.pos+(e.depth-(t+1)),i=ne(e,t,r,n,s);if(i){for(let n=t-1;n>=0;n--){let{match:t,type:r}=this.frontier[n],s=ne(e,n,r,t,!0);if(!s||s.childCount)continue e}return{depth:t,fit:i,move:s?e.doc.resolve(e.after(t+1)):e}}}}close(e){let t=this.findCloseLevel(e);if(!t)return null;while(this.depth>t.depth)this.closeFrontierNode();t.fit.childCount&&(this.placed=Z(this.placed,t.depth,t.fit)),e=t.move;for(let n=t.depth+1;n<=e.depth;n++){let t=e.node(n),r=t.type.contentMatch.fillBefore(t.content,!0,e.index(n));this.openFrontierNode(t.type,t.attrs,r)}return e}openFrontierNode(e,t=null,n){let s=this.frontier[this.depth];s.match=s.match.matchType(e),this.placed=Z(this.placed,this.depth,r.HY.from(e.create(t,n))),this.frontier.push({type:e,match:e.contentMatch})}closeFrontierNode(){let e=this.frontier.pop(),t=e.match.fillBefore(r.HY.empty,!0);t.childCount&&(this.placed=Z(this.placed,this.frontier.length,t))}}function X(e,t,n){return 0==t?e.cutByIndex(n,e.childCount):e.replaceChild(0,e.firstChild.copy(X(e.firstChild.content,t-1,n)))}function Z(e,t,n){return 0==t?e.append(n):e.replaceChild(e.childCount-1,e.lastChild.copy(Z(e.lastChild.content,t-1,n)))}function ee(e,t){for(let n=0;n<t;n++)e=e.firstChild.content;return e}function te(e,t,n){if(t<=0)return e;let s=e.content;return t>1&&(s=s.replaceChild(0,te(s.firstChild,t-1,1==s.childCount?n-1:0))),t>0&&(s=e.type.contentMatch.fillBefore(s).append(s),n<=0&&(s=s.append(e.type.contentMatch.matchFragment(s).fillBefore(r.HY.empty,!0)))),e.copy(s)}function ne(e,t,n,r,s){let i=e.node(t),o=s?e.indexAfter(t):e.index(t);if(o==i.childCount&&!n.compatibleContent(i.type))return null;let a=r.fillBefore(i.content,!0,o);return a&&!re(n,i.content,o)?a:null}function re(e,t,n){for(let r=n;r<t.childCount;r++)if(!e.allowsMarks(t.child(r).marks))return!0;return!1}function se(e){return e.spec.defining||e.spec.definingForContent}function ie(e,t,n,s){if(!s.size)return e.deleteRange(t,n);let i=e.doc.resolve(t),o=e.doc.resolve(n);if(J(i,o,s))return e.step(new k(t,n,s));let a=le(i,e.doc.resolve(n));0==a[a.length-1]&&a.pop();let c=-(i.depth+1);a.unshift(c);for(let r=i.depth,p=i.pos-1;r>0;r--,p--){let e=i.node(r).type.spec;if(e.defining||e.definingAsContext||e.isolating)break;a.indexOf(r)>-1?c=r:i.before(r)==p&&a.splice(1,0,-r)}let l=a.indexOf(c),u=[],h=s.openStart;for(let r=s.content,p=0;;p++){let e=r.firstChild;if(u.push(e),p==s.openStart)break;r=e.content}for(let r=h-1;r>=0;r--){let e=u[r].type,t=se(e);if(t&&i.node(l).type!=e)h=r;else if(t||!e.isTextblock)break}for(let p=s.openStart;p>=0;p--){let t=(p+h+1)%(s.openStart+1),c=u[t];if(c)for(let u=0;u<a.length;u++){let h=a[(u+l)%a.length],d=!0;h<0&&(d=!1,h=-h);let p=i.node(h-1),f=i.index(h-1);if(p.canReplaceWith(f,f,c.type,c.marks))return e.replace(i.before(h),d?o.after(h):n,new r.p2(oe(s.content,0,s.openStart,t),t,s.openEnd))}}let d=e.steps.length;for(let r=a.length-1;r>=0;r--){if(e.replace(t,n,s),e.steps.length>d)break;let c=a[r];c<0||(t=i.before(c),n=o.after(c))}}function oe(e,t,n,s,i){if(t<n){let r=e.firstChild;e=e.replaceChild(0,r.copy(oe(r.content,t+1,n,s,r)))}if(t>s){let t=i.contentMatchAt(0),n=t.fillBefore(e).append(e);e=n.append(t.matchFragment(n).fillBefore(r.HY.empty,!0))}return e}function ae(e,t,n,s){if(!s.isInline&&t==n&&e.doc.resolve(t).parent.content.size){let r=G(e.doc,t,s.type);null!=r&&(t=n=r)}e.replaceRange(t,n,new r.p2(r.HY.from(s),0,0))}function ce(e,t,n){let r=e.doc.resolve(t),s=e.doc.resolve(n),i=le(r,s);for(let o=0;o<i.length;o++){let t=i[o],n=o==i.length-1;if(n&&0==t||r.node(t).type.contentMatch.validEnd)return e.delete(r.start(t),s.end(t));if(t>0&&(n||r.node(t-1).canReplace(r.index(t-1),s.indexAfter(t-1))))return e.delete(r.before(t),s.after(t))}for(let o=1;o<=r.depth&&o<=s.depth;o++)if(t-r.start(o)==r.depth-o&&n>r.end(o)&&s.end(o)-n!=s.depth-o)return e.delete(r.before(o),n);e.delete(t,n)}function le(e,t){let n=[],r=Math.min(e.depth,t.depth);for(let s=r;s>=0;s--){let r=e.start(s);if(r<e.pos-(e.depth-s)||t.end(s)>t.pos+(t.depth-s)||e.node(s).type.spec.isolating||t.node(s).type.spec.isolating)break;(r==t.start(s)||s==e.depth&&s==t.depth&&e.parent.inlineContent&&t.parent.inlineContent&&s&&t.start(s-1)==r-1)&&n.push(s)}return n}class ue extends y{constructor(e,t,n){super(),this.pos=e,this.attr=t,this.value=n}apply(e){let t=e.nodeAt(this.pos);if(!t)return w.fail("No node at attribute step's position");let n=Object.create(null);for(let r in t.attrs)n[r]=t.attrs[r];n[this.attr]=this.value;let s=t.type.create(n,null,t.marks);return w.fromReplace(e,this.pos,this.pos+1,new r.p2(r.HY.from(s),0,t.isLeaf?0:1))}getMap(){return f.empty}invert(e){return new ue(this.pos,this.attr,e.nodeAt(this.pos).attrs[this.attr])}map(e){let t=e.mapResult(this.pos,1);return t.deletedAfter?null:new ue(t.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(e,t){if("number"!=typeof t.pos||"string"!=typeof t.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new ue(t.pos,t.attr,t.value)}}y.jsonID("attr",ue);let he=class extends Error{};he=function e(t){let n=Error.call(this,t);return n.__proto__=e.prototype,n},he.prototype=Object.create(Error.prototype),he.prototype.constructor=he,he.prototype.name="TransformError";class de{constructor(e){this.doc=e,this.steps=[],this.docs=[],this.mapping=new g}get before(){return this.docs.length?this.docs[0]:this.doc}step(e){let t=this.maybeStep(e);if(t.failed)throw new he(t.failed);return this}maybeStep(e){let t=e.apply(this.doc);return t.failed||this.addStep(e,t.doc),t}get docChanged(){return this.steps.length>0}addStep(e,t){this.docs.push(this.doc),this.steps.push(e),this.mapping.appendMap(e.getMap()),this.doc=t}replace(e,t=e,n=r.p2.empty){let s=Y(this.doc,e,t,n);return s&&this.step(s),this}replaceWith(e,t,n){return this.replace(e,t,new r.p2(r.HY.from(n),0,0))}delete(e,t){return this.replace(e,t,r.p2.empty)}insert(e,t){return this.replaceWith(e,e,t)}replaceRange(e,t,n){return ie(this,e,t,n),this}replaceRangeWith(e,t,n){return ae(this,e,t,n),this}deleteRange(e,t){return ce(this,e,t),this}lift(e,t){return N(this,e,t),this}join(e,t=1){return q(this,e,t),this}wrap(e,t){return B(this,e,t),this}setBlockType(e,t=e,n,r=null){return U(this,e,t,n,r),this}setNodeMarkup(e,t,n=null,r){return F(this,e,t,n,r),this}setNodeAttribute(e,t,n){return this.step(new ue(e,t,n)),this}addNodeMark(e,t){return this.step(new _(e,t)),this}removeNodeMark(e,t){if(!(t instanceof r.vc)){let n=this.doc.nodeAt(e);if(!n)throw new RangeError("No node at position "+e);if(t=t.isInSet(n.marks),!t)return this}return this.step(new S(e,t)),this}split(e,t=1,n){return z(this,e,t,n),this}addMark(e,t,n){return C(this,e,t,n),this}removeMark(e,t,n){return I(this,e,t,n),this}clearIncompatible(e,t,n){return R(this,e,t,n),this}}},1460:function(e,t,n){"use strict";n.d(t,{EH:function(){return Tn},p:function(){return Sn},tk:function(){return nr}});n(7658);var r=n(157),s=n(1543),i=n(1382);const o=function(e){for(var t=0;;t++)if(e=e.previousSibling,!e)return t},a=function(e){let t=e.assignedSlot||e.parentNode;return t&&11==t.nodeType?t.host:t};let c=null;const l=function(e,t,n){let r=c||(c=document.createRange());return r.setEnd(e,null==n?e.nodeValue.length:n),r.setStart(e,t||0),r},u=function(e,t,n,r){return n&&(d(e,t,n,r,-1)||d(e,t,n,r,1))},h=/^(img|br|input|textarea|hr)$/i;function d(e,t,n,r,s){for(;;){if(e==n&&t==r)return!0;if(t==(s<0?0:p(e))){let n=e.parentNode;if(!n||1!=n.nodeType||g(e)||h.test(e.nodeName)||"false"==e.contentEditable)return!1;t=o(e)+(s<0?0:1),e=n}else{if(1!=e.nodeType)return!1;if(e=e.childNodes[t+(s<0?-1:0)],"false"==e.contentEditable)return!1;t=s<0?p(e):0}}}function p(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function f(e,t,n){for(let r=0==t,s=t==p(e);r||s;){if(e==n)return!0;let t=o(e);if(e=e.parentNode,!e)return!1;r=r&&0==t,s=s&&t==p(e)}}function g(e){let t;for(let n=e;n;n=n.parentNode)if(t=n.pmViewDesc)break;return t&&t.node&&t.node.isBlock&&(t.dom==e||t.contentDOM==e)}const m=function(e){return e.focusNode&&u(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset)};function y(e,t){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=e,n.key=n.code=t,n}function w(e){let t=e.activeElement;while(t&&t.shadowRoot)t=t.shadowRoot.activeElement;return t}const b="undefined"!=typeof navigator?navigator:null,v="undefined"!=typeof document?document:null,E=b&&b.userAgent||"",_=/Edge\/(\d+)/.exec(E),S=/MSIE \d/.exec(E),k=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(E),A=!!(S||k||_),T=S?document.documentMode:k?+k[1]:_?+_[1]:0,C=!A&&/gecko\/(\d+)/i.test(E);C&&(/Firefox\/(\d+)/.exec(E)||[0,0])[1];const I=!A&&/Chrome\/(\d+)/.exec(E),R=!!I,O=I?+I[1]:0,x=!A&&!!b&&/Apple Computer/.test(b.vendor),N=x&&(/Mobile\/\w+/.test(E)||!!b&&b.maxTouchPoints>2),D=N||!!b&&/Mac/.test(b.platform),P=/Android \d/.test(E),L=!!v&&"webkitFontSmoothing"in v.documentElement.style,M=L?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function B(e){return{left:0,right:e.documentElement.clientWidth,top:0,bottom:e.documentElement.clientHeight}}function U(e,t){return"number"==typeof e?e:e[t]}function V(e){let t=e.getBoundingClientRect(),n=t.width/e.offsetWidth||1,r=t.height/e.offsetHeight||1;return{left:t.left,right:t.left+e.clientWidth*n,top:t.top,bottom:t.top+e.clientHeight*r}}function F(e,t,n){let r=e.someProp("scrollThreshold")||0,s=e.someProp("scrollMargin")||5,i=e.dom.ownerDocument;for(let o=n||e.dom;;o=a(o)){if(!o)break;if(1!=o.nodeType)continue;let e=o,n=e==i.body,a=n?B(i):V(e),c=0,l=0;if(t.top<a.top+U(r,"top")?l=-(a.top-t.top+U(s,"top")):t.bottom>a.bottom-U(r,"bottom")&&(l=t.bottom-a.bottom+U(s,"bottom")),t.left<a.left+U(r,"left")?c=-(a.left-t.left+U(s,"left")):t.right>a.right-U(r,"right")&&(c=t.right-a.right+U(s,"right")),c||l)if(n)i.defaultView.scrollBy(c,l);else{let n=e.scrollLeft,r=e.scrollTop;l&&(e.scrollTop+=l),c&&(e.scrollLeft+=c);let s=e.scrollLeft-n,i=e.scrollTop-r;t={left:t.left-s,top:t.top-i,right:t.right-s,bottom:t.bottom-i}}if(n)break}}function j(e){let t,n,r=e.dom.getBoundingClientRect(),s=Math.max(0,r.top);for(let i=(r.left+r.right)/2,o=s+1;o<Math.min(innerHeight,r.bottom);o+=5){let r=e.root.elementFromPoint(i,o);if(!r||r==e.dom||!e.dom.contains(r))continue;let a=r.getBoundingClientRect();if(a.top>=s-20){t=r,n=a.top;break}}return{refDOM:t,refTop:n,stack:z(e.dom)}}function z(e){let t=[],n=e.ownerDocument;for(let r=e;r;r=a(r))if(t.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),e==n)break;return t}function $({refDOM:e,refTop:t,stack:n}){let r=e?e.getBoundingClientRect().top:0;H(n,0==r?0:r-t)}function H(e,t){for(let n=0;n<e.length;n++){let{dom:r,top:s,left:i}=e[n];r.scrollTop!=s+t&&(r.scrollTop=s+t),r.scrollLeft!=i&&(r.scrollLeft=i)}}let K=null;function q(e){if(e.setActive)return e.setActive();if(K)return e.focus(K);let t=z(e);e.focus(null==K?{get preventScroll(){return K={preventScroll:!0},!0}}:void 0),K||(K=!1,H(t,0))}function G(e,t){let n,r,s=2e8,i=0,o=t.top,a=t.top;for(let c=e.firstChild,u=0;c;c=c.nextSibling,u++){let e;if(1==c.nodeType)e=c.getClientRects();else{if(3!=c.nodeType)continue;e=l(c).getClientRects()}for(let l=0;l<e.length;l++){let h=e[l];if(h.top<=o&&h.bottom>=a){o=Math.max(h.bottom,o),a=Math.min(h.top,a);let e=h.left>t.left?h.left-t.left:h.right<t.left?t.left-h.right:0;if(e<s){n=c,s=e,r=e&&3==n.nodeType?{left:h.right<t.left?h.right:h.left,top:t.top}:t,1==c.nodeType&&e&&(i=u+(t.left>=(h.left+h.right)/2?1:0));continue}}!n&&(t.left>=h.right&&t.top>=h.top||t.left>=h.left&&t.top>=h.bottom)&&(i=u+1)}}return n&&3==n.nodeType?W(n,r):!n||s&&1==n.nodeType?{node:e,offset:i}:G(n,r)}function W(e,t){let n=e.nodeValue.length,r=document.createRange();for(let s=0;s<n;s++){r.setEnd(e,s+1),r.setStart(e,s);let n=te(r,1);if(n.top!=n.bottom&&Y(t,n))return{node:e,offset:s+(t.left>=(n.left+n.right)/2?1:0)}}return{node:e,offset:0}}function Y(e,t){return e.left>=t.left-1&&e.left<=t.right+1&&e.top>=t.top-1&&e.top<=t.bottom+1}function J(e,t){let n=e.parentNode;return n&&/^li$/i.test(n.nodeName)&&t.left<e.getBoundingClientRect().left?n:e}function Q(e,t,n){let{node:r,offset:s}=G(t,n),i=-1;if(1==r.nodeType&&!r.firstChild){let e=r.getBoundingClientRect();i=e.left!=e.right&&n.left>(e.left+e.right)/2?1:-1}return e.docView.posFromDOM(r,s,i)}function X(e,t,n,r){let s=-1;for(let i=t,o=!1;;){if(i==e.dom)break;let t=e.docView.nearestDesc(i,!0);if(!t)return null;if(1==t.dom.nodeType&&(t.node.isBlock&&t.parent&&!o||!t.contentDOM)){let e=t.dom.getBoundingClientRect();if(t.node.isBlock&&t.parent&&!o&&(o=!0,e.left>r.left||e.top>r.top?s=t.posBefore:(e.right<r.left||e.bottom<r.top)&&(s=t.posAfter)),!t.contentDOM&&s<0){let n=t.node.isBlock?r.top<(e.top+e.bottom)/2:r.left<(e.left+e.right)/2;return n?t.posBefore:t.posAfter}}i=t.dom.parentNode}return s>-1?s:e.docView.posFromDOM(t,n,-1)}function Z(e,t,n){let r=e.childNodes.length;if(r&&n.top<n.bottom)for(let s=Math.max(0,Math.min(r-1,Math.floor(r*(t.top-n.top)/(n.bottom-n.top))-2)),i=s;;){let n=e.childNodes[i];if(1==n.nodeType){let e=n.getClientRects();for(let r=0;r<e.length;r++){let s=e[r];if(Y(t,s))return Z(n,t,s)}}if((i=(i+1)%r)==s)break}return e}function ee(e,t){let n,r=e.dom.ownerDocument,s=0;if(r.caretPositionFromPoint)try{let e=r.caretPositionFromPoint(t.left,t.top);e&&({offsetNode:n,offset:s}=e)}catch(l){}if(!n&&r.caretRangeFromPoint){let e=r.caretRangeFromPoint(t.left,t.top);e&&({startContainer:n,startOffset:s}=e)}let i,o=(e.root.elementFromPoint?e.root:r).elementFromPoint(t.left,t.top);if(!o||!e.dom.contains(1!=o.nodeType?o.parentNode:o)){let n=e.dom.getBoundingClientRect();if(!Y(t,n))return null;if(o=Z(e.dom,t,n),!o)return null}if(x)for(let u=o;n&&u;u=a(u))u.draggable&&(n=void 0);if(o=J(o,t),n){if(C&&1==n.nodeType&&(s=Math.min(s,n.childNodes.length),s<n.childNodes.length)){let e,r=n.childNodes[s];"IMG"==r.nodeName&&(e=r.getBoundingClientRect()).right<=t.left&&e.bottom>t.top&&s++}n==e.dom&&s==n.childNodes.length-1&&1==n.lastChild.nodeType&&t.top>n.lastChild.getBoundingClientRect().bottom?i=e.state.doc.content.size:0!=s&&1==n.nodeType&&"BR"==n.childNodes[s-1].nodeName||(i=X(e,n,s,t))}null==i&&(i=Q(e,o,t));let c=e.docView.nearestDesc(o,!0);return{pos:i,inside:c?c.posAtStart-c.border:-1}}function te(e,t){let n=e.getClientRects();return n.length?n[t<0?0:n.length-1]:e.getBoundingClientRect()}const ne=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function re(e,t,n){let{node:r,offset:s,atom:i}=e.docView.domFromPos(t,n<0?-1:1),o=L||C;if(3==r.nodeType){if(!o||!ne.test(r.nodeValue)&&(n<0?s:s!=r.nodeValue.length)){let e=s,t=s,i=n<0?1:-1;return n<0&&!s?(t++,i=-1):n>=0&&s==r.nodeValue.length?(e--,i=1):n<0?e--:t++,se(te(l(r,e,t),1),i<0)}{let e=te(l(r,s,s),n);if(C&&s&&/\s/.test(r.nodeValue[s-1])&&s<r.nodeValue.length){let t=te(l(r,s-1,s-1),-1);if(t.top==e.top){let n=te(l(r,s,s+1),-1);if(n.top!=e.top)return se(n,n.left<t.left)}}return e}}let a=e.state.doc.resolve(t-(i||0));if(!a.parent.inlineContent){if(null==i&&s&&(n<0||s==p(r))){let e=r.childNodes[s-1];if(1==e.nodeType)return ie(e.getBoundingClientRect(),!1)}if(null==i&&s<p(r)){let e=r.childNodes[s];if(1==e.nodeType)return ie(e.getBoundingClientRect(),!0)}return ie(r.getBoundingClientRect(),n>=0)}if(null==i&&s&&(n<0||s==p(r))){let e=r.childNodes[s-1],t=3==e.nodeType?l(e,p(e)-(o?0:1)):1!=e.nodeType||"BR"==e.nodeName&&e.nextSibling?null:e;if(t)return se(te(t,1),!1)}if(null==i&&s<p(r)){let e=r.childNodes[s];while(e.pmViewDesc&&e.pmViewDesc.ignoreForCoords)e=e.nextSibling;let t=e?3==e.nodeType?l(e,0,o?0:1):1==e.nodeType?e:null:null;if(t)return se(te(t,-1),!0)}return se(te(3==r.nodeType?l(r):r,-n),n>=0)}function se(e,t){if(0==e.width)return e;let n=t?e.left:e.right;return{top:e.top,bottom:e.bottom,left:n,right:n}}function ie(e,t){if(0==e.height)return e;let n=t?e.top:e.bottom;return{top:n,bottom:n,left:e.left,right:e.right}}function oe(e,t,n){let r=e.state,s=e.root.activeElement;r!=t&&e.updateState(t),s!=e.dom&&e.focus();try{return n()}finally{r!=t&&e.updateState(r),s!=e.dom&&s&&s.focus()}}function ae(e,t,n){let r=t.selection,s="up"==n?r.$from:r.$to;return oe(e,t,(()=>{let{node:t}=e.docView.domFromPos(s.pos,"up"==n?-1:1);for(;;){let n=e.docView.nearestDesc(t,!0);if(!n)break;if(n.node.isBlock){t=n.contentDOM||n.dom;break}t=n.dom.parentNode}let r=re(e,s.pos,1);for(let e=t.firstChild;e;e=e.nextSibling){let t;if(1==e.nodeType)t=e.getClientRects();else{if(3!=e.nodeType)continue;t=l(e,0,e.nodeValue.length).getClientRects()}for(let e=0;e<t.length;e++){let s=t[e];if(s.bottom>s.top+1&&("up"==n?r.top-s.top>2*(s.bottom-r.top):s.bottom-r.bottom>2*(r.bottom-s.top)))return!1}}return!0}))}const ce=/[\u0590-\u08ac]/;function le(e,t,n){let{$head:r}=t.selection;if(!r.parent.isTextblock)return!1;let s=r.parentOffset,i=!s,o=s==r.parent.content.size,a=e.domSelection();return ce.test(r.parent.textContent)&&a.modify?oe(e,t,(()=>{let{focusNode:t,focusOffset:s,anchorNode:i,anchorOffset:o}=e.domSelectionRange(),c=a.caretBidiLevel;a.modify("move",n,"character");let l=r.depth?e.docView.domAfterPos(r.before()):e.dom,{focusNode:u,focusOffset:h}=e.domSelectionRange(),d=u&&!l.contains(1==u.nodeType?u:u.parentNode)||t==u&&s==h;try{a.collapse(i,o),t&&(t!=i||s!=o)&&a.extend&&a.extend(t,s)}catch(p){}return null!=c&&(a.caretBidiLevel=c),d})):"left"==n||"backward"==n?i:o}let ue=null,he=null,de=!1;function pe(e,t,n){return ue==t&&he==n?de:(ue=t,he=n,de="up"==n||"down"==n?ae(e,t,n):le(e,t,n))}const fe=0,ge=1,me=2,ye=3;class we{constructor(e,t,n,r){this.parent=e,this.children=t,this.dom=n,this.contentDOM=r,this.dirty=fe,n.pmViewDesc=this}matchesWidget(e){return!1}matchesMark(e){return!1}matchesNode(e,t,n){return!1}matchesHack(e){return!1}parseRule(){return null}stopEvent(e){return!1}get size(){let e=0;for(let t=0;t<this.children.length;t++)e+=this.children[t].size;return e}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let e=0;e<this.children.length;e++)this.children[e].destroy()}posBeforeChild(e){for(let t=0,n=this.posAtStart;;t++){let r=this.children[t];if(r==e)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(e,t,n){if(this.contentDOM&&this.contentDOM.contains(1==e.nodeType?e:e.parentNode)){if(n<0){let n,r;if(e==this.contentDOM)n=e.childNodes[t-1];else{while(e.parentNode!=this.contentDOM)e=e.parentNode;n=e.previousSibling}while(n&&(!(r=n.pmViewDesc)||r.parent!=this))n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}{let n,r;if(e==this.contentDOM)n=e.childNodes[t];else{while(e.parentNode!=this.contentDOM)e=e.parentNode;n=e.nextSibling}while(n&&(!(r=n.pmViewDesc)||r.parent!=this))n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}}let r;if(e==this.dom&&this.contentDOM)r=t>o(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=2&e.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==t)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!1;break}if(t.previousSibling)break}if(null==r&&t==e.childNodes.length)for(let t=e;;t=t.parentNode){if(t==this.dom){r=!0;break}if(t.nextSibling)break}}return(null==r?n>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(e,t=!1){for(let n=!0,r=e;r;r=r.parentNode){let s,i=this.getDesc(r);if(i&&(!t||i.node)){if(!n||!(s=i.nodeDOM)||(1==s.nodeType?s.contains(1==e.nodeType?e:e.parentNode):s==e))return i;n=!1}}}getDesc(e){let t=e.pmViewDesc;for(let n=t;n;n=n.parent)if(n==this)return t}posFromDOM(e,t,n){for(let r=e;r;r=r.parentNode){let s=this.getDesc(r);if(s)return s.localPosFromDOM(e,t,n)}return-1}descAt(e){for(let t=0,n=0;t<this.children.length;t++){let r=this.children[t],s=n+r.size;if(n==e&&s!=n){while(!r.border&&r.children.length)r=r.children[0];return r}if(e<s)return r.descAt(e-n-r.border);n=s}}domFromPos(e,t){if(!this.contentDOM)return{node:this.dom,offset:0,atom:e+1};let n=0,r=0;for(let s=0;n<this.children.length;n++){let t=this.children[n],i=s+t.size;if(i>e||t instanceof Ae){r=e-s;break}s=i}if(r)return this.children[n].domFromPos(r-this.children[n].border,t);for(let s;n&&!(s=this.children[n-1]).size&&s instanceof be&&s.side>=0;n--);if(t<=0){let e,r=!0;for(;;n--,r=!1)if(e=n?this.children[n-1]:null,!e||e.dom.parentNode==this.contentDOM)break;return e&&t&&r&&!e.border&&!e.domAtom?e.domFromPos(e.size,t):{node:this.contentDOM,offset:e?o(e.dom)+1:0}}{let e,r=!0;for(;;n++,r=!1)if(e=n<this.children.length?this.children[n]:null,!e||e.dom.parentNode==this.contentDOM)break;return e&&r&&!e.border&&!e.domAtom?e.domFromPos(0,t):{node:this.contentDOM,offset:e?o(e.dom):this.contentDOM.childNodes.length}}}parseRange(e,t,n=0){if(0==this.children.length)return{node:this.contentDOM,from:e,to:t,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,s=-1;for(let i=n,a=0;;a++){let n=this.children[a],c=i+n.size;if(-1==r&&e<=c){let s=i+n.border;if(e>=s&&t<=c-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(e,t,s);e=i;for(let t=a;t>0;t--){let n=this.children[t-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=o(n.dom)+1;break}e-=n.size}-1==r&&(r=0)}if(r>-1&&(c>t||a==this.children.length-1)){t=c;for(let e=a+1;e<this.children.length;e++){let n=this.children[e];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){s=o(n.dom);break}t+=n.size}-1==s&&(s=this.contentDOM.childNodes.length);break}i=c}return{node:this.contentDOM,from:e,to:t,fromOffset:r,toOffset:s}}emptyChildAt(e){if(this.border||!this.contentDOM||!this.children.length)return!1;let t=this.children[e<0?0:this.children.length-1];return 0==t.size||t.emptyChildAt(e)}domAfterPos(e){let{node:t,offset:n}=this.domFromPos(e,0);if(1!=t.nodeType||n==t.childNodes.length)throw new RangeError("No node after pos "+e);return t.childNodes[n]}setSelection(e,t,n,r=!1){let s=Math.min(e,t),i=Math.max(e,t);for(let o=0,u=0;o<this.children.length;o++){let a=this.children[o],c=u+a.size;if(s>u&&i<c)return a.setSelection(e-u-a.border,t-u-a.border,n,r);u=c}let a=this.domFromPos(e,e?-1:1),c=t==e?a:this.domFromPos(t,t?-1:1),l=n.getSelection(),h=!1;if((C||x)&&e==t){let{node:e,offset:t}=a;if(3==e.nodeType){if(h=!(!t||"\n"!=e.nodeValue[t-1]),h&&t==e.nodeValue.length)for(let n,r=e;r;r=r.parentNode){if(n=r.nextSibling){"BR"==n.nodeName&&(a=c={node:n.parentNode,offset:o(n)+1});break}let e=r.pmViewDesc;if(e&&e.node&&e.node.isBlock)break}}else{let n=e.childNodes[t-1];h=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(C&&l.focusNode&&l.focusNode!=c.node&&1==l.focusNode.nodeType){let e=l.focusNode.childNodes[l.focusOffset];e&&"false"==e.contentEditable&&(r=!0)}if(!(r||h&&x)&&u(a.node,a.offset,l.anchorNode,l.anchorOffset)&&u(c.node,c.offset,l.focusNode,l.focusOffset))return;let d=!1;if((l.extend||e==t)&&!h){l.collapse(a.node,a.offset);try{e!=t&&l.extend(c.node,c.offset),d=!0}catch(p){}}if(!d){if(e>t){let e=a;a=c,c=e}let n=document.createRange();n.setEnd(c.node,c.offset),n.setStart(a.node,a.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(e){return!this.contentDOM&&"selection"!=e.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(e,t){for(let n=0,r=0;r<this.children.length;r++){let s=this.children[r],i=n+s.size;if(n==i?e<=i&&t>=n:e<i&&t>n){let r=n+s.border,o=i-s.border;if(e>=r&&t<=o)return this.dirty=e==n||t==i?me:ge,void(e!=r||t!=o||!s.contentLost&&s.dom.parentNode==this.contentDOM?s.markDirty(e-r,t-r):s.dirty=ye);s.dirty=s.dom!=s.contentDOM||s.dom.parentNode!=this.contentDOM||s.children.length?ye:me}n=i}this.dirty=me}markParentsDirty(){let e=1;for(let t=this.parent;t;t=t.parent,e++){let n=1==e?me:ge;t.dirty<n&&(t.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class be extends we{constructor(e,t,n,r){let s,i=t.type.toDOM;if("function"==typeof i&&(i=i(n,(()=>s?s.parent?s.parent.posBeforeChild(s):void 0:r))),!t.type.spec.raw){if(1!=i.nodeType){let e=document.createElement("span");e.appendChild(i),i=e}i.contentEditable="false",i.classList.add("ProseMirror-widget")}super(e,[],i,null),this.widget=t,this.widget=t,s=this}matchesWidget(e){return this.dirty==fe&&e.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(e){let t=this.widget.spec.stopEvent;return!!t&&t(e)}ignoreMutation(e){return"selection"!=e.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class ve extends we{constructor(e,t,n,r){super(e,[],t,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(e,t){return e!=this.textDOM?this.posAtStart+(t?this.size:0):this.posAtStart+t}domFromPos(e){return{node:this.textDOM,offset:e}}ignoreMutation(e){return"characterData"===e.type&&e.target.nodeValue==e.oldValue}}class Ee extends we{constructor(e,t,n,r){super(e,[],n,r),this.mark=t}static create(e,t,n,r){let i=r.nodeViews[t.type.name],o=i&&i(t,r,n);return o&&o.dom||(o=s.PW.renderSpec(document,t.type.spec.toDOM(t,n))),new Ee(e,t,o.dom,o.contentDOM||o.dom)}parseRule(){return this.dirty&ye||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM||void 0}}matchesMark(e){return this.dirty!=ye&&this.mark.eq(e)}markDirty(e,t){if(super.markDirty(e,t),this.dirty!=fe){let e=this.parent;while(!e.node)e=e.parent;e.dirty<this.dirty&&(e.dirty=this.dirty),this.dirty=fe}}slice(e,t,n){let r=Ee.create(this.parent,this.mark,!0,n),s=this.children,i=this.size;t<i&&(s=$e(s,t,i,n)),e>0&&(s=$e(s,0,e,n));for(let o=0;o<s.length;o++)s[o].parent=r;return r.children=s,r}}class _e extends we{constructor(e,t,n,r,s,i,o,a,c){super(e,[],s,i),this.node=t,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=o,i&&this.updateChildren(a,c)}static create(e,t,n,r,i,o){let a,c=i.nodeViews[t.type.name],l=c&&c(t,i,(()=>a?a.parent?a.parent.posBeforeChild(a):void 0:o),n,r),u=l&&l.dom,h=l&&l.contentDOM;if(t.isText)if(u){if(3!=u.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else u=document.createTextNode(t.text);else u||({dom:u,contentDOM:h}=s.PW.renderSpec(document,t.type.spec.toDOM(t)));h||t.isText||"BR"==u.nodeName||(u.hasAttribute("contenteditable")||(u.contentEditable="false"),t.type.spec.draggable&&(u.draggable=!0));let d=u;return u=De(u,n,t),l?a=new Te(e,t,n,r,u,h||null,d,l,i,o+1):t.isText?new ke(e,t,n,r,u,d,i):new _e(e,t,n,r,u,h||null,d,i,o+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let e={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(e.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let t=this.children.length-1;t>=0;t--){let n=this.children[t];if(this.dom.contains(n.dom.parentNode)){e.contentElement=n.dom.parentNode;break}}e.contentElement||(e.getContent=()=>s.HY.empty)}else e.contentElement=this.contentDOM;else e.getContent=()=>this.node.content;return e}matchesNode(e,t,n){return this.dirty==fe&&e.eq(this.node)&&Pe(t,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(e,t){let n=this.node.inlineContent,r=t,i=e.composing?this.localCompositionInfo(e,t):null,o=i&&i.pos>-1?i:null,a=i&&i.pos<0,c=new Me(this,o&&o.node,e);Ve(this.node,this.innerDeco,((t,i,o)=>{t.spec.marks?c.syncToMarks(t.spec.marks,n,e):t.type.side>=0&&!o&&c.syncToMarks(i==this.node.childCount?s.vc.none:this.node.child(i).marks,n,e),c.placeWidget(t,e,r)}),((t,s,o,l)=>{let u;c.syncToMarks(t.marks,n,e),c.findNodeMatch(t,s,o,l)||a&&e.state.selection.from>r&&e.state.selection.to<r+t.nodeSize&&(u=c.findIndexWithChild(i.node))>-1&&c.updateNodeAt(t,s,o,u,e)||c.updateNextNode(t,s,o,e,l)||c.addNode(t,s,o,e,r),r+=t.nodeSize})),c.syncToMarks([],n,e),this.node.isTextblock&&c.addTextblockHacks(),c.destroyRest(),(c.changed||this.dirty==me)&&(o&&this.protectLocalComposition(e,o),Ce(this.contentDOM,this.children,e),N&&Fe(this.dom))}localCompositionInfo(e,t){let{from:n,to:s}=e.state.selection;if(!(e.state.selection instanceof r.Bs)||n<t||s>t+this.node.content.size)return null;let i=e.domSelectionRange(),o=je(i.focusNode,i.focusOffset);if(!o||!this.dom.contains(o.parentNode))return null;if(this.node.inlineContent){let e=o.nodeValue,r=ze(this.node.content,e,n-t,s-t);return r<0?null:{node:o,pos:r,text:e}}return{node:o,pos:-1,text:""}}protectLocalComposition(e,{node:t,pos:n,text:r}){if(this.getDesc(t))return;let s=t;for(;;s=s.parentNode){if(s.parentNode==this.contentDOM)break;while(s.previousSibling)s.parentNode.removeChild(s.previousSibling);while(s.nextSibling)s.parentNode.removeChild(s.nextSibling);s.pmViewDesc&&(s.pmViewDesc=void 0)}let i=new ve(this,s,t,r);e.input.compositionNodes.push(i),this.children=$e(this.children,n,n+r.length,e,i)}update(e,t,n,r){return!(this.dirty==ye||!e.sameMarkup(this.node))&&(this.updateInner(e,t,n,r),!0)}updateInner(e,t,n,r){this.updateOuterDeco(t),this.node=e,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=fe}updateOuterDeco(e){if(Pe(e,this.outerDeco))return;let t=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=xe(this.dom,this.nodeDOM,Oe(this.outerDeco,this.node,t),Oe(e,this.node,t)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=e}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function Se(e,t,n,r,s){return De(r,t,e),new _e(void 0,e,t,n,r,r,r,s,0)}class ke extends _e{constructor(e,t,n,r,s,i,o){super(e,t,n,r,s,null,i,o,0)}parseRule(){let e=this.nodeDOM.parentNode;while(e&&e!=this.dom&&!e.pmIsDeco)e=e.parentNode;return{skip:e||!0}}update(e,t,n,r){return!(this.dirty==ye||this.dirty!=fe&&!this.inParent()||!e.sameMarkup(this.node))&&(this.updateOuterDeco(t),this.dirty==fe&&e.text==this.node.text||e.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=e.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=e,this.dirty=fe,!0)}inParent(){let e=this.parent.contentDOM;for(let t=this.nodeDOM;t;t=t.parentNode)if(t==e)return!0;return!1}domFromPos(e){return{node:this.nodeDOM,offset:e}}localPosFromDOM(e,t,n){return e==this.nodeDOM?this.posAtStart+Math.min(t,this.node.text.length):super.localPosFromDOM(e,t,n)}ignoreMutation(e){return"characterData"!=e.type&&"selection"!=e.type}slice(e,t,n){let r=this.node.cut(e,t),s=document.createTextNode(r.text);return new ke(this.parent,r,this.outerDeco,this.innerDeco,s,s,n)}markDirty(e,t){super.markDirty(e,t),this.dom==this.nodeDOM||0!=e&&t!=this.nodeDOM.nodeValue.length||(this.dirty=ye)}get domAtom(){return!1}}class Ae extends we{parseRule(){return{ignore:!0}}matchesHack(e){return this.dirty==fe&&this.dom.nodeName==e}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class Te extends _e{constructor(e,t,n,r,s,i,o,a,c,l){super(e,t,n,r,s,i,o,c,l),this.spec=a}update(e,t,n,r){if(this.dirty==ye)return!1;if(this.spec.update){let s=this.spec.update(e,t,n);return s&&this.updateInner(e,t,n,r),s}return!(!this.contentDOM&&!e.isLeaf)&&super.update(e,t,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(e,t,n,r){this.spec.setSelection?this.spec.setSelection(e,t,n):super.setSelection(e,t,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(e){return!!this.spec.stopEvent&&this.spec.stopEvent(e)}ignoreMutation(e){return this.spec.ignoreMutation?this.spec.ignoreMutation(e):super.ignoreMutation(e)}}function Ce(e,t,n){let r=e.firstChild,s=!1;for(let i=0;i<t.length;i++){let o=t[i],a=o.dom;if(a.parentNode==e){while(a!=r)r=Le(r),s=!0;r=r.nextSibling}else s=!0,e.insertBefore(a,r);if(o instanceof Ee){let t=r?r.previousSibling:e.lastChild;Ce(o.contentDOM,o.children,n),r=t?t.nextSibling:e.firstChild}}while(r)r=Le(r),s=!0;s&&n.trackWrites==e&&(n.trackWrites=null)}const Ie=function(e){e&&(this.nodeName=e)};Ie.prototype=Object.create(null);const Re=[new Ie];function Oe(e,t,n){if(0==e.length)return Re;let r=n?Re[0]:new Ie,s=[r];for(let i=0;i<e.length;i++){let o=e[i].type.attrs;if(o){o.nodeName&&s.push(r=new Ie(o.nodeName));for(let e in o){let i=o[e];null!=i&&(n&&1==s.length&&s.push(r=new Ie(t.isInline?"span":"div")),"class"==e?r.class=(r.class?r.class+" ":"")+i:"style"==e?r.style=(r.style?r.style+";":"")+i:"nodeName"!=e&&(r[e]=i))}}}return s}function xe(e,t,n,r){if(n==Re&&r==Re)return t;let s=t;for(let i=0;i<r.length;i++){let t=r[i],o=n[i];if(i){let n;o&&o.nodeName==t.nodeName&&s!=e&&(n=s.parentNode)&&n.nodeName.toLowerCase()==t.nodeName||(n=document.createElement(t.nodeName),n.pmIsDeco=!0,n.appendChild(s),o=Re[0]),s=n}Ne(s,o||Re[0],t)}return s}function Ne(e,t,n){for(let r in t)"class"==r||"style"==r||"nodeName"==r||r in n||e.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=t[r]&&e.setAttribute(r,n[r]);if(t.class!=n.class){let r=t.class?t.class.split(" ").filter(Boolean):[],s=n.class?n.class.split(" ").filter(Boolean):[];for(let t=0;t<r.length;t++)-1==s.indexOf(r[t])&&e.classList.remove(r[t]);for(let t=0;t<s.length;t++)-1==r.indexOf(s[t])&&e.classList.add(s[t]);0==e.classList.length&&e.removeAttribute("class")}if(t.style!=n.style){if(t.style){let n,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;while(n=r.exec(t.style))e.style.removeProperty(n[1])}n.style&&(e.style.cssText+=n.style)}}function De(e,t,n){return xe(e,e,Re,Oe(t,n,1!=e.nodeType))}function Pe(e,t){if(e.length!=t.length)return!1;for(let n=0;n<e.length;n++)if(!e[n].type.eq(t[n].type))return!1;return!0}function Le(e){let t=e.nextSibling;return e.parentNode.removeChild(e),t}class Me{constructor(e,t,n){this.lock=t,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=e,this.preMatch=Be(e.node.content,e)}destroyBetween(e,t){if(e!=t){for(let n=e;n<t;n++)this.top.children[n].destroy();this.top.children.splice(e,t-e),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(e,t,n){let r=0,s=this.stack.length>>1,i=Math.min(s,e.length);while(r<i&&(r==s-1?this.top:this.stack[r+1<<1]).matchesMark(e[r])&&!1!==e[r].type.spec.spanning)r++;while(r<s)this.destroyRest(),this.top.dirty=fe,this.index=this.stack.pop(),this.top=this.stack.pop(),s--;while(s<e.length){this.stack.push(this.top,this.index+1);let r=-1;for(let t=this.index;t<Math.min(this.index+3,this.top.children.length);t++){let n=this.top.children[t];if(n.matchesMark(e[s])&&!this.isLocked(n.dom)){r=t;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=Ee.create(this.top,e[s],t,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,s++}}findNodeMatch(e,t,n,r){let s,i=-1;if(r>=this.preMatch.index&&(s=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&s.matchesNode(e,t,n))i=this.top.children.indexOf(s,this.index);else for(let o=this.index,a=Math.min(this.top.children.length,o+5);o<a;o++){let r=this.top.children[o];if(r.matchesNode(e,t,n)&&!this.preMatch.matched.has(r)){i=o;break}}return!(i<0)&&(this.destroyBetween(this.index,i),this.index++,!0)}updateNodeAt(e,t,n,r,s){let i=this.top.children[r];return i.dirty==ye&&i.dom==i.contentDOM&&(i.dirty=me),!!i.update(e,t,n,s)&&(this.destroyBetween(this.index,r),this.index++,!0)}findIndexWithChild(e){for(;;){let t=e.parentNode;if(!t)return-1;if(t==this.top.contentDOM){let t=e.pmViewDesc;if(t)for(let e=this.index;e<this.top.children.length;e++)if(this.top.children[e]==t)return e;return-1}e=t}}updateNextNode(e,t,n,r,s){for(let i=this.index;i<this.top.children.length;i++){let o=this.top.children[i];if(o instanceof _e){let a=this.preMatch.matched.get(o);if(null!=a&&a!=s)return!1;let c=o.dom,l=this.isLocked(c)&&!(e.isText&&o.node&&o.node.isText&&o.nodeDOM.nodeValue==e.text&&o.dirty!=ye&&Pe(t,o.outerDeco));if(!l&&o.update(e,t,n,r))return this.destroyBetween(this.index,i),o.dom!=c&&(this.changed=!0),this.index++,!0;break}}return!1}addNode(e,t,n,r,s){this.top.children.splice(this.index++,0,_e.create(this.top,e,t,n,r,s)),this.changed=!0}placeWidget(e,t,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(e)||e!=r.widget&&r.widget.type.toDOM.parentNode){let r=new be(this.top,e,t,n);this.top.children.splice(this.index++,0,r),this.changed=!0}else this.index++}addTextblockHacks(){let e=this.top.children[this.index-1],t=this.top;while(e instanceof Ee)t=e,e=t.children[t.children.length-1];(!e||!(e instanceof ke)||/\n$/.test(e.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(e.node.text))&&((x||R)&&e&&"false"==e.dom.contentEditable&&this.addHackNode("IMG",t),this.addHackNode("BR",this.top))}addHackNode(e,t){if(t==this.top&&this.index<t.children.length&&t.children[this.index].matchesHack(e))this.index++;else{let n=document.createElement(e);"IMG"==e&&(n.className="ProseMirror-separator",n.alt=""),"BR"==e&&(n.className="ProseMirror-trailingBreak");let r=new Ae(this.top,[],n,null);t!=this.top?t.children.push(r):t.children.splice(this.index++,0,r),this.changed=!0}}isLocked(e){return this.lock&&(e==this.lock||1==e.nodeType&&e.contains(this.lock.parentNode))}}function Be(e,t){let n=t,r=n.children.length,s=e.childCount,i=new Map,o=[];e:while(s>0){let a;for(;;)if(r){let e=n.children[r-1];if(!(e instanceof Ee)){a=e,r--;break}n=e,r=e.children.length}else{if(n==t)break e;r=n.parent.children.indexOf(n),n=n.parent}let c=a.node;if(c){if(c!=e.child(s-1))break;--s,i.set(a,s),o.push(a)}}return{index:s,matched:i,matches:o.reverse()}}function Ue(e,t){return e.type.side-t.type.side}function Ve(e,t,n,r){let s=t.locals(e),i=0;if(0==s.length){for(let n=0;n<e.childCount;n++){let o=e.child(n);r(o,s,t.forChild(i,o),n),i+=o.nodeSize}return}let o=0,a=[],c=null;for(let l=0;;){if(o<s.length&&s[o].to==i){let e,t=s[o++];while(o<s.length&&s[o].to==i)(e||(e=[t])).push(s[o++]);if(e){e.sort(Ue);for(let t=0;t<e.length;t++)n(e[t],l,!!c)}else n(t,l,!!c)}let u,h;if(c)h=-1,u=c,c=null;else{if(!(l<e.childCount))break;h=l,u=e.child(l++)}for(let e=0;e<a.length;e++)a[e].to<=i&&a.splice(e--,1);while(o<s.length&&s[o].from<=i&&s[o].to>i)a.push(s[o++]);let d=i+u.nodeSize;if(u.isText){let e=d;o<s.length&&s[o].from<e&&(e=s[o].from);for(let t=0;t<a.length;t++)a[t].to<e&&(e=a[t].to);e<d&&(c=u.cut(e-i),u=u.cut(0,e-i),d=e,h=-1)}let p=u.isInline&&!u.isLeaf?a.filter((e=>!e.inline)):a.slice();r(u,p,t.forChild(i,u),h),i=d}}function Fe(e){if("UL"==e.nodeName||"OL"==e.nodeName){let t=e.style.cssText;e.style.cssText=t+"; list-style: square !important",window.getComputedStyle(e).listStyle,e.style.cssText=t}}function je(e,t){for(;;){if(3==e.nodeType)return e;if(1==e.nodeType&&t>0){if(e.childNodes.length>t&&3==e.childNodes[t].nodeType)return e.childNodes[t];e=e.childNodes[t-1],t=p(e)}else{if(!(1==e.nodeType&&t<e.childNodes.length))return null;e=e.childNodes[t],t=0}}}function ze(e,t,n,r){for(let s=0,i=0;s<e.childCount&&i<=r;){let o=e.child(s++),a=i;if(i+=o.nodeSize,!o.isText)continue;let c=o.text;while(s<e.childCount){let t=e.child(s++);if(i+=t.nodeSize,!t.isText)break;c+=t.text}if(i>=n){let e=a<r?c.lastIndexOf(t,r-a-1):-1;if(e>=0&&e+t.length+a>=n)return a+e;if(n==r&&c.length>=r+t.length-a&&c.slice(r-a,r-a+t.length)==t)return r}}return-1}function $e(e,t,n,r,s){let i=[];for(let o=0,a=0;o<e.length;o++){let c=e[o],l=a,u=a+=c.size;l>=n||u<=t?i.push(c):(l<t&&i.push(c.slice(0,t-l,r)),s&&(i.push(s),s=void 0),u>n&&i.push(c.slice(n-l,c.size,r)))}return i}function He(e,t=null){let n=e.domSelectionRange(),s=e.state.doc;if(!n.focusNode)return null;let i=e.docView.nearestDesc(n.focusNode),o=i&&0==i.size,a=e.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(a<0)return null;let c,l,u=s.resolve(a);if(m(n)){c=u;while(i&&!i.node)i=i.parent;let e=i.node;if(i&&e.isAtom&&r.qv.isSelectable(e)&&i.parent&&(!e.isInline||!f(n.focusNode,n.focusOffset,i.dom))){let e=i.posBefore;l=new r.qv(a==e?u:s.resolve(e))}}else{let t=e.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(t<0)return null;c=s.resolve(t)}if(!l){let n="pointer"==t||e.state.selection.head<u.pos&&!o?1:-1;l=tt(e,c,u,n)}return l}function Ke(e){return e.editable?e.hasFocus():rt(e)&&document.activeElement&&document.activeElement.contains(e.dom)}function qe(e,t=!1){let n=e.state.selection;if(Ze(e,n),Ke(e)){if(!t&&e.input.mouseDown&&e.input.mouseDown.allowDefault&&R){let t=e.domSelectionRange(),n=e.domObserver.currentSelection;if(t.anchorNode&&n.anchorNode&&u(t.anchorNode,t.anchorOffset,n.anchorNode,n.anchorOffset))return e.input.mouseDown.delayedSelectionSync=!0,void e.domObserver.setCurSelection()}if(e.domObserver.disconnectSelection(),e.cursorWrapper)Xe(e);else{let s,i,{anchor:o,head:a}=n;!Ge||n instanceof r.Bs||(n.$from.parent.inlineContent||(s=We(e,n.from)),n.empty||n.$from.parent.inlineContent||(i=We(e,n.to))),e.docView.setSelection(o,a,e.root,t),Ge&&(s&&Je(s),i&&Je(i)),n.visible?e.dom.classList.remove("ProseMirror-hideselection"):(e.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&Qe(e))}e.domObserver.setCurSelection(),e.domObserver.connectSelection()}}const Ge=x||R&&O<63;function We(e,t){let{node:n,offset:r}=e.docView.domFromPos(t,0),s=r<n.childNodes.length?n.childNodes[r]:null,i=r?n.childNodes[r-1]:null;if(x&&s&&"false"==s.contentEditable)return Ye(s);if((!s||"false"==s.contentEditable)&&(!i||"false"==i.contentEditable)){if(s)return Ye(s);if(i)return Ye(i)}}function Ye(e){return e.contentEditable="true",x&&e.draggable&&(e.draggable=!1,e.wasDraggable=!0),e}function Je(e){e.contentEditable="false",e.wasDraggable&&(e.draggable=!0,e.wasDraggable=null)}function Qe(e){let t=e.dom.ownerDocument;t.removeEventListener("selectionchange",e.input.hideSelectionGuard);let n=e.domSelectionRange(),r=n.anchorNode,s=n.anchorOffset;t.addEventListener("selectionchange",e.input.hideSelectionGuard=()=>{n.anchorNode==r&&n.anchorOffset==s||(t.removeEventListener("selectionchange",e.input.hideSelectionGuard),setTimeout((()=>{Ke(e)&&!e.state.selection.visible||e.dom.classList.remove("ProseMirror-hideselection")}),20))})}function Xe(e){let t=e.domSelection(),n=document.createRange(),r=e.cursorWrapper.dom,s="IMG"==r.nodeName;s?n.setEnd(r.parentNode,o(r)+1):n.setEnd(r,0),n.collapse(!1),t.removeAllRanges(),t.addRange(n),!s&&!e.state.selection.visible&&A&&T<=11&&(r.disabled=!0,r.disabled=!1)}function Ze(e,t){if(t instanceof r.qv){let n=e.docView.descAt(t.from);n!=e.lastSelectedViewDesc&&(et(e),n&&n.selectNode(),e.lastSelectedViewDesc=n)}else et(e)}function et(e){e.lastSelectedViewDesc&&(e.lastSelectedViewDesc.parent&&e.lastSelectedViewDesc.deselectNode(),e.lastSelectedViewDesc=void 0)}function tt(e,t,n,s){return e.someProp("createSelectionBetween",(r=>r(e,t,n)))||r.Bs.between(t,n,s)}function nt(e){return!(e.editable&&!e.hasFocus())&&rt(e)}function rt(e){let t=e.domSelectionRange();if(!t.anchorNode)return!1;try{return e.dom.contains(3==t.anchorNode.nodeType?t.anchorNode.parentNode:t.anchorNode)&&(e.editable||e.dom.contains(3==t.focusNode.nodeType?t.focusNode.parentNode:t.focusNode))}catch(n){return!1}}function st(e){let t=e.docView.domFromPos(e.state.selection.anchor,0),n=e.domSelectionRange();return u(t.node,t.offset,n.anchorNode,n.anchorOffset)}function it(e,t){let{$anchor:n,$head:s}=e.selection,i=t>0?n.max(s):n.min(s),o=i.parent.inlineContent?i.depth?e.doc.resolve(t>0?i.after():i.before()):null:i;return o&&r.Y1.findFrom(o,t)}function ot(e,t){return e.dispatch(e.state.tr.setSelection(t).scrollIntoView()),!0}function at(e,t,n){let s=e.state.selection;if(!(s instanceof r.Bs)){if(s instanceof r.qv&&s.node.isInline)return ot(e,new r.Bs(t>0?s.$to:s.$from));{let n=it(e.state,t);return!!n&&ot(e,n)}}if(!s.empty||n.indexOf("s")>-1)return!1;if(e.endOfTextblock(t>0?"right":"left")){let n=it(e.state,t);return!!(n&&n instanceof r.qv)&&ot(e,n)}if(!(D&&n.indexOf("m")>-1)){let n,i=s.$head,o=i.textOffset?null:t<0?i.nodeBefore:i.nodeAfter;if(!o||o.isText)return!1;let a=t<0?i.pos-o.nodeSize:i.pos;return!!(o.isAtom||(n=e.docView.descAt(a))&&!n.contentDOM)&&(r.qv.isSelectable(o)?ot(e,new r.qv(t<0?e.state.doc.resolve(i.pos-o.nodeSize):i)):!!L&&ot(e,new r.Bs(e.state.doc.resolve(t<0?a:a+o.nodeSize))))}}function ct(e){return 3==e.nodeType?e.nodeValue.length:e.childNodes.length}function lt(e){let t=e.pmViewDesc;return t&&0==t.size&&(e.nextSibling||"BR"!=e.nodeName)}function ut(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let s,i,a=!1;for(C&&1==n.nodeType&&r<ct(n)&&lt(n.childNodes[r])&&(a=!0);;)if(r>0){if(1!=n.nodeType)break;{let e=n.childNodes[r-1];if(lt(e))s=n,i=--r;else{if(3!=e.nodeType)break;n=e,r=n.nodeValue.length}}}else{if(dt(n))break;{let t=n.previousSibling;while(t&&lt(t))s=n.parentNode,i=o(t),t=t.previousSibling;if(t)n=t,r=ct(n);else{if(n=n.parentNode,n==e.dom)break;r=0}}}a?pt(e,n,r):s&&pt(e,s,i)}function ht(e){let t=e.domSelectionRange(),n=t.focusNode,r=t.focusOffset;if(!n)return;let s,i,a=ct(n);for(;;)if(r<a){if(1!=n.nodeType)break;let e=n.childNodes[r];if(!lt(e))break;s=n,i=++r}else{if(dt(n))break;{let t=n.nextSibling;while(t&&lt(t))s=t.parentNode,i=o(t)+1,t=t.nextSibling;if(t)n=t,r=0,a=ct(n);else{if(n=n.parentNode,n==e.dom)break;r=a=0}}}s&&pt(e,s,i)}function dt(e){let t=e.pmViewDesc;return t&&t.node&&t.node.isBlock}function pt(e,t,n){let r=e.domSelection();if(m(r)){let e=document.createRange();e.setEnd(t,n),e.setStart(t,n),r.removeAllRanges(),r.addRange(e)}else r.extend&&r.extend(t,n);e.domObserver.setCurSelection();let{state:s}=e;setTimeout((()=>{e.state==s&&qe(e)}),50)}function ft(e,t,n){let s=e.state.selection;if(s instanceof r.Bs&&!s.empty||n.indexOf("s")>-1)return!1;if(D&&n.indexOf("m")>-1)return!1;let{$from:i,$to:o}=s;if(!i.parent.inlineContent||e.endOfTextblock(t<0?"up":"down")){let n=it(e.state,t);if(n&&n instanceof r.qv)return ot(e,n)}if(!i.parent.inlineContent){let n=t<0?i:o,a=s instanceof r.C1?r.Y1.near(n,t):r.Y1.findFrom(n,t);return!!a&&ot(e,a)}return!1}function gt(e,t){if(!(e.state.selection instanceof r.Bs))return!0;let{$head:n,$anchor:s,empty:i}=e.state.selection;if(!n.sameParent(s))return!0;if(!i)return!1;if(e.endOfTextblock(t>0?"forward":"backward"))return!0;let o=!n.textOffset&&(t<0?n.nodeBefore:n.nodeAfter);if(o&&!o.isText){let r=e.state.tr;return t<0?r.delete(n.pos-o.nodeSize,n.pos):r.delete(n.pos,n.pos+o.nodeSize),e.dispatch(r),!0}return!1}function mt(e,t,n){e.domObserver.stop(),t.contentEditable=n,e.domObserver.start()}function yt(e){if(!x||e.state.selection.$head.parentOffset>0)return!1;let{focusNode:t,focusOffset:n}=e.domSelectionRange();if(t&&1==t.nodeType&&0==n&&t.firstChild&&"false"==t.firstChild.contentEditable){let n=t.firstChild;mt(e,n,"true"),setTimeout((()=>mt(e,n,"false")),20)}return!1}function wt(e){let t="";return e.ctrlKey&&(t+="c"),e.metaKey&&(t+="m"),e.altKey&&(t+="a"),e.shiftKey&&(t+="s"),t}function bt(e,t){let n=t.keyCode,r=wt(t);return 8==n||D&&72==n&&"c"==r?gt(e,-1)||ut(e):46==n||D&&68==n&&"c"==r?gt(e,1)||ht(e):13==n||27==n||(37==n||D&&66==n&&"c"==r?at(e,-1,r)||ut(e):39==n||D&&70==n&&"c"==r?at(e,1,r)||ht(e):38==n||D&&80==n&&"c"==r?ft(e,-1,r)||ut(e):40==n||D&&78==n&&"c"==r?yt(e)||ft(e,1,r)||ht(e):r==(D?"m":"c")&&(66==n||73==n||89==n||90==n))}function vt(e,t){e.someProp("transformCopied",(n=>{t=n(t,e)}));let n=[],{content:r,openStart:i,openEnd:o}=t;while(i>1&&o>1&&1==r.childCount&&1==r.firstChild.childCount){i--,o--;let e=r.firstChild;n.push(e.type.name,e.attrs!=e.type.defaultAttrs?e.attrs:null),r=e.content}let a=e.someProp("clipboardSerializer")||s.PW.fromSchema(e.state.schema),c=xt(),l=c.createElement("div");l.appendChild(a.serializeFragment(r,{document:c}));let u,h=l.firstChild,d=0;while(h&&1==h.nodeType&&(u=Rt[h.nodeName.toLowerCase()])){for(let e=u.length-1;e>=0;e--){let t=c.createElement(u[e]);while(l.firstChild)t.appendChild(l.firstChild);l.appendChild(t),d++}h=l.firstChild}h&&1==h.nodeType&&h.setAttribute("data-pm-slice",`${i} ${o}${d?` -${d}`:""} ${JSON.stringify(n)}`);let p=e.someProp("clipboardTextSerializer",(n=>n(t,e)))||t.content.textBetween(0,t.content.size,"\n\n");return{dom:l,text:p}}function Et(e,t,n,r,i){let o,a,c=i.parent.type.spec.code;if(!n&&!t)return null;let l=t&&(r||c||!n);if(l){if(e.someProp("transformPastedText",(n=>{t=n(t,c||r,e)})),c)return t?new s.p2(s.HY.from(e.state.schema.text(t.replace(/\r\n?/g,"\n"))),0,0):s.p2.empty;let n=e.someProp("clipboardTextParser",(n=>n(t,i,r,e)));if(n)a=n;else{let n=i.marks(),{schema:r}=e.state,a=s.PW.fromSchema(r);o=document.createElement("div"),t.split(/(?:\r\n?|\n)+/).forEach((e=>{let t=o.appendChild(document.createElement("p"));e&&t.appendChild(a.serializeNode(r.text(e,n)))}))}}else e.someProp("transformPastedHTML",(t=>{n=t(n,e)})),o=Nt(n),L&&Dt(o);let u=o&&o.querySelector("[data-pm-slice]"),h=u&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(u.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let s=+h[3];s>0;s--){let e=o.firstChild;while(e&&1!=e.nodeType)e=e.nextSibling;if(!e)break;o=e}if(!a){let t=e.someProp("clipboardParser")||e.someProp("domParser")||s.aw.fromSchema(e.state.schema);a=t.parseSlice(o,{preserveWhitespace:!(!l&&!h),context:i,ruleFromNode(e){return"BR"!=e.nodeName||e.nextSibling||!e.parentNode||_t.test(e.parentNode.nodeName)?null:{ignore:!0}}})}if(h)a=Pt(It(a,+h[1],+h[2]),h[4]);else if(a=s.p2.maxOpen(St(a.content,i),!0),a.openStart||a.openEnd){let e=0,t=0;for(let n=a.content.firstChild;e<a.openStart&&!n.type.spec.isolating;e++,n=n.firstChild);for(let n=a.content.lastChild;t<a.openEnd&&!n.type.spec.isolating;t++,n=n.lastChild);a=It(a,e,t)}return e.someProp("transformPasted",(t=>{a=t(a,e)})),a}const _t=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function St(e,t){if(e.childCount<2)return e;for(let n=t.depth;n>=0;n--){let r,i=t.node(n),o=i.contentMatchAt(t.index(n)),a=[];if(e.forEach((e=>{if(!a)return;let t,n=o.findWrapping(e.type);if(!n)return a=null;if(t=a.length&&r.length&&At(n,r,e,a[a.length-1],0))a[a.length-1]=t;else{a.length&&(a[a.length-1]=Tt(a[a.length-1],r.length));let t=kt(e,n);a.push(t),o=o.matchType(t.type),r=n}})),a)return s.HY.from(a)}return e}function kt(e,t,n=0){for(let r=t.length-1;r>=n;r--)e=t[r].create(null,s.HY.from(e));return e}function At(e,t,n,r,i){if(i<e.length&&i<t.length&&e[i]==t[i]){let o=At(e,t,n,r.lastChild,i+1);if(o)return r.copy(r.content.replaceChild(r.childCount-1,o));let a=r.contentMatchAt(r.childCount);if(a.matchType(i==e.length-1?n.type:e[i+1]))return r.copy(r.content.append(s.HY.from(kt(n,e,i+1))))}}function Tt(e,t){if(0==t)return e;let n=e.content.replaceChild(e.childCount-1,Tt(e.lastChild,t-1)),r=e.contentMatchAt(e.childCount).fillBefore(s.HY.empty,!0);return e.copy(n.append(r))}function Ct(e,t,n,r,i,o){let a=t<0?e.firstChild:e.lastChild,c=a.content;return i<r-1&&(c=Ct(c,t,n,r,i+1,o)),i>=n&&(c=t<0?a.contentMatchAt(0).fillBefore(c,e.childCount>1||o<=i).append(c):c.append(a.contentMatchAt(a.childCount).fillBefore(s.HY.empty,!0))),e.replaceChild(t<0?0:e.childCount-1,a.copy(c))}function It(e,t,n){return t<e.openStart&&(e=new s.p2(Ct(e.content,-1,t,e.openStart,0,e.openEnd),t,e.openEnd)),n<e.openEnd&&(e=new s.p2(Ct(e.content,1,n,e.openEnd,0,0),e.openStart,n)),e}const Rt={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let Ot=null;function xt(){return Ot||(Ot=document.implementation.createHTMLDocument("title"))}function Nt(e){let t=/^(\s*<meta [^>]*>)*/.exec(e);t&&(e=e.slice(t[0].length));let n,r=xt().createElement("div"),s=/<([a-z][^>\s]+)/i.exec(e);if((n=s&&Rt[s[1].toLowerCase()])&&(e=n.map((e=>"<"+e+">")).join("")+e+n.map((e=>"</"+e+">")).reverse().join("")),r.innerHTML=e,n)for(let i=0;i<n.length;i++)r=r.querySelector(n[i])||r;return r}function Dt(e){let t=e.querySelectorAll(R?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<t.length;n++){let r=t[n];1==r.childNodes.length&&" "==r.textContent&&r.parentNode&&r.parentNode.replaceChild(e.ownerDocument.createTextNode(" "),r)}}function Pt(e,t){if(!e.size)return e;let n,r=e.content.firstChild.type.schema;try{n=JSON.parse(t)}catch(c){return e}let{content:i,openStart:o,openEnd:a}=e;for(let l=n.length-2;l>=0;l-=2){let e=r.nodes[n[l]];if(!e||e.hasRequiredAttrs())break;i=s.HY.from(e.create(n[l+1],i)),o++,a++}return new s.p2(i,o,a)}const Lt={},Mt={},Bt={touchstart:!0,touchmove:!0};class Ut{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function Vt(e){for(let t in Lt){let n=Lt[t];e.dom.addEventListener(t,e.input.eventHandlers[t]=t=>{!Ht(e,t)||$t(e,t)||!e.editable&&t.type in Mt||n(e,t)},Bt[t]?{passive:!0}:void 0)}x&&e.dom.addEventListener("input",(()=>null)),zt(e)}function Ft(e,t){e.input.lastSelectionOrigin=t,e.input.lastSelectionTime=Date.now()}function jt(e){e.domObserver.stop();for(let t in e.input.eventHandlers)e.dom.removeEventListener(t,e.input.eventHandlers[t]);clearTimeout(e.input.composingTimeout),clearTimeout(e.input.lastIOSEnterFallbackTimeout)}function zt(e){e.someProp("handleDOMEvents",(t=>{for(let n in t)e.input.eventHandlers[n]||e.dom.addEventListener(n,e.input.eventHandlers[n]=t=>$t(e,t))}))}function $t(e,t){return e.someProp("handleDOMEvents",(n=>{let r=n[t.type];return!!r&&(r(e,t)||t.defaultPrevented)}))}function Ht(e,t){if(!t.bubbles)return!0;if(t.defaultPrevented)return!1;for(let n=t.target;n!=e.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(t))return!1;return!0}function Kt(e,t){$t(e,t)||!Lt[t.type]||!e.editable&&t.type in Mt||Lt[t.type](e,t)}function qt(e){return{left:e.clientX,top:e.clientY}}function Gt(e,t){let n=t.x-e.clientX,r=t.y-e.clientY;return n*n+r*r<100}function Wt(e,t,n,r,s){if(-1==r)return!1;let i=e.state.doc.resolve(r);for(let o=i.depth+1;o>0;o--)if(e.someProp(t,(t=>o>i.depth?t(e,n,i.nodeAfter,i.before(o),s,!0):t(e,n,i.node(o),i.before(o),s,!1))))return!0;return!1}function Yt(e,t,n){e.focused||e.focus();let r=e.state.tr.setSelection(t);"pointer"==n&&r.setMeta("pointer",!0),e.dispatch(r)}function Jt(e,t){if(-1==t)return!1;let n=e.state.doc.resolve(t),s=n.nodeAfter;return!!(s&&s.isAtom&&r.qv.isSelectable(s))&&(Yt(e,new r.qv(n),"pointer"),!0)}function Qt(e,t){if(-1==t)return!1;let n,s,i=e.state.selection;i instanceof r.qv&&(n=i.node);let o=e.state.doc.resolve(t);for(let a=o.depth+1;a>0;a--){let e=a>o.depth?o.nodeAfter:o.node(a);if(r.qv.isSelectable(e)){s=n&&i.$from.depth>0&&a>=i.$from.depth&&o.before(i.$from.depth+1)==i.$from.pos?o.before(i.$from.depth):o.before(a);break}}return null!=s&&(Yt(e,r.qv.create(e.state.doc,s),"pointer"),!0)}function Xt(e,t,n,r,s){return Wt(e,"handleClickOn",t,n,r)||e.someProp("handleClick",(n=>n(e,t,r)))||(s?Qt(e,n):Jt(e,n))}function Zt(e,t,n,r){return Wt(e,"handleDoubleClickOn",t,n,r)||e.someProp("handleDoubleClick",(n=>n(e,t,r)))}function en(e,t,n,r){return Wt(e,"handleTripleClickOn",t,n,r)||e.someProp("handleTripleClick",(n=>n(e,t,r)))||tn(e,n,r)}function tn(e,t,n){if(0!=n.button)return!1;let s=e.state.doc;if(-1==t)return!!s.inlineContent&&(Yt(e,r.Bs.create(s,0,s.content.size),"pointer"),!0);let i=s.resolve(t);for(let o=i.depth+1;o>0;o--){let t=o>i.depth?i.nodeAfter:i.node(o),n=i.before(o);if(t.inlineContent)Yt(e,r.Bs.create(s,n+1,n+1+t.content.size),"pointer");else{if(!r.qv.isSelectable(t))continue;Yt(e,r.qv.create(s,n),"pointer")}return!0}}function nn(e){return hn(e)}Mt.keydown=(e,t)=>{let n=t;if(e.input.shiftKey=16==n.keyCode||n.shiftKey,!on(e,n)&&(e.input.lastKeyCode=n.keyCode,e.input.lastKeyCodeTime=Date.now(),!P||!R||13!=n.keyCode))if(229!=n.keyCode&&e.domObserver.forceFlush(),!N||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)e.someProp("handleKeyDown",(t=>t(e,n)))||bt(e,n)?n.preventDefault():Ft(e,"key");else{let t=Date.now();e.input.lastIOSEnter=t,e.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{e.input.lastIOSEnter==t&&(e.someProp("handleKeyDown",(t=>t(e,y(13,"Enter")))),e.input.lastIOSEnter=0)}),200)}},Mt.keyup=(e,t)=>{16==t.keyCode&&(e.input.shiftKey=!1)},Mt.keypress=(e,t)=>{let n=t;if(on(e,n)||!n.charCode||n.ctrlKey&&!n.altKey||D&&n.metaKey)return;if(e.someProp("handleKeyPress",(t=>t(e,n))))return void n.preventDefault();let s=e.state.selection;if(!(s instanceof r.Bs)||!s.$from.sameParent(s.$to)){let t=String.fromCharCode(n.charCode);/[\r\n]/.test(t)||e.someProp("handleTextInput",(n=>n(e,s.$from.pos,s.$to.pos,t)))||e.dispatch(e.state.tr.insertText(t).scrollIntoView()),n.preventDefault()}};const rn=D?"metaKey":"ctrlKey";Lt.mousedown=(e,t)=>{let n=t;e.input.shiftKey=n.shiftKey;let r=nn(e),s=Date.now(),i="singleClick";s-e.input.lastClick.time<500&&Gt(n,e.input.lastClick)&&!n[rn]&&("singleClick"==e.input.lastClick.type?i="doubleClick":"doubleClick"==e.input.lastClick.type&&(i="tripleClick")),e.input.lastClick={time:s,x:n.clientX,y:n.clientY,type:i};let o=e.posAtCoords(qt(n));o&&("singleClick"==i?(e.input.mouseDown&&e.input.mouseDown.done(),e.input.mouseDown=new sn(e,o,n,!!r)):("doubleClick"==i?Zt:en)(e,o.pos,o.inside,n)?n.preventDefault():Ft(e,"pointer"))};class sn{constructor(e,t,n,s){let i,o;if(this.view=e,this.pos=t,this.event=n,this.flushed=s,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=e.state.doc,this.selectNode=!!n[rn],this.allowDefault=n.shiftKey,t.inside>-1)i=e.state.doc.nodeAt(t.inside),o=t.inside;else{let n=e.state.doc.resolve(t.pos);i=n.parent,o=n.depth?n.before():0}const a=s?null:n.target,c=a?e.docView.nearestDesc(a,!0):null;this.target=c?c.dom:null;let{selection:l}=e.state;(0==n.button&&i.type.spec.draggable&&!1!==i.type.spec.selectable||l instanceof r.qv&&l.from<=o&&l.to>o)&&(this.mightDrag={node:i,pos:o,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!C||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),e.root.addEventListener("mouseup",this.up=this.up.bind(this)),e.root.addEventListener("mousemove",this.move=this.move.bind(this)),Ft(e,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>qe(this.view))),this.view.input.mouseDown=null}up(e){if(this.done(),!this.view.dom.contains(e.target))return;let t=this.pos;this.view.state.doc!=this.startDoc&&(t=this.view.posAtCoords(qt(e))),this.updateAllowDefault(e),this.allowDefault||!t?Ft(this.view,"pointer"):Xt(this.view,t.pos,t.inside,e,this.selectNode)?e.preventDefault():0==e.button&&(this.flushed||x&&this.mightDrag&&!this.mightDrag.node.isAtom||R&&!this.view.state.selection.visible&&Math.min(Math.abs(t.pos-this.view.state.selection.from),Math.abs(t.pos-this.view.state.selection.to))<=2)?(Yt(this.view,r.Y1.near(this.view.state.doc.resolve(t.pos)),"pointer"),e.preventDefault()):Ft(this.view,"pointer")}move(e){this.updateAllowDefault(e),Ft(this.view,"pointer"),0==e.buttons&&this.done()}updateAllowDefault(e){!this.allowDefault&&(Math.abs(this.event.x-e.clientX)>4||Math.abs(this.event.y-e.clientY)>4)&&(this.allowDefault=!0)}}function on(e,t){return!!e.composing||!!(x&&Math.abs(t.timeStamp-e.input.compositionEndedAt)<500)&&(e.input.compositionEndedAt=-2e8,!0)}Lt.touchstart=e=>{e.input.lastTouch=Date.now(),nn(e),Ft(e,"pointer")},Lt.touchmove=e=>{e.input.lastTouch=Date.now(),Ft(e,"pointer")},Lt.contextmenu=e=>nn(e);const an=P?5e3:-1;function cn(e,t){clearTimeout(e.input.composingTimeout),t>-1&&(e.input.composingTimeout=setTimeout((()=>hn(e)),t))}function ln(e){e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=un());while(e.input.compositionNodes.length>0)e.input.compositionNodes.pop().markParentsDirty()}function un(){let e=document.createEvent("Event");return e.initEvent("event",!0,!0),e.timeStamp}function hn(e,t=!1){if(!(P&&e.domObserver.flushingSoon>=0)){if(e.domObserver.forceFlush(),ln(e),t||e.docView&&e.docView.dirty){let t=He(e);return t&&!t.eq(e.state.selection)?e.dispatch(e.state.tr.setSelection(t)):e.updateState(e.state),!0}return!1}}function dn(e,t){if(!e.dom.parentNode)return;let n=e.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(t),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),s=document.createRange();s.selectNodeContents(t),e.dom.blur(),r.removeAllRanges(),r.addRange(s),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),e.focus()}),50)}Mt.compositionstart=Mt.compositionupdate=e=>{if(!e.composing){e.domObserver.flush();let{state:t}=e,n=t.selection.$from;if(t.selection.empty&&(t.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((e=>!1===e.type.spec.inclusive))))e.markCursor=e.state.storedMarks||n.marks(),hn(e,!0),e.markCursor=null;else if(hn(e),C&&t.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let t=e.domSelectionRange();for(let n=t.focusNode,r=t.focusOffset;n&&1==n.nodeType&&0!=r;){let t=r<0?n.lastChild:n.childNodes[r-1];if(!t)break;if(3==t.nodeType){e.domSelection().collapse(t,t.nodeValue.length);break}n=t,r=-1}}e.input.composing=!0}cn(e,an)},Mt.compositionend=(e,t)=>{e.composing&&(e.input.composing=!1,e.input.compositionEndedAt=t.timeStamp,cn(e,20))};const pn=A&&T<15||N&&M<604;function fn(e){return 0==e.openStart&&0==e.openEnd&&1==e.content.childCount?e.content.firstChild:null}function gn(e,t){if(!e.dom.parentNode)return;let n=e.input.shiftKey||e.state.selection.$from.parent.type.spec.code,r=e.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus(),setTimeout((()=>{e.focus(),r.parentNode&&r.parentNode.removeChild(r),n?mn(e,r.value,null,e.input.shiftKey,t):mn(e,r.textContent,r.innerHTML,e.input.shiftKey,t)}),50)}function mn(e,t,n,r,i){let o=Et(e,t,n,r,e.state.selection.$from);if(e.someProp("handlePaste",(t=>t(e,i,o||s.p2.empty))))return!0;if(!o)return!1;let a=fn(o),c=a?e.state.tr.replaceSelectionWith(a,e.input.shiftKey):e.state.tr.replaceSelection(o);return e.dispatch(c.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}Lt.copy=Mt.cut=(e,t)=>{let n=t,r=e.state.selection,s="cut"==n.type;if(r.empty)return;let i=pn?null:n.clipboardData,o=r.content(),{dom:a,text:c}=vt(e,o);i?(n.preventDefault(),i.clearData(),i.setData("text/html",a.innerHTML),i.setData("text/plain",c)):dn(e,a),s&&e.dispatch(e.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},Mt.paste=(e,t)=>{let n=t;if(e.composing&&!P)return;let r=pn?null:n.clipboardData;r&&mn(e,r.getData("text/plain"),r.getData("text/html"),e.input.shiftKey,n)?n.preventDefault():gn(e,n)};class yn{constructor(e,t){this.slice=e,this.move=t}}const wn=D?"altKey":"ctrlKey";Lt.dragstart=(e,t)=>{let n=t,s=e.input.mouseDown;if(s&&s.done(),!n.dataTransfer)return;let i=e.state.selection,o=i.empty?null:e.posAtCoords(qt(n));if(o&&o.pos>=i.from&&o.pos<=(i instanceof r.qv?i.to-1:i.to));else if(s&&s.mightDrag)e.dispatch(e.state.tr.setSelection(r.qv.create(e.state.doc,s.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let t=e.docView.nearestDesc(n.target,!0);t&&t.node.type.spec.draggable&&t!=e.docView&&e.dispatch(e.state.tr.setSelection(r.qv.create(e.state.doc,t.posBefore)))}let a=e.state.selection.content(),{dom:c,text:l}=vt(e,a);n.dataTransfer.clearData(),n.dataTransfer.setData(pn?"Text":"text/html",c.innerHTML),n.dataTransfer.effectAllowed="copyMove",pn||n.dataTransfer.setData("text/plain",l),e.dragging=new yn(a,!n[wn])},Lt.dragend=e=>{let t=e.dragging;window.setTimeout((()=>{e.dragging==t&&(e.dragging=null)}),50)},Mt.dragover=Mt.dragenter=(e,t)=>t.preventDefault(),Mt.drop=(e,t)=>{let n=t,o=e.dragging;if(e.dragging=null,!n.dataTransfer)return;let a=e.posAtCoords(qt(n));if(!a)return;let c=e.state.doc.resolve(a.pos),l=o&&o.slice;l?e.someProp("transformPasted",(t=>{l=t(l,e)})):l=Et(e,n.dataTransfer.getData(pn?"Text":"text/plain"),pn?null:n.dataTransfer.getData("text/html"),!1,c);let u=!(!o||n[wn]);if(e.someProp("handleDrop",(t=>t(e,n,l||s.p2.empty,u))))return void n.preventDefault();if(!l)return;n.preventDefault();let h=l?(0,i.nj)(e.state.doc,c.pos,l):c.pos;null==h&&(h=c.pos);let d=e.state.tr;u&&d.deleteSelection();let p=d.mapping.map(h),f=0==l.openStart&&0==l.openEnd&&1==l.content.childCount,g=d.doc;if(f?d.replaceRangeWith(p,p,l.content.firstChild):d.replaceRange(p,p,l),d.doc.eq(g))return;let m=d.doc.resolve(p);if(f&&r.qv.isSelectable(l.content.firstChild)&&m.nodeAfter&&m.nodeAfter.sameMarkup(l.content.firstChild))d.setSelection(new r.qv(m));else{let t=d.mapping.map(h);d.mapping.maps[d.mapping.maps.length-1].forEach(((e,n,r,s)=>t=s)),d.setSelection(tt(e,m,d.doc.resolve(t)))}e.focus(),e.dispatch(d.setMeta("uiEvent","drop"))},Lt.focus=e=>{e.input.lastFocus=Date.now(),e.focused||(e.domObserver.stop(),e.dom.classList.add("ProseMirror-focused"),e.domObserver.start(),e.focused=!0,setTimeout((()=>{e.docView&&e.hasFocus()&&!e.domObserver.currentSelection.eq(e.domSelectionRange())&&qe(e)}),20))},Lt.blur=(e,t)=>{let n=t;e.focused&&(e.domObserver.stop(),e.dom.classList.remove("ProseMirror-focused"),e.domObserver.start(),n.relatedTarget&&e.dom.contains(n.relatedTarget)&&e.domObserver.currentSelection.clear(),e.focused=!1)},Lt.beforeinput=(e,t)=>{let n=t;if(R&&P&&"deleteContentBackward"==n.inputType){e.domObserver.flushSoon();let{domChangeCount:t}=e.input;setTimeout((()=>{if(e.input.domChangeCount!=t)return;if(e.dom.blur(),e.focus(),e.someProp("handleKeyDown",(t=>t(e,y(8,"Backspace")))))return;let{$cursor:n}=e.state.selection;n&&n.pos>0&&e.dispatch(e.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let ur in Mt)Lt[ur]=Mt[ur];function bn(e,t){if(e==t)return!0;for(let n in e)if(e[n]!==t[n])return!1;for(let n in t)if(!(n in e))return!1;return!0}class vn{constructor(e,t){this.toDOM=e,this.spec=t||An,this.side=this.spec.side||0}map(e,t,n,r){let{pos:s,deleted:i}=e.mapResult(t.from+r,this.side<0?-1:1);return i?null:new Sn(s-n,s-n,this)}valid(){return!0}eq(e){return this==e||e instanceof vn&&(this.spec.key&&this.spec.key==e.spec.key||this.toDOM==e.toDOM&&bn(this.spec,e.spec))}destroy(e){this.spec.destroy&&this.spec.destroy(e)}}class En{constructor(e,t){this.attrs=e,this.spec=t||An}map(e,t,n,r){let s=e.map(t.from+r,this.spec.inclusiveStart?-1:1)-n,i=e.map(t.to+r,this.spec.inclusiveEnd?1:-1)-n;return s>=i?null:new Sn(s,i,this)}valid(e,t){return t.from<t.to}eq(e){return this==e||e instanceof En&&bn(this.attrs,e.attrs)&&bn(this.spec,e.spec)}static is(e){return e.type instanceof En}destroy(){}}class _n{constructor(e,t){this.attrs=e,this.spec=t||An}map(e,t,n,r){let s=e.mapResult(t.from+r,1);if(s.deleted)return null;let i=e.mapResult(t.to+r,-1);return i.deleted||i.pos<=s.pos?null:new Sn(s.pos-n,i.pos-n,this)}valid(e,t){let n,{index:r,offset:s}=e.content.findIndex(t.from);return s==t.from&&!(n=e.child(r)).isText&&s+n.nodeSize==t.to}eq(e){return this==e||e instanceof _n&&bn(this.attrs,e.attrs)&&bn(this.spec,e.spec)}destroy(){}}class Sn{constructor(e,t,n){this.from=e,this.to=t,this.type=n}copy(e,t){return new Sn(e,t,this.type)}eq(e,t=0){return this.type.eq(e.type)&&this.from+t==e.from&&this.to+t==e.to}map(e,t,n){return this.type.map(e,this,t,n)}static widget(e,t,n){return new Sn(e,e,new vn(t,n))}static inline(e,t,n,r){return new Sn(e,t,new En(n,r))}static node(e,t,n,r){return new Sn(e,t,new _n(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof En}}const kn=[],An={};class Tn{constructor(e,t){this.local=e.length?e:kn,this.children=t.length?t:kn}static create(e,t){return t.length?Pn(t,e,0,An):Cn}find(e,t,n){let r=[];return this.findInner(null==e?0:e,null==t?1e9:t,r,0,n),r}findInner(e,t,n,r,s){for(let i=0;i<this.local.length;i++){let o=this.local[i];o.from<=t&&o.to>=e&&(!s||s(o.spec))&&n.push(o.copy(o.from+r,o.to+r))}for(let i=0;i<this.children.length;i+=3)if(this.children[i]<t&&this.children[i+1]>e){let o=this.children[i]+1;this.children[i+2].findInner(e-o,t-o,n,r+o,s)}}map(e,t,n){return this==Cn||0==e.maps.length?this:this.mapInner(e,t,0,0,n||An)}mapInner(e,t,n,r,s){let i;for(let o=0;o<this.local.length;o++){let a=this.local[o].map(e,n,r);a&&a.type.valid(t,a)?(i||(i=[])).push(a):s.onRemove&&s.onRemove(this.local[o].spec)}return this.children.length?Rn(this.children,i||[],e,t,n,r,s):i?new Tn(i.sort(Ln),kn):Cn}add(e,t){return t.length?this==Cn?Tn.create(e,t):this.addInner(e,t,0):this}addInner(e,t,n){let r,s=0;e.forEach(((e,i)=>{let o,a=i+n;if(o=Nn(t,e,a)){r||(r=this.children.slice());while(s<r.length&&r[s]<i)s+=3;r[s]==i?r[s+2]=r[s+2].addInner(e,o,a+1):r.splice(s,0,i,i+e.nodeSize,Pn(o,e,a+1,An)),s+=3}}));let i=On(s?Dn(t):t,-n);for(let o=0;o<i.length;o++)i[o].type.valid(e,i[o])||i.splice(o--,1);return new Tn(i.length?this.local.concat(i).sort(Ln):this.local,r||this.children)}remove(e){return 0==e.length||this==Cn?this:this.removeInner(e,0)}removeInner(e,t){let n=this.children,r=this.local;for(let s=0;s<n.length;s+=3){let r,i=n[s]+t,o=n[s+1]+t;for(let t,n=0;n<e.length;n++)(t=e[n])&&t.from>i&&t.to<o&&(e[n]=null,(r||(r=[])).push(t));if(!r)continue;n==this.children&&(n=this.children.slice());let a=n[s+2].removeInner(r,i+1);a!=Cn?n[s+2]=a:(n.splice(s,3),s-=3)}if(r.length)for(let s,i=0;i<e.length;i++)if(s=e[i])for(let e=0;e<r.length;e++)r[e].eq(s,t)&&(r==this.local&&(r=this.local.slice()),r.splice(e--,1));return n==this.children&&r==this.local?this:r.length||n.length?new Tn(r,n):Cn}forChild(e,t){if(this==Cn)return this;if(t.isLeaf)return Tn.empty;let n,r;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=e){this.children[o]==e&&(n=this.children[o+2]);break}let s=e+1,i=s+t.content.size;for(let o=0;o<this.local.length;o++){let e=this.local[o];if(e.from<i&&e.to>s&&e.type instanceof En){let t=Math.max(s,e.from)-s,n=Math.min(i,e.to)-s;t<n&&(r||(r=[])).push(e.copy(t,n))}}if(r){let e=new Tn(r.sort(Ln),kn);return n?new In([e,n]):e}return n||Cn}eq(e){if(this==e)return!0;if(!(e instanceof Tn)||this.local.length!=e.local.length||this.children.length!=e.children.length)return!1;for(let t=0;t<this.local.length;t++)if(!this.local[t].eq(e.local[t]))return!1;for(let t=0;t<this.children.length;t+=3)if(this.children[t]!=e.children[t]||this.children[t+1]!=e.children[t+1]||!this.children[t+2].eq(e.children[t+2]))return!1;return!0}locals(e){return Mn(this.localsInner(e))}localsInner(e){if(this==Cn)return kn;if(e.inlineContent||!this.local.some(En.is))return this.local;let t=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof En||t.push(this.local[n]);return t}}Tn.empty=new Tn([],[]),Tn.removeOverlap=Mn;const Cn=Tn.empty;class In{constructor(e){this.members=e}map(e,t){const n=this.members.map((n=>n.map(e,t,An)));return In.from(n)}forChild(e,t){if(t.isLeaf)return Tn.empty;let n=[];for(let r=0;r<this.members.length;r++){let s=this.members[r].forChild(e,t);s!=Cn&&(s instanceof In?n=n.concat(s.members):n.push(s))}return In.from(n)}eq(e){if(!(e instanceof In)||e.members.length!=this.members.length)return!1;for(let t=0;t<this.members.length;t++)if(!this.members[t].eq(e.members[t]))return!1;return!0}locals(e){let t,n=!0;for(let r=0;r<this.members.length;r++){let s=this.members[r].localsInner(e);if(s.length)if(t){n&&(t=t.slice(),n=!1);for(let e=0;e<s.length;e++)t.push(s[e])}else t=s}return t?Mn(n?t:t.sort(Ln)):kn}static from(e){switch(e.length){case 0:return Cn;case 1:return e[0];default:return new In(e.every((e=>e instanceof Tn))?e:e.reduce(((e,t)=>e.concat(t instanceof Tn?t:t.members)),[]))}}}function Rn(e,t,n,r,s,i,o){let a=e.slice();for(let l=0,u=i;l<n.maps.length;l++){let e=0;n.maps[l].forEach(((t,n,r,i)=>{let o=i-r-(n-t);for(let c=0;c<a.length;c+=3){let i=a[c+1];if(i<0||t>i+u-e)continue;let l=a[c]+u-e;n>=l?a[c+1]=t<=l?-2:-1:r>=s&&o&&(a[c]+=o,a[c+1]+=o)}e+=o})),u=n.maps[l].map(u,-1)}let c=!1;for(let l=0;l<a.length;l+=3)if(a[l+1]<0){if(-2==a[l+1]){c=!0,a[l+1]=-1;continue}let t=n.map(e[l]+i),u=t-s;if(u<0||u>=r.content.size){c=!0;continue}let h=n.map(e[l+1]+i,-1),d=h-s,{index:p,offset:f}=r.content.findIndex(u),g=r.maybeChild(p);if(g&&f==u&&f+g.nodeSize==d){let r=a[l+2].mapInner(n,g,t+1,e[l]+i+1,o);r!=Cn?(a[l]=u,a[l+1]=d,a[l+2]=r):(a[l+1]=-2,c=!0)}else c=!0}if(c){let c=xn(a,e,t,n,s,i,o),l=Pn(c,r,0,o);t=l.local;for(let e=0;e<a.length;e+=3)a[e+1]<0&&(a.splice(e,3),e-=3);for(let e=0,t=0;e<l.children.length;e+=3){let n=l.children[e];while(t<a.length&&a[t]<n)t+=3;a.splice(t,0,l.children[e],l.children[e+1],l.children[e+2])}}return new Tn(t.sort(Ln),a)}function On(e,t){if(!t||!e.length)return e;let n=[];for(let r=0;r<e.length;r++){let s=e[r];n.push(new Sn(s.from+t,s.to+t,s.type))}return n}function xn(e,t,n,r,s,i,o){function a(e,t){for(let i=0;i<e.local.length;i++){let a=e.local[i].map(r,s,t);a?n.push(a):o.onRemove&&o.onRemove(e.local[i].spec)}for(let n=0;n<e.children.length;n+=3)a(e.children[n+2],e.children[n]+t+1)}for(let c=0;c<e.length;c+=3)-1==e[c+1]&&a(e[c+2],t[c]+i+1);return n}function Nn(e,t,n){if(t.isLeaf)return null;let r=n+t.nodeSize,s=null;for(let i,o=0;o<e.length;o++)(i=e[o])&&i.from>n&&i.to<r&&((s||(s=[])).push(i),e[o]=null);return s}function Dn(e){let t=[];for(let n=0;n<e.length;n++)null!=e[n]&&t.push(e[n]);return t}function Pn(e,t,n,r){let s=[],i=!1;t.forEach(((t,o)=>{let a=Nn(e,t,o+n);if(a){i=!0;let e=Pn(a,t,n+o+1,r);e!=Cn&&s.push(o,o+t.nodeSize,e)}}));let o=On(i?Dn(e):e,-n).sort(Ln);for(let a=0;a<o.length;a++)o[a].type.valid(t,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||s.length?new Tn(o,s):Cn}function Ln(e,t){return e.from-t.from||e.to-t.to}function Mn(e){let t=e;for(let n=0;n<t.length-1;n++){let r=t[n];if(r.from!=r.to)for(let s=n+1;s<t.length;s++){let i=t[s];if(i.from!=r.from){i.from<r.to&&(t==e&&(t=e.slice()),t[n]=r.copy(r.from,i.from),Bn(t,s,r.copy(i.from,r.to)));break}i.to!=r.to&&(t==e&&(t=e.slice()),t[s]=i.copy(i.from,r.to),Bn(t,s+1,i.copy(r.to,i.to)))}}return t}function Bn(e,t,n){while(t<e.length&&Ln(n,e[t])>0)t++;e.splice(t,0,n)}function Un(e){let t=[];return e.someProp("decorations",(n=>{let r=n(e.state);r&&r!=Cn&&t.push(r)})),e.cursorWrapper&&t.push(Tn.create(e.state.doc,[e.cursorWrapper.deco])),In.from(t)}const Vn={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},Fn=A&&T<=11;class jn{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(e){this.anchorNode=e.anchorNode,this.anchorOffset=e.anchorOffset,this.focusNode=e.focusNode,this.focusOffset=e.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(e){return e.anchorNode==this.anchorNode&&e.anchorOffset==this.anchorOffset&&e.focusNode==this.focusNode&&e.focusOffset==this.focusOffset}}class zn{constructor(e,t){this.view=e,this.handleDOMChange=t,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new jn,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((e=>{for(let t=0;t<e.length;t++)this.queue.push(e[t]);A&&T<=11&&e.some((e=>"childList"==e.type&&e.removedNodes.length||"characterData"==e.type&&e.oldValue.length>e.target.nodeValue.length))?this.flushSoon():this.flush()})),Fn&&(this.onCharData=e=>{this.queue.push({target:e.target,type:"characterData",oldValue:e.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,Vn)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let e=this.observer.takeRecords();if(e.length){for(let t=0;t<e.length;t++)this.queue.push(e[t]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(nt(this.view)){if(this.suppressingSelectionUpdates)return qe(this.view);if(A&&T<=11&&!this.view.state.selection.empty){let e=this.view.domSelectionRange();if(e.focusNode&&u(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(e){if(!e.focusNode)return!0;let t,n=new Set;for(let s=e.focusNode;s;s=a(s))n.add(s);for(let s=e.anchorNode;s;s=a(s))if(n.has(s)){t=s;break}let r=t&&this.view.docView.nearestDesc(t);return r&&r.ignoreMutation({type:"selection",target:3==t.nodeType?t.parentNode:t})?(this.setCurSelection(),!0):void 0}flush(){let{view:e}=this;if(!e.docView||this.flushingSoon>-1)return;let t=this.observer?this.observer.takeRecords():[];this.queue.length&&(t=this.queue.concat(t),this.queue.length=0);let n=e.domSelectionRange(),s=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&nt(e)&&!this.ignoreSelectionChange(n),i=-1,o=-1,a=!1,c=[];if(e.editable)for(let r=0;r<t.length;r++){let e=this.registerMutation(t[r],c);e&&(i=i<0?e.from:Math.min(e.from,i),o=o<0?e.to:Math.max(e.to,o),e.typeOver&&(a=!0))}if(C&&c.length>1){let e=c.filter((e=>"BR"==e.nodeName));if(2==e.length){let t=e[0],n=e[1];t.parentNode&&t.parentNode.parentNode==n.parentNode?n.remove():t.remove()}}let l=null;i<0&&s&&e.input.lastFocus>Date.now()-200&&Math.max(e.input.lastTouch,e.input.lastClick.time)<Date.now()-300&&m(n)&&(l=He(e))&&l.eq(r.Y1.near(e.state.doc.resolve(0),1))?(e.input.lastFocus=0,qe(e),this.currentSelection.set(n),e.scrollToSelection()):(i>-1||s)&&(i>-1&&(e.docView.markDirty(i,o),Kn(e)),this.handleDOMChange(i,o,a,c),e.docView&&e.docView.dirty?e.updateState(e.state):this.currentSelection.eq(n)||qe(e),this.currentSelection.set(n))}registerMutation(e,t){if(t.indexOf(e.target)>-1)return null;let n=this.view.docView.nearestDesc(e.target);if("attributes"==e.type&&(n==this.view.docView||"contenteditable"==e.attributeName||"style"==e.attributeName&&!e.oldValue&&!e.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(e))return null;if("childList"==e.type){for(let n=0;n<e.addedNodes.length;n++)t.push(e.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(e.target))return{from:n.posBefore,to:n.posAfter};let r=e.previousSibling,s=e.nextSibling;if(A&&T<=11&&e.addedNodes.length)for(let t=0;t<e.addedNodes.length;t++){let{previousSibling:n,nextSibling:i}=e.addedNodes[t];(!n||Array.prototype.indexOf.call(e.addedNodes,n)<0)&&(r=n),(!i||Array.prototype.indexOf.call(e.addedNodes,i)<0)&&(s=i)}let i=r&&r.parentNode==e.target?o(r)+1:0,a=n.localPosFromDOM(e.target,i,-1),c=s&&s.parentNode==e.target?o(s):e.target.childNodes.length,l=n.localPosFromDOM(e.target,c,1);return{from:a,to:l}}return"attributes"==e.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:e.target.nodeValue==e.oldValue}}}let $n=new WeakMap,Hn=!1;function Kn(e){if(!$n.has(e)&&($n.set(e,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(e.dom).whiteSpace))){if(e.requiresGeckoHackNode=C,Hn)return;console["warn"]("ProseMirror expects the CSS white-space property to be set, preferably to 'pre-wrap'. It is recommended to load style/prosemirror.css from the prosemirror-view package."),Hn=!0}}function qn(e){let t;function n(e){e.preventDefault(),e.stopImmediatePropagation(),t=e.getTargetRanges()[0]}e.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),e.dom.removeEventListener("beforeinput",n,!0);let r=t.startContainer,s=t.startOffset,i=t.endContainer,o=t.endOffset,a=e.domAtPos(e.state.selection.anchor);return u(a.node,a.offset,i,o)&&([r,s,i,o]=[i,o,r,s]),{anchorNode:r,anchorOffset:s,focusNode:i,focusOffset:o}}function Gn(e,t,n){let r,{node:i,fromOffset:o,toOffset:a,from:c,to:l}=e.docView.parseRange(t,n),u=e.domSelectionRange(),h=u.anchorNode;if(h&&e.dom.contains(1==h.nodeType?h:h.parentNode)&&(r=[{node:h,offset:u.anchorOffset}],m(u)||r.push({node:u.focusNode,offset:u.focusOffset})),R&&8===e.input.lastKeyCode)for(let s=a;s>o;s--){let e=i.childNodes[s-1],t=e.pmViewDesc;if("BR"==e.nodeName&&!t){a=s;break}if(!t||t.size)break}let d=e.state.doc,p=e.someProp("domParser")||s.aw.fromSchema(e.state.schema),f=d.resolve(c),g=null,y=p.parse(i,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:o,to:a,preserveWhitespace:"pre"!=f.parent.type.whitespace||"full",findPositions:r,ruleFromNode:Wn,context:f});if(r&&null!=r[0].pos){let e=r[0].pos,t=r[1]&&r[1].pos;null==t&&(t=e),g={anchor:e+c,head:t+c}}return{doc:y,sel:g,from:c,to:l}}function Wn(e){let t=e.pmViewDesc;if(t)return t.parseRule();if("BR"==e.nodeName&&e.parentNode){if(x&&/^(ul|ol)$/i.test(e.parentNode.nodeName)){let e=document.createElement("div");return e.appendChild(document.createElement("li")),{skip:e}}if(e.parentNode.lastChild==e||x&&/^(tr|table)$/i.test(e.parentNode.nodeName))return{ignore:!0}}else if("IMG"==e.nodeName&&e.getAttribute("mark-placeholder"))return{ignore:!0};return null}const Yn=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function Jn(e,t,n,s,i){if(t<0){let t=e.input.lastSelectionTime>Date.now()-50?e.input.lastSelectionOrigin:null,n=He(e,t);if(n&&!e.state.selection.eq(n)){if(R&&P&&13===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime&&e.someProp("handleKeyDown",(t=>t(e,y(13,"Enter")))))return;let r=e.state.tr.setSelection(n);"pointer"==t?r.setMeta("pointer",!0):"key"==t&&r.scrollIntoView(),e.dispatch(r)}return}let o=e.state.doc.resolve(t),a=o.sharedDepth(n);t=o.before(a+1),n=e.state.doc.resolve(n).after(a+1);let c,l,u=e.state.selection,h=Gn(e,t,n),d=e.state.doc,p=d.slice(h.from,h.to);8===e.input.lastKeyCode&&Date.now()-100<e.input.lastKeyCodeTime?(c=e.state.selection.to,l="end"):(c=e.state.selection.from,l="start"),e.input.lastKeyCode=null;let f=tr(p.content,h.doc.content,h.from,c,l);if((N&&e.input.lastIOSEnter>Date.now()-225||P)&&i.some((e=>1==e.nodeType&&!Yn.test(e.nodeName)))&&(!f||f.endA>=f.endB)&&e.someProp("handleKeyDown",(t=>t(e,y(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(!f){if(!(s&&u instanceof r.Bs&&!u.empty&&u.$head.sameParent(u.$anchor))||e.composing||h.sel&&h.sel.anchor!=h.sel.head){if(h.sel){let t=Qn(e,e.state.doc,h.sel);t&&!t.eq(e.state.selection)&&e.dispatch(e.state.tr.setSelection(t))}return}f={start:u.from,endA:u.to,endB:u.to}}if(R&&e.cursorWrapper&&h.sel&&h.sel.anchor==e.cursorWrapper.deco.from&&h.sel.head==h.sel.anchor){let e=f.endB-f.start;h.sel={anchor:h.sel.anchor+e,head:h.sel.anchor+e}}e.input.domChangeCount++,e.state.selection.from<e.state.selection.to&&f.start==f.endB&&e.state.selection instanceof r.Bs&&(f.start>e.state.selection.from&&f.start<=e.state.selection.from+2&&e.state.selection.from>=h.from?f.start=e.state.selection.from:f.endA<e.state.selection.to&&f.endA>=e.state.selection.to-2&&e.state.selection.to<=h.to&&(f.endB+=e.state.selection.to-f.endA,f.endA=e.state.selection.to)),A&&T<=11&&f.endB==f.start+1&&f.endA==f.start&&f.start>h.from&&"  "==h.doc.textBetween(f.start-h.from-1,f.start-h.from+1)&&(f.start--,f.endA--,f.endB--);let g,m=h.doc.resolveNoCache(f.start-h.from),w=h.doc.resolveNoCache(f.endB-h.from),b=d.resolve(f.start),v=m.sameParent(w)&&m.parent.inlineContent&&b.end()>=f.endA;if((N&&e.input.lastIOSEnter>Date.now()-225&&(!v||i.some((e=>"DIV"==e.nodeName||"P"==e.nodeName)))||!v&&m.pos<h.doc.content.size&&(g=r.Y1.findFrom(h.doc.resolve(m.pos+1),1,!0))&&g.head==w.pos)&&e.someProp("handleKeyDown",(t=>t(e,y(13,"Enter")))))return void(e.input.lastIOSEnter=0);if(e.state.selection.anchor>f.start&&Zn(d,f.start,f.endA,m,w)&&e.someProp("handleKeyDown",(t=>t(e,y(8,"Backspace")))))return void(P&&R&&e.domObserver.suppressSelectionUpdates());R&&P&&f.endB==f.start&&(e.input.lastAndroidDelete=Date.now()),P&&!v&&m.start()!=w.start()&&0==w.parentOffset&&m.depth==w.depth&&h.sel&&h.sel.anchor==h.sel.head&&h.sel.head==f.endA&&(f.endB-=2,w=h.doc.resolveNoCache(f.endB-h.from),setTimeout((()=>{e.someProp("handleKeyDown",(function(t){return t(e,y(13,"Enter"))}))}),20));let E,_,S,k=f.start,C=f.endA;if(v)if(m.pos==w.pos)A&&T<=11&&0==m.parentOffset&&(e.domObserver.suppressSelectionUpdates(),setTimeout((()=>qe(e)),20)),E=e.state.tr.delete(k,C),_=d.resolve(f.start).marksAcross(d.resolve(f.endA));else if(f.endA==f.endB&&(S=Xn(m.parent.content.cut(m.parentOffset,w.parentOffset),b.parent.content.cut(b.parentOffset,f.endA-b.start()))))E=e.state.tr,"add"==S.type?E.addMark(k,C,S.mark):E.removeMark(k,C,S.mark);else if(m.parent.child(m.index()).isText&&m.index()==w.index()-(w.textOffset?0:1)){let t=m.parent.textBetween(m.parentOffset,w.parentOffset);if(e.someProp("handleTextInput",(n=>n(e,k,C,t))))return;E=e.state.tr.insertText(t,k,C)}if(E||(E=e.state.tr.replace(k,C,h.doc.slice(f.start-h.from,f.endB-h.from))),h.sel){let t=Qn(e,E.doc,h.sel);t&&!(R&&P&&e.composing&&t.empty&&(f.start!=f.endB||e.input.lastAndroidDelete<Date.now()-100)&&(t.head==k||t.head==E.mapping.map(C)-1)||A&&t.empty&&t.head==k)&&E.setSelection(t)}_&&E.ensureMarks(_),e.dispatch(E.scrollIntoView())}function Qn(e,t,n){return Math.max(n.anchor,n.head)>t.content.size?null:tt(e,t.resolve(n.anchor),t.resolve(n.head))}function Xn(e,t){let n,r,i,o=e.firstChild.marks,a=t.firstChild.marks,c=o,l=a;for(let s=0;s<a.length;s++)c=a[s].removeFromSet(c);for(let s=0;s<o.length;s++)l=o[s].removeFromSet(l);if(1==c.length&&0==l.length)r=c[0],n="add",i=e=>e.mark(r.addToSet(e.marks));else{if(0!=c.length||1!=l.length)return null;r=l[0],n="remove",i=e=>e.mark(r.removeFromSet(e.marks))}let u=[];for(let s=0;s<t.childCount;s++)u.push(i(t.child(s)));if(s.HY.from(u).eq(e))return{mark:r,type:n}}function Zn(e,t,n,r,s){if(!r.parent.isTextblock||n-t<=s.pos-r.pos||er(r,!0,!1)<s.pos)return!1;let i=e.resolve(t);if(i.parentOffset<i.parent.content.size||!i.parent.isTextblock)return!1;let o=e.resolve(er(i,!0,!0));return!(!o.parent.isTextblock||o.pos>n||er(o,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(o.parent.content)}function er(e,t,n){let r=e.depth,s=t?e.end():e.pos;while(r>0&&(t||e.indexAfter(r)==e.node(r).childCount))r--,s++,t=!1;if(n){let t=e.node(r).maybeChild(e.indexAfter(r));while(t&&!t.isLeaf)t=t.firstChild,s++}return s}function tr(e,t,n,r,s){let i=e.findDiffStart(t,n);if(null==i)return null;let{a:o,b:a}=e.findDiffEnd(t,n+e.size,n+t.size);if("end"==s){let e=Math.max(0,i-Math.min(o,a));r-=o+e-i}if(o<i&&e.size<t.size){let e=r<=i&&r>=o?i-r:0;i-=e,a=i+(a-o),o=i}else if(a<i){let e=r<=i&&r>=a?i-r:0;i-=e,o=i+(o-a),a=i}return{start:i,endA:o,endB:a}}class nr{constructor(e,t){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new Ut,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=t,this.state=t.state,this.directPlugins=t.plugins||[],this.directPlugins.forEach(lr),this.dispatch=this.dispatch.bind(this),this.dom=e&&e.mount||document.createElement("div"),e&&(e.appendChild?e.appendChild(this.dom):"function"==typeof e?e(this.dom):e.mount&&(this.mounted=!0)),this.editable=ir(this),sr(this),this.nodeViews=ar(this),this.docView=Se(this.state.doc,rr(this),Un(this),this.dom,this),this.domObserver=new zn(this,((e,t,n,r)=>Jn(this,e,t,n,r))),this.domObserver.start(),Vt(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let e=this._props;this._props={};for(let t in e)this._props[t]=e[t];this._props.state=this.state}return this._props}update(e){e.handleDOMEvents!=this._props.handleDOMEvents&&zt(this);let t=this._props;this._props=e,e.plugins&&(e.plugins.forEach(lr),this.directPlugins=e.plugins),this.updateStateInner(e.state,t)}setProps(e){let t={};for(let n in this._props)t[n]=this._props[n];t.state=this.state;for(let n in e)t[n]=e[n];this.update(t)}updateState(e){this.updateStateInner(e,this._props)}updateStateInner(e,t){let n=this.state,r=!1,s=!1;e.storedMarks&&this.composing&&(ln(this),s=!0),this.state=e;let i=n.plugins!=e.plugins||this._props.plugins!=t.plugins;if(i||this._props.plugins!=t.plugins||this._props.nodeViews!=t.nodeViews){let e=ar(this);cr(e,this.nodeViews)&&(this.nodeViews=e,r=!0)}(i||t.handleDOMEvents!=this._props.handleDOMEvents)&&zt(this),this.editable=ir(this),sr(this);let o=Un(this),a=rr(this),c=n.plugins==e.plugins||n.doc.eq(e.doc)?e.scrollToSelection>n.scrollToSelection?"to selection":"preserve":"reset",l=r||!this.docView.matchesNode(e.doc,a,o);!l&&e.selection.eq(n.selection)||(s=!0);let u="preserve"==c&&s&&null==this.dom.style.overflowAnchor&&j(this);if(s){this.domObserver.stop();let t=l&&(A||R)&&!this.composing&&!n.selection.empty&&!e.selection.empty&&or(n.selection,e.selection);if(l){let n=R?this.trackWrites=this.domSelectionRange().focusNode:null;!r&&this.docView.update(e.doc,a,o,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=Se(e.doc,a,o,this.dom,this)),n&&!this.trackWrites&&(t=!0)}t||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&st(this))?qe(this,t):(Ze(this,e.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),"reset"==c?this.dom.scrollTop=0:"to selection"==c?this.scrollToSelection():u&&$(u)}scrollToSelection(){let e=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(e=>e(this))));else if(this.state.selection instanceof r.qv){let t=this.docView.domAfterPos(this.state.selection.from);1==t.nodeType&&F(this,t.getBoundingClientRect(),e)}else F(this,this.coordsAtPos(this.state.selection.head,1),e)}destroyPluginViews(){let e;while(e=this.pluginViews.pop())e.destroy&&e.destroy()}updatePluginViews(e){if(e&&e.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let t=0;t<this.pluginViews.length;t++){let n=this.pluginViews[t];n.update&&n.update(this,e)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let e=0;e<this.directPlugins.length;e++){let t=this.directPlugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}for(let e=0;e<this.state.plugins.length;e++){let t=this.state.plugins[e];t.spec.view&&this.pluginViews.push(t.spec.view(this))}}}someProp(e,t){let n,r=this._props&&this._props[e];if(null!=r&&(n=t?t(r):r))return n;for(let i=0;i<this.directPlugins.length;i++){let r=this.directPlugins[i].props[e];if(null!=r&&(n=t?t(r):r))return n}let s=this.state.plugins;if(s)for(let i=0;i<s.length;i++){let r=s[i].props[e];if(null!=r&&(n=t?t(r):r))return n}}hasFocus(){if(A){let e=this.root.activeElement;if(e==this.dom)return!0;if(!e||!this.dom.contains(e))return!1;while(e&&this.dom!=e&&this.dom.contains(e)){if("false"==e.contentEditable)return!1;e=e.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&q(this.dom),qe(this),this.domObserver.start()}get root(){let e=this._root;if(null==e)for(let t=this.dom.parentNode;t;t=t.parentNode)if(9==t.nodeType||11==t.nodeType&&t.host)return t.getSelection||(Object.getPrototypeOf(t).getSelection=()=>t.ownerDocument.getSelection()),this._root=t;return e||document}posAtCoords(e){return ee(this,e)}coordsAtPos(e,t=1){return re(this,e,t)}domAtPos(e,t=0){return this.docView.domFromPos(e,t)}nodeDOM(e){let t=this.docView.descAt(e);return t?t.nodeDOM:null}posAtDOM(e,t,n=-1){let r=this.docView.posFromDOM(e,t,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(e,t){return pe(this,t||this.state,e)}pasteHTML(e,t){return mn(this,"",e,!1,t||new ClipboardEvent("paste"))}pasteText(e,t){return mn(this,e,null,!0,t||new ClipboardEvent("paste"))}destroy(){this.docView&&(jt(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],Un(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(e){return Kt(this,e)}dispatch(e){let t=this._props.dispatchTransaction;t?t.call(this,e):this.updateState(this.state.apply(e))}domSelectionRange(){return x&&11===this.root.nodeType&&w(this.dom.ownerDocument)==this.dom?qn(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function rr(e){let t=Object.create(null);return t.class="ProseMirror",t.contenteditable=String(e.editable),t.translate="no",e.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(e.state)),n)for(let e in n)"class"==e&&(t.class+=" "+n[e]),"style"==e?t.style=(t.style?t.style+";":"")+n[e]:t[e]||"contenteditable"==e||"nodeName"==e||(t[e]=String(n[e]))})),[Sn.node(0,e.state.doc.content.size,t)]}function sr(e){if(e.markCursor){let t=document.createElement("img");t.className="ProseMirror-separator",t.setAttribute("mark-placeholder","true"),t.setAttribute("alt",""),e.cursorWrapper={dom:t,deco:Sn.widget(e.state.selection.head,t,{raw:!0,marks:e.markCursor})}}else e.cursorWrapper=null}function ir(e){return!e.someProp("editable",(t=>!1===t(e.state)))}function or(e,t){let n=Math.min(e.$anchor.sharedDepth(e.head),t.$anchor.sharedDepth(t.head));return e.$anchor.start(n)!=t.$anchor.start(n)}function ar(e){let t=Object.create(null);function n(e){for(let n in e)Object.prototype.hasOwnProperty.call(t,n)||(t[n]=e[n])}return e.someProp("nodeViews",n),e.someProp("markViews",n),t}function cr(e,t){let n=0,r=0;for(let s in e){if(e[s]!=t[s])return!0;n++}for(let s in t)r++;return n!=r}function lr(e){if(e.spec.state||e.spec.filterTransaction||e.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}},2483:function(e,t,n){"use strict";n.d(t,{PO:function(){return V},p7:function(){return tt}});n(7658),n(541);var r=n(3396),s=n(4870);
/*!
  * vue-router v4.1.6
  * (c) 2022 Eduardo San Martin Morote
  * @license MIT
  */
const i="undefined"!==typeof window;function o(e){return e.__esModule||"Module"===e[Symbol.toStringTag]}const a=Object.assign;function c(e,t){const n={};for(const r in t){const s=t[r];n[r]=u(s)?s.map(e):e(s)}return n}const l=()=>{},u=Array.isArray;const h=/\/$/,d=e=>e.replace(h,"");function p(e,t,n="/"){let r,s={},i="",o="";const a=t.indexOf("#");let c=t.indexOf("?");return a<c&&a>=0&&(c=-1),c>-1&&(r=t.slice(0,c),i=t.slice(c+1,a>-1?a:t.length),s=e(i)),a>-1&&(r=r||t.slice(0,a),o=t.slice(a,t.length)),r=E(null!=r?r:t,n),{fullPath:r+(i&&"?")+i+o,path:r,query:s,hash:o}}function f(e,t){const n=t.query?e(t.query):"";return t.path+(n&&"?")+n+(t.hash||"")}function g(e,t){return t&&e.toLowerCase().startsWith(t.toLowerCase())?e.slice(t.length)||"/":e}function m(e,t,n){const r=t.matched.length-1,s=n.matched.length-1;return r>-1&&r===s&&y(t.matched[r],n.matched[s])&&w(t.params,n.params)&&e(t.query)===e(n.query)&&t.hash===n.hash}function y(e,t){return(e.aliasOf||e)===(t.aliasOf||t)}function w(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(!b(e[n],t[n]))return!1;return!0}function b(e,t){return u(e)?v(e,t):u(t)?v(t,e):e===t}function v(e,t){return u(t)?e.length===t.length&&e.every(((e,n)=>e===t[n])):1===e.length&&e[0]===t}function E(e,t){if(e.startsWith("/"))return e;if(!e)return t;const n=t.split("/"),r=e.split("/");let s,i,o=n.length-1;for(s=0;s<r.length;s++)if(i=r[s],"."!==i){if(".."!==i)break;o>1&&o--}return n.slice(0,o).join("/")+"/"+r.slice(s-(s===r.length?1:0)).join("/")}var _,S;(function(e){e["pop"]="pop",e["push"]="push"})(_||(_={})),function(e){e["back"]="back",e["forward"]="forward",e["unknown"]=""}(S||(S={}));function k(e){if(!e)if(i){const t=document.querySelector("base");e=t&&t.getAttribute("href")||"/",e=e.replace(/^\w+:\/\/[^\/]+/,"")}else e="/";return"/"!==e[0]&&"#"!==e[0]&&(e="/"+e),d(e)}const A=/^[^#]+#/;function T(e,t){return e.replace(A,"#")+t}function C(e,t){const n=document.documentElement.getBoundingClientRect(),r=e.getBoundingClientRect();return{behavior:t.behavior,left:r.left-n.left-(t.left||0),top:r.top-n.top-(t.top||0)}}const I=()=>({left:window.pageXOffset,top:window.pageYOffset});function R(e){let t;if("el"in e){const n=e.el,r="string"===typeof n&&n.startsWith("#");0;const s="string"===typeof n?r?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!s)return;t=C(s,e)}else t=e;"scrollBehavior"in document.documentElement.style?window.scrollTo(t):window.scrollTo(null!=t.left?t.left:window.pageXOffset,null!=t.top?t.top:window.pageYOffset)}function O(e,t){const n=history.state?history.state.position-t:-1;return n+e}const x=new Map;function N(e,t){x.set(e,t)}function D(e){const t=x.get(e);return x.delete(e),t}let P=()=>location.protocol+"//"+location.host;function L(e,t){const{pathname:n,search:r,hash:s}=t,i=e.indexOf("#");if(i>-1){let t=s.includes(e.slice(i))?e.slice(i).length:1,n=s.slice(t);return"/"!==n[0]&&(n="/"+n),g(n,"")}const o=g(n,e);return o+r+s}function M(e,t,n,r){let s=[],i=[],o=null;const c=({state:i})=>{const a=L(e,location),c=n.value,l=t.value;let u=0;if(i){if(n.value=a,t.value=i,o&&o===c)return void(o=null);u=l?i.position-l.position:0}else r(a);s.forEach((e=>{e(n.value,c,{delta:u,type:_.pop,direction:u?u>0?S.forward:S.back:S.unknown})}))};function l(){o=n.value}function u(e){s.push(e);const t=()=>{const t=s.indexOf(e);t>-1&&s.splice(t,1)};return i.push(t),t}function h(){const{history:e}=window;e.state&&e.replaceState(a({},e.state,{scroll:I()}),"")}function d(){for(const e of i)e();i=[],window.removeEventListener("popstate",c),window.removeEventListener("beforeunload",h)}return window.addEventListener("popstate",c),window.addEventListener("beforeunload",h),{pauseListeners:l,listen:u,destroy:d}}function B(e,t,n,r=!1,s=!1){return{back:e,current:t,forward:n,replaced:r,position:window.history.length,scroll:s?I():null}}function U(e){const{history:t,location:n}=window,r={value:L(e,n)},s={value:t.state};function i(r,i,o){const a=e.indexOf("#"),c=a>-1?(n.host&&document.querySelector("base")?e:e.slice(a))+r:P()+e+r;try{t[o?"replaceState":"pushState"](i,"",c),s.value=i}catch(l){console.error(l),n[o?"replace":"assign"](c)}}function o(e,n){const o=a({},t.state,B(s.value.back,e,s.value.forward,!0),n,{position:s.value.position});i(e,o,!0),r.value=e}function c(e,n){const o=a({},s.value,t.state,{forward:e,scroll:I()});i(o.current,o,!0);const c=a({},B(r.value,e,null),{position:o.position+1},n);i(e,c,!1),r.value=e}return s.value||i(r.value,{back:null,current:r.value,forward:null,position:t.length-1,replaced:!0,scroll:null},!0),{location:r,state:s,push:c,replace:o}}function V(e){e=k(e);const t=U(e),n=M(e,t.state,t.location,t.replace);function r(e,t=!0){t||n.pauseListeners(),history.go(e)}const s=a({location:"",base:e,go:r,createHref:T.bind(null,e)},t,n);return Object.defineProperty(s,"location",{enumerable:!0,get:()=>t.location.value}),Object.defineProperty(s,"state",{enumerable:!0,get:()=>t.state.value}),s}function F(e){return"string"===typeof e||e&&"object"===typeof e}function j(e){return"string"===typeof e||"symbol"===typeof e}const z={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},$=Symbol("");var H;(function(e){e[e["aborted"]=4]="aborted",e[e["cancelled"]=8]="cancelled",e[e["duplicated"]=16]="duplicated"})(H||(H={}));function K(e,t){return a(new Error,{type:e,[$]:!0},t)}function q(e,t){return e instanceof Error&&$ in e&&(null==t||!!(e.type&t))}const G="[^/]+?",W={sensitive:!1,strict:!1,start:!0,end:!0},Y=/[.+*?^${}()[\]/\\]/g;function J(e,t){const n=a({},W,t),r=[];let s=n.start?"^":"";const i=[];for(const a of e){const e=a.length?[]:[90];n.strict&&!a.length&&(s+="/");for(let t=0;t<a.length;t++){const r=a[t];let o=40+(n.sensitive?.25:0);if(0===r.type)t||(s+="/"),s+=r.value.replace(Y,"\\$&"),o+=40;else if(1===r.type){const{value:e,repeatable:n,optional:c,regexp:l}=r;i.push({name:e,repeatable:n,optional:c});const u=l||G;if(u!==G){o+=10;try{new RegExp(`(${u})`)}catch(h){throw new Error(`Invalid custom RegExp for param "${e}" (${u}): `+h.message)}}let d=n?`((?:${u})(?:/(?:${u}))*)`:`(${u})`;t||(d=c&&a.length<2?`(?:/${d})`:"/"+d),c&&(d+="?"),s+=d,o+=20,c&&(o+=-8),n&&(o+=-20),".*"===u&&(o+=-50)}e.push(o)}r.push(e)}if(n.strict&&n.end){const e=r.length-1;r[e][r[e].length-1]+=.7000000000000001}n.strict||(s+="/?"),n.end?s+="$":n.strict&&(s+="(?:/|$)");const o=new RegExp(s,n.sensitive?"":"i");function c(e){const t=e.match(o),n={};if(!t)return null;for(let r=1;r<t.length;r++){const e=t[r]||"",s=i[r-1];n[s.name]=e&&s.repeatable?e.split("/"):e}return n}function l(t){let n="",r=!1;for(const s of e){r&&n.endsWith("/")||(n+="/"),r=!1;for(const e of s)if(0===e.type)n+=e.value;else if(1===e.type){const{value:i,repeatable:o,optional:a}=e,c=i in t?t[i]:"";if(u(c)&&!o)throw new Error(`Provided param "${i}" is an array but it is not repeatable (* or + modifiers)`);const l=u(c)?c.join("/"):c;if(!l){if(!a)throw new Error(`Missing required param "${i}"`);s.length<2&&(n.endsWith("/")?n=n.slice(0,-1):r=!0)}n+=l}}return n||"/"}return{re:o,score:r,keys:i,parse:c,stringify:l}}function Q(e,t){let n=0;while(n<e.length&&n<t.length){const r=t[n]-e[n];if(r)return r;n++}return e.length<t.length?1===e.length&&80===e[0]?-1:1:e.length>t.length?1===t.length&&80===t[0]?1:-1:0}function X(e,t){let n=0;const r=e.score,s=t.score;while(n<r.length&&n<s.length){const e=Q(r[n],s[n]);if(e)return e;n++}if(1===Math.abs(s.length-r.length)){if(Z(r))return 1;if(Z(s))return-1}return s.length-r.length}function Z(e){const t=e[e.length-1];return e.length>0&&t[t.length-1]<0}const ee={type:0,value:""},te=/[a-zA-Z0-9_]/;function ne(e){if(!e)return[[]];if("/"===e)return[[ee]];if(!e.startsWith("/"))throw new Error(`Invalid path "${e}"`);function t(e){throw new Error(`ERR (${n})/"${l}": ${e}`)}let n=0,r=n;const s=[];let i;function o(){i&&s.push(i),i=[]}let a,c=0,l="",u="";function h(){l&&(0===n?i.push({type:0,value:l}):1===n||2===n||3===n?(i.length>1&&("*"===a||"+"===a)&&t(`A repeatable param (${l}) must be alone in its segment. eg: '/:ids+.`),i.push({type:1,value:l,regexp:u,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):t("Invalid state to consume buffer"),l="")}function d(){l+=a}while(c<e.length)if(a=e[c++],"\\"!==a||2===n)switch(n){case 0:"/"===a?(l&&h(),o()):":"===a?(h(),n=1):d();break;case 4:d(),n=r;break;case 1:"("===a?n=2:te.test(a)?d():(h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&c--);break;case 2:")"===a?"\\"==u[u.length-1]?u=u.slice(0,-1)+a:n=3:u+=a;break;case 3:h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&c--,u="";break;default:t("Unknown state");break}else r=n,n=4;return 2===n&&t(`Unfinished custom RegExp for param "${l}"`),h(),o(),s}function re(e,t,n){const r=J(ne(e.path),n);const s=a(r,{record:e,parent:t,children:[],alias:[]});return t&&!s.record.aliasOf===!t.record.aliasOf&&t.children.push(s),s}function se(e,t){const n=[],r=new Map;function s(e){return r.get(e)}function i(e,n,r){const s=!r,c=oe(e);c.aliasOf=r&&r.record;const h=ue(t,e),d=[c];if("alias"in e){const t="string"===typeof e.alias?[e.alias]:e.alias;for(const e of t)d.push(a({},c,{components:r?r.record.components:c.components,path:e,aliasOf:r?r.record:c}))}let p,f;for(const t of d){const{path:a}=t;if(n&&"/"!==a[0]){const e=n.record.path,r="/"===e[e.length-1]?"":"/";t.path=n.record.path+(a&&r+a)}if(p=re(t,n,h),r?r.alias.push(p):(f=f||p,f!==p&&f.alias.push(p),s&&e.name&&!ce(p)&&o(e.name)),c.children){const e=c.children;for(let t=0;t<e.length;t++)i(e[t],p,r&&r.children[t])}r=r||p,(p.record.components&&Object.keys(p.record.components).length||p.record.name||p.record.redirect)&&u(p)}return f?()=>{o(f)}:l}function o(e){if(j(e)){const t=r.get(e);t&&(r.delete(e),n.splice(n.indexOf(t),1),t.children.forEach(o),t.alias.forEach(o))}else{const t=n.indexOf(e);t>-1&&(n.splice(t,1),e.record.name&&r.delete(e.record.name),e.children.forEach(o),e.alias.forEach(o))}}function c(){return n}function u(e){let t=0;while(t<n.length&&X(e,n[t])>=0&&(e.record.path!==n[t].record.path||!he(e,n[t])))t++;n.splice(t,0,e),e.record.name&&!ce(e)&&r.set(e.record.name,e)}function h(e,t){let s,i,o,c={};if("name"in e&&e.name){if(s=r.get(e.name),!s)throw K(1,{location:e});0,o=s.record.name,c=a(ie(t.params,s.keys.filter((e=>!e.optional)).map((e=>e.name))),e.params&&ie(e.params,s.keys.map((e=>e.name)))),i=s.stringify(c)}else if("path"in e)i=e.path,s=n.find((e=>e.re.test(i))),s&&(c=s.parse(i),o=s.record.name);else{if(s=t.name?r.get(t.name):n.find((e=>e.re.test(t.path))),!s)throw K(1,{location:e,currentLocation:t});o=s.record.name,c=a({},t.params,e.params),i=s.stringify(c)}const l=[];let u=s;while(u)l.unshift(u.record),u=u.parent;return{name:o,path:i,params:c,matched:l,meta:le(l)}}return t=ue({strict:!1,end:!0,sensitive:!1},t),e.forEach((e=>i(e))),{addRoute:i,resolve:h,removeRoute:o,getRoutes:c,getRecordMatcher:s}}function ie(e,t){const n={};for(const r of t)r in e&&(n[r]=e[r]);return n}function oe(e){return{path:e.path,redirect:e.redirect,name:e.name,meta:e.meta||{},aliasOf:void 0,beforeEnter:e.beforeEnter,props:ae(e),children:e.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in e?e.components||null:e.component&&{default:e.component}}}function ae(e){const t={},n=e.props||!1;if("component"in e)t.default=n;else for(const r in e.components)t[r]="boolean"===typeof n?n:n[r];return t}function ce(e){while(e){if(e.record.aliasOf)return!0;e=e.parent}return!1}function le(e){return e.reduce(((e,t)=>a(e,t.meta)),{})}function ue(e,t){const n={};for(const r in e)n[r]=r in t?t[r]:e[r];return n}function he(e,t){return t.children.some((t=>t===e||he(e,t)))}const de=/#/g,pe=/&/g,fe=/\//g,ge=/=/g,me=/\?/g,ye=/\+/g,we=/%5B/g,be=/%5D/g,ve=/%5E/g,Ee=/%60/g,_e=/%7B/g,Se=/%7C/g,ke=/%7D/g,Ae=/%20/g;function Te(e){return encodeURI(""+e).replace(Se,"|").replace(we,"[").replace(be,"]")}function Ce(e){return Te(e).replace(_e,"{").replace(ke,"}").replace(ve,"^")}function Ie(e){return Te(e).replace(ye,"%2B").replace(Ae,"+").replace(de,"%23").replace(pe,"%26").replace(Ee,"`").replace(_e,"{").replace(ke,"}").replace(ve,"^")}function Re(e){return Ie(e).replace(ge,"%3D")}function Oe(e){return Te(e).replace(de,"%23").replace(me,"%3F")}function xe(e){return null==e?"":Oe(e).replace(fe,"%2F")}function Ne(e){try{return decodeURIComponent(""+e)}catch(t){}return""+e}function De(e){const t={};if(""===e||"?"===e)return t;const n="?"===e[0],r=(n?e.slice(1):e).split("&");for(let s=0;s<r.length;++s){const e=r[s].replace(ye," "),n=e.indexOf("="),i=Ne(n<0?e:e.slice(0,n)),o=n<0?null:Ne(e.slice(n+1));if(i in t){let e=t[i];u(e)||(e=t[i]=[e]),e.push(o)}else t[i]=o}return t}function Pe(e){let t="";for(let n in e){const r=e[n];if(n=Re(n),null==r){void 0!==r&&(t+=(t.length?"&":"")+n);continue}const s=u(r)?r.map((e=>e&&Ie(e))):[r&&Ie(r)];s.forEach((e=>{void 0!==e&&(t+=(t.length?"&":"")+n,null!=e&&(t+="="+e))}))}return t}function Le(e){const t={};for(const n in e){const r=e[n];void 0!==r&&(t[n]=u(r)?r.map((e=>null==e?null:""+e)):null==r?r:""+r)}return t}const Me=Symbol(""),Be=Symbol(""),Ue=Symbol(""),Ve=Symbol(""),Fe=Symbol("");function je(){let e=[];function t(t){return e.push(t),()=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)}}function n(){e=[]}return{add:t,list:()=>e,reset:n}}function ze(e,t,n,r,s){const i=r&&(r.enterCallbacks[s]=r.enterCallbacks[s]||[]);return()=>new Promise(((o,a)=>{const c=e=>{!1===e?a(K(4,{from:n,to:t})):e instanceof Error?a(e):F(e)?a(K(2,{from:t,to:e})):(i&&r.enterCallbacks[s]===i&&"function"===typeof e&&i.push(e),o())},l=e.call(r&&r.instances[s],t,n,c);let u=Promise.resolve(l);e.length<3&&(u=u.then(c)),u.catch((e=>a(e)))}))}function $e(e,t,n,r){const s=[];for(const i of e){0;for(const e in i.components){let a=i.components[e];if("beforeRouteEnter"===t||i.instances[e])if(He(a)){const o=a.__vccOpts||a,c=o[t];c&&s.push(ze(c,n,r,i,e))}else{let c=a();0,s.push((()=>c.then((s=>{if(!s)return Promise.reject(new Error(`Couldn't resolve component "${e}" at "${i.path}"`));const a=o(s)?s.default:s;i.components[e]=a;const c=a.__vccOpts||a,l=c[t];return l&&ze(l,n,r,i,e)()}))))}}}return s}function He(e){return"object"===typeof e||"displayName"in e||"props"in e||"__vccOpts"in e}function Ke(e){const t=(0,r.f3)(Ue),n=(0,r.f3)(Ve),i=(0,r.Fl)((()=>t.resolve((0,s.SU)(e.to)))),o=(0,r.Fl)((()=>{const{matched:e}=i.value,{length:t}=e,r=e[t-1],s=n.matched;if(!r||!s.length)return-1;const o=s.findIndex(y.bind(null,r));if(o>-1)return o;const a=Je(e[t-2]);return t>1&&Je(r)===a&&s[s.length-1].path!==a?s.findIndex(y.bind(null,e[t-2])):o})),a=(0,r.Fl)((()=>o.value>-1&&Ye(n.params,i.value.params))),c=(0,r.Fl)((()=>o.value>-1&&o.value===n.matched.length-1&&w(n.params,i.value.params)));function u(n={}){return We(n)?t[(0,s.SU)(e.replace)?"replace":"push"]((0,s.SU)(e.to)).catch(l):Promise.resolve()}return{route:i,href:(0,r.Fl)((()=>i.value.href)),isActive:a,isExactActive:c,navigate:u}}const qe=(0,r.aZ)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Ke,setup(e,{slots:t}){const n=(0,s.qj)(Ke(e)),{options:i}=(0,r.f3)(Ue),o=(0,r.Fl)((()=>({[Qe(e.activeClass,i.linkActiveClass,"router-link-active")]:n.isActive,[Qe(e.exactActiveClass,i.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive})));return()=>{const s=t.default&&t.default(n);return e.custom?s:(0,r.h)("a",{"aria-current":n.isExactActive?e.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:o.value},s)}}}),Ge=qe;function We(e){if(!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)&&!e.defaultPrevented&&(void 0===e.button||0===e.button)){if(e.currentTarget&&e.currentTarget.getAttribute){const t=e.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(t))return}return e.preventDefault&&e.preventDefault(),!0}}function Ye(e,t){for(const n in t){const r=t[n],s=e[n];if("string"===typeof r){if(r!==s)return!1}else if(!u(s)||s.length!==r.length||r.some(((e,t)=>e!==s[t])))return!1}return!0}function Je(e){return e?e.aliasOf?e.aliasOf.path:e.path:""}const Qe=(e,t,n)=>null!=e?e:null!=t?t:n,Xe=(0,r.aZ)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(e,{attrs:t,slots:n}){const i=(0,r.f3)(Fe),o=(0,r.Fl)((()=>e.route||i.value)),c=(0,r.f3)(Be,0),l=(0,r.Fl)((()=>{let e=(0,s.SU)(c);const{matched:t}=o.value;let n;while((n=t[e])&&!n.components)e++;return e})),u=(0,r.Fl)((()=>o.value.matched[l.value]));(0,r.JJ)(Be,(0,r.Fl)((()=>l.value+1))),(0,r.JJ)(Me,u),(0,r.JJ)(Fe,o);const h=(0,s.iH)();return(0,r.YP)((()=>[h.value,u.value,e.name]),(([e,t,n],[r,s,i])=>{t&&(t.instances[n]=e,s&&s!==t&&e&&e===r&&(t.leaveGuards.size||(t.leaveGuards=s.leaveGuards),t.updateGuards.size||(t.updateGuards=s.updateGuards))),!e||!t||s&&y(t,s)&&r||(t.enterCallbacks[n]||[]).forEach((t=>t(e)))}),{flush:"post"}),()=>{const s=o.value,i=e.name,c=u.value,l=c&&c.components[i];if(!l)return Ze(n.default,{Component:l,route:s});const d=c.props[i],p=d?!0===d?s.params:"function"===typeof d?d(s):d:null,f=e=>{e.component.isUnmounted&&(c.instances[i]=null)},g=(0,r.h)(l,a({},p,t,{onVnodeUnmounted:f,ref:h}));return Ze(n.default,{Component:g,route:s})||g}}});function Ze(e,t){if(!e)return null;const n=e(t);return 1===n.length?n[0]:n}const et=Xe;function tt(e){const t=se(e.routes,e),n=e.parseQuery||De,o=e.stringifyQuery||Pe,h=e.history;const d=je(),g=je(),y=je(),w=(0,s.XI)(z);let b=z;i&&e.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const v=c.bind(null,(e=>""+e)),E=c.bind(null,xe),S=c.bind(null,Ne);function k(e,n){let r,s;return j(e)?(r=t.getRecordMatcher(e),s=n):s=e,t.addRoute(s,r)}function A(e){const n=t.getRecordMatcher(e);n&&t.removeRoute(n)}function T(){return t.getRoutes().map((e=>e.record))}function C(e){return!!t.getRecordMatcher(e)}function x(e,r){if(r=a({},r||w.value),"string"===typeof e){const s=p(n,e,r.path),i=t.resolve({path:s.path},r),o=h.createHref(s.fullPath);return a(s,i,{params:S(i.params),hash:Ne(s.hash),redirectedFrom:void 0,href:o})}let s;if("path"in e)s=a({},e,{path:p(n,e.path,r.path).path});else{const t=a({},e.params);for(const e in t)null==t[e]&&delete t[e];s=a({},e,{params:E(e.params)}),r.params=E(r.params)}const i=t.resolve(s,r),c=e.hash||"";i.params=v(S(i.params));const l=f(o,a({},e,{hash:Ce(c),path:i.path})),u=h.createHref(l);return a({fullPath:l,hash:c,query:o===Pe?Le(e.query):e.query||{}},i,{redirectedFrom:void 0,href:u})}function P(e){return"string"===typeof e?p(n,e,w.value.path):a({},e)}function L(e,t){if(b!==e)return K(8,{from:t,to:e})}function M(e){return V(e)}function B(e){return M(a(P(e),{replace:!0}))}function U(e){const t=e.matched[e.matched.length-1];if(t&&t.redirect){const{redirect:n}=t;let r="function"===typeof n?n(e):n;return"string"===typeof r&&(r=r.includes("?")||r.includes("#")?r=P(r):{path:r},r.params={}),a({query:e.query,hash:e.hash,params:"path"in r?{}:e.params},r)}}function V(e,t){const n=b=x(e),r=w.value,s=e.state,i=e.force,c=!0===e.replace,l=U(n);if(l)return V(a(P(l),{state:"object"===typeof l?a({},s,l.state):s,force:i,replace:c}),t||n);const u=n;let h;return u.redirectedFrom=t,!i&&m(o,r,n)&&(h=K(16,{to:u,from:r}),ne(r,r,!0,!1)),(h?Promise.resolve(h):$(u,r)).catch((e=>q(e)?q(e,2)?e:te(e):Z(e,u,r))).then((e=>{if(e){if(q(e,2))return V(a({replace:c},P(e.to),{state:"object"===typeof e.to?a({},s,e.to.state):s,force:i}),t||u)}else e=G(u,r,!0,c,s);return H(u,r,e),e}))}function F(e,t){const n=L(e,t);return n?Promise.reject(n):Promise.resolve()}function $(e,t){let n;const[r,s,i]=rt(e,t);n=$e(r.reverse(),"beforeRouteLeave",e,t);for(const a of r)a.leaveGuards.forEach((r=>{n.push(ze(r,e,t))}));const o=F.bind(null,e,t);return n.push(o),nt(n).then((()=>{n=[];for(const r of d.list())n.push(ze(r,e,t));return n.push(o),nt(n)})).then((()=>{n=$e(s,"beforeRouteUpdate",e,t);for(const r of s)r.updateGuards.forEach((r=>{n.push(ze(r,e,t))}));return n.push(o),nt(n)})).then((()=>{n=[];for(const r of e.matched)if(r.beforeEnter&&!t.matched.includes(r))if(u(r.beforeEnter))for(const s of r.beforeEnter)n.push(ze(s,e,t));else n.push(ze(r.beforeEnter,e,t));return n.push(o),nt(n)})).then((()=>(e.matched.forEach((e=>e.enterCallbacks={})),n=$e(i,"beforeRouteEnter",e,t),n.push(o),nt(n)))).then((()=>{n=[];for(const r of g.list())n.push(ze(r,e,t));return n.push(o),nt(n)})).catch((e=>q(e,8)?e:Promise.reject(e)))}function H(e,t,n){for(const r of y.list())r(e,t,n)}function G(e,t,n,r,s){const o=L(e,t);if(o)return o;const c=t===z,l=i?history.state:{};n&&(r||c?h.replace(e.fullPath,a({scroll:c&&l&&l.scroll},s)):h.push(e.fullPath,s)),w.value=e,ne(e,t,n,c),te()}let W;function Y(){W||(W=h.listen(((e,t,n)=>{if(!ae.listening)return;const r=x(e),s=U(r);if(s)return void V(a(s,{replace:!0}),r).catch(l);b=r;const o=w.value;i&&N(O(o.fullPath,n.delta),I()),$(r,o).catch((e=>q(e,12)?e:q(e,2)?(V(e.to,r).then((e=>{q(e,20)&&!n.delta&&n.type===_.pop&&h.go(-1,!1)})).catch(l),Promise.reject()):(n.delta&&h.go(-n.delta,!1),Z(e,r,o)))).then((e=>{e=e||G(r,o,!1),e&&(n.delta&&!q(e,8)?h.go(-n.delta,!1):n.type===_.pop&&q(e,20)&&h.go(-1,!1)),H(r,o,e)})).catch(l)})))}let J,Q=je(),X=je();function Z(e,t,n){te(e);const r=X.list();return r.length?r.forEach((r=>r(e,t,n))):console.error(e),Promise.reject(e)}function ee(){return J&&w.value!==z?Promise.resolve():new Promise(((e,t)=>{Q.add([e,t])}))}function te(e){return J||(J=!e,Y(),Q.list().forEach((([t,n])=>e?n(e):t())),Q.reset()),e}function ne(t,n,s,o){const{scrollBehavior:a}=e;if(!i||!a)return Promise.resolve();const c=!s&&D(O(t.fullPath,0))||(o||!s)&&history.state&&history.state.scroll||null;return(0,r.Y3)().then((()=>a(t,n,c))).then((e=>e&&R(e))).catch((e=>Z(e,t,n)))}const re=e=>h.go(e);let ie;const oe=new Set,ae={currentRoute:w,listening:!0,addRoute:k,removeRoute:A,hasRoute:C,getRoutes:T,resolve:x,options:e,push:M,replace:B,go:re,back:()=>re(-1),forward:()=>re(1),beforeEach:d.add,beforeResolve:g.add,afterEach:y.add,onError:X.add,isReady:ee,install(e){const t=this;e.component("RouterLink",Ge),e.component("RouterView",et),e.config.globalProperties.$router=t,Object.defineProperty(e.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,s.SU)(w)}),i&&!ie&&w.value===z&&(ie=!0,M(h.location).catch((e=>{0})));const n={};for(const s in z)n[s]=(0,r.Fl)((()=>w.value[s]));e.provide(Ue,t),e.provide(Ve,(0,s.qj)(n)),e.provide(Fe,w);const o=e.unmount;oe.add(e),e.unmount=function(){oe.delete(e),oe.size<1&&(b=z,W&&W(),W=null,w.value=z,ie=!1,J=!1),o()}}};return ae}function nt(e){return e.reduce(((e,t)=>e.then((()=>t()))),Promise.resolve())}function rt(e,t){const n=[],r=[],s=[],i=Math.max(t.matched.length,e.matched.length);for(let o=0;o<i;o++){const i=t.matched[o];i&&(e.matched.find((e=>y(e,i)))?r.push(i):n.push(i));const a=e.matched[o];a&&(t.matched.find((e=>y(e,a)))||s.push(a))}return[n,r,s]}},7195:function(e,t,n){"use strict";n.d(t,{JR:function(){return h},SF:function(){return p},US:function(){return u}});var r=n(1811),s=n(3248),i=n(6969),o=n(7862),a=n(1634);let c=null;const l=()=>{const e=c;c=null,e.forEach(((e,t)=>{const n=t.state.tr,s=r.Gt.getState(t.state);s&&s.binding&&!s.binding.isDestroyed&&(e.forEach(((e,t)=>{n.setMeta(t,e)})),t.dispatch(n))}))},u=(e,t,n)=>{c||(c=new Map,a.Vs(0,l)),o.Yu(c,e,o.Ue).set(t,n)},h=(e,t,n)=>{if(0===e)return s.w$(t,0);let r=null===t._first?null:t._first.content.type;while(null!==r&&t!==r){if(r instanceof s.eI){if(r._length>=e)return s.w$(r,e);if(e-=r._length,null!==r._item&&null!==r._item.next)r=r._item.next.content.type;else{do{r=null===r._item?null:r._item.parent,e--}while(r!==t&&null!==r&&null!==r._item&&null===r._item.next);null!==r&&r!==t&&(r=null===r._item?null:r._item.next.content.type)}}else{const i=(n.get(r)||{nodeSize:0}).nodeSize;if(null!==r._first&&e<i)r=r._first.content.type,e--;else{if(1===e&&0===r._length&&i>1)return new s.Zi(null===r._item?null:r._item.id,null===r._item?s.BW(r):null,null);if(e-=i,null!==r._item&&null!==r._item.next)r=r._item.next.content.type;else{if(0===e)return r=null===r._item?r:r._item.parent,new s.Zi(null===r._item?null:r._item.id,null===r._item?s.BW(r):null,null);do{r=r._item.parent,e--}while(r!==t&&null===r._item.next);r!==t&&(r=r._item.next.content.type)}}}if(null===r)throw i.zR();if(0===e&&r.constructor!==s.eI&&r!==t)return d(r._item.parent,r._item)}return s.w$(t,t._length)},d=(e,t)=>{let n=null,r=null;return null===e._item?r=s.BW(e):n=s.at(e._item.id.client,e._item.id.clock),new s.Zi(n,r,t.id)},p=(e,t,n,r)=>{const i=s.or(n,e);if(null===i||i.type!==t&&!s.$4(t,i.type._item))return null;let o=i.type,a=0;if(o.constructor===s.eI)a=i.index;else if(null===o._item||!o._item.deleted){let e=o._first,t=0;while(t<o._length&&t<i.index&&null!==e){if(!e.deleted){const n=e.content.type;t++,n instanceof s.eI?a+=n._length:a+=r.get(n).nodeSize}e=e.right}a+=1}while(o!==t&&null!==o._item){const e=o._item.parent;if(null===e._item||!e._item.deleted){a+=1;let t=e._first;while(null!==t){const e=t.content.type;if(e===o)break;t.deleted||(e instanceof s.eI?a+=e._length:a+=r.get(e).nodeSize),t=t.right}}o=e}return a-1}},1811:function(e,t,n){"use strict";n.d(t,{Gk:function(){return i},Gt:function(){return s},uJ:function(){return o}});var r=n(157);const s=new r.H$("y-sync"),i=new r.H$("y-undo"),o=new r.H$("yjs-cursor")},3248:function(e,t,n){"use strict";n.d(t,{MM:function(){return vs},$_:function(){return Ts},zc:function(){return Ms},QW:function(){return Et},ck:function(){return zs},Zi:function(){return rn},aC:function(){return dn},xv:function(){return Jr},H6:function(){return Fn},lt:function(){return ts},eI:function(){return os},NG:function(){return Bt},Uq:function(){return hn},or:function(){return un},VG:function(){return gt},at:function(){return en},og:function(){return sn},w$:function(){return ln},Ox:function(){return pn},D$:function(){return Ft},gJ:function(){return qt},BW:function(){return tn},uY:function(){return ht},$4:function(){return nn},UQ:function(){return lt},CO:function(){return fn},ud:function(){return pr}});n(7658),n(3767),n(8585),n(8696),n(541);var r=n(7862),s=n(893);const i=e=>e[e.length-1],o=(e,t)=>{for(let n=0;n<t.length;n++)e.push(t[n])},a=Array.from,c=Array.isArray;class l{constructor(){this._observers=r.Ue()}on(e,t){r.Yu(this._observers,e,s.Ue).add(t)}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};this.on(e,n)}off(e,t){const n=this._observers.get(e);void 0!==n&&(n.delete(t),0===n.size&&this._observers.delete(e))}emit(e,t){return a((this._observers.get(e)||r.Ue()).values()).forEach((e=>e(...t)))}destroy(){this._observers=r.Ue()}}var u=n(1383),h=(n(2801),n(654)),d=n(6413);const p=e=>new Uint8Array(e),f=(e,t,n)=>new Uint8Array(e,t,n),g=e=>{let t="";for(let n=0;n<e.byteLength;n++)t+=h.IK(e[n]);return btoa(t)},m=e=>Buffer.from(e.buffer,e.byteOffset,e.byteLength).toString("base64"),y=e=>{const t=atob(e),n=p(t.length);for(let r=0;r<t.length;r++)n[r]=t.charCodeAt(r);return n},w=e=>{const t=Buffer.from(e,"base64");return new Uint8Array(t.buffer,t.byteOffset,t.byteLength)},b=(d.jU,d.jU,e=>{const t=p(e.byteLength);return t.set(e),t}),v=1,E=2,_=4,S=8,k=32,A=64,T=128,C=31,I=63,R=127,O=2147483647,x=Number.MAX_SAFE_INTEGER,N=(Number.MIN_SAFE_INTEGER,Number.isInteger||(e=>"number"===typeof e&&isFinite(e)&&u.GW(e)===e));Number.isNaN,Number.parseInt;class D{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const P=()=>new D,L=e=>{let t=e.cpos;for(let n=0;n<e.bufs.length;n++)t+=e.bufs[n].length;return t},M=e=>{const t=new Uint8Array(L(e));let n=0;for(let r=0;r<e.bufs.length;r++){const s=e.bufs[r];t.set(s,n),n+=s.length}return t.set(f(e.cbuf.buffer,0,e.cpos),n),t},B=(e,t)=>{const n=e.cbuf.length;n-e.cpos<t&&(e.bufs.push(f(e.cbuf.buffer,0,e.cpos)),e.cbuf=new Uint8Array(2*u.Fp(n,t)),e.cpos=0)},U=(e,t)=>{const n=e.cbuf.length;e.cpos===n&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(2*n),e.cpos=0),e.cbuf[e.cpos++]=t},V=U,F=(e,t)=>{while(t>R)U(e,T|R&t),t=u.GW(t/128);U(e,R&t)},j=(e,t)=>{const n=u.GR(t);n&&(t=-t),U(e,(t>I?T:0)|(n?A:0)|I&t),t=u.GW(t/64);while(t>0)U(e,(t>R?T:0)|R&t),t=u.GW(t/128)},z=new Uint8Array(3e4),$=z.length/3,H=(e,t)=>{if(t.length<$){const n=h.YZ.encodeInto(t,z).written||0;F(e,n);for(let t=0;t<n;t++)U(e,z[t])}else W(e,h.lz(t))},K=(e,t)=>{const n=unescape(encodeURIComponent(t)),r=n.length;F(e,r);for(let s=0;s<r;s++)U(e,n.codePointAt(s))},q=h.YZ&&h.YZ.encodeInto?H:K,G=(e,t)=>{const n=e.cbuf.length,r=e.cpos,s=u.VV(n-r,t.length),i=t.length-s;e.cbuf.set(t.subarray(0,s),r),e.cpos+=s,i>0&&(e.bufs.push(e.cbuf),e.cbuf=new Uint8Array(u.Fp(2*n,i)),e.cbuf.set(t.subarray(s)),e.cpos=i)},W=(e,t)=>{F(e,t.byteLength),G(e,t)},Y=(e,t)=>{B(e,t);const n=new DataView(e.cbuf.buffer,e.cpos,t);return e.cpos+=t,n},J=(e,t)=>Y(e,4).setFloat32(0,t,!1),Q=(e,t)=>Y(e,8).setFloat64(0,t,!1),X=(e,t)=>Y(e,8).setBigInt64(0,t,!1),Z=new DataView(new ArrayBuffer(4)),ee=e=>(Z.setFloat32(0,e),Z.getFloat32(0)===e),te=(e,t)=>{switch(typeof t){case"string":U(e,119),q(e,t);break;case"number":N(t)&&u.Wn(t)<=O?(U(e,125),j(e,t)):ee(t)?(U(e,124),J(e,t)):(U(e,123),Q(e,t));break;case"bigint":U(e,122),X(e,t);break;case"object":if(null===t)U(e,126);else if(t instanceof Array){U(e,117),F(e,t.length);for(let n=0;n<t.length;n++)te(e,t[n])}else if(t instanceof Uint8Array)U(e,116),W(e,t);else{U(e,118);const n=Object.keys(t);F(e,n.length);for(let r=0;r<n.length;r++){const s=n[r];q(e,s),te(e,t[s])}}break;case"boolean":U(e,t?120:121);break;default:U(e,127)}};class ne extends D{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&F(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const re=e=>{e.count>0&&(j(e.encoder,1===e.count?e.s:-e.s),e.count>1&&F(e.encoder,e.count-2))};class se{constructor(){this.encoder=new D,this.s=0,this.count=0}write(e){this.s===e?this.count++:(re(this),this.count=1,this.s=e)}toUint8Array(){return re(this),M(this.encoder)}}const ie=e=>{if(e.count>0){const t=2*e.diff+(1===e.count?0:1);j(e.encoder,t),e.count>1&&F(e.encoder,e.count-2)}};class oe{constructor(){this.encoder=new D,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(ie(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return ie(this),M(this.encoder)}}class ae{constructor(){this.sarr=[],this.s="",this.lensE=new se}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new D;return this.sarr.push(this.s),this.s="",q(e,this.sarr.join("")),G(e,this.lensE.toUint8Array()),M(e)}}var ce=n(6969);const le=ce.Ue("Unexpected end of array"),ue=ce.Ue("Integer out of Range");class he{constructor(e){this.arr=e,this.pos=0}}const de=e=>new he(e),pe=e=>e.pos!==e.arr.length,fe=(e,t)=>{const n=f(e.arr.buffer,e.pos+e.arr.byteOffset,t);return e.pos+=t,n},ge=e=>fe(e,ye(e)),me=e=>e.arr[e.pos++],ye=e=>{let t=0,n=1;const r=e.arr.length;while(e.pos<r){const r=e.arr[e.pos++];if(t+=(r&R)*n,n*=128,r<T)return t;if(t>x)throw ue}throw le},we=e=>{let t=e.arr[e.pos++],n=t&I,r=64;const s=(t&A)>0?-1:1;if(0===(t&T))return s*n;const i=e.arr.length;while(e.pos<i){if(t=e.arr[e.pos++],n+=(t&R)*r,r*=128,t<T)return s*n;if(n>x)throw ue}throw le},be=e=>{let t=ye(e);if(0===t)return"";{let n=String.fromCodePoint(me(e));if(--t<100)while(t--)n+=String.fromCodePoint(me(e));else while(t>0){const r=t<1e4?t:1e4,s=e.arr.subarray(e.pos,e.pos+r);e.pos+=r,n+=String.fromCodePoint.apply(null,s),t-=r}return decodeURIComponent(escape(n))}},ve=e=>h.CO.decode(ge(e)),Ee=h.CO?ve:be,_e=(e,t)=>{const n=new DataView(e.arr.buffer,e.arr.byteOffset+e.pos,t);return e.pos+=t,n},Se=e=>_e(e,4).getFloat32(0,!1),ke=e=>_e(e,8).getFloat64(0,!1),Ae=e=>_e(e,8).getBigInt64(0,!1),Te=[e=>{},e=>null,we,Se,ke,Ae,e=>!1,e=>!0,Ee,e=>{const t=ye(e),n={};for(let r=0;r<t;r++){const t=Ee(e);n[t]=Ce(e)}return n},e=>{const t=ye(e),n=[];for(let r=0;r<t;r++)n.push(Ce(e));return n},ge],Ce=e=>Te[127-me(e)](e);class Ie extends he{constructor(e,t){super(e),this.reader=t,this.s=null,this.count=0}read(){return 0===this.count&&(this.s=this.reader(this),pe(this)?this.count=ye(this)+1:this.count=-1),this.count--,this.s}}class Re extends he{constructor(e){super(e),this.s=0,this.count=0}read(){if(0===this.count){this.s=we(this);const e=u.GR(this.s);this.count=1,e&&(this.s=-this.s,this.count=ye(this)+2)}return this.count--,this.s}}class Oe extends he{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(0===this.count){const e=we(this),t=1&e;this.diff=u.GW(e/2),this.count=1,t&&(this.count=ye(this)+2)}return this.s+=this.diff,this.count--,this.s}}class xe{constructor(e){this.decoder=new Re(e),this.str=Ee(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),t=this.str.slice(this.spos,e);return this.spos=e,t}}var Ne=n(6157);const De=e=>new Promise(e);var Pe=n(7409);const Le=Symbol;class Me{constructor(e,t){this.left=e,this.right=t}}const Be=(e,t)=>new Me(e,t);var Ue=n(7214);const Ve=Date.now,Fe=Le(),je=Le(),ze=Le(),$e=Le(),He=Le(),Ke=Le(),qe=Le(),Ge=Le(),We=Le(),Ye={[Fe]:Be("font-weight","bold"),[je]:Be("font-weight","normal"),[ze]:Be("color","blue"),[He]:Be("color","green"),[$e]:Be("color","grey"),[Ke]:Be("color","red"),[qe]:Be("color","purple"),[Ge]:Be("color","orange"),[We]:Be("color","black")},Je={[Fe]:"[1m",[je]:"[2m",[ze]:"[34m",[He]:"[32m",[$e]:"[37m",[Ke]:"[31m",[qe]:"[35m",[Ge]:"[38;5;208m",[We]:"[0m"},Qe=e=>{const t=[],n=[],s=r.Ue();let i=[],o=0;for(;o<e.length;o++){const r=e[o],i=Ye[r];if(void 0!==i)s.set(i.left,i.right);else{if(r.constructor!==String&&r.constructor!==Number)break;{const e=Ue.x0(s);o>0||e.length>0?(t.push("%c"+r),n.push(e)):t.push(r)}}}for(o>0&&(i=n,i.unshift(t.join("")));o<e.length;o++){const t=e[o];t instanceof Symbol||i.push(t)}return i},Xe=e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const n=e[r],s=Je[n];if(void 0===s){if(n.constructor!==String&&n.constructor!==Number)break;t.push(n)}}for(r>0&&n.push(t.join(""));r<e.length;r++){const t=e[r];t instanceof Symbol||(t.constructor===Object?n.push(JSON.stringify(t)):n.push(t))}return n},Ze=e=>{const t=[],n=[];let r=0;for(;r<e.length;r++){const n=e[r],s=Je[n];if(void 0!==s)t.push(s);else{if(n.constructor!==String&&n.constructor!==Number)break;t.push(n)}}for(r>0&&(t.push("[0m"),n.push(t.join("")));r<e.length;r++){const t=e[r];t instanceof Symbol||n.push(t)}return n},et=d.hH?d.UG?Ze:Qe:Xe,tt=(...e)=>{console.log(...et(e)),nt.forEach((t=>t.print(e)))},nt=s.Ue();Ve();const rt=e=>({[Symbol.iterator](){return this},next:e}),st=(e,t)=>rt((()=>{let n;do{n=e.next()}while(!n.done&&!t(n.value));return n})),it=(e,t)=>rt((()=>{const{done:n,value:r}=e.next();return{done:n,value:n?void 0:t(r)}}));var ot=n(1370);class at{constructor(e,t){this.clock=e,this.len=t}}class ct{constructor(){this.clients=new Map}}const lt=(e,t,n)=>t.clients.forEach(((t,r)=>{const s=e.doc.store.clients.get(r);for(let i=0;i<t.length;i++){const r=t[i];In(e,s,r.clock,r.len,n)}})),ut=(e,t)=>{let n=0,r=e.length-1;while(n<=r){const s=u.GW((n+r)/2),i=e[s],o=i.clock;if(o<=t){if(t<o+i.len)return s;n=s+1}else r=s-1}return null},ht=(e,t)=>{const n=e.clients.get(t.client);return void 0!==n&&null!==ut(n,t.clock)},dt=e=>{e.clients.forEach((e=>{let t,n;for(e.sort(((e,t)=>e.clock-t.clock)),t=1,n=1;t<e.length;t++){const r=e[n-1],s=e[t];r.clock+r.len>=s.clock?r.len=u.Fp(r.len,s.clock+s.len-r.clock):(n<t&&(e[n]=s),n++)}e.length=n}))},pt=e=>{const t=new ct;for(let n=0;n<e.length;n++)e[n].clients.forEach(((r,s)=>{if(!t.clients.has(s)){const i=r.slice();for(let t=n+1;t<e.length;t++)o(i,e[t].clients.get(s)||[]);t.clients.set(s,i)}}));return dt(t),t},ft=(e,t,n,s)=>{r.Yu(e.clients,t,(()=>[])).push(new at(n,s))},gt=()=>new ct,mt=e=>{const t=gt();return e.clients.forEach(((e,n)=>{const r=[];for(let t=0;t<e.length;t++){const n=e[t];if(n.deleted){const s=n.id.clock;let i=n.length;if(t+1<e.length)for(let n=e[t+1];t+1<e.length&&n.deleted;n=e[1+ ++t])i+=n.length;r.push(new at(s,i))}}r.length>0&&t.clients.set(n,r)})),t},yt=(e,t)=>{F(e.restEncoder,t.clients.size),a(t.clients.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([t,n])=>{e.resetDsCurVal(),F(e.restEncoder,t);const r=n.length;F(e.restEncoder,r);for(let s=0;s<r;s++){const t=n[s];e.writeDsClock(t.clock),e.writeDsLen(t.len)}}))},wt=e=>{const t=new ct,n=ye(e.restDecoder);for(let s=0;s<n;s++){e.resetDsCurVal();const n=ye(e.restDecoder),s=ye(e.restDecoder);if(s>0){const i=r.Yu(t.clients,n,(()=>[]));for(let t=0;t<s;t++)i.push(new at(e.readDsClock(),e.readDsLen()))}}return t},bt=(e,t,n)=>{const r=new ct,s=ye(e.restDecoder);for(let i=0;i<s;i++){e.resetDsCurVal();const s=ye(e.restDecoder),i=ye(e.restDecoder),o=n.clients.get(s)||[],a=bn(n,s);for(let n=0;n<i;n++){const n=e.readDsClock(),i=n+e.readDsLen();if(n<a){a<i&&ft(r,s,a,i-a);let e=En(o,n),c=o[e];!c.deleted&&c.id.clock<n&&(o.splice(e+1,0,Fs(t,c,n-c.id.clock)),e++);while(e<o.length){if(c=o[e++],!(c.id.clock<i))break;c.deleted||(i<c.id.clock+c.length&&o.splice(e,0,Fs(t,c,i-c.id.clock)),c.delete(t))}}else ft(r,s,n,i-n)}}if(r.clients.size>0){const e=new Rt;return F(e.restEncoder,0),yt(e,r),e.toUint8Array()}return null},vt=Ne.U7;class Et extends l{constructor({guid:e=Ne.k$(),collectionid:t=null,gc:n=!0,gcFilter:r=(()=>!0),meta:s=null,autoLoad:i=!1,shouldLoad:o=!0}={}){super(),this.gc=n,this.gcFilter=r,this.clientID=vt(),this.guid=e,this.collectionid=t,this.share=new Map,this.store=new yn,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=o,this.autoLoad=i,this.meta=s,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=De((e=>{this.on("load",(()=>{this.isLoaded=!0,e(this)}))}));const a=()=>De((e=>{const t=n=>{void 0!==n&&!0!==n||(this.off("sync",t),e())};this.on("sync",t)}));this.on("sync",(e=>{!1===e&&this.isSynced&&(this.whenSynced=a()),this.isSynced=void 0===e||!0===e,this.isLoaded||this.emit("load",[])})),this.whenSynced=a()}load(){const e=this._item;null===e||this.shouldLoad||Mn(e.parent.doc,(e=>{e.subdocsLoaded.add(this)}),null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(a(this.subdocs).map((e=>e.guid)))}transact(e,t=null){return Mn(this,e,t)}get(e,t=ur){const n=r.Yu(this.share,e,(()=>{const e=new t;return e._integrate(this,null),e})),s=n.constructor;if(t!==ur&&s!==t){if(s===ur){const r=new t;r._map=n._map,n._map.forEach((e=>{for(;null!==e;e=e.left)e.parent=r})),r._start=n._start;for(let e=r._start;null!==e;e=e.right)e.parent=r;return r._length=n._length,this.share.set(e,r),r._integrate(this,null),r}throw new Error(`Type with the name ${e} has already been defined with a different constructor`)}return n}getArray(e=""){return this.get(e,Or)}getText(e=""){return this.get(e,Jr)}getMap(e=""){return this.get(e,Dr)}getXmlFragment(e=""){return this.get(e,Zr)}toJSON(){const e={};return this.share.forEach(((t,n)=>{e[n]=t.toJSON()})),e}destroy(){a(this.subdocs).forEach((e=>e.destroy()));const e=this._item;if(null!==e){this._item=null;const t=e.content;t.doc=new Et({guid:this.guid,...t.opts,shouldLoad:!1}),t.doc._item=e,Mn(e.parent.doc,(n=>{const r=t.doc;e.deleted||n.subdocsAdded.add(r),n.subdocsRemoved.add(this)}),null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,t){super.on(e,t)}off(e,t){super.off(e,t)}}class _t{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ye(this.restDecoder)}readDsLen(){return ye(this.restDecoder)}}class St extends _t{readLeftID(){return en(ye(this.restDecoder),ye(this.restDecoder))}readRightID(){return en(ye(this.restDecoder),ye(this.restDecoder))}readClient(){return ye(this.restDecoder)}readInfo(){return me(this.restDecoder)}readString(){return Ee(this.restDecoder)}readParentInfo(){return 1===ye(this.restDecoder)}readTypeRef(){return ye(this.restDecoder)}readLen(){return ye(this.restDecoder)}readAny(){return Ce(this.restDecoder)}readBuf(){return b(ge(this.restDecoder))}readJSON(){return JSON.parse(Ee(this.restDecoder))}readKey(){return Ee(this.restDecoder)}}class kt{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ye(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ye(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class At extends kt{constructor(e){super(e),this.keys=[],ye(e),this.keyClockDecoder=new Oe(ge(e)),this.clientDecoder=new Re(ge(e)),this.leftClockDecoder=new Oe(ge(e)),this.rightClockDecoder=new Oe(ge(e)),this.infoDecoder=new Ie(ge(e),me),this.stringDecoder=new xe(ge(e)),this.parentInfoDecoder=new Ie(ge(e),me),this.typeRefDecoder=new Re(ge(e)),this.lenDecoder=new Re(ge(e))}readLeftID(){return new Xt(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Xt(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return 1===this.parentInfoDecoder.read()}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return Ce(this.restDecoder)}readBuf(){return ge(this.restDecoder)}readJSON(){return Ce(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const e=this.stringDecoder.read();return this.keys.push(e),e}}}class Tt{constructor(){this.restEncoder=P()}toUint8Array(){return M(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){F(this.restEncoder,e)}writeDsLen(e){F(this.restEncoder,e)}}class Ct extends Tt{writeLeftID(e){F(this.restEncoder,e.client),F(this.restEncoder,e.clock)}writeRightID(e){F(this.restEncoder,e.client),F(this.restEncoder,e.clock)}writeClient(e){F(this.restEncoder,e)}writeInfo(e){V(this.restEncoder,e)}writeString(e){q(this.restEncoder,e)}writeParentInfo(e){F(this.restEncoder,e?1:0)}writeTypeRef(e){F(this.restEncoder,e)}writeLen(e){F(this.restEncoder,e)}writeAny(e){te(this.restEncoder,e)}writeBuf(e){W(this.restEncoder,e)}writeJSON(e){q(this.restEncoder,JSON.stringify(e))}writeKey(e){q(this.restEncoder,e)}}class It{constructor(){this.restEncoder=P(),this.dsCurrVal=0}toUint8Array(){return M(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const t=e-this.dsCurrVal;this.dsCurrVal=e,F(this.restEncoder,t)}writeDsLen(e){0===e&&ce.zR(),F(this.restEncoder,e-1),this.dsCurrVal+=e}}class Rt extends It{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new oe,this.clientEncoder=new se,this.leftClockEncoder=new oe,this.rightClockEncoder=new oe,this.infoEncoder=new ne(V),this.stringEncoder=new ae,this.parentInfoEncoder=new ne(V),this.typeRefEncoder=new se,this.lenEncoder=new se}toUint8Array(){const e=P();return F(e,0),W(e,this.keyClockEncoder.toUint8Array()),W(e,this.clientEncoder.toUint8Array()),W(e,this.leftClockEncoder.toUint8Array()),W(e,this.rightClockEncoder.toUint8Array()),W(e,M(this.infoEncoder)),W(e,this.stringEncoder.toUint8Array()),W(e,M(this.parentInfoEncoder)),W(e,this.typeRefEncoder.toUint8Array()),W(e,this.lenEncoder.toUint8Array()),G(e,M(this.restEncoder)),M(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){te(this.restEncoder,e)}writeBuf(e){W(this.restEncoder,e)}writeJSON(e){te(this.restEncoder,e)}writeKey(e){const t=this.keyMap.get(e);void 0===t?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(t)}}const Ot=(e,t,n,r)=>{r=u.Fp(r,t[0].id.clock);const s=En(t,r);F(e.restEncoder,t.length-s),e.writeClient(n),F(e.restEncoder,r);const i=t[s];i.write(e,r-i.id.clock);for(let o=s+1;o<t.length;o++)t[o].write(e,0)},xt=(e,t,n)=>{const r=new Map;n.forEach(((e,n)=>{bn(t,n)>e&&r.set(n,e)})),wn(t).forEach(((e,t)=>{n.has(t)||r.set(t,0)})),F(e.restEncoder,r.size),a(r.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([n,r])=>{Ot(e,t.clients.get(n),n,r)}))},Nt=(e,t)=>{const n=r.Ue(),s=ye(e.restDecoder);for(let r=0;r<s;r++){const r=ye(e.restDecoder),s=new Array(r),i=e.readClient();let o=ye(e.restDecoder);n.set(i,{i:0,refs:s});for(let n=0;n<r;n++){const r=e.readInfo();switch(C&r){case 0:{const t=e.readLen();s[n]=new us(en(i,o),t),o+=t;break}case 10:{const t=ye(e.restDecoder);s[n]=new qs(en(i,o),t),o+=t;break}default:{const a=0===(r&(A|T)),c=new zs(en(i,o),null,(r&T)===T?e.readLeftID():null,null,(r&A)===A?e.readRightID():null,a?e.readParentInfo()?t.get(e.readString()):e.readLeftID():null,a&&(r&k)===k?e.readString():null,$s(e,r));s[n]=c,o+=c.length}}}}return n},Dt=(e,t,n)=>{const s=[];let i=a(n.keys()).sort(((e,t)=>e-t));if(0===i.length)return null;const o=()=>{if(0===i.length)return null;let e=n.get(i[i.length-1]);while(e.refs.length===e.i){if(i.pop(),!(i.length>0))return null;e=n.get(i[i.length-1])}return e};let c=o();if(null===c&&0===s.length)return null;const l=new yn,u=new Map,h=(e,t)=>{const n=u.get(e);(null==n||n>t)&&u.set(e,t)};let d=c.refs[c.i++];const p=new Map,f=()=>{for(const e of s){const t=e.id.client,r=n.get(t);r?(r.i--,l.clients.set(t,r.refs.slice(r.i)),n.delete(t),r.i=0,r.refs=[]):l.clients.set(t,[e]),i=i.filter((e=>e!==t))}s.length=0};while(1){if(d.constructor!==qs){const i=r.Yu(p,d.id.client,(()=>bn(t,d.id.client))),o=i-d.id.clock;if(o<0)s.push(d),h(d.id.client,d.id.clock-1),f();else{const r=d.getMissing(e,t);if(null!==r){s.push(d);const e=n.get(r)||{refs:[],i:0};if(e.refs.length!==e.i){d=e.refs[e.i++];continue}h(r,bn(t,r)),f()}else(0===o||o<d.length)&&(d.integrate(e,o),p.set(d.id.client,d.id.clock+d.length))}}if(s.length>0)d=s.pop();else if(null!==c&&c.i<c.refs.length)d=c.refs[c.i++];else{if(c=o(),null===c)break;d=c.refs[c.i++]}}if(l.clients.size>0){const e=new Rt;return xt(e,l,new Map),F(e.restEncoder,0),{missing:u,update:e.toUint8Array()}}return null},Pt=(e,t)=>xt(e,t.doc.store,t.beforeState),Lt=(e,t,n,r=new At(e))=>Mn(t,(e=>{e.local=!1;let t=!1;const n=e.doc,s=n.store,i=Nt(r,n),o=Dt(e,s,i),a=s.pendingStructs;if(a){for(const[e,n]of a.missing)if(n<bn(s,e)){t=!0;break}if(o){for(const[e,t]of o.missing){const n=a.missing.get(e);(null==n||n>t)&&a.missing.set(e,t)}a.update=qn([a.update,o.update])}}else s.pendingStructs=o;const c=bt(r,e,s);if(s.pendingDs){const t=new At(de(s.pendingDs));ye(t.restDecoder);const n=bt(t,e,s);s.pendingDs=c&&n?qn([c,n]):c||n}else s.pendingDs=c;if(t){const t=s.pendingStructs.update;s.pendingStructs=null,Mt(e.doc,t)}}),n,!1),Mt=(e,t,n,r=At)=>{const s=de(t);Lt(s,e,n,new r(s))},Bt=(e,t,n)=>Mt(e,t,n,St),Ut=(e,t,n=new Map)=>{xt(e,t.store,n),yt(e,mt(t.store))},Vt=(e,t=new Uint8Array([0]),n=new Rt)=>{const r=zt(t);Ut(n,e,r);const s=[n.toUint8Array()];if(e.store.pendingDs&&s.push(e.store.pendingDs),e.store.pendingStructs&&s.push(Gn(e.store.pendingStructs.update,t)),s.length>1){if(n.constructor===Ct)return Hn(s.map(((e,t)=>0===t?e:Xn(e))));if(n.constructor===Rt)return qn(s)}return s[0]},Ft=(e,t)=>Vt(e,t,new Ct),jt=e=>{const t=new Map,n=ye(e.restDecoder);for(let r=0;r<n;r++){const n=ye(e.restDecoder),r=ye(e.restDecoder);t.set(n,r)}return t},zt=e=>jt(new _t(de(e))),$t=(e,t)=>(F(e.restEncoder,t.size),a(t.entries()).sort(((e,t)=>t[0]-e[0])).forEach((([t,n])=>{F(e.restEncoder,t),F(e.restEncoder,n)})),e),Ht=(e,t)=>$t(e,wn(t.store)),Kt=(e,t=new It)=>(e instanceof Map?$t(t,e):Ht(t,e),t.toUint8Array()),qt=e=>Kt(e,new Tt);class Gt{constructor(){this.l=[]}}const Wt=()=>new Gt,Yt=(e,t)=>e.l.push(t),Jt=(e,t)=>{const n=e.l,r=n.length;e.l=n.filter((e=>t!==e)),r===e.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},Qt=(e,t,n)=>Pe.PP(e.l,[t,n]);class Xt{constructor(e,t){this.client=e,this.clock=t}}const Zt=(e,t)=>e===t||null!==e&&null!==t&&e.client===t.client&&e.clock===t.clock,en=(e,t)=>new Xt(e,t),tn=e=>{for(const[t,n]of e.doc.share.entries())if(n===e)return t;throw ce.zR()},nn=(e,t)=>{while(null!==t){if(t.parent===e)return!0;t=t.parent._item}return!1};class rn{constructor(e,t,n,r=0){this.type=e,this.tname=t,this.item=n,this.assoc=r}}const sn=e=>new rn(null==e.type?null:en(e.type.client,e.type.clock),e.tname||null,null==e.item?null:en(e.item.client,e.item.clock),null==e.assoc?0:e.assoc);class on{constructor(e,t,n=0){this.type=e,this.index=t,this.assoc=n}}const an=(e,t,n=0)=>new on(e,t,n),cn=(e,t,n)=>{let r=null,s=null;return null===e._item?s=tn(e):r=en(e._item.id.client,e._item.id.clock),new rn(r,s,t,n)},ln=(e,t,n=0)=>{let r=e._start;if(n<0){if(0===t)return cn(e,null,n);t--}while(null!==r){if(!r.deleted&&r.countable){if(r.length>t)return cn(e,en(r.id.client,r.id.clock+t),n);t-=r.length}if(null===r.right&&n<0)return cn(e,r.lastId,n);r=r.right}return cn(e,null,n)},un=(e,t)=>{const n=t.store,r=e.item,s=e.type,i=e.tname,o=e.assoc;let a=null,c=0;if(null!==r){if(bn(n,r.client)<=r.clock)return null;const e=Us(n,r),t=e.item;if(!(t instanceof zs))return null;if(a=t.parent,null===a._item||!a._item.deleted){c=t.deleted||!t.countable?0:e.diff+(o>=0?0:1);let n=t.left;while(null!==n)!n.deleted&&n.countable&&(c+=n.length),n=n.left}}else{if(null!==i)a=t.get(i);else{if(null===s)throw ce.zR();{if(bn(n,s.client)<=s.clock)return null;const{item:e}=Us(n,s);if(!(e instanceof zs&&e.content instanceof Ms))return null;a=e.content.type}}c=o>=0?a._length:0}return an(a,c,e.assoc)},hn=(e,t)=>e===t||null!==e&&null!==t&&e.tname===t.tname&&Zt(e.item,t.item)&&Zt(e.type,t.type)&&e.assoc===t.assoc;class dn{constructor(e,t){this.ds=e,this.sv=t}}const pn=(e,t)=>new dn(e,t),fn=(pn(gt(),new Map),e=>pn(mt(e.store),wn(e.store))),gn=(e,t)=>void 0===t?!e.deleted:t.sv.has(e.id.client)&&(t.sv.get(e.id.client)||0)>e.id.clock&&!ht(t.ds,e.id),mn=(e,t)=>{const n=r.Yu(e.meta,mn,s.Ue),i=e.doc.store;n.has(t)||(t.sv.forEach(((t,n)=>{t<bn(i,n)&&An(e,en(n,t))})),lt(e,t.ds,(e=>{})),n.add(t))};class yn{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const wn=e=>{const t=new Map;return e.clients.forEach(((e,n)=>{const r=e[e.length-1];t.set(n,r.id.clock+r.length)})),t},bn=(e,t)=>{const n=e.clients.get(t);if(void 0===n)return 0;const r=n[n.length-1];return r.id.clock+r.length},vn=(e,t)=>{let n=e.clients.get(t.id.client);if(void 0===n)n=[],e.clients.set(t.id.client,n);else{const e=n[n.length-1];if(e.id.clock+e.length!==t.id.clock)throw ce.zR()}n.push(t)},En=(e,t)=>{let n=0,r=e.length-1,s=e[r],i=s.id.clock;if(i===t)return r;let o=u.GW(t/(i+s.length-1)*r);while(n<=r){if(s=e[o],i=s.id.clock,i<=t){if(t<i+s.length)return o;n=o+1}else r=o-1;o=u.GW((n+r)/2)}throw ce.zR()},_n=(e,t)=>{const n=e.clients.get(t.client);return n[En(n,t.clock)]},Sn=_n,kn=(e,t,n)=>{const r=En(t,n),s=t[r];return s.id.clock<n&&s instanceof zs?(t.splice(r+1,0,Fs(e,s,n-s.id.clock)),r+1):r},An=(e,t)=>{const n=e.doc.store.clients.get(t.client);return n[kn(e,n,t.clock)]},Tn=(e,t,n)=>{const r=t.clients.get(n.client),s=En(r,n.clock),i=r[s];return n.clock!==i.id.clock+i.length-1&&i.constructor!==us&&r.splice(s+1,0,Fs(e,i,n.clock-i.id.clock+1)),i},Cn=(e,t,n)=>{const r=e.clients.get(t.id.client);r[En(r,t.id.clock)]=n},In=(e,t,n,r,s)=>{if(0===r)return;const i=n+r;let o,a=kn(e,t,n);do{o=t[a++],i<o.id.clock+o.length&&kn(e,t,i),s(o)}while(a<t.length&&t[a].id.clock<i)};class Rn{constructor(e,t,n){this.doc=e,this.deleteSet=new ct,this.beforeState=wn(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=t,this.meta=new Map,this.local=n,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set}}const On=(e,t)=>!(0===t.deleteSet.clients.size&&!r.Yj(t.afterState,((e,n)=>t.beforeState.get(n)!==e)))&&(dt(t.deleteSet),Pt(e,t),yt(e,t.deleteSet),!0),xn=(e,t,n)=>{const i=t._item;(null===i||i.id.clock<(e.beforeState.get(i.id.client)||0)&&!i.deleted)&&r.Yu(e.changed,t,s.Ue).add(n)},Nn=(e,t)=>{const n=e[t-1],r=e[t];n.deleted===r.deleted&&n.constructor===r.constructor&&n.mergeWith(r)&&(e.splice(t,1),r instanceof zs&&null!==r.parentSub&&r.parent._map.get(r.parentSub)===r&&r.parent._map.set(r.parentSub,n))},Dn=(e,t,n)=>{for(const[r,s]of e.clients.entries()){const e=t.clients.get(r);for(let r=s.length-1;r>=0;r--){const i=s[r],o=i.clock+i.len;for(let r=En(e,i.clock),s=e[r];r<e.length&&s.id.clock<o;s=e[++r]){const s=e[r];if(i.clock+i.len<=s.id.clock)break;s instanceof zs&&s.deleted&&!s.keep&&n(s)&&s.gc(t,!1)}}}},Pn=(e,t)=>{e.clients.forEach(((e,n)=>{const r=t.clients.get(n);for(let t=e.length-1;t>=0;t--){const n=e[t],s=u.VV(r.length-1,1+En(r,n.clock+n.len-1));for(let e=s,t=r[e];e>0&&t.id.clock>=n.clock;t=r[--e])Nn(r,e)}}))},Ln=(e,t)=>{if(t<e.length){const n=e[t],r=n.doc,s=r.store,i=n.deleteSet,o=n._mergeStructs;try{dt(i),n.afterState=wn(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const e=[];n.changed.forEach(((t,r)=>e.push((()=>{null!==r._item&&r._item.deleted||r._callObserver(n,t)})))),e.push((()=>{n.changedParentTypes.forEach(((t,r)=>e.push((()=>{null!==r._item&&r._item.deleted||(t=t.filter((e=>null===e.target._item||!e.target._item.deleted)),t.forEach((e=>{e.currentTarget=r})),t.sort(((e,t)=>e.path.length-t.path.length)),Qt(r._dEH,t,n))})))),e.push((()=>r.emit("afterTransaction",[n,r])))})),(0,Pe.PP)(e,[])}finally{r.gc&&Dn(i,s,r.gcFilter),Pn(i,s),n.afterState.forEach(((e,t)=>{const r=n.beforeState.get(t)||0;if(r!==e){const e=s.clients.get(t),n=u.Fp(En(e,r),1);for(let t=e.length-1;t>=n;t--)Nn(e,t)}}));for(let e=0;e<o.length;e++){const{client:t,clock:n}=o[e].id,r=s.clients.get(t),i=En(r,n);i+1<r.length&&Nn(r,i+1),i>0&&Nn(r,i)}if(n.local||n.afterState.get(r.clientID)===n.beforeState.get(r.clientID)||(tt(Ge,Fe,"[yjs] ",je,Ke,"Changed the client-id because another client seems to be using it."),r.clientID=vt()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const e=new Ct,t=On(e,n);t&&r.emit("update",[e.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const e=new Rt,t=On(e,n);t&&r.emit("updateV2",[e.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach((e=>{e.clientID=r.clientID,null==e.collectionid&&(e.collectionid=r.collectionid),r.subdocs.add(e)})),l.forEach((e=>r.subdocs.delete(e))),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach((e=>e.destroy()))),e.length<=t+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,e])):Ln(e,t+1)}}},Mn=(e,t,n=null,r=!0)=>{const s=e._transactionCleanups;let i=!1,o=null;null===e._transaction&&(i=!0,e._transaction=new Rn(e,n,r),s.push(e._transaction),1===s.length&&e.emit("beforeAllTransactions",[e]),e.emit("beforeTransaction",[e._transaction,e]));try{o=t(e._transaction)}finally{if(i){const t=e._transaction===s[0];e._transaction=null,t&&Ln(s,0)}}return o};class Bn{constructor(e,t){this.insertions=t,this.deletions=e,this.meta=new Map}}const Un=(e,t,n)=>{lt(e,n.deletions,(e=>{e instanceof zs&&t.scope.some((t=>nn(t,e)))&&Vs(e,!1)}))},Vn=(e,t,n)=>{let r=null,s=null;const i=e.doc,o=e.scope;if(Mn(i,(n=>{while(t.length>0&&null===r){const s=i.store,a=t.pop(),c=new Set,l=[];let u=!1;lt(n,a.insertions,(e=>{if(e instanceof zs){if(null!==e.redone){let{item:t,diff:r}=Us(s,e.id);r>0&&(t=An(n,en(t.id.client,t.id.clock+r))),e=t}!e.deleted&&o.some((t=>nn(t,e)))&&l.push(e)}})),lt(n,a.deletions,(e=>{e instanceof zs&&o.some((t=>nn(t,e)))&&!ht(a.insertions,e.id)&&c.add(e)})),c.forEach((t=>{u=null!==js(n,t,c,a.insertions,e.ignoreRemoteMapChanges)||u}));for(let t=l.length-1;t>=0;t--){const r=l[t];e.deleteFilter(r)&&(r.delete(n),u=!0)}r=u?a:null}n.changed.forEach(((e,t)=>{e.has(null)&&t._searchMarker&&(t._searchMarker.length=0)})),s=n}),e),null!=r){const t=s.changedParentTypes;e.emit("stack-item-popped",[{stackItem:r,type:n,changedParentTypes:t},e])}return r};class Fn extends l{constructor(e,{captureTimeout:t=500,captureTransaction:n=(e=>!0),deleteFilter:r=(()=>!0),trackedOrigins:s=new Set([null]),ignoreRemoteMapChanges:i=!1,doc:o=(c(e)?e[0].doc:e.doc)}={}){super(),this.scope=[],this.addToScope(e),this.deleteFilter=r,s.add(this),this.trackedOrigins=s,this.captureTransaction=n,this.undoStack=[],this.redoStack=[],this.undoing=!1,this.redoing=!1,this.doc=o,this.lastChange=0,this.ignoreRemoteMapChanges=i,this.captureTimeout=t,this.afterTransactionHandler=e=>{if(!this.captureTransaction(e)||!this.scope.some((t=>e.changedParentTypes.has(t)))||!this.trackedOrigins.has(e.origin)&&(!e.origin||!this.trackedOrigins.has(e.origin.constructor)))return;const t=this.undoing,n=this.redoing,r=t?this.redoStack:this.undoStack;t?this.stopCapturing():n||this.clear(!1,!0);const s=new ct;e.afterState.forEach(((t,n)=>{const r=e.beforeState.get(n)||0,i=t-r;i>0&&ft(s,n,r,i)}));const i=Ve();let o=!1;if(this.lastChange>0&&i-this.lastChange<this.captureTimeout&&r.length>0&&!t&&!n){const t=r[r.length-1];t.deletions=pt([t.deletions,e.deleteSet]),t.insertions=pt([t.insertions,s])}else r.push(new Bn(e.deleteSet,s)),o=!0;t||n||(this.lastChange=i),lt(e,e.deleteSet,(e=>{e instanceof zs&&this.scope.some((t=>nn(t,e)))&&Vs(e,!0)}));const a=[{stackItem:r[r.length-1],origin:e.origin,type:t?"redo":"undo",changedParentTypes:e.changedParentTypes},this];o?this.emit("stack-item-added",a):this.emit("stack-item-updated",a)},this.doc.on("afterTransaction",this.afterTransactionHandler),this.doc.on("destroy",(()=>{this.destroy()}))}addToScope(e){e=c(e)?e:[e],e.forEach((e=>{this.scope.every((t=>t!==e))&&this.scope.push(e)}))}addTrackedOrigin(e){this.trackedOrigins.add(e)}removeTrackedOrigin(e){this.trackedOrigins.delete(e)}clear(e=!0,t=!0){(e&&this.canUndo()||t&&this.canRedo())&&this.doc.transact((n=>{e&&(this.undoStack.forEach((e=>Un(n,this,e))),this.undoStack=[]),t&&(this.redoStack.forEach((e=>Un(n,this,e))),this.redoStack=[]),this.emit("stack-cleared",[{undoStackCleared:e,redoStackCleared:t}])}))}stopCapturing(){this.lastChange=0}undo(){let e;this.undoing=!0;try{e=Vn(this,this.undoStack,"undo")}finally{this.undoing=!1}return e}redo(){let e;this.redoing=!0;try{e=Vn(this,this.redoStack,"redo")}finally{this.redoing=!1}return e}canUndo(){return this.undoStack.length>0}canRedo(){return this.redoStack.length>0}destroy(){this.trackedOrigins.delete(this),this.doc.off("afterTransaction",this.afterTransactionHandler),super.destroy()}}function*jn(e){const t=ye(e.restDecoder);for(let n=0;n<t;n++){const t=ye(e.restDecoder),n=e.readClient();let r=ye(e.restDecoder);for(let s=0;s<t;s++){const t=e.readInfo();if(10===t){const t=ye(e.restDecoder);yield new qs(en(n,r),t),r+=t}else if(0!==(C&t)){const s=0===(t&(A|T)),i=new zs(en(n,r),null,(t&T)===T?e.readLeftID():null,null,(t&A)===A?e.readRightID():null,s?e.readParentInfo()?e.readString():e.readLeftID():null,s&&(t&k)===k?e.readString():null,$s(e,t));yield i,r+=i.length}else{const t=e.readLen();yield new us(en(n,r),t),r+=t}}}}class zn{constructor(e,t){this.gen=jn(e),this.curr=null,this.done=!1,this.filterSkips=t,this.next()}next(){do{this.curr=this.gen.next().value||null}while(this.filterSkips&&null!==this.curr&&this.curr.constructor===qs);return this.curr}}class $n{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const Hn=e=>qn(e,St,Ct),Kn=(e,t)=>{if(e.constructor===us){const{client:n,clock:r}=e.id;return new us(en(n,r+t),e.length-t)}if(e.constructor===qs){const{client:n,clock:r}=e.id;return new qs(en(n,r+t),e.length-t)}{const n=e,{client:r,clock:s}=n.id;return new zs(en(r,s+t),null,en(r,s+t-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(t))}},qn=(e,t=At,n=Rt)=>{if(1===e.length)return e[0];const r=e.map((e=>new t(de(e))));let s=r.map((e=>new zn(e,!0))),i=null;const o=new n,a=new $n(o);while(1){if(s=s.filter((e=>null!==e.curr)),s.sort(((e,t)=>{if(e.curr.id.client===t.curr.id.client){const n=e.curr.id.clock-t.curr.id.clock;return 0===n?e.curr.constructor===t.curr.constructor?0:e.curr.constructor===qs?1:-1:n}return t.curr.id.client-e.curr.id.client})),0===s.length)break;const e=s[0],t=e.curr.id.client;if(null!==i){let n=e.curr,r=!1;while(null!==n&&n.id.clock+n.length<=i.struct.id.clock+i.struct.length&&n.id.client>=i.struct.id.client)n=e.next(),r=!0;if(null===n||n.id.client!==t||r&&n.id.clock>i.struct.id.clock+i.struct.length)continue;if(t!==i.struct.id.client)Yn(a,i.struct,i.offset),i={struct:n,offset:0},e.next();else if(i.struct.id.clock+i.struct.length<n.id.clock)if(i.struct.constructor===qs)i.struct.length=n.id.clock+n.length-i.struct.id.clock;else{Yn(a,i.struct,i.offset);const e=n.id.clock-i.struct.id.clock-i.struct.length,r=new qs(en(t,i.struct.id.clock+i.struct.length),e);i={struct:r,offset:0}}else{const t=i.struct.id.clock+i.struct.length-n.id.clock;t>0&&(i.struct.constructor===qs?i.struct.length-=t:n=Kn(n,t)),i.struct.mergeWith(n)||(Yn(a,i.struct,i.offset),i={struct:n,offset:0},e.next())}}else i={struct:e.curr,offset:0},e.next();for(let n=e.curr;null!==n&&n.id.client===t&&n.id.clock===i.struct.id.clock+i.struct.length&&n.constructor!==qs;n=e.next())Yn(a,i.struct,i.offset),i={struct:n,offset:0}}null!==i&&(Yn(a,i.struct,i.offset),i=null),Jn(a);const c=r.map((e=>wt(e))),l=pt(c);return yt(o,l),o.toUint8Array()},Gn=(e,t,n=At,r=Rt)=>{const s=zt(t),i=new r,o=new $n(i),a=new n(de(e)),c=new zn(a,!1);while(c.curr){const e=c.curr,t=e.id.client,n=s.get(t)||0;if(c.curr.constructor!==qs)if(e.id.clock+e.length>n){Yn(o,e,u.Fp(n-e.id.clock,0)),c.next();while(c.curr&&c.curr.id.client===t)Yn(o,c.curr,0),c.next()}else while(c.curr&&c.curr.id.client===t&&c.curr.id.clock+c.curr.length<=n)c.next();else c.next()}Jn(o);const l=wt(a);return yt(i,l),i.toUint8Array()},Wn=e=>{e.written>0&&(e.clientStructs.push({written:e.written,restEncoder:M(e.encoder.restEncoder)}),e.encoder.restEncoder=P(),e.written=0)},Yn=(e,t,n)=>{e.written>0&&e.currClient!==t.id.client&&Wn(e),0===e.written&&(e.currClient=t.id.client,e.encoder.writeClient(t.id.client),F(e.encoder.restEncoder,t.id.clock+n)),t.write(e.encoder,n),e.written++},Jn=e=>{Wn(e);const t=e.encoder.restEncoder;F(t,e.clientStructs.length);for(let n=0;n<e.clientStructs.length;n++){const r=e.clientStructs[n];F(t,r.written),G(t,r.restEncoder)}},Qn=(e,t,n)=>{const r=new t(de(e)),s=new zn(r,!1),i=new n,o=new $n(i);for(let c=s.curr;null!==c;c=s.next())Yn(o,c,0);Jn(o);const a=wt(r);return yt(i,a),i.toUint8Array()},Xn=e=>Qn(e,At,Ct);class Zn{constructor(e,t){this.target=e,this.currentTarget=e,this.transaction=t,this._changes=null,this._keys=null,this._delta=null}get path(){return er(this.currentTarget,this.target)}deletes(e){return ht(this.transaction.deleteSet,e.id)}get keys(){if(null===this._keys){const e=new Map,t=this.target,n=this.transaction.changed.get(t);n.forEach((n=>{if(null!==n){const r=t._map.get(n);let s,o;if(this.adds(r)){let e=r.left;while(null!==e&&this.adds(e))e=e.left;if(this.deletes(r)){if(null===e||!this.deletes(e))return;s="delete",o=i(e.content.getContent())}else null!==e&&this.deletes(e)?(s="update",o=i(e.content.getContent())):(s="add",o=void 0)}else{if(!this.deletes(r))return;s="delete",o=i(r.content.getContent())}e.set(n,{action:s,oldValue:o})}})),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(null===e){const t=this.target,n=s.Ue(),r=s.Ue(),i=[];e={added:n,deleted:r,delta:i,keys:this.keys};const o=this.transaction.changed.get(t);if(o.has(null)){let e=null;const s=()=>{e&&i.push(e)};for(let i=t._start;null!==i;i=i.right)i.deleted?this.deletes(i)&&!this.adds(i)&&(null!==e&&void 0!==e.delete||(s(),e={delete:0}),e.delete+=i.length,r.add(i)):this.adds(i)?(null!==e&&void 0!==e.insert||(s(),e={insert:[]}),e.insert=e.insert.concat(i.content.getContent()),n.add(i)):(null!==e&&void 0!==e.retain||(s(),e={retain:0}),e.retain+=i.length);null!==e&&void 0===e.retain&&s()}this._changes=e}return e}}const er=(e,t)=>{const n=[];while(null!==t._item&&t!==e){if(null!==t._item.parentSub)n.unshift(t._item.parentSub);else{let e=0,r=t._item.parent._start;while(r!==t._item&&null!==r)r.deleted||e++,r=r.right;n.unshift(e)}t=t._item.parent}return n},tr=80;let nr=0;class rr{constructor(e,t){e.marker=!0,this.p=e,this.index=t,this.timestamp=nr++}}const sr=e=>{e.timestamp=nr++},ir=(e,t,n)=>{e.p.marker=!1,e.p=t,t.marker=!0,e.index=n,e.timestamp=nr++},or=(e,t,n)=>{if(e.length>=tr){const r=e.reduce(((e,t)=>e.timestamp<t.timestamp?e:t));return ir(r,t,n),r}{const r=new rr(t,n);return e.push(r),r}},ar=(e,t)=>{if(null===e._start||0===t||null===e._searchMarker)return null;const n=0===e._searchMarker.length?null:e._searchMarker.reduce(((e,n)=>u.Wn(t-e.index)<u.Wn(t-n.index)?e:n));let r=e._start,s=0;null!==n&&(r=n.p,s=n.index,sr(n));while(null!==r.right&&s<t){if(!r.deleted&&r.countable){if(t<s+r.length)break;s+=r.length}r=r.right}while(null!==r.left&&s>t)r=r.left,!r.deleted&&r.countable&&(s-=r.length);while(null!==r.left&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return null!==n&&u.Wn(n.index-s)<r.parent.length/tr?(ir(n,r,s),n):or(e._searchMarker,r,s)},cr=(e,t,n)=>{for(let r=e.length-1;r>=0;r--){const s=e[r];if(n>0){let t=s.p;t.marker=!1;while(t&&(t.deleted||!t.countable))t=t.left,t&&!t.deleted&&t.countable&&(s.index-=t.length);if(null===t||!0===t.marker){e.splice(r,1);continue}s.p=t,t.marker=!0}(t<s.index||n>0&&t===s.index)&&(s.index=u.Fp(t,s.index+n))}},lr=(e,t,n)=>{const s=e,i=t.changedParentTypes;while(1){if(r.Yu(i,e,(()=>[])).push(n),null===e._item)break;e=e._item.parent}Qt(s._eH,n,t)};class ur{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Wt(),this._dEH=Wt(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,t){this.doc=e,this._item=t}_copy(){throw ce.Nw()}clone(){throw ce.Nw()}_write(e){}get _first(){let e=this._start;while(null!==e&&e.deleted)e=e.right;return e}_callObserver(e,t){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Yt(this._eH,e)}observeDeep(e){Yt(this._dEH,e)}unobserve(e){Jt(this._eH,e)}unobserveDeep(e){Jt(this._dEH,e)}toJSON(){}}const hr=(e,t,n)=>{t<0&&(t=e._length+t),n<0&&(n=e._length+n);let r=n-t;const s=[];let i=e._start;while(null!==i&&r>0){if(i.countable&&!i.deleted){const e=i.content.getContent();if(e.length<=t)t-=e.length;else{for(let n=t;n<e.length&&r>0;n++)s.push(e[n]),r--;t=0}}i=i.right}return s},dr=e=>{const t=[];let n=e._start;while(null!==n){if(n.countable&&!n.deleted){const e=n.content.getContent();for(let n=0;n<e.length;n++)t.push(e[n])}n=n.right}return t},pr=(e,t)=>{const n=[];let r=e._start;while(null!==r){if(r.countable&&gn(r,t)){const e=r.content.getContent();for(let t=0;t<e.length;t++)n.push(e[t])}r=r.right}return n},fr=(e,t)=>{let n=0,r=e._start;while(null!==r){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let r=0;r<s.length;r++)t(s[r],n++,e)}r=r.right}},gr=(e,t)=>{const n=[];return fr(e,((r,s)=>{n.push(t(r,s,e))})),n},mr=e=>{let t=e._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(null===n){while(null!==t&&t.deleted)t=t.right;if(null===t)return{done:!0,value:void 0};n=t.content.getContent(),r=0,t=t.right}const e=n[r++];return n.length<=r&&(n=null),{done:!1,value:e}}}},yr=(e,t)=>{const n=ar(e,t);let r=e._start;for(null!==n&&(r=n.p,t-=n.index);null!==r;r=r.right)if(!r.deleted&&r.countable){if(t<r.length)return r.content.getContent()[t];t-=r.length}},wr=(e,t,n,r)=>{let s=n;const i=e.doc,o=i.clientID,a=i.store,c=null===n?t._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new zs(en(o,bn(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new ks(l)),s.integrate(e,0),l=[])};r.forEach((n=>{if(null===n)l.push(n);else switch(n.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(n);break;default:switch(u(),n.constructor){case Uint8Array:case ArrayBuffer:s=new zs(en(o,bn(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new hs(new Uint8Array(n))),s.integrate(e,0);break;case Et:s=new zs(en(o,bn(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new ms(n)),s.integrate(e,0);break;default:if(!(n instanceof ur))throw new Error("Unexpected content type in insert operation");s=new zs(en(o,bn(a,o)),s,s&&s.lastId,c,c&&c.id,t,null,new Ms(n)),s.integrate(e,0)}}})),u()},br=ce.Ue("Length exceeded!"),vr=(e,t,n,r)=>{if(n>t._length)throw br;if(0===n)return t._searchMarker&&cr(t._searchMarker,n,r.length),wr(e,t,null,r);const s=n,i=ar(t,n);let o=t._start;for(null!==i&&(o=i.p,n-=i.index,0===n&&(o=o.prev,n+=o&&o.countable&&!o.deleted?o.length:0));null!==o;o=o.right)if(!o.deleted&&o.countable){if(n<=o.length){n<o.length&&An(e,en(o.id.client,o.id.clock+n));break}n-=o.length}return t._searchMarker&&cr(t._searchMarker,s,r.length),wr(e,t,o,r)},Er=(e,t,n)=>{const r=(t._searchMarker||[]).reduce(((e,t)=>t.index>e.index?t:e),{index:0,p:t._start});let s=r.p;if(s)while(s.right)s=s.right;return wr(e,t,s,n)},_r=(e,t,n,r)=>{if(0===r)return;const s=n,i=r,o=ar(t,n);let a=t._start;for(null!==o&&(a=o.p,n-=o.index);null!==a&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&An(e,en(a.id.client,a.id.clock+n)),n-=a.length);while(r>0&&null!==a)a.deleted||(r<a.length&&An(e,en(a.id.client,a.id.clock+r)),a.delete(e),r-=a.length),a=a.right;if(r>0)throw br;t._searchMarker&&cr(t._searchMarker,s,-i+r)},Sr=(e,t,n)=>{const r=t._map.get(n);void 0!==r&&r.delete(e)},kr=(e,t,n,r)=>{const s=t._map.get(n)||null,i=e.doc,o=i.clientID;let a;if(null==r)a=new ks([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new ks([r]);break;case Uint8Array:a=new hs(r);break;case Et:a=new ms(r);break;default:if(!(r instanceof ur))throw new Error("Unexpected content type");a=new Ms(r)}new zs(en(o,bn(i.store,o)),s,s&&s.lastId,null,null,t,n,a).integrate(e,0)},Ar=(e,t)=>{const n=e._map.get(t);return void 0===n||n.deleted?void 0:n.content.getContent()[n.length-1]},Tr=e=>{const t={};return e._map.forEach(((e,n)=>{e.deleted||(t[n]=e.content.getContent()[e.length-1])})),t},Cr=(e,t)=>{const n=e._map.get(t);return void 0!==n&&!n.deleted},Ir=e=>st(e.entries(),(e=>!e[1].deleted));class Rr extends Zn{constructor(e,t){super(e,t),this._transaction=t}}class Or extends ur{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const t=new Or;return t.push(e),t}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Or}clone(){const e=new Or;return e.insert(0,this.toArray().map((e=>e instanceof ur?e.clone():e))),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}_callObserver(e,t){super._callObserver(e,t),lr(this,e,new Rr(this,e))}insert(e,t){null!==this.doc?Mn(this.doc,(n=>{vr(n,this,e,t)})):this._prelimContent.splice(e,0,...t)}push(e){null!==this.doc?Mn(this.doc,(t=>{Er(t,this,e)})):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,t=1){null!==this.doc?Mn(this.doc,(n=>{_r(n,this,e,t)})):this._prelimContent.splice(e,t)}get(e){return yr(this,e)}toArray(){return dr(this)}slice(e=0,t=this.length){return hr(this,e,t)}toJSON(){return this.map((e=>e instanceof ur?e.toJSON():e))}map(e){return gr(this,e)}forEach(e){fr(this,e)}[Symbol.iterator](){return mr(this)}_write(e){e.writeTypeRef(Rs)}}const xr=e=>new Or;class Nr extends Zn{constructor(e,t,n){super(e,t),this.keysChanged=n}}class Dr extends ur{constructor(e){super(),this._prelimContent=null,this._prelimContent=void 0===e?new Map:new Map(e)}_integrate(e,t){super._integrate(e,t),this._prelimContent.forEach(((e,t)=>{this.set(t,e)})),this._prelimContent=null}_copy(){return new Dr}clone(){const e=new Dr;return this.forEach(((t,n)=>{e.set(n,t instanceof ur?t.clone():t)})),e}_callObserver(e,t){lr(this,e,new Nr(this,e,t))}toJSON(){const e={};return this._map.forEach(((t,n)=>{if(!t.deleted){const r=t.content.getContent()[t.length-1];e[n]=r instanceof ur?r.toJSON():r}})),e}get size(){return[...Ir(this._map)].length}keys(){return it(Ir(this._map),(e=>e[0]))}values(){return it(Ir(this._map),(e=>e[1].content.getContent()[e[1].length-1]))}entries(){return it(Ir(this._map),(e=>[e[0],e[1].content.getContent()[e[1].length-1]]))}forEach(e){this._map.forEach(((t,n)=>{t.deleted||e(t.content.getContent()[t.length-1],n,this)}))}[Symbol.iterator](){return this.entries()}delete(e){null!==this.doc?Mn(this.doc,(t=>{Sr(t,this,e)})):this._prelimContent.delete(e)}set(e,t){return null!==this.doc?Mn(this.doc,(n=>{kr(n,this,e,t)})):this._prelimContent.set(e,t),t}get(e){return Ar(this,e)}has(e){return Cr(this,e)}clear(){null!==this.doc?Mn(this.doc,(e=>{this.forEach((function(t,n,r){Sr(e,r,n)}))})):this._prelimContent.clear()}_write(e){e.writeTypeRef(Os)}}const Pr=e=>new Dr,Lr=(e,t)=>e===t||"object"===typeof e&&"object"===typeof t&&e&&t&&ot.$m(e,t);class Mr{constructor(e,t,n,r){this.left=e,this.right=t,this.index=n,this.currentAttributes=r}forward(){switch(null===this.right&&ce.zR(),this.right.content.constructor){case vs:this.right.deleted||Fr(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Br=(e,t,n)=>{while(null!==t.right&&n>0){switch(t.right.content.constructor){case vs:t.right.deleted||Fr(t.currentAttributes,t.right.content);break;default:t.right.deleted||(n<t.right.length&&An(e,en(t.right.id.client,t.right.id.clock+n)),t.index+=t.right.length,n-=t.right.length);break}t.left=t.right,t.right=t.right.right}return t},Ur=(e,t,n)=>{const r=new Map,s=ar(t,n);if(s){const t=new Mr(s.p.left,s.p,s.index,r);return Br(e,t,n-s.index)}{const s=new Mr(null,t._start,0,r);return Br(e,s,n)}},Vr=(e,t,n,r)=>{while(null!==n.right&&(!0===n.right.deleted||n.right.content.constructor===vs&&Lr(r.get(n.right.content.key),n.right.content.value)))n.right.deleted||r.delete(n.right.content.key),n.forward();const s=e.doc,i=s.clientID;r.forEach(((r,o)=>{const a=n.left,c=n.right,l=new zs(en(i,bn(s.store,i)),a,a&&a.lastId,c,c&&c.id,t,null,new vs(o,r));l.integrate(e,0),n.right=l,n.forward()}))},Fr=(e,t)=>{const{key:n,value:r}=t;null===r?e.delete(n):e.set(n,r)},jr=(e,t)=>{while(1){if(null===e.right)break;if(!(e.right.deleted||e.right.content.constructor===vs&&Lr(t[e.right.content.key]||null,e.right.content.value)))break;e.forward()}},zr=(e,t,n,r)=>{const s=e.doc,i=s.clientID,o=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)||null;if(!Lr(l,c)){o.set(a,l);const{left:r,right:u}=n;n.right=new zs(en(i,bn(s.store,i)),r,r&&r.lastId,u,u&&u.id,t,null,new vs(a,c)),n.right.integrate(e,0),n.forward()}}return o},$r=(e,t,n,r,s)=>{n.currentAttributes.forEach(((e,t)=>{void 0===s[t]&&(s[t]=null)}));const i=e.doc,o=i.clientID;jr(n,s);const a=zr(e,t,n,s),c=r.constructor===String?new Ts(r):r instanceof ur?new Ms(r):new ws(r);let{left:l,right:u,index:h}=n;t._searchMarker&&cr(t._searchMarker,n.index,c.getLength()),u=new zs(en(o,bn(i.store,o)),l,l&&l.lastId,u,u&&u.id,t,null,c),u.integrate(e,0),n.right=u,n.index=h,n.forward(),Vr(e,t,n,a)},Hr=(e,t,n,r,s)=>{const i=e.doc,o=i.clientID;jr(n,s);const a=zr(e,t,n,s);e:while(null!==n.right&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===vs))){if(!n.right.deleted)switch(n.right.content.constructor){case vs:{const{key:t,value:i}=n.right.content,o=s[t];if(void 0!==o){if(Lr(o,i))a.delete(t);else{if(0===r)break e;a.set(t,i)}n.right.delete(e)}else n.currentAttributes.set(t,i);break}default:r<n.right.length&&An(e,en(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let s="";for(;r>0;r--)s+="\n";n.right=new zs(en(o,bn(i.store,o)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,t,null,new Ts(s)),n.right.integrate(e,0),n.forward()}Vr(e,t,n,a)},Kr=(e,t,n,s,i)=>{let o=t;const a=r.Ue();while(o&&(!o.countable||o.deleted)){if(!o.deleted&&o.content.constructor===vs){const e=o.content;a.set(e.key,e)}o=o.right}let c=0,l=!1;while(t!==o){if(n===t&&(l=!0),!t.deleted){const n=t.content;switch(n.constructor){case vs:{const{key:r,value:o}=n,u=s.get(r)||null;a.get(r)===n&&u!==o||(t.delete(e),c++,l||(i.get(r)||null)!==o||u===o||(null===u?i.delete(r):i.set(r,u))),l||t.deleted||Fr(i,n);break}}}t=t.right}return c},qr=(e,t)=>{while(t&&t.right&&(t.right.deleted||!t.right.countable))t=t.right;const n=new Set;while(t&&(t.deleted||!t.countable)){if(!t.deleted&&t.content.constructor===vs){const r=t.content.key;n.has(r)?t.delete(e):n.add(r)}t=t.left}},Gr=e=>{let t=0;return Mn(e.doc,(n=>{let s=e._start,i=e._start,o=r.Ue();const a=r.JG(o);while(i){if(!1===i.deleted)switch(i.content.constructor){case vs:Fr(a,i.content);break;default:t+=Kr(n,s,i,o,a),o=r.JG(a),s=i;break}i=i.right}})),t},Wr=(e,t,n)=>{const s=n,i=r.JG(t.currentAttributes),o=t.right;while(n>0&&null!==t.right){if(!1===t.right.deleted)switch(t.right.content.constructor){case Ms:case ws:case Ts:n<t.right.length&&An(e,en(t.right.id.client,t.right.id.clock+n)),n-=t.right.length,t.right.delete(e);break}t.forward()}o&&Kr(e,o,t.right,i,t.currentAttributes);const a=(t.left||t.right).parent;return a._searchMarker&&cr(a._searchMarker,t.index,-s+n),t};class Yr extends Zn{constructor(e,t,n){super(e,t),this.childListChanged=!1,this.keysChanged=new Set,n.forEach((e=>{null===e?this.childListChanged=!0:this.keysChanged.add(e)}))}get changes(){if(null===this._changes){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(null===this._delta){const e=this.target.doc,t=[];Mn(e,(e=>{const n=new Map,r=new Map;let s=this.target._start,i=null;const o={};let a="",c=0,l=0;const u=()=>{if(null!==i){let e;switch(i){case"delete":e={delete:l},l=0;break;case"insert":e={insert:a},n.size>0&&(e.attributes={},n.forEach(((t,n)=>{null!==t&&(e.attributes[n]=t)}))),a="";break;case"retain":if(e={retain:c},Object.keys(o).length>0){e.attributes={};for(const t in o)e.attributes[t]=o[t]}c=0;break}t.push(e),i=null}};while(null!==s){switch(s.content.constructor){case Ms:case ws:this.adds(s)?this.deletes(s)||(u(),i="insert",a=s.content.getContent()[0],u()):this.deletes(s)?("delete"!==i&&(u(),i="delete"),l+=1):s.deleted||("retain"!==i&&(u(),i="retain"),c+=1);break;case Ts:this.adds(s)?this.deletes(s)||("insert"!==i&&(u(),i="insert"),a+=s.content.str):this.deletes(s)?("delete"!==i&&(u(),i="delete"),l+=s.length):s.deleted||("retain"!==i&&(u(),i="retain"),c+=s.length);break;case vs:{const{key:t,value:a}=s.content;if(this.adds(s)){if(!this.deletes(s)){const c=n.get(t)||null;Lr(c,a)?null!==a&&s.delete(e):("retain"===i&&u(),Lr(a,r.get(t)||null)?delete o[t]:o[t]=a)}}else if(this.deletes(s)){r.set(t,a);const e=n.get(t)||null;Lr(e,a)||("retain"===i&&u(),o[t]=e)}else if(!s.deleted){r.set(t,a);const n=o[t];void 0!==n&&(Lr(n,a)?null!==n&&s.delete(e):("retain"===i&&u(),null===a?delete o[t]:o[t]=a))}s.deleted||("insert"===i&&u(),Fr(n,s.content));break}}s=s.right}u();while(t.length>0){const e=t[t.length-1];if(void 0===e.retain||void 0!==e.attributes)break;t.pop()}})),this._delta=t}return this._delta}}class Jr extends ur{constructor(e){super(),this._pending=void 0!==e?[()=>this.insert(0,e)]:[],this._searchMarker=[]}get length(){return this._length}_integrate(e,t){super._integrate(e,t);try{this._pending.forEach((e=>e()))}catch(n){console.error(n)}this._pending=null}_copy(){return new Jr}clone(){const e=new Jr;return e.applyDelta(this.toDelta()),e}_callObserver(e,t){super._callObserver(e,t);const n=new Yr(this,e,t),r=e.doc;if(lr(this,e,n),!e.local){let t=!1;for(const[n,s]of e.afterState.entries()){const i=e.beforeState.get(n)||0;if(s!==i&&(In(e,r.store.clients.get(n),i,s,(e=>{e.deleted||e.content.constructor!==vs||(t=!0)})),t))break}t||lt(e,e.deleteSet,(e=>{e instanceof us||t||e.parent===this&&e.content.constructor===vs&&(t=!0)})),Mn(r,(e=>{t?Gr(this):lt(e,e.deleteSet,(t=>{t instanceof us||t.parent===this&&qr(e,t)}))}))}}toString(){let e="",t=this._start;while(null!==t)!t.deleted&&t.countable&&t.content.constructor===Ts&&(e+=t.content.str),t=t.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:t=!0}={}){null!==this.doc?Mn(this.doc,(n=>{const r=new Mr(null,this._start,0,new Map);for(let s=0;s<e.length;s++){const i=e[s];if(void 0!==i.insert){const o=t||"string"!==typeof i.insert||s!==e.length-1||null!==r.right||"\n"!==i.insert.slice(-1)?i.insert:i.insert.slice(0,-1);("string"!==typeof o||o.length>0)&&$r(n,this,r,o,i.attributes||{})}else void 0!==i.retain?Hr(n,this,r,i.retain,i.attributes||{}):void 0!==i.delete&&Wr(n,r,i.delete)}})):this._pending.push((()=>this.applyDelta(e)))}toDelta(e,t,n){const r=[],s=new Map,i=this.doc;let o="",a=this._start;function c(){if(o.length>0){const e={};let t=!1;s.forEach(((n,r)=>{t=!0,e[r]=n}));const n={insert:o};t&&(n.attributes=e),r.push(n),o=""}}const l=()=>{while(null!==a){if(gn(a,e)||void 0!==t&&gn(a,t))switch(a.content.constructor){case Ts:{const r=s.get("ychange");void 0===e||gn(a,e)?void 0===t||gn(a,t)?void 0!==r&&(c(),s.delete("ychange")):void 0!==r&&r.user===a.id.client&&"added"===r.type||(c(),s.set("ychange",n?n("added",a.id):{type:"added"})):void 0!==r&&r.user===a.id.client&&"removed"===r.type||(c(),s.set("ychange",n?n("removed",a.id):{type:"removed"})),o+=a.content.str;break}case Ms:case ws:{c();const e={insert:a.content.getContent()[0]};if(s.size>0){const t={};e.attributes=t,s.forEach(((e,n)=>{t[n]=e}))}r.push(e);break}case vs:gn(a,e)&&(c(),Fr(s,a.content));break}a=a.right}c()};return e||t?Mn(i,(n=>{e&&mn(n,e),t&&mn(n,t),l()}),"cleanup"):l(),r}insert(e,t,n){if(t.length<=0)return;const r=this.doc;null!==r?Mn(r,(r=>{const s=Ur(r,this,e);n||(n={},s.currentAttributes.forEach(((e,t)=>{n[t]=e}))),$r(r,this,s,t,n)})):this._pending.push((()=>this.insert(e,t,n)))}insertEmbed(e,t,n={}){const r=this.doc;null!==r?Mn(r,(r=>{const s=Ur(r,this,e);$r(r,this,s,t,n)})):this._pending.push((()=>this.insertEmbed(e,t,n)))}delete(e,t){if(0===t)return;const n=this.doc;null!==n?Mn(n,(n=>{Wr(n,Ur(n,this,e),t)})):this._pending.push((()=>this.delete(e,t)))}format(e,t,n){if(0===t)return;const r=this.doc;null!==r?Mn(r,(r=>{const s=Ur(r,this,e);null!==s.right&&Hr(r,this,s,t,n)})):this._pending.push((()=>this.format(e,t,n)))}removeAttribute(e){null!==this.doc?Mn(this.doc,(t=>{Sr(t,this,e)})):this._pending.push((()=>this.removeAttribute(e)))}setAttribute(e,t){null!==this.doc?Mn(this.doc,(n=>{kr(n,this,e,t)})):this._pending.push((()=>this.setAttribute(e,t)))}getAttribute(e){return Ar(this,e)}getAttributes(){return Tr(this)}_write(e){e.writeTypeRef(xs)}}const Qr=e=>new Jr;class Xr{constructor(e,t=(()=>!0)){this._filter=t,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,t=e&&e.content&&e.content.type;if(null!==e&&(!this._firstCall||e.deleted||!this._filter(t)))do{if(t=e.content.type,e.deleted||t.constructor!==ts&&t.constructor!==Zr||null===t._start)while(null!==e){if(null!==e.right){e=e.right;break}e=e.parent===this._root?null:e.parent._item}else e=t._start}while(null!==e&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,null===e?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class Zr extends ur{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,t){super._integrate(e,t),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Zr}clone(){const e=new Zr;return e.insert(0,this.toArray().map((e=>e instanceof ur?e.clone():e))),e}get length(){return null===this._prelimContent?this._length:this._prelimContent.length}createTreeWalker(e){return new Xr(this,e)}querySelector(e){e=e.toUpperCase();const t=new Xr(this,(t=>t.nodeName&&t.nodeName.toUpperCase()===e)),n=t.next();return n.done?null:n.value}querySelectorAll(e){return e=e.toUpperCase(),a(new Xr(this,(t=>t.nodeName&&t.nodeName.toUpperCase()===e)))}_callObserver(e,t){lr(this,e,new rs(this,t,e))}toString(){return gr(this,(e=>e.toString())).join("")}toJSON(){return this.toString()}toDOM(e=document,t={},n){const r=e.createDocumentFragment();return void 0!==n&&n._createAssociation(r,this),fr(this,(s=>{r.insertBefore(s.toDOM(e,t,n),null)})),r}insert(e,t){null!==this.doc?Mn(this.doc,(n=>{vr(n,this,e,t)})):this._prelimContent.splice(e,0,...t)}insertAfter(e,t){if(null!==this.doc)Mn(this.doc,(n=>{const r=e&&e instanceof ur?e._item:e;wr(n,this,r,t)}));else{const n=this._prelimContent,r=null===e?0:n.findIndex((t=>t===e))+1;if(0===r&&null!==e)throw ce.Ue("Reference item not found");n.splice(r,0,...t)}}delete(e,t=1){null!==this.doc?Mn(this.doc,(n=>{_r(n,this,e,t)})):this._prelimContent.splice(e,t)}toArray(){return dr(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return yr(this,e)}slice(e=0,t=this.length){return hr(this,e,t)}forEach(e){fr(this,e)}_write(e){e.writeTypeRef(Ds)}}const es=e=>new Zr;class ts extends Zr{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,t){super._integrate(e,t),this._prelimAttrs.forEach(((e,t)=>{this.setAttribute(t,e)})),this._prelimAttrs=null}_copy(){return new ts(this.nodeName)}clone(){const e=new ts(this.nodeName),t=this.getAttributes();for(const n in t)e.setAttribute(n,t[n]);return e.insert(0,this.toArray().map((e=>e instanceof ur?e.clone():e))),e}toString(){const e=this.getAttributes(),t=[],n=[];for(const o in e)n.push(o);n.sort();const r=n.length;for(let o=0;o<r;o++){const r=n[o];t.push(r+'="'+e[r]+'"')}const s=this.nodeName.toLocaleLowerCase(),i=t.length>0?" "+t.join(" "):"";return`<${s}${i}>${super.toString()}</${s}>`}removeAttribute(e){null!==this.doc?Mn(this.doc,(t=>{Sr(t,this,e)})):this._prelimAttrs.delete(e)}setAttribute(e,t){null!==this.doc?Mn(this.doc,(n=>{kr(n,this,e,t)})):this._prelimAttrs.set(e,t)}getAttribute(e){return Ar(this,e)}hasAttribute(e){return Cr(this,e)}getAttributes(){return Tr(this)}toDOM(e=document,t={},n){const r=e.createElement(this.nodeName),s=this.getAttributes();for(const i in s)r.setAttribute(i,s[i]);return fr(this,(s=>{r.appendChild(s.toDOM(e,t,n))})),void 0!==n&&n._createAssociation(r,this),r}_write(e){e.writeTypeRef(Ns),e.writeKey(this.nodeName)}}const ns=e=>new ts(e.readKey());class rs extends Zn{constructor(e,t,n){super(e,n),this.childListChanged=!1,this.attributesChanged=new Set,t.forEach((e=>{null===e?this.childListChanged=!0:this.attributesChanged.add(e)}))}}class ss extends Dr{constructor(e){super(),this.hookName=e}_copy(){return new ss(this.hookName)}clone(){const e=new ss(this.hookName);return this.forEach(((t,n)=>{e.set(n,t)})),e}toDOM(e=document,t={},n){const r=t[this.hookName];let s;return s=void 0!==r?r.createDom(this):document.createElement(this.hookName),s.setAttribute("data-yjs-hook",this.hookName),void 0!==n&&n._createAssociation(s,this),s}_write(e){e.writeTypeRef(Ps),e.writeKey(this.hookName)}}const is=e=>new ss(e.readKey());class os extends Jr{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new os}clone(){const e=new os;return e.applyDelta(this.toDelta()),e}toDOM(e=document,t,n){const r=e.createTextNode(this.toString());return void 0!==n&&n._createAssociation(r,this),r}toString(){return this.toDelta().map((e=>{const t=[];for(const r in e.attributes){const n=[];for(const t in e.attributes[r])n.push({key:t,value:e.attributes[r][t]});n.sort(((e,t)=>e.key<t.key?-1:1)),t.push({nodeName:r,attrs:n})}t.sort(((e,t)=>e.nodeName<t.nodeName?-1:1));let n="";for(let r=0;r<t.length;r++){const e=t[r];n+=`<${e.nodeName}`;for(let t=0;t<e.attrs.length;t++){const r=e.attrs[t];n+=` ${r.key}="${r.value}"`}n+=">"}n+=e.insert;for(let r=t.length-1;r>=0;r--)n+=`</${t[r].nodeName}>`;return n})).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(Ls)}}const as=e=>new os;class cs{constructor(e,t){this.id=e,this.length=t}get deleted(){throw ce.Nw()}mergeWith(e){return!1}write(e,t,n){throw ce.Nw()}integrate(e,t){throw ce.Nw()}}const ls=0;class us extends cs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){t>0&&(this.id.clock+=t,this.length-=t),vn(e.doc.store,this)}write(e,t){e.writeInfo(ls),e.writeLen(this.length-t)}getMissing(e,t){return null}}class hs{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new hs(this.content)}splice(e){throw ce.Nw()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeBuf(this.content)}getRef(){return 3}}const ds=e=>new hs(e.readBuf());class ps{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new ps(this.len)}splice(e){const t=new ps(this.len-e);return this.len=e,t}mergeWith(e){return this.len+=e.len,!0}integrate(e,t){ft(e.deleteSet,t.id.client,t.id.clock,this.len),t.markDeleted()}delete(e){}gc(e){}write(e,t){e.writeLen(this.len-t)}getRef(){return 1}}const fs=e=>new ps(e.readLen()),gs=(e,t)=>new Et({guid:e,...t,shouldLoad:t.shouldLoad||t.autoLoad||!1});class ms{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const t={};this.opts=t,e.gc||(t.gc=!1),e.autoLoad&&(t.autoLoad=!0),null!==e.meta&&(t.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new ms(gs(this.doc.guid,this.opts))}splice(e){throw ce.Nw()}mergeWith(e){return!1}integrate(e,t){this.doc._item=t,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,t){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const ys=e=>new ms(gs(e.readString(),e.readAny()));class ws{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new ws(this.embed)}splice(e){throw ce.Nw()}mergeWith(e){return!1}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeJSON(this.embed)}getRef(){return 5}}const bs=e=>new ws(e.readJSON());class vs{constructor(e,t){this.key=e,this.value=t}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new vs(this.key,this.value)}splice(e){throw ce.Nw()}mergeWith(e){return!1}integrate(e,t){t.parent._searchMarker=null}delete(e){}gc(e){}write(e,t){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Es=e=>new vs(e.readKey(),e.readJSON());class _s{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new _s(this.arr)}splice(e){const t=new _s(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let r=t;r<n;r++){const t=this.arr[r];e.writeString(void 0===t?"undefined":JSON.stringify(t))}}getRef(){return 2}}const Ss=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++){const t=e.readString();"undefined"===t?n.push(void 0):n.push(JSON.parse(t))}return new _s(n)};class ks{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new ks(this.arr)}splice(e){const t=new ks(this.arr.slice(e));return this.arr=this.arr.slice(0,e),t}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){const n=this.arr.length;e.writeLen(n-t);for(let r=t;r<n;r++){const t=this.arr[r];e.writeAny(t)}}getRef(){return 8}}const As=e=>{const t=e.readLen(),n=[];for(let r=0;r<t;r++)n.push(e.readAny());return new ks(n)};class Ts{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ts(this.str)}splice(e){const t=new Ts(this.str.slice(e));this.str=this.str.slice(0,e);const n=this.str.charCodeAt(e-1);return n>=55296&&n<=56319&&(this.str=this.str.slice(0,e-1)+"�",t.str="�"+t.str.slice(1)),t}mergeWith(e){return this.str+=e.str,!0}integrate(e,t){}delete(e){}gc(e){}write(e,t){e.writeString(0===t?this.str:this.str.slice(t))}getRef(){return 4}}const Cs=e=>new Ts(e.readString()),Is=[xr,Pr,Qr,ns,es,is,as],Rs=0,Os=1,xs=2,Ns=3,Ds=4,Ps=5,Ls=6;class Ms{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new Ms(this.type._copy())}splice(e){throw ce.Nw()}mergeWith(e){return!1}integrate(e,t){this.type._integrate(e.doc,t)}delete(e){let t=this.type._start;while(null!==t)t.deleted?e._mergeStructs.push(t):t.delete(e),t=t.right;this.type._map.forEach((t=>{t.deleted?e._mergeStructs.push(t):t.delete(e)})),e.changed.delete(this.type)}gc(e){let t=this.type._start;while(null!==t)t.gc(e,!0),t=t.right;this.type._start=null,this.type._map.forEach((t=>{while(null!==t)t.gc(e,!0),t=t.left})),this.type._map=new Map}write(e,t){this.type._write(e)}getRef(){return 7}}const Bs=e=>new Ms(Is[e.readTypeRef()](e)),Us=(e,t)=>{let n,r=t,s=0;do{s>0&&(r=en(r.client,r.clock+s)),n=Sn(e,r),s=r.clock-n.id.clock,r=n.redone}while(null!==r&&n instanceof zs);return{item:n,diff:s}},Vs=(e,t)=>{while(null!==e&&e.keep!==t)e.keep=t,e=e.parent._item},Fs=(e,t,n)=>{const{client:r,clock:s}=t.id,i=new zs(en(r,s+n),t,en(r,s+n-1),t.right,t.rightOrigin,t.parent,t.parentSub,t.content.splice(n));return t.deleted&&i.markDeleted(),t.keep&&(i.keep=!0),null!==t.redone&&(i.redone=en(t.redone.client,t.redone.clock+n)),t.right=i,null!==i.right&&(i.right.left=i),e._mergeStructs.push(i),null!==i.parentSub&&null===i.right&&i.parent._map.set(i.parentSub,i),t.length=n,i},js=(e,t,n,r,s)=>{const i=e.doc,o=i.store,a=i.clientID,c=t.redone;if(null!==c)return An(e,c);let l,u=t.parent._item,h=null;if(null!==u&&!0===u.deleted){if(null===u.redone&&(!n.has(u)||null===js(e,u,n,r,s)))return null;while(null!==u.redone)u=An(e,u.redone)}const d=null===u?t.parent:u.content.type;if(null===t.parentSub){h=t.left,l=t;while(null!==h){let t=h;while(null!==t&&t.parent._item!==u)t=null===t.redone?null:An(e,t.redone);if(null!==t&&t.parent._item===u){h=t;break}h=h.left}while(null!==l){let t=l;while(null!==t&&t.parent._item!==u)t=null===t.redone?null:An(e,t.redone);if(null!==t&&t.parent._item===u){l=t;break}l=l.right}}else if(l=null,t.right&&!s){h=t;while(null!==h&&null!==h.right&&ht(r,h.right.id))h=h.right;while(null!==h&&null!==h.redone)h=An(e,h.redone);if(h&&null!==h.right)return null}else h=d._map.get(t.parentSub)||null;const p=bn(o,a),f=en(a,p),g=new zs(f,h,h&&h.lastId,l,l&&l.id,d,t.parentSub,t.content.copy());return t.redone=f,Vs(g,!0),g.integrate(e,0),g};class zs extends cs{constructor(e,t,n,r,s,i,o,a){super(e,a.getLength()),this.origin=n,this.left=t,this.right=r,this.rightOrigin=s,this.parent=i,this.parentSub=o,this.redone=null,this.content=a,this.info=this.content.isCountable()?E:0}set marker(e){(this.info&S)>0!==e&&(this.info^=S)}get marker(){return(this.info&S)>0}get keep(){return(this.info&v)>0}set keep(e){this.keep!==e&&(this.info^=v)}get countable(){return(this.info&E)>0}get deleted(){return(this.info&_)>0}set deleted(e){this.deleted!==e&&(this.info^=_)}markDeleted(){this.info|=_}getMissing(e,t){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=bn(t,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=bn(t,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Xt&&this.id.client!==this.parent.client&&this.parent.clock>=bn(t,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Tn(e,t,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=An(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===us||this.right&&this.right.constructor===us)&&(this.parent=null),this.parent){if(this.parent.constructor===Xt){const e=Sn(t,this.parent);e.constructor===us?this.parent=null:this.parent=e.content.type}}else this.left&&this.left.constructor===zs&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===zs&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);return null}integrate(e,t){if(t>0&&(this.id.clock+=t,this.left=Tn(e,e.doc.store,en(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(t),this.length-=t),this.parent){if(!this.left&&(!this.right||null!==this.right.left)||this.left&&this.left.right!==this.right){let t,n=this.left;if(null!==n)t=n.right;else if(null!==this.parentSub){t=this.parent._map.get(this.parentSub)||null;while(null!==t&&null!==t.left)t=t.left}else t=this.parent._start;const r=new Set,s=new Set;while(null!==t&&t!==this.right){if(s.add(t),r.add(t),Zt(this.origin,t.origin)){if(t.id.client<this.id.client)n=t,r.clear();else if(Zt(this.rightOrigin,t.rightOrigin))break}else{if(null===t.origin||!s.has(Sn(e.doc.store,t.origin)))break;r.has(Sn(e.doc.store,t.origin))||(n=t,r.clear())}t=t.right}this.left=n}if(null!==this.left){const e=this.left.right;this.right=e,this.left.right=this}else{let e;if(null!==this.parentSub){e=this.parent._map.get(this.parentSub)||null;while(null!==e&&null!==e.left)e=e.left}else e=this.parent._start,this.parent._start=this;this.right=e}null!==this.right?this.right.left=this:null!==this.parentSub&&(this.parent._map.set(this.parentSub,this),null!==this.left&&this.left.delete(e)),null===this.parentSub&&this.countable&&!this.deleted&&(this.parent._length+=this.length),vn(e.doc.store,this),this.content.integrate(e,this),xn(e,this.parent,this.parentSub),(null!==this.parent._item&&this.parent._item.deleted||null!==this.parentSub&&null!==this.right)&&this.delete(e)}else new us(this.id,this.length).integrate(e,0)}get next(){let e=this.right;while(null!==e&&e.deleted)e=e.right;return e}get prev(){let e=this.left;while(null!==e&&e.deleted)e=e.left;return e}get lastId(){return 1===this.length?this.id:en(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&Zt(e.origin,this.lastId)&&this.right===e&&Zt(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&null===this.redone&&null===e.redone&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const t=this.parent._searchMarker;return t&&t.forEach((t=>{t.p===e&&(t.p=this,!this.deleted&&this.countable&&(t.index-=this.length))})),e.keep&&(this.keep=!0),this.right=e.right,null!==this.right&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const t=this.parent;this.countable&&null===this.parentSub&&(t._length-=this.length),this.markDeleted(),ft(e.deleteSet,this.id.client,this.id.clock,this.length),xn(e,t,this.parentSub),this.content.delete(e)}}gc(e,t){if(!this.deleted)throw ce.zR();this.content.gc(e),t?Cn(e,this,new us(this.id,this.length)):this.content=new ps(this.length)}write(e,t){const n=t>0?en(this.id.client,this.id.clock+t-1):this.origin,r=this.rightOrigin,s=this.parentSub,i=this.content.getRef()&C|(null===n?0:T)|(null===r?0:A)|(null===s?0:k);if(e.writeInfo(i),null!==n&&e.writeLeftID(n),null!==r&&e.writeRightID(r),null===n&&null===r){const t=this.parent;if(void 0!==t._item){const n=t._item;if(null===n){const n=tn(t);e.writeParentInfo(!0),e.writeString(n)}else e.writeParentInfo(!1),e.writeLeftID(n.id)}else t.constructor===String?(e.writeParentInfo(!0),e.writeString(t)):t.constructor===Xt?(e.writeParentInfo(!1),e.writeLeftID(t)):ce.zR();null!==s&&e.writeString(s)}this.content.write(e,t)}}const $s=(e,t)=>Hs[t&C](e),Hs=[()=>{ce.zR()},fs,Ss,ds,Cs,bs,Es,Bs,As,ys,()=>{ce.zR()}],Ks=10;class qs extends cs{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor===e.constructor&&(this.length+=e.length,!0)}integrate(e,t){ce.zR()}write(e,t){e.writeInfo(Ks),F(e.restEncoder,this.length-t)}getMissing(e,t){return null}}const Gs="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof global?global:{},Ws="__ $YJS$ __";!0===Gs[Ws]&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438"),Gs[Ws]=!0}}]);
//# sourceMappingURL=chunk-vendors.91efa9cc.js.map